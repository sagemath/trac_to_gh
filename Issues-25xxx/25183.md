# Issue 25183: Bug in the associahedron object

archive/issues_024946.json:
```json
{
    "assignees": [],
    "body": "The following lines currently occur:\n\n```\nsage: A = polytopes.associahedron(['A',3])\nsage: face = A.faces(2)[3]\nsage: face\n<6,8,9,10>\nsage: face.as_polyhedron()\n/home/jplabbe/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:590: RichReprWarning: Exception in _rich_repr_ while displaying object: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'\n  RichReprWarning,\n<repr(<sage.combinat.root_system.associahedron.Associahedra_with_category.element_class at 0x7f48d0d7ad70>) failed: AttributeError: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'>\n```\n\nThe construction `as_polyhedron` initializes the new (face-)polyhedron via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.\n\nSame (or similar problem) with:\n\n- `minkowski_sum`,\n- `minkowski_difference`,\n- `translation`,\n- `dilation`,\n- `convex_hull`,\n- `intersection` (actually even worse as coercion fails),\n- `polar`.\n\nWe fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).\n\nFurther we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.\n\nWe fix `_coerce_map_from_` to take into account that no general polyhedron can be coerced to an associahedron.\n\nWe manually set the correct pushout of polyhedra over ZZ and associahedra (over QQ) to be polyhedra over QQ.\n\nDepends on #27798\n\nCC:  @fchapoton @stumpc5 @tscrim @mo271 @jplab @LaisRast\n\nKeywords: **associahedron**\n\nBranch/Commit: **[`d9083b7`](https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d)**\n\nReviewer: **Jean-Philippe Labb\u00e9, Travis Scrimshaw**\n\nAuthor: **Jonathan Kliem**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25183_\n\n",
    "closed_at": "2019-11-16T20:15:54Z",
    "created_at": "2018-04-16T15:23:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Bug in the associahedron object",
    "type": "issue",
    "updated_at": "2019-11-16T20:15:54Z",
    "url": "https://github.com/sagemath/sage/issues/25183",
    "user": "https://github.com/jplab"
}
```
The following lines currently occur:

```
sage: A = polytopes.associahedron(['A',3])
sage: face = A.faces(2)[3]
sage: face
<6,8,9,10>
sage: face.as_polyhedron()
/home/jplabbe/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:590: RichReprWarning: Exception in _rich_repr_ while displaying object: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'
  RichReprWarning,
<repr(<sage.combinat.root_system.associahedron.Associahedra_with_category.element_class at 0x7f48d0d7ad70>) failed: AttributeError: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'>
```

The construction `as_polyhedron` initializes the new (face-)polyhedron via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.

Same (or similar problem) with:

- `minkowski_sum`,
- `minkowski_difference`,
- `translation`,
- `dilation`,
- `convex_hull`,
- `intersection` (actually even worse as coercion fails),
- `polar`.

We fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).

Further we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.

We fix `_coerce_map_from_` to take into account that no general polyhedron can be coerced to an associahedron.

We manually set the correct pushout of polyhedra over ZZ and associahedra (over QQ) to be polyhedra over QQ.

Depends on #27798

CC:  @fchapoton @stumpc5 @tscrim @mo271 @jplab @LaisRast

Keywords: **associahedron**

Branch/Commit: **[`d9083b7`](https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d)**

Reviewer: **Jean-Philippe Labbé, Travis Scrimshaw**

Author: **Jonathan Kliem**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/25183_





---

archive/issue_events_350150.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-16T15:23:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350150"
}
```



---

archive/issue_events_350151.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-16T15:23:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350151"
}
```



---

archive/issue_events_350152.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-16T15:23:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350152"
}
```



---

archive/issue_events_350153.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-16T15:23:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350153"
}
```



---

archive/issue_comments_384933.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI think I took care of it in #27798.",
    "created_at": "2019-05-10T10:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384933",
    "user": "https://github.com/kliem"
}
```

<div id="comment:2" align="right">comment:2</div>

I think I took care of it in #27798.



---

archive/issue_events_350154.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-05-16T13:12:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350154"
}
```



---

archive/issue_comments_384934.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,9 @@\n   RichReprWarning,\n <repr(<sage.combinat.root_system.associahedron.Associahedra_with_category.element_class at 0x7f48d0d7ad70>) failed: AttributeError: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'>\n ```\n+\n+The construction `as_polyhedron` initializes the new (face-)polyhedron as via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.\n+\n+We fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).\n+\n+Further we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.\n``````\n",
    "created_at": "2019-05-16T13:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384934",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,9 @@
   RichReprWarning,
 <repr(<sage.combinat.root_system.associahedron.Associahedra_with_category.element_class at 0x7f48d0d7ad70>) failed: AttributeError: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'>
 ```
+
+The construction `as_polyhedron` initializes the new (face-)polyhedron as via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.
+
+We fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).
+
+Further we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.
``````




---

archive/issue_comments_384935.json:
```json
{
    "body": "Author: **Jonathan Kliem**",
    "created_at": "2019-05-16T13:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384935",
    "user": "https://github.com/kliem"
}
```

Author: **Jonathan Kliem**



---

archive/issue_comments_384936.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis branch should fix the bug.\n\nFeel free to change it, alter it, abonden it, etc.\n\nMaybe there is a better way to obtain the correct parent, i.e. improve the following lines:\n\n```\n156             for typ1 in ancestors_of_associahedron:\n157                 if typ1 in mro:\n158                     return typ1(parent, Vrep, Hrep, **kwds)\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26430784821c585ea4ab52327ac76ca18b7351b1\"><code>2643078</code></a></td><td><code>added `backend` to associahedron and flow polytope</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9b4826fd8db7a30960d203cc89a4e937c8785fc\"><code>a9b4826</code></a></td><td><code>typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87169854f26eab8a4030efef1869a1883500b336\"><code>8716985</code></a></td><td><code>corrected docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b873156d9459e778e560d9a9d499002e29470011\"><code>b873156</code></a></td><td><code>associahedron actually uses the claimed backend now</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f4bb257102026e66791f0c25547d7a8767467ac\"><code>1f4bb25</code></a></td><td><code>comments by tscrim</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c812c508f0f5d7a8a88f132e32b149e4cc58788\"><code>2c812c5</code></a></td><td><code>should have fixed bug in #25183</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65b11c9de95bb2ecde90c722ca2e9781fdac7cc5\"><code>65b11c9</code></a></td><td><code>removed redundant line</code></td></tr></table>\n",
    "created_at": "2019-05-16T13:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384936",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3" align="right">comment:3</div>

This branch should fix the bug.

Feel free to change it, alter it, abonden it, etc.

Maybe there is a better way to obtain the correct parent, i.e. improve the following lines:

```
156             for typ1 in ancestors_of_associahedron:
157                 if typ1 in mro:
158                     return typ1(parent, Vrep, Hrep, **kwds)
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26430784821c585ea4ab52327ac76ca18b7351b1"><code>2643078</code></a></td><td><code>added `backend` to associahedron and flow polytope</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9b4826fd8db7a30960d203cc89a4e937c8785fc"><code>a9b4826</code></a></td><td><code>typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87169854f26eab8a4030efef1869a1883500b336"><code>8716985</code></a></td><td><code>corrected docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b873156d9459e778e560d9a9d499002e29470011"><code>b873156</code></a></td><td><code>associahedron actually uses the claimed backend now</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f4bb257102026e66791f0c25547d7a8767467ac"><code>1f4bb25</code></a></td><td><code>comments by tscrim</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c812c508f0f5d7a8a88f132e32b149e4cc58788"><code>2c812c5</code></a></td><td><code>should have fixed bug in #25183</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65b11c9de95bb2ecde90c722ca2e9781fdac7cc5"><code>65b11c9</code></a></td><td><code>removed redundant line</code></td></tr></table>




---

archive/issue_comments_384937.json:
```json
{
    "body": "Commit: **[`65b11c9`](https://github.com/sagemath/sagetrac-mirror/commit/65b11c9de95bb2ecde90c722ca2e9781fdac7cc5)**",
    "created_at": "2019-05-16T13:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384937",
    "user": "https://github.com/kliem"
}
```

Commit: **[`65b11c9`](https://github.com/sagemath/sagetrac-mirror/commit/65b11c9de95bb2ecde90c722ca2e9781fdac7cc5)**



---

archive/issue_comments_384938.json:
```json
{
    "body": "Branch: **[public/25183](https://github.com/sagemath/sagetrac-mirror/tree/public/25183)**",
    "created_at": "2019-05-16T13:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384938",
    "user": "https://github.com/kliem"
}
```

Branch: **[public/25183](https://github.com/sagemath/sagetrac-mirror/tree/public/25183)**



---

archive/issue_comments_384939.json:
```json
{
    "body": "Dependencies: **27798**",
    "created_at": "2019-05-16T13:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384939",
    "user": "https://github.com/kliem"
}
```

Dependencies: **27798**



---

archive/issue_comments_384940.json:
```json
{
    "body": "Changed dependencies from **27798** to **#27798**",
    "created_at": "2019-05-16T13:12:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384940",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **27798** to **#27798**



---

archive/issue_events_350155.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-07-01T13:46:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350155"
}
```



---

archive/issue_events_350156.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-07-01T13:46:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350156"
}
```



---

archive/issue_events_350157.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-08-27T20:14:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350157"
}
```



---

archive/issue_events_350158.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-08-27T20:14:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350158"
}
```



---

archive/issue_comments_384941.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOnce #27798 is done, I'm going to rebase it and solve the merge conflict. At the moment it seems pointless to me.",
    "created_at": "2019-08-27T20:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384941",
    "user": "https://github.com/kliem"
}
```

<div id="comment:6" align="right">comment:6</div>

Once #27798 is done, I'm going to rebase it and solve the merge conflict. At the moment it seems pointless to me.



---

archive/issue_comments_384942.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,6 +13,16 @@\n \n The construction `as_polyhedron` initializes the new (face-)polyhedron as via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.\n \n+Same (or similar problem) with:\n+\n+- `minkowski_sum`,\n+- `minkowski_difference`,\n+- `translation`,\n+- `dilation`,\n+- `convex_hull`,\n+- `intersection` (actually even worse as coercion fails),\n+- `polar`.\n+\n We fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).\n \n Further we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.\n``````\n",
    "created_at": "2019-08-28T11:15:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384942",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,6 +13,16 @@
 
 The construction `as_polyhedron` initializes the new (face-)polyhedron as via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.
 
+Same (or similar problem) with:
+
+- `minkowski_sum`,
+- `minkowski_difference`,
+- `translation`,
+- `dilation`,
+- `convex_hull`,
+- `intersection` (actually even worse as coercion fails),
+- `polar`.
+
 We fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).
 
 Further we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.
``````




---

archive/issue_comments_384943.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/949b0a943b35aa4474d35890bf2fa5d966c6641f\"><code>949b0a9</code></a></td><td><code>added `backend` to associahedron and flow polytope</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e13719990d626cef945852e79d8ef68d92a99554\"><code>e137199</code></a></td><td><code>changed default value of `backend`; small changes in documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e892e7019001400faf0c3cfed542fffd3ac7227\"><code>0e892e7</code></a></td><td><code>modify construction and coercion of associahedra to fix bug #25183</code></td></tr></table>\n",
    "created_at": "2019-08-29T14:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384943",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/949b0a943b35aa4474d35890bf2fa5d966c6641f"><code>949b0a9</code></a></td><td><code>added `backend` to associahedron and flow polytope</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e13719990d626cef945852e79d8ef68d92a99554"><code>e137199</code></a></td><td><code>changed default value of `backend`; small changes in documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e892e7019001400faf0c3cfed542fffd3ac7227"><code>0e892e7</code></a></td><td><code>modify construction and coercion of associahedra to fix bug #25183</code></td></tr></table>




---

archive/issue_comments_384944.json:
```json
{
    "body": "Changed commit from **[`65b11c9`](https://github.com/sagemath/sagetrac-mirror/commit/65b11c9de95bb2ecde90c722ca2e9781fdac7cc5)** to **[`0e892e7`](https://github.com/sagemath/sagetrac-mirror/commit/0e892e7019001400faf0c3cfed542fffd3ac7227)**",
    "created_at": "2019-08-29T14:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384944",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`65b11c9`](https://github.com/sagemath/sagetrac-mirror/commit/65b11c9de95bb2ecde90c722ca2e9781fdac7cc5)** to **[`0e892e7`](https://github.com/sagemath/sagetrac-mirror/commit/0e892e7019001400faf0c3cfed542fffd3ac7227)**



---

archive/issue_comments_384945.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,7 @@\n <repr(<sage.combinat.root_system.associahedron.Associahedra_with_category.element_class at 0x7f48d0d7ad70>) failed: AttributeError: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'>\n ```\n \n-The construction `as_polyhedron` initializes the new (face-)polyhedron as via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.\n+The construction `as_polyhedron` initializes the new (face-)polyhedron via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.\n \n Same (or similar problem) with:\n \n@@ -26,3 +26,7 @@\n We fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).\n \n Further we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.\n+\n+We fix `_coerce_map_from_` to take into account that no general polyhedron can be coerced to an associahedron.\n+\n+We manually set the correct pushout of polyhedra over ZZ and associahedra (over QQ) to be polyhedra over QQ.\n``````\n",
    "created_at": "2019-08-29T14:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384945",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,7 @@
 <repr(<sage.combinat.root_system.associahedron.Associahedra_with_category.element_class at 0x7f48d0d7ad70>) failed: AttributeError: 'Associahedra_with_category.element_class' object has no attribute '_cartan_type'>
 ```
 
-The construction `as_polyhedron` initializes the new (face-)polyhedron as via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.
+The construction `as_polyhedron` initializes the new (face-)polyhedron via `P.__class__(parent, Vrep, None)`. In the case of the associahedron, this does not give a valid object, as the associahedron requires a cartan type as well.
 
 Same (or similar problem) with:
 
@@ -26,3 +26,7 @@
 We fix the initialization of the associahedron to now require the cartan type on `__init__` (before it was assumed to be set after initialization).
 
 Further we have `__new__` return the correct parent class such that e.g. the face of an `Associahedron_class_ppl` is constructed as `Polyhedron_ppl`.
+
+We fix `_coerce_map_from_` to take into account that no general polyhedron can be coerced to an associahedron.
+
+We manually set the correct pushout of polyhedra over ZZ and associahedra (over QQ) to be polyhedra over QQ.
``````




---

archive/issue_events_350159.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-08-29T14:39:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350159"
}
```



---

archive/issue_events_350160.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-08-29T14:39:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350160"
}
```



---

archive/issue_comments_384946.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI think I got things fixed now. Suggestions for better solutions are welcome.",
    "created_at": "2019-08-29T14:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384946",
    "user": "https://github.com/kliem"
}
```

<div id="comment:10" align="right">comment:10</div>

I think I got things fixed now. Suggestions for better solutions are welcome.



---

archive/issue_comments_384947.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThat looks good to me. Might be good to have some feedback from Travis or Fr\u00e9d\u00e9ric on the cartan side of things, if they are done properly.\n\nI would put this to positive review since the error appears to be fixed.",
    "created_at": "2019-11-12T23:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384947",
    "user": "https://github.com/jplab"
}
```

<div id="comment:12" align="right">comment:12</div>

That looks good to me. Might be good to have some feedback from Travis or Frédéric on the cartan side of things, if they are done properly.

I would put this to positive review since the error appears to be fixed.



---

archive/issue_comments_384948.json:
```json
{
    "body": "Reviewer: **Jean-Philippe Labb\u00e9**",
    "created_at": "2019-11-12T23:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384948",
    "user": "https://github.com/jplab"
}
```

Reviewer: **Jean-Philippe Labbé**



---

archive/issue_comments_384949.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI don't have any comments on the Cartan side as you are not really doing anything with them. However, I do have one comment about this code block:\n\n```python\n            for typ1 in ancestors_of_associahedron:\n                if typ1 in mro:\n                    return typ1(parent, Vrep, Hrep, **kwds)\n```\nMy understanding is there is no subclass relations among the classes in `ancestors_of_associahedron`. So I think it is faster to make that a `set` object and test\n\n```python\n            for typ1 in mro:\n                if typ1 in ancestors_of_associahedron:\n                    return typ1(parent, Vrep, Hrep, **kwds)\n```\nas `set` containment check is much faster and these classes are likely to be higher in the MRO. It also has a side effect of making all of these classes run in the same time. For example, imagine if you are looking for a `Polyhedron_polymake`, that means it has to check the through the entire MRO 4 times (and a bit more to actually find it). So this could become really expensive if you create lots of (temporary) associahedra.",
    "created_at": "2019-11-14T10:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384949",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

I don't have any comments on the Cartan side as you are not really doing anything with them. However, I do have one comment about this code block:

```python
            for typ1 in ancestors_of_associahedron:
                if typ1 in mro:
                    return typ1(parent, Vrep, Hrep, **kwds)
```
My understanding is there is no subclass relations among the classes in `ancestors_of_associahedron`. So I think it is faster to make that a `set` object and test

```python
            for typ1 in mro:
                if typ1 in ancestors_of_associahedron:
                    return typ1(parent, Vrep, Hrep, **kwds)
```
as `set` containment check is much faster and these classes are likely to be higher in the MRO. It also has a side effect of making all of these classes run in the same time. For example, imagine if you are looking for a `Polyhedron_polymake`, that means it has to check the through the entire MRO 4 times (and a bit more to actually find it). So this could become really expensive if you create lots of (temporary) associahedra.



---

archive/issue_comments_384950.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc20d20736f64b7e0242e086ee4bdc987be63120\"><code>cc20d20</code></a></td><td><code>modify construction and coercion of associahedra to fix bug #25183</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d\"><code>d9083b7</code></a></td><td><code>small change of order of iteration to be more efficient</code></td></tr></table>\n",
    "created_at": "2019-11-14T12:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384950",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc20d20736f64b7e0242e086ee4bdc987be63120"><code>cc20d20</code></a></td><td><code>modify construction and coercion of associahedra to fix bug #25183</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d"><code>d9083b7</code></a></td><td><code>small change of order of iteration to be more efficient</code></td></tr></table>




---

archive/issue_comments_384951.json:
```json
{
    "body": "Changed commit from **[`0e892e7`](https://github.com/sagemath/sagetrac-mirror/commit/0e892e7019001400faf0c3cfed542fffd3ac7227)** to **[`d9083b7`](https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d)**",
    "created_at": "2019-11-14T12:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384951",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`0e892e7`](https://github.com/sagemath/sagetrac-mirror/commit/0e892e7019001400faf0c3cfed542fffd3ac7227)** to **[`d9083b7`](https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d)**



---

archive/issue_comments_384952.json:
```json
{
    "body": "Changed branch from **[public/25183](https://github.com/sagemath/sagetrac-mirror/tree/public/25183)** to **[public/25183-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/25183-reb)**",
    "created_at": "2019-11-14T12:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384952",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/25183](https://github.com/sagemath/sagetrac-mirror/tree/public/25183)** to **[public/25183-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/25183-reb)**



---

archive/issue_comments_384953.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nChanged to order of iteration, such that it only runs once through mro now.",
    "created_at": "2019-11-14T12:49:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384953",
    "user": "https://github.com/kliem"
}
```

<div id="comment:15" align="right">comment:15</div>

Changed to order of iteration, such that it only runs once through mro now.



---

archive/issue_events_350161.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-11-14T12:59:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350161"
}
```



---

archive/issue_events_350162.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-11-14T12:59:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350162"
}
```



---

archive/issue_comments_384954.json:
```json
{
    "body": "Changed reviewer from **Jean-Philippe Labb\u00e9** to **Jean-Philippe Labb\u00e9, Travis Scrimshaw**",
    "created_at": "2019-11-14T12:59:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384954",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Jean-Philippe Labbé** to **Jean-Philippe Labbé, Travis Scrimshaw**



---

archive/issue_events_350163.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-11-14T12:59:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350163"
}
```



---

archive/issue_events_350164.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-11-14T12:59:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350164"
}
```



---

archive/issue_comments_384955.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks. LGTM.",
    "created_at": "2019-11-14T12:59:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384955",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks. LGTM.



---

archive/issue_events_350165.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-16T20:15:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350165"
}
```



---

archive/issue_events_350166.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "eb5d0df2602eaba6922a2d1b94d7b697af172bc1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-11-16T20:15:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25183#event-350166"
}
```



---

archive/issue_comments_384956.json:
```json
{
    "body": "Changed branch from **[public/25183-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/25183-reb)** to **[`d9083b7`](https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d)**",
    "created_at": "2019-11-16T20:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25183#issuecomment-384956",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/25183-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/25183-reb)** to **[`d9083b7`](https://github.com/sagemath/sagetrac-mirror/commit/d9083b70195aafacf95eb991e21099136101ce3d)**
