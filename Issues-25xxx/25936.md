# Issue 25936: Improvements to integrated curves and geodesics on manifolds

archive/issues_025699.json:
```json
{
    "body": "This ticket implements some improvements regarding integrated curves on manifolds, first appearing in #22951.\n\nIt adds `scipy.integrate.ode` as an integration solver. The main advantage is that it supports basic event handling, making it possible to detect frontiers of charts. This allows for integration on multiple charts, as shown in [this](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/solve_across_charts%20example.ipynb) notebook, which can be particularly useful to avoid singularities, or in manifold which cannot be represented by a single chart, like in [this one](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/solve_across_charts%20example%202.ipynb) (not commented).\n\n\nA side effect of this new method is that the time needed for the integration can be reduced (a lot!) by using objects created with `fast_callable` instead of symbolic expressions. This is used in [this](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/kerr_geodesic_minimal.ipynb) notebook to compute the shape of a geodesic in a Kerr spacetime. Speed test shows a x700 speedup compared to the default integration method \"rk4_maxima\".\n\n\n\n\nCC:  @egourgoulhon karimvanaelst\n\nKeywords: manifold, geodesic, integrated curve, integration, chart\n\nBranch/Commit: 61061c152b58324f182dccc2d89a35d8fe045709\n\nReviewer: Travis Scrimshaw, Eric Gourgoulhon\n\nAuthor: Florentin Jaffredo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25936\n\n",
    "closed_at": "2018-10-28T20:26:56Z",
    "created_at": "2018-07-26T13:13:16Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Improvements to integrated curves and geodesics on manifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25936",
    "user": "https://github.com/FlorentinJ"
}
```
This ticket implements some improvements regarding integrated curves on manifolds, first appearing in #22951.

It adds `scipy.integrate.ode` as an integration solver. The main advantage is that it supports basic event handling, making it possible to detect frontiers of charts. This allows for integration on multiple charts, as shown in [this](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/solve_across_charts%20example.ipynb) notebook, which can be particularly useful to avoid singularities, or in manifold which cannot be represented by a single chart, like in [this one](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/solve_across_charts%20example%202.ipynb) (not commented).


A side effect of this new method is that the time needed for the integration can be reduced (a lot!) by using objects created with `fast_callable` instead of symbolic expressions. This is used in [this](http://nbviewer.jupyter.org/github/FlorentinJ/Sage_examples/blob/master/kerr_geodesic_minimal.ipynb) notebook to compute the shape of a geodesic in a Kerr spacetime. Speed test shows a x700 speedup compared to the default integration method "rk4_maxima".




CC:  @egourgoulhon karimvanaelst

Keywords: manifold, geodesic, integrated curve, integration, chart

Branch/Commit: 61061c152b58324f182dccc2d89a35d8fe045709

Reviewer: Travis Scrimshaw, Eric Gourgoulhon

Author: Florentin Jaffredo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25936





---

archive/issue_comments_498138.json:
```json
{
    "body": "Changing commit from \"3512312ee75d8e158067f2166696854ee2757e95\" to \"65f231dd03d59c38239f3d499607fb707d907d50\"",
    "created_at": "2018-07-26T13:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3512312ee75d8e158067f2166696854ee2757e95" to "65f231dd03d59c38239f3d499607fb707d907d50"



---

archive/issue_comments_498139.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-26T13:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_498140.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-31T19:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_498141.json:
```json
{
    "body": "Changing commit from \"65f231dd03d59c38239f3d499607fb707d907d50\" to \"4c9732ad7523e1f72bc8a38354816397e9cdccd4\"",
    "created_at": "2018-07-31T19:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "65f231dd03d59c38239f3d499607fb707d907d50" to "4c9732ad7523e1f72bc8a38354816397e9cdccd4"



---

archive/issue_comments_498142.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-06T10:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498142",
    "user": "https://github.com/FlorentinJ"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_498143.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-07T12:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498143",
    "user": "https://github.com/FlorentinJ"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_498144.json:
```json
{
    "body": "<a id='comment:4'></a>Forgot some doctests after the last commit + debug print not removed",
    "created_at": "2018-08-07T12:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498144",
    "user": "https://github.com/FlorentinJ"
}
```

<a id='comment:4'></a>Forgot some doctests after the last commit + debug print not removed



---

archive/issue_comments_498145.json:
```json
{
    "body": "Changing commit from \"4c9732ad7523e1f72bc8a38354816397e9cdccd4\" to \"f0330d2eabde2f251155f4fd3bb08bddf52cd760\"",
    "created_at": "2018-08-08T11:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4c9732ad7523e1f72bc8a38354816397e9cdccd4" to "f0330d2eabde2f251155f4fd3bb08bddf52cd760"



---

archive/issue_comments_498146.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-08T11:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_498147.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-08T11:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498147",
    "user": "https://github.com/FlorentinJ"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_498148.json:
```json
{
    "body": "<a id='comment:7'></a>Some little things:\n\n- You have `$` in docstrings which should be ```.\n- Sometimes it is better to break PEP8 80 char/line, e.g.:\n  {{{\n-        for ichart in set(initial_pt._coordinates.keys()).\\\n-            intersection(charts):\n+        for ichart in set(initial_pt._coordinates.keys()).intersection(charts):\n  }}}\n- This is confusing to read and needs more whitespace padding on the subsequent lines:\n  {{{\n                res += self.plot_integrated(chart=chart,\n             ambient_coords=ambient_coords, mapping=mapping, prange=prange,\n             interpolation_key=interpolation_key+\"_chart_\"+str(i),\n             include_end_point=include_end_point,\n             end_point_offset=end_point_offset, verbose=verbose, color=color[i],\n             style=style, label_axes=False, display_tangent=display_tangent,\n             color_tangent=color_tangent, across_charts=False,\n             plot_points=nb_pts, **kwds)\n  }}}\n- Please remove a lot (all) of these blanklines:\n  {{{#!diff\n+            sphinx_plot(fig)\n+\n+\n+\n+\n+        \"\"\"\n  }}}\n- PEP8:\n  {{{#!diff\n     def solve_across_charts(self, charts=None, step=None, solution_key=None,\n-              parameters_values=None, verbose=False):\n+                            parameters_values=None, verbose=False):\n  }}}\n- `euclidean` -> `Euclidean`.\n- `Let's also Add restrictions` -> `Let us also add restrictions`.\n- You're not always consistent with your periods/full-stops at the end of verbose messages.\n\nOtherwise I think I am good with the current branch as it seems to work as claimed. Eric, any other comments?",
    "created_at": "2018-09-29T00:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498148",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Some little things:

- You have `$` in docstrings which should be ```.
- Sometimes it is better to break PEP8 80 char/line, e.g.:
  {{{
-        for ichart in set(initial_pt._coordinates.keys()).\
-            intersection(charts):
+        for ichart in set(initial_pt._coordinates.keys()).intersection(charts):
  }}}
- This is confusing to read and needs more whitespace padding on the subsequent lines:
  {{{
                res += self.plot_integrated(chart=chart,
             ambient_coords=ambient_coords, mapping=mapping, prange=prange,
             interpolation_key=interpolation_key+"_chart_"+str(i),
             include_end_point=include_end_point,
             end_point_offset=end_point_offset, verbose=verbose, color=color[i],
             style=style, label_axes=False, display_tangent=display_tangent,
             color_tangent=color_tangent, across_charts=False,
             plot_points=nb_pts, **kwds)
  }}}
- Please remove a lot (all) of these blanklines:
  {{{#!diff
+            sphinx_plot(fig)
+
+
+
+
+        """
  }}}
- PEP8:
  {{{#!diff
     def solve_across_charts(self, charts=None, step=None, solution_key=None,
-              parameters_values=None, verbose=False):
+                            parameters_values=None, verbose=False):
  }}}
- `euclidean` -> `Euclidean`.
- `Let's also Add restrictions` -> `Let us also add restrictions`.
- You're not always consistent with your periods/full-stops at the end of verbose messages.

Otherwise I think I am good with the current branch as it seems to work as claimed. Eric, any other comments?



---

archive/issue_comments_498149.json:
```json
{
    "body": "Changing commit from \"f0330d2eabde2f251155f4fd3bb08bddf52cd760\" to \"d16555c536fddedf2f7a69657c7af5dccbfbcd39\"",
    "created_at": "2018-10-08T00:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f0330d2eabde2f251155f4fd3bb08bddf52cd760" to "d16555c536fddedf2f7a69657c7af5dccbfbcd39"



---

archive/issue_comments_498150.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T00:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_498151.json:
```json
{
    "body": "<a id='comment:9'></a>This takes care of my[comment:7](#comment%3A7). Eric, do you have any comments? Otherwise I think this is good to go.",
    "created_at": "2018-10-08T00:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498151",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>This takes care of my[comment:7](#comment%3A7). Eric, do you have any comments? Otherwise I think this is good to go.



---

archive/issue_comments_498152.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-10-08T00:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498152",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_498153.json:
```json
{
    "body": "Changing commit from \"d16555c536fddedf2f7a69657c7af5dccbfbcd39\" to \"61061c152b58324f182dccc2d89a35d8fe045709\"",
    "created_at": "2018-10-23T16:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498153",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d16555c536fddedf2f7a69657c7af5dccbfbcd39" to "61061c152b58324f182dccc2d89a35d8fe045709"



---

archive/issue_comments_498154.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-23T16:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_498155.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [tscrim](#comment%3A9):\n> This takes care of my[comment:7](#comment%3A7). Eric, do you have any comments? Otherwise I think this is good to go.\n\n\nSorry for the delay in replying... I've pushed a new commit (comment:10), which corrects a doctest error as well as a pyflakes one. It also improves slightly the documentation. This is fully OK for me. Karim, do you have any further comment?",
    "created_at": "2018-10-23T16:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498155",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'></a>Replying to [tscrim](#comment%3A9):
> This takes care of my[comment:7](#comment%3A7). Eric, do you have any comments? Otherwise I think this is good to go.


Sorry for the delay in replying... I've pushed a new commit (comment:10), which corrects a doctest error as well as a pyflakes one. It also improves slightly the documentation. This is fully OK for me. Karim, do you have any further comment?



---

archive/issue_events_064839.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2018-10-23T16:25:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25936#event-64839"
}
```



---

archive/issue_comments_498156.json:
```json
{
    "body": "<a id='comment:13'></a>Good for me up to any comments from Karim.",
    "created_at": "2018-10-23T16:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498156",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Good for me up to any comments from Karim.



---

archive/issue_comments_498157.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [tscrim](#comment%3A13):\n> Good for me up to any comments from Karim.\n\n\nI actually have no comment to make, thank you for asking and for this great improvement!",
    "created_at": "2018-10-25T08:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498157",
    "user": "https://trac.sagemath.org/admin/accounts/users/karimvanaelst"
}
```

<a id='comment:14'></a>Replying to [tscrim](#comment%3A13):
> Good for me up to any comments from Karim.


I actually have no comment to make, thank you for asking and for this great improvement!



---

archive/issue_comments_498158.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-26T01:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498158",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_498159.json:
```json
{
    "body": "Changing reviewer from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Eric Gourgoulhon\"",
    "created_at": "2018-10-26T01:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498159",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "Travis Scrimshaw" to "Travis Scrimshaw, Eric Gourgoulhon"



---

archive/issue_comments_498160.json:
```json
{
    "body": "Changing branch from \"public/manifolds/better_integrated_curve\" to \"61061c152b58324f182dccc2d89a35d8fe045709\"",
    "created_at": "2018-10-28T20:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498160",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/manifolds/better_integrated_curve" to "61061c152b58324f182dccc2d89a35d8fe045709"



---

archive/issue_events_064840.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-28T20:26:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25936#event-64840"
}
```



---

archive/issue_comments_498161.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-28T20:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25936#issuecomment-498161",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
