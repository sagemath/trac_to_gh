# Issue 25316: Replace python 5755 patch by monkey patch

archive/issues_025079.json:
```json
{
    "body": "Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. it seems: https://github.com/python/cpython/pull/7476\n\nBecause of that, Sage patches Python.\n\nI don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as Python) should be avoided if possible.\n\nIn this case it is possible: We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument. That's a bit of a hack of course. But it doesn't have any practical disadvantages to the Python patch and removes one patch from Python.\n\n**Branch:** [u/gh-timokau/monkey-patch-5755](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/monkey-patch-5755)\n\n**Commit:** [88e9acd8c91b8f0d84f1f80502298944248e136f](https://github.com/sagemath/sagetrac-mirror/commit/88e9acd8c91b8f0d84f1f80502298944248e136f)\n\n**Upstream:** Fixed upstream, in a later stable release.\n\n**Author:** Timo Kaufmann\n\nIssue created by migration from https://trac.sagemath.org/ticket/25316\n\n",
    "closed_at": "2022-05-19T15:37:46Z",
    "created_at": "2018-05-09T10:34:40Z",
    "labels": [
        "component: packages: standard",
        "enhancement",
        "wontfix"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Replace python 5755 patch by monkey patch",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25316",
    "user": "https://github.com/timokau"
}
```
Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. it seems: https://github.com/python/cpython/pull/7476

Because of that, Sage patches Python.

I don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as Python) should be avoided if possible.

In this case it is possible: We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument. That's a bit of a hack of course. But it doesn't have any practical disadvantages to the Python patch and removes one patch from Python.

**Branch:** [u/gh-timokau/monkey-patch-5755](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/monkey-patch-5755)

**Commit:** [88e9acd8c91b8f0d84f1f80502298944248e136f](https://github.com/sagemath/sagetrac-mirror/commit/88e9acd8c91b8f0d84f1f80502298944248e136f)

**Upstream:** Fixed upstream, in a later stable release.

**Author:** Timo Kaufmann

Issue created by migration from https://trac.sagemath.org/ticket/25316





---

archive/issue_comments_462601.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-05-09T10:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462601",
    "user": "https://github.com/timokau"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_462602.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n-Python bug #5755 won't be fixed in 2.7. Because of that, sage patches python.\n+Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. Because of that, Sage patches Python.\n \n-I don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as python) should be avoided if possible.\n+I don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as Python) should be avoided if possible.\n \n-In this case it is possible: We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument. Thats a bit of a hack of course. But it doesn't have any practical disadvantages to the python patch and removes one patch from python.\n+In this case it is possible: We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument. That's a bit of a hack of course. But it doesn't have any practical disadvantages to the Python patch and removes one patch from Python.\n``````\n",
    "created_at": "2018-05-09T11:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462602",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
-Python bug #5755 won't be fixed in 2.7. Because of that, sage patches python.
+Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. Because of that, Sage patches Python.
 
-I don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as python) should be avoided if possible.
+I don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as Python) should be avoided if possible.
 
-In this case it is possible: We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument. Thats a bit of a hack of course. But it doesn't have any practical disadvantages to the python patch and removes one patch from python.
+In this case it is possible: We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument. That's a bit of a hack of course. But it doesn't have any practical disadvantages to the Python patch and removes one patch from Python.
``````




---

archive/issue_comments_462603.json:
```json
{
    "body": "Replying to [ticket:25316 gh-timokau]:\n> We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument.\n\n\nI don't see that in your branch.",
    "created_at": "2018-05-09T11:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462603",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:25316 gh-timokau]:
> We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument.


I don't see that in your branch.



---

archive/issue_comments_462604.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-05-09T11:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462604",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_462605.json:
```json
{
    "body": "<a id='comment:4'></a>\nTwo general comments:\n\n1. This patch fixes a *warning*, it should not affect functionality. Are there any problems building Sage without this patch?\n\n2. There are plenty of patches to Python in Sage. I don't think that all of them can be replaced by a monkey-patch, so how does it help if this one patch is removed?",
    "created_at": "2018-05-09T12:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462605",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Two general comments:

1. This patch fixes a *warning*, it should not affect functionality. Are there any problems building Sage without this patch?

2. There are plenty of patches to Python in Sage. I don't think that all of them can be replaced by a monkey-patch, so how does it help if this one patch is removed?



---

archive/issue_comments_462606.json:
```json
{
    "body": "**Changing commit** from \"[ea015bf38c6498d65bb1e3e456424fff82650fb5](https://github.com/sagemath/sagetrac-mirror/commit/ea015bf38c6498d65bb1e3e456424fff82650fb5)\" to \"[88e9acd8c91b8f0d84f1f80502298944248e136f](https://github.com/sagemath/sagetrac-mirror/commit/88e9acd8c91b8f0d84f1f80502298944248e136f)\".",
    "created_at": "2018-05-09T12:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462606",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ea015bf38c6498d65bb1e3e456424fff82650fb5](https://github.com/sagemath/sagetrac-mirror/commit/ea015bf38c6498d65bb1e3e456424fff82650fb5)" to "[88e9acd8c91b8f0d84f1f80502298944248e136f](https://github.com/sagemath/sagetrac-mirror/commit/88e9acd8c91b8f0d84f1f80502298944248e136f)".



---

archive/issue_comments_462607.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88e9acd8c91b8f0d84f1f80502298944248e136f\">88e9acd</a></td><td><code>Replace python 5755 patch by monkey patch</code></td></tr></table>\n",
    "created_at": "2018-05-09T12:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462607",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88e9acd8c91b8f0d84f1f80502298944248e136f">88e9acd</a></td><td><code>Replace python 5755 patch by monkey patch</code></td></tr></table>




---

archive/issue_comments_462608.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jdemeyer](#comment%3A3):\n> Replying to [ticket:25316 gh-timokau]:\n> > We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument.\n\n> \n> I don't see that in your branch.\n\n\nOh sorry, I must've forgotten to `git add` it. I've amended the commit.",
    "created_at": "2018-05-09T12:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462608",
    "user": "https://github.com/timokau"
}
```

<a id='comment:6'></a>
Replying to [jdemeyer](#comment%3A3):
> Replying to [ticket:25316 gh-timokau]:
> > We can instead monkey-patch `build_extensions` to always remove the `-Wstrict-prototypes` argument.

> 
> I don't see that in your branch.


Oh sorry, I must've forgotten to `git add` it. I've amended the commit.



---

archive/issue_comments_462609.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jdemeyer](#comment%3A4):\n> Two general comments:\n> \n> 1. This patch fixes a *warning*, it should not affect functionality. Are there any problems building Sage without this patch?\n\n\nNot building, but it causes the doctests to fail.\n\n> 2. There are plenty of patches to Python in Sage. I don't think that all of them can be replaced by a monkey-patch, so how does it help if this one patch is removed?\n\n\nIts not *that* much. I only had to adopt two: `re_match_index-issue_27177.patch` (apparently `re` is impossible to monkey-patch) and `descr_ref-issue_25750.patch`.\n\nThe re patch was accepted upstream but unfortuantely not backported to 2.7.\n\nThe other one is currently in an upstream PR and seems likely to be accepted.\n\nSo after that one is accepted, only one patch is needed. I think just because 0 patches can't be archived doesn't mean the amount shouldn't be minimized.",
    "created_at": "2018-05-09T12:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462609",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'></a>
Replying to [jdemeyer](#comment%3A4):
> Two general comments:
> 
> 1. This patch fixes a *warning*, it should not affect functionality. Are there any problems building Sage without this patch?


Not building, but it causes the doctests to fail.

> 2. There are plenty of patches to Python in Sage. I don't think that all of them can be replaced by a monkey-patch, so how does it help if this one patch is removed?


Its not *that* much. I only had to adopt two: `re_match_index-issue_27177.patch` (apparently `re` is impossible to monkey-patch) and `descr_ref-issue_25750.patch`.

The re patch was accepted upstream but unfortuantely not backported to 2.7.

The other one is currently in an upstream PR and seems likely to be accepted.

So after that one is accepted, only one patch is needed. I think just because 0 patches can't be archived doesn't mean the amount shouldn't be minimized.



---

archive/issue_comments_462610.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [gh-timokau](#comment%3A7):\n> it causes the doctests to fail.\n\n\nCan you show the test failures?",
    "created_at": "2018-05-09T14:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462610",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [gh-timokau](#comment%3A7):
> it causes the doctests to fail.


Can you show the test failures?



---

archive/issue_comments_462611.json:
```json
{
    "body": "<a id='comment:9'></a>\nSurprisingly not all that many, just 3 tests in `cython.py`:\n\nhttps://gist.github.com/timokau/569928555dcec4868d7411c0ca6beb51",
    "created_at": "2018-05-09T21:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462611",
    "user": "https://github.com/timokau"
}
```

<a id='comment:9'></a>
Surprisingly not all that many, just 3 tests in `cython.py`:

https://gist.github.com/timokau/569928555dcec4868d7411c0ca6beb51



---

archive/issue_comments_462612.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-05-10T11:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462612",
    "user": "https://github.com/timokau"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_462613.json:
```json
{
    "body": "<a id='comment:11'></a>\nTo be honest, I'm not too happy with this branch. The Python patch that you want to remove fixes an obvious bug. The way I see it, you're proposing that Sage **adds** a Python bug. I don't think that Sage should suffer because upstream Python ignores a bug report.\n\nOf course, I'll admit that I'm very biased: I'm not packaging Sage for a distro, so I'm in a very different situation than you are.",
    "created_at": "2018-05-11T21:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462613",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
To be honest, I'm not too happy with this branch. The Python patch that you want to remove fixes an obvious bug. The way I see it, you're proposing that Sage **adds** a Python bug. I don't think that Sage should suffer because upstream Python ignores a bug report.

Of course, I'll admit that I'm very biased: I'm not packaging Sage for a distro, so I'm in a very different situation than you are.



---

archive/issue_comments_462614.json:
```json
{
    "body": "<a id='comment:12'></a>\nI get where you're coming from. Its a matter of priorities: every patch to sages dependencies makes packaging sage a bit more painful. In my mind reducing that hurdle is more valuable than the \"purity\" gained by patching python instead. If upstream doesn't recognize the bug, I think its best to work around it if possible.\n\nIts not *that* important to me anymore: I already have a working patch for sage that probably won't be too hard to maintain. But it is one more annoyance if somebody wants to create a sage package for another distro.",
    "created_at": "2018-05-12T14:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462614",
    "user": "https://github.com/timokau"
}
```

<a id='comment:12'></a>
I get where you're coming from. Its a matter of priorities: every patch to sages dependencies makes packaging sage a bit more painful. In my mind reducing that hurdle is more valuable than the "purity" gained by patching python instead. If upstream doesn't recognize the bug, I think its best to work around it if possible.

Its not *that* important to me anymore: I already have a working patch for sage that probably won't be too hard to maintain. But it is one more annoyance if somebody wants to create a sage package for another distro.



---

archive/issue_comments_462615.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [gh-timokau](#comment%3A12):\n> If upstream doesn't recognize the bug, I think its best to work around it if possible.\n\n\nThis is the part that I disagree most with. In my view, it's Python who is at fault here, not Sage.\n\nMaybe I should just open a real pull request for the upstream Python issue?",
    "created_at": "2018-05-12T14:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462615",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [gh-timokau](#comment%3A12):
> If upstream doesn't recognize the bug, I think its best to work around it if possible.


This is the part that I disagree most with. In my view, it's Python who is at fault here, not Sage.

Maybe I should just open a real pull request for the upstream Python issue?



---

archive/issue_comments_462616.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe patch produced here has a runtime effect: Any sage process will import distutils. It doesn't do that now.\n\nAnother, reduced, effect: presently, with the hard patch included, the \"sage\" python will have this fixed. After this fix, it will only have it fixed if it imports sage.all (which probably not all scripts in the sage distributions do).\n\nSo it looks like a proper monkeypatch fix would find a hook somewhere to execute the patch upon importing distutils. Another option would be to instead import some module distutils-fixed or so (together with distutils) to make the fix. That would basically amount to manually providing the relevant hook. That's probably rather invasive to maintain.\n\nI think the most important part is that sage can run as much as possible on vanilla python, so that we allow progress towards integrating sage as normal software, rather than having it live in its own little world. Given that the problem here seems to be a warning perhaps we don't need to insist on fixing it.",
    "created_at": "2018-05-12T19:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462616",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:14'></a>
The patch produced here has a runtime effect: Any sage process will import distutils. It doesn't do that now.

Another, reduced, effect: presently, with the hard patch included, the "sage" python will have this fixed. After this fix, it will only have it fixed if it imports sage.all (which probably not all scripts in the sage distributions do).

So it looks like a proper monkeypatch fix would find a hook somewhere to execute the patch upon importing distutils. Another option would be to instead import some module distutils-fixed or so (together with distutils) to make the fix. That would basically amount to manually providing the relevant hook. That's probably rather invasive to maintain.

I think the most important part is that sage can run as much as possible on vanilla python, so that we allow progress towards integrating sage as normal software, rather than having it live in its own little world. Given that the problem here seems to be a warning perhaps we don't need to insist on fixing it.



---

archive/issue_comments_462617.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A13):\n> In my view, it's Python who is at fault here, not Sage.\n\n\nDefinitely pythons fault. But what does it practically matter who is at fault? If python does not fix it, sage users (or packagers) are the ones who have to deal with it.\n\n> Maybe I should just open a real pull request for the upstream Python issue?\n> Replying to [gh-timokau](#comment%3A12):\n> > If upstream doesn't recognize the bug, I think its best to work around it if possible.\n\n\nThis is the part that I disagree most with. bug already something like a pull request that was effectively rejected? I'm not very familiar with the contribution process of python.\nIsn't the python \n\n\nReplying to [nbruin](#comment%3A14):\n> The patch produced here has a runtime effect: Any sage process will import distutils. It doesn't do that now.\n\n\nDoes that make any practical difference? Distutils will always be there anyways and while I haven't run any benchmarks, I can't imagine that it significantly impacts sages startup time.\n\n> Another, reduced, effect: presently, with the hard patch included, the \"sage\" python will have this fixed. After this fix, it will only have it fixed if it imports sage.all (which probably not all scripts in the sage distributions do).\n\n\nWell its just a warning after all, so practically it mostly matters to fix the doctests.\n\n> So it looks like a proper monkeypatch fix would find a hook somewhere to execute the patch upon importing distutils. Another option would be to instead import some module distutils-fixed or so (together with distutils) to make the fix. That would basically amount to manually providing the relevant hook. That's probably rather invasive to maintain.\n\n\nThat honestly exceeds my pthon knowledge.\n\n> I think the most important part is that sage can run as much as possible on vanilla python, so that we allow progress towards integrating sage as normal software, rather than having it live in its own little world.\n\n\nExactly my point.\n\n> Given that the problem here seems to be a warning perhaps we don't need to insist on fixing it.\n\n\nWe could instead just drop the patch entirely and fix the few failing doctests.\n\nI think its very valuable to have the doctests pass. Sages doctests may be a bit brittle, but very valuable\nnonetheless.",
    "created_at": "2018-05-12T21:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462617",
    "user": "https://github.com/timokau"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A13):
> In my view, it's Python who is at fault here, not Sage.


Definitely pythons fault. But what does it practically matter who is at fault? If python does not fix it, sage users (or packagers) are the ones who have to deal with it.

> Maybe I should just open a real pull request for the upstream Python issue?
> Replying to [gh-timokau](#comment%3A12):
> > If upstream doesn't recognize the bug, I think its best to work around it if possible.


This is the part that I disagree most with. bug already something like a pull request that was effectively rejected? I'm not very familiar with the contribution process of python.
Isn't the python 


Replying to [nbruin](#comment%3A14):
> The patch produced here has a runtime effect: Any sage process will import distutils. It doesn't do that now.


Does that make any practical difference? Distutils will always be there anyways and while I haven't run any benchmarks, I can't imagine that it significantly impacts sages startup time.

> Another, reduced, effect: presently, with the hard patch included, the "sage" python will have this fixed. After this fix, it will only have it fixed if it imports sage.all (which probably not all scripts in the sage distributions do).


Well its just a warning after all, so practically it mostly matters to fix the doctests.

> So it looks like a proper monkeypatch fix would find a hook somewhere to execute the patch upon importing distutils. Another option would be to instead import some module distutils-fixed or so (together with distutils) to make the fix. That would basically amount to manually providing the relevant hook. That's probably rather invasive to maintain.


That honestly exceeds my pthon knowledge.

> I think the most important part is that sage can run as much as possible on vanilla python, so that we allow progress towards integrating sage as normal software, rather than having it live in its own little world.


Exactly my point.

> Given that the problem here seems to be a warning perhaps we don't need to insist on fixing it.


We could instead just drop the patch entirely and fix the few failing doctests.

I think its very valuable to have the doctests pass. Sages doctests may be a bit brittle, but very valuable
nonetheless.



---

archive/issue_comments_462618.json:
```json
{
    "body": "<a id='comment:16'></a>\nHas the particular patch that you suggest as monkey-patch (but perhaps only for C++ extensions) been proposed as pull request? As far as I can tell not.",
    "created_at": "2018-05-13T09:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462618",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Has the particular patch that you suggest as monkey-patch (but perhaps only for C++ extensions) been proposed as pull request? As far as I can tell not.



---

archive/issue_comments_462619.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [gh-timokau](#comment%3A15):\n> Definitely pythons fault. But what does it practically matter who is at fault? If python does not fix it, sage users (or packagers) are the ones who have to deal with it.\n\n\nPackagers could just package the Python patch too.",
    "created_at": "2018-05-13T09:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462619",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [gh-timokau](#comment%3A15):
> Definitely pythons fault. But what does it practically matter who is at fault? If python does not fix it, sage users (or packagers) are the ones who have to deal with it.


Packagers could just package the Python patch too.



---

archive/issue_comments_462620.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jdemeyer](#comment%3A16):\n> Has the particular patch that you suggest as monkey-patch been proposed as pull request? As far as I can tell not.\n\n\nIsn't the python bug linked the equivalent of a pull request? As I said, not familiar with the process there. The best outcome would be if upstream just accepted the patch of course.\n\n> Packagers could just package the Python patch too.\n\n\nYeah thats what I meant with packagers have to deal with it. Every patch adds friction while packaging.",
    "created_at": "2018-05-13T09:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462620",
    "user": "https://github.com/timokau"
}
```

<a id='comment:18'></a>
Replying to [jdemeyer](#comment%3A16):
> Has the particular patch that you suggest as monkey-patch been proposed as pull request? As far as I can tell not.


Isn't the python bug linked the equivalent of a pull request? As I said, not familiar with the process there. The best outcome would be if upstream just accepted the patch of course.

> Packagers could just package the Python patch too.


Yeah thats what I meant with packagers have to deal with it. Every patch adds friction while packaging.



---

archive/issue_comments_462621.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [gh-timokau](#comment%3A18):\n> Isn't the python bug linked the equivalent of a pull request?\n\n\nThe patch sent upstream is the same patch as in Sage, but very different from what you are proposing as monkey-patch here. So my proposal is: change the monkey-patch to a real patch, make sure that it takes effect only for non-C code and then put that in a pull request.",
    "created_at": "2018-05-14T05:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462621",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Replying to [gh-timokau](#comment%3A18):
> Isn't the python bug linked the equivalent of a pull request?


The patch sent upstream is the same patch as in Sage, but very different from what you are proposing as monkey-patch here. So my proposal is: change the monkey-patch to a real patch, make sure that it takes effect only for non-C code and then put that in a pull request.



---

archive/issue_comments_462622.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [jdemeyer](#comment%3A19):\n> So my proposal is: change the monkey-patch to a real patch, make sure that it takes effect only for non-C code and then put that in a pull request.\n\n\nWhy should that have any better chances than the current one? In my view the one currently proposed upstream is \"cleaner\" as a hard-patch, because it doesn't add the flag to begin with. The monkey patch is more of a band-aid.",
    "created_at": "2018-05-14T09:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462622",
    "user": "https://github.com/timokau"
}
```

<a id='comment:20'></a>
Replying to [jdemeyer](#comment%3A19):
> So my proposal is: change the monkey-patch to a real patch, make sure that it takes effect only for non-C code and then put that in a pull request.


Why should that have any better chances than the current one? In my view the one currently proposed upstream is "cleaner" as a hard-patch, because it doesn't add the flag to begin with. The monkey patch is more of a band-aid.



---

archive/issue_comments_462623.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [gh-timokau](#comment%3A20):\n> Why should that have any better chances than the current one? In my view the one currently proposed upstream is \"cleaner\" as a hard-patch, because it doesn't add the flag to begin with.\n\n\nOne could certainly argue that it's a feature to add that flag for C code. But given how distutils almost makes no difference between C and C++ code, I just realized that it's not really possible to add that flag just for C code.",
    "created_at": "2018-05-14T09:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462623",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Replying to [gh-timokau](#comment%3A20):
> Why should that have any better chances than the current one? In my view the one currently proposed upstream is "cleaner" as a hard-patch, because it doesn't add the flag to begin with.


One could certainly argue that it's a feature to add that flag for C code. But given how distutils almost makes no difference between C and C++ code, I just realized that it's not really possible to add that flag just for C code.



---

archive/issue_comments_462624.json:
```json
{
    "body": "<a id='comment:22'></a>\nStill, it makes sense to compile Python itself with `-Wstrict-prototypes` but not extension modules.",
    "created_at": "2018-05-14T09:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462624",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Still, it makes sense to compile Python itself with `-Wstrict-prototypes` but not extension modules.



---

archive/issue_comments_462625.json:
```json
{
    "body": "<a id='comment:23'></a>\nThat seems to be done in the linked issues:\n\nhttps://bugs.python.org/issue1222585\nhttps://bugs.python.org/issue9031\n\nHowever since they are \"adding\" support for C++ (as opposed to \"fixing\" broken C++ support), a 2.7 backport seems unlikely.",
    "created_at": "2018-05-14T10:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462625",
    "user": "https://github.com/timokau"
}
```

<a id='comment:23'></a>
That seems to be done in the linked issues:

https://bugs.python.org/issue1222585
https://bugs.python.org/issue9031

However since they are "adding" support for C++ (as opposed to "fixing" broken C++ support), a 2.7 backport seems unlikely.



---

archive/issue_events_071792.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-04T12:50:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71792"
}
```



---

archive/issue_comments_462626.json:
```json
{
    "body": "<a id='comment:24'></a>\nUpstream CPython has accepted the patch which was originally in Sage.",
    "created_at": "2018-06-04T12:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462626",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Upstream CPython has accepted the patch which was originally in Sage.



---

archive/issue_events_071793.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71793"
}
```



---

archive/issue_events_071794.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-04T12:50:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71794"
}
```



---

archive/issue_comments_462627.json:
```json
{
    "body": "<a id='comment:25'></a>\nFor reference: https://github.com/python/cpython/pull/6791\n\nThats great, thanks! Does that also include a 2.7 backport? It looks like the PR only targets master and backporting isn't mentioned.",
    "created_at": "2018-06-04T15:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462627",
    "user": "https://github.com/timokau"
}
```

<a id='comment:25'></a>
For reference: https://github.com/python/cpython/pull/6791

Thats great, thanks! Does that also include a 2.7 backport? It looks like the PR only targets master and backporting isn't mentioned.



---

archive/issue_comments_462628.json:
```json
{
    "body": "<a id='comment:26'></a>\nUpstream only applied the patch to 3.6 so the motivation for this issue is still valid.",
    "created_at": "2018-06-06T11:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462628",
    "user": "https://github.com/timokau"
}
```

<a id='comment:26'></a>
Upstream only applied the patch to 3.6 so the motivation for this issue is still valid.



---

archive/issue_events_071795.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71795"
}
```



---

archive/issue_events_071796.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-07-02T21:00:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71796"
}
```



---

archive/issue_events_071797.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-07-02T21:00:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71797"
}
```



---

archive/issue_comments_462629.json:
```json
{
    "body": "**Changing status** from closed to new.",
    "created_at": "2019-07-02T21:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462629",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from closed to new.



---

archive/issue_comments_462630.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. Because of that, Sage patches Python.\n+Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. it seems: https://github.com/python/cpython/pull/7476\n+\n+Because of that, Sage patches Python.\n \n I don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as Python) should be avoided if possible.\n \n``````\n",
    "created_at": "2019-07-02T21:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462630",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. Because of that, Sage patches Python.
+Python bug https://bugs.python.org/issue5755 won't be fixed in 2.7. it seems: https://github.com/python/cpython/pull/7476
+
+Because of that, Sage patches Python.
 
 I don't know what the policy for that is, but at least in my opinion hard patches of dependencies (especially big ones such as Python) should be avoided if possible.
 
``````




---

archive/issue_comments_462631.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2019-07-02T21:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462631",
    "user": "https://github.com/jdemeyer"
}
```

**Changing upstream** from "N/A" to "Fixed upstream, in a later stable release.".



---

archive/issue_events_071798.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71798"
}
```



---

archive/issue_events_071799.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71799"
}
```



---

archive/issue_comments_462632.json:
```json
{
    "body": "<a id='comment:30'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462632",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>
Ticket retargeted after milestone closed



---

archive/issue_events_071800.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71800"
}
```



---

archive/issue_events_071801.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71801"
}
```



---

archive/issue_comments_462633.json:
```json
{
    "body": "<a id='comment:31'></a>\nMoving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462633",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_events_071802.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71802"
}
```



---

archive/issue_events_071803.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71803"
}
```



---

archive/issue_comments_462634.json:
```json
{
    "body": "<a id='comment:33'></a>\nSetting milestone to 9.1.1 assuming this ticket is only about Python 2.\n\nIf not please revert.",
    "created_at": "2020-09-16T18:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462634",
    "user": "https://github.com/slel"
}
```

<a id='comment:33'></a>
Setting milestone to 9.1.1 assuming this ticket is only about Python 2.

If not please revert.



---

archive/issue_events_071804.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-16T18:15:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71804"
}
```



---

archive/issue_comments_462635.json:
```json
{
    "body": "<a id='comment:34'></a>\ncan this now be closed as invalid ?",
    "created_at": "2022-05-19T12:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462635",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:34'></a>
can this now be closed as invalid ?



---

archive/issue_events_071805.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-05-19T12:16:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71805"
}
```



---

archive/issue_comments_462636.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-05-19T12:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462636",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_events_071806.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-05-19T15:37:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25316#event-71806"
}
```



---

archive/issue_comments_462637.json:
```json
{
    "body": "<a id='comment:35'></a>\nIt can.",
    "created_at": "2022-05-19T15:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25316",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25316#issuecomment-462637",
    "user": "https://github.com/slel"
}
```

<a id='comment:35'></a>
It can.
