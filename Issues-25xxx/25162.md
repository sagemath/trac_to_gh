# Issue 25162: Implement orbit basis for partition algebras

archive/issues_024925.json:
```json
{
    "assignees": [],
    "body": "Aside from the natural diagram basis for the Partition Algebra, there is an \"orbit basis\" which carries representation-theoretic meaning. At present, the Partition Algebra (indeed all diagram algebras) have only the diagram  basis implemented.  This ticket will implement the orbit basis following the model of `PBWBasisOfFreeAlgebra` in `sage.algebras.free_algebra`.\n\nDepends on #24323\nDepends on #25146\n\nCC:  @darijgr @alauve @tscrim @ghseeli @srdoty @mantepse @zabrocki\n\nKeywords: **IMA coding sprint, CHAs, set partitions, diagram algebras**\n\nBranch/Commit: **[`8481a77`](https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Aaron Lauve, Mike Zabrocki, Travis Scrimshaw**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25162_\n\n",
    "closed_at": "2018-05-24T07:10:18Z",
    "created_at": "2018-04-13T14:18:09Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement orbit basis for partition algebras",
    "type": "issue",
    "updated_at": "2018-05-24T07:10:18Z",
    "url": "https://github.com/sagemath/sage/issues/25162",
    "user": "https://github.com/alauve"
}
```
Aside from the natural diagram basis for the Partition Algebra, there is an "orbit basis" which carries representation-theoretic meaning. At present, the Partition Algebra (indeed all diagram algebras) have only the diagram  basis implemented.  This ticket will implement the orbit basis following the model of `PBWBasisOfFreeAlgebra` in `sage.algebras.free_algebra`.

Depends on #24323
Depends on #25146

CC:  @darijgr @alauve @tscrim @ghseeli @srdoty @mantepse @zabrocki

Keywords: **IMA coding sprint, CHAs, set partitions, diagram algebras**

Branch/Commit: **[`8481a77`](https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86)**

Reviewer: **Travis Scrimshaw**

Author: **Aaron Lauve, Mike Zabrocki, Travis Scrimshaw**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/25162_





---

archive/issue_events_345338.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-04-13T14:18:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345338"
}
```



---

archive/issue_events_345339.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-04-13T14:18:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345339"
}
```



---

archive/issue_events_345340.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-04-13T14:18:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345340"
}
```



---

archive/issue_events_345341.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-04-13T14:18:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345341"
}
```



---

archive/issue_comments_384523.json:
```json
{
    "body": "Branch: **[public/combinat/implement_orbit_basis-25162](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/implement_orbit_basis-25162)**",
    "created_at": "2018-04-13T14:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384523",
    "user": "https://github.com/alauve"
}
```

Branch: **[public/combinat/implement_orbit_basis-25162](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/implement_orbit_basis-25162)**



---

archive/issue_comments_384524.json:
```json
{
    "body": "Commit: **[`9d1b0b4`](https://github.com/sagemath/sagetrac-mirror/commit/9d1b0b4c545940cc9e97b9782c9b874d804c809a)**",
    "created_at": "2018-04-16T12:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384524",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`9d1b0b4`](https://github.com/sagemath/sagetrac-mirror/commit/9d1b0b4c545940cc9e97b9782c9b874d804c809a)**



---

archive/issue_comments_384525.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/179ce29bce4e76ac162da96354eb43a274a481b6\"><code>179ce29</code></a></td><td><code>Fixing options for Brauer diagrams and algebra.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64901e3a120305590ee241761ec38831e3037893\"><code>64901e3</code></a></td><td><code>additions to the documentation to explain the compact notation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d651d513ecd70917a785c6cf0442ca0cf4e9f60\"><code>1d651d5</code></a></td><td><code>added element classes specfic to subclasses, methods to element classes, factor set partition methods</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcad2c4d4e294dfcc56a7ea950e4984d10e1d549\"><code>bcad2c4</code></a></td><td><code>cleanup advice from Travis, added missing doctests, restored previous partition algebra iterator</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/737d383992ac01ac315b5458ed55d8642900c962\"><code>737d383</code></a></td><td><code>doc test +1/2 iterators, move max_block_size, remove unused import statement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/783bca55ffff14aef7448cc0c655295f957b3275\"><code>783bca5</code></a></td><td><code>max takes an iterator</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0c9fbd619c0d0c63a4e5c9a8934bf004168c79c\"><code>d0c9fbd</code></a></td><td><code>move (restore) is_planar as a standalone function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15aa908aec34ebb25c34730b84dc2e27c8b271ef\"><code>15aa908</code></a></td><td><code>added diagram algebras to the list of Subsets and set partitions doc, moved is_planar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d1b0b4c545940cc9e97b9782c9b874d804c809a\"><code>9d1b0b4</code></a></td><td><code>Began implementation of orbit basis for partition algebra.</code></td></tr></table>\n",
    "created_at": "2018-04-16T12:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384525",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/179ce29bce4e76ac162da96354eb43a274a481b6"><code>179ce29</code></a></td><td><code>Fixing options for Brauer diagrams and algebra.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64901e3a120305590ee241761ec38831e3037893"><code>64901e3</code></a></td><td><code>additions to the documentation to explain the compact notation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d651d513ecd70917a785c6cf0442ca0cf4e9f60"><code>1d651d5</code></a></td><td><code>added element classes specfic to subclasses, methods to element classes, factor set partition methods</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcad2c4d4e294dfcc56a7ea950e4984d10e1d549"><code>bcad2c4</code></a></td><td><code>cleanup advice from Travis, added missing doctests, restored previous partition algebra iterator</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/737d383992ac01ac315b5458ed55d8642900c962"><code>737d383</code></a></td><td><code>doc test +1/2 iterators, move max_block_size, remove unused import statement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/783bca55ffff14aef7448cc0c655295f957b3275"><code>783bca5</code></a></td><td><code>max takes an iterator</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0c9fbd619c0d0c63a4e5c9a8934bf004168c79c"><code>d0c9fbd</code></a></td><td><code>move (restore) is_planar as a standalone function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15aa908aec34ebb25c34730b84dc2e27c8b271ef"><code>15aa908</code></a></td><td><code>added diagram algebras to the list of Subsets and set partitions doc, moved is_planar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d1b0b4c545940cc9e97b9782c9b874d804c809a"><code>9d1b0b4</code></a></td><td><code>Began implementation of orbit basis for partition algebra.</code></td></tr></table>




---

archive/issue_comments_384526.json:
```json
{
    "body": "Changed commit from **[`9d1b0b4`](https://github.com/sagemath/sagetrac-mirror/commit/9d1b0b4c545940cc9e97b9782c9b874d804c809a)** to **[`8b9dd14`](https://github.com/sagemath/sagetrac-mirror/commit/8b9dd14e93655c37a35a261fff6f5a207a76b7c4)**",
    "created_at": "2018-04-19T03:12:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384526",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9d1b0b4`](https://github.com/sagemath/sagetrac-mirror/commit/9d1b0b4c545940cc9e97b9782c9b874d804c809a)** to **[`8b9dd14`](https://github.com/sagemath/sagetrac-mirror/commit/8b9dd14e93655c37a35a261fff6f5a207a76b7c4)**



---

archive/issue_comments_384527.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b9dd14e93655c37a35a261fff6f5a207a76b7c4\"><code>8b9dd14</code></a></td><td><code>Implemented new \"orbit basis\" for partition algebras.</code></td></tr></table>\n",
    "created_at": "2018-04-19T03:12:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384527",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b9dd14e93655c37a35a261fff6f5a207a76b7c4"><code>8b9dd14</code></a></td><td><code>Implemented new "orbit basis" for partition algebras.</code></td></tr></table>




---

archive/issue_comments_384528.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI should mention that I did quite a bit more than implement the orbit basis. I also worked towards implmenting coercion between different instances of SubPartitionAlgebra classes. \n\ne.g., one would like the following code to work, and it seems like now it does:\n\n```\nsage: R.<q> = QQ[]\nsage: S2 = SymmetricGroupAlgebra(ZZ, 2)\nsage: B2 = BrauerAlgebra(2, q, R)\nsage: P = PartitionAlgebra(4, q, R)\nsage: P(S2.an_element())\n3*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}\nsage: P(B2.an_element())\n3*P{{-4, 4}, {-3, 3}, {-2, -1}, {1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}\n```\n\nHowever, I don't understand why coercion from the base ring doesn't work:\n\n```\nsage: R.<q> = QQ[]\nsage: O2 = PartitionAlgebra(2, q, R).orbit_basis()\nsage: P2 = PartitionAlgebra(2, q, R)\nsage: O2(P2(13))\n13*OP{{-2, -1, 1, 2}} + 13*OP{{-2, 2}, {-1, 1}}\nsage: O2(13)  # this is wrong!!\n13*OP{{-2, 2}, {-1, 1}}\n```\n\n(Mike should also check that multiplication in the Orbit basis performs as expected.)",
    "created_at": "2018-04-19T03:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384528",
    "user": "https://github.com/alauve"
}
```

<div id="comment:5" align="right">comment:5</div>

I should mention that I did quite a bit more than implement the orbit basis. I also worked towards implmenting coercion between different instances of SubPartitionAlgebra classes. 

e.g., one would like the following code to work, and it seems like now it does:

```
sage: R.<q> = QQ[]
sage: S2 = SymmetricGroupAlgebra(ZZ, 2)
sage: B2 = BrauerAlgebra(2, q, R)
sage: P = PartitionAlgebra(4, q, R)
sage: P(S2.an_element())
3*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}
sage: P(B2.an_element())
3*P{{-4, 4}, {-3, 3}, {-2, -1}, {1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}
```

However, I don't understand why coercion from the base ring doesn't work:

```
sage: R.<q> = QQ[]
sage: O2 = PartitionAlgebra(2, q, R).orbit_basis()
sage: P2 = PartitionAlgebra(2, q, R)
sage: O2(P2(13))
13*OP{{-2, -1, 1, 2}} + 13*OP{{-2, 2}, {-1, 1}}
sage: O2(13)  # this is wrong!!
13*OP{{-2, 2}, {-1, 1}}
```

(Mike should also check that multiplication in the Orbit basis performs as expected.)



---

archive/issue_comments_384529.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nMy guess is because `DiagramAlgebra.one_basis()` is defined for the orbit basis. IIRC, the conversion (technically, what you are doing is conversion) for scalars first tries to see if `one_basis()` is defined, and if so, then constructs an element as the term `(self.one_basis(), scalar)`. This is done for speed reasons (it is faster than acting by multiplication). You probably need to add another ABC for the diagram algebra bases where `1` is not a basis element.",
    "created_at": "2018-04-19T03:39:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384529",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

My guess is because `DiagramAlgebra.one_basis()` is defined for the orbit basis. IIRC, the conversion (technically, what you are doing is conversion) for scalars first tries to see if `one_basis()` is defined, and if so, then constructs an element as the term `(self.one_basis(), scalar)`. This is done for speed reasons (it is faster than acting by multiplication). You probably need to add another ABC for the diagram algebra bases where `1` is not a basis element.



---

archive/issue_comments_384530.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e71dac1149f424222e4284d59b31c032e43f117\"><code>3e71dac</code></a></td><td><code>moved one_basis from DiagramAlgebra, one -> id in one</code></td></tr></table>\n",
    "created_at": "2018-04-19T14:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384530",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e71dac1149f424222e4284d59b31c032e43f117"><code>3e71dac</code></a></td><td><code>moved one_basis from DiagramAlgebra, one -> id in one</code></td></tr></table>




---

archive/issue_comments_384531.json:
```json
{
    "body": "Changed commit from **[`8b9dd14`](https://github.com/sagemath/sagetrac-mirror/commit/8b9dd14e93655c37a35a261fff6f5a207a76b7c4)** to **[`3e71dac`](https://github.com/sagemath/sagetrac-mirror/commit/3e71dac1149f424222e4284d59b31c032e43f117)**",
    "created_at": "2018-04-19T14:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384531",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8b9dd14`](https://github.com/sagemath/sagetrac-mirror/commit/8b9dd14e93655c37a35a261fff6f5a207a76b7c4)** to **[`3e71dac`](https://github.com/sagemath/sagetrac-mirror/commit/3e71dac1149f424222e4284d59b31c032e43f117)**



---

archive/issue_comments_384532.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe problem was that `one_basis` was defined in `DiagramAlgebra` and you didn't want that method to exist in the orbit basis.  I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.",
    "created_at": "2018-04-19T14:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384532",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:8" align="right">comment:8</div>

The problem was that `one_basis` was defined in `DiagramAlgebra` and you didn't want that method to exist in the orbit basis.  I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.



---

archive/issue_comments_384533.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nGreat, thanks! (and I agree that `unital_algebra` should not assume that the unit is a single monomial.)\n\nWill you be making other changes soon? I can tackle the doctest failures, but I think it's best to wait for zabrocki/tscrim/other to take a deeper look under the hood first.",
    "created_at": "2018-04-19T21:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384533",
    "user": "https://github.com/alauve"
}
```

<div id="comment:9" align="right">comment:9</div>

Great, thanks! (and I agree that `unital_algebra` should not assume that the unit is a single monomial.)

Will you be making other changes soon? I can tackle the doctest failures, but I think it's best to wait for zabrocki/tscrim/other to take a deeper look under the hood first.



---

archive/issue_comments_384534.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@zabrocki](#comment%3A8):\n> I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.\n\nThat is incorrect, unital algebras does **not** force you to implement `one_basis`. If you have implemented `one_basis`, then it has every right to assume `1` is a basis element. Otherwise you should just implement `one()`.",
    "created_at": "2018-04-19T21:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384534",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@zabrocki](#comment%3A8):
> I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.

That is incorrect, unital algebras does **not** force you to implement `one_basis`. If you have implemented `one_basis`, then it has every right to assume `1` is a basis element. Otherwise you should just implement `one()`.



---

archive/issue_comments_384535.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nah. that's more sensible.",
    "created_at": "2018-04-19T22:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384535",
    "user": "https://github.com/alauve"
}
```

<div id="comment:11" align="right">comment:11</div>

ah. that's more sensible.



---

archive/issue_comments_384536.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI am currently doing a bunch of refactoring on this ticket (including merging in the fix on #24323).",
    "created_at": "2018-04-19T22:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384536",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

I am currently doing a bunch of refactoring on this ticket (including merging in the fix on #24323).



---

archive/issue_comments_384537.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aefa456b3a4cdddba3f7d7b7fed445da23998e2f\"><code>aefa456</code></a></td><td><code>Merge branch 'public/combinat/implement_orbit_basis-25162' of git://trac.sagemath.org/sage into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3448e98a68273bed9aff1421b500200f8e568353\"><code>3448e98</code></a></td><td><code>Merge branch 'public/combinat/fix_brauer_algebra_options-24323' of git://trac.sagemath.org/sage into public/combinat/fix_brauer_algebra_options-24323</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f484d44d203e615252122d9ccd6b00861e1c39d\"><code>9f484d4</code></a></td><td><code>Fix failing doctest.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52cf619f3c922fdd2083c715f04cd621bad45b55\"><code>52cf619</code></a></td><td><code>Merge branch 'public/combinat/fix_brauer_algebra_options-24323' into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f64c871195df24d7b5388ec2f515279a5edeb76b\"><code>f64c871</code></a></td><td><code>Refactoring and fixing bugs and various minor issues.</code></td></tr></table>\n",
    "created_at": "2018-04-19T23:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384537",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aefa456b3a4cdddba3f7d7b7fed445da23998e2f"><code>aefa456</code></a></td><td><code>Merge branch 'public/combinat/implement_orbit_basis-25162' of git://trac.sagemath.org/sage into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3448e98a68273bed9aff1421b500200f8e568353"><code>3448e98</code></a></td><td><code>Merge branch 'public/combinat/fix_brauer_algebra_options-24323' of git://trac.sagemath.org/sage into public/combinat/fix_brauer_algebra_options-24323</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f484d44d203e615252122d9ccd6b00861e1c39d"><code>9f484d4</code></a></td><td><code>Fix failing doctest.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52cf619f3c922fdd2083c715f04cd621bad45b55"><code>52cf619</code></a></td><td><code>Merge branch 'public/combinat/fix_brauer_algebra_options-24323' into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f64c871195df24d7b5388ec2f515279a5edeb76b"><code>f64c871</code></a></td><td><code>Refactoring and fixing bugs and various minor issues.</code></td></tr></table>




---

archive/issue_comments_384538.json:
```json
{
    "body": "Changed commit from **[`3e71dac`](https://github.com/sagemath/sagetrac-mirror/commit/3e71dac1149f424222e4284d59b31c032e43f117)** to **[`f64c871`](https://github.com/sagemath/sagetrac-mirror/commit/f64c871195df24d7b5388ec2f515279a5edeb76b)**",
    "created_at": "2018-04-19T23:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384538",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3e71dac`](https://github.com/sagemath/sagetrac-mirror/commit/3e71dac1149f424222e4284d59b31c032e43f117)** to **[`f64c871`](https://github.com/sagemath/sagetrac-mirror/commit/f64c871195df24d7b5388ec2f515279a5edeb76b)**



---

archive/issue_comments_384539.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-04-19T23:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384539",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_384540.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOkay, I have finished my refactoring and made the code as clean as I can make it. All doctests now pass and there is 100% coverage. I have also reviewed the code you wrote.",
    "created_at": "2018-04-19T23:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384540",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Okay, I have finished my refactoring and made the code as clean as I can make it. All doctests now pass and there is 100% coverage. I have also reviewed the code you wrote.



---

archive/issue_comments_384541.json:
```json
{
    "body": "Changed author from **Aaron Lauve, Mike Zabrocki** to **Aaron Lauve, Mike Zabrocki, Travis Scrimshaw**",
    "created_at": "2018-04-19T23:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384541",
    "user": "https://github.com/tscrim"
}
```

Changed author from **Aaron Lauve, Mike Zabrocki** to **Aaron Lauve, Mike Zabrocki, Travis Scrimshaw**



---

archive/issue_comments_384542.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSome comments:\n\n- Never use a base `except:`; it catches far too much (including things like interrupts, or so I've been told).\n- The `module_morphism` is primarily expecting something that takes a basis element as input.\n- I have never really liked the (user-level) idiom of `parent.to_foo(x)`, so I removed it. I am good with it being there to avoid reimplementation of boilerplate code, but beyond that, I think only the method at the element level should be exposed to the user.\n- I fixed the category issue of `PropogatingIdeal` as effectively a by-product of my refactoring.\n\nThere is likely more to be done to improve this file, but this is what is sufficient for the ticket at hand.",
    "created_at": "2018-04-19T23:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384542",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Some comments:

- Never use a base `except:`; it catches far too much (including things like interrupts, or so I've been told).
- The `module_morphism` is primarily expecting something that takes a basis element as input.
- I have never really liked the (user-level) idiom of `parent.to_foo(x)`, so I removed it. I am good with it being there to avoid reimplementation of boilerplate code, but beyond that, I think only the method at the element level should be exposed to the user.
- I fixed the category issue of `PropogatingIdeal` as effectively a by-product of my refactoring.

There is likely more to be done to improve this file, but this is what is sufficient for the ticket at hand.



---

archive/issue_comments_384543.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nTravis,\nYour changes look good to me. (Your comments are duly noted.) \n\n- regarding your third comment...\nYou removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`\n\n- One mathematical quibble/query... \nThe orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.\n\n```\n        PD = PartitionDiagrams(self._alg._k)\n        one = self.base_ring().one()\n        return self._from_dict({d: one for d in PD(diag).coarsenings()},\n                               coerce=False, remove_zeros=False)\n```\nI'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. \n\n- \"Basis\" versus \"Algebra\"...\nThe new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name.",
    "created_at": "2018-04-20T03:41:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384543",
    "user": "https://github.com/alauve"
}
```

<div id="comment:16" align="right">comment:16</div>

Travis,
Your changes look good to me. (Your comments are duly noted.) 

- regarding your third comment...
You removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`

- One mathematical quibble/query... 
The orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.

```
        PD = PartitionDiagrams(self._alg._k)
        one = self.base_ring().one()
        return self._from_dict({d: one for d in PD(diag).coarsenings()},
                               coerce=False, remove_zeros=False)
```
I'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. 

- "Basis" versus "Algebra"...
The new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name.



---

archive/issue_comments_384544.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@alauve](#comment%3A16):\n> - regarding your third comment...\n>   You removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`\n\nThat was one of the first things I touched and a remnant of when I thought it could be necessary/useful. It can be removed.\n\n> - One mathematical quibble/query... \n>   The orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.\n> \n>   ```\n>         PD = PartitionDiagrams(self._alg._k)\n>         one = self.base_ring().one()\n>         return self._from_dict({d: one for d in PD(diag).coarsenings()},\n>                                coerce=False, remove_zeros=False)\n>   ```\n>   I'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. \n\nI don't really care since it is not anything (directly) exposed to the user. I think it is overly verbose to have it in the class name (the docstring differentiates IMO), but feel free to change it back.\n\n(I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces. In which case, `sage.combinat.partition_algebra.OrbitBasis` removes ambiguity, but that is a tangential.)\n\n> - \"Basis\" versus \"Algebra\"...\n>   The new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name. \n\nThese are all implemented as algebras in a particular basis. so IMO, there is no distinction between an algebra and a basis. I highly doubt this will cause any serious confusion/problems once someone reads-the-code (if they are looking at these things, they should already be doing that).",
    "created_at": "2018-04-20T04:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384544",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@alauve](#comment%3A16):
> - regarding your third comment...
>   You removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`

That was one of the first things I touched and a remnant of when I thought it could be necessary/useful. It can be removed.

> - One mathematical quibble/query... 
>   The orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.
> 
>   ```
>         PD = PartitionDiagrams(self._alg._k)
>         one = self.base_ring().one()
>         return self._from_dict({d: one for d in PD(diag).coarsenings()},
>                                coerce=False, remove_zeros=False)
>   ```
>   I'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. 

I don't really care since it is not anything (directly) exposed to the user. I think it is overly verbose to have it in the class name (the docstring differentiates IMO), but feel free to change it back.

(I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces. In which case, `sage.combinat.partition_algebra.OrbitBasis` removes ambiguity, but that is a tangential.)

> - "Basis" versus "Algebra"...
>   The new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name. 

These are all implemented as algebras in a particular basis. so IMO, there is no distinction between an algebra and a basis. I highly doubt this will cause any serious confusion/problems once someone reads-the-code (if they are looking at these things, they should already be doing that).



---

archive/issue_comments_384545.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIt seems really slow.  We might have to implement the multiplication directly on the orbit basis.\n\nThere seems to be something wrong here:\n\n```\nsage: O = PartitionAlgebra(2,x).orbit_basis()\nsage: O[[1,-1],[2],[-2]]\nOP{{-2}, {-1, 1}, {2}}\nsage: O[[1,-1,2,-2]]\nTypeError: 'sage.rings.integer.Integer' object is not iterable\n```",
    "created_at": "2018-04-20T12:32:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384545",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:18" align="right">comment:18</div>

It seems really slow.  We might have to implement the multiplication directly on the orbit basis.

There seems to be something wrong here:

```
sage: O = PartitionAlgebra(2,x).orbit_basis()
sage: O[[1,-1],[2],[-2]]
OP{{-2}, {-1, 1}, {2}}
sage: O[[1,-1,2,-2]]
TypeError: 'sage.rings.integer.Integer' object is not iterable
```



---

archive/issue_comments_384546.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHmm. I forgot about this use. This is handled in 'get item'? I may have to give up on idea of allowing user to enter a permutation as a list \n\nRegarding speed, would it be bad practice to make coarse bonds a cached function? (Product in orbit basis is not known, right?)",
    "created_at": "2018-04-20T12:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384546",
    "user": "https://github.com/alauve"
}
```

<div id="comment:19" align="right">comment:19</div>

Hmm. I forgot about this use. This is handled in 'get item'? I may have to give up on idea of allowing user to enter a permutation as a list 

Regarding speed, would it be bad practice to make coarse bonds a cached function? (Product in orbit basis is not known, right?)



---

archive/issue_comments_384547.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe product on the orbit basis is known.  I'll have to find a reference/derivation and make sure that it is faster.  We might want to cache coarsenings.  It seems like if you are doing even one change of basis for a given k it will be doing repeating the same calculations.\n\nfrom [comment:17](#comment%3A17) \n> I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces.\n\n+1 .  Something to be done at a later date, plus improve the documentation.",
    "created_at": "2018-04-20T13:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384547",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:20" align="right">comment:20</div>

The product on the orbit basis is known.  I'll have to find a reference/derivation and make sure that it is faster.  We might want to cache coarsenings.  It seems like if you are doing even one change of basis for a given k it will be doing repeating the same calculations.

from [comment:17](#comment%3A17) 
> I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces.

+1 .  Something to be done at a later date, plus improve the documentation.



---

archive/issue_comments_384548.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nBy the way, the commit from [comment:2](#comment%3A2) deleted the changes from #25146",
    "created_at": "2018-04-20T14:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384548",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:21" align="right">comment:21</div>

By the way, the commit from [comment:2](#comment%3A2) deleted the changes from #25146



---

archive/issue_comments_384549.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@zabrocki](#comment%3A18):\n> There seems to be something wrong here:\n> \n> ```\n> sage: O = PartitionAlgebra(2,x).orbit_basis()\n> sage: O[[1,-1],[2],[-2]]\n> OP{{-2}, {-1, 1}, {2}}\n> sage: O[[1,-1,2,-2]]\n> TypeError: 'sage.rings.integer.Integer' object is not iterable\n> ```\n\nThis bug is present even in development branch for `PartitionAlgebra`. Should perhaps be pushed to a separate ticket?",
    "created_at": "2018-04-20T14:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384549",
    "user": "https://github.com/alauve"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@zabrocki](#comment%3A18):
> There seems to be something wrong here:
> 
> ```
> sage: O = PartitionAlgebra(2,x).orbit_basis()
> sage: O[[1,-1],[2],[-2]]
> OP{{-2}, {-1, 1}, {2}}
> sage: O[[1,-1,2,-2]]
> TypeError: 'sage.rings.integer.Integer' object is not iterable
> ```

This bug is present even in development branch for `PartitionAlgebra`. Should perhaps be pushed to a separate ticket?



---

archive/issue_comments_384550.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI found a reference for the product on the orbit basis.  See Lemma 4.3 in https://arxiv.org/pdf/1707.01410.pdf .\nI checked for example that Example 4.5 (2) agrees: \n\n```\nsage: P = PartitionAlgebra(4,x);O = P.orbit_basis()\nsage: O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]\n(x^2-11*x+30)*OP{{-4}, {-3, -1}, {-2, 4}, {1}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 1}, {-2, 4}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 2, 3}, {-2, 4}, {1}} + (x^2-9*x+20)*OP{{-4, 1}, {-3, -1}, {-2, 4}, {2, 3}} + (x^2-7*x+12)*OP{{-4, 1}, {-3, -1, 2, 3}, {-2, 4}} + (x^2-9*x+20)*OP{{-4, 2, 3}, {-3, -1}, {-2, 4}, {1}} + (x^2-7*x+12)*OP{{-4, 2, 3}, {-3, -1, 1}, {-2, 4}}\nsage: %timeit O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]\n1 loop, best of 3: 3.82 s per loop\n```",
    "created_at": "2018-04-20T18:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384550",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:23" align="right">comment:23</div>

I found a reference for the product on the orbit basis.  See Lemma 4.3 in https://arxiv.org/pdf/1707.01410.pdf .
I checked for example that Example 4.5 (2) agrees: 

```
sage: P = PartitionAlgebra(4,x);O = P.orbit_basis()
sage: O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]
(x^2-11*x+30)*OP{{-4}, {-3, -1}, {-2, 4}, {1}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 1}, {-2, 4}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 2, 3}, {-2, 4}, {1}} + (x^2-9*x+20)*OP{{-4, 1}, {-3, -1}, {-2, 4}, {2, 3}} + (x^2-7*x+12)*OP{{-4, 1}, {-3, -1, 2, 3}, {-2, 4}} + (x^2-9*x+20)*OP{{-4, 2, 3}, {-3, -1}, {-2, 4}, {1}} + (x^2-7*x+12)*OP{{-4, 2, 3}, {-3, -1, 1}, {-2, 4}}
sage: %timeit O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]
1 loop, best of 3: 3.82 s per loop
```



---

archive/issue_comments_384551.json:
```json
{
    "body": "Changed commit from **[`f64c871`](https://github.com/sagemath/sagetrac-mirror/commit/f64c871195df24d7b5388ec2f515279a5edeb76b)** to **[`b9197b9`](https://github.com/sagemath/sagetrac-mirror/commit/b9197b9115cfcfd357b1c7be0843138ac1a35b7b)**",
    "created_at": "2018-04-20T19:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384551",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f64c871`](https://github.com/sagemath/sagetrac-mirror/commit/f64c871195df24d7b5388ec2f515279a5edeb76b)** to **[`b9197b9`](https://github.com/sagemath/sagetrac-mirror/commit/b9197b9115cfcfd357b1c7be0843138ac1a35b7b)**



---

archive/issue_comments_384552.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9197b9115cfcfd357b1c7be0843138ac1a35b7b\"><code>b9197b9</code></a></td><td><code>fix element constructor when set partition is a single part</code></td></tr></table>\n",
    "created_at": "2018-04-20T19:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384552",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9197b9115cfcfd357b1c7be0843138ac1a35b7b"><code>b9197b9</code></a></td><td><code>fix element constructor when set partition is a single part</code></td></tr></table>




---

archive/issue_comments_384553.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThat fix is quite easy so I don't think it should be a separate ticket and we should not be adding more bases and propagating this error. Let me point out a minor  problem that perhaps should be on a separate ticket:\n\n```\nsage: P = PartitionAlgebra(4,x)\nsage: P[[1,-1,2,-2]]\nP{{-2, -1, 1, 2}}\n```\nI feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.\n\n```\nP{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}\n```",
    "created_at": "2018-04-20T19:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384553",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:25" align="right">comment:25</div>

That fix is quite easy so I don't think it should be a separate ticket and we should not be adding more bases and propagating this error. Let me point out a minor  problem that perhaps should be on a separate ticket:

```
sage: P = PartitionAlgebra(4,x)
sage: P[[1,-1,2,-2]]
P{{-2, -1, 1, 2}}
```
I feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.

```
P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}
```



---

archive/issue_comments_384554.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@zabrocki](#comment%3A25):\n> Let me point out a minor  problem that perhaps should be on a separate ticket:\n> \n> ```\n> sage: P = PartitionAlgebra(4,x)\n> sage: P[[1,-1,2,-2]]\n> P{{-2, -1, 1, 2}}\n> ```\n\nHmm. This is the sort of thing I've tried to address with my work. See how it works with this alternate construction:\n\n```\nsage: P = PartitionAlgebra(4,x)\nsage: P([[1,-1,2,-2]])\nP{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n\nsage: P([[-1,-2],[1],[2]])\nP{{-4, 4}, {-3, 3}, {-2, -1}, {1}, {2}}\n```\nSo... in the `__getitem__` method, perhaps one could push to `._diag_to_Blst` to solve the problem?\n\n.\n\n> I feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.\n> \n> ```\n> P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}\n> ```\n\nI would prefer that missing nodes come in as pairs, if possible, instead of adding singleton blocks, because this is how smaller partition algebras would embed into larger ones. I have tried to allow for singleton blocks in `._diag_to_Blst` as well: i you want to add things as singletons, you can add a stray unpaired singleton. This is **not documented well:**\n\n```\nsage: P([[1,-1,2,-2]])\nP{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n\nsage: P([[1,-1,2,-2],[4]])\nP{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}\n\nsage: P([[-1,-2],[1],[2,3]])\nP{{-4}, {-3}, {-2, -1}, {1}, {2, 3}, {4}}\n```",
    "created_at": "2018-04-20T21:42:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384554",
    "user": "https://github.com/alauve"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@zabrocki](#comment%3A25):
> Let me point out a minor  problem that perhaps should be on a separate ticket:
> 
> ```
> sage: P = PartitionAlgebra(4,x)
> sage: P[[1,-1,2,-2]]
> P{{-2, -1, 1, 2}}
> ```

Hmm. This is the sort of thing I've tried to address with my work. See how it works with this alternate construction:

```
sage: P = PartitionAlgebra(4,x)
sage: P([[1,-1,2,-2]])
P{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}

sage: P([[-1,-2],[1],[2]])
P{{-4, 4}, {-3, 3}, {-2, -1}, {1}, {2}}
```
So... in the `__getitem__` method, perhaps one could push to `._diag_to_Blst` to solve the problem?

.

> I feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.
> 
> ```
> P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}
> ```

I would prefer that missing nodes come in as pairs, if possible, instead of adding singleton blocks, because this is how smaller partition algebras would embed into larger ones. I have tried to allow for singleton blocks in `._diag_to_Blst` as well: i you want to add things as singletons, you can add a stray unpaired singleton. This is **not documented well:**

```
sage: P([[1,-1,2,-2]])
P{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}

sage: P([[1,-1,2,-2],[4]])
P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}

sage: P([[-1,-2],[1],[2,3]])
P{{-4}, {-3}, {-2, -1}, {1}, {2, 3}, {4}}
```



---

archive/issue_comments_384555.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI'm not even sure how it is making those decisions based on your examples.  I would have paired the 4 and -4 in the last one.  Can you explain what it is doing?\n\nI understand the reason for wanting to pair up for the Brauer algebra, but I don't know if that is particularly natural for the partition algebra or not.  The problem arises if there are an odd number of vertices that are unpaired or if there are not the same number of positive as negative.",
    "created_at": "2018-04-20T21:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384555",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:27" align="right">comment:27</div>

I'm not even sure how it is making those decisions based on your examples.  I would have paired the 4 and -4 in the last one.  Can you explain what it is doing?

I understand the reason for wanting to pair up for the Brauer algebra, but I don't know if that is particularly natural for the partition algebra or not.  The problem arises if there are an odd number of vertices that are unpaired or if there are not the same number of positive as negative.



---

archive/issue_comments_384556.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThe pairing that it tries to do is of the form (+i,-i) for all omitted nodes. If the omitted nodes cannot be so paired, then it brings in everything nodes as singletons.\n\n(So the question about an even or odd number of omitted nodes doesn't quite enter into the story.) \nI note that this even works for putting P_n into P_{n+1/2} story, where one insists that (n+1) and -(n+1) always appear in the same block.\n\nHere is the code, roughly:\n\n```\n        nodes = flatten(map(list, d))\n        assert max(nodes) <= self._k\n        if all([-i in nodes for i in nodes]):\n            d = to_set_partition(d, self._k, through_strands=True)\n        else:\n            d = to_set_partition(d, self._k)\n        return self[self._base_diagrams(d)]\n```\n\nWhere, the optional argument 'through_strands' for the function `to_set_partition` brings omitted nodes in as pairs (i,-i). The default value is `False`.",
    "created_at": "2018-04-20T22:05:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384556",
    "user": "https://github.com/alauve"
}
```

<div id="comment:28" align="right">comment:28</div>

The pairing that it tries to do is of the form (+i,-i) for all omitted nodes. If the omitted nodes cannot be so paired, then it brings in everything nodes as singletons.

(So the question about an even or odd number of omitted nodes doesn't quite enter into the story.) 
I note that this even works for putting P_n into P_{n+1/2} story, where one insists that (n+1) and -(n+1) always appear in the same block.

Here is the code, roughly:

```
        nodes = flatten(map(list, d))
        assert max(nodes) <= self._k
        if all([-i in nodes for i in nodes]):
            d = to_set_partition(d, self._k, through_strands=True)
        else:
            d = to_set_partition(d, self._k)
        return self[self._base_diagrams(d)]
```

Where, the optional argument 'through_strands' for the function `to_set_partition` brings omitted nodes in as pairs (i,-i). The default value is `False`.



---

archive/issue_comments_384557.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI have a few minutes now. Let me implement the product in the orbit basis.",
    "created_at": "2018-04-20T22:18:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384557",
    "user": "https://github.com/alauve"
}
```

<div id="comment:29" align="right">comment:29</div>

I have a few minutes now. Let me implement the product in the orbit basis.



---

archive/issue_comments_384558.json:
```json
{
    "body": "Changed commit from **[`b9197b9`](https://github.com/sagemath/sagetrac-mirror/commit/b9197b9115cfcfd357b1c7be0843138ac1a35b7b)** to **[`0d8e723`](https://github.com/sagemath/sagetrac-mirror/commit/0d8e723156d240575aeb01fd2dfc0f7aff5ed152)**",
    "created_at": "2018-04-20T23:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384558",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b9197b9`](https://github.com/sagemath/sagetrac-mirror/commit/b9197b9115cfcfd357b1c7be0843138ac1a35b7b)** to **[`0d8e723`](https://github.com/sagemath/sagetrac-mirror/commit/0d8e723156d240575aeb01fd2dfc0f7aff5ed152)**



---

archive/issue_comments_384559.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d8e723156d240575aeb01fd2dfc0f7aff5ed152\"><code>0d8e723</code></a></td><td><code>began implementing product in orbit basis... currently as _product_on_basis. Ran into a snag, and will not get back to it before Monday. Mike or Travis should feel free to fix it before then.</code></td></tr></table>\n",
    "created_at": "2018-04-20T23:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384559",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d8e723156d240575aeb01fd2dfc0f7aff5ed152"><code>0d8e723</code></a></td><td><code>began implementing product in orbit basis... currently as _product_on_basis. Ran into a snag, and will not get back to it before Monday. Mike or Travis should feel free to fix it before then.</code></td></tr></table>




---

archive/issue_comments_384560.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nFYI - It is *much* faster to the partition algebra defined over, e.g., a polynomial ring rather than the symbolic ring.\n\nWhen looking at the multiplication-by-coercion timings with `%prun`, about 1/3 of the time was spent constructing `Set` objects, 1/3 of the time (not necessarily disjoint) was spent in coarsenings, and at most 1/3 was spent in the other helper functions of `diagram_algebras.py`. However, the direct version takes almost no time. I will push momentarily a corrected version.",
    "created_at": "2018-04-21T04:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384560",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:31" align="right">comment:31</div>

FYI - It is *much* faster to the partition algebra defined over, e.g., a polynomial ring rather than the symbolic ring.

When looking at the multiplication-by-coercion timings with `%prun`, about 1/3 of the time was spent constructing `Set` objects, 1/3 of the time (not necessarily disjoint) was spent in coarsenings, and at most 1/3 was spent in the other helper functions of `diagram_algebras.py`. However, the direct version takes almost no time. I will push momentarily a corrected version.



---

archive/issue_comments_384561.json:
```json
{
    "body": "Changed commit from **[`0d8e723`](https://github.com/sagemath/sagetrac-mirror/commit/0d8e723156d240575aeb01fd2dfc0f7aff5ed152)** to **[`6bb56c5`](https://github.com/sagemath/sagetrac-mirror/commit/6bb56c5ae655e5ae58a266d99b719ac7e7ecd475)**",
    "created_at": "2018-04-21T04:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384561",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0d8e723`](https://github.com/sagemath/sagetrac-mirror/commit/0d8e723156d240575aeb01fd2dfc0f7aff5ed152)** to **[`6bb56c5`](https://github.com/sagemath/sagetrac-mirror/commit/6bb56c5ae655e5ae58a266d99b719ac7e7ecd475)**



---

archive/issue_comments_384562.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bb56c5ae655e5ae58a266d99b719ac7e7ecd475\"><code>6bb56c5</code></a></td><td><code>Rewrote implementation of direct multiplication in orbit basis.</code></td></tr></table>\n",
    "created_at": "2018-04-21T04:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384562",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bb56c5ae655e5ae58a266d99b719ac7e7ecd475"><code>6bb56c5</code></a></td><td><code>Rewrote implementation of direct multiplication in orbit basis.</code></td></tr></table>




---

archive/issue_comments_384563.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc163202500c98a2b406b852759cf7a7f4cfadef\"><code>cc16320</code></a></td><td><code>Rewrote implementation of direct multiplication in orbit basis.</code></td></tr></table>\n",
    "created_at": "2018-04-21T04:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384563",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc163202500c98a2b406b852759cf7a7f4cfadef"><code>cc16320</code></a></td><td><code>Rewrote implementation of direct multiplication in orbit basis.</code></td></tr></table>




---

archive/issue_comments_384564.json:
```json
{
    "body": "Changed commit from **[`6bb56c5`](https://github.com/sagemath/sagetrac-mirror/commit/6bb56c5ae655e5ae58a266d99b719ac7e7ecd475)** to **[`cc16320`](https://github.com/sagemath/sagetrac-mirror/commit/cc163202500c98a2b406b852759cf7a7f4cfadef)**",
    "created_at": "2018-04-21T04:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384564",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6bb56c5`](https://github.com/sagemath/sagetrac-mirror/commit/6bb56c5ae655e5ae58a266d99b719ac7e7ecd475)** to **[`cc16320`](https://github.com/sagemath/sagetrac-mirror/commit/cc163202500c98a2b406b852759cf7a7f4cfadef)**



---

archive/issue_comments_384565.json:
```json
{
    "body": "Changed commit from **[`cc16320`](https://github.com/sagemath/sagetrac-mirror/commit/cc163202500c98a2b406b852759cf7a7f4cfadef)** to **[`52c1fbf`](https://github.com/sagemath/sagetrac-mirror/commit/52c1fbf0970e55d5e29262a9bfdb2ed7644ca211)**",
    "created_at": "2018-04-21T04:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384565",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cc16320`](https://github.com/sagemath/sagetrac-mirror/commit/cc163202500c98a2b406b852759cf7a7f4cfadef)** to **[`52c1fbf`](https://github.com/sagemath/sagetrac-mirror/commit/52c1fbf0970e55d5e29262a9bfdb2ed7644ca211)**



---

archive/issue_comments_384566.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52c1fbf0970e55d5e29262a9bfdb2ed7644ca211\"><code>52c1fbf</code></a></td><td><code>Rewrote implementation of direct multiplication in orbit basis.</code></td></tr></table>\n",
    "created_at": "2018-04-21T04:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384566",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52c1fbf0970e55d5e29262a9bfdb2ed7644ca211"><code>52c1fbf</code></a></td><td><code>Rewrote implementation of direct multiplication in orbit basis.</code></td></tr></table>




---

archive/issue_comments_384567.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThanks for catching my math mistake, Travis. I realized I miscoded the formula as I was walking to the train. \n\nThis wasn't the snag I hit, though. For some reason I couldn't even compose diagrams:\n\n```\nsage: P = PartitionAlgebra(3,x); PD = P.basis().keys()\nsage: d1 = PD.random_element(); d2 = PD.random_element()\nsage: d1.compose(d2)\n```\nthe last line throwing some `TypeError`::\n\n```\nTypeError                                 Traceback (most recent call last)\n<ipython-input-75-c92a56b0f000> in <module>()\n----> 1 d1.compose(d2)\n\n/Applications/sage/src/sage/combinat/diagram_algebras.py in compose(self, other)\n    360         \"\"\"\n    361         (composite_diagram, loops_removed) = set_partition_composition(self._base_diagram, other._base_diagram)\n--> 362         return (self.__class__(self.parent(), composite_diagram), loops_removed)\n    363 \n    364     def propagating_number(self):\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1672)()\n    331         else:\n    332             # Fast version of type.__call__(cls, *args, **kwds)\n--> 333             return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n    334 \n    335     def __get__(cls, instance, owner):\n\n/Applications/sage/src/sage/combinat/diagram_algebras.py in __init__(self, parent, d)\n    240         \"\"\"\n    241         self._base_diagram = tuple(sorted(tuple(sorted(i)) for i in d))\n--> 242         super(AbstractPartitionDiagram, self).__init__(parent, self._base_diagram)\n    243 \n    244     def check(self):\n\nTypeError: super(type, obj): obj must be an instance or subtype of type\n```\n\nIt seems to work now, so I don't know what classes I accidentally made `d1` and `d2`. I'll play around a bit more to see if I can reproduce the error.",
    "created_at": "2018-04-21T12:38:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384567",
    "user": "https://github.com/alauve"
}
```

<div id="comment:35" align="right">comment:35</div>

Thanks for catching my math mistake, Travis. I realized I miscoded the formula as I was walking to the train. 

This wasn't the snag I hit, though. For some reason I couldn't even compose diagrams:

```
sage: P = PartitionAlgebra(3,x); PD = P.basis().keys()
sage: d1 = PD.random_element(); d2 = PD.random_element()
sage: d1.compose(d2)
```
the last line throwing some `TypeError`::

```
TypeError                                 Traceback (most recent call last)
<ipython-input-75-c92a56b0f000> in <module>()
----> 1 d1.compose(d2)

/Applications/sage/src/sage/combinat/diagram_algebras.py in compose(self, other)
    360         """
    361         (composite_diagram, loops_removed) = set_partition_composition(self._base_diagram, other._base_diagram)
--> 362         return (self.__class__(self.parent(), composite_diagram), loops_removed)
    363 
    364     def propagating_number(self):

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1672)()
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)
--> 333             return (<PyTypeObject*>type).tp_call(cls, args, kwds)
    334 
    335     def __get__(cls, instance, owner):

/Applications/sage/src/sage/combinat/diagram_algebras.py in __init__(self, parent, d)
    240         """
    241         self._base_diagram = tuple(sorted(tuple(sorted(i)) for i in d))
--> 242         super(AbstractPartitionDiagram, self).__init__(parent, self._base_diagram)
    243 
    244     def check(self):

TypeError: super(type, obj): obj must be an instance or subtype of type
```

It seems to work now, so I don't know what classes I accidentally made `d1` and `d2`. I'll play around a bit more to see if I can reproduce the error.



---

archive/issue_comments_384568.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5aac2621e4a784f0bfab5200494a599dee5cfa16\"><code>5aac262</code></a></td><td><code>1. Modified getitem to use the same conversion scheme as element_constructor.</code></td></tr></table>\n",
    "created_at": "2018-04-21T13:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384568",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5aac2621e4a784f0bfab5200494a599dee5cfa16"><code>5aac262</code></a></td><td><code>1. Modified getitem to use the same conversion scheme as element_constructor.</code></td></tr></table>




---

archive/issue_comments_384569.json:
```json
{
    "body": "Changed commit from **[`52c1fbf`](https://github.com/sagemath/sagetrac-mirror/commit/52c1fbf0970e55d5e29262a9bfdb2ed7644ca211)** to **[`5aac262`](https://github.com/sagemath/sagetrac-mirror/commit/5aac2621e4a784f0bfab5200494a599dee5cfa16)**",
    "created_at": "2018-04-21T13:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384569",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`52c1fbf`](https://github.com/sagemath/sagetrac-mirror/commit/52c1fbf0970e55d5e29262a9bfdb2ed7644ca211)** to **[`5aac262`](https://github.com/sagemath/sagetrac-mirror/commit/5aac2621e4a784f0bfab5200494a599dee5cfa16)**



---

archive/issue_comments_384570.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nWhat do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4",
    "created_at": "2018-04-21T14:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384570",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:37" align="right">comment:37</div>

What do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4



---

archive/issue_comments_384571.json:
```json
{
    "body": "Changed commit from **[`5aac262`](https://github.com/sagemath/sagetrac-mirror/commit/5aac2621e4a784f0bfab5200494a599dee5cfa16)** to **[`937226f`](https://github.com/sagemath/sagetrac-mirror/commit/937226f27f62c98983b28dd79f5586cdd61bb9d3)**",
    "created_at": "2018-04-21T14:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384571",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5aac262`](https://github.com/sagemath/sagetrac-mirror/commit/5aac2621e4a784f0bfab5200494a599dee5cfa16)** to **[`937226f`](https://github.com/sagemath/sagetrac-mirror/commit/937226f27f62c98983b28dd79f5586cdd61bb9d3)**



---

archive/issue_comments_384572.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/937226f27f62c98983b28dd79f5586cdd61bb9d3\"><code>937226f</code></a></td><td><code>Cleaned up old code and comments</code></td></tr></table>\n",
    "created_at": "2018-04-21T14:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384572",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/937226f27f62c98983b28dd79f5586cdd61bb9d3"><code>937226f</code></a></td><td><code>Cleaned up old code and comments</code></td></tr></table>




---

archive/issue_comments_384573.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@zabrocki](#comment%3A37):\n> What do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4\n\nWell, since I caused the problem, I guess I should try to solve it. Will take a look now to see how easy are they to merge \"by hand\".",
    "created_at": "2018-04-21T14:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384573",
    "user": "https://github.com/alauve"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@zabrocki](#comment%3A37):
> What do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4

Well, since I caused the problem, I guess I should try to solve it. Will take a look now to see how easy are they to merge "by hand".



---

archive/issue_comments_384574.json:
```json
{
    "body": "Changed commit from **[`937226f`](https://github.com/sagemath/sagetrac-mirror/commit/937226f27f62c98983b28dd79f5586cdd61bb9d3)** to **[`0aa6023`](https://github.com/sagemath/sagetrac-mirror/commit/0aa60231cda84b9d010e2aa5a0cac430f31801ab)**",
    "created_at": "2018-04-21T22:31:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384574",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`937226f`](https://github.com/sagemath/sagetrac-mirror/commit/937226f27f62c98983b28dd79f5586cdd61bb9d3)** to **[`0aa6023`](https://github.com/sagemath/sagetrac-mirror/commit/0aa60231cda84b9d010e2aa5a0cac430f31801ab)**



---

archive/issue_comments_384575.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0aa60231cda84b9d010e2aa5a0cac430f31801ab\"><code>0aa6023</code></a></td><td><code>Merged relevant changes from 9d1b0b4 into :trac:`25162`, which were removed in commit 9d1b0b4.</code></td></tr></table>\n",
    "created_at": "2018-04-21T22:31:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384575",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0aa60231cda84b9d010e2aa5a0cac430f31801ab"><code>0aa6023</code></a></td><td><code>Merged relevant changes from 9d1b0b4 into :trac:`25162`, which were removed in commit 9d1b0b4.</code></td></tr></table>




---

archive/issue_events_345342.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-04-23T14:06:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345342"
}
```



---

archive/issue_comments_384576.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/877a1b0ccb5f7597e23b3ad69ea67ac109005da9\"><code>877a1b0</code></a></td><td><code>Merge branch 'public/cleanup_diagrams-25146' of git://trac.sagemath.org/sage into public/cleanup_diagrams-25146</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd77d096620f8f107b46e1a0f1c3263cd546cf2a\"><code>dd77d09</code></a></td><td><code>Better test for AbstractPartitionDiagrams.__init__ and some cleanup.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cef9946cda104d64779e7d5f22f78d7f1725a276\"><code>cef9946</code></a></td><td><code>Merge branch 'public/cleanup_diagrams-25146' into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28502249f0dc463220a5a8b5f4e55139ef4cae4d\"><code>2850224</code></a></td><td><code>Getting rid of duplicate code and streamlining implementation.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6776305b2d16ea13c3c35ed82ca815eacf9ac15\"><code>f677630</code></a></td><td><code>Simplifying code, trivial change of iteration order.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e84063767b081ffd4e04b2c581935679da6fd63\"><code>5e84063</code></a></td><td><code>Better `__classcall_private__` implementations.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cc4e1bebf8a950b806b3c8e176406619b359b93\"><code>9cc4e1b</code></a></td><td><code>Merge branch 'public/cleanup_diagrams-25146' into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00dea1a9b032474284e13b74d0160310cf217afe\"><code>00dea1a</code></a></td><td><code>Using frozenset instead of Set for the base set; renamed to _set for consistency with SetPartitions_set.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/053aac428153ded3b31927d8a568d5838c2c55f6\"><code>053aac4</code></a></td><td><code>A little more cleanup.</code></td></tr></table>\n",
    "created_at": "2018-04-24T00:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384576",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/877a1b0ccb5f7597e23b3ad69ea67ac109005da9"><code>877a1b0</code></a></td><td><code>Merge branch 'public/cleanup_diagrams-25146' of git://trac.sagemath.org/sage into public/cleanup_diagrams-25146</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd77d096620f8f107b46e1a0f1c3263cd546cf2a"><code>dd77d09</code></a></td><td><code>Better test for AbstractPartitionDiagrams.__init__ and some cleanup.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cef9946cda104d64779e7d5f22f78d7f1725a276"><code>cef9946</code></a></td><td><code>Merge branch 'public/cleanup_diagrams-25146' into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28502249f0dc463220a5a8b5f4e55139ef4cae4d"><code>2850224</code></a></td><td><code>Getting rid of duplicate code and streamlining implementation.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6776305b2d16ea13c3c35ed82ca815eacf9ac15"><code>f677630</code></a></td><td><code>Simplifying code, trivial change of iteration order.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e84063767b081ffd4e04b2c581935679da6fd63"><code>5e84063</code></a></td><td><code>Better `__classcall_private__` implementations.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cc4e1bebf8a950b806b3c8e176406619b359b93"><code>9cc4e1b</code></a></td><td><code>Merge branch 'public/cleanup_diagrams-25146' into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00dea1a9b032474284e13b74d0160310cf217afe"><code>00dea1a</code></a></td><td><code>Using frozenset instead of Set for the base set; renamed to _set for consistency with SetPartitions_set.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/053aac428153ded3b31927d8a568d5838c2c55f6"><code>053aac4</code></a></td><td><code>A little more cleanup.</code></td></tr></table>




---

archive/issue_comments_384577.json:
```json
{
    "body": "Changed commit from **[`0aa6023`](https://github.com/sagemath/sagetrac-mirror/commit/0aa60231cda84b9d010e2aa5a0cac430f31801ab)** to **[`053aac4`](https://github.com/sagemath/sagetrac-mirror/commit/053aac428153ded3b31927d8a568d5838c2c55f6)**",
    "created_at": "2018-04-24T00:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384577",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0aa6023`](https://github.com/sagemath/sagetrac-mirror/commit/0aa60231cda84b9d010e2aa5a0cac430f31801ab)** to **[`053aac4`](https://github.com/sagemath/sagetrac-mirror/commit/053aac428153ded3b31927d8a568d5838c2c55f6)**



---

archive/issue_comments_384578.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nHere is an updated branch with my changes from #25146, as well as fixing what should be the only docstring issue, bring to full doctest coverage, and some misc fixes.",
    "created_at": "2018-04-24T00:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384578",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

Here is an updated branch with my changes from #25146, as well as fixing what should be the only docstring issue, bring to full doctest coverage, and some misc fixes.



---

archive/issue_comments_384579.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51b1a3a98ff86b96c3fecdb9fc1ee78798ad8784\"><code>51b1a3a</code></a></td><td><code>orbit basis more appropriate than Orbit basis in doc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39560019209ba19d7621ed7d15dd1083cd33b5f4\"><code>3956001</code></a></td><td><code>add documentation for the definition of the orbit basis</code></td></tr></table>\n",
    "created_at": "2018-05-04T16:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384579",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51b1a3a98ff86b96c3fecdb9fc1ee78798ad8784"><code>51b1a3a</code></a></td><td><code>orbit basis more appropriate than Orbit basis in doc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39560019209ba19d7621ed7d15dd1083cd33b5f4"><code>3956001</code></a></td><td><code>add documentation for the definition of the orbit basis</code></td></tr></table>




---

archive/issue_comments_384580.json:
```json
{
    "body": "Changed commit from **[`053aac4`](https://github.com/sagemath/sagetrac-mirror/commit/053aac428153ded3b31927d8a568d5838c2c55f6)** to **[`3956001`](https://github.com/sagemath/sagetrac-mirror/commit/39560019209ba19d7621ed7d15dd1083cd33b5f4)**",
    "created_at": "2018-05-04T16:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384580",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`053aac4`](https://github.com/sagemath/sagetrac-mirror/commit/053aac428153ded3b31927d8a568d5838c2c55f6)** to **[`3956001`](https://github.com/sagemath/sagetrac-mirror/commit/39560019209ba19d7621ed7d15dd1083cd33b5f4)**



---

archive/issue_comments_384581.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI want to question the use of `O`+prefix for the orbit basis and propose that it be switched just to `O` or `o`.  Is the double letter really necessary here?  The expressions are already extremely long because the default display of set partitions has so many braces.  I would prefer to have the default prefix be more compact.  I computed an example the other day and I thought the `OP` prefix was heavy notation (but hey, the code worked as promised and has been very helpful!).\n\nI also found it was misleading when I was looking at the `to_orbit_basis` in the `SubPartitionAlgebra` because then it generated a basis indexed by `OB` and I thought that this poorly indicated that this was not the orbit basis of the Brauer algebra, but instead the orbit basis of the partition algebra (I actually also find this strange behavior for `ambient` and `lift` but these are not new to this ticket).\n\nEither way, I would just as soon have the display prefix for the basis be simply `O`.  Are there objections to me changing it?",
    "created_at": "2018-05-04T16:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384581",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:45" align="right">comment:45</div>

I want to question the use of `O`+prefix for the orbit basis and propose that it be switched just to `O` or `o`.  Is the double letter really necessary here?  The expressions are already extremely long because the default display of set partitions has so many braces.  I would prefer to have the default prefix be more compact.  I computed an example the other day and I thought the `OP` prefix was heavy notation (but hey, the code worked as promised and has been very helpful!).

I also found it was misleading when I was looking at the `to_orbit_basis` in the `SubPartitionAlgebra` because then it generated a basis indexed by `OB` and I thought that this poorly indicated that this was not the orbit basis of the Brauer algebra, but instead the orbit basis of the partition algebra (I actually also find this strange behavior for `ambient` and `lift` but these are not new to this ticket).

Either way, I would just as soon have the display prefix for the basis be simply `O`.  Are there objections to me changing it?



---

archive/issue_comments_384582.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n`O` is fine by me. \n\nYes, the lift functionality is strange. I don't think it should keep the same letter as prefix, after lift, as it had before. But I decided not to mess with it. We could perhaps remove this method, but I thought there could be some use for it. Shall I work on improving the surrounding documentation?",
    "created_at": "2018-05-05T12:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384582",
    "user": "https://github.com/alauve"
}
```

<div id="comment:46" align="right">comment:46</div>

`O` is fine by me. 

Yes, the lift functionality is strange. I don't think it should keep the same letter as prefix, after lift, as it had before. But I decided not to mess with it. We could perhaps remove this method, but I thought there could be some use for it. Shall I work on improving the surrounding documentation?



---

archive/issue_comments_384583.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e77512d439852257024d1130762b476c0b4c42b5\"><code>e77512d</code></a></td><td><code>change OP -> O, correct failing doctest</code></td></tr></table>\n",
    "created_at": "2018-05-05T13:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384583",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e77512d439852257024d1130762b476c0b4c42b5"><code>e77512d</code></a></td><td><code>change OP -> O, correct failing doctest</code></td></tr></table>




---

archive/issue_comments_384584.json:
```json
{
    "body": "Changed commit from **[`3956001`](https://github.com/sagemath/sagetrac-mirror/commit/39560019209ba19d7621ed7d15dd1083cd33b5f4)** to **[`e77512d`](https://github.com/sagemath/sagetrac-mirror/commit/e77512d439852257024d1130762b476c0b4c42b5)**",
    "created_at": "2018-05-05T13:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384584",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3956001`](https://github.com/sagemath/sagetrac-mirror/commit/39560019209ba19d7621ed7d15dd1083cd33b5f4)** to **[`e77512d`](https://github.com/sagemath/sagetrac-mirror/commit/e77512d439852257024d1130762b476c0b4c42b5)**



---

archive/issue_comments_384585.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\npyflakes says\n\n```\nsrc/sage/combinat/diagram_algebras.py:28: 'sage.categories.algebras.Algebras' imported but unused\nsrc/sage/combinat/diagram_algebras.py:2801: local variable 'k' is assigned to but never used\n```",
    "created_at": "2018-05-05T14:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384585",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:48" align="right">comment:48</div>

pyflakes says

```
src/sage/combinat/diagram_algebras.py:28: 'sage.categories.algebras.Algebras' imported but unused
src/sage/combinat/diagram_algebras.py:2801: local variable 'k' is assigned to but never used
```



---

archive/issue_comments_384586.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nI think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in [comment:25](#comment%3A25) .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.\n\n```\nsage: P3 = PartitionAlgebra(3,x,prefix='P3'); P4 = PartitionAlgebra(4,x,prefix='P4')\nsage: P2(P[[1,-2,2,-1]])\nP4{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n```\nbut\n\n```\nsage: P3 = PartitionAlgebra(3,x); Px = PartitionAlgebra(7/2,x,prefix='P3.5')\nsage: Px(P3[[1,-2,2,-1]])\nValueError: {{-3, 3}, {-2, -1, 1, 2}} does not represent two rows of vertices of order 7/2\nsage: Px(P4[[1,-2,2,-1]])\nP3.5{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n```\n\nso I think that there is something wrong (probably minor).",
    "created_at": "2018-05-05T14:14:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384586",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:49" align="right">comment:49</div>

I think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in [comment:25](#comment%3A25) .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.

```
sage: P3 = PartitionAlgebra(3,x,prefix='P3'); P4 = PartitionAlgebra(4,x,prefix='P4')
sage: P2(P[[1,-2,2,-1]])
P4{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}
```
but

```
sage: P3 = PartitionAlgebra(3,x); Px = PartitionAlgebra(7/2,x,prefix='P3.5')
sage: Px(P3[[1,-2,2,-1]])
ValueError: {{-3, 3}, {-2, -1, 1, 2}} does not represent two rows of vertices of order 7/2
sage: Px(P4[[1,-2,2,-1]])
P3.5{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}
```

so I think that there is something wrong (probably minor).



---

archive/issue_events_345343.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2018-05-05T14:14:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345343"
}
```



---

archive/issue_events_345344.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2018-05-05T14:14:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345344"
}
```



---

archive/issue_comments_384587.json:
```json
{
    "body": "Changed commit from **[`e77512d`](https://github.com/sagemath/sagetrac-mirror/commit/e77512d439852257024d1130762b476c0b4c42b5)** to **[`10fa992`](https://github.com/sagemath/sagetrac-mirror/commit/10fa9928d830d0165cbab1740b76c21c34a7da31)**",
    "created_at": "2018-05-05T14:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384587",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e77512d`](https://github.com/sagemath/sagetrac-mirror/commit/e77512d439852257024d1130762b476c0b4c42b5)** to **[`10fa992`](https://github.com/sagemath/sagetrac-mirror/commit/10fa9928d830d0165cbab1740b76c21c34a7da31)**



---

archive/issue_comments_384588.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10fa9928d830d0165cbab1740b76c21c34a7da31\"><code>10fa992</code></a></td><td><code>pyflakes edits</code></td></tr></table>\n",
    "created_at": "2018-05-05T14:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384588",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10fa9928d830d0165cbab1740b76c21c34a7da31"><code>10fa992</code></a></td><td><code>pyflakes edits</code></td></tr></table>




---

archive/issue_comments_384589.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@zabrocki](#comment%3A49):\n> I think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in [comment:25](#comment%3A25) .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.\n\nYes, this.",
    "created_at": "2018-05-05T14:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384589",
    "user": "https://github.com/alauve"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@zabrocki](#comment%3A49):
> I think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in [comment:25](#comment%3A25) .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.

Yes, this.



---

archive/issue_comments_384590.json:
```json
{
    "body": "Changed commit from **[`10fa992`](https://github.com/sagemath/sagetrac-mirror/commit/10fa9928d830d0165cbab1740b76c21c34a7da31)** to **[`1ccf822`](https://github.com/sagemath/sagetrac-mirror/commit/1ccf8229e876613b4f798f6ddbc73420ea60a50e)**",
    "created_at": "2018-05-05T16:25:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384590",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`10fa992`](https://github.com/sagemath/sagetrac-mirror/commit/10fa9928d830d0165cbab1740b76c21c34a7da31)** to **[`1ccf822`](https://github.com/sagemath/sagetrac-mirror/commit/1ccf8229e876613b4f798f6ddbc73420ea60a50e)**



---

archive/issue_comments_384591.json:
```json
{
    "body": "<div id=\"comment:52\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ccf8229e876613b4f798f6ddbc73420ea60a50e\"><code>1ccf822</code></a></td><td><code>change to_set_partition</code></td></tr></table>\n",
    "created_at": "2018-05-05T16:25:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384591",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:52"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ccf8229e876613b4f798f6ddbc73420ea60a50e"><code>1ccf822</code></a></td><td><code>change to_set_partition</code></td></tr></table>




---

archive/issue_comments_384592.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nSee if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:\n\n```\nsage: P = PartitionAlgebra(3,x)\nsage: P[[1]]\nP{{-3}, {-2}, {-1}, {1}, {2}, {3}}\n```\nbut I just made it pair the missing {i,-i} strands if it can.  Now:\n\n```\nsage: P = PartitionAlgebra(3,x)\nsage: P[[1]]\nP{{-3, 3}, {-2, 2}, {-1}, {1}}\n```",
    "created_at": "2018-05-05T16:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384592",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:53" align="right">comment:53</div>

See if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:

```
sage: P = PartitionAlgebra(3,x)
sage: P[[1]]
P{{-3}, {-2}, {-1}, {1}, {2}, {3}}
```
but I just made it pair the missing {i,-i} strands if it can.  Now:

```
sage: P = PartitionAlgebra(3,x)
sage: P[[1]]
P{{-3, 3}, {-2, 2}, {-1}, {1}}
```



---

archive/issue_comments_384593.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@zabrocki](#comment%3A53):\n> See if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:\n> \n> ```\n> sage: P = PartitionAlgebra(3,x)\n> sage: P[[1]]\n> P{{-3}, {-2}, {-1}, {1}, {2}, {3}}\n> ```\n> but I just made it pair the missing {i,-i} strands if it can.  Now:\n> \n> ```\n> sage: P = PartitionAlgebra(3,x)\n> sage: P[[1]]\n> P{{-3, 3}, {-2, 2}, {-1}, {1}}\n> ```\n\nMy idea was to preserve the ability to bring things in with singletons. \nTry \n\n```\nP[[1],[-1]]\n```",
    "created_at": "2018-05-05T17:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384593",
    "user": "https://github.com/alauve"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@zabrocki](#comment%3A53):
> See if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:
> 
> ```
> sage: P = PartitionAlgebra(3,x)
> sage: P[[1]]
> P{{-3}, {-2}, {-1}, {1}, {2}, {3}}
> ```
> but I just made it pair the missing {i,-i} strands if it can.  Now:
> 
> ```
> sage: P = PartitionAlgebra(3,x)
> sage: P[[1]]
> P{{-3, 3}, {-2, 2}, {-1}, {1}}
> ```

My idea was to preserve the ability to bring things in with singletons. 
Try 

```
P[[1],[-1]]
```



---

archive/issue_comments_384594.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\n> My idea was to preserve the ability to bring things in with singletons. Try\n\n\n```\nP[[1],[-1]]\n```\n\nI did \n\n```\nsage: P = PartitionAlgebra(3,x)\nsage: P[[1],[-1]]\nP{{-3, 3}, {-2, 2}, {-1}, {1}}\n```\nThis is what I expected.  Is that not what you thought?  Maybe I don't understand \"bring things in with singletons.\"",
    "created_at": "2018-05-05T18:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384594",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:55" align="right">comment:55</div>

> My idea was to preserve the ability to bring things in with singletons. Try


```
P[[1],[-1]]
```

I did 

```
sage: P = PartitionAlgebra(3,x)
sage: P[[1],[-1]]
P{{-3, 3}, {-2, 2}, {-1}, {1}}
```
This is what I expected.  Is that not what you thought?  Maybe I don't understand "bring things in with singletons."



---

archive/issue_comments_384595.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nIt is different from \n\n```\nP[[1]]\n```\nwhich is the one that brings things in as singletons. The idea was if your excluded nodes don't pair up, then bring the rest in as singletons. If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.",
    "created_at": "2018-05-05T19:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384595",
    "user": "https://github.com/alauve"
}
```

<div id="comment:56" align="right">comment:56</div>

It is different from 

```
P[[1]]
```
which is the one that brings things in as singletons. The idea was if your excluded nodes don't pair up, then bring the rest in as singletons. If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.



---

archive/issue_comments_384596.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nThis is what I see now (and this is what I think should be):\n\n```\nsage: P[[1]]==P[[1],[-1]]\nTrue\n```\n\n> The idea was if your excluded nodes don't pair up, then bring the rest in as singletons.  If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.\n\nThe problem to me is that is not well documented and it is complex. I think it should follow a simple and consistent rule : \"pair {i,-i} if they are not listed.  Do this as much as possible and then fill in singletons.\"\n\nWhat it was doing before was raising an error when I computed `P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)` for `P=PartitionAlgebra(5/2,x)`.",
    "created_at": "2018-05-05T19:36:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384596",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:57" align="right">comment:57</div>

This is what I see now (and this is what I think should be):

```
sage: P[[1]]==P[[1],[-1]]
True
```

> The idea was if your excluded nodes don't pair up, then bring the rest in as singletons.  If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.

The problem to me is that is not well documented and it is complex. I think it should follow a simple and consistent rule : "pair {i,-i} if they are not listed.  Do this as much as possible and then fill in singletons."

What it was doing before was raising an error when I computed `P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)` for `P=PartitionAlgebra(5/2,x)`.



---

archive/issue_comments_384597.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nThat's fine with me. I was trying to preserve behavior as I found it as best as possible. But improving the documentation will not improve the situation much. It is complex.",
    "created_at": "2018-05-05T20:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384597",
    "user": "https://github.com/alauve"
}
```

<div id="comment:58" align="right">comment:58</div>

That's fine with me. I was trying to preserve behavior as I found it as best as possible. But improving the documentation will not improve the situation much. It is complex.



---

archive/issue_comments_384598.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nNote that `3/2 == 1` in Python2 (with `from `__future__` import division`/Python3, it becomes a floating point). IMO, if you really want to add `3/2`, do it using `QQ` and then take the corresponding `floor`. Although a better approach to add 1 and then take `ceil`.\n\nAlso, if you want to change the \"default\" output, you can add the global options change to your `~/.sage/sage.init` (or wherever your `.sage` directory is). Commands in this file are run on startup. Although for this to work, we would need a ticket to add a global option to `SetPartition` or to `PartitionAlgebra`.",
    "created_at": "2018-05-05T21:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384598",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:59" align="right">comment:59</div>

Note that `3/2 == 1` in Python2 (with `from `__future__` import division`/Python3, it becomes a floating point). IMO, if you really want to add `3/2`, do it using `QQ` and then take the corresponding `floor`. Although a better approach to add 1 and then take `ceil`.

Also, if you want to change the "default" output, you can add the global options change to your `~/.sage/sage.init` (or wherever your `.sage` directory is). Commands in this file are run on startup. Although for this to work, we would need a ticket to add a global option to `SetPartition` or to `PartitionAlgebra`.



---

archive/issue_comments_384599.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0e1a3cca1a04cf74b26717a147dd7d5b89f332c\"><code>f0e1a3c</code></a></td><td><code>additions to documentation, int(k+3/2)->ceil(k+1)</code></td></tr></table>\n",
    "created_at": "2018-05-05T21:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384599",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0e1a3cca1a04cf74b26717a147dd7d5b89f332c"><code>f0e1a3c</code></a></td><td><code>additions to documentation, int(k+3/2)->ceil(k+1)</code></td></tr></table>




---

archive/issue_comments_384600.json:
```json
{
    "body": "Changed commit from **[`1ccf822`](https://github.com/sagemath/sagetrac-mirror/commit/1ccf8229e876613b4f798f6ddbc73420ea60a50e)** to **[`f0e1a3c`](https://github.com/sagemath/sagetrac-mirror/commit/f0e1a3cca1a04cf74b26717a147dd7d5b89f332c)**",
    "created_at": "2018-05-05T21:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384600",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1ccf822`](https://github.com/sagemath/sagetrac-mirror/commit/1ccf8229e876613b4f798f6ddbc73420ea60a50e)** to **[`f0e1a3c`](https://github.com/sagemath/sagetrac-mirror/commit/f0e1a3cca1a04cf74b26717a147dd7d5b89f332c)**



---

archive/issue_comments_384601.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI agree that a global options is in order for `SetPartition` and `PartitionAlgebra`.  A compact notation would be a nice feature.  I think that there is a lot of work to do to implement the some results of Halverson-Ram (e.g. Jucys-Murphy elements, class type of a diagram, various flavors of generators, etc.).  Plus reorganizing some of the code because the file has become quite huge.  These are all items for followup tickets.\n\nOne of the nice features of the diagram algebra code is the latex of an expression.  [BH2017] differentiates the latex of the diagram basis from the orbit basis by filled nodes so I added this for the latex of the orbit basis (although it switches BH convention in that orbit basis has filled nodes and diagram basis has not filled nodes).\n\n> Although a better approach to add 1 and then take `ceil`.\n\nI went with this approach (in fact, I had it before).",
    "created_at": "2018-05-06T11:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384601",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:61" align="right">comment:61</div>

I agree that a global options is in order for `SetPartition` and `PartitionAlgebra`.  A compact notation would be a nice feature.  I think that there is a lot of work to do to implement the some results of Halverson-Ram (e.g. Jucys-Murphy elements, class type of a diagram, various flavors of generators, etc.).  Plus reorganizing some of the code because the file has become quite huge.  These are all items for followup tickets.

One of the nice features of the diagram algebra code is the latex of an expression.  [BH2017] differentiates the latex of the diagram basis from the orbit basis by filled nodes so I added this for the latex of the orbit basis (although it switches BH convention in that orbit basis has filled nodes and diagram basis has not filled nodes).

> Although a better approach to add 1 and then take `ceil`.

I went with this approach (in fact, I had it before).



---

archive/issue_comments_384602.json:
```json
{
    "body": "<div id=\"comment:62\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0cb892c909a8467bac4807e2ffc3bd576888cf8\"><code>a0cb892</code></a></td><td><code>differentiate the latex of the orbit and diagram bases</code></td></tr></table>\n",
    "created_at": "2018-05-06T11:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384602",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0cb892c909a8467bac4807e2ffc3bd576888cf8"><code>a0cb892</code></a></td><td><code>differentiate the latex of the orbit and diagram bases</code></td></tr></table>




---

archive/issue_comments_384603.json:
```json
{
    "body": "Changed commit from **[`f0e1a3c`](https://github.com/sagemath/sagetrac-mirror/commit/f0e1a3cca1a04cf74b26717a147dd7d5b89f332c)** to **[`a0cb892`](https://github.com/sagemath/sagetrac-mirror/commit/a0cb892c909a8467bac4807e2ffc3bd576888cf8)**",
    "created_at": "2018-05-06T11:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384603",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f0e1a3c`](https://github.com/sagemath/sagetrac-mirror/commit/f0e1a3cca1a04cf74b26717a147dd7d5b89f332c)** to **[`a0cb892`](https://github.com/sagemath/sagetrac-mirror/commit/a0cb892c909a8467bac4807e2ffc3bd576888cf8)**



---

archive/issue_comments_384604.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1257b518cf0bec367dd5814bd24a74b1f2a01ca0\"><code>1257b51</code></a></td><td><code>doctest for diagram_basis, o->O, d->D, remove TODO</code></td></tr></table>\n",
    "created_at": "2018-05-06T13:44:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384604",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1257b518cf0bec367dd5814bd24a74b1f2a01ca0"><code>1257b51</code></a></td><td><code>doctest for diagram_basis, o->O, d->D, remove TODO</code></td></tr></table>




---

archive/issue_comments_384605.json:
```json
{
    "body": "Changed commit from **[`a0cb892`](https://github.com/sagemath/sagetrac-mirror/commit/a0cb892c909a8467bac4807e2ffc3bd576888cf8)** to **[`1257b51`](https://github.com/sagemath/sagetrac-mirror/commit/1257b518cf0bec367dd5814bd24a74b1f2a01ca0)**",
    "created_at": "2018-05-06T13:44:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384605",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a0cb892`](https://github.com/sagemath/sagetrac-mirror/commit/a0cb892c909a8467bac4807e2ffc3bd576888cf8)** to **[`1257b51`](https://github.com/sagemath/sagetrac-mirror/commit/1257b518cf0bec367dd5814bd24a74b1f2a01ca0)**



---

archive/issue_comments_384606.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nI deleted the \"TODO: find a better name?\".  `elementary_symmetric` is a fine name and I would not recommend deprecating it now if there was one (and one can always add an alias if a better name comes along).\n\nI added a doctest for `diagram_algebra` because the ones that were there I think must have been copy-pasted.\n\nOtherwise I think this is ready to go.",
    "created_at": "2018-05-06T13:49:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384606",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:64" align="right">comment:64</div>

I deleted the "TODO: find a better name?".  `elementary_symmetric` is a fine name and I would not recommend deprecating it now if there was one (and one can always add an alias if a better name comes along).

I added a doctest for `diagram_algebra` because the ones that were there I think must have been copy-pasted.

Otherwise I think this is ready to go.



---

archive/issue_events_345345.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2018-05-06T13:49:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345345"
}
```



---

archive/issue_events_345346.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2018-05-06T13:49:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345346"
}
```



---

archive/issue_comments_384607.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nI agree. Thank you.",
    "created_at": "2018-05-06T23:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384607",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:65" align="right">comment:65</div>

I agree. Thank you.



---

archive/issue_events_345347.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-06T23:51:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345347"
}
```



---

archive/issue_events_345348.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-06T23:51:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345348"
}
```



---

archive/issue_events_345349.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-06T23:51:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345349"
}
```



---

archive/issue_events_345350.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-06T23:51:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345350"
}
```



---

archive/issue_events_345351.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2018-05-07T03:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345351"
}
```



---

archive/issue_events_345352.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2018-05-07T03:39:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345352"
}
```



---

archive/issue_comments_384608.json:
```json
{
    "body": "<div id=\"comment:67\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80a670e01f129950fae557f928f6731d38af55c4\"><code>80a670e</code></a></td><td><code>deleted superfluous function; updated authors</code></td></tr></table>\n",
    "created_at": "2018-05-07T03:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384608",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:67"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80a670e01f129950fae557f928f6731d38af55c4"><code>80a670e</code></a></td><td><code>deleted superfluous function; updated authors</code></td></tr></table>




---

archive/issue_comments_384609.json:
```json
{
    "body": "Changed commit from **[`1257b51`](https://github.com/sagemath/sagetrac-mirror/commit/1257b518cf0bec367dd5814bd24a74b1f2a01ca0)** to **[`80a670e`](https://github.com/sagemath/sagetrac-mirror/commit/80a670e01f129950fae557f928f6731d38af55c4)**",
    "created_at": "2018-05-07T03:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384609",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1257b51`](https://github.com/sagemath/sagetrac-mirror/commit/1257b518cf0bec367dd5814bd24a74b1f2a01ca0)** to **[`80a670e`](https://github.com/sagemath/sagetrac-mirror/commit/80a670e01f129950fae557f928f6731d38af55c4)**



---

archive/issue_comments_384610.json:
```json
{
    "body": "Changed commit from **[`80a670e`](https://github.com/sagemath/sagetrac-mirror/commit/80a670e01f129950fae557f928f6731d38af55c4)** to **[`564f36b`](https://github.com/sagemath/sagetrac-mirror/commit/564f36be796ad0f3fe480895f411513289904a5b)**",
    "created_at": "2018-05-07T03:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384610",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`80a670e`](https://github.com/sagemath/sagetrac-mirror/commit/80a670e01f129950fae557f928f6731d38af55c4)** to **[`564f36b`](https://github.com/sagemath/sagetrac-mirror/commit/564f36be796ad0f3fe480895f411513289904a5b)**



---

archive/issue_comments_384611.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/564f36be796ad0f3fe480895f411513289904a5b\"><code>564f36b</code></a></td><td><code>added another author</code></td></tr></table>\n",
    "created_at": "2018-05-07T03:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384611",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:68"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/564f36be796ad0f3fe480895f411513289904a5b"><code>564f36b</code></a></td><td><code>added another author</code></td></tr></table>




---

archive/issue_comments_384612.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nTravis,\n* The function I deleted was one I added in an earlier revision within this branch. After Mike's changes, it's no longer needed. So I deleted it. \n\n* Not quite sure if the work I did is worthy of mention. Please feel free to yank the new line in the header.\n\n* It looks like all the changes from #25146 have been mixed in here. That ticket seems stable now. There are some differences, of course, but nothing that should affect a merge. Should this be double-checked before setting to positive review?",
    "created_at": "2018-05-07T03:44:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384612",
    "user": "https://github.com/alauve"
}
```

<div id="comment:69" align="right">comment:69</div>

Travis,
* The function I deleted was one I added in an earlier revision within this branch. After Mike's changes, it's no longer needed. So I deleted it. 

* Not quite sure if the work I did is worthy of mention. Please feel free to yank the new line in the header.

* It looks like all the changes from #25146 have been mixed in here. That ticket seems stable now. There are some differences, of course, but nothing that should affect a merge. Should this be double-checked before setting to positive review?



---

archive/issue_comments_384613.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nAll of the changes from #25146 have been merged in here.",
    "created_at": "2018-05-07T04:38:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384613",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:70" align="right">comment:70</div>

All of the changes from #25146 have been merged in here.



---

archive/issue_comments_384614.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nOkay. If there's no objection, I shall move ticket status back to \"positive review\".",
    "created_at": "2018-05-07T14:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384614",
    "user": "https://github.com/alauve"
}
```

<div id="comment:71" align="right">comment:71</div>

Okay. If there's no objection, I shall move ticket status back to "positive review".



---

archive/issue_events_345353.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-05-07T14:20:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345353"
}
```



---

archive/issue_events_345354.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-05-07T14:20:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345354"
}
```



---

archive/issue_events_345355.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2018-05-10T09:57:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345355"
}
```



---

archive/issue_events_345356.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2018-05-10T09:57:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345356"
}
```



---

archive/issue_comments_384615.json:
```json
{
    "body": "<div id=\"comment:73\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e71d82a36a99fad05a17c379ca1ac6db5ce21751\"><code>e71d82a</code></a></td><td><code>Merge branch 'public/25146' of git://trac.sagemath.org/sage into public/25146</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/136244a75c6e6785e897d3ad3c2653507e2e1a71\"><code>136244a</code></a></td><td><code>Merge branch 'public/combinat/implement_orbit_basis-25162' of git://trac.sagemath.org/sage into public/combinat/implement_orbit_basis-25162</code></td></tr></table>\n",
    "created_at": "2018-05-10T09:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384615",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e71d82a36a99fad05a17c379ca1ac6db5ce21751"><code>e71d82a</code></a></td><td><code>Merge branch 'public/25146' of git://trac.sagemath.org/sage into public/25146</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/136244a75c6e6785e897d3ad3c2653507e2e1a71"><code>136244a</code></a></td><td><code>Merge branch 'public/combinat/implement_orbit_basis-25162' of git://trac.sagemath.org/sage into public/combinat/implement_orbit_basis-25162</code></td></tr></table>




---

archive/issue_comments_384616.json:
```json
{
    "body": "Changed commit from **[`564f36b`](https://github.com/sagemath/sagetrac-mirror/commit/564f36be796ad0f3fe480895f411513289904a5b)** to **[`136244a`](https://github.com/sagemath/sagetrac-mirror/commit/136244a75c6e6785e897d3ad3c2653507e2e1a71)**",
    "created_at": "2018-05-10T09:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384616",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`564f36b`](https://github.com/sagemath/sagetrac-mirror/commit/564f36be796ad0f3fe480895f411513289904a5b)** to **[`136244a`](https://github.com/sagemath/sagetrac-mirror/commit/136244a75c6e6785e897d3ad3c2653507e2e1a71)**



---

archive/issue_comments_384617.json:
```json
{
    "body": "Changed commit from **[`136244a`](https://github.com/sagemath/sagetrac-mirror/commit/136244a75c6e6785e897d3ad3c2653507e2e1a71)** to **[`cb89aa3`](https://github.com/sagemath/sagetrac-mirror/commit/cb89aa3caf4d024a44dd3bb11f8d021d8d153d97)**",
    "created_at": "2018-05-10T09:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384617",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`136244a`](https://github.com/sagemath/sagetrac-mirror/commit/136244a75c6e6785e897d3ad3c2653507e2e1a71)** to **[`cb89aa3`](https://github.com/sagemath/sagetrac-mirror/commit/cb89aa3caf4d024a44dd3bb11f8d021d8d153d97)**



---

archive/issue_comments_384618.json:
```json
{
    "body": "<div id=\"comment:74\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb89aa3caf4d024a44dd3bb11f8d021d8d153d97\"><code>cb89aa3</code></a></td><td><code>Marking one test as long (> 2s on my laptop).</code></td></tr></table>\n",
    "created_at": "2018-05-10T09:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384618",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:74"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb89aa3caf4d024a44dd3bb11f8d021d8d153d97"><code>cb89aa3</code></a></td><td><code>Marking one test as long (> 2s on my laptop).</code></td></tr></table>




---

archive/issue_events_345357.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-10T09:59:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345357"
}
```



---

archive/issue_events_345358.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-10T09:59:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345358"
}
```



---

archive/issue_comments_384619.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nTrivial rebase and marked one test as long. I'm allowing myself to set it back to a positive review.",
    "created_at": "2018-05-10T09:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384619",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:75" align="right">comment:75</div>

Trivial rebase and marked one test as long. I'm allowing myself to set it back to a positive review.



---

archive/issue_comments_384620.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nFails on 32-bit:\n\n```\nFile \"src/sage/combinat/diagram_algebras.py\", line 2228, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_\nFailed example:\n    A(S.an_element())\nExpected:\n    P{{-3, 3}, {-2, 2}, {-1, 1}} + P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}}\n     + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}\nGot:\n    P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}} + P{{-3, 3}, {-2, 2}, {-1, 1}} + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}\n**********************************************************************\nFile \"src/sage/combinat/diagram_algebras.py\", line 2234, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_\nFailed example:\n    A(B.an_element())\nExpected:\n    2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 2*P{{-3, 1}, {-2, 3}, {-1, 2}}\n     + 3*P{{-3, 1}, {-2, -1}, {2, 3}}\nGot:\n    2*P{{-3, 1}, {-2, 3}, {-1, 2}} + 2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 3*P{{-3, 1}, {-2, -1}, {2, 3}}\n**********************************************************************\nFile \"src/sage/combinat/diagram_algebras.py\", line 2371, in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_\nFailed example:\n    A._coerce_map_from_(O3)(elt)\nExpected:\n    3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}} - 3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}}\n     + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}}\nGot:\n    -3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}} + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}} + 3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}}\n**********************************************************************\nFile \"src/sage/combinat/diagram_algebras.py\", line 2776, in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis\nFailed example:\n    O[[1,-1],[2,-2],[3],[4,-3],[-4]] * O[[1,-2],[2],[3,-1],[4],[-3],[-4]]\nExpected:\n    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}}\n     + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}\n     + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}}\nGot:\n    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}} + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}} + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}\n**********************************************************************\n3 items had failures:\n   1 of  29 in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis\n   1 of  17 in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_\n   2 of  39 in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_\n    [781 tests, 4 failures, 19.54 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/combinat/diagram_algebras.py  # 4 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2018-05-18T17:48:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384620",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:76" align="right">comment:76</div>

Fails on 32-bit:

```
File "src/sage/combinat/diagram_algebras.py", line 2228, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_
Failed example:
    A(S.an_element())
Expected:
    P{{-3, 3}, {-2, 2}, {-1, 1}} + P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}}
     + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}
Got:
    P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}} + P{{-3, 3}, {-2, 2}, {-1, 1}} + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}
**********************************************************************
File "src/sage/combinat/diagram_algebras.py", line 2234, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_
Failed example:
    A(B.an_element())
Expected:
    2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 2*P{{-3, 1}, {-2, 3}, {-1, 2}}
     + 3*P{{-3, 1}, {-2, -1}, {2, 3}}
Got:
    2*P{{-3, 1}, {-2, 3}, {-1, 2}} + 2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 3*P{{-3, 1}, {-2, -1}, {2, 3}}
**********************************************************************
File "src/sage/combinat/diagram_algebras.py", line 2371, in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_
Failed example:
    A._coerce_map_from_(O3)(elt)
Expected:
    3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}} - 3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}}
     + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}}
Got:
    -3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}} + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}} + 3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}}
**********************************************************************
File "src/sage/combinat/diagram_algebras.py", line 2776, in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis
Failed example:
    O[[1,-1],[2,-2],[3],[4,-3],[-4]] * O[[1,-2],[2],[3,-1],[4],[-3],[-4]]
Expected:
    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}}
     + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}
     + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}}
Got:
    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}} + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}} + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}
**********************************************************************
3 items had failures:
   1 of  29 in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis
   1 of  17 in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_
   2 of  39 in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_
    [781 tests, 4 failures, 19.54 s]
----------------------------------------------------------------------
sage -t --long src/sage/combinat/diagram_algebras.py  # 4 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_events_345359.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:48:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345359"
}
```



---

archive/issue_events_345360.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:48:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345360"
}
```



---

archive/issue_comments_384621.json:
```json
{
    "body": "Changed commit from **[`cb89aa3`](https://github.com/sagemath/sagetrac-mirror/commit/cb89aa3caf4d024a44dd3bb11f8d021d8d153d97)** to **[`91996a1`](https://github.com/sagemath/sagetrac-mirror/commit/91996a1f507024941ec2356d45b8ec9d75263309)**",
    "created_at": "2018-05-19T08:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384621",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cb89aa3`](https://github.com/sagemath/sagetrac-mirror/commit/cb89aa3caf4d024a44dd3bb11f8d021d8d153d97)** to **[`91996a1`](https://github.com/sagemath/sagetrac-mirror/commit/91996a1f507024941ec2356d45b8ec9d75263309)**



---

archive/issue_comments_384622.json:
```json
{
    "body": "<div id=\"comment:77\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fbab6bb55517d61f3b28751410d75393cad1df51\"><code>fbab6bb</code></a></td><td><code>Merge branch 'public/combinat/implement_orbit_basis-25162' of git://trac.sagemath.org/sage into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91996a1f507024941ec2356d45b8ec9d75263309\"><code>91996a1</code></a></td><td><code>Diagrams now do checks with __lt__.</code></td></tr></table>\n",
    "created_at": "2018-05-19T08:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384622",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:77"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fbab6bb55517d61f3b28751410d75393cad1df51"><code>fbab6bb</code></a></td><td><code>Merge branch 'public/combinat/implement_orbit_basis-25162' of git://trac.sagemath.org/sage into public/combinat/implement_orbit_basis-25162</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91996a1f507024941ec2356d45b8ec9d75263309"><code>91996a1</code></a></td><td><code>Diagrams now do checks with __lt__.</code></td></tr></table>




---

archive/issue_comments_384623.json:
```json
{
    "body": "<div id=\"comment:78\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86\"><code>8481a77</code></a></td><td><code>Adding custom `__hash__` to AbstractPartitionDiagram.</code></td></tr></table>\n",
    "created_at": "2018-05-19T08:44:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384623",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:78"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86"><code>8481a77</code></a></td><td><code>Adding custom `__hash__` to AbstractPartitionDiagram.</code></td></tr></table>




---

archive/issue_comments_384624.json:
```json
{
    "body": "Changed commit from **[`91996a1`](https://github.com/sagemath/sagetrac-mirror/commit/91996a1f507024941ec2356d45b8ec9d75263309)** to **[`8481a77`](https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86)**",
    "created_at": "2018-05-19T08:44:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384624",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`91996a1`](https://github.com/sagemath/sagetrac-mirror/commit/91996a1f507024941ec2356d45b8ec9d75263309)** to **[`8481a77`](https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86)**



---

archive/issue_comments_384625.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nSo it turns out AFAIK that no `<` comparison was returning `True` for the diagrams. This was because the abstract `__lt__` check was checking the subclass `SetPartition` rather than `AbstractSetPartition`. However, I implemented a custom `__lt__` to take advantage of the `_base_diagram`. To be honest, I am surprised we were not seeing (more) machine-specific output-order doctest failures.\n\nI also implemented a custom hash to use `_base_diagram` for better speed and better compatibility with `==`.",
    "created_at": "2018-05-19T08:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384625",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:79" align="right">comment:79</div>

So it turns out AFAIK that no `<` comparison was returning `True` for the diagrams. This was because the abstract `__lt__` check was checking the subclass `SetPartition` rather than `AbstractSetPartition`. However, I implemented a custom `__lt__` to take advantage of the `_base_diagram`. To be honest, I am surprised we were not seeing (more) machine-specific output-order doctest failures.

I also implemented a custom hash to use `_base_diagram` for better speed and better compatibility with `==`.



---

archive/issue_events_345361.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-19T08:45:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345361"
}
```



---

archive/issue_events_345362.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-19T08:45:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345362"
}
```



---

archive/issue_comments_384626.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nAll tests pass on my machine, but so did the previous version.  If you are confident that it fixes the problem, I'll say positive review.",
    "created_at": "2018-05-19T18:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384626",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:81" align="right">comment:81</div>

All tests pass on my machine, but so did the previous version.  If you are confident that it fixes the problem, I'll say positive review.



---

archive/issue_comments_384627.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nYes, it is doing the comparison by the lex ordering of `AbstractSetPartition`.",
    "created_at": "2018-05-19T19:33:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384627",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:82" align="right">comment:82</div>

Yes, it is doing the comparison by the lex ordering of `AbstractSetPartition`.



---

archive/issue_events_345363.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-19T19:33:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345363"
}
```



---

archive/issue_events_345364.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-19T19:33:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345364"
}
```



---

archive/issue_events_345365.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-24T07:10:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345365"
}
```



---

archive/issue_events_345366.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3534f1e479dfb55a7046391205af7a6d2676782c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-05-24T07:10:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25162#event-345366"
}
```



---

archive/issue_comments_384628.json:
```json
{
    "body": "Changed branch from **[public/combinat/implement_orbit_basis-25162](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/implement_orbit_basis-25162)** to **[`8481a77`](https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86)**",
    "created_at": "2018-05-24T07:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25162#issuecomment-384628",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/combinat/implement_orbit_basis-25162](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/implement_orbit_basis-25162)** to **[`8481a77`](https://github.com/sagemath/sagetrac-mirror/commit/8481a771ba2ff3326db6ce3eae00249846bfac86)**
