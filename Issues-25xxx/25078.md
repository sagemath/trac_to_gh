# Issue 25078: ./sage -f sagelib no longer works

archive/issues_024841.json:
```json
{
    "body": "CC:  @embray\n\nThis used to be a convenient way to force-rebuild the whole Sage library:\n\n```\n$ ./sage -f sagelib\n...\nError: package 'sagelib' not found\nNote: if it is an old-style package, use -p instead of -i to install it\n```\n\nSimilar for `./sage -f doc`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25078\n\n",
    "closed_at": "2018-04-17T20:29:53Z",
    "created_at": "2018-04-02T09:53:36Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "./sage -f sagelib no longer works",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25078",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @embray

This used to be a convenient way to force-rebuild the whole Sage library:

```
$ ./sage -f sagelib
...
Error: package 'sagelib' not found
Note: if it is an old-style package, use -p instead of -i to install it
```

Similar for `./sage -f doc`.

Issue created by migration from https://trac.sagemath.org/ticket/25078





---

archive/issue_comments_348465.json:
```json
{
    "body": "This reminds me, it's been on my TODO list to just make \"sagelib\" another spkg (with some special disposition that allows its \"source\" to be found and built in a local directory rather than downloaded as a tarball and extracted to a temp dir).  I'm not sure why this would be broken now though.",
    "created_at": "2018-04-03T10:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348465",
    "user": "https://github.com/embray"
}
```

This reminds me, it's been on my TODO list to just make "sagelib" another spkg (with some special disposition that allows its "source" to be found and built in a local directory rather than downloaded as a tarball and extracted to a temp dir).  I'm not sure why this would be broken now though.



---

archive/issue_comments_348466.json:
```json
{
    "body": "In `src/bin/sage` there's a kind of hackish \"grep\" of `build/make/Makefile` to ensure that the argument to `./sage -f` (mostly assumed to be name of an SPKG) is actually a make target.  But it seems from the usage you describe here, really `./sage -f` should work for almost any make target, not just SPKGs. \n\nI guess either the check could be made more generic or just removed entirely.\n\nAlso is this actually documented behavior?  If not I wouldn't consider it a \"blocker\".  The `--help` just says of `-f` \"force build of the given Sage packages\".  It's not clear to me whether \"sagelib\" and \"doc\" are considered \"Sage packages\" (per my above comment maybe the should be...)",
    "created_at": "2018-04-03T10:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348466",
    "user": "https://github.com/embray"
}
```

In `src/bin/sage` there's a kind of hackish "grep" of `build/make/Makefile` to ensure that the argument to `./sage -f` (mostly assumed to be name of an SPKG) is actually a make target.  But it seems from the usage you describe here, really `./sage -f` should work for almost any make target, not just SPKGs. 

I guess either the check could be made more generic or just removed entirely.

Also is this actually documented behavior?  If not I wouldn't consider it a "blocker".  The `--help` just says of `-f` "force build of the given Sage packages".  It's not clear to me whether "sagelib" and "doc" are considered "Sage packages" (per my above comment maybe the should be...)



---

archive/issue_comments_348467.json:
```json
{
    "body": "Replying to [comment:3 embray]:\n> Also is this actually documented behavior?\n\n\nI don't think so, but it should be. I have certainly recommended running `./sage -f sagelib` to people.",
    "created_at": "2018-04-03T20:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348467",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 embray]:
> Also is this actually documented behavior?


I don't think so, but it should be. I have certainly recommended running `./sage -f sagelib` to people.



---

archive/issue_comments_348468.json:
```json
{
    "body": "Well how would you suggest handling it?  IMO the actual behavior you desire should be documented before moving forward on fixing it.  What targets should it work for?  Just \"sagelib\" and \"doc\"?  Or others as well?  Previously, it technically worked for any target in the Makefile.",
    "created_at": "2018-04-04T09:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348468",
    "user": "https://github.com/embray"
}
```

Well how would you suggest handling it?  IMO the actual behavior you desire should be documented before moving forward on fixing it.  What targets should it work for?  Just "sagelib" and "doc"?  Or others as well?  Previously, it technically worked for any target in the Makefile.



---

archive/issue_comments_348469.json:
```json
{
    "body": "Replying to [comment:5 embray]:\n> Previously, it technically worked for any target in the Makefile.\n\n\nIt is actually by design that `./sage -i` works that way. So maybe the easiest fix is removing this check:\n\n```\n        # First check that $PKG is actually a Makefile target\n        # Since https://trac.sagemath.org/ticket/21524 there is not explicitly\n        # a target for the package, but if it has a vers_<pkgname> variable\n        # there will also be a generated rule for it\n        if ! grep \"^vers_$PKG = \" build/make/Makefile >/dev/null; then\n            echo >&2 \"Error: package '$PKG' not found\"\n            echo >&2 \"Note: if it is an old-style package, use -p instead of -i to install it\"\n            exit 1\n        fi\n```",
    "created_at": "2018-04-04T13:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348469",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 embray]:
> Previously, it technically worked for any target in the Makefile.


It is actually by design that `./sage -i` works that way. So maybe the easiest fix is removing this check:

```
        # First check that $PKG is actually a Makefile target
        # Since https://trac.sagemath.org/ticket/21524 there is not explicitly
        # a target for the package, but if it has a vers_<pkgname> variable
        # there will also be a generated rule for it
        if ! grep "^vers_$PKG = " build/make/Makefile >/dev/null; then
            echo >&2 "Error: package '$PKG' not found"
            echo >&2 "Note: if it is an old-style package, use -p instead of -i to install it"
            exit 1
        fi
```



---

archive/issue_comments_348470.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-05T08:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348470",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_348471.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-05T08:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348471",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348472.json:
```json
{
    "body": "FWIW I don't think 'build' commands should be combined into Sage's runtime interface at all.  The sole exception might be `sage -i` (or an equivalent) for installing optional packages, and even that has its problems.",
    "created_at": "2018-04-05T09:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348472",
    "user": "https://github.com/embray"
}
```

FWIW I don't think 'build' commands should be combined into Sage's runtime interface at all.  The sole exception might be `sage -i` (or an equivalent) for installing optional packages, and even that has its problems.



---

archive/issue_comments_348473.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-05T09:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348473",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348474.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-04-05T09:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348474",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_348475.json:
```json
{
    "body": "Actually, upon testing this I take it back.  This is rather user-hostile because if you run `./sage -i <unknown_or_misspelled_package>` it will still just fire up make, possibly rebuild some other things (as it did for me, since I had to rebuild my toolchain packages due to previous tinkering) and only much later give an error from `make` that the target is not found (and a hard to understand error, at that, if you don't know what you're looking for).",
    "created_at": "2018-04-05T09:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348475",
    "user": "https://github.com/embray"
}
```

Actually, upon testing this I take it back.  This is rather user-hostile because if you run `./sage -i <unknown_or_misspelled_package>` it will still just fire up make, possibly rebuild some other things (as it did for me, since I had to rebuild my toolchain packages due to previous tinkering) and only much later give an error from `make` that the target is not found (and a hard to understand error, at that, if you don't know what you're looking for).



---

archive/issue_comments_348476.json:
```json
{
    "body": "What about something like this?  If you run `make list` it simply prints a list of all the packages the makefile knows about, as well as some additional \"packages\" listed in the `SAGE_I_TARGETS` variable.  Ccurrently just \"sagelib\" and \"doc\" but others could be added--though I don't think *every* makefile target is necessarily useful or valid in this context.",
    "created_at": "2018-04-05T10:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348476",
    "user": "https://github.com/embray"
}
```

What about something like this?  If you run `make list` it simply prints a list of all the packages the makefile knows about, as well as some additional "packages" listed in the `SAGE_I_TARGETS` variable.  Ccurrently just "sagelib" and "doc" but others could be added--though I don't think *every* makefile target is necessarily useful or valid in this context.



---

archive/issue_comments_348477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-05T10:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-05T10:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348479.json:
```json
{
    "body": "I agree with Erik that the misspelt package names are a nuisance, resulting in misleading logs.",
    "created_at": "2018-04-05T10:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348479",
    "user": "https://github.com/dimpase"
}
```

I agree with Erik that the misspelt package names are a nuisance, resulting in misleading logs.



---

archive/issue_comments_348480.json:
```json
{
    "body": "I don't think Dima intended to change the branch...\n\n---\nNew commits:",
    "created_at": "2018-04-05T12:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348480",
    "user": "https://github.com/embray"
}
```

I don't think Dima intended to change the branch...

---
New commits:



---

archive/issue_comments_348481.json:
```json
{
    "body": "apologies for messing up the branch.\nI forgot that this happens if the ticket was changed in the meantime, and I didn't click somthing (I am hopeless with GUIs in general :-))",
    "created_at": "2018-04-05T12:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348481",
    "user": "https://github.com/dimpase"
}
```

apologies for messing up the branch.
I forgot that this happens if the ticket was changed in the meantime, and I didn't click somthing (I am hopeless with GUIs in general :-))



---

archive/issue_comments_348482.json:
```json
{
    "body": "No problem I've done that too.",
    "created_at": "2018-04-05T14:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348482",
    "user": "https://github.com/embray"
}
```

No problem I've done that too.



---

archive/issue_comments_348483.json:
```json
{
    "body": "needs review?",
    "created_at": "2018-04-11T09:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348483",
    "user": "https://github.com/jdemeyer"
}
```

needs review?



---

archive/issue_comments_348484.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-11T13:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348484",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348485.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n> needs review?\n\n\nI guess, if you agree with my general analysis of the situation.  I posted my branch as an offer for an alternative solution, but it only \"needs review\" if you agree with my previous comments.",
    "created_at": "2018-04-11T13:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348485",
    "user": "https://github.com/embray"
}
```

Replying to [comment:18 jdemeyer]:
> needs review?


I guess, if you agree with my general analysis of the situation.  I posted my branch as an offer for an alternative solution, but it only "needs review" if you agree with my previous comments.



---

archive/issue_comments_348486.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-12T11:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348486",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348487.json:
```json
{
    "body": "What's the point of\n\n```\n@$(MAKE) -q build/make/Makefile >&2\n```\nWouldn't it make more sense to actually build `build/make/Makefile`?",
    "created_at": "2018-04-12T11:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348487",
    "user": "https://github.com/jdemeyer"
}
```

What's the point of

```
@$(MAKE) -q build/make/Makefile >&2
```
Wouldn't it make more sense to actually build `build/make/Makefile`?



---

archive/issue_comments_348488.json:
```json
{
    "body": "Apart from that, this works fine.",
    "created_at": "2018-04-12T11:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348488",
    "user": "https://github.com/jdemeyer"
}
```

Apart from that, this works fine.



---

archive/issue_comments_348489.json:
```json
{
    "body": "I think you misread that line.  That's exactly what it's doing.",
    "created_at": "2018-04-12T11:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348489",
    "user": "https://github.com/embray"
}
```

I think you misread that line.  That's exactly what it's doing.



---

archive/issue_comments_348490.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-12T11:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348490",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348491.json:
```json
{
    "body": "I think you either misread the `make` manpage or you have a different version of `make` than me.\n\n```\n       -q, --question\n            ``Question mode''.  Do not run any commands, or print anything; just return an exit status that  is  zero  if  the  specified  targets  are\n            already up to date, nonzero otherwise.\n```",
    "created_at": "2018-04-12T18:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348491",
    "user": "https://github.com/jdemeyer"
}
```

I think you either misread the `make` manpage or you have a different version of `make` than me.

```
       -q, --question
            ``Question mode''.  Do not run any commands, or print anything; just return an exit status that  is  zero  if  the  specified  targets  are
            already up to date, nonzero otherwise.
```



---

archive/issue_comments_348492.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-13T07:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348492",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348493.json:
```json
{
    "body": "Oops, sorry, you're right.  I had it confused with `-s` for `--silent` (which confusingly can also be spelled `--quiet`, but *not* `-q`).",
    "created_at": "2018-04-13T13:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348493",
    "user": "https://github.com/embray"
}
```

Oops, sorry, you're right.  I had it confused with `-s` for `--silent` (which confusingly can also be spelled `--quiet`, but *not* `-q`).



---

archive/issue_comments_348494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T13:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348495.json:
```json
{
    "body": "The overall intent was so that in the (unusual) case that `build/make/Makefile` has to be generated in order to produce the list, the only output to stdout would still be the list itself.",
    "created_at": "2018-04-13T13:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348495",
    "user": "https://github.com/embray"
}
```

The overall intent was so that in the (unusual) case that `build/make/Makefile` has to be generated in order to produce the list, the only output to stdout would still be the list itself.



---

archive/issue_comments_348496.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-13T13:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348496",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348497.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-16T08:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348497",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_062896.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-04-17T20:29:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25078#event-62896"
}
```



---

archive/issue_comments_348498.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-04-17T20:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25078#issuecomment-348498",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
