# Issue 25076: Fix Matrix_gfpn_dense * int

archive/issues_024839.json:
```json
{
    "assignees": [],
    "body": "The following previous bug was fixed by #24742:\n\n```\nsage: M = matrix(GF(9,'x'), 2,3)\nsage: type(M)\n<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\nsage: M*1\n[0 0 0]\n[0 0 0]\nsage: M*int(1)\n...\nValueError: Cannot initialise non-square matrix from 1\n```\n\nThis ticket adds a test that makes sure that the issue remains fixed.\n\nDepends on #24742\n\nCC:  @tscrim\n\nBranch: **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Simon King**\n\nComponent: **coercion**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25076_\n\n",
    "closed_at": "2018-05-09T09:49:44Z",
    "created_at": "2018-04-01T22:31:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20coercion",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix Matrix_gfpn_dense * int",
    "type": "issue",
    "updated_at": "2018-09-06T13:52:38Z",
    "url": "https://github.com/sagemath/sage/issues/25076",
    "user": "https://github.com/simon-king-jena"
}
```
The following previous bug was fixed by #24742:

```
sage: M = matrix(GF(9,'x'), 2,3)
sage: type(M)
<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
sage: M*1
[0 0 0]
[0 0 0]
sage: M*int(1)
...
ValueError: Cannot initialise non-square matrix from 1
```

This ticket adds a test that makes sure that the issue remains fixed.

Depends on #24742

CC:  @tscrim

Branch: **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)**

Reviewer: **Jeroen Demeyer**

Author: **Simon King**

Component: **coercion**

_Issue created by migration from https://trac.sagemath.org/ticket/25076_





---

archive/issue_events_346867.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-01T22:31:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346867"
}
```



---

archive/issue_events_346868.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-01T22:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346868"
}
```



---

archive/issue_events_346869.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-01T22:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346869"
}
```



---

archive/issue_events_346870.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-01T22:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346870"
}
```



---

archive/issue_comments_382165.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWhile we are at it: How is one supposed to run optional tests? It seems that \"sage -t --optional=meataxe\" will ONLY run the tests marked as optional, hence, it will skip all compulsory tests, and thus will fail in most tests as definitions given in the compulsory tests are missing when running the optional tests.",
    "created_at": "2018-04-01T22:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382165",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">comment:1</div>

While we are at it: How is one supposed to run optional tests? It seems that "sage -t --optional=meataxe" will ONLY run the tests marked as optional, hence, it will skip all compulsory tests, and thus will fail in most tests as definitions given in the compulsory tests are missing when running the optional tests.



---

archive/issue_comments_382166.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@simon-king-jena](#comment:1):\n> While we are at it: How is one supposed to run optional tests? It seems that \"sage -t --optional=meataxe\" will ONLY run the tests marked as optional, hence, it will skip all compulsory tests, and thus will fail in most tests as definitions given in the compulsory tests are missing when running the optional tests.\n\n`sage -t --optional=meataxe,sage` will do.",
    "created_at": "2018-04-02T00:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382166",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@simon-king-jena](#comment:1):
> While we are at it: How is one supposed to run optional tests? It seems that "sage -t --optional=meataxe" will ONLY run the tests marked as optional, hence, it will skip all compulsory tests, and thus will fail in most tests as definitions given in the compulsory tests are missing when running the optional tests.

`sage -t --optional=meataxe,sage` will do.



---

archive/issue_comments_382167.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWorks for me:\n\n```\nSageMath version 8.2.rc0, Release Date: 2018-03-28\nsage: M = matrix(GF(9,'x'), 2,3); type(M)\n<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\nsage: M * int(1)\n[0 0 0]\n[0 0 0]\n```",
    "created_at": "2018-04-02T06:44:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382167",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Works for me:

```
SageMath version 8.2.rc0, Release Date: 2018-03-28
sage: M = matrix(GF(9,'x'), 2,3); type(M)
<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
sage: M * int(1)
[0 0 0]
[0 0 0]
```



---

archive/issue_comments_382168.json:
```json
{
    "body": "Replying to [ticket:25076 SimonKing]:\n> \n> ```\n> Crashboom\n> ...\n> ValueError: Cannot initialise non-square matrix from 1\n> ```\n\nPlease read https://groups.google.com/forum/#!topic/sage-devel/H0t9l6XdfPI",
    "created_at": "2018-04-02T06:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382168",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:25076 SimonKing]:
> 
> ```
> Crashboom
> ...
> ValueError: Cannot initialise non-square matrix from 1
> ```

Please read https://groups.google.com/forum/#!topic/sage-devel/H0t9l6XdfPI



---

archive/issue_comments_382169.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSimon: can you specify which version of Sage you using and whether any patches are applied?",
    "created_at": "2018-04-02T06:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382169",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Simon: can you specify which version of Sage you using and whether any patches are applied?



---

archive/issue_comments_382170.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@jdemeyer](#comment:6):\n> Simon: can you specify which version of Sage you using and whether any patches are applied?\n\nSorry. It's the branch from #18514, which means Sage 8.5.beta2. Another change: I recently installed tkinter. And something seems to be broken anyway: \"git status\" gives me untracked files `bin/`, `share/` etc. Likely reason: When I manually installed something, I gave the wrong prefix (SAGE_ROOT instead of SAGE_LOCAL) during configuration.\n\nAfter removing the misplaced directories, re-installing the packages and sage -br, I get\n\n```\nsage: M = MatrixSpace(GF(9,'x'), 2,3)()\nsage: type(M)\n<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\nsage: M*int(1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-3-1a2faedb318b> in <module>()\n----> 1 M*int(Integer(1))\n\n/home/king/Sage/git/sage/src/sage/structure/element.pyx in sage.structure.element.Matrix.__mul__ (build/cythonized/sage/structure/element.c:23460)()\n   3671         if have_same_parent(left, right):\n   3672             return (<Matrix>left)._matrix_times_matrix_(<Matrix>right)\n-> 3673         return coercion_model.bin_op(left, right, mul)\n   3674 \n   3675     def __truediv__(left, right):\n\n/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9671)()\n   1111             if xp is yp:\n   1112                 return op(x,y)\n-> 1113             action = self.get_action(xp, yp, op, x, y)\n   1114             if action is not None:\n   1115                 return (<Action>action)._call_(x, y)\n\n/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16889)()\n   1654         except KeyError:\n   1655             pass\n-> 1656         action = self.discover_action(R, S, op, r, s)\n   1657         action = self.verify_action(action, R, S, op)\n   1658         self._action_maps.set(R, S, op, action)\n\n/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18411)()\n   1804 \n   1805         if isinstance(R, Parent):\n-> 1806             action = (<Parent>R).get_action(S, op, True, r, s)\n   1807             if action is not None:\n   1808                 return action\n\n/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21664)()\n   2493         action = self._get_action_(S, op, self_on_left)\n   2494         if action is None:\n-> 2495             action = self.discover_action(S, op, self_on_left, self_el, S_el)\n   2496 \n   2497         if action is not None:\n\n/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:23017)()\n   2604                     return action\n   2605 \n-> 2606                 if parent_is_integers(S) and not self.has_coerce_map_from(S):\n   2607                     from sage.structure.coerce_actions import IntegerMulAction\n   2608                     try:\n\n/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.has_coerce_map_from (build/cythonized/sage/structure/parent.c:17925)()\n   2022                 print(\"Warning: non-unique parents %s\" % (type(S)))\n   2023             return True\n-> 2024         return self._internal_coerce_map_from(S) is not None\n   2025 \n   2026     cpdef _coerce_map_from_(self, S):\n\n/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent._internal_coerce_map_from (build/cythonized/sage/structure/parent.c:18944)()\n   2164         try:\n   2165             _register_pair(self, S, \"coerce\")\n-> 2166             mor = self.discover_coerce_map_from(S)\n   2167             #if mor is not None:\n   2168             #    # Need to check that this morphism doesn't connect previously unconnected parts of the coercion diagram\n\n/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_coerce_map_from (build/cythonized/sage/structure/parent.c:19396)()\n   2301                 return (<Parent>S)._embedding\n   2302 \n-> 2303         user_provided_mor = self._coerce_map_from_(S)\n   2304 \n   2305         if user_provided_mor is None or user_provided_mor is False:\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_map_from_ (build/cythonized/sage/structure/parent_old.c:7549)()\n    339     cpdef _coerce_map_from_(self, S):\n    340         if self._element_constructor is None:\n--> 341             return self.coerce_map_from_c(S)\n    342         else:\n    343             return parent.Parent._coerce_map_from_(self, S)\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:4044)()\n    157                 self._coerce_from_hash[S] = None\n    158                 return None\n--> 159             mor = self.coerce_map_from_c(sage_type)\n    160             if mor is not None:\n    161                 mor = mor * sage_type._internal_coerce_map_from(S)\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:3768)()\n    141             pass\n    142 \n--> 143         mor = self.coerce_map_from_c_impl(S)\n    144         import sage.categories.morphism\n    145         import sage.categories.map\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:4710)()\n    189         # Piggyback off the old code for now\n    190         # WARNING: when working on this, make sure circular dependencies aren't introduced!\n--> 191         if self.has_coerce_map_from_c(S):\n    192             if isinstance(S, type):\n    193                 S = Set_PythonType(S)\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:6312)()\n    275             except KeyError:\n    276                 pass\n--> 277         x = self.has_coerce_map_from_c_impl(S)\n    278         self._has_coerce_map_from.set(S, x)\n    279         return x\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:6489)()\n    284             return False\n    285         try:\n--> 286             self._coerce_c((<parent.Parent>S).an_element())\n    287         except TypeError:\n    288             return False\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_c (build/cythonized/sage/structure/parent_old.c:5382)()\n    217             pass\n    218         if HAS_DICTIONARY(self):\n--> 219             return self._coerce_impl(x)\n    220         else:\n    221             return self._coerce_c_impl(x)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in _coerce_impl(self, x)\n   1100             and self.base_ring().has_coerce_map_from(x.base_ring())):\n   1101             return self(x)\n-> 1102         return self._coerce_try(x, self.base_ring())\n   1103 \n   1104     def _repr_(self):\n\n/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5902)()\n    255             try:\n    256                 y = R._coerce_(x)\n--> 257                 return self(y)\n    258             except (TypeError, AttributeError) as msg:\n    259                 pass\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __call__(self, entries, coerce, copy, sparse)\n    873             [t]\n    874         \"\"\"\n--> 875         return self.matrix(entries, coerce, copy)\n    876 \n    877     def change_ring(self, R):\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in matrix(self, x, coerce, copy)\n   1886                 x = list_to_dict(x, m, n)\n   1887                 copy = False\n-> 1888         return MC(self, x, copy=copy, coerce=coerce)\n   1889 \n   1890     def matrix_space(self, nrows=None, ncols=None, sparse=False):\n\n/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__init__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:5278)()\n    423                 return\n    424             if self._nrows != self._ncols:\n--> 425                 raise ValueError(\"Cannot initialise non-square matrix from {}\".format(data))\n    426             f = FfFromInt(self._converter.field_to_int(self._coerce_element(data)))\n    427             x = self.Data.Data\n\nValueError: Cannot initialise non-square matrix from 1\n```\n\nSo, perhaps I should retry with #18514 rebased on top of the latest develop branch?",
    "created_at": "2018-04-02T07:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382170",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@jdemeyer](#comment:6):
> Simon: can you specify which version of Sage you using and whether any patches are applied?

Sorry. It's the branch from #18514, which means Sage 8.5.beta2. Another change: I recently installed tkinter. And something seems to be broken anyway: "git status" gives me untracked files `bin/`, `share/` etc. Likely reason: When I manually installed something, I gave the wrong prefix (SAGE_ROOT instead of SAGE_LOCAL) during configuration.

After removing the misplaced directories, re-installing the packages and sage -br, I get

```
sage: M = MatrixSpace(GF(9,'x'), 2,3)()
sage: type(M)
<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
sage: M*int(1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-3-1a2faedb318b> in <module>()
----> 1 M*int(Integer(1))

/home/king/Sage/git/sage/src/sage/structure/element.pyx in sage.structure.element.Matrix.__mul__ (build/cythonized/sage/structure/element.c:23460)()
   3671         if have_same_parent(left, right):
   3672             return (<Matrix>left)._matrix_times_matrix_(<Matrix>right)
-> 3673         return coercion_model.bin_op(left, right, mul)
   3674 
   3675     def __truediv__(left, right):

/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9671)()
   1111             if xp is yp:
   1112                 return op(x,y)
-> 1113             action = self.get_action(xp, yp, op, x, y)
   1114             if action is not None:
   1115                 return (<Action>action)._call_(x, y)

/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16889)()
   1654         except KeyError:
   1655             pass
-> 1656         action = self.discover_action(R, S, op, r, s)
   1657         action = self.verify_action(action, R, S, op)
   1658         self._action_maps.set(R, S, op, action)

/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18411)()
   1804 
   1805         if isinstance(R, Parent):
-> 1806             action = (<Parent>R).get_action(S, op, True, r, s)
   1807             if action is not None:
   1808                 return action

/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21664)()
   2493         action = self._get_action_(S, op, self_on_left)
   2494         if action is None:
-> 2495             action = self.discover_action(S, op, self_on_left, self_el, S_el)
   2496 
   2497         if action is not None:

/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:23017)()
   2604                     return action
   2605 
-> 2606                 if parent_is_integers(S) and not self.has_coerce_map_from(S):
   2607                     from sage.structure.coerce_actions import IntegerMulAction
   2608                     try:

/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.has_coerce_map_from (build/cythonized/sage/structure/parent.c:17925)()
   2022                 print("Warning: non-unique parents %s" % (type(S)))
   2023             return True
-> 2024         return self._internal_coerce_map_from(S) is not None
   2025 
   2026     cpdef _coerce_map_from_(self, S):

/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent._internal_coerce_map_from (build/cythonized/sage/structure/parent.c:18944)()
   2164         try:
   2165             _register_pair(self, S, "coerce")
-> 2166             mor = self.discover_coerce_map_from(S)
   2167             #if mor is not None:
   2168             #    # Need to check that this morphism doesn't connect previously unconnected parts of the coercion diagram

/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_coerce_map_from (build/cythonized/sage/structure/parent.c:19396)()
   2301                 return (<Parent>S)._embedding
   2302 
-> 2303         user_provided_mor = self._coerce_map_from_(S)
   2304 
   2305         if user_provided_mor is None or user_provided_mor is False:

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_map_from_ (build/cythonized/sage/structure/parent_old.c:7549)()
    339     cpdef _coerce_map_from_(self, S):
    340         if self._element_constructor is None:
--> 341             return self.coerce_map_from_c(S)
    342         else:
    343             return parent.Parent._coerce_map_from_(self, S)

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:4044)()
    157                 self._coerce_from_hash[S] = None
    158                 return None
--> 159             mor = self.coerce_map_from_c(sage_type)
    160             if mor is not None:
    161                 mor = mor * sage_type._internal_coerce_map_from(S)

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:3768)()
    141             pass
    142 
--> 143         mor = self.coerce_map_from_c_impl(S)
    144         import sage.categories.morphism
    145         import sage.categories.map

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:4710)()
    189         # Piggyback off the old code for now
    190         # WARNING: when working on this, make sure circular dependencies aren't introduced!
--> 191         if self.has_coerce_map_from_c(S):
    192             if isinstance(S, type):
    193                 S = Set_PythonType(S)

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:6312)()
    275             except KeyError:
    276                 pass
--> 277         x = self.has_coerce_map_from_c_impl(S)
    278         self._has_coerce_map_from.set(S, x)
    279         return x

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:6489)()
    284             return False
    285         try:
--> 286             self._coerce_c((<parent.Parent>S).an_element())
    287         except TypeError:
    288             return False

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_c (build/cythonized/sage/structure/parent_old.c:5382)()
    217             pass
    218         if HAS_DICTIONARY(self):
--> 219             return self._coerce_impl(x)
    220         else:
    221             return self._coerce_c_impl(x)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in _coerce_impl(self, x)
   1100             and self.base_ring().has_coerce_map_from(x.base_ring())):
   1101             return self(x)
-> 1102         return self._coerce_try(x, self.base_ring())
   1103 
   1104     def _repr_(self):

/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5902)()
    255             try:
    256                 y = R._coerce_(x)
--> 257                 return self(y)
    258             except (TypeError, AttributeError) as msg:
    259                 pass

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __call__(self, entries, coerce, copy, sparse)
    873             [t]
    874         """
--> 875         return self.matrix(entries, coerce, copy)
    876 
    877     def change_ring(self, R):

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in matrix(self, x, coerce, copy)
   1886                 x = list_to_dict(x, m, n)
   1887                 copy = False
-> 1888         return MC(self, x, copy=copy, coerce=coerce)
   1889 
   1890     def matrix_space(self, nrows=None, ncols=None, sparse=False):

/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__init__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:5278)()
    423                 return
    424             if self._nrows != self._ncols:
--> 425                 raise ValueError("Cannot initialise non-square matrix from {}".format(data))
    426             f = FfFromInt(self._converter.field_to_int(self._coerce_element(data)))
    427             x = self.Data.Data

ValueError: Cannot initialise non-square matrix from 1
```

So, perhaps I should retry with #18514 rebased on top of the latest develop branch?



---

archive/issue_comments_382171.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nPS: The same error was observed by other people as well, on #18514. So, I have to see what went wrong there.",
    "created_at": "2018-04-02T07:22:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382171",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

PS: The same error was observed by other people as well, on #18514. So, I have to see what went wrong there.



---

archive/issue_comments_382172.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@simon-king-jena](#comment:7):\n> So, perhaps I should retry with #18514 rebased on top of the latest develop branch?\n\nYes and let me know if that fixes it.",
    "created_at": "2018-04-02T07:56:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382172",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@simon-king-jena](#comment:7):
> So, perhaps I should retry with #18514 rebased on top of the latest develop branch?

Yes and let me know if that fixes it.



---

archive/issue_comments_382173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,8 +8,158 @@\n [0 0 0]\n [0 0 0]\n sage: M*int(1)\n-Crashboom\n-...\n+---------------------------------------------------------------------------\n+ValueError                                Traceback (most recent call last)\n+<ipython-input-3-1a2faedb318b> in <module>()\n+----> 1 M*int(Integer(1))\n+\n+/home/king/Sage/git/sage/src/sage/structure/element.pyx in sage.structure.element.Matrix.__mul__ (build/cythonized/sage/structure/element.c:23460)()\n+   3671         if have_same_parent(left, right):\n+   3672             return (<Matrix>left)._matrix_times_matrix_(<Matrix>right)\n+-> 3673         return coercion_model.bin_op(left, right, mul)\n+   3674 \n+   3675     def __truediv__(left, right):\n+\n+/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9671)()\n+   1111             if xp is yp:\n+   1112                 return op(x,y)\n+-> 1113             action = self.get_action(xp, yp, op, x, y)\n+   1114             if action is not None:\n+   1115                 return (<Action>action)._call_(x, y)\n+\n+/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16889)()\n+   1654         except KeyError:\n+   1655             pass\n+-> 1656         action = self.discover_action(R, S, op, r, s)\n+   1657         action = self.verify_action(action, R, S, op)\n+   1658         self._action_maps.set(R, S, op, action)\n+\n+/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18411)()\n+   1804 \n+   1805         if isinstance(R, Parent):\n+-> 1806             action = (<Parent>R).get_action(S, op, True, r, s)\n+   1807             if action is not None:\n+   1808                 return action\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21664)()\n+   2493         action = self._get_action_(S, op, self_on_left)\n+   2494         if action is None:\n+-> 2495             action = self.discover_action(S, op, self_on_left, self_el, S_el)\n+   2496 \n+   2497         if action is not None:\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:23017)()\n+   2604                     return action\n+   2605 \n+-> 2606                 if parent_is_integers(S) and not self.has_coerce_map_from(S):\n+   2607                     from sage.structure.coerce_actions import IntegerMulAction\n+   2608                     try:\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.has_coerce_map_from (build/cythonized/sage/structure/parent.c:17925)()\n+   2022                 print(\"Warning: non-unique parents %s\" % (type(S)))\n+   2023             return True\n+-> 2024         return self._internal_coerce_map_from(S) is not None\n+   2025 \n+   2026     cpdef _coerce_map_from_(self, S):\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent._internal_coerce_map_from (build/cythonized/sage/structure/parent.c:18944)()\n+   2164         try:\n+   2165             _register_pair(self, S, \"coerce\")\n+-> 2166             mor = self.discover_coerce_map_from(S)\n+   2167             #if mor is not None:\n+   2168             #    # Need to check that this morphism doesn't connect previously unconnected parts of the coercion diagram\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_coerce_map_from (build/cythonized/sage/structure/parent.c:19396)()\n+   2301                 return (<Parent>S)._embedding\n+   2302 \n+-> 2303         user_provided_mor = self._coerce_map_from_(S)\n+   2304 \n+   2305         if user_provided_mor is None or user_provided_mor is False:\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_map_from_ (build/cythonized/sage/structure/parent_old.c:7549)()\n+    339     cpdef _coerce_map_from_(self, S):\n+    340         if self._element_constructor is None:\n+--> 341             return self.coerce_map_from_c(S)\n+    342         else:\n+    343             return parent.Parent._coerce_map_from_(self, S)\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:4044)()\n+    157                 self._coerce_from_hash[S] = None\n+    158                 return None\n+--> 159             mor = self.coerce_map_from_c(sage_type)\n+    160             if mor is not None:\n+    161                 mor = mor * sage_type._internal_coerce_map_from(S)\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:3768)()\n+    141             pass\n+    142 \n+--> 143         mor = self.coerce_map_from_c_impl(S)\n+    144         import sage.categories.morphism\n+    145         import sage.categories.map\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:4710)()\n+    189         # Piggyback off the old code for now\n+    190         # WARNING: when working on this, make sure circular dependencies aren't introduced!\n+--> 191         if self.has_coerce_map_from_c(S):\n+    192             if isinstance(S, type):\n+    193                 S = Set_PythonType(S)\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:6312)()\n+    275             except KeyError:\n+    276                 pass\n+--> 277         x = self.has_coerce_map_from_c_impl(S)\n+    278         self._has_coerce_map_from.set(S, x)\n+    279         return x\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:6489)()\n+    284             return False\n+    285         try:\n+--> 286             self._coerce_c((<parent.Parent>S).an_element())\n+    287         except TypeError:\n+    288             return False\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_c (build/cythonized/sage/structure/parent_old.c:5382)()\n+    217             pass\n+    218         if HAS_DICTIONARY(self):\n+--> 219             return self._coerce_impl(x)\n+    220         else:\n+    221             return self._coerce_c_impl(x)\n+\n+/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in _coerce_impl(self, x)\n+   1100             and self.base_ring().has_coerce_map_from(x.base_ring())):\n+   1101             return self(x)\n+-> 1102         return self._coerce_try(x, self.base_ring())\n+   1103 \n+   1104     def _repr_(self):\n+\n+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5902)()\n+    255             try:\n+    256                 y = R._coerce_(x)\n+--> 257                 return self(y)\n+    258             except (TypeError, AttributeError) as msg:\n+    259                 pass\n+\n+/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __call__(self, entries, coerce, copy, sparse)\n+    873             [t]\n+    874         \"\"\"\n+--> 875         return self.matrix(entries, coerce, copy)\n+    876 \n+    877     def change_ring(self, R):\n+\n+/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in matrix(self, x, coerce, copy)\n+   1886                 x = list_to_dict(x, m, n)\n+   1887                 copy = False\n+-> 1888         return MC(self, x, copy=copy, coerce=coerce)\n+   1889 \n+   1890     def matrix_space(self, nrows=None, ncols=None, sparse=False):\n+\n+/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__init__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:5278)()\n+    423                 return\n+    424             if self._nrows != self._ncols:\n+--> 425                 raise ValueError(\"Cannot initialise non-square matrix from {}\".format(data))\n+    426             f = FfFromInt(self._converter.field_to_int(self._coerce_element(data)))\n+    427             x = self.Data.Data\n+\n ValueError: Cannot initialise non-square matrix from 1\n ```\n \n``````\n",
    "created_at": "2018-04-02T07:57:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382173",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,8 +8,158 @@
 [0 0 0]
 [0 0 0]
 sage: M*int(1)
-Crashboom
-...
+---------------------------------------------------------------------------
+ValueError                                Traceback (most recent call last)
+<ipython-input-3-1a2faedb318b> in <module>()
+----> 1 M*int(Integer(1))
+
+/home/king/Sage/git/sage/src/sage/structure/element.pyx in sage.structure.element.Matrix.__mul__ (build/cythonized/sage/structure/element.c:23460)()
+   3671         if have_same_parent(left, right):
+   3672             return (<Matrix>left)._matrix_times_matrix_(<Matrix>right)
+-> 3673         return coercion_model.bin_op(left, right, mul)
+   3674 
+   3675     def __truediv__(left, right):
+
+/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9671)()
+   1111             if xp is yp:
+   1112                 return op(x,y)
+-> 1113             action = self.get_action(xp, yp, op, x, y)
+   1114             if action is not None:
+   1115                 return (<Action>action)._call_(x, y)
+
+/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16889)()
+   1654         except KeyError:
+   1655             pass
+-> 1656         action = self.discover_action(R, S, op, r, s)
+   1657         action = self.verify_action(action, R, S, op)
+   1658         self._action_maps.set(R, S, op, action)
+
+/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18411)()
+   1804 
+   1805         if isinstance(R, Parent):
+-> 1806             action = (<Parent>R).get_action(S, op, True, r, s)
+   1807             if action is not None:
+   1808                 return action
+
+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21664)()
+   2493         action = self._get_action_(S, op, self_on_left)
+   2494         if action is None:
+-> 2495             action = self.discover_action(S, op, self_on_left, self_el, S_el)
+   2496 
+   2497         if action is not None:
+
+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:23017)()
+   2604                     return action
+   2605 
+-> 2606                 if parent_is_integers(S) and not self.has_coerce_map_from(S):
+   2607                     from sage.structure.coerce_actions import IntegerMulAction
+   2608                     try:
+
+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.has_coerce_map_from (build/cythonized/sage/structure/parent.c:17925)()
+   2022                 print("Warning: non-unique parents %s" % (type(S)))
+   2023             return True
+-> 2024         return self._internal_coerce_map_from(S) is not None
+   2025 
+   2026     cpdef _coerce_map_from_(self, S):
+
+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent._internal_coerce_map_from (build/cythonized/sage/structure/parent.c:18944)()
+   2164         try:
+   2165             _register_pair(self, S, "coerce")
+-> 2166             mor = self.discover_coerce_map_from(S)
+   2167             #if mor is not None:
+   2168             #    # Need to check that this morphism doesn't connect previously unconnected parts of the coercion diagram
+
+/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_coerce_map_from (build/cythonized/sage/structure/parent.c:19396)()
+   2301                 return (<Parent>S)._embedding
+   2302 
+-> 2303         user_provided_mor = self._coerce_map_from_(S)
+   2304 
+   2305         if user_provided_mor is None or user_provided_mor is False:
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_map_from_ (build/cythonized/sage/structure/parent_old.c:7549)()
+    339     cpdef _coerce_map_from_(self, S):
+    340         if self._element_constructor is None:
+--> 341             return self.coerce_map_from_c(S)
+    342         else:
+    343             return parent.Parent._coerce_map_from_(self, S)
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:4044)()
+    157                 self._coerce_from_hash[S] = None
+    158                 return None
+--> 159             mor = self.coerce_map_from_c(sage_type)
+    160             if mor is not None:
+    161                 mor = mor * sage_type._internal_coerce_map_from(S)
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:3768)()
+    141             pass
+    142 
+--> 143         mor = self.coerce_map_from_c_impl(S)
+    144         import sage.categories.morphism
+    145         import sage.categories.map
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:4710)()
+    189         # Piggyback off the old code for now
+    190         # WARNING: when working on this, make sure circular dependencies aren't introduced!
+--> 191         if self.has_coerce_map_from_c(S):
+    192             if isinstance(S, type):
+    193                 S = Set_PythonType(S)
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:6312)()
+    275             except KeyError:
+    276                 pass
+--> 277         x = self.has_coerce_map_from_c_impl(S)
+    278         self._has_coerce_map_from.set(S, x)
+    279         return x
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:6489)()
+    284             return False
+    285         try:
+--> 286             self._coerce_c((<parent.Parent>S).an_element())
+    287         except TypeError:
+    288             return False
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_c (build/cythonized/sage/structure/parent_old.c:5382)()
+    217             pass
+    218         if HAS_DICTIONARY(self):
+--> 219             return self._coerce_impl(x)
+    220         else:
+    221             return self._coerce_c_impl(x)
+
+/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in _coerce_impl(self, x)
+   1100             and self.base_ring().has_coerce_map_from(x.base_ring())):
+   1101             return self(x)
+-> 1102         return self._coerce_try(x, self.base_ring())
+   1103 
+   1104     def _repr_(self):
+
+/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5902)()
+    255             try:
+    256                 y = R._coerce_(x)
+--> 257                 return self(y)
+    258             except (TypeError, AttributeError) as msg:
+    259                 pass
+
+/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __call__(self, entries, coerce, copy, sparse)
+    873             [t]
+    874         """
+--> 875         return self.matrix(entries, coerce, copy)
+    876 
+    877     def change_ring(self, R):
+
+/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in matrix(self, x, coerce, copy)
+   1886                 x = list_to_dict(x, m, n)
+   1887                 copy = False
+-> 1888         return MC(self, x, copy=copy, coerce=coerce)
+   1889 
+   1890     def matrix_space(self, nrows=None, ncols=None, sparse=False):
+
+/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__init__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:5278)()
+    423                 return
+    424             if self._nrows != self._ncols:
+--> 425                 raise ValueError("Cannot initialise non-square matrix from {}".format(data))
+    426             f = FfFromInt(self._converter.field_to_int(self._coerce_element(data)))
+    427             x = self.Data.Data
+
 ValueError: Cannot initialise non-square matrix from 1
 ```
 
``````




---

archive/issue_comments_382174.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -165,6 +165,8 @@\n \n The Python int 1 should or course not be converted into the matrix space (simply because that matrix space is not an algebra), but instead should be converted into the matrix' basering, so that `_lmul_` can be called.\n \n+Or even better: The shortcut _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.\n+\n It could be that the actual error is in the coercion system, although it seems to occur only with the MeatAxe backend:\n \n ```\n``````\n",
    "created_at": "2018-04-02T07:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382174",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -165,6 +165,8 @@
 
 The Python int 1 should or course not be converted into the matrix space (simply because that matrix space is not an algebra), but instead should be converted into the matrix' basering, so that `_lmul_` can be called.
 
+Or even better: The shortcut _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.
+
 It could be that the actual error is in the coercion system, although it seems to occur only with the MeatAxe backend:
 
 ```
``````




---

archive/issue_comments_382175.json:
```json
{
    "body": "Attachment: **[giac-1.4.9.45.p2.log](https://github.com/sagemath/sage/files/ticket25076/giac-1.4.9.45.p2.log)**\n\nFailing giac on Linux 4.4.0-116-generic #140-Ubuntu x86_64",
    "created_at": "2018-04-02T08:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382175",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[giac-1.4.9.45.p2.log](https://github.com/sagemath/sage/files/ticket25076/giac-1.4.9.45.p2.log)**

Failing giac on Linux 4.4.0-116-generic #140-Ubuntu x86_64



---

archive/issue_comments_382176.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment:9):\n> Replying to [@simon-king-jena](#comment:7):\n> > So, perhaps I should retry with #18514 rebased on top of the latest develop branch?\n\n> \n> Yes and let me know if that fixes it.\n\nGiac fails to build (see attached log). Known problem?",
    "created_at": "2018-04-02T08:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382176",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment:9):
> Replying to [@simon-king-jena](#comment:7):
> > So, perhaps I should retry with #18514 rebased on top of the latest develop branch?

> 
> Yes and let me know if that fixes it.

Giac fails to build (see attached log). Known problem?



---

archive/issue_comments_382177.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@simon-king-jena](#comment:12):\n> Giac fails to build (see attached log). Known problem?\n\nPeople have reported it but nobody knows how to reproduce it.",
    "created_at": "2018-04-02T08:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382177",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@simon-king-jena](#comment:12):
> Giac fails to build (see attached log). Known problem?

People have reported it but nobody knows how to reproduce it.



---

archive/issue_comments_382178.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Replying to [@simon-king-jena](#comment:12):\n> > Giac fails to build (see attached log). Known problem?\n\n> \n> People have reported it but nobody knows how to reproduce it.\n\nOuch. Any work-around (such as rebuilding from scratch)?\n\nCould it be related with tkinter being installed (which used to not be the case when I last built Sage)?",
    "created_at": "2018-04-02T08:51:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382178",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:13):
> Replying to [@simon-king-jena](#comment:12):
> > Giac fails to build (see attached log). Known problem?

> 
> People have reported it but nobody knows how to reproduce it.

Ouch. Any work-around (such as rebuilding from scratch)?

Could it be related with tkinter being installed (which used to not be the case when I last built Sage)?



---

archive/issue_comments_382179.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@simon-king-jena](#comment:14):\n> such as rebuilding from scratch\n\nIt's certainly something to try. Please let us know whether that fixes your giac problem.",
    "created_at": "2018-04-02T08:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382179",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@simon-king-jena](#comment:14):
> such as rebuilding from scratch

It's certainly something to try. Please let us know whether that fixes your giac problem.



---

archive/issue_comments_382180.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI don't know why, but the two messages I was trying to send to sage-release via slrn didn't come through.\n\nTrying now make distclean; make on a clean develop branch.",
    "created_at": "2018-04-02T09:41:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382180",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:16" align="right">comment:16</div>

I don't know why, but the two messages I was trying to send to sage-release via slrn didn't come through.

Trying now make distclean; make on a clean develop branch.



---

archive/issue_comments_382181.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOK, rebuilding from scratch did work. And with clean develop branch, I still get the error.\n\nSo, what is special about matrix_gfpn_dense? What is special about multiplying it with an int? And why the heck is _mul_long not called (why has it been removed from sage.matrix in the first place)?",
    "created_at": "2018-04-02T13:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382181",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

OK, rebuilding from scratch did work. And with clean develop branch, I still get the error.

So, what is special about matrix_gfpn_dense? What is special about multiplying it with an int? And why the heck is _mul_long not called (why has it been removed from sage.matrix in the first place)?



---

archive/issue_events_346871.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-02T13:27:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "title_is": "Fix Matrix_gfpn_dense * int",
    "title_was": "Un-break optional meataxe backend",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346871"
}
```



---

archive/issue_comments_382182.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The following happens when MeatAxe is used as a matrix backend:\n+The following happens on some systems (why only some?) when MeatAxe is used as a matrix backend:\n \n ```\n sage: M = matrix(GF(9,'x'), 2,3)\n``````\n",
    "created_at": "2018-04-02T13:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382182",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The following happens when MeatAxe is used as a matrix backend:
+The following happens on some systems (why only some?) when MeatAxe is used as a matrix backend:
 
 ```
 sage: M = matrix(GF(9,'x'), 2,3)
``````




---

archive/issue_events_346872.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-02T13:27:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346872"
}
```



---

archive/issue_events_346873.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-02T13:27:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20coercion",
    "label_color": "0000ff",
    "label_name": "c: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346873"
}
```



---

archive/issue_comments_382183.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nNow that's really frustrating. It is supposed to be related with coercion. Coercion is supposed to be machine independent. So, why (as Jeroen clarifies in the new ticket description) is the bug only present on some machines?\n\nBy the way, on #18514, at least one other person has seen that error. So, it is not restricted to my own laptop.",
    "created_at": "2018-04-02T13:33:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382183",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

Now that's really frustrating. It is supposed to be related with coercion. Coercion is supposed to be machine independent. So, why (as Jeroen clarifies in the new ticket description) is the bug only present on some machines?

By the way, on #18514, at least one other person has seen that error. So, it is not restricted to my own laptop.



---

archive/issue_comments_382184.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIf it makes you feel better, I managed to reproduce it on a different machine.",
    "created_at": "2018-04-02T13:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382184",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

If it makes you feel better, I managed to reproduce it on a different machine.



---

archive/issue_comments_382185.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@simon-king-jena](#comment:17):\n> OK, rebuilding from scratch did work. And with clean develop branch, I still get the error.\n> \n> So, what is special about matrix_gfpn_dense? What is special about multiplying it with an int? And why the heck is _mul_long not called (why has it been removed from sage.matrix in the first place)?\n\ndid you try other native python types, e.g. float?",
    "created_at": "2018-04-02T13:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382185",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@simon-king-jena](#comment:17):
> OK, rebuilding from scratch did work. And with clean develop branch, I still get the error.
> 
> So, what is special about matrix_gfpn_dense? What is special about multiplying it with an int? And why the heck is _mul_long not called (why has it been removed from sage.matrix in the first place)?

did you try other native python types, e.g. float?



---

archive/issue_comments_382186.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nit might be gmp vs mpir difference, by the way.",
    "created_at": "2018-04-02T13:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382186",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

it might be gmp vs mpir difference, by the way.



---

archive/issue_comments_382187.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@dimpase](#comment:21):\n> Replying to [@simon-king-jena](#comment:17):\n> > OK, rebuilding from scratch did work. And with clean develop branch, I still get the error.\n> > \n> > So, what is special about matrix_gfpn_dense? What is special about multiplying it with an int? And why the heck is _mul_long not called (why has it been removed from sage.matrix in the first place)?\n\n> \n> did you try other native python types, e.g. float?\n\nDoesn't make sense, as a float doesn't coerce into GF(3).\n\nBy inserting print statements into the bin_op method of the coercion model, I found that it isn't even called, although it should be.",
    "created_at": "2018-04-02T13:38:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382187",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@dimpase](#comment:21):
> Replying to [@simon-king-jena](#comment:17):
> > OK, rebuilding from scratch did work. And with clean develop branch, I still get the error.
> > 
> > So, what is special about matrix_gfpn_dense? What is special about multiplying it with an int? And why the heck is _mul_long not called (why has it been removed from sage.matrix in the first place)?

> 
> did you try other native python types, e.g. float?

Doesn't make sense, as a float doesn't coerce into GF(3).

By inserting print statements into the bin_op method of the coercion model, I found that it isn't even called, although it should be.



---

archive/issue_comments_382188.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@dimpase](#comment:22):\n> it might be gmp vs mpir difference, by the way.\n\nDoes it even come that far?",
    "created_at": "2018-04-02T13:38:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382188",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@dimpase](#comment:22):
> it might be gmp vs mpir difference, by the way.

Does it even come that far?



---

archive/issue_comments_382189.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOr to be precise: The bin_op method *is* called, but it doesn't come to the line \"if op is mul or op is imul:...\"",
    "created_at": "2018-04-02T13:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382189",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">comment:25</div>

Or to be precise: The bin_op method *is* called, but it doesn't come to the line "if op is mul or op is imul:..."



---

archive/issue_comments_382190.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThis seems to be fixed (accidentally) by #24742.\n\nProposal: consider this issue a duplicate, just add a doctest to prevent regressions.",
    "created_at": "2018-04-02T13:42:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382190",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

This seems to be fixed (accidentally) by #24742.

Proposal: consider this issue a duplicate, just add a doctest to prevent regressions.



---

archive/issue_comments_382191.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@dimpase](#comment:22):\n> it might be gmp vs mpir difference, by the way.\n\nI just noticed something that supports your guess. When doing \"sage -br\", I noticed these lines:\n\n```\nUpdating Cython code....\nsage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'\nsage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'\nsage/rings/integer.pyx: cannot find cimported module 'gmpy2'\nsage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'\nsage/rings/rational.pyx: cannot find cimported module 'gmpy2'\nsage/rings/real_double.pyx: cannot find cimported module 'gmpy2'\nsage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'\n```",
    "created_at": "2018-04-02T13:44:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382191",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@dimpase](#comment:22):
> it might be gmp vs mpir difference, by the way.

I just noticed something that supports your guess. When doing "sage -br", I noticed these lines:

```
Updating Cython code....
sage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'
sage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'
sage/rings/integer.pyx: cannot find cimported module 'gmpy2'
sage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'
sage/rings/rational.pyx: cannot find cimported module 'gmpy2'
sage/rings/real_double.pyx: cannot find cimported module 'gmpy2'
sage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'
```



---

archive/issue_comments_382192.json:
```json
{
    "body": "Dependencies: **#24742**",
    "created_at": "2018-04-02T13:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382192",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#24742**



---

archive/issue_comments_382193.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2018-04-02T13:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382193",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_382194.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@simon-king-jena](#comment:27):\n> \n> ```\n> sage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'\n> sage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'\n> sage/rings/integer.pyx: cannot find cimported module 'gmpy2'\n> sage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'\n> sage/rings/rational.pyx: cannot find cimported module 'gmpy2'\n> sage/rings/real_double.pyx: cannot find cimported module 'gmpy2'\n> sage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'\n> ```\n\nRed herring. Those warnings only mean that the Python package `gmpy2` was not installed.",
    "created_at": "2018-04-02T13:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382194",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@simon-king-jena](#comment:27):
> 
> ```
> sage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'
> sage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'
> sage/rings/integer.pyx: cannot find cimported module 'gmpy2'
> sage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'
> sage/rings/rational.pyx: cannot find cimported module 'gmpy2'
> sage/rings/real_double.pyx: cannot find cimported module 'gmpy2'
> sage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'
> ```

Red herring. Those warnings only mean that the Python package `gmpy2` was not installed.



---

archive/issue_comments_382195.json:
```json
{
    "body": "Branch: **[u/jdemeyer/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense___int)**",
    "created_at": "2018-04-02T13:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382195",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense___int)**



---

archive/issue_comments_382196.json:
```json
{
    "body": "Commit: **[`59ac78a`](https://github.com/sagemath/sagetrac-mirror/commit/59ac78a4cf1f5c103b2e1725c52df27d6b264eb1)**",
    "created_at": "2018-04-02T13:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382196",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`59ac78a`](https://github.com/sagemath/sagetrac-mirror/commit/59ac78a4cf1f5c103b2e1725c52df27d6b264eb1)**



---

archive/issue_comments_382197.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf9cefd138bb9fbb19c3c43a778ab230bf962902\">bf9cefd</a></td><td><code>New MatrixArgs object to deal with constructing matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59ac78a4cf1f5c103b2e1725c52df27d6b264eb1\">59ac78a</a></td><td><code>Add doctest for Trac #25076</code></td></tr></table>\n",
    "created_at": "2018-04-02T13:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382197",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf9cefd138bb9fbb19c3c43a778ab230bf962902">bf9cefd</a></td><td><code>New MatrixArgs object to deal with constructing matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59ac78a4cf1f5c103b2e1725c52df27d6b264eb1">59ac78a</a></td><td><code>Add doctest for Trac #25076</code></td></tr></table>




---

archive/issue_events_346874.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-02T13:48:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346874"
}
```



---

archive/issue_events_346875.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-02T14:02:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346875"
}
```



---

archive/issue_events_346876.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-02T14:02:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346876"
}
```



---

archive/issue_comments_382198.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nIt isn't fixed. I inserted a print statement in the _mul_long method of matrix_gfpn_dense, but apparently the method is not called.\n\nBy consequence, the Python int is converted to an element of the base ring and then multiplied using _lmul_. I should run some timings, but I am sure that this is slower than using _mul_long.",
    "created_at": "2018-04-02T14:02:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382198",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">comment:32</div>

It isn't fixed. I inserted a print statement in the _mul_long method of matrix_gfpn_dense, but apparently the method is not called.

By consequence, the Python int is converted to an element of the base ring and then multiplied using _lmul_. I should run some timings, but I am sure that this is slower than using _mul_long.



---

archive/issue_comments_382199.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@simon-king-jena](#comment:32):\n> It isn't fixed. I inserted a print statement in the _mul_long method of matrix_gfpn_dense, but apparently the method is not called.\n> \n> By consequence, the Python int is converted to an element of the base ring and then multiplied using _lmul_. I should run some timings, but I am sure that this is slower than using _mul_long.\n\nActually it is a lot worse than I thought:\n\n```\nsage: M = random_matrix(GF(9,'x'), 64,51)\nsage: type(M)\n<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\nsage: cython(\"\"\"\n....: from sage.matrix.matrix_gfpn_dense cimport Matrix_gfpn_dense as MTX\n....: def test1(MTX M):\n....:     cdef size_t i\n....:     cdef MTX N\n....:     for i in range(100000):\n....:         N = M*i\n....: def test2(MTX M):\n....:     cdef size_t i\n....:     cdef MTX N\n....:     for i in range(100000):\n....:         N = M._mul_long(i)\n....: \"\"\")\nsage: %timeit test1(M)\n1 loop, best of 3: 11.7 s per loop\nsage: %timeit test2(M)\n1 loop, best of 3: 366 ms per loop\nsage: 11.7/0.366\n31.9672131147541\n```\nSo, the current code is almost 32 times slower than what used to happen, in a scenario that I do care about.\n\nHence, adding a doctest isn't enough.",
    "created_at": "2018-04-02T14:11:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382199",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@simon-king-jena](#comment:32):
> It isn't fixed. I inserted a print statement in the _mul_long method of matrix_gfpn_dense, but apparently the method is not called.
> 
> By consequence, the Python int is converted to an element of the base ring and then multiplied using _lmul_. I should run some timings, but I am sure that this is slower than using _mul_long.

Actually it is a lot worse than I thought:

```
sage: M = random_matrix(GF(9,'x'), 64,51)
sage: type(M)
<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
sage: cython("""
....: from sage.matrix.matrix_gfpn_dense cimport Matrix_gfpn_dense as MTX
....: def test1(MTX M):
....:     cdef size_t i
....:     cdef MTX N
....:     for i in range(100000):
....:         N = M*i
....: def test2(MTX M):
....:     cdef size_t i
....:     cdef MTX N
....:     for i in range(100000):
....:         N = M._mul_long(i)
....: """)
sage: %timeit test1(M)
1 loop, best of 3: 11.7 s per loop
sage: %timeit test2(M)
1 loop, best of 3: 366 ms per loop
sage: 11.7/0.366
31.9672131147541
```
So, the current code is almost 32 times slower than what used to happen, in a scenario that I do care about.

Hence, adding a doctest isn't enough.



---

archive/issue_comments_382200.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer** to none",
    "created_at": "2018-04-02T14:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382200",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Jeroen Demeyer** to none



---

archive/issue_comments_382201.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@simon-king-jena](#comment:32):\n> It isn't fixed.\n\nI just pushed a branch fixing exactly the problem that you described and you're not happy because it doesn't also fix *another* issue? Good luck fixing it your way then.",
    "created_at": "2018-04-02T14:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382201",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@simon-king-jena](#comment:32):
> It isn't fixed.

I just pushed a branch fixing exactly the problem that you described and you're not happy because it doesn't also fix *another* issue? Good luck fixing it your way then.



---

archive/issue_comments_382202.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense___int)** to none",
    "created_at": "2018-04-02T14:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382202",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/jdemeyer/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense___int)** to none



---

archive/issue_comments_382203.json:
```json
{
    "body": "Changed dependencies from **#24742** to none",
    "created_at": "2018-04-02T14:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382203",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24742** to none



---

archive/issue_comments_382204.json:
```json
{
    "body": "Changed commit from **[`59ac78a`](https://github.com/sagemath/sagetrac-mirror/commit/59ac78a4cf1f5c103b2e1725c52df27d6b264eb1)** to none",
    "created_at": "2018-04-02T14:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382204",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`59ac78a`](https://github.com/sagemath/sagetrac-mirror/commit/59ac78a4cf1f5c103b2e1725c52df27d6b264eb1)** to none



---

archive/issue_comments_382205.json:
```json
{
    "body": "Dependencies: **#24742**",
    "created_at": "2018-04-02T14:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382205",
    "user": "https://github.com/simon-king-jena"
}
```

Dependencies: **#24742**



---

archive/issue_comments_382206.json:
```json
{
    "body": "Changed keywords from **meataxe coercion** to **_mul_long**",
    "created_at": "2018-04-02T14:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382206",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from **meataxe coercion** to **_mul_long**



---

archive/issue_comments_382207.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@jdemeyer](#comment:34):\n> Replying to [@simon-king-jena](#comment:32):\n> > It isn't fixed.\n\n> \n> I just pushed a branch fixing exactly the problem that you described and you're not happy because it doesn't also fix *another* issue? Good luck fixing it your way then.\n\nYour behaviour makes me speechless. Almost.\n\nThe ticket description is about using the short-cut _mul_long as a solution to the problem that Matrix*int didn't work. As it turns out #24742 allows Matrix*int, but it doesn't do it by enabling _mul_long (although _mul_long is supported in sage.structure.element).\n\nSo, given the poor performance I demonstrated, there is an issue here that goes beyond what was fixed in #24742, and it is related with what the ticket description of this ticket says.\n\nIn addition, I notice that the current implementation of _mul_long for Matrix_gfpn_dense doesn't convert an integer into `GF(p^n,'x')` by reduction modulo p, but by some conversion used by MeatAxe. For instance, 4 would be converted to the number x+1 in GF(9,'x'). I didn't notice it before since in my cohomology applications I work with matrices over prime fields, where the different conversions happen to coincide.\n\nHence, if this ticket is about to \"Fix Matrix_gfpn_dense*int\", then here one should\n1. re-enable the usage of _mul_long for matrix times int, because of the performance issue\n2. fix _mul_long of Matrix_gfpn_dense for non-prime fields.\n\nI changed the ticket description accordingly.\n\nConsequently, this ticket is by no means just a duplicate of #24742.\n\nAnd even when you insist that it is a duplicate: What would be the point of closing this ticket as a duplicate (or maybe just adding a test) and then opening yet another ticket that deals with the two remaining issues?\n\nAlternatively, I could just leave the issues alone and use ._mul_long directly in my cohomology code, to be independent of whatever implementation of coercion is currently used.",
    "created_at": "2018-04-02T14:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382207",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@jdemeyer](#comment:34):
> Replying to [@simon-king-jena](#comment:32):
> > It isn't fixed.

> 
> I just pushed a branch fixing exactly the problem that you described and you're not happy because it doesn't also fix *another* issue? Good luck fixing it your way then.

Your behaviour makes me speechless. Almost.

The ticket description is about using the short-cut _mul_long as a solution to the problem that Matrix*int didn't work. As it turns out #24742 allows Matrix*int, but it doesn't do it by enabling _mul_long (although _mul_long is supported in sage.structure.element).

So, given the poor performance I demonstrated, there is an issue here that goes beyond what was fixed in #24742, and it is related with what the ticket description of this ticket says.

In addition, I notice that the current implementation of _mul_long for Matrix_gfpn_dense doesn't convert an integer into `GF(p^n,'x')` by reduction modulo p, but by some conversion used by MeatAxe. For instance, 4 would be converted to the number x+1 in GF(9,'x'). I didn't notice it before since in my cohomology applications I work with matrices over prime fields, where the different conversions happen to coincide.

Hence, if this ticket is about to "Fix Matrix_gfpn_dense*int", then here one should
1. re-enable the usage of _mul_long for matrix times int, because of the performance issue
2. fix _mul_long of Matrix_gfpn_dense for non-prime fields.

I changed the ticket description accordingly.

Consequently, this ticket is by no means just a duplicate of #24742.

And even when you insist that it is a duplicate: What would be the point of closing this ticket as a duplicate (or maybe just adding a test) and then opening yet another ticket that deals with the two remaining issues?

Alternatively, I could just leave the issues alone and use ._mul_long directly in my cohomology code, to be independent of whatever implementation of coercion is currently used.



---

archive/issue_comments_382208.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The following happens on some systems (why only some?) when MeatAxe is used as a matrix backend:\n+The following previous bug was fixed by #24742:\n \n ```\n sage: M = matrix(GF(9,'x'), 2,3)\n@@ -163,16 +163,7 @@\n ValueError: Cannot initialise non-square matrix from 1\n ```\n \n-The Python int 1 should or course not be converted into the matrix space (simply because that matrix space is not an algebra), but instead should be converted into the matrix' basering, so that `_lmul_` can be called.\n+What #24742 doesn't fix:\n+1. Multiplication of a matrix with a scalar that is given as an integer doesn't use _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.\n+2. The _mul_long implementation of Matrix_gfpn_dense is flawed, as it *should* do a coercion of the given integer into the underlying base ring (which is by computing the remainder modulo the modulus of the base ring), but currently uses a different way of conversion.\n \n-Or even better: The shortcut _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.\n-\n-It could be that the actual error is in the coercion system, although it seems to occur only with the MeatAxe backend:\n-\n-```\n-sage: M = MatrixSpace(GF(9,'x'), 2,3, implementation=\"generic\")()\n-sage: M*int(1)\n-[0 0 0]\n-[0 0 0]\n-```\n-\n``````\n",
    "created_at": "2018-04-02T14:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382208",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The following happens on some systems (why only some?) when MeatAxe is used as a matrix backend:
+The following previous bug was fixed by #24742:
 
 ```
 sage: M = matrix(GF(9,'x'), 2,3)
@@ -163,16 +163,7 @@
 ValueError: Cannot initialise non-square matrix from 1
 ```
 
-The Python int 1 should or course not be converted into the matrix space (simply because that matrix space is not an algebra), but instead should be converted into the matrix' basering, so that `_lmul_` can be called.
+What #24742 doesn't fix:
+1. Multiplication of a matrix with a scalar that is given as an integer doesn't use _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.
+2. The _mul_long implementation of Matrix_gfpn_dense is flawed, as it *should* do a coercion of the given integer into the underlying base ring (which is by computing the remainder modulo the modulus of the base ring), but currently uses a different way of conversion.
 
-Or even better: The shortcut _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.
-
-It could be that the actual error is in the coercion system, although it seems to occur only with the MeatAxe backend:
-
-```
-sage: M = MatrixSpace(GF(9,'x'), 2,3, implementation="generic")()
-sage: M*int(1)
-[0 0 0]
-[0 0 0]
-```
-
``````




---

archive/issue_comments_382209.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -164,6 +164,6 @@\n ```\n \n What #24742 doesn't fix:\n-1. Multiplication of a matrix with a scalar that is given as an integer doesn't use _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.\n+1. Multiplication of a matrix with a scalar that is given as a Python int fails to use _mul_long(), which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.\n 2. The _mul_long implementation of Matrix_gfpn_dense is flawed, as it *should* do a coercion of the given integer into the underlying base ring (which is by computing the remainder modulo the modulus of the base ring), but currently uses a different way of conversion.\n \n``````\n",
    "created_at": "2018-04-02T14:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382209",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -164,6 +164,6 @@
 ```
 
 What #24742 doesn't fix:
-1. Multiplication of a matrix with a scalar that is given as an integer doesn't use _mul_long() should be used, which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.
+1. Multiplication of a matrix with a scalar that is given as a Python int fails to use _mul_long(), which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.
 2. The _mul_long implementation of Matrix_gfpn_dense is flawed, as it *should* do a coercion of the given integer into the underlying base ring (which is by computing the remainder modulo the modulus of the base ring), but currently uses a different way of conversion.
 
``````




---

archive/issue_comments_382210.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@simon-king-jena](#comment:35):\n> What would be the point of closing this ticket as a duplicate (or maybe just adding a test) and then opening yet another ticket that deals with the two remaining issues?\n\n1. It fixes the issue that `Matrix * int` didn't work.\n\n2. It adds a doctest to show that 1. will remain fixed.",
    "created_at": "2018-04-02T15:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382210",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@simon-king-jena](#comment:35):
> What would be the point of closing this ticket as a duplicate (or maybe just adding a test) and then opening yet another ticket that deals with the two remaining issues?

1. It fixes the issue that `Matrix * int` didn't work.

2. It adds a doctest to show that 1. will remain fixed.



---

archive/issue_comments_382211.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jdemeyer](#comment:37):\n> Replying to [@simon-king-jena](#comment:35):\n> > What would be the point of closing this ticket as a duplicate (or maybe just adding a test) and then opening yet another ticket that deals with the two remaining issues?\n\n> \n> 1. It fixes the issue that `Matrix * int` didn't work.\n> \n> 2. It adds a doctest to show that 1. will remain fixed.\n\nIssue 1 is fixed in the dependency and moreover these are not the only issues related with the original ticket description. And what would be the point of opening yet another ticket when the remaining issue can be dealt with here?\n\nIt is, by the way, not without precedence that a ticket description was changed because of issues that came up while working on the original ticket description.",
    "created_at": "2018-04-02T15:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382211",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jdemeyer](#comment:37):
> Replying to [@simon-king-jena](#comment:35):
> > What would be the point of closing this ticket as a duplicate (or maybe just adding a test) and then opening yet another ticket that deals with the two remaining issues?

> 
> 1. It fixes the issue that `Matrix * int` didn't work.
> 
> 2. It adds a doctest to show that 1. will remain fixed.

Issue 1 is fixed in the dependency and moreover these are not the only issues related with the original ticket description. And what would be the point of opening yet another ticket when the remaining issue can be dealt with here?

It is, by the way, not without precedence that a ticket description was changed because of issues that came up while working on the original ticket description.



---

archive/issue_comments_382212.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@simon-king-jena](#comment:38):\n> And what would be the point of opening yet another ticket when the remaining issue can be dealt with here?\n\nBecause this ticket already does something useful.\n\nTo turn your question around: what would be the point of **not** opening yet another ticket given that there are really two issues here (one about coercing scalars to the base ring and one about using `_mul_long`)?",
    "created_at": "2018-04-02T15:07:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382212",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@simon-king-jena](#comment:38):
> And what would be the point of opening yet another ticket when the remaining issue can be dealt with here?

Because this ticket already does something useful.

To turn your question around: what would be the point of **not** opening yet another ticket given that there are really two issues here (one about coercing scalars to the base ring and one about using `_mul_long`)?



---

archive/issue_comments_382213.json:
```json
{
    "body": "Branch: **[u/SimonKing/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense___int)**",
    "created_at": "2018-04-02T15:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382213",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense___int)**



---

archive/issue_comments_382214.json:
```json
{
    "body": "Changed keywords from **_mul_long** to none",
    "created_at": "2018-04-02T15:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382214",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from **_mul_long** to none



---

archive/issue_comments_382215.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,162 +8,8 @@\n [0 0 0]\n [0 0 0]\n sage: M*int(1)\n----------------------------------------------------------------------------\n-ValueError                                Traceback (most recent call last)\n-<ipython-input-3-1a2faedb318b> in <module>()\n-----> 1 M*int(Integer(1))\n-\n-/home/king/Sage/git/sage/src/sage/structure/element.pyx in sage.structure.element.Matrix.__mul__ (build/cythonized/sage/structure/element.c:23460)()\n-   3671         if have_same_parent(left, right):\n-   3672             return (<Matrix>left)._matrix_times_matrix_(<Matrix>right)\n--> 3673         return coercion_model.bin_op(left, right, mul)\n-   3674 \n-   3675     def __truediv__(left, right):\n-\n-/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9671)()\n-   1111             if xp is yp:\n-   1112                 return op(x,y)\n--> 1113             action = self.get_action(xp, yp, op, x, y)\n-   1114             if action is not None:\n-   1115                 return (<Action>action)._call_(x, y)\n-\n-/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16889)()\n-   1654         except KeyError:\n-   1655             pass\n--> 1656         action = self.discover_action(R, S, op, r, s)\n-   1657         action = self.verify_action(action, R, S, op)\n-   1658         self._action_maps.set(R, S, op, action)\n-\n-/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18411)()\n-   1804 \n-   1805         if isinstance(R, Parent):\n--> 1806             action = (<Parent>R).get_action(S, op, True, r, s)\n-   1807             if action is not None:\n-   1808                 return action\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21664)()\n-   2493         action = self._get_action_(S, op, self_on_left)\n-   2494         if action is None:\n--> 2495             action = self.discover_action(S, op, self_on_left, self_el, S_el)\n-   2496 \n-   2497         if action is not None:\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:23017)()\n-   2604                     return action\n-   2605 \n--> 2606                 if parent_is_integers(S) and not self.has_coerce_map_from(S):\n-   2607                     from sage.structure.coerce_actions import IntegerMulAction\n-   2608                     try:\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.has_coerce_map_from (build/cythonized/sage/structure/parent.c:17925)()\n-   2022                 print(\"Warning: non-unique parents %s\" % (type(S)))\n-   2023             return True\n--> 2024         return self._internal_coerce_map_from(S) is not None\n-   2025 \n-   2026     cpdef _coerce_map_from_(self, S):\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent._internal_coerce_map_from (build/cythonized/sage/structure/parent.c:18944)()\n-   2164         try:\n-   2165             _register_pair(self, S, \"coerce\")\n--> 2166             mor = self.discover_coerce_map_from(S)\n-   2167             #if mor is not None:\n-   2168             #    # Need to check that this morphism doesn't connect previously unconnected parts of the coercion diagram\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_coerce_map_from (build/cythonized/sage/structure/parent.c:19396)()\n-   2301                 return (<Parent>S)._embedding\n-   2302 \n--> 2303         user_provided_mor = self._coerce_map_from_(S)\n-   2304 \n-   2305         if user_provided_mor is None or user_provided_mor is False:\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_map_from_ (build/cythonized/sage/structure/parent_old.c:7549)()\n-    339     cpdef _coerce_map_from_(self, S):\n-    340         if self._element_constructor is None:\n---> 341             return self.coerce_map_from_c(S)\n-    342         else:\n-    343             return parent.Parent._coerce_map_from_(self, S)\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:4044)()\n-    157                 self._coerce_from_hash[S] = None\n-    158                 return None\n---> 159             mor = self.coerce_map_from_c(sage_type)\n-    160             if mor is not None:\n-    161                 mor = mor * sage_type._internal_coerce_map_from(S)\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:3768)()\n-    141             pass\n-    142 \n---> 143         mor = self.coerce_map_from_c_impl(S)\n-    144         import sage.categories.morphism\n-    145         import sage.categories.map\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:4710)()\n-    189         # Piggyback off the old code for now\n-    190         # WARNING: when working on this, make sure circular dependencies aren't introduced!\n---> 191         if self.has_coerce_map_from_c(S):\n-    192             if isinstance(S, type):\n-    193                 S = Set_PythonType(S)\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:6312)()\n-    275             except KeyError:\n-    276                 pass\n---> 277         x = self.has_coerce_map_from_c_impl(S)\n-    278         self._has_coerce_map_from.set(S, x)\n-    279         return x\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:6489)()\n-    284             return False\n-    285         try:\n---> 286             self._coerce_c((<parent.Parent>S).an_element())\n-    287         except TypeError:\n-    288             return False\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_c (build/cythonized/sage/structure/parent_old.c:5382)()\n-    217             pass\n-    218         if HAS_DICTIONARY(self):\n---> 219             return self._coerce_impl(x)\n-    220         else:\n-    221             return self._coerce_c_impl(x)\n-\n-/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in _coerce_impl(self, x)\n-   1100             and self.base_ring().has_coerce_map_from(x.base_ring())):\n-   1101             return self(x)\n--> 1102         return self._coerce_try(x, self.base_ring())\n-   1103 \n-   1104     def _repr_(self):\n-\n-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5902)()\n-    255             try:\n-    256                 y = R._coerce_(x)\n---> 257                 return self(y)\n-    258             except (TypeError, AttributeError) as msg:\n-    259                 pass\n-\n-/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __call__(self, entries, coerce, copy, sparse)\n-    873             [t]\n-    874         \"\"\"\n---> 875         return self.matrix(entries, coerce, copy)\n-    876 \n-    877     def change_ring(self, R):\n-\n-/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in matrix(self, x, coerce, copy)\n-   1886                 x = list_to_dict(x, m, n)\n-   1887                 copy = False\n--> 1888         return MC(self, x, copy=copy, coerce=coerce)\n-   1889 \n-   1890     def matrix_space(self, nrows=None, ncols=None, sparse=False):\n-\n-/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__init__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:5278)()\n-    423                 return\n-    424             if self._nrows != self._ncols:\n---> 425                 raise ValueError(\"Cannot initialise non-square matrix from {}\".format(data))\n-    426             f = FfFromInt(self._converter.field_to_int(self._coerce_element(data)))\n-    427             x = self.Data.Data\n-\n+...\n ValueError: Cannot initialise non-square matrix from 1\n ```\n \n-What #24742 doesn't fix:\n-1. Multiplication of a matrix with a scalar that is given as a Python int fails to use _mul_long(), which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.\n-2. The _mul_long implementation of Matrix_gfpn_dense is flawed, as it *should* do a coercion of the given integer into the underlying base ring (which is by computing the remainder modulo the modulus of the base ring), but currently uses a different way of conversion.\n-\n+This ticket adds a test that makes sure that the issue remains fixed.\n``````\n",
    "created_at": "2018-04-02T15:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382215",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,162 +8,8 @@
 [0 0 0]
 [0 0 0]
 sage: M*int(1)
----------------------------------------------------------------------------
-ValueError                                Traceback (most recent call last)
-<ipython-input-3-1a2faedb318b> in <module>()
-----> 1 M*int(Integer(1))
-
-/home/king/Sage/git/sage/src/sage/structure/element.pyx in sage.structure.element.Matrix.__mul__ (build/cythonized/sage/structure/element.c:23460)()
-   3671         if have_same_parent(left, right):
-   3672             return (<Matrix>left)._matrix_times_matrix_(<Matrix>right)
--> 3673         return coercion_model.bin_op(left, right, mul)
-   3674 
-   3675     def __truediv__(left, right):
-
-/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9671)()
-   1111             if xp is yp:
-   1112                 return op(x,y)
--> 1113             action = self.get_action(xp, yp, op, x, y)
-   1114             if action is not None:
-   1115                 return (<Action>action)._call_(x, y)
-
-/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16889)()
-   1654         except KeyError:
-   1655             pass
--> 1656         action = self.discover_action(R, S, op, r, s)
-   1657         action = self.verify_action(action, R, S, op)
-   1658         self._action_maps.set(R, S, op, action)
-
-/home/king/Sage/git/sage/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18411)()
-   1804 
-   1805         if isinstance(R, Parent):
--> 1806             action = (<Parent>R).get_action(S, op, True, r, s)
-   1807             if action is not None:
-   1808                 return action
-
-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21664)()
-   2493         action = self._get_action_(S, op, self_on_left)
-   2494         if action is None:
--> 2495             action = self.discover_action(S, op, self_on_left, self_el, S_el)
-   2496 
-   2497         if action is not None:
-
-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:23017)()
-   2604                     return action
-   2605 
--> 2606                 if parent_is_integers(S) and not self.has_coerce_map_from(S):
-   2607                     from sage.structure.coerce_actions import IntegerMulAction
-   2608                     try:
-
-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.has_coerce_map_from (build/cythonized/sage/structure/parent.c:17925)()
-   2022                 print("Warning: non-unique parents %s" % (type(S)))
-   2023             return True
--> 2024         return self._internal_coerce_map_from(S) is not None
-   2025 
-   2026     cpdef _coerce_map_from_(self, S):
-
-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent._internal_coerce_map_from (build/cythonized/sage/structure/parent.c:18944)()
-   2164         try:
-   2165             _register_pair(self, S, "coerce")
--> 2166             mor = self.discover_coerce_map_from(S)
-   2167             #if mor is not None:
-   2168             #    # Need to check that this morphism doesn't connect previously unconnected parts of the coercion diagram
-
-/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_coerce_map_from (build/cythonized/sage/structure/parent.c:19396)()
-   2301                 return (<Parent>S)._embedding
-   2302 
--> 2303         user_provided_mor = self._coerce_map_from_(S)
-   2304 
-   2305         if user_provided_mor is None or user_provided_mor is False:
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_map_from_ (build/cythonized/sage/structure/parent_old.c:7549)()
-    339     cpdef _coerce_map_from_(self, S):
-    340         if self._element_constructor is None:
---> 341             return self.coerce_map_from_c(S)
-    342         else:
-    343             return parent.Parent._coerce_map_from_(self, S)
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:4044)()
-    157                 self._coerce_from_hash[S] = None
-    158                 return None
---> 159             mor = self.coerce_map_from_c(sage_type)
-    160             if mor is not None:
-    161                 mor = mor * sage_type._internal_coerce_map_from(S)
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:3768)()
-    141             pass
-    142 
---> 143         mor = self.coerce_map_from_c_impl(S)
-    144         import sage.categories.morphism
-    145         import sage.categories.map
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:4710)()
-    189         # Piggyback off the old code for now
-    190         # WARNING: when working on this, make sure circular dependencies aren't introduced!
---> 191         if self.has_coerce_map_from_c(S):
-    192             if isinstance(S, type):
-    193                 S = Set_PythonType(S)
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c (build/cythonized/sage/structure/parent_old.c:6312)()
-    275             except KeyError:
-    276                 pass
---> 277         x = self.has_coerce_map_from_c_impl(S)
-    278         self._has_coerce_map_from.set(S, x)
-    279         return x
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent.has_coerce_map_from_c_impl (build/cythonized/sage/structure/parent_old.c:6489)()
-    284             return False
-    285         try:
---> 286             self._coerce_c((<parent.Parent>S).an_element())
-    287         except TypeError:
-    288             return False
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_c (build/cythonized/sage/structure/parent_old.c:5382)()
-    217             pass
-    218         if HAS_DICTIONARY(self):
---> 219             return self._coerce_impl(x)
-    220         else:
-    221             return self._coerce_c_impl(x)
-
-/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in _coerce_impl(self, x)
-   1100             and self.base_ring().has_coerce_map_from(x.base_ring())):
-   1101             return self(x)
--> 1102         return self._coerce_try(x, self.base_ring())
-   1103 
-   1104     def _repr_(self):
-
-/home/king/Sage/git/sage/src/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5902)()
-    255             try:
-    256                 y = R._coerce_(x)
---> 257                 return self(y)
-    258             except (TypeError, AttributeError) as msg:
-    259                 pass
-
-/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __call__(self, entries, coerce, copy, sparse)
-    873             [t]
-    874         """
---> 875         return self.matrix(entries, coerce, copy)
-    876 
-    877     def change_ring(self, R):
-
-/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in matrix(self, x, coerce, copy)
-   1886                 x = list_to_dict(x, m, n)
-   1887                 copy = False
--> 1888         return MC(self, x, copy=copy, coerce=coerce)
-   1889 
-   1890     def matrix_space(self, nrows=None, ncols=None, sparse=False):
-
-/home/king/Sage/git/sage/src/sage/matrix/matrix_gfpn_dense.pyx in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.__init__ (build/cythonized/sage/matrix/matrix_gfpn_dense.c:5278)()
-    423                 return
-    424             if self._nrows != self._ncols:
---> 425                 raise ValueError("Cannot initialise non-square matrix from {}".format(data))
-    426             f = FfFromInt(self._converter.field_to_int(self._coerce_element(data)))
-    427             x = self.Data.Data
-
+...
 ValueError: Cannot initialise non-square matrix from 1
 ```
 
-What #24742 doesn't fix:
-1. Multiplication of a matrix with a scalar that is given as a Python int fails to use _mul_long(), which is supported by sage.structure.element but isn't used anywhere in sage.matrix except in sage.matrix.matrix_gfpn_dense.
-2. The _mul_long implementation of Matrix_gfpn_dense is flawed, as it *should* do a coercion of the given integer into the underlying base ring (which is by computing the remainder modulo the modulus of the base ring), but currently uses a different way of conversion.
-
+This ticket adds a test that makes sure that the issue remains fixed.
``````




---

archive/issue_events_346877.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-02T15:15:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346877"
}
```



---

archive/issue_events_346878.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-04-02T15:15:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346878"
}
```



---

archive/issue_comments_382216.json:
```json
{
    "body": "Author: **SimonKing**",
    "created_at": "2018-04-02T15:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382216",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **SimonKing**



---

archive/issue_comments_382217.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nOK, just adding a test here, and then opening another ticket for the two remaining issues (that do belong together).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf9cefd138bb9fbb19c3c43a778ab230bf962902\">bf9cefd</a></td><td><code>New MatrixArgs object to deal with constructing matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc828252def3e2631c7cca8db7bd6f972af4efc6\">cc82825</a></td><td><code>Merge branch 'u/jdemeyer/new_matrixinput_object_to_deal_with_constructing_matrices' of git://trac.sagemath.org/sage into t/25076/fix_matrix_gfpn_dense___int</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8\">bed63f0</a></td><td><code>Add a test ensuring that #24742 remains fixed</code></td></tr></table>\n",
    "created_at": "2018-04-02T15:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382217",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:41" align="right">comment:41</div>

OK, just adding a test here, and then opening another ticket for the two remaining issues (that do belong together).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf9cefd138bb9fbb19c3c43a778ab230bf962902">bf9cefd</a></td><td><code>New MatrixArgs object to deal with constructing matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc828252def3e2631c7cca8db7bd6f972af4efc6">cc82825</a></td><td><code>Merge branch 'u/jdemeyer/new_matrixinput_object_to_deal_with_constructing_matrices' of git://trac.sagemath.org/sage into t/25076/fix_matrix_gfpn_dense___int</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8">bed63f0</a></td><td><code>Add a test ensuring that #24742 remains fixed</code></td></tr></table>




---

archive/issue_comments_382218.json:
```json
{
    "body": "Commit: **[`bed63f0`](https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8)**",
    "created_at": "2018-04-02T15:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382218",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[`bed63f0`](https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8)**



---

archive/issue_comments_382219.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nNote that I constructed the test in such a way that blindly using the current implementation of _mul_long would give the wrong result, which means it also makes sure that the follow-up ticket will use the right conversion.",
    "created_at": "2018-04-02T15:16:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382219",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:42" align="right">comment:42</div>

Note that I constructed the test in such a way that blindly using the current implementation of _mul_long would give the wrong result, which means it also makes sure that the follow-up ticket will use the right conversion.



---

archive/issue_comments_382220.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@simon-king-jena](#comment:41):\n> opening another ticket for the two remaining issues (that do belong together).\n\nThose still look like different issues to me. One is about the coercion model and one is about the meataxe interface.",
    "created_at": "2018-04-02T15:21:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382220",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@simon-king-jena](#comment:41):
> opening another ticket for the two remaining issues (that do belong together).

Those still look like different issues to me. One is about the coercion model and one is about the meataxe interface.



---

archive/issue_comments_382221.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@simon-king-jena](#comment:42):\n> Note that I constructed the test in such a way that blindly using the current implementation of _mul_long would give the wrong result, which means it also makes sure that the follow-up ticket will use the right conversion.\n\nSee #25079",
    "created_at": "2018-04-02T15:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382221",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@simon-king-jena](#comment:42):
> Note that I constructed the test in such a way that blindly using the current implementation of _mul_long would give the wrong result, which means it also makes sure that the follow-up ticket will use the right conversion.

See #25079



---

archive/issue_comments_382222.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI think it would be good to refer to this ticket instead of #24742 and to add a test for `int * Matrix` too.",
    "created_at": "2018-04-02T15:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382222",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

I think it would be good to refer to this ticket instead of #24742 and to add a test for `int * Matrix` too.



---

archive/issue_comments_382223.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@jdemeyer](#comment:43):\n> Replying to [@simon-king-jena](#comment:41):\n> > opening another ticket for the two remaining issues (that do belong together).\n\n> \n> Those still look like different issues to me. One is about the coercion model and one is about the meataxe interface.\n\nYes, they are two different issues, but it is totally natural to deal with them on a single ticket: When one only fixes the coercion model, one would actually *introduce* a bug (namely: The flawed _mul_long of Matrix_gfpn_dense would be used). When one only fixes the meataxe interface, one wouldn't be able to demonstrate that it is fixed without using cython in doctests.\n\nYes, using cython in doctests is possible, but why should one, if the existing test \"M*int(4)==M\" is good enough?",
    "created_at": "2018-04-02T15:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382223",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@jdemeyer](#comment:43):
> Replying to [@simon-king-jena](#comment:41):
> > opening another ticket for the two remaining issues (that do belong together).

> 
> Those still look like different issues to me. One is about the coercion model and one is about the meataxe interface.

Yes, they are two different issues, but it is totally natural to deal with them on a single ticket: When one only fixes the coercion model, one would actually *introduce* a bug (namely: The flawed _mul_long of Matrix_gfpn_dense would be used). When one only fixes the meataxe interface, one wouldn't be able to demonstrate that it is fixed without using cython in doctests.

Yes, using cython in doctests is possible, but why should one, if the existing test "M*int(4)==M" is good enough?



---

archive/issue_comments_382224.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f\">f0e97af</a></td><td><code>Modify the test that ensures that #24742 remains fixed</code></td></tr></table>\n",
    "created_at": "2018-04-02T15:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382224",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f">f0e97af</a></td><td><code>Modify the test that ensures that #24742 remains fixed</code></td></tr></table>




---

archive/issue_comments_382225.json:
```json
{
    "body": "Changed commit from **[`bed63f0`](https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8)** to **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)**",
    "created_at": "2018-04-02T15:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382225",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bed63f0`](https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8)** to **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)**



---

archive/issue_comments_382226.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@jdemeyer](#comment:45):\n> I think it would be good to refer to this ticket instead of #24742 and to add a test for `int * Matrix` too.\n\nDone.",
    "created_at": "2018-04-02T15:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382226",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@jdemeyer](#comment:45):
> I think it would be good to refer to this ticket instead of #24742 and to add a test for `int * Matrix` too.

Done.



---

archive/issue_events_346879.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-05T08:58:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346879"
}
```



---

archive/issue_events_346880.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-05T08:58:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346880"
}
```



---

archive/issue_comments_382227.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2018-04-05T08:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382227",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_346881.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-09T09:49:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346881"
}
```



---

archive/issue_events_346882.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "96987ac2a54d9dcb3b7f65cbdff88cff0603fa7e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-05-09T09:49:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25076#event-346882"
}
```



---

archive/issue_comments_382228.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense___int)** to **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)**",
    "created_at": "2018-05-09T09:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382228",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/SimonKing/fix_matrix_gfpn_dense___int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense___int)** to **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)**



---

archive/issue_comments_382229.json:
```json
{
    "body": "Changed commit from **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)** to none",
    "created_at": "2018-09-06T13:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382229",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`f0e97af`](https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f)** to none



---

archive/issue_comments_382230.json:
```json
{
    "body": "Changed author from **SimonKing** to **Simon King**",
    "created_at": "2018-09-06T13:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25076#issuecomment-382230",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **SimonKing** to **Simon King**
