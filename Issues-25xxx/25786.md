# Issue 25786: Fix introspection with ? when doc source is not available

archive/issues_025549.json:
```json
{
    "body": "Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and Arch Linux (if the sagemath-doc package is not installed):\n\n```\nsage: ZZ?\n\u2026\n/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)\n    497     oldpath = sys.path\n    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath\n--> 499     from conf import extlinks\n    500     sys.path = oldpath\n    501     for key in extlinks:\n\nImportError: cannot import name extlinks\n```\n\nThe problem is that `src/doc/common/conf.py` is not in the place that Sage expects.\n\nI don't think that we should require the documentation configuration to be installed for Sage to work.\n\nA docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253\n\nCC:  @antonio-rojas @jdemeyer @slel\n\nKeywords: conda, Arch Linux, introspection\n\nBranch/Commit: a401a171fcfde7ed5e5a128bb6af0967e96b11a8\n\nWork_Issues: is the patchbot happy?\n\nReviewer: Julian R\u00fcth, Isuru Fernando, Fran\u00e7ois Bissey\n\nAuthor: Julian R\u00fcth, Isuru Fernando\n\nDependencies: #25843\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25786\n\n",
    "closed_at": "2019-07-23T21:03:51Z",
    "created_at": "2018-07-06T11:22:02Z",
    "labels": [
        "component: documentation",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Fix introspection with ? when doc source is not available",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25786",
    "user": "https://github.com/saraedum"
}
```
Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and Arch Linux (if the sagemath-doc package is not installed):

```
sage: ZZ?
…
/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)
    497     oldpath = sys.path
    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath
--> 499     from conf import extlinks
    500     sys.path = oldpath
    501     for key in extlinks:

ImportError: cannot import name extlinks
```

The problem is that `src/doc/common/conf.py` is not in the place that Sage expects.

I don't think that we should require the documentation configuration to be installed for Sage to work.

A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253

CC:  @antonio-rojas @jdemeyer @slel

Keywords: conda, Arch Linux, introspection

Branch/Commit: a401a171fcfde7ed5e5a128bb6af0967e96b11a8

Work_Issues: is the patchbot happy?

Reviewer: Julian Rüth, Isuru Fernando, François Bissey

Author: Julian Rüth, Isuru Fernando

Dependencies: #25843

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25786





---

archive/issue_comments_383348.json:
```json
{
    "body": "<a id='comment:2'></a>Is this needs review?\n\n---\nNew commits:",
    "created_at": "2018-07-06T11:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383348",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Is this needs review?

---
New commits:



---

archive/issue_comments_383349.json:
```json
{
    "body": "<a id='comment:3'></a>I had a comment in #24655 that `src/doc/en/introspect` is required as well\u2026let's see if that's still the case.",
    "created_at": "2018-07-06T11:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383349",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:3'></a>I had a comment in #24655 that `src/doc/en/introspect` is required as well…let's see if that's still the case.



---

archive/issue_comments_383350.json:
```json
{
    "body": "<a id='comment:4'></a>jdemeyer: No, I have not tested this yet. But feel free to give feedback if you know something about this :)",
    "created_at": "2018-07-06T11:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383350",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>jdemeyer: No, I have not tested this yet. But feel free to give feedback if you know something about this :)



---

archive/issue_comments_383351.json:
```json
{
    "body": "<a id='comment:5'></a>See #25787 for a followup regarding the docker images.",
    "created_at": "2018-07-06T11:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383351",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:5'></a>See #25787 for a followup regarding the docker images.



---

archive/issue_comments_383352.json:
```json
{
    "body": "<a id='comment:6'></a>In any case, I agree with the idea behind the patch.",
    "created_at": "2018-07-06T11:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383352",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>In any case, I agree with the idea behind the patch.



---

archive/issue_comments_383353.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-06T11:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383353",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_383354.json:
```json
{
    "body": "<a id='comment:9'></a>So, if the patchbot and my tests are Ok, then this is a positive review?",
    "created_at": "2018-07-06T11:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383354",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:9'></a>So, if the patchbot and my tests are Ok, then this is a positive review?



---

archive/issue_comments_383355.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -17,6 +17,8 @@\n \n I don't think that we should require the documentation configuration to be installed for Sage to work.\n \n+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253\n+\n Comment: 1\n \n Summary: Fix introspection with ? in conda and  ArchLinux\n```\n",
    "created_at": "2018-07-06T11:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383355",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -17,6 +17,8 @@
 
 I don't think that we should require the documentation configuration to be installed for Sage to work.
 
+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253
+
 Comment: 1
 
 Summary: Fix introspection with ? in conda and  ArchLinux
```




---

archive/issue_comments_383356.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 saraedum]:\n> So, if the patchbot and my tests are Ok, then this is a positive review?\n\n\nYes",
    "created_at": "2018-07-06T11:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383356",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:9 saraedum]:
> So, if the patchbot and my tests are Ok, then this is a positive review?


Yes



---

archive/issue_comments_383357.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and ArchLinux:\n \n+```\n+sage: ZZ?\n+\u2026\n+/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)\n+    497     oldpath = sys.path\n+    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath\n+--> 499     from conf import extlinks\n+    500     sys.path = oldpath\n+    501     for key in extlinks:\n+\n+ImportError: cannot import name extlinks\n+```\n+\n+The problem is that `src/doc/common/conf.py` is not in the place that Sage expects.\n+\n+I don't think that we should require the documentation configuration to be installed for Sage to work.\n+\n+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253\n \n Comment: 1\n \n```\n",
    "created_at": "2018-07-06T11:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383357",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,23 @@
+Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and ArchLinux:
 
+```
+sage: ZZ?
+…
+/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)
+    497     oldpath = sys.path
+    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath
+--> 499     from conf import extlinks
+    500     sys.path = oldpath
+    501     for key in extlinks:
+
+ImportError: cannot import name extlinks
+```
+
+The problem is that `src/doc/common/conf.py` is not in the place that Sage expects.
+
+I don't think that we should require the documentation configuration to be installed for Sage to work.
+
+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253
 
 Comment: 1
 
```




---

archive/issue_comments_383358.json:
```json
{
    "body": "<a id='comment:13'></a>This still doesn't allow introspection on Arch without having the doc sources installed, due to \n\n```\n    # Sphinx constructor: Sphinx(srcdir, confdir, outdir, doctreedir,\n    # buildername, confoverrides, status, warning, freshenv).\n    confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')\n\n    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r\"\"\"\n[parsers]\nsmart_quotes = no\n\"\"\")\n    doctreedir = os.path.join(srcdir, 'doctrees')\n    confoverrides = {'html_context': {}, 'master_doc': 'docstring'}\n\n    import sys\n    old_sys_path = list(sys.path)  # Sphinx modifies sys.path\n    sphinx_app = Sphinx(srcdir, confdir, srcdir, doctreedir, format,\n                        confoverrides, None, None, True)\n    sphinx_app.build(None, [rst_name])\n    sys.path = old_sys_path\n```\nin misc/sphinxify.py",
    "created_at": "2018-07-06T12:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383358",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:13'></a>This still doesn't allow introspection on Arch without having the doc sources installed, due to 

```
    # Sphinx constructor: Sphinx(srcdir, confdir, outdir, doctreedir,
    # buildername, confoverrides, status, warning, freshenv).
    confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')

    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r"""
[parsers]
smart_quotes = no
""")
    doctreedir = os.path.join(srcdir, 'doctrees')
    confoverrides = {'html_context': {}, 'master_doc': 'docstring'}

    import sys
    old_sys_path = list(sys.path)  # Sphinx modifies sys.path
    sphinx_app = Sphinx(srcdir, confdir, srcdir, doctreedir, format,
                        confoverrides, None, None, True)
    sphinx_app.build(None, [rst_name])
    sys.path = old_sys_path
```
in misc/sphinxify.py



---

archive/issue_comments_383359.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-07T22:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383360.json:
```json
{
    "body": "<a id='comment:15'></a>arojas: Right, now it works for me. But probably the `from common.conf import *` is there for a reason and I should not simply delete it.",
    "created_at": "2018-07-07T23:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383360",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'></a>arojas: Right, now it works for me. But probably the `from common.conf import *` is there for a reason and I should not simply delete it.



---

archive/issue_comments_383361.json:
```json
{
    "body": "<a id='comment:16'></a>I really prefer one ticket, one issue.",
    "created_at": "2018-07-08T06:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383361",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>I really prefer one ticket, one issue.



---

archive/issue_comments_383362.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-08T06:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383362",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_383363.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 jdemeyer]:\n> I really prefer one ticket, one issue.\n\n\nI believe that this is one issue: \"Fix introspection with ? in conda and ArchLinux\". And even the solution can be seen as one thing: \"Make Sage runtime not depend on documentation configuration.\"",
    "created_at": "2018-07-09T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383363",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:18'></a>Replying to [comment:16 jdemeyer]:
> I really prefer one ticket, one issue.


I believe that this is one issue: "Fix introspection with ? in conda and ArchLinux". And even the solution can be seen as one thing: "Make Sage runtime not depend on documentation configuration."



---

archive/issue_comments_383364.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-09T16:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383364",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_383365.json:
```json
{
    "body": "<a id='comment:19'></a>The patchbots report weird errors that seem unrelated to the changes here\u2026let me try this out locally.",
    "created_at": "2018-07-09T16:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383365",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:19'></a>The patchbots report weird errors that seem unrelated to the changes here…let me try this out locally.



---

archive/issue_comments_383366.json:
```json
{
    "body": "<a id='comment:20'></a>I moved the first part to #25843 and gave positive review to that.",
    "created_at": "2018-07-12T10:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383366",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>I moved the first part to #25843 and gave positive review to that.



---

archive/issue_comments_383367.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and Arch Linux:\n \n+```\n+sage: ZZ?\n+\u2026\n+/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)\n+    497     oldpath = sys.path\n+    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath\n+--> 499     from conf import extlinks\n+    500     sys.path = oldpath\n+    501     for key in extlinks:\n+\n+ImportError: cannot import name extlinks\n+```\n+\n+The problem is that `src/doc/common/conf.py` is not in the place that Sage expects.\n+\n+I don't think that we should require the documentation configuration to be installed for Sage to work.\n+\n+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253\n \n Comment: 1\n \n```\n",
    "created_at": "2018-08-25T17:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383367",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,23 @@
+Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and Arch Linux:
 
+```
+sage: ZZ?
+…
+/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)
+    497     oldpath = sys.path
+    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath
+--> 499     from conf import extlinks
+    500     sys.path = oldpath
+    501     for key in extlinks:
+
+ImportError: cannot import name extlinks
+```
+
+The problem is that `src/doc/common/conf.py` is not in the place that Sage expects.
+
+I don't think that we should require the documentation configuration to be installed for Sage to work.
+
+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253
 
 Comment: 1
 
```




---

archive/issue_comments_383368.json:
```json
{
    "body": "Changing keywords from \"\" to \"conda, Arch Linux, introspection\".",
    "created_at": "2018-08-25T17:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383368",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "conda, Arch Linux, introspection".



---

archive/issue_comments_383369.json:
```json
{
    "body": "<a id='comment:22'></a>Updating slightly misleading description - introspection works fine in Arch if the sagemath-doc package is installed.",
    "created_at": "2018-08-26T07:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383369",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:22'></a>Updating slightly misleading description - introspection works fine in Arch if the sagemath-doc package is installed.



---

archive/issue_comments_383370.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and Arch Linux (if the sagemath-doc package is not installed):\n \n+```\n+sage: ZZ?\n+\u2026\n+/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)\n+    497     oldpath = sys.path\n+    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath\n+--> 499     from conf import extlinks\n+    500     sys.path = oldpath\n+    501     for key in extlinks:\n+\n+ImportError: cannot import name extlinks\n+```\n+\n+The problem is that `src/doc/common/conf.py` is not in the place that Sage expects.\n+\n+I don't think that we should require the documentation configuration to be installed for Sage to work.\n+\n+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253\n \n Comment: 1\n \n```\n",
    "created_at": "2018-08-26T07:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383370",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,23 @@
+Currently, introspection does not work in [conda](https://github.com/conda-forge/sagelib-feedstock/issues/39) and Arch Linux (if the sagemath-doc package is not installed):
 
+```
+sage: ZZ?
+…
+/usr/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in process_extlinks(s, embedded)
+    497     oldpath = sys.path
+    498     sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath
+--> 499     from conf import extlinks
+    500     sys.path = oldpath
+    501     for key in extlinks:
+
+ImportError: cannot import name extlinks
+```
+
+The problem is that `src/doc/common/conf.py` is not in the place that Sage expects.
+
+I don't think that we should require the documentation configuration to be installed for Sage to work.
+
+A docker image to play with this is being built here: https://gitlab.com/sagemath/dev/sage/pipelines/25262253
 
 Comment: 1
 
```




---

archive/issue_comments_383371.json:
```json
{
    "body": "<a id='comment:23'></a>One thing I don't like is the style of the long `\"\"\"`-quoted strings in between code. This could be made more readable by moving the strings outside of the function. Something like\n\n```\n# At module level\nlayout_html = r\"\"\"\n<div class=\"docstring\">\n    {% block body %} {% endblock %}\n</div>\"\"\"\n```\n\n```\n# Inside the function\n    with open(os.path.join(templatesdir, 'layout.html'), 'w') as filed:\n        filed.write(layout_html)\n```",
    "created_at": "2018-09-04T20:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383371",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>One thing I don't like is the style of the long `"""`-quoted strings in between code. This could be made more readable by moving the strings outside of the function. Something like

```
# At module level
layout_html = r"""
<div class="docstring">
    {% block body %} {% endblock %}
</div>"""
```

```
# Inside the function
    with open(os.path.join(templatesdir, 'layout.html'), 'w') as filed:
        filed.write(layout_html)
```



---

archive/issue_comments_383372.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-03T12:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383373.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T11:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383374.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-10-15T06:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383374",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_383375.json:
```json
{
    "body": "<a id='comment:26'></a>`OMIT` is removed from `src/sage_setup/docbuild/build_options.py`, but it is needed in `src/sage_setup/docbuild/__init__.py`",
    "created_at": "2018-10-15T06:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383375",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:26'></a>`OMIT` is removed from `src/sage_setup/docbuild/build_options.py`, but it is needed in `src/sage_setup/docbuild/__init__.py`



---

archive/issue_comments_383376.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-18T21:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383377.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-18T21:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383378.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-18T21:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383378",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_383379.json:
```json
{
    "body": "<a id='comment:30'></a>I like it. It helps me remove some manual installs in sage-on-gentoo. In fact I may not have to install the `common` folder and all the stuff I put in it anymore. This may be a bigger win than it looks like.",
    "created_at": "2019-06-19T00:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383379",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>I like it. It helps me remove some manual installs in sage-on-gentoo. In fact I may not have to install the `common` folder and all the stuff I put in it anymore. This may be a bigger win than it looks like.



---

archive/issue_comments_383380.json:
```json
{
    "body": "<a id='comment:31'></a>The patchbot reports a few broken doctests over formatting.\n\n```\nFile \"src/sage/misc/sagedoc.py\", line 196, in sage.misc.sagedoc.detex\nFailed example:\n    detex(r'Some math: `n \\geq k`.  A website: \\url{sagemath.org}.')\nExpected:\n    'Some math: n >= k.  A website: sagemath.org.\\n'\nGot:\n    'Some math: *n geq k*.  A website: sagemath.org.\\n'\n```\nas an example.",
    "created_at": "2019-06-19T00:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383380",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>The patchbot reports a few broken doctests over formatting.

```
File "src/sage/misc/sagedoc.py", line 196, in sage.misc.sagedoc.detex
Failed example:
    detex(r'Some math: `n \geq k`.  A website: \url{sagemath.org}.')
Expected:
    'Some math: n >= k.  A website: sagemath.org.\n'
Got:
    'Some math: *n geq k*.  A website: sagemath.org.\n'
```
as an example.



---

archive/issue_events_064469.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-06-25T06:55:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25786#event-64469"
}
```



---

archive/issue_comments_383381.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-28T11:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383381",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_383382.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-28T12:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383383.json:
```json
{
    "body": "<a id='comment:36'></a>isuruf commented that following seems to be missing.\n\n```\nfrom sage.env import SAGE_DOC_SRC\nsys.path.append(SAGE_DOC_SRC)\nfrom common.conf import *\n```",
    "created_at": "2019-07-01T13:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383383",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:36'></a>isuruf commented that following seems to be missing.

```
from sage.env import SAGE_DOC_SRC
sys.path.append(SAGE_DOC_SRC)
from common.conf import *
```



---

archive/issue_comments_383384.json:
```json
{
    "body": "<a id='comment:37'></a>Maybe move `src/doc/common/conf.py` to `src/sage/docs/conf.py` and update the imports?",
    "created_at": "2019-07-02T17:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383384",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:37'></a>Maybe move `src/doc/common/conf.py` to `src/sage/docs/conf.py` and update the imports?



---

archive/issue_comments_383385.json:
```json
{
    "body": "<a id='comment:38'></a>What do you think about the above suggestion? I can update this branch if you agree",
    "created_at": "2019-07-10T14:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383385",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:38'></a>What do you think about the above suggestion? I can update this branch if you agree



---

archive/issue_comments_383386.json:
```json
{
    "body": "<a id='comment:39'></a>Sorry, yes please go ahead :)",
    "created_at": "2019-07-10T14:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383386",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:39'></a>Sorry, yes please go ahead :)



---

archive/issue_comments_383387.json:
```json
{
    "body": "<a id='comment:40'></a>It would be nice to finish this. I would add that the clean up should probably also include this line https://github.com/sagemath/sage/blob/master/src/sage_setup/docbuild/build_options.py#L12\n\n```\nOMIT = [\"introspect\"]  # docs/dirs to omit when listing and building 'all'\n```\nThis ticket is removing that folder altogether. Do we even need `OMIT`?  If we don't, I think we could remove that logic in a follow up ticket.",
    "created_at": "2019-07-16T03:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383387",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'></a>It would be nice to finish this. I would add that the clean up should probably also include this line https://github.com/sagemath/sage/blob/master/src/sage_setup/docbuild/build_options.py#L12

```
OMIT = ["introspect"]  # docs/dirs to omit when listing and building 'all'
```
This ticket is removing that folder altogether. Do we even need `OMIT`?  If we don't, I think we could remove that logic in a follow up ticket.



---

archive/issue_comments_383388.json:
```json
{
    "body": "<a id='comment:41'></a>`@`saraedum can you pull https://github.com/isuruf/sage/commit/863d433d402c9257768929f7d62c4bd478eabbc8",
    "created_at": "2019-07-16T06:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383388",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:41'></a>`@`saraedum can you pull https://github.com/isuruf/sage/commit/863d433d402c9257768929f7d62c4bd478eabbc8



---

archive/issue_comments_383389.json:
```json
{
    "body": "<a id='comment:42'></a>Sure. You can also just push to this ticket, there is no ownership as with [GitHub](GitHub) PRs here.",
    "created_at": "2019-07-16T06:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383389",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:42'></a>Sure. You can also just push to this ticket, there is no ownership as with [GitHub](GitHub) PRs here.



---

archive/issue_comments_383390.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-16T06:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383391.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-16T06:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383391",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_383392.json:
```json
{
    "body": "<a id='comment:45'></a>Is there a reason why we should not squash one layer here, i.e., move `conf.py` one level up so that we can write `from sage.docs.conf import *`?",
    "created_at": "2019-07-16T06:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383392",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:45'></a>Is there a reason why we should not squash one layer here, i.e., move `conf.py` one level up so that we can write `from sage.docs.conf import *`?



---

archive/issue_comments_383393.json:
```json
{
    "body": "<a id='comment:46'></a>No reason. I previously had some other files in `sage/docs/conf` and were removed later.",
    "created_at": "2019-07-16T06:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383393",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:46'></a>No reason. I previously had some other files in `sage/docs/conf` and were removed later.



---

archive/issue_comments_383394.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-16T06:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383395.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-16T06:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383396.json:
```json
{
    "body": "<a id='comment:49'></a>`@`isuruf: Could  you have a look at my latest changes? (That I did not test yet, because I have not built recent Sage\u2026)",
    "created_at": "2019-07-16T06:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383396",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:49'></a>`@`isuruf: Could  you have a look at my latest changes? (That I did not test yet, because I have not built recent Sage…)



---

archive/issue_comments_383397.json:
```json
{
    "body": "<a id='comment:50'></a>Looks good to me. Thanks",
    "created_at": "2019-07-16T07:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383397",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:50'></a>Looks good to me. Thanks



---

archive/issue_comments_383398.json:
```json
{
    "body": "<a id='comment:51'></a>There is strange stuff about `lcalc` in the branch. May be some rebasing is needed?",
    "created_at": "2019-07-16T07:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383398",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:51'></a>There is strange stuff about `lcalc` in the branch. May be some rebasing is needed?



---

archive/issue_comments_383399.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-16T07:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383399",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383400.json:
```json
{
    "body": "<a id='comment:53'></a>Thanks fbissey. That should not have been here.",
    "created_at": "2019-07-16T07:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383400",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:53'></a>Thanks fbissey. That should not have been here.



---

archive/issue_comments_383401.json:
```json
{
    "body": "<a id='comment:54'></a>New commits:",
    "created_at": "2019-07-16T14:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383401",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:54'></a>New commits:



---

archive/issue_comments_383402.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-16T16:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_383403.json:
```json
{
    "body": "<a id='comment:56'></a>I think the patchbot is happy with it (the last run had a failure that should be unrelated). Anything to add or is it completely ready for review?",
    "created_at": "2019-07-16T21:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383403",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'></a>I think the patchbot is happy with it (the last run had a failure that should be unrelated). Anything to add or is it completely ready for review?



---

archive/issue_comments_383404.json:
```json
{
    "body": "<a id='comment:57'></a>> Anything to add or is it completely ready for review? \n\n\nNothing to add. Ready for review",
    "created_at": "2019-07-16T21:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383404",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:57'></a>> Anything to add or is it completely ready for review? 


Nothing to add. Ready for review



---

archive/issue_comments_383405.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-16T22:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383405",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_383406.json:
```json
{
    "body": "<a id='comment:58'></a>Looks good to me :)",
    "created_at": "2019-07-16T22:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383406",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:58'></a>Looks good to me :)



---

archive/issue_comments_383407.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-23T21:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25786#issuecomment-383407",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_064470.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-23T21:03:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25786",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25786#event-64470"
}
```
