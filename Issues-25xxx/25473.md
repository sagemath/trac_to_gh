# Issue 25473: 20 internet doctests failed in sage/finance/stock.py

archive/issues_025236.json:
```json
{
    "body": "As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),\n\n```\nsage -t --optional=sage,internet src/sage/finance/stock.py\n```\n\ngives\n\n```\nRunning doctests with ID 2018-05-30-22-48-41-52141b2a.\nUsing --optional=internet,sage\nDoctesting 1 file.\nsage -t --warn-long 82.6 src/sage/finance/stock.py\n**********************************************************************\nFile \"src/sage/finance/stock.py\", line 156, in sage.finance.stock.Stock.__init__\nFailed example:\n    S        # optional -- internet\nExpected:\n    IBM (...)\nGot:\n    <repr(<instance at 0x7f2fcce08680>) failed: URLError: <urlopen error [Errno -2] Name or service not known>>\n**********************************************************************\n...\n**********************************************************************\nFile \"src/sage/finance/stock.py\", line 626, in sage.finance.stock.Stock._get_data\nFailed example:\n    finance.Stock('whatever').history() # optional -- internet\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Google reported a wrong request (did you specify a cid?)\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.finance.stock.Stock._get_data[1]>\", line 1, in <module>\n        finance.Stock('whatever').history() # optional -- internet\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py\", line 385, in history\n        R = self._get_data('NASDAQ:', startdate, enddate, histperiod)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py\", line 637, in _get_data\n        data = urlopen(url).read()\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 154, in urlopen\n        return opener.open(url, data, timeout)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 435, in open\n        response = meth(req, response)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 548, in http_response\n        'http', request, response, code, msg, hdrs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 473, in error\n        return self._call_chain(*args)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 407, in _call_chain\n        result = func(*args)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 556, in http_error_default\n        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)\n    HTTPError: HTTP Error 403: Forbidden\n**********************************************************************\n8 items had failures:\n   1 of   3 in sage.finance.stock.Stock.__init__\n   1 of   2 in sage.finance.stock.Stock.__repr__\n   2 of   3 in sage.finance.stock.Stock._get_data\n   4 of   6 in sage.finance.stock.Stock.close\n   2 of   3 in sage.finance.stock.Stock.current_price_data\n   5 of   6 in sage.finance.stock.Stock.history\n   1 of   2 in sage.finance.stock.Stock.market_value\n   4 of   6 in sage.finance.stock.Stock.open\n    [43 tests, 20 failures, 10.21 s]\n----------------------------------------------------------------------\nsage -t --warn-long 82.6 src/sage/finance/stock.py  # 20 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 10.2 seconds\n    cpu time: 0.4 seconds\n    cumulative wall time: 10.2 seconds\n```\n\nFull log on [framabin](https://framabin.org/p/?cd13e7717c5eaa11#k2r/88vX7mrhCnDc+RTfXh115dLbqOJMzdgc0xo3ZfA=) against 8.5.beta0.\n\nThis ticket marks the tests as \"known bug\".\n\nRelated tickets:\n\n- #25425: finance.Stock -- obtaining stock prices from Google is completely broken now\n- #26754: Remove or replace calls to Yahoo! Finance in sage/finance/stock.py\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nBranch: 268d9be19b683a889726022100d15271659f9760\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25473\n\n",
    "closed_at": "2018-11-23T21:42:01Z",
    "created_at": "2018-05-30T20:50:56Z",
    "labels": [
        "component: finance",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "20 internet doctests failed in sage/finance/stock.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25473",
    "user": "https://github.com/seblabbe"
}
```
As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),

```
sage -t --optional=sage,internet src/sage/finance/stock.py
```

gives

```
Running doctests with ID 2018-05-30-22-48-41-52141b2a.
Using --optional=internet,sage
Doctesting 1 file.
sage -t --warn-long 82.6 src/sage/finance/stock.py
**********************************************************************
File "src/sage/finance/stock.py", line 156, in sage.finance.stock.Stock.__init__
Failed example:
    S        # optional -- internet
Expected:
    IBM (...)
Got:
    <repr(<instance at 0x7f2fcce08680>) failed: URLError: <urlopen error [Errno -2] Name or service not known>>
**********************************************************************
...
**********************************************************************
File "src/sage/finance/stock.py", line 626, in sage.finance.stock.Stock._get_data
Failed example:
    finance.Stock('whatever').history() # optional -- internet
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Google reported a wrong request (did you specify a cid?)
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.finance.stock.Stock._get_data[1]>", line 1, in <module>
        finance.Stock('whatever').history() # optional -- internet
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py", line 385, in history
        R = self._get_data('NASDAQ:', startdate, enddate, histperiod)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py", line 637, in _get_data
        data = urlopen(url).read()
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
        return opener.open(url, data, timeout)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 435, in open
        response = meth(req, response)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 548, in http_response
        'http', request, response, code, msg, hdrs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 473, in error
        return self._call_chain(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
        result = func(*args)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 556, in http_error_default
        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
    HTTPError: HTTP Error 403: Forbidden
**********************************************************************
8 items had failures:
   1 of   3 in sage.finance.stock.Stock.__init__
   1 of   2 in sage.finance.stock.Stock.__repr__
   2 of   3 in sage.finance.stock.Stock._get_data
   4 of   6 in sage.finance.stock.Stock.close
   2 of   3 in sage.finance.stock.Stock.current_price_data
   5 of   6 in sage.finance.stock.Stock.history
   1 of   2 in sage.finance.stock.Stock.market_value
   4 of   6 in sage.finance.stock.Stock.open
    [43 tests, 20 failures, 10.21 s]
----------------------------------------------------------------------
sage -t --warn-long 82.6 src/sage/finance/stock.py  # 20 doctests failed
----------------------------------------------------------------------
Total time for all tests: 10.2 seconds
    cpu time: 0.4 seconds
    cumulative wall time: 10.2 seconds
```

Full log on [framabin](https://framabin.org/p/?cd13e7717c5eaa11#k2r/88vX7mrhCnDc+RTfXh115dLbqOJMzdgc0xo3ZfA=) against 8.5.beta0.

This ticket marks the tests as "known bug".

Related tickets:

- #25425: finance.Stock -- obtaining stock prices from Google is completely broken now
- #26754: Remove or replace calls to Yahoo! Finance in sage/finance/stock.py

Reviewer: Frédéric Chapoton

Author: Sébastien Labbé

Branch: 268d9be19b683a889726022100d15271659f9760

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25473





---

archive/issue_comments_378373.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -8,7 +8,6 @@\n \n ```\n Running doctests with ID 2018-05-30-22-48-41-52141b2a.\n-Git branch: 25305\n Using --optional=internet,sage\n Doctesting 1 file.\n sage -t --warn-long 82.6 src/sage/finance/stock.py\n```\n",
    "created_at": "2018-05-30T21:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378373",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -8,7 +8,6 @@
 
 ```
 Running doctests with ID 2018-05-30-22-48-41-52141b2a.
-Git branch: 25305
 Using --optional=internet,sage
 Doctesting 1 file.
 sage -t --warn-long 82.6 src/sage/finance/stock.py
```




---

archive/issue_comments_378374.json:
```json
{
    "body": "<a id='comment:2'></a>Updated framabin link to include only failures related to `finance/stock.py` file",
    "created_at": "2018-10-22T12:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378374",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>Updated framabin link to include only failures related to `finance/stock.py` file



---

archive/issue_comments_378375.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,80 @@\n+As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),\n \n+```\n+sage -t --optional=sage,internet src/sage/finance/stock.py\n+```\n+\n+gives\n+\n+```\n+Running doctests with ID 2018-05-30-22-48-41-52141b2a.\n+Using --optional=internet,sage\n+Doctesting 1 file.\n+sage -t --warn-long 82.6 src/sage/finance/stock.py\n+**********************************************************************\n+File \"src/sage/finance/stock.py\", line 156, in sage.finance.stock.Stock.__init__\n+Failed example:\n+    S        # optional -- internet\n+Expected:\n+    IBM (...)\n+Got:\n+    <repr(<instance at 0x7f2fcce08680>) failed: URLError: <urlopen error [Errno -2] Name or service not known>>\n+**********************************************************************\n+...\n+**********************************************************************\n+File \"src/sage/finance/stock.py\", line 626, in sage.finance.stock.Stock._get_data\n+Failed example:\n+    finance.Stock('whatever').history() # optional -- internet\n+Expected:\n+    Traceback (most recent call last):\n+    ...\n+    RuntimeError: Google reported a wrong request (did you specify a cid?)\n+Got:\n+    <BLANKLINE>\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.finance.stock.Stock._get_data[1]>\", line 1, in <module>\n+        finance.Stock('whatever').history() # optional -- internet\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py\", line 385, in history\n+        R = self._get_data('NASDAQ:', startdate, enddate, histperiod)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py\", line 637, in _get_data\n+        data = urlopen(url).read()\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 154, in urlopen\n+        return opener.open(url, data, timeout)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 435, in open\n+        response = meth(req, response)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 548, in http_response\n+        'http', request, response, code, msg, hdrs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 473, in error\n+        return self._call_chain(*args)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 407, in _call_chain\n+        result = func(*args)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 556, in http_error_default\n+        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)\n+    HTTPError: HTTP Error 403: Forbidden\n+**********************************************************************\n+8 items had failures:\n+   1 of   3 in sage.finance.stock.Stock.__init__\n+   1 of   2 in sage.finance.stock.Stock.__repr__\n+   2 of   3 in sage.finance.stock.Stock._get_data\n+   4 of   6 in sage.finance.stock.Stock.close\n+   2 of   3 in sage.finance.stock.Stock.current_price_data\n+   5 of   6 in sage.finance.stock.Stock.history\n+   1 of   2 in sage.finance.stock.Stock.market_value\n+   4 of   6 in sage.finance.stock.Stock.open\n+    [43 tests, 20 failures, 10.21 s]\n+----------------------------------------------------------------------\n+sage -t --warn-long 82.6 src/sage/finance/stock.py  # 20 doctests failed\n+----------------------------------------------------------------------\n+Total time for all tests: 10.2 seconds\n+    cpu time: 0.4 seconds\n+    cumulative wall time: 10.2 seconds\n+```\n+\n+Full log on [framabin](https://framabin.org/p/?cd13e7717c5eaa11#k2r/88vX7mrhCnDc+RTfXh115dLbqOJMzdgc0xo3ZfA=) against 8.5.beta0.\n \n Comment: 1\n \n```\n",
    "created_at": "2018-10-22T12:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378375",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,80 @@
+As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),
 
+```
+sage -t --optional=sage,internet src/sage/finance/stock.py
+```
+
+gives
+
+```
+Running doctests with ID 2018-05-30-22-48-41-52141b2a.
+Using --optional=internet,sage
+Doctesting 1 file.
+sage -t --warn-long 82.6 src/sage/finance/stock.py
+**********************************************************************
+File "src/sage/finance/stock.py", line 156, in sage.finance.stock.Stock.__init__
+Failed example:
+    S        # optional -- internet
+Expected:
+    IBM (...)
+Got:
+    <repr(<instance at 0x7f2fcce08680>) failed: URLError: <urlopen error [Errno -2] Name or service not known>>
+**********************************************************************
+...
+**********************************************************************
+File "src/sage/finance/stock.py", line 626, in sage.finance.stock.Stock._get_data
+Failed example:
+    finance.Stock('whatever').history() # optional -- internet
+Expected:
+    Traceback (most recent call last):
+    ...
+    RuntimeError: Google reported a wrong request (did you specify a cid?)
+Got:
+    <BLANKLINE>
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.finance.stock.Stock._get_data[1]>", line 1, in <module>
+        finance.Stock('whatever').history() # optional -- internet
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py", line 385, in history
+        R = self._get_data('NASDAQ:', startdate, enddate, histperiod)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py", line 637, in _get_data
+        data = urlopen(url).read()
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
+        return opener.open(url, data, timeout)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 435, in open
+        response = meth(req, response)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 548, in http_response
+        'http', request, response, code, msg, hdrs)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 473, in error
+        return self._call_chain(*args)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
+        result = func(*args)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 556, in http_error_default
+        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
+    HTTPError: HTTP Error 403: Forbidden
+**********************************************************************
+8 items had failures:
+   1 of   3 in sage.finance.stock.Stock.__init__
+   1 of   2 in sage.finance.stock.Stock.__repr__
+   2 of   3 in sage.finance.stock.Stock._get_data
+   4 of   6 in sage.finance.stock.Stock.close
+   2 of   3 in sage.finance.stock.Stock.current_price_data
+   5 of   6 in sage.finance.stock.Stock.history
+   1 of   2 in sage.finance.stock.Stock.market_value
+   4 of   6 in sage.finance.stock.Stock.open
+    [43 tests, 20 failures, 10.21 s]
+----------------------------------------------------------------------
+sage -t --warn-long 82.6 src/sage/finance/stock.py  # 20 doctests failed
+----------------------------------------------------------------------
+Total time for all tests: 10.2 seconds
+    cpu time: 0.4 seconds
+    cumulative wall time: 10.2 seconds
+```
+
+Full log on [framabin](https://framabin.org/p/?cd13e7717c5eaa11#k2r/88vX7mrhCnDc+RTfXh115dLbqOJMzdgc0xo3ZfA=) against 8.5.beta0.
 
 Comment: 1
 
```




---

archive/issue_comments_378376.json:
```json
{
    "body": "<a id='comment:3'></a>It seems the \"Yahoo! Finance\" service which allowed to get csv files was disabled\nin May 2017. I don't see any replacement.",
    "created_at": "2018-10-26T18:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378376",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>It seems the "Yahoo! Finance" service which allowed to get csv files was disabled
in May 2017. I don't see any replacement.



---

archive/issue_comments_378377.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-22T18:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378377",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_378378.json:
```json
{
    "body": "<a id='comment:4'></a>The module `Stock` is completely broken. We could just delete it. For now, I suggest to add the `#known bug` tag to broken optional internet doctests.\n\nOther motivated people could eventually open another ticket to fix the code or deprecate/delete the code.\n\nMeanwhile, let's stop this file from creating noise when running doctests.\n\n---\nNew commits:",
    "created_at": "2018-11-22T18:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378378",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>The module `Stock` is completely broken. We could just delete it. For now, I suggest to add the `#known bug` tag to broken optional internet doctests.

Other motivated people could eventually open another ticket to fix the code or deprecate/delete the code.

Meanwhile, let's stop this file from creating noise when running doctests.

---
New commits:



---

archive/issue_comments_378379.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-22T20:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378379",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_378380.json:
```json
{
    "body": "<a id='comment:5'></a>ok. I would vote for the complete removal.",
    "created_at": "2018-11-22T20:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378380",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>ok. I would vote for the complete removal.



---

archive/issue_events_063907.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-11-23T12:23:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25473#event-63907"
}
```



---

archive/issue_comments_378381.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-23T21:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378381",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063908.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-23T21:42:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25473#event-63908"
}
```



---

archive/issue_comments_378382.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,87 @@\n+As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),\n \n+```\n+sage -t --optional=sage,internet src/sage/finance/stock.py\n+```\n+\n+gives\n+\n+```\n+Running doctests with ID 2018-05-30-22-48-41-52141b2a.\n+Using --optional=internet,sage\n+Doctesting 1 file.\n+sage -t --warn-long 82.6 src/sage/finance/stock.py\n+**********************************************************************\n+File \"src/sage/finance/stock.py\", line 156, in sage.finance.stock.Stock.__init__\n+Failed example:\n+    S        # optional -- internet\n+Expected:\n+    IBM (...)\n+Got:\n+    <repr(<instance at 0x7f2fcce08680>) failed: URLError: <urlopen error [Errno -2] Name or service not known>>\n+**********************************************************************\n+...\n+**********************************************************************\n+File \"src/sage/finance/stock.py\", line 626, in sage.finance.stock.Stock._get_data\n+Failed example:\n+    finance.Stock('whatever').history() # optional -- internet\n+Expected:\n+    Traceback (most recent call last):\n+    ...\n+    RuntimeError: Google reported a wrong request (did you specify a cid?)\n+Got:\n+    <BLANKLINE>\n+    Traceback (most recent call last):\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.finance.stock.Stock._get_data[1]>\", line 1, in <module>\n+        finance.Stock('whatever').history() # optional -- internet\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py\", line 385, in history\n+        R = self._get_data('NASDAQ:', startdate, enddate, histperiod)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py\", line 637, in _get_data\n+        data = urlopen(url).read()\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 154, in urlopen\n+        return opener.open(url, data, timeout)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 435, in open\n+        response = meth(req, response)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 548, in http_response\n+        'http', request, response, code, msg, hdrs)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 473, in error\n+        return self._call_chain(*args)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 407, in _call_chain\n+        result = func(*args)\n+      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py\", line 556, in http_error_default\n+        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)\n+    HTTPError: HTTP Error 403: Forbidden\n+**********************************************************************\n+8 items had failures:\n+   1 of   3 in sage.finance.stock.Stock.__init__\n+   1 of   2 in sage.finance.stock.Stock.__repr__\n+   2 of   3 in sage.finance.stock.Stock._get_data\n+   4 of   6 in sage.finance.stock.Stock.close\n+   2 of   3 in sage.finance.stock.Stock.current_price_data\n+   5 of   6 in sage.finance.stock.Stock.history\n+   1 of   2 in sage.finance.stock.Stock.market_value\n+   4 of   6 in sage.finance.stock.Stock.open\n+    [43 tests, 20 failures, 10.21 s]\n+----------------------------------------------------------------------\n+sage -t --warn-long 82.6 src/sage/finance/stock.py  # 20 doctests failed\n+----------------------------------------------------------------------\n+Total time for all tests: 10.2 seconds\n+    cpu time: 0.4 seconds\n+    cumulative wall time: 10.2 seconds\n+```\n+\n+Full log on [framabin](https://framabin.org/p/?cd13e7717c5eaa11#k2r/88vX7mrhCnDc+RTfXh115dLbqOJMzdgc0xo3ZfA=) against 8.5.beta0.\n+\n+This ticket marks the tests as \"known bug\".\n+\n+Related tickets:\n+\n+- #25425: finance.Stock -- obtaining stock prices from Google is completely broken now\n+- #26754: Remove or replace calls to Yahoo! Finance in sage/finance/stock.py\n \n Comment: 1\n \n```\n",
    "created_at": "2018-11-24T01:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25473#issuecomment-378382",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,87 @@
+As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),
 
+```
+sage -t --optional=sage,internet src/sage/finance/stock.py
+```
+
+gives
+
+```
+Running doctests with ID 2018-05-30-22-48-41-52141b2a.
+Using --optional=internet,sage
+Doctesting 1 file.
+sage -t --warn-long 82.6 src/sage/finance/stock.py
+**********************************************************************
+File "src/sage/finance/stock.py", line 156, in sage.finance.stock.Stock.__init__
+Failed example:
+    S        # optional -- internet
+Expected:
+    IBM (...)
+Got:
+    <repr(<instance at 0x7f2fcce08680>) failed: URLError: <urlopen error [Errno -2] Name or service not known>>
+**********************************************************************
+...
+**********************************************************************
+File "src/sage/finance/stock.py", line 626, in sage.finance.stock.Stock._get_data
+Failed example:
+    finance.Stock('whatever').history() # optional -- internet
+Expected:
+    Traceback (most recent call last):
+    ...
+    RuntimeError: Google reported a wrong request (did you specify a cid?)
+Got:
+    <BLANKLINE>
+    Traceback (most recent call last):
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.finance.stock.Stock._get_data[1]>", line 1, in <module>
+        finance.Stock('whatever').history() # optional -- internet
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py", line 385, in history
+        R = self._get_data('NASDAQ:', startdate, enddate, histperiod)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/finance/stock.py", line 637, in _get_data
+        data = urlopen(url).read()
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 154, in urlopen
+        return opener.open(url, data, timeout)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 435, in open
+        response = meth(req, response)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 548, in http_response
+        'http', request, response, code, msg, hdrs)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 473, in error
+        return self._call_chain(*args)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 407, in _call_chain
+        result = func(*args)
+      File "/home/slabbe/GitBox/sage/local/lib/python2.7/urllib2.py", line 556, in http_error_default
+        raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
+    HTTPError: HTTP Error 403: Forbidden
+**********************************************************************
+8 items had failures:
+   1 of   3 in sage.finance.stock.Stock.__init__
+   1 of   2 in sage.finance.stock.Stock.__repr__
+   2 of   3 in sage.finance.stock.Stock._get_data
+   4 of   6 in sage.finance.stock.Stock.close
+   2 of   3 in sage.finance.stock.Stock.current_price_data
+   5 of   6 in sage.finance.stock.Stock.history
+   1 of   2 in sage.finance.stock.Stock.market_value
+   4 of   6 in sage.finance.stock.Stock.open
+    [43 tests, 20 failures, 10.21 s]
+----------------------------------------------------------------------
+sage -t --warn-long 82.6 src/sage/finance/stock.py  # 20 doctests failed
+----------------------------------------------------------------------
+Total time for all tests: 10.2 seconds
+    cpu time: 0.4 seconds
+    cumulative wall time: 10.2 seconds
+```
+
+Full log on [framabin](https://framabin.org/p/?cd13e7717c5eaa11#k2r/88vX7mrhCnDc+RTfXh115dLbqOJMzdgc0xo3ZfA=) against 8.5.beta0.
+
+This ticket marks the tests as "known bug".
+
+Related tickets:
+
+- #25425: finance.Stock -- obtaining stock prices from Google is completely broken now
+- #26754: Remove or replace calls to Yahoo! Finance in sage/finance/stock.py
 
 Comment: 1
 
```

