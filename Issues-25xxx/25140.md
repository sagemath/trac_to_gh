# Issue 25140: Add spkg-legacy-uninstall scripts for most standard packages

archive/issues_024903.json:
```json
{
    "body": "This is a followup to #25139 and represents work that was originally done in #22510 to convert most packages to use `spkg-legacy-uninstall` and remove uninstall-related commands from their `spkg-install` scripts.\n\nThis work was brought over from an older branch and still needs some adjustment: It should incorporate the changes from the #24024 metaticket which conflict with some of these changes.  There are also some additional optional and experimental packages (and maybe a couple standard packages) that still need to be updated as well.\n\nProbably won't bother with that until and unless #25139 is approved of in some form that still includes the `spkg-legacy-uninstall` feature.\n\n---\n\nTo summarize what this is about: Part of the goal in implementing the new installation/uninstallation system for packages is that `spkg-install` should, ideally, not modify `$SAGE_LOCAL` in any way, at least for packages that support `DESTDIR`-based installation.  This allows more separation from the building of packages from their runtime installation target.\n\nHowever, many packages' `spkg-install` or `spkg-build` include commands (mostly in the form of `rm -rf`'s) to clean up files from previous installs of those packages.  This is no longer necessary for new-style package installations that track exactly what files are installed by a package.  But it is still necessary when upgrading from old installs of packages that don't have a file manifest.  This is what the `spkg-legacy-uninstall` script is for.  It's just taking the `rm -rf`'s from `spkg-install` and moving it into a separate script that is called by the uninstaller if it doesn't have a file manifest for that package.\n\nSo this ticket is just creating the `spkg-legacy-uninstall` for many packages that already have `DESTDIR` support.\n\nAssignee: @embray\n\nKeywords: uninstall\n\nReviewer: Julian R\u00fcth\n\nAuthor: Erik Bray\n\nBranch: u/embray/build/spkg-uninstall/legacy-uninstallers\n\nStatus: new\n\nCommit: e2d2b01f15e25c24334d8e6f110c3302d41cdd6f\n\nIssue created by migration from https://trac.sagemath.org/ticket/25140\n\n",
    "closed_at": "2018-08-11T16:55:31Z",
    "created_at": "2018-04-10T17:42:39Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-pending",
    "title": "Add spkg-legacy-uninstall scripts for most standard packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25140",
    "user": "https://github.com/embray"
}
```
This is a followup to #25139 and represents work that was originally done in #22510 to convert most packages to use `spkg-legacy-uninstall` and remove uninstall-related commands from their `spkg-install` scripts.

This work was brought over from an older branch and still needs some adjustment: It should incorporate the changes from the #24024 metaticket which conflict with some of these changes.  There are also some additional optional and experimental packages (and maybe a couple standard packages) that still need to be updated as well.

Probably won't bother with that until and unless #25139 is approved of in some form that still includes the `spkg-legacy-uninstall` feature.

---

To summarize what this is about: Part of the goal in implementing the new installation/uninstallation system for packages is that `spkg-install` should, ideally, not modify `$SAGE_LOCAL` in any way, at least for packages that support `DESTDIR`-based installation.  This allows more separation from the building of packages from their runtime installation target.

However, many packages' `spkg-install` or `spkg-build` include commands (mostly in the form of `rm -rf`'s) to clean up files from previous installs of those packages.  This is no longer necessary for new-style package installations that track exactly what files are installed by a package.  But it is still necessary when upgrading from old installs of packages that don't have a file manifest.  This is what the `spkg-legacy-uninstall` script is for.  It's just taking the `rm -rf`'s from `spkg-install` and moving it into a separate script that is called by the uninstaller if it doesn't have a file manifest for that package.

So this ticket is just creating the `spkg-legacy-uninstall` for many packages that already have `DESTDIR` support.

Assignee: @embray

Keywords: uninstall

Reviewer: Julian Rüth

Author: Erik Bray

Branch: u/embray/build/spkg-uninstall/legacy-uninstallers

Status: new

Commit: e2d2b01f15e25c24334d8e6f110c3302d41cdd6f

Issue created by migration from https://trac.sagemath.org/ticket/25140





---

archive/issue_comments_473284.json:
```json
{
    "body": "Changing keywords from \"\" to \"uninstall\".",
    "created_at": "2018-04-10T17:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473284",
    "user": "https://github.com/embray"
}
```

Changing keywords from "" to "uninstall".



---

archive/issue_events_079553.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79553"
}
```



---

archive/issue_comments_473285.json:
```json
{
    "body": "Changing dependencies from \"#25139\" to \"\"",
    "created_at": "2018-07-10T16:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473285",
    "user": "https://github.com/embray"
}
```

Changing dependencies from "#25139" to ""



---

archive/issue_comments_473286.json:
```json
{
    "body": "Changing commit from \"219150c1039eb86fabf39a10530cc869b6924580\" to \"58ad74e5c9f64de5b8780083273e5d6be8f2fcb2\"",
    "created_at": "2018-07-10T17:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "219150c1039eb86fabf39a10530cc869b6924580" to "58ad74e5c9f64de5b8780083273e5d6be8f2fcb2"



---

archive/issue_comments_473287.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|\n|[58ad74e](https://github.com/sagemath/sagetrac-mirror/commit/58ad74e5c9f64de5b8780083273e5d6be8f2fcb2)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|",
    "created_at": "2018-07-10T17:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
|[58ad74e](https://github.com/sagemath/sagetrac-mirror/commit/58ad74e5c9f64de5b8780083273e5d6be8f2fcb2)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|



---

archive/issue_comments_473288.json:
```json
{
    "body": "<a id='comment:5'></a>\nAs a reminder, the goal of this is to make it so that `spkg-install` scripts do not modify the contents of `$SAGE_LOCAL` directly.",
    "created_at": "2018-07-10T17:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473288",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
As a reminder, the goal of this is to make it so that `spkg-install` scripts do not modify the contents of `$SAGE_LOCAL` directly.



---

archive/issue_comments_473289.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-10T17:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473289",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_473290.json:
```json
{
    "body": "Changing commit from \"58ad74e5c9f64de5b8780083273e5d6be8f2fcb2\" to \"e6f189ed4c331456beda0ede5edf00329d90d7d8\"",
    "created_at": "2018-07-11T16:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "58ad74e5c9f64de5b8780083273e5d6be8f2fcb2" to "e6f189ed4c331456beda0ede5edf00329d90d7d8"



---

archive/issue_comments_473291.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[e6f189e](https://github.com/sagemath/sagetrac-mirror/commit/e6f189ed4c331456beda0ede5edf00329d90d7d8)|`add spkg-legacy-uninstall for a few more packages that I missed`|",
    "created_at": "2018-07-11T16:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473291",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[e6f189e](https://github.com/sagemath/sagetrac-mirror/commit/e6f189ed4c331456beda0ede5edf00329d90d7d8)|`add spkg-legacy-uninstall for a few more packages that I missed`|



---

archive/issue_comments_473292.json:
```json
{
    "body": "<a id='comment:7'></a>\nAdded `spkg-legacy-uninstall` for a few packages that could use it.\n\nThis is now done for at least most, if not all packages that have DESTDIR support from #24024.  It doesn't make sense to do for packages that haven't been converted to the new install/uninstall method yet.  However, for any remaining packages that need to be converted, they should also get an `spkg-legacy-uninstall` at the same time, where appropriate.",
    "created_at": "2018-07-11T16:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473292",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Added `spkg-legacy-uninstall` for a few packages that could use it.

This is now done for at least most, if not all packages that have DESTDIR support from #24024.  It doesn't make sense to do for packages that haven't been converted to the new install/uninstall method yet.  However, for any remaining packages that need to be converted, they should also get an `spkg-legacy-uninstall` at the same time, where appropriate.



---

archive/issue_comments_473293.json:
```json
{
    "body": "<a id='comment:8'></a>\nFeel free to set this to positive review if you are confident that this still works.",
    "created_at": "2018-07-17T15:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473293",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:8'></a>
Feel free to set this to positive review if you are confident that this still works.



---

archive/issue_comments_473294.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Julian R\u00fcth\"",
    "created_at": "2018-07-17T15:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473294",
    "user": "https://github.com/saraedum"
}
```

Changing reviewer from "" to "Julian Rüth"



---

archive/issue_comments_473295.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe pyflakes plugin found an actual bug in the elliptic_curves package; it wasn't otherwise caught since I didn't bump the package versions for this (it isn't really necessary to).\n\nI think I should fix that, and test doing a forced-reinstall of all these packages.  I know I did that a long time ago back when this was part of #22510, but that was then...",
    "created_at": "2018-07-17T16:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473295",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
The pyflakes plugin found an actual bug in the elliptic_curves package; it wasn't otherwise caught since I didn't bump the package versions for this (it isn't really necessary to).

I think I should fix that, and test doing a forced-reinstall of all these packages.  I know I did that a long time ago back when this was part of #22510, but that was then...



---

archive/issue_comments_473296.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-17T16:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473296",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_473297.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|\n|[b4e6851](https://github.com/sagemath/sagetrac-mirror/commit/b4e6851526a709c70726f903684f08c2fbbe1dcf)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|\n|[d45b4af](https://github.com/sagemath/sagetrac-mirror/commit/d45b4afa37e45cef68250a64d00661cff3a750be)|`add spkg-legacy-uninstall for a few more packages that I missed`|",
    "created_at": "2018-07-17T16:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
|[b4e6851](https://github.com/sagemath/sagetrac-mirror/commit/b4e6851526a709c70726f903684f08c2fbbe1dcf)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|
|[d45b4af](https://github.com/sagemath/sagetrac-mirror/commit/d45b4afa37e45cef68250a64d00661cff3a750be)|`add spkg-legacy-uninstall for a few more packages that I missed`|



---

archive/issue_comments_473298.json:
```json
{
    "body": "Changing commit from \"e6f189ed4c331456beda0ede5edf00329d90d7d8\" to \"d45b4afa37e45cef68250a64d00661cff3a750be\"",
    "created_at": "2018-07-17T16:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473298",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e6f189ed4c331456beda0ede5edf00329d90d7d8" to "d45b4afa37e45cef68250a64d00661cff3a750be"



---

archive/issue_events_079554.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79554"
}
```



---

archive/issue_events_079555.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79555"
}
```



---

archive/issue_comments_473299.json:
```json
{
    "body": "<a id='comment:11'></a>\nI believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473299",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_comments_473300.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,11 @@\n This work was brought over from an older branch and still needs some adjustment: It should incorporate the changes from the #24024 metaticket which conflict with some of these changes.  There are also some additional optional and experimental packages (and maybe a couple standard packages) that still need to be updated as well.\n \n Probably won't bother with that until and unless #25139 is approved of in some form that still includes the `spkg-legacy-uninstall` feature.\n+\n+---\n+\n+To summarize what this is about: Part of the goal in implementing the new installation/uninstallation system for packages is that `spkg-install` should, ideally, not modify `$SAGE_LOCAL` in any way, at least for packages that support `DESTDIR`-based installation.  This allows more separation from the building of packages from their runtime installation target.\n+\n+However, many packages' `spkg-install` or `spkg-build` include commands (mostly in the form of `rm -rf`'s) to clean up files from previous installs of those packages.  This is no longer necessary for new-style package installations that track exactly what files are installed by a package.  But it is still necessary when upgrading from old installs of packages that don't have a file manifest.  This is what the `spkg-legacy-uninstall` script is for.  It's just taking the `rm -rf`'s from `spkg-install` and moving it into a separate script that is called by the uninstaller if it doesn't have a file manifest for that package.\n+\n+So this ticket is just creating the `spkg-legacy-uninstall` for many packages that already have `DESTDIR` support.\n``````\n",
    "created_at": "2018-07-24T09:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473300",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,11 @@
 This work was brought over from an older branch and still needs some adjustment: It should incorporate the changes from the #24024 metaticket which conflict with some of these changes.  There are also some additional optional and experimental packages (and maybe a couple standard packages) that still need to be updated as well.
 
 Probably won't bother with that until and unless #25139 is approved of in some form that still includes the `spkg-legacy-uninstall` feature.
+
+---
+
+To summarize what this is about: Part of the goal in implementing the new installation/uninstallation system for packages is that `spkg-install` should, ideally, not modify `$SAGE_LOCAL` in any way, at least for packages that support `DESTDIR`-based installation.  This allows more separation from the building of packages from their runtime installation target.
+
+However, many packages' `spkg-install` or `spkg-build` include commands (mostly in the form of `rm -rf`'s) to clean up files from previous installs of those packages.  This is no longer necessary for new-style package installations that track exactly what files are installed by a package.  But it is still necessary when upgrading from old installs of packages that don't have a file manifest.  This is what the `spkg-legacy-uninstall` script is for.  It's just taking the `rm -rf`'s from `spkg-install` and moving it into a separate script that is called by the uninstaller if it doesn't have a file manifest for that package.
+
+So this ticket is just creating the `spkg-legacy-uninstall` for many packages that already have `DESTDIR` support.
``````




---

archive/issue_comments_473301.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-24T09:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473301",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_473302.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-07T12:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473302",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_473303.json:
```json
{
    "body": "<a id='comment:13'></a>\nFirst of all, there are merge conflicts.\n\nSecond, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).\n\nI'm not actively against this ticket, it's just that I don't see the point.",
    "created_at": "2018-08-07T12:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473303",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
First of all, there are merge conflicts.

Second, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).

I'm not actively against this ticket, it's just that I don't see the point.



---

archive/issue_comments_473304.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [jdemeyer](#comment%3A13):\n> First of all, there are merge conflicts.\n\n\nWell I mean, there weren't 2 weeks ago and that's obviously resolvable so it's not a big deal.\n\n> Second, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).\n> \n> I'm not actively against this ticket, it's just that I don't see the point.\n\n\nI'm not in any hurry on this and am also happy to do it gradually.  Though since it's already done I don't see the point in *not* just going ahead and merging this now either.  It would be more work at this point not to.",
    "created_at": "2018-08-08T13:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473304",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
Replying to [jdemeyer](#comment%3A13):
> First of all, there are merge conflicts.


Well I mean, there weren't 2 weeks ago and that's obviously resolvable so it's not a big deal.

> Second, do we really need this? I understand that you want to clean up the `spkg-install` scripts, but we can do that gradually as we upgrade packages anyway. I don't really see the point of adding a whole new feature only for backwards compatibility in cases where it almost never matters (typically, it's not a problem to skip the uninstall).
> 
> I'm not actively against this ticket, it's just that I don't see the point.


I'm not in any hurry on this and am also happy to do it gradually.  Though since it's already done I don't see the point in *not* just going ahead and merging this now either.  It would be more work at this point not to.



---

archive/issue_comments_473305.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|\n|[801a2c3](https://github.com/sagemath/sagetrac-mirror/commit/801a2c3b1bad4a57ab5806e00cc1fa5a3cc03d56)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|\n|[bafe689](https://github.com/sagemath/sagetrac-mirror/commit/bafe689b2ded2440c12fcaba9c5928700d514114)|`add spkg-legacy-uninstall for a few more packages that I missed`|",
    "created_at": "2018-08-08T13:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
|[801a2c3](https://github.com/sagemath/sagetrac-mirror/commit/801a2c3b1bad4a57ab5806e00cc1fa5a3cc03d56)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|
|[bafe689](https://github.com/sagemath/sagetrac-mirror/commit/bafe689b2ded2440c12fcaba9c5928700d514114)|`add spkg-legacy-uninstall for a few more packages that I missed`|



---

archive/issue_comments_473306.json:
```json
{
    "body": "Changing commit from \"d45b4afa37e45cef68250a64d00661cff3a750be\" to \"bafe689b2ded2440c12fcaba9c5928700d514114\"",
    "created_at": "2018-08-08T13:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d45b4afa37e45cef68250a64d00661cff3a750be" to "bafe689b2ded2440c12fcaba9c5928700d514114"



---

archive/issue_comments_473307.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-08T13:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473307",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_473308.json:
```json
{
    "body": "<a id='comment:17'></a>\nLooks good to me.",
    "created_at": "2018-08-09T00:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473308",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:17'></a>
Looks good to me.



---

archive/issue_comments_473309.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-09T00:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473309",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_079556.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-11T16:55:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79556"
}
```



---

archive/issue_comments_473310.json:
```json
{
    "body": "Changing branch from \"u/embray/build/spkg-uninstall/legacy-uninstallers\" to \"bafe689b2ded2440c12fcaba9c5928700d514114\"",
    "created_at": "2018-08-11T16:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473310",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/build/spkg-uninstall/legacy-uninstallers" to "bafe689b2ded2440c12fcaba9c5928700d514114"



---

archive/issue_comments_473311.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-11T16:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473311",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_473312.json:
```json
{
    "body": "Changing commit from \"bafe689b2ded2440c12fcaba9c5928700d514114\" to \"\"",
    "created_at": "2018-08-12T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473312",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "bafe689b2ded2440c12fcaba9c5928700d514114" to ""



---

archive/issue_comments_473313.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2018-08-12T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473313",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_079557.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-12T09:05:45Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79557"
}
```



---

archive/issue_comments_473314.json:
```json
{
    "body": "<a id='comment:19'></a>\nWhen reinstalling an already installed elliptic_curves:\n\n```\n$ ./sage -p elliptic_curves\n[...]\nNo record that 'elliptic_curves' was ever installed; skipping uninstall\nCreating database /mnt/disk/home/release/Sage/local/share/cremona/cremona_mini.db\nTraceback (most recent call last):\n  File \"spkg-install.py\", line 89, in <module>\n    install_cremona()\n  File \"spkg-install.py\", line 31, in install_cremona\n    con.execute('CREATE TABLE t_class(rank INTEGER, class TEXT PRIMARY KEY,'\nsqlite3.OperationalError: table t_class already exists\n\nreal\t0m0.161s\nuser\t0m0.053s\nsys\t0m0.028s\n************************************************************************\nError installing package elliptic_curves-0.8.p0\n************************************************************************\n```\nThis breaks incremental rebuilds...",
    "created_at": "2018-08-12T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473314",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
When reinstalling an already installed elliptic_curves:

```
$ ./sage -p elliptic_curves
[...]
No record that 'elliptic_curves' was ever installed; skipping uninstall
Creating database /mnt/disk/home/release/Sage/local/share/cremona/cremona_mini.db
Traceback (most recent call last):
  File "spkg-install.py", line 89, in <module>
    install_cremona()
  File "spkg-install.py", line 31, in install_cremona
    con.execute('CREATE TABLE t_class(rank INTEGER, class TEXT PRIMARY KEY,'
sqlite3.OperationalError: table t_class already exists

real	0m0.161s
user	0m0.053s
sys	0m0.028s
************************************************************************
Error installing package elliptic_curves-0.8.p0
************************************************************************
```
This breaks incremental rebuilds...



---

archive/issue_comments_473315.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2018-08-12T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473315",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_473316.json:
```json
{
    "body": "<a id='comment:20'></a>\nPlease check that all packages can be installed twice before settings back to positive review.",
    "created_at": "2018-08-12T09:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473316",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>
Please check that all packages can be installed twice before settings back to positive review.



---

archive/issue_comments_473317.json:
```json
{
    "body": "<a id='comment:21'></a>\nNew commits:\n|                                                                                                                                          |                                                                                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|\n|[801a2c3](https://github.com/sagemath/sagetrac-mirror/commit/801a2c3b1bad4a57ab5806e00cc1fa5a3cc03d56)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|\n|[bafe689](https://github.com/sagemath/sagetrac-mirror/commit/bafe689b2ded2440c12fcaba9c5928700d514114)|`add spkg-legacy-uninstall for a few more packages that I missed`|",
    "created_at": "2018-08-14T15:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473317",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
New commits:
|                                                                                                                                          |                                                                                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
|[801a2c3](https://github.com/sagemath/sagetrac-mirror/commit/801a2c3b1bad4a57ab5806e00cc1fa5a3cc03d56)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|
|[bafe689](https://github.com/sagemath/sagetrac-mirror/commit/bafe689b2ded2440c12fcaba9c5928700d514114)|`add spkg-legacy-uninstall for a few more packages that I missed`|



---

archive/issue_comments_473318.json:
```json
{
    "body": "Changing branch from \"bafe689b2ded2440c12fcaba9c5928700d514114\" to \"u/embray/build/spkg-uninstall/legacy-uninstallers\"",
    "created_at": "2018-08-14T15:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473318",
    "user": "https://github.com/embray"
}
```

Changing branch from "bafe689b2ded2440c12fcaba9c5928700d514114" to "u/embray/build/spkg-uninstall/legacy-uninstallers"



---

archive/issue_comments_473319.json:
```json
{
    "body": "Changing commit from \"\" to \"bafe689b2ded2440c12fcaba9c5928700d514114\"",
    "created_at": "2018-08-14T15:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473319",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "bafe689b2ded2440c12fcaba9c5928700d514114"



---

archive/issue_comments_473320.json:
```json
{
    "body": "Changing commit from \"bafe689b2ded2440c12fcaba9c5928700d514114\" to \"6f82064665b2996cac072fce0152531da1271735\"",
    "created_at": "2018-08-14T16:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bafe689b2ded2440c12fcaba9c5928700d514114" to "6f82064665b2996cac072fce0152531da1271735"



---

archive/issue_comments_473321.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[6f82064](https://github.com/sagemath/sagetrac-mirror/commit/6f82064665b2996cac072fce0152531da1271735)|`revert changes to elliptic_curves; it will be handled in a separate ticket`|",
    "created_at": "2018-08-14T16:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[6f82064](https://github.com/sagemath/sagetrac-mirror/commit/6f82064665b2996cac072fce0152531da1271735)|`revert changes to elliptic_curves; it will be handled in a separate ticket`|



---

archive/issue_comments_473322.json:
```json
{
    "body": "<a id='comment:23'></a>\nYes, there were still several problems with the spkg-install for elliptic_curves; I think it should just be updated in a separate ticket.  It should not have been included in this ticket in the first place since it was only intending to update packages that already had working DESTDIR support.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[6f82064](https://github.com/sagemath/sagetrac-mirror/commit/6f82064665b2996cac072fce0152531da1271735)|`revert changes to elliptic_curves; it will be handled in a separate ticket`|",
    "created_at": "2018-08-14T16:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473322",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
Yes, there were still several problems with the spkg-install for elliptic_curves; I think it should just be updated in a separate ticket.  It should not have been included in this ticket in the first place since it was only intending to update packages that already had working DESTDIR support.

---
New commits:
|                                                                                                                                          |                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[6f82064](https://github.com/sagemath/sagetrac-mirror/commit/6f82064665b2996cac072fce0152531da1271735)|`revert changes to elliptic_curves; it will be handled in a separate ticket`|



---

archive/issue_events_079558.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T11:41:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79558"
}
```



---

archive/issue_events_079559.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T11:41:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79559"
}
```



---

archive/issue_comments_473323.json:
```json
{
    "body": "<a id='comment:25'></a>\nRetargeting some of my tickets (somewhat optimistically for now).",
    "created_at": "2018-12-28T14:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473323",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>
Retargeting some of my tickets (somewhat optimistically for now).



---

archive/issue_events_079560.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:10:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79560"
}
```



---

archive/issue_events_079561.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:10:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79561"
}
```



---

archive/issue_comments_473324.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|\n|[e2d2b01](https://github.com/sagemath/sagetrac-mirror/commit/e2d2b01f15e25c24334d8e6f110c3302d41cdd6f)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|",
    "created_at": "2019-01-09T17:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473324",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|
|[e2d2b01](https://github.com/sagemath/sagetrac-mirror/commit/e2d2b01f15e25c24334d8e6f110c3302d41cdd6f)|`Fix spkg-installs of packages with legacy uninstall commands; moving those commands into spkg-legacy-uninstall scripts`|



---

archive/issue_comments_473325.json:
```json
{
    "body": "Changing commit from \"6f82064665b2996cac072fce0152531da1271735\" to \"e2d2b01f15e25c24334d8e6f110c3302d41cdd6f\"",
    "created_at": "2019-01-09T17:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473325",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6f82064665b2996cac072fce0152531da1271735" to "e2d2b01f15e25c24334d8e6f110c3302d41cdd6f"



---

archive/issue_comments_473326.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2019-01-09T17:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473326",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_473327.json:
```json
{
    "body": "<a id='comment:27'></a>\nRebased this, though some of these are now handled in other tickets so I need to clean it up a bit more (focus only on packages that already otherwise have been fixed as part of #24024).",
    "created_at": "2019-01-09T17:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473327",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
Rebased this, though some of these are now handled in other tickets so I need to clean it up a bit more (focus only on packages that already otherwise have been fixed as part of #24024).



---

archive/issue_comments_473328.json:
```json
{
    "body": "<a id='comment:28'></a>\nRemoving most of the rest of my open tickets out of the 8.7 milestone, which should be closed.",
    "created_at": "2019-03-25T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25140#issuecomment-473328",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.



---

archive/issue_events_079562.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:44:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79562"
}
```



---

archive/issue_events_079563.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:44:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25140",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25140#event-79563"
}
```
