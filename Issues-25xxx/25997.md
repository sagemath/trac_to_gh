# Issue 25997: Fix bug in matrix space with prescribed implementation

archive/issues_025760.json:
```json
{
    "assignees": [],
    "body": "Currently, with SharedMeatAxe being installed, I get\n\n```\nsage: MS = MatrixSpace(GF(3),5, implementation='meataxe')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-3-d39fb0c2de0f> in <module>()\n----> 1 MS = MatrixSpace(GF(Integer(3)),Integer(5), implementation='meataxe')\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1639)()\n    327         \"\"\"\n    328         if cls.classcall is not None:\n--> 329             return cls.classcall(cls, *args, **kwds)\n    330         else:\n    331             # Fast version of type.__call__(cls, *args, **kwds)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation)\n    478             raise OverflowError(\"number of rows and columns may be at most %s\" % sys.maxsize)\n    479 \n--> 480         matrix_cls = get_matrix_class(base_ring, nrows, ncols, sparse, implementation)\n    481         return super(MatrixSpace, cls).__classcall__(\n    482                 cls, base_ring, nrows, ncols, sparse, matrix_cls)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in get_matrix_class(R, nrows, ncols, sparse, implementation)\n    306         # generic fallback\n    307         if implementation != 'generic' and implementation is not None:\n--> 308             raise ValueError(\"unknown matrix implementation %r over %r\" % (implementation, R))\n    309         else:\n    310             return matrix_generic_dense.Matrix_generic_dense\n\nValueError: unknown matrix implementation 'meataxe' over Finite Field of size 3\n```\n\nI am unsure what component to choose. The bug isn't really about the optional package itself.\n\nCC:  @videlec @jdemeyer @tscrim\n\nKeywords: **meataxe matrix space**\n\nBranch/Commit: **[`7741f08`](https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Simon King**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25997_\n\n",
    "closed_at": "2020-02-25T19:51:14Z",
    "created_at": "2018-08-04T10:17:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix bug in matrix space with prescribed implementation",
    "type": "issue",
    "updated_at": "2020-02-25T19:51:14Z",
    "url": "https://github.com/sagemath/sage/issues/25997",
    "user": "https://github.com/simon-king-jena"
}
```
Currently, with SharedMeatAxe being installed, I get

```
sage: MS = MatrixSpace(GF(3),5, implementation='meataxe')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-3-d39fb0c2de0f> in <module>()
----> 1 MS = MatrixSpace(GF(Integer(3)),Integer(5), implementation='meataxe')

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1639)()
    327         """
    328         if cls.classcall is not None:
--> 329             return cls.classcall(cls, *args, **kwds)
    330         else:
    331             # Fast version of type.__call__(cls, *args, **kwds)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation)
    478             raise OverflowError("number of rows and columns may be at most %s" % sys.maxsize)
    479 
--> 480         matrix_cls = get_matrix_class(base_ring, nrows, ncols, sparse, implementation)
    481         return super(MatrixSpace, cls).__classcall__(
    482                 cls, base_ring, nrows, ncols, sparse, matrix_cls)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in get_matrix_class(R, nrows, ncols, sparse, implementation)
    306         # generic fallback
    307         if implementation != 'generic' and implementation is not None:
--> 308             raise ValueError("unknown matrix implementation %r over %r" % (implementation, R))
    309         else:
    310             return matrix_generic_dense.Matrix_generic_dense

ValueError: unknown matrix implementation 'meataxe' over Finite Field of size 3
```

I am unsure what component to choose. The bug isn't really about the optional package itself.

CC:  @videlec @jdemeyer @tscrim

Keywords: **meataxe matrix space**

Branch/Commit: **[`7741f08`](https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9)**

Reviewer: **Vincent Delecroix**

Author: **Simon King**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/25997_





---

archive/issue_events_359144.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-08-04T10:17:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359144"
}
```



---

archive/issue_events_359145.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-08-04T10:17:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359145"
}
```



---

archive/issue_events_359146.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-08-04T10:17:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359146"
}
```



---

archive/issue_events_359147.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-08-04T10:17:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359147"
}
```



---

archive/issue_comments_400486.json:
```json
{
    "body": "Changed keywords from none to **meataxe matrix space**",
    "created_at": "2018-08-04T10:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400486",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from none to **meataxe matrix space**



---

archive/issue_comments_400487.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n\n```\nsage: from sage.matrix.matrix_space import get_matrix_class\nsage: get_matrix_class(GF(3),4,4,False, 'meataxe')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-2-9827f9b2c640> in <module>()\n----> 1 get_matrix_class(GF(Integer(3)),Integer(4),Integer(4),False, 'meataxe')\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in get_matrix_class(R, nrows, ncols, sparse, implementation)\n    306         # generic fallback\n    307         if implementation != 'generic' and implementation is not None:\n--> 308             raise ValueError(\"unknown matrix implementation %r over %r\" % (implementation, R))\n    309         else:\n    310             return matrix_generic_dense.Matrix_generic_dense\n\nValueError: unknown matrix implementation 'meataxe' over Finite Field of size 3\n```\n\nOddly enough, it turns out that `get_matrix_class` doesn't even get as far as testing whether the base ring is a finite field.",
    "created_at": "2018-08-04T10:26:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400487",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>


```
sage: from sage.matrix.matrix_space import get_matrix_class
sage: get_matrix_class(GF(3),4,4,False, 'meataxe')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-2-9827f9b2c640> in <module>()
----> 1 get_matrix_class(GF(Integer(3)),Integer(4),Integer(4),False, 'meataxe')

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_space.pyc in get_matrix_class(R, nrows, ncols, sparse, implementation)
    306         # generic fallback
    307         if implementation != 'generic' and implementation is not None:
--> 308             raise ValueError("unknown matrix implementation %r over %r" % (implementation, R))
    309         else:
    310             return matrix_generic_dense.Matrix_generic_dense

ValueError: unknown matrix implementation 'meataxe' over Finite Field of size 3
```

Oddly enough, it turns out that `get_matrix_class` doesn't even get as far as testing whether the base ring is a finite field.



---

archive/issue_comments_400488.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nGosh, the bug is in the test for an integer mod ring:\n\n```\nsage: sage.rings.finite_rings.integer_mod_ring.is_IntegerModRing(GF(3))\nTrue\n```\n\nSo, apparently its implementation has changed. I am not gonna argue about `is_IntegerModRing`, because mathematically `GF(3)` IS an integer mod ring. but then to the very least `get_matrix_class` should first test for finite fields and only later for integer mod rings.",
    "created_at": "2018-08-04T10:30:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400488",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

Gosh, the bug is in the test for an integer mod ring:

```
sage: sage.rings.finite_rings.integer_mod_ring.is_IntegerModRing(GF(3))
True
```

So, apparently its implementation has changed. I am not gonna argue about `is_IntegerModRing`, because mathematically `GF(3)` IS an integer mod ring. but then to the very least `get_matrix_class` should first test for finite fields and only later for integer mod rings.



---

archive/issue_comments_400489.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nA finite prime field is at the same time an integer mod ring. So, if the implementation \"meataxe\" is requested for a matrix over a finite prime field, this case should be dealt with in the \"if\" clause testing for an integer mod ring. With that fix, at least the tests in src/sage/matrix pass. So, I'll push the branch in a minute...",
    "created_at": "2018-08-04T10:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400489",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">comment:4</div>

A finite prime field is at the same time an integer mod ring. So, if the implementation "meataxe" is requested for a matrix over a finite prime field, this case should be dealt with in the "if" clause testing for an integer mod ring. With that fix, at least the tests in src/sage/matrix pass. So, I'll push the branch in a minute...



---

archive/issue_comments_400490.json:
```json
{
    "body": "Branch: **[u/SimonKing/matrix_space_meataxe](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/matrix_space_meataxe)**",
    "created_at": "2018-08-04T10:53:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400490",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/matrix_space_meataxe](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/matrix_space_meataxe)**



---

archive/issue_comments_400491.json:
```json
{
    "body": "Commit: **[`9c67d1a`](https://github.com/sagemath/sagetrac-mirror/commit/9c67d1a9bc7639ad292739d9beb3813dd14aa117)**",
    "created_at": "2018-08-04T10:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400491",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[`9c67d1a`](https://github.com/sagemath/sagetrac-mirror/commit/9c67d1a9bc7639ad292739d9beb3813dd14aa117)**



---

archive/issue_events_359148.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-08-04T10:56:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359148"
}
```



---

archive/issue_comments_400492.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2018-08-04T10:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400492",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_400493.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c67d1a9bc7639ad292739d9beb3813dd14aa117\">9c67d1a</a></td><td><code>Fix: Allow to choose meataxe as backend for matrices over a finite prime field</code></td></tr></table>\n",
    "created_at": "2018-08-04T10:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400493",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c67d1a9bc7639ad292739d9beb3813dd14aa117">9c67d1a</a></td><td><code>Fix: Allow to choose meataxe as backend for matrices over a finite prime field</code></td></tr></table>




---

archive/issue_comments_400494.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI don't really like the logic of the code and the code duplication. That being said, this isn't your fault and maybe it would be too much to ask to refactor the code just to fix this bug.",
    "created_at": "2018-08-04T11:07:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400494",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

I don't really like the logic of the code and the code duplication. That being said, this isn't your fault and maybe it would be too much to ask to refactor the code just to fix this bug.



---

archive/issue_comments_400495.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jdemeyer](#comment:7):\n> I don't really like the logic of the code and the code duplication. That being said, this isn't your fault and maybe it would be too much to ask to refactor the code just to fix this bug.\n\nI'll try to see if I can simplify it a bit.",
    "created_at": "2018-08-04T11:16:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400495",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jdemeyer](#comment:7):
> I don't really like the logic of the code and the code duplication. That being said, this isn't your fault and maybe it would be too much to ask to refactor the code just to fix this bug.

I'll try to see if I can simplify it a bit.



---

archive/issue_comments_400496.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI guess the logic should be:\n1. Is a specific implementation requested? If this is the case, test whether this specific implementation supports the given base ring.\n2. Otherwise, choose a default implementation according to whether R is finite, a field, a quotient ring, etc.\n\nCurrently, these two tasks are intertwined. First, some properties of the ring are checked and only then it is considered whether an implementation is requested.",
    "created_at": "2018-08-04T11:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400496",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

I guess the logic should be:
1. Is a specific implementation requested? If this is the case, test whether this specific implementation supports the given base ring.
2. Otherwise, choose a default implementation according to whether R is finite, a field, a quotient ring, etc.

Currently, these two tasks are intertwined. First, some properties of the ring are checked and only then it is considered whether an implementation is requested.



---

archive/issue_comments_400497.json:
```json
{
    "body": "Changed commit from **[`9c67d1a`](https://github.com/sagemath/sagetrac-mirror/commit/9c67d1a9bc7639ad292739d9beb3813dd14aa117)** to **[`427ca06`](https://github.com/sagemath/sagetrac-mirror/commit/427ca0673c084319feffc85ed7eb6c60c6107dba)**",
    "created_at": "2018-08-04T13:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400497",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9c67d1a`](https://github.com/sagemath/sagetrac-mirror/commit/9c67d1a9bc7639ad292739d9beb3813dd14aa117)** to **[`427ca06`](https://github.com/sagemath/sagetrac-mirror/commit/427ca0673c084319feffc85ed7eb6c60c6107dba)**



---

archive/issue_comments_400498.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/427ca0673c084319feffc85ed7eb6c60c6107dba\">427ca06</a></td><td><code>Untangle the logic of choosing a matrix implementation</code></td></tr></table>\n",
    "created_at": "2018-08-04T13:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400498",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/427ca0673c084319feffc85ed7eb6c60c6107dba">427ca06</a></td><td><code>Untangle the logic of choosing a matrix implementation</code></td></tr></table>




---

archive/issue_comments_400499.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI think the new commit provides a cleaner way of choosing the implementation for a matrix. The tests in src/sage/matrix pass (with optional meataxe), but I didn't run the full test suite yet.\n\nStill needs review, of course.",
    "created_at": "2018-08-04T13:47:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400499",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">comment:11</div>

I think the new commit provides a cleaner way of choosing the implementation for a matrix. The tests in src/sage/matrix pass (with optional meataxe), but I didn't run the full test suite yet.

Still needs review, of course.



---

archive/issue_comments_400500.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nJust two quick minor comments:\n\nI believe there is a very mild behavior change when passing `implementation=''` (or `0` or `[]`, etc.) as now that will be treated the same as `implementation=None`.\n\nI don't think you need the nested `if` inside of the `CDF` case (as you already have `not implementation` being `True`).",
    "created_at": "2018-08-04T22:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400500",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Just two quick minor comments:

I believe there is a very mild behavior change when passing `implementation=''` (or `0` or `[]`, etc.) as now that will be treated the same as `implementation=None`.

I don't think you need the nested `if` inside of the `CDF` case (as you already have `not implementation` being `True`).



---

archive/issue_comments_400501.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@tscrim](#comment:13):\n> Just two quick minor comments:\n> \n> I believe there is a very mild behavior change when passing `implementation=''` (or `0` or `[]`, etc.) as now that will be treated the same as `implementation=None`.\n> \n> I don't think you need the nested `if` inside of the `CDF` case (as you already have `not implementation` being `True`).\n\nI just notice that I forgot to react.\n\nDo you recall what \"mild behaviour change\" you see?",
    "created_at": "2019-07-21T07:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400501",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@tscrim](#comment:13):
> Just two quick minor comments:
> 
> I believe there is a very mild behavior change when passing `implementation=''` (or `0` or `[]`, etc.) as now that will be treated the same as `implementation=None`.
> 
> I don't think you need the nested `if` inside of the `CDF` case (as you already have `not implementation` being `True`).

I just notice that I forgot to react.

Do you recall what "mild behaviour change" you see?



---

archive/issue_comments_400502.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@simon-king-jena](#comment:14):\n> Replying to [@tscrim](#comment:13):\n> > Just two quick minor comments:\n> > \n> > I believe there is a very mild behavior change when passing `implementation=''` (or `0` or `[]`, etc.) as now that will be treated the same as `implementation=None`.\n\n>\n> Do you recall what \"mild behaviour change\" you see?\n\nBefore this would result in an error, but with you change, it now should get treated as if you passed `None`. It is not a bad thing IMO, but just something I noticed and am pointing out.",
    "created_at": "2019-07-21T07:19:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400502",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@simon-king-jena](#comment:14):
> Replying to [@tscrim](#comment:13):
> > Just two quick minor comments:
> > 
> > I believe there is a very mild behavior change when passing `implementation=''` (or `0` or `[]`, etc.) as now that will be treated the same as `implementation=None`.

>
> Do you recall what "mild behaviour change" you see?

Before this would result in an error, but with you change, it now should get treated as if you passed `None`. It is not a bad thing IMO, but just something I noticed and am pointing out.



---

archive/issue_events_359149.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-07-21T15:38:46Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359149"
}
```



---

archive/issue_events_359150.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-07-21T15:38:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359150"
}
```



---

archive/issue_events_359151.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359151"
}
```



---

archive/issue_events_359152.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359152"
}
```



---

archive/issue_comments_400503.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400503",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Ticket retargeted after milestone closed



---

archive/issue_events_359153.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-02-22T15:45:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359153"
}
```



---

archive/issue_events_359154.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-02-22T15:45:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359154"
}
```



---

archive/issue_comments_400504.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI also think that `if implementation is None` should be prefered to `if not implementation`.",
    "created_at": "2020-02-22T15:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400504",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

I also think that `if implementation is None` should be prefered to `if not implementation`.



---

archive/issue_comments_400505.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nCould you put appropriate spacings as any other example in the file?\n\n```\nsage: get_matrix_class(GF(25,'x'),4,4,False, 'meataxe')\n```\nshould be\n\n```\nsage: get_matrix_class(GF(25, 'x'), 4, 4, False, 'meataxe')\n```",
    "created_at": "2020-02-22T15:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400505",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

Could you put appropriate spacings as any other example in the file?

```
sage: get_matrix_class(GF(25,'x'),4,4,False, 'meataxe')
```
should be

```
sage: get_matrix_class(GF(25, 'x'), 4, 4, False, 'meataxe')
```



---

archive/issue_comments_400506.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWhy am I getting errors when checking out the ticket branch?\n\n```\nremote branch: u/SimonKing/matrix_space_meataxe\n\nFrom git://trac.sagemath.org/sage\n * branch                  u/SimonKing/matrix_space_meataxe -> FETCH_HEAD\n\nTraceback (most recent call last):\n  File \"/home/king/.local/bin/git-trac\", line 18, in <module>\n    cmdline.launch()\n  File \"/home/king/Sage/git/git-trac-command/git_trac/cmdline.py\", line 224, in launch\n    app.pull(args.ticket_or_branch)\n  File \"/home/king/Sage/git/git-trac-command/git_trac/app.py\", line 93, in pull\n    self.repo.pull(remote)\n  File \"/home/king/Sage/git/git-trac-command/git_trac/git_repository.py\", line 190, in pull\n    self.git.echo.merge('FETCH_HEAD')\n  File \"/home/king/Sage/git/git-trac-command/git_trac/git_interface.py\", line 341, in meth\n    return self.execute(git_cmd, *args, **kwds)\n  File \"/home/king/Sage/git/git-trac-command/git_trac/git_interface.py\", line 98, in execute\n    popen_stderr=subprocess.PIPE)\n  File \"/home/king/Sage/git/git-trac-command/git_trac/git_interface.py\", line 263, in _run\n    raise GitError(result)\ngit_trac.git_error.GitError: git returned with non-zero exit code (1) when executing \"git merge FETCH_HEAD\"\n    STDOUT: Auto-merging src/sage/matrix/matrix_space.py\n    STDOUT: CONFLICT (content): Merge conflict in src/sage/matrix/matrix_space.py\n    STDOUT: Automatic merge failed; fix conflicts and then commit the result.\n    STDERR: Recorded preimage for 'src/sage/matrix/matrix_space.py'\n```\nI guess I will delete my local branch and try again.",
    "created_at": "2020-02-22T16:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400506",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">comment:20</div>

Why am I getting errors when checking out the ticket branch?

```
remote branch: u/SimonKing/matrix_space_meataxe

From git://trac.sagemath.org/sage
 * branch                  u/SimonKing/matrix_space_meataxe -> FETCH_HEAD

Traceback (most recent call last):
  File "/home/king/.local/bin/git-trac", line 18, in <module>
    cmdline.launch()
  File "/home/king/Sage/git/git-trac-command/git_trac/cmdline.py", line 224, in launch
    app.pull(args.ticket_or_branch)
  File "/home/king/Sage/git/git-trac-command/git_trac/app.py", line 93, in pull
    self.repo.pull(remote)
  File "/home/king/Sage/git/git-trac-command/git_trac/git_repository.py", line 190, in pull
    self.git.echo.merge('FETCH_HEAD')
  File "/home/king/Sage/git/git-trac-command/git_trac/git_interface.py", line 341, in meth
    return self.execute(git_cmd, *args, **kwds)
  File "/home/king/Sage/git/git-trac-command/git_trac/git_interface.py", line 98, in execute
    popen_stderr=subprocess.PIPE)
  File "/home/king/Sage/git/git-trac-command/git_trac/git_interface.py", line 263, in _run
    raise GitError(result)
git_trac.git_error.GitError: git returned with non-zero exit code (1) when executing "git merge FETCH_HEAD"
    STDOUT: Auto-merging src/sage/matrix/matrix_space.py
    STDOUT: CONFLICT (content): Merge conflict in src/sage/matrix/matrix_space.py
    STDOUT: Automatic merge failed; fix conflicts and then commit the result.
    STDERR: Recorded preimage for 'src/sage/matrix/matrix_space.py'
```
I guess I will delete my local branch and try again.



---

archive/issue_comments_400507.json:
```json
{
    "body": "Changed commit from **[`427ca06`](https://github.com/sagemath/sagetrac-mirror/commit/427ca0673c084319feffc85ed7eb6c60c6107dba)** to **[`6c9edb6`](https://github.com/sagemath/sagetrac-mirror/commit/6c9edb6f58370c17c754bf575386d2e901d75cb8)**",
    "created_at": "2020-02-22T16:22:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400507",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`427ca06`](https://github.com/sagemath/sagetrac-mirror/commit/427ca0673c084319feffc85ed7eb6c60c6107dba)** to **[`6c9edb6`](https://github.com/sagemath/sagetrac-mirror/commit/6c9edb6f58370c17c754bf575386d2e901d75cb8)**



---

archive/issue_comments_400508.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c9edb6f58370c17c754bf575386d2e901d75cb8\">6c9edb6</a></td><td><code>Fix spacing</code></td></tr></table>\n",
    "created_at": "2020-02-22T16:22:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400508",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c9edb6f58370c17c754bf575386d2e901d75cb8">6c9edb6</a></td><td><code>Fix spacing</code></td></tr></table>




---

archive/issue_events_359155.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-02-22T16:22:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359155"
}
```



---

archive/issue_events_359156.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-02-22T16:22:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359156"
}
```



---

archive/issue_comments_400509.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI did some global cleaning. If it fits you, you can set positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9\">7741f08</a></td><td><code>25997: uniformize error message and code organization</code></td></tr></table>\n",
    "created_at": "2020-02-22T16:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400509",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

I did some global cleaning. If it fits you, you can set positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9">7741f08</a></td><td><code>25997: uniformize error message and code organization</code></td></tr></table>




---

archive/issue_comments_400510.json:
```json
{
    "body": "Changed commit from **[`6c9edb6`](https://github.com/sagemath/sagetrac-mirror/commit/6c9edb6f58370c17c754bf575386d2e901d75cb8)** to **[`7741f08`](https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9)**",
    "created_at": "2020-02-22T16:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400510",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`6c9edb6`](https://github.com/sagemath/sagetrac-mirror/commit/6c9edb6f58370c17c754bf575386d2e901d75cb8)** to **[`7741f08`](https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9)**



---

archive/issue_comments_400511.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2020-02-22T16:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400511",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_400512.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/matrix_space_meataxe](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/matrix_space_meataxe)** to **[public/25997](https://github.com/sagemath/sagetrac-mirror/tree/public/25997)**",
    "created_at": "2020-02-22T16:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400512",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/SimonKing/matrix_space_meataxe](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/matrix_space_meataxe)** to **[public/25997](https://github.com/sagemath/sagetrac-mirror/tree/public/25997)**



---

archive/issue_comments_400513.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@videlec](#comment:23):\n> I did some global cleaning. If it fits you, you can set positive review.\n> \n> ---\n> New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9\">7741f08</a></td><td><code>25997: uniformize error message and code organization</code></td></tr></table>\n\nLooks good, but I'd like to wait till there is a green blob... (or tests pass on my laptop, at least...).",
    "created_at": "2020-02-22T16:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400513",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@videlec](#comment:23):
> I did some global cleaning. If it fits you, you can set positive review.
> 
> ---
> New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9">7741f08</a></td><td><code>25997: uniformize error message and code organization</code></td></tr></table>

Looks good, but I'd like to wait till there is a green blob... (or tests pass on my laptop, at least...).



---

archive/issue_events_359157.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-02-23T11:55:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359157"
}
```



---

archive/issue_events_359158.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2020-02-23T11:55:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359158"
}
```



---

archive/issue_comments_400514.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nTests pass both without and with meataxe installed. Hence, I guess it is positive review.",
    "created_at": "2020-02-23T11:55:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400514",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">comment:25</div>

Tests pass both without and with meataxe installed. Hence, I guess it is positive review.



---

archive/issue_comments_400515.json:
```json
{
    "body": "Changed branch from **[public/25997](https://github.com/sagemath/sagetrac-mirror/tree/public/25997)** to **[`7741f08`](https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9)**",
    "created_at": "2020-02-25T19:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25997#issuecomment-400515",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/25997](https://github.com/sagemath/sagetrac-mirror/tree/public/25997)** to **[`7741f08`](https://github.com/sagemath/sagetrac-mirror/commit/7741f086c35387969cf1b41cf30c3dd320b932e9)**



---

archive/issue_events_359159.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-02-25T19:51:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359159"
}
```



---

archive/issue_events_359160.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2682a3407ac2d6db9d24b37de1ed14cb2374d007",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-02-25T19:51:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25997",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25997#event-359160"
}
```
