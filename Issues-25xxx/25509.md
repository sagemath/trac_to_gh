# Issue 25509: Provide a simple (and generic) way to create immutable vectors and matrices

archive/issues_025272.json:
```json
{
    "assignees": [],
    "body": "We currently have the following elegant way to produce immutable graphs:\n\n```\nsage: set([Graph(i) for i in range(5)])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: This graph is mutable, and thus not hashable. Create an immutable copy by `g.copy(immutable=True)`\nsage: set([Graph(i, immutable=True) for i in range(5)])\n{Graph on 0 vertices,\n Graph on 1 vertex,\n Graph on 2 vertices,\n Graph on 3 vertices,\n Graph on 4 vertices}\n```\nThe aim of this ticket is to have the same for other objects, in particular vectors and matrices.\n\nIt would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n\n```\nS = set()\nfor x in some_list:\n    v = vector(x)\n    v.set_immutable()\n    S.add(v)\n```\nto\n\n```\nS = set(vector(x, immutable=True) for x in some_list)\n```\n\n\nCC:  @kliem\n\nKeywords: **vector, matrix, immutable**\n\nBranch/Commit: **[`5e110ad`](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)**\n\nReviewer: **Jonathan Kliem**\n\nAuthor: **Julian Ritter**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25509_\n\n",
    "closed_at": "2020-01-31T23:49:58Z",
    "created_at": "2018-06-05T09:30:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Provide a simple (and generic) way to create immutable vectors and matrices",
    "type": "issue",
    "updated_at": "2020-01-31T23:49:58Z",
    "url": "https://github.com/sagemath/sage/issues/25509",
    "user": "https://github.com/mantepse"
}
```
We currently have the following elegant way to produce immutable graphs:

```
sage: set([Graph(i) for i in range(5)])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: This graph is mutable, and thus not hashable. Create an immutable copy by `g.copy(immutable=True)`
sage: set([Graph(i, immutable=True) for i in range(5)])
{Graph on 0 vertices,
 Graph on 1 vertex,
 Graph on 2 vertices,
 Graph on 3 vertices,
 Graph on 4 vertices}
```
The aim of this ticket is to have the same for other objects, in particular vectors and matrices.

It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare

```
S = set()
for x in some_list:
    v = vector(x)
    v.set_immutable()
    S.add(v)
```
to

```
S = set(vector(x, immutable=True) for x in some_list)
```


CC:  @kliem

Keywords: **vector, matrix, immutable**

Branch/Commit: **[`5e110ad`](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)**

Reviewer: **Jonathan Kliem**

Author: **Julian Ritter**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/25509_





---

archive/issue_events_349982.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2018-06-05T09:30:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349982"
}
```



---

archive/issue_events_349983.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2018-06-05T09:30:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349983"
}
```



---

archive/issue_events_349984.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2018-06-05T09:30:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349984"
}
```



---

archive/issue_comments_391162.json:
```json
{
    "body": "Branch: **[u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)**",
    "created_at": "2019-12-17T12:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391162",
    "user": "https://github.com/sagetrac-nailuj"
}
```

Branch: **[u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)**



---

archive/issue_comments_391163.json:
```json
{
    "body": "Author: **Julian Ritter**",
    "created_at": "2019-12-17T12:38:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391163",
    "user": "https://github.com/sagetrac-nailuj"
}
```

Author: **Julian Ritter**



---

archive/issue_events_349985.json:
```json
{
    "actor": "https://github.com/sagetrac-nailuj",
    "created_at": "2019-12-17T12:38:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349985"
}
```



---

archive/issue_events_349986.json:
```json
{
    "actor": "https://github.com/sagetrac-nailuj",
    "created_at": "2019-12-17T12:38:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349986"
}
```



---

archive/issue_comments_391164.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI propose a modification of the `vector` and `matrix` constructors to accept `immutable=Tre/False` as argument. The default behaviour (mutable output) stays the same.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5533ba85e5c5d24b918e1ae696322194cd911869\"><code>5533ba8</code></a></td><td><code>added immutable switch for vector constructor</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793\"><code>1fd1d48</code></a></td><td><code>added immutable switch for matrix constructor</code></td></tr></table>\n",
    "created_at": "2019-12-17T12:38:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391164",
    "user": "https://github.com/sagetrac-nailuj"
}
```

<div id="comment:2" align="right">comment:2</div>

I propose a modification of the `vector` and `matrix` constructors to accept `immutable=Tre/False` as argument. The default behaviour (mutable output) stays the same.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5533ba85e5c5d24b918e1ae696322194cd911869"><code>5533ba8</code></a></td><td><code>added immutable switch for vector constructor</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793"><code>1fd1d48</code></a></td><td><code>added immutable switch for matrix constructor</code></td></tr></table>




---

archive/issue_comments_391165.json:
```json
{
    "body": "Commit: **[`1fd1d48`](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)**",
    "created_at": "2019-12-17T12:38:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391165",
    "user": "https://github.com/sagetrac-nailuj"
}
```

Commit: **[`1fd1d48`](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)**



---

archive/issue_events_349987.json:
```json
{
    "actor": "https://github.com/sagetrac-nailuj",
    "created_at": "2019-12-17T12:38:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349987"
}
```



---

archive/issue_comments_391166.json:
```json
{
    "body": "Changed keywords from none to **vector, matrix, immutable**",
    "created_at": "2019-12-17T12:38:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391166",
    "user": "https://github.com/sagetrac-nailuj"
}
```

Changed keywords from none to **vector, matrix, immutable**



---

archive/issue_comments_391167.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.\n\nAre there other examples (than graphs) that do it with keywords?",
    "created_at": "2019-12-17T14:07:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391167",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3" align="right">comment:3</div>

I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.

Are there other examples (than graphs) that do it with keywords?



---

archive/issue_comments_391168.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@kliem](#comment:3):\n> I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.\n\nIt would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n\n```\nS = set()\nfor x in some_list:\n    v = vector(x)\n    v.set_immutable()\n    S.add(v)\n```\nto\n\n```\nS = set(vector(x, immutable=True) for x in some_list)\n```\n\n> Are there other examples (than graphs) that do it with keywords?\n\nI did a quick research. Apart from `Graph` and `DiGraph`, I found:\n- `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch\n- `SimplicialComplex` accepts both `is_mutable` and `is_immutable`\n- `Constellation` accepts `mutable`.\n\nApart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:\n\n- the abstract classes `ClonableElement` and `Mutability`\n- `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix\n- `ToricLattice_quotient_element`, having a `set_mutable` method, which \"does nothing, it is introduced for compatibility purposes only\".\n\nJust like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?",
    "created_at": "2019-12-17T16:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391168",
    "user": "https://github.com/sagetrac-nailuj"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@kliem](#comment:3):
> I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.

It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare

```
S = set()
for x in some_list:
    v = vector(x)
    v.set_immutable()
    S.add(v)
```
to

```
S = set(vector(x, immutable=True) for x in some_list)
```

> Are there other examples (than graphs) that do it with keywords?

I did a quick research. Apart from `Graph` and `DiGraph`, I found:
- `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch
- `SimplicialComplex` accepts both `is_mutable` and `is_immutable`
- `Constellation` accepts `mutable`.

Apart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:

- the abstract classes `ClonableElement` and `Mutability`
- `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix
- `ToricLattice_quotient_element`, having a `set_mutable` method, which "does nothing, it is introduced for compatibility purposes only".

Just like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?



---

archive/issue_comments_391169.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThank you for implementing this. Personally, I have been missing this option several times and was surprised it did not exist.\n\nThe `vector` function has early returns that are not handled yet, so the `immutable` keyword is sometimes ignored. Moreover, the docstring should probably be of the form:\n\n```\n    - ``immutable`` -- boolean (default: ``False``); whether the result should be an immutable vector\n```",
    "created_at": "2019-12-17T21:49:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391169",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:5" align="right">comment:5</div>

Thank you for implementing this. Personally, I have been missing this option several times and was surprised it did not exist.

The `vector` function has early returns that are not handled yet, so the `immutable` keyword is sometimes ignored. Moreover, the docstring should probably be of the form:

```
    - ``immutable`` -- boolean (default: ``False``); whether the result should be an immutable vector
```



---

archive/issue_comments_391170.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThanks. Especially the example illustrated to me, why such a switch makes sense. Maybe you could add this example to the description of the ticket.\n\nI'm not into matrices or vectors too much (I never contributed to them). So if I'm going to agree to adding a switch, I want to know, that it is useful. I never had a striking reason against adding the `immutable` switch, but one needs at least one argument on the pro side as well (otherwise we could add tons of almost useless switches for very special cases).\n\nSome more remarks:\n- You should specify the error in the doctest:\n\n```diff\n-        sage: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).\n+        ValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).\n```\n- Maybe you can simplify the construction\n\n```diff\n-    if kwds.pop('immutable', False):\n-        M = MatrixArgs(*args, **kwds).matrix()\n-        M.set_immutable()\n-        return M\n-\n-    return MatrixArgs(*args, **kwds).matrix()\n+    immutable = kwds.pop('immutable', False)\n+    M = MatrixArgs(*args, **kwds).matrix()\n+    if immutable:\n+        M.set_immutable()\n+    return M\n```\n  The reason I'm suggesting it: It is clearer, what the switch immutable does. It doesn't effect the construction of the matrix, it is just setting the matrix immutable, after the construction.\n- I find it strange, when the comments preceding examples end with `. ::`. However, it seems to work well with sphinx: http://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html\n\nOtherwise, this looks fine modulo the changes suggested by Markus Wageringel. Maybe one could add tiny tests for each case of the early returns.\n\nReplying to [@sagetrac-nailuj](#comment:4):\n> Replying to [@kliem](#comment:3):\n> > I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.\n\n> \n> It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n> \n> ```\n> S = set()\n> for x in some_list:\n>     v = vector(x)\n>     v.set_immutable()\n>     S.add(v)\n> ```\n> to\n> \n> ```\n> S = set(vector(x, immutable=True) for x in some_list)\n> ```\n> \n> > Are there other examples (than graphs) that do it with keywords?\n\n> \n> I did a quick research. Apart from `Graph` and `DiGraph`, I found:\n> - `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch\n> - `SimplicialComplex` accepts both `is_mutable` and `is_immutable`\n> - `Constellation` accepts `mutable`.\n> \n> Apart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:\n> \n> - the abstract classes `ClonableElement` and `Mutability`\n> - `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix\n> - `ToricLattice_quotient_element`, having a `set_mutable` method, which \"does nothing, it is introduced for compatibility purposes only\".\n> \n> Just like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?",
    "created_at": "2019-12-18T07:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391170",
    "user": "https://github.com/kliem"
}
```

<div id="comment:6" align="right">comment:6</div>

Thanks. Especially the example illustrated to me, why such a switch makes sense. Maybe you could add this example to the description of the ticket.

I'm not into matrices or vectors too much (I never contributed to them). So if I'm going to agree to adding a switch, I want to know, that it is useful. I never had a striking reason against adding the `immutable` switch, but one needs at least one argument on the pro side as well (otherwise we could add tons of almost useless switches for very special cases).

Some more remarks:
- You should specify the error in the doctest:

```diff
-        sage: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).
+        ValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).
```
- Maybe you can simplify the construction

```diff
-    if kwds.pop('immutable', False):
-        M = MatrixArgs(*args, **kwds).matrix()
-        M.set_immutable()
-        return M
-
-    return MatrixArgs(*args, **kwds).matrix()
+    immutable = kwds.pop('immutable', False)
+    M = MatrixArgs(*args, **kwds).matrix()
+    if immutable:
+        M.set_immutable()
+    return M
```
  The reason I'm suggesting it: It is clearer, what the switch immutable does. It doesn't effect the construction of the matrix, it is just setting the matrix immutable, after the construction.
- I find it strange, when the comments preceding examples end with `. ::`. However, it seems to work well with sphinx: http://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html

Otherwise, this looks fine modulo the changes suggested by Markus Wageringel. Maybe one could add tiny tests for each case of the early returns.

Replying to [@sagetrac-nailuj](#comment:4):
> Replying to [@kliem](#comment:3):
> > I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.

> 
> It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare
> 
> ```
> S = set()
> for x in some_list:
>     v = vector(x)
>     v.set_immutable()
>     S.add(v)
> ```
> to
> 
> ```
> S = set(vector(x, immutable=True) for x in some_list)
> ```
> 
> > Are there other examples (than graphs) that do it with keywords?

> 
> I did a quick research. Apart from `Graph` and `DiGraph`, I found:
> - `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch
> - `SimplicialComplex` accepts both `is_mutable` and `is_immutable`
> - `Constellation` accepts `mutable`.
> 
> Apart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:
> 
> - the abstract classes `ClonableElement` and `Mutability`
> - `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix
> - `ToricLattice_quotient_element`, having a `set_mutable` method, which "does nothing, it is introduced for compatibility purposes only".
> 
> Just like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?



---

archive/issue_events_349988.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-18T07:47:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349988"
}
```



---

archive/issue_events_349989.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-18T07:47:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349989"
}
```



---

archive/issue_comments_391171.json:
```json
{
    "body": "Changed commit from **[`1fd1d48`](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)** to **[`1e4ca9f`](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)**",
    "created_at": "2019-12-18T15:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391171",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1fd1d48`](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)** to **[`1e4ca9f`](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)**



---

archive/issue_comments_391172.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/192d6340087caf449c0087d371da6db16291c040\"><code>192d634</code></a></td><td><code>Handled early returns in vector constructor</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b05759903dbd3f4a846ebc52a0c588f650c625db\"><code>b057599</code></a></td><td><code>Better vector docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/203e83de3d48f53750124819d9138272459d2cf1\"><code>203e83d</code></a></td><td><code>Specified error in the matrix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c\"><code>1e4ca9f</code></a></td><td><code>Simplified construction of immutable matrix</code></td></tr></table>\n",
    "created_at": "2019-12-18T15:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391172",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/192d6340087caf449c0087d371da6db16291c040"><code>192d634</code></a></td><td><code>Handled early returns in vector constructor</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b05759903dbd3f4a846ebc52a0c588f650c625db"><code>b057599</code></a></td><td><code>Better vector docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/203e83de3d48f53750124819d9138272459d2cf1"><code>203e83d</code></a></td><td><code>Specified error in the matrix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c"><code>1e4ca9f</code></a></td><td><code>Simplified construction of immutable matrix</code></td></tr></table>




---

archive/issue_events_349990.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349990"
}
```



---

archive/issue_events_349991.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349991"
}
```



---

archive/issue_comments_391173.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391173",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Ticket retargeted after milestone closed



---

archive/issue_comments_391174.json:
```json
{
    "body": "Changed commit from **[`1e4ca9f`](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)** to **[`d4663d5`](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)**",
    "created_at": "2020-01-28T17:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391174",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1e4ca9f`](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)** to **[`d4663d5`](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)**



---

archive/issue_comments_391175.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3\"><code>d4663d5</code></a></td><td><code>Added tests for each early return</code></td></tr></table>\n",
    "created_at": "2020-01-28T17:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391175",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3"><code>d4663d5</code></a></td><td><code>Added tests for each early return</code></td></tr></table>




---

archive/issue_comments_391176.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,19 @@\n  Graph on 4 vertices}\n ```\n The aim of this ticket is to have the same for other objects, in particular vectors and matrices.\n+\n+It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n+\n+```\n+S = set()\n+for x in some_list:\n+    v = vector(x)\n+    v.set_immutable()\n+    S.add(v)\n+```\n+to\n+\n+```\n+S = set(vector(x, immutable=True) for x in some_list)\n+```\n+\n``````\n",
    "created_at": "2020-01-28T17:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391176",
    "user": "https://github.com/sagetrac-nailuj"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,19 @@
  Graph on 4 vertices}
 ```
 The aim of this ticket is to have the same for other objects, in particular vectors and matrices.
+
+It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare
+
+```
+S = set()
+for x in some_list:
+    v = vector(x)
+    v.set_immutable()
+    S.add(v)
+```
+to
+
+```
+S = set(vector(x, immutable=True) for x in some_list)
+```
+
``````




---

archive/issue_comments_391177.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI made all the proposed adjustments. This should be ready for review.\n\nWhile working on the early returns, I noticed that `v = vector(R, w)` and `v = vector(w, R)` just output `w` if `R` is equal to `None` or `w.base_ring()`. As a consequence, all changes applied to `v` are also applied to `w`. Do you think this is the desired behaviour or should a ticket be opened to ask if this might be a bug?",
    "created_at": "2020-01-28T17:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391177",
    "user": "https://github.com/sagetrac-nailuj"
}
```

<div id="comment:11" align="right">comment:11</div>

I made all the proposed adjustments. This should be ready for review.

While working on the early returns, I noticed that `v = vector(R, w)` and `v = vector(w, R)` just output `w` if `R` is equal to `None` or `w.base_ring()`. As a consequence, all changes applied to `v` are also applied to `w`. Do you think this is the desired behaviour or should a ticket be opened to ask if this might be a bug?



---

archive/issue_events_349992.json:
```json
{
    "actor": "https://github.com/sagetrac-nailuj",
    "created_at": "2020-01-28T17:56:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349992"
}
```



---

archive/issue_events_349993.json:
```json
{
    "actor": "https://github.com/sagetrac-nailuj",
    "created_at": "2020-01-28T17:56:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349993"
}
```



---

archive/issue_comments_391178.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.\n\n**EDIT:** as pointed out, consistency is important and for graphs it looks like `immutable` already forces our hand. Changing all to `mutable` would be a different discussion and seems not worth it.",
    "created_at": "2020-01-28T21:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391178",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:12" align="right">comment:12</div>

I don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.

**EDIT:** as pointed out, consistency is important and for graphs it looks like `immutable` already forces our hand. Changing all to `mutable` would be a different discussion and seems not worth it.



---

archive/issue_comments_391179.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@nbruin](#comment:12):\n> I don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.\n\nI think it should be consistent with graphs (either way).",
    "created_at": "2020-01-28T21:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391179",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@nbruin](#comment:12):
> I don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.

I think it should be consistent with graphs (either way).



---

archive/issue_comments_391180.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nYour missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.\n\nAlso I think, error message should not end with a period.\n\nI think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.",
    "created_at": "2020-01-29T07:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391180",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14" align="right">comment:14</div>

Your missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.

Also I think, error message should not end with a period.

I think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.



---

archive/issue_comments_391181.json:
```json
{
    "body": "Changed commit from **[`d4663d5`](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)** to **[`5e110ad`](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)**",
    "created_at": "2020-01-29T14:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391181",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d4663d5`](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)** to **[`5e110ad`](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)**



---

archive/issue_comments_391182.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7\"><code>5e110ad</code></a></td><td><code>Typo in matrix doctest</code></td></tr></table>\n",
    "created_at": "2020-01-29T14:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391182",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7"><code>5e110ad</code></a></td><td><code>Typo in matrix doctest</code></td></tr></table>




---

archive/issue_comments_391183.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@kliem](#comment:14):\n> Your missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.\n\nThank you, I only tested the vector file. I fixed it.\n\n> Also I think, error message should not end with a period.\n\nCould you be more specific? I don't think I introduced any error message.\n\n> I think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.\n\nThanks!",
    "created_at": "2020-01-29T14:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391183",
    "user": "https://github.com/sagetrac-nailuj"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@kliem](#comment:14):
> Your missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.

Thank you, I only tested the vector file. I fixed it.

> Also I think, error message should not end with a period.

Could you be more specific? I don't think I introduced any error message.

> I think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.

Thanks!



---

archive/issue_comments_391184.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nLGTM.",
    "created_at": "2020-01-29T15:58:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391184",
    "user": "https://github.com/kliem"
}
```

<div id="comment:17" align="right">comment:17</div>

LGTM.



---

archive/issue_comments_391185.json:
```json
{
    "body": "Reviewer: **Jonathan Kliem**",
    "created_at": "2020-01-29T15:58:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391185",
    "user": "https://github.com/kliem"
}
```

Reviewer: **Jonathan Kliem**



---

archive/issue_events_349994.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-01-29T15:58:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349994"
}
```



---

archive/issue_events_349995.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-01-29T15:58:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349995"
}
```



---

archive/issue_comments_391186.json:
```json
{
    "body": "Changed branch from **[u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)** to **[`5e110ad`](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)**",
    "created_at": "2020-01-31T23:49:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-391186",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)** to **[`5e110ad`](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)**



---

archive/issue_events_349996.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349996"
}
```



---

archive/issue_events_349997.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "67759239bab3360feeedf502946def9ae675abbb",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-31T23:49:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-349997"
}
```
