# Issue 25509: Provide a simple (and generic) way to create immutable vectors and matrices

archive/issues_025272.json:
```json
{
    "body": "We currently have the following elegant way to produce immutable graphs:\n\n```\nsage: set([Graph(i) for i in range(5)])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: This graph is mutable, and thus not hashable. Create an immutable copy by `g.copy(immutable=True)`\nsage: set([Graph(i, immutable=True) for i in range(5)])\n{Graph on 0 vertices,\n Graph on 1 vertex,\n Graph on 2 vertices,\n Graph on 3 vertices,\n Graph on 4 vertices}\n```\nThe aim of this ticket is to have the same for other objects, in particular vectors and matrices.\n\nIt would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n\n```\nS = set()\nfor x in some_list:\n    v = vector(x)\n    v.set_immutable()\n    S.add(v)\n```\nto\n\n```\nS = set(vector(x, immutable=True) for x in some_list)\n```\n\n\n**CC:**  @kliem\n\n**Keywords:** vector, matrix, immutable\n\n**Branch/Commit:** [5e110add6a639a56aa5a31c657c686caa043ebb7](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)\n\n**Reviewer:** Jonathan Kliem\n\n**Author:** Julian Ritter\n\nIssue created by migration from https://trac.sagemath.org/ticket/25509\n\n",
    "closed_at": "2020-01-31T23:49:58Z",
    "created_at": "2018-06-05T09:30:53Z",
    "labels": [
        "component: misc",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "Provide a simple (and generic) way to create immutable vectors and matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/25509",
    "user": "https://github.com/mantepse"
}
```
We currently have the following elegant way to produce immutable graphs:

```
sage: set([Graph(i) for i in range(5)])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: This graph is mutable, and thus not hashable. Create an immutable copy by `g.copy(immutable=True)`
sage: set([Graph(i, immutable=True) for i in range(5)])
{Graph on 0 vertices,
 Graph on 1 vertex,
 Graph on 2 vertices,
 Graph on 3 vertices,
 Graph on 4 vertices}
```
The aim of this ticket is to have the same for other objects, in particular vectors and matrices.

It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare

```
S = set()
for x in some_list:
    v = vector(x)
    v.set_immutable()
    S.add(v)
```
to

```
S = set(vector(x, immutable=True) for x in some_list)
```


**CC:**  @kliem

**Keywords:** vector, matrix, immutable

**Branch/Commit:** [5e110add6a639a56aa5a31c657c686caa043ebb7](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)

**Reviewer:** Jonathan Kliem

**Author:** Julian Ritter

Issue created by migration from https://trac.sagemath.org/ticket/25509





---

archive/issue_comments_393810.json:
```json
{
    "body": "**Branch:** [u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)",
    "created_at": "2019-12-17T12:32:25Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393810",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

**Branch:** [u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)



---

archive/issue_comments_393811.json:
```json
{
    "body": "**Author:** Julian Ritter",
    "created_at": "2019-12-17T12:38:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393811",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

**Author:** Julian Ritter



---

archive/issue_events_226537.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/nailuj",
    "created_at": "2019-12-17T12:38:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226537"
}
```



---

archive/issue_events_226538.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/nailuj",
    "created_at": "2019-12-17T12:38:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226538"
}
```



---

archive/issue_comments_393812.json:
```json
{
    "body": "<a id='comment:2'></a>\nI propose a modification of the `vector` and `matrix` constructors to accept `immutable=Tre/False` as argument. The default behaviour (mutable output) stays the same.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5533ba85e5c5d24b918e1ae696322194cd911869\">5533ba8</a></td><td><code>added immutable switch for vector constructor</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793\">1fd1d48</a></td><td><code>added immutable switch for matrix constructor</code></td></tr></table>\n",
    "created_at": "2019-12-17T12:38:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393812",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:2'></a>
I propose a modification of the `vector` and `matrix` constructors to accept `immutable=Tre/False` as argument. The default behaviour (mutable output) stays the same.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5533ba85e5c5d24b918e1ae696322194cd911869">5533ba8</a></td><td><code>added immutable switch for vector constructor</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793">1fd1d48</a></td><td><code>added immutable switch for matrix constructor</code></td></tr></table>




---

archive/issue_comments_393813.json:
```json
{
    "body": "**Commit:** [1fd1d481b8961aae21d11ef91e904fd47a385793](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)",
    "created_at": "2019-12-17T12:38:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393813",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

**Commit:** [1fd1d481b8961aae21d11ef91e904fd47a385793](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)



---

archive/issue_events_226539.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/nailuj",
    "created_at": "2019-12-17T12:38:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226539"
}
```



---

archive/issue_comments_393814.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"vector, matrix, immutable\".",
    "created_at": "2019-12-17T12:38:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393814",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

**Changing keywords** from "" to "vector, matrix, immutable".



---

archive/issue_comments_393815.json:
```json
{
    "body": "<a id='comment:3'></a>\nI personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.\n\nAre there other examples (than graphs) that do it with keywords?",
    "created_at": "2019-12-17T14:07:10Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393815",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.

Are there other examples (than graphs) that do it with keywords?



---

archive/issue_comments_393816.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [gh-kliem](#comment%3A3):\n> I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.\n\nIt would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n\n```\nS = set()\nfor x in some_list:\n    v = vector(x)\n    v.set_immutable()\n    S.add(v)\n```\nto\n\n```\nS = set(vector(x, immutable=True) for x in some_list)\n```\n\n> Are there other examples (than graphs) that do it with keywords?\n\nI did a quick research. Apart from `Graph` and `DiGraph`, I found:\n- `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch\n- `SimplicialComplex` accepts both `is_mutable` and `is_immutable`\n- `Constellation` accepts `mutable`.\n\nApart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:\n\n- the abstract classes `ClonableElement` and `Mutability`\n- `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix\n- `ToricLattice_quotient_element`, having a `set_mutable` method, which \"does nothing, it is introduced for compatibility purposes only\".\n\nJust like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?",
    "created_at": "2019-12-17T16:49:51Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393816",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:4'></a>
Replying to [gh-kliem](#comment%3A3):
> I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.

It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare

```
S = set()
for x in some_list:
    v = vector(x)
    v.set_immutable()
    S.add(v)
```
to

```
S = set(vector(x, immutable=True) for x in some_list)
```

> Are there other examples (than graphs) that do it with keywords?

I did a quick research. Apart from `Graph` and `DiGraph`, I found:
- `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch
- `SimplicialComplex` accepts both `is_mutable` and `is_immutable`
- `Constellation` accepts `mutable`.

Apart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:

- the abstract classes `ClonableElement` and `Mutability`
- `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix
- `ToricLattice_quotient_element`, having a `set_mutable` method, which "does nothing, it is introduced for compatibility purposes only".

Just like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?



---

archive/issue_comments_393817.json:
```json
{
    "body": "<a id='comment:5'></a>\nThank you for implementing this. Personally, I have been missing this option several times and was surprised it did not exist.\n\nThe `vector` function has early returns that are not handled yet, so the `immutable` keyword is sometimes ignored. Moreover, the docstring should probably be of the form:\n\n```\n    - ``immutable`` -- boolean (default: ``False``); whether the result should be an immutable vector\n```",
    "created_at": "2019-12-17T21:49:54Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393817",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:5'></a>
Thank you for implementing this. Personally, I have been missing this option several times and was surprised it did not exist.

The `vector` function has early returns that are not handled yet, so the `immutable` keyword is sometimes ignored. Moreover, the docstring should probably be of the form:

```
    - ``immutable`` -- boolean (default: ``False``); whether the result should be an immutable vector
```



---

archive/issue_comments_393818.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks. Especially the example illustrated to me, why such a switch makes sense. Maybe you could add this example to the description of the ticket.\n\nI'm not into matrices or vectors too much (I never contributed to them). So if I'm going to agree to adding a switch, I want to know, that it is useful. I never had a striking reason against adding the `immutable` switch, but one needs at least one argument on the pro side as well (otherwise we could add tons of almost useless switches for very special cases).\n\nSome more remarks:\n- You should specify the error in the doctest:\n\n```diff\n-        sage: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).\n+        ValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).\n```\n- Maybe you can simplify the construction\n\n```diff\n-    if kwds.pop('immutable', False):\n-        M = MatrixArgs(*args, **kwds).matrix()\n-        M.set_immutable()\n-        return M\n-\n-    return MatrixArgs(*args, **kwds).matrix()\n+    immutable = kwds.pop('immutable', False)\n+    M = MatrixArgs(*args, **kwds).matrix()\n+    if immutable:\n+        M.set_immutable()\n+    return M\n```\n  The reason I'm suggesting it: It is clearer, what the switch immutable does. It doesn't effect the construction of the matrix, it is just setting the matrix immutable, after the construction.\n- I find it strange, when the comments preceding examples end with `. ::`. However, it seems to work well with sphinx: http://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html\n\nOtherwise, this looks fine modulo the changes suggested by Markus Wageringel. Maybe one could add tiny tests for each case of the early returns.\n\nReplying to [nailuj](#comment%3A4):\n> Replying to [gh-kliem](#comment%3A3):\n> > I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.\n\n> \n> It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n> \n> ```\n> S = set()\n> for x in some_list:\n>     v = vector(x)\n>     v.set_immutable()\n>     S.add(v)\n> ```\n> to\n> \n> ```\n> S = set(vector(x, immutable=True) for x in some_list)\n> ```\n> \n> > Are there other examples (than graphs) that do it with keywords?\n\n> \n> I did a quick research. Apart from `Graph` and `DiGraph`, I found:\n> - `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch\n> - `SimplicialComplex` accepts both `is_mutable` and `is_immutable`\n> - `Constellation` accepts `mutable`.\n> \n> Apart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:\n> \n> - the abstract classes `ClonableElement` and `Mutability`\n> - `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix\n> - `ToricLattice_quotient_element`, having a `set_mutable` method, which \"does nothing, it is introduced for compatibility purposes only\".\n> \n> Just like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?",
    "created_at": "2019-12-18T07:47:05Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393818",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>
Thanks. Especially the example illustrated to me, why such a switch makes sense. Maybe you could add this example to the description of the ticket.

I'm not into matrices or vectors too much (I never contributed to them). So if I'm going to agree to adding a switch, I want to know, that it is useful. I never had a striking reason against adding the `immutable` switch, but one needs at least one argument on the pro side as well (otherwise we could add tons of almost useless switches for very special cases).

Some more remarks:
- You should specify the error in the doctest:

```diff
-        sage: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).
+        ValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).
```
- Maybe you can simplify the construction

```diff
-    if kwds.pop('immutable', False):
-        M = MatrixArgs(*args, **kwds).matrix()
-        M.set_immutable()
-        return M
-
-    return MatrixArgs(*args, **kwds).matrix()
+    immutable = kwds.pop('immutable', False)
+    M = MatrixArgs(*args, **kwds).matrix()
+    if immutable:
+        M.set_immutable()
+    return M
```
  The reason I'm suggesting it: It is clearer, what the switch immutable does. It doesn't effect the construction of the matrix, it is just setting the matrix immutable, after the construction.
- I find it strange, when the comments preceding examples end with `. ::`. However, it seems to work well with sphinx: http://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html

Otherwise, this looks fine modulo the changes suggested by Markus Wageringel. Maybe one could add tiny tests for each case of the early returns.

Replying to [nailuj](#comment%3A4):
> Replying to [gh-kliem](#comment%3A3):
> > I personally do not see the advantage to just setting the matrix/vector immutable, once I'm done modifying it.

> 
> It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare
> 
> ```
> S = set()
> for x in some_list:
>     v = vector(x)
>     v.set_immutable()
>     S.add(v)
> ```
> to
> 
> ```
> S = set(vector(x, immutable=True) for x in some_list)
> ```
> 
> > Are there other examples (than graphs) that do it with keywords?

> 
> I did a quick research. Apart from `Graph` and `DiGraph`, I found:
> - `Sequence` and `PolynomialSequence` having an `immutable=True/False` switch
> - `SimplicialComplex` accepts both `is_mutable` and `is_immutable`
> - `Constellation` accepts `mutable`.
> 
> Apart from `vector` and `matrix`, the only classes I found having a `set_immutable` method, but no corresponding switch in the constructor are the following:
> 
> - the abstract classes `ClonableElement` and `Mutability`
> - `Matrix_cyclo_dense` and `LatinSquare`, passing the `set_immutable` command to its associated matrix
> - `ToricLattice_quotient_element`, having a `set_mutable` method, which "does nothing, it is introduced for compatibility purposes only".
> 
> Just like @mantepse, I would prefer `vector` and `matrix` to have such switches. Is there a striking argument why they shouldn't?



---

archive/issue_events_226540.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-18T07:47:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226540"
}
```



---

archive/issue_events_226541.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-12-18T07:47:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226541"
}
```



---

archive/issue_comments_393819.json:
```json
{
    "body": "**Changing commit** from \"[1fd1d481b8961aae21d11ef91e904fd47a385793](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)\" to \"[1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)\".",
    "created_at": "2019-12-18T15:29:23Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1fd1d481b8961aae21d11ef91e904fd47a385793](https://github.com/sagemath/sagetrac-mirror/commit/1fd1d481b8961aae21d11ef91e904fd47a385793)" to "[1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)".



---

archive/issue_comments_393820.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/192d6340087caf449c0087d371da6db16291c040\">192d634</a></td><td><code>Handled early returns in vector constructor</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b05759903dbd3f4a846ebc52a0c588f650c625db\">b057599</a></td><td><code>Better vector docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/203e83de3d48f53750124819d9138272459d2cf1\">203e83d</a></td><td><code>Specified error in the matrix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c\">1e4ca9f</a></td><td><code>Simplified construction of immutable matrix</code></td></tr></table>\n",
    "created_at": "2019-12-18T15:29:23Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/192d6340087caf449c0087d371da6db16291c040">192d634</a></td><td><code>Handled early returns in vector constructor</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b05759903dbd3f4a846ebc52a0c588f650c625db">b057599</a></td><td><code>Better vector docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/203e83de3d48f53750124819d9138272459d2cf1">203e83d</a></td><td><code>Specified error in the matrix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c">1e4ca9f</a></td><td><code>Simplified construction of immutable matrix</code></td></tr></table>




---

archive/issue_events_226542.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226542"
}
```



---

archive/issue_events_226543.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226543"
}
```



---

archive/issue_comments_393821.json:
```json
{
    "body": "<a id='comment:9'></a>\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393821",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Ticket retargeted after milestone closed



---

archive/issue_comments_393822.json:
```json
{
    "body": "**Changing commit** from \"[1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)\" to \"[d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)\".",
    "created_at": "2020-01-28T17:39:35Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c](https://github.com/sagemath/sagetrac-mirror/commit/1e4ca9fddc49a2b5074846f3c8428fe1d59bf31c)" to "[d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)".



---

archive/issue_comments_393823.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3\">d4663d5</a></td><td><code>Added tests for each early return</code></td></tr></table>\n",
    "created_at": "2020-01-28T17:39:35Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3">d4663d5</a></td><td><code>Added tests for each early return</code></td></tr></table>




---

archive/issue_comments_393824.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,3 +14,19 @@\n  Graph on 4 vertices}\n ```\n The aim of this ticket is to have the same for other objects, in particular vectors and matrices.\n+\n+It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare\n+\n+```\n+S = set()\n+for x in some_list:\n+    v = vector(x)\n+    v.set_immutable()\n+    S.add(v)\n+```\n+to\n+\n+```\n+S = set(vector(x, immutable=True) for x in some_list)\n+```\n+\n``````\n",
    "created_at": "2020-01-28T17:56:28Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393824",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,3 +14,19 @@
  Graph on 4 vertices}
 ```
 The aim of this ticket is to have the same for other objects, in particular vectors and matrices.
+
+It would avoid introducing a variable just to make this adjustment. This can simplify code by more than just one line. Consider, for example, list/set/dict comprehensions and compare
+
+```
+S = set()
+for x in some_list:
+    v = vector(x)
+    v.set_immutable()
+    S.add(v)
+```
+to
+
+```
+S = set(vector(x, immutable=True) for x in some_list)
+```
+
``````




---

archive/issue_comments_393825.json:
```json
{
    "body": "<a id='comment:11'></a>\nI made all the proposed adjustments. This should be ready for review.\n\nWhile working on the early returns, I noticed that `v = vector(R, w)` and `v = vector(w, R)` just output `w` if `R` is equal to `None` or `w.base_ring()`. As a consequence, all changes applied to `v` are also applied to `w`. Do you think this is the desired behaviour or should a ticket be opened to ask if this might be a bug?",
    "created_at": "2020-01-28T17:56:28Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393825",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:11'></a>
I made all the proposed adjustments. This should be ready for review.

While working on the early returns, I noticed that `v = vector(R, w)` and `v = vector(w, R)` just output `w` if `R` is equal to `None` or `w.base_ring()`. As a consequence, all changes applied to `v` are also applied to `w`. Do you think this is the desired behaviour or should a ticket be opened to ask if this might be a bug?



---

archive/issue_events_226544.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/nailuj",
    "created_at": "2020-01-28T17:56:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226544"
}
```



---

archive/issue_events_226545.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/nailuj",
    "created_at": "2020-01-28T17:56:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226545"
}
```



---

archive/issue_comments_393826.json:
```json
{
    "body": "<a id='comment:12'></a>\nI don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.\n\n**EDIT:** as pointed out, consistency is important and for graphs it looks like `immutable` already forces our hand. Changing all to `mutable` would be a different discussion and seems not worth it.",
    "created_at": "2020-01-28T21:01:19Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393826",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:12'></a>
I don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.

**EDIT:** as pointed out, consistency is important and for graphs it looks like `immutable` already forces our hand. Changing all to `mutable` would be a different discussion and seems not worth it.



---

archive/issue_comments_393827.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [nbruin](#comment%3A12):\n> I don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.\n\nI think it should be consistent with graphs (either way).",
    "created_at": "2020-01-28T21:26:58Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393827",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:13'></a>
Replying to [nbruin](#comment%3A12):
> I don't feel very strongly about this point, but `mutable=False` seems like a more direct way (at least in english) than `immutable=True`: naming an option directly than by its negation seems more straightforward. Perhaps worth considering.

I think it should be consistent with graphs (either way).



---

archive/issue_comments_393828.json:
```json
{
    "body": "<a id='comment:14'></a>\nYour missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.\n\nAlso I think, error message should not end with a period.\n\nI think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.",
    "created_at": "2020-01-29T07:18:00Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393828",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>
Your missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.

Also I think, error message should not end with a period.

I think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.



---

archive/issue_comments_393829.json:
```json
{
    "body": "**Changing commit** from \"[d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)\" to \"[5e110add6a639a56aa5a31c657c686caa043ebb7](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)\".",
    "created_at": "2020-01-29T14:29:17Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3](https://github.com/sagemath/sagetrac-mirror/commit/d4663d5b098a0dc8b919cdc9b6c93ba3d9f09aa3)" to "[5e110add6a639a56aa5a31c657c686caa043ebb7](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)".



---

archive/issue_comments_393830.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7\">5e110ad</a></td><td><code>Typo in matrix doctest</code></td></tr></table>\n",
    "created_at": "2020-01-29T14:29:17Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7">5e110ad</a></td><td><code>Typo in matrix doctest</code></td></tr></table>




---

archive/issue_comments_393831.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [gh-kliem](#comment%3A14):\n> Your missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.\n\nThank you, I only tested the vector file. I fixed it.\n\n> Also I think, error message should not end with a period.\n\nCould you be more specific? I don't think I introduced any error message.\n\n> I think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.\n\nThanks!",
    "created_at": "2020-01-29T14:31:20Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393831",
    "user": "https://trac.sagemath.org/admin/accounts/users/nailuj"
}
```

<a id='comment:16'></a>
Replying to [gh-kliem](#comment%3A14):
> Your missing the colons after `Traceback (most recent call last)` in the doctest. So there is a failing test.

Thank you, I only tested the vector file. I fixed it.

> Also I think, error message should not end with a period.

Could you be more specific? I don't think I introduced any error message.

> I think returning `a` with `vector(a)` is definitely not the desired behavior. E.g. `list`, `matrix` and `graph` return a copy in this case. So one would expect `vector` to behave the same.

Thanks!



---

archive/issue_comments_393832.json:
```json
{
    "body": "<a id='comment:17'></a>\nLGTM.",
    "created_at": "2020-01-29T15:58:09Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393832",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>
LGTM.



---

archive/issue_comments_393833.json:
```json
{
    "body": "**Reviewer:** Jonathan Kliem",
    "created_at": "2020-01-29T15:58:09Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393833",
    "user": "https://github.com/kliem"
}
```

**Reviewer:** Jonathan Kliem



---

archive/issue_events_226546.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-01-29T15:58:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226546"
}
```



---

archive/issue_events_226547.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-01-29T15:58:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226547"
}
```



---

archive/issue_comments_393834.json:
```json
{
    "body": "**Changing branch** from \"[u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)\" to \"[5e110add6a639a56aa5a31c657c686caa043ebb7](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)\".",
    "created_at": "2020-01-31T23:49:58Z",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25509#issuecomment-393834",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/nailuj/immutable_vectors_and_matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/nailuj/immutable_vectors_and_matrices)" to "[5e110add6a639a56aa5a31c657c686caa043ebb7](https://github.com/sagemath/sagetrac-mirror/commit/5e110add6a639a56aa5a31c657c686caa043ebb7)".



---

archive/issue_events_226548.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226548"
}
```



---

archive/issue_events_226549.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "67759239bab3360feeedf502946def9ae675abbb",
    "created_at": "2020-01-31T23:49:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25509",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25509#event-226549"
}
```
