# Issue 25895: LatticePoset, optimize congruence-related functions for trivial cases

archive/issues_025658.json:
```json
{
    "body": "This patch adds an internal function to find \"double-double -irreducible\". To be used for counting out trivial cases for `is_isoform` etc.\n\n**CC:**  @tscrim @fchapoton\n\n**Keywords:** sagedays@icerm\n\n**Branch/Commit:** [16b2719be5edf9aa357bda3bbcfaeb7295abe63f](https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Jori M\u00e4ntysalo\n\nIssue created by migration from https://trac.sagemath.org/ticket/25895\n\n",
    "closed_at": "2018-08-05T08:15:49Z",
    "created_at": "2018-07-22T07:17:36Z",
    "labels": [
        "component: combinatorics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "title": "LatticePoset, optimize congruence-related functions for trivial cases",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/25895",
    "user": "https://github.com/jm58660"
}
```
This patch adds an internal function to find "double-double -irreducible". To be used for counting out trivial cases for `is_isoform` etc.

**CC:**  @tscrim @fchapoton

**Keywords:** sagedays@icerm

**Branch/Commit:** [16b2719be5edf9aa357bda3bbcfaeb7295abe63f](https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f)

**Reviewer:** Travis Scrimshaw

**Author:** Jori Mäntysalo

Issue created by migration from https://trac.sagemath.org/ticket/25895





---

archive/issue_events_229811.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2018-07-22T07:19:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25895#event-229811"
}
```



---

archive/issue_comments_400731.json:
```json
{
    "body": "**Author:** Jori M\u00e4ntysalo",
    "created_at": "2018-07-22T07:19:31Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400731",
    "user": "https://github.com/jm58660"
}
```

**Author:** Jori Mäntysalo



---

archive/issue_events_229812.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2018-07-22T07:19:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25895#event-229812"
}
```



---

archive/issue_events_229813.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2018-07-22T07:19:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "label": "component: combinatorics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25895#event-229813"
}
```



---

archive/issue_comments_400732.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+This patch adds an internal function to find \"double-double -irreducible\". To be used for counting out trivial cases for `is_isoform` etc.\n``````\n",
    "created_at": "2018-07-22T07:19:31Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400732",
    "user": "https://github.com/jm58660"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+This patch adds an internal function to find "double-double -irreducible". To be used for counting out trivial cases for `is_isoform` etc.
``````




---

archive/issue_comments_400733.json:
```json
{
    "body": "**Branch:** [u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases)",
    "created_at": "2018-07-22T07:19:54Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400733",
    "user": "https://github.com/jm58660"
}
```

**Branch:** [u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases)



---

archive/issue_comments_400734.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b1799d1d4103c45e4b78103a4f5f16502d6fb31\">4b1799d</a></td><td><code>Add function for trivial congruence.</code></td></tr></table>\n",
    "created_at": "2018-07-22T07:21:30Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400734",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b1799d1d4103c45e4b78103a4f5f16502d6fb31">4b1799d</a></td><td><code>Add function for trivial congruence.</code></td></tr></table>




---

archive/issue_comments_400735.json:
```json
{
    "body": "**Commit:** [4b1799d1d4103c45e4b78103a4f5f16502d6fb31](https://github.com/sagemath/sagetrac-mirror/commit/4b1799d1d4103c45e4b78103a4f5f16502d6fb31)",
    "created_at": "2018-07-22T07:21:30Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [4b1799d1d4103c45e4b78103a4f5f16502d6fb31](https://github.com/sagemath/sagetrac-mirror/commit/4b1799d1d4103c45e4b78103a4f5f16502d6fb31)



---

archive/issue_comments_400736.json:
```json
{
    "body": "<a id='comment:4'></a>\nHow is this method being used? I don't want to add a hidden method that is not used. I think it is generally better to have at least one use-case in the same ticket.",
    "created_at": "2018-07-22T15:59:37Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400736",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
How is this method being used? I don't want to add a hidden method that is not used. I think it is generally better to have at least one use-case in the same ticket.



---

archive/issue_comments_400737.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b3b08c871c60fa26bdc884ea912320b91138f03\">3b3b08c</a></td><td><code>Merge branch 'develop' into t/25895/latticeposet__optimize_congruence_related_functions_for_trivial_cases</code></td></tr></table>\n",
    "created_at": "2018-07-23T05:26:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400737",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b3b08c871c60fa26bdc884ea912320b91138f03">3b3b08c</a></td><td><code>Merge branch 'develop' into t/25895/latticeposet__optimize_congruence_related_functions_for_trivial_cases</code></td></tr></table>




---

archive/issue_comments_400738.json:
```json
{
    "body": "**Changing commit** from \"[4b1799d1d4103c45e4b78103a4f5f16502d6fb31](https://github.com/sagemath/sagetrac-mirror/commit/4b1799d1d4103c45e4b78103a4f5f16502d6fb31)\" to \"[3b3b08c871c60fa26bdc884ea912320b91138f03](https://github.com/sagemath/sagetrac-mirror/commit/3b3b08c871c60fa26bdc884ea912320b91138f03)\".",
    "created_at": "2018-07-23T05:26:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400738",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4b1799d1d4103c45e4b78103a4f5f16502d6fb31](https://github.com/sagemath/sagetrac-mirror/commit/4b1799d1d4103c45e4b78103a4f5f16502d6fb31)" to "[3b3b08c871c60fa26bdc884ea912320b91138f03](https://github.com/sagemath/sagetrac-mirror/commit/3b3b08c871c60fa26bdc884ea912320b91138f03)".



---

archive/issue_comments_400739.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f\">16b2719</a></td><td><code>Add example use case.</code></td></tr></table>\n",
    "created_at": "2018-07-23T05:53:59Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400739",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f">16b2719</a></td><td><code>Add example use case.</code></td></tr></table>




---

archive/issue_comments_400740.json:
```json
{
    "body": "**Changing commit** from \"[3b3b08c871c60fa26bdc884ea912320b91138f03](https://github.com/sagemath/sagetrac-mirror/commit/3b3b08c871c60fa26bdc884ea912320b91138f03)\" to \"[16b2719be5edf9aa357bda3bbcfaeb7295abe63f](https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f)\".",
    "created_at": "2018-07-23T05:53:59Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400740",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3b3b08c871c60fa26bdc884ea912320b91138f03](https://github.com/sagemath/sagetrac-mirror/commit/3b3b08c871c60fa26bdc884ea912320b91138f03)" to "[16b2719be5edf9aa357bda3bbcfaeb7295abe63f](https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f)".



---

archive/issue_comments_400741.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tscrim](#comment%3A4):\n> I think it is generally better to have at least one use-case in the same ticket.\n\n\nDone this. If `Lats` is a list of all 10-element lattices, then the time for\n\n```\nsum(1 for L in Lats if L.is_uniform())\n```\n\ndrops from 26 seconds to 9 seconds with this patch.",
    "created_at": "2018-07-23T05:56:56Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400741",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>
Replying to [tscrim](#comment%3A4):
> I think it is generally better to have at least one use-case in the same ticket.


Done this. If `Lats` is a list of all 10-element lattices, then the time for

```
sum(1 for L in Lats if L.is_uniform())
```

drops from 26 seconds to 9 seconds with this patch.



---

archive/issue_comments_400742.json:
```json
{
    "body": "<a id='comment:8'></a>\nLGTM. Thanks. Nice speedup too.",
    "created_at": "2018-07-23T11:34:32Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400742",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
LGTM. Thanks. Nice speedup too.



---

archive/issue_events_229814.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T11:34:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25895#event-229814"
}
```



---

archive/issue_events_229815.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-23T11:34:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25895#event-229815"
}
```



---

archive/issue_comments_400743.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sagedays@icerm\".",
    "created_at": "2018-07-23T11:34:32Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400743",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "" to "sagedays@icerm".



---

archive/issue_comments_400744.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-07-23T11:34:32Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400744",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_400745.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks.\n\nThe speedup thing for this kind of functions is hard to decide. It the user asks if a lattice is modular, should we first try to see if it happens to be distributive? If so, it must be also modular and the test was very fast. But then, distributive lattices are \"rare\". OTOH also lattices with at least one \"doubledouble\"-irreducible element are \"rare\", so should we test for those?\n\nAt the other extreme we have for example `is_orthocomplemented`, where we start by checking that the number of elements is even; here the quick test is extremely cheap.",
    "created_at": "2018-07-23T11:44:16Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400745",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:9'></a>
Thanks.

The speedup thing for this kind of functions is hard to decide. It the user asks if a lattice is modular, should we first try to see if it happens to be distributive? If so, it must be also modular and the test was very fast. But then, distributive lattices are "rare". OTOH also lattices with at least one "doubledouble"-irreducible element are "rare", so should we test for those?

At the other extreme we have for example `is_orthocomplemented`, where we start by checking that the number of elements is even; here the quick test is extremely cheap.



---

archive/issue_comments_400746.json:
```json
{
    "body": "<a id='comment:10'></a>\nBecause the test for distributive is relatively expensive (and a stronger property?), I would not do it. One possibility is putting a `.. NOTE::` in the doc saying something like in your comment: that the distributive test is faster but more likely to fail. (Although perhaps stronger properties are easier to test for in general?)",
    "created_at": "2018-07-23T11:50:13Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400746",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
Because the test for distributive is relatively expensive (and a stronger property?), I would not do it. One possibility is putting a `.. NOTE::` in the doc saying something like in your comment: that the distributive test is faster but more likely to fail. (Although perhaps stronger properties are easier to test for in general?)



---

archive/issue_comments_400747.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A10):\n\n> Because the test for distributive is relatively expensive (and a stronger property?), I would not do it. One possibility is putting a `.. NOTE::` in the doc saying something like in your comment: that the distributive test is faster but more likely to fail.\n\n\nMaybe... But that might depend on use case.\n\n> (Although perhaps stronger properties are easier to test for in general?)\n\n\nNo, for example testing for semimodularity is faster that testing for modularity. But of course one can always test for a stronger property to get sure \"yes\"-answer, test for a weaker property to get sure \"no\"-answer, and only when needed to proceed testing the original property.",
    "created_at": "2018-07-23T12:23:07Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400747",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A10):

> Because the test for distributive is relatively expensive (and a stronger property?), I would not do it. One possibility is putting a `.. NOTE::` in the doc saying something like in your comment: that the distributive test is faster but more likely to fail.


Maybe... But that might depend on use case.

> (Although perhaps stronger properties are easier to test for in general?)


No, for example testing for semimodularity is faster that testing for modularity. But of course one can always test for a stronger property to get sure "yes"-answer, test for a weaker property to get sure "no"-answer, and only when needed to proceed testing the original property.



---

archive/issue_events_229816.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-05T08:15:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25895#event-229816"
}
```



---

archive/issue_events_229817.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2220712b29591458d63e9bf42f8b3de5b5071dc3",
    "created_at": "2018-08-05T08:15:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25895#event-229817"
}
```



---

archive/issue_comments_400748.json:
```json
{
    "body": "**Changing branch** from \"[u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases)\" to \"[16b2719be5edf9aa357bda3bbcfaeb7295abe63f](https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f)\".",
    "created_at": "2018-08-05T08:15:49Z",
    "issue": "https://github.com/sagemath/sage/issues/25895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25895#issuecomment-400748",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__optimize_congruence_related_functions_for_trivial_cases)" to "[16b2719be5edf9aa357bda3bbcfaeb7295abe63f](https://github.com/sagemath/sagetrac-mirror/commit/16b2719be5edf9aa357bda3bbcfaeb7295abe63f)".
