# Issue 25270: Add option to only run short doctests

archive/issues_025033.json:
```json
{
    "body": "The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.\n\n[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)\n\nThis ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).\n\nThis gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.\n\nHere is an example:\n\n```\n> sage -tp --short 5 src/sage/rings/padics/*.py\nDoctesting 19 files using 4 threads.\nsage -t src/sage/rings/padics/padic_base_leaves.py\n    [14% of tests run, 1.31 s]\nsage -t src/sage/rings/padics/factory.py\n    [29% of tests run, 1.31 s]\nsage -t src/sage/rings/padics/lattice_precision.py\n    [43% of tests run, 1.00 s]\nsage -t src/sage/rings/padics/padic_valuation.py\n    [4% of tests run, 2.80 s]\nsage -t src/sage/rings/padics/padic_base_generic.py\n    [95% of tests run, 1.72 s]\nsage -t src/sage/rings/padics/local_generic.py\n    [1% of tests run, 0.73 s]\nsage -t src/sage/rings/padics/padic_extension_generic.py\n    [5% of tests run, 0.77 s]\nsage -t src/sage/rings/padics/padic_lattice_element.py\n    [2% of tests run, 0.78 s]\nsage -t src/sage/rings/padics/generic_nodes.py\n    [1% of tests run, 0.75 s]\nsage -t src/sage/rings/padics/padic_generic.py\n    [1% of tests run, 0.73 s]\nsage -t src/sage/rings/padics/unramified_extension_generic.py\n    [2% of tests run, 0.43 s]\nsage -t src/sage/rings/padics/tutorial.py\n    [4% of tests run, 0.70 s]\nsage -t src/sage/rings/padics/tests.py\n    [0% of tests run, 0.00 s]\nsage -t src/sage/rings/padics/eisenstein_extension_generic.py\n    [7% of tests run, 0.80 s]\nsage -t src/sage/rings/padics/misc.py\n    [6% of tests run, 0.78 s]\nsage -t src/sage/rings/padics/precision_error.py\n    [0 tests, 0.00 s]\nsage -t src/sage/rings/padics/all.py\n    [0 tests, 0.00 s]\nsage -t src/sage/rings/padics/__init__.py\n    [0 tests, 0.00 s]\nsage -t src/sage/rings/padics/padic_extension_leaves.py\n    [10% of tests run, 6.54 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 6.6 seconds\n    cpu time: 20.0 seconds\n    cumulative wall time: 21.1 seconds\n```\n\nCC:  @embray @nthiery @roed314\n\nWork_Issues: is the patchbot happy?\n\nReviewer: Erik Bray\n\nAuthor: Julian R\u00fcth\n\nBranch: a4614abfd029249ce92219204f8dd5c012b99068\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25270\n\n",
    "closed_at": "2018-10-20T19:02:31Z",
    "created_at": "2018-04-30T23:49:09Z",
    "labels": [
        "component: doctest framework",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Add option to only run short doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25270",
    "user": "https://github.com/saraedum"
}
```
The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.

[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)

This ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).

This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.

Here is an example:

```
> sage -tp --short 5 src/sage/rings/padics/*.py
Doctesting 19 files using 4 threads.
sage -t src/sage/rings/padics/padic_base_leaves.py
    [14% of tests run, 1.31 s]
sage -t src/sage/rings/padics/factory.py
    [29% of tests run, 1.31 s]
sage -t src/sage/rings/padics/lattice_precision.py
    [43% of tests run, 1.00 s]
sage -t src/sage/rings/padics/padic_valuation.py
    [4% of tests run, 2.80 s]
sage -t src/sage/rings/padics/padic_base_generic.py
    [95% of tests run, 1.72 s]
sage -t src/sage/rings/padics/local_generic.py
    [1% of tests run, 0.73 s]
sage -t src/sage/rings/padics/padic_extension_generic.py
    [5% of tests run, 0.77 s]
sage -t src/sage/rings/padics/padic_lattice_element.py
    [2% of tests run, 0.78 s]
sage -t src/sage/rings/padics/generic_nodes.py
    [1% of tests run, 0.75 s]
sage -t src/sage/rings/padics/padic_generic.py
    [1% of tests run, 0.73 s]
sage -t src/sage/rings/padics/unramified_extension_generic.py
    [2% of tests run, 0.43 s]
sage -t src/sage/rings/padics/tutorial.py
    [4% of tests run, 0.70 s]
sage -t src/sage/rings/padics/tests.py
    [0% of tests run, 0.00 s]
sage -t src/sage/rings/padics/eisenstein_extension_generic.py
    [7% of tests run, 0.80 s]
sage -t src/sage/rings/padics/misc.py
    [6% of tests run, 0.78 s]
sage -t src/sage/rings/padics/precision_error.py
    [0 tests, 0.00 s]
sage -t src/sage/rings/padics/all.py
    [0 tests, 0.00 s]
sage -t src/sage/rings/padics/__init__.py
    [0 tests, 0.00 s]
sage -t src/sage/rings/padics/padic_extension_leaves.py
    [10% of tests run, 6.54 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 6.6 seconds
    cpu time: 20.0 seconds
    cumulative wall time: 21.1 seconds
```

CC:  @embray @nthiery @roed314

Work_Issues: is the patchbot happy?

Reviewer: Erik Bray

Author: Julian RÃ¼th

Branch: a4614abfd029249ce92219204f8dd5c012b99068

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25270





---

archive/issue_comments_374940.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [bar.png](tarball://root/attachments/some-uuid/ticket25270/bar.png) by @saraedum created at 2018-04-30 23:50:15",
    "created_at": "2018-04-30T23:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374940",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:1'></a>Attachment [bar.png](tarball://root/attachments/some-uuid/ticket25270/bar.png) by @saraedum created at 2018-04-30 23:50:15



---

archive/issue_comments_374941.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.\n+\n+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)\n \n It would be nice to add a `--limit=40:00` switch (or similar) to run doctests in each module for at most the corresponding fraction of time (I still have to try whether it's better to do the accounting by module or by line of doctest.)\n \n``````\n",
    "created_at": "2018-04-30T23:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374941",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.
+
+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)
 
 It would be nice to add a `--limit=40:00` switch (or similar) to run doctests in each module for at most the corresponding fraction of time (I still have to try whether it's better to do the accounting by module or by line of doctest.)
 
``````




---

archive/issue_comments_374942.json:
```json
{
    "body": "<a id='comment:4'></a>I have a first prototype now. If I set it to try to finish in 30s walltime and run on `src/sage/rings/padics`, it does skip tests in only 4 files (here reported as failures at the moment):\n\n```\nsage -t ../rings/padics/padic_base_leaves.py  # 125 doctests failed\nsage -t ../rings/padics/padic_lattice_element.py  # 303 doctests failed\nsage -t ../rings/padics/padic_extension_leaves.py  # 72 doctests failed\nsage -t ../rings/padics/padic_generic_element.pyx  # 172 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 35.8 seconds\n```\n\nAs an extreme example, if let it test everything in `src/` in two minutes, it manages to finish within four minutes (because it does not actually abort any doctest line once it started) and runs 314607 docstring lines and skips 361692, so it skips roughly 50%.",
    "created_at": "2018-05-01T01:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374942",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>I have a first prototype now. If I set it to try to finish in 30s walltime and run on `src/sage/rings/padics`, it does skip tests in only 4 files (here reported as failures at the moment):

```
sage -t ../rings/padics/padic_base_leaves.py  # 125 doctests failed
sage -t ../rings/padics/padic_lattice_element.py  # 303 doctests failed
sage -t ../rings/padics/padic_extension_leaves.py  # 72 doctests failed
sage -t ../rings/padics/padic_generic_element.pyx  # 172 doctests failed
----------------------------------------------------------------------
Total time for all tests: 35.8 seconds
```

As an extreme example, if let it test everything in `src/` in two minutes, it manages to finish within four minutes (because it does not actually abort any doctest line once it started) and runs 314607 docstring lines and skips 361692, so it skips roughly 50%.



---

archive/issue_comments_374943.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2018-06-09T21:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374943",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_374944.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.\n \n+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)\n+\n+This ticket implements a `--short [SECONDS=300]` switch which runs as many doctests as possible (from the top of each module) as possible in SECONDS.\n+\n+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short src` before I leave the rest to the patchbot.\n \n Summary: Add option to only run --short doctests\n \n``````\n",
    "created_at": "2018-06-09T21:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374944",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.
 
+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)
+
+This ticket implements a `--short [SECONDS=300]` switch which runs as many doctests as possible (from the top of each module) as possible in SECONDS.
+
+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short src` before I leave the rest to the patchbot.
 
 Summary: Add option to only run --short doctests
 
``````




---

archive/issue_comments_374945.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.\n \n+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)\n+\n+This ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).\n+\n+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.\n \n Summary: Add option to only run --short doctests\n \n``````\n",
    "created_at": "2018-06-09T21:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374945",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.
 
+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)
+
+This ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).
+
+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.
 
 Summary: Add option to only run --short doctests
 
``````




---

archive/issue_comments_374946.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,61 @@\n+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.\n \n+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)\n+\n+This ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).\n+\n+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.\n+\n+Here is an example:\n+\n+```\n+> sage -tp --short 2 src/sage/rings/padics/*.py\n+Doctesting 19 files using 4 threads.\n+sage -t src/sage/rings/padics/padic_extension_leaves.py\n+    [68/155 tests, 0.69 s]\n+sage -t src/sage/rings/padics/padic_base_generic.py\n+    [43/102 tests, 0.73 s]\n+sage -t src/sage/rings/padics/padic_valuation.py\n+    [183/413 tests, 0.69 s]\n+sage -t src/sage/rings/padics/padic_base_leaves.py\n+    [212/452 tests, 0.77 s]\n+sage -t src/sage/rings/padics/local_generic.py\n+    [140/310 tests, 0.73 s]\n+sage -t src/sage/rings/padics/lattice_precision.py\n+    [456/982 tests, 0.76 s]\n+sage -t src/sage/rings/padics/factory.py\n+    [502/1034 tests, 0.72 s]\n+sage -t src/sage/rings/padics/padic_generic.py\n+    [170/388 tests, 0.74 s]\n+sage -t src/sage/rings/padics/unramified_extension_generic.py\n+    [27/69 tests, 0.41 s]\n+sage -t src/sage/rings/padics/tutorial.py\n+    [45/91 tests, 0.00 s]\n+sage -t src/sage/rings/padics/misc.py\n+    [26/57 tests, 0.00 s]\n+sage -t src/sage/rings/padics/eisenstein_extension_generic.py\n+    [43/97 tests, 0.00 s]\n+sage -t src/sage/rings/padics/tests.py\n+    [12/25 tests, 0.00 s]\n+sage -t src/sage/rings/padics/precision_error.py\n+    [0 tests, 0.00 s]\n+sage -t src/sage/rings/padics/generic_nodes.py\n+    [143/316 tests, 0.72 s]\n+sage -t src/sage/rings/padics/__init__.py\n+    [0 tests, 0.00 s]\n+sage -t src/sage/rings/padics/all.py\n+    [0 tests, 0.00 s]\n+sage -t src/sage/rings/padics/padic_extension_generic.py\n+    [84/181 tests, 0.74 s]\n+sage -t src/sage/rings/padics/padic_lattice_element.py\n+    [263/561 tests, 0.70 s]\n+----------------------------------------------------------------------\n+All tests passed!\n+----------------------------------------------------------------------\n+Total time for all tests: 2.7 seconds\n+    cpu time: 8.1 seconds\n+    cumulative wall time: 8.4 seconds\n+```\n \n Summary: Add option to only run --short doctests\n \n``````\n",
    "created_at": "2018-06-09T21:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374946",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,61 @@
+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.
 
+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)
+
+This ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).
+
+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.
+
+Here is an example:
+
+```
+> sage -tp --short 2 src/sage/rings/padics/*.py
+Doctesting 19 files using 4 threads.
+sage -t src/sage/rings/padics/padic_extension_leaves.py
+    [68/155 tests, 0.69 s]
+sage -t src/sage/rings/padics/padic_base_generic.py
+    [43/102 tests, 0.73 s]
+sage -t src/sage/rings/padics/padic_valuation.py
+    [183/413 tests, 0.69 s]
+sage -t src/sage/rings/padics/padic_base_leaves.py
+    [212/452 tests, 0.77 s]
+sage -t src/sage/rings/padics/local_generic.py
+    [140/310 tests, 0.73 s]
+sage -t src/sage/rings/padics/lattice_precision.py
+    [456/982 tests, 0.76 s]
+sage -t src/sage/rings/padics/factory.py
+    [502/1034 tests, 0.72 s]
+sage -t src/sage/rings/padics/padic_generic.py
+    [170/388 tests, 0.74 s]
+sage -t src/sage/rings/padics/unramified_extension_generic.py
+    [27/69 tests, 0.41 s]
+sage -t src/sage/rings/padics/tutorial.py
+    [45/91 tests, 0.00 s]
+sage -t src/sage/rings/padics/misc.py
+    [26/57 tests, 0.00 s]
+sage -t src/sage/rings/padics/eisenstein_extension_generic.py
+    [43/97 tests, 0.00 s]
+sage -t src/sage/rings/padics/tests.py
+    [12/25 tests, 0.00 s]
+sage -t src/sage/rings/padics/precision_error.py
+    [0 tests, 0.00 s]
+sage -t src/sage/rings/padics/generic_nodes.py
+    [143/316 tests, 0.72 s]
+sage -t src/sage/rings/padics/__init__.py
+    [0 tests, 0.00 s]
+sage -t src/sage/rings/padics/all.py
+    [0 tests, 0.00 s]
+sage -t src/sage/rings/padics/padic_extension_generic.py
+    [84/181 tests, 0.74 s]
+sage -t src/sage/rings/padics/padic_lattice_element.py
+    [263/561 tests, 0.70 s]
+----------------------------------------------------------------------
+All tests passed!
+----------------------------------------------------------------------
+Total time for all tests: 2.7 seconds
+    cpu time: 8.1 seconds
+    cumulative wall time: 8.4 seconds
+```
 
 Summary: Add option to only run --short doctests
 
``````




---

archive/issue_comments_374947.json:
```json
{
    "body": "<a id='comment:9'></a>I still need some doctests for this but if somebody already wants to comment on this, I would be very happy about some feedback.\n\nSomehow my counting is off quite a bit. I am not entirely sure what's the problem.",
    "created_at": "2018-06-09T21:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374947",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:9'></a>I still need some doctests for this but if somebody already wants to comment on this, I would be very happy about some feedback.

Somehow my counting is off quite a bit. I am not entirely sure what's the problem.



---

archive/issue_comments_374948.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,61 @@\n+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.\n \n+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)\n+\n+This ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).\n+\n+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.\n+\n+Here is an example:\n+\n+```\n+> sage -tp --short 5 src/sage/rings/padics/*.py\n+Doctesting 19 files using 4 threads.\n+sage -t src/sage/rings/padics/padic_base_leaves.py\n+    [14% of tests run, 1.31 s]\n+sage -t src/sage/rings/padics/factory.py\n+    [29% of tests run, 1.31 s]\n+sage -t src/sage/rings/padics/lattice_precision.py\n+    [43% of tests run, 1.00 s]\n+sage -t src/sage/rings/padics/padic_valuation.py\n+    [4% of tests run, 2.80 s]\n+sage -t src/sage/rings/padics/padic_base_generic.py\n+    [95% of tests run, 1.72 s]\n+sage -t src/sage/rings/padics/local_generic.py\n+    [1% of tests run, 0.73 s]\n+sage -t src/sage/rings/padics/padic_extension_generic.py\n+    [5% of tests run, 0.77 s]\n+sage -t src/sage/rings/padics/padic_lattice_element.py\n+    [2% of tests run, 0.78 s]\n+sage -t src/sage/rings/padics/generic_nodes.py\n+    [1% of tests run, 0.75 s]\n+sage -t src/sage/rings/padics/padic_generic.py\n+    [1% of tests run, 0.73 s]\n+sage -t src/sage/rings/padics/unramified_extension_generic.py\n+    [2% of tests run, 0.43 s]\n+sage -t src/sage/rings/padics/tutorial.py\n+    [4% of tests run, 0.70 s]\n+sage -t src/sage/rings/padics/tests.py\n+    [0% of tests run, 0.00 s]\n+sage -t src/sage/rings/padics/eisenstein_extension_generic.py\n+    [7% of tests run, 0.80 s]\n+sage -t src/sage/rings/padics/misc.py\n+    [6% of tests run, 0.78 s]\n+sage -t src/sage/rings/padics/precision_error.py\n+    [0 tests, 0.00 s]\n+sage -t src/sage/rings/padics/all.py\n+    [0 tests, 0.00 s]\n+sage -t src/sage/rings/padics/__init__.py\n+    [0 tests, 0.00 s]\n+sage -t src/sage/rings/padics/padic_extension_leaves.py\n+    [10% of tests run, 6.54 s]\n+----------------------------------------------------------------------\n+All tests passed!\n+----------------------------------------------------------------------\n+Total time for all tests: 6.6 seconds\n+    cpu time: 20.0 seconds\n+    cumulative wall time: 21.1 seconds\n+```\n \n Summary: Add option to only run --short doctests\n \n``````\n",
    "created_at": "2018-06-10T20:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374948",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,61 @@
+The attached picture shows how many modules (horizontal) you can run in how many CPU minutes (vertical). So, for example, in 40 CPU minutes (i.e., 10 wall minutes on my laptop) I can run all the doctests in 80% of all Sage modules. In 4 CPU minutes, I can doctest 50% of all Sage modules.
 
+[This is the Trac macro *Image* that was inherited from the migration called with arguments (bar.png,width=80%,center))](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)
+
+This ticket implements a `--short [SECONDS]` switch which runs as many doctests as possible (from the top of each module) in SECONDS (default 300).
+
+This gives us a quick way to check that a change did not break things too terribly. For example, when I work on p-adics, I would probably do: `sage -tp --short 30 src/sage/rings/padics` frequently. Once I am happy with my changes, I could do `sage -tp --short src/sage/rings`  and a final `sage -tp --short --all` before I leave the rest to the patchbot.
+
+Here is an example:
+
+```
+> sage -tp --short 5 src/sage/rings/padics/*.py
+Doctesting 19 files using 4 threads.
+sage -t src/sage/rings/padics/padic_base_leaves.py
+    [14% of tests run, 1.31 s]
+sage -t src/sage/rings/padics/factory.py
+    [29% of tests run, 1.31 s]
+sage -t src/sage/rings/padics/lattice_precision.py
+    [43% of tests run, 1.00 s]
+sage -t src/sage/rings/padics/padic_valuation.py
+    [4% of tests run, 2.80 s]
+sage -t src/sage/rings/padics/padic_base_generic.py
+    [95% of tests run, 1.72 s]
+sage -t src/sage/rings/padics/local_generic.py
+    [1% of tests run, 0.73 s]
+sage -t src/sage/rings/padics/padic_extension_generic.py
+    [5% of tests run, 0.77 s]
+sage -t src/sage/rings/padics/padic_lattice_element.py
+    [2% of tests run, 0.78 s]
+sage -t src/sage/rings/padics/generic_nodes.py
+    [1% of tests run, 0.75 s]
+sage -t src/sage/rings/padics/padic_generic.py
+    [1% of tests run, 0.73 s]
+sage -t src/sage/rings/padics/unramified_extension_generic.py
+    [2% of tests run, 0.43 s]
+sage -t src/sage/rings/padics/tutorial.py
+    [4% of tests run, 0.70 s]
+sage -t src/sage/rings/padics/tests.py
+    [0% of tests run, 0.00 s]
+sage -t src/sage/rings/padics/eisenstein_extension_generic.py
+    [7% of tests run, 0.80 s]
+sage -t src/sage/rings/padics/misc.py
+    [6% of tests run, 0.78 s]
+sage -t src/sage/rings/padics/precision_error.py
+    [0 tests, 0.00 s]
+sage -t src/sage/rings/padics/all.py
+    [0 tests, 0.00 s]
+sage -t src/sage/rings/padics/__init__.py
+    [0 tests, 0.00 s]
+sage -t src/sage/rings/padics/padic_extension_leaves.py
+    [10% of tests run, 6.54 s]
+----------------------------------------------------------------------
+All tests passed!
+----------------------------------------------------------------------
+Total time for all tests: 6.6 seconds
+    cpu time: 20.0 seconds
+    cumulative wall time: 21.1 seconds
+```
 
 Summary: Add option to only run --short doctests
 
``````




---

archive/issue_comments_374949.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-10T20:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374949",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_374950.json:
```json
{
    "body": "<a id='comment:12'></a>I am quite unhappy with the spaghetti code that I added here but I don't really see a much better way. I have a feeling that we cramped a lot of features already into Python's doctesting framework and that it was never meant to be extended like that. A proper plugin system would have been cool but I guess it's too late for that ;)",
    "created_at": "2018-06-10T20:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374950",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:12'></a>I am quite unhappy with the spaghetti code that I added here but I don't really see a much better way. I have a feeling that we cramped a lot of features already into Python's doctesting framework and that it was never meant to be extended like that. A proper plugin system would have been cool but I guess it's too late for that ;)



---

archive/issue_comments_374951.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-11T06:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374952.json:
```json
{
    "body": "<a id='comment:14'></a>Needs to be rebased it looks like.  I can't wait to see this working though, and if I have some ideas how to improve the implementation I'll give them.",
    "created_at": "2018-06-27T14:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374952",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>Needs to be rebased it looks like.  I can't wait to see this working though, and if I have some ideas how to improve the implementation I'll give them.



---

archive/issue_comments_374953.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T15:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374954.json:
```json
{
    "body": "<a id='comment:16'></a>Ok. I rebased this.",
    "created_at": "2018-07-03T15:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374954",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:16'></a>Ok. I rebased this.



---

archive/issue_comments_374955.json:
```json
{
    "body": "<a id='comment:17'></a>I wish we also had a way to prioritize tests.  E.g. we could mark a test as `# important` and ensure all such tests get run first.  That could be added later though.",
    "created_at": "2018-07-10T13:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374955",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>I wish we also had a way to prioritize tests.  E.g. we could mark a test as `# important` and ensure all such tests get run first.  That could be added later though.



---

archive/issue_comments_374956.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-10T13:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374956",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_374957.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-07-11T05:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_374958.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-07-11T05:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_374959.json:
```json
{
    "body": "<a id='comment:19'></a>Rebased again. Somehow the patchbots fail to build this, probably they are broken atm.",
    "created_at": "2018-07-11T05:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374959",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:19'></a>Rebased again. Somehow the patchbots fail to build this, probably they are broken atm.



---

archive/issue_comments_374960.json:
```json
{
    "body": "<a id='comment:20'></a>My patchbot Ubuntu/18.04/x86_64/3.13.0-123-generic/sagemath-patchbot-docker was broken for a few days due to running out of disk space.  It should be working now though.",
    "created_at": "2018-07-11T11:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374960",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>My patchbot Ubuntu/18.04/x86_64/3.13.0-123-generic/sagemath-patchbot-docker was broken for a few days due to running out of disk space.  It should be working now though.



---

archive/issue_comments_374961.json:
```json
{
    "body": "<a id='comment:21'></a>This will only work if the full testsuite is run at least once and allowed to save state right?\n\nI'd love something like this for distribution CI (testing weather or not a dependency update breaks sage), but if thats the case it couldn't be used for that. Something like `#important` would be good in that case.",
    "created_at": "2018-07-11T11:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374961",
    "user": "https://github.com/timokau"
}
```

<a id='comment:21'></a>This will only work if the full testsuite is run at least once and allowed to save state right?

I'd love something like this for distribution CI (testing weather or not a dependency update breaks sage), but if thats the case it couldn't be used for that. Something like `#important` would be good in that case.



---

archive/issue_comments_374962.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 gh-timokau]:\n> This will only work if the full testsuite is run at least once and allowed to save state right?\nNo. The changes proposed here do not rely on saved state.",
    "created_at": "2018-07-11T12:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374962",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:22'></a>Replying to [comment:21 gh-timokau]:
> This will only work if the full testsuite is run at least once and allowed to save state right?
No. The changes proposed here do not rely on saved state.



---

archive/issue_comments_374963.json:
```json
{
    "body": "<a id='comment:23'></a>Thats great! The code is a bit hard to read without context and I don't want to dig too deeply. How does it determine which tests to skip then? Just allocate equal time to each file and abort remaining tests if the time budged is used up?",
    "created_at": "2018-07-11T13:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374963",
    "user": "https://github.com/timokau"
}
```

<a id='comment:23'></a>Thats great! The code is a bit hard to read without context and I don't want to dig too deeply. How does it determine which tests to skip then? Just allocate equal time to each file and abort remaining tests if the time budged is used up?



---

archive/issue_comments_374964.json:
```json
{
    "body": "<a id='comment:24'></a>Yes. It allocates equal time and starts testing from the top.",
    "created_at": "2018-07-11T13:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374964",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:24'></a>Yes. It allocates equal time and starts testing from the top.



---

archive/issue_comments_374965.json:
```json
{
    "body": "<a id='comment:25'></a>This also needs to be documented in `src/doc/en/reference/repl/options.rst`.",
    "created_at": "2018-07-11T15:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374965",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>This also needs to be documented in `src/doc/en/reference/repl/options.rst`.



---

archive/issue_comments_374966.json:
```json
{
    "body": "<a id='comment:26'></a>Does the `[SECONDS]` argument refer to the total time for testing, or the time for each file? When I ran `sage --tp --short 15 src/sage`, it spent much less than 15 seconds on each file before giving up.",
    "created_at": "2018-07-11T15:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374966",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>Does the `[SECONDS]` argument refer to the total time for testing, or the time for each file? When I ran `sage --tp --short 15 src/sage`, it spent much less than 15 seconds on each file before giving up.



---

archive/issue_comments_374967.json:
```json
{
    "body": "<a id='comment:27'></a>The [SECONDS] are the total amount of time.",
    "created_at": "2018-07-11T15:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374967",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:27'></a>The [SECONDS] are the total amount of time.



---

archive/issue_comments_374968.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-11T15:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374968",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_374969.json:
```json
{
    "body": "<a id='comment:28'></a>I am getting a doctest failure from `sage -tp --short 600 src/sage/`:\n\n```\nsage -t src/sage/doctest/reporting.py\n**********************************************************************\nFile \"src/sage/doctest/reporting.py\", line 324, in sage.doctest.reporting.DocTestReporter.report\nFailed example:\n    DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), \"Good tests\")\nExpected:\n        1 unlabeled test not run\n        4 long tests not run\n        5 magma tests not run\n        2 other tests skipped\n        [... tests, ... s]\nGot:\n        1 unlabeled test not run\n        4 long tests not run\n        5 magma tests not run\n        2 not tested tests not run\n        0 tests not run because we ran out of time\n        [126 tests, 0.00 s]\n**********************************************************************\nFile \"src/sage/doctest/reporting.py\", line 350, in sage.doctest.reporting.DocTestReporter.report\nFailed example:\n    DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), \"Good tests\")\nExpected nothing\nGot:\n        [126 tests, 0.00 s]\n**********************************************************************\n1 item had failures:\n   2 of  57 in sage.doctest.reporting.DocTestReporter.report\n    [120 tests, 2 failures, 0.54 s]\n```",
    "created_at": "2018-07-11T15:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374969",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>I am getting a doctest failure from `sage -tp --short 600 src/sage/`:

```
sage -t src/sage/doctest/reporting.py
**********************************************************************
File "src/sage/doctest/reporting.py", line 324, in sage.doctest.reporting.DocTestReporter.report
Failed example:
    DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), "Good tests")
Expected:
        1 unlabeled test not run
        4 long tests not run
        5 magma tests not run
        2 other tests skipped
        [... tests, ... s]
Got:
        1 unlabeled test not run
        4 long tests not run
        5 magma tests not run
        2 not tested tests not run
        0 tests not run because we ran out of time
        [126 tests, 0.00 s]
**********************************************************************
File "src/sage/doctest/reporting.py", line 350, in sage.doctest.reporting.DocTestReporter.report
Failed example:
    DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), "Good tests")
Expected nothing
Got:
        [126 tests, 0.00 s]
**********************************************************************
1 item had failures:
   2 of  57 in sage.doctest.reporting.DocTestReporter.report
    [120 tests, 2 failures, 0.54 s]
```



---

archive/issue_comments_374970.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-12T12:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374970",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374971.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-12T12:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374971",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_374972.json:
```json
{
    "body": "<a id='comment:30'></a>New commits:",
    "created_at": "2018-07-12T12:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374972",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:30'></a>New commits:



---

archive/issue_comments_374973.json:
```json
{
    "body": "<a id='comment:31'></a>Let's see what the patchbot says (if indeed I've actually managed to fix it...)",
    "created_at": "2018-07-12T12:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374973",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Let's see what the patchbot says (if indeed I've actually managed to fix it...)



---

archive/issue_comments_374974.json:
```json
{
    "body": "<a id='comment:32'></a>Got a few test failures in `sage.doctest` that seem relevant :)",
    "created_at": "2018-07-12T18:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374974",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'></a>Got a few test failures in `sage.doctest` that seem relevant :)



---

archive/issue_comments_374975.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-12T18:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374975",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_374976.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-20T07:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374977.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-20T07:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374977",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374978.json:
```json
{
    "body": "<a id='comment:36'></a>New commits:",
    "created_at": "2018-07-20T07:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374978",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:36'></a>New commits:



---

archive/issue_comments_374979.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-20T07:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374979",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_374980.json:
```json
{
    "body": "<a id='comment:37'></a>Still getting a failure:\n\n```\nsage -t --long src/sage/doctest/reporting.py\n**********************************************************************\nFile \"src/sage/doctest/reporting.py\", line 351, in sage.doctest.reporting.DocTestReporter.report\nFailed example:\n    DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), \"Good tests\")\nExpected nothing\nGot:\n        [126 tests, 0.00 s]\n**********************************************************************\n1 item had failures:\n   1 of  57 in sage.doctest.reporting.DocTestReporter.report\n    [120 tests, 1 failure, 0.52 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/doctest/reporting.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nI've seen some cases before where the expected output was accidentally left off a doctest, and the doctest runner just ignored that, seemingly buggily, whereas fixing/changing things in the doctest runner made it start expecting output again.  Could this be something like that?",
    "created_at": "2018-07-23T16:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374980",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>Still getting a failure:

```
sage -t --long src/sage/doctest/reporting.py
**********************************************************************
File "src/sage/doctest/reporting.py", line 351, in sage.doctest.reporting.DocTestReporter.report
Failed example:
    DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), "Good tests")
Expected nothing
Got:
        [126 tests, 0.00 s]
**********************************************************************
1 item had failures:
   1 of  57 in sage.doctest.reporting.DocTestReporter.report
    [120 tests, 1 failure, 0.52 s]
----------------------------------------------------------------------
sage -t --long src/sage/doctest/reporting.py  # 1 doctest failed
----------------------------------------------------------------------
```

I've seen some cases before where the expected output was accidentally left off a doctest, and the doctest runner just ignored that, seemingly buggily, whereas fixing/changing things in the doctest runner made it start expecting output again.  Could this be something like that?



---

archive/issue_comments_374981.json:
```json
{
    "body": "<a id='comment:38'></a>Maybe?",
    "created_at": "2018-07-23T16:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374981",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'></a>Maybe?



---

archive/issue_comments_374982.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-23T16:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374982",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_374983.json:
```json
{
    "body": "<a id='comment:39'></a>If my fast build machine weren't down I'd test to see if I could reproduce this manually.",
    "created_at": "2018-07-23T16:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374983",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'></a>If my fast build machine weren't down I'd test to see if I could reproduce this manually.



---

archive/issue_comments_374984.json:
```json
{
    "body": "<a id='comment:40'></a>Yeah, I was able to reproduce the test failure locally just running `./sage -t src/sage/doctest/reporting.py`.",
    "created_at": "2018-07-24T08:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374984",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>Yeah, I was able to reproduce the test failure locally just running `./sage -t src/sage/doctest/reporting.py`.



---

archive/issue_comments_374985.json:
```json
{
    "body": "<a id='comment:41'></a>I think it's a legitimate regression, unlike my earlier guess.  The failure is here:\n\n```\n        The only-errors mode does not output anything on success::\n\n            sage: DD = DocTestDefaults(only_errors=True)\n            sage: FDS = FileDocTestSource(filename, DD)\n            sage: DC = DocTestController(DD, [filename])\n            sage: DTR = DocTestReporter(DC)\n            sage: doctests, extras = FDS.create_doctests(globals())\n            sage: runner = SageDocTestRunner(SageOutputChecker(), verbose=False, sage_options=DD, optionflags=doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS)\n            sage: Timer().start().stop().annotate(runner)\n            sage: D = DictAsObject({'err':None})\n            sage: runner.update_results(D)\n            0\n            sage: DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), \"Good tests\")\n\n        However, failures are still output in the errors-only mode::\n\n            sage: runner.failures = 1\n            sage: runner.update_results(D)\n            1\n            sage: DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), \"Failed test\")\n                [... tests, 1 failure, ... s]\n\n```\n\nThe intent of the test is that nothing should be output by `DocTestRunner.report` if it's in \"only-errors mode\" (a thing I didn't know existed), and there are no failures.",
    "created_at": "2018-07-24T08:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374985",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>I think it's a legitimate regression, unlike my earlier guess.  The failure is here:

```
        The only-errors mode does not output anything on success::

            sage: DD = DocTestDefaults(only_errors=True)
            sage: FDS = FileDocTestSource(filename, DD)
            sage: DC = DocTestController(DD, [filename])
            sage: DTR = DocTestReporter(DC)
            sage: doctests, extras = FDS.create_doctests(globals())
            sage: runner = SageDocTestRunner(SageOutputChecker(), verbose=False, sage_options=DD, optionflags=doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS)
            sage: Timer().start().stop().annotate(runner)
            sage: D = DictAsObject({'err':None})
            sage: runner.update_results(D)
            0
            sage: DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), "Good tests")

        However, failures are still output in the errors-only mode::

            sage: runner.failures = 1
            sage: runner.update_results(D)
            1
            sage: DTR.report(FDS, False, 0, (sum([len(t.examples) for t in doctests]), D), "Failed test")
                [... tests, 1 failure, ... s]

```

The intent of the test is that nothing should be output by `DocTestRunner.report` if it's in "only-errors mode" (a thing I didn't know existed), and there are no failures.



---

archive/issue_comments_374986.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-28T13:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374986",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374987.json:
```json
{
    "body": "<a id='comment:43'></a>Ok. I had somehow removed the line about the `only_errors` flag. I put it back in.",
    "created_at": "2018-07-28T13:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374987",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:43'></a>Ok. I had somehow removed the line about the `only_errors` flag. I put it back in.



---

archive/issue_comments_374988.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-28T13:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374988",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_374989.json:
```json
{
    "body": "<a id='comment:44'></a>Ok, positive review from me then pending results from a patchbot or two.\n\nMine were down all weekend so they'll probably need a day or 2 to get to it.",
    "created_at": "2018-07-30T16:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374989",
    "user": "https://github.com/embray"
}
```

<a id='comment:44'></a>Ok, positive review from me then pending results from a patchbot or two.

Mine were down all weekend so they'll probably need a day or 2 to get to it.



---

archive/issue_comments_374990.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-07T16:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374990",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374991.json:
```json
{
    "body": "<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-16T22:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374991",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374992.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-20T20:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374992",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_374993.json:
```json
{
    "body": "<a id='comment:47'></a>Finally, there was a happy patchbot based off 8.4.beta1 :)",
    "created_at": "2018-08-20T20:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374993",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:47'></a>Finally, there was a happy patchbot based off 8.4.beta1 :)



---

archive/issue_comments_374994.json:
```json
{
    "body": "<a id='comment:48'></a>I am not sure that's the right approach here when looking at patchbot outputs but the patchbots are so flaky lately, that I just assume that \"build fails\" has nothing to do with this ticket.",
    "created_at": "2018-08-20T20:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374994",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:48'></a>I am not sure that's the right approach here when looking at patchbot outputs but the patchbots are so flaky lately, that I just assume that "build fails" has nothing to do with this ticket.



---

archive/issue_comments_374995.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-08-20T20:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374995",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_374996.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-08-20T20:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374996",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_374997.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-20T20:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_374998.json:
```json
{
    "body": "<a id='comment:51'></a>Sorry for this noise. I had pushed something to the wrong ticket. Reverted back to the reviewed state.",
    "created_at": "2018-08-20T20:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374998",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:51'></a>Sorry for this noise. I had pushed something to the wrong ticket. Reverted back to the reviewed state.



---

archive/issue_comments_374999.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-20T20:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-374999",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375000.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-26T09:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375000",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_375001.json:
```json
{
    "body": "<a id='comment:52'></a>Merge conflict",
    "created_at": "2018-08-26T09:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375001",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:52'></a>Merge conflict



---

archive/issue_comments_375002.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-26T11:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375002",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375003.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-26T11:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375003",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375004.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-02T12:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375004",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_375005.json:
```json
{
    "body": "<a id='comment:56'></a>embray: I sometimes get\n\n```\nError in atexit._run_exitfuncs:\nTraceback (most recent call last):\n  File \"/home/sage/sage/local/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"<doctest sage.cpython.atexit[2]>\", line 2, in handler\nNameError: global name 'print' is not defined\nsage -t sage/src/sage/cpython/atexit.pyx\n    NameError in doctesting framework\n**********************************************************************\nTests run before doctest exception:\nsage: import atexit ## line 54 ##\nsage: from sage.cpython.atexit import restore_atexit ## line 55 ##\nsage: def handler(*args, **kwargs):\n    print((args, kwargs)) ## line 56 ##\nsage: atexit.register(handler, 1, 2, c=3) ## line 58 ##\n<function handler at 0x7f3ee18f41b8>\n\n**********************************************************************\nTraceback (most recent call last):\n  File \"/home/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2426, in __call__\n    break\n  File \"sage/cpython/atexit.pyx\", line 143, in sage.cpython.atexit.restore_atexit.__exit__ (build/cythonized/sage/cpython/atexit.c:1497)\n    atexit._run_exitfuncs()\n  File \"/home/sage/sage/local/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs\n    func(*targs, **kargs)\n  File \"<doctest sage.cpython.atexit[2]>\", line 2, in handler\nNameError: global name 'print' is not defined\n```\n\nI guess this happens when the tests in `atexit` are only run partially and maybe some cleanup that is part of the doctests did not happen.\n\nSince you're listed as the author of that file, any clue what's going on here?",
    "created_at": "2018-09-02T12:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375005",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:56'></a>embray: I sometimes get

```
Error in atexit._run_exitfuncs:
Traceback (most recent call last):
  File "/home/sage/sage/local/lib/python2.7/atexit.py", line 24, in _run_exitfuncs
    func(*targs, **kargs)
  File "<doctest sage.cpython.atexit[2]>", line 2, in handler
NameError: global name 'print' is not defined
sage -t sage/src/sage/cpython/atexit.pyx
    NameError in doctesting framework
**********************************************************************
Tests run before doctest exception:
sage: import atexit ## line 54 ##
sage: from sage.cpython.atexit import restore_atexit ## line 55 ##
sage: def handler(*args, **kwargs):
    print((args, kwargs)) ## line 56 ##
sage: atexit.register(handler, 1, 2, c=3) ## line 58 ##
<function handler at 0x7f3ee18f41b8>

**********************************************************************
Traceback (most recent call last):
  File "/home/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2426, in __call__
    break
  File "sage/cpython/atexit.pyx", line 143, in sage.cpython.atexit.restore_atexit.__exit__ (build/cythonized/sage/cpython/atexit.c:1497)
    atexit._run_exitfuncs()
  File "/home/sage/sage/local/lib/python2.7/atexit.py", line 24, in _run_exitfuncs
    func(*targs, **kargs)
  File "<doctest sage.cpython.atexit[2]>", line 2, in handler
NameError: global name 'print' is not defined
```

I guess this happens when the tests in `atexit` are only run partially and maybe some cleanup that is part of the doctests did not happen.

Since you're listed as the author of that file, any clue what's going on here?



---

archive/issue_comments_375006.json:
```json
{
    "body": "<a id='comment:57'></a>Hmm--I think maybe, if nothing else, there should be a `from __future__ import print_function` in that module, which there currently is not.  I'm not positive that that's the problem though.  I'd have to try to reproduce it first.",
    "created_at": "2018-09-03T08:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375006",
    "user": "https://github.com/embray"
}
```

<a id='comment:57'></a>Hmm--I think maybe, if nothing else, there should be a `from __future__ import print_function` in that module, which there currently is not.  I'm not positive that that's the problem though.  I'd have to try to reproduce it first.



---

archive/issue_comments_375007.json:
```json
{
    "body": "<a id='comment:58'></a>Strange, though, since looking at `sage.doctest.forker` all doctests are supposed to be compiled as though `from __future__ import print_function` was present.  Maybe, somehow, just including the required compile flags isn't enough to ensure that the `print()` function is in the globals?",
    "created_at": "2018-09-03T08:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375007",
    "user": "https://github.com/embray"
}
```

<a id='comment:58'></a>Strange, though, since looking at `sage.doctest.forker` all doctests are supposed to be compiled as though `from __future__ import print_function` was present.  Maybe, somehow, just including the required compile flags isn't enough to ensure that the `print()` function is in the globals?



---

archive/issue_comments_375008.json:
```json
{
    "body": "<a id='comment:59'></a>For the atexit tests, does that happen if you test `src/sage/cpython/atexit.pyx` directly?  Or does it only happen when running the full test suite with `./sage --short`?",
    "created_at": "2018-09-05T15:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375008",
    "user": "https://github.com/embray"
}
```

<a id='comment:59'></a>For the atexit tests, does that happen if you test `src/sage/cpython/atexit.pyx` directly?  Or does it only happen when running the full test suite with `./sage --short`?



---

archive/issue_events_063366.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-06T09:32:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25270#event-63366"
}
```



---

archive/issue_comments_375009.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T11:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375010.json:
```json
{
    "body": "<a id='comment:62'></a>embray, I don't think we should put too much effort into fixing this rather obscure problem as it is going to go away with Python 3 anyway. I added a simple workaround (untested.) Would you be fine with something like this?\n\n---\nNew commits:",
    "created_at": "2018-10-08T11:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375010",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:62'></a>embray, I don't think we should put too much effort into fixing this rather obscure problem as it is going to go away with Python 3 anyway. I added a simple workaround (untested.) Would you be fine with something like this?

---
New commits:



---

archive/issue_comments_375011.json:
```json
{
    "body": "<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T11:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375012.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-08T11:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375012",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375013.json:
```json
{
    "body": "<a id='comment:65'></a>Yes, I think this is entirely reasonable.  Relying on module-level globals that may already be set to `None` during interpreter shutdown can always be a problem.  Here instead you were getting a `NameError` which is a bit more strange to me, but almost certainly has some strange interplay with how `from __future__ import print_function` works.\n\nPositive review from me pending patchbot results, but I think it will be fine...",
    "created_at": "2018-10-08T11:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375013",
    "user": "https://github.com/embray"
}
```

<a id='comment:65'></a>Yes, I think this is entirely reasonable.  Relying on module-level globals that may already be set to `None` during interpreter shutdown can always be a problem.  Here instead you were getting a `NameError` which is a bit more strange to me, but almost certainly has some strange interplay with how `from __future__ import print_function` works.

Positive review from me pending patchbot results, but I think it will be fine...



---

archive/issue_comments_375014.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-08T11:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375014",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375015.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-20T19:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375015",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063367.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-20T19:02:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25270#event-63367"
}
```



---

archive/issue_events_063368.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T14:43:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25270#event-63368"
}
```



---

archive/issue_events_063369.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T14:43:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25270#event-63369"
}
```



---

archive/issue_comments_375016.json:
```json
{
    "body": "<a id='comment:67'></a>I assume?",
    "created_at": "2018-10-28T14:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25270#issuecomment-375016",
    "user": "https://github.com/embray"
}
```

<a id='comment:67'></a>I assume?
