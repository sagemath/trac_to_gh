# Issue 25320: Support older versions of backports.shutil_get_terminal_size

archive/issues_025083.json:
```json
{
    "assignees": [],
    "body": "Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks without spacing as follows:\n\n```\n    ZeroDivisionErrorTraceback (most recent call last)\n    ...\n    ZeroDivisionError: rational division by zero\n```\n\nApparently [debian has the same problem](https://salsa.debian.org/science-team/sagemath/blob/e063adfe71044302f7777bd1d4794f6b8ca31c8d/debian/patches/u2-fix-trivial-test-cases.patch#L47).\n\nThis patch makes the doctests accept both formats.\n\nBranch: **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)**\n\nReviewer: **Julian R\u00fcth**\n\nAuthor: **Timo Kaufmann**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25320_\n\n",
    "closed_at": "2018-07-08T13:05:27Z",
    "created_at": "2018-05-09T21:51:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Support older versions of backports.shutil_get_terminal_size",
    "type": "issue",
    "updated_at": "2018-10-28T09:52:12Z",
    "url": "https://github.com/sagemath/sage/issues/25320",
    "user": "https://github.com/timokau"
}
```
Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks without spacing as follows:

```
    ZeroDivisionErrorTraceback (most recent call last)
    ...
    ZeroDivisionError: rational division by zero
```

Apparently [debian has the same problem](https://salsa.debian.org/science-team/sagemath/blob/e063adfe71044302f7777bd1d4794f6b8ca31c8d/debian/patches/u2-fix-trivial-test-cases.patch#L47).

This patch makes the doctests accept both formats.

Branch: **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)**

Reviewer: **Julian Rüth**

Author: **Timo Kaufmann**

_Issue created by migration from https://trac.sagemath.org/ticket/25320_





---

archive/issue_events_320368.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-09T21:51:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320368"
}
```



---

archive/issue_events_320369.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-09T21:51:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting",
    "label_color": "000080",
    "label_name": "component: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320369"
}
```



---

archive/issue_events_320370.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-09T21:51:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320370"
}
```



---

archive/issue_events_320371.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-09T21:51:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320371"
}
```



---

archive/issue_events_320372.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-09T21:51:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320372"
}
```



---

archive/issue_events_320373.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-05-10T07:32:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320373"
}
```



---

archive/issue_events_320374.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-05-10T07:32:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320374"
}
```



---

archive/issue_comments_389970.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThere is a log file in the commit.",
    "created_at": "2018-05-10T07:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389970",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'>Comment 2:</a>
There is a log file in the commit.



---

archive/issue_comments_389971.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f79070ddd09fa0ad6b340b097bd8d690a7aa35f0\">f79070d</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n",
    "created_at": "2018-05-10T08:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389971",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f79070ddd09fa0ad6b340b097bd8d690a7aa35f0">f79070d</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>




---

archive/issue_comments_389972.json:
```json
{
    "body": "Changed commit from **[fb04c0c](https://github.com/sagemath/sagetrac-mirror/commit/fb04c0c183997674d0cda8a6bf9cb8c01f5c7fda)** to **[f79070d](https://github.com/sagemath/sagetrac-mirror/commit/f79070ddd09fa0ad6b340b097bd8d690a7aa35f0)**",
    "created_at": "2018-05-10T08:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389972",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fb04c0c](https://github.com/sagemath/sagetrac-mirror/commit/fb04c0c183997674d0cda8a6bf9cb8c01f5c7fda)** to **[f79070d](https://github.com/sagemath/sagetrac-mirror/commit/f79070ddd09fa0ad6b340b097bd8d690a7aa35f0)**



---

archive/issue_comments_389973.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nOh  sorry, I should've reviewed before pushing. Removed.",
    "created_at": "2018-05-10T08:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389973",
    "user": "https://github.com/timokau"
}
```

<a id='comment:4'>Comment 4:</a>
Oh  sorry, I should've reviewed before pushing. Removed.



---

archive/issue_events_320375.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-10T08:46:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320375"
}
```



---

archive/issue_events_320376.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-10T08:46:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320376"
}
```



---

archive/issue_comments_389974.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nYou need a patched version of https://github.com/chrippa/backports.shutil_get_terminal_size",
    "created_at": "2018-06-06T15:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389974",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'>Comment 5:</a>
You need a patched version of https://github.com/chrippa/backports.shutil_get_terminal_size



---

archive/issue_comments_389975.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,5 @@\n Apparently there are at least two formats for `ZeroDivisionError`s out there. Sage expects\n-\n-```\n-    ---------------------------------------------------------------------------\n-    ZeroDivisionError                         Traceback (most recent call last)\n-    ...\n-    ZeroDivisionError: rational division by zero\n-```\n-\n-while I get (with nix):\n+Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros shows tracebacks as follows:\n \n ```\n <BLANKLINE>\n@@ -16,7 +8,6 @@\n     ZeroDivisionError: rational division by zero\n ```\n \n-I'm not sure what is causing this difference. Apparently [debian has the same problem](https://salsa.debian.org/science-team/sagemath/blob/e063adfe71044302f7777bd1d4794f6b8ca31c8d/debian/patches/u2-fix-trivial-test-cases.patch#L47).\n+Apparently [debian has the same problem](https://salsa.debian.org/science-team/sagemath/blob/e063adfe71044302f7777bd1d4794f6b8ca31c8d/debian/patches/u2-fix-trivial-test-cases.patch#L47).\n \n This patch makes the doctests accept both formats.\n-\n``````\n",
    "created_at": "2018-06-06T15:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389975",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,5 @@
 Apparently there are at least two formats for `ZeroDivisionError`s out there. Sage expects
-
-```
-    ---------------------------------------------------------------------------
-    ZeroDivisionError                         Traceback (most recent call last)
-    ...
-    ZeroDivisionError: rational division by zero
-```
-
-while I get (with nix):
+Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros shows tracebacks as follows:
 
 ```
 <BLANKLINE>
@@ -16,7 +8,6 @@
     ZeroDivisionError: rational division by zero
 ```
 
-I'm not sure what is causing this difference. Apparently [debian has the same problem](https://salsa.debian.org/science-team/sagemath/blob/e063adfe71044302f7777bd1d4794f6b8ca31c8d/debian/patches/u2-fix-trivial-test-cases.patch#L47).
+Apparently [debian has the same problem](https://salsa.debian.org/science-team/sagemath/blob/e063adfe71044302f7777bd1d4794f6b8ca31c8d/debian/patches/u2-fix-trivial-test-cases.patch#L47).
 
 This patch makes the doctests accept both formats.
-
``````




---

archive/issue_comments_389976.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,4 @@\n-Apparently there are at least two formats for `ZeroDivisionError`s out there. Sage expects\n-Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros shows tracebacks as follows:\n+Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks as follows:\n \n ```\n <BLANKLINE>\n``````\n",
    "created_at": "2018-06-06T15:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389976",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,4 @@
-Apparently there are at least two formats for `ZeroDivisionError`s out there. Sage expects
-Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros shows tracebacks as follows:
+Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks as follows:
 
 ```
 <BLANKLINE>
``````




---

archive/issue_events_320377.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-06T15:03:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "title_is": "Support older versions of backports.shutil_get_terminal_size",
    "title_was": "Make ZeroDivisionError format more flexible",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320377"
}
```



---

archive/issue_comments_389977.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,6 @@\n-Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks as follows:\n+Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks without spacing as follows:\n \n ```\n-<BLANKLINE>\n     ZeroDivisionErrorTraceback (most recent call last)\n     ...\n     ZeroDivisionError: rational division by zero\n``````\n",
    "created_at": "2018-06-06T15:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389977",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,6 @@
-Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks as follows:
+Because of a broken version of [backports.shutil_get_terminal_size](https://github.com/chrippa/backports.shutil_get_terminal_size), some distros show tracebacks without spacing as follows:
 
 ```
-<BLANKLINE>
     ZeroDivisionErrorTraceback (most recent call last)
     ...
     ZeroDivisionError: rational division by zero
``````




---

archive/issue_comments_389978.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nIt seems like this patch was only included to fix this formatting error (#20599). This is a bit meta, but is there a general patching policy for sage?\n\nSage patches a lot of its dependencies and often has very good reasons to do so. But sometimes it is not strictly necessary. That makes life hard for packagers and also for the people maintaining the sage spkgs. In my opinion patching dependencies should be a last resort, only if there is pretty much no other option.",
    "created_at": "2018-06-06T15:13:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389978",
    "user": "https://github.com/timokau"
}
```

<a id='comment:9'>Comment 9:</a>
It seems like this patch was only included to fix this formatting error (#20599). This is a bit meta, but is there a general patching policy for sage?

Sage patches a lot of its dependencies and often has very good reasons to do so. But sometimes it is not strictly necessary. That makes life hard for packagers and also for the people maintaining the sage spkgs. In my opinion patching dependencies should be a last resort, only if there is pretty much no other option.



---

archive/issue_comments_389979.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@timokau](#comment%3A9):\n> This is a bit meta, but is there a general patching policy for sage?\n\nThere is no such policy. But it might be a good topic for discussion on `sage-packaging` (do you know about that mailing list?)",
    "created_at": "2018-06-06T15:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389979",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@timokau](#comment%3A9):
> This is a bit meta, but is there a general patching policy for sage?

There is no such policy. But it might be a good topic for discussion on `sage-packaging` (do you know about that mailing list?)



---

archive/issue_comments_389980.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nYes I do, but to my understanding the purpose of that list is packagers working together to solve packaging issues right? Such a policy would benefit packagers, but upstream developers would need to be the ones actually deciding on it and adhering to it. So I don't think discussing that on sage-packaging is very useful.\n\nMaybe sage-devel, if there is no more proper place to discuss that?",
    "created_at": "2018-06-06T15:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389980",
    "user": "https://github.com/timokau"
}
```

<a id='comment:11'>Comment 11:</a>
Yes I do, but to my understanding the purpose of that list is packagers working together to solve packaging issues right? Such a policy would benefit packagers, but upstream developers would need to be the ones actually deciding on it and adhering to it. So I don't think discussing that on sage-packaging is very useful.

Maybe sage-devel, if there is no more proper place to discuss that?



---

archive/issue_comments_389981.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nI have posted on sage-devel about this (https://groups.google.com/forum/#!topic/sage-devel/-lBph6WWg5E), so this ticket can go back to topic.",
    "created_at": "2018-06-06T16:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389981",
    "user": "https://github.com/timokau"
}
```

<a id='comment:12'>Comment 12:</a>
I have posted on sage-devel about this (https://groups.google.com/forum/#!topic/sage-devel/-lBph6WWg5E), so this ticket can go back to topic.



---

archive/issue_comments_389982.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nYour patch looks good to me. I think a ` # see #25320 for the apparently unnecessary ...` or something similar would be nice to make sure that nobody takes this out on the next refactoring.\n\nFeel free to set this to positive review once you added a comment, or also if you don't deem it necessary.",
    "created_at": "2018-06-07T19:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389982",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:13'>Comment 13:</a>
Your patch looks good to me. I think a ` # see #25320 for the apparently unnecessary ...` or something similar would be nice to make sure that nobody takes this out on the next refactoring.

Feel free to set this to positive review once you added a comment, or also if you don't deem it necessary.



---

archive/issue_comments_389983.json:
```json
{
    "body": "Reviewer: **Julian R\u00fcth**",
    "created_at": "2018-06-07T19:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389983",
    "user": "https://github.com/saraedum"
}
```

Reviewer: **Julian Rüth**



---

archive/issue_comments_389984.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nYeah I thought about that but I wasn't sure how to add comments to the doctests.\n\nSimply a `sage: # my comment` line? That would also show up in the generated docs right?",
    "created_at": "2018-06-07T20:11:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389984",
    "user": "https://github.com/timokau"
}
```

<a id='comment:14'>Comment 14:</a>
Yeah I thought about that but I wasn't sure how to add comments to the doctests.

Simply a `sage: # my comment` line? That would also show up in the generated docs right?



---

archive/issue_comments_389985.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nYes, I think that's acceptable.",
    "created_at": "2018-06-11T08:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389985",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'>Comment 15:</a>
Yes, I think that's acceptable.



---

archive/issue_comments_389986.json:
```json
{
    "body": "Changed commit from **[f79070d](https://github.com/sagemath/sagetrac-mirror/commit/f79070ddd09fa0ad6b340b097bd8d690a7aa35f0)** to **[3629f9a](https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36)**",
    "created_at": "2018-06-11T09:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389986",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f79070d](https://github.com/sagemath/sagetrac-mirror/commit/f79070ddd09fa0ad6b340b097bd8d690a7aa35f0)** to **[3629f9a](https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36)**



---

archive/issue_comments_389987.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36\">3629f9a</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n",
    "created_at": "2018-06-11T09:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389987",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36">3629f9a</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>




---

archive/issue_events_320378.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-06-11T09:48:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320378"
}
```



---

archive/issue_events_320379.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-06-11T09:48:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320379"
}
```



---

archive/issue_comments_389988.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nOkay, I added such a comment.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36\">3629f9a</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n",
    "created_at": "2018-06-11T09:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389988",
    "user": "https://github.com/timokau"
}
```

<a id='comment:17'>Comment 17:</a>
Okay, I added such a comment.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36">3629f9a</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>




---

archive/issue_comments_389989.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nWell thank you for this. I couldn't figure which part was causing the breakage in sage-on-gentoo.",
    "created_at": "2018-06-11T22:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389989",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'>Comment 18:</a>
Well thank you for this. I couldn't figure which part was causing the breakage in sage-on-gentoo.



---

archive/issue_events_320380.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-12T20:45:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320380"
}
```



---

archive/issue_events_320381.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-12T20:45:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320381"
}
```



---

archive/issue_comments_389990.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\n\n```\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    shell.run_cell('1/0') # see #25320 for the reason of the `...` in this test\nExpected:\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (.../cythonized/sage/rings/integer.c:...)()\n       ...        if type(left) is type(right):\n       ...            if mpz_sgn((<Integer>right).value) == 0:\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:13287)()\n       1923         if type(left) is type(right):\n       1924             if mpz_sgn((<Integer>right).value) == 0:\n    -> 1925                 raise ZeroDivisionError(\"rational division by zero\")\n       1926             x = <Rational> Rational.__new__(Rational)\n       1927             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n```",
    "created_at": "2018-06-12T20:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389990",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'>Comment 19:</a>

```
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    shell.run_cell('1/0') # see #25320 for the reason of the `...` in this test
Expected:
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    .../sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (.../cythonized/sage/rings/integer.c:...)()
       ...        if type(left) is type(right):
       ...            if mpz_sgn((<Integer>right).value) == 0:
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:13287)()
       1923         if type(left) is type(right):
       1924             if mpz_sgn((<Integer>right).value) == 0:
    -> 1925                 raise ZeroDivisionError("rational division by zero")
       1926             x = <Rational> Rational.__new__(Rational)
       1927             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
```



---

archive/issue_comments_389991.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nSorry!\n\nThe issue seems to be the missing initial `...` at\n\n```\nExpected:\n    ZeroDivisionError...Traceback (most recent call last)\n```\n\nwhile the test code is:\n\n```\nsage: shell.run_cell('1/0') # see #25320 for the reason of the `...` in this test\n...\nZeroDivisionError...Traceback (most recent call last)\n```\n\nDoes anybody know why the `...` in the first line is ignored? (Or why this wasn't caught by my local tests).",
    "created_at": "2018-06-12T21:00:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389991",
    "user": "https://github.com/timokau"
}
```

<a id='comment:20'>Comment 20:</a>
Sorry!

The issue seems to be the missing initial `...` at

```
Expected:
    ZeroDivisionError...Traceback (most recent call last)
```

while the test code is:

```
sage: shell.run_cell('1/0') # see #25320 for the reason of the `...` in this test
...
ZeroDivisionError...Traceback (most recent call last)
```

Does anybody know why the `...` in the first line is ignored? (Or why this wasn't caught by my local tests).



---

archive/issue_comments_389992.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nNot sure. Also Volker is only quoting one failure, does that mean that the other one passes or did he imply it was also failing? A pity, that's the first time in a long time this doctest doesn't fail on me in sage-on-gentoo.",
    "created_at": "2018-06-12T21:31:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389992",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'>Comment 21:</a>
Not sure. Also Volker is only quoting one failure, does that mean that the other one passes or did he imply it was also failing? A pity, that's the first time in a long time this doctest doesn't fail on me in sage-on-gentoo.



---

archive/issue_comments_389993.json:
```json
{
    "body": "Changed commit from **[3629f9a](https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36)** to **[c1efa49](https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b)**",
    "created_at": "2018-06-13T12:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389993",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3629f9a](https://github.com/sagemath/sagetrac-mirror/commit/3629f9a98c167f61e5b1ea237c6a0457787aad36)** to **[c1efa49](https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b)**



---

archive/issue_comments_389994.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b\">c1efa49</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n",
    "created_at": "2018-06-13T12:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389994",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>Comment 22:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b">c1efa49</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>




---

archive/issue_comments_389995.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nOkay I could reproduce the error locally. No idea why I didn't notice that before, I must have messed up somewhere.\n\nApparently python will interpret those `...` at the beginning as line-continuation characters[1]. I've updated the patch with a solution for this, but its not very pretty: Print a leading dummy line.\n\nIn my opinion the best solution would be to just remove the backports patch in sage. One patch less is one problem less and this patch seems to bring little to none advantage. But judging by the mailing list discussion, @jdemeyer probably disagrees?\n\n[1] https://stackoverflow.com/questions/5812833/can-i-have-an-ellipsis-at-the-beginning-of-the-line-in-a-python-doctest\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b\">c1efa49</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n",
    "created_at": "2018-06-13T12:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389995",
    "user": "https://github.com/timokau"
}
```

<a id='comment:23'>Comment 23:</a>
Okay I could reproduce the error locally. No idea why I didn't notice that before, I must have messed up somewhere.

Apparently python will interpret those `...` at the beginning as line-continuation characters[1]. I've updated the patch with a solution for this, but its not very pretty: Print a leading dummy line.

In my opinion the best solution would be to just remove the backports patch in sage. One patch less is one problem less and this patch seems to bring little to none advantage. But judging by the mailing list discussion, @jdemeyer probably disagrees?

[1] https://stackoverflow.com/questions/5812833/can-i-have-an-ellipsis-at-the-beginning-of-the-line-in-a-python-doctest

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b">c1efa49</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>




---

archive/issue_events_320382.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-06-13T12:07:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320382"
}
```



---

archive/issue_events_320383.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-06-13T12:07:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320383"
}
```



---

archive/issue_comments_389996.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@timokau](#comment%3A23):\n> In my opinion the best solution would be to just remove the backports patch in sage.\n\nWhy? It's not the fault of Sage that upstream doesn't make a new release (EDIT: actually, that upstream is dead). One could also argue that your distro should just apply that patch to `backports.shutil_get_terminal_size` since it fixes an actual bug.\n\n> One patch less is one problem less and this patch seems to bring little to none advantage.\n\nI consider correctly formatting exceptions a good feature to have.",
    "created_at": "2018-06-13T13:10:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389996",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@timokau](#comment%3A23):
> In my opinion the best solution would be to just remove the backports patch in sage.

Why? It's not the fault of Sage that upstream doesn't make a new release (EDIT: actually, that upstream is dead). One could also argue that your distro should just apply that patch to `backports.shutil_get_terminal_size` since it fixes an actual bug.

> One patch less is one problem less and this patch seems to bring little to none advantage.

I consider correctly formatting exceptions a good feature to have.



---

archive/issue_comments_389997.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@jdemeyer](#comment%3A24):\n> Replying to [@timokau](#comment%3A23):\n> > In my opinion the best solution would be to just remove the backports patch in sage.\n\n> \n> Why? It's not the fault of Sage that upstream doesn't make a new release (EDIT: actually, that upstream is dead). One could also argue that your distro should just apply that patch to `backports.shutil_get_terminal_size` since it fixes an actual bug.\n\nIts not, but I still think it doesn't matter whose fault it is. Instead we should choose the most practical solution. But by now we're just repeating our arguments -- I'm just going to accept that dropping the patch is not an option.\n\nYeah the owner hasn't had any [GitHub](../wiki/GitHub) activity in ages. Best case would be if somebody would just fork it. Looks like there is not much maintenance needed besides reviewing the occasional patch. However I don't really feel comfortable running a python library project myself, as I have no knowledge about the ecosystem (setup.py, pypy etc).\n\n> > One patch less is one problem less and this patch seems to bring little to none advantage.\n\n> \n> I consider correctly formatting exceptions a good feature to have.\n\nIts kinda nice but at least in my mind not even remotely worth the trouble. The wrong format still conveys all the same information and doesn't really loose any clarity.",
    "created_at": "2018-06-13T20:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389997",
    "user": "https://github.com/timokau"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@jdemeyer](#comment%3A24):
> Replying to [@timokau](#comment%3A23):
> > In my opinion the best solution would be to just remove the backports patch in sage.

> 
> Why? It's not the fault of Sage that upstream doesn't make a new release (EDIT: actually, that upstream is dead). One could also argue that your distro should just apply that patch to `backports.shutil_get_terminal_size` since it fixes an actual bug.

Its not, but I still think it doesn't matter whose fault it is. Instead we should choose the most practical solution. But by now we're just repeating our arguments -- I'm just going to accept that dropping the patch is not an option.

Yeah the owner hasn't had any [GitHub](../wiki/GitHub) activity in ages. Best case would be if somebody would just fork it. Looks like there is not much maintenance needed besides reviewing the occasional patch. However I don't really feel comfortable running a python library project myself, as I have no knowledge about the ecosystem (setup.py, pypy etc).

> > One patch less is one problem less and this patch seems to bring little to none advantage.

> 
> I consider correctly formatting exceptions a good feature to have.

Its kinda nice but at least in my mind not even remotely worth the trouble. The wrong format still conveys all the same information and doesn't really loose any clarity.



---

archive/issue_comments_389998.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nJust to talk about something else: it's a bit strange that exactly the same test appears in two places. Maybe the test inside `run_cell` could be replaced by something not raising exceptions, say\n\n```\nsage: from sage.repl.interpreter import get_test_shell\nsage: shell = get_test_shell()\nsage: rc = shell.run_cell('2^50')\n1125899906842624\nsage: rc is None\nTrue\nsage: shell.quit()\n```",
    "created_at": "2018-06-14T09:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389998",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'>Comment 26:</a>
Just to talk about something else: it's a bit strange that exactly the same test appears in two places. Maybe the test inside `run_cell` could be replaced by something not raising exceptions, say

```
sage: from sage.repl.interpreter import get_test_shell
sage: shell = get_test_shell()
sage: rc = shell.run_cell('2^50')
1125899906842624
sage: rc is None
True
sage: shell.quit()
```



---

archive/issue_comments_389999.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@jdemeyer](#comment%3A26):\n> Just to talk about something else: it's a bit strange that exactly the same test appears in two places. Maybe the test inside `run_cell` could be replaced by something not raising exceptions, say\n> \n> ```\n> sage: from sage.repl.interpreter import get_test_shell\n> sage: shell = get_test_shell()\n> sage: rc = shell.run_cell('2^50')\n> 1125899906842624\n> sage: rc is None\n> True\n> sage: shell.quit()\n> ```\n\nStrange that it appears in two places? sage is littered with identical (and I mean identical) tests often in different files. The only thing peculiar about those two is proximity.",
    "created_at": "2018-06-14T09:39:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-389999",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@jdemeyer](#comment%3A26):
> Just to talk about something else: it's a bit strange that exactly the same test appears in two places. Maybe the test inside `run_cell` could be replaced by something not raising exceptions, say
> 
> ```
> sage: from sage.repl.interpreter import get_test_shell
> sage: shell = get_test_shell()
> sage: rc = shell.run_cell('2^50')
> 1125899906842624
> sage: rc is None
> True
> sage: shell.quit()
> ```

Strange that it appears in two places? sage is littered with identical (and I mean identical) tests often in different files. The only thing peculiar about those two is proximity.



---

archive/issue_comments_390000.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@kiwifb](#comment%3A27):\n> sage is littered with identical (and I mean identical) tests often in different files.\n\nI know. I think it's because of the \"coverage\" policy that every function should have tests. If people cannot come up with good tests, they just copy an existing test to satisfy the `sage-coverage` tool. It's a good example of a well-intentioned tool having unintended side effects.",
    "created_at": "2018-06-14T09:44:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390000",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@kiwifb](#comment%3A27):
> sage is littered with identical (and I mean identical) tests often in different files.

I know. I think it's because of the "coverage" policy that every function should have tests. If people cannot come up with good tests, they just copy an existing test to satisfy the `sage-coverage` tool. It's a good example of a well-intentioned tool having unintended side effects.



---

archive/issue_comments_390001.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a\">d24dd41</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n",
    "created_at": "2018-06-14T10:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390001",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a">d24dd41</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>




---

archive/issue_comments_390002.json:
```json
{
    "body": "Changed commit from **[c1efa49](https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b)** to **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)**",
    "created_at": "2018-06-14T10:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390002",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c1efa49](https://github.com/sagemath/sagetrac-mirror/commit/c1efa49101b3d363eb38c732b19bdb335b5aa98b)** to **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)**



---

archive/issue_comments_390003.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nReplying to [@jdemeyer](#comment%3A26):\n> Just to talk about something else: it's a bit strange that exactly the same test appears in two places. Maybe the test inside `run_cell` could be replaced by something not raising exceptions, say\n> \n> ```\n> sage: from sage.repl.interpreter import get_test_shell\n> sage: shell = get_test_shell()\n> sage: rc = shell.run_cell('2^50')\n> 1125899906842624\n> sage: rc is None\n> True\n> sage: shell.quit()\n> ```\n\nI agree, that'll improve the test (doctests with textual output are inherently brittle) and solve half of this problem.\n\nWhat about the other one? Could we maybe replace that with another exception that is well-behaved, regardless of the backport patch level?\n\nI skimmed through the source and the patch to get an idea, but I can't figure out how the backport even influences the ZeroDivisionError formatting, let alone how the `master.patch` fixes it.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a\">d24dd41</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a\">d24dd41</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>\n",
    "created_at": "2018-06-14T10:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390003",
    "user": "https://github.com/timokau"
}
```

<a id='comment:30'>Comment 30:</a>
Replying to [@jdemeyer](#comment%3A26):
> Just to talk about something else: it's a bit strange that exactly the same test appears in two places. Maybe the test inside `run_cell` could be replaced by something not raising exceptions, say
> 
> ```
> sage: from sage.repl.interpreter import get_test_shell
> sage: shell = get_test_shell()
> sage: rc = shell.run_cell('2^50')
> 1125899906842624
> sage: rc is None
> True
> sage: shell.quit()
> ```

I agree, that'll improve the test (doctests with textual output are inherently brittle) and solve half of this problem.

What about the other one? Could we maybe replace that with another exception that is well-behaved, regardless of the backport patch level?

I skimmed through the source and the patch to get an idea, but I can't figure out how the backport even influences the ZeroDivisionError formatting, let alone how the `master.patch` fixes it.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a">d24dd41</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a">d24dd41</a></td><td><code>Make the ZeroDivisionError format more flexible</code></td></tr></table>




---

archive/issue_comments_390004.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@timokau](#comment%3A30):\n> another exception that is well-behaved\n\nThe issue is not with the specific exception, but with how IPython formats exceptions in general.",
    "created_at": "2018-06-14T10:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390004",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@timokau](#comment%3A30):
> another exception that is well-behaved

The issue is not with the specific exception, but with how IPython formats exceptions in general.



---

archive/issue_comments_390005.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nOh so the backport just reports a wrong terminal size and IPython formats the exception to fit into that size? That makes sense.\n\nWhat do you think about that dummy-line \"fix\"?",
    "created_at": "2018-06-14T10:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390005",
    "user": "https://github.com/timokau"
}
```

<a id='comment:32'>Comment 32:</a>
Oh so the backport just reports a wrong terminal size and IPython formats the exception to fit into that size? That makes sense.

What do you think about that dummy-line "fix"?



---

archive/issue_comments_390006.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\n@jdemeyer do you think that fix is acceptable?",
    "created_at": "2018-06-30T16:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390006",
    "user": "https://github.com/timokau"
}
```

<a id='comment:33'>Comment 33:</a>
@jdemeyer do you think that fix is acceptable?



---

archive/issue_comments_390007.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nReplying to [@timokau](#comment%3A33):\n> @jdemeyer do you think that fix is acceptable?\n\nOf course not. As I mentioned on the mailing list, I don't like \"fixing\" doctests. That's just hiding the problem.",
    "created_at": "2018-06-30T16:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390007",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>Comment 34:</a>
Replying to [@timokau](#comment%3A33):
> @jdemeyer do you think that fix is acceptable?

Of course not. As I mentioned on the mailing list, I don't like "fixing" doctests. That's just hiding the problem.



---

archive/issue_comments_390008.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nConsidering what is causing this issue (backports.shutil_get_terminal size failing to do the one thing it is supposed to do), I now agree that the patch should be applied. I will propose it for inclusion in nix.\n\nI still think that the sage doctests shouldn't fail because of this. The \"problem\" here is not essential to sages functionality. But thats not my call so if you don't want any version of this ticket in sage feel free to close this. If you want this ticket resolved but in a different way, I'll gladly implement any suggestions.\n\nThanks again for reviewing!",
    "created_at": "2018-06-30T17:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390008",
    "user": "https://github.com/timokau"
}
```

<a id='comment:35'>Comment 35:</a>
Considering what is causing this issue (backports.shutil_get_terminal size failing to do the one thing it is supposed to do), I now agree that the patch should be applied. I will propose it for inclusion in nix.

I still think that the sage doctests shouldn't fail because of this. The "problem" here is not essential to sages functionality. But thats not my call so if you don't want any version of this ticket in sage feel free to close this. If you want this ticket resolved but in a different way, I'll gladly implement any suggestions.

Thanks again for reviewing!



---

archive/issue_comments_390009.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nI won't actively oppose the patch on this ticket. If other people think it's OK, then I'm fine with it.\n\nPersonally, I think you should just add this patch to the sagemath in your distribution.",
    "created_at": "2018-07-01T07:37:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390009",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'>Comment 36:</a>
I won't actively oppose the patch on this ticket. If other people think it's OK, then I'm fine with it.

Personally, I think you should just add this patch to the sagemath in your distribution.



---

archive/issue_events_320384.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-03T15:38:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320384"
}
```



---

archive/issue_events_320385.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-03T15:38:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320385"
}
```



---

archive/issue_events_320386.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-08T13:05:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320386"
}
```



---

archive/issue_events_320387.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2f9e9a1fdb13e15ea0bd9db1bad8546143a6c533",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-07-08T13:05:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25320#event-320387"
}
```



---

archive/issue_comments_390010.json:
```json
{
    "body": "Changed branch from **[u/gh-timokau/zero-division-format](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/zero-division-format)** to **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)**",
    "created_at": "2018-07-08T13:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390010",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-timokau/zero-division-format](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/zero-division-format)** to **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)**



---

archive/issue_comments_390011.json:
```json
{
    "body": "Changed commit from **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)** to none",
    "created_at": "2018-10-28T09:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390011",
    "user": "https://github.com/antonio-rojas"
}
```

Changed commit from **[d24dd41](https://github.com/sagemath/sagetrac-mirror/commit/d24dd41d1634b3f0cd1707a69c6d545ae8a6b97a)** to none



---

archive/issue_comments_390012.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nThis is not working for me on Arch: the test is still failing (with unpatched shutil_get_terminal_size)",
    "created_at": "2018-10-28T09:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390012",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:39'>Comment 39:</a>
This is not working for me on Arch: the test is still failing (with unpatched shutil_get_terminal_size)



---

archive/issue_comments_390013.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nShould have reacted earlier, but yes the final version of that ticket didn't fix everything.\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/repl/interpreter.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (.../cythonized/sage/rings/integer.c:...)()\n       ...        if type(left) is type(right):\n       ...            if mpz_sgn((<Integer>right).value) == 0:\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    <BLANKLINE>\n    ZeroDivisionErrorTraceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /usr/lib64/python2.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:13336)()\n       1914         if type(left) is type(right):\n       1915             if mpz_sgn((<Integer>right).value) == 0:\n    -> 1916                 raise ZeroDivisionError(\"rational division by zero\")\n       1917             x = <Rational> Rational.__new__(Rational)\n       1918             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n```\nbut during development it was - at some point.",
    "created_at": "2018-10-28T09:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25320#issuecomment-390013",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'>Comment 40:</a>
Should have reacted earlier, but yes the final version of that ticket didn't fix everything.

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/repl/interpreter.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    .../sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (.../cythonized/sage/rings/integer.c:...)()
       ...        if type(left) is type(right):
       ...            if mpz_sgn((<Integer>right).value) == 0:
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    <BLANKLINE>
    ZeroDivisionErrorTraceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /usr/lib64/python2.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:13336)()
       1914         if type(left) is type(right):
       1915             if mpz_sgn((<Integer>right).value) == 0:
    -> 1916                 raise ZeroDivisionError("rational division by zero")
       1917             x = <Rational> Rational.__new__(Rational)
       1918             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
```
but during development it was - at some point.
