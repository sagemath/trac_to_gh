# Issue 25913: Allow input as packed words for Hopf algebra WQSym

archive/issues_025676.json:
```json
{
    "assignees": [],
    "body": "The Hopf algebra `WordQuasiSymmetricFunctions`, despite it's name, is indexed internally as ordered set partitions. This ticket aims to allow the user to also use packed words as input.\n\nCC:  @tscrim @nthiery @darijgr @zabrocki @alauve @amypang @sagetrac-hmlodecki @saliola\n\nKeywords: **sagedays@icerm, packed words, IMA coding sprint, CHAs**\n\nBranch/Commit: **[`8e3b93f`](https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Aaron Lauve**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25913_\n\n",
    "closed_at": "2018-09-29T11:59:34Z",
    "created_at": "2018-07-24T14:39:09Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Allow input as packed words for Hopf algebra WQSym",
    "type": "issue",
    "updated_at": "2018-09-29T11:59:34Z",
    "url": "https://github.com/sagemath/sage/issues/25913",
    "user": "https://github.com/alauve"
}
```
The Hopf algebra `WordQuasiSymmetricFunctions`, despite it's name, is indexed internally as ordered set partitions. This ticket aims to allow the user to also use packed words as input.

CC:  @tscrim @nthiery @darijgr @zabrocki @alauve @amypang @sagetrac-hmlodecki @saliola

Keywords: **sagedays@icerm, packed words, IMA coding sprint, CHAs**

Branch/Commit: **[`8e3b93f`](https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195)**

Reviewer: **Travis Scrimshaw**

Author: **Aaron Lauve**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/25913_





---

archive/issue_events_355063.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-07-24T14:39:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355063"
}
```



---

archive/issue_events_355064.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-07-24T14:39:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355064"
}
```



---

archive/issue_events_355065.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-07-24T14:39:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355065"
}
```



---

archive/issue_events_355066.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-07-24T14:39:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355066"
}
```



---

archive/issue_comments_398588.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/481b0f0c46b68e9f6d8c09044dc1755661ff891e\"><code>481b0f0</code></a></td><td><code>modify getitem to allow for use of packed words as indices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcecdecfa0f09cea9d33bc69e6c1ac2252783207\"><code>dcecdec</code></a></td><td><code>Merge branch 'develop' into public/combinat/allow-packed-words-in-wqsym</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/709ae4ce4301f844a2c1f8ea0b4994d94b4494dd\"><code>709ae4c</code></a></td><td><code>begin implementing indexing by packed words</code></td></tr></table>\n",
    "created_at": "2018-07-24T14:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398588",
    "user": "https://github.com/alauve"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/481b0f0c46b68e9f6d8c09044dc1755661ff891e"><code>481b0f0</code></a></td><td><code>modify getitem to allow for use of packed words as indices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcecdecfa0f09cea9d33bc69e6c1ac2252783207"><code>dcecdec</code></a></td><td><code>Merge branch 'develop' into public/combinat/allow-packed-words-in-wqsym</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/709ae4ce4301f844a2c1f8ea0b4994d94b4494dd"><code>709ae4c</code></a></td><td><code>begin implementing indexing by packed words</code></td></tr></table>




---

archive/issue_comments_398589.json:
```json
{
    "body": "Branch: **[public/combinat/allow-packed-words-in-wqsym-25913](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/allow-packed-words-in-wqsym-25913)**",
    "created_at": "2018-07-24T14:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398589",
    "user": "https://github.com/alauve"
}
```

Branch: **[public/combinat/allow-packed-words-in-wqsym-25913](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/allow-packed-words-in-wqsym-25913)**



---

archive/issue_comments_398590.json:
```json
{
    "body": "Commit: **[`709ae4c`](https://github.com/sagemath/sagetrac-mirror/commit/709ae4ce4301f844a2c1f8ea0b4994d94b4494dd)**",
    "created_at": "2018-07-24T14:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398590",
    "user": "https://github.com/alauve"
}
```

Commit: **[`709ae4c`](https://github.com/sagemath/sagetrac-mirror/commit/709ae4ce4301f844a2c1f8ea0b4994d94b4494dd)**



---

archive/issue_comments_398591.json:
```json
{
    "body": "Changed commit from **[`709ae4c`](https://github.com/sagemath/sagetrac-mirror/commit/709ae4ce4301f844a2c1f8ea0b4994d94b4494dd)** to **[`faf13e7`](https://github.com/sagemath/sagetrac-mirror/commit/faf13e7205bc2c50b66c11a3d91347dca8458800)**",
    "created_at": "2018-07-24T22:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398591",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`709ae4c`](https://github.com/sagemath/sagetrac-mirror/commit/709ae4ce4301f844a2c1f8ea0b4994d94b4494dd)** to **[`faf13e7`](https://github.com/sagemath/sagetrac-mirror/commit/faf13e7205bc2c50b66c11a3d91347dca8458800)**



---

archive/issue_comments_398592.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30f38f1a8fd7301c44f26445e5682800316e513a\"><code>30f38f1</code></a></td><td><code>fighting with global options</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/faf13e7205bc2c50b66c11a3d91347dca8458800\"><code>faf13e7</code></a></td><td><code>moved call to GlobalOptions</code></td></tr></table>\n",
    "created_at": "2018-07-24T22:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398592",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30f38f1a8fd7301c44f26445e5682800316e513a"><code>30f38f1</code></a></td><td><code>fighting with global options</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/faf13e7205bc2c50b66c11a3d91347dca8458800"><code>faf13e7</code></a></td><td><code>moved call to GlobalOptions</code></td></tr></table>




---

archive/issue_comments_398593.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6256d9f32423b9fcbc0fb43dfee503506e40bbd\"><code>e6256d9</code></a></td><td><code>Merge branch 'develop' into public/combinat/allow-packed-words-in-wqsym-25913</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1302381a1045dba36684dee7fc43b025a601b77d\"><code>1302381</code></a></td><td><code>updated documentation to illustrate the words realization of WQSym</code></td></tr></table>\n",
    "created_at": "2018-07-25T15:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398593",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6256d9f32423b9fcbc0fb43dfee503506e40bbd"><code>e6256d9</code></a></td><td><code>Merge branch 'develop' into public/combinat/allow-packed-words-in-wqsym-25913</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1302381a1045dba36684dee7fc43b025a601b77d"><code>1302381</code></a></td><td><code>updated documentation to illustrate the words realization of WQSym</code></td></tr></table>




---

archive/issue_comments_398594.json:
```json
{
    "body": "Changed commit from **[`faf13e7`](https://github.com/sagemath/sagetrac-mirror/commit/faf13e7205bc2c50b66c11a3d91347dca8458800)** to **[`1302381`](https://github.com/sagemath/sagetrac-mirror/commit/1302381a1045dba36684dee7fc43b025a601b77d)**",
    "created_at": "2018-07-25T15:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398594",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`faf13e7`](https://github.com/sagemath/sagetrac-mirror/commit/faf13e7205bc2c50b66c11a3d91347dca8458800)** to **[`1302381`](https://github.com/sagemath/sagetrac-mirror/commit/1302381a1045dba36684dee7fc43b025a601b77d)**



---

archive/issue_events_355067.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-07-25T16:01:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355067"
}
```



---

archive/issue_comments_398595.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nUpdated documentation to reflect the words realization of WQSym. Should be ready for a close inspection.",
    "created_at": "2018-07-25T16:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398595",
    "user": "https://github.com/alauve"
}
```

<div id="comment:4" align="right">comment:4</div>

Updated documentation to reflect the words realization of WQSym. Should be ready for a close inspection.



---

archive/issue_comments_398596.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis does not actually look correct. The global options should not be a specific instance but instead constructed as class-level subclass (as it was before; it results in an instance due to some magic IIRC, but that is an implementation detail).\n\nAlso, as we discussed at lunch today, we do not want to have two different objects for WQSym (over the same base ring).",
    "created_at": "2018-07-26T21:59:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398596",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

This does not actually look correct. The global options should not be a specific instance but instead constructed as class-level subclass (as it was before; it results in an instance due to some magic IIRC, but that is an implementation detail).

Also, as we discussed at lunch today, we do not want to have two different objects for WQSym (over the same base ring).



---

archive/issue_events_355068.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-26T21:59:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355068"
}
```



---

archive/issue_events_355069.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-26T21:59:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355069"
}
```



---

archive/issue_comments_398597.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI am not happy with the current (development branch) situation, but also not happy with this branch... worrying about end-user getting unexpected results from misuse of `.monomial`, `.sum_of_terms`, etc.\n\nFor instance, if users see packed words in their output (e.g., `M[1,1,2,1]`) and also are allowed to write `M[1,1,2,1]` as input, they will be inclined to write code like this:\n\n```\nout = M.zero()\nfor w in PackedWords(4):\n    M.sum_of_terms((v,1) for v in w. right_weak_order_greater())\n```\nThis may only cause confusion once per user, but I'm sure there are more exotic errors I'm not thinking of.\n\nWhat if we do this?: create a new class called `WQSymKeys` that has exactly one job: handle, without complaint, either packed words or ordered set partitions and converting as appropriate. Might there be a way to do this that would make the previous code-block **and** the next one run error-free?:\n\n```\nout = M.zero()\nfor w in OrderedSetPartitions(4):\n    M.sum_of_terms((v,1) for v in op.finer())\n```",
    "created_at": "2018-07-27T01:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398597",
    "user": "https://github.com/alauve"
}
```

<div id="comment:6" align="right">comment:6</div>

I am not happy with the current (development branch) situation, but also not happy with this branch... worrying about end-user getting unexpected results from misuse of `.monomial`, `.sum_of_terms`, etc.

For instance, if users see packed words in their output (e.g., `M[1,1,2,1]`) and also are allowed to write `M[1,1,2,1]` as input, they will be inclined to write code like this:

```
out = M.zero()
for w in PackedWords(4):
    M.sum_of_terms((v,1) for v in w. right_weak_order_greater())
```
This may only cause confusion once per user, but I'm sure there are more exotic errors I'm not thinking of.

What if we do this?: create a new class called `WQSymKeys` that has exactly one job: handle, without complaint, either packed words or ordered set partitions and converting as appropriate. Might there be a way to do this that would make the previous code-block **and** the next one run error-free?:

```
out = M.zero()
for w in OrderedSetPartitions(4):
    M.sum_of_terms((v,1) for v in op.finer())
```



---

archive/issue_comments_398598.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe default is not packed words, so when you change the display options, *you* take responsibility for realizing that *out*put is not *in*put. We are trying to make both as possibilities, but there are ambiguities in the input. We can document that we try, but to avoid ambiguities, you will need to have users explicitly cast their objects as packed words, which we can then handle in `__getitem__`, but you must have read the documentation, where it is clearly spelled out that we are using ordered set partitions as the basis. As we discussed, we can change this, but we have to change everything.\n\nAlso, `sum_of_terms` and the like assumes you are passing in good indices. However, that is a completely separate issue.",
    "created_at": "2018-07-27T13:58:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398598",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

The default is not packed words, so when you change the display options, *you* take responsibility for realizing that *out*put is not *in*put. We are trying to make both as possibilities, but there are ambiguities in the input. We can document that we try, but to avoid ambiguities, you will need to have users explicitly cast their objects as packed words, which we can then handle in `__getitem__`, but you must have read the documentation, where it is clearly spelled out that we are using ordered set partitions as the basis. As we discussed, we can change this, but we have to change everything.

Also, `sum_of_terms` and the like assumes you are passing in good indices. However, that is a completely separate issue.



---

archive/issue_comments_398599.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nGetting back to this ticket finally... \n\nAfter discussion at SageDays@ICERM, it seems I should scrap/revert most of the commits on this ticket. \n\nThe new plan (submitted here for your correction or comment, if I have remembered it incorrectly):\n\n* basis keys used internally are ordered set partitions\n* print output as ordered set partitions unless global option is set to words\n* adjust code so that, e.g., in `__getitem__`, \n  - first look for types `(Packed)Word` and `OrderedSetPartition`,\n  - next assume the user is passing a (packed) word (as a list), \n  - and if that makes no sense, then try to view that list as an ordered set partition.\n* be sure the documentation **clearly spells out** the above, and that the best way for user to have no surprises to write `M[w]` or `M[pi]`, where `w` has type (Packed)Word and `pi` has type `OrderedSetPartition`\n\nHere are the ambiguities for the user, so far as I can tell:\n\n* `M[1,2,3]`  -- will output `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`\n* `M[This is the Trac macro *1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,3-macro)` -- will output  `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`\n* `M[This is the Trac macro *[1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#[1,2,3-macro)]` -- will output `M[{1,2,3}]` and surely the user did not mean `M[{1},{2},{3}]`\n* `M[1,1,2]` -- will correctly output `M[{1,2},{3}]`, while at present it would output `M[{1,2}]`",
    "created_at": "2018-09-20T15:15:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398599",
    "user": "https://github.com/alauve"
}
```

<div id="comment:8" align="right">comment:8</div>

Getting back to this ticket finally... 

After discussion at SageDays@ICERM, it seems I should scrap/revert most of the commits on this ticket. 

The new plan (submitted here for your correction or comment, if I have remembered it incorrectly):

* basis keys used internally are ordered set partitions
* print output as ordered set partitions unless global option is set to words
* adjust code so that, e.g., in `__getitem__`, 
  - first look for types `(Packed)Word` and `OrderedSetPartition`,
  - next assume the user is passing a (packed) word (as a list), 
  - and if that makes no sense, then try to view that list as an ordered set partition.
* be sure the documentation **clearly spells out** the above, and that the best way for user to have no surprises to write `M[w]` or `M[pi]`, where `w` has type (Packed)Word and `pi` has type `OrderedSetPartition`

Here are the ambiguities for the user, so far as I can tell:

* `M[1,2,3]`  -- will output `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`
* `M[This is the Trac macro *1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,3-macro)` -- will output  `M[{1},{2},{3}]` while the user may have meant `M[{1,2,3}]`
* `M[This is the Trac macro *[1,2,3* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#[1,2,3-macro)]` -- will output `M[{1,2,3}]` and surely the user did not mean `M[{1},{2},{3}]`
* `M[1,1,2]` -- will correctly output `M[{1,2},{3}]`, while at present it would output `M[{1,2}]`



---

archive/issue_comments_398600.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55900970a33e402eca573c157971e0dddf62fc44\"><code>5590097</code></a></td><td><code>Revert \"updated documentation to illustrate the words realization of WQSym\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06c265ecf2ed3aae0d545ded405985410f37f7d8\"><code>06c265e</code></a></td><td><code>Revert \"moved call to GlobalOptions\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba6e0e874f682012072f1c8079e4e247d7a1f5eb\"><code>ba6e0e8</code></a></td><td><code>Revert \"fighting with global options\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f584c4da5181e1cd42b3a396ed2cc2bbd5e25bc\"><code>7f584c4</code></a></td><td><code>Revert \"begin implementing indexing by packed words\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f958cfb2e583cec9e990564d240e97656997a17\"><code>8f958cf</code></a></td><td><code>Revert \"modify getitem to allow for use of packed words as indices\"</code></td></tr></table>\n",
    "created_at": "2018-09-20T21:09:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398600",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55900970a33e402eca573c157971e0dddf62fc44"><code>5590097</code></a></td><td><code>Revert "updated documentation to illustrate the words realization of WQSym"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06c265ecf2ed3aae0d545ded405985410f37f7d8"><code>06c265e</code></a></td><td><code>Revert "moved call to GlobalOptions"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba6e0e874f682012072f1c8079e4e247d7a1f5eb"><code>ba6e0e8</code></a></td><td><code>Revert "fighting with global options"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f584c4da5181e1cd42b3a396ed2cc2bbd5e25bc"><code>7f584c4</code></a></td><td><code>Revert "begin implementing indexing by packed words"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f958cfb2e583cec9e990564d240e97656997a17"><code>8f958cf</code></a></td><td><code>Revert "modify getitem to allow for use of packed words as indices"</code></td></tr></table>




---

archive/issue_comments_398601.json:
```json
{
    "body": "Changed commit from **[`1302381`](https://github.com/sagemath/sagetrac-mirror/commit/1302381a1045dba36684dee7fc43b025a601b77d)** to **[`8f958cf`](https://github.com/sagemath/sagetrac-mirror/commit/8f958cfb2e583cec9e990564d240e97656997a17)**",
    "created_at": "2018-09-20T21:09:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398601",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1302381`](https://github.com/sagemath/sagetrac-mirror/commit/1302381a1045dba36684dee7fc43b025a601b77d)** to **[`8f958cf`](https://github.com/sagemath/sagetrac-mirror/commit/8f958cfb2e583cec9e990564d240e97656997a17)**



---

archive/issue_comments_398602.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cda2ef85a2764504f11aa9336c3d2713b02ad1e\"><code>8cda2ef</code></a></td><td><code>Merge branch 'develop' into public/combinat/allow-packed-words-in-wqsym-25913</code></td></tr></table>\n",
    "created_at": "2018-09-21T14:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398602",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cda2ef85a2764504f11aa9336c3d2713b02ad1e"><code>8cda2ef</code></a></td><td><code>Merge branch 'develop' into public/combinat/allow-packed-words-in-wqsym-25913</code></td></tr></table>




---

archive/issue_comments_398603.json:
```json
{
    "body": "Changed commit from **[`8f958cf`](https://github.com/sagemath/sagetrac-mirror/commit/8f958cfb2e583cec9e990564d240e97656997a17)** to **[`8cda2ef`](https://github.com/sagemath/sagetrac-mirror/commit/8cda2ef85a2764504f11aa9336c3d2713b02ad1e)**",
    "created_at": "2018-09-21T14:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398603",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8f958cf`](https://github.com/sagemath/sagetrac-mirror/commit/8f958cfb2e583cec9e990564d240e97656997a17)** to **[`8cda2ef`](https://github.com/sagemath/sagetrac-mirror/commit/8cda2ef85a2764504f11aa9336c3d2713b02ad1e)**



---

archive/issue_comments_398604.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60ae680408c74f67757a30cfe2d9c035432319c9\"><code>60ae680</code></a></td><td><code>added nonempty tests in set_partitions_ordered; began modifying element constructor within wqsym.py</code></td></tr></table>\n",
    "created_at": "2018-09-24T05:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398604",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60ae680408c74f67757a30cfe2d9c035432319c9"><code>60ae680</code></a></td><td><code>added nonempty tests in set_partitions_ordered; began modifying element constructor within wqsym.py</code></td></tr></table>




---

archive/issue_comments_398605.json:
```json
{
    "body": "Changed commit from **[`8cda2ef`](https://github.com/sagemath/sagetrac-mirror/commit/8cda2ef85a2764504f11aa9336c3d2713b02ad1e)** to **[`60ae680`](https://github.com/sagemath/sagetrac-mirror/commit/60ae680408c74f67757a30cfe2d9c035432319c9)**",
    "created_at": "2018-09-24T05:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398605",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8cda2ef`](https://github.com/sagemath/sagetrac-mirror/commit/8cda2ef85a2764504f11aa9336c3d2713b02ad1e)** to **[`60ae680`](https://github.com/sagemath/sagetrac-mirror/commit/60ae680408c74f67757a30cfe2d9c035432319c9)**



---

archive/issue_comments_398606.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/931abd1e2a930a57d3e643cb6b3def20edea890c\"><code>931abd1</code></a></td><td><code>added `_element_constructor_` method in wqsym</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b89b5af6b3790e5802ec4b6f14f4d813e3c1bd40\"><code>b89b5af</code></a></td><td><code>updating documentation and tests; tracking down bug in set_partition_ordered</code></td></tr></table>\n",
    "created_at": "2018-09-25T04:19:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398606",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/931abd1e2a930a57d3e643cb6b3def20edea890c"><code>931abd1</code></a></td><td><code>added `_element_constructor_` method in wqsym</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b89b5af6b3790e5802ec4b6f14f4d813e3c1bd40"><code>b89b5af</code></a></td><td><code>updating documentation and tests; tracking down bug in set_partition_ordered</code></td></tr></table>




---

archive/issue_comments_398607.json:
```json
{
    "body": "Changed commit from **[`60ae680`](https://github.com/sagemath/sagetrac-mirror/commit/60ae680408c74f67757a30cfe2d9c035432319c9)** to **[`b89b5af`](https://github.com/sagemath/sagetrac-mirror/commit/b89b5af6b3790e5802ec4b6f14f4d813e3c1bd40)**",
    "created_at": "2018-09-25T04:19:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398607",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`60ae680`](https://github.com/sagemath/sagetrac-mirror/commit/60ae680408c74f67757a30cfe2d9c035432319c9)** to **[`b89b5af`](https://github.com/sagemath/sagetrac-mirror/commit/b89b5af6b3790e5802ec4b6f14f4d813e3c1bd40)**



---

archive/issue_comments_398608.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI expect this is ready for review (and certainly ready for others to take a closer peek at).",
    "created_at": "2018-09-25T04:22:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398608",
    "user": "https://github.com/alauve"
}
```

<div id="comment:13" align="right">comment:13</div>

I expect this is ready for review (and certainly ready for others to take a closer peek at).



---

archive/issue_comments_398609.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThank you for working more on this. Here are my comments.\n\nYou have to handle zeros better:\n\n```\nsage: WZ = WordQuasiSymmetricFunctions(ZZ)\nsage: M = WZ.M()\nsage: M(2)\n2*M[]\nsage: M(0/1)  # This is more common than you might expect\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: cannot convert 0 into an element of Ordered set partitions\n```\nvs current:\n\n```\nsage: M(0/1)\n0\n```\nCoercion is too strong. Ideally, you should allow conversion of scalars. `CombinatorialFreeModule` dictates that any 0 that is also in the `base_ring()` will convert, but since this is known to be an algebra, we should be better and allow the conversion of any scalar.\n\nI don't like the punt-off of `__getitem__` to `_element_constructor_`. If you fix the above issue, than this will work:\n\n```\nsage: WQ = WordQuasiSymmetricFunctions(QQ)\nsage: M = WQ.M()\nsage: M[0/1]\n```\nand result in `0`. I think the assumptions you should make between the two will be different. The `__getitem__` should assume it is an OSP or packed word and let the error propagate up. I would be okay with the reverse `_element_constructor_` calling `__getitem__`.\n\nThese are the same:\n\n```\nsage: [[1,2],]\n[[1, 2]]\nsage: [[1,2]]\n[[1, 2]]\n```\nPlease remove the extraneous commas in the ``coproduct()` tests.",
    "created_at": "2018-09-25T22:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398609",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Thank you for working more on this. Here are my comments.

You have to handle zeros better:

```
sage: WZ = WordQuasiSymmetricFunctions(ZZ)
sage: M = WZ.M()
sage: M(2)
2*M[]
sage: M(0/1)  # This is more common than you might expect
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: cannot convert 0 into an element of Ordered set partitions
```
vs current:

```
sage: M(0/1)
0
```
Coercion is too strong. Ideally, you should allow conversion of scalars. `CombinatorialFreeModule` dictates that any 0 that is also in the `base_ring()` will convert, but since this is known to be an algebra, we should be better and allow the conversion of any scalar.

I don't like the punt-off of `__getitem__` to `_element_constructor_`. If you fix the above issue, than this will work:

```
sage: WQ = WordQuasiSymmetricFunctions(QQ)
sage: M = WQ.M()
sage: M[0/1]
```
and result in `0`. I think the assumptions you should make between the two will be different. The `__getitem__` should assume it is an OSP or packed word and let the error propagate up. I would be okay with the reverse `_element_constructor_` calling `__getitem__`.

These are the same:

```
sage: [[1,2],]
[[1, 2]]
sage: [[1,2]]
[[1, 2]]
```
Please remove the extraneous commas in the ``coproduct()` tests.



---

archive/issue_comments_398610.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?\n\nActually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?",
    "created_at": "2018-09-26T03:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398610",
    "user": "https://github.com/alauve"
}
```

<div id="comment:15" align="right">comment:15</div>

Oh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?

Actually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?



---

archive/issue_comments_398611.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@alauve](#comment:15):\n> Oh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?\n\nNo, you are correct. However, `M[foo]` should not return anything that is not a basis element corresponding (under some map) to `foo`.\n\n> Actually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?\n\nBecause `0/1` is an element of `QQ`, which has no coercion into `ZZ`.\n\nEdit - Forgot to answer your first question.",
    "created_at": "2018-09-26T03:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398611",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@alauve](#comment:15):
> Oh my! Do I have things backwards? I thought M(...) should be the catch-all, not M[...]. And I'm happy to handle the zeros better... which of the methods would be most appropriate to handle 0/1?

No, you are correct. However, `M[foo]` should not return anything that is not a basis element corresponding (under some map) to `foo`.

> Actually, looking through the error trace for your test `sage: M(0/1)`, I'm not sure why it failed... , why doesn't 0/1 get picked up by the `__call__` or `_call_` methods it tries before turning to `_element_constructor_`?

Because `0/1` is an element of `QQ`, which has no coercion into `ZZ`.

Edit - Forgot to answer your first question.



---

archive/issue_comments_398612.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nHmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`\nOr maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?\n\nI have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.",
    "created_at": "2018-09-26T03:50:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398612",
    "user": "https://github.com/alauve"
}
```

<div id="comment:18" align="right">comment:18</div>

Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`
Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?

I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.



---

archive/issue_comments_398613.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@alauve](#comment:18):\n> Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`\n> Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?\n\nYes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.\n\n> I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.\n\nI agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.",
    "created_at": "2018-09-26T23:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398613",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@alauve](#comment:18):
> Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`
> Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?

Yes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.

> I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.

I agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.



---

archive/issue_comments_398614.json:
```json
{
    "body": "Changed commit from **[`b89b5af`](https://github.com/sagemath/sagetrac-mirror/commit/b89b5af6b3790e5802ec4b6f14f4d813e3c1bd40)** to **[`735a4c3`](https://github.com/sagemath/sagetrac-mirror/commit/735a4c3050b75b01ef41f3c5145c95a4765cf6ef)**",
    "created_at": "2018-09-27T03:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398614",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b89b5af`](https://github.com/sagemath/sagetrac-mirror/commit/b89b5af6b3790e5802ec4b6f14f4d813e3c1bd40)** to **[`735a4c3`](https://github.com/sagemath/sagetrac-mirror/commit/735a4c3050b75b01ef41f3c5145c95a4765cf6ef)**



---

archive/issue_comments_398615.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/735a4c3050b75b01ef41f3c5145c95a4765cf6ef\"><code>735a4c3</code></a></td><td><code>removed `_element_constructor_` method</code></td></tr></table>\n",
    "created_at": "2018-09-27T03:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398615",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/735a4c3050b75b01ef41f3c5145c95a4765cf6ef"><code>735a4c3</code></a></td><td><code>removed `_element_constructor_` method</code></td></tr></table>




---

archive/issue_comments_398616.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f40d3e5fdbf66f25099bcd09f5e16f385a8cab35\"><code>f40d3e5</code></a></td><td><code>small bug fix</code></td></tr></table>\n",
    "created_at": "2018-09-27T03:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398616",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f40d3e5fdbf66f25099bcd09f5e16f385a8cab35"><code>f40d3e5</code></a></td><td><code>small bug fix</code></td></tr></table>




---

archive/issue_comments_398617.json:
```json
{
    "body": "Changed commit from **[`735a4c3`](https://github.com/sagemath/sagetrac-mirror/commit/735a4c3050b75b01ef41f3c5145c95a4765cf6ef)** to **[`f40d3e5`](https://github.com/sagemath/sagetrac-mirror/commit/f40d3e5fdbf66f25099bcd09f5e16f385a8cab35)**",
    "created_at": "2018-09-27T03:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398617",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`735a4c3`](https://github.com/sagemath/sagetrac-mirror/commit/735a4c3050b75b01ef41f3c5145c95a4765cf6ef)** to **[`f40d3e5`](https://github.com/sagemath/sagetrac-mirror/commit/f40d3e5fdbf66f25099bcd09f5e16f385a8cab35)**



---

archive/issue_events_355070.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-09-27T03:43:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355070"
}
```



---

archive/issue_events_355071.json:
```json
{
    "actor": "https://github.com/alauve",
    "created_at": "2018-09-27T03:43:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355071"
}
```



---

archive/issue_comments_398618.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@tscrim](#comment:19):\n> Replying to [@alauve](#comment:18):\n> > Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`\n> > Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?\n\n> \n> Yes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.\n> \n> > I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.\n\n> \n> I agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.\n\n\nOkay. I think I misunderstood what you originally wrote... I thought you wanted `M[0/1]` to return `0`. \n\nI should mention that, since `M([[1,3],2]])` worked in the original code (by which I mean `M[{1,3},{2}]` was returned), I was trying to get `M[1,2,1]` to work as well. This was the origin of my messing with `_element_constructor`. But after chatting with others, it seems I shouldn't try to be so accommodating. The basis keys are OSPs, not words. END-OF-STORY.\n\nI removed that custom method, but I could do as you propose and instead let `_element_constructor_` pass off to `__getitem__`. \nOtherwise, I think this patch is ready for review.",
    "created_at": "2018-09-27T03:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398618",
    "user": "https://github.com/alauve"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@tscrim](#comment:19):
> Replying to [@alauve](#comment:18):
> > Hmm. But I view `M[...]` as attempts to access a basis key. So users have no business trying `M[0/1]`
> > Or maybe that's your point... I can handle it there (with some careful coding) since it looks so different from what I expect to see?

> 
> Yes, they have no business doing it, which is why it should return an error and not silently return a 0. This can make it a lot harder to track down logical bugs.
> 
> > I have some concern about processing `M[0/1]` differently than `M[2/2]` though: I'd like the latter to come in as`M[{1}]` and not `(2/2)*M[]`, since `2/2 in ZZ` evaluates to `True`.

> 
> I agree with you, which is why I do not like the `__getitem__` calling `_element_constructor_`.


Okay. I think I misunderstood what you originally wrote... I thought you wanted `M[0/1]` to return `0`. 

I should mention that, since `M([[1,3],2]])` worked in the original code (by which I mean `M[{1,3},{2}]` was returned), I was trying to get `M[1,2,1]` to work as well. This was the origin of my messing with `_element_constructor`. But after chatting with others, it seems I shouldn't try to be so accommodating. The basis keys are OSPs, not words. END-OF-STORY.

I removed that custom method, but I could do as you propose and instead let `_element_constructor_` pass off to `__getitem__`. 
Otherwise, I think this patch is ready for review.



---

archive/issue_comments_398619.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n\n```\nsage: M = algebras.WQSym(QQ).M()\nsage: M[2/2]\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-2-e174bca538a0> in <module>()\n----> 1 M[Integer(2)/Integer(2)]\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__getitem__ (build/cythonized/sage/structure/parent.c:11402)()\n   1222             except AttributeError:\n   1223                 return self.list()[n]\n-> 1224         return meth(n)\n   1225 \n   1226     #################################################################################\n\n/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/combinat/chas/wqsym.pyc in __getitem__(self, p)\n   1967                 return self.monomial(self._indices(p))\n   1968             except TypeError:\n-> 1969                 raise ValueError(\"cannot convert %s into an element of %s\"%(p, self._indices))\n   1970 \n   1971         def is_field(self, proof=True):\n\nValueError: cannot convert 1 into an element of Ordered set partitions\nsage: M.indices().from_finite_word([2/2])\n[{1}]\nsage: M[M.indices().from_finite_word([2/2])]\nM[{1}]\nsage: M[M.indices().from_finite_word([2/2])] == M[1]\nTrue\n```\nDon't do `isinstance(x, (int, Integer))`. Use `x in ZZ`. Getting rational numbers instead of true integers is a very easy trap to fall into.\n\nI also think it would be good to document explicitly some of the ambiguities and says what it defaults to treating it as when it is ambiguous.",
    "created_at": "2018-09-27T04:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398619",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>


```
sage: M = algebras.WQSym(QQ).M()
sage: M[2/2]
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-2-e174bca538a0> in <module>()
----> 1 M[Integer(2)/Integer(2)]

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__getitem__ (build/cythonized/sage/structure/parent.c:11402)()
   1222             except AttributeError:
   1223                 return self.list()[n]
-> 1224         return meth(n)
   1225 
   1226     #################################################################################

/home/uqtscrim/sage-build/local/lib/python2.7/site-packages/sage/combinat/chas/wqsym.pyc in __getitem__(self, p)
   1967                 return self.monomial(self._indices(p))
   1968             except TypeError:
-> 1969                 raise ValueError("cannot convert %s into an element of %s"%(p, self._indices))
   1970 
   1971         def is_field(self, proof=True):

ValueError: cannot convert 1 into an element of Ordered set partitions
sage: M.indices().from_finite_word([2/2])
[{1}]
sage: M[M.indices().from_finite_word([2/2])]
M[{1}]
sage: M[M.indices().from_finite_word([2/2])] == M[1]
True
```
Don't do `isinstance(x, (int, Integer))`. Use `x in ZZ`. Getting rational numbers instead of true integers is a very easy trap to fall into.

I also think it would be good to document explicitly some of the ambiguities and says what it defaults to treating it as when it is ambiguous.



---

archive/issue_events_355072.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-27T04:00:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355072"
}
```



---

archive/issue_events_355073.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-27T04:00:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355073"
}
```



---

archive/issue_comments_398620.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-09-27T04:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398620",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_398621.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195\"><code>8e3b93f</code></a></td><td><code>getitem tweak; improving documentation</code></td></tr></table>\n",
    "created_at": "2018-09-27T18:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398621",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195"><code>8e3b93f</code></a></td><td><code>getitem tweak; improving documentation</code></td></tr></table>




---

archive/issue_comments_398622.json:
```json
{
    "body": "Changed commit from **[`f40d3e5`](https://github.com/sagemath/sagetrac-mirror/commit/f40d3e5fdbf66f25099bcd09f5e16f385a8cab35)** to **[`8e3b93f`](https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195)**",
    "created_at": "2018-09-27T18:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398622",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f40d3e5`](https://github.com/sagemath/sagetrac-mirror/commit/f40d3e5fdbf66f25099bcd09f5e16f385a8cab35)** to **[`8e3b93f`](https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195)**



---

archive/issue_comments_398623.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThank you. LGTM.",
    "created_at": "2018-09-27T21:52:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398623",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

Thank you. LGTM.



---

archive/issue_events_355074.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-27T21:52:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355074"
}
```



---

archive/issue_events_355075.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-27T21:52:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355075"
}
```



---

archive/issue_comments_398624.json:
```json
{
    "body": "Changed branch from **[public/combinat/allow-packed-words-in-wqsym-25913](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/allow-packed-words-in-wqsym-25913)** to **[`8e3b93f`](https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195)**",
    "created_at": "2018-09-29T11:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25913#issuecomment-398624",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/combinat/allow-packed-words-in-wqsym-25913](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/allow-packed-words-in-wqsym-25913)** to **[`8e3b93f`](https://github.com/sagemath/sagetrac-mirror/commit/8e3b93f729fba9d6368b4ab6cfb57d0040afe195)**



---

archive/issue_events_355076.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-29T11:59:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355076"
}
```



---

archive/issue_events_355077.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a090fd23c8a8c01109c37c75967d713b949c618f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-09-29T11:59:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25913",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25913#event-355077"
}
```
