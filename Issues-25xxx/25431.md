# Issue 25431: Timeouts in lattice precision

archive/issues_025194.json:
```json
{
    "body": "The patchbots time out with some lattice precision tests https://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-20-generic/petitbonum/2018-05-11%2012:03:31?short. I have also seen the same issues with [GitLab](GitLab) CI tests.\n\nThe test suite takes too much time, more precisely `_test_matrix_smith`.\n\n```\nsage: R = QpLC(7, label='init')\nsage: %time TestSuite(R).run(skip='_test_teichmuller')\nWall time: 2min 59s\nsage: %time R._test_matrix_smith()\nWall time: 2min 56s\n```\n\nCC:  @xcaruso @roed314 @fchapoton\n\nReviewer: Julian R\u00fcth, David Loeffler\n\nAuthor: Julian R\u00fcth, Xavier Caruso\n\nBranch: b80dc9e2d1996a76de2ef286d8860262cbfaaaa0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25431\n\n",
    "closed_at": "2018-05-28T07:45:39Z",
    "created_at": "2018-05-23T11:49:01Z",
    "labels": [
        "component: padics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Timeouts in lattice precision",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25431",
    "user": "https://github.com/saraedum"
}
```
The patchbots time out with some lattice precision tests https://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-20-generic/petitbonum/2018-05-11%2012:03:31?short. I have also seen the same issues with [GitLab](GitLab) CI tests.

The test suite takes too much time, more precisely `_test_matrix_smith`.

```
sage: R = QpLC(7, label='init')
sage: %time TestSuite(R).run(skip='_test_teichmuller')
Wall time: 2min 59s
sage: %time R._test_matrix_smith()
Wall time: 2min 56s
```

CC:  @xcaruso @roed314 @fchapoton

Reviewer: Julian Rüth, David Loeffler

Author: Julian Rüth, Xavier Caruso

Branch: b80dc9e2d1996a76de2ef286d8860262cbfaaaa0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25431





---

archive/issue_comments_354326.json:
```json
{
    "body": "<a id='comment:4'></a>I have not run doctests yet, so let's see if the patchbots are happy now.\n\n---\nNew commits:",
    "created_at": "2018-05-23T12:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354326",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>I have not run doctests yet, so let's see if the patchbots are happy now.

---
New commits:



---

archive/issue_comments_354327.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-23T12:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354327",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354328.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-23T12:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_354329.json:
```json
{
    "body": "<a id='comment:6'></a>I have launched my patchbot having the timeout issue, to see if the branch brings any progress.",
    "created_at": "2018-05-23T19:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354329",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>I have launched my patchbot having the timeout issue, to see if the branch brings any progress.



---

archive/issue_comments_354330.json:
```json
{
    "body": "<a id='comment:7'></a>This indeed seems to fix the timeout issue (see petibonum report)\n\nNote: my patchbot has found some pyflakes errors in the modified files, see the pyflakes plugin.",
    "created_at": "2018-05-24T05:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354330",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>This indeed seems to fix the timeout issue (see petibonum report)

Note: my patchbot has found some pyflakes errors in the modified files, see the pyflakes plugin.



---

archive/issue_comments_354331.json:
```json
{
    "body": "<a id='comment:8'></a>FYI: short doctests should take at most 1 second or so and long doctests at most 30 seconds (unless for exceptional reasons).",
    "created_at": "2018-05-24T19:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354331",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>FYI: short doctests should take at most 1 second or so and long doctests at most 30 seconds (unless for exceptional reasons).



---

archive/issue_comments_354332.json:
```json
{
    "body": "<a id='comment:10'></a>I fixed the pyflakes warnings.\n\n---\nNew commits:",
    "created_at": "2018-05-24T22:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354332",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:10'></a>I fixed the pyflakes warnings.

---
New commits:



---

archive/issue_comments_354333.json:
```json
{
    "body": "<a id='comment:12'></a>Xavier, your changes look good. Can you review my original changes?",
    "created_at": "2018-05-26T11:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354333",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:12'></a>Xavier, your changes look good. Can you review my original changes?



---

archive/issue_comments_354334.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-26T14:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354334",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_354335.json:
```json
{
    "body": "<a id='comment:13'></a>Changes look reasonable + it gets the timings down to an acceptable level. Positive review.",
    "created_at": "2018-05-26T14:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354335",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:13'></a>Changes look reasonable + it gets the timings down to an acceptable level. Positive review.



---

archive/issue_comments_354336.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-28T07:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354336",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063828.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-28T07:45:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25431#event-63828"
}
```



---

archive/issue_comments_354337.json:
```json
{
    "body": "<a id='comment:15'></a>As noted on the mailing list, I am also getting\n\n```\nsage -t src/sage/rings/padics/padic_base_leaves.py\n    Timed out (with segmentation fault after interrupt)\n```\n\non cygwin.  I will test this patch and see if the tests at least pass with these tests skipped by default (and I will also test with `--long`)",
    "created_at": "2018-05-31T09:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-354337",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>As noted on the mailing list, I am also getting

```
sage -t src/sage/rings/padics/padic_base_leaves.py
    Timed out (with segmentation fault after interrupt)
```

on cygwin.  I will test this patch and see if the tests at least pass with these tests skipped by default (and I will also test with `--long`)
