# Issue 25381: py3: adding .items iterator to vectors

archive/issues_025144.json:
```json
{
    "body": "to help build doc in python3\n\nCC:  @embray @jdemeyer\n\nBranch/Commit: 2fd6154ce97b94a5424f94a726ef09c8cd45fea0\n\nReviewer: Erik Bray\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25381\n\n",
    "closed_at": "2018-05-19T15:56:46Z",
    "created_at": "2018-05-17T08:20:53Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "py3: adding .items iterator to vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25381",
    "user": "https://github.com/fchapoton"
}
```
to help build doc in python3

CC:  @embray @jdemeyer

Branch/Commit: 2fd6154ce97b94a5424f94a726ef09c8cd45fea0

Reviewer: Erik Bray

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25381





---

archive/issue_comments_376796.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-05-17T08:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376796",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_376797.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-17T08:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376797",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_376798.json:
```json
{
    "body": "<a id='comment:2'></a>+1 in principle.\n\nI have a different approach to this in my python3 branch that I haven't made a ticket for yet.  What do you think?\n\n```diff\ndiff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx\nindex 29b2de1..814afa7 100644\n--- a/src/sage/modules/free_module_element.pyx\n+++ b/src/sage/modules/free_module_element.pyx\n@@ -821,6 +821,7 @@ def random_vector(ring, degree=None, *args, **kwds):\n     entries = [ring.random_element(*args, **kwds) for _ in range(degree)]\n     return vector(ring, degree, entries, sparse)\n\n+\n cdef class FreeModuleElement(Vector):   # abstract base class\n     \"\"\"\n     An element of a generic free module.\n@@ -1545,6 +1546,28 @@ cdef class FreeModuleElement(Vector):   # abstract base class\n         from sage.arith.all import lcm\n         return lcm(v)\n\n+    def items(self):\n+        \"\"\"\n+        Return an iterable over self.\n+\n+        On Python 2 this returns the same as ``list(self.iteritems())``, while\n+        on Python 3 this is an alias for ``self.items()``.  This is for\n+        congruence with ``dict.items()``.\n+\n+        EXAMPLES::\n+\n+            sage: v = vector([1, 2/3, pi])\n+            sage: v.items()  # py2\n+            [(0, 1), (1, 2/3), (2, pi)]\n+            sage: v.items()  # py3\n+            <generator object at ...>\n+        \"\"\"\n+\n+        IF PY_MAJOR_VERSION < 3:\n+            return list(self.iteritems())\n+        ELSE:\n+            return self.iteritems()\n+\n     def iteritems(self):\n         \"\"\"\n         Return iterator over self.\n@@ -4543,7 +4566,7 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):\n                 e = entries\n                 entries = {}\n                 try:\n-                    for k, x in e.iteritems():\n+                    for k, x in e.items():\n                         x = coefficient_ring(x)\n                         if x:\n                             entries[k] = x\n@@ -4734,11 +4757,11 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):\n\n             sage: v = vector([1,2/3,pi], sparse=True)\n             sage: v.iteritems()\n-            <dictionary-itemiterator object at ...>\n+            <dict...itemiterator object at ...>\n             sage: list(v.iteritems())\n             [(0, 1), (1, 2/3), (2, pi)]\n         \"\"\"\n-        return self._entries.iteritems()\n+        return iter(self._entries.iteritems())\n\n     def __reduce__(self):\n         \"\"\"\n```",
    "created_at": "2018-05-17T15:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376798",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>+1 in principle.

I have a different approach to this in my python3 branch that I haven't made a ticket for yet.  What do you think?

```diff
diff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx
index 29b2de1..814afa7 100644
--- a/src/sage/modules/free_module_element.pyx
+++ b/src/sage/modules/free_module_element.pyx
@@ -821,6 +821,7 @@ def random_vector(ring, degree=None, *args, **kwds):
     entries = [ring.random_element(*args, **kwds) for _ in range(degree)]
     return vector(ring, degree, entries, sparse)

+
 cdef class FreeModuleElement(Vector):   # abstract base class
     """
     An element of a generic free module.
@@ -1545,6 +1546,28 @@ cdef class FreeModuleElement(Vector):   # abstract base class
         from sage.arith.all import lcm
         return lcm(v)

+    def items(self):
+        """
+        Return an iterable over self.
+
+        On Python 2 this returns the same as ``list(self.iteritems())``, while
+        on Python 3 this is an alias for ``self.items()``.  This is for
+        congruence with ``dict.items()``.
+
+        EXAMPLES::
+
+            sage: v = vector([1, 2/3, pi])
+            sage: v.items()  # py2
+            [(0, 1), (1, 2/3), (2, pi)]
+            sage: v.items()  # py3
+            <generator object at ...>
+        """
+
+        IF PY_MAJOR_VERSION < 3:
+            return list(self.iteritems())
+        ELSE:
+            return self.iteritems()
+
     def iteritems(self):
         """
         Return iterator over self.
@@ -4543,7 +4566,7 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):
                 e = entries
                 entries = {}
                 try:
-                    for k, x in e.iteritems():
+                    for k, x in e.items():
                         x = coefficient_ring(x)
                         if x:
                             entries[k] = x
@@ -4734,11 +4757,11 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):

             sage: v = vector([1,2/3,pi], sparse=True)
             sage: v.iteritems()
-            <dictionary-itemiterator object at ...>
+            <dict...itemiterator object at ...>
             sage: list(v.iteritems())
             [(0, 1), (1, 2/3), (2, pi)]
         """
-        return self._entries.iteritems()
+        return iter(self._entries.iteritems())

     def __reduce__(self):
         """
```



---

archive/issue_comments_376799.json:
```json
{
    "body": "<a id='comment:3'></a>oh, well. Given that \"items\" currently does not exist, one can just provide it directly with the python3 behaviour. Otherwise, this opens the possibility that someone will use that \"items\" in a python3-incompatible way, and that we will have to fix this bad use later..",
    "created_at": "2018-05-17T17:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376799",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>oh, well. Given that "items" currently does not exist, one can just provide it directly with the python3 behaviour. Otherwise, this opens the possibility that someone will use that "items" in a python3-incompatible way, and that we will have to fix this bad use later..



---

archive/issue_comments_376800.json:
```json
{
    "body": "<a id='comment:4'></a>That is true--the question is to be compatible with Python 2 semantics on Python 2, or just be immediately forward-compatible with Python 3.  Since `FreeModuleElement` is not *actually* a `dict` subclass I think we have some freedom to pick the latter.\n\nIn that case though what you might do instead is actually rename the `iteritems()` method to just `items()` and make `iteritems()` and deprecated (perhaps just informally?) alias for `items()`.",
    "created_at": "2018-05-18T12:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376800",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>That is true--the question is to be compatible with Python 2 semantics on Python 2, or just be immediately forward-compatible with Python 3.  Since `FreeModuleElement` is not *actually* a `dict` subclass I think we have some freedom to pick the latter.

In that case though what you might do instead is actually rename the `iteritems()` method to just `items()` and make `iteritems()` and deprecated (perhaps just informally?) alias for `items()`.



---

archive/issue_comments_376801.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-18T13:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376802.json:
```json
{
    "body": "<a id='comment:6'></a>Done.\n\nI do not think that one should deprecate formally anything.",
    "created_at": "2018-05-18T13:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376802",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>Done.

I do not think that one should deprecate formally anything.



---

archive/issue_comments_376803.json:
```json
{
    "body": "<a id='comment:7'></a>I'm inclined to agree in this case, though I can't quite articulate why.",
    "created_at": "2018-05-18T13:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376803",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>I'm inclined to agree in this case, though I can't quite articulate why.



---

archive/issue_comments_376804.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-18T13:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376804",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_376805.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-19T15:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25381#issuecomment-376805",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063671.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-19T15:56:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25381",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25381#event-63671"
}
```
