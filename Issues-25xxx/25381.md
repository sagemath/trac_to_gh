# Issue 25381: py3: adding .items iterator to vectors

archive/issues_025144.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nto help build doc in python3\n\nCC:  @embray @jdemeyer\n\nComponent: **python3**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`2fd6154`](https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0)**\n\nReviewer: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25381_\n\n",
    "closed_at": "2018-05-19T15:56:46Z",
    "created_at": "2018-05-17T08:20:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: adding .items iterator to vectors",
    "type": "issue",
    "updated_at": "2018-05-19T15:56:46Z",
    "url": "https://github.com/sagemath/sage/issues/25381",
    "user": "https://github.com/fchapoton"
}
```
<div id="comment:0"></div>

to help build doc in python3

CC:  @embray @jdemeyer

Component: **python3**

Author: **Frédéric Chapoton**

Branch/Commit: **[`2fd6154`](https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0)**

Reviewer: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/25381_





---

archive/issue_events_348228.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-17T08:20:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348228"
}
```



---

archive/issue_events_348229.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-17T08:20:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348229"
}
```



---

archive/issue_events_348230.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-17T08:20:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348230"
}
```



---

archive/issue_events_348231.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-17T08:20:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348231"
}
```



---

archive/issue_comments_388381.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbd18885ff45659d9a57c9024dc01567a22bc0df\"><code>cbd1888</code></a></td><td><code>adding .items method to vectors for py3 sake</code></td></tr></table>\n",
    "created_at": "2018-05-17T08:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388381",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbd18885ff45659d9a57c9024dc01567a22bc0df"><code>cbd1888</code></a></td><td><code>adding .items method to vectors for py3 sake</code></td></tr></table>




---

archive/issue_events_348232.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-17T08:21:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348232"
}
```



---

archive/issue_comments_388382.json:
```json
{
    "body": "Commit: **[`cbd1888`](https://github.com/sagemath/sagetrac-mirror/commit/cbd18885ff45659d9a57c9024dc01567a22bc0df)**",
    "created_at": "2018-05-17T08:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388382",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`cbd1888`](https://github.com/sagemath/sagetrac-mirror/commit/cbd18885ff45659d9a57c9024dc01567a22bc0df)**



---

archive/issue_comments_388383.json:
```json
{
    "body": "Branch: **[u/chapoton/25381](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25381)**",
    "created_at": "2018-05-17T08:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388383",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/25381](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25381)**



---

archive/issue_comments_388384.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n+1 in principle.\n\nI have a different approach to this in my python3 branch that I haven't made a ticket for yet.  What do you think?\n\n```diff\ndiff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx\nindex 29b2de1..814afa7 100644\n--- a/src/sage/modules/free_module_element.pyx\n+++ b/src/sage/modules/free_module_element.pyx\n@@ -821,6 +821,7 @@ def random_vector(ring, degree=None, *args, **kwds):\n     entries = [ring.random_element(*args, **kwds) for _ in range(degree)]\n     return vector(ring, degree, entries, sparse)\n\n+\n cdef class FreeModuleElement(Vector):   # abstract base class\n     \"\"\"\n     An element of a generic free module.\n@@ -1545,6 +1546,28 @@ cdef class FreeModuleElement(Vector):   # abstract base class\n         from sage.arith.all import lcm\n         return lcm(v)\n\n+    def items(self):\n+        \"\"\"\n+        Return an iterable over self.\n+\n+        On Python 2 this returns the same as ``list(self.iteritems())``, while\n+        on Python 3 this is an alias for ``self.items()``.  This is for\n+        congruence with ``dict.items()``.\n+\n+        EXAMPLES::\n+\n+            sage: v = vector([1, 2/3, pi])\n+            sage: v.items()  # py2\n+            [(0, 1), (1, 2/3), (2, pi)]\n+            sage: v.items()  # py3\n+            <generator object at ...>\n+        \"\"\"\n+\n+        IF PY_MAJOR_VERSION < 3:\n+            return list(self.iteritems())\n+        ELSE:\n+            return self.iteritems()\n+\n     def iteritems(self):\n         \"\"\"\n         Return iterator over self.\n@@ -4543,7 +4566,7 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):\n                 e = entries\n                 entries = {}\n                 try:\n-                    for k, x in e.iteritems():\n+                    for k, x in e.items():\n                         x = coefficient_ring(x)\n                         if x:\n                             entries[k] = x\n@@ -4734,11 +4757,11 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):\n\n             sage: v = vector([1,2/3,pi], sparse=True)\n             sage: v.iteritems()\n-            <dictionary-itemiterator object at ...>\n+            <dict...itemiterator object at ...>\n             sage: list(v.iteritems())\n             [(0, 1), (1, 2/3), (2, pi)]\n         \"\"\"\n-        return self._entries.iteritems()\n+        return iter(self._entries.iteritems())\n\n     def __reduce__(self):\n         \"\"\"\n```",
    "created_at": "2018-05-17T15:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388384",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

+1 in principle.

I have a different approach to this in my python3 branch that I haven't made a ticket for yet.  What do you think?

```diff
diff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx
index 29b2de1..814afa7 100644
--- a/src/sage/modules/free_module_element.pyx
+++ b/src/sage/modules/free_module_element.pyx
@@ -821,6 +821,7 @@ def random_vector(ring, degree=None, *args, **kwds):
     entries = [ring.random_element(*args, **kwds) for _ in range(degree)]
     return vector(ring, degree, entries, sparse)

+
 cdef class FreeModuleElement(Vector):   # abstract base class
     """
     An element of a generic free module.
@@ -1545,6 +1546,28 @@ cdef class FreeModuleElement(Vector):   # abstract base class
         from sage.arith.all import lcm
         return lcm(v)

+    def items(self):
+        """
+        Return an iterable over self.
+
+        On Python 2 this returns the same as ``list(self.iteritems())``, while
+        on Python 3 this is an alias for ``self.items()``.  This is for
+        congruence with ``dict.items()``.
+
+        EXAMPLES::
+
+            sage: v = vector([1, 2/3, pi])
+            sage: v.items()  # py2
+            [(0, 1), (1, 2/3), (2, pi)]
+            sage: v.items()  # py3
+            <generator object at ...>
+        """
+
+        IF PY_MAJOR_VERSION < 3:
+            return list(self.iteritems())
+        ELSE:
+            return self.iteritems()
+
     def iteritems(self):
         """
         Return iterator over self.
@@ -4543,7 +4566,7 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):
                 e = entries
                 entries = {}
                 try:
-                    for k, x in e.iteritems():
+                    for k, x in e.items():
                         x = coefficient_ring(x)
                         if x:
                             entries[k] = x
@@ -4734,11 +4757,11 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):

             sage: v = vector([1,2/3,pi], sparse=True)
             sage: v.iteritems()
-            <dictionary-itemiterator object at ...>
+            <dict...itemiterator object at ...>
             sage: list(v.iteritems())
             [(0, 1), (1, 2/3), (2, pi)]
         """
-        return self._entries.iteritems()
+        return iter(self._entries.iteritems())

     def __reduce__(self):
         """
```



---

archive/issue_comments_388385.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\noh, well. Given that \"items\" currently does not exist, one can just provide it directly with the python3 behaviour. Otherwise, this opens the possibility that someone will use that \"items\" in a python3-incompatible way, and that we will have to fix this bad use later..",
    "created_at": "2018-05-17T17:07:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388385",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

oh, well. Given that "items" currently does not exist, one can just provide it directly with the python3 behaviour. Otherwise, this opens the possibility that someone will use that "items" in a python3-incompatible way, and that we will have to fix this bad use later..



---

archive/issue_comments_388386.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThat is true--the question is to be compatible with Python 2 semantics on Python 2, or just be immediately forward-compatible with Python 3.  Since `FreeModuleElement` is not *actually* a `dict` subclass I think we have some freedom to pick the latter.\n\nIn that case though what you might do instead is actually rename the `iteritems()` method to just `items()` and make `iteritems()` and deprecated (perhaps just informally?) alias for `items()`.",
    "created_at": "2018-05-18T12:26:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388386",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

That is true--the question is to be compatible with Python 2 semantics on Python 2, or just be immediately forward-compatible with Python 3.  Since `FreeModuleElement` is not *actually* a `dict` subclass I think we have some freedom to pick the latter.

In that case though what you might do instead is actually rename the `iteritems()` method to just `items()` and make `iteritems()` and deprecated (perhaps just informally?) alias for `items()`.



---

archive/issue_comments_388387.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0\"><code>2fd6154</code></a></td><td><code>trac 25381 iteritems as an alias of items for vectors</code></td></tr></table>\n",
    "created_at": "2018-05-18T13:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388387",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0"><code>2fd6154</code></a></td><td><code>trac 25381 iteritems as an alias of items for vectors</code></td></tr></table>




---

archive/issue_comments_388388.json:
```json
{
    "body": "Changed commit from **[`cbd1888`](https://github.com/sagemath/sagetrac-mirror/commit/cbd18885ff45659d9a57c9024dc01567a22bc0df)** to **[`2fd6154`](https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0)**",
    "created_at": "2018-05-18T13:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388388",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cbd1888`](https://github.com/sagemath/sagetrac-mirror/commit/cbd18885ff45659d9a57c9024dc01567a22bc0df)** to **[`2fd6154`](https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0)**



---

archive/issue_comments_388389.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDone.\n\nI do not think that one should deprecate formally anything.",
    "created_at": "2018-05-18T13:32:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388389",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

Done.

I do not think that one should deprecate formally anything.



---

archive/issue_comments_388390.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'm inclined to agree in this case, though I can't quite articulate why.",
    "created_at": "2018-05-18T13:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388390",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

I'm inclined to agree in this case, though I can't quite articulate why.



---

archive/issue_events_348233.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-18T13:34:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348233"
}
```



---

archive/issue_events_348234.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-18T13:34:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348234"
}
```



---

archive/issue_comments_388391.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2018-05-18T13:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388391",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_388392.json:
```json
{
    "body": "Changed branch from **[u/chapoton/25381](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25381)** to **[`2fd6154`](https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0)**",
    "created_at": "2018-05-19T15:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25381#issuecomment-388392",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/25381](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25381)** to **[`2fd6154`](https://github.com/sagemath/sagetrac-mirror/commit/2fd6154ce97b94a5424f94a726ef09c8cd45fea0)**



---

archive/issue_events_348235.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-19T15:56:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348235"
}
```



---

archive/issue_events_348236.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d1c9fb9227a1db4f4eb2cf496304a2c8768dd7d7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-05-19T15:56:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25381",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25381#event-348236"
}
```
