# Issue 25019: no error raised when dividing by (lazy) zero in AA or QQbar

archive/issues_024782.json:
```json
{
    "body": "CC:  @bgrenet @gagern @mkoeppe @mezzarobba @slel tmonteil @videlec\n\nKeywords: division by zero, AA\n\nDividing by zero in AA or QQbar is currently allowed and can lead to terrible arithmetic inconsistency such as\n\n```\nsage: a = QQbar(I).real()\nsage: b = ~a\nsage: (a*b).is_zero()\nTrue\n```\nWe had check for nonzero denominator in divisions.\n\n---\nOriginal report:\n\nSometimes dividing by zero in `AA` results in returning an object which prints as\n\n```\n[-infinity .. +infinity]\n```\nOther times the `ZeroDivisionError` is raised.\n\nI am not sure what the \"[-infinity .. +infinity]\" object is and as far as I can tell there are no methods in `AA` to test for it, so my feeling is that this return is erroneous. I believe that dividing by zero should always be handled in a consistent way, which it is not as the following example illustrates:\n\n```\nsage: z = QQbar(I).real()\nsage: z\n0\nsage: ~z  # or 1/z\n[-infinity .. +infinity]\nsage: z == 0  # or z.is_zero()\nTrue\nsage: ~z  # or 1/z\nTraceback (most recent call last)\n...\nZeroDivisionError: rational division by zero\n```\n\nThe above example clearly indicates that simply testing the value of variables in `AA` (which you would naively guess has no effect on their internal state) changes the outcome of division (by zero). Reminds me of quantum mechanics...\n\nI think this is a significant issue because people unaware of the possibility of a `[-infinity .. +infinity]` return will not test for it.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25019\n\n",
    "closed_at": "2019-10-03T17:58:23Z",
    "created_at": "2018-03-21T15:27:58Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "no error raised when dividing by (lazy) zero in AA or QQbar",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25019",
    "user": "https://trac.sagemath.org/admin/accounts/users/wphooper"
}
```
CC:  @bgrenet @gagern @mkoeppe @mezzarobba @slel tmonteil @videlec

Keywords: division by zero, AA

Dividing by zero in AA or QQbar is currently allowed and can lead to terrible arithmetic inconsistency such as

```
sage: a = QQbar(I).real()
sage: b = ~a
sage: (a*b).is_zero()
True
```
We had check for nonzero denominator in divisions.

---
Original report:

Sometimes dividing by zero in `AA` results in returning an object which prints as

```
[-infinity .. +infinity]
```
Other times the `ZeroDivisionError` is raised.

I am not sure what the "[-infinity .. +infinity]" object is and as far as I can tell there are no methods in `AA` to test for it, so my feeling is that this return is erroneous. I believe that dividing by zero should always be handled in a consistent way, which it is not as the following example illustrates:

```
sage: z = QQbar(I).real()
sage: z
0
sage: ~z  # or 1/z
[-infinity .. +infinity]
sage: z == 0  # or z.is_zero()
True
sage: ~z  # or 1/z
Traceback (most recent call last)
...
ZeroDivisionError: rational division by zero
```

The above example clearly indicates that simply testing the value of variables in `AA` (which you would naively guess has no effect on their internal state) changes the outcome of division (by zero). Reminds me of quantum mechanics...

I think this is a significant issue because people unaware of the possibility of a `[-infinity .. +infinity]` return will not test for it.

Issue created by migration from https://trac.sagemath.org/ticket/25019





---

archive/issue_events_062757.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-09-18T04:57:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25019#event-62757"
}
```



---

archive/issue_comments_347574.json:
```json
{
    "body": "Edit description with simpler example illustrating the issue.",
    "created_at": "2019-09-18T04:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347574",
    "user": "https://github.com/slel"
}
```

Edit description with simpler example illustrating the issue.



---

archive/issue_comments_347575.json:
```json
{
    "body": "There is a lazyness mechanism of the computations in `QQbar`, which does not compute (costly) exactifications unless it is required to save time, see for example:\n\n```\nsage: a = QQbar(2)\nsage: b = a.sqrt()\nsage: b\n1.414213562373095?\nsage: b^2\n2.000000000000000?\nsage: b^2 < 4       # this is fast because Sage does not need exactifying b^2 for deciding\nTrue\nsage: b^2\n2.000000000000000?\nsage: b^2 == 2      # this exact computation requires exactification, of course the better internal representation is kept for further computations\nTrue\nsage: b^2\n```\n\nI admit that in your case, an error is delayed, but i guess that in a \"true\" computation process, the error will happen anyway later. Exactifying to catch such error on-time might slow down every `QQbar` computation.",
    "created_at": "2019-09-18T09:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347575",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

There is a lazyness mechanism of the computations in `QQbar`, which does not compute (costly) exactifications unless it is required to save time, see for example:

```
sage: a = QQbar(2)
sage: b = a.sqrt()
sage: b
1.414213562373095?
sage: b^2
2.000000000000000?
sage: b^2 < 4       # this is fast because Sage does not need exactifying b^2 for deciding
True
sage: b^2
2.000000000000000?
sage: b^2 == 2      # this exact computation requires exactification, of course the better internal representation is kept for further computations
True
sage: b^2
```

I admit that in your case, an error is delayed, but i guess that in a "true" computation process, the error will happen anyway later. Exactifying to catch such error on-time might slow down every `QQbar` computation.



---

archive/issue_comments_347576.json:
```json
{
    "body": "Replying to [comment:2 tmonteil]:\n> There is a lazyness mechanism of the computations in `QQbar`, which does not compute (costly) exactifications unless it is required to save time, see for example:\n> \n> \n> ```\n> sage: a = QQbar(2)\n> sage: b = a.sqrt()\n> sage: b\n> 1.414213562373095?\n> sage: b^2\n> 2.000000000000000?\n> sage: b^2 < 4       # this is fast because Sage does not need exactifying b^2 for deciding\n> True\n> sage: b^2\n> 2.000000000000000?\n> sage: b^2 == 2      # this exact computation requires exactification, of course the better internal representation is kept for further computations\n> True\n> sage: b^2\n> ```\n> \n> I admit that in your case, an error is delayed, but i guess that in a \"true\" computation process, the error will happen anyway later. Exactifying to catch such error on-time might slow down every `QQbar` computation.\n\n\nIn case a division is performed, we must check for nonzeroness. Otherwise, we can easily end up with inconsistent results if automatic simplification happen later.",
    "created_at": "2019-09-18T12:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347576",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:2 tmonteil]:
> There is a lazyness mechanism of the computations in `QQbar`, which does not compute (costly) exactifications unless it is required to save time, see for example:
> 
> 
> ```
> sage: a = QQbar(2)
> sage: b = a.sqrt()
> sage: b
> 1.414213562373095?
> sage: b^2
> 2.000000000000000?
> sage: b^2 < 4       # this is fast because Sage does not need exactifying b^2 for deciding
> True
> sage: b^2
> 2.000000000000000?
> sage: b^2 == 2      # this exact computation requires exactification, of course the better internal representation is kept for further computations
> True
> sage: b^2
> ```
> 
> I admit that in your case, an error is delayed, but i guess that in a "true" computation process, the error will happen anyway later. Exactifying to catch such error on-time might slow down every `QQbar` computation.


In case a division is performed, we must check for nonzeroness. Otherwise, we can easily end up with inconsistent results if automatic simplification happen later.



---

archive/issue_comments_347577.json:
```json
{
    "body": "For example, this is a critical bug\n\n```\nsage: z = QQbar(I).real()\nsage: a = ~z\nsage: (z*a).is_zero()\nTrue\n```",
    "created_at": "2019-09-18T12:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347577",
    "user": "https://github.com/videlec"
}
```

For example, this is a critical bug

```
sage: z = QQbar(I).real()
sage: a = ~z
sage: (z*a).is_zero()
True
```



---

archive/issue_comments_347578.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-18T15:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347578",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347579.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-09-18T15:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347579",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_347580.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-18T15:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347580",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347581.json:
```json
{
    "body": "one failing doctest in src/sage/rings/integer.pyx",
    "created_at": "2019-09-18T18:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347581",
    "user": "https://github.com/fchapoton"
}
```

one failing doctest in src/sage/rings/integer.pyx



---

archive/issue_comments_347582.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-18T20:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347583.json:
```json
{
    "body": "Fixed... Though, I don't understand why this is tested in `integer.pyx`.",
    "created_at": "2019-09-18T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347583",
    "user": "https://github.com/videlec"
}
```

Fixed... Though, I don't understand why this is tested in `integer.pyx`.



---

archive/issue_comments_347584.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-19T07:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347584",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347585.json:
```json
{
    "body": "feu vert",
    "created_at": "2019-09-19T07:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347585",
    "user": "https://github.com/fchapoton"
}
```

feu vert



---

archive/issue_comments_347586.json:
```json
{
    "body": "Maybe tangentially related: #28530.",
    "created_at": "2019-09-23T13:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347586",
    "user": "https://github.com/mezzarobba"
}
```

Maybe tangentially related: #28530.



---

archive/issue_events_062758.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-03T17:58:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25019#event-62758"
}
```



---

archive/issue_comments_347587.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-03T17:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25019#issuecomment-347587",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
