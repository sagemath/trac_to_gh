# Issue 25358: Test safe directory without python subprocess

archive/issues_025121.json:
```json
{
    "body": "The `test_safe_directory` function currently works by spawning a python subprocess and relying on the `sys_path_security-issue_16202.patch` being applied (https://bugs.python.org/issue16202).\n\nThat is not really necessary: This commit changes the implementation to use `os.stat` instead. That has several advantages:\n\n- does not depend on the python patch\n- saves the (small) overhead of forking a new python process\n- is simpler / more obvious to implement\n\n**CC:**  @jdemeyer @embray @slel @kiwifb @jhpalmieri\n\n**Branch/Commit:** [904b1a18742e5677aa8de02920b7bf3a13ae4c68](https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68)\n\n**Reviewer:** Matthias Koeppe, Dima Pasechnik\n\n**Author:** Timo Kaufmann\n\nIssue created by migration from https://trac.sagemath.org/ticket/25358\n\n",
    "closed_at": "2020-03-29T00:24:20Z",
    "created_at": "2018-05-13T19:49:54Z",
    "labels": [
        "component: distribution",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "Test safe directory without python subprocess",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/25358",
    "user": "https://github.com/timokau"
}
```
The `test_safe_directory` function currently works by spawning a python subprocess and relying on the `sys_path_security-issue_16202.patch` being applied (https://bugs.python.org/issue16202).

That is not really necessary: This commit changes the implementation to use `os.stat` instead. That has several advantages:

- does not depend on the python patch
- saves the (small) overhead of forking a new python process
- is simpler / more obvious to implement

**CC:**  @jdemeyer @embray @slel @kiwifb @jhpalmieri

**Branch/Commit:** [904b1a18742e5677aa8de02920b7bf3a13ae4c68](https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68)

**Reviewer:** Matthias Koeppe, Dima Pasechnik

**Author:** Timo Kaufmann

Issue created by migration from https://trac.sagemath.org/ticket/25358





---

archive/issue_comments_390402.json:
```json
{
    "body": "**Commit:** [dc673c17555efca611f68398d5013b66e9825463](https://github.com/sagemath/sagetrac-mirror/commit/dc673c17555efca611f68398d5013b66e9825463)",
    "created_at": "2018-05-13T19:50:49Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390402",
    "user": "https://github.com/timokau"
}
```

**Commit:** [dc673c17555efca611f68398d5013b66e9825463](https://github.com/sagemath/sagetrac-mirror/commit/dc673c17555efca611f68398d5013b66e9825463)



---

archive/issue_comments_390403.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc673c17555efca611f68398d5013b66e9825463\">dc673c1</a></td><td><code>Test safe directory without subprocess</code></td></tr></table>\n",
    "created_at": "2018-05-13T19:50:49Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390403",
    "user": "https://github.com/timokau"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc673c17555efca611f68398d5013b66e9825463">dc673c1</a></td><td><code>Test safe directory without subprocess</code></td></tr></table>




---

archive/issue_comments_390404.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-timokau/python-safe-diretory](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/python-safe-diretory)\" to \"[u/gh-timokau/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/python-safe-directory)\".",
    "created_at": "2018-05-13T19:50:49Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390404",
    "user": "https://github.com/timokau"
}
```

**Changing branch** from "[u/gh-timokau/python-safe-diretory](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/python-safe-diretory)" to "[u/gh-timokau/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/python-safe-directory)".



---

archive/issue_events_224995.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-13T19:50:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-224995"
}
```



---

archive/issue_events_224996.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-14T05:25:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-224996"
}
```



---

archive/issue_events_224997.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-14T05:25:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-224997"
}
```



---

archive/issue_comments_390405.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis patch changes behaviour. The security check implemented in the Python patch is more complicated that this simple check. It involves group permissions, umask...\n\nThis brings us to the main *advantage* of the subprocess approach: it's very simple to get the same behaviour as Python.",
    "created_at": "2018-05-14T05:25:52Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390405",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
This patch changes behaviour. The security check implemented in the Python patch is more complicated that this simple check. It involves group permissions, umask...

This brings us to the main *advantage* of the subprocess approach: it's very simple to get the same behaviour as Python.



---

archive/issue_comments_390406.json:
```json
{
    "body": "<a id='comment:3'></a>\nFor Sage, another advantage of the subprocess approach that it is implicitly also a test of the logic in the Python patch.",
    "created_at": "2018-05-14T05:29:05Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390406",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
For Sage, another advantage of the subprocess approach that it is implicitly also a test of the logic in the Python patch.



---

archive/issue_comments_390407.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jdemeyer](#comment%3A2):\n> This patch changes behaviour. The security check implemented in the Python patch is more complicated that this simple check. It involves group permissions, umask...\n\n\nFor reference: [here](https://gist.github.com/timokau/e3aa33a997e0f3296a9ba53972348031) is the relevant permission checking code. Some of that seems arbitrary to me, for example `/* Only keep group bit if the current group ID is the same as the group of \"parent\" */`. But it probably wouldn't be too hard to implement that logic in python.\n\n> This brings us to the main *advantage* of the subprocess approach: it's very simple to get the same behaviour as Python.\n\n\n> For Sage, another advantage of the subprocess approach that it is implicitly also a test of the logic in the Python patch.\n\n\nBut whats the value in that? Only sages python has that behaviour anyways and the upstream patch looks like a loosing battle.\n\nCurrently the result is that [debian](https://salsa.debian.org/science-team/sagemath/blob/master/debian/patches/df-python_security.patch) and [gentoo](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/files/sage-7.3-safepython.patch) (and nix) simply disable the test while arch just failes it.",
    "created_at": "2018-05-14T09:28:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390407",
    "user": "https://github.com/timokau"
}
```

<a id='comment:4'></a>
Replying to [jdemeyer](#comment%3A2):
> This patch changes behaviour. The security check implemented in the Python patch is more complicated that this simple check. It involves group permissions, umask...


For reference: [here](https://gist.github.com/timokau/e3aa33a997e0f3296a9ba53972348031) is the relevant permission checking code. Some of that seems arbitrary to me, for example `/* Only keep group bit if the current group ID is the same as the group of "parent" */`. But it probably wouldn't be too hard to implement that logic in python.

> This brings us to the main *advantage* of the subprocess approach: it's very simple to get the same behaviour as Python.


> For Sage, another advantage of the subprocess approach that it is implicitly also a test of the logic in the Python patch.


But whats the value in that? Only sages python has that behaviour anyways and the upstream patch looks like a loosing battle.

Currently the result is that [debian](https://salsa.debian.org/science-team/sagemath/blob/master/debian/patches/df-python_security.patch) and [gentoo](https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/files/sage-7.3-safepython.patch) (and nix) simply disable the test while arch just failes it.



---

archive/issue_events_224998.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-14T09:29:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-224998"
}
```



---

archive/issue_events_224999.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-05-14T09:29:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-224999"
}
```



---

archive/issue_comments_390408.json:
```json
{
    "body": "<a id='comment:5'></a>\nChanging to needs_review because I don't know what work is needed yet: Do you want me to implement more of that python patch logic in sage?",
    "created_at": "2018-05-14T09:29:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390408",
    "user": "https://github.com/timokau"
}
```

<a id='comment:5'></a>
Changing to needs_review because I don't know what work is needed yet: Do you want me to implement more of that python patch logic in sage?



---

archive/issue_comments_390409.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [gh-timokau](#comment%3A4):\n> and the upstream patch looks like a loosing battle.\n\n\nI don't see it as a \"battle\". If upstream Python wants to continue shipping their Python with a huge security hole, it's their problem. That's how I see it.",
    "created_at": "2018-05-14T09:48:52Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390409",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [gh-timokau](#comment%3A4):
> and the upstream patch looks like a loosing battle.


I don't see it as a "battle". If upstream Python wants to continue shipping their Python with a huge security hole, it's their problem. That's how I see it.



---

archive/issue_comments_390410.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jdemeyer](#comment%3A6):\n> Replying to [gh-timokau](#comment%3A4):\n> > and the upstream patch looks like a loosing battle.\n\n> \n> I don't see it as a \"battle\". If upstream Python wants to continue shipping their Python with a huge security hole, it's their problem. That's how I see it.\n\n\nRight, but if it makes packaging harder that makes it our problem, too. In the end its not really sages place to judge and test for that behaviour. I'm not suggesting to remove the patch from \"sage-the-distribution\", just that the doctests don't depend on it. In my opinion thats better than every distribution removing the test individually.",
    "created_at": "2018-05-14T10:00:47Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390410",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'></a>
Replying to [jdemeyer](#comment%3A6):
> Replying to [gh-timokau](#comment%3A4):
> > and the upstream patch looks like a loosing battle.

> 
> I don't see it as a "battle". If upstream Python wants to continue shipping their Python with a huge security hole, it's their problem. That's how I see it.


Right, but if it makes packaging harder that makes it our problem, too. In the end its not really sages place to judge and test for that behaviour. I'm not suggesting to remove the patch from "sage-the-distribution", just that the doctests don't depend on it. In my opinion thats better than every distribution removing the test individually.



---

archive/issue_comments_390411.json:
```json
{
    "body": "<a id='comment:8'></a>\nCan I do anything to push this ticket forward @jdemeyer?",
    "created_at": "2018-06-30T16:43:55Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390411",
    "user": "https://github.com/timokau"
}
```

<a id='comment:8'></a>
Can I do anything to push this ticket forward @jdemeyer?



---

archive/issue_comments_390412.json:
```json
{
    "body": "<a id='comment:9'></a>\nupdate milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390412",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
update milestone 8.3 -> 8.4



---

archive/issue_events_225000.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225000"
}
```



---

archive/issue_events_225001.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225001"
}
```



---

archive/issue_comments_390413.json:
```json
{
    "body": "<a id='comment:10'></a>\nImho we should not depend on a patched Python in our doctesting.\n\nI appreciate the patch to Python as such. Loading random modules from `.` is certainly something that many people are not aware of so it made sense to patch this upstream and to backport that patch to Sage-the-distribution.\n\nI am not convinced that we should change Python's doctesting behaviour as such. We should change not common behaviour, I think: if Python does not check that the current directory is safe in its built-in doctesting, we should not do that either; after all we're just a Python library. But I can imagine that some disagree.\n\nAnyway, we should not check that we are running on patched Python. So my proposal is to make this a Python3 check instead.",
    "created_at": "2018-10-10T11:40:30Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390413",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>
Imho we should not depend on a patched Python in our doctesting.

I appreciate the patch to Python as such. Loading random modules from `.` is certainly something that many people are not aware of so it made sense to patch this upstream and to backport that patch to Sage-the-distribution.

I am not convinced that we should change Python's doctesting behaviour as such. We should change not common behaviour, I think: if Python does not check that the current directory is safe in its built-in doctesting, we should not do that either; after all we're just a Python library. But I can imagine that some disagree.

Anyway, we should not check that we are running on patched Python. So my proposal is to make this a Python3 check instead.



---

archive/issue_comments_390414.json:
```json
{
    "body": "<a id='comment:11'></a>\nHm\u2026somehow I was under the impression that the warning was part of Python3 now...that does not seem to be the case.\n\nIn that case, I propose to remove that doctest completely.",
    "created_at": "2018-10-10T11:43:59Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390414",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:11'></a>
Hm…somehow I was under the impression that the warning was part of Python3 now...that does not seem to be the case.

In that case, I propose to remove that doctest completely.



---

archive/issue_comments_390415.json:
```json
{
    "body": "<a id='comment:12'></a>\nI tried to start a more general discussion at #26457.",
    "created_at": "2018-10-10T12:24:06Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390415",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:12'></a>
I tried to start a more general discussion at #26457.



---

archive/issue_comments_390416.json:
```json
{
    "body": "<a id='comment:13'></a>\n+1.  My one concern is that this might have impact on Cygwin if the directory in question is not on a mount with POSIX permissions emulation, but I need to check.",
    "created_at": "2018-10-28T17:03:23Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390416",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
+1.  My one concern is that this might have impact on Cygwin if the directory in question is not on a mount with POSIX permissions emulation, but I need to check.



---

archive/issue_comments_390417.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n The `test_safe_directory` function currently works by spawning a python subprocess and relying on the `sys_path_security-issue_16202.patch` being applied (https://bugs.python.org/issue16202).\n \n-That is not really necessary: This commit changes the implementation to use `os.stat\u00b4 instead. That has several disadvantages:\n+That is not really necessary: This commit changes the implementation to use `os.stat` instead. That has several advantages:\n \n - does not depend on the python patch\n - saves the (small) overhead of forking a new python process\n``````\n",
    "created_at": "2019-02-28T16:04:19Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390417",
    "user": "https://github.com/timokau"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 The `test_safe_directory` function currently works by spawning a python subprocess and relying on the `sys_path_security-issue_16202.patch` being applied (https://bugs.python.org/issue16202).
 
-That is not really necessary: This commit changes the implementation to use `os.stat´ instead. That has several disadvantages:
+That is not really necessary: This commit changes the implementation to use `os.stat` instead. That has several advantages:
 
 - does not depend on the python patch
 - saves the (small) overhead of forking a new python process
``````




---

archive/issue_events_225002.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T11:08:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225002"
}
```



---

archive/issue_events_225003.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T11:08:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225003"
}
```



---

archive/issue_comments_390418.json:
```json
{
    "body": "<a id='comment:16'></a>\nCan we move on either here or in #27529, please ?",
    "created_at": "2019-05-24T15:21:47Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390418",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
Can we move on either here or in #27529, please ?



---

archive/issue_events_225004.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-05-24T15:22:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225004"
}
```



---

archive/issue_events_225005.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-05-24T15:22:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225005"
}
```



---

archive/issue_comments_390419.json:
```json
{
    "body": "<a id='comment:18'></a>\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390419",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_events_225006.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225006"
}
```



---

archive/issue_events_225007.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225007"
}
```



---

archive/issue_comments_390420.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/093c46e2667c299ef07d276089e47962668ac4c6\">093c46e</a></td><td><code>Test safe directory without subprocess</code></td></tr></table>\n",
    "created_at": "2019-10-05T10:59:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/093c46e2667c299ef07d276089e47962668ac4c6">093c46e</a></td><td><code>Test safe directory without subprocess</code></td></tr></table>




---

archive/issue_comments_390421.json:
```json
{
    "body": "**Changing commit** from \"[dc673c17555efca611f68398d5013b66e9825463](https://github.com/sagemath/sagetrac-mirror/commit/dc673c17555efca611f68398d5013b66e9825463)\" to \"[093c46e2667c299ef07d276089e47962668ac4c6](https://github.com/sagemath/sagetrac-mirror/commit/093c46e2667c299ef07d276089e47962668ac4c6)\".",
    "created_at": "2019-10-05T10:59:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390421",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dc673c17555efca611f68398d5013b66e9825463](https://github.com/sagemath/sagetrac-mirror/commit/dc673c17555efca611f68398d5013b66e9825463)" to "[093c46e2667c299ef07d276089e47962668ac4c6](https://github.com/sagemath/sagetrac-mirror/commit/093c46e2667c299ef07d276089e47962668ac4c6)".



---

archive/issue_comments_390422.json:
```json
{
    "body": "<a id='comment:20'></a>\nRebased for sage 9.0.",
    "created_at": "2019-10-05T11:00:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390422",
    "user": "https://github.com/timokau"
}
```

<a id='comment:20'></a>
Rebased for sage 9.0.



---

archive/issue_events_225008.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-10-05T11:00:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225008"
}
```



---

archive/issue_events_225009.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2019-10-05T11:00:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225009"
}
```



---

archive/issue_comments_390423.json:
```json
{
    "body": "<a id='comment:22'></a>\nred branch",
    "created_at": "2019-11-13T07:58:02Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390423",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>
red branch



---

archive/issue_events_225010.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-11-13T07:58:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225010"
}
```



---

archive/issue_events_225011.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-11-13T07:58:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225011"
}
```



---

archive/issue_comments_390424.json:
```json
{
    "body": "<a id='comment:23'></a>\nSince there doesn't seem to be any chance for this to get merged, I won't push this any further. Luckily it will become irrelevant with the python3 switch anyways, since the relevant test is marked py2 only.",
    "created_at": "2019-11-13T08:34:34Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390424",
    "user": "https://github.com/timokau"
}
```

<a id='comment:23'></a>
Since there doesn't seem to be any chance for this to get merged, I won't push this any further. Luckily it will become irrelevant with the python3 switch anyways, since the relevant test is marked py2 only.



---

archive/issue_comments_390425.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [gh-timokau](#comment%3A23):\n> Since there doesn't seem to be any chance for this to get merged, I won't push this any further. Luckily it will become irrelevant with the python3 switch anyways, since the relevant test is marked py2 only.\n\n\nI think it might be that the patch in question was never ported to Python 3.  So, when as part of #28000 we go through and remove all the `# py2` tests, it will just go away anyways, I guess :)",
    "created_at": "2019-11-13T17:44:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390425",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
Replying to [gh-timokau](#comment%3A23):
> Since there doesn't seem to be any chance for this to get merged, I won't push this any further. Luckily it will become irrelevant with the python3 switch anyways, since the relevant test is marked py2 only.


I think it might be that the patch in question was never ported to Python 3.  So, when as part of #28000 we go through and remove all the `# py2` tests, it will just go away anyways, I guess :)



---

archive/issue_comments_390426.json:
```json
{
    "body": "<a id='comment:25'></a>\nExactly, problem solved :)",
    "created_at": "2019-11-13T17:48:13Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390426",
    "user": "https://github.com/timokau"
}
```

<a id='comment:25'></a>
Exactly, problem solved :)



---

archive/issue_events_225012.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225012"
}
```



---

archive/issue_events_225013.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225013"
}
```



---

archive/issue_comments_390427.json:
```json
{
    "body": "<a id='comment:26'></a>\nTicket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390427",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>
Ticket retargeted after milestone closed



---

archive/issue_comments_390428.json:
```json
{
    "body": "<a id='comment:27'></a>\nNeeds rebasing",
    "created_at": "2020-03-22T21:39:58Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390428",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Needs rebasing



---

archive/issue_comments_390429.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-timokau/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/python-safe-directory)\" to \"[u/mkoeppe/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python-safe-directory)\".",
    "created_at": "2020-03-22T23:04:20Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390429",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/gh-timokau/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-timokau/python-safe-directory)" to "[u/mkoeppe/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python-safe-directory)".



---

archive/issue_events_225014.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T23:04:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225014"
}
```



---

archive/issue_events_225015.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T23:04:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225015"
}
```



---

archive/issue_comments_390430.json:
```json
{
    "body": "<a id='comment:29'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68\">904b1a1</a></td><td><code>Test safe directory without subprocess</code></td></tr></table>\n",
    "created_at": "2020-03-22T23:04:35Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390430",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68">904b1a1</a></td><td><code>Test safe directory without subprocess</code></td></tr></table>




---

archive/issue_comments_390431.json:
```json
{
    "body": "**Changing commit** from \"[093c46e2667c299ef07d276089e47962668ac4c6](https://github.com/sagemath/sagetrac-mirror/commit/093c46e2667c299ef07d276089e47962668ac4c6)\" to \"[904b1a18742e5677aa8de02920b7bf3a13ae4c68](https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68)\".",
    "created_at": "2020-03-22T23:04:35Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390431",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[093c46e2667c299ef07d276089e47962668ac4c6](https://github.com/sagemath/sagetrac-mirror/commit/093c46e2667c299ef07d276089e47962668ac4c6)" to "[904b1a18742e5677aa8de02920b7bf3a13ae4c68](https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68)".



---

archive/issue_comments_390432.json:
```json
{
    "body": "<a id='comment:31'></a>\nlet me try to test this on \"interesting\" platforms",
    "created_at": "2020-03-23T02:39:39Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390432",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
let me try to test this on "interesting" platforms



---

archive/issue_comments_390433.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2020-03-23T09:26:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390433",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_comments_390434.json:
```json
{
    "body": "<a id='comment:32'></a>\nWorks for me at https://github.com/mkoeppe/sage/actions/runs/61077298",
    "created_at": "2020-03-23T09:26:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390434",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Works for me at https://github.com/mkoeppe/sage/actions/runs/61077298



---

archive/issue_comments_390435.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [dimpase](#comment%3A31):\n> let me try to test this on \"interesting\" platforms\n\nProbably should be tested on cygwin",
    "created_at": "2020-03-23T12:43:00Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390435",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Replying to [dimpase](#comment%3A31):
> let me try to test this on "interesting" platforms

Probably should be tested on cygwin



---

archive/issue_comments_390436.json:
```json
{
    "body": "<a id='comment:34'></a>\nCan't cygwin testing be done via GH Actions?",
    "created_at": "2020-03-23T15:51:43Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390436",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
Can't cygwin testing be done via GH Actions?



---

archive/issue_comments_390437.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [dimpase](#comment%3A34):\n> Can't cygwin testing be done via GH Actions?\n\nYes, but at the moment the build is timing out before it can do \"make ptest\"",
    "created_at": "2020-03-23T17:04:23Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390437",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Replying to [dimpase](#comment%3A34):
> Can't cygwin testing be done via GH Actions?

Yes, but at the moment the build is timing out before it can do "make ptest"



---

archive/issue_comments_390438.json:
```json
{
    "body": "<a id='comment:36'></a>\nI imagine a minimal build in cygwin is hopless, but a standard one, with python3 from the system ticket, should be quick enough to do at least \"make build\"\nfollowed by testing of some files",
    "created_at": "2020-03-23T17:17:02Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390438",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>
I imagine a minimal build in cygwin is hopless, but a standard one, with python3 from the system ticket, should be quick enough to do at least "make build"
followed by testing of some files



---

archive/issue_comments_390439.json:
```json
{
    "body": "<a id='comment:37'></a>\nI've created #29397 to activate more system packages on cygwin",
    "created_at": "2020-03-23T17:26:00Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390439",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
I've created #29397 to activate more system packages on cygwin



---

archive/issue_comments_390440.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe\" to \"Matthias Koeppe, ...\".",
    "created_at": "2020-03-24T14:46:33Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390440",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Matthias Koeppe" to "Matthias Koeppe, ...".



---

archive/issue_comments_390441.json:
```json
{
    "body": "<a id='comment:39'></a>\nLet's merge this, and worry about cygwin later.",
    "created_at": "2020-03-24T14:54:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390441",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>
Let's merge this, and worry about cygwin later.



---

archive/issue_events_225016.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-24T14:54:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225016"
}
```



---

archive/issue_events_225017.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-24T14:54:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225017"
}
```



---

archive/issue_comments_390442.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe, ...\" to \"Matthias Koeppe, Dima Pasechnik\".",
    "created_at": "2020-03-24T14:54:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390442",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "Matthias Koeppe, ..." to "Matthias Koeppe, Dima Pasechnik".



---

archive/issue_comments_390443.json:
```json
{
    "body": "<a id='comment:40'></a>\nOK, I agree",
    "created_at": "2020-03-24T16:24:50Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390443",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
OK, I agree



---

archive/issue_comments_390444.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python-safe-directory)\" to \"[904b1a18742e5677aa8de02920b7bf3a13ae4c68](https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68)\".",
    "created_at": "2020-03-29T00:24:20Z",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25358#issuecomment-390444",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/python-safe-directory](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python-safe-directory)" to "[904b1a18742e5677aa8de02920b7bf3a13ae4c68](https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68)".



---

archive/issue_events_225018.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-29T00:24:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225018"
}
```



---

archive/issue_events_225019.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-29T00:24:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25358",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25358#event-225019"
}
```
