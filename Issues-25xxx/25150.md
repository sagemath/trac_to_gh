# Issue 25150: Eliminate dependence on VERSION.txt within Sage

archive/issues_024913.json:
```json
{
    "body": "As discussed on #25056, that ticket introduced a small, but annoying runtime dependency on a file that lives in `$SAGE_ROOT`, `VERSION.txt`, which creates problems for downstream distributions.\n\nThis proposes to eliminate practically all dependence on `VERSION.txt`, by instead writing the same string to a new variable `SAGE_VERSION_BANNER` which is stored in both `src/bin/sage-version.sh` and `src/sage/version.py`.  Although mildly redundant, this is at least consistent.\n\nOriginally I thought to just outright remove `VERSION.txt` since at this point it is not used directly anywhere in sagelib or sage-the-distribution. However, there are probably various external utilities that look for that file--I can confirm that the patchbot is one such utility, if nothing else.  But there are likely others.  So it's harmless to keep it.\n\n**CC:**  @kiwifb @jdemeyer @vbraun\n\n**Branch/Commit:** [c12e4428445f9ae0ae905323fe31c022183cd0cc](https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc)\n\n**Reviewer:** Fran\u00e7ois Bissey\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/25150\n\n",
    "closed_at": "2018-06-01T15:42:12Z",
    "created_at": "2018-04-12T10:09:28Z",
    "labels": [
        "component: misc",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "title": "Eliminate dependence on VERSION.txt within Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/25150",
    "user": "https://github.com/embray"
}
```
As discussed on #25056, that ticket introduced a small, but annoying runtime dependency on a file that lives in `$SAGE_ROOT`, `VERSION.txt`, which creates problems for downstream distributions.

This proposes to eliminate practically all dependence on `VERSION.txt`, by instead writing the same string to a new variable `SAGE_VERSION_BANNER` which is stored in both `src/bin/sage-version.sh` and `src/sage/version.py`.  Although mildly redundant, this is at least consistent.

Originally I thought to just outright remove `VERSION.txt` since at this point it is not used directly anywhere in sagelib or sage-the-distribution. However, there are probably various external utilities that look for that file--I can confirm that the patchbot is one such utility, if nothing else.  But there are likely others.  So it's harmless to keep it.

**CC:**  @kiwifb @jdemeyer @vbraun

**Branch/Commit:** [c12e4428445f9ae0ae905323fe31c022183cd0cc](https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc)

**Reviewer:** François Bissey

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/25150





---

archive/issue_events_223180.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-12T10:13:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223180"
}
```



---

archive/issue_comments_386880.json:
```json
{
    "body": "**Changing commit** from \"[ba0177a2a016e83e0e35d9420f6beaca06fc6d50](https://github.com/sagemath/sagetrac-mirror/commit/ba0177a2a016e83e0e35d9420f6beaca06fc6d50)\" to \"[669b09b47a74029a64298ff0d8d249e284a7b79e](https://github.com/sagemath/sagetrac-mirror/commit/669b09b47a74029a64298ff0d8d249e284a7b79e)\".",
    "created_at": "2018-04-12T10:25:19Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ba0177a2a016e83e0e35d9420f6beaca06fc6d50](https://github.com/sagemath/sagetrac-mirror/commit/ba0177a2a016e83e0e35d9420f6beaca06fc6d50)" to "[669b09b47a74029a64298ff0d8d249e284a7b79e](https://github.com/sagemath/sagetrac-mirror/commit/669b09b47a74029a64298ff0d8d249e284a7b79e)".



---

archive/issue_comments_386881.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/669b09b47a74029a64298ff0d8d249e284a7b79e\">669b09b</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr></table>\n",
    "created_at": "2018-04-12T10:25:19Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386881",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/669b09b47a74029a64298ff0d8d249e284a7b79e">669b09b</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr></table>




---

archive/issue_comments_386882.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhy \"blocker\"? My gut feeling says that this ticket has a non-trivial chance of breaking stuff, so it should be treated as a normal ticket for Sage 8.3.",
    "created_at": "2018-04-12T11:40:50Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386882",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Why "blocker"? My gut feeling says that this ticket has a non-trivial chance of breaking stuff, so it should be treated as a normal ticket for Sage 8.3.



---

archive/issue_comments_386883.json:
```json
{
    "body": "<a id='comment:5'></a>\nBecause we don't want to add an additional annoyance to Sage 8.2 for downstream packagers that they'll have to work around, only to remove that workaround for the next version.  It's a simple change we can make now so why not?",
    "created_at": "2018-04-12T11:49:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386883",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Because we don't want to add an additional annoyance to Sage 8.2 for downstream packagers that they'll have to work around, only to remove that workaround for the next version.  It's a simple change we can make now so why not?



---

archive/issue_comments_386884.json:
```json
{
    "body": "<a id='comment:6'></a>\nFor the record I have already worked around. I am not exactly convinced by the content of this ticket either. Admittedly some things have to be considered carefully, and I can see due diligence in action.",
    "created_at": "2018-04-12T11:55:36Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386884",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
For the record I have already worked around. I am not exactly convinced by the content of this ticket either. Admittedly some things have to be considered carefully, and I can see due diligence in action.



---

archive/issue_comments_386885.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt doesn't break anything. VERSION.txt is a completely static file shipped in the Sage sources, generated by `sage-update-version`--nothing is changed about that.  Within Sage itself it's used in just three minor places to get...a string: `build/make/install` (badly--it should use `sage-version.sh` instead which it now does).  `src/bin/sage` (as added in #25056 in a less than ideal manner), and in a trivial way in `src/bin/sage-start`.",
    "created_at": "2018-04-12T11:56:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386885",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
It doesn't break anything. VERSION.txt is a completely static file shipped in the Sage sources, generated by `sage-update-version`--nothing is changed about that.  Within Sage itself it's used in just three minor places to get...a string: `build/make/install` (badly--it should use `sage-version.sh` instead which it now does).  `src/bin/sage` (as added in #25056 in a less than ideal manner), and in a trivial way in `src/bin/sage-start`.



---

archive/issue_comments_386886.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [fbissey](#comment%3A6):\n> For the record I have already worked around. I am not exactly convinced by the content of this ticket either. Admittedly some things have to be considered carefully, and I can see due diligence in action.\n\nYou may have, but not Debian (which, granted, is in a state of limbo right now, but something we are hoping to fix), and conda at a minimum.",
    "created_at": "2018-04-12T11:56:53Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386886",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Replying to [fbissey](#comment%3A6):
> For the record I have already worked around. I am not exactly convinced by the content of this ticket either. Admittedly some things have to be considered carefully, and I can see due diligence in action.

You may have, but not Debian (which, granted, is in a state of limbo right now, but something we are hoping to fix), and conda at a minimum.



---

archive/issue_comments_386887.json:
```json
{
    "body": "<a id='comment:9'></a>\nConflicts... \n\nAlso, we should probably fix this properly instead of a last-minute effort that may or may not improve things.",
    "created_at": "2018-04-16T22:38:46Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386887",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Conflicts... 

Also, we should probably fix this properly instead of a last-minute effort that may or may not improve things.



---

archive/issue_events_223181.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-04-16T22:38:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223181"
}
```



---

archive/issue_comments_386888.json:
```json
{
    "body": "<a id='comment:10'></a>\nI would say this is \"properly\"...",
    "created_at": "2018-04-17T16:03:54Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386888",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
I would say this is "properly"...



---

archive/issue_comments_386889.json:
```json
{
    "body": "**Changing commit** from \"[669b09b47a74029a64298ff0d8d249e284a7b79e](https://github.com/sagemath/sagetrac-mirror/commit/669b09b47a74029a64298ff0d8d249e284a7b79e)\" to \"[dabcba29a87dbf7b427ceb0b2dada597ee458c6f](https://github.com/sagemath/sagetrac-mirror/commit/dabcba29a87dbf7b427ceb0b2dada597ee458c6f)\".",
    "created_at": "2018-04-17T16:06:19Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[669b09b47a74029a64298ff0d8d249e284a7b79e](https://github.com/sagemath/sagetrac-mirror/commit/669b09b47a74029a64298ff0d8d249e284a7b79e)" to "[dabcba29a87dbf7b427ceb0b2dada597ee458c6f](https://github.com/sagemath/sagetrac-mirror/commit/dabcba29a87dbf7b427ceb0b2dada597ee458c6f)".



---

archive/issue_comments_386890.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c13a95f189e5e6866f6b903c56395a671c9773d\">0c13a95</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dabcba29a87dbf7b427ceb0b2dada597ee458c6f\">dabcba2</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr></table>\n",
    "created_at": "2018-04-17T16:06:19Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c13a95f189e5e6866f6b903c56395a671c9773d">0c13a95</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dabcba29a87dbf7b427ceb0b2dada597ee458c6f">dabcba2</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr></table>




---

archive/issue_events_223182.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-17T16:08:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223182"
}
```



---

archive/issue_comments_386891.json:
```json
{
    "body": "<a id='comment:12'></a>\nPlease properly review this ticket.  It fixes an issue that was introduced in development by #25056 and is problematic for non-source-based Sage installs (~~including on Windows~~ it's not actually a problem here after all since I do install VERSION.txt; however, we should not be introducing known regressions at the last minute if we can easily fix them).  The fix was carefully considered and tested, but all you're telling me is that's \"not proper\" based on a \"gut feeling\".",
    "created_at": "2018-04-17T16:08:39Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386891",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
Please properly review this ticket.  It fixes an issue that was introduced in development by #25056 and is problematic for non-source-based Sage installs (~~including on Windows~~ it's not actually a problem here after all since I do install VERSION.txt; however, we should not be introducing known regressions at the last minute if we can easily fix them).  The fix was carefully considered and tested, but all you're telling me is that's "not proper" based on a "gut feeling".



---

archive/issue_comments_386892.json:
```json
{
    "body": "<a id='comment:13'></a>\nI'll leave it to Volker to decide on the blocker status.\n\nThe reason for my \"git feeling\" is that tickets touching the build system have a tendency to introduce subtle breakage. And this isn't a simple bug-fix either, it's really adding new functionality.",
    "created_at": "2018-04-17T20:55:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386892",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
I'll leave it to Volker to decide on the blocker status.

The reason for my "git feeling" is that tickets touching the build system have a tendency to introduce subtle breakage. And this isn't a simple bug-fix either, it's really adding new functionality.



---

archive/issue_comments_386893.json:
```json
{
    "body": "<a id='comment:14'></a>\nI don't think `$SAGE_LOCAL/bin` is a good place for `sage-version.sh` but this is a matter in some other tickets. I was mainly surprised by the extents of the changes wrought by this ticket and the fact there is still a mention of `SAGE_ROOT` - but I should never take that branch so it's probably OK. There is stuff all over the place where I did not expect it. \n\nAs Jeroen says it touches bits of the build system, while I don't expect any problem (and sage-on-gentoo doesn't really care) I understand him being worried about it.\n\nAt the end of the day, I'll probably patch less than before with this ticket.",
    "created_at": "2018-04-17T21:54:02Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386893",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
I don't think `$SAGE_LOCAL/bin` is a good place for `sage-version.sh` but this is a matter in some other tickets. I was mainly surprised by the extents of the changes wrought by this ticket and the fact there is still a mention of `SAGE_ROOT` - but I should never take that branch so it's probably OK. There is stuff all over the place where I did not expect it. 

As Jeroen says it touches bits of the build system, while I don't expect any problem (and sage-on-gentoo doesn't really care) I understand him being worried about it.

At the end of the day, I'll probably patch less than before with this ticket.



---

archive/issue_comments_386894.json:
```json
{
    "body": "<a id='comment:15'></a>\nOur existing implementation is far from ideal, but I also don't see a real improvement in this patch.\n\nThe way it should be is: there is a version py and sh file, for import/source in python and shell scripts. There shouldn't be python scripts looking at environment variables that where set elsewhere.\n\nThere should be some mechanism to check that `SAGE_ROOT` is not being used outside of the build system so this doesn't happen again, and that is not in the attached branch.",
    "created_at": "2018-04-17T22:50:11Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386894",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
Our existing implementation is far from ideal, but I also don't see a real improvement in this patch.

The way it should be is: there is a version py and sh file, for import/source in python and shell scripts. There shouldn't be python scripts looking at environment variables that where set elsewhere.

There should be some mechanism to check that `SAGE_ROOT` is not being used outside of the build system so this doesn't happen again, and that is not in the attached branch.



---

archive/issue_comments_386895.json:
```json
{
    "body": "<a id='comment:16'></a>\nVERSION_FULL is actually a banner. So how about this change?\n\nVERSION_FULL --> VERSION_BANNER",
    "created_at": "2018-04-18T04:54:10Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386895",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:16'></a>
VERSION_FULL is actually a banner. So how about this change?

VERSION_FULL --> VERSION_BANNER



---

archive/issue_comments_386896.json:
```json
{
    "body": "**Changing commit** from \"[dabcba29a87dbf7b427ceb0b2dada597ee458c6f](https://github.com/sagemath/sagetrac-mirror/commit/dabcba29a87dbf7b427ceb0b2dada597ee458c6f)\" to \"[d87fd38c91318ef231c9b0764d37fbac31389db3](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3)\".",
    "created_at": "2018-04-18T14:03:52Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dabcba29a87dbf7b427ceb0b2dada597ee458c6f](https://github.com/sagemath/sagetrac-mirror/commit/dabcba29a87dbf7b427ceb0b2dada597ee458c6f)" to "[d87fd38c91318ef231c9b0764d37fbac31389db3](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3)".



---

archive/issue_comments_386897.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/664af6b32c45c602d57baa7bfc7d109e66496827\">664af6b</a></td><td><code>fix these tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3\">d87fd38</a></td><td><code>Enforce the default value of SAGE_BANNER before running this test, since otherwise it might now pass</code></td></tr></table>\n",
    "created_at": "2018-04-18T14:03:52Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/664af6b32c45c602d57baa7bfc7d109e66496827">664af6b</a></td><td><code>fix these tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3">d87fd38</a></td><td><code>Enforce the default value of SAGE_BANNER before running this test, since otherwise it might now pass</code></td></tr></table>




---

archive/issue_comments_386898.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [fbissey](#comment%3A14):\n> I don't think `$SAGE_LOCAL/bin` is a good place for `sage-version.sh` but this is a matter in some other tickets. I was mainly surprised by the extents of the changes wrought by this ticket and the fact there is still a mention of `SAGE_ROOT` - but I should never take that branch so it's probably OK. There is stuff all over the place where I did not expect it. \n\nThe only \"mention of `SAGE_ROOT`\" is as an alternative \"$SAGE_LOCAL/bin/sage-version.sh\" if it does not exist.\n\nI agree that's not a great place for that file, but it's where it already existed.  I don't know what you do with it on gentoo (though having it there isn't the worst place for it).  I think I would rather do away with `sage-version.sh` and instead put that info in `sage-env-config`, but I was trying to keep this change as undisruptive as possible.\n\nWhich is why, while I'm sorry to make a fight over this, I just feel like it's a little unfair to unilaterally brush it off without due consideration, especially since it was only to address a legitimate complaint of a regression for downstream packagers.  I considered this change and its impact carefully. I don't necessarily expect anyone to take my word for that, but at least do me the same consideration.\n\nI'll also note that at the very least [d87fd38c](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3) is now necessary for the tests to pass on Docker.  We force `SAGE_BANNER=bare` on Docker due to a bug in Docker (I think now fixed, but still in older versions), and this test as written was assuming the default value of `SAGE_BANNER`.",
    "created_at": "2018-04-18T14:06:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386898",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Replying to [fbissey](#comment%3A14):
> I don't think `$SAGE_LOCAL/bin` is a good place for `sage-version.sh` but this is a matter in some other tickets. I was mainly surprised by the extents of the changes wrought by this ticket and the fact there is still a mention of `SAGE_ROOT` - but I should never take that branch so it's probably OK. There is stuff all over the place where I did not expect it. 

The only "mention of `SAGE_ROOT`" is as an alternative "$SAGE_LOCAL/bin/sage-version.sh" if it does not exist.

I agree that's not a great place for that file, but it's where it already existed.  I don't know what you do with it on gentoo (though having it there isn't the worst place for it).  I think I would rather do away with `sage-version.sh` and instead put that info in `sage-env-config`, but I was trying to keep this change as undisruptive as possible.

Which is why, while I'm sorry to make a fight over this, I just feel like it's a little unfair to unilaterally brush it off without due consideration, especially since it was only to address a legitimate complaint of a regression for downstream packagers.  I considered this change and its impact carefully. I don't necessarily expect anyone to take my word for that, but at least do me the same consideration.

I'll also note that at the very least [d87fd38c](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3) is now necessary for the tests to pass on Docker.  We force `SAGE_BANNER=bare` on Docker due to a bug in Docker (I think now fixed, but still in older versions), and this test as written was assuming the default value of `SAGE_BANNER`.



---

archive/issue_comments_386899.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [vbraun](#comment%3A15):\n> Our existing implementation is far from ideal, but I also don't see a real improvement in this patch.\n> \n> The way it should be is: there is a version py and sh file, for import/source in python and shell scripts. There shouldn't be python scripts looking at environment variables that where set elsewhere.\n> \n> There should be some mechanism to check that `SAGE_ROOT` is not being used outside of the build system so this doesn't happen again, and that is not in the attached branch.\n\n+1 to all of the above in principle.  However, you'll see in this branch that it actually eliminates several uses of `$SAGE_ROOT`, and leaves only one in the `sage` script, and only as a fallback if `$SAGE_LOCAL/bin/sage-version.sh` does not exist yet.  I agree that's still not ideal, but also somewhat necessary since currently the `sage` script serves as an entrypoint to runtime capabilities of Sage, and to the \"build system\" (a fact I've complained about in #25130).\n\nThe goal there was that at the very least, running `./sage --version` should work the same whether in a fresh clone of the repository (though that's actually already broken at the moment for unrelated reasons), or running some binary release with no `$SAGE_ROOT`.",
    "created_at": "2018-04-18T14:14:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386899",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
Replying to [vbraun](#comment%3A15):
> Our existing implementation is far from ideal, but I also don't see a real improvement in this patch.
> 
> The way it should be is: there is a version py and sh file, for import/source in python and shell scripts. There shouldn't be python scripts looking at environment variables that where set elsewhere.
> 
> There should be some mechanism to check that `SAGE_ROOT` is not being used outside of the build system so this doesn't happen again, and that is not in the attached branch.

+1 to all of the above in principle.  However, you'll see in this branch that it actually eliminates several uses of `$SAGE_ROOT`, and leaves only one in the `sage` script, and only as a fallback if `$SAGE_LOCAL/bin/sage-version.sh` does not exist yet.  I agree that's still not ideal, but also somewhat necessary since currently the `sage` script serves as an entrypoint to runtime capabilities of Sage, and to the "build system" (a fact I've complained about in #25130).

The goal there was that at the very least, running `./sage --version` should work the same whether in a fresh clone of the repository (though that's actually already broken at the moment for unrelated reasons), or running some binary release with no `$SAGE_ROOT`.



---

archive/issue_comments_386900.json:
```json
{
    "body": "**Changing commit** from \"[d87fd38c91318ef231c9b0764d37fbac31389db3](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3)\" to \"[3055ab9e6e49080c251ea0fffcd747b184a721b4](https://github.com/sagemath/sagetrac-mirror/commit/3055ab9e6e49080c251ea0fffcd747b184a721b4)\".",
    "created_at": "2018-04-18T14:20:04Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d87fd38c91318ef231c9b0764d37fbac31389db3](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3)" to "[3055ab9e6e49080c251ea0fffcd747b184a721b4](https://github.com/sagemath/sagetrac-mirror/commit/3055ab9e6e49080c251ea0fffcd747b184a721b4)".



---

archive/issue_comments_386901.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3055ab9e6e49080c251ea0fffcd747b184a721b4\">3055ab9</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr></table>\n",
    "created_at": "2018-04-18T14:20:04Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3055ab9e6e49080c251ea0fffcd747b184a721b4">3055ab9</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr></table>




---

archive/issue_comments_386902.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [klee](#comment%3A16):\n> VERSION_FULL is actually a banner. So how about this change?\n> \n> VERSION_FULL --> VERSION_BANNER\n\nYeah, I think I agree with that.",
    "created_at": "2018-04-18T14:21:06Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386902",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Replying to [klee](#comment%3A16):
> VERSION_FULL is actually a banner. So how about this change?
> 
> VERSION_FULL --> VERSION_BANNER

Yeah, I think I agree with that.



---

archive/issue_comments_386903.json:
```json
{
    "body": "**Changing commit** from \"[3055ab9e6e49080c251ea0fffcd747b184a721b4](https://github.com/sagemath/sagetrac-mirror/commit/3055ab9e6e49080c251ea0fffcd747b184a721b4)\" to \"[e6b76d08acdb5ef109c37d256f15c8dfbce6c7db](https://github.com/sagemath/sagetrac-mirror/commit/e6b76d08acdb5ef109c37d256f15c8dfbce6c7db)\".",
    "created_at": "2018-04-18T14:26:45Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386903",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3055ab9e6e49080c251ea0fffcd747b184a721b4](https://github.com/sagemath/sagetrac-mirror/commit/3055ab9e6e49080c251ea0fffcd747b184a721b4)" to "[e6b76d08acdb5ef109c37d256f15c8dfbce6c7db](https://github.com/sagemath/sagetrac-mirror/commit/e6b76d08acdb5ef109c37d256f15c8dfbce6c7db)".



---

archive/issue_comments_386904.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6b76d08acdb5ef109c37d256f15c8dfbce6c7db\">e6b76d0</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>\n",
    "created_at": "2018-04-18T14:26:45Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6b76d08acdb5ef109c37d256f15c8dfbce6c7db">e6b76d0</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>




---

archive/issue_comments_386905.json:
```json
{
    "body": "<a id='comment:23'></a>\nThe only problem with `SAGE_VERSION_BANNER` is it's potentially confusable with `SAGE_BANNER`.  But I think that's not a problem so long as it's kept undocumented, for internal use.",
    "created_at": "2018-04-18T14:27:35Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386905",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
The only problem with `SAGE_VERSION_BANNER` is it's potentially confusable with `SAGE_BANNER`.  But I think that's not a problem so long as it's kept undocumented, for internal use.



---

archive/issue_comments_386906.json:
```json
{
    "body": "<a id='comment:24'></a>\nIf this ticket is too much trouble, as a compromise we can at least merge [d87fd38c](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3) which is actually a (possible) test regression introduced by #25056, and actually caught by the patchbot but we ignored it.\n\nI'd also appreciate an alternate fix the issue raised in this ticket that would be more acceptable, but if I'm the only one who cares then don't worry about it I guess.",
    "created_at": "2018-04-18T14:59:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386906",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
If this ticket is too much trouble, as a compromise we can at least merge [d87fd38c](https://github.com/sagemath/sagetrac-mirror/commit/d87fd38c91318ef231c9b0764d37fbac31389db3) which is actually a (possible) test regression introduced by #25056, and actually caught by the patchbot but we ignored it.

I'd also appreciate an alternate fix the issue raised in this ticket that would be more acceptable, but if I'm the only one who cares then don't worry about it I guess.



---

archive/issue_comments_386907.json:
```json
{
    "body": "<a id='comment:25'></a>\nI'm fine with just d87fd38c; I'd prefer not to merge the entire ticket for 8.2; distro packagers either have the issue already patched, can do it easily enough, or can wait until 8.3",
    "created_at": "2018-04-18T23:25:53Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386907",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
I'm fine with just d87fd38c; I'd prefer not to merge the entire ticket for 8.2; distro packagers either have the issue already patched, can do it easily enough, or can wait until 8.3



---

archive/issue_comments_386908.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n As discussed on #25056, that ticket introduced a small, but annoying runtime dependency on a file that lives in `$SAGE_ROOT`, `VERSION.txt`, which creates problems for downstream distributions.\n \n-This proposes to eliminate practically all dependence on `VERSION.txt`, by instead writing the same string to a new variable `SAGE_VERSION_FULL` which is stored in both `src/bin/sage-version.sh` and `src/sage/version.py`.  Although mildly redundant, this is at least consistent.\n+This proposes to eliminate practically all dependence on `VERSION.txt`, by instead writing the same string to a new variable `SAGE_VERSION_BANNER` which is stored in both `src/bin/sage-version.sh` and `src/sage/version.py`.  Although mildly redundant, this is at least consistent.\n \n Originally I thought to just outright remove `VERSION.txt` since at this point it is not used directly anywhere in sagelib or sage-the-distribution. However, there are probably various external utilities that look for that file--I can confirm that the patchbot is one such utility, if nothing else.  But there are likely others.  So it's harmless to keep it.\n``````\n",
    "created_at": "2018-04-19T00:26:52Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386908",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 As discussed on #25056, that ticket introduced a small, but annoying runtime dependency on a file that lives in `$SAGE_ROOT`, `VERSION.txt`, which creates problems for downstream distributions.
 
-This proposes to eliminate practically all dependence on `VERSION.txt`, by instead writing the same string to a new variable `SAGE_VERSION_FULL` which is stored in both `src/bin/sage-version.sh` and `src/sage/version.py`.  Although mildly redundant, this is at least consistent.
+This proposes to eliminate practically all dependence on `VERSION.txt`, by instead writing the same string to a new variable `SAGE_VERSION_BANNER` which is stored in both `src/bin/sage-version.sh` and `src/sage/version.py`.  Although mildly redundant, this is at least consistent.
 
 Originally I thought to just outright remove `VERSION.txt` since at this point it is not used directly anywhere in sagelib or sage-the-distribution. However, there are probably various external utilities that look for that file--I can confirm that the patchbot is one such utility, if nothing else.  But there are likely others.  So it's harmless to keep it.
``````




---

archive/issue_comments_386909.json:
```json
{
    "body": "<a id='comment:27'></a>\nI still don't see what the big deal is, but okay.  I will downgrade this ticket it and make a separate one for the test fix.",
    "created_at": "2018-04-19T11:52:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386909",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
I still don't see what the big deal is, but okay.  I will downgrade this ticket it and make a separate one for the test fix.



---

archive/issue_events_223183.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-19T11:52:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223183"
}
```



---

archive/issue_events_223184.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-19T11:52:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223184"
}
```



---

archive/issue_events_223185.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-19T11:52:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223185"
}
```



---

archive/issue_events_223186.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-19T11:52:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223186"
}
```



---

archive/issue_comments_386910.json:
```json
{
    "body": "<a id='comment:29'></a>\nDoes this need review at the moment? I did not read through the entire discussion but it appears that this needs work first? Also, there are merge conflicts.",
    "created_at": "2018-04-21T19:33:21Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386910",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:29'></a>
Does this need review at the moment? I did not read through the entire discussion but it appears that this needs work first? Also, there are merge conflicts.



---

archive/issue_events_223187.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-04-21T19:33:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223187"
}
```



---

archive/issue_events_223188.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-04-21T19:33:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223188"
}
```



---

archive/issue_comments_386911.json:
```json
{
    "body": "<a id='comment:30'></a>\nThere is a merge conflict, since I guess Volker made another release (this ticket edits some files that are normally otherwise only changed during releases).  Otherwise, nobody has been able to provide particularly useful commentary on this ticket.",
    "created_at": "2018-04-23T14:40:09Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386911",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>
There is a merge conflict, since I guess Volker made another release (this ticket edits some files that are normally otherwise only changed during releases).  Otherwise, nobody has been able to provide particularly useful commentary on this ticket.



---

archive/issue_comments_386912.json:
```json
{
    "body": "**Changing commit** from \"[e6b76d08acdb5ef109c37d256f15c8dfbce6c7db](https://github.com/sagemath/sagetrac-mirror/commit/e6b76d08acdb5ef109c37d256f15c8dfbce6c7db)\" to \"[37f67a79f5eea0b15917ebc7dd18633c4b6ad439](https://github.com/sagemath/sagetrac-mirror/commit/37f67a79f5eea0b15917ebc7dd18633c4b6ad439)\".",
    "created_at": "2018-04-23T14:43:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e6b76d08acdb5ef109c37d256f15c8dfbce6c7db](https://github.com/sagemath/sagetrac-mirror/commit/e6b76d08acdb5ef109c37d256f15c8dfbce6c7db)" to "[37f67a79f5eea0b15917ebc7dd18633c4b6ad439](https://github.com/sagemath/sagetrac-mirror/commit/37f67a79f5eea0b15917ebc7dd18633c4b6ad439)".



---

archive/issue_comments_386913.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47068aee04cf13dded4bb0d6788647d3b767a186\">47068ae</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96f4d3ffd3524dd53cc9b437e6beba88e611e4d8\">96f4d3f</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d1fd349d00ab708d88c7629cf5cda00dfdcccdf\">1d1fd34</a></td><td><code>fix these tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c2a937e27c18c39867534dfda83dc16291a5925\">4c2a937</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37f67a79f5eea0b15917ebc7dd18633c4b6ad439\">37f67a7</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>\n",
    "created_at": "2018-04-23T14:43:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47068aee04cf13dded4bb0d6788647d3b767a186">47068ae</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96f4d3ffd3524dd53cc9b437e6beba88e611e4d8">96f4d3f</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d1fd349d00ab708d88c7629cf5cda00dfdcccdf">1d1fd34</a></td><td><code>fix these tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c2a937e27c18c39867534dfda83dc16291a5925">4c2a937</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37f67a79f5eea0b15917ebc7dd18633c4b6ad439">37f67a7</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>




---

archive/issue_events_223189.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-23T14:43:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223189"
}
```



---

archive/issue_events_223190.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-23T14:43:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223190"
}
```



---

archive/issue_comments_386914.json:
```json
{
    "body": "<a id='comment:33'></a>\nI am actually OK with the ticket in this form. My last comment may not have been clear enough considering the answer I got from it. I am happy for it to move to the next stage.\n\nHowever it is marked to merge in 8.3 and some bits will need rebasing as soon as 8.2 is released (version.py and version.sh) so I am bit concerned about changing to positive right now. But I approve of it.",
    "created_at": "2018-04-24T01:11:20Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386914",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:33'></a>
I am actually OK with the ticket in this form. My last comment may not have been clear enough considering the answer I got from it. I am happy for it to move to the next stage.

However it is marked to merge in 8.3 and some bits will need rebasing as soon as 8.2 is released (version.py and version.sh) so I am bit concerned about changing to positive right now. But I approve of it.



---

archive/issue_comments_386915.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2018-04-24T01:11:20Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386915",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** François Bissey



---

archive/issue_events_223191.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-05-14T15:14:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223191"
}
```



---

archive/issue_events_223192.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-05-14T15:14:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223192"
}
```



---

archive/issue_comments_386916.json:
```json
{
    "body": "<a id='comment:34'></a>\nthere are merge conflicts.",
    "created_at": "2018-05-14T15:14:55Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386916",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:34'></a>
there are merge conflicts.



---

archive/issue_comments_386917.json:
```json
{
    "body": "**Changing commit** from \"[37f67a79f5eea0b15917ebc7dd18633c4b6ad439](https://github.com/sagemath/sagetrac-mirror/commit/37f67a79f5eea0b15917ebc7dd18633c4b6ad439)\" to \"[6d000872790c82d5531083b599a0f377672ddc31](https://github.com/sagemath/sagetrac-mirror/commit/6d000872790c82d5531083b599a0f377672ddc31)\".",
    "created_at": "2018-05-16T09:47:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386917",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[37f67a79f5eea0b15917ebc7dd18633c4b6ad439](https://github.com/sagemath/sagetrac-mirror/commit/37f67a79f5eea0b15917ebc7dd18633c4b6ad439)" to "[6d000872790c82d5531083b599a0f377672ddc31](https://github.com/sagemath/sagetrac-mirror/commit/6d000872790c82d5531083b599a0f377672ddc31)".



---

archive/issue_comments_386918.json:
```json
{
    "body": "<a id='comment:35'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c7c4c02efb0729e1f3a71fc2a0c0b7464d90118\">4c7c4c0</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b85e026a85840208e95e7c2d6e5a64e831cfcae\">1b85e02</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d4e2bf038dca76dc248c73e8c189a4b3e8476cd\">5d4e2bf</a></td><td><code>fix these tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/671933d8b5d254362fa1d035472c8cc65d0b131a\">671933d</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d000872790c82d5531083b599a0f377672ddc31\">6d00087</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>\n",
    "created_at": "2018-05-16T09:47:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386918",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c7c4c02efb0729e1f3a71fc2a0c0b7464d90118">4c7c4c0</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b85e026a85840208e95e7c2d6e5a64e831cfcae">1b85e02</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d4e2bf038dca76dc248c73e8c189a4b3e8476cd">5d4e2bf</a></td><td><code>fix these tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/671933d8b5d254362fa1d035472c8cc65d0b131a">671933d</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d000872790c82d5531083b599a0f377672ddc31">6d00087</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>




---

archive/issue_comments_386919.json:
```json
{
    "body": "<a id='comment:36'></a>\nRebased.  I still believe this to be better than the current situation, though I would welcome concrete feedback and/or criticism.",
    "created_at": "2018-05-16T09:48:09Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386919",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'></a>
Rebased.  I still believe this to be better than the current situation, though I would welcome concrete feedback and/or criticism.



---

archive/issue_events_223193.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-16T09:48:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223193"
}
```



---

archive/issue_events_223194.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-16T09:48:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223194"
}
```



---

archive/issue_events_223195.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-05-16T09:53:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223195"
}
```



---

archive/issue_events_223196.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-05-16T09:53:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223196"
}
```



---

archive/issue_comments_386920.json:
```json
{
    "body": "<a id='comment:38'></a>\nWhy did you move sourcing of `sage-env` and handling of options like `--root` inside `src/bin/sage`?",
    "created_at": "2018-05-16T10:09:48Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386920",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
Why did you move sourcing of `sage-env` and handling of options like `--root` inside `src/bin/sage`?



---

archive/issue_events_223197.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-16T10:09:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223197"
}
```



---

archive/issue_events_223198.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-16T10:09:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223198"
}
```



---

archive/issue_comments_386921.json:
```json
{
    "body": "<a id='comment:39'></a>\nDepending on how you read the diff, I didn't move it at all :)  At least, in terms of intent, what I was moving was:\n\n```\nif [ \"$1\" = '-dumpversion' -o \"$1\" = '--dumpversion' ]; then\n        sage_version\n        exit 0\nfi\n\nif [ \"$1\" = '-v' -o \"$1\" = '-version' -o \"$1\" = '--version' ]; then\n        sage_version -v\n        exit 0\nfi\n\nif [ \"$1\" = '-root'  -o \"$1\" = '--root' ]; then\n    echo \"$SAGE_ROOT\"\n    exit 0\nfi\n\nif [ $# -gt 0 ]; then\n  if [ \"$1\" = '-h' -o \"$1\" = '-?' -o \"$1\" = '-help' -o \"$1\" = '--help' ]; then\n     usage\n  fi\n  if [ \"$1\" = \"-advanced\" -o \"$1\" = \"--advanced\" ]; then\n     usage_advanced\n  fi\nfi\n```\n\nwhich I felt should work even from a clean source checkout.  Previously these flags did not work in that case because sourcing sage-env would not work correctly.  In other words, from a clean source checkout you can now do:\n\n`./sage --version`\n\n`./sage --root`\n\nand so on.",
    "created_at": "2018-05-16T15:34:59Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386921",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'></a>
Depending on how you read the diff, I didn't move it at all :)  At least, in terms of intent, what I was moving was:

```
if [ "$1" = '-dumpversion' -o "$1" = '--dumpversion' ]; then
        sage_version
        exit 0
fi

if [ "$1" = '-v' -o "$1" = '-version' -o "$1" = '--version' ]; then
        sage_version -v
        exit 0
fi

if [ "$1" = '-root'  -o "$1" = '--root' ]; then
    echo "$SAGE_ROOT"
    exit 0
fi

if [ $# -gt 0 ]; then
  if [ "$1" = '-h' -o "$1" = '-?' -o "$1" = '-help' -o "$1" = '--help' ]; then
     usage
  fi
  if [ "$1" = "-advanced" -o "$1" = "--advanced" ]; then
     usage_advanced
  fi
fi
```

which I felt should work even from a clean source checkout.  Previously these flags did not work in that case because sourcing sage-env would not work correctly.  In other words, from a clean source checkout you can now do:

`./sage --version`

`./sage --root`

and so on.



---

archive/issue_comments_386922.json:
```json
{
    "body": "**Changing commit** from \"[6d000872790c82d5531083b599a0f377672ddc31](https://github.com/sagemath/sagetrac-mirror/commit/6d000872790c82d5531083b599a0f377672ddc31)\" to \"[c12e4428445f9ae0ae905323fe31c022183cd0cc](https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc)\".",
    "created_at": "2018-05-31T09:57:23Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6d000872790c82d5531083b599a0f377672ddc31](https://github.com/sagemath/sagetrac-mirror/commit/6d000872790c82d5531083b599a0f377672ddc31)" to "[c12e4428445f9ae0ae905323fe31c022183cd0cc](https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc)".



---

archive/issue_comments_386923.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6364cc712b945fa0bd187740815c50f1902b2b7\">b6364cc</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49d1b3d81f2ee312f93960388032e04d9dd78b64\">49d1b3d</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dae483647ed3f0221edad9a61981295e306ab449\">dae4836</a></td><td><code>fix these tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a19135548a1a571b477daa9e8cbca52603efe68\">0a19135</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc\">c12e442</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>\n",
    "created_at": "2018-05-31T09:57:23Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386923",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6364cc712b945fa0bd187740815c50f1902b2b7">b6364cc</a></td><td><code>Remove all runtime dependency on a VERSION.txt file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49d1b3d81f2ee312f93960388032e04d9dd78b64">49d1b3d</a></td><td><code>Improve functionality of sage --version and sage --dumpversion so that it can work without SAGE_LOCAL existing yet</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dae483647ed3f0221edad9a61981295e306ab449">dae4836</a></td><td><code>fix these tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a19135548a1a571b477daa9e8cbca52603efe68">0a19135</a></td><td><code>Process reporting arguements to the sage command before attempting to source sage-env; this way at least those commands work out-of-the-box.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc">c12e442</a></td><td><code>Rename SAGE_VERSION_FULL => SAGE_VERSION_BANNER</code></td></tr></table>




---

archive/issue_events_223199.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-31T09:57:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223199"
}
```



---

archive/issue_events_223200.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-31T09:57:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223200"
}
```



---

archive/issue_comments_386924.json:
```json
{
    "body": "<a id='comment:41'></a>\nRebased again.",
    "created_at": "2018-05-31T09:57:54Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386924",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>
Rebased again.



---

archive/issue_events_223201.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-05-31T10:03:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223201"
}
```



---

archive/issue_events_223202.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-05-31T10:03:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223202"
}
```



---

archive/issue_comments_386925.json:
```json
{
    "body": "<a id='comment:42'></a>\nLet's try to get it in again.",
    "created_at": "2018-05-31T10:03:59Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386925",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>
Let's try to get it in again.



---

archive/issue_events_223203.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-01T15:42:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223203"
}
```



---

archive/issue_events_223204.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "724bb3cd9b04f84359c07a497c7e63d99a435698",
    "created_at": "2018-06-01T15:42:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25150#event-223204"
}
```



---

archive/issue_comments_386926.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/build/remove-version.txt](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/remove-version.txt)\" to \"[c12e4428445f9ae0ae905323fe31c022183cd0cc](https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc)\".",
    "created_at": "2018-06-01T15:42:12Z",
    "issue": "https://github.com/sagemath/sage/issues/25150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25150#issuecomment-386926",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/build/remove-version.txt](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/remove-version.txt)" to "[c12e4428445f9ae0ae905323fe31c022183cd0cc](https://github.com/sagemath/sagetrac-mirror/commit/c12e4428445f9ae0ae905323fe31c022183cd0cc)".
