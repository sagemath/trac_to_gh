# Issue 25476: MeatAxe-related bug introduced in 8.3.beta

archive/issues_025239.json:
```json
{
    "assignees": [],
    "body": "Vincent reports this for SageMath 8.3.beta3 with MeatAxe installed:\n\n```\nFile \"src/sage/coding/linear_code.py\", line 2039, in\nsage.coding.linear_code.AbstractLinearCode.__getitem__\nFailed example:\n     C = random_matrix(GF(25,'a'), 2, 7).row_space()\nException raised:\n     Traceback (most recent call last):\n       File\n\"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\",\nline 572, in _run\n         self.compile_and_execute(example, compiler, test.globs)\n       File\n\"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\",\nline 982, in compile_and_execute\n         exec(compiled, globs)\n       File \"<doctest\nsage.coding.linear_code.AbstractLinearCode.__getitem__[4]>\", line 1, in\n<module>\n         C = random_matrix(GF(Integer(25),'a'), Integer(2),\nInteger(7)).row_space()\n       File \"sage/matrix/matrix2.pyx\", line 4592, in\nsage.matrix.matrix2.Matrix.row_space\n(build/cythonized/sage/matrix/matrix2.c:34495)\n         return self.row_module(base_ring=base_ring)\n       File \"sage/matrix/matrix2.pyx\", line 4565, in\nsage.matrix.matrix2.Matrix.row_module\n(build/cythonized/sage/matrix/matrix2.c:34373)\n         return M.span(self.rows(), already_echelonized=False)\n       File\n\"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py\",\nline 3850, in span\n         self.ambient_module(), gens=gens, check=check,\nalready_echelonized=already_echelonized)\n       File\n\"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py\",\nline 6961, in __init__\n         echelonize=not already_echelonized,\nalready_echelonized=already_echelonized)\n       File\n\"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py\",\nline 6763, in __init__\n         echelonized_basis=echelonized_basis,\nalready_echelonized=already_echelonized)\n       File\n\"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py\",\nline 5691, in __init__\n         basis = self._echelonized_basis(ambient, basis)\n       File\n\"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py\",\nline 6894, in _echelonized_basis\n         E = A.echelon_form()\n       File \"sage/matrix/matrix2.pyx\", line 6819, in\nsage.matrix.matrix2.Matrix.echelon_form\n(build/cythonized/sage/matrix/matrix2.c:53810)\n         v = E.echelonize(cutoff=cutoff, **kwds)\n       File \"sage/matrix/matrix2.pyx\", line 6719, in\nsage.matrix.matrix2.Matrix.echelonize\n(build/cythonized/sage/matrix/matrix2.c:53210)\n         self._echelon_in_place(algorithm)\n       File \"sage/matrix/matrix2.pyx\", line 6984, in\nsage.matrix.matrix2.Matrix._echelon_in_place\n(build/cythonized/sage/matrix/matrix2.c:54847)\n         A.rescale_row(r, a_inverse, c)\n       File \"sage/matrix/matrix0.pyx\", line 3005, in\nsage.matrix.matrix0.Matrix.rescale_row\n(build/cythonized/sage/matrix/matrix0.c:21880)\n         self.rescale_row_c(i, s, start_col)\n       File \"sage/matrix/matrix_gfpn_dense.pyx\", line 944, in\nsage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.rescale_row_c\n(build/cythonized/sage/matrix/matrix_gfpn_dense.c:9339)\n         raise ValueError(\"We can only rescale a full row of a non-empty\nmatrix\")\n     ValueError: We can only rescale a full row of a non-empty matrix\n**********************************************************************\n```\n\nThe above error does not occur in 8.2.rc4. Let's try to prevent it from being published in 8.3!\n\n\n**CC:**  @videlec @tscrim\n\n**Keywords:** meataxe rescale_row\n\n**Branch/Commit:** [e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d](https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d)\n\n**Reviewer:** Simon King, Travis Scrimshaw\n\n**Author:** Travis Scrimshaw, Simon King\n\nIssue created by migration from https://trac.sagemath.org/ticket/25476\n\n",
    "closed_at": "2018-06-07T22:15:20Z",
    "created_at": "2018-05-30T23:02:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "MeatAxe-related bug introduced in 8.3.beta",
    "type": "issue",
    "updated_at": "2018-06-07T22:15:20Z",
    "url": "https://github.com/sagemath/sage/issues/25476",
    "user": "https://github.com/simon-king-jena"
}
```
Vincent reports this for SageMath 8.3.beta3 with MeatAxe installed:

```
File "src/sage/coding/linear_code.py", line 2039, in
sage.coding.linear_code.AbstractLinearCode.__getitem__
Failed example:
     C = random_matrix(GF(25,'a'), 2, 7).row_space()
Exception raised:
     Traceback (most recent call last):
       File
"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py",
line 572, in _run
         self.compile_and_execute(example, compiler, test.globs)
       File
"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py",
line 982, in compile_and_execute
         exec(compiled, globs)
       File "<doctest
sage.coding.linear_code.AbstractLinearCode.__getitem__[4]>", line 1, in
<module>
         C = random_matrix(GF(Integer(25),'a'), Integer(2),
Integer(7)).row_space()
       File "sage/matrix/matrix2.pyx", line 4592, in
sage.matrix.matrix2.Matrix.row_space
(build/cythonized/sage/matrix/matrix2.c:34495)
         return self.row_module(base_ring=base_ring)
       File "sage/matrix/matrix2.pyx", line 4565, in
sage.matrix.matrix2.Matrix.row_module
(build/cythonized/sage/matrix/matrix2.c:34373)
         return M.span(self.rows(), already_echelonized=False)
       File
"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py",
line 3850, in span
         self.ambient_module(), gens=gens, check=check,
already_echelonized=already_echelonized)
       File
"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py",
line 6961, in __init__
         echelonize=not already_echelonized,
already_echelonized=already_echelonized)
       File
"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py",
line 6763, in __init__
         echelonized_basis=echelonized_basis,
already_echelonized=already_echelonized)
       File
"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py",
line 5691, in __init__
         basis = self._echelonized_basis(ambient, basis)
       File
"/home/vdelecro/sage_patchbot/local/lib/python2.7/site-packages/sage/modules/free_module.py",
line 6894, in _echelonized_basis
         E = A.echelon_form()
       File "sage/matrix/matrix2.pyx", line 6819, in
sage.matrix.matrix2.Matrix.echelon_form
(build/cythonized/sage/matrix/matrix2.c:53810)
         v = E.echelonize(cutoff=cutoff, **kwds)
       File "sage/matrix/matrix2.pyx", line 6719, in
sage.matrix.matrix2.Matrix.echelonize
(build/cythonized/sage/matrix/matrix2.c:53210)
         self._echelon_in_place(algorithm)
       File "sage/matrix/matrix2.pyx", line 6984, in
sage.matrix.matrix2.Matrix._echelon_in_place
(build/cythonized/sage/matrix/matrix2.c:54847)
         A.rescale_row(r, a_inverse, c)
       File "sage/matrix/matrix0.pyx", line 3005, in
sage.matrix.matrix0.Matrix.rescale_row
(build/cythonized/sage/matrix/matrix0.c:21880)
         self.rescale_row_c(i, s, start_col)
       File "sage/matrix/matrix_gfpn_dense.pyx", line 944, in
sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.rescale_row_c
(build/cythonized/sage/matrix/matrix_gfpn_dense.c:9339)
         raise ValueError("We can only rescale a full row of a non-empty
matrix")
     ValueError: We can only rescale a full row of a non-empty matrix
**********************************************************************
```

The above error does not occur in 8.2.rc4. Let's try to prevent it from being published in 8.3!


**CC:**  @videlec @tscrim

**Keywords:** meataxe rescale_row

**Branch/Commit:** [e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d](https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d)

**Reviewer:** Simon King, Travis Scrimshaw

**Author:** Travis Scrimshaw, Simon King

Issue created by migration from https://trac.sagemath.org/ticket/25476





---

archive/issue_comments_392917.json:
```json
{
    "body": "<a id='comment:1'></a>\nPractical problem: I can currently not build and test 8.3.beta3, since I won't interrupt a computation that I am currently running (it is running since three weeks and might disprove a conjecture on the structure of cohomology rings).",
    "created_at": "2018-05-30T23:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392917",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>
Practical problem: I can currently not build and test 8.3.beta3, since I won't interrupt a computation that I am currently running (it is running since three weeks and might disprove a conjecture on the structure of cohomology rings).



---

archive/issue_comments_392918.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis also occurs in testing `matrix/matrix2.pyx`.",
    "created_at": "2018-05-31T04:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392918",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
This also occurs in testing `matrix/matrix2.pyx`.



---

archive/issue_events_226151.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-31T05:47:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/critical",
    "label_color": "ff0000",
    "label_name": "critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226151"
}
```



---

archive/issue_events_226152.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-31T05:47:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226152"
}
```



---

archive/issue_comments_392919.json:
```json
{
    "body": "<a id='comment:3'></a>\nSo this seems to be caused by #17272, but I do not understand why. It is the exact same code for the classical echelon algorithm. The only other difference is that has become a `cpdef` method instead of a `def` method, but changing that didn't seem to fix the problem. At least, where the error is happening, it means we would have just inverted a 0 if the row is all 0. So perhaps this is a bug in Cython?\n\nAlso, failing tests with optional packages is a blocker.",
    "created_at": "2018-05-31T05:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392919",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
So this seems to be caused by #17272, but I do not understand why. It is the exact same code for the classical echelon algorithm. The only other difference is that has become a `cpdef` method instead of a `def` method, but changing that didn't seem to fix the problem. At least, where the error is happening, it means we would have just inverted a 0 if the row is all 0. So perhaps this is a bug in Cython?

Also, failing tests with optional packages is a blocker.



---

archive/issue_comments_392920.json:
```json
{
    "body": "<a id='comment:4'></a>\nPS - I think the machine I tested #17272 on did not have `meataxe` installed (unlike my usual devbox), but I thought it did...(cannot check it for the next ~2 months).",
    "created_at": "2018-05-31T05:49:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392920",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
PS - I think the machine I tested #17272 on did not have `meataxe` installed (unlike my usual devbox), but I thought it did...(cannot check it for the next ~2 months).



---

archive/issue_comments_392921.json:
```json
{
    "body": "<a id='comment:5'></a>\nI really have no idea what is going on. It does work before #17272, but fails after. Changing both the `cpdef` -> `def` doesn't fix it. The algorithm is exactly the same and even reverting that part of the code does not fix it.",
    "created_at": "2018-05-31T06:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392921",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I really have no idea what is going on. It does work before #17272, but fails after. Changing both the `cpdef` -> `def` doesn't fix it. The algorithm is exactly the same and even reverting that part of the code does not fix it.



---

archive/issue_comments_392922.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhile trying to build the latest beta, cddlib fails. Very bad. So, I still cannot test stuff.",
    "created_at": "2018-05-31T07:08:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392922",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
While trying to build the latest beta, cddlib fails. Very bad. So, I still cannot test stuff.



---

archive/issue_comments_392923.json:
```json
{
    "body": "<a id='comment:7'></a>\nFortunately retrying `make cddlib` worked.",
    "created_at": "2018-05-31T07:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392923",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
Fortunately retrying `make cddlib` worked.



---

archive/issue_comments_392924.json:
```json
{
    "body": "<a id='comment:8'></a>\nNow I completed building the latest beta and can confirm the bug.",
    "created_at": "2018-05-31T09:32:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392924",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
Now I completed building the latest beta and can confirm the bug.



---

archive/issue_comments_392925.json:
```json
{
    "body": "<a id='comment:9'></a>\nPS: It is not the creation of the matrix but calling `.row_space()`.",
    "created_at": "2018-05-31T09:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392925",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>
PS: It is not the creation of the matrix but calling `.row_space()`.



---

archive/issue_comments_392926.json:
```json
{
    "body": "<a id='comment:10'></a>\nOK, the problem is that the algorithm has been changed so that only a part of a row was rescaled. That's quite reasonable to do, and actually one of the changes of SharedMeatAxe compared to MeatAxe is that in the school book gau\u00dfian elimination implementation I made it so that the already annulated part of a row is not rescaled.\n\nOnly in the wrapper in Sage I did not expose that functionality. I guess that needs to change.",
    "created_at": "2018-05-31T09:37:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392926",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>
OK, the problem is that the algorithm has been changed so that only a part of a row was rescaled. That's quite reasonable to do, and actually one of the changes of SharedMeatAxe compared to MeatAxe is that in the school book gaußian elimination implementation I made it so that the already annulated part of a row is not rescaled.

Only in the wrapper in Sage I did not expose that functionality. I guess that needs to change.



---

archive/issue_comments_392927.json:
```json
{
    "body": "<a id='comment:11'></a>\nThat part of Gau\u00dfian elimination was not changed by #17272.\n\nAh, I found the problem: the method was renamed `_echelon_in_place_classical` -> `_echelon_in_place`. So the generic matrix code is no longer calling the specialized version.",
    "created_at": "2018-05-31T09:42:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392927",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
That part of Gaußian elimination was not changed by #17272.

Ah, I found the problem: the method was renamed `_echelon_in_place_classical` -> `_echelon_in_place`. So the generic matrix code is no longer calling the specialized version.



---

archive/issue_comments_392928.json:
```json
{
    "body": "<a id='comment:12'></a>\nI will push a fix in 1 second.",
    "created_at": "2018-05-31T09:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392928",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
I will push a fix in 1 second.



---

archive/issue_comments_392929.json:
```json
{
    "body": "**Commit:** [4eae803913d67d3f46f58e56d3524c9b4f73b002](https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002)",
    "created_at": "2018-05-31T10:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392929",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [4eae803913d67d3f46f58e56d3524c9b4f73b002](https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002)



---

archive/issue_comments_392930.json:
```json
{
    "body": "**Branch:** [public/linear_algebras/fix_meataxe_echelon-25476](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebras/fix_meataxe_echelon-25476)",
    "created_at": "2018-05-31T10:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392930",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/linear_algebras/fix_meataxe_echelon-25476](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebras/fix_meataxe_echelon-25476)



---

archive/issue_comments_392931.json:
```json
{
    "body": "<a id='comment:13'></a>\nOkay, so this fixes the problem. It has a bit of technical debt as it pushes a potentially bigger issue design issue down the road, but it works. I also do similar fixes for other matrices that may not be using their optimized code. A bigger design discussion on matrices is likely needed.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002\">4eae803</a></td><td><code>Making matrices use the new _echelon_in_place method.</code></td></tr></table>\n",
    "created_at": "2018-05-31T10:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392931",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Okay, so this fixes the problem. It has a bit of technical debt as it pushes a potentially bigger issue design issue down the road, but it works. I also do similar fixes for other matrices that may not be using their optimized code. A bigger design discussion on matrices is likely needed.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002">4eae803</a></td><td><code>Making matrices use the new _echelon_in_place method.</code></td></tr></table>




---

archive/issue_events_226153.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-05-31T10:16:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226153"
}
```



---

archive/issue_comments_392932.json:
```json
{
    "body": "<a id='comment:14'></a>\nSo, you think it won't be needed to allow !Matrix_gfpn_dense to perform a partial row rescaling? Would it nonetheless be a good idea to implement?",
    "created_at": "2018-05-31T14:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392932",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>
So, you think it won't be needed to allow !Matrix_gfpn_dense to perform a partial row rescaling? Would it nonetheless be a good idea to implement?



---

archive/issue_comments_392933.json:
```json
{
    "body": "<a id='comment:15'></a>\nI definitely think it would be good to do partial row rescaling; it probably will give you a speed boost. Although that this actually indicated an error turned out to be a good thing indicating something I missed when reviewing #17272.",
    "created_at": "2018-05-31T14:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392933",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
I definitely think it would be good to do partial row rescaling; it probably will give you a speed boost. Although that this actually indicated an error turned out to be a good thing indicating something I missed when reviewing #17272.



---

archive/issue_comments_392934.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [@tscrim](#comment%3A15):\n> I definitely think it would be good to do partial row rescaling; it probably will give you a speed boost. Although that this actually indicated an error turned out to be a good thing indicating something I missed when reviewing #17272.\n\nThen I propose to provide an enhancement on top of your changes. I just checked: With your branch the tests in src/sage/matrix pass. And then I hope we can review each other's commits.",
    "created_at": "2018-05-31T14:20:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392934",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:16'></a>
Replying to [@tscrim](#comment%3A15):
> I definitely think it would be good to do partial row rescaling; it probably will give you a speed boost. Although that this actually indicated an error turned out to be a good thing indicating something I missed when reviewing #17272.

Then I propose to provide an enhancement on top of your changes. I just checked: With your branch the tests in src/sage/matrix pass. And then I hope we can review each other's commits.



---

archive/issue_comments_392935.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@simon-king-jena](#comment%3A16):\n> Replying to [@tscrim](#comment%3A15):\n> > I definitely think it would be good to do partial row rescaling; it probably will give you a speed boost. Although that this actually indicated an error turned out to be a good thing indicating something I missed when reviewing #17272.\n\n> \n> Then I propose to provide an enhancement on top of your changes. I just checked: With your branch the tests in src/sage/matrix pass. And then I hope we can review each other's commits.\n\nIn principle, I would fine with it. However, given this is a blocker issue, I think this would be better to do so on a follow-up (which I will happily review).",
    "created_at": "2018-05-31T14:29:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392935",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
Replying to [@simon-king-jena](#comment%3A16):
> Replying to [@tscrim](#comment%3A15):
> > I definitely think it would be good to do partial row rescaling; it probably will give you a speed boost. Although that this actually indicated an error turned out to be a good thing indicating something I missed when reviewing #17272.

> 
> Then I propose to provide an enhancement on top of your changes. I just checked: With your branch the tests in src/sage/matrix pass. And then I hope we can review each other's commits.

In principle, I would fine with it. However, given this is a blocker issue, I think this would be better to do so on a follow-up (which I will happily review).



---

archive/issue_comments_392936.json:
```json
{
    "body": "<a id='comment:18'></a>\nSo far I got a timeout in `sage -t src/sage/rings/padics/padic_lattice_element.py`.",
    "created_at": "2018-05-31T15:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392936",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:18'></a>
So far I got a timeout in `sage -t src/sage/rings/padics/padic_lattice_element.py`.



---

archive/issue_comments_392937.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@simon-king-jena](#comment%3A18):\n> So far I got a timeout in `sage -t src/sage/rings/padics/padic_lattice_element.py`.\n\nThat has been noticed by a few other people.",
    "created_at": "2018-05-31T15:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392937",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Replying to [@simon-king-jena](#comment%3A18):
> So far I got a timeout in `sage -t src/sage/rings/padics/padic_lattice_element.py`.

That has been noticed by a few other people.



---

archive/issue_comments_392938.json:
```json
{
    "body": "<a id='comment:20'></a>\n`sage -t src/sage/rings/padics/padic_lattice_element.py` and `sage -t src/sage/rings/padics/padic_base_leaves.py` time out consistently, even when tested separately. \n\nI cannot imagine that it is related with the issue we are dealing with here - hence, I'll try if these two tests fail without the patch from here.",
    "created_at": "2018-05-31T18:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392938",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:20'></a>
`sage -t src/sage/rings/padics/padic_lattice_element.py` and `sage -t src/sage/rings/padics/padic_base_leaves.py` time out consistently, even when tested separately. 

I cannot imagine that it is related with the issue we are dealing with here - hence, I'll try if these two tests fail without the patch from here.



---

archive/issue_comments_392939.json:
```json
{
    "body": "<a id='comment:21'></a>\nYep, I get the same timeouts. So, I believe the timeouts are not related with this ticket and thus shouldn't prevent a review.\n\nThe code looks good. But shouldn't there be a test that demonstrates that the bug is fixed? Or are the existing tests good enough?",
    "created_at": "2018-05-31T19:10:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392939",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>
Yep, I get the same timeouts. So, I believe the timeouts are not related with this ticket and thus shouldn't prevent a review.

The code looks good. But shouldn't there be a test that demonstrates that the bug is fixed? Or are the existing tests good enough?



---

archive/issue_comments_392940.json:
```json
{
    "body": "<a id='comment:22'></a>\nTests pass for me on OS X with this branch, on a system with MeatAxe installed. I haven't tried without MeatAxe present.",
    "created_at": "2018-05-31T19:57:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392940",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
Tests pass for me on OS X with this branch, on a system with MeatAxe installed. I haven't tried without MeatAxe present.



---

archive/issue_comments_392941.json:
```json
{
    "body": "<a id='comment:23'></a>\nI would say the existing tests are good enough since they were breaking before this change.",
    "created_at": "2018-06-01T05:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392941",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
I would say the existing tests are good enough since they were breaking before this change.



---

archive/issue_comments_392942.json:
```json
{
    "body": "**Author:** Travis Scrimshaw",
    "created_at": "2018-06-01T06:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392942",
    "user": "https://github.com/simon-king-jena"
}
```

**Author:** Travis Scrimshaw



---

archive/issue_comments_392943.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@tscrim](#comment%3A23):\n> I would say the existing tests are good enough since they were breaking before this change.\n\nIn this case I can give a positive review.",
    "created_at": "2018-06-01T06:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392943",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:24'></a>
Replying to [@tscrim](#comment%3A23):
> I would say the existing tests are good enough since they were breaking before this change.

In this case I can give a positive review.



---

archive/issue_events_226154.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-01T06:35:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226154"
}
```



---

archive/issue_events_226155.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-01T06:35:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226155"
}
```



---

archive/issue_comments_392944.json:
```json
{
    "body": "**Reviewer:** Simon King",
    "created_at": "2018-06-01T06:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392944",
    "user": "https://github.com/simon-king-jena"
}
```

**Reviewer:** Simon King



---

archive/issue_events_226156.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-02T09:05:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226156"
}
```



---

archive/issue_events_226157.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-02T09:05:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226157"
}
```



---

archive/issue_comments_392945.json:
```json
{
    "body": "<a id='comment:25'></a>\nSee patchbot",
    "created_at": "2018-06-02T09:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392945",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
See patchbot



---

archive/issue_comments_392946.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [@vbraun](#comment%3A25):\n> See patchbot\n\nThe patchbot complains that there is a non-ascii character. But I cannot identify it. So, what is it?\n\nThe patchbot complains about pyflakes. But the error is \"NameError: name 'isPythonFile' is not defined\". Doesn't that mean there is a bug in the plugin, not in the changeset?\n\nThe patchbot complains about startup time. I don't know how to interpret the numbers, so I don't know how much of a problem we have here.\n\nThe test error is reproducible as follows:\n\n```\nsage: K.<x> = GF(25)\nsage: M = MatrixSpace(K,9,3,implementation='generic')()\nsage: entries = [((0, 2), x), ((0, 4), 3*x + 2), ((0, 8), 2*x), ((1, 1), x + 3), ((1, 5), 3*x), ((1, 6), x + 4), ((2, 0), 2*x), ((2, 5), 4*x + 1)]\nsage: for (i,j),v in entries: M[j,i]=v\nsage: M\n[      0       0     2*x]\n[      0   x + 3       0]\n[      x       0       0]\n[      0       0       0]\n[3*x + 2       0       0]\n[      0     3*x 4*x + 1]\n[      0   x + 4       0]\n[      0       0       0]\n[    2*x       0       0]\nsage: type(M)\n<type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>\nsage: M._echelon_in_place('classical')\n(0, 1, 2)\n```\nHence, `M._echelon_in_place_classical` behaves differently for Matrix_gfpn_dense and for generic implementation. That indeed needs to be fixed.",
    "created_at": "2018-06-02T09:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392946",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:26'></a>
Replying to [@vbraun](#comment%3A25):
> See patchbot

The patchbot complains that there is a non-ascii character. But I cannot identify it. So, what is it?

The patchbot complains about pyflakes. But the error is "NameError: name 'isPythonFile' is not defined". Doesn't that mean there is a bug in the plugin, not in the changeset?

The patchbot complains about startup time. I don't know how to interpret the numbers, so I don't know how much of a problem we have here.

The test error is reproducible as follows:

```
sage: K.<x> = GF(25)
sage: M = MatrixSpace(K,9,3,implementation='generic')()
sage: entries = [((0, 2), x), ((0, 4), 3*x + 2), ((0, 8), 2*x), ((1, 1), x + 3), ((1, 5), 3*x), ((1, 6), x + 4), ((2, 0), 2*x), ((2, 5), 4*x + 1)]
sage: for (i,j),v in entries: M[j,i]=v
sage: M
[      0       0     2*x]
[      0   x + 3       0]
[      x       0       0]
[      0       0       0]
[3*x + 2       0       0]
[      0     3*x 4*x + 1]
[      0   x + 4       0]
[      0       0       0]
[    2*x       0       0]
sage: type(M)
<type 'sage.matrix.matrix_generic_dense.Matrix_generic_dense'>
sage: M._echelon_in_place('classical')
(0, 1, 2)
```
Hence, `M._echelon_in_place_classical` behaves differently for Matrix_gfpn_dense and for generic implementation. That indeed needs to be fixed.



---

archive/issue_comments_392947.json:
```json
{
    "body": "<a id='comment:27'></a>\nThe generic implementation's documentation does not state what return value it gives. However, it apparently returns the pivots. So, I guess I shall modify the _echelon_in_place_classical method of Matrix_gfpn_dense.",
    "created_at": "2018-06-02T09:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392947",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:27'></a>
The generic implementation's documentation does not state what return value it gives. However, it apparently returns the pivots. So, I guess I shall modify the _echelon_in_place_classical method of Matrix_gfpn_dense.



---

archive/issue_comments_392948.json:
```json
{
    "body": "**Changing commit** from \"[4eae803913d67d3f46f58e56d3524c9b4f73b002](https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002)\" to \"[e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d](https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d)\".",
    "created_at": "2018-06-02T15:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392948",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4eae803913d67d3f46f58e56d3524c9b4f73b002](https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002)" to "[e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d](https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d)".



---

archive/issue_comments_392949.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d\">e2f0550</a></td><td><code>Specify that _echelon_in_place shall return the pivots</code></td></tr></table>\n",
    "created_at": "2018-06-02T15:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392949",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d">e2f0550</a></td><td><code>Specify that _echelon_in_place shall return the pivots</code></td></tr></table>




---

archive/issue_comments_392950.json:
```json
{
    "body": "**Changing author** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Simon King\".",
    "created_at": "2018-06-02T15:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392950",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing author** from "Travis Scrimshaw" to "Travis Scrimshaw, Simon King".



---

archive/issue_comments_392951.json:
```json
{
    "body": "<a id='comment:29'></a>\nDone! Should work now, regardless whether meataxe is installed or not. Hopefully someone can review the last commit.",
    "created_at": "2018-06-02T15:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392951",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:29'></a>
Done! Should work now, regardless whether meataxe is installed or not. Hopefully someone can review the last commit.



---

archive/issue_events_226158.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-02T15:02:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226158"
}
```



---

archive/issue_events_226159.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-02T15:02:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226159"
}
```



---

archive/issue_comments_392952.json:
```json
{
    "body": "<a id='comment:30'></a>\n\n```\n----------------------------------------------------------------------\nsage -t src/sage/rings/padics/padic_base_leaves.py  # Timed out\nsage -t src/sage/rings/padics/padic_lattice_element.py  # Timed out\nsage -t src/sage/tests/cmdline.py  # 2 doctests failed\nsage -t src/sage/symbolic/integration/integral.py  # 1 doctest failed\nsage -t src/sage/combinat/tutorial.py  # 2 doctests failed\nsage -t src/sage/groups/perm_gps/permgroup_named.py  # 2 doctests failed\nsage -t src/sage/combinat/words/paths.py  # 1 doctest failed\nsage -t src/sage/symbolic/integration/external.py  # 3 doctests failed\nsage -t src/sage/combinat/designs/bibd.py  # 1 doctest failed\nsage -t src/sage/databases/oeis.py  # 34 doctests failed\nsage -t src/sage/coding/databases.py  # 2 doctests failed\nsage -t src/doc/en/developer/coding_basics.rst  # 1 doctest failed\nsage -t src/sage/combinat/integer_lists/invlex.pyx  # 1 doctest failed\nsage -t src/sage/repl/load.py  # 1 doctest failed\nsage -t src/sage/databases/findstat.py  # 8 doctests failed\nsage -t src/sage/combinat/designs/ext_rep.py  # 1 doctest failed\nsage -t src/sage/finance/stock.py  # 20 doctests failed\nsage -t src/sage/structure/sage_object.pyx  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 4047.7 seconds\n    cpu time: 8523.9 seconds\n    cumulative wall time: 10809.1 seconds\nExternal software detected for doctesting: internet,latex\nTraceback (most recent call last):\n  File \"/home/king/Sage/git/sage/src/bin/sage-runtests\", line 127, in <module>\n    err = DC.run()\n  File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1176, in run\n    + ','.join(available_software.seen()))\n  File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 583, in log\n    self.logger.write(s + end)\n  File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 250, in write\n    f.write(x)\nValueError: I/O operation on closed file\nMakefile:132: recipe for target 'ptestall' failed\nmake: *** [ptestall] Error 1\n```\nOuch.",
    "created_at": "2018-06-02T18:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392952",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:30'></a>

```
----------------------------------------------------------------------
sage -t src/sage/rings/padics/padic_base_leaves.py  # Timed out
sage -t src/sage/rings/padics/padic_lattice_element.py  # Timed out
sage -t src/sage/tests/cmdline.py  # 2 doctests failed
sage -t src/sage/symbolic/integration/integral.py  # 1 doctest failed
sage -t src/sage/combinat/tutorial.py  # 2 doctests failed
sage -t src/sage/groups/perm_gps/permgroup_named.py  # 2 doctests failed
sage -t src/sage/combinat/words/paths.py  # 1 doctest failed
sage -t src/sage/symbolic/integration/external.py  # 3 doctests failed
sage -t src/sage/combinat/designs/bibd.py  # 1 doctest failed
sage -t src/sage/databases/oeis.py  # 34 doctests failed
sage -t src/sage/coding/databases.py  # 2 doctests failed
sage -t src/doc/en/developer/coding_basics.rst  # 1 doctest failed
sage -t src/sage/combinat/integer_lists/invlex.pyx  # 1 doctest failed
sage -t src/sage/repl/load.py  # 1 doctest failed
sage -t src/sage/databases/findstat.py  # 8 doctests failed
sage -t src/sage/combinat/designs/ext_rep.py  # 1 doctest failed
sage -t src/sage/finance/stock.py  # 20 doctests failed
sage -t src/sage/structure/sage_object.pyx  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 4047.7 seconds
    cpu time: 8523.9 seconds
    cumulative wall time: 10809.1 seconds
External software detected for doctesting: internet,latex
Traceback (most recent call last):
  File "/home/king/Sage/git/sage/src/bin/sage-runtests", line 127, in <module>
    err = DC.run()
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1176, in run
    + ','.join(available_software.seen()))
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 583, in log
    self.logger.write(s + end)
  File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 250, in write
    f.write(x)
ValueError: I/O operation on closed file
Makefile:132: recipe for target 'ptestall' failed
make: *** [ptestall] Error 1
```
Ouch.



---

archive/issue_comments_392953.json:
```json
{
    "body": "<a id='comment:31'></a>\nBut these failures seem all to be \"optional: internet\". Anyway, I got them with `make ptestall`.",
    "created_at": "2018-06-02T18:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392953",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:31'></a>
But these failures seem all to be "optional: internet". Anyway, I got them with `make ptestall`.



---

archive/issue_comments_392954.json:
```json
{
    "body": "<a id='comment:32'></a>\nPS: I'll try again with a clean develop branch.",
    "created_at": "2018-06-02T18:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392954",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:32'></a>
PS: I'll try again with a clean develop branch.



---

archive/issue_comments_392955.json:
```json
{
    "body": "<a id='comment:33'></a>\nLoads of errors, but at least the last few errors I saw are due to what was fixed in this ticket.\n\nFrustrating.",
    "created_at": "2018-06-02T19:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392955",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:33'></a>
Loads of errors, but at least the last few errors I saw are due to what was fixed in this ticket.

Frustrating.



---

archive/issue_comments_392956.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [@simon-king-jena](#comment%3A33):\n> Loads of errors, but at least the last few errors I saw are due to what was fixed in this ticket.\n> \n> Frustrating.\n\nThe \"optional - internet\" tests are failing, too.",
    "created_at": "2018-06-02T19:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392956",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:34'></a>
Replying to [@simon-king-jena](#comment%3A33):
> Loads of errors, but at least the last few errors I saw are due to what was fixed in this ticket.
> 
> Frustrating.

The "optional - internet" tests are failing, too.



---

archive/issue_comments_392957.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [@simon-king-jena](#comment%3A33):\n> Frustrating.\n\nBy \"frustrating\" I mean the fact that a clean develop branch doesn't pass tests. So, how could one possibly do development without a proper base to start with.",
    "created_at": "2018-06-02T20:40:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392957",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:35'></a>
Replying to [@simon-king-jena](#comment%3A33):
> Frustrating.

By "frustrating" I mean the fact that a clean develop branch doesn't pass tests. So, how could one possibly do development without a proper base to start with.



---

archive/issue_comments_392958.json:
```json
{
    "body": "<a id='comment:36'></a>\nThe internet tests failing are in some sense recent: Sage is supposed to automatically test for an internet connection and then run those tests, but the function `has_internet` was incorrectly returning `False` until a recent fix (#25222). Now lots of tests are failing, but there are tickets for them (#25474, #25472, and some others). You could turn off your internet while running tests, or just specify testing those tests marked optional with the `meataxe` tag.",
    "created_at": "2018-06-02T21:34:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392958",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>
The internet tests failing are in some sense recent: Sage is supposed to automatically test for an internet connection and then run those tests, but the function `has_internet` was incorrectly returning `False` until a recent fix (#25222). Now lots of tests are failing, but there are tickets for them (#25474, #25472, and some others). You could turn off your internet while running tests, or just specify testing those tests marked optional with the `meataxe` tag.



---

archive/issue_comments_392959.json:
```json
{
    "body": "<a id='comment:37'></a>\nYou can also run the tests manually with `sage -b` (with `--optional=sage,meataxe`, but I think `internet` gets excluded from those tests and the default is sufficient).",
    "created_at": "2018-06-03T07:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392959",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>
You can also run the tests manually with `sage -b` (with `--optional=sage,meataxe`, but I think `internet` gets excluded from those tests and the default is sufficient).



---

archive/issue_comments_392960.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [@simon-king-jena](#comment%3A35):\n> So, how could one possibly do development without a proper base to start with.\n\nDon't use `make ptestall` if you don't want all external tests to be run. Instead, use `make ptest`.",
    "created_at": "2018-06-04T08:19:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392960",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
Replying to [@simon-king-jena](#comment%3A35):
> So, how could one possibly do development without a proper base to start with.

Don't use `make ptestall` if you don't want all external tests to be run. Instead, use `make ptest`.



---

archive/issue_comments_392961.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [@simon-king-jena](#comment%3A29):\n> Hopefully someone can review the last commit.\n\nTravis, can you do that? This is making it very hard to work on any matrix-related ticket (like #23719, #25079 and #25504)",
    "created_at": "2018-06-04T12:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392961",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Replying to [@simon-king-jena](#comment%3A29):
> Hopefully someone can review the last commit.

Travis, can you do that? This is making it very hard to work on any matrix-related ticket (like #23719, #25079 and #25504)



---

archive/issue_comments_392962.json:
```json
{
    "body": "<a id='comment:40'></a>\nLGTM. Thank you.",
    "created_at": "2018-06-05T00:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392962",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>
LGTM. Thank you.



---

archive/issue_events_226160.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-05T00:12:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226160"
}
```



---

archive/issue_events_226161.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-05T00:12:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226161"
}
```



---

archive/issue_comments_392963.json:
```json
{
    "body": "**Changing reviewer** from \"Simon King\" to \"Simon King, Travis Scrimshaw\".",
    "created_at": "2018-06-05T00:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392963",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Simon King" to "Simon King, Travis Scrimshaw".



---

archive/issue_events_226162.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-07T22:15:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226162"
}
```



---

archive/issue_events_226163.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "88ad0a94025e9507ca8e0be6a3b0ee3ceb3125de",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-06-07T22:15:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25476#event-226163"
}
```



---

archive/issue_comments_392964.json:
```json
{
    "body": "**Changing branch** from \"[public/linear_algebras/fix_meataxe_echelon-25476](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebras/fix_meataxe_echelon-25476)\" to \"[e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d](https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d)\".",
    "created_at": "2018-06-07T22:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25476#issuecomment-392964",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/linear_algebras/fix_meataxe_echelon-25476](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebras/fix_meataxe_echelon-25476)" to "[e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d](https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d)".
