# Issue 25168: Doctests: Symbolic expression matching bug

archive/issues_024931.json:
```json
{
    "body": "This is from GiNaC:\n\n```\nsage: w0=SR.wild(0); w1=SR.wild(1); w2=SR.wild(2)\nsage: (sqrt(c+x)*x).match(w0 * sqrt(w0+w1))\nsage: (sqrt(c+x)*x).match(w1 * sqrt(w0+w1))\n{$0: c, $1: x}\nssage: (sqrt(c*x)*x).match(w0 * sqrt(w0*w1))  # no output: fail\nsage: (sqrt(c*x)*x).match(w1 * sqrt(w0*w1))\n{$0: c, $1: x}\n```\n\nMatching practically works if wildcards are not repeated. This means it's unusable for serious work.\n\nhttps://github.com/pynac/pynac/issues/324\n\nThis branch adds extensive doctest cases in a file under `tests/`\n\nAuthor: Ralf Stephan\n\nBranch: u/rws/25168-1\n\nStatus: needs_review\n\nDependencies: #25447, #24838\n\nCommit: 7f17534c420c0f3354fd97747c1a7d67971b2752\n\nIssue created by migration from https://trac.sagemath.org/ticket/25168\n\n",
    "created_at": "2018-04-14T08:27:35Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Doctests: Symbolic expression matching bug",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25168",
    "user": "https://github.com/rwst"
}
```
This is from GiNaC:

```
sage: w0=SR.wild(0); w1=SR.wild(1); w2=SR.wild(2)
sage: (sqrt(c+x)*x).match(w0 * sqrt(w0+w1))
sage: (sqrt(c+x)*x).match(w1 * sqrt(w0+w1))
{$0: c, $1: x}
ssage: (sqrt(c*x)*x).match(w0 * sqrt(w0*w1))  # no output: fail
sage: (sqrt(c*x)*x).match(w1 * sqrt(w0*w1))
{$0: c, $1: x}
```

Matching practically works if wildcards are not repeated. This means it's unusable for serious work.

https://github.com/pynac/pynac/issues/324

This branch adds extensive doctest cases in a file under `tests/`

Author: Ralf Stephan

Branch: u/rws/25168-1

Status: needs_review

Dependencies: #25447, #24838

Commit: 7f17534c420c0f3354fd97747c1a7d67971b2752

Issue created by migration from https://trac.sagemath.org/ticket/25168





---

archive/issue_comments_480538.json:
```json
{
    "body": "<a id='comment:1'></a>It should be noted that GiNaC's match() also does not differentiate between regular and sequence variables, they behave as regular in nonassociative functions, but as sequence in sums and products. This means that `(a+b).match(a+b+w0)` will match with `w0:0`. This can no longer be changed as it's established by now. It however complicates real commutative matching (if done right) by a great deal.\n\nIn contrast Mathematica differentiates between `f[a + b + u_] := u` where `f` does not match `a+b`, and `f[a + b + u___] := u` with `f[a + b] = Sequence[]`.",
    "created_at": "2018-04-17T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480538",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>It should be noted that GiNaC's match() also does not differentiate between regular and sequence variables, they behave as regular in nonassociative functions, but as sequence in sums and products. This means that `(a+b).match(a+b+w0)` will match with `w0:0`. This can no longer be changed as it's established by now. It however complicates real commutative matching (if done right) by a great deal.

In contrast Mathematica differentiates between `f[a + b + u_] := u` where `f` does not match `a+b`, and `f[a + b + u___] := u` with `f[a + b] = Sequence[]`.



---

archive/issue_comments_480539.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/symbolic_expression_matching_bug\"",
    "created_at": "2018-05-27T06:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480539",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/symbolic_expression_matching_bug"



---

archive/issue_comments_480540.json:
```json
{
    "body": "Changing commit from \"\" to \"2a22ae8b65c543d233b6bf38aefde5050e6d5dff\"",
    "created_at": "2018-05-27T06:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480540",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "2a22ae8b65c543d233b6bf38aefde5050e6d5dff"



---

archive/issue_comments_480541.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-27T06:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480541",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480542.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#25447, pynac-0.7.20\"",
    "created_at": "2018-05-27T06:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480542",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "#25447, pynac-0.7.20"



---

archive/issue_events_063138.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-05-27T06:15:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25168#event-63138"
}
```



---

archive/issue_comments_480543.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2018-05-27T06:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480543",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_480544.json:
```json
{
    "body": "Changing branch from \"u/rws/symbolic_expression_matching_bug\" to \"u/rws/25168-1\"",
    "created_at": "2018-07-01T07:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480544",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/symbolic_expression_matching_bug" to "u/rws/25168-1"



---

archive/issue_comments_480545.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-01T08:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480545",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_480546.json:
```json
{
    "body": "Changing commit from \"2a22ae8b65c543d233b6bf38aefde5050e6d5dff\" to \"7f17534c420c0f3354fd97747c1a7d67971b2752\"",
    "created_at": "2018-07-01T08:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480546",
    "user": "https://github.com/rwst"
}
```

Changing commit from "2a22ae8b65c543d233b6bf38aefde5050e6d5dff" to "7f17534c420c0f3354fd97747c1a7d67971b2752"



---

archive/issue_comments_480547.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2018-07-01T08:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480547",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_480548.json:
```json
{
    "body": "Changing dependencies from \"#25447, pynac-0.7.20\" to \"#25447, #24868\"",
    "created_at": "2018-07-01T08:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480548",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#25447, pynac-0.7.20" to "#25447, #24868"



---

archive/issue_comments_480549.json:
```json
{
    "body": "Changing dependencies from \"#25447, #24868\" to \"#25447, #24838\"",
    "created_at": "2018-07-01T08:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480549",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#25447, #24868" to "#25447, #24838"



---

archive/issue_comments_480550.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,5 @@\n Matching practically works if wildcards are not repeated. This means it's unusable for serious work.\n \n https://github.com/pynac/pynac/issues/324\n+\n+This branch adds extensive doctest cases in a file under `tests/`\n``````\n",
    "created_at": "2018-07-02T05:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480550",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,5 @@
 Matching practically works if wildcards are not repeated. This means it's unusable for serious work.
 
 https://github.com/pynac/pynac/issues/324
+
+This branch adds extensive doctest cases in a file under `tests/`
``````




---

archive/issue_events_063139.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25168#event-63139"
}
```



---

archive/issue_events_063140.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25168#event-63140"
}
```



---

archive/issue_comments_480551.json:
```json
{
    "body": "<a id='comment:9'></a>update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25168#issuecomment-480551",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>update milestone 8.3 -> 8.4
