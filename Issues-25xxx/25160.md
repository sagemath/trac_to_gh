# Issue 25160: Do not mangle Python stack traces in sphinx-build

archive/issues_024923.json:
```json
{
    "body": "This upstreams part of Debian's `u2-better-sphinx-failure-modes.patch` by Ximin Luo: we should not `.strip()` the lines that come out of Sphinx because this breaks indent in stack traces. Instead we should only `rstrip()` to remove the trailing newline.\n\nAfter this one line change, I also wanted to make this doctestable, so I had to remove the global variable (which at least to me feels like a hack anyway.)\n\nFinally, I added a copyright header sourced from the git log.\n\nCC:  @infinity0\n\nReviewer: Jeroen Demeyer\n\nAuthor: Julian R\u00fcth\n\nBranch: 67aff77da6301d16b409a495e1bd0737177678cb\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25160\n\n",
    "closed_at": "2018-05-19T15:56:37Z",
    "created_at": "2018-04-13T11:49:21Z",
    "labels": [
        "component: doctest framework",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Do not mangle Python stack traces in sphinx-build",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25160",
    "user": "https://github.com/saraedum"
}
```
This upstreams part of Debian's `u2-better-sphinx-failure-modes.patch` by Ximin Luo: we should not `.strip()` the lines that come out of Sphinx because this breaks indent in stack traces. Instead we should only `rstrip()` to remove the trailing newline.

After this one line change, I also wanted to make this doctestable, so I had to remove the global variable (which at least to me feels like a hack anyway.)

Finally, I added a copyright header sourced from the git log.

CC:  @infinity0

Reviewer: Jeroen Demeyer

Author: Julian RÃ¼th

Branch: 67aff77da6301d16b409a495e1bd0737177678cb

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25160





---

archive/issue_comments_480249.json:
```json
{
    "body": "Changing branch from \"\" to \"u/saraedum/sphinxbuild-stack\"",
    "created_at": "2018-04-13T11:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480249",
    "user": "https://github.com/saraedum"
}
```

Changing branch from "" to "u/saraedum/sphinxbuild-stack"



---

archive/issue_comments_480250.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-13T11:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480250",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_480251.json:
```json
{
    "body": "Changing commit from \"\" to \"18afd6d2d95c0f36bb27f429339f2e29c05fe743\"",
    "created_at": "2018-04-13T11:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480251",
    "user": "https://github.com/saraedum"
}
```

Changing commit from "" to "18afd6d2d95c0f36bb27f429339f2e29c05fe743"



---

archive/issue_comments_480252.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-04-13T11:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480252",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_480253.json:
```json
{
    "body": "Changing commit from \"18afd6d2d95c0f36bb27f429339f2e29c05fe743\" to \"0936a5de140a5fa3f6f9e0f5960702bfc4a16702\"",
    "created_at": "2018-04-13T18:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "18afd6d2d95c0f36bb27f429339f2e29c05fe743" to "0936a5de140a5fa3f6f9e0f5960702bfc4a16702"



---

archive/issue_comments_480254.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-04-13T18:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_480255.json:
```json
{
    "body": "Changing commit from \"0936a5de140a5fa3f6f9e0f5960702bfc4a16702\" to \"0477b3c52728e39271bb19210458f64fe62a22d5\"",
    "created_at": "2018-04-13T18:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0936a5de140a5fa3f6f9e0f5960702bfc4a16702" to "0477b3c52728e39271bb19210458f64fe62a22d5"



---

archive/issue_comments_480256.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-13T18:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_480257.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T18:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480258.json:
```json
{
    "body": "Changing commit from \"0477b3c52728e39271bb19210458f64fe62a22d5\" to \"ca66c033e2d3023c5d51f0206954ed3e5c3aa3c6\"",
    "created_at": "2018-04-13T18:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480258",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0477b3c52728e39271bb19210458f64fe62a22d5" to "ca66c033e2d3023c5d51f0206954ed3e5c3aa3c6"



---

archive/issue_comments_480259.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T20:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480259",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480260.json:
```json
{
    "body": "Changing commit from \"ca66c033e2d3023c5d51f0206954ed3e5c3aa3c6\" to \"5881359e17cc4a6ee3e7884afceefec7d4fd9908\"",
    "created_at": "2018-04-13T20:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480260",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ca66c033e2d3023c5d51f0206954ed3e5c3aa3c6" to "5881359e17cc4a6ee3e7884afceefec7d4fd9908"



---

archive/issue_comments_480261.json:
```json
{
    "body": "Changing commit from \"5881359e17cc4a6ee3e7884afceefec7d4fd9908\" to \"f46dee40c0057348c2ffcbcd1ebeb3bd24c30f1a\"",
    "created_at": "2018-04-14T00:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480261",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5881359e17cc4a6ee3e7884afceefec7d4fd9908" to "f46dee40c0057348c2ffcbcd1ebeb3bd24c30f1a"



---

archive/issue_comments_480262.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-14T00:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480263.json:
```json
{
    "body": "<a id='comment:8'></a>I think it would be better to write `if self._error is not None` instead of `if self._error`",
    "created_at": "2018-04-16T08:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480263",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>I think it would be better to write `if self._error is not None` instead of `if self._error`



---

archive/issue_comments_480264.json:
```json
{
    "body": "Changing commit from \"f46dee40c0057348c2ffcbcd1ebeb3bd24c30f1a\" to \"9dc5282551eb0fd81ce37d819a440827ca3eb9ff\"",
    "created_at": "2018-04-21T19:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f46dee40c0057348c2ffcbcd1ebeb3bd24c30f1a" to "9dc5282551eb0fd81ce37d819a440827ca3eb9ff"



---

archive/issue_comments_480265.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T19:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480266.json:
```json
{
    "body": "Changing commit from \"9dc5282551eb0fd81ce37d819a440827ca3eb9ff\" to \"67aff77da6301d16b409a495e1bd0737177678cb\"",
    "created_at": "2018-04-21T19:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9dc5282551eb0fd81ce37d819a440827ca3eb9ff" to "67aff77da6301d16b409a495e1bd0737177678cb"



---

archive/issue_comments_480267.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T19:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480268.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-04-23T13:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480268",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_480269.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-23T13:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480269",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_063125.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2018-05-17T11:49:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25160#event-63125"
}
```



---

archive/issue_events_063126.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-19T15:56:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25160#event-63126"
}
```



---

archive/issue_comments_480270.json:
```json
{
    "body": "Changing branch from \"u/saraedum/sphinxbuild-stack\" to \"67aff77da6301d16b409a495e1bd0737177678cb\"",
    "created_at": "2018-05-19T15:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480270",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/saraedum/sphinxbuild-stack" to "67aff77da6301d16b409a495e1bd0737177678cb"



---

archive/issue_comments_480271.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-19T15:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480271",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_480272.json:
```json
{
    "body": "Changing commit from \"67aff77da6301d16b409a495e1bd0737177678cb\" to \"\"",
    "created_at": "2019-01-17T22:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480272",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "67aff77da6301d16b409a495e1bd0737177678cb" to ""



---

archive/issue_comments_480273.json:
```json
{
    "body": "<a id='comment:15'></a>Breakage at #27073.",
    "created_at": "2019-01-17T22:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480273",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Breakage at #27073.



---

archive/issue_comments_480274.json:
```json
{
    "body": "NOTE: doctests ignore whitespace, so this test doesn't actually test the indentation anyway.",
    "created_at": "2019-01-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25160#issuecomment-480274",
    "user": "https://github.com/jdemeyer"
}
```

NOTE: doctests ignore whitespace, so this test doesn't actually test the indentation anyway.
