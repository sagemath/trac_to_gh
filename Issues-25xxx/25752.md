# Issue 25752: @cached_method for cdef classes without a __dict__ are not cached

archive/issues_025515.json:
```json
{
    "assignees": [],
    "body": "\n```sage\nsage: cython(\"\"\"\n....: from sage.misc.cachefunc import cached_method\n....: cdef class Foo(object):\n....:     @cached_method\n....:     def test(self, x):\n....:         print(\"cache\")\n....:         return 5\n....: \"\"\")\nsage: F = Foo()\nsage: F.test(2)\ncache\n5\nsage: F.test(2)\ncache\n5\n```\n\nThis may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.\n\nCC:  @jdemeyer @simon-king-jena @saraedum\n\nKeywords: **days94**\n\nComponent: **performance**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25752_\n\n",
    "created_at": "2018-07-02T21:41:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "@cached_method for cdef classes without a __dict__ are not cached",
    "type": "issue",
    "updated_at": "2022-12-29T01:41:45Z",
    "url": "https://github.com/sagemath/sage/issues/25752",
    "user": "https://github.com/tscrim"
}
```

```sage
sage: cython("""
....: from sage.misc.cachefunc import cached_method
....: cdef class Foo(object):
....:     @cached_method
....:     def test(self, x):
....:         print("cache")
....:         return 5
....: """)
sage: F = Foo()
sage: F.test(2)
cache
5
sage: F.test(2)
cache
5
```

This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.

CC:  @jdemeyer @simon-king-jena @saraedum

Keywords: **days94**

Component: **performance**

_Issue created by migration from https://trac.sagemath.org/ticket/25752_





---

archive/issue_events_356048.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-02T21:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25752",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25752#event-356048"
}
```



---

archive/issue_events_356049.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-02T21:41:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25752",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25752#event-356049"
}
```



---

archive/issue_events_356050.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-02T21:41:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25752",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25752#event-356050"
}
```



---

archive/issue_events_356051.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-02T21:41:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25752",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25752#event-356051"
}
```



---

archive/issue_comments_395686.json:
```json
{
    "body": "Replying to [ticket:25752 tscrim]:\n> This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.\n\nI think it was designed that way. It should provide a cache for Python classes and for parents (even if the parent is cdef). For everything else it should just work as a usual method (albeit slower).",
    "created_at": "2018-07-02T23:09:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25752#issuecomment-395686",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [ticket:25752 tscrim]:
> This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.

I think it was designed that way. It should provide a cache for Python classes and for parents (even if the parent is cdef). For everything else it should just work as a usual method (albeit slower).



---

archive/issue_comments_395687.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@simon-king-jena](#comment:1):\n> Replying to [ticket:25752 tscrim]:\n> > This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.\n\n> \n> I think it was designed that way. It should provide a cache for Python classes and for parents (even if the parent is cdef).\n\nThat is curious:\n\n```\nsage: cython(\"\"\"\n....: from sage.misc.cachefunc import cached_method\n....: from sage.structure.parent cimport Parent\n....: cdef class Foo(Parent):\n....:     @cached_method\n....:     def test(self, x):\n....:         print(\"cache\")\n....:         return 5\n....: \"\"\")\nsage: F = Foo()\nsage: F.test(2)\ncache\n5\nsage: F.test(2)\n5\n```\nWhy does it work special for `Parent` subclasses? Is this behavior doc(tested)?\n\n> For everything else it should just work as a usual method (albeit slower).\n\nIs this documented somewhere? If the result is not cached, why is the decorator just not doing anything to method (and instead slowing it down)?",
    "created_at": "2018-07-03T07:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25752#issuecomment-395687",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@simon-king-jena](#comment:1):
> Replying to [ticket:25752 tscrim]:
> > This may not be fixable as there is not a way to assign something to `F`, but it should not silently not cache the result.

> 
> I think it was designed that way. It should provide a cache for Python classes and for parents (even if the parent is cdef).

That is curious:

```
sage: cython("""
....: from sage.misc.cachefunc import cached_method
....: from sage.structure.parent cimport Parent
....: cdef class Foo(Parent):
....:     @cached_method
....:     def test(self, x):
....:         print("cache")
....:         return 5
....: """)
sage: F = Foo()
sage: F.test(2)
cache
5
sage: F.test(2)
5
```
Why does it work special for `Parent` subclasses? Is this behavior doc(tested)?

> For everything else it should just work as a usual method (albeit slower).

Is this documented somewhere? If the result is not cached, why is the decorator just not doing anything to method (and instead slowing it down)?



---

archive/issue_events_356052.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:41:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25752",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25752#event-356052"
}
```
