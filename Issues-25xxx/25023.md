# Issue 25023: Adds function to compute quadratic defect

archive/issues_024786.json:
```json
{
    "body": "Computes the quadratic defect (see O'Meara Section 63A) of a number field element locally at a prime p.  This is an implementation of Algorithm 3.1.3 from Kirschmer's \"Definite quadratic and hermitian forms with small class number.\"   \n\nThe function returns the valuation of the quadratic defect (rather than the fractional ideal itself) since this is the more relevant (and computationally useful) piece of information. \n\nBranch/Commit: 56283fe849868db720531ad45364aa247050247a\n\nReviewer: Simon Brandhorst\n\nAuthor: Anna Haensch\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25023\n\n",
    "closed_at": "2018-05-12T11:47:16Z",
    "created_at": "2018-03-22T09:52:29Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Adds function to compute quadratic defect",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25023",
    "user": "https://github.com/annahaensch"
}
```
Computes the quadratic defect (see O'Meara Section 63A) of a number field element locally at a prime p.  This is an implementation of Algorithm 3.1.3 from Kirschmer's "Definite quadratic and hermitian forms with small class number."   

The function returns the valuation of the quadratic defect (rather than the fractional ideal itself) since this is the more relevant (and computationally useful) piece of information. 

Branch/Commit: 56283fe849868db720531ad45364aa247050247a

Reviewer: Simon Brandhorst

Author: Anna Haensch

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25023





---

archive/issue_comments_370483.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-03-24T10:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370483",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_370484.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-24T10:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370484",
    "user": "https://github.com/annahaensch"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_370485.json:
```json
{
    "body": "<a id='comment:3'></a>Some quick comments:\n\nover `QQ`:\ndo not use quadratic_residues as that forms a list of size (p-1)/2  this is not necessary. You can use legendre_symbol or reduce mod p and then use is_square (like over numberfields)\n\nYour method quadratic_defect sits in the wrong class. (NumberField_quadratic) so it is not accessible in general. For example we can move it to NumberField_generic. \n\n```\n+                    if w < u and w % 2 ==1:\n+                        d = v+w\n+                    if w == u and (f+F((a-1)/4)).is_irreducible():\n+                        d = v+w\n```\nYou sure this is correct ?(I did not fully check).\n\n- the reference to kirschmers work should be a proper citation  in src/doc/en/reference/references\n\nCould you explain why you consider the valuation more useful than the quadratic_defect itself?",
    "created_at": "2018-03-27T16:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370485",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:3'></a>Some quick comments:

over `QQ`:
do not use quadratic_residues as that forms a list of size (p-1)/2  this is not necessary. You can use legendre_symbol or reduce mod p and then use is_square (like over numberfields)

Your method quadratic_defect sits in the wrong class. (NumberField_quadratic) so it is not accessible in general. For example we can move it to NumberField_generic. 

```
+                    if w < u and w % 2 ==1:
+                        d = v+w
+                    if w == u and (f+F((a-1)/4)).is_irreducible():
+                        d = v+w
```
You sure this is correct ?(I did not fully check).

- the reference to kirschmers work should be a proper citation  in src/doc/en/reference/references

Could you explain why you consider the valuation more useful than the quadratic_defect itself?



---

archive/issue_comments_370486.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-27T16:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370486",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_370487.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-27T19:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370487",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370488.json:
```json
{
    "body": "<a id='comment:6'></a>Thanks for the helpful comments! I've done the following: \n* Updated the function in rational_field to use legendre_symbol() instead of quadratic_residue().  \n* I added Kirschmer's item to the reference list, and added a reference line to the documentation.  I've never done this before, perhaps up can see if I did it correctly? \n* I moved the number field version of the function to be in the class number_field_generic...I think.  Is this accomplished by just moving the function to where that class is defined?  Maybe you can check to see if I did that correctly. \n* The item you point out should be correct, this should be 63:3 and 63:5 from O'meara's book on quadratic forms. \n\nI am choosing to return a valuation since this is an easier object to deal with.  Moreover, this is also what is returned by the analogous function \"QuadraticDefect\" in magma (which I believe was implimented by Kirschmer). \n\n---\nNew commits:",
    "created_at": "2018-03-27T19:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370488",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:6'></a>Thanks for the helpful comments! I've done the following: 
* Updated the function in rational_field to use legendre_symbol() instead of quadratic_residue().  
* I added Kirschmer's item to the reference list, and added a reference line to the documentation.  I've never done this before, perhaps up can see if I did it correctly? 
* I moved the number field version of the function to be in the class number_field_generic...I think.  Is this accomplished by just moving the function to where that class is defined?  Maybe you can check to see if I did that correctly. 
* The item you point out should be correct, this should be 63:3 and 63:5 from O'meara's book on quadratic forms. 

I am choosing to return a valuation since this is an easier object to deal with.  Moreover, this is also what is returned by the analogous function "QuadraticDefect" in magma (which I believe was implimented by Kirschmer). 

---
New commits:



---

archive/issue_comments_370489.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-27T19:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370489",
    "user": "https://github.com/annahaensch"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_370490.json:
```json
{
    "body": "<a id='comment:9'></a>I did some cosmetic changes. Positive review if you are happy with what I have done.",
    "created_at": "2018-04-03T12:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370490",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:9'></a>I did some cosmetic changes. Positive review if you are happy with what I have done.



---

archive/issue_comments_370491.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-03T12:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370491",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370492.json:
```json
{
    "body": "<a id='comment:11'></a>I just added the official reference to the rational_field version of the function.  Now I am happy with it, and would be most pleased with a positive review. Thanks!",
    "created_at": "2018-04-03T12:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370492",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:11'></a>I just added the official reference to the rational_field version of the function.  Now I am happy with it, and would be most pleased with a positive review. Thanks!



---

archive/issue_comments_370493.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-03T12:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370493",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_370494.json:
```json
{
    "body": "<a id='comment:14'></a>a trivial addition REFERENCES:: --> REFERENCES:\n\n---\nNew commits:",
    "created_at": "2018-05-01T18:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370494",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:14'></a>a trivial addition REFERENCES:: --> REFERENCES:

---
New commits:



---

archive/issue_comments_370495.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-12T11:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25023#issuecomment-370495",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062763.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-12T11:47:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25023",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25023#event-62763"
}
```
