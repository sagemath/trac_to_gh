# Issue 25034: Special case for gen_legendre_P with n == m gives incorrect results for x in (-1,1)

archive/issues_024797.json:
```json
{
    "assignees": [],
    "body": "The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.\n\n---\n\n**Old Description**\n\nI am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`\nfrom `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre\nfunctions / Ferrers functions in SageMath 8.1.\n\nThere appears to be a discrepancy in the results I obtain, depending on whether\nI use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.\nI think this is because the `_eval_` method first tries to call the `_eval_special_values_`\nmethod, before using `eval_poly`.\n\nWith this input\n\n```\nx = SR.var('x')\nprint(gen_legendre_P.eval_poly(1, 1, x))\nprint(gen_legendre_P(1, 1, x))\nprint(gen_legendre_P.eval_poly(1, 1, 0.5))\nprint(gen_legendre_P(1, 1, 0.5))\n```\n\nI obtain\n\n```\n-sqrt(-x^2 + 1)\nsqrt(x^2 - 1)\n-0.866025403784439\n5.30287619362453e-17 + 0.866025403784439*I\n```\n\nThe result from eval_poly agrees with Mathematica, i.e.\n\n```\nLegendreP[1, 1, 0.5]\n-0.866025\n```\n\nBased on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].\n\nLooking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns\n\n```\nfactorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)\n```\n\nThis discrepancy also seems to be present in `spherical_harmonic` when\n`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),\nwhich is built using `gen_legendre_P`.\n\nAfter [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)\nin the sage-devel mailing list it appears that this is because the `n == m`\ncase in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,\nbut this is not defined in (-infinity,1].\n\nFor the spherical harmonics, where the argument x = cos(theta),\nx will always be in the range [-1, 1 ], where special case used\nin `_eval_special_values_` is not defined.\n\nOn the sage-devel mailing list, Howard Cohl suggested that\nthe correct formula for x in [-1, 1] is \n\n```\nP_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)\n```\n\nSee: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ\n\nAccording to Howard Cohl this is formally a Ferrers function\n(defined on (-1,1) ), rather than an associated Legendre polynomial.\nHowever, the existing code for Func_assoc_legendre_P does not\nseem to make any distinction between Ferrers and associated\nLegendre functions. \n\nMy proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).\n\nThis raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. \n\nIn my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of \"associated Legendre functions\", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.\n\nCC:  @rwst @slel @fredrik-johansson @tscrim\n\nComponent: **misc**\n\nKeywords: **legendre, special function, spherical harmonic**\n\nAuthor: **Michael Jung**\n\nBranch: **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)**\n\nReviewer: **Eric Gourgoulhon, Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25034_\n\n",
    "closed_at": "2021-04-25T12:14:14Z",
    "created_at": "2018-03-27T09:09:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Special case for gen_legendre_P with n == m gives incorrect results for x in (-1,1)",
    "type": "issue",
    "updated_at": "2021-04-26T15:00:02Z",
    "url": "https://github.com/sagemath/sage/issues/25034",
    "user": "https://github.com/sagetrac-jcwomack"
}
```
The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.

---

**Old Description**

I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`
from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre
functions / Ferrers functions in SageMath 8.1.

There appears to be a discrepancy in the results I obtain, depending on whether
I use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.
I think this is because the `_eval_` method first tries to call the `_eval_special_values_`
method, before using `eval_poly`.

With this input

```
x = SR.var('x')
print(gen_legendre_P.eval_poly(1, 1, x))
print(gen_legendre_P(1, 1, x))
print(gen_legendre_P.eval_poly(1, 1, 0.5))
print(gen_legendre_P(1, 1, 0.5))
```

I obtain

```
-sqrt(-x^2 + 1)
sqrt(x^2 - 1)
-0.866025403784439
5.30287619362453e-17 + 0.866025403784439*I
```

The result from eval_poly agrees with Mathematica, i.e.

```
LegendreP[1, 1, 0.5]
-0.866025
```

Based on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].

Looking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns

```
factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)
```

This discrepancy also seems to be present in `spherical_harmonic` when
`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),
which is built using `gen_legendre_P`.

After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)
in the sage-devel mailing list it appears that this is because the `n == m`
case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,
but this is not defined in (-infinity,1].

For the spherical harmonics, where the argument x = cos(theta),
x will always be in the range [-1, 1 ], where special case used
in `_eval_special_values_` is not defined.

On the sage-devel mailing list, Howard Cohl suggested that
the correct formula for x in [-1, 1] is 

```
P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)
```

See: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ

According to Howard Cohl this is formally a Ferrers function
(defined on (-1,1) ), rather than an associated Legendre polynomial.
However, the existing code for Func_assoc_legendre_P does not
seem to make any distinction between Ferrers and associated
Legendre functions. 

My proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).

This raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. 

In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of "associated Legendre functions", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.

CC:  @rwst @slel @fredrik-johansson @tscrim

Component: **misc**

Keywords: **legendre, special function, spherical harmonic**

Author: **Michael Jung**

Branch: **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)**

Reviewer: **Eric Gourgoulhon, Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/25034_





---

archive/issue_events_343243.json:
```json
{
    "actor": "https://github.com/sagetrac-jcwomack",
    "created_at": "2018-03-27T09:09:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343243"
}
```



---

archive/issue_events_343244.json:
```json
{
    "actor": "https://github.com/sagetrac-jcwomack",
    "created_at": "2018-03-27T09:09:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343244"
}
```



---

archive/issue_events_343245.json:
```json
{
    "actor": "https://github.com/sagetrac-jcwomack",
    "created_at": "2018-03-27T09:09:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343245"
}
```



---

archive/issue_comments_381302.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -42,7 +42,7 @@\n \n For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in `_eval_special_values_` is not defined.\n \n-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x < 1 is \n+On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is \n \n ```\n P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)\n``````\n",
    "created_at": "2018-03-28T08:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381302",
    "user": "https://github.com/sagetrac-jcwomack"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -42,7 +42,7 @@
 
 For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in `_eval_special_values_` is not defined.
 
-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x < 1 is 
+On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is 
 
 ```
 P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)
``````




---

archive/issue_comments_381303.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,11 @@\n-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P from sage/functions/orthogonal_polys.py) to evaluate associated Legendre functions / Ferrers functions in Sage Math 8.1.\n+I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P\n+from sage/functions/orthogonal_polys.py) to evaluate associated Legendre\n+functions / Ferrers functions in SageMath 8.1.\n \n-There appears to be a discrepancy in the results I obtain, depending on whether I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases. I think this is because the `_eval_` method first tries to call the `_eval_special_values_` method, before using eval_poly.\n+There appears to be a discrepancy in the results I obtain, depending on whether\n+I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.\n+I think this is because the `_eval_` method first tries to call the `_eval_special_values_`\n+method, before using eval_poly.\n \n With this input\n \n@@ -36,13 +41,21 @@\n factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)\n ```\n \n-This discrepancy also seems to be present in spherical_harmonic when n == m (an instance of SphericalHarmonic from sage/functions/special.py), which is built using gen_legendre_P.\n+This discrepancy also seems to be present in spherical_harmonic when\n+n == m (an instance of SphericalHarmonic from sage/functions/special.py),\n+which is built using gen_legendre_P.\n \n-After discussion in the sage-devel mailing list (https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ) it appears that this is because the n == m case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15, but this is not defined in (-infinity,1].\n+After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)\n+in the sage-devel mailing list it appears that this is because the n == m\n+case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,\n+but this is not defined in (-infinity,1].\n \n-For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in `_eval_special_values_` is not defined.\n+For the spherical harmonics, where the argument x = cos(theta),\n+x will always be in the range [-1, 1 ], where special case used\n+in `_eval_special_values_` is not defined.\n \n-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is \n+On the sage-devel mailing list, Howard Cohl suggested that\n+the correct formula for x in [-1, 1] is \n \n ```\n P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)\n@@ -50,7 +63,11 @@\n \n See: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ\n \n-According to Howard Cohl this is formally a Ferrers function (defined on (-1,1) ), rather than an associated Legendre polynomial. However, the existing code for Func_assoc_legendre_P does not seem to make any distinction between Ferrers and associated Legendre functions. \n+According to Howard Cohl this is formally a Ferrers function\n+(defined on (-1,1) ), rather than an associated Legendre polynomial.\n+However, the existing code for Func_assoc_legendre_P does not\n+seem to make any distinction between Ferrers and associated\n+Legendre functions. \n \n My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).\n \n``````\n",
    "created_at": "2018-04-04T13:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381303",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,11 @@
-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P from sage/functions/orthogonal_polys.py) to evaluate associated Legendre functions / Ferrers functions in Sage Math 8.1.
+I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P
+from sage/functions/orthogonal_polys.py) to evaluate associated Legendre
+functions / Ferrers functions in SageMath 8.1.
 
-There appears to be a discrepancy in the results I obtain, depending on whether I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases. I think this is because the `_eval_` method first tries to call the `_eval_special_values_` method, before using eval_poly.
+There appears to be a discrepancy in the results I obtain, depending on whether
+I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.
+I think this is because the `_eval_` method first tries to call the `_eval_special_values_`
+method, before using eval_poly.
 
 With this input
 
@@ -36,13 +41,21 @@
 factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)
 ```
 
-This discrepancy also seems to be present in spherical_harmonic when n == m (an instance of SphericalHarmonic from sage/functions/special.py), which is built using gen_legendre_P.
+This discrepancy also seems to be present in spherical_harmonic when
+n == m (an instance of SphericalHarmonic from sage/functions/special.py),
+which is built using gen_legendre_P.
 
-After discussion in the sage-devel mailing list (https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ) it appears that this is because the n == m case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15, but this is not defined in (-infinity,1].
+After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)
+in the sage-devel mailing list it appears that this is because the n == m
+case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,
+but this is not defined in (-infinity,1].
 
-For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in `_eval_special_values_` is not defined.
+For the spherical harmonics, where the argument x = cos(theta),
+x will always be in the range [-1, 1 ], where special case used
+in `_eval_special_values_` is not defined.
 
-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is 
+On the sage-devel mailing list, Howard Cohl suggested that
+the correct formula for x in [-1, 1] is 
 
 ```
 P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)
@@ -50,7 +63,11 @@
 
 See: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ
 
-According to Howard Cohl this is formally a Ferrers function (defined on (-1,1) ), rather than an associated Legendre polynomial. However, the existing code for Func_assoc_legendre_P does not seem to make any distinction between Ferrers and associated Legendre functions. 
+According to Howard Cohl this is formally a Ferrers function
+(defined on (-1,1) ), rather than an associated Legendre polynomial.
+However, the existing code for Func_assoc_legendre_P does not
+seem to make any distinction between Ferrers and associated
+Legendre functions. 
 
 My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).
 
``````




---

archive/issue_comments_381304.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nA (quite severe IMHO) consequence of this bug is\n\n```\nsage: theta, phi = var('theta phi')\nsage: spherical_harmonic(1, 1, theta, phi)\n-1/4*sqrt(3)*sqrt(2)*sqrt(cos(theta)^2 - 1)*e^(I*phi)/sqrt(pi)\n```\nwhich is plain wrong: the term `sqrt(cos(theta)^2-1)` (which is imaginary for `theta` real) should actually be `sin(theta)`.",
    "created_at": "2018-04-08T16:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381304",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:3" align="right">comment:3</div>

A (quite severe IMHO) consequence of this bug is

```
sage: theta, phi = var('theta phi')
sage: spherical_harmonic(1, 1, theta, phi)
-1/4*sqrt(3)*sqrt(2)*sqrt(cos(theta)^2 - 1)*e^(I*phi)/sqrt(pi)
```
which is plain wrong: the term `sqrt(cos(theta)^2-1)` (which is imaginary for `theta` real) should actually be `sin(theta)`.



---

archive/issue_comments_381305.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFor reference, here are some related issues reported by users:\n- https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ\n- https://ask.sagemath.org/question/49694\n- https://ask.sagemath.org/question/48776",
    "created_at": "2020-01-28T14:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381305",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:4" align="right">comment:4</div>

For reference, here are some related issues reported by users:
- https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ
- https://ask.sagemath.org/question/49694
- https://ask.sagemath.org/question/48776



---

archive/issue_comments_381306.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@egourgoulhon](#comment%3A4):\n> For reference, here are some related issues reported by users:\n> - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ\n> - https://ask.sagemath.org/question/49694\n> - https://ask.sagemath.org/question/48776\n\nOne more:\n- https://ask.sagemath.org/question/49891/",
    "created_at": "2020-02-12T20:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381306",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@egourgoulhon](#comment%3A4):
> For reference, here are some related issues reported by users:
> - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ
> - https://ask.sagemath.org/question/49694
> - https://ask.sagemath.org/question/48776

One more:
- https://ask.sagemath.org/question/49891/



---

archive/issue_comments_381307.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> > For reference, here are some related issues reported by users:\n> > - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ\n> > - https://ask.sagemath.org/question/49694\n> > - https://ask.sagemath.org/question/48776\n\n> \n> One more:\n> - https://ask.sagemath.org/question/49891/\n\nYet one more:\n- https://ask.sagemath.org/question/51994/",
    "created_at": "2020-06-15T15:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381307",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:6" align="right">comment:6</div>

> > For reference, here are some related issues reported by users:
> > - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ
> > - https://ask.sagemath.org/question/49694
> > - https://ask.sagemath.org/question/48776

> 
> One more:
> - https://ask.sagemath.org/question/49891/

Yet one more:
- https://ask.sagemath.org/question/51994/



---

archive/issue_comments_381308.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,20 +1,20 @@\n-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P\n-from sage/functions/orthogonal_polys.py) to evaluate associated Legendre\n+I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`\n+from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre\n functions / Ferrers functions in SageMath 8.1.\n \n There appears to be a discrepancy in the results I obtain, depending on whether\n-I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.\n+I use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.\n I think this is because the `_eval_` method first tries to call the `_eval_special_values_`\n-method, before using eval_poly.\n+method, before using `eval_poly`.\n \n With this input\n \n ```\n x = SR.var('x')\n-print gen_legendre_P.eval_poly(1,1,x)\n-print gen_legendre_P(1,1,x)\n-print gen_legendre_P.eval_poly(1,1,0.5)\n-print gen_legendre_P(1,1,0.5)\n+print(gen_legendre_P.eval_poly(1, 1, x))\n+print(gen_legendre_P(1, 1, x))\n+print(gen_legendre_P.eval_poly(1, 1, 0.5))\n+print(gen_legendre_P(1, 1, 0.5))\n ```\n \n I obtain\n@@ -33,20 +33,20 @@\n -0.866025\n ```\n \n-Based on the above output, it seems to me that gen_legendre_P.eval_poly(1,1,cos(theta)) will always be real while gen_legendre_P(1,1,cos(theta)) will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].\n+Based on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].\n \n-Looking at the code for Func_assoc_legendre_P._eval_special_values_, I suspect the culprit is the n == m case, which returns\n+Looking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns\n \n ```\n factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)\n ```\n \n-This discrepancy also seems to be present in spherical_harmonic when\n-n == m (an instance of SphericalHarmonic from sage/functions/special.py),\n-which is built using gen_legendre_P.\n+This discrepancy also seems to be present in `spherical_harmonic` when\n+`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),\n+which is built using `gen_legendre_P`.\n \n After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)\n-in the sage-devel mailing list it appears that this is because the n == m\n+in the sage-devel mailing list it appears that this is because the `n == m`\n case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,\n but this is not defined in (-infinity,1].\n \n@@ -69,8 +69,8 @@\n seem to make any distinction between Ferrers and associated\n Legendre functions. \n \n-My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).\n+My proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).\n \n-This raises the question of whether Func_assoc_legendre_P is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. \n+This raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. \n \n-In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of \"associated Legendre functions\", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for Func_assoc_legendre_P that the class seems to cover both functions.\n+In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of \"associated Legendre functions\", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.\n``````\n",
    "created_at": "2020-06-15T23:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381308",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,20 +1,20 @@
-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P
-from sage/functions/orthogonal_polys.py) to evaluate associated Legendre
+I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`
+from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre
 functions / Ferrers functions in SageMath 8.1.
 
 There appears to be a discrepancy in the results I obtain, depending on whether
-I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.
+I use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.
 I think this is because the `_eval_` method first tries to call the `_eval_special_values_`
-method, before using eval_poly.
+method, before using `eval_poly`.
 
 With this input
 
 ```
 x = SR.var('x')
-print gen_legendre_P.eval_poly(1,1,x)
-print gen_legendre_P(1,1,x)
-print gen_legendre_P.eval_poly(1,1,0.5)
-print gen_legendre_P(1,1,0.5)
+print(gen_legendre_P.eval_poly(1, 1, x))
+print(gen_legendre_P(1, 1, x))
+print(gen_legendre_P.eval_poly(1, 1, 0.5))
+print(gen_legendre_P(1, 1, 0.5))
 ```
 
 I obtain
@@ -33,20 +33,20 @@
 -0.866025
 ```
 
-Based on the above output, it seems to me that gen_legendre_P.eval_poly(1,1,cos(theta)) will always be real while gen_legendre_P(1,1,cos(theta)) will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].
+Based on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].
 
-Looking at the code for Func_assoc_legendre_P._eval_special_values_, I suspect the culprit is the n == m case, which returns
+Looking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns
 
 ```
 factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)
 ```
 
-This discrepancy also seems to be present in spherical_harmonic when
-n == m (an instance of SphericalHarmonic from sage/functions/special.py),
-which is built using gen_legendre_P.
+This discrepancy also seems to be present in `spherical_harmonic` when
+`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),
+which is built using `gen_legendre_P`.
 
 After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)
-in the sage-devel mailing list it appears that this is because the n == m
+in the sage-devel mailing list it appears that this is because the `n == m`
 case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,
 but this is not defined in (-infinity,1].
 
@@ -69,8 +69,8 @@
 seem to make any distinction between Ferrers and associated
 Legendre functions. 
 
-My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).
+My proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).
 
-This raises the question of whether Func_assoc_legendre_P is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. 
+This raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. 
 
-In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of "associated Legendre functions", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for Func_assoc_legendre_P that the class seems to cover both functions.
+In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of "associated Legendre functions", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.
``````




---

archive/issue_events_343246.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-06-15T23:11:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343246"
}
```



---

archive/issue_events_343247.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-06-15T23:11:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343247"
}
```



---

archive/issue_events_343248.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343248"
}
```



---

archive/issue_events_343249.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343249"
}
```



---

archive/issue_events_343250.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-08T21:40:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343250"
}
```



---

archive/issue_events_343251.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-08T21:40:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343251"
}
```



---

archive/issue_comments_381309.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSince this features is obviously highly demanded, and within two years not resolved, I took the freedom to shift it's priority to \"critical\".",
    "created_at": "2021-04-08T21:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381309",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:9" align="right">comment:9</div>

Since this features is obviously highly demanded, and within two years not resolved, I took the freedom to shift it's priority to "critical".



---

archive/issue_comments_381310.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWhat about separately adding `Func_ferrers` to the library with the appropriate convention then?\n\nOne can easily refer to https://dlmf.nist.gov/14.7#E8 and https://dlmf.nist.gov/14.7#E14 respectively and clarify the convention.\n\nAlso, I found a nice stackexchange post explaining the origin of this difference: https://math.stackexchange.com/a/2986444",
    "created_at": "2021-04-09T21:06:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381310",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:11" align="right">comment:11</div>

What about separately adding `Func_ferrers` to the library with the appropriate convention then?

One can easily refer to https://dlmf.nist.gov/14.7#E8 and https://dlmf.nist.gov/14.7#E14 respectively and clarify the convention.

Also, I found a nice stackexchange post explaining the origin of this difference: https://math.stackexchange.com/a/2986444



---

archive/issue_comments_381311.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI already worked on something. Will push tomorrow.",
    "created_at": "2021-04-10T00:25:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381311",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:12" align="right">comment:12</div>

I already worked on something. Will push tomorrow.



---

archive/issue_comments_381312.json:
```json
{
    "body": "Branch: **[public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)**",
    "created_at": "2021-04-10T09:43:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381312",
    "user": "https://github.com/mjungmath"
}
```

Branch: **[public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)**



---

archive/issue_comments_381313.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/568d0fa7113b39833c3cc93ddc7629bf491f59ec\"><code>568d0fa</code></a></td><td><code>Trac #25034: follow mathematica convention on legendre polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d6ead15155270684b310d099f8ecd3cd9848ca7\"><code>6d6ead1</code></a></td><td><code>Trac #25034: doctest for spherical harmonics added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14\"><code>571632f</code></a></td><td><code>Trac #25034: doctest further improved</code></td></tr></table>\n",
    "created_at": "2021-04-10T10:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381313",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/568d0fa7113b39833c3cc93ddc7629bf491f59ec"><code>568d0fa</code></a></td><td><code>Trac #25034: follow mathematica convention on legendre polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d6ead15155270684b310d099f8ecd3cd9848ca7"><code>6d6ead1</code></a></td><td><code>Trac #25034: doctest for spherical harmonics added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14"><code>571632f</code></a></td><td><code>Trac #25034: doctest further improved</code></td></tr></table>




---

archive/issue_comments_381314.json:
```json
{
    "body": "Commit: **[`571632f`](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)**",
    "created_at": "2021-04-10T10:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381314",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`571632f`](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)**



---

archive/issue_comments_381315.json:
```json
{
    "body": "Changed commit from **[`571632f`](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)** to **[`4fcc574`](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)**",
    "created_at": "2021-04-10T12:01:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381315",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`571632f`](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)** to **[`4fcc574`](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)**



---

archive/issue_comments_381316.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3\"><code>4fcc574</code></a></td><td><code>Trac #25034: formula for n=m fixed</code></td></tr></table>\n",
    "created_at": "2021-04-10T12:01:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381316",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3"><code>4fcc574</code></a></td><td><code>Trac #25034: formula for n=m fixed</code></td></tr></table>




---

archive/issue_comments_381317.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI have uploaded a proposal. Please let me know in case I have missed any details.\n\n**What have I done?**\n\n- The main modification is as proposed:\n\n   ```diff\n            if m == 0:\n                return legendre_P(n, x)\n            if n == m:\n   -            return (-1)**m*(1-x**2)**(m/2) * ZZ(2*m-1).multifactorial(2)\n   +            return (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)\n   ```\n\n- Furthermore I have added the feature of negative `m` which wasn't there yet.\n- The special case `m+1=n` has been added.\n\nYou are invited to contribute more doctests, especially for spherical harmonics. So far, I have only collected some of the code snippets posted above that have not worked. They are working now.\n\n**Follow-Ups**\n\n- As for resolving convention conflicts, I propose to wrap this up in a follow-up ticket (#31637).\n\n- Moreover, imho the documentation for orthogonal polynomials is a mess and urgently needs to be cleaned up. I suggest to attack this in another follow-up ticket (#31636).",
    "created_at": "2021-04-10T12:01:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381317",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:16" align="right">comment:16</div>

I have uploaded a proposal. Please let me know in case I have missed any details.

**What have I done?**

- The main modification is as proposed:

   ```diff
            if m == 0:
                return legendre_P(n, x)
            if n == m:
   -            return (-1)**m*(1-x**2)**(m/2) * ZZ(2*m-1).multifactorial(2)
   +            return (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)
   ```

- Furthermore I have added the feature of negative `m` which wasn't there yet.
- The special case `m+1=n` has been added.

You are invited to contribute more doctests, especially for spherical harmonics. So far, I have only collected some of the code snippets posted above that have not worked. They are working now.

**Follow-Ups**

- As for resolving convention conflicts, I propose to wrap this up in a follow-up ticket (#31637).

- Moreover, imho the documentation for orthogonal polynomials is a mess and urgently needs to be cleaned up. I suggest to attack this in another follow-up ticket (#31636).



---

archive/issue_comments_381318.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThank you so much for tackling this! \n\nShall the ticket be set to needs_review? (in order to draw it to the patchbots' attention)",
    "created_at": "2021-04-10T12:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381318",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:17" align="right">comment:17</div>

Thank you so much for tackling this! 

Shall the ticket be set to needs_review? (in order to draw it to the patchbots' attention)



---

archive/issue_comments_381319.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@egourgoulhon](#comment%3A17):\n> Thank you so much for tackling this! \n> \n> Shall the ticket be set to needs_review? (in order to get the attention of the patchbots)\n\nWould you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.",
    "created_at": "2021-04-10T12:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381319",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@egourgoulhon](#comment%3A17):
> Thank you so much for tackling this! 
> 
> Shall the ticket be set to needs_review? (in order to get the attention of the patchbots)

Would you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.



---

archive/issue_comments_381320.json:
```json
{
    "body": "Author: **Michael Jung**",
    "created_at": "2021-04-10T12:13:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381320",
    "user": "https://github.com/mjungmath"
}
```

Author: **Michael Jung**



---

archive/issue_comments_381321.json:
```json
{
    "body": "Changed commit from **[`4fcc574`](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)** to **[`a4edb24`](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)**",
    "created_at": "2021-04-10T14:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381321",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4fcc574`](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)** to **[`a4edb24`](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)**



---

archive/issue_comments_381322.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0\"><code>a4edb24</code></a></td><td><code>Trac #25034: abs(m) exceeding n gives zero immediately</code></td></tr></table>\n",
    "created_at": "2021-04-10T14:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381322",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0"><code>a4edb24</code></a></td><td><code>Trac #25034: abs(m) exceeding n gives zero immediately</code></td></tr></table>




---

archive/issue_events_343252.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-10T15:22:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343252"
}
```



---

archive/issue_comments_381323.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@mjungmath](#comment%3A18):\n> Would you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.\n\nAlright, technically speaking spherical harmonics do not belong to this ticket. Let's finish this one first before messing with spherical harmonics. I created a follow-up: #31639.",
    "created_at": "2021-04-10T15:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381323",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@mjungmath](#comment%3A18):
> Would you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.

Alright, technically speaking spherical harmonics do not belong to this ticket. Let's finish this one first before messing with spherical harmonics. I created a follow-up: #31639.



---

archive/issue_comments_381324.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nPatchbot is green at least.",
    "created_at": "2021-04-10T20:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381324",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:22" align="right">comment:22</div>

Patchbot is green at least.



---

archive/issue_comments_381325.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThe order in which you perform tests is important. Here:\n\n```\nif n in ZZ and m in ZZ and (x in ZZ or not SR(x).is_numeric()) and n >= 0:\n```\nyou should have the `n >= 0` before the `x` tests as it is quicker.\n\nI am also not sure about doing the multiplication first in the quotient here:\n\n```\nreturn (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)\n```\nI feel like \n\n```\n(-1)**m * factorial(2*m)/factorial(m)/2**m * (1-x**2)**(m/2)\n```\nshould give better performance since we know the first division is exact. (I really would prefer `//`, but that won't work if `m` is a symbolic variable unfortunately...)\n\nAlso, a while-we-are-at-it:\n\n```diff\n-return ZZ(0)\n+return ZZ.zero()\n```\n\nI probably would also be good to add support for negative `n` by replacing it with `-n-1`. This will get rid of the error for `gen_legendre_P(-2,-2,x)`.\n\nI don't understand why you feed this back through the full evaluation instead of this:\n\n```diff\n-return x*(2*m+1)*gen_legendre_P(m, m, x)\n+return x * (2*m+1) * self._eval_special_values_(m, m, x)\n```\n\nA small tweak in the language:\n\n```diff\n-Print the first associated Legendre polynomials::\n+We give the first associated Legendre polynomials::\n```\nI would also add a space around the `=` to make it easier to read the output.\n\nPlease put the `REFERENCES:` at the end of the docstring (and add the `S`).",
    "created_at": "2021-04-10T22:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381325",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

The order in which you perform tests is important. Here:

```
if n in ZZ and m in ZZ and (x in ZZ or not SR(x).is_numeric()) and n >= 0:
```
you should have the `n >= 0` before the `x` tests as it is quicker.

I am also not sure about doing the multiplication first in the quotient here:

```
return (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)
```
I feel like 

```
(-1)**m * factorial(2*m)/factorial(m)/2**m * (1-x**2)**(m/2)
```
should give better performance since we know the first division is exact. (I really would prefer `//`, but that won't work if `m` is a symbolic variable unfortunately...)

Also, a while-we-are-at-it:

```diff
-return ZZ(0)
+return ZZ.zero()
```

I probably would also be good to add support for negative `n` by replacing it with `-n-1`. This will get rid of the error for `gen_legendre_P(-2,-2,x)`.

I don't understand why you feed this back through the full evaluation instead of this:

```diff
-return x*(2*m+1)*gen_legendre_P(m, m, x)
+return x * (2*m+1) * self._eval_special_values_(m, m, x)
```

A small tweak in the language:

```diff
-Print the first associated Legendre polynomials::
+We give the first associated Legendre polynomials::
```
I would also add a space around the `=` to make it easier to read the output.

Please put the `REFERENCES:` at the end of the docstring (and add the `S`).



---

archive/issue_comments_381326.json:
```json
{
    "body": "Changed commit from **[`a4edb24`](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)** to **[`6b365d7`](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)**",
    "created_at": "2021-04-11T11:20:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381326",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a4edb24`](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)** to **[`6b365d7`](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)**



---

archive/issue_comments_381327.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c532a1067695bc81fd7aba14615a7462ef9bf06\"><code>7c532a1</code></a></td><td><code>Trac #25034: minor improvements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9\"><code>6b365d7</code></a></td><td><code>Trac #25034: slight refactoring of _eval_</code></td></tr></table>\n",
    "created_at": "2021-04-11T11:20:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381327",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c532a1067695bc81fd7aba14615a7462ef9bf06"><code>7c532a1</code></a></td><td><code>Trac #25034: minor improvements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9"><code>6b365d7</code></a></td><td><code>Trac #25034: slight refactoring of _eval_</code></td></tr></table>




---

archive/issue_comments_381328.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThank you Travis for the feedback! I hope I took everything in account now. In addition, I refactored `_eval_` a bit and completely removed `_eval_special_values_`. Please check this out.",
    "created_at": "2021-04-11T11:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381328",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:25" align="right">comment:25</div>

Thank you Travis for the feedback! I hope I took everything in account now. In addition, I refactored `_eval_` a bit and completely removed `_eval_special_values_`. Please check this out.



---

archive/issue_comments_381329.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI know that this is not absolutely precise at the moment. But at least this implementation is more or less consistent and makes spherical harmonics work properly. More elaborate thoughts to resolve this are very much appreciated in #31637.",
    "created_at": "2021-04-11T11:31:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381329",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:26" align="right">comment:26</div>

I know that this is not absolutely precise at the moment. But at least this implementation is more or less consistent and makes spherical harmonics work properly. More elaborate thoughts to resolve this are very much appreciated in #31637.



---

archive/issue_comments_381330.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nPatchbot green again.",
    "created_at": "2021-04-11T14:20:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381330",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:27" align="right">comment:27</div>

Patchbot green again.



---

archive/issue_comments_381331.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI am -1 on removing `_eval_special_values_` as it has a clear purpose and is useful for future maintenance by having a more logical grouping of the code.",
    "created_at": "2021-04-11T22:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381331",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

I am -1 on removing `_eval_special_values_` as it has a clear purpose and is useful for future maintenance by having a more logical grouping of the code.



---

archive/issue_comments_381332.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nNow it is grouped into \"integer\" and \"non-integer\" case. Unfortunately, this didn't work well with `_eval_special_values_` because it would lead to many repeated if-statements. This is the most concise pattern I could think of. Do you have another idea?\n\nMoreover, the `x == 0` case seemingly didn't make sense for `_evalf_`. Please correct me if I am wrong here.",
    "created_at": "2021-04-11T23:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381332",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:29" align="right">comment:29</div>

Now it is grouped into "integer" and "non-integer" case. Unfortunately, this didn't work well with `_eval_special_values_` because it would lead to many repeated if-statements. This is the most concise pattern I could think of. Do you have another idea?

Moreover, the `x == 0` case seemingly didn't make sense for `_evalf_`. Please correct me if I am wrong here.



---

archive/issue_comments_381333.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI thought the previous version was fine. I don't like forcing it all together, as opposed to what many other functions do. I also don't really think the `SR(x).is_numeric()` test being run so frequently is good.\n\nAdditionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.",
    "created_at": "2021-04-12T01:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381333",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

I thought the previous version was fine. I don't like forcing it all together, as opposed to what many other functions do. I also don't really think the `SR(x).is_numeric()` test being run so frequently is good.

Additionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.



---

archive/issue_comments_381334.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@tscrim](#comment%3A30):\n> Additionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.\n\nTrue. However, this particular formula holds indeed if `m` and `n` are integers. But I am not sure whether this extends accordingly to arbitrary `m` and `n` using Gamma functions...\n\nPlaying around with the numeric tool, it turned out that the case `abs(m) > n` only yields zero for the integer case (try for example `gen_legendre_P(2.,3.*I,.5)`).\n\nGrouping it the same way as before would therefore lead to many redundant if-statements, as said above. I don't think this is desirable either.",
    "created_at": "2021-04-12T08:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381334",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@tscrim](#comment%3A30):
> Additionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.

True. However, this particular formula holds indeed if `m` and `n` are integers. But I am not sure whether this extends accordingly to arbitrary `m` and `n` using Gamma functions...

Playing around with the numeric tool, it turned out that the case `abs(m) > n` only yields zero for the integer case (try for example `gen_legendre_P(2.,3.*I,.5)`).

Grouping it the same way as before would therefore lead to many redundant if-statements, as said above. I don't think this is desirable either.



---

archive/issue_comments_381335.json:
```json
{
    "body": "Changed commit from **[`6b365d7`](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)** to **[`801298c`](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)**",
    "created_at": "2021-04-12T10:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381335",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6b365d7`](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)** to **[`801298c`](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)**



---

archive/issue_comments_381336.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7\"><code>801298c</code></a></td><td><code>Trac #25034: allow negative n</code></td></tr></table>\n",
    "created_at": "2021-04-12T10:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381336",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7"><code>801298c</code></a></td><td><code>Trac #25034: allow negative n</code></td></tr></table>




---

archive/issue_comments_381337.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nWhat about this?",
    "created_at": "2021-04-12T10:31:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381337",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:33" align="right">comment:33</div>

What about this?



---

archive/issue_comments_381338.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAt least the patchbot likes it. This version is very close to the version before, but now with negative `n`. This is still not optimal but I think more preciseness should be elaborated in the follow-up ticket.\n\nWhat do you think?",
    "created_at": "2021-04-13T11:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381338",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:34" align="right">comment:34</div>

At least the patchbot likes it. This version is very close to the version before, but now with negative `n`. This is still not optimal but I think more preciseness should be elaborated in the follow-up ticket.

What do you think?



---

archive/issue_comments_381339.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI think this is a lot better.\n\nThis is a bit cumbersome way of saying \"let m be a positive integer\":\n\n```\n+    For `n` being a non-negative integer, negative integer values for `m`\n+    with `|m| \\leq n` can be obtained by:\n+\n+    .. MATH::\n+\n+            P^{-|m|}_n(x) = (-1)^{|m|} \\frac{(n-|m|)!}{(n+|m|)!} P_n^{|m|}(x).\n```\n\nI am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?\n\nI think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.",
    "created_at": "2021-04-14T01:06:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381339",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

I think this is a lot better.

This is a bit cumbersome way of saying "let m be a positive integer":

```
+    For `n` being a non-negative integer, negative integer values for `m`
+    with `|m| \leq n` can be obtained by:
+
+    .. MATH::
+
+            P^{-|m|}_n(x) = (-1)^{|m|} \frac{(n-|m|)!}{(n+|m|)!} P_n^{|m|}(x).
```

I am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?

I think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.



---

archive/issue_comments_381340.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@tscrim](#comment%3A35):\n> I am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?\n\nI think it is reasonable to assume that `mpmath` already uses optimized algorithms, isn't it? Moreover, without the above patch we have something like that:\n\n```\nsage: %%time \n....: gen_legendre_P(1.2,1.1,0)\nCPU times: user 2.78 ms, sys: 0 ns, total: 2.78 ms\nWall time: 2.8 ms\n2.14354692507259*cos(1.15000000000000*pi)*gamma(33/20)/(sqrt(pi)*gamma(749113601384401/713441525128001))\n```\n\nwhich already looks clunky. Moreover if we want the answer in terms of floating numbers, we get:\n\n```\nsage: %%time \n....: gen_legendre_P(1.2,1.1,0).n()\nCPU times: user 166 ms, sys: 7.01 ms, total: 173 ms\nWall time: 204 ms\n-0.996322549249593\n```\n\nwhereas compared to with patch:\n\n```\nsage: %%time \n....: gen_legendre_P(1.2,1.1,0)\nCPU times: user 302 \u00b5s, sys: 20 \u00b5s, total: 322 \u00b5s\nWall time: 326 \u00b5s\n-0.996322549249593\n```\n\nFor the case `m=n` however, the `mpmath` version seems to be slightly slower than evaluating the special case (now everything with the new patch):\n\n```\nsage: %%time \n....: gen_legendre_P._evalf_(1,1,.2)\nCPU times: user 1.29 ms, sys: 0 ns, total: 1.29 ms\nWall time: 1.29 ms\n-0.979795897113271\nsage: %%time \n....: gen_legendre_P._eval_special_values_(1,1,.2)\nCPU times: user 124 \u00b5s, sys: 0 ns, total: 124 \u00b5s\nWall time: 127 \u00b5s\n-0.979795897113271\n```\n\nBut treading these cases differently would dismantle `_eval_special_values_` again.\n\n> \n> I think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.\n\nI'll do.",
    "created_at": "2021-04-14T10:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381340",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@tscrim](#comment%3A35):
> I am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?

I think it is reasonable to assume that `mpmath` already uses optimized algorithms, isn't it? Moreover, without the above patch we have something like that:

```
sage: %%time 
....: gen_legendre_P(1.2,1.1,0)
CPU times: user 2.78 ms, sys: 0 ns, total: 2.78 ms
Wall time: 2.8 ms
2.14354692507259*cos(1.15000000000000*pi)*gamma(33/20)/(sqrt(pi)*gamma(749113601384401/713441525128001))
```

which already looks clunky. Moreover if we want the answer in terms of floating numbers, we get:

```
sage: %%time 
....: gen_legendre_P(1.2,1.1,0).n()
CPU times: user 166 ms, sys: 7.01 ms, total: 173 ms
Wall time: 204 ms
-0.996322549249593
```

whereas compared to with patch:

```
sage: %%time 
....: gen_legendre_P(1.2,1.1,0)
CPU times: user 302 s, sys: 20 s, total: 322 s
Wall time: 326 s
-0.996322549249593
```

For the case `m=n` however, the `mpmath` version seems to be slightly slower than evaluating the special case (now everything with the new patch):

```
sage: %%time 
....: gen_legendre_P._evalf_(1,1,.2)
CPU times: user 1.29 ms, sys: 0 ns, total: 1.29 ms
Wall time: 1.29 ms
-0.979795897113271
sage: %%time 
....: gen_legendre_P._eval_special_values_(1,1,.2)
CPU times: user 124 s, sys: 0 ns, total: 124 s
Wall time: 127 s
-0.979795897113271
```

But treading these cases differently would dismantle `_eval_special_values_` again.

> 
> I think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.

I'll do.



---

archive/issue_comments_381341.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,9 @@\n+The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.\n+\n+---\n+\n+**Old Description**\n+\n I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`\n from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre\n functions / Ferrers functions in SageMath 8.1.\n``````\n",
    "created_at": "2021-04-14T21:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381341",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,9 @@
+The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.
+
+---
+
+**Old Description**
+
 I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`
 from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre
 functions / Ferrers functions in SageMath 8.1.
``````




---

archive/issue_events_343253.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-14T21:20:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343253"
}
```



---

archive/issue_events_343254.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-14T21:20:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343254"
}
```



---

archive/issue_comments_381342.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nWe need to also be more careful if the type of the output is changing as this can break other code in the wild. It might be good to see how other special functions behave for different inputs to make sure things match if we are going to change stuff.",
    "created_at": "2021-04-15T07:23:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381342",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

We need to also be more careful if the type of the output is changing as this can break other code in the wild. It might be good to see how other special functions behave for different inputs to make sure things match if we are going to change stuff.



---

archive/issue_comments_381343.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e\"><code>0b7d917</code></a></td><td><code>Trac #25034: Turn gen_legendre_P into Ferrers functions only</code></td></tr></table>\n",
    "created_at": "2021-04-17T13:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381343",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e"><code>0b7d917</code></a></td><td><code>Trac #25034: Turn gen_legendre_P into Ferrers functions only</code></td></tr></table>




---

archive/issue_comments_381344.json:
```json
{
    "body": "Changed commit from **[`801298c`](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)** to **[`0b7d917`](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)**",
    "created_at": "2021-04-17T13:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381344",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`801298c`](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)** to **[`0b7d917`](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)**



---

archive/issue_events_343255.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-17T13:47:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343255"
}
```



---

archive/issue_events_343256.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-17T13:47:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343256"
}
```



---

archive/issue_comments_381345.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI had a little chat with Howard Cohl. He said that one has to be *extremely* careful which formula goes under what condition. In particular, one shouldn't use formulas for cases that are not stated in https://dlmf.nist.gov/14.\n\nSo I tried to be very careful and always referred to the corresponding formula in the code. But please double check that for me.\n\nOther than that, this is ready for review again.",
    "created_at": "2021-04-17T13:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381345",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:41" align="right">comment:41</div>

I had a little chat with Howard Cohl. He said that one has to be *extremely* careful which formula goes under what condition. In particular, one shouldn't use formulas for cases that are not stated in https://dlmf.nist.gov/14.

So I tried to be very careful and always referred to the corresponding formula in the code. But please double check that for me.

Other than that, this is ready for review again.



---

archive/issue_comments_381346.json:
```json
{
    "body": "Changed commit from **[`0b7d917`](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)** to **[`d203066`](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)**",
    "created_at": "2021-04-17T13:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381346",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b7d917`](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)** to **[`d203066`](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)**



---

archive/issue_comments_381347.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505\"><code>d203066</code></a></td><td><code>Trac #25034: wrong indent in docstring</code></td></tr></table>\n",
    "created_at": "2021-04-17T13:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381347",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505"><code>d203066</code></a></td><td><code>Trac #25034: wrong indent in docstring</code></td></tr></table>




---

archive/issue_comments_381348.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThanks for this work! It's nice that you made references to the DLMF for formulas in the code.\n\nIn the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for\n\n```\n        sage: gen_legendre_P(-5/3,3,1.+I)\n        0.238163715352606 + 0.0548443903534220*I\n```\nin the docstring of `Func_assoc_legendre_P`.",
    "created_at": "2021-04-17T16:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381348",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:43" align="right">comment:43</div>

Thanks for this work! It's nice that you made references to the DLMF for formulas in the code.

In the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for

```
        sage: gen_legendre_P(-5/3,3,1.+I)
        0.238163715352606 + 0.0548443903534220*I
```
in the docstring of `Func_assoc_legendre_P`.



---

archive/issue_comments_381349.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@egourgoulhon](#comment%3A43):\n> In the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for\n> \n> ```\n>         sage: gen_legendre_P(-5/3,3,1.+I)\n>         0.238163715352606 + 0.0548443903534220*I\n> ```\n> in the docstring of `Func_assoc_legendre_P`.\n\nDone.",
    "created_at": "2021-04-17T16:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381349",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@egourgoulhon](#comment%3A43):
> In the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for
> 
> ```
>         sage: gen_legendre_P(-5/3,3,1.+I)
>         0.238163715352606 + 0.0548443903534220*I
> ```
> in the docstring of `Func_assoc_legendre_P`.

Done.



---

archive/issue_comments_381350.json:
```json
{
    "body": "Reviewer: **Eric Gourgoulhon, Travis Scrimshaw**",
    "created_at": "2021-04-17T16:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381350",
    "user": "https://github.com/mjungmath"
}
```

Reviewer: **Eric Gourgoulhon, Travis Scrimshaw**



---

archive/issue_comments_381351.json:
```json
{
    "body": "Changed commit from **[`d203066`](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)** to **[`c746088`](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)**",
    "created_at": "2021-04-17T16:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381351",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d203066`](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)** to **[`c746088`](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)**



---

archive/issue_comments_381352.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed\"><code>c746088</code></a></td><td><code>Trac #25034: add abs tol</code></td></tr></table>\n",
    "created_at": "2021-04-17T16:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381352",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed"><code>c746088</code></a></td><td><code>Trac #25034: add abs tol</code></td></tr></table>




---

archive/issue_comments_381353.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI hope this will make it in Sage 9.3.",
    "created_at": "2021-04-17T16:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381353",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:46" align="right">comment:46</div>

I hope this will make it in Sage 9.3.



---

archive/issue_events_343257.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-04-18T10:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343257"
}
```



---

archive/issue_events_343258.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-04-18T10:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343258"
}
```



---

archive/issue_comments_381354.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nThanks again! It's great that Sage has decent spherical harmonics at last!\n\nTravis, do you agree with the positive review?",
    "created_at": "2021-04-18T10:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381354",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:47" align="right">comment:47</div>

Thanks again! It's great that Sage has decent spherical harmonics at last!

Travis, do you agree with the positive review?



---

archive/issue_events_343259.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:13:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343259"
}
```



---

archive/issue_events_343260.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:13:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343260"
}
```



---

archive/issue_events_343261.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-04-19T00:32:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343261"
}
```



---

archive/issue_events_343262.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-04-19T00:32:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343262"
}
```



---

archive/issue_comments_381355.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nYou have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.\n\nAs per [comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:\n\n```\nsage: gen_legendre_P(x,x,.2)                                                                              \ngen_legendre_P(x, x, 0.200000000000000)\n```\nversus before:\n\n```\n(-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))\n```",
    "created_at": "2021-04-19T00:32:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381355",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:49" align="right">comment:49</div>

You have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.

As per [comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:

```
sage: gen_legendre_P(x,x,.2)                                                                              
gen_legendre_P(x, x, 0.200000000000000)
```
versus before:

```
(-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))
```



---

archive/issue_comments_381356.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@tscrim](#comment%3A49):\n> You have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.\n\nRight!\n\n> As per [comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:\n> \n> ```\n> sage: gen_legendre_P(x,x,.2)                                                                              \n> gen_legendre_P(x, x, 0.200000000000000)\n> ```\n> versus before:\n> \n> ```\n> (-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))\n> ```\n\nThis has nothing to do with removing `_eval_special_values_`. In fact:\n\n```\nsage: assume(x, 'integer')                                                      \nsage: gen_legendre_P(x, x, .2)                                                  \n0.960000000000000^(1/2*x)*(-1)^x*factorial(2*x)/(2^x*factorial(x))\n```\n\nIt is the line\n\n```diff\n+        if m.is_integer() and n.is_integer():\n             ...\n             if m == n:\n```\nthat makes sure that this formula is only used when `x` is an integer.",
    "created_at": "2021-04-19T07:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381356",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@tscrim](#comment%3A49):
> You have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.

Right!

> As per [comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:
> 
> ```
> sage: gen_legendre_P(x,x,.2)                                                                              
> gen_legendre_P(x, x, 0.200000000000000)
> ```
> versus before:
> 
> ```
> (-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))
> ```

This has nothing to do with removing `_eval_special_values_`. In fact:

```
sage: assume(x, 'integer')                                                      
sage: gen_legendre_P(x, x, .2)                                                  
0.960000000000000^(1/2*x)*(-1)^x*factorial(2*x)/(2^x*factorial(x))
```

It is the line

```diff
+        if m.is_integer() and n.is_integer():
             ...
             if m == n:
```
that makes sure that this formula is only used when `x` is an integer.



---

archive/issue_comments_381357.json:
```json
{
    "body": "Changed commit from **[`c746088`](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)** to **[`82a447c`](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)**",
    "created_at": "2021-04-19T07:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381357",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c746088`](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)** to **[`82a447c`](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)**



---

archive/issue_comments_381358.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35\"><code>82a447c</code></a></td><td><code>Trac #25034: eval_poly deprecation + doc improved</code></td></tr></table>\n",
    "created_at": "2021-04-19T07:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381358",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35"><code>82a447c</code></a></td><td><code>Trac #25034: eval_poly deprecation + doc improved</code></td></tr></table>




---

archive/issue_comments_381359.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nHere we go. Moreover, I have added some examples in the visible doc that show some floating number examples like the one above.",
    "created_at": "2021-04-19T07:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381359",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:52" align="right">comment:52</div>

Here we go. Moreover, I have added some examples in the visible doc that show some floating number examples like the one above.



---

archive/issue_events_343263.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-19T07:55:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343263"
}
```



---

archive/issue_events_343264.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-04-19T07:55:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343264"
}
```



---

archive/issue_comments_381360.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nOkay, thanks for the explanation. This will be good. Just a few more minor things:\n\n- `Case `|m| > |n|` for integers:` needs a `::`\n- Add a period at the end of the `.. MATH::` in `eval_gen_poly`.\n- Some formatting: <code>Evaluate the Ferrers function \\`P(n, m, x)\\` for \\`m\\` and \\`n\\` being concrete</code>\n- I would move the paragraph <code>These expressions ... \\`where |m| \\leq |n|\\`.</code> to the main part of the documentation so it is more visible.\n\nOnly the first is a must-do, but the rest are good while-we-are-at-it things.\n\nOnce these are done, it will be a positive review from me.",
    "created_at": "2021-04-20T02:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381360",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:54" align="right">comment:54</div>

Okay, thanks for the explanation. This will be good. Just a few more minor things:

- `Case `|m| > |n|` for integers:` needs a `::`
- Add a period at the end of the `.. MATH::` in `eval_gen_poly`.
- Some formatting: <code>Evaluate the Ferrers function \`P(n, m, x)\` for \`m\` and \`n\` being concrete</code>
- I would move the paragraph <code>These expressions ... \`where |m| \leq |n|\`.</code> to the main part of the documentation so it is more visible.

Only the first is a must-do, but the rest are good while-we-are-at-it things.

Once these are done, it will be a positive review from me.



---

archive/issue_comments_381361.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nI think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.",
    "created_at": "2021-04-20T03:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381361",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:55" align="right">comment:55</div>

I think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.



---

archive/issue_comments_381362.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@tscrim](#comment%3A54):\n> - I would move the paragraph <code>These expressions ... \\`where |m| \\leq |n|\\`.</code> to the main part of the documentation so it is more visible.\n\nI agree. However, the documentation of the whole file needs to be refactored imo (see #31636). Thus, I'll leave it there for now.\n\nAs for the rest: thank you for taking such a thorough look! :)",
    "created_at": "2021-04-20T07:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381362",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@tscrim](#comment%3A54):
> - I would move the paragraph <code>These expressions ... \`where |m| \leq |n|\`.</code> to the main part of the documentation so it is more visible.

I agree. However, the documentation of the whole file needs to be refactored imo (see #31636). Thus, I'll leave it there for now.

As for the rest: thank you for taking such a thorough look! :)



---

archive/issue_comments_381363.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526\"><code>0cda09b</code></a></td><td><code>Trac #25034: formatting + typos</code></td></tr></table>\n",
    "created_at": "2021-04-20T07:25:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381363",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526"><code>0cda09b</code></a></td><td><code>Trac #25034: formatting + typos</code></td></tr></table>




---

archive/issue_comments_381364.json:
```json
{
    "body": "Changed commit from **[`82a447c`](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)** to **[`0cda09b`](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)**",
    "created_at": "2021-04-20T07:25:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381364",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`82a447c`](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)** to **[`0cda09b`](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)**



---

archive/issue_comments_381365.json:
```json
{
    "body": "Changed commit from **[`0cda09b`](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)** to **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)**",
    "created_at": "2021-04-20T07:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381365",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0cda09b`](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)** to **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)**



---

archive/issue_comments_381366.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397\"><code>0b14d02</code></a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>\n",
    "created_at": "2021-04-20T07:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381366",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397"><code>0b14d02</code></a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>




---

archive/issue_comments_381367.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [@DaveWitteMorris](#comment%3A55):\n> I think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.\n\nIs that alright?\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397\"><code>0b14d02</code></a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>\n",
    "created_at": "2021-04-20T07:36:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381367",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [@DaveWitteMorris](#comment%3A55):
> I think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.

Is that alright?

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397"><code>0b14d02</code></a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>




---

archive/issue_comments_381368.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nPatchbot is green. :)",
    "created_at": "2021-04-20T17:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381368",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:60" align="right">comment:60</div>

Patchbot is green. :)



---

archive/issue_comments_381369.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nLooks like all sufficient conditions for positive review are satisfied.",
    "created_at": "2021-04-20T18:29:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381369",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">comment:61</div>

Looks like all sufficient conditions for positive review are satisfied.



---

archive/issue_events_343265.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-20T18:29:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343265"
}
```



---

archive/issue_events_343266.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-20T18:29:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343266"
}
```



---

archive/issue_events_343267.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-25T12:14:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343267"
}
```



---

archive/issue_events_343268.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6d8b561fecff1d7d0117f90ef9213ca9aea7e70b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-04-25T12:14:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25034#event-343268"
}
```



---

archive/issue_comments_381370.json:
```json
{
    "body": "Changed branch from **[public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)** to **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)**",
    "created_at": "2021-04-25T12:14:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381370",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)** to **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)**



---

archive/issue_comments_381371.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nThank you Matthias! :)",
    "created_at": "2021-04-26T15:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381371",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:63" align="right">comment:63</div>

Thank you Matthias! :)



---

archive/issue_comments_381372.json:
```json
{
    "body": "Changed commit from **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)** to none",
    "created_at": "2021-04-26T15:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25034#issuecomment-381372",
    "user": "https://github.com/mjungmath"
}
```

Changed commit from **[`0b14d02`](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)** to none
