# Issue 25034: Special case for gen_legendre_P with n == m gives incorrect results for x in (-1,1)

archive/issues_024797.json:
```json
{
    "body": "The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.\n\n---\n\n**Old Description**\n\nI am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`\nfrom `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre\nfunctions / Ferrers functions in SageMath 8.1.\n\nThere appears to be a discrepancy in the results I obtain, depending on whether\nI use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.\nI think this is because the `_eval_` method first tries to call the `_eval_special_values_`\nmethod, before using `eval_poly`.\n\nWith this input\n\n```\nx = SR.var('x')\nprint(gen_legendre_P.eval_poly(1, 1, x))\nprint(gen_legendre_P(1, 1, x))\nprint(gen_legendre_P.eval_poly(1, 1, 0.5))\nprint(gen_legendre_P(1, 1, 0.5))\n```\n\nI obtain\n\n```\n-sqrt(-x^2 + 1)\nsqrt(x^2 - 1)\n-0.866025403784439\n5.30287619362453e-17 + 0.866025403784439*I\n```\n\nThe result from eval_poly agrees with Mathematica, i.e.\n\n```\nLegendreP[1, 1, 0.5]\n-0.866025\n```\n\nBased on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].\n\nLooking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns\n\n```\nfactorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)\n```\n\nThis discrepancy also seems to be present in `spherical_harmonic` when\n`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),\nwhich is built using `gen_legendre_P`.\n\nAfter [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)\nin the sage-devel mailing list it appears that this is because the `n == m`\ncase in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,\nbut this is not defined in (-infinity,1].\n\nFor the spherical harmonics, where the argument x = cos(theta),\nx will always be in the range [-1, 1 ], where special case used\nin `_eval_special_values_` is not defined.\n\nOn the sage-devel mailing list, Howard Cohl suggested that\nthe correct formula for x in [-1, 1] is \n\n```\nP_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)\n```\n\nSee: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ\n\nAccording to Howard Cohl this is formally a Ferrers function\n(defined on (-1,1) ), rather than an associated Legendre polynomial.\nHowever, the existing code for Func_assoc_legendre_P does not\nseem to make any distinction between Ferrers and associated\nLegendre functions. \n\nMy proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).\n\nThis raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. \n\nIn my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of \"associated Legendre functions\", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.\n\n**CC:**  @rwst @slel @fredrik-johansson @tscrim\n\n**Keywords:** legendre, special function, spherical harmonic\n\n**Branch:** [0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)\n\n**Reviewer:** Eric Gourgoulhon, Travis Scrimshaw\n\n**Author:** Michael Jung\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25034\n\n",
    "closed_at": "2021-04-25T12:14:14Z",
    "created_at": "2018-03-27T09:09:57Z",
    "labels": [
        "component: misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Special case for gen_legendre_P with n == m gives incorrect results for x in (-1,1)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25034",
    "user": "https://trac.sagemath.org/admin/accounts/users/jcwomack"
}
```
The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.

---

**Old Description**

I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`
from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre
functions / Ferrers functions in SageMath 8.1.

There appears to be a discrepancy in the results I obtain, depending on whether
I use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.
I think this is because the `_eval_` method first tries to call the `_eval_special_values_`
method, before using `eval_poly`.

With this input

```
x = SR.var('x')
print(gen_legendre_P.eval_poly(1, 1, x))
print(gen_legendre_P(1, 1, x))
print(gen_legendre_P.eval_poly(1, 1, 0.5))
print(gen_legendre_P(1, 1, 0.5))
```

I obtain

```
-sqrt(-x^2 + 1)
sqrt(x^2 - 1)
-0.866025403784439
5.30287619362453e-17 + 0.866025403784439*I
```

The result from eval_poly agrees with Mathematica, i.e.

```
LegendreP[1, 1, 0.5]
-0.866025
```

Based on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].

Looking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns

```
factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)
```

This discrepancy also seems to be present in `spherical_harmonic` when
`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),
which is built using `gen_legendre_P`.

After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)
in the sage-devel mailing list it appears that this is because the `n == m`
case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,
but this is not defined in (-infinity,1].

For the spherical harmonics, where the argument x = cos(theta),
x will always be in the range [-1, 1 ], where special case used
in `_eval_special_values_` is not defined.

On the sage-devel mailing list, Howard Cohl suggested that
the correct formula for x in [-1, 1] is 

```
P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)
```

See: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ

According to Howard Cohl this is formally a Ferrers function
(defined on (-1,1) ), rather than an associated Legendre polynomial.
However, the existing code for Func_assoc_legendre_P does not
seem to make any distinction between Ferrers and associated
Legendre functions. 

My proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).

This raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. 

In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of "associated Legendre functions", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.

**CC:**  @rwst @slel @fredrik-johansson @tscrim

**Keywords:** legendre, special function, spherical harmonic

**Branch:** [0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)

**Reviewer:** Eric Gourgoulhon, Travis Scrimshaw

**Author:** Michael Jung

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/25034





---

archive/issue_comments_478468.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -42,7 +42,7 @@\n \n For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in _eval_special_values_ is not defined.\n \n-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x < 1 is \n+On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is \n \n ```\n P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)\n``````\n",
    "created_at": "2018-03-28T08:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478468",
    "user": "https://trac.sagemath.org/admin/accounts/users/jcwomack"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -42,7 +42,7 @@
 
 For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in _eval_special_values_ is not defined.
 
-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x < 1 is 
+On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is 
 
 ```
 P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)
``````




---

archive/issue_comments_478469.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,11 @@\n-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P from sage/functions/orthogonal_polys.py) to evaluate associated Legendre functions / Ferrers functions in Sage Math 8.1.\n+I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P\n+from sage/functions/orthogonal_polys.py) to evaluate associated Legendre\n+functions / Ferrers functions in SageMath 8.1.\n \n-There appears to be a discrepancy in the results I obtain, depending on whether I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases. I think this is because the _eval_ method first tries to call the _eval_special_values_ method, before using eval_poly.\n+There appears to be a discrepancy in the results I obtain, depending on whether\n+I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.\n+I think this is because the _eval_ method first tries to call the _eval_special_values_\n+method, before using eval_poly.\n \n With this input\n \n@@ -36,13 +41,21 @@\n factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)\n ```\n \n-This discrepancy also seems to be present in spherical_harmonic when n == m (an instance of SphericalHarmonic from sage/functions/special.py), which is built using gen_legendre_P.\n+This discrepancy also seems to be present in spherical_harmonic when\n+n == m (an instance of SphericalHarmonic from sage/functions/special.py),\n+which is built using gen_legendre_P.\n \n-After discussion in the sage-devel mailing list (https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ) it appears that this is because the n == m case in _eval_special_values_ is based on  https://dlmf.nist.gov/14.7#E15, but this is not defined in (-infinity,1].\n+After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)\n+in the sage-devel mailing list it appears that this is because the n == m\n+case in _eval_special_values_ is based on  https://dlmf.nist.gov/14.7#E15,\n+but this is not defined in (-infinity,1].\n \n-For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in _eval_special_values_ is not defined.\n+For the spherical harmonics, where the argument x = cos(theta),\n+x will always be in the range [-1, 1 ], where special case used\n+in _eval_special_values_ is not defined.\n \n-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is \n+On the sage-devel mailing list, Howard Cohl suggested that\n+the correct formula for x in [-1, 1] is \n \n ```\n P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)\n@@ -50,7 +63,11 @@\n \n See: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ\n \n-According to Howard Cohl this is formally a Ferrers function (defined on (-1,1) ), rather than an associated Legendre polynomial. However, the existing code for Func_assoc_legendre_P does not seem to make any distinction between Ferrers and associated Legendre functions. \n+According to Howard Cohl this is formally a Ferrers function\n+(defined on (-1,1) ), rather than an associated Legendre polynomial.\n+However, the existing code for Func_assoc_legendre_P does not\n+seem to make any distinction between Ferrers and associated\n+Legendre functions. \n \n My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).\n \n``````\n",
    "created_at": "2018-04-04T13:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478469",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,11 @@
-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P from sage/functions/orthogonal_polys.py) to evaluate associated Legendre functions / Ferrers functions in Sage Math 8.1.
+I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P
+from sage/functions/orthogonal_polys.py) to evaluate associated Legendre
+functions / Ferrers functions in SageMath 8.1.
 
-There appears to be a discrepancy in the results I obtain, depending on whether I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases. I think this is because the _eval_ method first tries to call the _eval_special_values_ method, before using eval_poly.
+There appears to be a discrepancy in the results I obtain, depending on whether
+I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.
+I think this is because the _eval_ method first tries to call the _eval_special_values_
+method, before using eval_poly.
 
 With this input
 
@@ -36,13 +41,21 @@
 factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)
 ```
 
-This discrepancy also seems to be present in spherical_harmonic when n == m (an instance of SphericalHarmonic from sage/functions/special.py), which is built using gen_legendre_P.
+This discrepancy also seems to be present in spherical_harmonic when
+n == m (an instance of SphericalHarmonic from sage/functions/special.py),
+which is built using gen_legendre_P.
 
-After discussion in the sage-devel mailing list (https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ) it appears that this is because the n == m case in _eval_special_values_ is based on  https://dlmf.nist.gov/14.7#E15, but this is not defined in (-infinity,1].
+After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)
+in the sage-devel mailing list it appears that this is because the n == m
+case in _eval_special_values_ is based on  https://dlmf.nist.gov/14.7#E15,
+but this is not defined in (-infinity,1].
 
-For the spherical harmonics, where the argument x = cos(theta), x will always be in the range [-1, 1 ], where special case used in _eval_special_values_ is not defined.
+For the spherical harmonics, where the argument x = cos(theta),
+x will always be in the range [-1, 1 ], where special case used
+in _eval_special_values_ is not defined.
 
-On the sage-devel mailing list, Howard Cohl suggested that the correct formula for x in [-1, 1] is 
+On the sage-devel mailing list, Howard Cohl suggested that
+the correct formula for x in [-1, 1] is 
 
 ```
 P_m^m(x)=(-1)^m (2m)!/(2^m m!) (1-x^2)^(m/2)
@@ -50,7 +63,11 @@
 
 See: https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/QWwnAeLJBAAJ
 
-According to Howard Cohl this is formally a Ferrers function (defined on (-1,1) ), rather than an associated Legendre polynomial. However, the existing code for Func_assoc_legendre_P does not seem to make any distinction between Ferrers and associated Legendre functions. 
+According to Howard Cohl this is formally a Ferrers function
+(defined on (-1,1) ), rather than an associated Legendre polynomial.
+However, the existing code for Func_assoc_legendre_P does not
+seem to make any distinction between Ferrers and associated
+Legendre functions. 
 
 My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).
 
``````




---

archive/issue_comments_478470.json:
```json
{
    "body": "<a id='comment:3'></a>\nA (quite severe IMHO) consequence of this bug is\n\n```\nsage: theta, phi = var('theta phi')\nsage: spherical_harmonic(1, 1, theta, phi)\n-1/4*sqrt(3)*sqrt(2)*sqrt(cos(theta)^2 - 1)*e^(I*phi)/sqrt(pi)\n```\nwhich is plain wrong: the term `sqrt(cos(theta)^2-1)` (which is imaginary for `theta` real) should actually be `sin(theta)`.",
    "created_at": "2018-04-08T16:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478470",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'></a>
A (quite severe IMHO) consequence of this bug is

```
sage: theta, phi = var('theta phi')
sage: spherical_harmonic(1, 1, theta, phi)
-1/4*sqrt(3)*sqrt(2)*sqrt(cos(theta)^2 - 1)*e^(I*phi)/sqrt(pi)
```
which is plain wrong: the term `sqrt(cos(theta)^2-1)` (which is imaginary for `theta` real) should actually be `sin(theta)`.



---

archive/issue_comments_478471.json:
```json
{
    "body": "<a id='comment:4'></a>\nFor reference, here are some related issues reported by users:\n- https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ\n- https://ask.sagemath.org/question/49694\n- https://ask.sagemath.org/question/48776",
    "created_at": "2020-01-28T14:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478471",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>
For reference, here are some related issues reported by users:
- https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ
- https://ask.sagemath.org/question/49694
- https://ask.sagemath.org/question/48776



---

archive/issue_comments_478472.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [egourgoulhon](#comment%3A4):\n> For reference, here are some related issues reported by users:\n> - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ\n> - https://ask.sagemath.org/question/49694\n> - https://ask.sagemath.org/question/48776\n\n\nOne more:\n- https://ask.sagemath.org/question/49891/",
    "created_at": "2020-02-12T20:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478472",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>
Replying to [egourgoulhon](#comment%3A4):
> For reference, here are some related issues reported by users:
> - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ
> - https://ask.sagemath.org/question/49694
> - https://ask.sagemath.org/question/48776


One more:
- https://ask.sagemath.org/question/49891/



---

archive/issue_comments_478473.json:
```json
{
    "body": "<a id='comment:6'></a>\n> > For reference, here are some related issues reported by users:\n> > - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ\n> > - https://ask.sagemath.org/question/49694\n> > - https://ask.sagemath.org/question/48776\n \n> \n> One more:\n> - https://ask.sagemath.org/question/49891/\n \nYet one more:\n- https://ask.sagemath.org/question/51994/",
    "created_at": "2020-06-15T15:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478473",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'></a>
> > For reference, here are some related issues reported by users:
> > - https://groups.google.com/forum/#!msg/sage-support/I_d_meMxRbM/bDhZ_wtoAgAJ
> > - https://ask.sagemath.org/question/49694
> > - https://ask.sagemath.org/question/48776
 
> 
> One more:
> - https://ask.sagemath.org/question/49891/
 
Yet one more:
- https://ask.sagemath.org/question/51994/



---

archive/issue_comments_478474.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,20 +1,20 @@\n-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P\n-from sage/functions/orthogonal_polys.py) to evaluate associated Legendre\n+I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`\n+from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre\n functions / Ferrers functions in SageMath 8.1.\n \n There appears to be a discrepancy in the results I obtain, depending on whether\n-I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.\n-I think this is because the _eval_ method first tries to call the _eval_special_values_\n-method, before using eval_poly.\n+I use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.\n+I think this is because the `_eval_` method first tries to call the `_eval_special_values_`\n+method, before using `eval_poly`.\n \n With this input\n \n ```\n x = SR.var('x')\n-print gen_legendre_P.eval_poly(1,1,x)\n-print gen_legendre_P(1,1,x)\n-print gen_legendre_P.eval_poly(1,1,0.5)\n-print gen_legendre_P(1,1,0.5)\n+print(gen_legendre_P.eval_poly(1, 1, x))\n+print(gen_legendre_P(1, 1, x))\n+print(gen_legendre_P.eval_poly(1, 1, 0.5))\n+print(gen_legendre_P(1, 1, 0.5))\n ```\n \n I obtain\n@@ -33,26 +33,26 @@\n -0.866025\n ```\n \n-Based on the above output, it seems to me that gen_legendre_P.eval_poly(1,1,cos(theta)) will always be real while gen_legendre_P(1,1,cos(theta)) will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].\n+Based on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].\n \n-Looking at the code for Func_assoc_legendre_P._eval_special_values_, I suspect the culprit is the n == m case, which returns\n+Looking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns\n \n ```\n factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)\n ```\n \n-This discrepancy also seems to be present in spherical_harmonic when\n-n == m (an instance of SphericalHarmonic from sage/functions/special.py),\n-which is built using gen_legendre_P.\n+This discrepancy also seems to be present in `spherical_harmonic` when\n+`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),\n+which is built using `gen_legendre_P`.\n \n After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)\n-in the sage-devel mailing list it appears that this is because the n == m\n-case in _eval_special_values_ is based on  https://dlmf.nist.gov/14.7#E15,\n+in the sage-devel mailing list it appears that this is because the `n == m`\n+case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,\n but this is not defined in (-infinity,1].\n \n For the spherical harmonics, where the argument x = cos(theta),\n x will always be in the range [-1, 1 ], where special case used\n-in _eval_special_values_ is not defined.\n+in `_eval_special_values_` is not defined.\n \n On the sage-devel mailing list, Howard Cohl suggested that\n the correct formula for x in [-1, 1] is \n@@ -69,8 +69,8 @@\n seem to make any distinction between Ferrers and associated\n Legendre functions. \n \n-My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).\n+My proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).\n \n-This raises the question of whether Func_assoc_legendre_P is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. \n+This raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. \n \n-In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of \"associated Legendre functions\", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for Func_assoc_legendre_P that the class seems to cover both functions.\n+In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of \"associated Legendre functions\", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.\n``````\n",
    "created_at": "2020-06-15T23:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478474",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,20 +1,20 @@
-I am using the gen_legendre_P function (an instance of Func_assoc_legendre_P
-from sage/functions/orthogonal_polys.py) to evaluate associated Legendre
+I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`
+from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre
 functions / Ferrers functions in SageMath 8.1.
 
 There appears to be a discrepancy in the results I obtain, depending on whether
-I use gen_legendre_P.eval_poly() or directly call gen_legendre_P() in some cases.
-I think this is because the _eval_ method first tries to call the _eval_special_values_
-method, before using eval_poly.
+I use `gen_legendre_P.eval_poly()` or directly call `gen_legendre_P()` in some cases.
+I think this is because the `_eval_` method first tries to call the `_eval_special_values_`
+method, before using `eval_poly`.
 
 With this input
 
 ```
 x = SR.var('x')
-print gen_legendre_P.eval_poly(1,1,x)
-print gen_legendre_P(1,1,x)
-print gen_legendre_P.eval_poly(1,1,0.5)
-print gen_legendre_P(1,1,0.5)
+print(gen_legendre_P.eval_poly(1, 1, x))
+print(gen_legendre_P(1, 1, x))
+print(gen_legendre_P.eval_poly(1, 1, 0.5))
+print(gen_legendre_P(1, 1, 0.5))
 ```
 
 I obtain
@@ -33,26 +33,26 @@
 -0.866025
 ```
 
-Based on the above output, it seems to me that gen_legendre_P.eval_poly(1,1,cos(theta)) will always be real while gen_legendre_P(1,1,cos(theta)) will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].
+Based on the above output, it seems to me that `gen_legendre_P.eval_poly(1, 1, cos(theta))` will always be real while `gen_legendre_P(1, 1, cos(theta))` will be complex (unless |cos(theta)| = 1), since cos(theta) is in the interval [-1,1].
 
-Looking at the code for Func_assoc_legendre_P._eval_special_values_, I suspect the culprit is the n == m case, which returns
+Looking at the code for `Func_assoc_legendre_P._eval_special_values_`, I suspect the culprit is the `n == m` case, which returns
 
 ```
 factorial(2*m)/2**m/factorial(m) * (x**2-1)**(m/2)
 ```
 
-This discrepancy also seems to be present in spherical_harmonic when
-n == m (an instance of SphericalHarmonic from sage/functions/special.py),
-which is built using gen_legendre_P.
+This discrepancy also seems to be present in `spherical_harmonic` when
+`n == m` (an instance of `SphericalHarmonic` from `sage/functions/special.py`),
+which is built using `gen_legendre_P`.
 
 After [discussion](https://groups.google.com/d/msg/sage-devel/IDtiGF6HB28/ErLsqI1eBAAJ)
-in the sage-devel mailing list it appears that this is because the n == m
-case in _eval_special_values_ is based on  https://dlmf.nist.gov/14.7#E15,
+in the sage-devel mailing list it appears that this is because the `n == m`
+case in `_eval_special_values_` is based on  https://dlmf.nist.gov/14.7#E15,
 but this is not defined in (-infinity,1].
 
 For the spherical harmonics, where the argument x = cos(theta),
 x will always be in the range [-1, 1 ], where special case used
-in _eval_special_values_ is not defined.
+in `_eval_special_values_` is not defined.
 
 On the sage-devel mailing list, Howard Cohl suggested that
 the correct formula for x in [-1, 1] is 
@@ -69,8 +69,8 @@
 seem to make any distinction between Ferrers and associated
 Legendre functions. 
 
-My proposed fix would be to have Func_assoc_legendre_P._eval_special_values_ choose between two n == m special cases, based on whether -1 <= x <= 1 (above expression) or > 1 (current expression).
+My proposed fix would be to have `Func_assoc_legendre_P._eval_special_values_` choose between two `n == m` special cases, based on whether `-1 <= x <= 1` (above expression) or `> 1` (current expression).
 
-This raises the question of whether Func_assoc_legendre_P is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. 
+This raises the question of whether `Func_assoc_legendre_P` is correctly defined, as at present it would seem to cover both Ferrers functions and associated Legendre functions. 
 
-In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of "associated Legendre functions", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for Func_assoc_legendre_P that the class seems to cover both functions.
+In my experience with the physics/chemistry literature, the spherical harmonics are universally defined in terms of "associated Legendre functions", even though the argument is x = cos(theta). DLMF suggests these are defined in terms of Ferrers functions of the first kind (https://dlmf.nist.gov/14.30.E1). Wolfram Mathematica does not seem to distinguish. Possibly it is worth flagging in the docstring for `Func_assoc_legendre_P` that the class seems to cover both functions.
``````




---

archive/issue_events_071415.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-06-15T23:11:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25034#event-71415"
}
```



---

archive/issue_events_071416.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25034#event-71416"
}
```



---

archive/issue_events_071417.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25034#event-71417"
}
```



---

archive/issue_events_071418.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25034#event-71418"
}
```



---

archive/issue_comments_478475.json:
```json
{
    "body": "<a id='comment:9'></a>\nSince this features is obviously highly demanded, and within two years not resolved, I took the freedom to shift it's priority to \"critical\".",
    "created_at": "2021-04-08T21:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478475",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:9'></a>
Since this features is obviously highly demanded, and within two years not resolved, I took the freedom to shift it's priority to "critical".



---

archive/issue_comments_478476.json:
```json
{
    "body": "<a id='comment:11'></a>\nWhat about separately adding `Func_ferrers` to the library with the appropriate convention then?\n\nOne can easily refer to https://dlmf.nist.gov/14.7#E8 and https://dlmf.nist.gov/14.7#E14 respectively and clarify the convention.\n\nAlso, I found a nice stackexchange post explaining the origin of this difference: https://math.stackexchange.com/a/2986444",
    "created_at": "2021-04-09T21:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478476",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:11'></a>
What about separately adding `Func_ferrers` to the library with the appropriate convention then?

One can easily refer to https://dlmf.nist.gov/14.7#E8 and https://dlmf.nist.gov/14.7#E14 respectively and clarify the convention.

Also, I found a nice stackexchange post explaining the origin of this difference: https://math.stackexchange.com/a/2986444



---

archive/issue_comments_478477.json:
```json
{
    "body": "<a id='comment:12'></a>\nI already worked on something. Will push tomorrow.",
    "created_at": "2021-04-10T00:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478477",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:12'></a>
I already worked on something. Will push tomorrow.



---

archive/issue_comments_478478.json:
```json
{
    "body": "**Branch:** [public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)",
    "created_at": "2021-04-10T09:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478478",
    "user": "https://github.com/mjungmath"
}
```

**Branch:** [public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)



---

archive/issue_comments_478479.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/568d0fa7113b39833c3cc93ddc7629bf491f59ec\">568d0fa</a></td><td><code>Trac #25034: follow mathematica convention on legendre polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d6ead15155270684b310d099f8ecd3cd9848ca7\">6d6ead1</a></td><td><code>Trac #25034: doctest for spherical harmonics added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14\">571632f</a></td><td><code>Trac #25034: doctest further improved</code></td></tr></table>\n",
    "created_at": "2021-04-10T10:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478479",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/568d0fa7113b39833c3cc93ddc7629bf491f59ec">568d0fa</a></td><td><code>Trac #25034: follow mathematica convention on legendre polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d6ead15155270684b310d099f8ecd3cd9848ca7">6d6ead1</a></td><td><code>Trac #25034: doctest for spherical harmonics added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14">571632f</a></td><td><code>Trac #25034: doctest further improved</code></td></tr></table>




---

archive/issue_comments_478480.json:
```json
{
    "body": "**Commit:** [571632f25b4cf431062d4a867ee4bbd54ac15b14](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)",
    "created_at": "2021-04-10T10:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [571632f25b4cf431062d4a867ee4bbd54ac15b14](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)



---

archive/issue_comments_478481.json:
```json
{
    "body": "**Changing commit** from \"[571632f25b4cf431062d4a867ee4bbd54ac15b14](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)\" to \"[4fcc57437dcd43de0e6f32626b7522c0080b57a3](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)\".",
    "created_at": "2021-04-10T12:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[571632f25b4cf431062d4a867ee4bbd54ac15b14](https://github.com/sagemath/sagetrac-mirror/commit/571632f25b4cf431062d4a867ee4bbd54ac15b14)" to "[4fcc57437dcd43de0e6f32626b7522c0080b57a3](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)".



---

archive/issue_comments_478482.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3\">4fcc574</a></td><td><code>Trac #25034: formula for n=m fixed</code></td></tr></table>\n",
    "created_at": "2021-04-10T12:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3">4fcc574</a></td><td><code>Trac #25034: formula for n=m fixed</code></td></tr></table>




---

archive/issue_comments_478483.json:
```json
{
    "body": "<a id='comment:16'></a>\nI have uploaded a proposal. Please let me know in case I have missed any details.\n\n**What have I done?**\n\n- The main modification is as proposed:\n\n   ```diff\n         if m == 0:\n             return legendre_P(n, x)\n         if n == m:\n-            return (-1)**m*(1-x**2)**(m/2) * ZZ(2*m-1).multifactorial(2)\n+            return (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)\n   ```\n\n- Furthermore I have added the feature of negative `m` which wasn't there yet.\n- The special case `m+1=n` has been added.\n\nYou are invited to contribute more doctests, especially for spherical harmonics. So far, I have only collected some of the code snippets posted above that have not worked. They are working now.\n\n**Follow-Ups**\n\n- As for resolving convention conflicts, I propose to wrap this up in a follow-up ticket (#31637).\n\n- Moreover, imho the documentation for orthogonal polynomials is a mess and urgently needs to be cleaned up. I suggest to attack this in another follow-up ticket (#31636).",
    "created_at": "2021-04-10T12:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478483",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:16'></a>
I have uploaded a proposal. Please let me know in case I have missed any details.

**What have I done?**

- The main modification is as proposed:

   ```diff
         if m == 0:
             return legendre_P(n, x)
         if n == m:
-            return (-1)**m*(1-x**2)**(m/2) * ZZ(2*m-1).multifactorial(2)
+            return (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)
   ```

- Furthermore I have added the feature of negative `m` which wasn't there yet.
- The special case `m+1=n` has been added.

You are invited to contribute more doctests, especially for spherical harmonics. So far, I have only collected some of the code snippets posted above that have not worked. They are working now.

**Follow-Ups**

- As for resolving convention conflicts, I propose to wrap this up in a follow-up ticket (#31637).

- Moreover, imho the documentation for orthogonal polynomials is a mess and urgently needs to be cleaned up. I suggest to attack this in another follow-up ticket (#31636).



---

archive/issue_comments_478484.json:
```json
{
    "body": "<a id='comment:17'></a>\nThank you so much for tackling this! \n\nShall the ticket be set to needs_review? (in order to draw it to the patchbots' attention)",
    "created_at": "2021-04-10T12:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478484",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:17'></a>
Thank you so much for tackling this! 

Shall the ticket be set to needs_review? (in order to draw it to the patchbots' attention)



---

archive/issue_comments_478485.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [egourgoulhon](#comment%3A17):\n> Thank you so much for tackling this! \n> \n> Shall the ticket be set to needs_review? (in order to get the attention of the patchbots)\n\n\nWould you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.",
    "created_at": "2021-04-10T12:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478485",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:18'></a>
Replying to [egourgoulhon](#comment%3A17):
> Thank you so much for tackling this! 
> 
> Shall the ticket be set to needs_review? (in order to get the attention of the patchbots)


Would you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.



---

archive/issue_comments_478486.json:
```json
{
    "body": "**Author:** Michael Jung",
    "created_at": "2021-04-10T12:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478486",
    "user": "https://github.com/mjungmath"
}
```

**Author:** Michael Jung



---

archive/issue_comments_478487.json:
```json
{
    "body": "**Changing commit** from \"[4fcc57437dcd43de0e6f32626b7522c0080b57a3](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)\" to \"[a4edb24ed3ffdd3aa667d3200452464963c137e0](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)\".",
    "created_at": "2021-04-10T14:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478487",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4fcc57437dcd43de0e6f32626b7522c0080b57a3](https://github.com/sagemath/sagetrac-mirror/commit/4fcc57437dcd43de0e6f32626b7522c0080b57a3)" to "[a4edb24ed3ffdd3aa667d3200452464963c137e0](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)".



---

archive/issue_comments_478488.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0\">a4edb24</a></td><td><code>Trac #25034: abs(m) exceeding n gives zero immediately</code></td></tr></table>\n",
    "created_at": "2021-04-10T14:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0">a4edb24</a></td><td><code>Trac #25034: abs(m) exceeding n gives zero immediately</code></td></tr></table>




---

archive/issue_comments_478489.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-04-10T15:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478489",
    "user": "https://github.com/mjungmath"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_478490.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [gh-mjungmath](#comment%3A18):\n> Would you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.\n\n\nAlright, technically speaking spherical harmonics do not belong to this ticket. Let's finish this one first before messing with spherical harmonics. I created a follow-up: #31639.",
    "created_at": "2021-04-10T15:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478490",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:21'></a>
Replying to [gh-mjungmath](#comment%3A18):
> Would you mind to add some more doctests for spherical coordinates before? I think, the current doctesting is a little bit sparse considering that the bug has not been caught. At least I would feel more comfortable if some identities or important values are checked that haven't worked before.


Alright, technically speaking spherical harmonics do not belong to this ticket. Let's finish this one first before messing with spherical harmonics. I created a follow-up: #31639.



---

archive/issue_comments_478491.json:
```json
{
    "body": "<a id='comment:22'></a>\nPatchbot is green at least.",
    "created_at": "2021-04-10T20:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478491",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:22'></a>
Patchbot is green at least.



---

archive/issue_comments_478492.json:
```json
{
    "body": "<a id='comment:23'></a>\nThe order in which you perform tests is important. Here:\n\n```\nif n in ZZ and m in ZZ and (x in ZZ or not SR(x).is_numeric()) and n >= 0:\n```\nyou should have the `n >= 0` before the `x` tests as it is quicker.\n\nI am also not sure about doing the multiplication first in the quotient here:\n\n```\nreturn (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)\n```\nI feel like \n\n```\n(-1)**m * factorial(2*m)/factorial(m)/2**m * (1-x**2)**(m/2)\n```\nshould give better performance since we know the first division is exact. (I really would prefer `//`, but that won't work if `m` is a symbolic variable unfortunately...)\n\nAlso, a while-we-are-at-it:\n\n```diff\n-return ZZ(0)\n+return ZZ.zero()\n```\n\nI probably would also be good to add support for negative `n` by replacing it with `-n-1`. This will get rid of the error for `gen_legendre_P(-2,-2,x)`.\n\nI don't understand why you feed this back through the full evaluation instead of this:\n\n```diff\n-return x*(2*m+1)*gen_legendre_P(m, m, x)\n+return x * (2*m+1) * self._eval_special_values_(m, m, x)\n```\n\nA small tweak in the language:\n\n```diff\n-Print the first associated Legendre polynomials::\n+We give the first associated Legendre polynomials::\n```\nI would also add a space around the `=` to make it easier to read the output.\n\nPlease put the `REFERENCES:` at the end of the docstring (and add the `S`).",
    "created_at": "2021-04-10T22:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478492",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
The order in which you perform tests is important. Here:

```
if n in ZZ and m in ZZ and (x in ZZ or not SR(x).is_numeric()) and n >= 0:
```
you should have the `n >= 0` before the `x` tests as it is quicker.

I am also not sure about doing the multiplication first in the quotient here:

```
return (-1)**m*factorial(2*m)/(2**m*factorial(m)) * (1-x**2)**(m/2)
```
I feel like 

```
(-1)**m * factorial(2*m)/factorial(m)/2**m * (1-x**2)**(m/2)
```
should give better performance since we know the first division is exact. (I really would prefer `//`, but that won't work if `m` is a symbolic variable unfortunately...)

Also, a while-we-are-at-it:

```diff
-return ZZ(0)
+return ZZ.zero()
```

I probably would also be good to add support for negative `n` by replacing it with `-n-1`. This will get rid of the error for `gen_legendre_P(-2,-2,x)`.

I don't understand why you feed this back through the full evaluation instead of this:

```diff
-return x*(2*m+1)*gen_legendre_P(m, m, x)
+return x * (2*m+1) * self._eval_special_values_(m, m, x)
```

A small tweak in the language:

```diff
-Print the first associated Legendre polynomials::
+We give the first associated Legendre polynomials::
```
I would also add a space around the `=` to make it easier to read the output.

Please put the `REFERENCES:` at the end of the docstring (and add the `S`).



---

archive/issue_comments_478493.json:
```json
{
    "body": "**Changing commit** from \"[a4edb24ed3ffdd3aa667d3200452464963c137e0](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)\" to \"[6b365d7722273cb8f0c3c0bc66de195c67509bb9](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)\".",
    "created_at": "2021-04-11T11:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478493",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a4edb24ed3ffdd3aa667d3200452464963c137e0](https://github.com/sagemath/sagetrac-mirror/commit/a4edb24ed3ffdd3aa667d3200452464963c137e0)" to "[6b365d7722273cb8f0c3c0bc66de195c67509bb9](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)".



---

archive/issue_comments_478494.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c532a1067695bc81fd7aba14615a7462ef9bf06\">7c532a1</a></td><td><code>Trac #25034: minor improvements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9\">6b365d7</a></td><td><code>Trac #25034: slight refactoring of _eval_</code></td></tr></table>\n",
    "created_at": "2021-04-11T11:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c532a1067695bc81fd7aba14615a7462ef9bf06">7c532a1</a></td><td><code>Trac #25034: minor improvements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9">6b365d7</a></td><td><code>Trac #25034: slight refactoring of _eval_</code></td></tr></table>




---

archive/issue_comments_478495.json:
```json
{
    "body": "<a id='comment:25'></a>\nThank you Travis for the feedback! I hope I took everything in account now. In addition, I refactored `_eval_` a bit and completely removed `_eval_special_values_`. Please check this out.",
    "created_at": "2021-04-11T11:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478495",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:25'></a>
Thank you Travis for the feedback! I hope I took everything in account now. In addition, I refactored `_eval_` a bit and completely removed `_eval_special_values_`. Please check this out.



---

archive/issue_comments_478496.json:
```json
{
    "body": "<a id='comment:26'></a>\nI know that this is not absolutely precise at the moment. But at least this implementation is more or less consistent and makes spherical harmonics work properly. More elaborate thoughts to resolve this are very much appreciated in #31637.",
    "created_at": "2021-04-11T11:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478496",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:26'></a>
I know that this is not absolutely precise at the moment. But at least this implementation is more or less consistent and makes spherical harmonics work properly. More elaborate thoughts to resolve this are very much appreciated in #31637.



---

archive/issue_comments_478497.json:
```json
{
    "body": "<a id='comment:27'></a>\nPatchbot green again.",
    "created_at": "2021-04-11T14:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478497",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:27'></a>
Patchbot green again.



---

archive/issue_comments_478498.json:
```json
{
    "body": "<a id='comment:28'></a>\nI am -1 on removing `_eval_special_values_` as it has a clear purpose and is useful for future maintenance by having a more logical grouping of the code.",
    "created_at": "2021-04-11T22:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478498",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
I am -1 on removing `_eval_special_values_` as it has a clear purpose and is useful for future maintenance by having a more logical grouping of the code.



---

archive/issue_comments_478499.json:
```json
{
    "body": "<a id='comment:29'></a>\nNow it is grouped into \"integer\" and \"non-integer\" case. Unfortunately, this didn't work well with `_eval_special_values_` because it would lead to many repeated if-statements. This is the most concise pattern I could think of. Do you have another idea?\n\nMoreover, the `x == 0` case seemingly didn't make sense for `_evalf_`. Please correct me if I am wrong here.",
    "created_at": "2021-04-11T23:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478499",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:29'></a>
Now it is grouped into "integer" and "non-integer" case. Unfortunately, this didn't work well with `_eval_special_values_` because it would lead to many repeated if-statements. This is the most concise pattern I could think of. Do you have another idea?

Moreover, the `x == 0` case seemingly didn't make sense for `_evalf_`. Please correct me if I am wrong here.



---

archive/issue_comments_478500.json:
```json
{
    "body": "<a id='comment:30'></a>\nI thought the previous version was fine. I don't like forcing it all together, as opposed to what many other functions do. I also don't really think the `SR(x).is_numeric()` test being run so frequently is good.\n\nAdditionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.",
    "created_at": "2021-04-12T01:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478500",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>
I thought the previous version was fine. I don't like forcing it all together, as opposed to what many other functions do. I also don't really think the `SR(x).is_numeric()` test being run so frequently is good.

Additionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.



---

archive/issue_comments_478501.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [tscrim](#comment%3A30):\n> Additionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.\n\n\nTrue. However, this particular formula holds indeed if `m` and `n` are integers. But I am not sure whether this extends accordingly to arbitrary `m` and `n` using Gamma functions...\n\nPlaying around with the numeric tool, it turned out that the case `abs(m) > n` only yields zero for the integer case (try for example `gen_legendre_P(2.,3.*I,.5)`).\n\nGrouping it the same way as before would therefore lead to many redundant if-statements, as said above. I don't think this is desirable either.",
    "created_at": "2021-04-12T08:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478501",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:31'></a>
Replying to [tscrim](#comment%3A30):
> Additionally, with your current code, if passing symbolic `m == n`, it no longer gets the special value AFAICS.


True. However, this particular formula holds indeed if `m` and `n` are integers. But I am not sure whether this extends accordingly to arbitrary `m` and `n` using Gamma functions...

Playing around with the numeric tool, it turned out that the case `abs(m) > n` only yields zero for the integer case (try for example `gen_legendre_P(2.,3.*I,.5)`).

Grouping it the same way as before would therefore lead to many redundant if-statements, as said above. I don't think this is desirable either.



---

archive/issue_comments_478502.json:
```json
{
    "body": "**Changing commit** from \"[6b365d7722273cb8f0c3c0bc66de195c67509bb9](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)\" to \"[801298c0384e772e3e4ffa52e865b7ae12a97ba7](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)\".",
    "created_at": "2021-04-12T10:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478502",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6b365d7722273cb8f0c3c0bc66de195c67509bb9](https://github.com/sagemath/sagetrac-mirror/commit/6b365d7722273cb8f0c3c0bc66de195c67509bb9)" to "[801298c0384e772e3e4ffa52e865b7ae12a97ba7](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)".



---

archive/issue_comments_478503.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7\">801298c</a></td><td><code>Trac #25034: allow negative n</code></td></tr></table>\n",
    "created_at": "2021-04-12T10:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7">801298c</a></td><td><code>Trac #25034: allow negative n</code></td></tr></table>




---

archive/issue_comments_478504.json:
```json
{
    "body": "<a id='comment:33'></a>\nWhat about this?",
    "created_at": "2021-04-12T10:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478504",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:33'></a>
What about this?



---

archive/issue_comments_478505.json:
```json
{
    "body": "<a id='comment:34'></a>\nAt least the patchbot likes it. This version is very close to the version before, but now with negative `n`. This is still not optimal but I think more preciseness should be elaborated in the follow-up ticket.\n\nWhat do you think?",
    "created_at": "2021-04-13T11:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478505",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:34'></a>
At least the patchbot likes it. This version is very close to the version before, but now with negative `n`. This is still not optimal but I think more preciseness should be elaborated in the follow-up ticket.

What do you think?



---

archive/issue_comments_478506.json:
```json
{
    "body": "<a id='comment:35'></a>\nI think this is a lot better.\n\nThis is a bit cumbersome way of saying \"let m be a positive integer\":\n\n```\n+    For `n` being a non-negative integer, negative integer values for `m`\n+    with `|m| \\leq n` can be obtained by:\n+\n+    .. MATH::\n+\n+            P^{-|m|}_n(x) = (-1)^{|m|} \\frac{(n-|m|)!}{(n+|m|)!} P_n^{|m|}(x).\n```\n\nI am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?\n\nI think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.",
    "created_at": "2021-04-14T01:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478506",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>
I think this is a lot better.

This is a bit cumbersome way of saying "let m be a positive integer":

```
+    For `n` being a non-negative integer, negative integer values for `m`
+    with `|m| \leq n` can be obtained by:
+
+    .. MATH::
+
+            P^{-|m|}_n(x) = (-1)^{|m|} \frac{(n-|m|)!}{(n+|m|)!} P_n^{|m|}(x).
```

I am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?

I think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.



---

archive/issue_comments_478507.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [tscrim](#comment%3A35):\n> I am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?\n\n\nI think it is reasonable to assume that `mpmath` already uses optimized algorithms, isn't it? Moreover, without the above patch we have something like that:\n\n```\nsage: %%time \n....: gen_legendre_P(1.2,1.1,0)\nCPU times: user 2.78 ms, sys: 0 ns, total: 2.78 ms\nWall time: 2.8 ms\n2.14354692507259*cos(1.15000000000000*pi)*gamma(33/20)/(sqrt(pi)*gamma(749113601384401/713441525128001))\n```\n\nwhich already looks clunky. Moreover if we want the answer in terms of floating numbers, we get:\n\n```\nsage: %%time \n....: gen_legendre_P(1.2,1.1,0).n()\nCPU times: user 166 ms, sys: 7.01 ms, total: 173 ms\nWall time: 204 ms\n-0.996322549249593\n```\n\nwhereas compared to with patch:\n\n```\nsage: %%time \n....: gen_legendre_P(1.2,1.1,0)\nCPU times: user 302 \u00b5s, sys: 20 \u00b5s, total: 322 \u00b5s\nWall time: 326 \u00b5s\n-0.996322549249593\n```\n\nFor the case `m=n` however, the `mpmath` version seems to be slightly slower than evaluating the special case (now everything with the new patch):\n\n```\nsage: %%time \n....: gen_legendre_P._evalf_(1,1,.2)\nCPU times: user 1.29 ms, sys: 0 ns, total: 1.29 ms\nWall time: 1.29 ms\n-0.979795897113271\nsage: %%time \n....: gen_legendre_P._eval_special_values_(1,1,.2)\nCPU times: user 124 \u00b5s, sys: 0 ns, total: 124 \u00b5s\nWall time: 127 \u00b5s\n-0.979795897113271\n```\n\nBut treading these cases differently would dismantle `_eval_special_values_` again.\n\n> \n> I think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.\n\n\nI'll do.",
    "created_at": "2021-04-14T10:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478507",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:36'></a>
Replying to [tscrim](#comment%3A35):
> I am not sure about removing the `_eval_special_values_` from `_evalf_`. Can we add doctests for floating point input with special values?


I think it is reasonable to assume that `mpmath` already uses optimized algorithms, isn't it? Moreover, without the above patch we have something like that:

```
sage: %%time 
....: gen_legendre_P(1.2,1.1,0)
CPU times: user 2.78 ms, sys: 0 ns, total: 2.78 ms
Wall time: 2.8 ms
2.14354692507259*cos(1.15000000000000*pi)*gamma(33/20)/(sqrt(pi)*gamma(749113601384401/713441525128001))
```

which already looks clunky. Moreover if we want the answer in terms of floating numbers, we get:

```
sage: %%time 
....: gen_legendre_P(1.2,1.1,0).n()
CPU times: user 166 ms, sys: 7.01 ms, total: 173 ms
Wall time: 204 ms
-0.996322549249593
```

whereas compared to with patch:

```
sage: %%time 
....: gen_legendre_P(1.2,1.1,0)
CPU times: user 302 s, sys: 20 s, total: 322 s
Wall time: 326 s
-0.996322549249593
```

For the case `m=n` however, the `mpmath` version seems to be slightly slower than evaluating the special case (now everything with the new patch):

```
sage: %%time 
....: gen_legendre_P._evalf_(1,1,.2)
CPU times: user 1.29 ms, sys: 0 ns, total: 1.29 ms
Wall time: 1.29 ms
-0.979795897113271
sage: %%time 
....: gen_legendre_P._eval_special_values_(1,1,.2)
CPU times: user 124 s, sys: 0 ns, total: 124 s
Wall time: 127 s
-0.979795897113271
```

But treading these cases differently would dismantle `_eval_special_values_` again.

> 
> I think we should also add doctests to `_eval_special_values_` for symbolic `m` input as well.


I'll do.



---

archive/issue_comments_478508.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,9 @@\n+The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.\n+\n+---\n+\n+**Old Description**\n+\n I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`\n from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre\n functions / Ferrers functions in SageMath 8.1.\n``````\n",
    "created_at": "2021-04-14T21:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478508",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,9 @@
+The current implementation of `gen_legendre_P` is not accurate. No distinction between Ferrers functions and Legendre functions has been made and some special cases are not correctly implemented. This heavily affects spherical harmonics. For a quick fix, to make spherical harmonics work, I propose to temporarily restrict `gen_legendre_P` to Ferrers functions. In a follow-up #31637, we will make the distinction complete.
+
+---
+
+**Old Description**
+
 I am using the `gen_legendre_P` function (an instance of `Func_assoc_legendre_P`
 from `sage/functions/orthogonal_polys.py`) to evaluate associated Legendre
 functions / Ferrers functions in SageMath 8.1.
``````




---

archive/issue_comments_478509.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-04-14T21:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478509",
    "user": "https://github.com/mjungmath"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_478510.json:
```json
{
    "body": "<a id='comment:39'></a>\nWe need to also be more careful if the type of the output is changing as this can break other code in the wild. It might be good to see how other special functions behave for different inputs to make sure things match if we are going to change stuff.",
    "created_at": "2021-04-15T07:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478510",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'></a>
We need to also be more careful if the type of the output is changing as this can break other code in the wild. It might be good to see how other special functions behave for different inputs to make sure things match if we are going to change stuff.



---

archive/issue_comments_478511.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e\">0b7d917</a></td><td><code>Trac #25034: Turn gen_legendre_P into Ferrers functions only</code></td></tr></table>\n",
    "created_at": "2021-04-17T13:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e">0b7d917</a></td><td><code>Trac #25034: Turn gen_legendre_P into Ferrers functions only</code></td></tr></table>




---

archive/issue_comments_478512.json:
```json
{
    "body": "**Changing commit** from \"[801298c0384e772e3e4ffa52e865b7ae12a97ba7](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)\" to \"[0b7d917305b77064de0ee01282edd732fc8bd02e](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)\".",
    "created_at": "2021-04-17T13:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478512",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[801298c0384e772e3e4ffa52e865b7ae12a97ba7](https://github.com/sagemath/sagetrac-mirror/commit/801298c0384e772e3e4ffa52e865b7ae12a97ba7)" to "[0b7d917305b77064de0ee01282edd732fc8bd02e](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)".



---

archive/issue_comments_478513.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-04-17T13:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478513",
    "user": "https://github.com/mjungmath"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_478514.json:
```json
{
    "body": "<a id='comment:41'></a>\nI had a little chat with Howard Cohl. He said that one has to be *extremely* careful which formula goes under what condition. In particular, one shouldn't use formulas for cases that are not stated in https://dlmf.nist.gov/14.\n\nSo I tried to be very careful and always referred to the corresponding formula in the code. But please double check that for me.\n\nOther than that, this is ready for review again.",
    "created_at": "2021-04-17T13:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478514",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:41'></a>
I had a little chat with Howard Cohl. He said that one has to be *extremely* careful which formula goes under what condition. In particular, one shouldn't use formulas for cases that are not stated in https://dlmf.nist.gov/14.

So I tried to be very careful and always referred to the corresponding formula in the code. But please double check that for me.

Other than that, this is ready for review again.



---

archive/issue_comments_478515.json:
```json
{
    "body": "**Changing commit** from \"[0b7d917305b77064de0ee01282edd732fc8bd02e](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)\" to \"[d203066273fa50d46c13e6bae2f1809d639ac505](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)\".",
    "created_at": "2021-04-17T13:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0b7d917305b77064de0ee01282edd732fc8bd02e](https://github.com/sagemath/sagetrac-mirror/commit/0b7d917305b77064de0ee01282edd732fc8bd02e)" to "[d203066273fa50d46c13e6bae2f1809d639ac505](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)".



---

archive/issue_comments_478516.json:
```json
{
    "body": "<a id='comment:42'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505\">d203066</a></td><td><code>Trac #25034: wrong indent in docstring</code></td></tr></table>\n",
    "created_at": "2021-04-17T13:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505">d203066</a></td><td><code>Trac #25034: wrong indent in docstring</code></td></tr></table>




---

archive/issue_comments_478517.json:
```json
{
    "body": "<a id='comment:43'></a>\nThanks for this work! It's nice that you made references to the DLMF for formulas in the code.\n\nIn the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for\n\n```\n        sage: gen_legendre_P(-5/3,3,1.+I)\n        0.238163715352606 + 0.0548443903534220*I\n```\nin the docstring of `Func_assoc_legendre_P`.",
    "created_at": "2021-04-17T16:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478517",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:43'></a>
Thanks for this work! It's nice that you made references to the DLMF for formulas in the code.

In the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for

```
        sage: gen_legendre_P(-5/3,3,1.+I)
        0.238163715352606 + 0.0548443903534220*I
```
in the docstring of `Func_assoc_legendre_P`.



---

archive/issue_comments_478518.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [egourgoulhon](#comment%3A43):\n> In the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for\n> \n> ```\n>         sage: gen_legendre_P(-5/3,3,1.+I)\n>         0.238163715352606 + 0.0548443903534220*I\n> ```\n> in the docstring of `Func_assoc_legendre_P`.\n\n\nDone.",
    "created_at": "2021-04-17T16:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478518",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:44'></a>
Replying to [egourgoulhon](#comment%3A43):
> In the doctests  *Check whether :trac:`25034` yields correct results compared to Maxima* in `special.py`, shouldn't there be markers `# abs tol 1e-14` ?  Same remark for
> 
> ```
>         sage: gen_legendre_P(-5/3,3,1.+I)
>         0.238163715352606 + 0.0548443903534220*I
> ```
> in the docstring of `Func_assoc_legendre_P`.


Done.



---

archive/issue_comments_478519.json:
```json
{
    "body": "**Reviewer:** Eric Gourgoulhon, Travis Scrimshaw",
    "created_at": "2021-04-17T16:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478519",
    "user": "https://github.com/mjungmath"
}
```

**Reviewer:** Eric Gourgoulhon, Travis Scrimshaw



---

archive/issue_comments_478520.json:
```json
{
    "body": "**Changing commit** from \"[d203066273fa50d46c13e6bae2f1809d639ac505](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)\" to \"[c746088e3d32b359fbacb500bf29fd35a3e33bed](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)\".",
    "created_at": "2021-04-17T16:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d203066273fa50d46c13e6bae2f1809d639ac505](https://github.com/sagemath/sagetrac-mirror/commit/d203066273fa50d46c13e6bae2f1809d639ac505)" to "[c746088e3d32b359fbacb500bf29fd35a3e33bed](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)".



---

archive/issue_comments_478521.json:
```json
{
    "body": "<a id='comment:45'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed\">c746088</a></td><td><code>Trac #25034: add abs tol</code></td></tr></table>\n",
    "created_at": "2021-04-17T16:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478521",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed">c746088</a></td><td><code>Trac #25034: add abs tol</code></td></tr></table>




---

archive/issue_comments_478522.json:
```json
{
    "body": "<a id='comment:46'></a>\nI hope this will make it in Sage 9.3.",
    "created_at": "2021-04-17T16:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478522",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:46'></a>
I hope this will make it in Sage 9.3.



---

archive/issue_comments_478523.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-04-18T10:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478523",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_478524.json:
```json
{
    "body": "<a id='comment:47'></a>\nThanks again! It's great that Sage has decent spherical harmonics at last!\n\nTravis, do you agree with the positive review?",
    "created_at": "2021-04-18T10:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478524",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:47'></a>
Thanks again! It's great that Sage has decent spherical harmonics at last!

Travis, do you agree with the positive review?



---

archive/issue_events_071419.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25034#event-71419"
}
```



---

archive/issue_comments_478525.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-04-19T00:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478525",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_478526.json:
```json
{
    "body": "<a id='comment:49'></a>\nYou have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.\n\nAs per[comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:\n\n```\nsage: gen_legendre_P(x,x,.2)                                                                              \ngen_legendre_P(x, x, 0.200000000000000)\n```\nversus before:\n\n```\n(-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))\n```",
    "created_at": "2021-04-19T00:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478526",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:49'></a>
You have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.

As per[comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:

```
sage: gen_legendre_P(x,x,.2)                                                                              
gen_legendre_P(x, x, 0.200000000000000)
```
versus before:

```
(-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))
```



---

archive/issue_comments_478527.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [tscrim](#comment%3A49):\n> You have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.\n\n\nRight!\n\n> As per[comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:\n> \n> ```\n> sage: gen_legendre_P(x,x,.2)                                                                              \n> gen_legendre_P(x, x, 0.200000000000000)\n> ```\n> versus before:\n> \n> ```\n> (-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))\n> ```\n\n\nThis has nothing to do with removing `_eval_special_values_`. In fact:\n\n```\nsage: assume(x, 'integer')                                                      \nsage: gen_legendre_P(x, x, .2)                                                  \n0.960000000000000^(1/2*x)*(-1)^x*factorial(2*x)/(2^x*factorial(x))\n```\n\nIt is the line\n\n```diff\n+        if m.is_integer() and n.is_integer():\n             ...\n             if m == n:\n```\nthat makes sure that this formula is only used when `x` is an integer.",
    "created_at": "2021-04-19T07:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478527",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:50'></a>
Replying to [tscrim](#comment%3A49):
> You have renamed the public function `eval_poly`, so this need a `deprecated_function_alias`.


Right!

> As per[comment:39](#comment%3A39), I consider this to be a regression because you removed `_eval_special_values_` from `_evalf_`:
> 
> ```
> sage: gen_legendre_P(x,x,.2)                                                                              
> gen_legendre_P(x, x, 0.200000000000000)
> ```
> versus before:
> 
> ```
> (-0.960000000000000)^(1/2*x)*factorial(2*x)/(2^x*factorial(x))
> ```


This has nothing to do with removing `_eval_special_values_`. In fact:

```
sage: assume(x, 'integer')                                                      
sage: gen_legendre_P(x, x, .2)                                                  
0.960000000000000^(1/2*x)*(-1)^x*factorial(2*x)/(2^x*factorial(x))
```

It is the line

```diff
+        if m.is_integer() and n.is_integer():
             ...
             if m == n:
```
that makes sure that this formula is only used when `x` is an integer.



---

archive/issue_comments_478528.json:
```json
{
    "body": "**Changing commit** from \"[c746088e3d32b359fbacb500bf29fd35a3e33bed](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)\" to \"[82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)\".",
    "created_at": "2021-04-19T07:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478528",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c746088e3d32b359fbacb500bf29fd35a3e33bed](https://github.com/sagemath/sagetrac-mirror/commit/c746088e3d32b359fbacb500bf29fd35a3e33bed)" to "[82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)".



---

archive/issue_comments_478529.json:
```json
{
    "body": "<a id='comment:51'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35\">82a447c</a></td><td><code>Trac #25034: eval_poly deprecation + doc improved</code></td></tr></table>\n",
    "created_at": "2021-04-19T07:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35">82a447c</a></td><td><code>Trac #25034: eval_poly deprecation + doc improved</code></td></tr></table>




---

archive/issue_comments_478530.json:
```json
{
    "body": "<a id='comment:52'></a>\nHere we go. Moreover, I have added some examples in the visible doc that show some floating number examples like the one above.",
    "created_at": "2021-04-19T07:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478530",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:52'></a>
Here we go. Moreover, I have added some examples in the visible doc that show some floating number examples like the one above.



---

archive/issue_comments_478531.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-04-19T07:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478531",
    "user": "https://github.com/mjungmath"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_478532.json:
```json
{
    "body": "<a id='comment:54'></a>\nOkay, thanks for the explanation. This will be good. Just a few more minor things:\n\n- `Case `|m| > |n|` for integers:` needs a `::`\n- Add a period at the end of the `.. MATH::` in `eval_gen_poly`.\n- Some formatting: `Evaluate the Ferrers function `P(n, m, x)` for `m` and `n` being concrete`\n- I would move the paragraph `These expressions ... `where |m| \\leq |n|`.` to the main part of the documentation so it is more visible.\n\nOnly the first is a must-do, but the rest are good while-we-are-at-it things.\n\nOnce these are done, it will be a positive review from me.",
    "created_at": "2021-04-20T02:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478532",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:54'></a>
Okay, thanks for the explanation. This will be good. Just a few more minor things:

- `Case `|m| > |n|` for integers:` needs a `::`
- Add a period at the end of the `.. MATH::` in `eval_gen_poly`.
- Some formatting: `Evaluate the Ferrers function `P(n, m, x)` for `m` and `n` being concrete`
- I would move the paragraph `These expressions ... `where |m| \leq |n|`.` to the main part of the documentation so it is more visible.

Only the first is a must-do, but the rest are good while-we-are-at-it things.

Once these are done, it will be a positive review from me.



---

archive/issue_comments_478533.json:
```json
{
    "body": "<a id='comment:55'></a>\nI think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.",
    "created_at": "2021-04-20T03:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478533",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:55'></a>
I think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.



---

archive/issue_comments_478534.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [tscrim](#comment%3A54):\n> - I would move the paragraph `These expressions ... `where |m| \\leq |n|`.` to the main part of the documentation so it is more visible.\n\n\nI agree. However, the documentation of the whole file needs to be refactored imo (see #31636). Thus, I'll leave it there for now.\n\nAs for the rest: thank you for taking such a thorough look! :)",
    "created_at": "2021-04-20T07:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478534",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:56'></a>
Replying to [tscrim](#comment%3A54):
> - I would move the paragraph `These expressions ... `where |m| \leq |n|`.` to the main part of the documentation so it is more visible.


I agree. However, the documentation of the whole file needs to be refactored imo (see #31636). Thus, I'll leave it there for now.

As for the rest: thank you for taking such a thorough look! :)



---

archive/issue_comments_478535.json:
```json
{
    "body": "<a id='comment:57'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526\">0cda09b</a></td><td><code>Trac #25034: formatting + typos</code></td></tr></table>\n",
    "created_at": "2021-04-20T07:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526">0cda09b</a></td><td><code>Trac #25034: formatting + typos</code></td></tr></table>




---

archive/issue_comments_478536.json:
```json
{
    "body": "**Changing commit** from \"[82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)\" to \"[0cda09b4d306be36eda9e634c44a07ca71a38526](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)\".",
    "created_at": "2021-04-20T07:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35](https://github.com/sagemath/sagetrac-mirror/commit/82a447c9bea6e082fbc1ff734ae9c8e5f1de5e35)" to "[0cda09b4d306be36eda9e634c44a07ca71a38526](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)".



---

archive/issue_comments_478537.json:
```json
{
    "body": "**Changing commit** from \"[0cda09b4d306be36eda9e634c44a07ca71a38526](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)\" to \"[0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)\".",
    "created_at": "2021-04-20T07:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0cda09b4d306be36eda9e634c44a07ca71a38526](https://github.com/sagemath/sagetrac-mirror/commit/0cda09b4d306be36eda9e634c44a07ca71a38526)" to "[0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)".



---

archive/issue_comments_478538.json:
```json
{
    "body": "<a id='comment:58'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397\">0b14d02</a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>\n",
    "created_at": "2021-04-20T07:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397">0b14d02</a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>




---

archive/issue_comments_478539.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [gh-DaveWitteMorris](#comment%3A55):\n> I think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.\n\n\nIs that alright?\n\nBranch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397\">0b14d02</a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>\n",
    "created_at": "2021-04-20T07:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478539",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:59'></a>
Replying to [gh-DaveWitteMorris](#comment%3A55):
> I think references should go in the master bibliography file (`src/doc/en/reference/references/index.rst`), instead of the docstring.  See #27497.


Is that alright?

Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397">0b14d02</a></td><td><code>Trac #25034: move reference to master bib</code></td></tr></table>




---

archive/issue_comments_478540.json:
```json
{
    "body": "<a id='comment:60'></a>\nPatchbot is green. :)",
    "created_at": "2021-04-20T17:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478540",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:60'></a>
Patchbot is green. :)



---

archive/issue_comments_478541.json:
```json
{
    "body": "<a id='comment:61'></a>\nLooks like all sufficient conditions for positive review are satisfied.",
    "created_at": "2021-04-20T18:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478541",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>
Looks like all sufficient conditions for positive review are satisfied.



---

archive/issue_comments_478542.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-04-20T18:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478542",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_071420.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-25T12:14:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25034#event-71420"
}
```



---

archive/issue_comments_478543.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2021-04-25T12:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478543",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_478544.json:
```json
{
    "body": "**Changing branch** from \"[public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)\" to \"[0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)\".",
    "created_at": "2021-04-25T12:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478544",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/legendre_25034](https://github.com/sagemath/sagetrac-mirror/tree/public/legendre_25034)" to "[0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)".



---

archive/issue_comments_478545.json:
```json
{
    "body": "<a id='comment:63'></a>\nThank you Matthias! :)",
    "created_at": "2021-04-26T15:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478545",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:63'></a>
Thank you Matthias! :)



---

archive/issue_comments_478546.json:
```json
{
    "body": "**Changing commit** from \"[0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)\" to \"\".",
    "created_at": "2021-04-26T15:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25034#issuecomment-478546",
    "user": "https://github.com/mjungmath"
}
```

**Changing commit** from "[0b14d02cbccf9d46149589acba7ee05dc2f12397](https://github.com/sagemath/sagetrac-mirror/commit/0b14d02cbccf9d46149589acba7ee05dc2f12397)" to "".
