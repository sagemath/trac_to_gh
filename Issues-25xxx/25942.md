# Issue 25942: speedup central orthogonal idempotents for SymmetricGroupAlgebra

archive/issues_025705.json:
```json
{
    "body": "The current implementation of `central_orthogonal_idempotents` is inherited from `FiniteDimensionalSemisimpleAlgebrasWithBasis`. The combinatorial formula in terms of standard tableaux is much faster (implemented as the method `cpis`).\n\nThis ticket does two/four things:\n\n* replaces the default implementation of `central_orthogonal_idempotent/s` with one based on the code in `cpi/s`;\n\n* fixes a bug in `cpi/s`, which assumes base ring contains `QQ`;\n\n* implements primitive central orthogonal idempotents in any characteristic, using Nakayama's Conjecture; \n\n* adds a `deprecated_function_alias` for the nondescriptive `cpi/s` methods.\n\n**CC:**  @tscrim @nthiery @alauve @canozanoguz meeseongim @srdoty\n\n**Keywords:** sagedays@icerm, central idempotents\n\n**Branch/Commit:** [77c38e29a3d15b56e15ffaa19d887619eeedd9d4](https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Mee Seong Im, Aaron Lauve\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25942\n\n",
    "closed_at": "2018-09-10T19:15:11Z",
    "created_at": "2018-07-26T22:34:36Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "speedup central orthogonal idempotents for SymmetricGroupAlgebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25942",
    "user": "https://github.com/MeeSeongIm"
}
```
The current implementation of `central_orthogonal_idempotents` is inherited from `FiniteDimensionalSemisimpleAlgebrasWithBasis`. The combinatorial formula in terms of standard tableaux is much faster (implemented as the method `cpis`).

This ticket does two/four things:

* replaces the default implementation of `central_orthogonal_idempotent/s` with one based on the code in `cpi/s`;

* fixes a bug in `cpi/s`, which assumes base ring contains `QQ`;

* implements primitive central orthogonal idempotents in any characteristic, using Nakayama's Conjecture; 

* adds a `deprecated_function_alias` for the nondescriptive `cpi/s` methods.

**CC:**  @tscrim @nthiery @alauve @canozanoguz meeseongim @srdoty

**Keywords:** sagedays@icerm, central idempotents

**Branch/Commit:** [77c38e29a3d15b56e15ffaa19d887619eeedd9d4](https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4)

**Reviewer:** Travis Scrimshaw

**Author:** Mee Seong Im, Aaron Lauve

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/25942





---

archive/issue_comments_500132.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78de7b5d2eb7d192509d4a1bcff6f8ed31096273\">78de7b5</a></td><td><code>overwrote default implementation of orthogonal idempotents with the faster cpis method.</code></td></tr></table>\n",
    "created_at": "2018-07-26T22:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500132",
    "user": "https://github.com/alauve"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78de7b5d2eb7d192509d4a1bcff6f8ed31096273">78de7b5</a></td><td><code>overwrote default implementation of orthogonal idempotents with the faster cpis method.</code></td></tr></table>




---

archive/issue_comments_500133.json:
```json
{
    "body": "**Branch:** [public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942)",
    "created_at": "2018-07-26T22:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500133",
    "user": "https://github.com/alauve"
}
```

**Branch:** [public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942)



---

archive/issue_comments_500134.json:
```json
{
    "body": "**Commit:** [78de7b5d2eb7d192509d4a1bcff6f8ed31096273](https://github.com/sagemath/sagetrac-mirror/commit/78de7b5d2eb7d192509d4a1bcff6f8ed31096273)",
    "created_at": "2018-07-26T22:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500134",
    "user": "https://github.com/alauve"
}
```

**Commit:** [78de7b5d2eb7d192509d4a1bcff6f8ed31096273](https://github.com/sagemath/sagetrac-mirror/commit/78de7b5d2eb7d192509d4a1bcff6f8ed31096273)



---

archive/issue_comments_500135.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe current implementation (develop branch) comes from `FiniteDimensionalSemisimpleAlgebrasWithBasis` and is quite slow. E.g.,\n\n```\nsage: %time z = SymmetricGroupAlgebra(QQ, 5).central_orthogonal_idempotents()\nCPU times: user 3.04 s, sys: 65.8 ms, total: 3.11 s\nWall time: 3.11 s\n```\n\nOn this branch's ticket, the method `central_orthogonal_idempotents` just points to `cpis`, which is much faster:\n\n```\nsage: %time z = SymmetricGroupAlgebra(QQ, 5).central_orthogonal_idempotents()\nCPU times: user 177 ms, sys: 38.4 ms, total: 215 ms\nWall time: 608 ms\n```",
    "created_at": "2018-07-26T23:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500135",
    "user": "https://github.com/alauve"
}
```

<a id='comment:2'></a>
The current implementation (develop branch) comes from `FiniteDimensionalSemisimpleAlgebrasWithBasis` and is quite slow. E.g.,

```
sage: %time z = SymmetricGroupAlgebra(QQ, 5).central_orthogonal_idempotents()
CPU times: user 3.04 s, sys: 65.8 ms, total: 3.11 s
Wall time: 3.11 s
```

On this branch's ticket, the method `central_orthogonal_idempotents` just points to `cpis`, which is much faster:

```
sage: %time z = SymmetricGroupAlgebra(QQ, 5).central_orthogonal_idempotents()
CPU times: user 177 ms, sys: 38.4 ms, total: 215 ms
Wall time: 608 ms
```



---

archive/issue_comments_500136.json:
```json
{
    "body": "<a id='comment:3'></a>\nMinor change. Needs review.",
    "created_at": "2018-07-26T23:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500136",
    "user": "https://trac.sagemath.org/admin/accounts/users/meeseongim"
}
```

<a id='comment:3'></a>
Minor change. Needs review.



---

archive/issue_comments_500137.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-07-26T23:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500137",
    "user": "https://trac.sagemath.org/admin/accounts/users/meeseongim"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_500138.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-07-26T23:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500138",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_500139.json:
```json
{
    "body": "<a id='comment:4'></a>\nThere is a test failure:\n\n```\nsage -t src/sage/categories/finite_dimensional_semisimple_algebras_with_basis.py\n**********************************************************************\nFile \"src/sage/categories/finite_dimensional_semisimple_algebras_with_basis.py\", line 89, in sage.categories.finite_dimensional_semisimple_algebras_with_basis.FiniteDimensionalSemisimpleAlgebrasWithBasis.ParentMethods.central_orthogonal_idempotents\nFailed example:\n    idempotents\nExpected:\n    (1/6*() + 1/6*(2,3) + 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) + 1/6*(1,3),\n     2/3*() - 1/3*(1,2,3) - 1/3*(1,3,2),\n     1/6*() - 1/6*(2,3) - 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) - 1/6*(1,3))\nGot:\n    [1/6*() + 1/6*(2,3) + 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) + 1/6*(1,3),\n     2/3*() - 1/3*(1,2,3) - 1/3*(1,3,2),\n     1/6*() - 1/6*(2,3) - 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) - 1/6*(1,3)]\n**********************************************************************\n```\nThe test in the file is no longer actually testing the method there. So you need a different semisimple finite-dimensional algebra with a (distinguished) basis.\n\nAlso, for consistency (and speed), you should return a `tuple` for `cpis` and make it an `@cached_method`.",
    "created_at": "2018-07-26T23:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500139",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
There is a test failure:

```
sage -t src/sage/categories/finite_dimensional_semisimple_algebras_with_basis.py
**********************************************************************
File "src/sage/categories/finite_dimensional_semisimple_algebras_with_basis.py", line 89, in sage.categories.finite_dimensional_semisimple_algebras_with_basis.FiniteDimensionalSemisimpleAlgebrasWithBasis.ParentMethods.central_orthogonal_idempotents
Failed example:
    idempotents
Expected:
    (1/6*() + 1/6*(2,3) + 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) + 1/6*(1,3),
     2/3*() - 1/3*(1,2,3) - 1/3*(1,3,2),
     1/6*() - 1/6*(2,3) - 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) - 1/6*(1,3))
Got:
    [1/6*() + 1/6*(2,3) + 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) + 1/6*(1,3),
     2/3*() - 1/3*(1,2,3) - 1/3*(1,3,2),
     1/6*() - 1/6*(2,3) - 1/6*(1,2) + 1/6*(1,2,3) + 1/6*(1,3,2) - 1/6*(1,3)]
**********************************************************************
```
The test in the file is no longer actually testing the method there. So you need a different semisimple finite-dimensional algebra with a (distinguished) basis.

Also, for consistency (and speed), you should return a `tuple` for `cpis` and make it an `@cached_method`.



---

archive/issue_comments_500140.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-07-26T23:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500140",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_500141.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d64660771934181709ebc3b43cbd790a2137954d\">d646607</a></td><td><code>added caching; fixed an error in coefficient computation within cpi method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e6c7ef6bf91335b776b8bf0c36ebff9dd326282\">7e6c7ef</a></td><td><code>work on docstrings</code></td></tr></table>\n",
    "created_at": "2018-07-27T04:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d64660771934181709ebc3b43cbd790a2137954d">d646607</a></td><td><code>added caching; fixed an error in coefficient computation within cpi method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e6c7ef6bf91335b776b8bf0c36ebff9dd326282">7e6c7ef</a></td><td><code>work on docstrings</code></td></tr></table>




---

archive/issue_comments_500142.json:
```json
{
    "body": "**Changing commit** from \"[78de7b5d2eb7d192509d4a1bcff6f8ed31096273](https://github.com/sagemath/sagetrac-mirror/commit/78de7b5d2eb7d192509d4a1bcff6f8ed31096273)\" to \"[7e6c7ef6bf91335b776b8bf0c36ebff9dd326282](https://github.com/sagemath/sagetrac-mirror/commit/7e6c7ef6bf91335b776b8bf0c36ebff9dd326282)\".",
    "created_at": "2018-07-27T04:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500142",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[78de7b5d2eb7d192509d4a1bcff6f8ed31096273](https://github.com/sagemath/sagetrac-mirror/commit/78de7b5d2eb7d192509d4a1bcff6f8ed31096273)" to "[7e6c7ef6bf91335b776b8bf0c36ebff9dd326282](https://github.com/sagemath/sagetrac-mirror/commit/7e6c7ef6bf91335b776b8bf0c36ebff9dd326282)".



---

archive/issue_comments_500143.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhat is the correct way to check for semisimplicity?\n\n(To maintain the old behavior, the method `central_orthogonal_idempotents` shouldn't appear for the user in the bad cases.)",
    "created_at": "2018-07-27T04:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500143",
    "user": "https://github.com/alauve"
}
```

<a id='comment:6'></a>
What is the correct way to check for semisimplicity?

(To maintain the old behavior, the method `central_orthogonal_idempotents` shouldn't appear for the user in the bad cases.)



---

archive/issue_comments_500144.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [alauve](#comment%3A6):\n> What is the correct way to check for semisimplicity?\n\n\nYou will need some form of a mathematical test, but the easiest way is:\n\n```\nsage: S3 = SymmetricGroupAlgebra(QQ, 3)\nsage: S3 in Algebras.Semisimple\nTrue\nsage: S3p = SymmetricGroupAlgebra(GF(3), 3)\nsage: S3p in Algebras.Semisimple\nFalse\n```\n\n> (To maintain the old behavior, the method `central_orthogonal_idempotents` shouldn't appear for the user in the bad cases.)\n\n\nThat is way too difficult and complicated. Just raise a `ValueError` when it is not semisimple in `cpis`.",
    "created_at": "2018-07-27T13:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500144",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Replying to [alauve](#comment%3A6):
> What is the correct way to check for semisimplicity?


You will need some form of a mathematical test, but the easiest way is:

```
sage: S3 = SymmetricGroupAlgebra(QQ, 3)
sage: S3 in Algebras.Semisimple
True
sage: S3p = SymmetricGroupAlgebra(GF(3), 3)
sage: S3p in Algebras.Semisimple
False
```

> (To maintain the old behavior, the method `central_orthogonal_idempotents` shouldn't appear for the user in the bad cases.)


That is way too difficult and complicated. Just raise a `ValueError` when it is not semisimple in `cpis`.



---

archive/issue_comments_500145.json:
```json
{
    "body": "<a id='comment:8'></a>\nUser gh-canozanoguz added.",
    "created_at": "2018-07-27T14:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500145",
    "user": "https://github.com/MeeSeongIm"
}
```

<a id='comment:8'></a>
User gh-canozanoguz added.



---

archive/issue_comments_500146.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [alauve](#comment%3A6):\n> What is the correct way to check for semisimplicity?\n> \n\n\nAn algebra is **semisimple** if the Jacobson radical of the algebra is trivial, and an element x in R is in the **Jacobson radical** of R if 1 + RxR is a unit, or rx is right quasi-regular for all r in R (rx is **right quasi-regular** if there exists an element z in R such that rx + z + rxz = 0).\n\nIf R has an identity element, then rx is right quasi-regular if and only if 1 + rx has a right inverse in R. \n\nHere is an alternative way to check for semisimplicity:\n\n```\nsage: S3 = SymmetricGroupAlgebra(QQ,3)\nsage: S3.radical()\nsage: S3.radical_basis()\n()\nsage: S3p = SymmetricGroupAlgebra(GF(3), 3)\nsage: S3p.radical()\nsage: S3p.radical_basis()\n([1, 2, 3] + 2*[3, 1, 2],\n [1, 3, 2] + 2*[3, 2, 1],\n [2, 1, 3] + 2*[3, 2, 1],\n [2, 3, 1] + 2*[3, 1, 2])\n```",
    "created_at": "2018-07-27T15:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500146",
    "user": "https://trac.sagemath.org/admin/accounts/users/meeseongim"
}
```

<a id='comment:9'></a>
Replying to [alauve](#comment%3A6):
> What is the correct way to check for semisimplicity?
> 


An algebra is **semisimple** if the Jacobson radical of the algebra is trivial, and an element x in R is in the **Jacobson radical** of R if 1 + RxR is a unit, or rx is right quasi-regular for all r in R (rx is **right quasi-regular** if there exists an element z in R such that rx + z + rxz = 0).

If R has an identity element, then rx is right quasi-regular if and only if 1 + rx has a right inverse in R. 

Here is an alternative way to check for semisimplicity:

```
sage: S3 = SymmetricGroupAlgebra(QQ,3)
sage: S3.radical()
sage: S3.radical_basis()
()
sage: S3p = SymmetricGroupAlgebra(GF(3), 3)
sage: S3p.radical()
sage: S3p.radical_basis()
([1, 2, 3] + 2*[3, 1, 2],
 [1, 3, 2] + 2*[3, 2, 1],
 [2, 1, 3] + 2*[3, 2, 1],
 [2, 3, 1] + 2*[3, 1, 2])
```



---

archive/issue_comments_500147.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think Aaron meant more in terms of code. Mathematically, the radical is the way to do it, but when it is known by other (computationally easier)- methods (since this is a group algebra), it is better to do those. Computing the radical can be computationally intensive, so is something generally to be avoided (at least by default).",
    "created_at": "2018-07-27T20:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500147",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
I think Aaron meant more in terms of code. Mathematically, the radical is the way to do it, but when it is known by other (computationally easier)- methods (since this is a group algebra), it is better to do those. Computing the radical can be computationally intensive, so is something generally to be avoided (at least by default).



---

archive/issue_comments_500148.json:
```json
{
    "body": "<a id='comment:11'></a>\nThat's right. I was speaking less about \"how best\" rather than \"how\".\n\nI don't know how the semisimplicity check gets done...\n\nI don't declare the axiom \"Semisimple\" at any point when I run\n\n```\nsage: S3 = SymmetricGroupAlgebra(QQ, 3)\n```\nversus\n\n```\nsage: S3mod = SymmetricGroupAlgebra(GF(3), 3)\n```\nyet somehow Sage knows it. \n\nWhen I browse through the `combinat.symmetric_group_algebra.py` file, I don't see any mention of semisimple. (Nor in the `algebras.group_algebra.py` file, for that matter.) Yet---in the development branch, at least---the method `.central_orthogonal_idempotents` is not made available to the user for `S3mod` but it is made available for `S3`.",
    "created_at": "2018-07-27T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500148",
    "user": "https://github.com/alauve"
}
```

<a id='comment:11'></a>
That's right. I was speaking less about "how best" rather than "how".

I don't know how the semisimplicity check gets done...

I don't declare the axiom "Semisimple" at any point when I run

```
sage: S3 = SymmetricGroupAlgebra(QQ, 3)
```
versus

```
sage: S3mod = SymmetricGroupAlgebra(GF(3), 3)
```
yet somehow Sage knows it. 

When I browse through the `combinat.symmetric_group_algebra.py` file, I don't see any mention of semisimple. (Nor in the `algebras.group_algebra.py` file, for that matter.) Yet---in the development branch, at least---the method `.central_orthogonal_idempotents` is not made available to the user for `S3mod` but it is made available for `S3`.



---

archive/issue_comments_500149.json:
```json
{
    "body": "<a id='comment:12'></a>\nI've made two more changes that I'd like an experienced contributor to chime-in on:\n\n*Change No.1/*\n\nThe method `.cpis` was not cached. Okay, but probably it should be, since `.central_orthogonal_idempotents` was and we're replacing it. However, `.cpis` simply calls `.cpi` for each partition of `_n_`. It seems more natural to cache these.\n\nThat way, when the user wants to study specht modules of hook-shape, or some such (i.e., not ever calling `.cpis`), then s/he would not have to repeat expensive computations.\n\n**Problem:** `.cpi` is happy to receive a list as argument (instead of a proper Partition). But you cannot add `@cached_method` in this case. So, do I:\n\n* cache individual idempotents to be friendly to Professor Hook-Shape, or\n* allow lists as inputs to be friendly to Professor Hook-Shape?\n\n*Change No.2/*\n\nThe `.cpi` code was incorrect, creating expressions with coefficients in `QQ` even if the group algebra was defined over `GF(3)`. \nI have added a check that denominators are not zero, and separately coerced the coefficients into `self.base_ring()`. (Note that some idempotents are well-defined even when the ring is not semisimple, so this seems like a better solution than just disallowing use of `.cpi` in these cases.)",
    "created_at": "2018-07-27T21:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500149",
    "user": "https://github.com/alauve"
}
```

<a id='comment:12'></a>
I've made two more changes that I'd like an experienced contributor to chime-in on:

*Change No.1/*

The method `.cpis` was not cached. Okay, but probably it should be, since `.central_orthogonal_idempotents` was and we're replacing it. However, `.cpis` simply calls `.cpi` for each partition of `_n_`. It seems more natural to cache these.

That way, when the user wants to study specht modules of hook-shape, or some such (i.e., not ever calling `.cpis`), then s/he would not have to repeat expensive computations.

**Problem:** `.cpi` is happy to receive a list as argument (instead of a proper Partition). But you cannot add `@cached_method` in this case. So, do I:

* cache individual idempotents to be friendly to Professor Hook-Shape, or
* allow lists as inputs to be friendly to Professor Hook-Shape?

*Change No.2/*

The `.cpi` code was incorrect, creating expressions with coefficients in `QQ` even if the group algebra was defined over `GF(3)`. 
I have added a check that denominators are not zero, and separately coerced the coefficients into `self.base_ring()`. (Note that some idempotents are well-defined even when the ring is not semisimple, so this seems like a better solution than just disallowing use of `.cpi` in these cases.)



---

archive/issue_comments_500150.json:
```json
{
    "body": "<a id='comment:13'></a>\n> That's right. I was speaking less about \"how best\" rather than \"how\".\n\n\nIn addition, there is the distinction between:\n- Is -- mathematically speaking -- the algebra semisimple?\n- Does Sage know that the algebra is semi-simple?\n\nTravis' suggestion is about the latter, and this is was we want in such situations: based on the current knowledge which algorithm is it best to use.\n\n> I don't know how the semisimplicity check gets done...\n\n\nThe relevant statement is that the algebra of a finite group is semisimple if the characteristic does not divide the order of the group, right? This is thus implemented in Groups.Finite.Algebra. And since one needs to have information about the order of the group, this goes in\n`Groups.Finite.Algebra.ParentMethods.__init_extra__` which is called on any group algebra of a finite group upon it's initialization.",
    "created_at": "2018-07-28T03:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500150",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:13'></a>
> That's right. I was speaking less about "how best" rather than "how".


In addition, there is the distinction between:
- Is -- mathematically speaking -- the algebra semisimple?
- Does Sage know that the algebra is semi-simple?

Travis' suggestion is about the latter, and this is was we want in such situations: based on the current knowledge which algorithm is it best to use.

> I don't know how the semisimplicity check gets done...


The relevant statement is that the algebra of a finite group is semisimple if the characteristic does not divide the order of the group, right? This is thus implemented in Groups.Finite.Algebra. And since one needs to have information about the order of the group, this goes in
`Groups.Finite.Algebra.ParentMethods.__init_extra__` which is called on any group algebra of a finite group upon it's initialization.



---

archive/issue_comments_500151.json:
```json
{
    "body": "<a id='comment:14'></a>\nFrom what you say, Nicolas, I gather this means that one way I could successsfully *not* provide `central_orthogonal_idempotents` in the bad cases is by moving my definition (see the one-line change in commit:\u200b78de7b5) to the end of `__init__`, wrapped in an if statement?:\n\n```\nif self in Algebras.Semisimple:\n    self.central_orthogonal_idempotents = self.cpis\n```",
    "created_at": "2018-07-28T03:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500151",
    "user": "https://github.com/alauve"
}
```

<a id='comment:14'></a>
From what you say, Nicolas, I gather this means that one way I could successsfully *not* provide `central_orthogonal_idempotents` in the bad cases is by moving my definition (see the one-line change in commit:â€‹78de7b5) to the end of `__init__`, wrapped in an if statement?:

```
if self in Algebras.Semisimple:
    self.central_orthogonal_idempotents = self.cpis
```



---

archive/issue_comments_500152.json:
```json
{
    "body": "<a id='comment:15'></a>\nHmm, interesting use case. As long as this is after the `Parent.__init__` (at the end of which the `__init_extra__` methods are called), this would indeed work.\n\nThis is polluting a bit the `__init__` method though. Also we would want to deprecate `cpis` as well.\n\nOne day, we really should have this `@conditionally_defined` attribute.\n\nFor now, I would:\n\n- mv `cpis` to `central_orthogonal_idempotents`\n- make `cpi` a `deprecated_function_alias`\n- raise a ValueError at the beginning of `central_orthogonal_idempotents` if the group algebra is not semisimple",
    "created_at": "2018-07-28T04:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500152",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:15'></a>
Hmm, interesting use case. As long as this is after the `Parent.__init__` (at the end of which the `__init_extra__` methods are called), this would indeed work.

This is polluting a bit the `__init__` method though. Also we would want to deprecate `cpis` as well.

One day, we really should have this `@conditionally_defined` attribute.

For now, I would:

- mv `cpis` to `central_orthogonal_idempotents`
- make `cpi` a `deprecated_function_alias`
- raise a ValueError at the beginning of `central_orthogonal_idempotents` if the group algebra is not semisimple



---

archive/issue_comments_500153.json:
```json
{
    "body": "<a id='comment:16'></a>\nDo you mean to make `cpis` a `deprecated_function_alias` or `cpi`?\n\nI'm inclined to leave `cpi` available (with new name or no), as one can sometimes build these idempotents even when the algebra is not semisimple. (Of course the \"p\"rimitive part is dubious in that case.)",
    "created_at": "2018-07-28T15:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500153",
    "user": "https://github.com/alauve"
}
```

<a id='comment:16'></a>
Do you mean to make `cpis` a `deprecated_function_alias` or `cpi`?

I'm inclined to leave `cpi` available (with new name or no), as one can sometimes build these idempotents even when the algebra is not semisimple. (Of course the "p"rimitive part is dubious in that case.)



---

archive/issue_comments_500154.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [alauve](#comment%3A16):\n> Do you mean to make `cpis` a `deprecated_function_alias` or `cpi`?\n> I'm inclined to leave `cpi` available (with new name or no), as one can sometimes build these idempotents even when the algebra is not semisimple. (Of course the \"p\"rimitive part is dubious in that case.) \n\n\nAgreed: deprecating both cpis and cpi, while renaming the later to something relevant;\nmaybe a name xxx that suggests how it is constructed, which makes it meaningful even\nwhen the algebra is not semisimple.\n\n`central_orthogonal_idempotents` could then return a `LazyFamily(Partitions(n), self.xxx)` in the semi-simple case.",
    "created_at": "2018-07-28T17:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500154",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:17'></a>
Replying to [alauve](#comment%3A16):
> Do you mean to make `cpis` a `deprecated_function_alias` or `cpi`?
> I'm inclined to leave `cpi` available (with new name or no), as one can sometimes build these idempotents even when the algebra is not semisimple. (Of course the "p"rimitive part is dubious in that case.) 


Agreed: deprecating both cpis and cpi, while renaming the later to something relevant;
maybe a name xxx that suggests how it is constructed, which makes it meaningful even
when the algebra is not semisimple.

`central_orthogonal_idempotents` could then return a `LazyFamily(Partitions(n), self.xxx)` in the semi-simple case.



---

archive/issue_comments_500155.json:
```json
{
    "body": "<a id='comment:18'></a>\n(with presumably a cache on xxx; maybe on central_orthogonal_idempotents)",
    "created_at": "2018-07-28T17:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500155",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:18'></a>
(with presumably a cache on xxx; maybe on central_orthogonal_idempotents)



---

archive/issue_comments_500156.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [alauve](#comment%3A11):\n> That's right. I was speaking less about \"how best\" rather than \"how\".\n> \n> I don't know how the semisimplicity check gets done...\n> \n> I don't declare the axiom \"Semisimple\" at any point when I run\n> \n> ```\n> sage: S3 = SymmetricGroupAlgebra(QQ, 3)\n> ```\n> versus\n> \n> ```\n> sage: S3mod = SymmetricGroupAlgebra(GF(3), 3)\n> ```\n> yet somehow Sage knows it. \n\n\nThis is because a finite group algebra can quickly check Maschke's theorem, which is done in the `finite_groups.py` (look for the `Algebras` category's `extra_super_categories`). (Group algebras is too generic as it doesn't special case when it comes from a finite group.)",
    "created_at": "2018-07-29T02:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500156",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Replying to [alauve](#comment%3A11):
> That's right. I was speaking less about "how best" rather than "how".
> 
> I don't know how the semisimplicity check gets done...
> 
> I don't declare the axiom "Semisimple" at any point when I run
> 
> ```
> sage: S3 = SymmetricGroupAlgebra(QQ, 3)
> ```
> versus
> 
> ```
> sage: S3mod = SymmetricGroupAlgebra(GF(3), 3)
> ```
> yet somehow Sage knows it. 


This is because a finite group algebra can quickly check Maschke's theorem, which is done in the `finite_groups.py` (look for the `Algebras` category's `extra_super_categories`). (Group algebras is too generic as it doesn't special case when it comes from a finite group.)



---

archive/issue_comments_500157.json:
```json
{
    "body": "<a id='comment:20'></a>\nYou can also cache things that take an arbitrary input:\n\n```\n@cached_method(key=lambda self,x: _Partitions(x))\ndef cpi(self, foo):\n    # Need to redo the cast as the first was only for the key, not (local) usage\n    foo = _Partitions(foo)\n```",
    "created_at": "2018-07-29T02:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500157",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
You can also cache things that take an arbitrary input:

```
@cached_method(key=lambda self,x: _Partitions(x))
def cpi(self, foo):
    # Need to redo the cast as the first was only for the key, not (local) usage
    foo = _Partitions(foo)
```



---

archive/issue_comments_500158.json:
```json
{
    "body": "<a id='comment:21'></a>\nI don't see why we need to deprecate `cpi/s` and not just keep them as an alias.\n\nAlso, +1 to returning a `Family` indexed by `Partitions(n)`.",
    "created_at": "2018-07-29T02:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500158",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
I don't see why we need to deprecate `cpi/s` and not just keep them as an alias.

Also, +1 to returning a `Family` indexed by `Partitions(n)`.



---

archive/issue_comments_500159.json:
```json
{
    "body": "<a id='comment:22'></a>\n> I don't see why we need to deprecate `cpi/s` and not just keep them as an alias.\n\n\nOh, just because they are incomprehensible names that pollute (a bit) the namespace without helping the discovery the functionalities. If it was a standard shorthand notation in the community that would be different.\n\nCheers",
    "created_at": "2018-07-30T13:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500159",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:22'></a>
> I don't see why we need to deprecate `cpi/s` and not just keep them as an alias.


Oh, just because they are incomprehensible names that pollute (a bit) the namespace without helping the discovery the functionalities. If it was a standard shorthand notation in the community that would be different.

Cheers



---

archive/issue_comments_500160.json:
```json
{
    "body": "**Changing commit** from \"[7e6c7ef6bf91335b776b8bf0c36ebff9dd326282](https://github.com/sagemath/sagetrac-mirror/commit/7e6c7ef6bf91335b776b8bf0c36ebff9dd326282)\" to \"[6e2d52d4276083347ca38d654fd11b0a3a128b29](https://github.com/sagemath/sagetrac-mirror/commit/6e2d52d4276083347ca38d654fd11b0a3a128b29)\".",
    "created_at": "2018-09-01T00:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500160",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7e6c7ef6bf91335b776b8bf0c36ebff9dd326282](https://github.com/sagemath/sagetrac-mirror/commit/7e6c7ef6bf91335b776b8bf0c36ebff9dd326282)" to "[6e2d52d4276083347ca38d654fd11b0a3a128b29](https://github.com/sagemath/sagetrac-mirror/commit/6e2d52d4276083347ca38d654fd11b0a3a128b29)".



---

archive/issue_comments_500161.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44f7d8d0703820f64d8ad07c633b209d917a45e5\">44f7d8d</a></td><td><code>Merge branch 'develop' into public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e2d52d4276083347ca38d654fd11b0a3a128b29\">6e2d52d</a></td><td><code>First draft of implementing Nakayama's Conjecture (now a theorem) to correct</code></td></tr></table>\n",
    "created_at": "2018-09-01T00:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44f7d8d0703820f64d8ad07c633b209d917a45e5">44f7d8d</a></td><td><code>Merge branch 'develop' into public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e2d52d4276083347ca38d654fd11b0a3a128b29">6e2d52d</a></td><td><code>First draft of implementing Nakayama's Conjecture (now a theorem) to correct</code></td></tr></table>




---

archive/issue_comments_500162.json:
```json
{
    "body": "<a id='comment:24'></a>\nCode needs a bit more work, but I think we're on the right track now with the changes in this ticket. \nI still need to read carefully Murphy's proof of Nakayama's Conjecture to be sure I'm defining idempotents correctly (and completely).",
    "created_at": "2018-09-01T00:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500162",
    "user": "https://github.com/alauve"
}
```

<a id='comment:24'></a>
Code needs a bit more work, but I think we're on the right track now with the changes in this ticket. 
I still need to read carefully Murphy's proof of Nakayama's Conjecture to be sure I'm defining idempotents correctly (and completely).



---

archive/issue_comments_500163.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c\">a441a59</a></td><td><code>allow p-cores as input for central_orthogonal_idempotent</code></td></tr></table>\n",
    "created_at": "2018-09-02T13:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c">a441a59</a></td><td><code>allow p-cores as input for central_orthogonal_idempotent</code></td></tr></table>




---

archive/issue_comments_500164.json:
```json
{
    "body": "**Changing commit** from \"[6e2d52d4276083347ca38d654fd11b0a3a128b29](https://github.com/sagemath/sagetrac-mirror/commit/6e2d52d4276083347ca38d654fd11b0a3a128b29)\" to \"[a441a596d549e18f35e810db6b24ad3882e3e37c](https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c)\".",
    "created_at": "2018-09-02T13:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500164",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6e2d52d4276083347ca38d654fd11b0a3a128b29](https://github.com/sagemath/sagetrac-mirror/commit/6e2d52d4276083347ca38d654fd11b0a3a128b29)" to "[a441a596d549e18f35e810db6b24ad3882e3e37c](https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c)".



---

archive/issue_comments_500165.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503\">efa01f7</a></td><td><code>setup deprecated_function_alias</code></td></tr></table>\n",
    "created_at": "2018-09-02T18:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500165",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503">efa01f7</a></td><td><code>setup deprecated_function_alias</code></td></tr></table>




---

archive/issue_comments_500166.json:
```json
{
    "body": "**Changing commit** from \"[a441a596d549e18f35e810db6b24ad3882e3e37c](https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c)\" to \"[efa01f7a9237f179e1b7295060c4eb508d150503](https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503)\".",
    "created_at": "2018-09-02T18:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a441a596d549e18f35e810db6b24ad3882e3e37c](https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c)" to "[efa01f7a9237f179e1b7295060c4eb508d150503](https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503)".



---

archive/issue_comments_500167.json:
```json
{
    "body": "<a id='comment:28'></a>\nI expect this is ready for \"needs_review\" but I'll way to see if anybody has suggestions before toggling it.\n\nThe main result to absorb to understand the changes I've made is \n\n__Murphy (J. Alg., 1983), Theorem 2.8__, which gives a constructive proof of Nakayama's Conjecture.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c\">a441a59</a></td><td><code>allow p-cores as input for central_orthogonal_idempotent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503\">efa01f7</a></td><td><code>setup deprecated_function_alias</code></td></tr></table>\n",
    "created_at": "2018-09-02T19:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500167",
    "user": "https://github.com/alauve"
}
```

<a id='comment:28'></a>
I expect this is ready for "needs_review" but I'll way to see if anybody has suggestions before toggling it.

The main result to absorb to understand the changes I've made is 

__Murphy (J. Alg., 1983), Theorem 2.8__, which gives a constructive proof of Nakayama's Conjecture.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a441a596d549e18f35e810db6b24ad3882e3e37c">a441a59</a></td><td><code>allow p-cores as input for central_orthogonal_idempotent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503">efa01f7</a></td><td><code>setup deprecated_function_alias</code></td></tr></table>




---

archive/issue_comments_500168.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,11 @@\n-the current implementation of `central_orthogonal_idempotents` is inherited from `FiniteDimensionalSemisimpleAlgebrasWithBasis`. The combinatorial formula in terms of standard tableaux is much faster (implemented as the method `cpis`).\n+The current implementation of `central_orthogonal_idempotents` is inherited from `FiniteDimensionalSemisimpleAlgebrasWithBasis`. The combinatorial formula in terms of standard tableaux is much faster (implemented as the method `cpis`).\n+\n+This ticket does two/four things:\n+\n+* replaces the default implementation of `central_orthogonal_idempotent/s` with one based on the code in `cpi/s`;\n+\n+* fixes a bug in `cpi/s`, which assumes base ring contains `QQ`;\n+\n+* implements primitive central orthogonal idempotents in any characteristic, using Nakayama's Conjecture; \n+\n+* adds a `deprecated_function_alias` for the nondescriptive `cpi/s` methods.\n``````\n",
    "created_at": "2018-09-02T19:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500168",
    "user": "https://github.com/alauve"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,11 @@
-the current implementation of `central_orthogonal_idempotents` is inherited from `FiniteDimensionalSemisimpleAlgebrasWithBasis`. The combinatorial formula in terms of standard tableaux is much faster (implemented as the method `cpis`).
+The current implementation of `central_orthogonal_idempotents` is inherited from `FiniteDimensionalSemisimpleAlgebrasWithBasis`. The combinatorial formula in terms of standard tableaux is much faster (implemented as the method `cpis`).
+
+This ticket does two/four things:
+
+* replaces the default implementation of `central_orthogonal_idempotent/s` with one based on the code in `cpi/s`;
+
+* fixes a bug in `cpi/s`, which assumes base ring contains `QQ`;
+
+* implements primitive central orthogonal idempotents in any characteristic, using Nakayama's Conjecture; 
+
+* adds a `deprecated_function_alias` for the nondescriptive `cpi/s` methods.
``````




---

archive/issue_comments_500169.json:
```json
{
    "body": "<a id='comment:30'></a>\nSome comments:\n\n- Why are you not displaying all 3 idempotents in the test you changed in `categories/finite_dimensional_semisimple_algebras_with_basis.py`?\n- You don't need to say `central_orthogonal_idempotents` overrides a generic implementation (if you insist on linking to that, then you should link to the explicit method).\n- In `central_orthogonal_idempotent`, `core` will all be in math mode. I think you should just use `c(\\lambda)`.\n- To better follow conventions:\n\n  ```\n        INPUT:\n\n        - ``la`` -- a partition of ``self.n`` or a\n          ``self.base_ring().characteristic()``-core of such\n          a partition\n\n        - ``block`` -- boolean (default: ``True``); when ``False``,\n          this returns the classical idempotent associated to ``la``\n          (defined over `\\QQ`)\n\n        OUTPUT:\n\n        If ``block=False`` and the corresponding coefficients are\n        not defined over ``self.base_ring()``, then return ``None``.\n        Otherwise return an element of ``self``.\n  ```\n- You can remove the <code>(taking \\`\\`block=False\\`\\`)</code> part as it is clear from the example.\n- I think your error message is better written as\n\n  ```\n  raise ValueError(\"the {1}-core of {0} is not a {1}-core of a partition of {2}\".format(la, p, self.n))\n  ```\n  I don't see the benefit of showing the user `mu`.\n- The `cpi = sum()` should not be in the `try-except` block. Similarly for calling `self._blocks_dictionary()`. That way you are less likely to catch errors that should be propagating up.\n- Better to use `_Partitions` instead of `Partitions()` as the former is already an instance.\n- In the same vein, you probably can just use `_Partitions` as the cache key for `cpi_over_QQ`.\n- Avoid calling `keys()` when you can just iterate over the `dict`.\n- Why are you using `gap` and not `libgap` here:\n\n  ```\n  eval(gap.eval(\"Display(Irr(SymmetricGroup(%d)));\"%n))\n  ```\n  Also, why are you sending it through `eval` and not using the `.sage()` of the GAP objects? Actually, why not just use `SymmetricGroup(n).character_table()`?\n- `cpi_over_QQ` is a function, not a method, so you should use `@cached_function`.\n- The error message in `cpi_over_QQ` says it should be a partition of 4, which doesn't seem correct.\n- You don't need the list of all partitions to get the index. Just get the cardinality `C` and run `{la: C-1-i for i,la in enumerate(Partitions(n))}`.",
    "created_at": "2018-09-05T03:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500169",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>
Some comments:

- Why are you not displaying all 3 idempotents in the test you changed in `categories/finite_dimensional_semisimple_algebras_with_basis.py`?
- You don't need to say `central_orthogonal_idempotents` overrides a generic implementation (if you insist on linking to that, then you should link to the explicit method).
- In `central_orthogonal_idempotent`, `core` will all be in math mode. I think you should just use `c(\lambda)`.
- To better follow conventions:

  ```
        INPUT:

        - ``la`` -- a partition of ``self.n`` or a
          ``self.base_ring().characteristic()``-core of such
          a partition

        - ``block`` -- boolean (default: ``True``); when ``False``,
          this returns the classical idempotent associated to ``la``
          (defined over `\QQ`)

        OUTPUT:

        If ``block=False`` and the corresponding coefficients are
        not defined over ``self.base_ring()``, then return ``None``.
        Otherwise return an element of ``self``.
  ```
- You can remove the <code>(taking \`\`block=False\`\`)</code> part as it is clear from the example.
- I think your error message is better written as

  ```
  raise ValueError("the {1}-core of {0} is not a {1}-core of a partition of {2}".format(la, p, self.n))
  ```
  I don't see the benefit of showing the user `mu`.
- The `cpi = sum()` should not be in the `try-except` block. Similarly for calling `self._blocks_dictionary()`. That way you are less likely to catch errors that should be propagating up.
- Better to use `_Partitions` instead of `Partitions()` as the former is already an instance.
- In the same vein, you probably can just use `_Partitions` as the cache key for `cpi_over_QQ`.
- Avoid calling `keys()` when you can just iterate over the `dict`.
- Why are you using `gap` and not `libgap` here:

  ```
  eval(gap.eval("Display(Irr(SymmetricGroup(%d)));"%n))
  ```
  Also, why are you sending it through `eval` and not using the `.sage()` of the GAP objects? Actually, why not just use `SymmetricGroup(n).character_table()`?
- `cpi_over_QQ` is a function, not a method, so you should use `@cached_function`.
- The error message in `cpi_over_QQ` says it should be a partition of 4, which doesn't seem correct.
- You don't need the list of all partitions to get the index. Just get the cardinality `C` and run `{la: C-1-i for i,la in enumerate(Partitions(n))}`.



---

archive/issue_comments_500170.json:
```json
{
    "body": "<a id='comment:31'></a>\nHi Travis,\n\nMost of your suggestions/questions seem reasonable. I'll get to them soon.\n\nLet me focus here on the gap stuff:\n\n> - Why are you using `gap` and not `libgap` here:\n> \n>   ```\n>   eval(gap.eval(\"Display(Irr(SymmetricGroup(%d)));\"%n))\n>   ```\n>   Also, why are you sending it through `eval` and not using the `.sage()` of the GAP objects? Actually, why not just use `SymmetricGroup(n).character_table()`?\n\n\nI didn't write these lines of code. They are hold-overs from the original `.cpi` method. I'm guessing you expect a speedup from doing things differently? I'm a novice when it comes to interacting with gap. (Stay tuned, there might be a call for help on the horizon.)",
    "created_at": "2018-09-05T03:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500170",
    "user": "https://github.com/alauve"
}
```

<a id='comment:31'></a>
Hi Travis,

Most of your suggestions/questions seem reasonable. I'll get to them soon.

Let me focus here on the gap stuff:

> - Why are you using `gap` and not `libgap` here:
> 
>   ```
>   eval(gap.eval("Display(Irr(SymmetricGroup(%d)));"%n))
>   ```
>   Also, why are you sending it through `eval` and not using the `.sage()` of the GAP objects? Actually, why not just use `SymmetricGroup(n).character_table()`?


I didn't write these lines of code. They are hold-overs from the original `.cpi` method. I'm guessing you expect a speedup from doing things differently? I'm a novice when it comes to interacting with gap. (Stay tuned, there might be a call for help on the horizon.)



---

archive/issue_comments_500171.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [alauve](#comment%3A31):\n> > - Why are you using `gap` and not `libgap` here:\n> > \n> >   ```\n> >   eval(gap.eval(\"Display(Irr(SymmetricGroup(%d)));\"%n))\n> >   ```\n> >   Also, why are you sending it through `eval` and not using the `.sage()` of the GAP objects? Actually, why not just use `SymmetricGroup(n).character_table()`?\n \n> \n> I didn't write these lines of code. They are hold-overs from the original `.cpi` method. I'm guessing you expect a speedup from doing things differently? I'm a novice when it comes to interacting with gap. (Stay tuned, there might be a call for help on the horizon.)\n\n\nUsing `libgap` will definitely be a speedup as it doesn't have to go through a pexpect interface (i.e., convert to/from strings), but it also is cleaner code. Perhaps a better way would be to directly call libgap to avoid more intermediate objects:\n\n```\nsage: [c.sage() for c in libgap.Irr(libgap.SymmetricGroup(4))]\n[[1, -1, 1, 1, -1],\n [3, -1, -1, 0, 1],\n [2, 0, 2, -1, 0],\n [3, 1, -1, 0, -1],\n [1, 1, 1, 1, 1]]\n```",
    "created_at": "2018-09-05T03:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500171",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>
Replying to [alauve](#comment%3A31):
> > - Why are you using `gap` and not `libgap` here:
> > 
> >   ```
> >   eval(gap.eval("Display(Irr(SymmetricGroup(%d)));"%n))
> >   ```
> >   Also, why are you sending it through `eval` and not using the `.sage()` of the GAP objects? Actually, why not just use `SymmetricGroup(n).character_table()`?
 
> 
> I didn't write these lines of code. They are hold-overs from the original `.cpi` method. I'm guessing you expect a speedup from doing things differently? I'm a novice when it comes to interacting with gap. (Stay tuned, there might be a call for help on the horizon.)


Using `libgap` will definitely be a speedup as it doesn't have to go through a pexpect interface (i.e., convert to/from strings), but it also is cleaner code. Perhaps a better way would be to directly call libgap to avoid more intermediate objects:

```
sage: [c.sage() for c in libgap.Irr(libgap.SymmetricGroup(4))]
[[1, -1, 1, 1, -1],
 [3, -1, -1, 0, 1],
 [2, 0, 2, -1, 0],
 [3, 1, -1, 0, -1],
 [1, 1, 1, 1, 1]]
```



---

archive/issue_comments_500172.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0\">15c3139</a></td><td><code>addressing reviewer comments</code></td></tr></table>\n",
    "created_at": "2018-09-05T18:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0">15c3139</a></td><td><code>addressing reviewer comments</code></td></tr></table>




---

archive/issue_comments_500173.json:
```json
{
    "body": "**Changing commit** from \"[efa01f7a9237f179e1b7295060c4eb508d150503](https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503)\" to \"[15c313928def0dfaa909ad698d4f06dd7f8203b0](https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0)\".",
    "created_at": "2018-09-05T18:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[efa01f7a9237f179e1b7295060c4eb508d150503](https://github.com/sagemath/sagetrac-mirror/commit/efa01f7a9237f179e1b7295060c4eb508d150503)" to "[15c313928def0dfaa909ad698d4f06dd7f8203b0](https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0)".



---

archive/issue_comments_500174.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d\">90a2093</a></td><td><code>moving from gap to libgap</code></td></tr></table>\n",
    "created_at": "2018-09-05T19:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d">90a2093</a></td><td><code>moving from gap to libgap</code></td></tr></table>




---

archive/issue_comments_500175.json:
```json
{
    "body": "**Changing commit** from \"[15c313928def0dfaa909ad698d4f06dd7f8203b0](https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0)\" to \"[90a2093b0954fabba6ccc71008af9e2218fe8a0d](https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d)\".",
    "created_at": "2018-09-05T19:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500175",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[15c313928def0dfaa909ad698d4f06dd7f8203b0](https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0)" to "[90a2093b0954fabba6ccc71008af9e2218fe8a0d](https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d)".



---

archive/issue_comments_500176.json:
```json
{
    "body": "<a id='comment:35'></a>\nOkay, libgap seems to be a bit faster:\n\n```\nsage: for n in [3,4, 8,9, 12,13]:\n....:     print n\n....:     print \"gap.eval:\"\n....:     timeit('character_table = eval(gap.eval(\"Display(Irr(SymmetricGroup(%d)));\"%n))')\n....:     print \"libgap:\"\n....:     timeit('_character_table = [c.sage() for c in libgap.Irr(libgap.SymmetricGroup(n))]')\n....:     print\n....:     \n3\ngap.eval:\n5 loops, best of 3: 6.84 ms per loop\nlibgap:\n125 loops, best of 3: 5.52 ms per loop\n\n4\ngap.eval:\n25 loops, best of 3: 7.08 ms per loop\nlibgap:\n25 loops, best of 3: 8.29 ms per loop\n\n8\ngap.eval:\n5 loops, best of 3: 48.3 ms per loop\nlibgap:\n5 loops, best of 3: 49.5 ms per loop\n\n9\ngap.eval:\n5 loops, best of 3: 97.8 ms per loop\nlibgap:\n5 loops, best of 3: 72.6 ms per loop\n\n12\ngap.eval:\n5 loops, best of 3: 971 ms per loop\nlibgap:\n5 loops, best of 3: 273 ms per loop\n\n13\ngap.eval:\n5 loops, best of 3: 3.72 s per loop\nlibgap:\n5 loops, best of 3: 573 ms per loop\n```\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0\">15c3139</a></td><td><code>addressing reviewer comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d\">90a2093</a></td><td><code>moving from gap to libgap</code></td></tr></table>\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0\">15c3139</a></td><td><code>addressing reviewer comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d\">90a2093</a></td><td><code>moving from gap to libgap</code></td></tr></table>\n",
    "created_at": "2018-09-05T19:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500176",
    "user": "https://github.com/alauve"
}
```

<a id='comment:35'></a>
Okay, libgap seems to be a bit faster:

```
sage: for n in [3,4, 8,9, 12,13]:
....:     print n
....:     print "gap.eval:"
....:     timeit('character_table = eval(gap.eval("Display(Irr(SymmetricGroup(%d)));"%n))')
....:     print "libgap:"
....:     timeit('_character_table = [c.sage() for c in libgap.Irr(libgap.SymmetricGroup(n))]')
....:     print
....:     
3
gap.eval:
5 loops, best of 3: 6.84 ms per loop
libgap:
125 loops, best of 3: 5.52 ms per loop

4
gap.eval:
25 loops, best of 3: 7.08 ms per loop
libgap:
25 loops, best of 3: 8.29 ms per loop

8
gap.eval:
5 loops, best of 3: 48.3 ms per loop
libgap:
5 loops, best of 3: 49.5 ms per loop

9
gap.eval:
5 loops, best of 3: 97.8 ms per loop
libgap:
5 loops, best of 3: 72.6 ms per loop

12
gap.eval:
5 loops, best of 3: 971 ms per loop
libgap:
5 loops, best of 3: 273 ms per loop

13
gap.eval:
5 loops, best of 3: 3.72 s per loop
libgap:
5 loops, best of 3: 573 ms per loop
```

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0">15c3139</a></td><td><code>addressing reviewer comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d">90a2093</a></td><td><code>moving from gap to libgap</code></td></tr></table>

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15c313928def0dfaa909ad698d4f06dd7f8203b0">15c3139</a></td><td><code>addressing reviewer comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d">90a2093</a></td><td><code>moving from gap to libgap</code></td></tr></table>




---

archive/issue_comments_500177.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-09-05T19:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500177",
    "user": "https://github.com/alauve"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_500178.json:
```json
{
    "body": "**Changing commit** from \"[90a2093b0954fabba6ccc71008af9e2218fe8a0d](https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d)\" to \"[5b752c4776b13d150f1fc6d60b38220171a7e781](https://github.com/sagemath/sagetrac-mirror/commit/5b752c4776b13d150f1fc6d60b38220171a7e781)\".",
    "created_at": "2018-09-06T00:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[90a2093b0954fabba6ccc71008af9e2218fe8a0d](https://github.com/sagemath/sagetrac-mirror/commit/90a2093b0954fabba6ccc71008af9e2218fe8a0d)" to "[5b752c4776b13d150f1fc6d60b38220171a7e781](https://github.com/sagemath/sagetrac-mirror/commit/5b752c4776b13d150f1fc6d60b38220171a7e781)".



---

archive/issue_comments_500179.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d77425d750529b36af556122def1e28029d658c6\">d77425d</a></td><td><code>Merge branch 'public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942' of git://trac.sagemath.org/sage into public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86bfd328d9d43d9c0cb958e31b6816aa64b9ec21\">86bfd32</a></td><td><code>Changing the caching of SGA central_orthogonal_idempotent(s).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b752c4776b13d150f1fc6d60b38220171a7e781\">5b752c4</a></td><td><code>Some tweaks to the changed test in fin-dim semiseimple algebras w/ basis.</code></td></tr></table>\n",
    "created_at": "2018-09-06T00:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500179",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d77425d750529b36af556122def1e28029d658c6">d77425d</a></td><td><code>Merge branch 'public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942' of git://trac.sagemath.org/sage into public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86bfd328d9d43d9c0cb958e31b6816aa64b9ec21">86bfd32</a></td><td><code>Changing the caching of SGA central_orthogonal_idempotent(s).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b752c4776b13d150f1fc6d60b38220171a7e781">5b752c4</a></td><td><code>Some tweaks to the changed test in fin-dim semiseimple algebras w/ basis.</code></td></tr></table>




---

archive/issue_comments_500180.json:
```json
{
    "body": "<a id='comment:38'></a>\nThe big change I made was that I altered how the caching was done for the idempotents. Specifically, I moved the caching into the SGA itself with a custom cache. Although I also write one that uses `@cached_method` with a slightly intricate `key` to extract the p-core when needed.\n\nAdvantages:\n\n- Things are not permanently nailed in a (non-publically accessible) function cache. So when you stop working with a particular SGA, then it will be garbage collected.\n- You do not have to redo the computation across partitions that have the same p-core.\n- The character table and `indices` does not have to constantly be recomputed across a block.\n- We can work with lower-level objects (e.g., a dict) safely.\n\nDisadvantages:\n\n- The cache of cpi's over **Q** is no longer shared. So if you create a bunch of SGAs with different fields (say, with different characteristics) but with the same n, the **Q** computation will have to be redone for each of the SGAs.\n\nI think the advantages, in particular the better locality of the cache, outweighs the disadvantages. Now we can get around the looks-like-a-memory-leak issue by making the separate function cache a `@weak_cache_function`, but then it is possible (maybe even likely) the results will be GC'ed and then have to be redone.\n\nSome timings:\n\n```\nsage: S3 = SymmetricGroup(10).algebra(GF(3))\nsage: _ = S3._blocks_dictionary  # So this is created and will not affect the timings\nsage: %time idem = S3.central_orthogonal_idempotent([1])\nCPU times: user 1.2 s, sys: 12 ms, total: 1.21 s\nWall time: 1.21 s\nsage: %time idem = S3.central_orthogonal_idempotent([2,1,1])\nCPU times: user 332 ms, sys: 44 ms, total: 376 ms\nWall time: 333 ms\nsage: %time idem = S3.central_orthogonal_idempotent([3,1])\nCPU times: user 416 ms, sys: 36 ms, total: 452 ms\nWall time: 405 ms\n```\nvs caching `_blocks_dictionary` and other optimizations:\n\n```\nsage: %time idem = S3.central_orthogonal_idempotent([1])\nCPU times: user 2.51 s, sys: 248 ms, total: 2.76 s\nWall time: 2.77 s\nsage: %time idem = S3.central_orthogonal_idempotent([2,1,1])\nCPU times: user 1.26 s, sys: 236 ms, total: 1.49 s\nWall time: 1.49 s\nsage: %time idem = S3.central_orthogonal_idempotent([3,1])\nCPU times: user 1.2 s, sys: 192 ms, total: 1.4 s\nWall time: 1.39 s\n```\nvs your branch\n\n```\nsage: %time idem = S3.central_orthogonal_idempotent([1])\nCPU times: user 2.7 s, sys: 260 ms, total: 2.96 s\nWall time: 3 s\nsage: %time idem = S3.central_orthogonal_idempotent([2,1,1])\nCPU times: user 1.84 s, sys: 312 ms, total: 2.15 s\nWall time: 2.15 s\nsage: %time idem = S3.central_orthogonal_idempotent([3,1])\nCPU times: user 1.92 s, sys: 312 ms, total: 2.23 s\nWall time: 2.23 s\n```\n\n---\n\nI also did a bunch of other small fixes and tweaks (in particular, I constructed cubed roots by using a cyclotomic field). If my changes are good, then positive review.",
    "created_at": "2018-09-06T00:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500180",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>
The big change I made was that I altered how the caching was done for the idempotents. Specifically, I moved the caching into the SGA itself with a custom cache. Although I also write one that uses `@cached_method` with a slightly intricate `key` to extract the p-core when needed.

Advantages:

- Things are not permanently nailed in a (non-publically accessible) function cache. So when you stop working with a particular SGA, then it will be garbage collected.
- You do not have to redo the computation across partitions that have the same p-core.
- The character table and `indices` does not have to constantly be recomputed across a block.
- We can work with lower-level objects (e.g., a dict) safely.

Disadvantages:

- The cache of cpi's over **Q** is no longer shared. So if you create a bunch of SGAs with different fields (say, with different characteristics) but with the same n, the **Q** computation will have to be redone for each of the SGAs.

I think the advantages, in particular the better locality of the cache, outweighs the disadvantages. Now we can get around the looks-like-a-memory-leak issue by making the separate function cache a `@weak_cache_function`, but then it is possible (maybe even likely) the results will be GC'ed and then have to be redone.

Some timings:

```
sage: S3 = SymmetricGroup(10).algebra(GF(3))
sage: _ = S3._blocks_dictionary  # So this is created and will not affect the timings
sage: %time idem = S3.central_orthogonal_idempotent([1])
CPU times: user 1.2 s, sys: 12 ms, total: 1.21 s
Wall time: 1.21 s
sage: %time idem = S3.central_orthogonal_idempotent([2,1,1])
CPU times: user 332 ms, sys: 44 ms, total: 376 ms
Wall time: 333 ms
sage: %time idem = S3.central_orthogonal_idempotent([3,1])
CPU times: user 416 ms, sys: 36 ms, total: 452 ms
Wall time: 405 ms
```
vs caching `_blocks_dictionary` and other optimizations:

```
sage: %time idem = S3.central_orthogonal_idempotent([1])
CPU times: user 2.51 s, sys: 248 ms, total: 2.76 s
Wall time: 2.77 s
sage: %time idem = S3.central_orthogonal_idempotent([2,1,1])
CPU times: user 1.26 s, sys: 236 ms, total: 1.49 s
Wall time: 1.49 s
sage: %time idem = S3.central_orthogonal_idempotent([3,1])
CPU times: user 1.2 s, sys: 192 ms, total: 1.4 s
Wall time: 1.39 s
```
vs your branch

```
sage: %time idem = S3.central_orthogonal_idempotent([1])
CPU times: user 2.7 s, sys: 260 ms, total: 2.96 s
Wall time: 3 s
sage: %time idem = S3.central_orthogonal_idempotent([2,1,1])
CPU times: user 1.84 s, sys: 312 ms, total: 2.15 s
Wall time: 2.15 s
sage: %time idem = S3.central_orthogonal_idempotent([3,1])
CPU times: user 1.92 s, sys: 312 ms, total: 2.23 s
Wall time: 2.23 s
```

---

I also did a bunch of other small fixes and tweaks (in particular, I constructed cubed roots by using a cyclotomic field). If my changes are good, then positive review.



---

archive/issue_comments_500181.json:
```json
{
    "body": "**Changing author** from \"Mee Seong Im\" to \"Mee Seong Im, Aaron Lauve\".",
    "created_at": "2018-09-06T00:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500181",
    "user": "https://github.com/tscrim"
}
```

**Changing author** from "Mee Seong Im" to "Mee Seong Im, Aaron Lauve".



---

archive/issue_comments_500182.json:
```json
{
    "body": "<a id='comment:39'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3223375b83ed77021a34ae452a4ac3fa2fc60ab9\">3223375</a></td><td><code>Further optimizations of idempotent computation in positive char.</code></td></tr></table>\n",
    "created_at": "2018-09-06T00:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3223375b83ed77021a34ae452a4ac3fa2fc60ab9">3223375</a></td><td><code>Further optimizations of idempotent computation in positive char.</code></td></tr></table>




---

archive/issue_comments_500183.json:
```json
{
    "body": "**Changing commit** from \"[5b752c4776b13d150f1fc6d60b38220171a7e781](https://github.com/sagemath/sagetrac-mirror/commit/5b752c4776b13d150f1fc6d60b38220171a7e781)\" to \"[3223375b83ed77021a34ae452a4ac3fa2fc60ab9](https://github.com/sagemath/sagetrac-mirror/commit/3223375b83ed77021a34ae452a4ac3fa2fc60ab9)\".",
    "created_at": "2018-09-06T00:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5b752c4776b13d150f1fc6d60b38220171a7e781](https://github.com/sagemath/sagetrac-mirror/commit/5b752c4776b13d150f1fc6d60b38220171a7e781)" to "[3223375b83ed77021a34ae452a4ac3fa2fc60ab9](https://github.com/sagemath/sagetrac-mirror/commit/3223375b83ed77021a34ae452a4ac3fa2fc60ab9)".



---

archive/issue_comments_500184.json:
```json
{
    "body": "<a id='comment:40'></a>\nI ended up seeing another way to get further speed out in positive characteristic: do not compute the cycle types over and over again. This leads to the following timings:\n\n```\nsage: %time idem = S3.central_orthogonal_idempotent([1])\nCPU times: user 360 ms, sys: 36 ms, total: 396 ms\nWall time: 393 ms\nsage: %time idem = S3.central_orthogonal_idempotent([2,1,1])\nCPU times: user 120 ms, sys: 8 ms, total: 128 ms\nWall time: 120 ms\nsage: %time idem = S3.central_orthogonal_idempotent([3,1])\nCPU times: user 192 ms, sys: 24 ms, total: 216 ms\nWall time: 195 ms\n```\n\nPerhaps the best thing to do would be to iterate over the partitions in reverse order and then iterate over the conjugacy classes. However, this is sufficient for now I think as it is already a 10x speedup.",
    "created_at": "2018-09-06T00:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500184",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>
I ended up seeing another way to get further speed out in positive characteristic: do not compute the cycle types over and over again. This leads to the following timings:

```
sage: %time idem = S3.central_orthogonal_idempotent([1])
CPU times: user 360 ms, sys: 36 ms, total: 396 ms
Wall time: 393 ms
sage: %time idem = S3.central_orthogonal_idempotent([2,1,1])
CPU times: user 120 ms, sys: 8 ms, total: 128 ms
Wall time: 120 ms
sage: %time idem = S3.central_orthogonal_idempotent([3,1])
CPU times: user 192 ms, sys: 24 ms, total: 216 ms
Wall time: 195 ms
```

Perhaps the best thing to do would be to iterate over the partitions in reverse order and then iterate over the conjugacy classes. However, this is sufficient for now I think as it is already a 10x speedup.



---

archive/issue_comments_500185.json:
```json
{
    "body": "<a id='comment:41'></a>\nNIce, Travis!\n\nChanges look good to me.",
    "created_at": "2018-09-06T02:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500185",
    "user": "https://github.com/alauve"
}
```

<a id='comment:41'></a>
NIce, Travis!

Changes look good to me.



---

archive/issue_comments_500186.json:
```json
{
    "body": "<a id='comment:42'></a>\nThank you!",
    "created_at": "2018-09-06T02:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500186",
    "user": "https://github.com/alauve"
}
```

<a id='comment:42'></a>
Thank you!



---

archive/issue_comments_500187.json:
```json
{
    "body": "<a id='comment:43'></a>\nI am assuming I should take[comment:41](#comment%3A41) as a positive review. Thank you all.",
    "created_at": "2018-09-06T02:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500187",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>
I am assuming I should take[comment:41](#comment%3A41) as a positive review. Thank you all.



---

archive/issue_comments_500188.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-09-06T02:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500188",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_500189.json:
```json
{
    "body": "<a id='comment:45'></a>\nVarious test failures (run `make ptestlong`)",
    "created_at": "2018-09-08T08:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500189",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:45'></a>
Various test failures (run `make ptestlong`)



---

archive/issue_comments_500190.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2018-09-08T08:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500190",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_500191.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4\">77c38e2</a></td><td><code>Fixing typo in variable name.</code></td></tr></table>\n",
    "created_at": "2018-09-08T10:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4">77c38e2</a></td><td><code>Fixing typo in variable name.</code></td></tr></table>




---

archive/issue_comments_500192.json:
```json
{
    "body": "**Changing commit** from \"[3223375b83ed77021a34ae452a4ac3fa2fc60ab9](https://github.com/sagemath/sagetrac-mirror/commit/3223375b83ed77021a34ae452a4ac3fa2fc60ab9)\" to \"[77c38e29a3d15b56e15ffaa19d887619eeedd9d4](https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4)\".",
    "created_at": "2018-09-08T10:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3223375b83ed77021a34ae452a4ac3fa2fc60ab9](https://github.com/sagemath/sagetrac-mirror/commit/3223375b83ed77021a34ae452a4ac3fa2fc60ab9)" to "[77c38e29a3d15b56e15ffaa19d887619eeedd9d4](https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4)".



---

archive/issue_comments_500193.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-09-08T10:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500193",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_500194.json:
```json
{
    "body": "<a id='comment:47'></a>\nMy fault. Stupid typo in the variable name. Fixed and now all tests pass.",
    "created_at": "2018-09-08T10:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500194",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:47'></a>
My fault. Stupid typo in the variable name. Fixed and now all tests pass.



---

archive/issue_comments_500195.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-09-08T21:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500195",
    "user": "https://trac.sagemath.org/admin/accounts/users/meeseongim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_500196.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-09-10T19:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500196",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_073691.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-10T19:15:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25942#event-73691"
}
```



---

archive/issue_comments_500197.json:
```json
{
    "body": "**Changing branch** from \"[public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942)\" to \"[77c38e29a3d15b56e15ffaa19d887619eeedd9d4](https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4)\".",
    "created_at": "2018-09-10T19:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25942#issuecomment-500197",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_idempotents_for_SymmetricGroupAlgebras_25942)" to "[77c38e29a3d15b56e15ffaa19d887619eeedd9d4](https://github.com/sagemath/sagetrac-mirror/commit/77c38e29a3d15b56e15ffaa19d887619eeedd9d4)".
