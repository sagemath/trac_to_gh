# Issue 21483: Fix some memory allocations in sparse_graph.pyx

archive/issues_021483.json:
```json
{
    "body": "CC:  @jm58660\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21720\n\n",
    "created_at": "2016-10-18T09:07:23Z",
    "labels": [
        "cython",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Fix some memory allocations in sparse_graph.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21483",
    "user": "@jdemeyer"
}
```
CC:  @jm58660



Issue created by migration from https://trac.sagemath.org/ticket/21720





---

archive/issue_comments_298184.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-18T10:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298184",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_298185.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-18T10:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298185",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_298186.json:
```json
{
    "body": "I don't know enough cython to review this, but at least it seems to work. With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`, with `2` the error message is `MemoryError: failed to allocate 1342177280 * 8 bytes`.",
    "created_at": "2016-10-18T13:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298186",
    "user": "@jm58660"
}
```

I don't know enough cython to review this, but at least it seems to work. With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`, with `2` the error message is `MemoryError: failed to allocate 1342177280 * 8 bytes`.



---

archive/issue_comments_298187.json:
```json
{
    "body": "Btw, is there same problem for example in `src/sage/combinat/degree_sequences.pyx`\n\n\n```\n    sig_on()\n    seq = <unsigned char *> sig_malloc((n+1)*sizeof(unsigned char))\n    memset(seq,0,(n+1)*sizeof(unsigned char))\n    sig_off()\n```\n\n\n?",
    "created_at": "2016-10-18T14:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298187",
    "user": "@jm58660"
}
```

Btw, is there same problem for example in `src/sage/combinat/degree_sequences.pyx`


```
    sig_on()
    seq = <unsigned char *> sig_malloc((n+1)*sizeof(unsigned char))
    memset(seq,0,(n+1)*sizeof(unsigned char))
    sig_off()
```


?



---

archive/issue_comments_298188.json:
```json
{
    "body": "I can't fix all problems in Sage...",
    "created_at": "2016-10-18T14:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298188",
    "user": "@jdemeyer"
}
```

I can't fix all problems in Sage...



---

archive/issue_comments_298189.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> I can't fix all problems in Sage...\n\nI know... But will it help someone if I open a ticket and search other uses of unnecessay `memset`?",
    "created_at": "2016-10-18T14:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298189",
    "user": "@jm58660"
}
```

Replying to [comment:10 jdemeyer]:
> I can't fix all problems in Sage...

I know... But will it help someone if I open a ticket and search other uses of unnecessay `memset`?



---

archive/issue_comments_298190.json:
```json
{
    "body": "Replying to [comment:11 jmantysalo]:\n> Replying to [comment:10 jdemeyer]:\n> > I can't fix all problems in Sage...\n> \n> I know... But will it help someone if I open a ticket and search other uses of unnecessay `memset`?\n\nTo be honest... unless you plan to fix it yourself, there is probably not much point.",
    "created_at": "2016-10-18T14:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298190",
    "user": "@jdemeyer"
}
```

Replying to [comment:11 jmantysalo]:
> Replying to [comment:10 jdemeyer]:
> > I can't fix all problems in Sage...
> 
> I know... But will it help someone if I open a ticket and search other uses of unnecessay `memset`?

To be honest... unless you plan to fix it yourself, there is probably not much point.



---

archive/issue_comments_298191.json:
```json
{
    "body": "Replying to [comment:8 jmantysalo]:\n> With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`\n\nWhat is \"it\" in the sentence above?",
    "created_at": "2016-10-18T15:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298191",
    "user": "@jdemeyer"
}
```

Replying to [comment:8 jmantysalo]:
> With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`

What is "it" in the sentence above?



---

archive/issue_comments_298192.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Replying to [comment:8 jmantysalo]:\n> > With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`\n> \n> What is \"it\" in the sentence above?\n\nError message.",
    "created_at": "2016-10-18T15:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298192",
    "user": "@jm58660"
}
```

Replying to [comment:13 jdemeyer]:
> Replying to [comment:8 jmantysalo]:
> > With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`
> 
> What is "it" in the sentence above?

Error message.



---

archive/issue_comments_298193.json:
```json
{
    "body": "Replying to [comment:14 jmantysalo]:\n> Replying to [comment:13 jdemeyer]:\n> > Replying to [comment:8 jmantysalo]:\n> > > With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`\n> > \n> > What is \"it\" in the sentence above?\n> \n> Error message.\n\nThe error message when doing *what*?",
    "created_at": "2016-10-18T15:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298193",
    "user": "@jdemeyer"
}
```

Replying to [comment:14 jmantysalo]:
> Replying to [comment:13 jdemeyer]:
> > Replying to [comment:8 jmantysalo]:
> > > With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`
> > 
> > What is "it" in the sentence above?
> 
> Error message.

The error message when doing *what*?



---

archive/issue_comments_298194.json:
```json
{
    "body": "Uh, sorry. I tested `Graph(10^10)`, but wrote that only in sage-devel, not here.",
    "created_at": "2016-10-18T15:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298194",
    "user": "@jm58660"
}
```

Uh, sorry. I tested `Graph(10^10)`, but wrote that only in sage-devel, not here.



---

archive/issue_comments_298195.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Replying to [comment:8 jmantysalo]:\n> > With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`\n\nBy the way, this number shows that some integer overflow is happening also (a different issue from this ticket).\n\nThe number 18446744072098938880 equals `<size_t><int>(10 << 28)` where the correct value would be just `<size_t>(10 << 28)` = 2684354560.",
    "created_at": "2016-10-18T20:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298195",
    "user": "@jdemeyer"
}
```

Replying to [comment:13 jdemeyer]:
> Replying to [comment:8 jmantysalo]:
> > With `/proc/sys/vm/overcommit_memory` as `0` or `1` it ends with `MemoryError: failed to allocate 18446744072098938880 * 8 bytes`

By the way, this number shows that some integer overflow is happening also (a different issue from this ticket).

The number 18446744072098938880 equals `<size_t><int>(10 << 28)` where the correct value would be just `<size_t>(10 << 28)` = 2684354560.



---

archive/issue_comments_298196.json:
```json
{
    "body": "Please review...",
    "created_at": "2016-11-02T11:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298196",
    "user": "@jdemeyer"
}
```

Please review...



---

archive/issue_comments_298197.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-02T12:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298197",
    "user": "@mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_298198.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-07T18:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21483#issuecomment-298198",
    "user": "@vbraun"
}
```

Resolution: fixed
