# Issue 20392: some absolute imports in the rings folder

Issue created by migration from https://trac.sagemath.org/ticket/20629

Original creator: chapoton

Original creation time: 2016-05-19 13:08:46

CC:  jdemeyer embray tscrim

convert some of the files in the rings folder to absolute import.

a small step towards py3


---

Comment by chapoton created at 2016-05-19 13:09:09

New commits:


---

Comment by chapoton created at 2016-05-19 13:09:09

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-05-19 13:27:33

Do we really need this in `src/sage/rings/asymptotic/__init__.py` and `src/sage/rings/semirings/__init__.py`, why aren't these files just empty?

```
from __future__ import absolute_import

from . import all
```



---

Comment by git created at 2016-05-19 13:28:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-05-19 13:29:52

Style issue: better use

```
from .padic_base_leaves import (pAdicRingCappedRelative,
        pAdicRingCappedAbsolute, pAdicRingFixedMod,
        pAdicFieldCappedRelative)
```

instead of

```
from .padic_base_leaves import pAdicRingCappedRelative, \
                               pAdicRingCappedAbsolute, \
                               pAdicRingFixedMod, \
                               pAdicFieldCappedRelative
```



---

Comment by jdemeyer created at 2016-05-19 13:31:15

Question: why do you only consider Python (`.py`) files and not Cython (`.pyx`)? I'm NOT saying that you should do this in this ticket, just asking why...


---

Comment by git created at 2016-05-19 13:31:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-05-19 13:32:56

Replying to [comment:5 jdemeyer]:
> Question: why do you only consider Python (`.py`) files and not Cython (`.pyx`)? I'm NOT saying that you should do this in this ticket, just asking why...

oh, I just made a grep restricted to py files. Anyway, this is only a very partial change.


---

Comment by jdemeyer created at 2016-05-19 13:43:16

positive_review if this passes buildbot testing


---

Comment by chapoton created at 2016-05-19 17:21:32

Hum, it seems that there is a problem with the *correct* python3 syntax

```
from . import rational
```

when the module `rational` is a cython module.

Is there some cython expert in the neighborhood ?


---

Comment by jdemeyer created at 2016-05-19 18:03:19

I don't know if it's really a Cython problem.


---

Comment by chapoton created at 2016-05-19 18:39:28

maybe a circular dependency ?


---

Comment by chapoton created at 2016-05-20 15:32:23

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2016-05-20 15:32:23

It seems that this involves some kind of circular import hell.


---

Comment by jdemeyer created at 2016-05-20 16:34:47

Probably, although it's not clear why something would fail as relative import but not as normal import...


---

Comment by git created at 2016-05-24 18:35:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-24 19:20:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-05-24 19:26:39

After a long battling against the import hell in the rings folder, I think I have now a working branch.

Review, please !


---

Comment by chapoton created at 2016-05-24 19:26:39

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-05-25 06:20:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-25 09:23:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-05-25 10:03:44

ok, let me put this in `needs_works`, as there is still some failing doctests. This is a tricky ticket.


---

Comment by chapoton created at 2016-05-25 10:03:44

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-05-25 13:53:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-25 18:20:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-05-26 06:13:24

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-05-26 06:13:24

hurray ! bot is green ! Please review


---

Comment by tscrim created at 2016-05-26 06:24:13

One of the reasons why you might have started to see the import hell is that you imported a few things directly from the modules, rather than importing the entire module. In order to do the former, Python needs to evaluate the module at the moment you call the `from foo import bar`, whereas the latter is done when first calling `foo.bar` (not at `import foo`). This is why the "Pythonic" way is to `import foo` and then do `foo.bar`, but IMO, it just means we have to do more reading and/or work for maintenance.


---

Comment by chapoton created at 2016-05-26 06:33:56

Hmm, not sure I understand your conclusion. Did I do something "wrong" ? Should we try to use `import foo` as much as possible, or the contrary ?

I just started wanting to convert to python3-compatible imports, and then had to resolve
a whole lot of circular imports. I did that by moving some imports inside functions, instead
of being on top of the files.


---

Comment by tscrim created at 2016-05-26 07:05:28

Replying to [comment:24 chapoton]:
> Hmm, not sure I understand your conclusion. Did I do something "wrong" ? Should we try to use `import foo` as much as possible, or the contrary ?

Well...there's my diagnosis of what might have caused the problem, and the "pythonic" treatment. However, I disagree with it being the best way to fix things.

> I just started wanting to convert to python3-compatible imports, and then had to resolve
> a whole lot of circular imports. I did that by moving some imports inside functions, instead
> of being on top of the files.

I think you did the right thing. Moreover, this is in agreement with what we normally do in Sage. Does that clarify things?


---

Comment by chapoton created at 2016-05-28 19:28:04

ping ?


---

Comment by chapoton created at 2016-06-01 08:04:26

*ping* ?


---

Comment by tscrim created at 2016-06-01 13:20:26

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-06-01 13:20:26

Changing keywords from "" to "days74".


---

Comment by vbraun created at 2016-06-01 21:56:48

Sage doesn't start with patch

```

/home/release/Sage/local/lib/python2.7/site-packages/sage/rings/rational_field.py in <module>()
     41     True
     42 
     43 AUTHORS:
     44 
     45 - Niles Johnson (2010-08): :trac:`3893`: ``random_element()`` should pass on
     46   ``*args`` and ``**kwds``.
     47 
     48 - Travis Scrimshaw (2012-10-18): Added additional docstrings for full coverage.
     49   Removed duplicates of ``discriminant()`` and ``signature()``.
     50 
     51 """
     52 from __future__ import print_function, absolute_import
     53 
     54 from .rational import Rational
     55 from .integer import Integer
---> 56 from . import infinity
        global infinity = undefined
     57 ZZ = None
     58 
     59 from sage.structure.parent_gens import ParentWithGens
     60 import sage.rings.number_field.number_field_base as number_field_base
     61 from sage.misc.fast_methods import Singleton
     62 
     63 class RationalField(Singleton, number_field_base.NumberField):
     64     r"""
     65     The class ``RationalField`` represents the field `\QQ` of rational numbers.
     66 
     67     EXAMPLES::
     68 
     69         sage: a = long(901824309821093821093812093810928309183091832091)
     70         sage: b = QQ(a); b
     71         901824309821093821093812093810928309183091832091

ImportError: cannot import name infinity
```



---

Comment by vbraun created at 2016-06-01 21:56:48

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2016-06-02 06:52:04

I do not see this. And two bots were green. Maybe a conflict with another ticket ?


---

Comment by jdemeyer created at 2016-06-08 13:58:37

I moved the working part of this branch to #20785. That reduces the problematic part, which can then be investigated more easily.


---

Comment by jdemeyer created at 2016-06-08 15:28:38

I suggest to wait until #20785 is merged and then look at this again.


---

Comment by git created at 2016-06-13 20:16:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-06-21 15:50:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-06-21 15:51:04

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-06-24 16:18:06

bot is green ! *ping* ?


---

Comment by tscrim created at 2016-06-24 16:53:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-06-26 07:30:39

Resolution: fixed


---

Comment by embray created at 2016-06-27 08:53:31

Hah, wish I had seen this ticket earlier.  I hit this the other day and thought it was just me.  Thanks!
