# Issue 32622: Wrong display from type() with %display latex

archive/issues_032622.json:
```json
{
    "body": "CC:  @kwankyu\n\nKeywords: jupyter display latex\n\nIn Sage 9.4 and 9.5.beta5, the following cell of a Jupyter notebook\n\n```\n%display latex\ntype(x)\n```\n\nresults in \n\n```\n\\[\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\verb||\\]\n```\n\ninstead of \n\n```\n<\ud835\ude8c\ud835\ude95\ud835\ude8a\ud835\ude9c\ud835\ude9c'\ud835\ude9c\ud835\ude8a\ud835\ude90\ud835\ude8e.\ud835\ude9c\ud835\udea2\ud835\ude96\ud835\ude8b\ud835\ude98\ud835\ude95\ud835\ude92\ud835\ude8c.\ud835\ude8e\ud835\udea1\ud835\ude99\ud835\ude9b\ud835\ude8e\ud835\ude9c\ud835\ude9c\ud835\ude92\ud835\ude98\ud835\ude97.\ud835\ude74\ud835\udea1\ud835\ude99\ud835\ude9b\ud835\ude8e\ud835\ude9c\ud835\ude9c\ud835\ude92\ud835\ude98\ud835\ude97'>\n```\n\nEverything is OK with Sage <= 9.3. \n\nIssue created by migration from https://trac.sagemath.org/ticket/32859\n\n",
    "created_at": "2021-11-12T12:23:06Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Wrong display from type() with %display latex",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32622",
    "user": "https://github.com/egourgoulhon"
}
```
CC:  @kwankyu

Keywords: jupyter display latex

In Sage 9.4 and 9.5.beta5, the following cell of a Jupyter notebook

```
%display latex
type(x)
```

results in 

```
\[\newcommand{\Bold}[1]{\mathbf{#1}}\verb||\]
```

instead of 

```
<ðšŒðš•ðšŠðšœðšœ'ðšœðšŠðšðšŽ.ðšœðš¢ðš–ðš‹ðš˜ðš•ðš’ðšŒ.ðšŽðš¡ðš™ðš›ðšŽðšœðšœðš’ðš˜ðš—.ð™´ðš¡ðš™ðš›ðšŽðšœðšœðš’ðš˜ðš—'>
```

Everything is OK with Sage <= 9.3. 

Issue created by migration from https://trac.sagemath.org/ticket/32859





---

archive/issue_comments_464717.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T14:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464718.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-12T14:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464718",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_464719.json:
```json
{
    "body": "The fix for this ticket is this part:\n\n\n```diff\n--- a/src/sage/misc/html.py\n+++ b/src/sage/misc/html.py\n@@ -351,15 +351,16 @@ class MathJax:\n             [_Latex_prefs._option['macros']] +\n             parts\n         )\n+        mathjax_string = latex_string.replace('<', '&lt;')\n         if mode == 'display':\n             html = r'<html>\\[{0}\\]</html>'\n         elif mode == 'inline':\n             html = r'<html>\\({0}\\)</html>'\n         elif mode == 'plain':\n-            return latex_string\n+            return mathjax_string\n         else:\n             raise ValueError(\"mode must be either 'display', 'inline', or 'plain'\")\n-        return MathJaxExpr(html.format(latex_string))\n+        return MathJaxExpr(html.format(mathjax_string))\n \n \n class HTMLFragmentFactory(SageObject):\ndiff --git a/src/sage/repl/rich_output/output_browser.py b/src/sage/repl/rich_output/output_browser.py\nindex 2746e3dff8..3d7cda599a 100644\n--- a/src/sage/repl/rich_output/output_browser.py\n+++ b/src/sage/repl/rich_output/output_browser.py\n@@ -40,10 +40,12 @@ class OutputHtml(OutputBase):\n         # pdf export of a notebook\n         m = latex_re.match(html)\n         if m:\n+            mathjax_string = m.group('latex')\n+            latex_string = mathjax_string.replace('&lt;', '<')\n             if m.group('mathstart') == r'\\[' and m.group('mathend') == r'\\]':\n-                self.latex = OutputBuffer('$$' + m.group('latex') + '$$')\n+                self.latex = OutputBuffer('$$' + latex_string + '$$')\n             else:\n-                self.latex = OutputBuffer('$' + m.group('latex') + '$')\n+                self.latex = OutputBuffer('$' + latex_string + '$')\n```\n",
    "created_at": "2021-11-12T14:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464719",
    "user": "https://github.com/kwankyu"
}
```

The fix for this ticket is this part:


```diff
--- a/src/sage/misc/html.py
+++ b/src/sage/misc/html.py
@@ -351,15 +351,16 @@ class MathJax:
             [_Latex_prefs._option['macros']] +
             parts
         )
+        mathjax_string = latex_string.replace('<', '&lt;')
         if mode == 'display':
             html = r'<html>\[{0}\]</html>'
         elif mode == 'inline':
             html = r'<html>\({0}\)</html>'
         elif mode == 'plain':
-            return latex_string
+            return mathjax_string
         else:
             raise ValueError("mode must be either 'display', 'inline', or 'plain'")
-        return MathJaxExpr(html.format(latex_string))
+        return MathJaxExpr(html.format(mathjax_string))
 
 
 class HTMLFragmentFactory(SageObject):
diff --git a/src/sage/repl/rich_output/output_browser.py b/src/sage/repl/rich_output/output_browser.py
index 2746e3dff8..3d7cda599a 100644
--- a/src/sage/repl/rich_output/output_browser.py
+++ b/src/sage/repl/rich_output/output_browser.py
@@ -40,10 +40,12 @@ class OutputHtml(OutputBase):
         # pdf export of a notebook
         m = latex_re.match(html)
         if m:
+            mathjax_string = m.group('latex')
+            latex_string = mathjax_string.replace('&lt;', '<')
             if m.group('mathstart') == r'\[' and m.group('mathend') == r'\]':
-                self.latex = OutputBuffer('$$' + m.group('latex') + '$$')
+                self.latex = OutputBuffer('$$' + latex_string + '$$')
             else:
-                self.latex = OutputBuffer('$' + m.group('latex') + '$')
+                self.latex = OutputBuffer('$' + latex_string + '$')
```




---

archive/issue_comments_464720.json:
```json
{
    "body": "But I merged the branch of #32208 to the present branch, in order to also fix pdf export problem of the example\n\n```\n%display latex\ntype(x)\n```\n\nof this ticket.",
    "created_at": "2021-11-12T14:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464720",
    "user": "https://github.com/kwankyu"
}
```

But I merged the branch of #32208 to the present branch, in order to also fix pdf export problem of the example

```
%display latex
type(x)
```

of this ticket.



---

archive/issue_comments_464721.json:
```json
{
    "body": "As always, please watch for any unexpected side effects in display and printing...",
    "created_at": "2021-11-12T14:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464721",
    "user": "https://github.com/kwankyu"
}
```

As always, please watch for any unexpected side effects in display and printing...



---

archive/issue_comments_464722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T14:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464723.json:
```json
{
    "body": "Thank you very much for the prompt fix! I am setting #32208 as a dependency because of comment:6 and I am going to test both tickets.",
    "created_at": "2021-11-13T10:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464723",
    "user": "https://github.com/egourgoulhon"
}
```

Thank you very much for the prompt fix! I am setting #32208 as a dependency because of comment:6 and I am going to test both tickets.



---

archive/issue_comments_464724.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-11-13T10:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464724",
    "user": "https://github.com/egourgoulhon"
}
```

Changing priority from major to critical.



---

archive/issue_comments_464725.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-13T13:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464725",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464726.json:
```json
{
    "body": "As for #32208, I've tested the fix with these notebooks: [test_display_latex](https://nbviewer.org/github/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb), [SM_Kerr_surfaces](https://nbviewer.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr_surfaces.ipynb) and [SM_spheres_S2](https://nbviewer.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S2.ipynb). Everything seems OK. Thank you very much.",
    "created_at": "2021-11-13T13:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464726",
    "user": "https://github.com/egourgoulhon"
}
```

As for #32208, I've tested the fix with these notebooks: [test_display_latex](https://nbviewer.org/github/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb), [SM_Kerr_surfaces](https://nbviewer.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr_surfaces.ipynb) and [SM_spheres_S2](https://nbviewer.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S2.ipynb). Everything seems OK. Thank you very much.



---

archive/issue_comments_464727.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-11-13T23:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464727",
    "user": "https://github.com/kwankyu"
}
```

Thank you.



---

archive/issue_comments_464728.json:
```json
{
    "body": "This is an off-topic, but your notebooks show latex expressions flush left. As far as I know, latex expressions are displayed centered by default. I don't know how you did it. Anyway, I think latex expressions should be shown flush left by default. What do you think?",
    "created_at": "2021-11-13T23:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464728",
    "user": "https://github.com/kwankyu"
}
```

This is an off-topic, but your notebooks show latex expressions flush left. As far as I know, latex expressions are displayed centered by default. I don't know how you did it. Anyway, I think latex expressions should be shown flush left by default. What do you think?



---

archive/issue_comments_464729.json:
```json
{
    "body": "Replying to [comment:12 klee]:\n> This is an off-topic, but your notebooks show latex expressions flush left. As far as I know, latex expressions are displayed centered by default. I don't know how you did it. \n\nI did nothing special. Latex expressions have always been flushed left on my notebooks since the introduction of Jupyter in Sage. Are they centered on your computer? The only thing I've noticed is that when run on CoCalc, the very same notebook has latex expression centered, see e.g. this [example](https://cocalc.com/share/public_paths/6850015be0320058cadba1ce63e7a3eedf4eef89).\n>Anyway, I think latex expressions should be shown flush left by default. What do you think?\nI don't have any strong opinion on that, but I agree with you: flush left is usually what we have in published articles.",
    "created_at": "2021-11-14T08:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464729",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:12 klee]:
> This is an off-topic, but your notebooks show latex expressions flush left. As far as I know, latex expressions are displayed centered by default. I don't know how you did it. 

I did nothing special. Latex expressions have always been flushed left on my notebooks since the introduction of Jupyter in Sage. Are they centered on your computer? The only thing I've noticed is that when run on CoCalc, the very same notebook has latex expression centered, see e.g. this [example](https://cocalc.com/share/public_paths/6850015be0320058cadba1ce63e7a3eedf4eef89).
>Anyway, I think latex expressions should be shown flush left by default. What do you think?
I don't have any strong opinion on that, but I agree with you: flush left is usually what we have in published articles.



---

archive/issue_comments_464730.json:
```json
{
    "body": "Replying to [comment:13 egourgoulhon]:\n> I did nothing special. Latex expressions have always been flushed left on my notebooks since the introduction of Jupyter in Sage. Are they centered on your computer? \n\nYes. It is mysterious to me since I know that latex expressions are centered because they are enclosed by `\\[...\\]`.\n\n> >Anyway, I think latex expressions should be shown flush left by default. What do you think?\n> I don't have any strong opinion on that, but I agree with you: flush left is usually what we have in published articles.\n\nOkay. Thank you.",
    "created_at": "2021-11-14T10:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464730",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:13 egourgoulhon]:
> I did nothing special. Latex expressions have always been flushed left on my notebooks since the introduction of Jupyter in Sage. Are they centered on your computer? 

Yes. It is mysterious to me since I know that latex expressions are centered because they are enclosed by `\[...\]`.

> >Anyway, I think latex expressions should be shown flush left by default. What do you think?
> I don't have any strong opinion on that, but I agree with you: flush left is usually what we have in published articles.

Okay. Thank you.



---

archive/issue_comments_464731.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-11-14T17:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464731",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_464732.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-11-14T17:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464732",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_464733.json:
```json
{
    "body": "Replying to [comment:14 klee]:\n> Replying to [comment:13 egourgoulhon]:\n> > I did nothing special. Latex expressions have always been flushed left on my notebooks since the introduction of Jupyter in Sage. Are they centered on your computer? \n> \n> Yes. It is mysterious to me since I know that latex expressions are centered because they are enclosed by `\\[...\\]`.\nThis is strange indeed... Maybe it's a matter of OS? What is yours? Mine is Ubuntu 20.04. I've always had flushed left expressions on all the computers I've used (all running various versions of Ubuntu). It could also be related to the locale (fr_FR in my case). The centered rendering on CoCalc does not surprise me further because their Jupyter is somehow customized.",
    "created_at": "2021-11-14T20:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464733",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:14 klee]:
> Replying to [comment:13 egourgoulhon]:
> > I did nothing special. Latex expressions have always been flushed left on my notebooks since the introduction of Jupyter in Sage. Are they centered on your computer? 
> 
> Yes. It is mysterious to me since I know that latex expressions are centered because they are enclosed by `\[...\]`.
This is strange indeed... Maybe it's a matter of OS? What is yours? Mine is Ubuntu 20.04. I've always had flushed left expressions on all the computers I've used (all running various versions of Ubuntu). It could also be related to the locale (fr_FR in my case). The centered rendering on CoCalc does not surprise me further because their Jupyter is somehow customized.



---

archive/issue_comments_464734.json:
```json
{
    "body": "Replying to [comment:15 vbraun]:\n> Merge conflict\nI guess we have to wait for 9.5.beta7 to solve that one.",
    "created_at": "2021-11-14T20:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464734",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:15 vbraun]:
> Merge conflict
I guess we have to wait for 9.5.beta7 to solve that one.



---

archive/issue_comments_464735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-15T01:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464736.json:
```json
{
    "body": "Resolved merge conflict",
    "created_at": "2021-11-15T01:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464736",
    "user": "https://github.com/kwankyu"
}
```

Resolved merge conflict



---

archive/issue_comments_464737.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-11-15T01:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464737",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_464738.json:
```json
{
    "body": "Replying to [comment:16 egourgoulhon]:\n> This is strange indeed... Maybe it's a matter of OS? What is yours? Mine is Ubuntu 20.04.\n\nMine is Mac OS. \n\n> I've always had flushed left expressions on all the computers I've used (all running various versions of Ubuntu). It could also be related to the locale (fr_FR in my case). \n\nPossibly. I don't know. If you open the notebook in editor (by right-clicking it), then you can see the raw data. Mine shows\n\n```\n    {\n     \"data\": {\n      \"text/html\": [\n       \"<html>\\\\[\\\\newcommand{\\\\Bold}[1]{\\\\mathbf{#1}}\\\\verb|&lt;class|\\\\verb| |\\\\verb|'sage.symbolic.expression.Expression'>|\\\\]</html>\"\n      ],\n      \"text/latex\": [\n       \"$$\\\\newcommand{\\\\Bold}[1]{\\\\mathbf{#1}}\\\\verb|<class|\\\\verb| |\\\\verb|'sage.symbolic.expression.Expression'>|$$\"\n      ],\n      \"text/plain\": [\n       \"<class 'sage.symbolic.expression.Expression'>\"\n      ]\n     }\n```\n\nfor `type(x)` cell. You see `\\\\[` and `$$`. How about yours?",
    "created_at": "2021-11-15T01:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464738",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:16 egourgoulhon]:
> This is strange indeed... Maybe it's a matter of OS? What is yours? Mine is Ubuntu 20.04.

Mine is Mac OS. 

> I've always had flushed left expressions on all the computers I've used (all running various versions of Ubuntu). It could also be related to the locale (fr_FR in my case). 

Possibly. I don't know. If you open the notebook in editor (by right-clicking it), then you can see the raw data. Mine shows

```
    {
     "data": {
      "text/html": [
       "<html>\\[\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\verb|&lt;class|\\verb| |\\verb|'sage.symbolic.expression.Expression'>|\\]</html>"
      ],
      "text/latex": [
       "$$\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\verb|<class|\\verb| |\\verb|'sage.symbolic.expression.Expression'>|$$"
      ],
      "text/plain": [
       "<class 'sage.symbolic.expression.Expression'>"
      ]
     }
```

for `type(x)` cell. You see `\\[` and `$$`. How about yours?



---

archive/issue_comments_464739.json:
```json
{
    "body": "I directly checked your notebooks. They are the same, the same `\\\\[` and `$$`.",
    "created_at": "2021-11-15T01:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464739",
    "user": "https://github.com/kwankyu"
}
```

I directly checked your notebooks. They are the same, the same `\\[` and `$$`.



---

archive/issue_comments_464740.json:
```json
{
    "body": "I downloaded your notebook to open it in my jupyterlab. Now latex expressions are centered. In nbviewer, they are rendered by mathjax 2.7.1. My jupyterlab uses mathjax 2.7.9. It might be a bug of mathjax 2.7.1...",
    "created_at": "2021-11-15T01:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464740",
    "user": "https://github.com/kwankyu"
}
```

I downloaded your notebook to open it in my jupyterlab. Now latex expressions are centered. In nbviewer, they are rendered by mathjax 2.7.1. My jupyterlab uses mathjax 2.7.9. It might be a bug of mathjax 2.7.1...



---

archive/issue_comments_464741.json:
```json
{
    "body": "Replying to [comment:22 klee]:\n> I downloaded your notebook to open it in my jupyterlab. Now latex expressions are centered. In nbviewer, they are rendered by mathjax 2.7.1. My jupyterlab uses mathjax 2.7.9. It might be a bug of mathjax 2.7.1... \n\nMy Jupyter notebook uses Mathjax 2.7.9 as well. However, if I right-click on a displayed expression to open the Mathjax contextual menu and choose `Math Settings -> Math Redender`, I see that `HTML-CSS` is selected; if I select `MathML` instead, I get a warning:\n\n```\nYour browser's native MathML does not implement all the features used by MathJax, \nso some expressions may not render properly.\n```\n\nbut then all the formulas in the notebook become centered! Moreover, the Rubik's cube is then correctly displayed. \n\nThe above is for Firefox (my default browser). If I do the same thing with Chrome (where initially all LaTeX expressions are left-flushed as well), I got the same warning when switching from `HTML-CSS` to `MathML`, but then, instead of LaTeX rendering, the literal code is displayed,\ne.g. \n\n```\n\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\sin\\left(x^{2}\\right)\n```\n\nfor the first formula.",
    "created_at": "2021-11-15T08:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464741",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:22 klee]:
> I downloaded your notebook to open it in my jupyterlab. Now latex expressions are centered. In nbviewer, they are rendered by mathjax 2.7.1. My jupyterlab uses mathjax 2.7.9. It might be a bug of mathjax 2.7.1... 

My Jupyter notebook uses Mathjax 2.7.9 as well. However, if I right-click on a displayed expression to open the Mathjax contextual menu and choose `Math Settings -> Math Redender`, I see that `HTML-CSS` is selected; if I select `MathML` instead, I get a warning:

```
Your browser's native MathML does not implement all the features used by MathJax, 
so some expressions may not render properly.
```

but then all the formulas in the notebook become centered! Moreover, the Rubik's cube is then correctly displayed. 

The above is for Firefox (my default browser). If I do the same thing with Chrome (where initially all LaTeX expressions are left-flushed as well), I got the same warning when switching from `HTML-CSS` to `MathML`, but then, instead of LaTeX rendering, the literal code is displayed,
e.g. 

```
\newcommand{\Bold}[1]{\mathbf{#1}}\sin\left(x^{2}\right)
```

for the first formula.



---

archive/issue_comments_464742.json:
```json
{
    "body": "Replying to [comment:23 egourgoulhon]:\n> My Jupyter notebook uses Mathjax 2.7.9 as well. However, if I right-click on a displayed expression to open the Mathjax contextual menu and choose `Math Settings -> Math Redender`, I see that `HTML-CSS` is selected; if I select `MathML` instead, I get a warning:\n> {{{\n> Your browser's native MathML does not implement all the features used by MathJax, \n> so some expressions may not render properly.\n> }}}\n> but then all the formulas in the notebook become centered! Moreover, the Rubik's cube is then correctly displayed. \n\nI experience all the same except that with HTML-CSS renderer, latex expressions are still centered.",
    "created_at": "2021-11-15T08:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464742",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:23 egourgoulhon]:
> My Jupyter notebook uses Mathjax 2.7.9 as well. However, if I right-click on a displayed expression to open the Mathjax contextual menu and choose `Math Settings -> Math Redender`, I see that `HTML-CSS` is selected; if I select `MathML` instead, I get a warning:
> {{{
> Your browser's native MathML does not implement all the features used by MathJax, 
> so some expressions may not render properly.
> }}}
> but then all the formulas in the notebook become centered! Moreover, the Rubik's cube is then correctly displayed. 

I experience all the same except that with HTML-CSS renderer, latex expressions are still centered.



---

archive/issue_comments_464743.json:
```json
{
    "body": "With Firefox on my mac, all the same (centered displays).",
    "created_at": "2021-11-15T08:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464743",
    "user": "https://github.com/kwankyu"
}
```

With Firefox on my mac, all the same (centered displays).



---

archive/issue_comments_464744.json:
```json
{
    "body": "Jupyter screenshot",
    "created_at": "2021-11-15T08:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464744",
    "user": "https://github.com/kwankyu"
}
```

Jupyter screenshot



---

archive/issue_comments_464745.json:
```json
{
    "body": "Attachment [Screen Shot 2021-11-15 at 5.55.59 PM.png](tarball://root/attachments/some-uuid/ticket32859/Screen Shot 2021-11-15 at 5.55.59 PM.png) by @egourgoulhon created at 2021-11-15 10:20:02\n\nAnother data point: when running Jupyterlab on my computer (via `sage -n jupyterlab`), latex expressions are centered. So there is a difference of behavior between the Jupyter notebook and Jupyterlab.",
    "created_at": "2021-11-15T10:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464745",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment [Screen Shot 2021-11-15 at 5.55.59 PM.png](tarball://root/attachments/some-uuid/ticket32859/Screen Shot 2021-11-15 at 5.55.59 PM.png) by @egourgoulhon created at 2021-11-15 10:20:02

Another data point: when running Jupyterlab on my computer (via `sage -n jupyterlab`), latex expressions are centered. So there is a difference of behavior between the Jupyter notebook and Jupyterlab.



---

archive/issue_comments_464746.json:
```json
{
    "body": "Replying to [comment:26 egourgoulhon]:\n> Another data point: when running Jupyterlab on my computer (via `sage -n jupyterlab`), latex expressions are centered. So there is a difference of behavior between the Jupyter notebook and Jupyterlab.\n\nRight. Me too. So it is a difference between jupyter notebook and jupyterlab!",
    "created_at": "2021-11-15T10:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464746",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:26 egourgoulhon]:
> Another data point: when running Jupyterlab on my computer (via `sage -n jupyterlab`), latex expressions are centered. So there is a difference of behavior between the Jupyter notebook and Jupyterlab.

Right. Me too. So it is a difference between jupyter notebook and jupyterlab!



---

archive/issue_comments_464747.json:
```json
{
    "body": "Another thing: you might have noticed on Cell [7] of the notebook [test_display_latex](https://nbviewer.org/github/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb) that in `%display latex` mode, `matplotlib.pyplot.show()` displays `Figure(432x288)` instead of the actual figure. This issue certainly does not pertain to the current ticket. Is there already a ticket for it?",
    "created_at": "2021-11-15T13:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464747",
    "user": "https://github.com/egourgoulhon"
}
```

Another thing: you might have noticed on Cell [7] of the notebook [test_display_latex](https://nbviewer.org/github/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb) that in `%display latex` mode, `matplotlib.pyplot.show()` displays `Figure(432x288)` instead of the actual figure. This issue certainly does not pertain to the current ticket. Is there already a ticket for it?



---

archive/issue_comments_464748.json:
```json
{
    "body": "Replying to [comment:28 egourgoulhon]:\n> Another thing: you might have noticed on Cell [7] of the notebook [test_display_latex](https://nbviewer.org/github/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb) that in `%display latex` mode, `matplotlib.pyplot.show()` displays `Figure(432x288)` instead of the actual figure. This issue certainly does not pertain to the current ticket. Is there already a ticket for it?\n\n#32882 is the new ticket for it.",
    "created_at": "2021-11-16T04:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464748",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:28 egourgoulhon]:
> Another thing: you might have noticed on Cell [7] of the notebook [test_display_latex](https://nbviewer.org/github/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb) that in `%display latex` mode, `matplotlib.pyplot.show()` displays `Figure(432x288)` instead of the actual figure. This issue certainly does not pertain to the current ticket. Is there already a ticket for it?

#32882 is the new ticket for it.



---

archive/issue_comments_464749.json:
```json
{
    "body": "Replying to [comment:29 klee]:\n> \n> #32882 is the new ticket for it.\n> \nThank you!",
    "created_at": "2021-11-16T09:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464749",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:29 klee]:
> 
> #32882 is the new ticket for it.
> 
Thank you!



---

archive/issue_events_029580.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-11-18T23:38:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32622#event-29580"
}
```



---

archive/issue_comments_464750.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-11-18T23:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464750",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_464751.json:
```json
{
    "body": "Regarding the above discussion about centered math formulas, a relevant [ask.sagemath question](https://ask.sagemath.org/question/59775/display-latex-makes-output-centered-in-exported-tex-file/) has been posted recently, complaining about centered outputs in LaTeX exports of Jupyter notebooks.  Apparently `\\begin{math}...\\end{math}` has been replaced by `$$...$$` somewhere between Sage 9.3 and 9.4.",
    "created_at": "2021-11-26T13:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464751",
    "user": "https://github.com/egourgoulhon"
}
```

Regarding the above discussion about centered math formulas, a relevant [ask.sagemath question](https://ask.sagemath.org/question/59775/display-latex-makes-output-centered-in-exported-tex-file/) has been posted recently, complaining about centered outputs in LaTeX exports of Jupyter notebooks.  Apparently `\begin{math}...\end{math}` has been replaced by `$$...$$` somewhere between Sage 9.3 and 9.4.



---

archive/issue_comments_464752.json:
```json
{
    "body": "Replying to [comment:32 egourgoulhon]:\n> Regarding the above discussion about centered math formulas, a relevant [ask.sagemath question](https://ask.sagemath.org/question/59775/display-latex-makes-output-centered-in-exported-tex-file/) has been posted recently, complaining about centered outputs in LaTeX exports of Jupyter notebooks.  Apparently `\\begin{math}...\\end{math}` has been replaced by `$$...$$` somewhere between Sage 9.3 and 9.4. \n\nI don't know how that happened. But it is likely that the behavior was introduced by one of the tickets that I authored.  \n\nAnyway that \"centered\" behavior is consistent with what we see in the jupyterlab. So the question is what behavior we want.",
    "created_at": "2021-11-26T16:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464752",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:32 egourgoulhon]:
> Regarding the above discussion about centered math formulas, a relevant [ask.sagemath question](https://ask.sagemath.org/question/59775/display-latex-makes-output-centered-in-exported-tex-file/) has been posted recently, complaining about centered outputs in LaTeX exports of Jupyter notebooks.  Apparently `\begin{math}...\end{math}` has been replaced by `$$...$$` somewhere between Sage 9.3 and 9.4. 

I don't know how that happened. But it is likely that the behavior was introduced by one of the tickets that I authored.  

Anyway that "centered" behavior is consistent with what we see in the jupyterlab. So the question is what behavior we want.



---

archive/issue_comments_464753.json:
```json
{
    "body": "Replying to [comment:33 klee]:\n> \n> Anyway that \"centered\" behavior is consistent with what we see in the jupyterlab. So the question is what behavior we want. \n\nExactly. As I said before (comment:13), I am kind of neutral on that.",
    "created_at": "2021-11-26T16:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464753",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:33 klee]:
> 
> Anyway that "centered" behavior is consistent with what we see in the jupyterlab. So the question is what behavior we want. 

Exactly. As I said before (comment:13), I am kind of neutral on that.



---

archive/issue_comments_464754.json:
```json
{
    "body": "Replying to [comment:34 egourgoulhon]:\n> Exactly. As I said before (comment:13), I am kind of neutral on that.  \n\nI prefer flush left. Well, I think users would be divided. A solution would be to introduce an option to control the behavior.",
    "created_at": "2021-11-26T23:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464754",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:34 egourgoulhon]:
> Exactly. As I said before (comment:13), I am kind of neutral on that.  

I prefer flush left. Well, I think users would be divided. A solution would be to introduce an option to control the behavior.



---

archive/issue_comments_464755.json:
```json
{
    "body": "Replying to [comment:35 klee]:\n> A solution would be to introduce an option to control the behavior.\n\nThis is now implemented in #32942. Please review.",
    "created_at": "2021-11-27T13:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32622#issuecomment-464755",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:35 klee]:
> A solution would be to introduce an option to control the behavior.

This is now implemented in #32942. Please review.
