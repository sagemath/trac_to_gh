# Issue 18110: implement the shard intersection order on permutations

archive/issues_018110.json:
```json
{
    "body": "CC:  @darijgr @tscrim @hughrthomas\n\nThis is a poset (and even a lattice) introduced by N. Reading in 2011.\n\nIt has nice properties, similar to that of noncrossing partitions.\n\nLet's have it in sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18347\n\n",
    "created_at": "2015-05-01T12:47:56Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "implement the shard intersection order on permutations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18110",
    "user": "https://github.com/fchapoton"
}
```
CC:  @darijgr @tscrim @hughrthomas

This is a poset (and even a lattice) introduced by N. Reading in 2011.

It has nice properties, similar to that of noncrossing partitions.

Let's have it in sage.

Issue created by migration from https://trac.sagemath.org/ticket/18347





---

archive/issue_comments_243784.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-01T12:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243784",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_243785.json:
```json
{
    "body": "Changing keywords from \"\" to \"poset\".",
    "created_at": "2015-05-01T12:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243785",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "poset".



---

archive/issue_comments_243786.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-01T12:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243786",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_243787.json:
```json
{
    "body": "You might have forgotten to git-add the main file?",
    "created_at": "2015-05-01T13:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243787",
    "user": "https://github.com/darijgr"
}
```

You might have forgotten to git-add the main file?



---

archive/issue_comments_243788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-01T13:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243789.json:
```json
{
    "body": "oops, indeed, I was a bit too quick\n\nDo you think that descending_runs should be integrated into runs ?",
    "created_at": "2015-05-01T13:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243789",
    "user": "https://github.com/fchapoton"
}
```

oops, indeed, I was a bit too quick

Do you think that descending_runs should be integrated into runs ?



---

archive/issue_comments_243790.json:
```json
{
    "body": "I don't know -- this seems to be a matter of taste.",
    "created_at": "2015-05-01T13:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243790",
    "user": "https://github.com/darijgr"
}
```

I don't know -- this seems to be a matter of taste.



---

archive/issue_comments_243791.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-01T20:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243791",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_243792.json:
```json
{
    "body": "Hello,\n\n1. In `decreasing_runs` why are you creating a list to return a tuple? You would better use\n\n```\nreturn tuple(tuple([n + 1 - i for i in r]) for r in s_bar.runs())\n```\n\n\n2. What is the point of the `cached_function` on `shard_preorder_graph`? As far as I understand the information is only temporarily used to construct the poset. The poset constructor basically makes comparison between all pairs. So you are storing information that will never be used beyond constructing the poset.\n\n- proposition 1: implement better the data to initialize the poset from\n- (ugly) proposition 2: clear the cache when you are done\n\n```\nSn = [s.decreasing_runs() for s in Permutations(n)]\nP = Poset([Sn, shard_compares], cover_relations=False)\nshard_preorder_graph.clear_cache()\nreturn P\n```\n\n\n3. This \n\n```\ndico1 = {}\n# conversion: integer -> index of run in r1\nfor i, bloc in enumerate(r1):\n    for j in bloc:\n        dico1[j] = i\n```\n\n  can be\n\n```\ndico1 = {j:i for i,bloc in enumerate(r1) for j in bloc}\n```\n\n\nVincent",
    "created_at": "2015-05-01T20:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243792",
    "user": "https://github.com/videlec"
}
```

Hello,

1. In `decreasing_runs` why are you creating a list to return a tuple? You would better use

```
return tuple(tuple([n + 1 - i for i in r]) for r in s_bar.runs())
```


2. What is the point of the `cached_function` on `shard_preorder_graph`? As far as I understand the information is only temporarily used to construct the poset. The poset constructor basically makes comparison between all pairs. So you are storing information that will never be used beyond constructing the poset.

- proposition 1: implement better the data to initialize the poset from
- (ugly) proposition 2: clear the cache when you are done

```
Sn = [s.decreasing_runs() for s in Permutations(n)]
P = Poset([Sn, shard_compares], cover_relations=False)
shard_preorder_graph.clear_cache()
return P
```


3. This 

```
dico1 = {}
# conversion: integer -> index of run in r1
for i, bloc in enumerate(r1):
    for j in bloc:
        dico1[j] = i
```

  can be

```
dico1 = {j:i for i,bloc in enumerate(r1) for j in bloc}
```


Vincent



---

archive/issue_comments_243793.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-02T12:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243794.json:
```json
{
    "body": "Thanks for the comments. I have corrected the two minor ones.\n\nAbout the caching: indeed, this is used only in the poset, but used many times.\n\nIt is not clear to me how to avoid that. One could precompute in the poset method all\nthese digraphs, and keep them in a list or a dictionary, and make the `shard_compares` method an internal one. I am not convinced that this would make things more clear.",
    "created_at": "2015-05-02T12:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243794",
    "user": "https://github.com/fchapoton"
}
```

Thanks for the comments. I have corrected the two minor ones.

About the caching: indeed, this is used only in the poset, but used many times.

It is not clear to me how to avoid that. One could precompute in the poset method all
these digraphs, and keep them in a list or a dictionary, and make the `shard_compares` method an internal one. I am not convinced that this would make things more clear.



---

archive/issue_comments_243795.json:
```json
{
    "body": "Replying to [comment:8 chapoton]:\n> Thanks for the comments. I have corrected the two minor ones.\n> \n> About the caching: indeed, this is used only in the poset, but used many times.\n\nIt is currently not used **in** the poset, only during its construction! Just have a look at the ugly poset code. It is not lazy at all.\n \n4. `runs` and `decreasing_runs` should return the same data. It is currently list for one of them and tuple for the other.\n\n5. Why did you wrote the following comment in `shard_compares`?\n\n```\n# We assume that r1 has less runs than r0\n```\n\n\n6. The function `shard_preorder_graph` only depends on the interval not on the runs themselves. So you are storing too much in the cache of this function. Make the input a tuple of pairs\n\n```\nsage: s = Permutation([2,8,3,9,6,4,5,1,7])\nsage: runs = s.decreasing_runs()\nsage: shard_preorder_graph(runs) == \\\n....:    shard_preorder_graph(tuple((r[0],r[-1]) for r in runs))\nTrue\n```\n\n  And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?\n\nVincent",
    "created_at": "2015-05-02T13:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243795",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:8 chapoton]:
> Thanks for the comments. I have corrected the two minor ones.
> 
> About the caching: indeed, this is used only in the poset, but used many times.

It is currently not used **in** the poset, only during its construction! Just have a look at the ugly poset code. It is not lazy at all.
 
4. `runs` and `decreasing_runs` should return the same data. It is currently list for one of them and tuple for the other.

5. Why did you wrote the following comment in `shard_compares`?

```
# We assume that r1 has less runs than r0
```


6. The function `shard_preorder_graph` only depends on the interval not on the runs themselves. So you are storing too much in the cache of this function. Make the input a tuple of pairs

```
sage: s = Permutation([2,8,3,9,6,4,5,1,7])
sage: runs = s.decreasing_runs()
sage: shard_preorder_graph(runs) == \
....:    shard_preorder_graph(tuple((r[0],r[-1]) for r in runs))
True
```

  And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?

Vincent



---

archive/issue_comments_243796.json:
```json
{
    "body": "Replying to [comment:9 vdelecroix]:\n> Replying to [comment:8 chapoton]:\n>   And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?\n\nThis is not quite true, sorry. You are building a comparability graph that also does depend on the order of the input. Not only on the intervals themselves...\n\nVincent",
    "created_at": "2015-05-02T13:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243796",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:9 vdelecroix]:
> Replying to [comment:8 chapoton]:
>   And you should really think moving it somewhere else as this has nothing to do with permutations. This is just a comparability graph given by the inclusion order on intervals. Isn't it?

This is not quite true, sorry. You are building a comparability graph that also does depend on the order of the input. Not only on the intervals themselves...

Vincent



---

archive/issue_comments_243797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-02T15:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243798.json:
```json
{
    "body": "Hello,\n\nyes, this is a rather subtle order, I think. It is indeed closely related to noncrossing\npartitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.\n\nConcerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?\n\nConcerning 5: I have added this as a simple necessary condition\n\nconcerning 6: I have made `shard_preorder_graph` input a tuple of pairs",
    "created_at": "2015-05-02T15:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243798",
    "user": "https://github.com/fchapoton"
}
```

Hello,

yes, this is a rather subtle order, I think. It is indeed closely related to noncrossing
partitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.

Concerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?

Concerning 5: I have added this as a simple necessary condition

concerning 6: I have made `shard_preorder_graph` input a tuple of pairs



---

archive/issue_comments_243799.json:
```json
{
    "body": "Why not making it a poset on permutations?\n\nReplying to [comment:12 chapoton]:\n> Hello,\n> \n> yes, this is a rather subtle order, I think. It is indeed closely related to noncrossing\n> partitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.\n> \n> Concerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?\n\nI think so.\n\n> Concerning 5: I have added this as a simple necessary condition\n> \n> concerning 6: I have made `shard_preorder_graph` input a tuple of pairs\n\nNice.\n\n\nI uploaded a branch at `public/18347` in which instead of storing every graph in an external function I created a new class for `ShardPosetElement`. It does some precomputation. It is much cleaner. It is just a toy implementation to let you see. Your previous `shard_compares` is now `ShardPosetElement.__le__`.\n\nBeyond these technicalities:\n- you must put more definitions (about the order, etc)\n- you should put more relevant doctest! \n\n```\n        sage: P = posets.ShardPoset(4); P\n        Finite poset containing 24 elements\n        sage: len(P.maximal_chains())\n        34\n        sage: P.is_selfdual()\n        False\n```\n\n  is clearly not enough!\n\nVincent",
    "created_at": "2015-05-02T17:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243799",
    "user": "https://github.com/videlec"
}
```

Why not making it a poset on permutations?

Replying to [comment:12 chapoton]:
> Hello,
> 
> yes, this is a rather subtle order, I think. It is indeed closely related to noncrossing
> partitions and to the weak order, but not in obvious ways. For example, the Mobius number is the number of connected partitions.
> 
> Concerning 4: I have added an option to specify the output of decreasing runs. Should I do the same for runs ?

I think so.

> Concerning 5: I have added this as a simple necessary condition
> 
> concerning 6: I have made `shard_preorder_graph` input a tuple of pairs

Nice.


I uploaded a branch at `public/18347` in which instead of storing every graph in an external function I created a new class for `ShardPosetElement`. It does some precomputation. It is much cleaner. It is just a toy implementation to let you see. Your previous `shard_compares` is now `ShardPosetElement.__le__`.

Beyond these technicalities:
- you must put more definitions (about the order, etc)
- you should put more relevant doctest! 

```
        sage: P = posets.ShardPoset(4); P
        Finite poset containing 24 elements
        sage: len(P.maximal_chains())
        34
        sage: P.is_selfdual()
        False
```

  is clearly not enough!

Vincent



---

archive/issue_comments_243800.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-06T14:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243801.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-07T08:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243802.json:
```json
{
    "body": "I have added some explanations. Enough ?",
    "created_at": "2015-05-11T12:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243802",
    "user": "https://github.com/fchapoton"
}
```

I have added some explanations. Enough ?



---

archive/issue_comments_243803.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-11T12:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243803",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_243804.json:
```json
{
    "body": "Hello,\n\nWhat does `connected_parts` is doing in the git branch?\n\nYou should work harder on `ShardPosetElement`:\n\n1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)\n\n2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)\n\n3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:\n\n```\nif type(self) is not type(other) or len(self) != len(other):\n    raise TypeError(\"these are not comparable\")\n```\n\n\n4. Do you want to keep all attributes of `ShardPosetElement` public as they are?\n\nVincent",
    "created_at": "2015-05-11T16:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243804",
    "user": "https://github.com/videlec"
}
```

Hello,

What does `connected_parts` is doing in the git branch?

You should work harder on `ShardPosetElement`:

1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)

2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)

3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:

```
if type(self) is not type(other) or len(self) != len(other):
    raise TypeError("these are not comparable")
```


4. Do you want to keep all attributes of `ShardPosetElement` public as they are?

Vincent



---

archive/issue_comments_243805.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-11T16:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243805",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_243806.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-11T17:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243807.json:
```json
{
    "body": "Hello\n\n> What does `connected_parts` is doing in the git branch?\n\nWell, I removed it. Could go in another ticket maybe.\n \n> 1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)\n\nDone\n\n> 2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)\n\nIs this really necessary ? This class is just there to help build the poset, there is no way\nit will be ever used for something else, I think.\n\n> 3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:\n> {{{\n> if type(self) is not type(other) or len(self) != len(other):\n>     raise TypeError(\"these are not comparable\")\n> }}}\n\nDone\n \n> 4. Do you want to keep all attributes of `ShardPosetElement` public as they are?\n\nOnce again, this class will probably not be very much used. So I do not see the point to hide things.\n\nMy motivation for this ticket was to have the poset, which is the main interesting thing here.\n\nThanks for your comments, by the way.\n\nFrederic",
    "created_at": "2015-05-11T17:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243807",
    "user": "https://github.com/fchapoton"
}
```

Hello

> What does `connected_parts` is doing in the git branch?

Well, I removed it. Could go in another ticket maybe.
 
> 1. it would be better if it inherits from `tuple` (i.e. remove the `p` attribute and add `tuple.__init__(self, p)` in the constructor). Then remove the `__hash__` and the `__repr__` (they are already fine in `tuple`)

Done

> 2. Implement the various operators `__le__`, `__lt__`, `__gt__`, `__ge__` and check that it is coherent (this should be ok for `__eq__` and `__ne__` inherited from `tuple`)

Is this really necessary ? This class is just there to help build the poset, there is no way
it will be ever used for something else, I think.

> 3. Moreover, in `__le__` you can not assume that `self` and `other` are of the same type. You should start the method with something like:
> {{{
> if type(self) is not type(other) or len(self) != len(other):
>     raise TypeError("these are not comparable")
> }}}

Done
 
> 4. Do you want to keep all attributes of `ShardPosetElement` public as they are?

Once again, this class will probably not be very much used. So I do not see the point to hide things.

My motivation for this ticket was to have the poset, which is the main interesting thing here.

Thanks for your comments, by the way.

Frederic



---

archive/issue_comments_243808.json:
```json
{
    "body": "Hi,\n\nReplying to [comment:19 chapoton]:\n\nI mostly agree with you for 2. and 4. But if you do not care about the elements, then the poset should be abstract on integers: i.e. just store a matrix of relations and send it to `Poset`. You do not want to know which permutation corresponds to which point in this poset?\n\nVincent",
    "created_at": "2015-05-11T17:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243808",
    "user": "https://github.com/videlec"
}
```

Hi,

Replying to [comment:19 chapoton]:

I mostly agree with you for 2. and 4. But if you do not care about the elements, then the poset should be abstract on integers: i.e. just store a matrix of relations and send it to `Poset`. You do not want to know which permutation corresponds to which point in this poset?

Vincent



---

archive/issue_comments_243809.json:
```json
{
    "body": "Well. I did implement this just to compute the number of maximal chains and the mobius\nnumbers. So only the \"abstract\" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.\n\nI do not think nevertheless that it is necessary to have the elements be permutations.\n\nSo I am happy with the current state of things..",
    "created_at": "2015-05-15T12:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243809",
    "user": "https://github.com/fchapoton"
}
```

Well. I did implement this just to compute the number of maximal chains and the mobius
numbers. So only the "abstract" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.

I do not think nevertheless that it is necessary to have the elements be permutations.

So I am happy with the current state of things..



---

archive/issue_comments_243810.json:
```json
{
    "body": "Replying to [comment:21 chapoton]:\n> Well. I did implement this just to compute the number of maximal chains and the mobius\n> numbers. So only the \"abstract\" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.\n> \n> I do not think nevertheless that it is necessary to have the elements be permutations.\n> \n> So I am happy with the current state of things..\n\nI see. Could you mention somewhere (probably in the docstring of `ShardPosetElement` and `ShardPoset`) that the elements are **not** permutation (for computational reasons). But hopefully they are easily recovered:\n\n```\nsage: P = posets.ShardPoset(4)\nsage: mins = P.minimal_elements()[0]\nsage: p = Permutation(mins)\n[2, 3, 4, 1]\nsage: p.decreasing_runs()\n[[2], [3], [4, 1]]\n```\n\n(or a more relevant example)\n\nVincent",
    "created_at": "2015-05-15T12:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243810",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:21 chapoton]:
> Well. I did implement this just to compute the number of maximal chains and the mobius
> numbers. So only the "abstract" poset was needed. But of course, this is more useful to other people if the vertices of the poset are more or less labelled by permutations.
> 
> I do not think nevertheless that it is necessary to have the elements be permutations.
> 
> So I am happy with the current state of things..

I see. Could you mention somewhere (probably in the docstring of `ShardPosetElement` and `ShardPoset`) that the elements are **not** permutation (for computational reasons). But hopefully they are easily recovered:

```
sage: P = posets.ShardPoset(4)
sage: mins = P.minimal_elements()[0]
sage: p = Permutation(mins)
[2, 3, 4, 1]
sage: p.decreasing_runs()
[[2], [3], [4, 1]]
```

(or a more relevant example)

Vincent



---

archive/issue_comments_243811.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-15T19:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243812.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-15T19:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243812",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_243813.json:
```json
{
    "body": "ok, back to needs review. I have added some doc about back and forth conversion to permutations.",
    "created_at": "2015-05-15T19:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243813",
    "user": "https://github.com/fchapoton"
}
```

ok, back to needs review. I have added some doc about back and forth conversion to permutations.



---

archive/issue_comments_243814.json:
```json
{
    "body": "Why did you put the `INPUT` block one kilometer away in `Permutation.runs`?!",
    "created_at": "2015-05-15T19:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243814",
    "user": "https://github.com/videlec"
}
```

Why did you put the `INPUT` block one kilometer away in `Permutation.runs`?!



---

archive/issue_comments_243815.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-15T20:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243816.json:
```json
{
    "body": "ping ?",
    "created_at": "2015-05-22T20:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243816",
    "user": "https://github.com/fchapoton"
}
```

ping ?



---

archive/issue_events_051758.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-22T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18110#event-51758"
}
```



---

archive/issue_comments_243817.json:
```json
{
    "body": "pong!",
    "created_at": "2015-05-23T13:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243817",
    "user": "https://github.com/videlec"
}
```

pong!



---

archive/issue_comments_243818.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-23T13:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243818",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_051759.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-23T22:59:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18110#event-51759"
}
```



---

archive/issue_comments_243819.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-23T22:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243819",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_243820.json:
```json
{
    "body": "Why was a new class derived from `tuple` rather then something inheriting from `SageObject`??? It now triggers a warning included in doctest by #20667",
    "created_at": "2016-05-24T02:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243820",
    "user": "https://github.com/novoselt"
}
```

Why was a new class derived from `tuple` rather then something inheriting from `SageObject`??? It now triggers a warning included in doctest by #20667



---

archive/issue_comments_243821.json:
```json
{
    "body": "Inheriting from tuple is forbidden?\n\nMore interesting: what is the warning that was not here before?",
    "created_at": "2016-05-24T03:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243821",
    "user": "https://github.com/videlec"
}
```

Inheriting from tuple is forbidden?

More interesting: what is the warning that was not here before?



---

archive/issue_comments_243822.json:
```json
{
    "body": "Nothing is forbidden, but\nhttp://doc.sagemath.org/html/en/developer/coding_in_python.html?highlight=sageobject\nand the result is\nhttp://git.sagemath.org/sage.git/diff/src/sage/combinat/shard_order.py?id=ed746286af38545c69edfc77c3a9f1cfde4665fd&id2=d5646a4e1a2c6f0575ca90b02085417b676e34dd",
    "created_at": "2016-05-24T03:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243822",
    "user": "https://github.com/novoselt"
}
```

Nothing is forbidden, but
http://doc.sagemath.org/html/en/developer/coding_in_python.html?highlight=sageobject
and the result is
http://git.sagemath.org/sage.git/diff/src/sage/combinat/shard_order.py?id=ed746286af38545c69edfc77c3a9f1cfde4665fd&id2=d5646a4e1a2c6f0575ca90b02085417b676e34dd



---

archive/issue_comments_243823.json:
```json
{
    "body": "The problem is that this error will not be solved by inheriting from `SageObject` since we need to initialize the content of the tuple... The inheritance from `tuple` is here for speed (the methods use `__hash__` and `__eq__`).\n\nDoes the same warning show up with the following?\n\n```\nsage: class A(tuple):\n....:    def __init__(self, a):\n....:        tuple.__init__(a)\nsage: a = A([1,2,3])\n```\n\nIt works without any warning in IPython console...",
    "created_at": "2016-05-24T03:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18110",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18110#issuecomment-243823",
    "user": "https://github.com/videlec"
}
```

The problem is that this error will not be solved by inheriting from `SageObject` since we need to initialize the content of the tuple... The inheritance from `tuple` is here for speed (the methods use `__hash__` and `__eq__`).

Does the same warning show up with the following?

```
sage: class A(tuple):
....:    def __init__(self, a):
....:        tuple.__init__(a)
sage: a = A([1,2,3])
```

It works without any warning in IPython console...
