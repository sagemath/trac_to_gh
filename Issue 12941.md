# Issue 12941: sage -pkg can't handle its own options

Issue created by migration from https://trac.sagemath.org/ticket/13113

Original creator: kini

Original creation time: 2012-06-13 19:34:10

Assignee: leif

CC:  jhpalmieri

As summary.


---

Comment by kini created at 2012-06-13 19:43:23

The second patch is kind of hard to read - all I did between the `for` statement I added and the `if __name__ == '__main__'` at the bottom was to indent everything by four spaces.


---

Comment by kini created at 2012-06-13 19:43:23

Changing status from new to needs_review.


---

Comment by kini created at 2012-06-13 19:46:58

Oops, I lied - another difference is that I moved the message about what package we're creating from `$SAGE_ROOT/spkg/bin/sage` to `$SAGE_LOCAL/bin/sage-pkg`, and also I removed line 55 for obvious reasons.

The first of these fixes this stupid situation:


```
[1] fs-boone@zhenghe /opt/sage/local/bin $ sage -pkg --help
Creating Sage package --help
Usage: sage-pkg [options]

Options:
  -h, --help            show this help message and exit
  -n, --no-compress, --no_compress, --nocompress
                        don't compress the spkg file
```


(Note the second line.)


---

Comment by kini created at 2012-06-13 19:51:07

Changing keywords from "" to "sd41 sage-pkg".


---

Comment by kini created at 2012-06-13 19:57:46

CCing jhpalmieri since he might be interested... maybe... ? :)


---

Comment by jhpalmieri created at 2012-06-13 22:08:50

You don't need leading spaces on lines 74-75 or 77. I think the same is true for selected lines in the range 102-126. Otherwise, the patches look good in principle. I haven't actually tested them, of course...


---

Comment by kini created at 2012-06-13 22:11:50

Whoops, you're right, of course. New patch in a sec


---

Comment by jhpalmieri created at 2012-06-13 23:22:54

Looks good to me, and works the way it should.


---

Comment by jhpalmieri created at 2012-06-13 23:22:54

Changing status from needs_review to positive_review.


---

Comment by kini created at 2012-06-13 23:24:17

Awesome, thanks!


---

Comment by kini created at 2012-06-14 05:58:07

Changing status from positive_review to needs_work.


---

Comment by kini created at 2012-06-14 05:58:07

Wait, the root repo patch needs work - I should handle --pkg_nc properly.


---

Comment by kini created at 2012-06-14 06:34:34

apply to $SAGE_LOCAL/bin


---

Comment by kini created at 2012-06-14 06:35:17

Changing status from needs_work to needs_review.


---

Attachment

Also replicated the message from `--pkg_nc` in `sage-pkg` (new line 53 in the scripts patch).


---

Comment by jhpalmieri created at 2012-06-15 19:55:14

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-06-15 19:55:14

Still looks good.


---

Comment by jdemeyer created at 2012-06-15 20:59:19

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-06-15 20:59:19

What's the point of the two

```
if [ $? -ne 0 ]; then 
    exit 1 
fi
```

blocks?

They could just be removed, right?


---

Comment by kini created at 2012-06-15 21:20:47

Well, they were there before, so I just left them there. If you think removing them is that important, I'll update the patches...


---

Attachment

apply to $SAGE_ROOT


---

Comment by kini created at 2012-06-15 21:22:55

New patch is up.


---

Comment by kini created at 2012-06-15 21:22:55

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2012-06-15 21:27:57

I still think this looks good. Jeroen?


---

Comment by jdemeyer created at 2012-06-15 21:59:16

Looks good to me, and I like your commit message :-)


---

Comment by jdemeyer created at 2012-06-15 21:59:16

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-07-02 15:25:26

Resolution: fixed
