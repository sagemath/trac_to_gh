# Issue 24925: Implement orbit basis for partition algebras

archive/issues_024925.json:
```json
{
    "body": "CC:  darij alauve tscrim ghseeli s.r.doty mantepse zabrocki\n\nKeywords: IMA coding sprint, CHAs, set partitions, diagram algebras\n\nAside from the natural diagram basis for the Partition Algebra, there is an \"orbit basis\" which carries representation-theoretic meaning. At present, the Partition Algebra (indeed all diagram algebras) have only the diagram  basis implemented.  This ticket will implement the orbit basis following the model of `PBWBasisOfFreeAlgebra` in `sage.algebras.free_algebra`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25162\n\n",
    "created_at": "2018-04-13T14:18:09Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "title": "Implement orbit basis for partition algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24925",
    "user": "alauve"
}
```
CC:  darij alauve tscrim ghseeli s.r.doty mantepse zabrocki

Keywords: IMA coding sprint, CHAs, set partitions, diagram algebras

Aside from the natural diagram basis for the Partition Algebra, there is an "orbit basis" which carries representation-theoretic meaning. At present, the Partition Algebra (indeed all diagram algebras) have only the diagram  basis implemented.  This ticket will implement the orbit basis following the model of `PBWBasisOfFreeAlgebra` in `sage.algebras.free_algebra`.

Issue created by migration from https://trac.sagemath.org/ticket/25162





---

archive/issue_comments_350787.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-16T12:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350787",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-19T03:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350788",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350789.json:
```json
{
    "body": "I should mention that I did quite a bit more than implement the orbit basis. I also worked towards implmenting coercion between different instances of SubPartitionAlgebra classes. \n\ne.g., one would like the following code to work, and it seems like now it does:\n\n\n```\nsage: R.<q> = QQ[]\nsage: S2 = SymmetricGroupAlgebra(ZZ, 2)\nsage: B2 = BrauerAlgebra(2, q, R)\nsage: P = PartitionAlgebra(4, q, R)\nsage: P(S2.an_element())\n3*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}\nsage: P(B2.an_element())\n3*P{{-4, 4}, {-3, 3}, {-2, -1}, {1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}\n```\n\n\nHowever, I don't understand why coercion from the base ring doesn't work:\n\n\n```\nsage: R.<q> = QQ[]\nsage: O2 = PartitionAlgebra(2, q, R).orbit_basis()\nsage: P2 = PartitionAlgebra(2, q, R)\nsage: O2(P2(13))\n13*OP{{-2, -1, 1, 2}} + 13*OP{{-2, 2}, {-1, 1}}\nsage: O2(13)  # this is wrong!!\n13*OP{{-2, 2}, {-1, 1}}\n```\n\n\n(Mike should also check that multiplication in the Orbit basis performs as expected.)",
    "created_at": "2018-04-19T03:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350789",
    "user": "alauve"
}
```

I should mention that I did quite a bit more than implement the orbit basis. I also worked towards implmenting coercion between different instances of SubPartitionAlgebra classes. 

e.g., one would like the following code to work, and it seems like now it does:


```
sage: R.<q> = QQ[]
sage: S2 = SymmetricGroupAlgebra(ZZ, 2)
sage: B2 = BrauerAlgebra(2, q, R)
sage: P = PartitionAlgebra(4, q, R)
sage: P(S2.an_element())
3*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}
sage: P(B2.an_element())
3*P{{-4, 4}, {-3, 3}, {-2, -1}, {1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 1}, {-1, 2}} + 2*P{{-4, 4}, {-3, 3}, {-2, 2}, {-1, 1}}
```


However, I don't understand why coercion from the base ring doesn't work:


```
sage: R.<q> = QQ[]
sage: O2 = PartitionAlgebra(2, q, R).orbit_basis()
sage: P2 = PartitionAlgebra(2, q, R)
sage: O2(P2(13))
13*OP{{-2, -1, 1, 2}} + 13*OP{{-2, 2}, {-1, 1}}
sage: O2(13)  # this is wrong!!
13*OP{{-2, 2}, {-1, 1}}
```


(Mike should also check that multiplication in the Orbit basis performs as expected.)



---

archive/issue_comments_350790.json:
```json
{
    "body": "My guess is because `DiagramAlgebra.one_basis()` is defined for the orbit basis. IIRC, the conversion (technically, what you are doing is conversion) for scalars first tries to see if `one_basis()` is defined, and if so, then constructs an element as the term `(self.one_basis(), scalar)`. This is done for speed reasons (it is faster than acting by multiplication). You probably need to add another ABC for the diagram algebra bases where `1` is not a basis element.",
    "created_at": "2018-04-19T03:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350790",
    "user": "tscrim"
}
```

My guess is because `DiagramAlgebra.one_basis()` is defined for the orbit basis. IIRC, the conversion (technically, what you are doing is conversion) for scalars first tries to see if `one_basis()` is defined, and if so, then constructs an element as the term `(self.one_basis(), scalar)`. This is done for speed reasons (it is faster than acting by multiplication). You probably need to add another ABC for the diagram algebra bases where `1` is not a basis element.



---

archive/issue_comments_350791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-19T14:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350792.json:
```json
{
    "body": "The problem was that `one_basis` was defined in `DiagramAlgebra` and you didn't want that method to exist in the orbit basis.  I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.",
    "created_at": "2018-04-19T14:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350792",
    "user": "zabrocki"
}
```

The problem was that `one_basis` was defined in `DiagramAlgebra` and you didn't want that method to exist in the orbit basis.  I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.



---

archive/issue_comments_350793.json:
```json
{
    "body": "Great, thanks! (and I agree that `unital_algebra` should not assume that the unit is a single monomial.)\n\nWill you be making other changes soon? I can tackle the doctest failures, but I think it's best to wait for zabrocki/tscrim/other to take a deeper look under the hood first.",
    "created_at": "2018-04-19T21:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350793",
    "user": "alauve"
}
```

Great, thanks! (and I agree that `unital_algebra` should not assume that the unit is a single monomial.)

Will you be making other changes soon? I can tackle the doctest failures, but I think it's best to wait for zabrocki/tscrim/other to take a deeper look under the hood first.



---

archive/issue_comments_350794.json:
```json
{
    "body": "Replying to [comment:8 zabrocki]:\n> I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.\n\nThat is incorrect, unital algebras does **not** force you to implement `one_basis`. If you have implemented `one_basis`, then it has every right to assume `1` is a basis element. Otherwise you should just implement `one()`.",
    "created_at": "2018-04-19T21:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350794",
    "user": "tscrim"
}
```

Replying to [comment:8 zabrocki]:
> I don't think it is right for `unital_algebra` to insist that the one of the basis is a single monomial.

That is incorrect, unital algebras does **not** force you to implement `one_basis`. If you have implemented `one_basis`, then it has every right to assume `1` is a basis element. Otherwise you should just implement `one()`.



---

archive/issue_comments_350795.json:
```json
{
    "body": "ah. that's more sensible.",
    "created_at": "2018-04-19T22:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350795",
    "user": "alauve"
}
```

ah. that's more sensible.



---

archive/issue_comments_350796.json:
```json
{
    "body": "I am currently doing a bunch of refactoring on this ticket (including merging in the fix on #24323).",
    "created_at": "2018-04-19T22:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350796",
    "user": "tscrim"
}
```

I am currently doing a bunch of refactoring on this ticket (including merging in the fix on #24323).



---

archive/issue_comments_350797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-19T23:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350798.json:
```json
{
    "body": "Okay, I have finished my refactoring and made the code as clean as I can make it. All doctests now pass and there is 100% coverage. I have also reviewed the code you wrote.",
    "created_at": "2018-04-19T23:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350798",
    "user": "tscrim"
}
```

Okay, I have finished my refactoring and made the code as clean as I can make it. All doctests now pass and there is 100% coverage. I have also reviewed the code you wrote.



---

archive/issue_comments_350799.json:
```json
{
    "body": "Some comments:\n\n- Never use a base `except:`; it catches far too much (including things like interrupts, or so I've been told).\n- The `module_morphism` is primarily expecting something that takes a basis element as input.\n- I have never really liked the (user-level) idiom of `parent.to_foo(x)`, so I removed it. I am good with it being there to avoid reimplementation of boilerplate code, but beyond that, I think only the method at the element level should be exposed to the user.\n- I fixed the category issue of `PropogatingIdeal` as effectively a by-product of my refactoring.\n\nThere is likely more to be done to improve this file, but this is what is sufficient for the ticket at hand.",
    "created_at": "2018-04-19T23:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350799",
    "user": "tscrim"
}
```

Some comments:

- Never use a base `except:`; it catches far too much (including things like interrupts, or so I've been told).
- The `module_morphism` is primarily expecting something that takes a basis element as input.
- I have never really liked the (user-level) idiom of `parent.to_foo(x)`, so I removed it. I am good with it being there to avoid reimplementation of boilerplate code, but beyond that, I think only the method at the element level should be exposed to the user.
- I fixed the category issue of `PropogatingIdeal` as effectively a by-product of my refactoring.

There is likely more to be done to improve this file, but this is what is sufficient for the ticket at hand.



---

archive/issue_comments_350800.json:
```json
{
    "body": "Travis,\nYour changes look good to me. (Your comments are duly noted.) \n\n- regarding your third comment...\nYou removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`\n\n- One mathematical quibble/query... \nThe orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.\n\n```\n        PD = PartitionDiagrams(self._alg._k)\n        one = self.base_ring().one()\n        return self._from_dict({d: one for d in PD(diag).coarsenings()},\n                               coerce=False, remove_zeros=False)\n```\n\nI'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. \n\n- \"Basis\" versus \"Algebra\"...\nThe new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name.",
    "created_at": "2018-04-20T03:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350800",
    "user": "alauve"
}
```

Travis,
Your changes look good to me. (Your comments are duly noted.) 

- regarding your third comment...
You removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`

- One mathematical quibble/query... 
The orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.

```
        PD = PartitionDiagrams(self._alg._k)
        one = self.base_ring().one()
        return self._from_dict({d: one for d in PD(diag).coarsenings()},
                               coerce=False, remove_zeros=False)
```

I'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. 

- "Basis" versus "Algebra"...
The new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name.



---

archive/issue_comments_350801.json:
```json
{
    "body": "Replying to [comment:16 alauve]:\n> - regarding your third comment...\n>   You removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`\n\nThat was one of the first things I touched and a remnant of when I thought it could be necessary/useful. It can be removed.\n\n> - One mathematical quibble/query... \n>   The orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.\n>   {{{\n>         PD = PartitionDiagrams(self._alg._k)\n>         one = self.base_ring().one()\n>         return self._from_dict({d: one for d in PD(diag).coarsenings()},\n>                                coerce=False, remove_zeros=False)\n>   }}}\n>   I'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. \n\nI don't really care since it is not anything (directly) exposed to the user. I think it is overly verbose to have it in the class name (the docstring differentiates IMO), but feel free to change it back.\n\n(I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces. In which case, `sage.combinat.partition_algebra.OrbitBasis` removes ambiguity, but that is a tangential.)\n\n> - \"Basis\" versus \"Algebra\"...\n>   The new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name. \n\nThese are all implemented as algebras in a particular basis. so IMO, there is no distinction between an algebra and a basis. I highly doubt this will cause any serious confusion/problems once someone reads-the-code (if they are looking at these things, they should already be doing that).",
    "created_at": "2018-04-20T04:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350801",
    "user": "tscrim"
}
```

Replying to [comment:16 alauve]:
> - regarding your third comment...
>   You removed `to_orbit_basis` from parent `PartitionAlgebra` but left `to_diagram_basis` within parent `OrbitBasis`

That was one of the first things I touched and a remnant of when I thought it could be necessary/useful. It can be removed.

> - One mathematical quibble/query... 
>   The orbit basis doesn't exist for many subalgebras of the partition algebra. Well, there could be something best known as 'orbit basis' for each subalgebra, but the formula for converting to diagram basis will not be the same as what appears  around line 2339.
>   {{{
>         PD = PartitionDiagrams(self._alg._k)
>         one = self.base_ring().one()
>         return self._from_dict({d: one for d in PD(diag).coarsenings()},
>                                coerce=False, remove_zeros=False)
>   }}}
>   I'm not sure what's the best way to address this, but I'd be inclined to keep `PartitionAlgebra` in the name. 

I don't really care since it is not anything (directly) exposed to the user. I think it is overly verbose to have it in the class name (the docstring differentiates IMO), but feel free to change it back.

(I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces. In which case, `sage.combinat.partition_algebra.OrbitBasis` removes ambiguity, but that is a tangential.)

> - "Basis" versus "Algebra"...
>   The new name also doesn't have the word 'algebra' in it, which may be more likely to lead to confusion. Likewise, implementing `DiagramBasis` seems like a good idea, though I'm not sure about the name. 

These are all implemented as algebras in a particular basis. so IMO, there is no distinction between an algebra and a basis. I highly doubt this will cause any serious confusion/problems once someone reads-the-code (if they are looking at these things, they should already be doing that).



---

archive/issue_comments_350802.json:
```json
{
    "body": "It seems really slow.  We might have to implement the multiplication directly on the orbit basis.\n\nThere seems to be something wrong here:\n\n```\nsage: O = PartitionAlgebra(2,x).orbit_basis()\nsage: O[[1,-1],[2],[-2]]\nOP{{-2}, {-1, 1}, {2}}\nsage: O[[1,-1,2,-2]]\nTypeError: 'sage.rings.integer.Integer' object is not iterable\n```\n",
    "created_at": "2018-04-20T12:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350802",
    "user": "zabrocki"
}
```

It seems really slow.  We might have to implement the multiplication directly on the orbit basis.

There seems to be something wrong here:

```
sage: O = PartitionAlgebra(2,x).orbit_basis()
sage: O[[1,-1],[2],[-2]]
OP{{-2}, {-1, 1}, {2}}
sage: O[[1,-1,2,-2]]
TypeError: 'sage.rings.integer.Integer' object is not iterable
```




---

archive/issue_comments_350803.json:
```json
{
    "body": "Hmm. I forgot about this use. This is handled in 'get item'? I may have to give up on idea of allowing user to enter a permutation as a list \n\nRegarding speed, would it be bad practice to make coarse bonds a cached function? (Product in orbit basis is not known, right?)",
    "created_at": "2018-04-20T12:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350803",
    "user": "alauve"
}
```

Hmm. I forgot about this use. This is handled in 'get item'? I may have to give up on idea of allowing user to enter a permutation as a list 

Regarding speed, would it be bad practice to make coarse bonds a cached function? (Product in orbit basis is not known, right?)



---

archive/issue_comments_350804.json:
```json
{
    "body": "The product on the orbit basis is known.  I'll have to find a reference/derivation and make sure that it is faster.  We might want to cache coarsenings.  It seems like if you are doing even one change of basis for a given k it will be doing repeating the same calculations.\n\nfrom comment:17 \n> I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces.\n+1 .  Something to be done at a later date, plus improve the documentation.",
    "created_at": "2018-04-20T13:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350804",
    "user": "zabrocki"
}
```

The product on the orbit basis is known.  I'll have to find a reference/derivation and make sure that it is faster.  We might want to cache coarsenings.  It seems like if you are doing even one change of basis for a given k it will be doing repeating the same calculations.

from comment:17 
> I think this file has gotten so big it is likely more manageable to be separated out into smaller pieces.
+1 .  Something to be done at a later date, plus improve the documentation.



---

archive/issue_comments_350805.json:
```json
{
    "body": "By the way, the commit from comment:2 deleted the changes from #25146",
    "created_at": "2018-04-20T14:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350805",
    "user": "zabrocki"
}
```

By the way, the commit from comment:2 deleted the changes from #25146



---

archive/issue_comments_350806.json:
```json
{
    "body": "Replying to [comment:18 zabrocki]:\n> There seems to be something wrong here:\n> {{{\n> sage: O = PartitionAlgebra(2,x).orbit_basis()\n> sage: O[[1,-1],[2],[-2]]\n> OP{{-2}, {-1, 1}, {2}}\n> sage: O[This is the Trac macro *1,-1,2,-2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,2,-2-macro)\n> TypeError: 'sage.rings.integer.Integer' object is not iterable\n> }}}\nThis bug is present even in development branch for `PartitionAlgebra`. Should perhaps be pushed to a separate ticket?",
    "created_at": "2018-04-20T14:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350806",
    "user": "alauve"
}
```

Replying to [comment:18 zabrocki]:
> There seems to be something wrong here:
> {{{
> sage: O = PartitionAlgebra(2,x).orbit_basis()
> sage: O[[1,-1],[2],[-2]]
> OP{{-2}, {-1, 1}, {2}}
> sage: O[This is the Trac macro *1,-1,2,-2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,2,-2-macro)
> TypeError: 'sage.rings.integer.Integer' object is not iterable
> }}}
This bug is present even in development branch for `PartitionAlgebra`. Should perhaps be pushed to a separate ticket?



---

archive/issue_comments_350807.json:
```json
{
    "body": "I found a reference for the product on the orbit basis.  See Lemma 4.3 in https://arxiv.org/pdf/1707.01410.pdf .\nI checked for example that Example 4.5 (2) agrees: \n\n```\nsage: P = PartitionAlgebra(4,x);O = P.orbit_basis()\nsage: O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]\n(x^2-11*x+30)*OP{{-4}, {-3, -1}, {-2, 4}, {1}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 1}, {-2, 4}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 2, 3}, {-2, 4}, {1}} + (x^2-9*x+20)*OP{{-4, 1}, {-3, -1}, {-2, 4}, {2, 3}} + (x^2-7*x+12)*OP{{-4, 1}, {-3, -1, 2, 3}, {-2, 4}} + (x^2-9*x+20)*OP{{-4, 2, 3}, {-3, -1}, {-2, 4}, {1}} + (x^2-7*x+12)*OP{{-4, 2, 3}, {-3, -1, 1}, {-2, 4}}\nsage: %timeit O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]\n1 loop, best of 3: 3.82 s per loop\n```\n",
    "created_at": "2018-04-20T18:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350807",
    "user": "zabrocki"
}
```

I found a reference for the product on the orbit basis.  See Lemma 4.3 in https://arxiv.org/pdf/1707.01410.pdf .
I checked for example that Example 4.5 (2) agrees: 

```
sage: P = PartitionAlgebra(4,x);O = P.orbit_basis()
sage: O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]
(x^2-11*x+30)*OP{{-4}, {-3, -1}, {-2, 4}, {1}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 1}, {-2, 4}, {2, 3}} + (x^2-9*x+20)*OP{{-4}, {-3, -1, 2, 3}, {-2, 4}, {1}} + (x^2-9*x+20)*OP{{-4, 1}, {-3, -1}, {-2, 4}, {2, 3}} + (x^2-7*x+12)*OP{{-4, 1}, {-3, -1, 2, 3}, {-2, 4}} + (x^2-9*x+20)*OP{{-4, 2, 3}, {-3, -1}, {-2, 4}, {1}} + (x^2-7*x+12)*OP{{-4, 2, 3}, {-3, -1, 1}, {-2, 4}}
sage: %timeit O[[1],[-1],[2,3],[4,-2],[-3,-4]]*O[[1],[2,-2],[3,4],[-1,-3],[-4]]
1 loop, best of 3: 3.82 s per loop
```




---

archive/issue_comments_350808.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-20T19:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350808",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350809.json:
```json
{
    "body": "That fix is quite easy so I don't think it should be a separate ticket and we should not be adding more bases and propagating this error. Let me point out a minor  problem that perhaps should be on a separate ticket:\n\n```\nsage: P = PartitionAlgebra(4,x)\nsage: P[[1,-1,2,-2]]\nP{{-2, -1, 1, 2}}\n```\n\nI feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.\n\n```\nP{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}\n```\n",
    "created_at": "2018-04-20T19:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350809",
    "user": "zabrocki"
}
```

That fix is quite easy so I don't think it should be a separate ticket and we should not be adding more bases and propagating this error. Let me point out a minor  problem that perhaps should be on a separate ticket:

```
sage: P = PartitionAlgebra(4,x)
sage: P[[1,-1,2,-2]]
P{{-2, -1, 1, 2}}
```

I feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.

```
P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}
```




---

archive/issue_comments_350810.json:
```json
{
    "body": "Replying to [comment:25 zabrocki]:\n> Let me point out a minor  problem that perhaps should be on a separate ticket:\n> {{{\n> sage: P = PartitionAlgebra(4,x)\n> sage: P[This is the Trac macro *1,-1,2,-2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,2,-2-macro)\n> P{{-2, -1, 1, 2}}\n> }}}\n\nHmm. This is the sort of thing I've tried to address with my work. See how it works with this alternate construction:\n\n```\nsage: P = PartitionAlgebra(4,x)\nsage: P([[1,-1,2,-2]])\nP{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n\nsage: P([[-1,-2],[1],[2]])\nP{{-4, 4}, {-3, 3}, {-2, -1}, {1}, {2}}\n```\n\nSo... in the `__getitem__` method, perhaps one could push to `._diag_to_Blst` to solve the problem?\n\n.\n\n> I feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.\n> {{{\n> P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}\n> }}}\nI would prefer that missing nodes come in as pairs, if possible, instead of adding singleton blocks, because this is how smaller partition algebras would embed into larger ones. I have tried to allow for singleton blocks in `._diag_to_Blst` as well: i you want to add things as singletons, you can add a stray unpaired singleton. This is **not documented well:**\n\n```\nsage: P([[1,-1,2,-2]])\nP{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n\nsage: P([[1,-1,2,-2],[4]])\nP{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}\n\nsage: P([[-1,-2],[1],[2,3]])\nP{{-4}, {-3}, {-2, -1}, {1}, {2, 3}, {4}}\n```\n",
    "created_at": "2018-04-20T21:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350810",
    "user": "alauve"
}
```

Replying to [comment:25 zabrocki]:
> Let me point out a minor  problem that perhaps should be on a separate ticket:
> {{{
> sage: P = PartitionAlgebra(4,x)
> sage: P[This is the Trac macro *1,-1,2,-2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,2,-2-macro)
> P{{-2, -1, 1, 2}}
> }}}

Hmm. This is the sort of thing I've tried to address with my work. See how it works with this alternate construction:

```
sage: P = PartitionAlgebra(4,x)
sage: P([[1,-1,2,-2]])
P{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}

sage: P([[-1,-2],[1],[2]])
P{{-4, 4}, {-3, 3}, {-2, -1}, {1}, {2}}
```

So... in the `__getitem__` method, perhaps one could push to `._diag_to_Blst` to solve the problem?

.

> I feel like we should  element constructor for `PartitionDiagrams(k)` or check that the missing values are not there and raise an error.  I think that the shorthand notation for blocks being left out is that they are all of size 1.
> {{{
> P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}
> }}}
I would prefer that missing nodes come in as pairs, if possible, instead of adding singleton blocks, because this is how smaller partition algebras would embed into larger ones. I have tried to allow for singleton blocks in `._diag_to_Blst` as well: i you want to add things as singletons, you can add a stray unpaired singleton. This is **not documented well:**

```
sage: P([[1,-1,2,-2]])
P{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}

sage: P([[1,-1,2,-2],[4]])
P{{-4}, {-3}, {-2, -1, 1, 2}, {3}, {4}}

sage: P([[-1,-2],[1],[2,3]])
P{{-4}, {-3}, {-2, -1}, {1}, {2, 3}, {4}}
```




---

archive/issue_comments_350811.json:
```json
{
    "body": "I'm not even sure how it is making those decisions based on your examples.  I would have paired the 4 and -4 in the last one.  Can you explain what it is doing?\n\nI understand the reason for wanting to pair up for the Brauer algebra, but I don't know if that is particularly natural for the partition algebra or not.  The problem arises if there are an odd number of vertices that are unpaired or if there are not the same number of positive as negative.",
    "created_at": "2018-04-20T21:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350811",
    "user": "zabrocki"
}
```

I'm not even sure how it is making those decisions based on your examples.  I would have paired the 4 and -4 in the last one.  Can you explain what it is doing?

I understand the reason for wanting to pair up for the Brauer algebra, but I don't know if that is particularly natural for the partition algebra or not.  The problem arises if there are an odd number of vertices that are unpaired or if there are not the same number of positive as negative.



---

archive/issue_comments_350812.json:
```json
{
    "body": "The pairing that it tries to do is of the form (+i,-i) for all omitted nodes. If the omitted nodes cannot be so paired, then it brings in everything nodes as singletons.\n\n(So the question about an even or odd number of omitted nodes doesn't quite enter into the story.) \nI note that this even works for putting P_n into P_{n+1/2} story, where one insists that (n+1) and -(n+1) always appear in the same block.\n\nHere is the code, roughly:\n\n```\n        nodes = flatten(map(list, d))\n        assert max(nodes) <= self._k\n        if all([-i in nodes for i in nodes]):\n            d = to_set_partition(d, self._k, through_strands=True)\n        else:\n            d = to_set_partition(d, self._k)\n        return self[self._base_diagrams(d)]\n```\n\n\nWhere, the optional argument 'through_strands' for the function `to_set_partition` brings omitted nodes in as pairs (i,-i). The default value is `False`.",
    "created_at": "2018-04-20T22:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350812",
    "user": "alauve"
}
```

The pairing that it tries to do is of the form (+i,-i) for all omitted nodes. If the omitted nodes cannot be so paired, then it brings in everything nodes as singletons.

(So the question about an even or odd number of omitted nodes doesn't quite enter into the story.) 
I note that this even works for putting P_n into P_{n+1/2} story, where one insists that (n+1) and -(n+1) always appear in the same block.

Here is the code, roughly:

```
        nodes = flatten(map(list, d))
        assert max(nodes) <= self._k
        if all([-i in nodes for i in nodes]):
            d = to_set_partition(d, self._k, through_strands=True)
        else:
            d = to_set_partition(d, self._k)
        return self[self._base_diagrams(d)]
```


Where, the optional argument 'through_strands' for the function `to_set_partition` brings omitted nodes in as pairs (i,-i). The default value is `False`.



---

archive/issue_comments_350813.json:
```json
{
    "body": "I have a few minutes now. Let me implement the product in the orbit basis.",
    "created_at": "2018-04-20T22:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350813",
    "user": "alauve"
}
```

I have a few minutes now. Let me implement the product in the orbit basis.



---

archive/issue_comments_350814.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-20T23:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350814",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350815.json:
```json
{
    "body": "FYI - It is *much* faster to the partition algebra defined over, e.g., a polynomial ring rather than the symbolic ring.\n\nWhen looking at the multiplication-by-coercion timings with `%prun`, about 1/3 of the time was spent constructing `Set` objects, 1/3 of the time (not necessarily disjoint) was spent in coarsenings, and at most 1/3 was spent in the other helper functions of `diagram_algebras.py`. However, the direct version takes almost no time. I will push momentarily a corrected version.",
    "created_at": "2018-04-21T04:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350815",
    "user": "tscrim"
}
```

FYI - It is *much* faster to the partition algebra defined over, e.g., a polynomial ring rather than the symbolic ring.

When looking at the multiplication-by-coercion timings with `%prun`, about 1/3 of the time was spent constructing `Set` objects, 1/3 of the time (not necessarily disjoint) was spent in coarsenings, and at most 1/3 was spent in the other helper functions of `diagram_algebras.py`. However, the direct version takes almost no time. I will push momentarily a corrected version.



---

archive/issue_comments_350816.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T04:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350816",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350817.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-21T04:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350817",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_350818.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-21T04:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350818",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_350819.json:
```json
{
    "body": "Thanks for catching my math mistake, Travis. I realized I miscoded the formula as I was walking to the train. \n\nThis wasn't the snag I hit, though. For some reason I couldn't even compose diagrams:\n\n```\nsage: P = PartitionAlgebra(3,x); PD = P.basis().keys()\nsage: d1 = PD.random_element(); d2 = PD.random_element()\nsage: d1.compose(d2)\n```\n\nthe last line throwing some `TypeError`::\n\n```\nTypeError                                 Traceback (most recent call last)\n<ipython-input-75-c92a56b0f000> in <module>()\n----> 1 d1.compose(d2)\n\n/Applications/sage/src/sage/combinat/diagram_algebras.py in compose(self, other)\n    360         \"\"\"\n    361         (composite_diagram, loops_removed) = set_partition_composition(self._base_diagram, other._base_diagram)\n--> 362         return (self.__class__(self.parent(), composite_diagram), loops_removed)\n    363 \n    364     def propagating_number(self):\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1672)()\n    331         else:\n    332             # Fast version of type.__call__(cls, *args, **kwds)\n--> 333             return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n    334 \n    335     def __get__(cls, instance, owner):\n\n/Applications/sage/src/sage/combinat/diagram_algebras.py in __init__(self, parent, d)\n    240         \"\"\"\n    241         self._base_diagram = tuple(sorted(tuple(sorted(i)) for i in d))\n--> 242         super(AbstractPartitionDiagram, self).__init__(parent, self._base_diagram)\n    243 \n    244     def check(self):\n\nTypeError: super(type, obj): obj must be an instance or subtype of type\n```\n\n\nIt seems to work now, so I don't know what classes I accidentally made `d1` and `d2`. I'll play around a bit more to see if I can reproduce the error.",
    "created_at": "2018-04-21T12:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350819",
    "user": "alauve"
}
```

Thanks for catching my math mistake, Travis. I realized I miscoded the formula as I was walking to the train. 

This wasn't the snag I hit, though. For some reason I couldn't even compose diagrams:

```
sage: P = PartitionAlgebra(3,x); PD = P.basis().keys()
sage: d1 = PD.random_element(); d2 = PD.random_element()
sage: d1.compose(d2)
```

the last line throwing some `TypeError`::

```
TypeError                                 Traceback (most recent call last)
<ipython-input-75-c92a56b0f000> in <module>()
----> 1 d1.compose(d2)

/Applications/sage/src/sage/combinat/diagram_algebras.py in compose(self, other)
    360         """
    361         (composite_diagram, loops_removed) = set_partition_composition(self._base_diagram, other._base_diagram)
--> 362         return (self.__class__(self.parent(), composite_diagram), loops_removed)
    363 
    364     def propagating_number(self):

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1672)()
    331         else:
    332             # Fast version of type.__call__(cls, *args, **kwds)
--> 333             return (<PyTypeObject*>type).tp_call(cls, args, kwds)
    334 
    335     def __get__(cls, instance, owner):

/Applications/sage/src/sage/combinat/diagram_algebras.py in __init__(self, parent, d)
    240         """
    241         self._base_diagram = tuple(sorted(tuple(sorted(i)) for i in d))
--> 242         super(AbstractPartitionDiagram, self).__init__(parent, self._base_diagram)
    243 
    244     def check(self):

TypeError: super(type, obj): obj must be an instance or subtype of type
```


It seems to work now, so I don't know what classes I accidentally made `d1` and `d2`. I'll play around a bit more to see if I can reproduce the error.



---

archive/issue_comments_350820.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T13:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350820",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350821.json:
```json
{
    "body": "What do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4",
    "created_at": "2018-04-21T14:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350821",
    "user": "zabrocki"
}
```

What do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4



---

archive/issue_comments_350822.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T14:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350822",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350823.json:
```json
{
    "body": "Replying to [comment:37 zabrocki]:\n> What do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4\n\nWell, since I caused the problem, I guess I should try to solve it. Will take a look now to see how easy are they to merge \"by hand\".",
    "created_at": "2018-04-21T14:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350823",
    "user": "alauve"
}
```

Replying to [comment:37 zabrocki]:
> What do we do about #25146 ?  This branch is (partially) merged, but Aaron deleted those changes in 9d1b0b4

Well, since I caused the problem, I guess I should try to solve it. Will take a look now to see how easy are they to merge "by hand".



---

archive/issue_comments_350824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-21T22:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350825.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-23T14:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350825",
    "user": "alauve"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_350826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-24T00:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350826",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350827.json:
```json
{
    "body": "Here is an updated branch with my changes from #25146, as well as fixing what should be the only docstring issue, bring to full doctest coverage, and some misc fixes.",
    "created_at": "2018-04-24T00:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350827",
    "user": "tscrim"
}
```

Here is an updated branch with my changes from #25146, as well as fixing what should be the only docstring issue, bring to full doctest coverage, and some misc fixes.



---

archive/issue_comments_350828.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-04T16:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350828",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350829.json:
```json
{
    "body": "I want to question the use of `O`+prefix for the orbit basis and propose that it be switched just to `O` or `o`.  Is the double letter really necessary here?  The expressions are already extremely long because the default display of set partitions has so many braces.  I would prefer to have the default prefix be more compact.  I computed an example the other day and I thought the `OP` prefix was heavy notation (but hey, the code worked as promised and has been very helpful!).\n\nI also found it was misleading when I was looking at the `to_orbit_basis` in the `SubPartitionAlgebra` because then it generated a basis indexed by `OB` and I thought that this poorly indicated that this was not the orbit basis of the Brauer algebra, but instead the orbit basis of the partition algebra (I actually also find this strange behavior for `ambient` and `lift` but these are not new to this ticket).\n\nEither way, I would just as soon have the display prefix for the basis be simply `O`.  Are there objections to me changing it?",
    "created_at": "2018-05-04T16:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350829",
    "user": "zabrocki"
}
```

I want to question the use of `O`+prefix for the orbit basis and propose that it be switched just to `O` or `o`.  Is the double letter really necessary here?  The expressions are already extremely long because the default display of set partitions has so many braces.  I would prefer to have the default prefix be more compact.  I computed an example the other day and I thought the `OP` prefix was heavy notation (but hey, the code worked as promised and has been very helpful!).

I also found it was misleading when I was looking at the `to_orbit_basis` in the `SubPartitionAlgebra` because then it generated a basis indexed by `OB` and I thought that this poorly indicated that this was not the orbit basis of the Brauer algebra, but instead the orbit basis of the partition algebra (I actually also find this strange behavior for `ambient` and `lift` but these are not new to this ticket).

Either way, I would just as soon have the display prefix for the basis be simply `O`.  Are there objections to me changing it?



---

archive/issue_comments_350830.json:
```json
{
    "body": "`O` is fine by me. \n\nYes, the lift functionality is strange. I don't think it should keep the same letter as prefix, after lift, as it had before. But I decided not to mess with it. We could perhaps remove this method, but I thought there could be some use for it. Shall I work on improving the surrounding documentation?",
    "created_at": "2018-05-05T12:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350830",
    "user": "alauve"
}
```

`O` is fine by me. 

Yes, the lift functionality is strange. I don't think it should keep the same letter as prefix, after lift, as it had before. But I decided not to mess with it. We could perhaps remove this method, but I thought there could be some use for it. Shall I work on improving the surrounding documentation?



---

archive/issue_comments_350831.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T13:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350831",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350832.json:
```json
{
    "body": "pyflakes says\n\n```\nsrc/sage/combinat/diagram_algebras.py:28: 'sage.categories.algebras.Algebras' imported but unused\nsrc/sage/combinat/diagram_algebras.py:2801: local variable 'k' is assigned to but never used\n```\n",
    "created_at": "2018-05-05T14:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350832",
    "user": "chapoton"
}
```

pyflakes says

```
src/sage/combinat/diagram_algebras.py:28: 'sage.categories.algebras.Algebras' imported but unused
src/sage/combinat/diagram_algebras.py:2801: local variable 'k' is assigned to but never used
```




---

archive/issue_comments_350833.json:
```json
{
    "body": "I think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in comment:25 .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.\n\n\n```\nsage: P3 = PartitionAlgebra(3,x,prefix='P3'); P4 = PartitionAlgebra(4,x,prefix='P4')\nsage: P2(P[[1,-2,2,-1]])\nP4{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n```\n\nbut\n\n```\nsage: P3 = PartitionAlgebra(3,x); Px = PartitionAlgebra(7/2,x,prefix='P3.5')\nsage: Px(P3[[1,-2,2,-1]])\nValueError: {{-3, 3}, {-2, -1, 1, 2}} does not represent two rows of vertices of order 7/2\nsage: Px(P4[[1,-2,2,-1]])\nP3.5{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}\n```\n\n\nso I think that there is something wrong (probably minor).",
    "created_at": "2018-05-05T14:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350833",
    "user": "zabrocki"
}
```

I think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in comment:25 .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.


```
sage: P3 = PartitionAlgebra(3,x,prefix='P3'); P4 = PartitionAlgebra(4,x,prefix='P4')
sage: P2(P[[1,-2,2,-1]])
P4{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}
```

but

```
sage: P3 = PartitionAlgebra(3,x); Px = PartitionAlgebra(7/2,x,prefix='P3.5')
sage: Px(P3[[1,-2,2,-1]])
ValueError: {{-3, 3}, {-2, -1, 1, 2}} does not represent two rows of vertices of order 7/2
sage: Px(P4[[1,-2,2,-1]])
P3.5{{-4, 4}, {-3, 3}, {-2, -1, 1, 2}}
```


so I think that there is something wrong (probably minor).



---

archive/issue_comments_350834.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-05T14:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350834",
    "user": "zabrocki"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_350835.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350835",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350836.json:
```json
{
    "body": "Replying to [comment:49 zabrocki]:\n> I think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in comment:25 .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.\n\nYes, this.",
    "created_at": "2018-05-05T14:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350836",
    "user": "alauve"
}
```

Replying to [comment:49 zabrocki]:
> I think that things left to do here are mostly improvements in the documentation and this embedding thing we started discussing in comment:25 .   Before I make any changes I just want to review what should be the right thing to do.  I think that P_k -> P_{k+1/2} -> P_{k+1} should be the same as P_{k} -> P_{k+1}.  In which case it is appropriate (as you say) to connect k+1 and -k-1 together.

Yes, this.



---

archive/issue_comments_350837.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T16:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350837",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350838.json:
```json
{
    "body": "See if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:\n\n```\nsage: P = PartitionAlgebra(3,x)\nsage: P[[1]]\nP{{-3}, {-2}, {-1}, {1}, {2}, {3}}\n```\n\nbut I just made it pair the missing {i,-i} strands if it can.  Now:\n\n```\nsage: P = PartitionAlgebra(3,x)\nsage: P[[1]]\nP{{-3, 3}, {-2, 2}, {-1}, {1}}\n```\n",
    "created_at": "2018-05-05T16:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350838",
    "user": "zabrocki"
}
```

See if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:

```
sage: P = PartitionAlgebra(3,x)
sage: P[[1]]
P{{-3}, {-2}, {-1}, {1}, {2}, {3}}
```

but I just made it pair the missing {i,-i} strands if it can.  Now:

```
sage: P = PartitionAlgebra(3,x)
sage: P[[1]]
P{{-3, 3}, {-2, 2}, {-1}, {1}}
```




---

archive/issue_comments_350839.json:
```json
{
    "body": "Replying to [comment:53 zabrocki]:\n> See if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:\n> {{{\n> sage: P = PartitionAlgebra(3,x)\n> sage: P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)\n> P{{-3}, {-2}, {-1}, {1}, {2}, {3}}\n> }}}\n> but I just made it pair the missing {i,-i} strands if it can.  Now:\n> {{{\n> sage: P = PartitionAlgebra(3,x)\n> sage: P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)\n> P{{-3, 3}, {-2, 2}, {-1}, {1}}\n> }}}\n\nMy idea was to preserve the ability to bring things in with singletons. \nTry \n\n```\nP[[1],[-1]]\n```\n",
    "created_at": "2018-05-05T17:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350839",
    "user": "alauve"
}
```

Replying to [comment:53 zabrocki]:
> See if you agree with this behavior.  I didn't understand what it was doing before.  There was a test `pairing_is_possible` which didn't always seem like the right thing to do.  Before:
> {{{
> sage: P = PartitionAlgebra(3,x)
> sage: P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)
> P{{-3}, {-2}, {-1}, {1}, {2}, {3}}
> }}}
> but I just made it pair the missing {i,-i} strands if it can.  Now:
> {{{
> sage: P = PartitionAlgebra(3,x)
> sage: P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)
> P{{-3, 3}, {-2, 2}, {-1}, {1}}
> }}}

My idea was to preserve the ability to bring things in with singletons. 
Try 

```
P[[1],[-1]]
```




---

archive/issue_comments_350840.json:
```json
{
    "body": "> My idea was to preserve the ability to bring things in with singletons. Try\n\n```\nP[[1],[-1]]\n```\n\n\nI did \n\n```\nsage: P = PartitionAlgebra(3,x)\nsage: P[[1],[-1]]\nP{{-3, 3}, {-2, 2}, {-1}, {1}}\n```\n\nThis is what I expected.  Is that not what you thought?  Maybe I don't understand \"bring things in with singletons.\"",
    "created_at": "2018-05-05T18:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350840",
    "user": "zabrocki"
}
```

> My idea was to preserve the ability to bring things in with singletons. Try

```
P[[1],[-1]]
```


I did 

```
sage: P = PartitionAlgebra(3,x)
sage: P[[1],[-1]]
P{{-3, 3}, {-2, 2}, {-1}, {1}}
```

This is what I expected.  Is that not what you thought?  Maybe I don't understand "bring things in with singletons."



---

archive/issue_comments_350841.json:
```json
{
    "body": "It is different from \n\n```\nP[[1]]\n```\n\nwhich is the one that brings things in as singletons. The idea was if your excluded nodes don't pair up, then bring the rest in as singletons. If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.",
    "created_at": "2018-05-05T19:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350841",
    "user": "alauve"
}
```

It is different from 

```
P[[1]]
```

which is the one that brings things in as singletons. The idea was if your excluded nodes don't pair up, then bring the rest in as singletons. If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.



---

archive/issue_comments_350842.json:
```json
{
    "body": "This is what I see now (and this is what I think should be):\n\n```\nsage: P[[1]]==P[[1],[-1]]\nTrue\n```\n\n\n> The idea was if your excluded nodes don't pair up, then bring the rest in as singletons.  If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.\nThe problem to me is that is not well documented and it is complex. I think it should follow a simple and consistent rule : \"pair {i,-i} if they are not listed.  Do this as much as possible and then fill in singletons.\"\n\nWhat it was doing before was raising an error when I computed `P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)` for `P=PartitionAlgebra(5/2,x)`.",
    "created_at": "2018-05-05T19:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350842",
    "user": "zabrocki"
}
```

This is what I see now (and this is what I think should be):

```
sage: P[[1]]==P[[1],[-1]]
True
```


> The idea was if your excluded nodes don't pair up, then bring the rest in as singletons.  If you want the excluded nodes to come in as pairs (through strands), then exclude them in pairs.
The problem to me is that is not well documented and it is complex. I think it should follow a simple and consistent rule : "pair {i,-i} if they are not listed.  Do this as much as possible and then fill in singletons."

What it was doing before was raising an error when I computed `P[This is the Trac macro *1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1-macro)` for `P=PartitionAlgebra(5/2,x)`.



---

archive/issue_comments_350843.json:
```json
{
    "body": "That's fine with me. I was trying to preserve behavior as I found it as best as possible. But improving the documentation will not improve the situation much. It is complex.",
    "created_at": "2018-05-05T20:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350843",
    "user": "alauve"
}
```

That's fine with me. I was trying to preserve behavior as I found it as best as possible. But improving the documentation will not improve the situation much. It is complex.



---

archive/issue_comments_350844.json:
```json
{
    "body": "Note that `3/2 == 1` in Python2 (with `from __future__ import division`/Python3, it becomes a floating point). IMO, if you really want to add `3/2`, do it using `QQ` and then take the corresponding `floor`. Although a better approach to add 1 and then take `ceil`.\n\nAlso, if you want to change the \"default\" output, you can add the global options change to your `~/.sage/sage.init` (or wherever your `.sage` directory is). Commands in this file are run on startup. Although for this to work, we would need a ticket to add a global option to `SetPartition` or to `PartitionAlgebra`.",
    "created_at": "2018-05-05T21:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350844",
    "user": "tscrim"
}
```

Note that `3/2 == 1` in Python2 (with `from __future__ import division`/Python3, it becomes a floating point). IMO, if you really want to add `3/2`, do it using `QQ` and then take the corresponding `floor`. Although a better approach to add 1 and then take `ceil`.

Also, if you want to change the "default" output, you can add the global options change to your `~/.sage/sage.init` (or wherever your `.sage` directory is). Commands in this file are run on startup. Although for this to work, we would need a ticket to add a global option to `SetPartition` or to `PartitionAlgebra`.



---

archive/issue_comments_350845.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T21:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350845",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350846.json:
```json
{
    "body": "I agree that a global options is in order for `SetPartition` and `PartitionAlgebra`.  A compact notation would be a nice feature.  I think that there is a lot of work to do to implement the some results of Halverson-Ram (e.g. Jucys-Murphy elements, class type of a diagram, various flavors of generators, etc.).  Plus reorganizing some of the code because the file has become quite huge.  These are all items for followup tickets.\n\nOne of the nice features of the diagram algebra code is the latex of an expression.  [BH2017] differentiates the latex of the diagram basis from the orbit basis by filled nodes so I added this for the latex of the orbit basis (although it switches BH convention in that orbit basis has filled nodes and diagram basis has not filled nodes).\n\n> Although a better approach to add 1 and then take `ceil`.\nI went with this approach (in fact, I had it before).",
    "created_at": "2018-05-06T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350846",
    "user": "zabrocki"
}
```

I agree that a global options is in order for `SetPartition` and `PartitionAlgebra`.  A compact notation would be a nice feature.  I think that there is a lot of work to do to implement the some results of Halverson-Ram (e.g. Jucys-Murphy elements, class type of a diagram, various flavors of generators, etc.).  Plus reorganizing some of the code because the file has become quite huge.  These are all items for followup tickets.

One of the nice features of the diagram algebra code is the latex of an expression.  [BH2017] differentiates the latex of the diagram basis from the orbit basis by filled nodes so I added this for the latex of the orbit basis (although it switches BH convention in that orbit basis has filled nodes and diagram basis has not filled nodes).

> Although a better approach to add 1 and then take `ceil`.
I went with this approach (in fact, I had it before).



---

archive/issue_comments_350847.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-06T11:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350847",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350848.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-06T13:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350848",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350849.json:
```json
{
    "body": "I deleted the \"TODO: find a better name?\".  `elementary_symmetric` is a fine name and I would not recommend deprecating it now if there was one (and one can always add an alias if a better name comes along).\n\nI added a doctest for `diagram_algebra` because the ones that were there I think must have been copy-pasted.\n\nOtherwise I think this is ready to go.",
    "created_at": "2018-05-06T13:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350849",
    "user": "zabrocki"
}
```

I deleted the "TODO: find a better name?".  `elementary_symmetric` is a fine name and I would not recommend deprecating it now if there was one (and one can always add an alias if a better name comes along).

I added a doctest for `diagram_algebra` because the ones that were there I think must have been copy-pasted.

Otherwise I think this is ready to go.



---

archive/issue_comments_350850.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-06T13:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350850",
    "user": "zabrocki"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_350851.json:
```json
{
    "body": "I agree. Thank you.",
    "created_at": "2018-05-06T23:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350851",
    "user": "tscrim"
}
```

I agree. Thank you.



---

archive/issue_comments_350852.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-06T23:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350852",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350853.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-05-07T03:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350853",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_350854.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-05-07T03:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350854",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_350855.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-07T03:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350855",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350856.json:
```json
{
    "body": "Travis,\n* The function I deleted was one I added in an earlier revision within this branch. After Mike's changes, it's no longer needed. So I deleted it. \n\n* Not quite sure if the work I did is worthy of mention. Please feel free to yank the new line in the header.\n\n* It looks like all the changes from #25146 have been mixed in here. That ticket seems stable now. There are some differences, of course, but nothing that should affect a merge. Should this be double-checked before setting to positive review?",
    "created_at": "2018-05-07T03:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350856",
    "user": "alauve"
}
```

Travis,
* The function I deleted was one I added in an earlier revision within this branch. After Mike's changes, it's no longer needed. So I deleted it. 

* Not quite sure if the work I did is worthy of mention. Please feel free to yank the new line in the header.

* It looks like all the changes from #25146 have been mixed in here. That ticket seems stable now. There are some differences, of course, but nothing that should affect a merge. Should this be double-checked before setting to positive review?



---

archive/issue_comments_350857.json:
```json
{
    "body": "All of the changes from #25146 have been merged in here.",
    "created_at": "2018-05-07T04:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350857",
    "user": "tscrim"
}
```

All of the changes from #25146 have been merged in here.



---

archive/issue_comments_350858.json:
```json
{
    "body": "Okay. If there's no objection, I shall move ticket status back to \"positive review\".",
    "created_at": "2018-05-07T14:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350858",
    "user": "alauve"
}
```

Okay. If there's no objection, I shall move ticket status back to "positive review".



---

archive/issue_comments_350859.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-07T14:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350859",
    "user": "alauve"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350860.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-05-10T09:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350860",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_350861.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-05-10T09:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350861",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_350862.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-10T09:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350862",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350863.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-10T09:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350863",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350864.json:
```json
{
    "body": "Trivial rebase and marked one test as long. I'm allowing myself to set it back to a positive review.",
    "created_at": "2018-05-10T09:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350864",
    "user": "tscrim"
}
```

Trivial rebase and marked one test as long. I'm allowing myself to set it back to a positive review.



---

archive/issue_comments_350865.json:
```json
{
    "body": "Fails on 32-bit:\n\n```\nFile \"src/sage/combinat/diagram_algebras.py\", line 2228, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_\nFailed example:\n    A(S.an_element())\nExpected:\n    P{{-3, 3}, {-2, 2}, {-1, 1}} + P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}}\n     + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}\nGot:\n    P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}} + P{{-3, 3}, {-2, 2}, {-1, 1}} + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}\n**********************************************************************\nFile \"src/sage/combinat/diagram_algebras.py\", line 2234, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_\nFailed example:\n    A(B.an_element())\nExpected:\n    2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 2*P{{-3, 1}, {-2, 3}, {-1, 2}}\n     + 3*P{{-3, 1}, {-2, -1}, {2, 3}}\nGot:\n    2*P{{-3, 1}, {-2, 3}, {-1, 2}} + 2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 3*P{{-3, 1}, {-2, -1}, {2, 3}}\n**********************************************************************\nFile \"src/sage/combinat/diagram_algebras.py\", line 2371, in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_\nFailed example:\n    A._coerce_map_from_(O3)(elt)\nExpected:\n    3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}} - 3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}}\n     + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}}\nGot:\n    -3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}} + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}} + 3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}}\n**********************************************************************\nFile \"src/sage/combinat/diagram_algebras.py\", line 2776, in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis\nFailed example:\n    O[[1,-1],[2,-2],[3],[4,-3],[-4]] * O[[1,-2],[2],[3,-1],[4],[-3],[-4]]\nExpected:\n    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}}\n     + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}\n     + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}}\nGot:\n    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}} + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}} + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}\n**********************************************************************\n3 items had failures:\n   1 of  29 in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis\n   1 of  17 in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_\n   2 of  39 in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_\n    [781 tests, 4 failures, 19.54 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/combinat/diagram_algebras.py  # 4 doctests failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2018-05-18T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350865",
    "user": "vbraun"
}
```

Fails on 32-bit:

```
File "src/sage/combinat/diagram_algebras.py", line 2228, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_
Failed example:
    A(S.an_element())
Expected:
    P{{-3, 3}, {-2, 2}, {-1, 1}} + P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}}
     + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}
Got:
    P{{-3, 1}, {-2, 3}, {-1, 2}} + 3*P{{-3, 3}, {-2, 1}, {-1, 2}} + P{{-3, 3}, {-2, 2}, {-1, 1}} + 2*P{{-3, 2}, {-2, 3}, {-1, 1}}
**********************************************************************
File "src/sage/combinat/diagram_algebras.py", line 2234, in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_
Failed example:
    A(B.an_element())
Expected:
    2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 2*P{{-3, 1}, {-2, 3}, {-1, 2}}
     + 3*P{{-3, 1}, {-2, -1}, {2, 3}}
Got:
    2*P{{-3, 1}, {-2, 3}, {-1, 2}} + 2*P{{-3, 1}, {-2, 2}, {-1, 3}} + 3*P{{-3, 1}, {-2, -1}, {2, 3}}
**********************************************************************
File "src/sage/combinat/diagram_algebras.py", line 2371, in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_
Failed example:
    A._coerce_map_from_(O3)(elt)
Expected:
    3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}} - 3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}}
     + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}}
Got:
    -3*P{{-4, 4}, {-3, -2, -1, 1, 2, 3}} + 2*P{{-4, 4}, {-3, -2, -1, 2, 3}, {1}} + 3*P{{-4, 4}, {-3, -2, -1, 1, 3}, {2}}
**********************************************************************
File "src/sage/combinat/diagram_algebras.py", line 2776, in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis
Failed example:
    O[[1,-1],[2,-2],[3],[4,-3],[-4]] * O[[1,-2],[2],[3,-1],[4],[-3],[-4]]
Expected:
    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}}
     + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}
     + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}}
Got:
    (x-6)*O{{-4}, {-3}, {-2, 1}, {-1, 4}, {2}, {3}} + (x-5)*O{{-4, 3}, {-3}, {-2, 1}, {-1, 4}, {2}} + (x-5)*O{{-4}, {-3, 3}, {-2, 1}, {-1, 4}, {2}}
**********************************************************************
3 items had failures:
   1 of  29 in sage.combinat.diagram_algebras.OrbitBasis.product_on_basis
   1 of  17 in sage.combinat.diagram_algebras.PartitionAlgebra._coerce_map_from_
   2 of  39 in sage.combinat.diagram_algebras.PartitionAlgebra._element_constructor_
    [781 tests, 4 failures, 19.54 s]
----------------------------------------------------------------------
sage -t --long src/sage/combinat/diagram_algebras.py  # 4 doctests failed
----------------------------------------------------------------------
```




---

archive/issue_comments_350866.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-18T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350866",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_350867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-19T08:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350867",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350868.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-19T08:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350868",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350869.json:
```json
{
    "body": "So it turns out AFAIK that no `<` comparison was returning `True` for the diagrams. This was because the abstract `__lt__` check was checking the subclass `SetPartition` rather than `AbstractSetPartition`. However, I implemented a custom `__lt__` to take advantage of the `_base_diagram`. To be honest, I am surprised we were not seeing (more) machine-specific output-order doctest failures.\n\nI also implemented a custom hash to use `_base_diagram` for better speed and better compatibility with `==`.",
    "created_at": "2018-05-19T08:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350869",
    "user": "tscrim"
}
```

So it turns out AFAIK that no `<` comparison was returning `True` for the diagrams. This was because the abstract `__lt__` check was checking the subclass `SetPartition` rather than `AbstractSetPartition`. However, I implemented a custom `__lt__` to take advantage of the `_base_diagram`. To be honest, I am surprised we were not seeing (more) machine-specific output-order doctest failures.

I also implemented a custom hash to use `_base_diagram` for better speed and better compatibility with `==`.



---

archive/issue_comments_350870.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-19T08:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350870",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_350871.json:
```json
{
    "body": "All tests pass on my machine, but so did the previous version.  If you are confident that it fixes the problem, I'll say positive review.",
    "created_at": "2018-05-19T18:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350871",
    "user": "zabrocki"
}
```

All tests pass on my machine, but so did the previous version.  If you are confident that it fixes the problem, I'll say positive review.



---

archive/issue_comments_350872.json:
```json
{
    "body": "Yes, it is doing the comparison by the lex ordering of `AbstractSetPartition`.",
    "created_at": "2018-05-19T19:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350872",
    "user": "tscrim"
}
```

Yes, it is doing the comparison by the lex ordering of `AbstractSetPartition`.



---

archive/issue_comments_350873.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-19T19:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350873",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350874.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-24T07:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24925#issuecomment-350874",
    "user": "vbraun"
}
```

Resolution: fixed
