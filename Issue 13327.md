# Issue 13327: short_vector_list_up_to_length is slow and wrong

archive/issues_013327.json:
```json
{
    "body": "Assignee: justin\n\n1) The method short_vector_list_up_to_length does not return a list of vectors as claimed in the documentation.\n2) Even with lattices of rank 6 and determinant 3 it takes really long to get the result. This is not PARI's fault (which is called in the background), but pexpect's.\n3) In some cases no result will be returned because to many GP queries are performed. This exceeds the maximal number of GP's sage[...] variables.\n\nAll this is fixed (the speed only in parts) by the attached patch.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13531\n\n",
    "created_at": "2012-09-25T13:54:42Z",
    "labels": [
        "component: quadratic forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "short_vector_list_up_to_length is slow and wrong",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13327",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```
Assignee: justin

1) The method short_vector_list_up_to_length does not return a list of vectors as claimed in the documentation.
2) Even with lattices of rank 6 and determinant 3 it takes really long to get the result. This is not PARI's fault (which is called in the background), but pexpect's.
3) In some cases no result will be returned because to many GP queries are performed. This exceeds the maximal number of GP's sage[...] variables.

All this is fixed (the speed only in parts) by the attached patch.

Issue created by migration from https://trac.sagemath.org/ticket/13531





---

archive/issue_comments_163479.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-25T13:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163479",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_163480.json:
```json
{
    "body": "I had to make even further changes, since Pari sometimes returns incorrect results. I will send a report to upstream, and I have built in a work around for the moment. For the record, I reproduce the corresponding example here.\n\n```\nqf = [72, 12; 12, 120];\nvecs = qfminim(qf, 2*22953421 - 2);\nmatsize(vecs[3])\nfor(i=1,matsize(vecs[3])[2],if(72 * vecs[3][1,i]^2 + 24 * vecs[3][1,i]*vecs[3][2,i] + 120 * vecs[3][2,i]^2 > 2*22953421 - 2, print(vecs[3][,i])))\n```\n\ngives the following:\n\n```\n[-65, 623]~\n[-143, 623]~\n[-44, 622]~\n[-16, 620]~\n[-220, 617]~\n[-243, 614]~\n[65, 610]~\n[77, 608]~\n[-285, 607]~\n[-300, 604]~\n[-361, 589]~\n[-381, 583]~\n[220, 573]~\n[-411, 573]~\n[-422, 569]~\n[247, 564]~\n[-435, 564]~\n[-445, 560]~\n[285, 550]~\n[300, 544]~\n[312, 539]~\n[-515, 527]~\n[348, 523]~\n[-548, 508]~\n[407, 493]~\n[416, 488]~\n[423, 484]~\n[435, 477]~\n[-594, 477]~\n[445, 471]~\n[-602, 471]~\n[-611, 464]~\n[504, 432]~\n[-648, 432]~\n[515, 424]~\n[519, 421]~\n[523, 418]~\n[536, 408]~\n[-672, 408]~\n[557, 391]~\n[-699, 377]~\n[591, 361]~\n[-715, 356]~\n[-720, 349]~\n[633, 319]~\n[-744, 311]~\n[-749, 302]~\n[-763, 274]~\n[681, 262]~\n[684, 258]~\n[-770, 258]~\n[-774, 248]~\n[715, 213]~\n[-786, 213]~\n[720, 205]~\n[723, 200]~\n[726, 195]~\n[-791, 195]~\n[-792, 191]~\n[734, 181]~\n[741, 168]~\n[-797, 168]~\n[752, 146]~\n[758, 133]~\n[764, 119]~\n[-804, 115]~\n[770, 104]~\n[773, 96]~\n[-805, 96]~\n[-805, 65]~\n[-804, 46]~\n[-803, 34]~\n[796, 14]~\n[798, 3]~\n[-799, 3]~\n```\n",
    "created_at": "2012-10-24T10:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163480",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

I had to make even further changes, since Pari sometimes returns incorrect results. I will send a report to upstream, and I have built in a work around for the moment. For the record, I reproduce the corresponding example here.

```
qf = [72, 12; 12, 120];
vecs = qfminim(qf, 2*22953421 - 2);
matsize(vecs[3])
for(i=1,matsize(vecs[3])[2],if(72 * vecs[3][1,i]^2 + 24 * vecs[3][1,i]*vecs[3][2,i] + 120 * vecs[3][2,i]^2 > 2*22953421 - 2, print(vecs[3][,i])))
```

gives the following:

```
[-65, 623]~
[-143, 623]~
[-44, 622]~
[-16, 620]~
[-220, 617]~
[-243, 614]~
[65, 610]~
[77, 608]~
[-285, 607]~
[-300, 604]~
[-361, 589]~
[-381, 583]~
[220, 573]~
[-411, 573]~
[-422, 569]~
[247, 564]~
[-435, 564]~
[-445, 560]~
[285, 550]~
[300, 544]~
[312, 539]~
[-515, 527]~
[348, 523]~
[-548, 508]~
[407, 493]~
[416, 488]~
[423, 484]~
[435, 477]~
[-594, 477]~
[445, 471]~
[-602, 471]~
[-611, 464]~
[504, 432]~
[-648, 432]~
[515, 424]~
[519, 421]~
[523, 418]~
[536, 408]~
[-672, 408]~
[557, 391]~
[-699, 377]~
[591, 361]~
[-715, 356]~
[-720, 349]~
[633, 319]~
[-744, 311]~
[-749, 302]~
[-763, 274]~
[681, 262]~
[684, 258]~
[-770, 258]~
[-774, 248]~
[715, 213]~
[-786, 213]~
[720, 205]~
[723, 200]~
[726, 195]~
[-791, 195]~
[-792, 191]~
[734, 181]~
[741, 168]~
[-797, 168]~
[752, 146]~
[758, 133]~
[764, 119]~
[-804, 115]~
[770, 104]~
[773, 96]~
[-805, 96]~
[-805, 65]~
[-804, 46]~
[-803, 34]~
[796, 14]~
[798, 3]~
[-799, 3]~
```




---

archive/issue_comments_163481.json:
```json
{
    "body": "Can you add a doctests for the Pari bug and a link to the upstream bug report? Presumably we'll want to remove your workaround when it is fixed.",
    "created_at": "2013-01-30T15:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163481",
    "user": "https://github.com/vbraun"
}
```

Can you add a doctests for the Pari bug and a link to the upstream bug report? Presumably we'll want to remove your workaround when it is fixed.



---

archive/issue_comments_163482.json:
```json
{
    "body": "Attachment [trac_13531-short_vectors-v2.patch](tarball://root/attachments/some-uuid/ticket13531/trac_13531-short_vectors-v2.patch) by mraum created at 2013-01-30 20:50:42\n\nThe test for the too long vectors is marked long time, because on my system it takes about 140 seconds. Currently, this is the best example I have.\n\nI have looked for the bug report, and I can't find it. I might have forgotten to send it, so I have just sent it. I post the bug number as soon as possible.",
    "created_at": "2013-01-30T20:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163482",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Attachment [trac_13531-short_vectors-v2.patch](tarball://root/attachments/some-uuid/ticket13531/trac_13531-short_vectors-v2.patch) by mraum created at 2013-01-30 20:50:42

The test for the too long vectors is marked long time, because on my system it takes about 140 seconds. Currently, this is the best example I have.

I have looked for the bug report, and I can't find it. I might have forgotten to send it, so I have just sent it. I post the bug number as soon as possible.



---

archive/issue_comments_163483.json:
```json
{
    "body": "I got this reply:\n\n\nit seems this bug has disappeared in the development branch in\nrev 2d4455dc:\n\ncommit 2d4455dc481cc0f0b09900e97c4fbb2e87b8db4d\n\nAuthor: Karim Belabas <Karim.Belabas`@`math.u-bordeaux1.fr>\n\nDate:   Sun Jul 17 11:27:48 2011 +0000\n\n    minor cleanup minim0()",
    "created_at": "2013-01-31T05:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163483",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

I got this reply:


it seems this bug has disappeared in the development branch in
rev 2d4455dc:

commit 2d4455dc481cc0f0b09900e97c4fbb2e87b8db4d

Author: Karim Belabas <Karim.Belabas`@`math.u-bordeaux1.fr>

Date:   Sun Jul 17 11:27:48 2011 +0000

    minor cleanup minim0()



---

archive/issue_comments_163484.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-31T09:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163484",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_163485.json:
```json
{
    "body": "Thanks!",
    "created_at": "2013-01-31T09:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163485",
    "user": "https://github.com/vbraun"
}
```

Thanks!



---

archive/issue_events_013221.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-05T08:18:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13327#event-13221"
}
```



---

archive/issue_comments_163486.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-05T08:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13327#issuecomment-163486",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
