# Issue 28754: spkg-configure.m4 for gc

Issue created by migration from https://trac.sagemath.org/ticket/28991

Original creator: mjo

Original creation time: 2020-01-11 22:57:26

CC:  embray dimpase isuruf

Split off of #28045, where the libatomic dependency is handled.


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by @thierry-FreeBSD created at 2020-04-30 12:12:31

spkg-configure.m4 to be copied under build/pkgs/gc


---

Attachment

With the attached spkg-configure.m4, it works for me on FreeBSD, and Sage uses the system package.

Note: ATM the FreeBSD system package is at v.8.0.4 (boehm-gc-threaded-8.0.4_1), and the pkg-config file is named bdw-gc-threaded.pc - this might be different on other systems.


---

Comment by mjo created at 2020-04-30 13:08:03

It's `bdw-gc.pc` on Gentoo at least, so we should check that name too.


---

Comment by dimpase created at 2020-04-30 14:03:08

Replying to [comment:4 mjo]:
> It's `bdw-gc.pc` on Gentoo at least, so we should check that name too.
also on Debian and Fedora it is `bdw-gc`.

- on Debian on needs to install `libgc-dev`
- on Fedora one needs to install `gc gc-devel`


---

Comment by dimpase created at 2020-08-11 20:31:44

New commits:


---

Comment by dimpase created at 2020-08-11 20:31:44

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-08-11 23:42:06

GH Actions run?


---

Comment by mjo created at 2020-08-12 18:11:20

Works on Gentoo now, thanks!


---

Comment by dimpase created at 2020-08-12 18:46:09

tests run on https://github.com/dimpase/sage/pull/16


---

Comment by git created at 2020-08-13 14:00:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-08-15 08:50:59

as can be seen on the GH Action logs from https://github.com/dimpase/sage/actions/runs/207790649 libgc is correctly recongnised - if it can be installed

On macOS Conda, libgc is not found:
https://github.com/dimpase/sage/runs/982690154

```
  - https://repo.anaconda.com/pkgs/main/osx-64
  - https://repo.anaconda.com/pkgs/main/noarch
  - https://repo.anaconda.com/pkgs/r/osx-64
  - https://repo.anaconda.com/pkgs/r/noarch

To search for alternate channels that may provide the conda package you're
looking for, navigate to

    https://anaconda.org

and use the search bar at the top of the page.


ERROR: InvocationError for command /bin/bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/conda.txt`; . /Users/runner/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/bin/activate && /Users/runner/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/bin/conda install --yes --quiet $PACKAGES' (exited with code 1)
___________________________________ summary ____________________________________
ERROR:   local-conda-forge-macos-standard: commands failed
##[error]Process completed with exit code 1.
```


Isuru, do you get an idea what's wrong here?


---

Comment by mkoeppe created at 2020-09-02 01:42:25

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2020-09-02 06:44:38

I will remove conda.txt


---

Comment by git created at 2020-09-02 10:25:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2020-09-02 10:26:34

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-09-02 10:26:34

commented out conda, rebased over 9.2.beta11.


---

Comment by mkoeppe created at 2020-09-02 16:02:20

GH run please


---

Comment by git created at 2020-09-02 23:09:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-09-02 23:10:18

Replying to [comment:17 mkoeppe]:
> GH run please

see https://github.com/sagemath/sage/pull/98


---

Comment by dimpase created at 2020-09-07 08:28:29

ping?


---

Comment by mjo created at 2020-09-07 11:41:55

LGTM, but can you just delete those conda.txt files rather than comment out their contents? If I'm looking for packages that need Gentoo information, I'm going to be checking for the existence of `distros/gentoo.txt` and assume that it's correct if present.


---

Comment by mjo created at 2020-09-07 11:41:55

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-09-07 14:25:10

Thanks! 

As to deleting, we already have quite a few of distros/foo.txt with commented out content, e.g. `build/pkgs/arb/distros/homebrew.txt`, so, no, the content of these files matters matters :-)


---

Comment by vbraun created at 2020-09-15 22:00:49

Resolution: fixed


---

Comment by mkoeppe created at 2020-09-22 14:08:23

Looks like this may have caused the breakage reported in #30629 (wsl-ubuntu-focal: ECL build fails).


---

Comment by dimpase created at 2020-09-22 14:15:46

Replying to [comment:24 mkoeppe]:
> Looks like this may have caused the breakage reported in #30629 (wsl-ubuntu-focal: ECL build fails).

it appears that all the  released versions of gc suffer from the problem at hand, no?


---

Comment by mkoeppe created at 2020-09-22 14:19:48

If I understand the issue correctly, it's a particular libgc configuration used on Ubuntu 20.04 that is the problem.
