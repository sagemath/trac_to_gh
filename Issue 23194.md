# Issue 23194: enhancements to free pre-Lie algebras

Issue created by migration from https://trac.sagemath.org/ticket/23431

Original creator: chapoton

Original creation time: 2017-07-14 07:59:15

CC:  tscrim darij hivert

to keep them inline with #23406

* changes the behaviour of single-variable case

* adds the category "LieAlgebras"

* enhance coercion


---

Comment by chapoton created at 2017-07-14 07:59:47

New commits:


---

Comment by chapoton created at 2017-07-14 07:59:47

Changing status from new to needs_review.


---

Comment by darij created at 2017-07-16 11:36:28

Why have you removed this doctest?

```
-            sage: F = algebras.FreePreLie(QQ, ZZ)
-            sage: elts = F.some_elements()[:-1] # Skip the last element
-            sage: TestSuite(F).run(some_elements=elts) # long time
```

Having an infinite generating set looks like a reasonable use case to me. If the test suite fails for stupid reasons, then I'm still in favor of manually testing some computations with elements.

Other than this, LGTM with my little review commits.
----
New commits:


---

Comment by darij created at 2017-07-16 11:36:28

Changing keywords from "" to "pre-lie algebras, trees, operads".


---

Comment by chapoton created at 2017-07-16 11:37:24

I removed it because it seems to me that the TestSuite takes much too long.


---

Comment by git created at 2017-07-16 11:41:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2017-07-16 11:42:07

OK, then I'm adding a manual version. If you like my changes, this is positively reviewed.


---

Comment by chapoton created at 2017-07-16 12:08:16

Looks good, except I have a doubt about

```
+    .. [ChLi]_
+
+    .. [Liv2006]_
```

that I would rather write

```
+    - [ChLi]_
+
+    - [Liv2006]_
```

But one needs to check that the doc builds in either way..


---

Comment by darij created at 2017-07-16 12:21:14

I'm afraid I cannot test doc in reasonable time from here :/


---

Comment by chapoton created at 2017-07-16 12:22:51

I have launched my bots on it, and will also build the doc on my own machines (takes many hours..)


---

Comment by git created at 2017-07-16 14:17:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-07-16 14:19:22

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-07-16 14:19:22

Ok, ref corrected. For info, if you use something like `.. [Name2018]_` then nothing appears in the REFERENCE block. Better use `- [Name2018]_`.

Setting to positive, thanks for the review.


---

Comment by tscrim created at 2017-07-16 14:30:09

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2017-07-16 14:30:09

I think you should make the variable names truly optional by setting a default value `names=None` in `__classcall_private__`. Subsequently, it does not make sense to have a non-`None` `self._alphabet`. I feel it mixes the two cases.

What about changing to use `normalize_names` and passing `names` to the `Parent.__init__` (CFM now handles them properly, so there should be no need to work around it)? In particular, doing something like

```
try:
    names = normalize_names(-1, names)
except (TypeError, ValueError):
    names = Alphabet(names)
```



---

Comment by git created at 2017-07-16 18:08:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-16 18:17:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-17 09:03:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-07-20 18:47:11

Could we maybe (for the moment) keep the existing way to handle names here (and do the same in Grossman-Larsson) ? Using normalize_names would change a lot of things..


---

Comment by tscrim created at 2017-07-20 22:35:37

That's okay with me. I just wanted to give that option, in particular as this input differs from polynomial rings:

```
algebras.FreePreLie(QQ, 'x,y,z')
Free PreLie algebra on 4 generators ['x', ',', 'y', 'z'] over Rational Field
```



---

Comment by tscrim created at 2017-07-21 23:36:24

Since you have addressed all of the issues I brought up and a green bot, I am treating this as in the needs_review state and setting a positive review. Thanks.


---

Comment by tscrim created at 2017-07-21 23:36:24

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-07-26 22:11:57

Resolution: fixed
