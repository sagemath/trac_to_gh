# Issue 21659: Error installing autotools spkg on Cygwin

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2016-11-18 09:56:19

CC:  mkoeppe dimpase

When installing the autotools spkg on Cygwin it runs for a while, then fails at:


```
[autotools-20141105] [ "$SAGE_KEEP_BUILT_SPKGS" = yes ] || rm -rf autoconf-2.69/*
[autotools-20141105] export MAKE='make -j1' ; \
[autotools-20141105] export AUTOCONF_VERSION=2.59 ; \
[autotools-20141105] cd automake-1.9 && \
[autotools-20141105]     ./configure --prefix="/home/embray/src/sagemath/sage/local/automake-1.9" && \
[autotools-20141105]     $MAKE && $MAKE install
[autotools-20141105] checking build system type... lib/config.guess: unable to guess system type
[autotools-20141105]
[autotools-20141105] This script, last modified 2004-06-24, has failed to recognize
[autotools-20141105] the operating system you are using. It is advised that you
[autotools-20141105] download the most up to date version of the config scripts from
[autotools-20141105]
[autotools-20141105]     ftp://ftp.gnu.org/pub/gnu/config/
[autotools-20141105]
[autotools-20141105] If the version you run (lib/config.guess) is already up to date, please
[autotools-20141105] send the following data and any information you think might be
[autotools-20141105] pertinent to <config-patches`@`gnu.org> in order to provide the needed
[autotools-20141105] information to handle your system.
[autotools-20141105]
[autotools-20141105] config.guess timestamp = 2004-06-24
[autotools-20141105]
[autotools-20141105] uname -m = x86_64
[autotools-20141105] uname -r = 2.5.1(0.297/5/3)
[autotools-20141105] uname -s = CYGWIN_NT-10.0
[autotools-20141105] uname -v = 2016-04-21 22:14
[autotools-20141105]
[autotools-20141105] /usr/bin/uname -p = unknown
[autotools-20141105] /bin/uname -X     =
[autotools-20141105]
[autotools-20141105] hostinfo               =
[autotools-20141105] /bin/universe          =
[autotools-20141105] /usr/bin/arch -k       =
[autotools-20141105] /bin/arch              = x86_64
[autotools-20141105] /usr/bin/oslevel       =
[autotools-20141105] /usr/convex/getsysinfo =
[autotools-20141105]
[autotools-20141105] UNAME_MACHINE = x86_64
[autotools-20141105] UNAME_RELEASE = 2.5.1(0.297/5/3)
[autotools-20141105] UNAME_SYSTEM  = CYGWIN_NT-10.0
[autotools-20141105] UNAME_VERSION = 2016-04-21 22:14
[autotools-20141105] configure: error: cannot guess build type; you must specify one
[autotools-20141105] make[2]: *** [Makefile:235: /home/embray/src/sagemath/sage/local/automake-1.9] Error 1
[autotools-20141105] make[2]: Leaving directory '/home/embray/src/sagemath/sage/local/var/tmp/sage/build/autotools-20141105/build'
```


upon trying to install automake 1.9.

This also left the autoreconf script installed by sage broken:


```
autoreconf: Entering directory `.'
autoreconf: configure.ac: not using Gettext
autoreconf: running: aclocal -I m4 --output=aclocal.m4t
/home/embray/src/sagemath/sage/local/bin/aclocal: line 25: /home/embray/src/sagemath/sage/local/automake-1.15/bin/aclocal: No such file or directory
autoreconf: aclocal failed with exit status: 127
```


It would be nice if sage packages didn't actually install anything into `$SAGE_LOCAL` until it has successfully built.


---

Comment by embray created at 2016-11-18 10:05:02

Manually going into the automake-1.9 source directory and copying the `config.guess` from my system's `/usr/share/automake-1.15` allowed it to build.

Actually, ended up just


```
find . -name 'config.guess' -exec cp /usr/share/automake-1.15/config.guess {} \;
```


I wonder if some variant of this wouldn't be good to include in the build scripts for the spkg (without hard-coding `automake-1.15` of course).  In other words, just take the latest `config.guess` from the system, if it exists.


---

Comment by embray created at 2016-11-18 10:13:43

After a closer look at the different `config.guess` scripts, the old ones would have worked on 32-bit Cygwin, but not on 64-bit Cygwin (they lack wildcard patterns that would match "x86_64" as the machine name).


---

Comment by jpflori created at 2016-11-18 10:22:18

Sage provides more or less up to date config.* scripts.
You can try to modify the spkg-install script to copy them at build time to let the build proceed...
But maybe installing autotools on a cygwin setup is not the best idea :/


---

Comment by embray created at 2016-11-18 10:28:23

Replying to [comment:3 jpflori]:
> Sage provides more or less up to date config.* scripts.

Provides how?  

> But maybe installing autotools on a cygwin setup is not the best idea :/

What would make you say that?


---

Comment by jpflori created at 2016-11-18 10:33:49

Replying to [comment:4 embray]:
> Replying to [comment:3 jpflori]:
> > Sage provides more or less up to date config.* scripts.
> 
> Provides how?  
In $SAGE_ROOT/config/
> 
> > But maybe installing autotools on a cygwin setup is not the best idea :/
> 
> What would make you say that?
You could autoreconf on a Linux machine, ok that implies maintaining two systems and communicating btw them...


---

Comment by embray created at 2016-11-18 12:16:00

For now I hand-edited the Makefile.build to copy my working config.guess to the proper place when building all the automakes, so I've kicked off that build.

In the meantime I've edited `spkg-write-makefile` (will post a patch soon) to add such a step to the makefile (the details are subject to debate; I haven't thought it through fully).  Once I've bootstrapped my $SAGE_LOCAL with a working autotools build I can re-run `spkg-write-makefile` to provide an updated `Makefile.build` as well.


---

Comment by mkoeppe created at 2020-08-13 14:36:16

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-08-13 14:36:16

Outdated - we removed the spkg


---

Comment by dimpase created at 2020-08-15 07:42:23

Changing status from needs_review to positive_review.


---

Comment by embray created at 2020-08-31 15:28:12

Resolution: wontfix
