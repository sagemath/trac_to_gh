# Issue 13150: Precision loss when converting between Magma and Sage

archive/issues_013150.json:
```json
{
    "body": "Assignee: was\n\nCC:  was nbruin ncalexan mariah\n\nKeywords: magma numerical real precision truncation\n\nThere is a significant amount of precision loss when converting Magma real numbers to Sage or Sage real numbers to Magma.\n\n```\nsage: s = RealField(1000)(1/3)\nsage: m = magma(RealField(1000))(1/3)\nsage: s\n0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333\nsage: m\n0.3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333\nsage: magma(s)\n0.3333333333333333333333333333334648101508701686342352880942137977049455344058515038341283798217773437500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\nsage: m.sage()\n0.333333333333333314829616256247390992939472198486328125000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n```\n\nFrom Sage to Magma, this is because the interface goes via 30 digit precision Magma `FldReElt`:\n\n```\nsage: s = RealField(300)(1/3)\nsage: s\n0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333\nsage: magma(s)\n0.333333333333333333333333333333464810150870168634235288094213797704945534405851503834128380\nsage: s._magma_init_(magma)\n'RealField(300 : Bits := true)!0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333'\nsage: magma('0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333')\n0.333333333333333333333333333333\nsage: magma('0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333').Type()\nFldReElt\nsage: magma('0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333').Precision()\n30\n```\n\nFrom Magma to Sage, this is because the interface goes via Python floats:\n\n```\nsage: m = magma(RealField(200))(1/3); m\n0.333333333333333333333333333333333333333333333333333333333333\nsage: m.sage()\n0.33333333333333331482961625624739099293947219848632812500000\nsage: str(m.Sage())\n'RealField(200)(0.333333333333333333333333333333333333333333333333333333333333)'\n0.33333333333333331482961625624739099293947219848632812500000\nsage: sage_eval(str(m.Sage()))\n0.33333333333333333333333333333333333333333333333333333333333\nsage: sage_eval(str(m.Sage()), preparse=False)\n0.33333333333333331482961625624739099293947219848632812500000\nsage: type(sage_eval('0.3333333333333333333333333333333333333333333', preparse=False))\n<type 'float'>\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13322\n\n",
    "created_at": "2012-08-01T13:15:08Z",
    "labels": [
        "interfaces",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Precision loss when converting between Magma and Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13150",
    "user": "mstreng"
}
```
Assignee: was

CC:  was nbruin ncalexan mariah

Keywords: magma numerical real precision truncation

There is a significant amount of precision loss when converting Magma real numbers to Sage or Sage real numbers to Magma.

```
sage: s = RealField(1000)(1/3)
sage: m = magma(RealField(1000))(1/3)
sage: s
0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333
sage: m
0.3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333
sage: magma(s)
0.3333333333333333333333333333334648101508701686342352880942137977049455344058515038341283798217773437500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
sage: m.sage()
0.333333333333333314829616256247390992939472198486328125000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```

From Sage to Magma, this is because the interface goes via 30 digit precision Magma `FldReElt`:

```
sage: s = RealField(300)(1/3)
sage: s
0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333
sage: magma(s)
0.333333333333333333333333333333464810150870168634235288094213797704945534405851503834128380
sage: s._magma_init_(magma)
'RealField(300 : Bits := true)!0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333'
sage: magma('0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333')
0.333333333333333333333333333333
sage: magma('0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333').Type()
FldReElt
sage: magma('0.333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333').Precision()
30
```

From Magma to Sage, this is because the interface goes via Python floats:

```
sage: m = magma(RealField(200))(1/3); m
0.333333333333333333333333333333333333333333333333333333333333
sage: m.sage()
0.33333333333333331482961625624739099293947219848632812500000
sage: str(m.Sage())
'RealField(200)(0.333333333333333333333333333333333333333333333333333333333333)'
0.33333333333333331482961625624739099293947219848632812500000
sage: sage_eval(str(m.Sage()))
0.33333333333333333333333333333333333333333333333333333333333
sage: sage_eval(str(m.Sage()), preparse=False)
0.33333333333333331482961625624739099293947219848632812500000
sage: type(sage_eval('0.3333333333333333333333333333333333333333333', preparse=False))
<type 'float'>
```


Issue created by migration from https://trac.sagemath.org/ticket/13322





---

archive/issue_comments_160207.json:
```json
{
    "body": "Attachment [13322.patch](tarball://root/attachments/some-uuid/ticket13322/13322.patch) by mstreng created at 2012-08-01 19:57:17",
    "created_at": "2012-08-01T19:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160207",
    "user": "mstreng"
}
```

Attachment [13322.patch](tarball://root/attachments/some-uuid/ticket13322/13322.patch) by mstreng created at 2012-08-01 19:57:17



---

archive/issue_comments_160208.json:
```json
{
    "body": "Attachment [13322-extcode.patch](tarball://root/attachments/some-uuid/ticket13322/13322-extcode.patch) by mstreng created at 2012-08-01 20:01:02\n\nI still need to run some tests before this is ready to be reviewed.",
    "created_at": "2012-08-01T20:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160208",
    "user": "mstreng"
}
```

Attachment [13322-extcode.patch](tarball://root/attachments/some-uuid/ticket13322/13322-extcode.patch) by mstreng created at 2012-08-01 20:01:02

I still need to run some tests before this is ready to be reviewed.



---

archive/issue_comments_160209.json:
```json
{
    "body": "for patchbot: apply 13322.patch (as the other patch is for extcode)",
    "created_at": "2012-08-02T08:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160209",
    "user": "mstreng"
}
```

for patchbot: apply 13322.patch (as the other patch is for extcode)



---

archive/issue_comments_160210.json:
```json
{
    "body": "All tests pass on Sage 5.2 and Magma V2.18-8, so please review!\n\n(More precisely, all non-optional tests pass, and all `-only-optional=magma` tests pass except for three unrelated tests that already fail on an unpatched 5.2\n\n```\n sage -t -only-optional=magma \"devel/sage/sage/coding/linear_code.py\"\n sage -t -only-optional=magma \"devel/sage/build/sage/coding/linear_code.py\"\n sage -t -only-optional=magma \"devel/sage/build/lib.linux-x86_64-2.7/sage/coding/linear_code.py\"\n```\n\n)",
    "created_at": "2012-08-02T11:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160210",
    "user": "mstreng"
}
```

All tests pass on Sage 5.2 and Magma V2.18-8, so please review!

(More precisely, all non-optional tests pass, and all `-only-optional=magma` tests pass except for three unrelated tests that already fail on an unpatched 5.2

```
 sage -t -only-optional=magma "devel/sage/sage/coding/linear_code.py"
 sage -t -only-optional=magma "devel/sage/build/sage/coding/linear_code.py"
 sage -t -only-optional=magma "devel/sage/build/lib.linux-x86_64-2.7/sage/coding/linear_code.py"
```

)



---

archive/issue_comments_160211.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-08-02T11:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160211",
    "user": "mstreng"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_160212.json:
```json
{
    "body": "replaces 13322.patch, yields a few more correct digits by removing one more type of truncation",
    "created_at": "2012-08-03T07:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160212",
    "user": "mstreng"
}
```

replaces 13322.patch, yields a few more correct digits by removing one more type of truncation



---

archive/issue_comments_160213.json:
```json
{
    "body": "Attachment [13322.2.patch](tarball://root/attachments/some-uuid/ticket13322/13322.2.patch) by mstreng created at 2012-08-03 07:41:41\n\nfor patchbot: apply 13322.2.patch (and another patch to extcode)",
    "created_at": "2012-08-03T07:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160213",
    "user": "mstreng"
}
```

Attachment [13322.2.patch](tarball://root/attachments/some-uuid/ticket13322/13322.2.patch) by mstreng created at 2012-08-03 07:41:41

for patchbot: apply 13322.2.patch (and another patch to extcode)



---

archive/issue_comments_160214.json:
```json
{
    "body": "This is ready for review. It should be easy and quick to review for people who know how the Magma interface works, so I'm randomly adding a few such people as cc (no pressure).",
    "created_at": "2012-08-03T11:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160214",
    "user": "mstreng"
}
```

This is ready for review. It should be easy and quick to review for people who know how the Magma interface works, so I'm randomly adding a few such people as cc (no pressure).



---

archive/issue_comments_160215.json:
```json
{
    "body": "I don't have Magma to test but patch looks good to me.",
    "created_at": "2012-09-03T10:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160215",
    "user": "vbraun"
}
```

I don't have Magma to test but patch looks good to me.



---

archive/issue_comments_160216.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-03T10:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160216",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_160217.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-18T11:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13150#issuecomment-160217",
    "user": "jdemeyer"
}
```

Resolution: fixed
