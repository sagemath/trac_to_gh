# Issue 16952: Upon the first pass of the documentation compilation, undefined label warnings should not trigger an exception

archive/issues_016952.json:
```json
{
    "body": "CC:  @hivert @jhpalmieri sage-combinat @vbraun\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17189\n\n",
    "created_at": "2014-10-21T15:48:16Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Upon the first pass of the documentation compilation, undefined label warnings should not trigger an exception",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16952",
    "user": "https://github.com/nthiery"
}
```
CC:  @hivert @jhpalmieri sage-combinat @vbraun



Issue created by migration from https://trac.sagemath.org/ticket/17189





---

archive/issue_comments_224389.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to documentation.",
    "created_at": "2014-10-21T16:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224389",
    "user": "https://github.com/nthiery"
}
```

Changing component from PLEASE CHANGE to documentation.



---

archive/issue_comments_224390.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-21T16:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224390",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224391.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-10-21T16:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224391",
    "user": "https://github.com/nthiery"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_224392.json:
```json
{
    "body": "This is needed for #16256.",
    "created_at": "2014-10-21T16:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224392",
    "user": "https://github.com/nthiery"
}
```

This is needed for #16256.



---

archive/issue_comments_224393.json:
```json
{
    "body": "When read aloud in French, this is a revolutionary ticket number :-)\n----\nNew commits:",
    "created_at": "2014-10-21T16:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224393",
    "user": "https://github.com/nthiery"
}
```

When read aloud in French, this is a revolutionary ticket number :-)
----
New commits:



---

archive/issue_comments_224394.json:
```json
{
    "body": "The problem with ignoring warnings is that you're ignoring warnings, so badly formatted documentation builds without an error. I tested by misformatting some documentation and running `make`. In the docbuilding log, I saw a line like\n\n```\nWARNING: Block quote ends without a blank line; unexpected unindent.\n```\n\non the first pass, not the second, and as a result, the documentation claimed to build successfully. How about something like this instead:\n\n```diff\ndiff --git a/src/doc/common/custom-sphinx-build.py b/src/doc/common/custom-sphinx-build.py\nindex 712694e..f1b48fa 100644\n--- a/src/doc/common/custom-sphinx-build.py\n+++ b/src/doc/common/custom-sphinx-build.py\n@@ -58,9 +58,12 @@ warnings = (re.compile('Segmentation fault'),\n # Unless this is the first pass of the compilation (where some cross\n # links may not be resolvable yet), or we are compiling the latex\n # documentation, we want all warnings to raise an exception.\n-if 'multidoc_first_pass=1' not in sys.argv and 'latex' not in sys.argv:\n-    warnings += (re.compile('WARNING'),)\n-\n+if 'latex' not in sys.argv:\n+    if 'multidoc_first_pass=1' in sys.argv:\n+        # Catch all warnings except 'WARNING: undefined label'\n+        warnings += (re.compile('WARNING: (?!undefined label)'),)\n+    else:\n+        warnings += (re.compile('WARNING:'),)\n \n # Do not error out at the first warning, sometimes there is more\n # information. So we run until the end of the file and only then raise\n```\n\nThe `(?!STRING)` syntax matches anything except for `STRING`: see https://docs.python.org/2/library/re.html.",
    "created_at": "2014-10-21T19:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224394",
    "user": "https://github.com/jhpalmieri"
}
```

The problem with ignoring warnings is that you're ignoring warnings, so badly formatted documentation builds without an error. I tested by misformatting some documentation and running `make`. In the docbuilding log, I saw a line like

```
WARNING: Block quote ends without a blank line; unexpected unindent.
```

on the first pass, not the second, and as a result, the documentation claimed to build successfully. How about something like this instead:

```diff
diff --git a/src/doc/common/custom-sphinx-build.py b/src/doc/common/custom-sphinx-build.py
index 712694e..f1b48fa 100644
--- a/src/doc/common/custom-sphinx-build.py
+++ b/src/doc/common/custom-sphinx-build.py
@@ -58,9 +58,12 @@ warnings = (re.compile('Segmentation fault'),
 # Unless this is the first pass of the compilation (where some cross
 # links may not be resolvable yet), or we are compiling the latex
 # documentation, we want all warnings to raise an exception.
-if 'multidoc_first_pass=1' not in sys.argv and 'latex' not in sys.argv:
-    warnings += (re.compile('WARNING'),)
-
+if 'latex' not in sys.argv:
+    if 'multidoc_first_pass=1' in sys.argv:
+        # Catch all warnings except 'WARNING: undefined label'
+        warnings += (re.compile('WARNING: (?!undefined label)'),)
+    else:
+        warnings += (re.compile('WARNING:'),)
 
 # Do not error out at the first warning, sometimes there is more
 # information. So we run until the end of the file and only then raise
```

The `(?!STRING)` syntax matches anything except for `STRING`: see https://docs.python.org/2/library/re.html.



---

archive/issue_comments_224395.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-21T19:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224395",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_224396.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-21T21:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224397.json:
```json
{
    "body": "Ah, good catch, I thought those warnings would be reissued upon the second pass. In that case, sure, this looks good.\n----\nNew commits:",
    "created_at": "2014-10-21T21:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224397",
    "user": "https://github.com/nthiery"
}
```

Ah, good catch, I thought those warnings would be reissued upon the second pass. In that case, sure, this looks good.
----
New commits:



---

archive/issue_comments_224398.json:
```json
{
    "body": "I think this looks good now. Any objections from anyone else?",
    "created_at": "2014-10-22T04:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224398",
    "user": "https://github.com/jhpalmieri"
}
```

I think this looks good now. Any objections from anyone else?



---

archive/issue_comments_224399.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-23T03:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224399",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_049813.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-24T10:14:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16952#event-49813"
}
```



---

archive/issue_comments_224400.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-24T10:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224400",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_224401.json:
```json
{
    "body": "Forgot your own middle initial, sir.",
    "created_at": "2014-11-14T18:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16952#issuecomment-224401",
    "user": "https://github.com/kcrisman"
}
```

Forgot your own middle initial, sir.
