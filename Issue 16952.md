# Issue 16952: Upon the first pass of the documentation compilation, undefined label warnings should not trigger an exception

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2014-10-21 15:48:16

CC:  hivert jhpalmieri sage-combinat vbraun




---

Comment by nthiery created at 2014-10-21 16:20:30

Changing component from PLEASE CHANGE to documentation.


---

Comment by nthiery created at 2014-10-21 16:20:30

Changing status from new to needs_review.


---

Comment by nthiery created at 2014-10-21 16:20:30

Changing type from PLEASE CHANGE to defect.


---

Comment by nthiery created at 2014-10-21 16:21:12

This is needed for #16256.


---

Comment by nthiery created at 2014-10-21 16:23:03

When read aloud in French, this is a revolutionary ticket number :-)
----
New commits:


---

Comment by jhpalmieri created at 2014-10-21 19:18:57

The problem with ignoring warnings is that you're ignoring warnings, so badly formatted documentation builds without an error. I tested by misformatting some documentation and running `make`. In the docbuilding log, I saw a line like

```
WARNING: Block quote ends without a blank line; unexpected unindent.
```

on the first pass, not the second, and as a result, the documentation claimed to build successfully. How about something like this instead:

```diff
diff --git a/src/doc/common/custom-sphinx-build.py b/src/doc/common/custom-sphinx-build.py
index 712694e..f1b48fa 100644
--- a/src/doc/common/custom-sphinx-build.py
+++ b/src/doc/common/custom-sphinx-build.py
`@``@` -58,9 +58,12 `@``@` warnings = (re.compile('Segmentation fault'),
 # Unless this is the first pass of the compilation (where some cross
 # links may not be resolvable yet), or we are compiling the latex
 # documentation, we want all warnings to raise an exception.
-if 'multidoc_first_pass=1' not in sys.argv and 'latex' not in sys.argv:
-    warnings += (re.compile('WARNING'),)
-
+if 'latex' not in sys.argv:
+    if 'multidoc_first_pass=1' in sys.argv:
+        # Catch all warnings except 'WARNING: undefined label'
+        warnings += (re.compile('WARNING: (?!undefined label)'),)
+    else:
+        warnings += (re.compile('WARNING:'),)
 
 # Do not error out at the first warning, sometimes there is more
 # information. So we run until the end of the file and only then raise
```

The `(?!STRING)` syntax matches anything except for `STRING`: see https://docs.python.org/2/library/re.html.


---

Comment by jhpalmieri created at 2014-10-21 19:18:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-10-21 21:28:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2014-10-21 21:28:31

Ah, good catch, I thought those warnings would be reissued upon the second pass. In that case, sure, this looks good.
----
New commits:


---

Comment by jhpalmieri created at 2014-10-22 04:49:31

I think this looks good now. Any objections from anyone else?


---

Comment by jhpalmieri created at 2014-10-23 03:19:11

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2014-10-24 10:14:39

Resolution: fixed


---

Comment by kcrisman created at 2014-11-14 18:13:52

Forgot your own middle initial, sir.
