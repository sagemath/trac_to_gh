# Issue 17300: The geodetic closure of a graph

archive/issues_017300.json:
```json
{
    "body": "CC:  ncohen\n\nHello!\n\nThe plan is to ship the algorithm for the minimal geodetic set of a graph but first let me try to sell this simple method for computing the geodetic closure of a (di) graph.\n\nLet me know if there are any bugs/suggestions for this contribution.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17537\n\n",
    "created_at": "2014-12-21T17:11:58Z",
    "labels": [
        "graph theory",
        "minor",
        "enhancement"
    ],
    "title": "The geodetic closure of a graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17300",
    "user": "azi"
}
```
CC:  ncohen

Hello!

The plan is to ship the algorithm for the minimal geodetic set of a graph but first let me try to sell this simple method for computing the geodetic closure of a (di) graph.

Let me know if there are any bugs/suggestions for this contribution.



Issue created by migration from https://trac.sagemath.org/ticket/17537





---

archive/issue_comments_230352.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-21T17:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230352",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_230353.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-21T17:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230353",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_230354.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-12-21T17:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230354",
    "user": "azi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230355.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-12-21T17:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230355",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_230356.json:
```json
{
    "body": "Hmmm... Calling \"distances_all_pairs\" in a function like that is a suicide. You cannot re-compute all distances every time you want to compute a closure. Actually, the information that you need is precisely the one that is stored in `convexity_properties`.\n\nThe \"convexity properties\" object associates to every pair of vertices `u,v` the bitset of all z such that z is on a shortest uv path. Thus if you need to find the closure of a set of points, all you have to do is compute the union (with 'or' processor operations) of the bitsets associated to all pairs of vertices.\n\nMy point is that the code is already there, but of course the name 'convexity properties' is very ill-chosen in this case. We will probably have to change the terminology... What do you think about all this ?\n\nBy the way, is the terminology 'closure' used anywhere ? Because formally it is not a closure function. One of the property of closure functions is that `f(f(X))` should be equal to `f(x)`.\n\nNathann",
    "created_at": "2014-12-21T17:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230356",
    "user": "ncohen"
}
```

Hmmm... Calling "distances_all_pairs" in a function like that is a suicide. You cannot re-compute all distances every time you want to compute a closure. Actually, the information that you need is precisely the one that is stored in `convexity_properties`.

The "convexity properties" object associates to every pair of vertices `u,v` the bitset of all z such that z is on a shortest uv path. Thus if you need to find the closure of a set of points, all you have to do is compute the union (with 'or' processor operations) of the bitsets associated to all pairs of vertices.

My point is that the code is already there, but of course the name 'convexity properties' is very ill-chosen in this case. We will probably have to change the terminology... What do you think about all this ?

By the way, is the terminology 'closure' used anywhere ? Because formally it is not a closure function. One of the property of closure functions is that `f(f(X))` should be equal to `f(x)`.

Nathann



---

archive/issue_comments_230357.json:
```json
{
    "body": "Replying to [comment:5 ncohen]:\n> Hmmm... Calling \"distances_all_pairs\" in a function like that is a suicide. You cannot re-compute all distances every time you want to compute a closure. Actually, the information that you need is precisely the one that is stored in `convexity_properties`.\nThat's true, though we can make for an optional argument DP that lets you pass the distance dictionary in case *anyone* really needs to compute this often.\n\n\n> \n> The \"convexity properties\" object associates to every pair of vertices `u,v` the bitset of all z such that z is on a shortest uv path. Thus if you need to find the closure of a set of points, all you have to do is compute the union (with 'or' processor operations) of the bitsets associated to all pairs of vertices.\nI see. \n\n> \n> My point is that the code is already there, but of course the name 'convexity properties' is very ill-chosen in this case. We will probably have to change the terminology... What do you think about all this ?\nFine to me. As far as my preferences go I'd like convexity properties to be part of the graph/generic graph family and cache this stuff in some other way. Having a module like that for just a few functions seems a bit unnatural to me?\n\n> \n> By the way, is the terminology 'closure' used anywhere ? Because formally it is not a closure function. One of the property of closure functions is that `f(f(X))` should be equal to `f(x)`.\nYes it appears that this is the standard way to call it. See for example the paper \"On pitfalls in computing the geodetic number of a graph\" by Hansen and van Omme.\n\n> \n> Nathann",
    "created_at": "2014-12-21T17:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230357",
    "user": "azi"
}
```

Replying to [comment:5 ncohen]:
> Hmmm... Calling "distances_all_pairs" in a function like that is a suicide. You cannot re-compute all distances every time you want to compute a closure. Actually, the information that you need is precisely the one that is stored in `convexity_properties`.
That's true, though we can make for an optional argument DP that lets you pass the distance dictionary in case *anyone* really needs to compute this often.


> 
> The "convexity properties" object associates to every pair of vertices `u,v` the bitset of all z such that z is on a shortest uv path. Thus if you need to find the closure of a set of points, all you have to do is compute the union (with 'or' processor operations) of the bitsets associated to all pairs of vertices.
I see. 

> 
> My point is that the code is already there, but of course the name 'convexity properties' is very ill-chosen in this case. We will probably have to change the terminology... What do you think about all this ?
Fine to me. As far as my preferences go I'd like convexity properties to be part of the graph/generic graph family and cache this stuff in some other way. Having a module like that for just a few functions seems a bit unnatural to me?

> 
> By the way, is the terminology 'closure' used anywhere ? Because formally it is not a closure function. One of the property of closure functions is that `f(f(X))` should be equal to `f(x)`.
Yes it appears that this is the standard way to call it. See for example the paper "On pitfalls in computing the geodetic number of a graph" by Hansen and van Omme.

> 
> Nathann



---

archive/issue_comments_230358.json:
```json
{
    "body": "Yo !\n\n> Fine to me. As far as my preferences go I'd like convexity properties to be part of the graph/generic graph family and cache this stuff in some other way. Having a module like that for just a few functions seems a bit unnatural to me?\n\nYes, it is a bad implementation. I can say it, it's mine. It is ugly. I needed someplace to store this bitset, and I did not know where.\n\n> Yes it appears that this is the standard way to call it. See for example the paper \"On pitfalls in computing the geodetic number of a graph\" by Hansen and van Omme.\n\nWeird `O_o`\n\nNathann",
    "created_at": "2014-12-21T17:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230358",
    "user": "ncohen"
}
```

Yo !

> Fine to me. As far as my preferences go I'd like convexity properties to be part of the graph/generic graph family and cache this stuff in some other way. Having a module like that for just a few functions seems a bit unnatural to me?

Yes, it is a bad implementation. I can say it, it's mine. It is ugly. I needed someplace to store this bitset, and I did not know where.

> Yes it appears that this is the standard way to call it. See for example the paper "On pitfalls in computing the geodetic number of a graph" by Hansen and van Omme.

Weird `O_o`

Nathann



---

archive/issue_comments_230359.json:
```json
{
    "body": "Replying to [comment:7 ncohen]:\n> Yo !\nHiiii\n> \n> > Fine to me. As far as my preferences go I'd like convexity properties to be part of the graph/generic graph family and cache this stuff in some other way. Having a module like that for just a few functions seems a bit unnatural to me?\n> \n> Yes, it is a bad implementation. I can say it, it's mine. It is ugly. I needed someplace to store this bitset, and I did not know where.\nSo what do you suggest that we do?\n\n\n> \n> > Yes it appears that this is the standard way to call it. See for example the paper \"On pitfalls in computing the geodetic number of a graph\" by Hansen and van Omme.\n> \n> Weird `O_o`\n:-)\n\n\n> \n> Nathann",
    "created_at": "2014-12-21T17:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230359",
    "user": "azi"
}
```

Replying to [comment:7 ncohen]:
> Yo !
Hiiii
> 
> > Fine to me. As far as my preferences go I'd like convexity properties to be part of the graph/generic graph family and cache this stuff in some other way. Having a module like that for just a few functions seems a bit unnatural to me?
> 
> Yes, it is a bad implementation. I can say it, it's mine. It is ugly. I needed someplace to store this bitset, and I did not know where.
So what do you suggest that we do?


> 
> > Yes it appears that this is the standard way to call it. See for example the paper "On pitfalls in computing the geodetic number of a graph" by Hansen and van Omme.
> 
> Weird `O_o`
:-)


> 
> Nathann



---

archive/issue_comments_230360.json:
```json
{
    "body": "> So what do you suggest that we do?\n\nWe rename `convexity_properties` to `geodetic_properties` and you add your `geodetic_closure` function there ? `:-P`\n\nIt is a bad design, but I still don't know how to implement it otherwise `^^;`\n\nNathann",
    "created_at": "2014-12-21T17:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230360",
    "user": "ncohen"
}
```

> So what do you suggest that we do?

We rename `convexity_properties` to `geodetic_properties` and you add your `geodetic_closure` function there ? `:-P`

It is a bad design, but I still don't know how to implement it otherwise `^^;`

Nathann



---

archive/issue_comments_230361.json:
```json
{
    "body": "http://en.wikipedia.org/wiki/Closure_%28mathematics%29\n\nThey also agree that a closure operator should be idempotent. Cursed wrong terminology. If we have a `geodetic_closure` function we must remember to add a big warning saying that this operation is NOT a closure, and blame those guys while citing the reference `:-P`\n\nNathann",
    "created_at": "2014-12-21T18:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230361",
    "user": "ncohen"
}
```

http://en.wikipedia.org/wiki/Closure_%28mathematics%29

They also agree that a closure operator should be idempotent. Cursed wrong terminology. If we have a `geodetic_closure` function we must remember to add a big warning saying that this operation is NOT a closure, and blame those guys while citing the reference `:-P`

Nathann



---

archive/issue_comments_230362.json:
```json
{
    "body": "Replying to [comment:9 ncohen]:\n> > So what do you suggest that we do?\n> \n> We rename `convexity_properties` to `geodetic_properties` and you add your `geodetic_closure` function there ? `:-P`\nOkay. Do you also want to do it your way with the bitfields present there or use the thing I pushed here? In the former case I suppose its much better if you just put it in as you already know the code?\n\n\n> \n> It is a bad design, but I still don't know how to implement it otherwise `^^;`\n:-P\n\n> \n> Nathann",
    "created_at": "2014-12-22T09:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230362",
    "user": "azi"
}
```

Replying to [comment:9 ncohen]:
> > So what do you suggest that we do?
> 
> We rename `convexity_properties` to `geodetic_properties` and you add your `geodetic_closure` function there ? `:-P`
Okay. Do you also want to do it your way with the bitfields present there or use the thing I pushed here? In the former case I suppose its much better if you just put it in as you already know the code?


> 
> It is a bad design, but I still don't know how to implement it otherwise `^^;`
:-P

> 
> Nathann



---

archive/issue_comments_230363.json:
```json
{
    "body": "Yo !\n\n> Okay. Do you also want to do it your way with the bitfields present there or use the thing I pushed here? In the former case I suppose its much better if you just put it in as you already know the code?\n\nSorry I can't do that now... Juggling with many computers at once and a slideshow to get ready for tomorrow. Can you do it ? Really it is nothing very complicated, and you should find inside some very similar function that computes the hull of a set of vertices. The geodetic is even simpler.\n\nNathann",
    "created_at": "2014-12-22T10:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230363",
    "user": "ncohen"
}
```

Yo !

> Okay. Do you also want to do it your way with the bitfields present there or use the thing I pushed here? In the former case I suppose its much better if you just put it in as you already know the code?

Sorry I can't do that now... Juggling with many computers at once and a slideshow to get ready for tomorrow. Can you do it ? Really it is nothing very complicated, and you should find inside some very similar function that computes the hull of a set of vertices. The geodetic is even simpler.

Nathann



---

archive/issue_comments_230364.json:
```json
{
    "body": "yoo,\n\nOkay hopefully I manage to do it by today.\n\nGood luck with presentation :-)\n\nJernej",
    "created_at": "2014-12-22T10:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230364",
    "user": "azi"
}
```

yoo,

Okay hopefully I manage to do it by today.

Good luck with presentation :-)

Jernej



---

archive/issue_comments_230365.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-09-05T10:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230365",
    "user": "dcoudert"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_230366.json:
```json
{
    "body": "I pushed a new branch with a more efficient implementation (in Cython). In particular, it does not require to compute and store the full distance matrix, and so can be used on quite large graphs. It is so far for undirected graphs only.\n----\nNew commits:",
    "created_at": "2021-09-05T10:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230366",
    "user": "dcoudert"
}
```

I pushed a new branch with a more efficient implementation (in Cython). In particular, it does not require to compute and store the full distance matrix, and so can be used on quite large graphs. It is so far for undirected graphs only.
----
New commits:



---

archive/issue_comments_230367.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-05T10:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230367",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_230368.json:
```json
{
    "body": "Add not implemented error when calling this method on digraphs.",
    "created_at": "2021-09-05T10:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230368",
    "user": "dcoudert"
}
```

Add not implemented error when calling this method on digraphs.



---

archive/issue_comments_230369.json:
```json
{
    "body": "Geodesic or geodetic?",
    "created_at": "2021-09-18T20:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230369",
    "user": "slelievre"
}
```

Geodesic or geodetic?



---

archive/issue_comments_230370.json:
```json
{
    "body": "The term used in the field is geodetic https://doi.org/10.1016/0895-7177(93)90259-2. Don't know why...",
    "created_at": "2021-09-18T21:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230370",
    "user": "dcoudert"
}
```

The term used in the field is geodetic https://doi.org/10.1016/0895-7177(93)90259-2. Don't know why...



---

archive/issue_comments_230371.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-03T08:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230371",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230372.json:
```json
{
    "body": "LGTM.\n\nIf you care enough, I believe there is a typo in this comment:\n\n```\n# Copy the graph has a short digraph\n```\n",
    "created_at": "2021-10-03T08:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230372",
    "user": "tscrim"
}
```

LGTM.

If you care enough, I believe there is a typo in this comment:

```
# Copy the graph has a short digraph
```




---

archive/issue_comments_230373.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-10-03T08:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230373",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_230374.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-10-03T08:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230374",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_230375.json:
```json
{
    "body": "I fixed the typo. Let me know if I should set the ticket back to needs review.\n\nThank you for the review.",
    "created_at": "2021-10-03T08:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230375",
    "user": "dcoudert"
}
```

I fixed the typo. Let me know if I should set the ticket back to needs review.

Thank you for the review.



---

archive/issue_comments_230376.json:
```json
{
    "body": "Trac does it automatically with the push.",
    "created_at": "2021-10-03T08:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230376",
    "user": "tscrim"
}
```

Trac does it automatically with the push.



---

archive/issue_comments_230377.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-03T08:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230377",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230378.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17300#issuecomment-230378",
    "user": "vbraun"
}
```

Resolution: fixed
