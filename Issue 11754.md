# Issue 11754: "make build" should run Sage once

archive/issues_011754.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  pcpa\n\nKeywords: Makefile build\n\nIn a multi-user environment, the user compiling Sage must run it at least once to generate the `sage-current-location` file, generate `.pyc` files, update package-config files.\n\nThe proposed fix is: in the top-level Makefile, if `local/lib/sage-current-location.txt` does not exist, do a dummy run of Sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11926\n\n",
    "created_at": "2011-10-15T14:16:06Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "\"make build\" should run Sage once",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11754",
    "user": "jdemeyer"
}
```
Assignee: GeorgSWeber

CC:  pcpa

Keywords: Makefile build

In a multi-user environment, the user compiling Sage must run it at least once to generate the `sage-current-location` file, generate `.pyc` files, update package-config files.

The proposed fix is: in the top-level Makefile, if `local/lib/sage-current-location.txt` does not exist, do a dummy run of Sage.

Issue created by migration from https://trac.sagemath.org/ticket/11926





---

archive/issue_comments_133765.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-15T14:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133765",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_133766.json:
```json
{
    "body": "I think I suggested this sort of thing once, and it was criticized.  I don't remember the critiques.  Anyway, I like the idea.  In case some system administrator is building Sage and doesn't want a .sage directory created for them, should we set DOTSAGE to something temporary first?\n\nBy the way, running Sage as part of the build process should also take care of some of the issues at #5155 (not all of them, unfortunately).",
    "created_at": "2011-10-15T17:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133766",
    "user": "jhpalmieri"
}
```

I think I suggested this sort of thing once, and it was criticized.  I don't remember the critiques.  Anyway, I like the idea.  In case some system administrator is building Sage and doesn't want a .sage directory created for them, should we set DOTSAGE to something temporary first?

By the way, running Sage as part of the build process should also take care of some of the issues at #5155 (not all of them, unfortunately).



---

archive/issue_comments_133767.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> I think I suggested this sort of thing once, and it was criticized.  I don't remember the critiques.  Anyway, I like the idea.\n\n> In case some system administrator is building Sage and doesn't want a .sage directory created for them, should we set DOTSAGE to something temporary first?\nGood idea.  Make a temporary DOTSAGE, run Sage, remove the temporary DOTSAGE\n\n> By the way, running Sage as part of the build process should also take care of some of the issues at #5155 (not all of them, unfortunately).\nThanks for the pointer.  Also #11887 is related.",
    "created_at": "2011-10-15T17:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133767",
    "user": "jdemeyer"
}
```

Replying to [comment:3 jhpalmieri]:
> I think I suggested this sort of thing once, and it was criticized.  I don't remember the critiques.  Anyway, I like the idea.

> In case some system administrator is building Sage and doesn't want a .sage directory created for them, should we set DOTSAGE to something temporary first?
Good idea.  Make a temporary DOTSAGE, run Sage, remove the temporary DOTSAGE

> By the way, running Sage as part of the build process should also take care of some of the issues at #5155 (not all of them, unfortunately).
Thanks for the pointer.  Also #11887 is related.



---

archive/issue_comments_133768.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-15T17:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133768",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_133769.json:
```json
{
    "body": "I don't like the idea of running `sage` after `make build` since it certainly doesn't belong to that target, but if at all, it shouldn't be run from `spkg/install` but the `Makefile`, preferably in the *default rule*, not `build`.  Or run `sage-location` from there if `make` did anything, but we should in principle run it from elsewhere.\n\nSomeone who is going to install Sage system-wide should run `make ptestlong` or similiar anyway (which also runs `sage`), just like one runs `make check` before running `make install`.\n\nAlso note that `sage` (or `sage-location`) should be run (at least) **after** it has been moved to its final installation location, which is likely to happen *after* having built Sage.",
    "created_at": "2011-10-15T18:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133769",
    "user": "leif"
}
```

I don't like the idea of running `sage` after `make build` since it certainly doesn't belong to that target, but if at all, it shouldn't be run from `spkg/install` but the `Makefile`, preferably in the *default rule*, not `build`.  Or run `sage-location` from there if `make` did anything, but we should in principle run it from elsewhere.

Someone who is going to install Sage system-wide should run `make ptestlong` or similiar anyway (which also runs `sage`), just like one runs `make check` before running `make install`.

Also note that `sage` (or `sage-location`) should be run (at least) **after** it has been moved to its final installation location, which is likely to happen *after* having built Sage.



---

archive/issue_comments_133770.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> I don't like the idea of running `sage` after `make build` since it certainly doesn't belong to that target\nI think it does.  Currently, after `make build` (or simply `make`), Sage **does not work** for a different user.  I think `make build` should result in a proper Sage installation, which means that it should work for **every user**.\n\n> it shouldn't be run from `spkg/install` but the `Makefile`\nWhy?  I like `spkg/install` better because it allows us to run Sage only if something was actually installed.  You don't want to run Sage everytime somebody does `make foo` for various values of \"foo\".  Also, IIRC, we run `spkg/install` on upgrading but not a top-level `make all` or `make build`.\n\n> Or run `sage-location` from there if `make` did anything, but we should in principle run it from elsewhere.\nRunning `sage-location` is certainly not sufficient to generate all files needed to run Sage.\n\n> Someone who is going to install Sage system-wide should run `make ptestlong`\nLet the sysadmin decide whether they want to run `make ptestlong` or not, I want to give him the option of NOT doing it.\n\n> Also note that `sage` (or `sage-location`) should be run (at least) **after** it has been moved to its final installation location, which is likely to happen *after* having built Sage.\nI would think most people run Sage from the location where they installed it, or equivalently, install Sage in the location they want to run it from.  In any case, this does not invalidate the reasons for this ticket.",
    "created_at": "2011-10-15T19:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133770",
    "user": "jdemeyer"
}
```

Replying to [comment:5 leif]:
> I don't like the idea of running `sage` after `make build` since it certainly doesn't belong to that target
I think it does.  Currently, after `make build` (or simply `make`), Sage **does not work** for a different user.  I think `make build` should result in a proper Sage installation, which means that it should work for **every user**.

> it shouldn't be run from `spkg/install` but the `Makefile`
Why?  I like `spkg/install` better because it allows us to run Sage only if something was actually installed.  You don't want to run Sage everytime somebody does `make foo` for various values of "foo".  Also, IIRC, we run `spkg/install` on upgrading but not a top-level `make all` or `make build`.

> Or run `sage-location` from there if `make` did anything, but we should in principle run it from elsewhere.
Running `sage-location` is certainly not sufficient to generate all files needed to run Sage.

> Someone who is going to install Sage system-wide should run `make ptestlong`
Let the sysadmin decide whether they want to run `make ptestlong` or not, I want to give him the option of NOT doing it.

> Also note that `sage` (or `sage-location`) should be run (at least) **after** it has been moved to its final installation location, which is likely to happen *after* having built Sage.
I would think most people run Sage from the location where they installed it, or equivalently, install Sage in the location they want to run it from.  In any case, this does not invalidate the reasons for this ticket.



---

archive/issue_comments_133771.json:
```json
{
    "body": "Updated version of the patch using a temporary `DOT_SAGE` directory.  I have not really tested it well.",
    "created_at": "2011-10-15T22:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133771",
    "user": "jdemeyer"
}
```

Updated version of the patch using a temporary `DOT_SAGE` directory.  I have not really tested it well.



---

archive/issue_comments_133772.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-15T22:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133772",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133773.json:
```json
{
    "body": "Tested with a complete build from scratch that this does indeed what it should do.  A simple `make build` allows **any user** to run Sage.",
    "created_at": "2011-10-16T15:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133773",
    "user": "jdemeyer"
}
```

Tested with a complete build from scratch that this does indeed what it should do.  A simple `make build` allows **any user** to run Sage.



---

archive/issue_comments_133774.json:
```json
{
    "body": "I don't see anything in the new patch about `DOT_SAGE`.",
    "created_at": "2011-10-16T19:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133774",
    "user": "jhpalmieri"
}
```

I don't see anything in the new patch about `DOT_SAGE`.



---

archive/issue_comments_133775.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n> I don't see anything in the new patch about `DOT_SAGE`.\n\nSo true!  I seems I forget a `hg qrefresh`.",
    "created_at": "2011-10-17T06:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133775",
    "user": "jdemeyer"
}
```

Replying to [comment:9 jhpalmieri]:
> I don't see anything in the new patch about `DOT_SAGE`.

So true!  I seems I forget a `hg qrefresh`.



---

archive/issue_comments_133776.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> In case some system administrator is building Sage and doesn't want a .sage directory created for them, should we set DOTSAGE to something temporary first?\n\nRelated question which comes up: should we also use a temporary DOT_SAGE directory for `make doc`?  In #10163, I found out that `make doc` does run Sage (and does create a DOT_SAGE directory).",
    "created_at": "2011-10-17T06:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133776",
    "user": "jdemeyer"
}
```

Replying to [comment:3 jhpalmieri]:
> In case some system administrator is building Sage and doesn't want a .sage directory created for them, should we set DOTSAGE to something temporary first?

Related question which comes up: should we also use a temporary DOT_SAGE directory for `make doc`?  In #10163, I found out that `make doc` does run Sage (and does create a DOT_SAGE directory).



---

archive/issue_comments_133777.json:
```json
{
    "body": "I'm somewhat tempted to add a new command-line option to Sage:\n\n```diff\ndiff --git a/sage-sage b/sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -247,6 +247,27 @@ if [ $# -gt 0 ]; then\n   fi\n fi\n \n+# The following function creates a temporary file and stores its name\n+# in $FILE.  (It would be nice to replace this with 'mktemp', but that\n+# command has different syntax on OS X compared to linux or Solaris.)\n+sagetempfile() {\n+    FILE=`mktemp -d 2>/dev/null`\n+    if [ $? -ne 0 ]; then\n+        # presumably because the \"-d\" option to mktemp expects an argument,\n+        # e.g., on OS X.\n+        FILE=`mktemp -d -t dotsage`\n+    fi\n+}\n+\n+if [ \"$1\" = '--norc' -o \"$1\" = '--nodotsage' ]; then\n+    OLD_DOT_SAGE=$DOT_SAGE\n+    sagetempfile\n+    DOT_SAGE=$FILE && export DOT_SAGE\n+    shift\n+    sage \"$@\"\n+    rm -rf \"$DOT_SAGE\"\n+    DOT_SAGE=$OLD_DOT_SAGE && export DOT_SAGE\n+fi\n \n LOGFILE=\"$SAGE_ROOT/sage.log\"\n LOGOPT=\"\"\n\n```\n\nWe should probably check exit codes for various things here, and of course this would need to be documented.  If we had this, then in `Makefile`, we could replace \"sage --docbuild ...\" with \"sage --norc --docbuild ...\".  We could possibly do the same with \"make test\", etc.",
    "created_at": "2011-10-17T17:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133777",
    "user": "jhpalmieri"
}
```

I'm somewhat tempted to add a new command-line option to Sage:

```diff
diff --git a/sage-sage b/sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -247,6 +247,27 @@ if [ $# -gt 0 ]; then
   fi
 fi
 
+# The following function creates a temporary file and stores its name
+# in $FILE.  (It would be nice to replace this with 'mktemp', but that
+# command has different syntax on OS X compared to linux or Solaris.)
+sagetempfile() {
+    FILE=`mktemp -d 2>/dev/null`
+    if [ $? -ne 0 ]; then
+        # presumably because the "-d" option to mktemp expects an argument,
+        # e.g., on OS X.
+        FILE=`mktemp -d -t dotsage`
+    fi
+}
+
+if [ "$1" = '--norc' -o "$1" = '--nodotsage' ]; then
+    OLD_DOT_SAGE=$DOT_SAGE
+    sagetempfile
+    DOT_SAGE=$FILE && export DOT_SAGE
+    shift
+    sage "$@"
+    rm -rf "$DOT_SAGE"
+    DOT_SAGE=$OLD_DOT_SAGE && export DOT_SAGE
+fi
 
 LOGFILE="$SAGE_ROOT/sage.log"
 LOGOPT=""

```

We should probably check exit codes for various things here, and of course this would need to be documented.  If we had this, then in `Makefile`, we could replace "sage --docbuild ..." with "sage --norc --docbuild ...".  We could possibly do the same with "make test", etc.



---

archive/issue_comments_133778.json:
```json
{
    "body": "Replying to [comment:13 jhpalmieri]:\n> I'm somewhat tempted to add a new command-line option to Sage:\nLet's discuss this in a different ticket: #11932.\n\nI think I am going to revert the `DOT_SAGE` handling here and leave that for #11932, because currently it's very hard to avoid having a `$HOME/.sage` directory created when installing Sage.",
    "created_at": "2011-10-17T18:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133778",
    "user": "jdemeyer"
}
```

Replying to [comment:13 jhpalmieri]:
> I'm somewhat tempted to add a new command-line option to Sage:
Let's discuss this in a different ticket: #11932.

I think I am going to revert the `DOT_SAGE` handling here and leave that for #11932, because currently it's very hard to avoid having a `$HOME/.sage` directory created when installing Sage.



---

archive/issue_comments_133779.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-17T18:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133779",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_133780.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-17T18:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133780",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133781.json:
```json
{
    "body": "s/succesfully/successfully/\n\nStill, running `sage` (especially the full bunch of shell scripts) there is quite dangerous, as almost everything can happen.  Worse, there's no *\"DO NOT INTERRUPT THIS\"**, and error messages aren't even logged.\n\nBetter write some `install` target (and / or a `sage-first_time` script), and update the Sage Installation Guide, especially with respect to files that are created upon first start-up, hardcoded path etc. etc.\n\nIMHO we should in general do certain things *upon installing Sage* (some actually *during* the build), rather than checking them and doing them *for the first time* when someone tries to start Sage.\n\n\n----\n* This message is btw. printed too late, as `install_moved()` already does some stuff before the script (eventually!) gets to this.\n\n\n\n\nP.S.: No serious sysadmin builds in, say, `/usr/local/`, or leaves an \"installation\" in `/tmp/`.",
    "created_at": "2011-10-17T20:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133781",
    "user": "leif"
}
```

s/succesfully/successfully/

Still, running `sage` (especially the full bunch of shell scripts) there is quite dangerous, as almost everything can happen.  Worse, there's no *"DO NOT INTERRUPT THIS"**, and error messages aren't even logged.

Better write some `install` target (and / or a `sage-first_time` script), and update the Sage Installation Guide, especially with respect to files that are created upon first start-up, hardcoded path etc. etc.

IMHO we should in general do certain things *upon installing Sage* (some actually *during* the build), rather than checking them and doing them *for the first time* when someone tries to start Sage.


----
* This message is btw. printed too late, as `install_moved()` already does some stuff before the script (eventually!) gets to this.




P.S.: No serious sysadmin builds in, say, `/usr/local/`, or leaves an "installation" in `/tmp/`.



---

archive/issue_comments_133782.json:
```json
{
    "body": "s/does not run/failed to start up/.",
    "created_at": "2011-10-17T20:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133782",
    "user": "leif"
}
```

s/does not run/failed to start up/.



---

archive/issue_comments_133783.json:
```json
{
    "body": "Also, upon upgrading the message is useless (at least in the first place), as a second attempt to upgrade / build Sage is made.",
    "created_at": "2011-10-17T21:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133783",
    "user": "leif"
}
```

Also, upon upgrading the message is useless (at least in the first place), as a second attempt to upgrade / build Sage is made.



---

archive/issue_comments_133784.json:
```json
{
    "body": "Instead of running Sage, you could run `sage-location` and `sage-python -c 'from sage.all import *'`, along with printing messages like \"Generating necessary pyc files; do not interrupt\".  This should generate the pyc files and the other files in local/lib, right? This avoids the shell script sage-sage, but is there any real advantage to doing this instead of just running `sage`?",
    "created_at": "2011-10-17T21:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133784",
    "user": "jhpalmieri"
}
```

Instead of running Sage, you could run `sage-location` and `sage-python -c 'from sage.all import *'`, along with printing messages like "Generating necessary pyc files; do not interrupt".  This should generate the pyc files and the other files in local/lib, right? This avoids the shell script sage-sage, but is there any real advantage to doing this instead of just running `sage`?



---

archive/issue_comments_133785.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> Instead of running Sage, you could run `sage-location` and `sage-python -c 'from sage.all import *'`, along with printing messages like \"Generating necessary pyc files; do not interrupt\".  This should generate the pyc files and the other files in local/lib, right? This avoids the shell script sage-sage, but is there any real advantage to doing this instead of just running `sage`?\n\nNot much I think.  But we should really separate the things that have to (or should better) be done before running Sage the first time.  Compiling Python files does IMHO not belong to this, and executing `from sage.all import *` can again do almost everything (or lead to arbitrary constellations if the build is broken), and is hardly guaranteed to at all exit by itself.\n\nCreating a (fully working) \"read-only\" installation (from the perspective of an arbitrary user) is certainly not something that belongs to a regular **build**; you'd do such if you intend to *install* Sage system-wide for example of course, hence there should be some (separate) target for this.  Such target *could* be the default target (`all`), although I think it shouldn't, at least not unless there's a (well-documented) way to specify the destination in advance, during some manually run `configure` for example.",
    "created_at": "2011-10-17T22:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133785",
    "user": "leif"
}
```

Replying to [comment:19 jhpalmieri]:
> Instead of running Sage, you could run `sage-location` and `sage-python -c 'from sage.all import *'`, along with printing messages like "Generating necessary pyc files; do not interrupt".  This should generate the pyc files and the other files in local/lib, right? This avoids the shell script sage-sage, but is there any real advantage to doing this instead of just running `sage`?

Not much I think.  But we should really separate the things that have to (or should better) be done before running Sage the first time.  Compiling Python files does IMHO not belong to this, and executing `from sage.all import *` can again do almost everything (or lead to arbitrary constellations if the build is broken), and is hardly guaranteed to at all exit by itself.

Creating a (fully working) "read-only" installation (from the perspective of an arbitrary user) is certainly not something that belongs to a regular **build**; you'd do such if you intend to *install* Sage system-wide for example of course, hence there should be some (separate) target for this.  Such target *could* be the default target (`all`), although I think it shouldn't, at least not unless there's a (well-documented) way to specify the destination in advance, during some manually run `configure` for example.



---

archive/issue_comments_133786.json:
```json
{
    "body": "On one hand, there is something attractive about building and installing Sage by running (perhaps) \"configure\", then \"make\", then \"make install\".  However, this would require some work, and also a potential change of behavior for most Sage developers.  This sounds like a possibility, but a long-term one.  I don't see it happening any time soon, anyway.  Jeroen's suggestion here, on the other hand, is a quick solution for a problem with Sage now.  I suggest we merge this now (once the typos are fixed, along with any other simple fixes), and consider a longer term solution separately.\n\nI wouldn't object if this were implemented by adding a new target in the Makefile, but I think it should be run by default to address the issues Jeroen has raised here.  I also wouldn't object if it were implemented as in the current patch, perhaps with a followup ticket to make it a separate target for make.",
    "created_at": "2011-10-18T05:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133786",
    "user": "jhpalmieri"
}
```

On one hand, there is something attractive about building and installing Sage by running (perhaps) "configure", then "make", then "make install".  However, this would require some work, and also a potential change of behavior for most Sage developers.  This sounds like a possibility, but a long-term one.  I don't see it happening any time soon, anyway.  Jeroen's suggestion here, on the other hand, is a quick solution for a problem with Sage now.  I suggest we merge this now (once the typos are fixed, along with any other simple fixes), and consider a longer term solution separately.

I wouldn't object if this were implemented by adding a new target in the Makefile, but I think it should be run by default to address the issues Jeroen has raised here.  I also wouldn't object if it were implemented as in the current patch, perhaps with a followup ticket to make it a separate target for make.



---

archive/issue_comments_133787.json:
```json
{
    "body": "Replying to [comment:21 jhpalmieri]:\n> Jeroen's suggestion here, on the other hand, is a quick solution for a problem with Sage now.\n\nI don't see any problem, except that the current behaviour of Sage regarding on-the-fly creation or modification of files in the \"static\" installation tree is suboptimal and -- IMHO worse -- AFAIK not documented, at least not very well.\n\nAnd the \"problem\" is all but new.\n\nSysadmins -- at least those that have installed Sage before (others will quickly notice) -- are likely to be aware of that; most other users don't care at all, so this is rather a non-issue.\n\nAdding running `sage` at the end of every (perhaps partial re-) build is not the right way to solve this; in contrast, it is likely to obscure errors that don't show up during the build but when you try to start Sage, in addition with the potential to make the build hang (without any output).\n\nSo the minimal things to do are -- if you really want to run Sage *there*:\n\n* Print a message that we're attempting to run `sage`.\n* Disable keyboard interrupts during important operations (`sage-location`, maybe elsewhere, too), and issue a warning that this process must not be interrupted, at least for a few minutes.\n* Perhaps set a reasonably long timeout for running `sage`.\n* Log the output instead of redirecting it to `/dev/null`, such that we can print at least a reference to the error log in case of failures.\n\n\n\n\n> I suggest we merge this now (once the typos are fixed, along with any other simple fixes), and consider a longer term solution separately.\n\nThere are various possible long-term solutions; the primary goal should be to *document* potential issues, i.e., at least prominently state that Sage should be run at least once at its final location for use in a multi-user environment, or more precisely, for a system-wide installation.\n\n\n\n\n> I wouldn't object if this were implemented by adding a new target in the Makefile, but I think it should be run by default to address the issues Jeroen has raised here.\n\nAn `echo` statement at the end of the build, perhaps in the `Makefile`, would IMHO fully suffice for the moment; no need to hurry or for \"quick [and dirty] fixes\" (which btw. often cause more trouble than they solve).\n\nHave there been any \"error\" reports regarding this?  Changing the permissions of *all* files in a couple of spkgs wasn't necessary either.\n\nNote that \"ordinary\" users won't be able to install / upgrade spkgs anyway, so the `pkg-config` and `.la` files for example aren't an issue in a system-wide installation, nor will such users be able to move Sage, unless they copy the whole installation (in which case they're likely to gain ownership, or at least can change the owner, such that they'll have write permission on the copied installation).",
    "created_at": "2011-10-18T07:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133787",
    "user": "leif"
}
```

Replying to [comment:21 jhpalmieri]:
> Jeroen's suggestion here, on the other hand, is a quick solution for a problem with Sage now.

I don't see any problem, except that the current behaviour of Sage regarding on-the-fly creation or modification of files in the "static" installation tree is suboptimal and -- IMHO worse -- AFAIK not documented, at least not very well.

And the "problem" is all but new.

Sysadmins -- at least those that have installed Sage before (others will quickly notice) -- are likely to be aware of that; most other users don't care at all, so this is rather a non-issue.

Adding running `sage` at the end of every (perhaps partial re-) build is not the right way to solve this; in contrast, it is likely to obscure errors that don't show up during the build but when you try to start Sage, in addition with the potential to make the build hang (without any output).

So the minimal things to do are -- if you really want to run Sage *there*:

* Print a message that we're attempting to run `sage`.
* Disable keyboard interrupts during important operations (`sage-location`, maybe elsewhere, too), and issue a warning that this process must not be interrupted, at least for a few minutes.
* Perhaps set a reasonably long timeout for running `sage`.
* Log the output instead of redirecting it to `/dev/null`, such that we can print at least a reference to the error log in case of failures.




> I suggest we merge this now (once the typos are fixed, along with any other simple fixes), and consider a longer term solution separately.

There are various possible long-term solutions; the primary goal should be to *document* potential issues, i.e., at least prominently state that Sage should be run at least once at its final location for use in a multi-user environment, or more precisely, for a system-wide installation.




> I wouldn't object if this were implemented by adding a new target in the Makefile, but I think it should be run by default to address the issues Jeroen has raised here.

An `echo` statement at the end of the build, perhaps in the `Makefile`, would IMHO fully suffice for the moment; no need to hurry or for "quick [and dirty] fixes" (which btw. often cause more trouble than they solve).

Have there been any "error" reports regarding this?  Changing the permissions of *all* files in a couple of spkgs wasn't necessary either.

Note that "ordinary" users won't be able to install / upgrade spkgs anyway, so the `pkg-config` and `.la` files for example aren't an issue in a system-wide installation, nor will such users be able to move Sage, unless they copy the whole installation (in which case they're likely to gain ownership, or at least can change the owner, such that they'll have write permission on the copied installation).



---

archive/issue_comments_133788.json:
```json
{
    "body": "Replying to [comment:16 leif]:\n> Still, running `sage` (especially the full bunch of shell scripts) there is quite dangerous, as almost everything can happen.\nWhat's your point really?  Whoever built Sage will have to run it sooner or later, otherwise it's quite pointless building Sage.  So the danger is there anyway.",
    "created_at": "2011-10-18T10:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133788",
    "user": "jdemeyer"
}
```

Replying to [comment:16 leif]:
> Still, running `sage` (especially the full bunch of shell scripts) there is quite dangerous, as almost everything can happen.
What's your point really?  Whoever built Sage will have to run it sooner or later, otherwise it's quite pointless building Sage.  So the danger is there anyway.



---

archive/issue_comments_133789.json:
```json
{
    "body": "Replying to [comment:18 leif]:\n> Also, upon upgrading the message is useless (at least in the first place), as a second attempt to upgrade / build Sage is made.\nWhat do you mean by \"a second attempt to upgrade / build Sage is made\"?",
    "created_at": "2011-10-18T10:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133789",
    "user": "jdemeyer"
}
```

Replying to [comment:18 leif]:
> Also, upon upgrading the message is useless (at least in the first place), as a second attempt to upgrade / build Sage is made.
What do you mean by "a second attempt to upgrade / build Sage is made"?



---

archive/issue_comments_133790.json:
```json
{
    "body": "Replying to [comment:16 leif]:\n> Better write some `install` target (and / or a `sage-first_time` script), and update the Sage Installation Guide, especially with respect to files that are created upon first start-up, hardcoded path etc. etc.\n> \n> IMHO we should in general do certain things *upon installing Sage* (some actually *during* the build), rather than checking them and doing them *for the first time* when someone tries to start Sage.\nIn principle you are of course right but Sage is quite different from other software.  It currently has no `make install` rule, and it is not at all clear to me what `make install` should do anyway.  Also, Sage is special in that the source code is really in the installation.  Normally, you would have a source tree and a build tree, but with Sage this is one.  Sage developers are used to this, so people might even complain if you try to change this.  So for this ticket, let's not overhaul the whole Sage build process, let's stick to the simple solution.\n\n> * This message is btw. printed too late, as `install_moved()` already does some stuff before the script (eventually!) gets to this.\nSee #5155.\n\nLeif: would you agree with the following: add a `make install` rule in Sage which simply runs Sage (and hence indirectly `sage-location`)?  And then not run Sage from `spkg/install`.",
    "created_at": "2011-10-18T10:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133790",
    "user": "jdemeyer"
}
```

Replying to [comment:16 leif]:
> Better write some `install` target (and / or a `sage-first_time` script), and update the Sage Installation Guide, especially with respect to files that are created upon first start-up, hardcoded path etc. etc.
> 
> IMHO we should in general do certain things *upon installing Sage* (some actually *during* the build), rather than checking them and doing them *for the first time* when someone tries to start Sage.
In principle you are of course right but Sage is quite different from other software.  It currently has no `make install` rule, and it is not at all clear to me what `make install` should do anyway.  Also, Sage is special in that the source code is really in the installation.  Normally, you would have a source tree and a build tree, but with Sage this is one.  Sage developers are used to this, so people might even complain if you try to change this.  So for this ticket, let's not overhaul the whole Sage build process, let's stick to the simple solution.

> * This message is btw. printed too late, as `install_moved()` already does some stuff before the script (eventually!) gets to this.
See #5155.

Leif: would you agree with the following: add a `make install` rule in Sage which simply runs Sage (and hence indirectly `sage-location`)?  And then not run Sage from `spkg/install`.



---

archive/issue_comments_133791.json:
```json
{
    "body": "Replying to [comment:23 jdemeyer]:\n> Replying to [comment:16 leif]:\n> > Still, running `sage` (especially the full bunch of shell scripts) there is quite dangerous, as almost everything can happen.\n> Whoever built Sage will have to run it sooner or later, otherwise it's quite pointless building Sage.  So the danger is there anyway.\n\n:D I didn't know that.  I only build Sage, but have never run it.\n\nSeriously, the difference is whether a user *intentionally* runs `sage` (for the first time after a build / upgrade / extraction of a binary distribution), and *sees* what's happening.  Your new patch omits the redirection to `/dev/null`, but I think it would be better to log the output to something like `$SAGE_ROOT/first_sage_startup-`date +\"%Y-%m-%d-%H:%M\"`.log`, which we *could* delete afterwards if apparently nothing went wrong, otherwise point the user to this file, e.g. for bug reports (also to sage-release btw.).\n\nWe have enough \"error reports\" where people claim something didn't work but couldn't provide error logs.\n\n\n\n\nI'd also prefer running Sage from the `Makefile`; rather than changing the `build` target, we could modify the *default target* to run `sage` once after a successful build (or after building the documentation, but that's likely to fail in \"weird\" ways if `sage` itself doesn't work properly), perhaps just if no (recent) \"first run\" logfile exists.\n\nThere we should IMHO separate what's currently implicitly performed by `sage-location`, for example by adding an option to `sage-sage` for running just that.  For upgrades, running `sage-location` *afterwards* is not strictly necessary; although some parts should be run by `sage-spkg` anyway, such that they also get run upon e.g. `sage -i ...`.  If `SAGE_UPGRADING=yes`, we could add a message to `spkg/install` (or `sage-sage`, or `sage-update`) recommending to try to run `sage` *right now* (provided the build succeeded).  `make upgrade` (and `make rebuild`) are overdue anyway; if/when we drop the creation of `pipestatus`, we could also change `sage-update` to just *download* new files and then run `make rebuild`, i.e., make it use the top-level `Makefile` as well (which is now under revision control and hence subject to upgrades, too).",
    "created_at": "2011-10-18T17:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133791",
    "user": "leif"
}
```

Replying to [comment:23 jdemeyer]:
> Replying to [comment:16 leif]:
> > Still, running `sage` (especially the full bunch of shell scripts) there is quite dangerous, as almost everything can happen.
> Whoever built Sage will have to run it sooner or later, otherwise it's quite pointless building Sage.  So the danger is there anyway.

:D I didn't know that.  I only build Sage, but have never run it.

Seriously, the difference is whether a user *intentionally* runs `sage` (for the first time after a build / upgrade / extraction of a binary distribution), and *sees* what's happening.  Your new patch omits the redirection to `/dev/null`, but I think it would be better to log the output to something like `$SAGE_ROOT/first_sage_startup-`date +"%Y-%m-%d-%H:%M"`.log`, which we *could* delete afterwards if apparently nothing went wrong, otherwise point the user to this file, e.g. for bug reports (also to sage-release btw.).

We have enough "error reports" where people claim something didn't work but couldn't provide error logs.




I'd also prefer running Sage from the `Makefile`; rather than changing the `build` target, we could modify the *default target* to run `sage` once after a successful build (or after building the documentation, but that's likely to fail in "weird" ways if `sage` itself doesn't work properly), perhaps just if no (recent) "first run" logfile exists.

There we should IMHO separate what's currently implicitly performed by `sage-location`, for example by adding an option to `sage-sage` for running just that.  For upgrades, running `sage-location` *afterwards* is not strictly necessary; although some parts should be run by `sage-spkg` anyway, such that they also get run upon e.g. `sage -i ...`.  If `SAGE_UPGRADING=yes`, we could add a message to `spkg/install` (or `sage-sage`, or `sage-update`) recommending to try to run `sage` *right now* (provided the build succeeded).  `make upgrade` (and `make rebuild`) are overdue anyway; if/when we drop the creation of `pipestatus`, we could also change `sage-update` to just *download* new files and then run `make rebuild`, i.e., make it use the top-level `Makefile` as well (which is now under revision control and hence subject to upgrades, too).



---

archive/issue_comments_133792.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> Replying to [comment:18 leif]:\n> > Also, upon upgrading the message is useless (at least in the first place), as a second attempt to upgrade / build Sage is made.\n> What do you mean by \"a second attempt to upgrade / build Sage is made\"?\n\n\n```sh\nif [ \"$1\" = '-upgrade' -o \"$1\" = \"--upgrade\" ]; then\n    # People often move the Sage install right before doing the upgrade, so it's\n    # important to fix any path hardcoding issues first, or certain library\n    # links will fail.\n    \"$SAGE_ROOT/local/bin/\"sage-location\n\n    # Do it twice since when installing sage-scripts and a running\n    # script changes, it gets confused and exits with an error.\n    # Running again (with the script replaced) then fixes the problem.\n    # Run from a temporary copy of sage-sage\n    shift\n    sage-upgrade \"$@\"\n    if [ $? = 2 ]; then   # this exit codes means the user elected not to do the upgrade at all.\n        exit $?\n    fi\n    echo \"Double checking that all packages have been installed.\"\n    sage-upgrade \"$@\"\n    exit $?\nfi\n```\n",
    "created_at": "2011-10-18T17:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133792",
    "user": "leif"
}
```

Replying to [comment:24 jdemeyer]:
> Replying to [comment:18 leif]:
> > Also, upon upgrading the message is useless (at least in the first place), as a second attempt to upgrade / build Sage is made.
> What do you mean by "a second attempt to upgrade / build Sage is made"?


```sh
if [ "$1" = '-upgrade' -o "$1" = "--upgrade" ]; then
    # People often move the Sage install right before doing the upgrade, so it's
    # important to fix any path hardcoding issues first, or certain library
    # links will fail.
    "$SAGE_ROOT/local/bin/"sage-location

    # Do it twice since when installing sage-scripts and a running
    # script changes, it gets confused and exits with an error.
    # Running again (with the script replaced) then fixes the problem.
    # Run from a temporary copy of sage-sage
    shift
    sage-upgrade "$@"
    if [ $? = 2 ]; then   # this exit codes means the user elected not to do the upgrade at all.
        exit $?
    fi
    echo "Double checking that all packages have been installed."
    sage-upgrade "$@"
    exit $?
fi
```




---

archive/issue_comments_133793.json:
```json
{
    "body": "Updated version, needs review (even though I have not yet tested building from scratch).",
    "created_at": "2011-10-18T19:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133793",
    "user": "jdemeyer"
}
```

Updated version, needs review (even though I have not yet tested building from scratch).



---

archive/issue_comments_133794.json:
```json
{
    "body": "Changing keywords from \"Makefile build\" to \"Makefile build sage-starts\".",
    "created_at": "2011-10-18T19:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133794",
    "user": "jdemeyer"
}
```

Changing keywords from "Makefile build" to "Makefile build sage-starts".



---

archive/issue_comments_133795.json:
```json
{
    "body": "Any reviewers for this quite simple patch?",
    "created_at": "2011-10-22T21:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133795",
    "user": "jdemeyer"
}
```

Any reviewers for this quite simple patch?



---

archive/issue_comments_133796.json:
```json
{
    "body": "I haven't tested it out, but it looks good at first glance.  If you're going to make changes to the error messages printed by sage-spkg, it would be good to mention `$SAGE_ROOT/spkg/logs/$PKG_NAME.log`.  If people build in parallel (and I hope they do), `$SAGE_ROOT/install.log` can be a real mess, and so may not be the best way to extract information.  What do you think about my attached patch?",
    "created_at": "2011-10-22T23:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133796",
    "user": "jhpalmieri"
}
```

I haven't tested it out, but it looks good at first glance.  If you're going to make changes to the error messages printed by sage-spkg, it would be good to mention `$SAGE_ROOT/spkg/logs/$PKG_NAME.log`.  If people build in parallel (and I hope they do), `$SAGE_ROOT/install.log` can be a real mess, and so may not be the best way to extract information.  What do you think about my attached patch?



---

archive/issue_comments_133797.json:
```json
{
    "body": "Attachment\n\nscripts repo; apply on top of other scripts patch",
    "created_at": "2011-10-22T23:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133797",
    "user": "jhpalmieri"
}
```

Attachment

scripts repo; apply on top of other scripts patch



---

archive/issue_comments_133798.json:
```json
{
    "body": "I think that in sage-starts, if Sage fails to start, you should delete `SAGE_ROOT/local/bin/sage-flags.txt`: this is created by sage-location, which gets run by sage, which gets run by sage-starts.  That is, the file sage-flags.txt might be created successfully, then \n\n```\nspkg/pipestatus \"./sage -c \\\"print 'Yes, Sage starts.'\\\" 2>&1\" \"tee -a start.log\"\n```\n\nfails, and then if you run \"make\" again, it won't test whether Sage starts because of the presence of sage-flags.txt.\n\nEither that, or there needs to be a different test in the Makefile to decide whether to run sage-starts.",
    "created_at": "2011-10-23T02:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133798",
    "user": "jhpalmieri"
}
```

I think that in sage-starts, if Sage fails to start, you should delete `SAGE_ROOT/local/bin/sage-flags.txt`: this is created by sage-location, which gets run by sage, which gets run by sage-starts.  That is, the file sage-flags.txt might be created successfully, then 

```
spkg/pipestatus "./sage -c \"print 'Yes, Sage starts.'\" 2>&1" "tee -a start.log"
```

fails, and then if you run "make" again, it won't test whether Sage starts because of the presence of sage-flags.txt.

Either that, or there needs to be a different test in the Makefile to decide whether to run sage-starts.



---

archive/issue_comments_133799.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-23T08:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133799",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_133800.json:
```json
{
    "body": "Replying to [comment:34 jhpalmieri]:\n> Either that, or there needs to be a different test in the Makefile to decide whether to run sage-starts.\n\nHow about having a *third* file besides the existing `sage-flags.txt` and `sage-current-location.txt`?  Say, a file `sage-started.txt` whose existence means Sage was run at least once successfully.\n\nI think we could also use the non-existence of this file as a trigger in `sage-location` to force some actions.  For example, on upgrading, even if the Sage tree was not moved, it might make sense to call `update_library_files()` and `update_pkgconfig_files()`.\n\nI would write the file `sage-started.txt` in `sage-location` and potentially delete it in `sage-starts` (that's what you proposed for `sage-flags.txt` instead).",
    "created_at": "2011-10-23T08:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133800",
    "user": "jdemeyer"
}
```

Replying to [comment:34 jhpalmieri]:
> Either that, or there needs to be a different test in the Makefile to decide whether to run sage-starts.

How about having a *third* file besides the existing `sage-flags.txt` and `sage-current-location.txt`?  Say, a file `sage-started.txt` whose existence means Sage was run at least once successfully.

I think we could also use the non-existence of this file as a trigger in `sage-location` to force some actions.  For example, on upgrading, even if the Sage tree was not moved, it might make sense to call `update_library_files()` and `update_pkgconfig_files()`.

I would write the file `sage-started.txt` in `sage-location` and potentially delete it in `sage-starts` (that's what you proposed for `sage-flags.txt` instead).



---

archive/issue_comments_133801.json:
```json
{
    "body": "You could instead test whether the file starts.log ends with \"Yes, Sage starts.\"  You could test this in sage-starts rather than in the Makefile.",
    "created_at": "2011-10-23T20:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133801",
    "user": "jhpalmieri"
}
```

You could instead test whether the file starts.log ends with "Yes, Sage starts."  You could test this in sage-starts rather than in the Makefile.



---

archive/issue_comments_133802.json:
```json
{
    "body": "Replying to [comment:36 jhpalmieri]:\n> You could instead test whether the file starts.log ends with \"Yes, Sage starts.\"\n\nSorry, but I disagree.  I think neither the existence nor contents of any logfiles should influence the runtime at all.  Users should be able to do whatever they want with logfiles without it making any difference.",
    "created_at": "2011-10-24T07:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133802",
    "user": "jdemeyer"
}
```

Replying to [comment:36 jhpalmieri]:
> You could instead test whether the file starts.log ends with "Yes, Sage starts."

Sorry, but I disagree.  I think neither the existence nor contents of any logfiles should influence the runtime at all.  Users should be able to do whatever they want with logfiles without it making any difference.



---

archive/issue_comments_133803.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-29T19:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133803",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133804.json:
```json
{
    "body": "New patches up for review.  It uses a new file *local/lib/sage-started.txt* to check whether to run `sage-starts`.  I also added a reviewer patch for your changed error message.",
    "created_at": "2011-10-29T19:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133804",
    "user": "jdemeyer"
}
```

New patches up for review.  It uses a new file *local/lib/sage-started.txt* to check whether to run `sage-starts`.  I also added a reviewer patch for your changed error message.



---

archive/issue_comments_133805.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-10-29T19:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133805",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_133806.json:
```json
{
    "body": "For the record:\n\n```\nInstallation in a Multiuser Environment\n---------------------------------------\n\nThis section addresses the question of how a system administrator\ncan install a single copy of Sage in a multi-user computer\nnetwork.\n\nSystem-wide install\n~~~~~~~~~~~~~~~~~~~\n\n#. After you build Sage, you may optionally copy or move the entire\n   build tree to ``/usr/local``.\n\n#. There are some initial files that have to be created the first time\n   Sage is run. Try starting up Sage once as root (or, to be\n   more thorough, try ``make test`` as root to run all the standard test\n   code). You can stop the tests by pressing ``ctrl-z`` followed by\n   typing ``kill %1`` (assuming you had no other jobs in the\n   background of that shell).\n\n...\n```\n\n\n(I.e., RTFM.)",
    "created_at": "2011-10-30T06:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133806",
    "user": "leif"
}
```

For the record:

```
Installation in a Multiuser Environment
---------------------------------------

This section addresses the question of how a system administrator
can install a single copy of Sage in a multi-user computer
network.

System-wide install
~~~~~~~~~~~~~~~~~~~

#. After you build Sage, you may optionally copy or move the entire
   build tree to ``/usr/local``.

#. There are some initial files that have to be created the first time
   Sage is run. Try starting up Sage once as root (or, to be
   more thorough, try ``make test`` as root to run all the standard test
   code). You can stop the tests by pressing ``ctrl-z`` followed by
   typing ``kill %1`` (assuming you had no other jobs in the
   background of that shell).

...
```


(I.e., RTFM.)



---

archive/issue_comments_133807.json:
```json
{
    "body": "The patch to `spkg/install` will conflict with #11959, so should be removed from the patch.  (The changes are irrelevant anyway.)",
    "created_at": "2011-10-30T07:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133807",
    "user": "leif"
}
```

The patch to `spkg/install` will conflict with #11959, so should be removed from the patch.  (The changes are irrelevant anyway.)



---

archive/issue_comments_133808.json:
```json
{
    "body": "I don't think it's a good idea to write the \"sage started\" file from `sage-location`, as running `sage-location` doesn't imply that Sage will or will get run.\n\nBtw., `.pyc` wasn't a typo; while the `.pyc` files don't get \"regenerated\" by `sage-location`, they get *deleted*, such that they'll indeed get regenerated the next time Sage is run.\n\n(The `.pc` files don't get regenerated either; if at all, they get updated when necessary.)",
    "created_at": "2011-10-30T07:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133808",
    "user": "leif"
}
```

I don't think it's a good idea to write the "sage started" file from `sage-location`, as running `sage-location` doesn't imply that Sage will or will get run.

Btw., `.pyc` wasn't a typo; while the `.pyc` files don't get "regenerated" by `sage-location`, they get *deleted*, such that they'll indeed get regenerated the next time Sage is run.

(The `.pc` files don't get regenerated either; if at all, they get updated when necessary.)



---

archive/issue_comments_133809.json:
```json
{
    "body": "The patch to `sage-spkg` is also unrelated (and of just cosmetic nature) and will just cause unnecessary merge conflicts.",
    "created_at": "2011-10-30T07:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133809",
    "user": "leif"
}
```

The patch to `sage-spkg` is also unrelated (and of just cosmetic nature) and will just cause unnecessary merge conflicts.



---

archive/issue_comments_133810.json:
```json
{
    "body": "Replying to [comment:50 leif]:\n> The patch to `sage-spkg` is also unrelated (and of just cosmetic nature) and will just cause unnecessary merge conflicts.\n\ns/the patch/the three patches/ !?!\n\nThese should better be split off and moved to (and later rebased on) #11021.",
    "created_at": "2011-10-30T07:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133810",
    "user": "leif"
}
```

Replying to [comment:50 leif]:
> The patch to `sage-spkg` is also unrelated (and of just cosmetic nature) and will just cause unnecessary merge conflicts.

s/the patch/the three patches/ !?!

These should better be split off and moved to (and later rebased on) #11021.



---

archive/issue_comments_133811.json:
```json
{
    "body": "Replying to [comment:47 leif]:\n> (I.e., RTFM.)\nI think we should Edit The Fucking Manual then.",
    "created_at": "2011-10-30T11:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133811",
    "user": "jdemeyer"
}
```

Replying to [comment:47 leif]:
> (I.e., RTFM.)
I think we should Edit The Fucking Manual then.



---

archive/issue_comments_133812.json:
```json
{
    "body": "Replying to [comment:48 leif]:\n> The patch to `spkg/install` will conflict with #11959, so should be removed from the patch.\n\nDone.",
    "created_at": "2011-10-30T11:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133812",
    "user": "jdemeyer"
}
```

Replying to [comment:48 leif]:
> The patch to `spkg/install` will conflict with #11959, so should be removed from the patch.

Done.



---

archive/issue_comments_133813.json:
```json
{
    "body": "Replying to [comment:50 leif]:\n> The patch to `sage-spkg` is also unrelated (and of just cosmetic nature) and will just cause unnecessary merge conflicts.\n\nI agree it is unrelated and of cosmetic nature but it improves the error messages which is quite important I think.  And #11021 is a ticket which has no activity since 3 months so I don't think moving it there is such a good solution.",
    "created_at": "2011-10-30T13:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133813",
    "user": "jdemeyer"
}
```

Replying to [comment:50 leif]:
> The patch to `sage-spkg` is also unrelated (and of just cosmetic nature) and will just cause unnecessary merge conflicts.

I agree it is unrelated and of cosmetic nature but it improves the error messages which is quite important I think.  And #11021 is a ticket which has no activity since 3 months so I don't think moving it there is such a good solution.



---

archive/issue_comments_133814.json:
```json
{
    "body": "Apply to SCRIPTS repository",
    "created_at": "2011-10-30T14:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133814",
    "user": "jdemeyer"
}
```

Apply to SCRIPTS repository



---

archive/issue_comments_133815.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-10-30T14:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133815",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_133816.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-30T14:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133816",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_133817.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-30T14:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133817",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133818.json:
```json
{
    "body": "Replying to [comment:49 leif]:\n> I don't think it's a good idea to write the \"sage started\" file from `sage-location`, as running `sage-location` doesn't imply that Sage will or will get run.\n\nOkay, moved this to `sage/all.py`, surely a better place.  Needs review.",
    "created_at": "2011-10-30T14:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133818",
    "user": "jdemeyer"
}
```

Replying to [comment:49 leif]:
> I don't think it's a good idea to write the "sage started" file from `sage-location`, as running `sage-location` doesn't imply that Sage will or will get run.

Okay, moved this to `sage/all.py`, surely a better place.  Needs review.



---

archive/issue_comments_133819.json:
```json
{
    "body": "If someone runs 'make build' instead of 'make' or 'make start', is there a good way to let them know that they should probably run Sage once to initialize various files, or should we just hope that they've read enough of README.txt or the installation guide?",
    "created_at": "2011-10-30T18:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133819",
    "user": "jhpalmieri"
}
```

If someone runs 'make build' instead of 'make' or 'make start', is there a good way to let them know that they should probably run Sage once to initialize various files, or should we just hope that they've read enough of README.txt or the installation guide?



---

archive/issue_comments_133820.json:
```json
{
    "body": "Replying to [comment:58 jhpalmieri]:\n> If someone runs 'make build' instead of 'make' or 'make start', is there a good way to let them know that they should probably run Sage once to initialize various files, or should we just hope that they've read enough of README.txt or the installation guide?\n\nWell, we could print a message after `make build` is finished, but this will also be printed when doing a simple `make` and might confuse users.  So I would rather *not* print anything and assume that users who know about `make build` also know what they are doing.",
    "created_at": "2011-10-31T08:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133820",
    "user": "jdemeyer"
}
```

Replying to [comment:58 jhpalmieri]:
> If someone runs 'make build' instead of 'make' or 'make start', is there a good way to let them know that they should probably run Sage once to initialize various files, or should we just hope that they've read enough of README.txt or the installation guide?

Well, we could print a message after `make build` is finished, but this will also be printed when doing a simple `make` and might confuse users.  So I would rather *not* print anything and assume that users who know about `make build` also know what they are doing.



---

archive/issue_comments_133821.json:
```json
{
    "body": "I think this looks good.  There are a few small cosmetic changes; if you want to make them, no need for re-review.\n\n- In [attachment:11926_sage.patch], line 859, I would change \"such that\" to \"so that\".\n\n- After having rewritten the error message in [attachment:trac_11926-error-msg.patch] myself, I now think it would look better to add blank lines above and below line 56, the name of the log file.  (That's line 59 in [attachment:11926-error-msg-review.patch]).  The same might go for line 65 (in the review patch), the commands to try to debug the error, but it's not as important there.",
    "created_at": "2011-10-31T22:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133821",
    "user": "jhpalmieri"
}
```

I think this looks good.  There are a few small cosmetic changes; if you want to make them, no need for re-review.

- In [attachment:11926_sage.patch], line 859, I would change "such that" to "so that".

- After having rewritten the error message in [attachment:trac_11926-error-msg.patch] myself, I now think it would look better to add blank lines above and below line 56, the name of the log file.  (That's line 59 in [attachment:11926-error-msg-review.patch]).  The same might go for line 65 (in the review patch), the commands to try to debug the error, but it's not as important there.



---

archive/issue_comments_133822.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-31T22:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133822",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133823.json:
```json
{
    "body": "Apply to the SAGE_ROOT repository",
    "created_at": "2011-10-31T22:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133823",
    "user": "jdemeyer"
}
```

Apply to the SAGE_ROOT repository



---

archive/issue_comments_133824.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-10-31T23:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133824",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_133825.json:
```json
{
    "body": "Attachment\n\nReplying to [comment:60 jhpalmieri]:\n> In [attachment:11926_sage.patch], line 859, I would change \"such that\" to \"so that\".\nDone\n\n> After having rewritten the error message in [attachment:trac_11926-error-msg.patch] myself, I now think it would look better to add blank lines above and below line 56, the name of the log file.  (That's line 59 in [attachment:11926-error-msg-review.patch]).  The same might go for line 65 (in the review patch), the commands to try to debug the error, but it's not as important there.\n\nWell, I think the indentation already makes them stand out.  Looking at the new error message in the description of this ticket, I quite like it.",
    "created_at": "2011-10-31T23:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133825",
    "user": "jdemeyer"
}
```

Attachment

Replying to [comment:60 jhpalmieri]:
> In [attachment:11926_sage.patch], line 859, I would change "such that" to "so that".
Done

> After having rewritten the error message in [attachment:trac_11926-error-msg.patch] myself, I now think it would look better to add blank lines above and below line 56, the name of the log file.  (That's line 59 in [attachment:11926-error-msg-review.patch]).  The same might go for line 65 (in the review patch), the commands to try to debug the error, but it's not as important there.

Well, I think the indentation already makes them stand out.  Looking at the new error message in the description of this ticket, I quite like it.



---

archive/issue_comments_133826.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-11-02T08:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133826",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_133827.json:
```json
{
    "body": "Replying to [comment:59 jdemeyer]:\n> Replying to [comment:58 jhpalmieri]:\n> > If someone runs 'make build' instead of 'make' or 'make start', is there a good way to let them know that they should probably run Sage once to initialize various files, or should we just hope that they've read enough of README.txt or the installation guide?\n> \n> Well, we could print a message after `make build` is finished, but this will also be printed when doing a simple `make` and might confuse users.  So I would rather *not* print anything and assume that users who know about `make build` also know what they are doing.\n\n\n```make\nifeq ($(MAKECMDGOALS),build)\n        RUN_SAGE_REMINDER = echo \"Make sure to run Sage once before ...\"\nendif\n\n...\n\nbuild: ...\n        ...\n        $(RUN_SAGE_REMINDER)\n```\n\n\n----\n\nIMHO this ticket still needs work.\n\nFirst of all, `doc` should also depend on `start`[sic], to avoid attempting to run both at the same time.\n\nSecond, the output of `sage-starts` still isn't logged, which is important for error reports at least.",
    "created_at": "2011-11-02T15:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133827",
    "user": "leif"
}
```

Replying to [comment:59 jdemeyer]:
> Replying to [comment:58 jhpalmieri]:
> > If someone runs 'make build' instead of 'make' or 'make start', is there a good way to let them know that they should probably run Sage once to initialize various files, or should we just hope that they've read enough of README.txt or the installation guide?
> 
> Well, we could print a message after `make build` is finished, but this will also be printed when doing a simple `make` and might confuse users.  So I would rather *not* print anything and assume that users who know about `make build` also know what they are doing.


```make
ifeq ($(MAKECMDGOALS),build)
        RUN_SAGE_REMINDER = echo "Make sure to run Sage once before ..."
endif

...

build: ...
        ...
        $(RUN_SAGE_REMINDER)
```


----

IMHO this ticket still needs work.

First of all, `doc` should also depend on `start`[sic], to avoid attempting to run both at the same time.

Second, the output of `sage-starts` still isn't logged, which is important for error reports at least.



---

archive/issue_comments_133828.json:
```json
{
    "body": "Replying to [comment:63 leif]:\n> First of all, `doc` should also depend on `start`[sic], to avoid attempting to run both at the same time.\nNothing wrong with running `doc` and `start`[sic] at the same time.\n\n> Second, the output of `sage-starts` still isn't logged\nThat's not true.  It is logged in `$SAGE_ROOT/start.log`, see the new `local/bin/sage-starts`.  If `sage-starts` fails, you get an error message pointing to this logfile.",
    "created_at": "2011-11-02T15:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133828",
    "user": "jdemeyer"
}
```

Replying to [comment:63 leif]:
> First of all, `doc` should also depend on `start`[sic], to avoid attempting to run both at the same time.
Nothing wrong with running `doc` and `start`[sic] at the same time.

> Second, the output of `sage-starts` still isn't logged
That's not true.  It is logged in `$SAGE_ROOT/start.log`, see the new `local/bin/sage-starts`.  If `sage-starts` fails, you get an error message pointing to this logfile.



---

archive/issue_comments_133829.json:
```json
{
    "body": "Replying to [comment:63 leif]:\n> Second, the output of `sage-starts` still isn't logged, which is important for error reports at least.\n\nOk, I see it is in `$SAGE_ROOT/start.log`.  Not immediately clear from the `Makefile`, and having it in `install.log` as well wouldn't be bad either.\n\nFrom `start.log` alone (which is always appended to), it isn't clear what happened inbetween (i.e., the relevant parts of `install.log`), and conversely, from `install.log` one doesn't necessarily see whether running Sage succeeded.  Having the date and time (UTC) there (in `start.log`, but in general in `install.log`, too) wouldn't be bad either.",
    "created_at": "2011-11-02T16:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133829",
    "user": "leif"
}
```

Replying to [comment:63 leif]:
> Second, the output of `sage-starts` still isn't logged, which is important for error reports at least.

Ok, I see it is in `$SAGE_ROOT/start.log`.  Not immediately clear from the `Makefile`, and having it in `install.log` as well wouldn't be bad either.

From `start.log` alone (which is always appended to), it isn't clear what happened inbetween (i.e., the relevant parts of `install.log`), and conversely, from `install.log` one doesn't necessarily see whether running Sage succeeded.  Having the date and time (UTC) there (in `start.log`, but in general in `install.log`, too) wouldn't be bad either.



---

archive/issue_comments_133830.json:
```json
{
    "body": "Replying to [comment:64 jdemeyer]:\n> Replying to [comment:63 leif]:\n> > First of all, `doc` should also depend on `start`[sic], to avoid attempting to run both at the same time.\n> Nothing wrong with running `doc` and `start`[sic] at the same time.\n\nSeriously?  If both get run at the same time, the [screen] output is likely to get messed up (the message of `sage-starts` almost certainly not being the last).  But more important, it doesn't make sense to try to build the documentation if Sage doesn't start up (since it will fail at some later point), and are you 100% sure that there aren't any further race conditions between these two?",
    "created_at": "2011-11-02T16:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133830",
    "user": "leif"
}
```

Replying to [comment:64 jdemeyer]:
> Replying to [comment:63 leif]:
> > First of all, `doc` should also depend on `start`[sic], to avoid attempting to run both at the same time.
> Nothing wrong with running `doc` and `start`[sic] at the same time.

Seriously?  If both get run at the same time, the [screen] output is likely to get messed up (the message of `sage-starts` almost certainly not being the last).  But more important, it doesn't make sense to try to build the documentation if Sage doesn't start up (since it will fail at some later point), and are you 100% sure that there aren't any further race conditions between these two?



---

archive/issue_comments_133831.json:
```json
{
    "body": "In the patch to `sage-spkg` (which is unrelated to this ticket anyway), `error_msg()` prints `\"sage: An error occurred while testing $PKG_NAME.` regardless of `$1`.",
    "created_at": "2011-11-02T16:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133831",
    "user": "leif"
}
```

In the patch to `sage-spkg` (which is unrelated to this ticket anyway), `error_msg()` prints `"sage: An error occurred while testing $PKG_NAME.` regardless of `$1`.



---

archive/issue_comments_133832.json:
```json
{
    "body": "Replying to [comment:67 leif]:\n> In the patch to `sage-spkg` (which is unrelated to this ticket anyway), `error_msg()` prints `\"sage: An error occurred while testing $PKG_NAME.` regardless of `$1`.\n\nI see.  Fixed in yet another reviewer patch...  Sorry for the noise, although the patch is still unrelated to the ticket's topic.  (More precisely, I already made similar changes at / for #11021, where it IMHO belongs.)",
    "created_at": "2011-11-02T16:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133832",
    "user": "leif"
}
```

Replying to [comment:67 leif]:
> In the patch to `sage-spkg` (which is unrelated to this ticket anyway), `error_msg()` prints `"sage: An error occurred while testing $PKG_NAME.` regardless of `$1`.

I see.  Fixed in yet another reviewer patch...  Sorry for the noise, although the patch is still unrelated to the ticket's topic.  (More precisely, I already made similar changes at / for #11021, where it IMHO belongs.)



---

archive/issue_comments_133833.json:
```json
{
    "body": "W.r.t. the Installation Guide:\n\nOne shouldn't edit `/usr/local/sage-*/sage` (**after** copying it; one can of course), but `/usr/local/bin/sage`, i.e., one should either edit the copy, or the original and copy it *afterwards*.\n\nNo need to remove the recommendation to run `make test` or whatever (`make ptestlong` would IMHO be more appropriate).",
    "created_at": "2011-11-02T16:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133833",
    "user": "leif"
}
```

W.r.t. the Installation Guide:

One shouldn't edit `/usr/local/sage-*/sage` (**after** copying it; one can of course), but `/usr/local/bin/sage`, i.e., one should either edit the copy, or the original and copy it *afterwards*.

No need to remove the recommendation to run `make test` or whatever (`make ptestlong` would IMHO be more appropriate).



---

archive/issue_comments_133834.json:
```json
{
    "body": "Replying to [comment:69 leif]:\n> W.r.t. the Installation Guide:\n> \n> One shouldn't edit `/usr/local/sage-*/sage` (**after** copying it; one can of course), but `/usr/local/bin/sage`, i.e., one should either edit the copy, or the original and copy it *afterwards*.\n\nP.S.: One should preferably edit the copy, since the original is under revision control, so changes to that can e.g. again cause \"errors\" during upgrading.",
    "created_at": "2011-11-02T16:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133834",
    "user": "leif"
}
```

Replying to [comment:69 leif]:
> W.r.t. the Installation Guide:
> 
> One shouldn't edit `/usr/local/sage-*/sage` (**after** copying it; one can of course), but `/usr/local/bin/sage`, i.e., one should either edit the copy, or the original and copy it *afterwards*.

P.S.: One should preferably edit the copy, since the original is under revision control, so changes to that can e.g. again cause "errors" during upgrading.



---

archive/issue_comments_133835.json:
```json
{
    "body": "Replying to [comment:68 leif]:\n> I see.  Fixed in yet another reviewer patch...  Sorry for the noise, although the patch is still unrelated to the ticket's topic.  (More precisely, I already made similar changes at / for #11021, where it IMHO belongs.)\n\nI don't see why it belongs more to #11021 than here, but in any case, that's not a very relevant discussion.  I was unaware of #11021 when I made the changes and I'm not sure whether that ticket is ready to be merged.",
    "created_at": "2011-11-02T19:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133835",
    "user": "jdemeyer"
}
```

Replying to [comment:68 leif]:
> I see.  Fixed in yet another reviewer patch...  Sorry for the noise, although the patch is still unrelated to the ticket's topic.  (More precisely, I already made similar changes at / for #11021, where it IMHO belongs.)

I don't see why it belongs more to #11021 than here, but in any case, that's not a very relevant discussion.  I was unaware of #11021 when I made the changes and I'm not sure whether that ticket is ready to be merged.



---

archive/issue_comments_133836.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-11-02T19:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133836",
    "user": "jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_comments_133837.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-11-02T19:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133837",
    "user": "jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_133838.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-02T19:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133838",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_133839.json:
```json
{
    "body": "Added an extra patch with the documentation changes proposed by leif, needs_review.",
    "created_at": "2011-11-02T19:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133839",
    "user": "jdemeyer"
}
```

Added an extra patch with the documentation changes proposed by leif, needs_review.



---

archive/issue_comments_133840.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133840",
    "user": "jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_133841.json:
```json
{
    "body": "Attachment\n\nCan somebody please review the last patch here?",
    "created_at": "2011-11-03T20:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133841",
    "user": "jdemeyer"
}
```

Attachment

Can somebody please review the last patch here?



---

archive/issue_comments_133842.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-11-03T21:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133842",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133843.json:
```json
{
    "body": "Looks okay to me.",
    "created_at": "2011-11-03T21:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133843",
    "user": "jhpalmieri"
}
```

Looks okay to me.



---

archive/issue_comments_133844.json:
```json
{
    "body": "Replying to [comment:79 jhpalmieri]:\n> Looks okay to me.\n\nYes.\n\nBut still `doc` should depend on `start`, such that one immediately gets *a single, meaningful* error message, not intermixed by repeated random tracebacks from Sphinx (after each of which the script btw. still unconditionally prints *\"Build succeeded.  The built documents can be found in...\"*).\n\nAnd it would be far better to have the output of `sage-starts` also appended to `install.log`, for the reasons given earlier.\n\n\n\n\nW.r.t. #11021:\n\nDespite its current title, it involves a \"major\" rewrite of `sage-spkg`, i.e., makes changes all over the code, half of which were -- though already positively reviewed -- removed from another ticket for IMHO no reason (since at that point, they did apply and didn't break any other tickets).\n\nSo that ticket certainly drags (which mainly is my fault; I've returned to it many times, but then again had to work on too many other tickets), but it doesn't make things easier if other tickets do redundant changes to `sage-spkg`, thereby just causing tedious rebasing.\n\nOne can by the way search for other tickets before working on e.g. scripts or spkgs.  And there's btw. also a meta-ticket for changes to the `Makefile`, #11622.",
    "created_at": "2011-11-03T23:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133844",
    "user": "leif"
}
```

Replying to [comment:79 jhpalmieri]:
> Looks okay to me.

Yes.

But still `doc` should depend on `start`, such that one immediately gets *a single, meaningful* error message, not intermixed by repeated random tracebacks from Sphinx (after each of which the script btw. still unconditionally prints *"Build succeeded.  The built documents can be found in..."*).

And it would be far better to have the output of `sage-starts` also appended to `install.log`, for the reasons given earlier.




W.r.t. #11021:

Despite its current title, it involves a "major" rewrite of `sage-spkg`, i.e., makes changes all over the code, half of which were -- though already positively reviewed -- removed from another ticket for IMHO no reason (since at that point, they did apply and didn't break any other tickets).

So that ticket certainly drags (which mainly is my fault; I've returned to it many times, but then again had to work on too many other tickets), but it doesn't make things easier if other tickets do redundant changes to `sage-spkg`, thereby just causing tedious rebasing.

One can by the way search for other tickets before working on e.g. scripts or spkgs.  And there's btw. also a meta-ticket for changes to the `Makefile`, #11622.



---

archive/issue_comments_133845.json:
```json
{
    "body": "Replying to [comment:80 leif]:\n> But still `doc` should depend on `start`, such that one immediately gets *a single, meaningful* error message\nI don't find it logical that `doc` would depend on `start`.  I still think the best solution would be to have `make build` run `sage-starts`.  So here, we have to agree to disagree.\n\n> So that ticket certainly drags (which mainly is my fault; I've returned to it many times, but then again had to work on too many other tickets), but it doesn't make things easier if other tickets do redundant changes to `sage-spkg`, thereby just causing tedious rebasing.\nIf we are not allowed to make patches just because some other ticket makes changes to the same code, then we might as well stop Sage development.  Especially if the ticket gets \"dragged\" as you say.",
    "created_at": "2011-11-04T09:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133845",
    "user": "jdemeyer"
}
```

Replying to [comment:80 leif]:
> But still `doc` should depend on `start`, such that one immediately gets *a single, meaningful* error message
I don't find it logical that `doc` would depend on `start`.  I still think the best solution would be to have `make build` run `sage-starts`.  So here, we have to agree to disagree.

> So that ticket certainly drags (which mainly is my fault; I've returned to it many times, but then again had to work on too many other tickets), but it doesn't make things easier if other tickets do redundant changes to `sage-spkg`, thereby just causing tedious rebasing.
If we are not allowed to make patches just because some other ticket makes changes to the same code, then we might as well stop Sage development.  Especially if the ticket gets "dragged" as you say.



---

archive/issue_comments_133846.json:
```json
{
    "body": "Replying to [comment:80 leif]:\n> And it would be far better to have the output of `sage-starts` also appended to `install.log`, for the reasons given earlier.\nI don't have strong feelings about this issue.  If you want to make this change on a different ticket, go ahead, I will have a look.",
    "created_at": "2011-11-04T09:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133846",
    "user": "jdemeyer"
}
```

Replying to [comment:80 leif]:
> And it would be far better to have the output of `sage-starts` also appended to `install.log`, for the reasons given earlier.
I don't have strong feelings about this issue.  If you want to make this change on a different ticket, go ahead, I will have a look.



---

archive/issue_comments_133847.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-11-04T09:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133847",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_133848.json:
```json
{
    "body": "Replying to [comment:81 jdemeyer]:\n> Replying to [comment:80 leif]:\n> > But still `doc` should depend on `start`, such that one immediately gets *a single, meaningful* error message\n> I don't find it logical that `doc` would depend on `start`.  I still think the best solution would be to have `make build` run `sage-starts`.  So here, we have to agree to disagree.\n\nThe builder imports `sage.all`, hence `doc` requires that Sage can start.\n\nPerhaps `sage --docbuild` should check once that it is functional (with `try: import sage.all ...`).\n\n\n\n\n\n> If we are not allowed to make patches just because some other ticket makes changes to the same code, then we might as well stop Sage development.  Especially if the ticket gets \"dragged\" as you say.\n\nI was talking about *unnecessary*, unrelated changes.  Any developer should at least be aware of other tickets touching the same code.\n\nIt's also bad practice to bundle unrelated changes to different files into a single patch, just because they're in the same repo.",
    "created_at": "2011-11-04T09:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133848",
    "user": "leif"
}
```

Replying to [comment:81 jdemeyer]:
> Replying to [comment:80 leif]:
> > But still `doc` should depend on `start`, such that one immediately gets *a single, meaningful* error message
> I don't find it logical that `doc` would depend on `start`.  I still think the best solution would be to have `make build` run `sage-starts`.  So here, we have to agree to disagree.

The builder imports `sage.all`, hence `doc` requires that Sage can start.

Perhaps `sage --docbuild` should check once that it is functional (with `try: import sage.all ...`).





> If we are not allowed to make patches just because some other ticket makes changes to the same code, then we might as well stop Sage development.  Especially if the ticket gets "dragged" as you say.

I was talking about *unnecessary*, unrelated changes.  Any developer should at least be aware of other tickets touching the same code.

It's also bad practice to bundle unrelated changes to different files into a single patch, just because they're in the same repo.



---

archive/issue_comments_133849.json:
```json
{
    "body": "See #11991 for what I hope is a quick a follow-up: sage-starts should record the time and version number.",
    "created_at": "2011-11-04T21:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133849",
    "user": "jhpalmieri"
}
```

See #11991 for what I hope is a quick a follow-up: sage-starts should record the time and version number.



---

archive/issue_comments_133850.json:
```json
{
    "body": "I hate to be late to the party. I was bogged down into work. I appreciate the point of view that most people won't build the stuff system wide. Me and Paulo from Mandriva do. I and probably him will object to that sage-started.txt file being stored in $SAGE_LOCAL/lib/. To us it belongs to DOTSAGE. I know it complicates the testing that Jeroen wants to do. But this goes a long way to making a system wide installation troublesome. \n\nI may have missed it but where is the documentation for someone who wants to make a system wide install? Just this ticket?",
    "created_at": "2011-11-24T22:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133850",
    "user": "fbissey"
}
```

I hate to be late to the party. I was bogged down into work. I appreciate the point of view that most people won't build the stuff system wide. Me and Paulo from Mandriva do. I and probably him will object to that sage-started.txt file being stored in $SAGE_LOCAL/lib/. To us it belongs to DOTSAGE. I know it complicates the testing that Jeroen wants to do. But this goes a long way to making a system wide installation troublesome. 

I may have missed it but where is the documentation for someone who wants to make a system wide install? Just this ticket?



---

archive/issue_comments_133851.json:
```json
{
    "body": "I think that sage_started.txt should be viewed as a file like sage-current-location.txt: a file which is produced during the build/test process, which ordinary users don't need write-access to.  This ticket is related to some of the issues at #5155, and should indeed fix some of them.  But maybe I don't understand your complaint; can you explain it more?",
    "created_at": "2011-11-25T04:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133851",
    "user": "jhpalmieri"
}
```

I think that sage_started.txt should be viewed as a file like sage-current-location.txt: a file which is produced during the build/test process, which ordinary users don't need write-access to.  This ticket is related to some of the issues at #5155, and should indeed fix some of them.  But maybe I don't understand your complaint; can you explain it more?



---

archive/issue_comments_133852.json:
```json
{
    "body": "Replying to [comment:85 fbissey]:\n> I hate to be late to the party. I was bogged down into work. I appreciate the point of view that most people won't build the stuff system wide. Me and Paulo from Mandriva do. I and probably him will object to that sage-started.txt file being stored in $SAGE_LOCAL/lib/. To us it belongs to DOTSAGE. I know it complicates the testing that Jeroen wants to do. But this goes a long way to making a system wide installation troublesome.\nWhy do you think this makes a system-wide install harder?  In fact, this ticket was exactly supposed to make it *easier* to do a system-wide install.\n\n> I may have missed it but where is the documentation for someone who wants to make a system wide install? Just this ticket?\nSee [http://sagemath.org/doc/installation/source.html#installation-in-a-multiuser-environment](http://sagemath.org/doc/installation/source.html#installation-in-a-multiuser-environment).  Of course this ticket (and probably others to be merged in sage-4.8) will change this documentation, but the essence should remain the same.",
    "created_at": "2011-11-25T09:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133852",
    "user": "jdemeyer"
}
```

Replying to [comment:85 fbissey]:
> I hate to be late to the party. I was bogged down into work. I appreciate the point of view that most people won't build the stuff system wide. Me and Paulo from Mandriva do. I and probably him will object to that sage-started.txt file being stored in $SAGE_LOCAL/lib/. To us it belongs to DOTSAGE. I know it complicates the testing that Jeroen wants to do. But this goes a long way to making a system wide installation troublesome.
Why do you think this makes a system-wide install harder?  In fact, this ticket was exactly supposed to make it *easier* to do a system-wide install.

> I may have missed it but where is the documentation for someone who wants to make a system wide install? Just this ticket?
See [http://sagemath.org/doc/installation/source.html#installation-in-a-multiuser-environment](http://sagemath.org/doc/installation/source.html#installation-in-a-multiuser-environment).  Of course this ticket (and probably others to be merged in sage-4.8) will change this documentation, but the essence should remain the same.



---

archive/issue_comments_133853.json:
```json
{
    "body": "OK. I just completed my first ebuild of a sage-4.8 alpha this afternoon. The first I noticed about this is when I ran the doctests as a normal user. I do that straight away as this is the only validation test I have. A truckload of doctests just failed complaining that they couldn't find \"sage-started.txt\". Actually so many failed that I am almost wondering if there is something wrong with the ones that didn't.\n\nI spent 3 weeks fixing bad fortran code and bad makefiles so I may have had a bit of a temper there but it just made my life difficult.\n\nI am not sure how it helps with #5155 since it adds stuff that actually wants access to SAGE_ROOT.\n\nI'll admit that I skimmed a bit on reading this thread so I won't attribute bad intent but using DOT_SAGE has been raised and apparently shot down as \"system wide install\" is not a normal install. You don't have to support the kind of stuff I do but it felt like making it more difficult knowingly.",
    "created_at": "2011-11-25T11:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133853",
    "user": "fbissey"
}
```

OK. I just completed my first ebuild of a sage-4.8 alpha this afternoon. The first I noticed about this is when I ran the doctests as a normal user. I do that straight away as this is the only validation test I have. A truckload of doctests just failed complaining that they couldn't find "sage-started.txt". Actually so many failed that I am almost wondering if there is something wrong with the ones that didn't.

I spent 3 weeks fixing bad fortran code and bad makefiles so I may have had a bit of a temper there but it just made my life difficult.

I am not sure how it helps with #5155 since it adds stuff that actually wants access to SAGE_ROOT.

I'll admit that I skimmed a bit on reading this thread so I won't attribute bad intent but using DOT_SAGE has been raised and apparently shot down as "system wide install" is not a normal install. You don't have to support the kind of stuff I do but it felt like making it more difficult knowingly.



---

archive/issue_comments_133854.json:
```json
{
    "body": "How did you build sage?  i.e. which shell commands did you execute, starting from the Sage source tarball, to get the totally-non-working Sage?",
    "created_at": "2011-11-25T11:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133854",
    "user": "jdemeyer"
}
```

How did you build sage?  i.e. which shell commands did you execute, starting from the Sage source tarball, to get the totally-non-working Sage?



---

archive/issue_comments_133855.json:
```json
{
    "body": "Also: precisely which alpha version of Sage did you use?  There have been various changes to the build process in the 4.8 series.",
    "created_at": "2011-11-25T11:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133855",
    "user": "jdemeyer"
}
```

Also: precisely which alpha version of Sage did you use?  There have been various changes to the build process in the 4.8 series.



---

archive/issue_comments_133856.json:
```json
{
    "body": "I tried the following:\n\n- build Sage ('make'), version 4.8.alpha2\n- move the Sage installation and run 'sage' once, as per the multi-user installation instructions\n- chmod a-w -R sage-x.y.z (so I don't have write access anymore)\n- sage -tp 18 devel/sage\n\nAlmost all tests passed; the only failures were the ones reported at #5515.\n\n```\nThe following tests failed:\n\n\tsage -t --long devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed\n\tsage -t --long devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed\n\tsage -t --long devel/sage/sage/lfunctions/sympow.py # 13 doctests failed\n\tsage -t --long devel/sage/sage/interfaces/qepcad.py # 3 doctests failed\n\tsage -t --long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\n```\n\nSo I think the approach on this ticket should work with a multi-user installation, but as I said earlier, I may be misunderstanding the problem.",
    "created_at": "2011-11-25T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133856",
    "user": "jhpalmieri"
}
```

I tried the following:

- build Sage ('make'), version 4.8.alpha2
- move the Sage installation and run 'sage' once, as per the multi-user installation instructions
- chmod a-w -R sage-x.y.z (so I don't have write access anymore)
- sage -tp 18 devel/sage

Almost all tests passed; the only failures were the ones reported at #5515.

```
The following tests failed:

	sage -t --long devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed
	sage -t --long devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed
	sage -t --long devel/sage/sage/lfunctions/sympow.py # 13 doctests failed
	sage -t --long devel/sage/sage/interfaces/qepcad.py # 3 doctests failed
	sage -t --long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
```

So I think the approach on this ticket should work with a multi-user installation, but as I said earlier, I may be misunderstanding the problem.



---

archive/issue_comments_133857.json:
```json
{
    "body": "Sorry not to reply immediately Jeroen but that last message was the last thing I did before getting some sleep.\n\nWhich helped clear my mind a little and take on board some comments properly. I, and am pretty sure that Mandriva does too, bypass the normal sage build system in our packages. You may have noticed the word ebuild (gentoo). So I didn't notice that you basically generated a file that was essential to start sage at the very end of the building process and outside of any spkg (that's a very crucial bit if you are packaging sage). I guess now that I have noticed and realized it is supposed to be there I could just add it and adjust the location.\n\nMy real mistake was to think it was created each time sage was launched - never mind that there is no process to remove it.",
    "created_at": "2011-11-25T18:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11754#issuecomment-133857",
    "user": "fbissey"
}
```

Sorry not to reply immediately Jeroen but that last message was the last thing I did before getting some sleep.

Which helped clear my mind a little and take on board some comments properly. I, and am pretty sure that Mandriva does too, bypass the normal sage build system in our packages. You may have noticed the word ebuild (gentoo). So I didn't notice that you basically generated a file that was essential to start sage at the very end of the building process and outside of any spkg (that's a very crucial bit if you are packaging sage). I guess now that I have noticed and realized it is supposed to be there I could just add it and adjust the location.

My real mistake was to think it was created each time sage was launched - never mind that there is no process to remove it.
