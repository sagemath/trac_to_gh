# Issue 31860: crack_given_decrypt in `Elementary Number Theory: Primes, Congruences, and Secrets` does not terminate

Issue created by migration from https://trac.sagemath.org/ticket/32097

Original creator: @kliem

Original creation time: 2021-07-02 12:39:45

CC:  was


```
sage -t --long --random-seed=9 src/sage/tests/book_stein_ent.py  # Timed out
```


The reason for the timeout is the following function:


```
sage: def crack_given_decrypt(n, m):
....:     n = Integer(n); m = Integer(m);  # some type checking
....:     # Step 1: divide out powers of 2
....:     while True:
....:         if is_odd(m): break
....:         divide_out = True
....:         for i in range(5):
....:            a = randrange(1,n)
....:            if gcd(a,n) == 1:
....:               if Mod(a,n)^(m//2) != 1:
....:                   divide_out = False
....:                   break
....:         if divide_out:
....:             m = m//2
....:         else:
....:             break
....:     # Step 2: Compute GCD
....:     while True:
....:         a = randrange(1,n)
....:         g = gcd(lift(Mod(a, n)^(m//2)) - 1, n)
....:         if g != 1 and g != n:
....:             return g
```


It does not always terminate.


```
sage: set_random_seed(0)                                                                                                                                                            
sage: e = 22601762315966221465875845336488389513                                                                                                                                    
sage: d = 31940292321834506197902778067109010093                                                                                                                                    
sage: n = 268494924039590992469444675130990465673                                                                                                                                   
sage: for _ in range(882): 
....:     p = crack_given_decrypt(n, e*d - 1) 
```


So far so good. However, the next call, will not terminate and gets stuck in step 2.
