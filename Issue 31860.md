# Issue 31860: crack_given_decrypt in `Elementary Number Theory: Primes, Congruences, and Secrets` does not terminate

archive/issues_031860.json:
```json
{
    "body": "CC:  was\n\n\n```\nsage -t --long --random-seed=9 src/sage/tests/book_stein_ent.py  # Timed out\n```\n\n\nThe reason for the timeout is the following function:\n\n\n```\nsage: def crack_given_decrypt(n, m):\n....:     n = Integer(n); m = Integer(m);  # some type checking\n....:     # Step 1: divide out powers of 2\n....:     while True:\n....:         if is_odd(m): break\n....:         divide_out = True\n....:         for i in range(5):\n....:            a = randrange(1,n)\n....:            if gcd(a,n) == 1:\n....:               if Mod(a,n)^(m//2) != 1:\n....:                   divide_out = False\n....:                   break\n....:         if divide_out:\n....:             m = m//2\n....:         else:\n....:             break\n....:     # Step 2: Compute GCD\n....:     while True:\n....:         a = randrange(1,n)\n....:         g = gcd(lift(Mod(a, n)^(m//2)) - 1, n)\n....:         if g != 1 and g != n:\n....:             return g\n```\n\n\nIt does not always terminate.\n\n\n```\nsage: set_random_seed(0)                                                                                                                                                            \nsage: e = 22601762315966221465875845336488389513                                                                                                                                    \nsage: d = 31940292321834506197902778067109010093                                                                                                                                    \nsage: n = 268494924039590992469444675130990465673                                                                                                                                   \nsage: for _ in range(882): \n....:     p = crack_given_decrypt(n, e*d - 1) \n```\n\n\nSo far so good. However, the next call, will not terminate and gets stuck in step 2.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32097\n\n",
    "created_at": "2021-07-02T12:39:45Z",
    "labels": [
        "cryptography",
        "major",
        "bug"
    ],
    "title": "crack_given_decrypt in `Elementary Number Theory: Primes, Congruences, and Secrets` does not terminate",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31860",
    "user": "@kliem"
}
```
CC:  was


```
sage -t --long --random-seed=9 src/sage/tests/book_stein_ent.py  # Timed out
```


The reason for the timeout is the following function:


```
sage: def crack_given_decrypt(n, m):
....:     n = Integer(n); m = Integer(m);  # some type checking
....:     # Step 1: divide out powers of 2
....:     while True:
....:         if is_odd(m): break
....:         divide_out = True
....:         for i in range(5):
....:            a = randrange(1,n)
....:            if gcd(a,n) == 1:
....:               if Mod(a,n)^(m//2) != 1:
....:                   divide_out = False
....:                   break
....:         if divide_out:
....:             m = m//2
....:         else:
....:             break
....:     # Step 2: Compute GCD
....:     while True:
....:         a = randrange(1,n)
....:         g = gcd(lift(Mod(a, n)^(m//2)) - 1, n)
....:         if g != 1 and g != n:
....:             return g
```


It does not always terminate.


```
sage: set_random_seed(0)                                                                                                                                                            
sage: e = 22601762315966221465875845336488389513                                                                                                                                    
sage: d = 31940292321834506197902778067109010093                                                                                                                                    
sage: n = 268494924039590992469444675130990465673                                                                                                                                   
sage: for _ in range(882): 
....:     p = crack_given_decrypt(n, e*d - 1) 
```


So far so good. However, the next call, will not terminate and gets stuck in step 2.

Issue created by migration from https://trac.sagemath.org/ticket/32097


