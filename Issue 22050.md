# Issue 22050: py3 no cmp() in some py files in modular

Issue created by migration from https://trac.sagemath.org/ticket/22287

Original creator: chapoton

Original creation time: 2017-02-01 20:33:05

CC:  tscrim aapitzsch jdemeyer

as another step to py3


---

Comment by chapoton created at 2017-02-01 20:33:46

let us wait for the bots (not checked)
----
New commits:


---

Comment by chapoton created at 2017-02-01 20:33:46

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-02-02 13:06:16

some failing doctests


---

Comment by chapoton created at 2017-02-02 13:06:16

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2017-02-02 16:43:01

general problems appearing here:

* one cannot safely replace `__cmp__` by the pair `__eq__` and `__ne__` when comparison of the objects is needed.

* therefore one would need a general mechanism (in Parent or SageObject?) siimilar to the handling of rich comparison by `__richcmp__` in cython files

specific problem: one class requires `__cmp__` from its subclasses

```
NotImplementedError: Derived class <class 'sage.modular.abvar.homology.Homology_submodule_with_category'> should implement __cmp__
```



---

Comment by git created at 2017-02-02 16:46:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2017-02-03 12:40:06

I wonder if the doctests failures are related or not..


---

Comment by chapoton created at 2017-02-05 20:00:19

green bot, please review


---

Comment by chapoton created at 2017-02-05 20:00:19

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-02-06 16:36:02

IIRC, `__cmp__` overrides rich comparisons, and so because a base class has a generic `__cmp__`, that gets called. So by changing to `_richcmp_`, it ends up going through the coercion systems `__cmp__`. At least, that is what I suspect is happening...

Here's a nifty little trick to simplify the code:

```
        b = all(self._map[g] == other._map[g]
                for g in self.parent().source().gens())
        return b == (op == op_EQ)
```

If you don't want to do it, then you can set a positive review.


---

Comment by git created at 2017-02-06 19:36:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-02-06 19:39:02

Thanks, done. I allow myself to set to positive, ok ?

Concerning the general problem that will need to be tackled elsewhere, I would like to be able to use '__richcmp__' just as in the cython files. Either just for parents and elements, or even for all SageObjects. This should be discussed on sage-devel maybe.


---

Comment by chapoton created at 2017-02-06 19:39:02

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-02-06 22:48:28

I think it would be more of removing the `__cmp__`'s that just raise an error rather than letting the usual Python framework do its thing. So I doubt that would be controversial as these errors are likely trapped by the coercion framework anyways. It might be something that we'd have to do all at once however.


---

Comment by vbraun created at 2017-02-08 00:07:48

Resolution: fixed


---

Comment by jdemeyer created at 2017-02-09 11:04:02

Breakage: #22334
