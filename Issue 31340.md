# Issue 31340: Move SAGE_ROOT/build/pkgs/{sagelib,sage_conf,sage_sws2rst,sage_docbuild}/src to SAGE_ROOT/src/pkgs/...

archive/issues_031340.json:
```json
{
    "body": "CC:  @jhpalmieri @dimpase @kiwifb\n\nIn the current layout, these embedded source trees are a little difficult to find.\n\nThe proposed location is:\n\n```\nSAGE_ROOT\n - src\n   - pkgs\n     - sage_conf\n     - sage_docbuild\n     - sage_sws2rst\n     - sagemath_standard\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31577\n\n",
    "created_at": "2021-03-29T04:50:47Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Move SAGE_ROOT/build/pkgs/{sagelib,sage_conf,sage_sws2rst,sage_docbuild}/src to SAGE_ROOT/src/pkgs/...",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31340",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jhpalmieri @dimpase @kiwifb

In the current layout, these embedded source trees are a little difficult to find.

The proposed location is:

```
SAGE_ROOT
 - src
   - pkgs
     - sage_conf
     - sage_docbuild
     - sage_sws2rst
     - sagemath_standard
```


Issue created by migration from https://trac.sagemath.org/ticket/31577





---

archive/issue_comments_447661.json:
```json
{
    "body": "Alternatively, these directories could just be put into SAGE_ROOT:\n\n```\nSAGE_ROOT\n - sage_conf\n - sage_docbuild\n - sage_sws2rst\n - sagemath_standard\n```\n",
    "created_at": "2021-03-29T15:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447661",
    "user": "https://github.com/mkoeppe"
}
```

Alternatively, these directories could just be put into SAGE_ROOT:

```
SAGE_ROOT
 - sage_conf
 - sage_docbuild
 - sage_sws2rst
 - sagemath_standard
```




---

archive/issue_comments_447662.json:
```json
{
    "body": "(made this change in the ticket description)",
    "created_at": "2021-03-30T23:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447662",
    "user": "https://github.com/mkoeppe"
}
```

(made this change in the ticket description)



---

archive/issue_comments_447663.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2021-04-12T04:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447663",
    "user": "https://github.com/mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_447664.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-04-12T04:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447664",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447665.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-04-12T04:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_447666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-12T04:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-12T05:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447667",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447668.json:
```json
{
    "body": "\n```\nsage_docbuild   -> symlinks to SAGE_ROOT/src/sage_docbuild\n```\n\nWould it make sense to reverse this: put the files in `SAGE_ROOT/sage_docbuild` and then make `SAGE_ROOT/src/sage_docbuild` into a link? Is there any reason to keep `SAGE_ROOT/src/sage_docbuild`? If so, why also create the top-level directory?\n\nWhat about `SAGE_ROOT/src/sage_setup`, along the same lines?",
    "created_at": "2021-04-12T18:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447668",
    "user": "https://github.com/jhpalmieri"
}
```


```
sage_docbuild   -> symlinks to SAGE_ROOT/src/sage_docbuild
```

Would it make sense to reverse this: put the files in `SAGE_ROOT/sage_docbuild` and then make `SAGE_ROOT/src/sage_docbuild` into a link? Is there any reason to keep `SAGE_ROOT/src/sage_docbuild`? If so, why also create the top-level directory?

What about `SAGE_ROOT/src/sage_setup`, along the same lines?



---

archive/issue_comments_447669.json:
```json
{
    "body": "This is a great question.\n\nThere is no technical reason for keeping `SAGE_ROOT/src/sage_docbuild` at all.\nLikewise, after #29847, there will be no technical reason for keeping `SAGE_ROOT/src/sage_setup`.\n\nBut in #29705, I promised not to change the structure of the source tree, which I interpret as keeping the monolithic tree `SAGE_ROOT/src` unchanged.  It is so that we don't overwhelm the developer community by making too many changes at the same time. \n\nOf course, it could be argued that `sage_docbuild` is a new name anyway, and very few people will know or care about this package.\n\nSo if you think that's better, I can just move the `sage_docbuild` sources to `SAGE_ROOT/sage_docbuild/sage_docbuild` on this ticket.\n\n(I'd rather not put reverse symlinks.)",
    "created_at": "2021-04-12T18:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447669",
    "user": "https://github.com/mkoeppe"
}
```

This is a great question.

There is no technical reason for keeping `SAGE_ROOT/src/sage_docbuild` at all.
Likewise, after #29847, there will be no technical reason for keeping `SAGE_ROOT/src/sage_setup`.

But in #29705, I promised not to change the structure of the source tree, which I interpret as keeping the monolithic tree `SAGE_ROOT/src` unchanged.  It is so that we don't overwhelm the developer community by making too many changes at the same time. 

Of course, it could be argued that `sage_docbuild` is a new name anyway, and very few people will know or care about this package.

So if you think that's better, I can just move the `sage_docbuild` sources to `SAGE_ROOT/sage_docbuild/sage_docbuild` on this ticket.

(I'd rather not put reverse symlinks.)



---

archive/issue_comments_447670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-12T19:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447670",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447671.json:
```json
{
    "body": "I will make another change, renaming the top-level directories from using underscores to using dashes. This will emphasize that these are the names of distribution packages (PyPI normalizes to dashes).",
    "created_at": "2021-04-12T19:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447671",
    "user": "https://github.com/mkoeppe"
}
```

I will make another change, renaming the top-level directories from using underscores to using dashes. This will emphasize that these are the names of distribution packages (PyPI normalizes to dashes).



---

archive/issue_comments_447672.json:
```json
{
    "body": "(This change is making the kludge that I had to add to the top-level Makefile unnecessary. The command for building `make sage_conf`, will no longer be fooled by the existence of a top-level directory of that name.)",
    "created_at": "2021-04-12T19:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447672",
    "user": "https://github.com/mkoeppe"
}
```

(This change is making the kludge that I had to add to the top-level Makefile unnecessary. The command for building `make sage_conf`, will no longer be fooled by the existence of a top-level directory of that name.)



---

archive/issue_comments_447673.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-12T19:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447673",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447674.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-12T19:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447674",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-12T19:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447675",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-12T23:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447677.json:
```json
{
    "body": "`make ptestlong` fails to run any doctests because of this error:\n\n```\nUsing --optional=build,dochtml,homebrew,pip,sage,sage_spkg\nDoctesting entire Sage library.\nTraceback (most recent call last):\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/bin/sage-runtests\", line 144, in <module>\n    err = DC.run()\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 1204, in run\n    self.expand_files_into_sources()\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 788, in expand_files_into_sources\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 788, in <listcomp>\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/sources.py\", line 528, in __init__\n    raise ValueError(\"unknown file extension %r\"%ext)\nValueError: unknown file extension ''\nmake: *** [ptestlong] Error 1\n```\n\nI believe the problem is that it trying to doctest `src/sage_docbuild`.",
    "created_at": "2021-04-13T00:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447677",
    "user": "https://github.com/jhpalmieri"
}
```

`make ptestlong` fails to run any doctests because of this error:

```
Using --optional=build,dochtml,homebrew,pip,sage,sage_spkg
Doctesting entire Sage library.
Traceback (most recent call last):
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/bin/sage-runtests", line 144, in <module>
    err = DC.run()
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/control.py", line 1204, in run
    self.expand_files_into_sources()
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/control.py", line 788, in expand_files_into_sources
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/control.py", line 788, in <listcomp>
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/local/lib/python3.9/site-packages/sage/doctest/sources.py", line 528, in __init__
    raise ValueError("unknown file extension %r"%ext)
ValueError: unknown file extension ''
make: *** [ptestlong] Error 1
```

I believe the problem is that it trying to doctest `src/sage_docbuild`.



---

archive/issue_comments_447678.json:
```json
{
    "body": "OK, I guess I have to retract my claim that there is no technical reason for having `src/sage_docbuild`. In part that's #31352 though",
    "created_at": "2021-04-13T01:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447678",
    "user": "https://github.com/mkoeppe"
}
```

OK, I guess I have to retract my claim that there is no technical reason for having `src/sage_docbuild`. In part that's #31352 though



---

archive/issue_comments_447679.json:
```json
{
    "body": "I'm currently testing this change:\n\n```diff\ndiff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\nindex afb0d6cbcf..45ec2263fb 100644\n--- a/src/sage/doctest/control.py\n+++ b/src/sage/doctest/control.py\n@@ -695,7 +695,7 @@ class DocTestController(SageObject):\n             # don't make sense to run outside a build environment\n             if have_git:\n                 self.files.append(opj(SAGE_SRC, 'sage_setup'))\n-                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n+                self.files.append(opj(SAGE_ROOT, 'sage-docbuild'))\n             self.files.append(SAGE_DOC_SRC)\n \n         if self.options.all or (self.options.new and not have_git):\n```\n",
    "created_at": "2021-04-13T01:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447679",
    "user": "https://github.com/jhpalmieri"
}
```

I'm currently testing this change:

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index afb0d6cbcf..45ec2263fb 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
@@ -695,7 +695,7 @@ class DocTestController(SageObject):
             # don't make sense to run outside a build environment
             if have_git:
                 self.files.append(opj(SAGE_SRC, 'sage_setup'))
-                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
+                self.files.append(opj(SAGE_ROOT, 'sage-docbuild'))
             self.files.append(SAGE_DOC_SRC)
 
         if self.options.all or (self.options.new and not have_git):
```




---

archive/issue_comments_447680.json:
```json
{
    "body": "I think I'd rather undo the change in 12df870 and keep it for another ticket.\n\nI think it's better to keep everything that is subject to Sage doctesting in one physical tree",
    "created_at": "2021-04-13T01:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447680",
    "user": "https://github.com/mkoeppe"
}
```

I think I'd rather undo the change in 12df870 and keep it for another ticket.

I think it's better to keep everything that is subject to Sage doctesting in one physical tree



---

archive/issue_comments_447681.json:
```json
{
    "body": "(Modularization of doctesting is a separate issue.)",
    "created_at": "2021-04-13T01:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447681",
    "user": "https://github.com/mkoeppe"
}
```

(Modularization of doctesting is a separate issue.)



---

archive/issue_comments_447682.json:
```json
{
    "body": "Replying to [comment:30 jhpalmieri]:\n> I'm currently testing this change:\n> {{{\n> #!diff\n> diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\n> index afb0d6cbcf..45ec2263fb 100644\n> --- a/src/sage/doctest/control.py\n> +++ b/src/sage/doctest/control.py\n> `@``@` -695,7 +695,7 `@``@` class DocTestController(SageObject):\n>              # don't make sense to run outside a build environment\n>              if have_git:\n>                  self.files.append(opj(SAGE_SRC, 'sage_setup'))\n> -                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n> +                self.files.append(opj(SAGE_ROOT, 'sage-docbuild'))\n>              self.files.append(SAGE_DOC_SRC)\n>  \n>          if self.options.all or (self.options.new and not have_git):\n> }}}\n\nI really don't like that kind of changes. In sage-on-distro `SAGE_SRC` becomes `SAGE_LIB` at runtime when `SAGE_ROOT` is undefined. That would break things there. Not to mention I am against introducing more `SAGE_ROOT` outside of the build system as a matter of principle. As Matthias says modularization of doctesting is a separate issue and that's what would be most appropriate there.",
    "created_at": "2021-04-13T01:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447682",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:30 jhpalmieri]:
> I'm currently testing this change:
> {{{
> #!diff
> diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
> index afb0d6cbcf..45ec2263fb 100644
> --- a/src/sage/doctest/control.py
> +++ b/src/sage/doctest/control.py
> `@``@` -695,7 +695,7 `@``@` class DocTestController(SageObject):
>              # don't make sense to run outside a build environment
>              if have_git:
>                  self.files.append(opj(SAGE_SRC, 'sage_setup'))
> -                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
> +                self.files.append(opj(SAGE_ROOT, 'sage-docbuild'))
>              self.files.append(SAGE_DOC_SRC)
>  
>          if self.options.all or (self.options.new and not have_git):
> }}}

I really don't like that kind of changes. In sage-on-distro `SAGE_SRC` becomes `SAGE_LIB` at runtime when `SAGE_ROOT` is undefined. That would break things there. Not to mention I am against introducing more `SAGE_ROOT` outside of the build system as a matter of principle. As Matthias says modularization of doctesting is a separate issue and that's what would be most appropriate there.



---

archive/issue_comments_447683.json:
```json
{
    "body": "Replying to [comment:33 fbissey]:\n> Replying to [comment:30 jhpalmieri]:\n> > I'm currently testing this change:\n> > {{{\n> > #!diff\n> > diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\n> > index afb0d6cbcf..45ec2263fb 100644\n> > --- a/src/sage/doctest/control.py\n> > +++ b/src/sage/doctest/control.py\n> > `@``@` -695,7 +695,7 `@``@` class DocTestController(SageObject):\n> >              # don't make sense to run outside a build environment\n> >              if have_git:\n> >                  self.files.append(opj(SAGE_SRC, 'sage_setup'))\n> > -                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n> > +                self.files.append(opj(SAGE_ROOT, 'sage-docbuild'))\n> >              self.files.append(SAGE_DOC_SRC)\n> >  \n> >          if self.options.all or (self.options.new and not have_git):\n> > }}}\n> \n> I really don't like that kind of changes. In sage-on-distro `SAGE_SRC` becomes `SAGE_LIB` at runtime when `SAGE_ROOT` is undefined. That would break things there. Not to mention I am against introducing more `SAGE_ROOT` outside of the build system as a matter of principle. As Matthias says modularization of doctesting is a separate issue and that's what would be most appropriate there.\n\nI think that on distros, `have_git` will be false (it tests whether `SAGE_ROOT/.git` exists), so this block, and the resulting doctests, will be skipped entirely.",
    "created_at": "2021-04-13T01:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447683",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:33 fbissey]:
> Replying to [comment:30 jhpalmieri]:
> > I'm currently testing this change:
> > {{{
> > #!diff
> > diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
> > index afb0d6cbcf..45ec2263fb 100644
> > --- a/src/sage/doctest/control.py
> > +++ b/src/sage/doctest/control.py
> > `@``@` -695,7 +695,7 `@``@` class DocTestController(SageObject):
> >              # don't make sense to run outside a build environment
> >              if have_git:
> >                  self.files.append(opj(SAGE_SRC, 'sage_setup'))
> > -                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
> > +                self.files.append(opj(SAGE_ROOT, 'sage-docbuild'))
> >              self.files.append(SAGE_DOC_SRC)
> >  
> >          if self.options.all or (self.options.new and not have_git):
> > }}}
> 
> I really don't like that kind of changes. In sage-on-distro `SAGE_SRC` becomes `SAGE_LIB` at runtime when `SAGE_ROOT` is undefined. That would break things there. Not to mention I am against introducing more `SAGE_ROOT` outside of the build system as a matter of principle. As Matthias says modularization of doctesting is a separate issue and that's what would be most appropriate there.

I think that on distros, `have_git` will be false (it tests whether `SAGE_ROOT/.git` exists), so this block, and the resulting doctests, will be skipped entirely.



---

archive/issue_comments_447684.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-04-13T01:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_447685.json:
```json
{
    "body": "You are right, it will skipped. Although technically they could be run if present.",
    "created_at": "2021-04-13T01:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447685",
    "user": "https://github.com/kiwifb"
}
```

You are right, it will skipped. Although technically they could be run if present.



---

archive/issue_comments_447686.json:
```json
{
    "body": "Nevertheless I have removed that change. Too complicated for 1 ticket.",
    "created_at": "2021-04-13T01:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447686",
    "user": "https://github.com/mkoeppe"
}
```

Nevertheless I have removed that change. Too complicated for 1 ticket.



---

archive/issue_comments_447687.json:
```json
{
    "body": "Replying to [comment:36 fbissey]:\n> You are right, it will skipped. Although technically they could be run if present.\n\nOne of the goals of that particular method is to exclude files if in a distro. I don't know enough about distros to know if the method is well-implemented, though. (I didn't write it.)\n\nSome related questions about this ticket: how does this new organization affect distros, and should we be doctesting any of the pieces that are being moved to `SAGE_ROOT`?",
    "created_at": "2021-04-13T01:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447687",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:36 fbissey]:
> You are right, it will skipped. Although technically they could be run if present.

One of the goals of that particular method is to exclude files if in a distro. I don't know enough about distros to know if the method is well-implemented, though. (I didn't write it.)

Some related questions about this ticket: how does this new organization affect distros, and should we be doctesting any of the pieces that are being moved to `SAGE_ROOT`?



---

archive/issue_comments_447688.json:
```json
{
    "body": "Replying to [comment:39 jhpalmieri]:\n> should we be doctesting any of the pieces that are being moved to `SAGE_ROOT`?\n\n`sage-sws2rst` has its own simple test script, not related to the Sage doctester.\n\nThe other packages do not have separate tests but are doctested as part of the Sage.\nThe assumption is here that the doctester is run after all of these packages are installed. This assumption would continue to hold even as the modularization goes forward. I don't really have a plan for modularizing the doctesting, other than #30778.",
    "created_at": "2021-04-13T01:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447688",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:39 jhpalmieri]:
> should we be doctesting any of the pieces that are being moved to `SAGE_ROOT`?

`sage-sws2rst` has its own simple test script, not related to the Sage doctester.

The other packages do not have separate tests but are doctested as part of the Sage.
The assumption is here that the doctester is run after all of these packages are installed. This assumption would continue to hold even as the modularization goes forward. I don't really have a plan for modularizing the doctesting, other than #30778.



---

archive/issue_comments_447689.json:
```json
{
    "body": "Replying to [comment:39 jhpalmieri]:\n> how does this new organization affect distros\n\nI would hope, not at all. All paths that were valid before are still valid afterwards thanks to the symlinks `build/pkgs/SOME_SPKG/src -> /SOME-SPKG`",
    "created_at": "2021-04-13T01:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447689",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:39 jhpalmieri]:
> how does this new organization affect distros

I would hope, not at all. All paths that were valid before are still valid afterwards thanks to the symlinks `build/pkgs/SOME_SPKG/src -> /SOME-SPKG`



---

archive/issue_comments_447690.json:
```json
{
    "body": "Replying to [comment:41 mkoeppe]:\n> Replying to [comment:39 jhpalmieri]:\n> > how does this new organization affect distros\n> \n> I would hope, not at all. All paths that were valid before are still valid afterwards thanks to the symlinks `build/pkgs/SOME_SPKG/src -> /SOME-SPKG`\n\nAs far as I am concerned, anything living under `build/pkgs/` should have a separate tarball and be installed as a separate package. This has been somewhat challenged by the way Matthias is conducting the modularization. But that's the goal at the end of the day. If it is there it is not supposed to be anything special anymore. \n\nThat being said `sage_conf` is being a pain because it is still very special as far as I can see. It still need a real SAGE_ROOT tree. But that is a different conversation and ticket.",
    "created_at": "2021-04-13T02:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447690",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:41 mkoeppe]:
> Replying to [comment:39 jhpalmieri]:
> > how does this new organization affect distros
> 
> I would hope, not at all. All paths that were valid before are still valid afterwards thanks to the symlinks `build/pkgs/SOME_SPKG/src -> /SOME-SPKG`

As far as I am concerned, anything living under `build/pkgs/` should have a separate tarball and be installed as a separate package. This has been somewhat challenged by the way Matthias is conducting the modularization. But that's the goal at the end of the day. If it is there it is not supposed to be anything special anymore. 

That being said `sage_conf` is being a pain because it is still very special as far as I can see. It still need a real SAGE_ROOT tree. But that is a different conversation and ticket.



---

archive/issue_comments_447691.json:
```json
{
    "body": "That's right, after this ticket, `SAGE_ROOT/sage-docbuild`, `SAGE_ROOT/sage-sws2rst`, `SAGE_ROOT/sagemath-standard`, and `SAGE_ROOT/sage-conf` are standard source trees of Python distribution packages, containing nothing that is specific to Sage-the-distribution. \n\nIt is possible to build sdists from each of these source trees using `setup.py sdist`, and wheels using `setup.py bdist_wheel`. \n\nActually also `sage-conf` has the same status: You can build an sdist or a wheel from it. However, this version of `sage-conf` is not useful for putting it on PyPI. #29039 and #31396 create separate versions of `sage-conf` that are suitable for distribution.",
    "created_at": "2021-04-13T02:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447691",
    "user": "https://github.com/mkoeppe"
}
```

That's right, after this ticket, `SAGE_ROOT/sage-docbuild`, `SAGE_ROOT/sage-sws2rst`, `SAGE_ROOT/sagemath-standard`, and `SAGE_ROOT/sage-conf` are standard source trees of Python distribution packages, containing nothing that is specific to Sage-the-distribution. 

It is possible to build sdists from each of these source trees using `setup.py sdist`, and wheels using `setup.py bdist_wheel`. 

Actually also `sage-conf` has the same status: You can build an sdist or a wheel from it. However, this version of `sage-conf` is not useful for putting it on PyPI. #29039 and #31396 create separate versions of `sage-conf` that are suitable for distribution.



---

archive/issue_comments_447692.json:
```json
{
    "body": "Replying to [comment:46 mkoeppe]:\n> Actually also `sage-conf` has the same status: You can build an sdist or a wheel from it. However, this version of `sage-conf` is not useful for putting it on PyPI. #29039 and #31396 create separate versions of `sage-conf` that are suitable for distribution.\n> \n\nThat's right, I had to remove a lot of stuff from the PyPI version before I could make it do the bits that would be useful to me properly as someone who build stuff from source. Considering the amount of stuff I just want to throw out, it is almost a different package altogether.",
    "created_at": "2021-04-13T02:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447692",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:46 mkoeppe]:
> Actually also `sage-conf` has the same status: You can build an sdist or a wheel from it. However, this version of `sage-conf` is not useful for putting it on PyPI. #29039 and #31396 create separate versions of `sage-conf` that are suitable for distribution.
> 

That's right, I had to remove a lot of stuff from the PyPI version before I could make it do the bits that would be useful to me properly as someone who build stuff from source. Considering the amount of stuff I just want to throw out, it is almost a different package altogether.



---

archive/issue_comments_447693.json:
```json
{
    "body": "Yes, downstream packaging is encouraged to write a separate `sage_conf` for their purposes.",
    "created_at": "2021-04-13T02:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447693",
    "user": "https://github.com/mkoeppe"
}
```

Yes, downstream packaging is encouraged to write a separate `sage_conf` for their purposes.



---

archive/issue_comments_447694.json:
```json
{
    "body": "Replying to [comment:48 mkoeppe]:\n> Yes, downstream packaging is encouraged to write a separate `sage_conf` for their purposes.\n\nBeurk. Anyway, we should have another meeting may be the next sage-days. I think there are things we should do to the design of \"those\" configuration files at large, and that could make it easier for distros in the process. I need to figure if what I think of who be easily doable python side. And it is definitely a separate conversation from this ticket.",
    "created_at": "2021-04-13T02:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447694",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:48 mkoeppe]:
> Yes, downstream packaging is encouraged to write a separate `sage_conf` for their purposes.

Beurk. Anyway, we should have another meeting may be the next sage-days. I think there are things we should do to the design of "those" configuration files at large, and that could make it easier for distros in the process. I need to figure if what I think of who be easily doable python side. And it is definitely a separate conversation from this ticket.



---

archive/issue_comments_447695.json:
```json
{
    "body": "It's really very easy: \n- You want to run our `configure` -> use one of our files which comes from configure.\n- You don't want to run `configure` -> write your `sage_conf.py` in which you hardcode your stuff.",
    "created_at": "2021-04-13T02:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447695",
    "user": "https://github.com/mkoeppe"
}
```

It's really very easy: 
- You want to run our `configure` -> use one of our files which comes from configure.
- You don't want to run `configure` -> write your `sage_conf.py` in which you hardcode your stuff.



---

archive/issue_comments_447696.json:
```json
{
    "body": "Replying to [comment:50 mkoeppe]:\n> It's really very easy: \n> - You don't want to run `configure` -> write your `sage_conf.py` in which you hardcode your stuff.\n\nThis is probably the best solution and it is also incredibly dirty once you get QA and multi-python support involved. In short this is cheap and easy if your packaging is somewhat ad hoc. Once you want this to go inside a framework with rules, there is a higher price than you may expect. \n\nBut we are getting incredibly off-topic and should stop polluting this ticket.",
    "created_at": "2021-04-13T02:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447696",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:50 mkoeppe]:
> It's really very easy: 
> - You don't want to run `configure` -> write your `sage_conf.py` in which you hardcode your stuff.

This is probably the best solution and it is also incredibly dirty once you get QA and multi-python support involved. In short this is cheap and easy if your packaging is somewhat ad hoc. Once you want this to go inside a framework with rules, there is a higher price than you may expect. 

But we are getting incredibly off-topic and should stop polluting this ticket.



---

archive/issue_comments_447697.json:
```json
{
    "body": "Yes, let's continue with this at another time and on another ticket.",
    "created_at": "2021-04-13T02:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447697",
    "user": "https://github.com/mkoeppe"
}
```

Yes, let's continue with this at another time and on another ticket.



---

archive/issue_comments_447698.json:
```json
{
    "body": "\n```\n% ./sage -t src/sage/misc/package.py \nRunning doctests with ID 2021-04-12-22-39-35-af3c76ef.\nGit branch: t/31577/move_sage_root_build_pkgs___src_to_sage_root____rename_sage_root_build_to_sage_root_sage_bootstrap\nUsing --optional=build,dochtml,homebrew,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --warn-long 125.4 --random-seed=0 src/sage/misc/package.py\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 336, in sage.misc.package.installed_packages\nFailed example:\n    installed_packages()['sage_conf']  # optional - build\nExpected:\n    'none'\nGot:\n    '9.3.rc3'\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.misc.package.installed_packages\n    [50 tests, 1 failure, 2.86 s]\n----------------------------------------------------------------------\nsage -t --warn-long 125.4 --random-seed=0 src/sage/misc/package.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2021-04-13T05:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447698",
    "user": "https://github.com/jhpalmieri"
}
```


```
% ./sage -t src/sage/misc/package.py 
Running doctests with ID 2021-04-12-22-39-35-af3c76ef.
Git branch: t/31577/move_sage_root_build_pkgs___src_to_sage_root____rename_sage_root_build_to_sage_root_sage_bootstrap
Using --optional=build,dochtml,homebrew,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --warn-long 125.4 --random-seed=0 src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 336, in sage.misc.package.installed_packages
Failed example:
    installed_packages()['sage_conf']  # optional - build
Expected:
    'none'
Got:
    '9.3.rc3'
**********************************************************************
1 item had failures:
   1 of   4 in sage.misc.package.installed_packages
    [50 tests, 1 failure, 2.86 s]
----------------------------------------------------------------------
sage -t --warn-long 125.4 --random-seed=0 src/sage/misc/package.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_447699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-13T05:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447700.json:
```json
{
    "body": "Thanks for testing!",
    "created_at": "2021-04-13T05:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447700",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for testing!



---

archive/issue_comments_447701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-13T16:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447702.json:
```json
{
    "body": "What are the files `Pipfile`, `Pipfile.m4`, etc. for? I just build Sage, and for example, `sagemath-standard/Pipfile` is currently a link pointing to a nonexistent target, and the same for `sagemath-standard/Pipfile-dist`.",
    "created_at": "2021-04-14T05:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447702",
    "user": "https://github.com/jhpalmieri"
}
```

What are the files `Pipfile`, `Pipfile.m4`, etc. for? I just build Sage, and for example, `sagemath-standard/Pipfile` is currently a link pointing to a nonexistent target, and the same for `sagemath-standard/Pipfile-dist`.



---

archive/issue_comments_447703.json:
```json
{
    "body": "If you run `./bootstrap`, the targets of these symlinks should be generated.\n\nThese files were introduced in #30913. They are not used in a normal build. They are for users who want to use https://pypi.org/project/pipenv/ to set up a virtual environment.",
    "created_at": "2021-04-14T05:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447703",
    "user": "https://github.com/mkoeppe"
}
```

If you run `./bootstrap`, the targets of these symlinks should be generated.

These files were introduced in #30913. They are not used in a normal build. They are for users who want to use https://pypi.org/project/pipenv/ to set up a virtual environment.



---

archive/issue_comments_447704.json:
```json
{
    "body": "I might prefer this in place of, or in addition to, the fixed `installed_packages()` doctest:\n\n```diff\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex e402293baf..f9a3f9fc9e 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -335,6 +335,8 @@ def installed_packages(exclude_pip=True):\n         '0.7.12'\n         sage: installed_packages()['sage_conf']  # optional - build, random\n         '9.3'\n+        sage: installed_packages()['sage_conf'] == sage.env.SAGE_VERSION # optional - build\n+        True\n \n     .. SEEALSO::\n \n```\n",
    "created_at": "2021-04-15T00:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447704",
    "user": "https://github.com/jhpalmieri"
}
```

I might prefer this in place of, or in addition to, the fixed `installed_packages()` doctest:

```diff
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index e402293baf..f9a3f9fc9e 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -335,6 +335,8 @@ def installed_packages(exclude_pip=True):
         '0.7.12'
         sage: installed_packages()['sage_conf']  # optional - build, random
         '9.3'
+        sage: installed_packages()['sage_conf'] == sage.env.SAGE_VERSION # optional - build
+        True
 
     .. SEEALSO::
 
```




---

archive/issue_comments_447705.json:
```json
{
    "body": "That's a good idea",
    "created_at": "2021-04-15T00:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447705",
    "user": "https://github.com/mkoeppe"
}
```

That's a good idea



---

archive/issue_comments_447706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-15T00:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447707.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-15T00:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447708.json:
```json
{
    "body": "Unfortunately I have a bit of trouble to make this layout work well with the tox-docker build.\n\nHow about pushing the new directories down one level, to something like `SAGE_ROOT/pkgs/sage-conf` etc.?",
    "created_at": "2021-04-15T01:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447708",
    "user": "https://github.com/mkoeppe"
}
```

Unfortunately I have a bit of trouble to make this layout work well with the tox-docker build.

How about pushing the new directories down one level, to something like `SAGE_ROOT/pkgs/sage-conf` etc.?



---

archive/issue_comments_447709.json:
```json
{
    "body": "Should the Sage source be in the same place? Or rather, should everything be in `src`? I don't know if there is any standard way to do this or any particular logic behind it.",
    "created_at": "2021-04-15T02:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447709",
    "user": "https://github.com/jhpalmieri"
}
```

Should the Sage source be in the same place? Or rather, should everything be in `src`? I don't know if there is any standard way to do this or any particular logic behind it.



---

archive/issue_comments_447710.json:
```json
{
    "body": "I don't think there is a standard for this.\n\nI initially had made it `SAGE_ROOT/src/pkgs/sage-conf` but I think it would be cleaner if `src` only contained the monolithic Sage library.",
    "created_at": "2021-04-15T03:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447710",
    "user": "https://github.com/mkoeppe"
}
```

I don't think there is a standard for this.

I initially had made it `SAGE_ROOT/src/pkgs/sage-conf` but I think it would be cleaner if `src` only contained the monolithic Sage library.



---

archive/issue_comments_447711.json:
```json
{
    "body": "Then sure, `SAGE_ROOT/pkgs/sage-conf` sounds good.",
    "created_at": "2021-04-15T04:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447711",
    "user": "https://github.com/jhpalmieri"
}
```

Then sure, `SAGE_ROOT/pkgs/sage-conf` sounds good.



---

archive/issue_comments_447712.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-22T16:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447712",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-06-24T23:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_447714.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T00:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-06-25T00:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_447716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T00:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447717.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-25T00:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447717",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447718.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T01:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447719.json:
```json
{
    "body": "Looks good.",
    "created_at": "2021-06-25T19:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447719",
    "user": "https://github.com/dimpase"
}
```

Looks good.



---

archive/issue_comments_447720.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-25T19:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447720",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447721.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-06-25T19:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447721",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_447722.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-29T17:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447722",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_447723.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-06-29T17:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447723",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_447724.json:
```json
{
    "body": "Merges cleanly with af326a8c9a (vbraun/develop)",
    "created_at": "2021-06-29T21:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447724",
    "user": "https://github.com/mkoeppe"
}
```

Merges cleanly with af326a8c9a (vbraun/develop)



---

archive/issue_comments_447725.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-06-29T21:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447725",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_447726.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-29T23:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447726",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_447727.json:
```json
{
    "body": "then wait for the next beta",
    "created_at": "2021-06-29T23:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447727",
    "user": "https://github.com/vbraun"
}
```

then wait for the next beta



---

archive/issue_comments_447728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-01T22:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447729.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-07-01T22:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447729",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_447730.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-06T21:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447730",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_447731.json:
```json
{
    "body": "whats going on here?\n\n```\n    STDOUT: CONFLICT (directory/file): There is a directory with name build/pkgs/sagelib/src in HEAD. Adding build/pkgs/sagelib/src as build/pkgs/sagelib/src~7568dc6dc7a2325525aaa4618ec1bc0bc417917b\n    STDOUT: Removing build/pkgs/sage_sws2rst/src/sage_sws2rst/__init__.py\n    STDOUT: Adding build/pkgs/sage_sws2rst/src\n    STDOUT: Removing build/pkgs/sage_docbuild/src/sage_docbuild\n    STDOUT: Removing build/pkgs/sage_docbuild/src/VERSION.txt\n    STDOUT: CONFLICT (directory/file): There is a directory with name build/pkgs/sage_docbuild/src in HEAD. Adding build/pkgs/sage_docbuild/src as build/pkgs/sage_docbuild/src~7568dc6dc7a2325525aaa4618ec1bc0bc417917b\n    STDOUT: Removing build/pkgs/sage_conf/src/bin/sage-env-config\n    STDOUT: Removing build/pkgs/sage_conf/src/README.rst\n    STDOUT: CONFLICT (directory/file): There is a directory with name build/pkgs/sage_conf/src in HEAD. Adding build/pkgs/sage_conf/src as build/pkgs/sage_conf/src~7568dc6dc7a2325525aaa4618ec1bc0bc417917b\n    STDOUT: Auto-merging build/bin/write-dockerfile.sh\n    STDOUT: Automatic merge failed; fix conflicts and then commit the result.\n[release@zen Sage]$ git --version\ngit version 2.31.1\n```\n",
    "created_at": "2021-07-06T21:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447731",
    "user": "https://github.com/vbraun"
}
```

whats going on here?

```
    STDOUT: CONFLICT (directory/file): There is a directory with name build/pkgs/sagelib/src in HEAD. Adding build/pkgs/sagelib/src as build/pkgs/sagelib/src~7568dc6dc7a2325525aaa4618ec1bc0bc417917b
    STDOUT: Removing build/pkgs/sage_sws2rst/src/sage_sws2rst/__init__.py
    STDOUT: Adding build/pkgs/sage_sws2rst/src
    STDOUT: Removing build/pkgs/sage_docbuild/src/sage_docbuild
    STDOUT: Removing build/pkgs/sage_docbuild/src/VERSION.txt
    STDOUT: CONFLICT (directory/file): There is a directory with name build/pkgs/sage_docbuild/src in HEAD. Adding build/pkgs/sage_docbuild/src as build/pkgs/sage_docbuild/src~7568dc6dc7a2325525aaa4618ec1bc0bc417917b
    STDOUT: Removing build/pkgs/sage_conf/src/bin/sage-env-config
    STDOUT: Removing build/pkgs/sage_conf/src/README.rst
    STDOUT: CONFLICT (directory/file): There is a directory with name build/pkgs/sage_conf/src in HEAD. Adding build/pkgs/sage_conf/src as build/pkgs/sage_conf/src~7568dc6dc7a2325525aaa4618ec1bc0bc417917b
    STDOUT: Auto-merging build/bin/write-dockerfile.sh
    STDOUT: Automatic merge failed; fix conflicts and then commit the result.
[release@zen Sage]$ git --version
git version 2.31.1
```




---

archive/issue_comments_447732.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-07-06T21:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447732",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_447733.json:
```json
{
    "body": "ok those were previously not-checked in build artifacts",
    "created_at": "2021-07-06T21:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447733",
    "user": "https://github.com/vbraun"
}
```

ok those were previously not-checked in build artifacts



---

archive/issue_comments_447734.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-09T20:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31340#issuecomment-447734",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
