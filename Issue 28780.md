# Issue 28780: Coercion map to a quotient of a polynomial ring has incorrect parent

Issue created by migration from https://trac.sagemath.org/ticket/29017

Original creator: pbruin

Original creation time: 2020-01-15 14:27:32

Keywords: quotient ring, homset

In SageMath 9.1.beta0:

```
sage: R.<x> = ZZ[]
sage: Q = R.quo(x - 1)
sage: H = R.Hom(Q); H
Set of Homomorphisms from Univariate Polynomial Ring in x over Integer Ring to Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
sage: h = R.hom(Q); h
Coercion map:
  From: Univariate Polynomial Ring in x over Integer Ring
  To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
sage: h.parent()
Set of Homomorphisms from Univariate Polynomial Ring in x over Integer Ring to Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
```

The parent of `h` seems to be `H` at first sight.  However:

```
sage: h in H
False
sage: h.parent() == H
False
```

One can convert `h` to an element of `H`, but the result is bizarre:

```
sage: H(h)
Composite map:
  From: Univariate Polynomial Ring in x over Integer Ring
  To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
  Defn:   Identity endomorphism of Univariate Polynomial Ring in x over Integer Ring
        then
          Coercion map:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
        then
          Identity endomorphism of Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
```




---

Comment by tscrim created at 2020-01-16 04:36:08

Another symptom is the categories of the respect homspaces not agreeing:

```
sage: H.category()
Category of homsets of unital magmas and additive unital additive magmas
sage: h.parent().category()
Category of homsets of unital magmas and right modules over (euclidean domains and infinite enumerated sets and metric spaces) and left modules over (euclidean domains and infinite enumerated sets and metric spaces)
```

This is why the homsets are not the same, but I don't know what is causing this.


---

Comment by tscrim created at 2020-01-16 04:44:57

So the issue comes down to the fact that the coercion map from `R -> Q` is in the bigger category (which is not detected by default). More specifically, it comes from this line in `Q._coerce_map_from_`:

```
parent = Hom(R, self, category=self.category()._meet_(R.category()))
```

which the category part is

```
sage: Q.category()._meet_(R.category())
Category of commutative no zero divisors algebras over (euclidean domains and infinite enumerated sets and metric spaces)
```

However, if we reverse it, we get

```
sage: R.category()._meet_(Q.category())
Category of integral domains
```

So something is going wrong. My guess is it comes from the parameterization of the quotient ring's category:

```
sage: R.category()
Join of Category of unique factorization domains and Category of commutative algebras over (euclidean domains and infinite enumerated sets and metric spaces) and Category of infinite sets
sage: Q.category()
Category of commutative no zero divisors quotients of algebras over Integer Ring
```



---

Comment by tscrim created at 2020-01-16 04:54:38

Changing status from new to needs_review.


---

Comment by tscrim created at 2020-01-16 04:54:38

Yep, the problem was exactly as I was suspecting. I don't think we ever implemented anything that properly category-meets together parameterized categories. This is a bit of a hack solution rather than a proper one, but it is something we should do anyways in line with other polynomial rings.
----
New commits:


---

Comment by pbruin created at 2020-01-16 13:00:39

Changing status from needs_review to positive_review.


---

Comment by pbruin created at 2020-01-16 13:00:39

Looks good.  Your patch makes the category of `Q` more consistent with that of `R`, and fixes the bug.  Mathematically speaking, I think it would be nice if `Q` were in the more specific category of *Z*-algebras or even `R`-algebras, but this should do for now.


---

Comment by vbraun created at 2020-01-20 21:18:00

Resolution: fixed
