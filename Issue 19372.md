# Issue 19372: Added image and kernel methods to morphisms of finite-dimensional modules with basis

archive/issues_019372.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat @nthiery @darijgr @avirmaux simonking\n\nKeywords: kernel, image, module morphism\n\nIt is useful to have these, and we can do these at the category level.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19609\n\n",
    "created_at": "2015-11-21T03:03:36Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Added image and kernel methods to morphisms of finite-dimensional modules with basis",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19372",
    "user": "@tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat @nthiery @darijgr @avirmaux simonking

Keywords: kernel, image, module morphism

It is useful to have these, and we can do these at the category level.

Issue created by migration from https://trac.sagemath.org/ticket/19609





---

archive/issue_comments_266136.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-11-21T03:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266136",
    "user": "@tscrim"
}
```

New commits:



---

archive/issue_comments_266137.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-21T03:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266137",
    "user": "@tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_266138.json:
```json
{
    "body": "It is definitely very usefull!\nJust a few (maybe useless) remarks. The basis method usually returns a Family (Finite, Lazy or ...), may we want to do the same for the kernel instead of a tuple?\nAlso, we may want to document the choice of right kernel versus left kernel.",
    "created_at": "2015-11-21T10:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266138",
    "user": "@avirmaux"
}
```

It is definitely very usefull!
Just a few (maybe useless) remarks. The basis method usually returns a Family (Finite, Lazy or ...), may we want to do the same for the kernel instead of a tuple?
Also, we may want to document the choice of right kernel versus left kernel.



---

archive/issue_comments_266139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-21T16:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266139",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266140.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-21T17:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266140",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266141.json:
```json
{
    "body": "Replying to [comment:2 virmaux]:\n> It is definitely very usefull!\n> Just a few (maybe useless) remarks. The basis method usually returns a Family (Finite, Lazy or ...), may we want to do the same for the kernel instead of a tuple?\n\nAll of the other `*_basis` (like `radical_basis`) returned lists. I changed these to tuples because the output is cached (so should be immutable) and for consistency.\n\nThere was also an issue that I could not use cached methods on the morphisms because the equality test used `__dict__`. However, I decided to not make the results cached because if the basis order changed, then one can get different bases for the kernel/image, which may be desirable.\n\n> Also, we may want to document the choice of right kernel versus left kernel.\n\nI think there is only the right kernel because I chose to use the right matrix version and there is no ambiguity. Perhaps I'm not thinking of something...",
    "created_at": "2015-11-21T17:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266141",
    "user": "@tscrim"
}
```

Replying to [comment:2 virmaux]:
> It is definitely very usefull!
> Just a few (maybe useless) remarks. The basis method usually returns a Family (Finite, Lazy or ...), may we want to do the same for the kernel instead of a tuple?

All of the other `*_basis` (like `radical_basis`) returned lists. I changed these to tuples because the output is cached (so should be immutable) and for consistency.

There was also an issue that I could not use cached methods on the morphisms because the equality test used `__dict__`. However, I decided to not make the results cached because if the basis order changed, then one can get different bases for the kernel/image, which may be desirable.

> Also, we may want to document the choice of right kernel versus left kernel.

I think there is only the right kernel because I chose to use the right matrix version and there is no ambiguity. Perhaps I'm not thinking of something...



---

archive/issue_comments_266142.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> I think there is only the right kernel because I chose to use the right matrix version and there is no ambiguity. Perhaps I'm not thinking of something...\n\nMaybe saying it in the documentation; I often check the code to know whether it is done on the right or left :P",
    "created_at": "2015-11-21T23:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266142",
    "user": "@avirmaux"
}
```

Replying to [comment:5 tscrim]:
> I think there is only the right kernel because I chose to use the right matrix version and there is no ambiguity. Perhaps I'm not thinking of something...

Maybe saying it in the documentation; I often check the code to know whether it is done on the right or left :P



---

archive/issue_comments_266143.json:
```json
{
    "body": "Replying to [comment:6 virmaux]:\n> Replying to [comment:5 tscrim]:\n> > I think there is only the right kernel because I chose to use the right matrix version and there is no ambiguity. Perhaps I'm not thinking of something...\n> \n> Maybe saying it in the documentation; I often check the code to know whether it is done on the right or left :P\n\nI guess that wasn't very clear. What I meant to say is that there is no right vs left because, obstinately, there is no matrix and the kernel is well defined in terms of the morphism. Also, for matrices, the left version would be the kernel of the dual map (under the convention that vector spaces are represented by column vectors). So I'm not sure what you would want me to say in the doc.",
    "created_at": "2015-11-22T04:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266143",
    "user": "@tscrim"
}
```

Replying to [comment:6 virmaux]:
> Replying to [comment:5 tscrim]:
> > I think there is only the right kernel because I chose to use the right matrix version and there is no ambiguity. Perhaps I'm not thinking of something...
> 
> Maybe saying it in the documentation; I often check the code to know whether it is done on the right or left :P

I guess that wasn't very clear. What I meant to say is that there is no right vs left because, obstinately, there is no matrix and the kernel is well defined in terms of the morphism. Also, for matrices, the left version would be the kernel of the dual map (under the convention that vector spaces are represented by column vectors). So I'm not sure what you would want me to say in the doc.



---

archive/issue_comments_266144.json:
```json
{
    "body": "Indeed, forget what I said before then, I don't see any problem anymore.",
    "created_at": "2015-11-29T18:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266144",
    "user": "@avirmaux"
}
```

Indeed, forget what I said before then, I don't see any problem anymore.



---

archive/issue_comments_266145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-28T01:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266145",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266146.json:
```json
{
    "body": "Travis, could you explain your `__eq__` methods? Are they intended to fix some issues where e.g. module morphisms were claimed to be equal because they matched on algebra generators?\n\n(I've reviewed the other edits, although arguably the `__eq__` ones are the main part of the branch.)",
    "created_at": "2015-12-28T01:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266146",
    "user": "@darijgr"
}
```

Travis, could you explain your `__eq__` methods? Are they intended to fix some issues where e.g. module morphisms were claimed to be equal because they matched on algebra generators?

(I've reviewed the other edits, although arguably the `__eq__` ones are the main part of the branch.)



---

archive/issue_comments_266147.json:
```json
{
    "body": "Replying to [comment:10 darij]:\n> Travis, could you explain your `__eq__` methods? Are they intended to fix some issues where e.g. module morphisms were claimed to be equal because they matched on algebra generators?\n\nI expanded out the `__dict__` comparison. I had at one point used a ``@`cached_method` for the kernel basis, which adds stuff to the `__dict__` and causes problems because of this. (However, because this might depend on the basis order, I decided to make it non-cached.)",
    "created_at": "2015-12-28T04:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266147",
    "user": "@tscrim"
}
```

Replying to [comment:10 darij]:
> Travis, could you explain your `__eq__` methods? Are they intended to fix some issues where e.g. module morphisms were claimed to be equal because they matched on algebra generators?

I expanded out the `__dict__` comparison. I had at one point used a ``@`cached_method` for the kernel basis, which adds stuff to the `__dict__` and causes problems because of this. (However, because this might depend on the basis order, I decided to make it non-cached.)



---

archive/issue_comments_266148.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-28T16:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266148",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266149.json:
```json
{
    "body": "Hmm, I'm not sure I'm happy with this -- but once again, this seems to be a Sage design flaw, not an error of your branch. Now that we are overriding `__eq__`, everyone implementing a new class of module morphism will have to override `__eq__` as well or risk distinct morphisms comparing as equal. Maybe we should also compare `on_basis()` and `_inverse` on triangular module morphisms?\n\nNicolas, Simon, or whoever else understands these matters: any chance you could look over the `__eq__` definitions?\n\nThe rest of the code LGTMs to me.",
    "created_at": "2015-12-28T16:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266149",
    "user": "@darijgr"
}
```

Hmm, I'm not sure I'm happy with this -- but once again, this seems to be a Sage design flaw, not an error of your branch. Now that we are overriding `__eq__`, everyone implementing a new class of module morphism will have to override `__eq__` as well or risk distinct morphisms comparing as equal. Maybe we should also compare `on_basis()` and `_inverse` on triangular module morphisms?

Nicolas, Simon, or whoever else understands these matters: any chance you could look over the `__eq__` definitions?

The rest of the code LGTMs to me.



---

archive/issue_comments_266150.json:
```json
{
    "body": "Replying to [comment:13 darij]:\n> Hmm, I'm not sure I'm happy with this -- but once again, this seems to be a Sage design flaw, not an error of your branch. Now that we are overriding `__eq__`, everyone implementing a new class of module morphism will have to override `__eq__` as well or risk distinct morphisms comparing as equal.\n\nThat is how you should write code in good OOP, inherit and use the parent class methods and override if necessary. I certainly understand why comparing the `__dict__` was done and it was a good solution at the time.\n\n> Maybe we should also compare `on_basis()` and `_inverse` on triangular module morphisms?\n\n`_inverse` is completely dependent on the other attributes, so I think that is a wasted test. However, the current inheritance scheme does not explicitly have an `on_basis` in `TriangularModuleMorphism`. Strictly speaking, I'm not opposed to doing this, but by the current class hierarchy, it would get double-checked because `TriangularModuleMorphism` is an ABC and the actual concrete implementations will end up checking that. So on that, I would say your test:\n\n```\nTriangularModuleMorphism.__eq__(phi, phi2) # I don't like this :/\n```\n\nis misleading. It is the correct result because as far as that class is concerned, they are equal (in fact, IMO the call to `on_basis` in the `__init__` should be moved into the `if inverse_on_support == \"compute\":` block since that is the only place it is used).\n\nActually, it might be better to remove the inheritance from `ModuleMorphism` and have `TriangularModuleMorphism` as a mixin class. However all of this should be on a separate ticket. I can also split the `__eq__` part off to said ticket as it is not needed for the features I was originally after.\n\n> Nicolas, Simon, or whoever else understands these matters: any chance you could look over the `__eq__` definitions?\n\nI would appreciate your (Nicolas and/or Simon) comments on these classes and what you think we should do moving forward. On a somewhat related question, do you think we should spend time to Cythonize these classes?",
    "created_at": "2015-12-28T17:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266150",
    "user": "@tscrim"
}
```

Replying to [comment:13 darij]:
> Hmm, I'm not sure I'm happy with this -- but once again, this seems to be a Sage design flaw, not an error of your branch. Now that we are overriding `__eq__`, everyone implementing a new class of module morphism will have to override `__eq__` as well or risk distinct morphisms comparing as equal.

That is how you should write code in good OOP, inherit and use the parent class methods and override if necessary. I certainly understand why comparing the `__dict__` was done and it was a good solution at the time.

> Maybe we should also compare `on_basis()` and `_inverse` on triangular module morphisms?

`_inverse` is completely dependent on the other attributes, so I think that is a wasted test. However, the current inheritance scheme does not explicitly have an `on_basis` in `TriangularModuleMorphism`. Strictly speaking, I'm not opposed to doing this, but by the current class hierarchy, it would get double-checked because `TriangularModuleMorphism` is an ABC and the actual concrete implementations will end up checking that. So on that, I would say your test:

```
TriangularModuleMorphism.__eq__(phi, phi2) # I don't like this :/
```

is misleading. It is the correct result because as far as that class is concerned, they are equal (in fact, IMO the call to `on_basis` in the `__init__` should be moved into the `if inverse_on_support == "compute":` block since that is the only place it is used).

Actually, it might be better to remove the inheritance from `ModuleMorphism` and have `TriangularModuleMorphism` as a mixin class. However all of this should be on a separate ticket. I can also split the `__eq__` part off to said ticket as it is not needed for the features I was originally after.

> Nicolas, Simon, or whoever else understands these matters: any chance you could look over the `__eq__` definitions?

I would appreciate your (Nicolas and/or Simon) comments on these classes and what you think we should do moving forward. On a somewhat related question, do you think we should spend time to Cythonize these classes?



---

archive/issue_comments_266151.json:
```json
{
    "body": "Oops, I forgot to CC Simon!\n\nI am OK with splitting this ticket into two -- if your `__eq__` changes are not necessary for the image and kernel, then there isn't much reason for them to be together. I can't really make a judgment call on the `__eq__`, so this issue will keep me from finishing the review for as long as the ticket stays joined; but if Nicolas, Simon or someone else from the OOP department steps in to finish the review, that won't be an issue.",
    "created_at": "2015-12-28T17:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266151",
    "user": "@darijgr"
}
```

Oops, I forgot to CC Simon!

I am OK with splitting this ticket into two -- if your `__eq__` changes are not necessary for the image and kernel, then there isn't much reason for them to be together. I can't really make a judgment call on the `__eq__`, so this issue will keep me from finishing the review for as long as the ticket stays joined; but if Nicolas, Simon or someone else from the OOP department steps in to finish the review, that won't be an issue.



---

archive/issue_comments_266152.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-01T23:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266152",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266153.json:
```json
{
    "body": "I've split off the `__eq__` to #19820. So can I take comment:15 as a positive review?",
    "created_at": "2016-01-01T23:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266153",
    "user": "@tscrim"
}
```

I've split off the `__eq__` to #19820. So can I take comment:15 as a positive review?



---

archive/issue_comments_266154.json:
```json
{
    "body": "Yes!",
    "created_at": "2016-01-01T23:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266154",
    "user": "@darijgr"
}
```

Yes!



---

archive/issue_comments_266155.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-01T23:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266155",
    "user": "@darijgr"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_266156.json:
```json
{
    "body": "(Provided that my code LGTYs.)",
    "created_at": "2016-01-01T23:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266156",
    "user": "@darijgr"
}
```

(Provided that my code LGTYs.)



---

archive/issue_comments_266157.json:
```json
{
    "body": "Reviewer name missing",
    "created_at": "2016-01-01T23:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266157",
    "user": "@vbraun"
}
```

Reviewer name missing



---

archive/issue_comments_266158.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-01-01T23:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266158",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_266159.json:
```json
{
    "body": "OK, Travis, can you add our both names if you agree to my changes?",
    "created_at": "2016-01-02T00:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266159",
    "user": "@darijgr"
}
```

OK, Travis, can you add our both names if you agree to my changes?



---

archive/issue_comments_266160.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2016-01-02T01:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266160",
    "user": "@tscrim"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_266161.json:
```json
{
    "body": "Did you push changes to this part of the ticket? The only commit I saw was to the doctests of the `__eq__`.",
    "created_at": "2016-01-02T01:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266161",
    "user": "@tscrim"
}
```

Did you push changes to this part of the ticket? The only commit I saw was to the doctests of the `__eq__`.



---

archive/issue_comments_266162.json:
```json
{
    "body": "I did, though only a few lines of code were changed (see http://git.sagemath.org/sage.git/log/?q=036455fd4defbb003152bf283af3a629b9c49324..13d988bc57a5bc7f4ea7cb1edc64db6dc1c8cdb2&h=13d988bc57a5bc7f4ea7cb1edc64db6dc1c8cdb2&qt=range ).",
    "created_at": "2016-01-02T01:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266162",
    "user": "@darijgr"
}
```

I did, though only a few lines of code were changed (see http://git.sagemath.org/sage.git/log/?q=036455fd4defbb003152bf283af3a629b9c49324..13d988bc57a5bc7f4ea7cb1edc64db6dc1c8cdb2&h=13d988bc57a5bc7f4ea7cb1edc64db6dc1c8cdb2&qt=range ).



---

archive/issue_comments_266163.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2016-01-02T02:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266163",
    "user": "@tscrim"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_266164.json:
```json
{
    "body": "Ah right. :P Thanks! Then back to positive review.",
    "created_at": "2016-01-02T02:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266164",
    "user": "@tscrim"
}
```

Ah right. :P Thanks! Then back to positive review.



---

archive/issue_comments_266165.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-02T19:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19372#issuecomment-266165",
    "user": "@vbraun"
}
```

Resolution: fixed
