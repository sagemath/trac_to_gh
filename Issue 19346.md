# Issue 19346: random triangulation as simplicial complex

archive/issues_019346.json:
```json
{
    "body": "CC:  @nathanncohen\n\nKeywords: random simplicial complex\n\nAfter #19520, let us now create the same random triangulations of the sphere of dimensions 2 as simplicial complexes. This will allow to take their flip graph.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19583\n\n",
    "created_at": "2015-11-13T14:39:45Z",
    "labels": [
        "algebraic topology",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "random triangulation as simplicial complex",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19346",
    "user": "@fchapoton"
}
```
CC:  @nathanncohen

Keywords: random simplicial complex

After #19520, let us now create the same random triangulations of the sphere of dimensions 2 as simplicial complexes. This will allow to take their flip graph.

Issue created by migration from https://trac.sagemath.org/ticket/19583





---

archive/issue_comments_265610.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-11-13T14:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265610",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_265611.json:
```json
{
    "body": "Err... Are you building the graph of [maximal cliques/faces] of the random triangulation? The code is awfully similar to what appeared in #19520.\n\nNathann",
    "created_at": "2015-11-13T14:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265611",
    "user": "@nathanncohen"
}
```

Err... Are you building the graph of [maximal cliques/faces] of the random triangulation? The code is awfully similar to what appeared in #19520.

Nathann



---

archive/issue_comments_265612.json:
```json
{
    "body": "No, no, because the random triangulation, as a graph, has many more triangles and has even larger cliques. Some information is lost there, which is exactly the data of the triangles which are really triangles.",
    "created_at": "2015-11-13T16:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265612",
    "user": "@fchapoton"
}
```

No, no, because the random triangulation, as a graph, has many more triangles and has even larger cliques. Some information is lost there, which is exactly the data of the triangles which are really triangles.



---

archive/issue_comments_265613.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-14T09:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265613",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265614.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-14T09:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265614",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265615.json:
```json
{
    "body": "Do you think that it could be complicated to modify `RandomTriangulation` to build a combinatorial embedding while the graph is being built? This way we could get the data that you want with a call to `.faces()`.\n----\nNew commits:",
    "created_at": "2015-11-14T09:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265615",
    "user": "@nathanncohen"
}
```

Do you think that it could be complicated to modify `RandomTriangulation` to build a combinatorial embedding while the graph is being built? This way we could get the data that you want with a call to `.faces()`.
----
New commits:



---

archive/issue_comments_265616.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-14T09:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265616",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265617.json:
```json
{
    "body": "(or, alternatively, could a call to `.is_planar(set_embedding=True)/.faces()` do the trick? Or is that too slow?)\n\nNathann",
    "created_at": "2015-11-14T09:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265617",
    "user": "@nathanncohen"
}
```

(or, alternatively, could a call to `.is_planar(set_embedding=True)/.faces()` do the trick? Or is that too slow?)

Nathann



---

archive/issue_comments_265618.json:
```json
{
    "body": "* modifying the code in #19520 to manage the embedding seems difficult (by the lack of a proper class for planar graphs, as I have said before). I would love to, and maybe will need too, but this will be hard.\n\n* the 'is_planar' is much too slow, and is in fact re-building by brute force the embedding we should already know.\n\n* one option would be to drop the code in #19520 and get the edge graph from the code here. I would prefer not to. This is just a little code duplication, do you really mind ?\n\n* I still have other projects in the same vein..",
    "created_at": "2015-11-14T09:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265618",
    "user": "@fchapoton"
}
```

* modifying the code in #19520 to manage the embedding seems difficult (by the lack of a proper class for planar graphs, as I have said before). I would love to, and maybe will need too, but this will be hard.

* the 'is_planar' is much too slow, and is in fact re-building by brute force the embedding we should already know.

* one option would be to drop the code in #19520 and get the edge graph from the code here. I would prefer not to. This is just a little code duplication, do you really mind ?

* I still have other projects in the same vein..



---

archive/issue_comments_265619.json:
```json
{
    "body": "> * modifying the code in #19520 to manage the embedding seems difficult (by the lack of a proper class for planar graphs, as I have said before). I would love to, and maybe will need too, but this will be hard.\n\nYou can easily manage embeddings right now, with get/set_embedding. All you need to know is the order of the neighbours of every vertex 'v'. Don't we have this information when building the graph? \n\n> * the 'is_planar' is much too slow, and is in fact re-building by brute force the embedding we should already know.\n\nOkay.\n\n> * one option would be to drop the code in #19520 and get the edge graph from the code here. I would prefer no too. This is just a little code duplication, do you really mind ?\n\nI don't mind if there is no way around it, and if there is an easy way out I prefer it.\n\n> * I still have other projects in the same vein..\n\nDo you plan a third copy/paste because of some information that you cannot find from the function you implement here? `:-P`\n\nNathann",
    "created_at": "2015-11-14T09:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265619",
    "user": "@nathanncohen"
}
```

> * modifying the code in #19520 to manage the embedding seems difficult (by the lack of a proper class for planar graphs, as I have said before). I would love to, and maybe will need too, but this will be hard.

You can easily manage embeddings right now, with get/set_embedding. All you need to know is the order of the neighbours of every vertex 'v'. Don't we have this information when building the graph? 

> * the 'is_planar' is much too slow, and is in fact re-building by brute force the embedding we should already know.

Okay.

> * one option would be to drop the code in #19520 and get the edge graph from the code here. I would prefer no too. This is just a little code duplication, do you really mind ?

I don't mind if there is no way around it, and if there is an easy way out I prefer it.

> * I still have other projects in the same vein..

Do you plan a third copy/paste because of some information that you cannot find from the function you implement here? `:-P`

Nathann



---

archive/issue_comments_265620.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-30T19:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265620",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265621.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-01T08:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265621",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265622.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-01T08:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265622",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_265623.json:
```json
{
    "body": "If you want a review from me you will have to answer [comment:10] first.",
    "created_at": "2015-12-01T08:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265623",
    "user": "@nathanncohen"
}
```

If you want a review from me you will have to answer [comment:10] first.



---

archive/issue_comments_265624.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> > * modifying the code in #19520 to manage the embedding seems difficult (by the lack of a proper class for planar graphs, as I have said before). I would love to, and maybe will need too, but this will be hard.\n> \n> You can easily manage embeddings right now, with get/set_embedding. All you need to know is the order of the neighbours of every vertex 'v'. Don't we have this information when building the graph? \n\nI think it would not be easy to manage the embedding in the rotate-and-close algo. Every single edge addition would have to do a lot of job to do to change the embedding.\n\n> > * one option would be to drop the code in #19520 and get the edge graph from the code here. I would prefer no too. This is just a little code duplication, do you really mind ?\n> \n> I don't mind if there is no way around it, and if there is an easy way out I prefer it.\n\nok. If you insist on no-code-duplication, as I said, one can get the graph from the simplicial complex, maybe at the prize of some (big?) speed loss.\n\n> > * I still have other projects in the same vein..\n> \n> Do you plan a third copy/paste because of some information that you cannot find from the function you implement here? `:-P`\n\nCould well be. My aim is to build a random interval in the Tamari lattices. For this I have to\nobtain a random minimal Schnyder wood. For the moment, this is only a project, so I cannot\nsay right now how much code I will re-use.",
    "created_at": "2015-12-03T00:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265624",
    "user": "@fchapoton"
}
```

Replying to [comment:10 ncohen]:
> > * modifying the code in #19520 to manage the embedding seems difficult (by the lack of a proper class for planar graphs, as I have said before). I would love to, and maybe will need too, but this will be hard.
> 
> You can easily manage embeddings right now, with get/set_embedding. All you need to know is the order of the neighbours of every vertex 'v'. Don't we have this information when building the graph? 

I think it would not be easy to manage the embedding in the rotate-and-close algo. Every single edge addition would have to do a lot of job to do to change the embedding.

> > * one option would be to drop the code in #19520 and get the edge graph from the code here. I would prefer no too. This is just a little code duplication, do you really mind ?
> 
> I don't mind if there is no way around it, and if there is an easy way out I prefer it.

ok. If you insist on no-code-duplication, as I said, one can get the graph from the simplicial complex, maybe at the prize of some (big?) speed loss.

> > * I still have other projects in the same vein..
> 
> Do you plan a third copy/paste because of some information that you cannot find from the function you implement here? `:-P`

Could well be. My aim is to build a random interval in the Tamari lattices. For this I have to
obtain a random minimal Schnyder wood. For the moment, this is only a project, so I cannot
say right now how much code I will re-use.



---

archive/issue_comments_265625.json:
```json
{
    "body": "Hello,\n\n> I think it would not be easy to manage the embedding in the rotate-and-close algo. Every single edge addition would have to do a lot of job to do to change the embedding.\n\nIn Sage, the embedding is represented by a list associated to each vertex. Given the picture  have in mind of the algorithm (though perhaps it is wrong) the algorithm starts from a tree and keeps adding edges, each of which is, when it is added, on the outer face.\n\nI wonder if when adding edge uv, it does not boil down to adding v at the end of u's list, and adding u at the beginning of v's list.\n\nAnd something slightly more specific for a and b.\n\n> ok. If you insist on no-code-duplication, as I said, one can get the graph from the simplicial complex, maybe at the prize of some (big?) speed loss.\n\nA big speed loss is a good justification for code duplication.\n\nNathann",
    "created_at": "2015-12-03T09:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265625",
    "user": "@nathanncohen"
}
```

Hello,

> I think it would not be easy to manage the embedding in the rotate-and-close algo. Every single edge addition would have to do a lot of job to do to change the embedding.

In Sage, the embedding is represented by a list associated to each vertex. Given the picture  have in mind of the algorithm (though perhaps it is wrong) the algorithm starts from a tree and keeps adding edges, each of which is, when it is added, on the outer face.

I wonder if when adding edge uv, it does not boil down to adding v at the end of u's list, and adding u at the beginning of v's list.

And something slightly more specific for a and b.

> ok. If you insist on no-code-duplication, as I said, one can get the graph from the simplicial complex, maybe at the prize of some (big?) speed loss.

A big speed loss is a good justification for code duplication.

Nathann



---

archive/issue_comments_265626.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-24T10:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265626",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265627.json:
```json
{
    "body": "Some timings\n\n```\nsage: %timeit simplicial_complexes.RandomTwoSphere(1000).graph()\n1 loops, best of 3: 769 ms per loop\nsage: %timeit graphs.RandomTriangulation(1000)\n1 loops, best of 3: 189 ms per loop\n```\n\nSo at least it is not a good idea to use the simplicial complex to generate the graph.",
    "created_at": "2016-01-27T16:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265627",
    "user": "@fchapoton"
}
```

Some timings

```
sage: %timeit simplicial_complexes.RandomTwoSphere(1000).graph()
1 loops, best of 3: 769 ms per loop
sage: %timeit graphs.RandomTriangulation(1000)
1 loops, best of 3: 189 ms per loop
```

So at least it is not a good idea to use the simplicial complex to generate the graph.



---

archive/issue_comments_265628.json:
```json
{
    "body": "My 2 cents, I would pull out the common code into separate helper functions (and in particular, the internal helper `rotate_word_to_next_occurrence()`).",
    "created_at": "2016-01-27T22:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265628",
    "user": "@tscrim"
}
```

My 2 cents, I would pull out the common code into separate helper functions (and in particular, the internal helper `rotate_word_to_next_occurrence()`).



---

archive/issue_comments_265629.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T08:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265629",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265630.json:
```json
{
    "body": "You realize that the code is longer after your 'refactoring' than before, and that the code of both functions is still almost the same?\n\nNathann",
    "created_at": "2016-01-28T08:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265630",
    "user": "@nathanncohen"
}
```

You realize that the code is longer after your 'refactoring' than before, and that the code of both functions is still almost the same?

Nathann



---

archive/issue_comments_265631.json:
```json
{
    "body": "I understand that you want this reviewed, but implementing \"whatever a reviewer asks for as long as it is easy\" in the hope that he will click on `positive_review` is not a responsible behaviour.\n\nNathann",
    "created_at": "2016-01-28T08:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265631",
    "user": "@nathanncohen"
}
```

I understand that you want this reviewed, but implementing "whatever a reviewer asks for as long as it is easy" in the hope that he will click on `positive_review` is not a responsible behaviour.

Nathann



---

archive/issue_comments_265632.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-28T08:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265632",
    "user": "@nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_265633.json:
```json
{
    "body": "> Some timings\n> {{{\n> sage: %timeit simplicial_complexes.RandomTwoSphere(1000).graph()\n> 1 loops, best of 3: 769 ms per loop\n> sage: %timeit graphs.RandomTriangulation(1000)\n> 1 loops, best of 3: 189 ms per loop\n> }}}\n\nSome timings:\n\n\n```\nsage: %timeit simplicial_complexes.RandomTwoSphere(1000)\n1 loops, best of 3: 246 ms per loop\nsage: %timeit graphs.RandomTriangulation(1000)\n1 loops, best of 3: 222 ms per loop\n```\n\n\nThat's what happens when you replace the last line of `RandomTwoSphere` this way:\n\n\n```diff\n-    return SimplicialComplex(triangles)\n+    return triangles\n```\n\n\nAnother timing:\n\n\n```\nsage: %timeit simplicial_complexes.RandomTwoSphere(1000)\n1 loops, best of 3: 269 ms per loop\nsage: %timeit graphs.RandomTriangulation(1000)\n1 loops, best of 3: 219 ms per loop\n```\n\n\nThat's what happens when you do the following replacement instead:\n\n\n```\n-    return SimplicialComplex(triangles)\n+    return SimplicialComplex(triangles,maximality_check=False)\n```\n\n\n\nOnce this (second) replacement is done, here is the effect on the `.graph` function:\n\n\n```\nsage: %timeit simplicial_complexes.RandomTwoSphere(1000).graph()\n1 loops, best of 3: 345 ms per loop\nsage: %timeit graphs.RandomTriangulation(1000)\n1 loops, best of 3: 222 ms per loop\n```\n\n\nIf that is still too much for your (I assume computer-intensive) needs, it seems that the .graph function is unnecessarily slow\n\n\n```\nsage: def simplex_to_graph(S):\n    g = Graph()\n    for S in S._facets:\n        g.add_cycle(g)\n    return g\nsage: %timeit simplex_to_graph(simplicial_complexes.RandomTwoSphere(1000))\n1 loops, best of 3: 288 ms per loop\nsage: %timeit graphs.RandomTriangulation(1000)\n1 loops, best of 3: 226 ms per loop\n```\n\n\nSo please stop messing around by moving around blocks of 5 lines, and keep only one of these two functions (unless you still find the speed penalty too big).\n\nNathann",
    "created_at": "2016-01-28T08:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265633",
    "user": "@nathanncohen"
}
```

> Some timings
> {{{
> sage: %timeit simplicial_complexes.RandomTwoSphere(1000).graph()
> 1 loops, best of 3: 769 ms per loop
> sage: %timeit graphs.RandomTriangulation(1000)
> 1 loops, best of 3: 189 ms per loop
> }}}

Some timings:


```
sage: %timeit simplicial_complexes.RandomTwoSphere(1000)
1 loops, best of 3: 246 ms per loop
sage: %timeit graphs.RandomTriangulation(1000)
1 loops, best of 3: 222 ms per loop
```


That's what happens when you replace the last line of `RandomTwoSphere` this way:


```diff
-    return SimplicialComplex(triangles)
+    return triangles
```


Another timing:


```
sage: %timeit simplicial_complexes.RandomTwoSphere(1000)
1 loops, best of 3: 269 ms per loop
sage: %timeit graphs.RandomTriangulation(1000)
1 loops, best of 3: 219 ms per loop
```


That's what happens when you do the following replacement instead:


```
-    return SimplicialComplex(triangles)
+    return SimplicialComplex(triangles,maximality_check=False)
```



Once this (second) replacement is done, here is the effect on the `.graph` function:


```
sage: %timeit simplicial_complexes.RandomTwoSphere(1000).graph()
1 loops, best of 3: 345 ms per loop
sage: %timeit graphs.RandomTriangulation(1000)
1 loops, best of 3: 222 ms per loop
```


If that is still too much for your (I assume computer-intensive) needs, it seems that the .graph function is unnecessarily slow


```
sage: def simplex_to_graph(S):
    g = Graph()
    for S in S._facets:
        g.add_cycle(g)
    return g
sage: %timeit simplex_to_graph(simplicial_complexes.RandomTwoSphere(1000))
1 loops, best of 3: 288 ms per loop
sage: %timeit graphs.RandomTriangulation(1000)
1 loops, best of 3: 226 ms per loop
```


So please stop messing around by moving around blocks of 5 lines, and keep only one of these two functions (unless you still find the speed penalty too big).

Nathann



---

archive/issue_comments_265634.json:
```json
{
    "body": "P.S.: I've never seen anything of that kind:\n\n\n```\nREFERENCES: [PS2006]_\n```\n\n\nAs far as I know we only write a 'REFERENCES' block when we *define* a new reference.",
    "created_at": "2016-01-28T09:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265634",
    "user": "@nathanncohen"
}
```

P.S.: I've never seen anything of that kind:


```
REFERENCES: [PS2006]_
```


As far as I know we only write a 'REFERENCES' block when we *define* a new reference.



---

archive/issue_comments_265635.json:
```json
{
    "body": "P.S.: If you use the `SimplicialComplex` class often, you may want to 'simplify' the maximality check by checking first whether the facets all have the same size.\n\nNathann",
    "created_at": "2016-01-28T09:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265635",
    "user": "@nathanncohen"
}
```

P.S.: If you use the `SimplicialComplex` class often, you may want to 'simplify' the maximality check by checking first whether the facets all have the same size.

Nathann



---

archive/issue_comments_265636.json:
```json
{
    "body": "Hello Nathann.\n\nThanks for your comments, and for your time.\n\nConcerning the suggestion of Travis, I can of course revert this factorisation. But you may qualify this as \"just doing everything that a potential reviewer asks for\".\n\nI was trying to think about adding the embedding information on the graph method, as you suggested before. I am not sure that this data is easily recoverable from the simplicial complex. So it seems to me that keeping both still has a value, if I manage to add the embedding.\n\n1) the graph method would give an embedded (planar) graph. \n\n2) the simplicial complex method (besides giving an interesting object by itself) allows to compute easily the planar dual of this graph, which would give another class of nice random graphs.",
    "created_at": "2016-01-28T09:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265636",
    "user": "@fchapoton"
}
```

Hello Nathann.

Thanks for your comments, and for your time.

Concerning the suggestion of Travis, I can of course revert this factorisation. But you may qualify this as "just doing everything that a potential reviewer asks for".

I was trying to think about adding the embedding information on the graph method, as you suggested before. I am not sure that this data is easily recoverable from the simplicial complex. So it seems to me that keeping both still has a value, if I manage to add the embedding.

1) the graph method would give an embedded (planar) graph. 

2) the simplicial complex method (besides giving an interesting object by itself) allows to compute easily the planar dual of this graph, which would give another class of nice random graphs.



---

archive/issue_comments_265637.json:
```json
{
    "body": "Yo,\n\n> Concerning the suggestion of Travis, I can of course revert this factorisation. But you may qualify this as \"just doing everything that a potential reviewer asks for\".\n\nI don't have anything against people telling me why they think one of my suggestions is wrong. If you think useful to keep this independent function, I'm all ears.\n\n> I was trying to think about adding the embedding information on the graph method, as you suggested before. I am not sure that this data is easily recoverable from the simplicial complex. So it seems to me that keeping both still has a value, if I manage to add the embedding.\n\nIf you manage to add the embedding to the `Graph` function, then it will be straightforward to build the `SimplicialComplex` from it. So again in this case, you can do without the `SimplicialComplex` constructor, which will merely list the faces of the `Graph` object (assuming that it contains the embedding).\n\nI have nothing against that.\n\nNathann",
    "created_at": "2016-01-28T09:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265637",
    "user": "@nathanncohen"
}
```

Yo,

> Concerning the suggestion of Travis, I can of course revert this factorisation. But you may qualify this as "just doing everything that a potential reviewer asks for".

I don't have anything against people telling me why they think one of my suggestions is wrong. If you think useful to keep this independent function, I'm all ears.

> I was trying to think about adding the embedding information on the graph method, as you suggested before. I am not sure that this data is easily recoverable from the simplicial complex. So it seems to me that keeping both still has a value, if I manage to add the embedding.

If you manage to add the embedding to the `Graph` function, then it will be straightforward to build the `SimplicialComplex` from it. So again in this case, you can do without the `SimplicialComplex` constructor, which will merely list the faces of the `Graph` object (assuming that it contains the embedding).

I have nothing against that.

Nathann



---

archive/issue_comments_265638.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T11:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265638",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265639.json:
```json
{
    "body": "Some timings now that we have the embedding:\n\n```\nsage: %timeit SimplicialComplex([set(flatten(d)) for d in graphs.RandomTriangulation(100).faces()])\n10 loops, best of 3: 82.6 ms per loop\nsage: %timeit simplicial_complexes.RandomTwoSphere(100)\n100 loops, best of 3: 5.26 ms per loop\n```\n\nso going through the graph to get the simplicial complex is not efficient..",
    "created_at": "2016-01-28T12:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265639",
    "user": "@fchapoton"
}
```

Some timings now that we have the embedding:

```
sage: %timeit SimplicialComplex([set(flatten(d)) for d in graphs.RandomTriangulation(100).faces()])
10 loops, best of 3: 82.6 ms per loop
sage: %timeit simplicial_complexes.RandomTwoSphere(100)
100 loops, best of 3: 5.26 ms per loop
```

so going through the graph to get the simplicial complex is not efficient..



---

archive/issue_comments_265640.json:
```json
{
    "body": "> Some timings now that we have the embedding:\n> {{{\n> sage: %timeit SimplicialComplex([set(flatten(d)) for d in graphs.RandomTriangulation(100).faces()])\n> 10 loops, best of 3: 82.6 ms per loop\n> sage: %timeit simplicial_complexes.RandomTwoSphere(100)\n> 100 loops, best of 3: 5.26 ms per loop\n> }}}\n> so going through the graph to get the simplicial complex is not efficient..\n\nSome other timings:\n\n\n```\ndef triangles(G):\n    G = G.relabel(inplace=False)\n    return [(u,v,w) for u,L in G._embedding.iteritems() \n            for v,w in zip(L,L[1:]+[L[0]]) if u<v and u<w]\n\nsage: %timeit graphs.RandomTriangulation(1000)\n1 loops, best of 3: 258 ms per loop\nsage: %timeit SimplicialComplex(triangles(graphs.RandomTriangulation(1000)),maximality_check=False)\n1 loops, best of 3: 304 ms per loop\nsage: %timeit simplicial_complexes.RandomTwoSphere(1000)\n1 loops, best of 3: 299 ms per loop\n```\n\n\nAnd a check:\n\n\n```\nsage: g=graphs.RandomTriangulation(1000)\nsage: h=Graph()\nsage: _=map(h.add_cycle,triangles(g))\nsage: g == h\nTrue\n```\n\n\nI have too much respect for you to think that you even gave it a decent try. You would have at least added `maximality_check=False`, as I made this remark this very morning.\n\nNathann",
    "created_at": "2016-01-28T13:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265640",
    "user": "@nathanncohen"
}
```

> Some timings now that we have the embedding:
> {{{
> sage: %timeit SimplicialComplex([set(flatten(d)) for d in graphs.RandomTriangulation(100).faces()])
> 10 loops, best of 3: 82.6 ms per loop
> sage: %timeit simplicial_complexes.RandomTwoSphere(100)
> 100 loops, best of 3: 5.26 ms per loop
> }}}
> so going through the graph to get the simplicial complex is not efficient..

Some other timings:


```
def triangles(G):
    G = G.relabel(inplace=False)
    return [(u,v,w) for u,L in G._embedding.iteritems() 
            for v,w in zip(L,L[1:]+[L[0]]) if u<v and u<w]

sage: %timeit graphs.RandomTriangulation(1000)
1 loops, best of 3: 258 ms per loop
sage: %timeit SimplicialComplex(triangles(graphs.RandomTriangulation(1000)),maximality_check=False)
1 loops, best of 3: 304 ms per loop
sage: %timeit simplicial_complexes.RandomTwoSphere(1000)
1 loops, best of 3: 299 ms per loop
```


And a check:


```
sage: g=graphs.RandomTriangulation(1000)
sage: h=Graph()
sage: _=map(h.add_cycle,triangles(g))
sage: g == h
True
```


I have too much respect for you to think that you even gave it a decent try. You would have at least added `maximality_check=False`, as I made this remark this very morning.

Nathann



---

archive/issue_comments_265641.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T13:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265641",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265642.json:
```json
{
    "body": "Indeed, I was too quick. \n\nI agree to use the graph to generate the simplicial complex.\n\nMaybe you can at last be happy with the state of affairs ?",
    "created_at": "2016-01-28T13:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265642",
    "user": "@fchapoton"
}
```

Indeed, I was too quick. 

I agree to use the graph to generate the simplicial complex.

Maybe you can at last be happy with the state of affairs ?



---

archive/issue_comments_265643.json:
```json
{
    "body": "Hello,\n\n> I agree to use the graph to generate the simplicial complex.\n> \n> Maybe you can at last be happy with the state of affairs ?\n\nThank you. I have absolutely nothing against the current design of functions. And I may take a look at `Graph.faces()`, just in case it may not be slow for triangulations only.\n\nNathann",
    "created_at": "2016-01-28T13:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265643",
    "user": "@nathanncohen"
}
```

Hello,

> I agree to use the graph to generate the simplicial complex.
> 
> Maybe you can at last be happy with the state of affairs ?

Thank you. I have absolutely nothing against the current design of functions. And I may take a look at `Graph.faces()`, just in case it may not be slow for triangulations only.

Nathann



---

archive/issue_comments_265644.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T14:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265644",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265645.json:
```json
{
    "body": "ok, let me put this back to needs_review, then.",
    "created_at": "2016-01-28T14:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265645",
    "user": "@fchapoton"
}
```

ok, let me put this back to needs_review, then.



---

archive/issue_comments_265646.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-28T14:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265646",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_265647.json:
```json
{
    "body": "Replying to [comment:23 ncohen]:\n> You realize that the code is longer after your 'refactoring' than before, and that the code of both functions is still almost the same?\n\nTo be fair, what really made it longer is the docstrings and doctests, which is not a bad thing either. Also, it would have made it easier in terms of long-term maintenance (you only have to make changes in one place).\n\nI've seen things like as in comment:26 (although not in so compact of state), and IMO that is a good way to add a reference that you don't specifically cite in the docstring.",
    "created_at": "2016-01-28T16:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265647",
    "user": "@tscrim"
}
```

Replying to [comment:23 ncohen]:
> You realize that the code is longer after your 'refactoring' than before, and that the code of both functions is still almost the same?

To be fair, what really made it longer is the docstrings and doctests, which is not a bad thing either. Also, it would have made it easier in terms of long-term maintenance (you only have to make changes in one place).

I've seen things like as in comment:26 (although not in so compact of state), and IMO that is a good way to add a reference that you don't specifically cite in the docstring.



---

archive/issue_comments_265648.json:
```json
{
    "body": "Hello,\n\nThe branch looks good. I only wonder about that: why keep it?\n\n\n```\n+    # graph.relabel()   # does not act on the embedding !\n```\n\n\nIf you expect `.relabel()` to apply to the embedding, then the right reaction is to write a bugfix, isn't it?\n\nCould you also add a doctest like that?\n\n\n```\nsage: for i in range(10):\n....:    g = graphs.RandomTriangulation(10)\n....:    assert g.is_planar(on_embedding=g.get_embedding())\n```\n\n\nI let it run for a long time, but that's probably safer to have it in the tests.\n\nThanks,\n\nNathann",
    "created_at": "2016-01-29T10:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265648",
    "user": "@nathanncohen"
}
```

Hello,

The branch looks good. I only wonder about that: why keep it?


```
+    # graph.relabel()   # does not act on the embedding !
```


If you expect `.relabel()` to apply to the embedding, then the right reaction is to write a bugfix, isn't it?

Could you also add a doctest like that?


```
sage: for i in range(10):
....:    g = graphs.RandomTriangulation(10)
....:    assert g.is_planar(on_embedding=g.get_embedding())
```


I let it run for a long time, but that's probably safer to have it in the tests.

Thanks,

Nathann



---

archive/issue_comments_265649.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-29T14:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265649",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-29T14:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265650",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265651.json:
```json
{
    "body": "Yoooooooooo !\n\nI just ran the test on the files you changed, and it's all right. Can I switch it to `positive_review` or do you have changes pending?\n\nNathann",
    "created_at": "2016-01-29T14:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265651",
    "user": "@nathanncohen"
}
```

Yoooooooooo !

I just ran the test on the files you changed, and it's all right. Can I switch it to `positive_review` or do you have changes pending?

Nathann



---

archive/issue_comments_265652.json:
```json
{
    "body": "Hello,\n\nno, I am all done.\n\nThanks a lot for your time, and your patience.",
    "created_at": "2016-01-29T14:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265652",
    "user": "@fchapoton"
}
```

Hello,

no, I am all done.

Thanks a lot for your time, and your patience.



---

archive/issue_comments_265653.json:
```json
{
    "body": "Yoooooooooooooo !\n\n> no, I am all done.\n\nExcellent. Then let it go. Thanks for the code `:-)`\n\nNathann",
    "created_at": "2016-01-29T14:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265653",
    "user": "@nathanncohen"
}
```

Yoooooooooooooo !

> no, I am all done.

Excellent. Then let it go. Thanks for the code `:-)`

Nathann



---

archive/issue_comments_265654.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-29T14:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265654",
    "user": "@nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_265655.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-30T00:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19346#issuecomment-265655",
    "user": "@vbraun"
}
```

Resolution: fixed
