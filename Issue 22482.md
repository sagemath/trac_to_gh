# Issue 22482: integral points for elliptic curves broken

archive/issues_022482.json:
```json
{
    "body": "CC:  @JohnCremona\n\nKeywords: integral points, ratpoints\n\n\n```\nsage: E = EllipticCurve(\"141d1\")\nsage: E.integral_points()\n```\n\n\ngoes boom with\n` --> 198         raise RuntimeError('Bad arguments to ratpoints')`\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22719\n\n",
    "created_at": "2017-03-30T15:26:05Z",
    "labels": [
        "elliptic curves",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "integral points for elliptic curves broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22482",
    "user": "@categorie"
}
```
CC:  @JohnCremona

Keywords: integral points, ratpoints


```
sage: E = EllipticCurve("141d1")
sage: E.integral_points()
```


goes boom with
` --> 198         raise RuntimeError('Bad arguments to ratpoints')`


Issue created by migration from https://trac.sagemath.org/ticket/22719





---

archive/issue_comments_313299.json:
```json
{
    "body": "I am not sure this has not been noted before in some form, but I could not find anything about it.\nIt is the optimal curve of lowest conductor for which this appears.",
    "created_at": "2017-03-30T15:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313299",
    "user": "@categorie"
}
```

I am not sure this has not been noted before in some form, but I could not find anything about it.
It is the optimal curve of lowest conductor for which this appears.



---

archive/issue_comments_313300.json:
```json
{
    "body": "Thanks for spotting this.  Since this was implemented I have checed many thousands of curves to compare with Magma, so this must be something new.  In particular ratpoints has changed.\n\nThere's another ticket which has been around for ages in which I am fixing other integral points bugs.  What joy.",
    "created_at": "2017-03-30T15:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313300",
    "user": "@JohnCremona"
}
```

Thanks for spotting this.  Since this was implemented I have checed many thousands of curves to compare with Magma, so this must be something new.  In particular ratpoints has changed.

There's another ticket which has been around for ages in which I am fixing other integral points bugs.  What joy.



---

archive/issue_comments_313301.json:
```json
{
    "body": "I just found this and took a look.  It's easy to fix (though I don't know what has changed): in line 5770 of ell_rational_field.py ratpoints() does not like being given H=0 which it is in this case.  I fixed this example by replacing the line above, defining H by\n\n```\nH = max(xmin.abs(), xmax.abs(), 1)\n```\n\nI am running some tests.",
    "created_at": "2017-11-07T19:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313301",
    "user": "@JohnCremona"
}
```

I just found this and took a look.  It's easy to fix (though I don't know what has changed): in line 5770 of ell_rational_field.py ratpoints() does not like being given H=0 which it is in this case.  I fixed this example by replacing the line above, defining H by

```
H = max(xmin.abs(), xmax.abs(), 1)
```

I am running some tests.



---

archive/issue_comments_313302.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-07T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313302",
    "user": "@JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313303.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-11-07T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313303",
    "user": "@JohnCremona"
}
```

New commits:



---

archive/issue_comments_313304.json:
```json
{
    "body": "I checked all curves of conductor <1000.  Doing more checking now -- note that it's a lot quicker to run E.integral_points() on curves when you have the optional database_cremona_ellcurve installed since it does not have to find the Mordell-Weil group of each.",
    "created_at": "2017-11-07T20:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313304",
    "user": "@JohnCremona"
}
```

I checked all curves of conductor <1000.  Doing more checking now -- note that it's a lot quicker to run E.integral_points() on curves when you have the optional database_cremona_ellcurve installed since it does not have to find the Mordell-Weil group of each.



---

archive/issue_comments_313305.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-08T22:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313305",
    "user": "@roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313306.json:
```json
{
    "body": "Looks good.",
    "created_at": "2017-11-08T22:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313306",
    "user": "@roed314"
}
```

Looks good.



---

archive/issue_comments_313307.json:
```json
{
    "body": "Oh, someone beat me to it :)\nI did random checks with thousands of curves and it always gives an answer now.",
    "created_at": "2017-11-09T09:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313307",
    "user": "@categorie"
}
```

Oh, someone beat me to it :)
I did random checks with thousands of curves and it always gives an answer now.



---

archive/issue_comments_313308.json:
```json
{
    "body": "Thanks both -- I meant to post again to say that I ran all curves up to conductor 10^5 with no problems.",
    "created_at": "2017-11-09T09:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313308",
    "user": "@JohnCremona"
}
```

Thanks both -- I meant to post again to say that I ran all curves up to conductor 10^5 with no problems.



---

archive/issue_comments_313309.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-11T01:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22482#issuecomment-313309",
    "user": "@vbraun"
}
```

Resolution: fixed
