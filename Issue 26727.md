# Issue 26727: missing packages for building Sage on fedora

archive/issues_026727.json:
```json
{
    "body": "CC:  dimpase embray jhpalmieri\n\nWhen trying to build Sage on a very bare fedora install (e.g. a Docker container) the packages listed in the build instructions at:\n\nhttps://doc.sagemath.org/html/en/installation/source.html#linux-prerequisite-installation\n\nare insufficient.  At the very least it also needs `findutils` and `which`, and currently it also requires `python2`, though that should be fixed as part of  #26953.\n\nThe need for `which` comes, at the very least, from MPIR's `configure` script, which uses `which` at least on Linux.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26964\n\n",
    "created_at": "2018-12-28T15:49:52Z",
    "labels": [
        "documentation",
        "minor",
        "bug"
    ],
    "title": "missing packages for building Sage on fedora",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26727",
    "user": "embray"
}
```
CC:  dimpase embray jhpalmieri

When trying to build Sage on a very bare fedora install (e.g. a Docker container) the packages listed in the build instructions at:

https://doc.sagemath.org/html/en/installation/source.html#linux-prerequisite-installation

are insufficient.  At the very least it also needs `findutils` and `which`, and currently it also requires `python2`, though that should be fixed as part of  #26953.

The need for `which` comes, at the very least, from MPIR's `configure` script, which uses `which` at least on Linux.

Issue created by migration from https://trac.sagemath.org/ticket/26964





---

archive/issue_comments_375909.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375909",
    "user": "embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_375910.json:
```json
{
    "body": "Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.",
    "created_at": "2019-03-25T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375910",
    "user": "embray"
}
```

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.



---

archive/issue_comments_375911.json:
```json
{
    "body": "Added these 2 packages to #29053.",
    "created_at": "2020-01-27T19:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375911",
    "user": "mkoeppe"
}
```

Added these 2 packages to #29053.



---

archive/issue_comments_375912.json:
```json
{
    "body": "I'm not sure how I feel about using the bootstrap script for this purpose.  I think I would prefer if it were done by configure instead.  Reason: The bootstrap script should really be limited to tasks specific to generating the `configure` file (whether running autoreconf or downloadng it).  Other than that, I think this is a great idea!",
    "created_at": "2020-02-05T11:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375912",
    "user": "embray"
}
```

I'm not sure how I feel about using the bootstrap script for this purpose.  I think I would prefer if it were done by configure instead.  Reason: The bootstrap script should really be limited to tasks specific to generating the `configure` file (whether running autoreconf or downloadng it).  Other than that, I think this is a great idea!



---

archive/issue_comments_375913.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-05T13:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375913",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_375914.json:
```json
{
    "body": "No, no, `bootstrap` is exactly the right phase for this, not `configure`. Let me explain more.\n\n`bootstrap` will prepare a source tree so that\n- `make sdist` can be run\n- `configure` can be run by a user (who does not have autotools)\n- `src/setup.py sdist` can be run.\n- `src/configure` can be run (#29119)\n\nNone of this depends on the configuration determined by `configure`!\n\nAs the installation manual sources are part of the sagelib sdist, the command lines of this ticket should be prepared in the bootstrap phase.",
    "created_at": "2020-02-05T13:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375914",
    "user": "mkoeppe"
}
```

No, no, `bootstrap` is exactly the right phase for this, not `configure`. Let me explain more.

`bootstrap` will prepare a source tree so that
- `make sdist` can be run
- `configure` can be run by a user (who does not have autotools)
- `src/setup.py sdist` can be run.
- `src/configure` can be run (#29119)

None of this depends on the configuration determined by `configure`!

As the installation manual sources are part of the sagelib sdist, the command lines of this ticket should be prepared in the bootstrap phase.



---

archive/issue_comments_375915.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> As the installation manual sources are part of the sagelib sdist, the command lines of this ticket should be prepared in the bootstrap phase.\n\nI want to clarify something about this here:  Do you mean the sagelib sdist, or the sage-the-distribution sdist?\n\nI sort of see your point, but I'm still not sure why it needs to go here.  Also, as part of #29119 I'm adding a `src/bootstrap` script for sagelib itself, so maybe something like this would make more sense to go there.\n\nAnyways, setting back to needs_work since no branch is attached.  Maybe then I'll see what you're talking about.",
    "created_at": "2020-02-06T11:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375915",
    "user": "embray"
}
```

Replying to [comment:7 mkoeppe]:
> As the installation manual sources are part of the sagelib sdist, the command lines of this ticket should be prepared in the bootstrap phase.

I want to clarify something about this here:  Do you mean the sagelib sdist, or the sage-the-distribution sdist?

I sort of see your point, but I'm still not sure why it needs to go here.  Also, as part of #29119 I'm adding a `src/bootstrap` script for sagelib itself, so maybe something like this would make more sense to go there.

Anyways, setting back to needs_work since no branch is attached.  Maybe then I'll see what you're talking about.



---

archive/issue_comments_375916.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-06T11:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375916",
    "user": "embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_375917.json:
```json
{
    "body": "Couldn't this also be done as part of `make sdist`?",
    "created_at": "2020-02-06T11:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375917",
    "user": "embray"
}
```

Couldn't this also be done as part of `make sdist`?



---

archive/issue_comments_375918.json:
```json
{
    "body": "Replying to [comment:8 embray]:\n> Replying to [comment:7 mkoeppe]:\n> > As the installation manual sources are part of the sagelib sdist, the command lines of this ticket should be prepared in the bootstrap phase.\n> \n> I want to clarify something about this here:  Do you mean the sagelib sdist, or the sage-the-distribution sdist?\n\nBoth.\n\nCurrently, of course, only sage-the-distribution has a working sdist.\n\nsagelib's sdist needs fixing. You might remember ticket #21516 - Fix sagelib sdist (`src/setup.py sdist`). \n\n\n> I sort of see your point, but I'm still not sure why it needs to go here.  Also, as part of #29119 I'm adding a `src/bootstrap` script for sagelib itself, so maybe something like this would make more sense to go there.\n\nIn my opinion, there should only be one developer-invoked `bootstrap` script (the one for the distribution) -- because everything will depend on the distribution's `build/pkgs` files. \n\n`SAGE_ROOT/bootstrap` could certainly call a new script `src/bootstrap` for generating files that end up in `src/`. If you create that in #29119, fine. \n\n\n> Anyways, setting back to needs_work since no branch is attached.  Maybe then I'll see what you're talking about.\n\nSure. #29041 (src/requirements.txt, src/constraints.txt, src/setup.cfg) has a branch, needs review.",
    "created_at": "2020-02-06T12:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375918",
    "user": "mkoeppe"
}
```

Replying to [comment:8 embray]:
> Replying to [comment:7 mkoeppe]:
> > As the installation manual sources are part of the sagelib sdist, the command lines of this ticket should be prepared in the bootstrap phase.
> 
> I want to clarify something about this here:  Do you mean the sagelib sdist, or the sage-the-distribution sdist?

Both.

Currently, of course, only sage-the-distribution has a working sdist.

sagelib's sdist needs fixing. You might remember ticket #21516 - Fix sagelib sdist (`src/setup.py sdist`). 


> I sort of see your point, but I'm still not sure why it needs to go here.  Also, as part of #29119 I'm adding a `src/bootstrap` script for sagelib itself, so maybe something like this would make more sense to go there.

In my opinion, there should only be one developer-invoked `bootstrap` script (the one for the distribution) -- because everything will depend on the distribution's `build/pkgs` files. 

`SAGE_ROOT/bootstrap` could certainly call a new script `src/bootstrap` for generating files that end up in `src/`. If you create that in #29119, fine. 


> Anyways, setting back to needs_work since no branch is attached.  Maybe then I'll see what you're talking about.

Sure. #29041 (src/requirements.txt, src/constraints.txt, src/setup.cfg) has a branch, needs review.



---

archive/issue_comments_375919.json:
```json
{
    "body": "Replying to [comment:9 embray]:\n> Couldn't this also be done as part of `make sdist`?\n\nNo, because developers who build sage out of a git worktree do not run `make sdist`.",
    "created_at": "2020-02-06T12:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375919",
    "user": "mkoeppe"
}
```

Replying to [comment:9 embray]:
> Couldn't this also be done as part of `make sdist`?

No, because developers who build sage out of a git worktree do not run `make sdist`.



---

archive/issue_comments_375920.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-09T19:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375920",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375921.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-09T19:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375921",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375922.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-09T19:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375922",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375923.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-11T21:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375923",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375924.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-02-11T21:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375924",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375925.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-11T21:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375925",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375926.json:
```json
{
    "body": "something is not quite right:\n\n```\n(sage-sh) dimpase@clpc171:sage$ ./build/bin/sage-print-system-package-command debian gmp\nsudo apt-get gmp \n(sage-sh) dimpase@clpc171:sage$ ./build/bin/sage-print-system-package-command conda gmp\n# gmp the following packages: \n```\n\n- so `debian` works, `conda` does not...",
    "created_at": "2020-02-11T22:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375926",
    "user": "dimpase"
}
```

something is not quite right:

```
(sage-sh) dimpase@clpc171:sage$ ./build/bin/sage-print-system-package-command debian gmp
sudo apt-get gmp 
(sage-sh) dimpase@clpc171:sage$ ./build/bin/sage-print-system-package-command conda gmp
# gmp the following packages: 
```

- so `debian` works, `conda` does not...



---

archive/issue_comments_375927.json:
```json
{
    "body": "you forgot the verb `install` in both commands",
    "created_at": "2020-02-12T02:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375927",
    "user": "mkoeppe"
}
```

you forgot the verb `install` in both commands



---

archive/issue_comments_375928.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-12T02:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375928",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375929.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-12T02:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375929",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375930.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> Replying to [comment:9 embray]:\n> > Couldn't this also be done as part of `make sdist`?\n> \n> No, because developers who build sage out of a git worktree do not run `make sdist`.\n\nSure, but what is required for running `make sdist`?  It seems to me this should be done in two separate cases: One when running `make sdist` and one when developing out of source.  In either case I don't think the bootstrap script is the appropriate place for it.\n\nThe only reason you seem to be putting it there is that it would happen to cover both cases, but I think both cases should be handled separately.",
    "created_at": "2020-02-12T17:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375930",
    "user": "embray"
}
```

Replying to [comment:11 mkoeppe]:
> Replying to [comment:9 embray]:
> > Couldn't this also be done as part of `make sdist`?
> 
> No, because developers who build sage out of a git worktree do not run `make sdist`.

Sure, but what is required for running `make sdist`?  It seems to me this should be done in two separate cases: One when running `make sdist` and one when developing out of source.  In either case I don't think the bootstrap script is the appropriate place for it.

The only reason you seem to be putting it there is that it would happen to cover both cases, but I think both cases should be handled separately.



---

archive/issue_comments_375931.json:
```json
{
    "body": "I think I might see part of the problem here:  It is true that the information you need to generate these documentation pages lives in sage-the-distribution, above the sagelib sources.  If you want to package sagelib in a stand-alone fashion you need to get access to this data somehow, but you can't, so the file is generated sort of externally to sagelib, using data from sage-the-distribution.\n\nA similar problem applies to #29119.  In the prototype for that I am working on a more general solution to the problem, which is that `./bootstrap` makes hard links of files sagelib needs into the sagelib sources under `src/`.  That way, only one copy of the relevant files needs to exist in the existing combined repository, but if sagelib is packaged separately it will retain the necessary files.\n\nI think having that might serve as a solution here too.  My feeling is that these documentation pages should be generated by the docbuilder itself.  As long as it has access to information about Sage's dependencies it can do this, without the top-level `./bootstrap` script having to take any special action.\n\nIn other words, what we ultimately want is to be able to build Sage's docs without direct dependency on the sage-the-distribution stuff.  As it stands, I fear this PR is introducing too much direct dependency on sage-the-distribution just to be able to build Sage's docs.  What we would really want is to be able to run `setup.py sdist`, the a source tarball just for sagelib and its docs, and later unpack it somewhere else and still be able to build the docs (and sage itself).",
    "created_at": "2020-02-12T17:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375931",
    "user": "embray"
}
```

I think I might see part of the problem here:  It is true that the information you need to generate these documentation pages lives in sage-the-distribution, above the sagelib sources.  If you want to package sagelib in a stand-alone fashion you need to get access to this data somehow, but you can't, so the file is generated sort of externally to sagelib, using data from sage-the-distribution.

A similar problem applies to #29119.  In the prototype for that I am working on a more general solution to the problem, which is that `./bootstrap` makes hard links of files sagelib needs into the sagelib sources under `src/`.  That way, only one copy of the relevant files needs to exist in the existing combined repository, but if sagelib is packaged separately it will retain the necessary files.

I think having that might serve as a solution here too.  My feeling is that these documentation pages should be generated by the docbuilder itself.  As long as it has access to information about Sage's dependencies it can do this, without the top-level `./bootstrap` script having to take any special action.

In other words, what we ultimately want is to be able to build Sage's docs without direct dependency on the sage-the-distribution stuff.  As it stands, I fear this PR is introducing too much direct dependency on sage-the-distribution just to be able to build Sage's docs.  What we would really want is to be able to run `setup.py sdist`, the a source tarball just for sagelib and its docs, and later unpack it somewhere else and still be able to build the docs (and sage itself).



---

archive/issue_comments_375932.json:
```json
{
    "body": "How is this supposed to work with an incremental build?\n\n```\n$ make bootstrap\nmake: `bootstrap' is up to date.\n$ make configure\nmake: `configure' is up to date.\n$ make\n...\nOSError: /Users/jpalmier/Desktop/Sage/git/sage/src/doc/en/installation/source.rst:228: WARNING: Include file '/Users/jpalmier/Desktop/Sage/git/sage/src/doc/en/installation/debian.txt' not found or reading it failed\n```\n",
    "created_at": "2020-02-12T18:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375932",
    "user": "jhpalmieri"
}
```

How is this supposed to work with an incremental build?

```
$ make bootstrap
make: `bootstrap' is up to date.
$ make configure
make: `configure' is up to date.
$ make
...
OSError: /Users/jpalmier/Desktop/Sage/git/sage/src/doc/en/installation/source.rst:228: WARNING: Include file '/Users/jpalmier/Desktop/Sage/git/sage/src/doc/en/installation/debian.txt' not found or reading it failed
```




---

archive/issue_comments_375933.json:
```json
{
    "body": "Replying to [comment:26 jhpalmieri]:\n> How is this supposed to work with an incremental build?\nThanks for catching this -- I need to add some dependencies",
    "created_at": "2020-02-12T18:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375933",
    "user": "mkoeppe"
}
```

Replying to [comment:26 jhpalmieri]:
> How is this supposed to work with an incremental build?
Thanks for catching this -- I need to add some dependencies



---

archive/issue_comments_375934.json:
```json
{
    "body": "Replying to [comment:25 embray]:\n> I think I might see part of the problem here:  It is true that the information you need to generate these documentation pages lives in sage-the-distribution, above the sagelib sources.  If you want to package sagelib in a stand-alone fashion you need to get access to this data somehow, but you can't, so the file is generated sort of externally to sagelib, using data from sage-the-distribution.\n> \n> A similar problem applies to #29119.  [...]\n\nThere is a really easy solution:  \n- `bootstrap` is only allowed in the full distribution source, not in a separate sagelib source. No hardlinks necessary. Only developers bootstrap.\n- Users don't bootstrap, they start with the configure phase. \n- sdist of the distribution and sdist of sagelib generate bootstrapped source archives.",
    "created_at": "2020-02-12T18:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375934",
    "user": "mkoeppe"
}
```

Replying to [comment:25 embray]:
> I think I might see part of the problem here:  It is true that the information you need to generate these documentation pages lives in sage-the-distribution, above the sagelib sources.  If you want to package sagelib in a stand-alone fashion you need to get access to this data somehow, but you can't, so the file is generated sort of externally to sagelib, using data from sage-the-distribution.
> 
> A similar problem applies to #29119.  [...]

There is a really easy solution:  
- `bootstrap` is only allowed in the full distribution source, not in a separate sagelib source. No hardlinks necessary. Only developers bootstrap.
- Users don't bootstrap, they start with the configure phase. 
- sdist of the distribution and sdist of sagelib generate bootstrapped source archives.



---

archive/issue_comments_375935.json:
```json
{
    "body": "Replying to [comment:24 embray]:\n> Sure, but what is required for running `make sdist`? \n\nObviously, it requires exactly a bootstrapped source tree!\n\n>  It seems to me this should be done in two separate cases: One when running `make sdist` and one when developing out of source.  In either case I don't think the bootstrap script is the appropriate place for it.\n> \n> The only reason you seem to be putting it there is that it would happen to cover both cases, but I think both cases should be handled separately.\n\n`bootstrap` is the phase before `configure`, which does not depend on the configuration of the system.",
    "created_at": "2020-02-12T18:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375935",
    "user": "mkoeppe"
}
```

Replying to [comment:24 embray]:
> Sure, but what is required for running `make sdist`? 

Obviously, it requires exactly a bootstrapped source tree!

>  It seems to me this should be done in two separate cases: One when running `make sdist` and one when developing out of source.  In either case I don't think the bootstrap script is the appropriate place for it.
> 
> The only reason you seem to be putting it there is that it would happen to cover both cases, but I think both cases should be handled separately.

`bootstrap` is the phase before `configure`, which does not depend on the configuration of the system.



---

archive/issue_comments_375936.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-12T19:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375936",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375937.json:
```json
{
    "body": "Replying to [comment:27 mkoeppe]:\n> Replying to [comment:26 jhpalmieri]:\n> > How is this supposed to work with an incremental build?\n> Thanks for catching this -- I need to add some dependencies\nDone.",
    "created_at": "2020-02-12T19:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375937",
    "user": "mkoeppe"
}
```

Replying to [comment:27 mkoeppe]:
> Replying to [comment:26 jhpalmieri]:
> > How is this supposed to work with an incremental build?
> Thanks for catching this -- I need to add some dependencies
Done.



---

archive/issue_comments_375938.json:
```json
{
    "body": "That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. By the way, I'm not sure whether I like the old style\n\n```\n     $ sudo apt-get install binutils pixz gcc g++ gfortran make m4 perl tar \\\n       git patch openssl libssl-dev libz-dev bc libbz2-dev liblzma-dev libgmp-dev \\\n       libffi-dev libgf2x-dev libcurl4-openssl-dev libzmq3-dev curl yasm \\\n       pkg-config libntl-dev libmpfr-dev libmpc-dev libflint-dev \\\n       libpcre3-dev libgd-dev libflint-dev libflint-arb-dev \\\n       libsymmetrica2-dev gmp-ecm libecm-dev libisl-dev libgivaro-dev \\\n       libpari-dev pari-gp2c libec-dev liblrcalc-dev \\\n       libm4ri-dev libm4rie-dev liblfunction-dev lcalc \\\n       libopenblas-dev r-base-dev libgsl-dev libcliquer-dev cliquer\n```\n\nor the new style\n\n```\n    $ sudo yum install binutils boost-devel bzip2 bzip2-devel curl eclib-devel findutils gcc gcc gcc-c++ gcc-c++ gcc-gfortran gcc-gfortran gfan git givaro-devel gmp gmp-devel gmp-ecm-devel libcurl-devel libmpc-devel lrcalc-devel m4 m4ri-devel m4rie-devel make mpfr-devel nauty ncurses-devel ntl-devel openblas-devel pari-devel pari-elldata pari-galdata pari-galdata pari-galpol pari-gp pari-seadata patch perl perl-ExtUtils-MakeMaker pkg-config python3 readline-devel rw-devel symmetrica-devel tar which xz xz-devel yasm zlib-devel\n```\n\nbetter.\n\nIs there a ticket which adds homebrew information to the `installation/source.rst`?",
    "created_at": "2020-02-12T19:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375938",
    "user": "jhpalmieri"
}
```

That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. By the way, I'm not sure whether I like the old style

```
     $ sudo apt-get install binutils pixz gcc g++ gfortran make m4 perl tar \
       git patch openssl libssl-dev libz-dev bc libbz2-dev liblzma-dev libgmp-dev \
       libffi-dev libgf2x-dev libcurl4-openssl-dev libzmq3-dev curl yasm \
       pkg-config libntl-dev libmpfr-dev libmpc-dev libflint-dev \
       libpcre3-dev libgd-dev libflint-dev libflint-arb-dev \
       libsymmetrica2-dev gmp-ecm libecm-dev libisl-dev libgivaro-dev \
       libpari-dev pari-gp2c libec-dev liblrcalc-dev \
       libm4ri-dev libm4rie-dev liblfunction-dev lcalc \
       libopenblas-dev r-base-dev libgsl-dev libcliquer-dev cliquer
```

or the new style

```
    $ sudo yum install binutils boost-devel bzip2 bzip2-devel curl eclib-devel findutils gcc gcc gcc-c++ gcc-c++ gcc-gfortran gcc-gfortran gfan git givaro-devel gmp gmp-devel gmp-ecm-devel libcurl-devel libmpc-devel lrcalc-devel m4 m4ri-devel m4rie-devel make mpfr-devel nauty ncurses-devel ntl-devel openblas-devel pari-devel pari-elldata pari-galdata pari-galdata pari-galpol pari-gp pari-seadata patch perl perl-ExtUtils-MakeMaker pkg-config python3 readline-devel rw-devel symmetrica-devel tar which xz xz-devel yasm zlib-devel
```

better.

Is there a ticket which adds homebrew information to the `installation/source.rst`?



---

archive/issue_comments_375939.json:
```json
{
    "body": "Replying to [comment:32 jhpalmieri]:\n> That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. \n\nThe *generated* files are in `src/doc/en/installation`. The source files are in `build/pkgs/`. Hence the dependency that I added. Changes to the .txt files trigger bootstrapping.",
    "created_at": "2020-02-12T19:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375939",
    "user": "mkoeppe"
}
```

Replying to [comment:32 jhpalmieri]:
> That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. 

The *generated* files are in `src/doc/en/installation`. The source files are in `build/pkgs/`. Hence the dependency that I added. Changes to the .txt files trigger bootstrapping.



---

archive/issue_comments_375940.json:
```json
{
    "body": "Replying to [comment:32 jhpalmieri]:\n> Is there a ticket which adds homebrew information to the `installation/source.rst`?\n\n#29104 is for homebrew. I haven't added the package information there yet -- any help is very welcome!",
    "created_at": "2020-02-12T19:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375940",
    "user": "mkoeppe"
}
```

Replying to [comment:32 jhpalmieri]:
> Is there a ticket which adds homebrew information to the `installation/source.rst`?

#29104 is for homebrew. I haven't added the package information there yet -- any help is very welcome!



---

archive/issue_comments_375941.json:
```json
{
    "body": "Replying to [comment:33 mkoeppe]:\n> Replying to [comment:32 jhpalmieri]:\n> > That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. \n> \n> The *generated* files are in `src/doc/en/installation`. The source files are in `build/pkgs/`. Hence the dependency that I added. Changes to the .txt files trigger bootstrapping.\n\nBut this ticket doesn't change any of those .txt files. In my case I have Sage 9.1.beta3, then I switch to this branch and `make` fails, even with your latest branch. Is there no way to avoid this?\n\n```\n$ git checkout t/26964/__bootstrap__format_build_pkgs_spkg_distros__information_to_produce_the_apt_get_yum_command_lines_shown_in_the_installation_manual \nSwitched to branch 't/26964/__bootstrap__format_build_pkgs_spkg_distros__information_to_produce_the_apt_get_yum_command_lines_shown_in_the_installation_manual'\n$ make configure\nmake: `configure' is up to date.\n```\n\n`./bootstrap -d` generates the correct files, but I have to run it manually.",
    "created_at": "2020-02-12T19:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375941",
    "user": "jhpalmieri"
}
```

Replying to [comment:33 mkoeppe]:
> Replying to [comment:32 jhpalmieri]:
> > That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. 
> 
> The *generated* files are in `src/doc/en/installation`. The source files are in `build/pkgs/`. Hence the dependency that I added. Changes to the .txt files trigger bootstrapping.

But this ticket doesn't change any of those .txt files. In my case I have Sage 9.1.beta3, then I switch to this branch and `make` fails, even with your latest branch. Is there no way to avoid this?

```
$ git checkout t/26964/__bootstrap__format_build_pkgs_spkg_distros__information_to_produce_the_apt_get_yum_command_lines_shown_in_the_installation_manual 
Switched to branch 't/26964/__bootstrap__format_build_pkgs_spkg_distros__information_to_produce_the_apt_get_yum_command_lines_shown_in_the_installation_manual'
$ make configure
make: `configure' is up to date.
```

`./bootstrap -d` generates the correct files, but I have to run it manually.



---

archive/issue_comments_375942.json:
```json
{
    "body": "the idea is that one can `make configure` is not a good one. `configure` is \"built\" by autoconf, not by make.\n\ncan we get rid of `configure` target?",
    "created_at": "2020-02-12T20:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375942",
    "user": "dimpase"
}
```

the idea is that one can `make configure` is not a good one. `configure` is "built" by autoconf, not by make.

can we get rid of `configure` target?



---

archive/issue_comments_375943.json:
```json
{
    "body": "Replying to [comment:32 jhpalmieri]:\n> That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. By the way, I'm not sure whether I like the old style\n> {{{\n>      $ sudo apt-get install binutils pixz gcc g++ gfortran make m4 perl tar \\\n>        git patch openssl libssl-dev libz-dev bc libbz2-dev liblzma-dev libgmp-dev \\\n>        libffi-dev libgf2x-dev libcurl4-openssl-dev libzmq3-dev curl yasm \\\n>        pkg-config libntl-dev libmpfr-dev libmpc-dev libflint-dev \\\n>        libpcre3-dev libgd-dev libflint-dev libflint-arb-dev \\\n>        libsymmetrica2-dev gmp-ecm libecm-dev libisl-dev libgivaro-dev \\\n>        libpari-dev pari-gp2c libec-dev liblrcalc-dev \\\n>        libm4ri-dev libm4rie-dev liblfunction-dev lcalc \\\n>        libopenblas-dev r-base-dev libgsl-dev libcliquer-dev cliquer\n> }}}\n> or the new style\n> {{{\n>     $ sudo yum install binutils boost-devel bzip2 bzip2-devel curl eclib-devel findutils gcc gcc gcc-c++ gcc-c++ gcc-gfortran gcc-gfortran gfan git givaro-devel gmp gmp-devel gmp-ecm-devel libcurl-devel libmpc-devel lrcalc-devel m4 m4ri-devel m4rie-devel make mpfr-devel nauty ncurses-devel ntl-devel openblas-devel pari-devel pari-elldata pari-galdata pari-galdata pari-galpol pari-gp pari-seadata patch perl perl-ExtUtils-MakeMaker pkg-config python3 readline-devel rw-devel symmetrica-devel tar which xz xz-devel yasm zlib-devel\n> }}}\n> better.\n\nthe new style is built automatically, whereas the old one was manual.\nOne can surely hack further to add insertion of ` \\` after ~80 chars, but it's certainlty minor...",
    "created_at": "2020-02-12T20:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375943",
    "user": "dimpase"
}
```

Replying to [comment:32 jhpalmieri]:
> That doesn't help, because the necessary text files are not `build/pkgs/*.txt build/pkgs/*/distros/*.txt` but rather in `src/doc/en/installation`. By the way, I'm not sure whether I like the old style
> {{{
>      $ sudo apt-get install binutils pixz gcc g++ gfortran make m4 perl tar \
>        git patch openssl libssl-dev libz-dev bc libbz2-dev liblzma-dev libgmp-dev \
>        libffi-dev libgf2x-dev libcurl4-openssl-dev libzmq3-dev curl yasm \
>        pkg-config libntl-dev libmpfr-dev libmpc-dev libflint-dev \
>        libpcre3-dev libgd-dev libflint-dev libflint-arb-dev \
>        libsymmetrica2-dev gmp-ecm libecm-dev libisl-dev libgivaro-dev \
>        libpari-dev pari-gp2c libec-dev liblrcalc-dev \
>        libm4ri-dev libm4rie-dev liblfunction-dev lcalc \
>        libopenblas-dev r-base-dev libgsl-dev libcliquer-dev cliquer
> }}}
> or the new style
> {{{
>     $ sudo yum install binutils boost-devel bzip2 bzip2-devel curl eclib-devel findutils gcc gcc gcc-c++ gcc-c++ gcc-gfortran gcc-gfortran gfan git givaro-devel gmp gmp-devel gmp-ecm-devel libcurl-devel libmpc-devel lrcalc-devel m4 m4ri-devel m4rie-devel make mpfr-devel nauty ncurses-devel ntl-devel openblas-devel pari-devel pari-elldata pari-galdata pari-galdata pari-galpol pari-gp pari-seadata patch perl perl-ExtUtils-MakeMaker pkg-config python3 readline-devel rw-devel symmetrica-devel tar which xz xz-devel yasm zlib-devel
> }}}
> better.

the new style is built automatically, whereas the old one was manual.
One can surely hack further to add insertion of ` \` after ~80 chars, but it's certainlty minor...



---

archive/issue_comments_375944.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-12T20:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375944",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375945.json:
```json
{
    "body": "Replying to [comment:35 jhpalmieri]:\n> But this ticket doesn't change any of those .txt files. In my case I have Sage 9.1.beta3, then I switch to this branch and `make` fails, even with your latest branch. Is there no way to avoid this?\n\nThanks! \nI've added more dependencies to the `make configure` target that should take care of this case.",
    "created_at": "2020-02-12T20:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375945",
    "user": "mkoeppe"
}
```

Replying to [comment:35 jhpalmieri]:
> But this ticket doesn't change any of those .txt files. In my case I have Sage 9.1.beta3, then I switch to this branch and `make` fails, even with your latest branch. Is there no way to avoid this?

Thanks! 
I've added more dependencies to the `make configure` target that should take care of this case.



---

archive/issue_comments_375946.json:
```json
{
    "body": "Replying to [comment:36 dimpase]:\n> the idea is that one can `make configure` is not a good one. `configure` is \"built\" by autoconf, not by make.\n\nI don't think there's anything wrong with these make targets -- also autotools have them (in maintainer mode).",
    "created_at": "2020-02-12T20:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375946",
    "user": "mkoeppe"
}
```

Replying to [comment:36 dimpase]:
> the idea is that one can `make configure` is not a good one. `configure` is "built" by autoconf, not by make.

I don't think there's anything wrong with these make targets -- also autotools have them (in maintainer mode).



---

archive/issue_comments_375947.json:
```json
{
    "body": "a typical autotools project won't have a Makefile in unbuilt state, only Makefile.am",
    "created_at": "2020-02-12T21:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375947",
    "user": "dimpase"
}
```

a typical autotools project won't have a Makefile in unbuilt state, only Makefile.am



---

archive/issue_comments_375948.json:
```json
{
    "body": "That is true, but there are Makefile targets that regenerate configure etc. from configure.ac.",
    "created_at": "2020-02-12T21:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375948",
    "user": "mkoeppe"
}
```

That is true, but there are Makefile targets that regenerate configure etc. from configure.ac.



---

archive/issue_comments_375949.json:
```json
{
    "body": "That works for me, thanks.\n\nI don't in general ever use `make configure` explicitly, but I was trying to get the previous versions of this branch to work so I tried it. With the most recent branch, I can just check it out and run `make`.",
    "created_at": "2020-02-12T21:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375949",
    "user": "jhpalmieri"
}
```

That works for me, thanks.

I don't in general ever use `make configure` explicitly, but I was trying to get the previous versions of this branch to work so I tried it. With the most recent branch, I can just check it out and run `make`.



---

archive/issue_comments_375950.json:
```json
{
    "body": "is `sage-print-system-package-command` meant to runnable by the user, or it's a \"service\" script?",
    "created_at": "2020-02-14T19:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375950",
    "user": "dimpase"
}
```

is `sage-print-system-package-command` meant to runnable by the user, or it's a "service" script?



---

archive/issue_comments_375951.json:
```json
{
    "body": "It's an internal script of sage the distribution. That's why it's in build/bin.",
    "created_at": "2020-02-14T19:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375951",
    "user": "mkoeppe"
}
```

It's an internal script of sage the distribution. That's why it's in build/bin.



---

archive/issue_comments_375952.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-14T20:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375952",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375953.json:
```json
{
    "body": "OK, the only nitpck is that on modern Fedora's it's `dnf`, not `yum`.",
    "created_at": "2020-02-14T20:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375953",
    "user": "dimpase"
}
```

OK, the only nitpck is that on modern Fedora's it's `dnf`, not `yum`.



---

archive/issue_comments_375954.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-02-14T20:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375954",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_375955.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-02-21T22:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375955",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_375956.json:
```json
{
    "body": "This breaks incremental builds: #29233",
    "created_at": "2020-02-22T16:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26727#issuecomment-375956",
    "user": "vbraun"
}
```

This breaks incremental builds: #29233
