# Issue 32440: sage.rings.real_double: Move methods using GSL to a separate extension module

archive/issues_032440.json:
```json
{
    "body": "CC:  @dimpase @kiwifb @williamstein @tscrim\n\nDiscussion: https://groups.google.com/g/sage-devel/c/HTN6KoqZVJQ/m/2BzAx5erBAAJ\n\nIssue created by migration from https://trac.sagemath.org/ticket/32677\n\n",
    "created_at": "2021-10-12T22:47:13Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "sage.rings.real_double: Move methods using GSL to a separate extension module",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32440",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @kiwifb @williamstein @tscrim

Discussion: https://groups.google.com/g/sage-devel/c/HTN6KoqZVJQ/m/2BzAx5erBAAJ

Issue created by migration from https://trac.sagemath.org/ticket/32677





---

archive/issue_comments_462218.json:
```json
{
    "body": "This simple change already breaks stuff.... what am I doing wrong?\n----\nNew commits:",
    "created_at": "2021-10-12T23:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462218",
    "user": "https://github.com/mkoeppe"
}
```

This simple change already breaks stuff.... what am I doing wrong?
----
New commits:



---

archive/issue_comments_462219.json:
```json
{
    "body": "Are you doing an incremental build? I pointed sage-on-gentoo to your commit and so far it has compiled sage for python3.8 and python3.9 is on its way. I won't know about doc building breakages without being a bit more involved.",
    "created_at": "2021-10-12T23:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462219",
    "user": "https://github.com/kiwifb"
}
```

Are you doing an incremental build? I pointed sage-on-gentoo to your commit and so far it has compiled sage for python3.8 and python3.9 is on its way. I won't know about doc building breakages without being a bit more involved.



---

archive/issue_comments_462220.json:
```json
{
    "body": "Installing \"sagemath-standard\" works here as far as I can tell.",
    "created_at": "2021-10-12T23:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462220",
    "user": "https://github.com/kiwifb"
}
```

Installing "sagemath-standard" works here as far as I can tell.



---

archive/issue_comments_462221.json:
```json
{
    "body": "Yes, it compiles but doctests fail:\n\n```\nsage -t --random-seed=0 src/sage/rings/infinity.py  # 4 doctests failed\nsage -t --random-seed=0 src/sage/rings/complex_double.pyx  # 4 doctests failed\nsage -t --random-seed=0 src/sage/rings/real_double.pyx  # 10 doctests failed\n```\n",
    "created_at": "2021-10-12T23:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462221",
    "user": "https://github.com/mkoeppe"
}
```

Yes, it compiles but doctests fail:

```
sage -t --random-seed=0 src/sage/rings/infinity.py  # 4 doctests failed
sage -t --random-seed=0 src/sage/rings/complex_double.pyx  # 4 doctests failed
sage -t --random-seed=0 src/sage/rings/real_double.pyx  # 10 doctests failed
```




---

archive/issue_comments_462222.json:
```json
{
    "body": "I only get those\n\n```\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx  # 2 doctests failed\n```\n\nAnd it looks like conversion from boolean to integer issues\n\n```\nfbissey@tarazed ~ $ sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-10-13-13-12-48-70eba795.\nUsing --optional=dochtml,pip,sage\nDoctesting 1 file.\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx\", line 1626, in sage.rings.complex_double.ComplexDoubleElement.is_infinity\nFailed example:\n    CDF(1, 2).is_infinity()\nExpected:\n    False\nGot:\n    0\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx\", line 1628, in sage.rings.complex_double.ComplexDoubleElement.is_infinity\nFailed example:\n    CDF(0, oo).is_infinity()\nExpected:\n    True\nGot:\n    1\n**********************************************************************\n1 item had failures:\n   2 of   3 in sage.rings.complex_double.ComplexDoubleElement.is_infinity\n    [345 tests, 2 failures, 0.18 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.3 seconds\n    cpu time: 0.2 seconds\n    cumulative wall time: 0.2 seconds\nPytest is not installed, skip checking tests that rely on it.\nfbissey@tarazed ~ $ sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-10-13-13-13-13-b89854b8.\nUsing --optional=dochtml,pip,sage\nDoctesting 1 file.\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/rings/real_double.pyx\", line 1730, in sage.rings.real_double.RealDoubleElement.is_infinity\nFailed example:\n    (a/b).is_infinity()\nExpected:\n    True\nGot:\n    1\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/rings/real_double.pyx\", line 1732, in sage.rings.real_double.RealDoubleElement.is_infinity\nFailed example:\n    (b/a).is_infinity()\nExpected:\n    False\nGot:\n    0\n**********************************************************************\n1 item had failures:\n   2 of   4 in sage.rings.real_double.RealDoubleElement.is_infinity\n    [454 tests, 2 failures, 0.15 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.2 seconds\n    cpu time: 0.1 seconds\n    cumulative wall time: 0.2 seconds\n```\n",
    "created_at": "2021-10-13T00:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462222",
    "user": "https://github.com/kiwifb"
}
```

I only get those

```
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx  # 2 doctests failed
```

And it looks like conversion from boolean to integer issues

```
fbissey@tarazed ~ $ sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx
too many failed tests, not using stored timings
Running doctests with ID 2021-10-13-13-12-48-70eba795.
Using --optional=dochtml,pip,sage
Doctesting 1 file.
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx", line 1626, in sage.rings.complex_double.ComplexDoubleElement.is_infinity
Failed example:
    CDF(1, 2).is_infinity()
Expected:
    False
Got:
    0
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx", line 1628, in sage.rings.complex_double.ComplexDoubleElement.is_infinity
Failed example:
    CDF(0, oo).is_infinity()
Expected:
    True
Got:
    1
**********************************************************************
1 item had failures:
   2 of   3 in sage.rings.complex_double.ComplexDoubleElement.is_infinity
    [345 tests, 2 failures, 0.18 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/complex_double.pyx  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.3 seconds
    cpu time: 0.2 seconds
    cumulative wall time: 0.2 seconds
Pytest is not installed, skip checking tests that rely on it.
fbissey@tarazed ~ $ sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx
too many failed tests, not using stored timings
Running doctests with ID 2021-10-13-13-13-13-b89854b8.
Using --optional=dochtml,pip,sage
Doctesting 1 file.
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/rings/real_double.pyx", line 1730, in sage.rings.real_double.RealDoubleElement.is_infinity
Failed example:
    (a/b).is_infinity()
Expected:
    True
Got:
    1
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/rings/real_double.pyx", line 1732, in sage.rings.real_double.RealDoubleElement.is_infinity
Failed example:
    (b/a).is_infinity()
Expected:
    False
Got:
    0
**********************************************************************
1 item had failures:
   2 of   4 in sage.rings.real_double.RealDoubleElement.is_infinity
    [454 tests, 2 failures, 0.15 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/rings/real_double.pyx  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.2 seconds
    cpu time: 0.1 seconds
    cumulative wall time: 0.2 seconds
```




---

archive/issue_comments_462223.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-15T22:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462224.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-16T02:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462225.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-16T02:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462226.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-16T02:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462226",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462227.json:
```json
{
    "body": "`@`fbissey Are you going to do a full review of this?\n\nFrom the patchbot, we have three trivial failures:\n\n```\nsage -t --long --random-seed=0 src/sage/misc/functional.py\n**********************************************************************\nFile \"src/sage/misc/functional.py\", line 1540, in sage.misc.functional.round\nFailed example:\n    type(q)\nExpected:\n    <type 'sage.rings.real_double.RealDoubleElement'>\nGot:\n    <class 'sage.rings.real_double_element_gsl.RealDoubleElement_gsl'>\n**********************************************************************\n```\n\n\n```\nsage -t --long --random-seed=0 src/sage/libs/mpmath/utils.pyx\n**********************************************************************\nFile \"src/sage/libs/mpmath/utils.pyx\", line 408, in sage.libs.mpmath.utils.call\nFailed example:\n    type(_)\nExpected:\n    <type 'sage.rings.real_double.RealDoubleElement'>\nGot:\n    <class 'sage.rings.real_double_element_gsl.RealDoubleElement_gsl'>\n**********************************************************************\n```\n\n\n```\nsage -t --long --random-seed=0 src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 1689, in sage.symbolic.expression.Expression._convert\nFailed example:\n    type(_.pyobject())\nExpected:\n    <type 'sage.rings.real_double.RealDoubleElement'>\nGot:\n    <class 'sage.rings.real_double_element_gsl.RealDoubleElement_gsl'>\n**********************************************************************\n```\n",
    "created_at": "2021-10-18T04:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462227",
    "user": "https://github.com/tscrim"
}
```

`@`fbissey Are you going to do a full review of this?

From the patchbot, we have three trivial failures:

```
sage -t --long --random-seed=0 src/sage/misc/functional.py
**********************************************************************
File "src/sage/misc/functional.py", line 1540, in sage.misc.functional.round
Failed example:
    type(q)
Expected:
    <type 'sage.rings.real_double.RealDoubleElement'>
Got:
    <class 'sage.rings.real_double_element_gsl.RealDoubleElement_gsl'>
**********************************************************************
```


```
sage -t --long --random-seed=0 src/sage/libs/mpmath/utils.pyx
**********************************************************************
File "src/sage/libs/mpmath/utils.pyx", line 408, in sage.libs.mpmath.utils.call
Failed example:
    type(_)
Expected:
    <type 'sage.rings.real_double.RealDoubleElement'>
Got:
    <class 'sage.rings.real_double_element_gsl.RealDoubleElement_gsl'>
**********************************************************************
```


```
sage -t --long --random-seed=0 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 1689, in sage.symbolic.expression.Expression._convert
Failed example:
    type(_.pyobject())
Expected:
    <type 'sage.rings.real_double.RealDoubleElement'>
Got:
    <class 'sage.rings.real_double_element_gsl.RealDoubleElement_gsl'>
**********************************************************************
```




---

archive/issue_comments_462228.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-18T05:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462228",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462229.json:
```json
{
    "body": "Was about to do a bit of reviewing. I need to pull the latest changes now.",
    "created_at": "2021-10-18T06:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462229",
    "user": "https://github.com/kiwifb"
}
```

Was about to do a bit of reviewing. I need to pull the latest changes now.



---

archive/issue_comments_462230.json:
```json
{
    "body": "I will leave the review to you `:)`.",
    "created_at": "2021-10-18T06:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462230",
    "user": "https://github.com/tscrim"
}
```

I will leave the review to you `:)`.



---

archive/issue_comments_462231.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-18T07:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462231",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462232.json:
```json
{
    "body": "Let's move this on.",
    "created_at": "2021-10-18T07:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462232",
    "user": "https://github.com/kiwifb"
}
```

Let's move this on.



---

archive/issue_comments_462233.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-10-18T16:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462233",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_086524.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-20T23:00:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32440#event-86524"
}
```



---

archive/issue_comments_462234.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-20T23:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462234",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_462235.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2021-10-21T22:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462235",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_462236.json:
```json
{
    "body": "Lots of failures of the form\n\n```\nsage -t --long --random-seed=95492849111503266761374143413906402145 src/doc/de/thematische_anleitungen/sage_gymnasium.rst\n**********************************************************************\nFile \"src/doc/de/thematische_anleitungen/sage_gymnasium.rst\", line 667, in doc.de.thematische_anleitungen.sage_gymnasium\nFailed example:\n    plot(f, xmin=-2, xmax=2, ymin=-10, ymax = 10, detect_poles=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest doc.de.thematische_anleitungen.sage_gymnasium[1]>\", line 1, in <module>\n        plot(f, xmin=-Integer(2), xmax=Integer(2), ymin=-Integer(10), ymax = Integer(10), detect_poles=True)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py\", line 491, in wrapper\n        return func(*args, **options)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py\", line 1957, in plot\n        G = funcs.plot(*args, **original_opts)\n      File \"sage/symbolic/expression.pyx\", line 12775, in sage.symbolic.expression.Expression.plot (build/cythonized/sage/symbolic/expression.cpp:94231)\n        return plot(f, *args, **kwds)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py\", line 491, in wrapper\n        return func(*args, **options)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py\", line 1972, in plot\n        G = _plot(funcs, (xmin, xmax), **kwds)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py\", line 2419, in _plot\n        alpha = (RDF(dy)/RDF(dx)).arctan()\n      File \"sage/structure/element.pyx\", line 494, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4755)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 507, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4867)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 363, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2634)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute 'arctan'\n**********************************************************************\nFile \"src/doc/de/thematische_anleitungen/sage_gymnasium.rst\", line 674, in doc.de.thematische_anleitungen.sage_gymnasium\nFailed example:\n    plot(f, xmin=-2, xmax=2, ymin=-10, ymax = 10, detect_poles=\"show\")\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest doc.de.thematische_anleitungen.sage_gymnasium[1]>\", line 1, in <module>\n        plot(f, xmin=-Integer(2), xmax=Integer(2), ymin=-Integer(10), ymax = Integer(10), detect_poles=\"show\")\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py\", line 491, in wrapper\n        return func(*args, **options)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py\", line 1957, in plot\n        G = funcs.plot(*args, **original_opts)\n      File \"sage/symbolic/expression.pyx\", line 12775, in sage.symbolic.expression.Expression.plot (build/cythonized/sage/symbolic/expression.cpp:94231)\n        return plot(f, *args, **kwds)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py\", line 491, in wrapper\n        return func(*args, **options)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py\", line 1972, in plot\n        G = _plot(funcs, (xmin, xmax), **kwds)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py\", line 2419, in _plot\n        alpha = (RDF(dy)/RDF(dx)).arctan()\n      File \"sage/structure/element.pyx\", line 494, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4755)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 507, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4867)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 363, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2634)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute 'arctan'\n**********************************************************************\n1 item had failures:\n   2 of 294 in doc.de.thematische_anleitungen.sage_gymnasium\n    [207 tests, 2 failures, 2.47 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=95492849111503266761374143413906402145 src/doc/de/thematische_anleitungen/sage_gymnasium.rst  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\n----\nNew commits:",
    "created_at": "2021-10-21T22:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462236",
    "user": "https://github.com/vbraun"
}
```

Lots of failures of the form

```
sage -t --long --random-seed=95492849111503266761374143413906402145 src/doc/de/thematische_anleitungen/sage_gymnasium.rst
**********************************************************************
File "src/doc/de/thematische_anleitungen/sage_gymnasium.rst", line 667, in doc.de.thematische_anleitungen.sage_gymnasium
Failed example:
    plot(f, xmin=-2, xmax=2, ymin=-10, ymax = 10, detect_poles=True)
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.de.thematische_anleitungen.sage_gymnasium[1]>", line 1, in <module>
        plot(f, xmin=-Integer(2), xmax=Integer(2), ymin=-Integer(10), ymax = Integer(10), detect_poles=True)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py", line 491, in wrapper
        return func(*args, **options)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py", line 1957, in plot
        G = funcs.plot(*args, **original_opts)
      File "sage/symbolic/expression.pyx", line 12775, in sage.symbolic.expression.Expression.plot (build/cythonized/sage/symbolic/expression.cpp:94231)
        return plot(f, *args, **kwds)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py", line 491, in wrapper
        return func(*args, **options)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py", line 1972, in plot
        G = _plot(funcs, (xmin, xmax), **kwds)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py", line 2419, in _plot
        alpha = (RDF(dy)/RDF(dx)).arctan()
      File "sage/structure/element.pyx", line 494, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4755)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 507, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4867)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 363, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2634)
        raise AttributeError(dummy_error_message)
    AttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute 'arctan'
**********************************************************************
File "src/doc/de/thematische_anleitungen/sage_gymnasium.rst", line 674, in doc.de.thematische_anleitungen.sage_gymnasium
Failed example:
    plot(f, xmin=-2, xmax=2, ymin=-10, ymax = 10, detect_poles="show")
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.de.thematische_anleitungen.sage_gymnasium[1]>", line 1, in <module>
        plot(f, xmin=-Integer(2), xmax=Integer(2), ymin=-Integer(10), ymax = Integer(10), detect_poles="show")
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py", line 491, in wrapper
        return func(*args, **options)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py", line 1957, in plot
        G = funcs.plot(*args, **original_opts)
      File "sage/symbolic/expression.pyx", line 12775, in sage.symbolic.expression.Expression.plot (build/cythonized/sage/symbolic/expression.cpp:94231)
        return plot(f, *args, **kwds)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/misc/decorators.py", line 491, in wrapper
        return func(*args, **options)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py", line 1972, in plot
        G = _plot(funcs, (xmin, xmax), **kwds)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/plot/plot.py", line 2419, in _plot
        alpha = (RDF(dy)/RDF(dx)).arctan()
      File "sage/structure/element.pyx", line 494, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4755)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 507, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4867)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 363, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2634)
        raise AttributeError(dummy_error_message)
    AttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute 'arctan'
**********************************************************************
1 item had failures:
   2 of 294 in doc.de.thematische_anleitungen.sage_gymnasium
    [207 tests, 2 failures, 2.47 s]
----------------------------------------------------------------------
sage -t --long --random-seed=95492849111503266761374143413906402145 src/doc/de/thematische_anleitungen/sage_gymnasium.rst  # 2 doctests failed
----------------------------------------------------------------------
```

----
New commits:



---

archive/issue_comments_462237.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2021-10-21T22:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462237",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_086525.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-21T22:40:57Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32440#event-86525"
}
```



---

archive/issue_comments_462238.json:
```json
{
    "body": "With some diagnostics added:\n\n```\ndiff --git a/src/sage/rings/real_double.pyx b/src/sage/rings/real_double.pyx\nindex 79ddbcf279..03f1ea767e 100644\n--- a/src/sage/rings/real_double.pyx\n+++ b/src/sage/rings/real_double.pyx\n@@ -2178,9 +2178,11 @@ from sage.misc.allocator cimport hook_tp_functions, hook_tp_functions_type\n hook_tp_functions(global_dummy_element, <newfunc>(&fast_tp_new), <destructor>(&fast_tp_dealloc), False)\n try:\n     from .real_double_element_gsl import RealDoubleElement_gsl\n-except Exception:\n+except Exception as e:\n+    print(\"Error: {}\".format(e))\n     pass\n else:\n+    print(\"Hooking RealDoubleElement_gsl\")\n     # global_dummy_element is of type RealDoubleElement_gsl,\n     # so hook the base class now.\n     hook_tp_functions_type(RealDoubleElement, <newfunc>(&fast_tp_new), <destructor>(&fast_tp_dealloc), False)\n```\n\none sees: `Error: cannot import name ComplexField`.",
    "created_at": "2021-10-21T23:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462238",
    "user": "https://github.com/mkoeppe"
}
```

With some diagnostics added:

```
diff --git a/src/sage/rings/real_double.pyx b/src/sage/rings/real_double.pyx
index 79ddbcf279..03f1ea767e 100644
--- a/src/sage/rings/real_double.pyx
+++ b/src/sage/rings/real_double.pyx
@@ -2178,9 +2178,11 @@ from sage.misc.allocator cimport hook_tp_functions, hook_tp_functions_type
 hook_tp_functions(global_dummy_element, <newfunc>(&fast_tp_new), <destructor>(&fast_tp_dealloc), False)
 try:
     from .real_double_element_gsl import RealDoubleElement_gsl
-except Exception:
+except Exception as e:
+    print("Error: {}".format(e))
     pass
 else:
+    print("Hooking RealDoubleElement_gsl")
     # global_dummy_element is of type RealDoubleElement_gsl,
     # so hook the base class now.
     hook_tp_functions_type(RealDoubleElement, <newfunc>(&fast_tp_new), <destructor>(&fast_tp_dealloc), False)
```

one sees: `Error: cannot import name ComplexField`.



---

archive/issue_comments_462239.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-21T23:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462240.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-21T23:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462240",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462241.json:
```json
{
    "body": "I hadn't seen any of that in a full ptestlong, why did Volker see something and not me?",
    "created_at": "2021-10-22T00:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462241",
    "user": "https://github.com/kiwifb"
}
```

I hadn't seen any of that in a full ptestlong, why did Volker see something and not me?



---

archive/issue_comments_462242.json:
```json
{
    "body": "This failure came from the combination with other changes that 9.5.beta4 has included, which must have made some changes to the import order.",
    "created_at": "2021-10-22T00:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462242",
    "user": "https://github.com/mkoeppe"
}
```

This failure came from the combination with other changes that 9.5.beta4 has included, which must have made some changes to the import order.



---

archive/issue_comments_462243.json:
```json
{
    "body": "OK, that would make sense. I am having a long week end, if someone want to do a new review before Monday evening (NZT) they are welcome to it.",
    "created_at": "2021-10-22T00:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462243",
    "user": "https://github.com/kiwifb"
}
```

OK, that would make sense. I am having a long week end, if someone want to do a new review before Monday evening (NZT) they are welcome to it.



---

archive/issue_comments_462244.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-26T08:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462244",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462245.json:
```json
{
    "body": "Back to positive review for me.",
    "created_at": "2021-10-26T08:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462245",
    "user": "https://github.com/kiwifb"
}
```

Back to positive review for me.



---

archive/issue_comments_462246.json:
```json
{
    "body": "Thank you!",
    "created_at": "2021-10-26T18:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462246",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_462247.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-10-28T23:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_462248.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-10-28T23:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_462249.json:
```json
{
    "body": "trivial merge",
    "created_at": "2021-10-28T23:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462249",
    "user": "https://github.com/mkoeppe"
}
```

trivial merge



---

archive/issue_comments_462250.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-28T23:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462250",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_086526.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-31T22:21:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32440#event-86526"
}
```



---

archive/issue_comments_462251.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-31T22:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32440",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32440#issuecomment-462251",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
