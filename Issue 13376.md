# Issue 13376: Parellel map reduce on SearchForest

archive/issues_013376.json:
```json
{
    "body": "Assignee: @hivert\n\nCC:  sage-combinat @nathanncohen @jdemeyer @seblabbe\n\nKeywords: map-reduce\n\nImplement a map reduce algorithm in parallel on large sets described by a `SearchForest`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13580\n\n",
    "created_at": "2012-10-07T17:07:38Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Parellel map reduce on SearchForest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13376",
    "user": "https://github.com/hivert"
}
```
Assignee: @hivert

CC:  sage-combinat @nathanncohen @jdemeyer @seblabbe

Keywords: map-reduce

Implement a map reduce algorithm in parallel on large sets described by a `SearchForest`.

Issue created by migration from https://trac.sagemath.org/ticket/13580





---

archive/issue_comments_164230.json:
```json
{
    "body": "Salut Florent et Nathann,\n\nI am starting to think/work on #6637... I have some questions. Mainly, I would like to know what is this ticket, because the above one liner in the description does not say much...\n\n- Will SearchForest survive or not? \n- Does it replace SearchForest?\n- Does it improve SearchForest? \n- Does it use SearchForest?\n- Or is it used by SearchForest?\n\nAlso, Florent wrote on [sage-devel](https://groups.google.com/d/msg/sage-devel/5XHvEx89RlQ/Tb_QBWepC5YJ) in October 2012 that \n\n\n```\n   I'm also in the process of finalizing a patch which do parallel and even\n   distributed map-reduce on recursively enumerated sets (currently badly named\n   SearchForest, I'll change the name in my patch, ticket #13580, patch on\n   Sage-Combinat queue [1]).\n```\n\n\n- I do not see in the cited patch that the name of SearchForest is changed.\n- What would be a better name for SearchForest ?\n- What patch is the more recent? the \"old\" one or the \"experimental\" one?\n\n\n```\n    trac_13580-map_reduce-fh.patch #+experimental\n    map_reduce_improved_loop-fh.patch #+experimental\n    map_reduce_condition-fh.patch #+experimental\n    trac_13580-map_reduce-old-fh.patch \n```\n",
    "created_at": "2013-02-09T18:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164230",
    "user": "https://github.com/seblabbe"
}
```

Salut Florent et Nathann,

I am starting to think/work on #6637... I have some questions. Mainly, I would like to know what is this ticket, because the above one liner in the description does not say much...

- Will SearchForest survive or not? 
- Does it replace SearchForest?
- Does it improve SearchForest? 
- Does it use SearchForest?
- Or is it used by SearchForest?

Also, Florent wrote on [sage-devel](https://groups.google.com/d/msg/sage-devel/5XHvEx89RlQ/Tb_QBWepC5YJ) in October 2012 that 


```
   I'm also in the process of finalizing a patch which do parallel and even
   distributed map-reduce on recursively enumerated sets (currently badly named
   SearchForest, I'll change the name in my patch, ticket #13580, patch on
   Sage-Combinat queue [1]).
```


- I do not see in the cited patch that the name of SearchForest is changed.
- What would be a better name for SearchForest ?
- What patch is the more recent? the "old" one or the "experimental" one?


```
    trac_13580-map_reduce-fh.patch #+experimental
    map_reduce_improved_loop-fh.patch #+experimental
    map_reduce_condition-fh.patch #+experimental
    trac_13580-map_reduce-old-fh.patch 
```




---

archive/issue_comments_164231.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-04-09T02:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164231",
    "user": "https://github.com/hivert"
}
```

New commits:



---

archive/issue_comments_164232.json:
```json
{
    "body": "Changing keywords from \"map-reduce\" to \"map-reduce, days57\".",
    "created_at": "2014-04-09T02:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164232",
    "user": "https://github.com/hivert"
}
```

Changing keywords from "map-reduce" to "map-reduce, days57".



---

archive/issue_comments_164233.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-09T15:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164233",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-20T22:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164235.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-20T23:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164236.json:
```json
{
    "body": "I saw the following typo in map reduce file while looking at the previous commit: \"As an example, ee compute\"",
    "created_at": "2015-05-21T07:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164236",
    "user": "https://github.com/seblabbe"
}
```

I saw the following typo in map reduce file while looking at the previous commit: "As an example, ee compute"



---

archive/issue_comments_164237.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-21T15:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164237",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164238.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-23T11:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164239.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-26T11:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164240.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-01T08:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T13:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T13:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164243.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-14T14:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164243",
    "user": "https://github.com/hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_164244.json:
```json
{
    "body": "The branch currently have conflicts with development version of Sage (because the link is red in the description of the ticket above). The branch seems to be based on 6.2.beta6 which is old and may explain the presence of a conflict.",
    "created_at": "2015-12-14T16:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164244",
    "user": "https://github.com/seblabbe"
}
```

The branch currently have conflicts with development version of Sage (because the link is red in the description of the ticket above). The branch seems to be based on 6.2.beta6 which is old and may explain the presence of a conflict.



---

archive/issue_comments_164245.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-14T16:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164245",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_164246.json:
```json
{
    "body": "Replying to [comment:21 slabbe]:\n> The branch currently have conflicts with development version of Sage (because the link is red in the description of the ticket above). The branch seems to be based on 6.2.beta6 which is old and may explain the presence of a conflict.\n\nYes ! there is a trivial conflict. Thank you for pointing it. I'm fixing it, testing and re-uploading.",
    "created_at": "2015-12-14T19:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164246",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:21 slabbe]:
> The branch currently have conflicts with development version of Sage (because the link is red in the description of the ticket above). The branch seems to be based on 6.2.beta6 which is old and may explain the presence of a conflict.

Yes ! there is a trivial conflict. Thank you for pointing it. I'm fixing it, testing and re-uploading.



---

archive/issue_comments_164247.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T20:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164248.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T20:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164249.json:
```json
{
    "body": "Replying to [comment:22 hivert]:\n> Replying to [comment:21 slabbe]:\n> > The branch currently have conflicts with development version of Sage (because the link is red in the description of the ticket above). The branch seems to be based on 6.2.beta6 which is old and may explain the presence of a conflict.\n> \n> Yes ! there is a trivial conflict. Thank you for pointing it. I'm fixing it, testing and re-uploading.\n\nDone ! I was actually based on 6.9.",
    "created_at": "2015-12-14T20:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164249",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:22 hivert]:
> Replying to [comment:21 slabbe]:
> > The branch currently have conflicts with development version of Sage (because the link is red in the description of the ticket above). The branch seems to be based on 6.2.beta6 which is old and may explain the presence of a conflict.
> 
> Yes ! there is a trivial conflict. Thank you for pointing it. I'm fixing it, testing and re-uploading.

Done ! I was actually based on 6.9.



---

archive/issue_comments_164250.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-14T20:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164250",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_164251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T21:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-14T22:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-15T07:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164254.json:
```json
{
    "body": "Replying to [comment:29 git]:\n> ||[5c7720d](http://git.sagemath.org/sage.git/commit/?id=5c7720dae1034f1b2e04bb9abb3ea90797de55ee)||`Fixed doctest continuations and raise statements`||\n\nPatchbot was complaining about old style multiline doctests and exception raises. Fixed and reuped. Should be Ok now.",
    "created_at": "2015-12-15T07:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164254",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:29 git]:
> ||[5c7720d](http://git.sagemath.org/sage.git/commit/?id=5c7720dae1034f1b2e04bb9abb3ea90797de55ee)||`Fixed doctest continuations and raise statements`||

Patchbot was complaining about old style multiline doctests and exception raises. Fixed and reuped. Should be Ok now.



---

archive/issue_comments_164255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-15T16:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164256.json:
```json
{
    "body": "I just looked at the code in the browser. Looks good. I will do real code review later this week hopefully. Quickly, I saw two typos:\n\nFirst line of `/src/sage/parallel/map_reduce.py` : `Paralell`\n\nLater in the same file I think: `parameters tu the`",
    "created_at": "2015-12-15T20:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164256",
    "user": "https://github.com/seblabbe"
}
```

I just looked at the code in the browser. Looks good. I will do real code review later this week hopefully. Quickly, I saw two typos:

First line of `/src/sage/parallel/map_reduce.py` : `Paralell`

Later in the same file I think: `parameters tu the`



---

archive/issue_comments_164257.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-15T21:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164258.json:
```json
{
    "body": "Replying to [comment:32 slabbe]:\n> I just looked at the code in the browser. Looks good. I will do real code review later this week hopefully. Quickly, I saw two typos:\n\nFixed ! I'm afraid you'll find more ! By the way, removed distributed from the title since I don't do distributed computation anymore. I had a prototype which allowed to launch those computation on a cluster of machines, but it induces a huge performance loss do I dropped It. maybe we will work on this with Jeroen...",
    "created_at": "2015-12-15T21:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164258",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:32 slabbe]:
> I just looked at the code in the browser. Looks good. I will do real code review later this week hopefully. Quickly, I saw two typos:

Fixed ! I'm afraid you'll find more ! By the way, removed distributed from the title since I don't do distributed computation anymore. I had a prototype which allowed to launch those computation on a cluster of machines, but it induces a huge performance loss do I dropped It. maybe we will work on this with Jeroen...



---

archive/issue_comments_164259.json:
```json
{
    "body": "Dear Florent, I know that you like multiline doctests, but for two reasons I prefer to avoid them as much as possible in doctests:\n\n1. It is not fun for the user who wants to adapt an example after a copy paste in the console. The up arrow brings the multiline all at once and it is not fun to change the value 10 to a value 25 let say.\n2. Using variables to store the input before calling the method gives lot of information easily to the user: what are the argument names, in what order should they be used.\n\nI know I am asking you to change your style by asking you this, but don't you agree with me or can you provide some counter-arguments to mine? I give an example below:\n\n\n```diff\ndiff --git a/src/sage/combinat/backtrack.py b/src/sage/combinat/backtrack.py\nindex 9dee057..ac1243a 100644\n--- a/src/sage/combinat/backtrack.py\n+++ b/src/sage/combinat/backtrack.py\n@@ -695,17 +695,19 @@ class SearchForest(Parent):\n                    reduce_function = None,\n                    reduce_init = None):\n         r\"\"\"\n-        Apply en Map Reduce algorithm on ``self``\n+        Apply a Map Reduce algorithm on ``self``\n \n         EXAMPLES::\n \n-            sage: F = RecursivelyEnumeratedSet( [([i],i, i) for i in range(1,10)],\n-            ....:     lambda (list, sum, last):\n-            ....:         [(list + [i], sum + i, i) for i in range(1,last)],\n-            ....:     structure='forest', enumeration='depth')\n+            sage: seeds = [([i],i, i) for i in range(1,10)]\n+            sage: succ = lambda (list, sum, last): \n+            ....:               [(list + [i], sum + i, i) for i in range(1,last)]\n+            sage: F = RecursivelyEnumeratedSet(seeds, succ, \n+            ....:                       structure='forest', enumeration='depth')\n             sage: y = var('y')\n-            sage: F.map_reduce(\n-            ....:     lambda (li, sum, _): y**sum, lambda x,y: x + y,  0 )\n+            sage: map_function = lambda (li, sum, _): y**sum\n+            sage: reduce_function = lambda x,y: x + y\n+            sage: F.map_reduce(map_function, reduce_function, 0)\n             y^45 + y^44 + y^43 + 2*y^42 + 2*y^41 + 3*y^40 + 4*y^39 + 5*y^38 + 6*y^37 + 8*y^36 + 9*y^35 \n \n         .. SEEALSO:: :mod:`sage.parallel.map_reduce`\n```\n\n\nI noticed another typo on the same line as the one `parameters tu the` : `On` -> `One`",
    "created_at": "2015-12-16T11:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164259",
    "user": "https://github.com/seblabbe"
}
```

Dear Florent, I know that you like multiline doctests, but for two reasons I prefer to avoid them as much as possible in doctests:

1. It is not fun for the user who wants to adapt an example after a copy paste in the console. The up arrow brings the multiline all at once and it is not fun to change the value 10 to a value 25 let say.
2. Using variables to store the input before calling the method gives lot of information easily to the user: what are the argument names, in what order should they be used.

I know I am asking you to change your style by asking you this, but don't you agree with me or can you provide some counter-arguments to mine? I give an example below:


```diff
diff --git a/src/sage/combinat/backtrack.py b/src/sage/combinat/backtrack.py
index 9dee057..ac1243a 100644
--- a/src/sage/combinat/backtrack.py
+++ b/src/sage/combinat/backtrack.py
@@ -695,17 +695,19 @@ class SearchForest(Parent):
                    reduce_function = None,
                    reduce_init = None):
         r"""
-        Apply en Map Reduce algorithm on ``self``
+        Apply a Map Reduce algorithm on ``self``
 
         EXAMPLES::
 
-            sage: F = RecursivelyEnumeratedSet( [([i],i, i) for i in range(1,10)],
-            ....:     lambda (list, sum, last):
-            ....:         [(list + [i], sum + i, i) for i in range(1,last)],
-            ....:     structure='forest', enumeration='depth')
+            sage: seeds = [([i],i, i) for i in range(1,10)]
+            sage: succ = lambda (list, sum, last): 
+            ....:               [(list + [i], sum + i, i) for i in range(1,last)]
+            sage: F = RecursivelyEnumeratedSet(seeds, succ, 
+            ....:                       structure='forest', enumeration='depth')
             sage: y = var('y')
-            sage: F.map_reduce(
-            ....:     lambda (li, sum, _): y**sum, lambda x,y: x + y,  0 )
+            sage: map_function = lambda (li, sum, _): y**sum
+            sage: reduce_function = lambda x,y: x + y
+            sage: F.map_reduce(map_function, reduce_function, 0)
             y^45 + y^44 + y^43 + 2*y^42 + 2*y^41 + 3*y^40 + 4*y^39 + 5*y^38 + 6*y^37 + 8*y^36 + 9*y^35 
 
         .. SEEALSO:: :mod:`sage.parallel.map_reduce`
```


I noticed another typo on the same line as the one `parameters tu the` : `On` -> `One`



---

archive/issue_comments_164260.json:
```json
{
    "body": "Replying to [comment:35 slabbe]:\n> Dear Florent, I know that you like multiline doctests, but for two reasons I prefer to avoid them as much as possible in doctests:\n> \n>  1. It is not fun for the user who wants to adapt an example after a copy paste in the console. The up arrow brings the multiline all at once and it is not fun to change the value 10 to a value 25 let say.\n\nI'm tempted to answer that I don't have this problem with emacs ;-). Of course, for the people using a two letters editor...\n\n>  2. Using variables to store the input before calling the method gives lot of information easily to the user: what are the argument names, in what order should they be used.\n\nI'm much more convinced by this argument. I'm watching an exam tomorrow evening. I'll change my code accordingly.",
    "created_at": "2015-12-16T23:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164260",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:35 slabbe]:
> Dear Florent, I know that you like multiline doctests, but for two reasons I prefer to avoid them as much as possible in doctests:
> 
>  1. It is not fun for the user who wants to adapt an example after a copy paste in the console. The up arrow brings the multiline all at once and it is not fun to change the value 10 to a value 25 let say.

I'm tempted to answer that I don't have this problem with emacs ;-). Of course, for the people using a two letters editor...

>  2. Using variables to store the input before calling the method gives lot of information easily to the user: what are the argument names, in what order should they be used.

I'm much more convinced by this argument. I'm watching an exam tomorrow evening. I'll change my code accordingly.



---

archive/issue_comments_164261.json:
```json
{
    "body": "Replying to [comment:36 hivert]:\n> I'm much more convinced by this argument. I'm watching an exam tomorrow evening. I'll change my code accordingly.\n\nActually, I'm not that much convinced. It's not clear for me that\n\n```\n      sage: map_function = lambda x: 1\n      sage: reduce_function = lambda x,y: x+y\n      sage: reduce_init = 0\n      sage: S.map_reduce(map_function, reduce_function, reduce_init)\n      131071\n```\n\nis much better than\n\n```\n      sage: S.map_reduce(\n      ....:   map_function = lambda x: 1,\n      ....:   reduce_function = lambda x,y: x+y,\n      ....:   reduce_init = 0 )\n```\n\nIn this second version which is the style I adopted in `map_reduce.py`, we don't repeat the name twice, which is better in my opinion.\n\nA third possibility is\n\n```\n      sage: S.map_reduce(lambda x: 1, lambda x,y: x+y, 0)\n```\n\nIt is the one used through the whole `backtrack.py` files. Unless for very short example, I don't find it very readable. But since it's not adding new code but changing old one, which needs even more cleanup and doc improvement, I'd rather keep it for another ticket. More precisly, I'd rather do that during #16351.\n\nWhat do you think ?",
    "created_at": "2015-12-17T13:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164261",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:36 hivert]:
> I'm much more convinced by this argument. I'm watching an exam tomorrow evening. I'll change my code accordingly.

Actually, I'm not that much convinced. It's not clear for me that

```
      sage: map_function = lambda x: 1
      sage: reduce_function = lambda x,y: x+y
      sage: reduce_init = 0
      sage: S.map_reduce(map_function, reduce_function, reduce_init)
      131071
```

is much better than

```
      sage: S.map_reduce(
      ....:   map_function = lambda x: 1,
      ....:   reduce_function = lambda x,y: x+y,
      ....:   reduce_init = 0 )
```

In this second version which is the style I adopted in `map_reduce.py`, we don't repeat the name twice, which is better in my opinion.

A third possibility is

```
      sage: S.map_reduce(lambda x: 1, lambda x,y: x+y, 0)
```

It is the one used through the whole `backtrack.py` files. Unless for very short example, I don't find it very readable. But since it's not adding new code but changing old one, which needs even more cleanup and doc improvement, I'd rather keep it for another ticket. More precisly, I'd rather do that during #16351.

What do you think ?



---

archive/issue_comments_164262.json:
```json
{
    "body": "I'm not sure to understand the patchbot complaint ? Is it because the `map_reduce` is not imported as Sage's startup ?",
    "created_at": "2015-12-17T13:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164262",
    "user": "https://github.com/hivert"
}
```

I'm not sure to understand the patchbot complaint ? Is it because the `map_reduce` is not imported as Sage's startup ?



---

archive/issue_comments_164263.json:
```json
{
    "body": "I just uploaded a doc improvement: the `map_reduce` function was missing the description of the input.",
    "created_at": "2015-12-17T14:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164263",
    "user": "https://github.com/hivert"
}
```

I just uploaded a doc improvement: the `map_reduce` function was missing the description of the input.



---

archive/issue_comments_164264.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-17T14:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-17T18:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164266.json:
```json
{
    "body": "Replying to [comment:37 hivert]:\n> What do you think ?\n\nI think that some doctest are more important than other, especially the first doctests that people might be expected to see when using the map reduce code. For example the `map_reduce` method in the recursively enumerated set file is one possible entry point where clarity of doctests matters more. Therefore, I like the way you change the doctest. Definitively, the top of the module is an important entry point. For other sub methods of the class map reduce, I care less...",
    "created_at": "2015-12-18T14:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164266",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:37 hivert]:
> What do you think ?

I think that some doctest are more important than other, especially the first doctests that people might be expected to see when using the map reduce code. For example the `map_reduce` method in the recursively enumerated set file is one possible entry point where clarity of doctests matters more. Therefore, I like the way you change the doctest. Definitively, the top of the module is an important entry point. For other sub methods of the class map reduce, I care less...



---

archive/issue_comments_164267.json:
```json
{
    "body": "Replying to [comment:38 hivert]:\n> I'm not sure to understand the patchbot complaint ? Is it because the `map_reduce` is not imported as Sage's startup ?  \n\nI don't see why neither...",
    "created_at": "2015-12-18T14:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164267",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:38 hivert]:
> I'm not sure to understand the patchbot complaint ? Is it because the `map_reduce` is not imported as Sage's startup ?  

I don't see why neither...



---

archive/issue_comments_164268.json:
```json
{
    "body": "`Event`, `Condition`, `time` and `os` are imported in map_reduce file but are not used.",
    "created_at": "2015-12-18T16:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164268",
    "user": "https://github.com/seblabbe"
}
```

`Event`, `Condition`, `time` and `os` are imported in map_reduce file but are not used.



---

archive/issue_comments_164269.json:
```json
{
    "body": "Is there a reason why you use `res=[\"\"]` and `res[0]` in `print_communication_statistics` instead of `res=\"\"` and `res`?",
    "created_at": "2015-12-18T16:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164269",
    "user": "https://github.com/seblabbe"
}
```

Is there a reason why you use `res=[""]` and `res[0]` in `print_communication_statistics` instead of `res=""` and `res`?



---

archive/issue_comments_164270.json:
```json
{
    "body": "Replying to [comment:45 slabbe]:\n> Is there a reason why you use `res=[\"\"]` and `res[0]` in `print_communication_statistics` instead of `res=\"\"` and `res`?\n\nYes ! This is the classical trick to have a local variable shared with the local function (see e.g: http://stackoverflow.com/questions/2609518/python-nested-function-scopes).",
    "created_at": "2015-12-18T17:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164270",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:45 slabbe]:
> Is there a reason why you use `res=[""]` and `res[0]` in `print_communication_statistics` instead of `res=""` and `res`?

Yes ! This is the classical trick to have a local variable shared with the local function (see e.g: http://stackoverflow.com/questions/2609518/python-nested-function-scopes).



---

archive/issue_comments_164271.json:
```json
{
    "body": "Replying to [comment:44 slabbe]:\n> `Event`, `Condition`, `time` and `os` are imported in map_reduce file but are not used.\n\nFixed in my last push.",
    "created_at": "2015-12-18T17:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164271",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:44 slabbe]:
> `Event`, `Condition`, `time` and `os` are imported in map_reduce file but are not used.

Fixed in my last push.



---

archive/issue_comments_164272.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-18T17:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164273.json:
```json
{
    "body": "Replying to [comment:43 slabbe]: \n> I don't see why neither...\n\nAccording to Vincent on Sage devel it is probably a bug of the patchbot (see https://groups.google.com/forum/#!topic/sage-devel/xlpLwktA5Hk).",
    "created_at": "2015-12-18T17:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164273",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:43 slabbe]: 
> I don't see why neither...

According to Vincent on Sage devel it is probably a bug of the patchbot (see https://groups.google.com/forum/#!topic/sage-devel/xlpLwktA5Hk).



---

archive/issue_comments_164274.json:
```json
{
    "body": "Replying to [comment:46 hivert]:\n> Replying to [comment:45 slabbe]:\n> > Is there a reason why you use `res=[\"\"]` and `res[0]` in `print_communication_statistics` instead of `res=\"\"` and `res`?\n> \n> Yes ! This is the classical trick to have a local variable shared with the local function (see e.g: http://stackoverflow.com/questions/2609518/python-nested-function-scopes).\n\nCould you add this information inside the code of that method?",
    "created_at": "2015-12-21T10:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164274",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:46 hivert]:
> Replying to [comment:45 slabbe]:
> > Is there a reason why you use `res=[""]` and `res[0]` in `print_communication_statistics` instead of `res=""` and `res`?
> 
> Yes ! This is the classical trick to have a local variable shared with the local function (see e.g: http://stackoverflow.com/questions/2609518/python-nested-function-scopes).

Could you add this information inside the code of that method?



---

archive/issue_comments_164275.json:
```json
{
    "body": "`map_reduce` method of `SearchForest` should document what happen when this method is called with no arguments, i.e. returns the cardinality. More precisely, it should say that the value `None` for arguments `map_function` and `reduce_function` is replaced by what?",
    "created_at": "2015-12-21T13:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164275",
    "user": "https://github.com/seblabbe"
}
```

`map_reduce` method of `SearchForest` should document what happen when this method is called with no arguments, i.e. returns the cardinality. More precisely, it should say that the value `None` for arguments `map_function` and `reduce_function` is replaced by what?



---

archive/issue_comments_164276.json:
```json
{
    "body": "`On can use the three following parameters:` -> `One can use the three following parameters:`",
    "created_at": "2015-12-21T13:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164276",
    "user": "https://github.com/seblabbe"
}
```

`On can use the three following parameters:` -> `One can use the three following parameters:`



---

archive/issue_comments_164277.json:
```json
{
    "body": "I get the following doctests error on top on sage-6.10 on my machine:\n\n\n```\nGit branch: 13580\nUsing --optional=gcc,mpir,python2,sage\nDoctesting 1 file.\nsage -t --warn-long 85.4 map_reduce.py\n**********************************************************************\nFile \"map_reduce.py\", line 960, in sage.parallel.map_reduce.RESetMapReduce._signal_task_start\nFailed example:\n    S._active_tasks\nExpected:\n    <Semaphore(value=2)>\nGot:\n    <Semaphore(value=unknown)>\n**********************************************************************\nFile \"map_reduce.py\", line 964, in sage.parallel.map_reduce.RESetMapReduce._signal_task_start\nFailed example:\n    S._active_tasks\nExpected:\n    <Semaphore(value=3)>\nGot:\n    <Semaphore(value=unknown)>\n**********************************************************************\nFile \"map_reduce.py\", line 985, in sage.parallel.map_reduce.RESetMapReduce._signal_task_done\nFailed example:\n    S._active_tasks\nExpected:\n    <Semaphore(value=2)>\nGot:\n    <Semaphore(value=unknown)>\n**********************************************************************\nFile \"map_reduce.py\", line 989, in sage.parallel.map_reduce.RESetMapReduce._signal_task_done\nFailed example:\n    S._active_tasks\nExpected:\n    <Semaphore(value=1)>\nGot:\n    <Semaphore(value=unknown)>\n**********************************************************************\n2 items had failures:\n   2 of   9 in sage.parallel.map_reduce.RESetMapReduce._signal_task_done\n   2 of   7 in sage.parallel.map_reduce.RESetMapReduce._signal_task_start\n    [249 tests, 4 failures, 43.04 s]\n----------------------------------------------------------------------\nsage -t --warn-long 85.4 map_reduce.py  # 4 doctests failed\n----------------------------------------------------------------------\n```\n\n\nIt seems ok on patchbot reporting seemingly unrelated errors :\n\n\n```\n----------------------------------------------------------------------\nsage -t --long src/sage/interfaces/expect.py  # Timed out\nsage -t --long src/sage/interfaces/gap.py  # 10 doctests failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2015-12-21T14:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164277",
    "user": "https://github.com/seblabbe"
}
```

I get the following doctests error on top on sage-6.10 on my machine:


```
Git branch: 13580
Using --optional=gcc,mpir,python2,sage
Doctesting 1 file.
sage -t --warn-long 85.4 map_reduce.py
**********************************************************************
File "map_reduce.py", line 960, in sage.parallel.map_reduce.RESetMapReduce._signal_task_start
Failed example:
    S._active_tasks
Expected:
    <Semaphore(value=2)>
Got:
    <Semaphore(value=unknown)>
**********************************************************************
File "map_reduce.py", line 964, in sage.parallel.map_reduce.RESetMapReduce._signal_task_start
Failed example:
    S._active_tasks
Expected:
    <Semaphore(value=3)>
Got:
    <Semaphore(value=unknown)>
**********************************************************************
File "map_reduce.py", line 985, in sage.parallel.map_reduce.RESetMapReduce._signal_task_done
Failed example:
    S._active_tasks
Expected:
    <Semaphore(value=2)>
Got:
    <Semaphore(value=unknown)>
**********************************************************************
File "map_reduce.py", line 989, in sage.parallel.map_reduce.RESetMapReduce._signal_task_done
Failed example:
    S._active_tasks
Expected:
    <Semaphore(value=1)>
Got:
    <Semaphore(value=unknown)>
**********************************************************************
2 items had failures:
   2 of   9 in sage.parallel.map_reduce.RESetMapReduce._signal_task_done
   2 of   7 in sage.parallel.map_reduce.RESetMapReduce._signal_task_start
    [249 tests, 4 failures, 43.04 s]
----------------------------------------------------------------------
sage -t --warn-long 85.4 map_reduce.py  # 4 doctests failed
----------------------------------------------------------------------
```


It seems ok on patchbot reporting seemingly unrelated errors :


```
----------------------------------------------------------------------
sage -t --long src/sage/interfaces/expect.py  # Timed out
sage -t --long src/sage/interfaces/gap.py  # 10 doctests failed
----------------------------------------------------------------------
```




---

archive/issue_comments_164278.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-21T14:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164278",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_164279.json:
```json
{
    "body": "I divided the review in a stack of tasks but since I am unable to parallelize my working time, I did the review serially with many interruptions during the previous days:)\n\nI finished to look at what I wanted to look at. The documentation compiles good and helps to understand what is happening. I was able to test the parallel computation on at least one extensive example. To me it will be a positive review after my previous four comments are answered.",
    "created_at": "2015-12-21T14:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164279",
    "user": "https://github.com/seblabbe"
}
```

I divided the review in a stack of tasks but since I am unable to parallelize my working time, I did the review serially with many interruptions during the previous days:)

I finished to look at what I wanted to look at. The documentation compiles good and helps to understand what is happening. I was able to test the parallel computation on at least one extensive example. To me it will be a positive review after my previous four comments are answered.



---

archive/issue_comments_164280.json:
```json
{
    "body": "Replying to [comment:53 slabbe]:\n> I get the following doctests error on top on sage-6.10 on my machine:\n> \n> {{{\n> Expected:\n>     <Semaphore(value=1)>\n> Got:\n>     <Semaphore(value=unknown)>\n> }}}\n\nIs this happening on MacOS ? I know that Semaphore are implemented differently on this system. See in particular [the note](https://docs.python.org/2/library/multiprocessing.html#synchronization-primitives) after class `multiprocessing.BoundedSemaphore`, where it says:\n\n    on Unix platforms like Mac OS X where sem_getvalue() is not implemented.\n\nIf so and if the rests behave correctly, I'm tempted to replace the doctests with\n\n```\n    <Semaphore(value=...)>\n```\n\n\nWhat do you think ?",
    "created_at": "2015-12-21T14:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164280",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:53 slabbe]:
> I get the following doctests error on top on sage-6.10 on my machine:
> 
> {{{
> Expected:
>     <Semaphore(value=1)>
> Got:
>     <Semaphore(value=unknown)>
> }}}

Is this happening on MacOS ? I know that Semaphore are implemented differently on this system. See in particular [the note](https://docs.python.org/2/library/multiprocessing.html#synchronization-primitives) after class `multiprocessing.BoundedSemaphore`, where it says:

    on Unix platforms like Mac OS X where sem_getvalue() is not implemented.

If so and if the rests behave correctly, I'm tempted to replace the doctests with

```
    <Semaphore(value=...)>
```


What do you think ?



---

archive/issue_comments_164281.json:
```json
{
    "body": "Replying to [comment:51 slabbe]:\n> `map_reduce` method of `SearchForest` should document what happen when this method is called with no arguments, i.e. returns the cardinality. More precisely, it should say that the value `None` for arguments `map_function` and `reduce_function` is replaced by what?\n\nI didn't document this one because I'm was not sure It was a sensible default. If you think it is then let's go for it.\n\nBy the way thanks for your careful review !!!\n\nFlorent",
    "created_at": "2015-12-21T14:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164281",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:51 slabbe]:
> `map_reduce` method of `SearchForest` should document what happen when this method is called with no arguments, i.e. returns the cardinality. More precisely, it should say that the value `None` for arguments `map_function` and `reduce_function` is replaced by what?

I didn't document this one because I'm was not sure It was a sensible default. If you think it is then let's go for it.

By the way thanks for your careful review !!!

Florent



---

archive/issue_comments_164282.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-21T15:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164283.json:
```json
{
    "body": "I uploaded a patch which should address all your concerns:\n- tests on MacOSX\n- typos\n- default values documentation",
    "created_at": "2015-12-21T15:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164283",
    "user": "https://github.com/hivert"
}
```

I uploaded a patch which should address all your concerns:
- tests on MacOSX
- typos
- default values documentation



---

archive/issue_comments_164284.json:
```json
{
    "body": "Introduced typo in the previous commit: `the function costant to 1.` -> `constant`",
    "created_at": "2015-12-21T19:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164284",
    "user": "https://github.com/seblabbe"
}
```

Introduced typo in the previous commit: `the function costant to 1.` -> `constant`



---

archive/issue_comments_164285.json:
```json
{
    "body": "Replying to [comment:55 hivert]:\n> Replying to [comment:53 slabbe]:\n> > I get the following doctests error on top on sage-6.10 on my machine:\n> > \n> > {{{\n> > Expected:\n> >     <Semaphore(value=1)>\n> > Got:\n> >     <Semaphore(value=unknown)>\n> > }}}\n> \n> Is this happening on MacOS ? \n\nYes\n\n> If so and if the rests behave correctly, I'm tempted to replace the doctests with\n> {{{\n>     <Semaphore(value=...)>\n> }}}\n> \n> What do you think ? \n\nI agree. All tests passed now...",
    "created_at": "2015-12-21T19:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164285",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:55 hivert]:
> Replying to [comment:53 slabbe]:
> > I get the following doctests error on top on sage-6.10 on my machine:
> > 
> > {{{
> > Expected:
> >     <Semaphore(value=1)>
> > Got:
> >     <Semaphore(value=unknown)>
> > }}}
> 
> Is this happening on MacOS ? 

Yes

> If so and if the rests behave correctly, I'm tempted to replace the doctests with
> {{{
>     <Semaphore(value=...)>
> }}}
> 
> What do you think ? 

I agree. All tests passed now...



---

archive/issue_comments_164286.json:
```json
{
    "body": "Replying to [comment:56 hivert]:\n> I didn't document this one because I'm was not sure It was a sensible default. If you think it is then let's go for it.\n\nI think it is a good default. Also, sometimes, you may want to set only some of the arguments and this information allows it. Finally, it's good to see that cardinality is a special case of this method.",
    "created_at": "2015-12-21T19:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164286",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:56 hivert]:
> I didn't document this one because I'm was not sure It was a sensible default. If you think it is then let's go for it.

I think it is a good default. Also, sometimes, you may want to set only some of the arguments and this information allows it. Finally, it's good to see that cardinality is a special case of this method.



---

archive/issue_comments_164287.json:
```json
{
    "body": "Just to be clear: I am waiting for the `costant` -> `constant` fix to change the status to positive review.",
    "created_at": "2015-12-22T12:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164287",
    "user": "https://github.com/seblabbe"
}
```

Just to be clear: I am waiting for the `costant` -> `constant` fix to change the status to positive review.



---

archive/issue_comments_164288.json:
```json
{
    "body": "Typo fixed, hence changing the status to positive review on Sebastien's behalf.\n----\nNew commits:",
    "created_at": "2015-12-24T08:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164288",
    "user": "https://github.com/nthiery"
}
```

Typo fixed, hence changing the status to positive review on Sebastien's behalf.
----
New commits:



---

archive/issue_comments_164289.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-12-24T08:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164289",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164290.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-12-24T17:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164290",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_164291.json:
```json
{
    "body": "Fails on OSX: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20incremental/builds/636/steps/shell_4/logs/stdio",
    "created_at": "2015-12-24T17:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164291",
    "user": "https://github.com/vbraun"
}
```

Fails on OSX: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20incremental/builds/636/steps/shell_4/logs/stdio



---

archive/issue_comments_164292.json:
```json
{
    "body": "Hello and merry christmas every one,\n\nI have some question on this ticket.\n\nFirstly, I don't understand the documentation from the line 571:\n\n\n```\n    Decription of the map/reduce operation:\n\n    - ``map_function=f`` -- (default to ``None``)\n    - ``reduce_function=red`` -- (default to ``None``)\n    - ``reduce_init=init`` -- (default to ``None``)\n```\n\n\nWhat means `f`, `red` and `init`? My opinion is that `f`, `red`and `init` are irrelevant but an example should be interesting at this point: \n\n(copy-paste of one in the module documentation)\n\n```\n sage: from sage.parallel.map_reduce import RESetMapReduce\n sage: S = RESetMapReduce(\n ....:   roots = [[]],\n ....:   children = lambda l: [l+[0], l+[1]] if len(l) <= 15 else [],\n ....:   map_function = lambda x : 1,\n ....:   reduce_function = lambda x,y: x+y,\n ....:   reduce_init = 0 )\n sage: S.run()\n 131071\n```\n\n\nOk, there is the `seealso` which says go to see the documentation of the module for examples, but one example there is interesting, no?\n\nThen it seems there is some useless import (like line 1345 `from multiprocessing import current_process`) (I try to compile sage soon and I can remove all useless import if you want).\n\nFinally, I'm not sure to understand the use of `AbortError`. It is used to abort the computation and to say to the workers and the thiefs every think is done?\n\nJean-Baptiste",
    "created_at": "2015-12-26T14:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164292",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Hello and merry christmas every one,

I have some question on this ticket.

Firstly, I don't understand the documentation from the line 571:


```
    Decription of the map/reduce operation:

    - ``map_function=f`` -- (default to ``None``)
    - ``reduce_function=red`` -- (default to ``None``)
    - ``reduce_init=init`` -- (default to ``None``)
```


What means `f`, `red` and `init`? My opinion is that `f`, `red`and `init` are irrelevant but an example should be interesting at this point: 

(copy-paste of one in the module documentation)

```
 sage: from sage.parallel.map_reduce import RESetMapReduce
 sage: S = RESetMapReduce(
 ....:   roots = [[]],
 ....:   children = lambda l: [l+[0], l+[1]] if len(l) <= 15 else [],
 ....:   map_function = lambda x : 1,
 ....:   reduce_function = lambda x,y: x+y,
 ....:   reduce_init = 0 )
 sage: S.run()
 131071
```


Ok, there is the `seealso` which says go to see the documentation of the module for examples, but one example there is interesting, no?

Then it seems there is some useless import (like line 1345 `from multiprocessing import current_process`) (I try to compile sage soon and I can remove all useless import if you want).

Finally, I'm not sure to understand the use of `AbortError`. It is used to abort the computation and to say to the workers and the thiefs every think is done?

Jean-Baptiste



---

archive/issue_comments_164293.json:
```json
{
    "body": "Replying to [comment:66 vbraun]:\n> Fails on OSX: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20incremental/builds/636/steps/shell_4/logs/stdio\n\nI can not reproduce this problem on my Mac OS X Yosemite 10.10.2:\n\n\n```\n$ sage -tp --long src/sage/parallel/map_reduce.py \nRunning doctests with ID 2015-12-28-10-44-31-65e477d9.\nGit branch: 13580\nUsing --optional=gcc,mpir,python2,sage\nDoctesting 1 file using 2 threads.\nsage -t --long --warn-long 85.0 src/sage/parallel/map_reduce.py\n    [252 tests, 40.89 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n",
    "created_at": "2015-12-28T09:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164293",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:66 vbraun]:
> Fails on OSX: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20incremental/builds/636/steps/shell_4/logs/stdio

I can not reproduce this problem on my Mac OS X Yosemite 10.10.2:


```
$ sage -tp --long src/sage/parallel/map_reduce.py 
Running doctests with ID 2015-12-28-10-44-31-65e477d9.
Git branch: 13580
Using --optional=gcc,mpir,python2,sage
Doctesting 1 file using 2 threads.
sage -t --long --warn-long 85.0 src/sage/parallel/map_reduce.py
    [252 tests, 40.89 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```




---

archive/issue_comments_164294.json:
```json
{
    "body": "Hello,\n\nI can reproduce test failures on El Capitan (os x):\n\n- [log_map_reduce](http://kerios.fr/downloads/sage/2016/log_map_reduce)\n- [log_map_reduce2](http://kerios.fr/downloads/sage/2016/log_map_reduce2)\n- [log_map_reduce3](http://kerios.fr/downloads/sage/2016/log_map_reduce3)\n\nI run 3 tests and I obtained 3 distincts failures. My problem is that if I try to execute those lines which fails in sage terminal (several times) then it does not fail!\n\nIs it possible that the test environment is not robust specially on mac os?",
    "created_at": "2016-01-06T10:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164294",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Hello,

I can reproduce test failures on El Capitan (os x):

- [log_map_reduce](http://kerios.fr/downloads/sage/2016/log_map_reduce)
- [log_map_reduce2](http://kerios.fr/downloads/sage/2016/log_map_reduce2)
- [log_map_reduce3](http://kerios.fr/downloads/sage/2016/log_map_reduce3)

I run 3 tests and I obtained 3 distincts failures. My problem is that if I try to execute those lines which fails in sage terminal (several times) then it does not fail!

Is it possible that the test environment is not robust specially on mac os?



---

archive/issue_comments_164295.json:
```json
{
    "body": "I read the code and I don't know how to understand this:\n\n\n```\nres = post_process(node)\nif res is not None:\n    self._res = reduc(self._res, mapp(res))\n```\n\n\nin the worker code of `walk_branch_locally` method.\n\nI think this is useless, no? Or if not then the documentation of `post_process` function should be improve to specify that if `post_process` returns `None` then there is a specific behavior.",
    "created_at": "2016-01-11T09:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164295",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

I read the code and I don't know how to understand this:


```
res = post_process(node)
if res is not None:
    self._res = reduc(self._res, mapp(res))
```


in the worker code of `walk_branch_locally` method.

I think this is useless, no? Or if not then the documentation of `post_process` function should be improve to specify that if `post_process` returns `None` then there is a specific behavior.



---

archive/issue_comments_164296.json:
```json
{
    "body": "Replying to [comment:70 elixyre]:\n> {{{\n> res = post_process(node)\n> if res is not None:\n>     self._res = reduc(self._res, mapp(res))\n> }}}\n> I think this is useless, no? Or if not then the documentation of `post_process` function should be improve to specify that if `post_process` returns `None` then there is a specific behavior.\n\nOk, this behavior is specify in the documentation of `RESetMapReduce` but this is not specified in paragraph (line 135) associated of this module.",
    "created_at": "2016-01-11T09:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164296",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Replying to [comment:70 elixyre]:
> {{{
> res = post_process(node)
> if res is not None:
>     self._res = reduc(self._res, mapp(res))
> }}}
> I think this is useless, no? Or if not then the documentation of `post_process` function should be improve to specify that if `post_process` returns `None` then there is a specific behavior.

Ok, this behavior is specify in the documentation of `RESetMapReduce` but this is not specified in paragraph (line 135) associated of this module.



---

archive/issue_comments_164297.json:
```json
{
    "body": "Furthermore the lines:\n\n```\nfor child in newnodes: \n    self._todo.append(child)\n```\n\nof `walk_branch_locally` should be replaced by\n\n```\nself._todo_.extend(newnodes)\n```\n\n\n(I just notice that I read and if you are agree with my remark then I can replace that)",
    "created_at": "2016-01-11T09:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164297",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Furthermore the lines:

```
for child in newnodes: 
    self._todo.append(child)
```

of `walk_branch_locally` should be replaced by

```
self._todo_.extend(newnodes)
```


(I just notice that I read and if you are agree with my remark then I can replace that)



---

archive/issue_comments_164298.json:
```json
{
    "body": "Go back to `None` activities, if I assume some users want to use *nodes* which could be `None` then my first idea is to use the `post_process` function to avoid problem but... if the *thief* doesn't receive then he send `None` and he says there is no job to do.\n\nI propose two solutions:\n- first one, to specify that `None` is not a node never! (this is assumed but this must be explicited in the documentation),\n- second one (the object way), to define an object `NoTask`.\n\nOpinion?",
    "created_at": "2016-01-11T10:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164298",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

Go back to `None` activities, if I assume some users want to use *nodes* which could be `None` then my first idea is to use the `post_process` function to avoid problem but... if the *thief* doesn't receive then he send `None` and he says there is no job to do.

I propose two solutions:
- first one, to specify that `None` is not a node never! (this is assumed but this must be explicited in the documentation),
- second one (the object way), to define an object `NoTask`.

Opinion?



---

archive/issue_comments_164299.json:
```json
{
    "body": "Replying to [comment:73 elixyre]:\n> Go back to `None` activities, if I assume some users want to use *nodes* which could be `None` then my first idea is to use the `post_process` function to avoid problem but... if the *thief* doesn't receive then he send `None` and he says there is no job to do.\n> \n> I propose two solutions:\n>  - first one, to specify that `None` is not a node never! (this is assumed but this must be explicited in the documentation),\n\nI'm clearly in Favor of this solution. We assume that `None` doesn't blong to the set described by the underlying RESet. Note that this is something which concerns more the underlying RESet than the map-reduce computation.",
    "created_at": "2016-01-12T08:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164299",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:73 elixyre]:
> Go back to `None` activities, if I assume some users want to use *nodes* which could be `None` then my first idea is to use the `post_process` function to avoid problem but... if the *thief* doesn't receive then he send `None` and he says there is no job to do.
> 
> I propose two solutions:
>  - first one, to specify that `None` is not a node never! (this is assumed but this must be explicited in the documentation),

I'm clearly in Favor of this solution. We assume that `None` doesn't blong to the set described by the underlying RESet. Note that this is something which concerns more the underlying RESet than the map-reduce computation.



---

archive/issue_comments_164300.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-01-12T09:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164300",
    "user": "https://github.com/hivert"
}
```

New commits:



---

archive/issue_comments_164301.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-12T10:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164301",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164302.json:
```json
{
    "body": "Replying to [comment:66 vbraun]:\n> Fails on OSX: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20incremental/builds/636/steps/shell_4/logs/stdio\n\nWe finally got the problem with Jean-Baptiste. It occurs that semaphore are broken on MacOSX (or at least are not fully POSIX compliant). In particular, on standard unixes, when two processes are trying to acquire a semaphore whose value is more than two, they always both succeeded. On MacOS, one of them may fail. As a consequence, I'm writing a different code form MacOS relying on a Lock and a shared integer. It may be slower on system where semaphore are implemented in a lockless way.\n\nIs there a standard Sage/Python way to check if we are on MacOS ?",
    "created_at": "2016-01-15T15:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164302",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:66 vbraun]:
> Fails on OSX: http://build.sagedev.org/release/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.10%20x86_64%29%20incremental/builds/636/steps/shell_4/logs/stdio

We finally got the problem with Jean-Baptiste. It occurs that semaphore are broken on MacOSX (or at least are not fully POSIX compliant). In particular, on standard unixes, when two processes are trying to acquire a semaphore whose value is more than two, they always both succeeded. On MacOS, one of them may fail. As a consequence, I'm writing a different code form MacOS relying on a Lock and a shared integer. It may be slower on system where semaphore are implemented in a lockless way.

Is there a standard Sage/Python way to check if we are on MacOS ?



---

archive/issue_comments_164303.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-01-17T20:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164303",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

New commits:



---

archive/issue_comments_164304.json:
```json
{
    "body": "I pushed the modifications done with Florent about mac os problem.\n\nIt seems there still exists the problem of synchronization with the `Pipe` (of the worker) but... it is never appear... so may be I am wrong.\n\nIs it possible that two distinct process write in the same time on the `_write_task` of a worker?",
    "created_at": "2016-01-17T20:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164304",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

I pushed the modifications done with Florent about mac os problem.

It seems there still exists the problem of synchronization with the `Pipe` (of the worker) but... it is never appear... so may be I am wrong.

Is it possible that two distinct process write in the same time on the `_write_task` of a worker?



---

archive/issue_comments_164305.json:
```json
{
    "body": "I just uploaded a version which hopefully should be working on all OSes including MacOS. Please tests on various oses and report any failure here. I don't put needs review yet because it needs a few refactoring and the coverage it not yet 100%. \n----\nNew commits:",
    "created_at": "2016-02-02T10:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164305",
    "user": "https://github.com/hivert"
}
```

I just uploaded a version which hopefully should be working on all OSes including MacOS. Please tests on various oses and report any failure here. I don't put needs review yet because it needs a few refactoring and the coverage it not yet 100%. 
----
New commits:



---

archive/issue_comments_164306.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-03T09:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164307.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-16T16:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164307",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164308.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-06T17:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164309.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T09:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164310.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T09:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164310",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164311.json:
```json
{
    "body": "Changing keywords from \"map-reduce, days57\" to \"map-reduce, days57, days77\".",
    "created_at": "2016-04-07T09:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164311",
    "user": "https://github.com/hivert"
}
```

Changing keywords from "map-reduce, days57" to "map-reduce, days57, days77".



---

archive/issue_comments_164312.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-07T09:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164312",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_164313.json:
```json
{
    "body": "I just uploaded a patch with basically two implementation of `ActiveTaskCounter`: one using semaphore and which doesn't work on MACOS and one using semaphore for all POSIX compliant OSes. It should be ready for review.",
    "created_at": "2016-04-07T09:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164313",
    "user": "https://github.com/hivert"
}
```

I just uploaded a patch with basically two implementation of `ActiveTaskCounter`: one using semaphore and which doesn't work on MACOS and one using semaphore for all POSIX compliant OSes. It should be ready for review.



---

archive/issue_comments_164314.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T13:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164315.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T17:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164316.json:
```json
{
    "body": "I get the following errors on OSX :\n\n\n```\nRunning doctests with ID 2016-04-07-19-23-55-8fd43b63.\nGit branch: 13580\nUsing --optional=dot2tex,mpir,python2,sage\nDoctesting 1 file using 2 threads.\nsage -t --long --warn-long 84.5 src/sage/parallel/map_reduce.py\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 727, in sage.parallel.map_reduce.ActiveTaskCounterPosix.__repr__\nFailed example:\n    ATC(4)\nExpected:\n    ActiveTaskCounter(value=4)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32e90>) failed: NotImplementedError>\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 743, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start\nFailed example:\n    c = ATC(4); c\nExpected:\n    ActiveTaskCounter(value=4)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32e50>) failed: NotImplementedError>\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 745, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start\nFailed example:\n    c.task_start()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start[2]>\", line 1, in <module>\n        c.task_start()\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/parallel/map_reduce.py\", line 764, in task_start\n        return self._active_tasks.get_value()\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python/multiprocessing/synchronize.py\", line 114, in get_value\n        return self._semlock._get_value()\n    NotImplementedError\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 747, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start\nFailed example:\n    c\nExpected:\n    ActiveTaskCounter(value=5)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32e50>) failed: NotImplementedError>\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 755, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start\nFailed example:\n    c\nExpected:\n    ActiveTaskCounter(value=0)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32f90>) failed: NotImplementedError>\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 778, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done\nFailed example:\n    c = ATC(4); c\nExpected:\n    ActiveTaskCounter(value=4)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5c10>) failed: NotImplementedError>\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 780, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done\nFailed example:\n    c.task_done()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done[2]>\", line 1, in <module>\n        c.task_done()\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/parallel/map_reduce.py\", line 796, in task_done\n        return self._active_tasks.get_value()\n      File \"/Users/slabbe/Applications/sage-git/local/lib/python/multiprocessing/synchronize.py\", line 114, in get_value\n        return self._semlock._get_value()\n    NotImplementedError\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 782, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done\nFailed example:\n    c\nExpected:\n    ActiveTaskCounter(value=3)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5c10>) failed: NotImplementedError>\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 805, in sage.parallel.map_reduce.ActiveTaskCounterPosix.abort\nFailed example:\n    c = ATC(4); c\nExpected:\n    ActiveTaskCounter(value=4)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5910>) failed: NotImplementedError>\n**********************************************************************\nFile \"src/sage/parallel/map_reduce.py\", line 808, in sage.parallel.map_reduce.ActiveTaskCounterPosix.abort\nFailed example:\n    c\nExpected:\n    ActiveTaskCounter(value=0)\nGot:\n    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5910>) failed: NotImplementedError>\n**********************************************************************\n4 items had failures:\n   1 of   3 in sage.parallel.map_reduce.ActiveTaskCounterPosix.__repr__\n   2 of   5 in sage.parallel.map_reduce.ActiveTaskCounterPosix.abort\n   3 of   7 in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done\n   4 of   8 in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start\n    [296 tests, 10 failures, 33.64 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 84.5 src/sage/parallel/map_reduce.py  # 10 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 33.9 seconds\n    cpu time: 5.8 seconds\n    cumulative wall time: 33.6 seconds\n```\n",
    "created_at": "2016-04-07T17:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164316",
    "user": "https://github.com/seblabbe"
}
```

I get the following errors on OSX :


```
Running doctests with ID 2016-04-07-19-23-55-8fd43b63.
Git branch: 13580
Using --optional=dot2tex,mpir,python2,sage
Doctesting 1 file using 2 threads.
sage -t --long --warn-long 84.5 src/sage/parallel/map_reduce.py
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 727, in sage.parallel.map_reduce.ActiveTaskCounterPosix.__repr__
Failed example:
    ATC(4)
Expected:
    ActiveTaskCounter(value=4)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32e90>) failed: NotImplementedError>
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 743, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start
Failed example:
    c = ATC(4); c
Expected:
    ActiveTaskCounter(value=4)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32e50>) failed: NotImplementedError>
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 745, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start
Failed example:
    c.task_start()
Exception raised:
    Traceback (most recent call last):
      File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start[2]>", line 1, in <module>
        c.task_start()
      File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/parallel/map_reduce.py", line 764, in task_start
        return self._active_tasks.get_value()
      File "/Users/slabbe/Applications/sage-git/local/lib/python/multiprocessing/synchronize.py", line 114, in get_value
        return self._semlock._get_value()
    NotImplementedError
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 747, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start
Failed example:
    c
Expected:
    ActiveTaskCounter(value=5)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32e50>) failed: NotImplementedError>
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 755, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start
Failed example:
    c
Expected:
    ActiveTaskCounter(value=0)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x190d32f90>) failed: NotImplementedError>
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 778, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done
Failed example:
    c = ATC(4); c
Expected:
    ActiveTaskCounter(value=4)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5c10>) failed: NotImplementedError>
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 780, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done
Failed example:
    c.task_done()
Exception raised:
    Traceback (most recent call last):
      File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done[2]>", line 1, in <module>
        c.task_done()
      File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/sage/parallel/map_reduce.py", line 796, in task_done
        return self._active_tasks.get_value()
      File "/Users/slabbe/Applications/sage-git/local/lib/python/multiprocessing/synchronize.py", line 114, in get_value
        return self._semlock._get_value()
    NotImplementedError
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 782, in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done
Failed example:
    c
Expected:
    ActiveTaskCounter(value=3)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5c10>) failed: NotImplementedError>
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 805, in sage.parallel.map_reduce.ActiveTaskCounterPosix.abort
Failed example:
    c = ATC(4); c
Expected:
    ActiveTaskCounter(value=4)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5910>) failed: NotImplementedError>
**********************************************************************
File "src/sage/parallel/map_reduce.py", line 808, in sage.parallel.map_reduce.ActiveTaskCounterPosix.abort
Failed example:
    c
Expected:
    ActiveTaskCounter(value=0)
Got:
    <repr(<sage.parallel.map_reduce.ActiveTaskCounterPosix at 0x1026a5910>) failed: NotImplementedError>
**********************************************************************
4 items had failures:
   1 of   3 in sage.parallel.map_reduce.ActiveTaskCounterPosix.__repr__
   2 of   5 in sage.parallel.map_reduce.ActiveTaskCounterPosix.abort
   3 of   7 in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_done
   4 of   8 in sage.parallel.map_reduce.ActiveTaskCounterPosix.task_start
    [296 tests, 10 failures, 33.64 s]
----------------------------------------------------------------------
sage -t --long --warn-long 84.5 src/sage/parallel/map_reduce.py  # 10 doctests failed
----------------------------------------------------------------------
Total time for all tests: 33.9 seconds
    cpu time: 5.8 seconds
    cumulative wall time: 33.6 seconds
```




---

archive/issue_comments_164317.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-07T17:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164317",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_164318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T17:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164319.json:
```json
{
    "body": "It works now! : \n\n\n```\nUsing --optional=dot2tex,mpir,python2,sage\nDoctesting 1 file using 2 threads.\nsage -t --warn-long 84.3 src/sage/parallel/map_reduce.py\n    [296 tests, 32.56 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n",
    "created_at": "2016-04-07T18:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164319",
    "user": "https://github.com/seblabbe"
}
```

It works now! : 


```
Using --optional=dot2tex,mpir,python2,sage
Doctesting 1 file using 2 threads.
sage -t --warn-long 84.3 src/sage/parallel/map_reduce.py
    [296 tests, 32.56 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```




---

archive/issue_comments_164320.json:
```json
{
    "body": "some typos:\n\n`compute the the cardinality`\n\n`its job. Non only mapping` -> `Not only`\n\n`method so that to compute the number of element you only need to call::` -> wrap the line\n\n`precedingly by we only ` -> `previously`? , `but` \n\nI would suggest to replace this:\n\n\n```\n        OUTPUT: Calling :meth:`task_done` decrement the counter and returns\n        its value after the decrementation.\n```\n\n\nby\n\n\n```\n        OUTPUT: \n\n        Calling :meth:`task_done` decrement the counter and returns\n        its value after the decrementation.\n```\n\n\nto follow sage standards (more than once).\n\nAlso, I would replace this:\n\n\n```\nINPUT: ``o`` -- a node\n```\n\n\nby\n\n\n```\nINPUT: \n\n- ``o`` -- a node\n```\n\n\nto follow sage standards (more than once).\n\n`the computation are done i` -> s missing",
    "created_at": "2016-04-07T18:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164320",
    "user": "https://github.com/seblabbe"
}
```

some typos:

`compute the the cardinality`

`its job. Non only mapping` -> `Not only`

`method so that to compute the number of element you only need to call::` -> wrap the line

`precedingly by we only ` -> `previously`? , `but` 

I would suggest to replace this:


```
        OUTPUT: Calling :meth:`task_done` decrement the counter and returns
        its value after the decrementation.
```


by


```
        OUTPUT: 

        Calling :meth:`task_done` decrement the counter and returns
        its value after the decrementation.
```


to follow sage standards (more than once).

Also, I would replace this:


```
INPUT: ``o`` -- a node
```


by


```
INPUT: 

- ``o`` -- a node
```


to follow sage standards (more than once).

`the computation are done i` -> s missing



---

archive/issue_comments_164321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T21:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_164322.json:
```json
{
    "body": "I am wondering what else is currently needed for this ticket before a positive review?\n\nAlso, what are the current plans to cythonize `SearchForest` and the parallel reduce map?",
    "created_at": "2016-04-07T23:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164322",
    "user": "https://github.com/tscrim"
}
```

I am wondering what else is currently needed for this ticket before a positive review?

Also, what are the current plans to cythonize `SearchForest` and the parallel reduce map?



---

archive/issue_comments_164323.json:
```json
{
    "body": "What I had in mind for the next step to do was to move the `SearchForest` code from backtrack file into the `recursivelyenumerated_set.pyx` file *and* into the hierarchy of `RecEnumSet` classes so that it benefits for example of methods like the newly added `to_digraph`.",
    "created_at": "2016-04-08T00:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164323",
    "user": "https://github.com/seblabbe"
}
```

What I had in mind for the next step to do was to move the `SearchForest` code from backtrack file into the `recursivelyenumerated_set.pyx` file *and* into the hierarchy of `RecEnumSet` classes so that it benefits for example of methods like the newly added `to_digraph`.



---

archive/issue_comments_164324.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-04-08T00:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164324",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_164325.json:
```json
{
    "body": "Replying to [comment:96 tscrim]:\n> I am wondering what else is currently needed for this ticket before a positive review?\n\nSebastien is currently rereading it. I think he is very close to put a positive review.\n\n> Also, what are the current plans to cythonize `SearchForest` and the parallel reduce map?\n\nConcerning Cythonization of map-reduce, my current opinion is that, the code\nis designed for case where the computation of the children is costly. In this\ncase the cost of the current code should be negligible. There are a lot of\nfunction calls, I'm using Python synchronization primitive, but most\nimportantly, communication is are by pickling/unpickling which is very\nslow. So the idea is to reduce at most at possible the communication, but\nwithout drastically changing the technology, I don't think you get a large\nimprovement without great effort. You'll need to rewrite all the communication\nprimitive and to inline the function call to the client code.\n\nOn the other hand, If you are allowed to write the code directly in C/C++\n(which is the case for small basic objects), then the Cilk extension of C is\nwonderful. It's a small extension which is supported by GCC since version 5,\nICC and in recent CLANG (https://cilkplus.github.io/). I've several code where\nI've been able to have very large speedup. See\ne.g. https://hal.archives-ouvertes.fr/hal-00823339/file/article.pdf if you are\ncurious.\n\nNow if you have a specific use case, I'll be happy to experiment.",
    "created_at": "2016-04-08T01:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164325",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:96 tscrim]:
> I am wondering what else is currently needed for this ticket before a positive review?

Sebastien is currently rereading it. I think he is very close to put a positive review.

> Also, what are the current plans to cythonize `SearchForest` and the parallel reduce map?

Concerning Cythonization of map-reduce, my current opinion is that, the code
is designed for case where the computation of the children is costly. In this
case the cost of the current code should be negligible. There are a lot of
function calls, I'm using Python synchronization primitive, but most
importantly, communication is are by pickling/unpickling which is very
slow. So the idea is to reduce at most at possible the communication, but
without drastically changing the technology, I don't think you get a large
improvement without great effort. You'll need to rewrite all the communication
primitive and to inline the function call to the client code.

On the other hand, If you are allowed to write the code directly in C/C++
(which is the case for small basic objects), then the Cilk extension of C is
wonderful. It's a small extension which is supported by GCC since version 5,
ICC and in recent CLANG (https://cilkplus.github.io/). I've several code where
I've been able to have very large speedup. See
e.g. https://hal.archives-ouvertes.fr/hal-00823339/file/article.pdf if you are
curious.

Now if you have a specific use case, I'll be happy to experiment.



---

archive/issue_comments_164326.json:
```json
{
    "body": "Replying to [comment:97 slabbe]:\n> What I had in mind for the next step to do was to move the `SearchForest` code from backtrack file into the `recursivelyenumerated_set.pyx` file *and* into the hierarchy of `RecEnumSet` classes so that it benefits for example of methods like the newly added `to_digraph`.\n\nThat was also the next goal in my mind.",
    "created_at": "2016-04-08T01:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164326",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:97 slabbe]:
> What I had in mind for the next step to do was to move the `SearchForest` code from backtrack file into the `recursivelyenumerated_set.pyx` file *and* into the hierarchy of `RecEnumSet` classes so that it benefits for example of methods like the newly added `to_digraph`.

That was also the next goal in my mind.



---

archive/issue_comments_164327.json:
```json
{
    "body": "See #16351",
    "created_at": "2016-04-08T08:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164327",
    "user": "https://github.com/seblabbe"
}
```

See #16351



---

archive/issue_comments_164328.json:
```json
{
    "body": "Replying to [comment:98 hivert]:\n> Replying to [comment:96 tscrim]:\n> > Also, what are the current plans to cythonize `SearchForest` and the parallel reduce map?\n> \n> Concerning Cythonization of map-reduce, my current opinion is that, the code\n> is designed for case where the computation of the children is costly. In this\n> case the cost of the current code should be negligible. There are a lot of\n> function calls, I'm using Python synchronization primitive, but most\n> importantly, communication is are by pickling/unpickling which is very\n> slow. So the idea is to reduce at most at possible the communication, but\n> without drastically changing the technology, I don't think you get a large\n> improvement without great effort. You'll need to rewrite all the communication\n> primitive and to inline the function call to the client code.\n> \n> On the other hand, If you are allowed to write the code directly in C/C++\n> (which is the case for small basic objects), then the Cilk extension of C is\n> wonderful. It's a small extension which is supported by GCC since version 5,\n> ICC and in recent CLANG (https://cilkplus.github.io/). I've several code where\n> I've been able to have very large speedup. See\n> e.g. https://hal.archives-ouvertes.fr/hal-00823339/file/article.pdf if you are\n> curious.\n> \n> Now if you have a specific use case, I'll be happy to experiment.\n\nChristian, Vivien, and I are working on trying to speed up the iteration of finite Coxeter groups by using (subgroups of) permutation groups and the iterator method of generic Coxeter groups, which uses a `SearchForest` (see #11187 and the `CoxeterGroups` category). Our goal is to try and match or beat GAP3 iteration time (which we are about ~30x slower).\n\nWe are in the process pushing our successor computation code to Cython and some of our other methods, but we would appreciate any insights you have.\n\nYet the code on this ticket will definitely help with that. Thank you for finishing it.",
    "created_at": "2016-04-08T09:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164328",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:98 hivert]:
> Replying to [comment:96 tscrim]:
> > Also, what are the current plans to cythonize `SearchForest` and the parallel reduce map?
> 
> Concerning Cythonization of map-reduce, my current opinion is that, the code
> is designed for case where the computation of the children is costly. In this
> case the cost of the current code should be negligible. There are a lot of
> function calls, I'm using Python synchronization primitive, but most
> importantly, communication is are by pickling/unpickling which is very
> slow. So the idea is to reduce at most at possible the communication, but
> without drastically changing the technology, I don't think you get a large
> improvement without great effort. You'll need to rewrite all the communication
> primitive and to inline the function call to the client code.
> 
> On the other hand, If you are allowed to write the code directly in C/C++
> (which is the case for small basic objects), then the Cilk extension of C is
> wonderful. It's a small extension which is supported by GCC since version 5,
> ICC and in recent CLANG (https://cilkplus.github.io/). I've several code where
> I've been able to have very large speedup. See
> e.g. https://hal.archives-ouvertes.fr/hal-00823339/file/article.pdf if you are
> curious.
> 
> Now if you have a specific use case, I'll be happy to experiment.

Christian, Vivien, and I are working on trying to speed up the iteration of finite Coxeter groups by using (subgroups of) permutation groups and the iterator method of generic Coxeter groups, which uses a `SearchForest` (see #11187 and the `CoxeterGroups` category). Our goal is to try and match or beat GAP3 iteration time (which we are about ~30x slower).

We are in the process pushing our successor computation code to Cython and some of our other methods, but we would appreciate any insights you have.

Yet the code on this ticket will definitely help with that. Thank you for finishing it.



---

archive/issue_comments_164329.json:
```json
{
    "body": "Replying to [comment:101 tscrim]:\n> Christian, Vivien, and I are working on trying to speed up the iteration of\n> finite Coxeter groups by using (subgroups of) permutation groups and the\n> iterator method of generic Coxeter groups, which uses a `SearchForest` (see\n> #11187 and the `CoxeterGroups` category). Our goal is to try and match or\n> beat GAP3 iteration time (which we are about ~30x slower).\n\nI'll be both very happy and interested to have usecase for this code.\n\n> We are in the process pushing our successor computation code to Cython and\n> some of our other methods, but we would appreciate any insights you have.\n\nDo you have a typical example relying on `SearchForest` of code on top of\n#11187 that I can profile ? Note that I included in the documentation of\nmap_reduce.py a guide on how to profile the parallel code. I'd like to measure\nthe proportion of time that is spend on Coxeter code one one hand and on the\nparallel infrastructure on the other.\n\n\nNow, concerning coxeter group, I'm quite sure that rewriting part of the code\nin C/C++ and using advanced parallel stuff (AVX instruction set + SIMD) you\ncan get speedup a large as several hundreds and even thousand ! As a witness\non https://github.com/hivert/IVMPG I wrote a code whose goal is to enumerate\ninteger vector modulo permutation group. Compared to the code we have in Sage\nwhich has been Cythonized and optimized by Simon King I manage to get speedup\na large as x2000 ! I need help on the build system to be able to distribute\nit. I'm pretty sure the code there is very similar to what you need in Coxeter\ngroups.\n\nBy the way, should we transfer this discussion on #11187 ?",
    "created_at": "2016-04-08T09:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164329",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:101 tscrim]:
> Christian, Vivien, and I are working on trying to speed up the iteration of
> finite Coxeter groups by using (subgroups of) permutation groups and the
> iterator method of generic Coxeter groups, which uses a `SearchForest` (see
> #11187 and the `CoxeterGroups` category). Our goal is to try and match or
> beat GAP3 iteration time (which we are about ~30x slower).

I'll be both very happy and interested to have usecase for this code.

> We are in the process pushing our successor computation code to Cython and
> some of our other methods, but we would appreciate any insights you have.

Do you have a typical example relying on `SearchForest` of code on top of
#11187 that I can profile ? Note that I included in the documentation of
map_reduce.py a guide on how to profile the parallel code. I'd like to measure
the proportion of time that is spend on Coxeter code one one hand and on the
parallel infrastructure on the other.


Now, concerning coxeter group, I'm quite sure that rewriting part of the code
in C/C++ and using advanced parallel stuff (AVX instruction set + SIMD) you
can get speedup a large as several hundreds and even thousand ! As a witness
on https://github.com/hivert/IVMPG I wrote a code whose goal is to enumerate
integer vector modulo permutation group. Compared to the code we have in Sage
which has been Cythonized and optimized by Simon King I manage to get speedup
a large as x2000 ! I need help on the build system to be able to distribute
it. I'm pretty sure the code there is very similar to what you need in Coxeter
groups.

By the way, should we transfer this discussion on #11187 ?



---

archive/issue_comments_164330.json:
```json
{
    "body": "Replying to [comment:102 hivert]:\n> By the way, should we transfer this discussion on #11187 ?\n\nDone.",
    "created_at": "2016-04-08T10:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164330",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:102 hivert]:
> By the way, should we transfer this discussion on #11187 ?

Done.



---

archive/issue_comments_164331.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-08T22:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164331",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_164332.json:
```json
{
    "body": "This ticket breaks the doctests on my patchbot, i do not know whether it is because it is run from a VM or from a 32-bit system, see http://patchbot.sagemath.org/log/0/debian/8.3/i686/3.16.0-4-586/tmonteil-debian-jessie-32/2016-04-15%2012:13:01?short",
    "created_at": "2016-04-15T15:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164332",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

This ticket breaks the doctests on my patchbot, i do not know whether it is because it is run from a VM or from a 32-bit system, see http://patchbot.sagemath.org/log/0/debian/8.3/i686/3.16.0-4-586/tmonteil-debian-jessie-32/2016-04-15%2012:13:01?short



---

archive/issue_comments_164333.json:
```json
{
    "body": "Note also that the VM emulates a \"Pentium III (Katmai)\"",
    "created_at": "2016-04-15T15:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164333",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Note also that the VM emulates a "Pentium III (Katmai)"



---

archive/issue_comments_164334.json:
```json
{
    "body": "Replying to [comment:105 tmonteil]:\n> This ticket breaks the doctests on my patchbot, i do not know whether it is because it is run from a VM or from a 32-bit system, see http://patchbot.sagemath.org/log/0/debian/8.3/i686/3.16.0-4-586/tmonteil-debian-jessie-32/2016-04-15%2012:13:01?short\n\nFrom the error message, it is neither because of 32 bits nor because of the VM but because your (virtual) machine has only one core. The goal of the patch is to distribute computation on several cores. The doctest assumes that your machine has at least 2 cores. I should fix that. Though I'm not sure what to do on those kind of machine. Pretend that they are two core and let the computation run on those two cores ?",
    "created_at": "2016-04-15T20:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164334",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:105 tmonteil]:
> This ticket breaks the doctests on my patchbot, i do not know whether it is because it is run from a VM or from a 32-bit system, see http://patchbot.sagemath.org/log/0/debian/8.3/i686/3.16.0-4-586/tmonteil-debian-jessie-32/2016-04-15%2012:13:01?short

From the error message, it is neither because of 32 bits nor because of the VM but because your (virtual) machine has only one core. The goal of the patch is to distribute computation on several cores. The doctest assumes that your machine has at least 2 cores. I should fix that. Though I'm not sure what to do on those kind of machine. Pretend that they are two core and let the computation run on those two cores ?



---

archive/issue_comments_164335.json:
```json
{
    "body": "Replying to [comment:107 hivert]:\n> From the error message, it is neither because of 32 bits nor because of the VM but because your (virtual) machine has only one core. The goal of the patch is to distribute computation on several cores. The doctest assumes that your machine has at least 2 cores. I should fix that. Though I'm not sure what to do on those kind of machine. Pretend that they are two core and let the computation run on those two cores ?\n\nI just checked that I get the very same errors on my machine pretending that it has only one core.",
    "created_at": "2016-04-15T20:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164335",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:107 hivert]:
> From the error message, it is neither because of 32 bits nor because of the VM but because your (virtual) machine has only one core. The goal of the patch is to distribute computation on several cores. The doctest assumes that your machine has at least 2 cores. I should fix that. Though I'm not sure what to do on those kind of machine. Pretend that they are two core and let the computation run on those two cores ?

I just checked that I get the very same errors on my machine pretending that it has only one core.



---

archive/issue_comments_164336.json:
```json
{
    "body": "OK thanks for isolating the culplrit, i made #20449 as a follwup.",
    "created_at": "2016-04-15T20:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13376#issuecomment-164336",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

OK thanks for isolating the culplrit, i made #20449 as a follwup.
