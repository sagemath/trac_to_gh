# Issue 19379: Update sagenb

Issue created by migration from https://trac.sagemath.org/ticket/19616

Original creator: kcrisman

Original creation time: 2015-11-23 15:45:59

CC:  novoselt fbissey

It's time again to update sagenb.  Primarily for #10295 but also a number of other upstream issues which have been resolved better.


---

Comment by kcrisman created at 2015-12-01 04:46:08

I'll remove the dependency if it doesn't make progress, since there are several other things we would want to update anyway.


---

Comment by jdemeyer created at 2015-12-01 09:32:47

Replying to [comment:2 kcrisman]:
> I'll remove the dependency if it doesn't make progress, since there are several other things we would want to update anyway.

Is it really required that sagenb and pexpect are upgraded together? I haven't looked at #10295 since it depends on this ticket.


---

Comment by kcrisman created at 2015-12-01 14:52:30

> > I'll remove the dependency if it doesn't make progress, since there are several other things we would want to update anyway.
> 
> Is it really required that sagenb and pexpect are upgraded together? I haven't looked at #10295 since it depends on this ticket.
You'd have to ask FranÃ§ois, but my understanding of what he said is that this is indeed necessary for that commit.


---

Comment by jdemeyer created at 2015-12-01 15:06:02

Note that there is a circular dependency with #10295. Can somebody please clarify?


---

Comment by kcrisman created at 2015-12-01 15:14:12

> Note that there is a circular dependency with #10295. Can somebody please clarify?
Again, [fbissey said](https://github.com/sagemath/sagenb/pull/351#issuecomment-157493140) that the packages need to be updated simultaneously; assuming that this ticket ends up including [this commit](https://github.com/sagemath/sagenb/commit/ab1f775af96583e5b9db79f53c5f3613f2815894), then this ticket would be the one.


---

Comment by jdemeyer created at 2015-12-01 15:19:58

OK, I understand now, thanks for the pointer.

To resolve the deadlock situation: can somebody arrange for this ticket to be set to needs_review?


---

Comment by kcrisman created at 2015-12-01 15:25:01

Got it, I see the problem on your side now.

I can package up what we have if you are willing to review that commit (which is surely a trivial thing, I just haven't tested it).  I still want to merge https://github.com/sagemath/sagenb/pull/324 and https://github.com/sagemath/sagenb/pull/345 but will try to set aside some time for that this afternoon (US) and then package up a sagenb update for this purpose.


---

Comment by kcrisman created at 2015-12-01 18:58:03

I'm going to make a separate package with other changes for this ticket, and then a followup for #10295.  Hopefully done within a couple hours (lots of other things going on today).


---

Comment by kcrisman created at 2015-12-02 02:25:59

Ran into trouble with one of the updates not passing tests but I'm still going to decouple these.


---

Comment by jdemeyer created at 2015-12-02 08:45:51

If you want to add a `sagenb` package for #10295, just add it on #10295 instead of a separate ticket.


---

Comment by kcrisman created at 2015-12-02 13:46:29

Yes, that was my plan.


---

Comment by kcrisman created at 2015-12-03 03:44:52

New commits:


---

Comment by kcrisman created at 2015-12-03 03:44:52

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-12-04 18:30:51

Could you also make a sagenb version 0.11.6 for #10295? Then I could just test 0.11.6 and test both tickets at the same time.


---

Comment by kcrisman created at 2015-12-04 18:33:40

I won't make a full release, in case it turns out that doesn't get merged very quickly, but I'll make a version just for you and that ticket for testing purposes only.


---

Comment by jdemeyer created at 2015-12-04 21:32:38

Replying to [comment:18 kcrisman]:
> I won't make a full release, in case it turns out that doesn't get merged very quickly, but I'll make a version just for you and that ticket for testing purposes only.

What is the difference between a "full release" and a release "for testing purposes only"?


---

Comment by jdemeyer created at 2015-12-04 21:34:56

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-12-04 21:34:56

The documentation doesn't build:

```
# Sphinx version: 1.2.2
# Python version: 2.7.9
# Docutils version: 0.12 release
# Jinja2 version: 2.7.3
# Loaded extensions:
#   sphinx.ext.graphviz from /usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/ext/graphviz.pyc
#   sphinx.ext.inheritance_diagram from /usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/ext/inheritance_diagram.pyc
#   matplotlib.sphinxext.plot_directive from /usr/local/src/sage-config/local/lib/python2.7/site-packages/matplotlib-1.4.3-py2.7-linux-x86_64.egg/matplotlib/sphinxext/plot_directive.pyc
#   sphinx.ext.extlinks from /usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/ext/extlinks.pyc
#   inventory_builder from /usr/local/src/sage-config/src/doc/common/inventory_builder.pyc
#   sage_autodoc from /usr/local/src/sage-config/src/doc/common/sage_autodoc.pyc
#   sphinx.ext.todo from /usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/ext/todo.pyc
#   sphinx.ext.mathjax from /usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/ext/mathjax.pyc
#   sphinx.ext.oldcmarkup from /usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/ext/oldcmarkup.pyc
#   multidocs from /usr/local/src/sage-config/src/doc/common/multidocs.pyc
Traceback (most recent call last):
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/cmdline.py", line 254, in main
    app.build(force_all, filenames)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/application.py", line 212, in build
    self.builder.build_update()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/builders/__init__.py", line 214, in build_update
    'out of date' % len(to_build))
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/builders/__init__.py", line 234, in build
    purple, length):
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/builders/__init__.py", line 134, in status_iterator
    for item in iterable:
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/environment.py", line 480, in update_generator
    self.read_doc(docname, app=app)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/environment.py", line 627, in read_doc
    pub.publish()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/core.py", line 217, in publish
    self.settings)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/readers/__init__.py", line 72, in read
    self.parse()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/readers/__init__.py", line 78, in parse
    self.parser.parse(self.input, document)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/__init__.py", line 172, in parse
    self.statemachine.run(inputlines, document, inliner=self.inliner)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 170, in run
    input_source=document['source'])
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/statemachine.py", line 239, in run
    context, state, transitions)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/statemachine.py", line 460, in check_line
    return method(match, context, next_state)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2726, in underline
    self.section(title, source, style, lineno - 1, messages)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 327, in section
    self.new_subsection(title, lineno, messages)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 395, in new_subsection
    node=section_node, match_titles=True)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 282, in nested_parse
    node=node, match_titles=match_titles)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 195, in run
    results = StateMachineWS.run(self, input_lines, input_offset)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/statemachine.py", line 239, in run
    context, state, transitions)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/statemachine.py", line 460, in check_line
    return method(match, context, next_state)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2301, in explicit_markup
    self.explicit_list(blank_finish)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2331, in explicit_list
    match_titles=self.state_machine.match_titles)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 319, in nested_list_parse
    node=node, match_titles=match_titles)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 195, in run
    results = StateMachineWS.run(self, input_lines, input_offset)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/statemachine.py", line 239, in run
    context, state, transitions)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/statemachine.py", line 460, in check_line
    return method(match, context, next_state)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2604, in explicit_markup
    nodelist, blank_finish = self.explicit_construct(match)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2311, in explicit_construct
    return method(self, expmatch)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2054, in directive
    directive_class, match, type_name, option_presets)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/docutils/parsers/rst/states.py", line 2103, in run_directive
    result = directive_instance.run()
  File "/usr/local/src/sage-config/src/doc/common/sage_autodoc.py", line 1168, in run
    documenter.generate(more_content=self.content)
  File "/usr/local/src/sage-config/src/doc/common/sage_autodoc.py", line 680, in generate
    self.document_members(all_members)
  File "/usr/local/src/sage-config/src/doc/common/sage_autodoc.py", line 576, in document_members
    for (mname, member, isattr) in self.filter_members(members, want_all):
  File "/usr/local/src/sage-config/src/doc/common/sage_autodoc.py", line 535, in filter_members
    doc = sage_getdoc_original(member)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/misc/sageinspect.py", line 1698, in sage_getdoc_original
    s,argspec = _extract_embedded_signature(_sage_getdoc_unformatted(obj), typ.__name__)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/misc/sageinspect.py", line 1613, in _sage_getdoc_unformatted
    r = obj._sage_doc_()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Werkzeug-0.11.2-py2.7.egg/werkzeug/local.py", line 342, in __getattr__
    return getattr(self._get_current_object(), name)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Werkzeug-0.11.2-py2.7.egg/werkzeug/local.py", line 301, in _get_current_object
    return self.__local()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/Flask-0.10.1-py2.7.egg/flask/globals.py", line 34, in _find_app
    raise RuntimeError('working outside of application context')
RuntimeError: working outside of application context
```



---

Comment by jdemeyer created at 2015-12-04 21:55:50

New commits:


---

Comment by jdemeyer created at 2015-12-04 21:55:50

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2015-12-05 03:44:56

So... the documentation builds for me with this.  Is that all that you would need for positive review?  It was migeruhito's change (which is where that runtime error comes from, html built from this is not created without making _some_ app) that affected this, but for testing we had to do a weirder workaround but I'm not quite sure how building doc should come from sagenb, nor exactly how these changes fix it (Sloane functions?  Really?).  I did check that the documentation builds.

However, the live documentation does not seem to work.  In fact, I can't get it to work in Sage 6.9 either!  Can you confirm this?  (Regular notebook seems to work fine.)  I guess if it is already broken maybe this isn't so horrible, but it would be best to have it working, and it did work fairly recently or I would have noticed.

Another problem is that I think the security change has [messed with some of the live documentation](https://github.com/sagemath/sagenb/pull/324#issuecomment-162136411).


---

Comment by kcrisman created at 2015-12-05 04:07:19

> However, the live documentation does not seem to work.  In fact, I can't get it to work in Sage 6.9 either!  Can you confirm this?  (Regular notebook seems to work fine.)  I guess if it is already broken maybe this isn't so horrible, but it would be best to have it working, and it did work fairly recently or I would have noticed.

In particular, `cell.worksheet().docbrowser()` is what we use to test this.  I'm looking into that.


---

Comment by kcrisman created at 2015-12-05 04:21:24

I couldn't figure it out right now, anyway.


---

Comment by jdemeyer created at 2015-12-05 08:29:28

I'll move the docbuild changes to #19671, such that they can hopefully be reviewed independently.


---

Comment by jdemeyer created at 2015-12-05 08:30:52

New commits:


---

Comment by kcrisman created at 2015-12-05 14:54:21

See https://github.com/sagemath/sagenb/pull/324#issuecomment-162174499 for a small issue that cropped up.  I'll probably make a 0.11.5.1 release for that, or anything else anyone notices; leaving as 'needs review' because I think that will be fairly easy to fix and we need testing.

As I said, I'd appreciate independent confirmation or denial that live doc does or doesn't work.  In an online installation of 6.9 it works fine, but in my local it doesn't in Safari or Firefox - I tried getting rid of the cache but to no avail. I assume it's my problem but anyway it would be nice to know I'm not crazy.


---

Comment by jdemeyer created at 2015-12-09 20:40:38

The live documentation looks like

```
K.&lt;y&gt; = NumberField(x^4 - 420*x^2 + 40000)
z = y^5/11; z
```


[obligatory xkcd](https://xkcd.com/234/)


---

Comment by jdemeyer created at 2015-12-09 20:51:03

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-12-09 20:53:39

Replying to [comment:23 kcrisman]:
> However, the live documentation does not seem to work.
I don't really know what you mean with "does not seem to work". Apart from the escape issue, it seems to work (i.e. entering `1+1` in a cell does produce the answer `2`).


---

Comment by jdemeyer created at 2015-12-09 20:54:03

The notebook generally seems to work.


---

Comment by kcrisman created at 2015-12-10 01:14:27

> The live documentation looks like
> {{{
> K.&lt;y&gt; = NumberField(x^4 - 420*x^2 + 40000)
> z = y^5/11; z
> }}}
This is what I meant by "not work", sorry.  `@`migeruhito and I are working on it at https://github.com/sagemath/sagenb/pull/354 - he has a very nice fix but I'm having some separate trouble with my installation for some reason.
> [obligatory xkcd](https://xkcd.com/234/)
Indeed.


---

Comment by kcrisman created at 2015-12-10 02:22:39

> > However, the live documentation does not seem to work.
> I don't really know what you mean with "does not seem to work". Apart from the escape issue, it seems to work (i.e. entering `1+1` in a cell does produce the answer `2`).

If you aren't having any other problems with the notebook then I'll go ahead and make a new package out of 0.11.5 + [the live doc escape fix](https://github.com/sagemath/sagenb/pull/354).


---

Comment by jdemeyer created at 2015-12-10 07:14:11

Please add the fix for pexpect too, #10295 has been given positive review.


---

Comment by jdemeyer created at 2015-12-10 07:18:42

Note that the dependency #19671 still needs a review.


---

Comment by jdemeyer created at 2015-12-10 08:33:55

Since we are in the "sage-6.10.rc" phase, I don't think this should be merged in 6.10.


---

Comment by jdemeyer created at 2015-12-10 08:41:08

And given that we are not in a hurry, I would like to look into fixing [https://github.com/sagemath/sagenb/issues/260](https://github.com/sagemath/sagenb/issues/260)


---

Comment by jdemeyer created at 2015-12-10 13:50:38

Replying to [comment:39 jdemeyer]:
> And given that we are not in a hurry, I would like to look into fixing [https://github.com/sagemath/sagenb/issues/260](https://github.com/sagemath/sagenb/issues/260)

This is now https://github.com/sagemath/sagenb/pull/355


---

Comment by kcrisman created at 2015-12-10 14:15:47

Okay, I'll take a look at that PR and try to update with respect to all these things.


---

Comment by kcrisman created at 2015-12-11 19:14:05

> Okay, I'll take a look at that PR and try to update with respect to all these things.
This causes some breaks.  In order to get #19671 in the first beta of 6.11 (or whatever Volker decides to call it), I'd prefer to make a sagenb package out of everything up to that fix.  Unfortunately I don't have any more time this weekend for sagenb stuff other than doing that.


---

Comment by git created at 2015-12-13 03:41:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2015-12-13 03:47:21

Needs review - not a bad idea to just check things out again, hopefully it will also work well in the 6.11 betas.


---

Comment by kcrisman created at 2015-12-13 03:47:21

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-12-13 09:43:27

Does this include the fix for #10295?


---

Comment by kcrisman created at 2015-12-13 21:09:58

Would I have released this new one otherwise?  You also could have just checked the github:
* https://github.com/sagemath/sagenb/commits/master
* https://github.com/sagemath/sagenb/commit/030a4e87c9b43c0139161f67855cfc23aaedb782


---

Comment by jdemeyer created at 2015-12-14 09:17:53

Replying to [comment:46 kcrisman]:
> Would I have released this new one otherwise?

I have no idea really. It's hard to follow what is happening precisely. I will update #10295.


---

Comment by jdemeyer created at 2015-12-14 11:19:43

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-12-14 11:19:43

[This commit](https://github.com/sagemath/sagenb/commit/509329893169d4f43274dd6c6d7ba2e2c5acb07e) is causing doctest failures

```
sage -t --long local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 154, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.process_doc_html
Failed example:
    txt
Expected:
    '<h1 class="title">Title</h1>\n\n<p>nSome text</p>\n\n\n\n'
Got:
    u'<h1 class="title">Title</h1>\n\n<p>nSome text</p>\n\n\n\n'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 199, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.hand_off_temp_pieces
Failed example:
    p.all_pieces
Expected:
    'a lot of stuff done bunch of tmp strings'
Got:
    u'a lot of stuff done bunch of tmp strings'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 323, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.process_cell_input_output
Failed example:
    p.process_cell_input_output(s)
Expected:
    '\n`id=0|\n4 + 4\n///\n8\n`\n\n'
Got:
    u'\n`id=0|\n4 + 4\n///\n8\n`\n\n'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 426, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.unknown_starttag
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<style type="text/css">']
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<style type="text/css">']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 449, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.unknown_endtag
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '</head>'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'</head>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 492, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.handle_charref
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '&#160;']
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'&#160;']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 514, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.handle_entityref
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '&160']
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'&160']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 537, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.handle_comment
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<!--important comment-->'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<!--important comment-->']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 560, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.handle_pi
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<?instructions>'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<?instructions>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 582, in sagenb.notebook.docHTMLProcessor.genericHTMLProcessor.handle_decl
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<!declaration>'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<!declaration>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 672, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.reset
Failed example:
    d.all_pieces
Expected:
    ''
Got:
    u''
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 748, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.start_div
Failed example:
    p.all_pieces
Expected:
    'a lot of stuff done bunch of tmp strings' 
Got:
    u'a lot of stuff done bunch of tmp strings'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 765, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.start_div
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<div class="something-else">']
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<div class="something-else">']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 826, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.end_div
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<div class="something-else">', 'some data', '</div>']
Got:
    ['bunch ',
     'of ',
     'tmp ',
     'strings',
     u'<div class="something-else">',
     'some data',
     u'</div>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 873, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.start_pre
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<pre>'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<pre>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 907, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.end_pre
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '</pre>'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'</pre>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 933, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.start_form
Failed example:
    p.all_pieces
Expected:
    'a lot of stuff done bunch of tmp strings' 
Got:
    u'a lot of stuff done bunch of tmp strings'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 996, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.start_span
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<span>'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<span>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 1029, in sagenb.notebook.docHTMLProcessor.SphinxHTMLProcessor.end_span
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '</span>'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'</span>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 1111, in sagenb.notebook.docHTMLProcessor.docutilsHTMLProcessor.reset
Failed example:
    d.all_pieces
Expected:
    ''
Got:
    u''
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 1183, in sagenb.notebook.docHTMLProcessor.docutilsHTMLProcessor.start_pre
Failed example:
    p.all_pieces
Expected:
    'a lot of stuff done bunch of tmp strings' 
Got:
    u'a lot of stuff done bunch of tmp strings'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 1200, in sagenb.notebook.docHTMLProcessor.docutilsHTMLProcessor.start_pre
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<pre class="something-else">']
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'<pre class="something-else">']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 1258, in sagenb.notebook.docHTMLProcessor.docutilsHTMLProcessor.end_pre
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '<pre class="something-else">', 'some data', '</pre>']
Got:
    ['bunch ',
     'of ',
     'tmp ',
     'strings',
     u'<pre class="something-else">',
     'some data',
     u'</pre>']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 1335, in sagenb.notebook.docHTMLProcessor.docutilsHTMLProcessor.start_cite
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '$'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'$']
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.11.6-py2.7.egg/sagenb/notebook/docHTMLProcessor.py", line 1355, in sagenb.notebook.docHTMLProcessor.docutilsHTMLProcessor.end_cite
Failed example:
    p.temp_pieces
Expected:
    ['bunch ', 'of ', 'tmp ', 'strings', '$', 'x^2', '$'] 
Got:
    ['bunch ', 'of ', 'tmp ', 'strings', u'$', 'x^2', u'$']
**********************************************************************
```



---

Comment by jdemeyer created at 2015-12-14 11:32:52

Apart from this, the notebook seems to work.


---

Comment by kcrisman created at 2015-12-14 19:33:16

Aargh!!!  I knew something like this would happen.  I apologize for not doing this - I thought SURELY this wouldn't change doctests and I wanted to make a package really quickly for when I wouldn't have a lot of access to Sage... well, shame on me.


---

Comment by kcrisman created at 2015-12-14 19:35:26

See https://github.com/sagemath/sagenb/issues/357


---

Comment by kcrisman created at 2015-12-15 02:53:57

Now I remember why I didn't doctest it - because I didn't want to have to deal with checking #10295 at the same time because it would be complicated to test both... I will try to deal with this now, anyway.


---

Comment by git created at 2015-12-15 13:48:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2015-12-15 13:52:46

Okay, I have now hopefully taken care of everything...


---

Comment by kcrisman created at 2015-12-15 13:52:53

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2015-12-16 21:28:43

AFAIK, the notebook works (including the live doc) and doctests pass. Ready to set a positive review?


---

Comment by jdemeyer created at 2015-12-16 21:32:18

I did not test the latest version, but the versions before seemed to work. So for me, this is good to go.


---

Comment by jdemeyer created at 2015-12-16 21:32:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-12-22 19:50:42

Resolution: fixed
