# Issue 15104: Hashing of GammaH congruence groups is broken

Issue created by migration from https://trac.sagemath.org/ticket/15341

Original creator: mderickx

Original creation time: 2013-10-29 21:33:26

CC:  tmonteil

To quote the python reference manual: http://docs.python.org/2/reference/datamodel.html#object.__hash__

The only required property is that objects which compare equal have the same hash value;

However:

```
G1=GammaH(21,[4])
G2=GammaH(21,[4,16])
print G1==G2
print hash(GammaH(21,[4,16]))
print hash(GammaH(21,[4]))
```


prints:


```
True
8309769839484863814
1170799062851396877
```



---

Comment by mderickx created at 2017-08-27 06:08:17

It will fail on 32bit systems, this ticket is reviewable if one just keeps in the back of your mind that a doctest needs to be changed for 32bit systems. 

Hopefully the patchbot will provide the correct value (otherwise we should find someone with a 32 bit system).
----
New commits:


---

Comment by mderickx created at 2017-08-27 06:08:17

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-08-27 15:14:42

Author name.


---

Comment by vdelecroix created at 2017-08-27 15:17:07

Why not

```
if xK in L:
    rts_L.append((L(xK), mult))
```



---

Comment by mderickx created at 2017-08-27 17:26:36

Hi thanks for looking at this,

Sorry, I should have been more clear. Only commmit b96aa08b6fe8cd1809fd514a37cc48bb6c144e99 is new. Al the other commits are just #23656 so your comment only makes sense for that ticket, and doesn't relate to the code under review here.

Do you happen to know a way to only show the new commits at this ticket? I tried setting #23656 as a dependency. But that doesn't work.


---

Comment by vdelecroix created at 2017-08-27 20:46:20

My comment does not apply to anything, it was intended for #23726


---

Comment by mderickx created at 2017-08-27 21:28:58

Hi Thierry Monteil,

I saw at https://wiki.sagemath.org/buildbot/owners that you have a 32bit patchbot. Could you test this ticket so that I know what hashes are returned on a 32bit machine.

Thanks in advance,
Maarten


---

Comment by tmonteil created at 2017-08-29 16:59:23

I am compiling your branch on a 32bit VM running Debian stretch. Which files chould i doctest ?


---

Comment by mderickx created at 2017-08-29 17:15:49

Thanks, the file is `src/sage/modular/arithgroup/arithgroup_generic.py`


---

Comment by git created at 2017-08-29 22:02:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2017-08-29 22:52:38

I got : 


```
sagemath@tmonteil-debian-stretch-32:/opt/sagemath/sage-8.0$ ./sage -t src/sage/modular/arithgroup/arithgroup_generic.py
Forcing sage-location, probably because a new package was installed.
Cleaning up, do not interrupt this.
Done cleaning.
Running doctests with ID 2017-08-29-22-50-23-b6ae0811.
Git branch: develop
Using --optional=4ti2,benzene,bliss,buckygen,cbc,ccache,cmake,coxeter3,cryptominisat,csdp,d3js,database_gap,database_pari,frobby,gambit,gap_jupyter,gap_packages,gdb,giacpy_sage,gmpy2,gp2c,igraph,latte_int,libbraiding,libhomfly,libogg,lidia,lrslib,mcqd,meataxe,mpir,normaliz,ore_algebra,pandoc_attributes,pandocfilters,pari_jupyter,plantri,pynormaliz,pysingular,python2,python_igraph,qepcad,rst2ipynb,saclib,sage,scons,singular_jupyter,sip,sirocco,tdlib,termcap,tides,topcom
Doctesting 1 file.
sage -t --warn-long 47.4 src/sage/modular/arithgroup/arithgroup_generic.py
**********************************************************************
File "src/sage/modular/arithgroup/arithgroup_generic.py", line 199, in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__
Failed example:
    Gamma0(11).__hash__()
Expected:
    -545929996 
Got:
    118770652
**********************************************************************
File "src/sage/modular/arithgroup/arithgroup_generic.py", line 202, in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__
Failed example:
    Gamma1(11).__hash__()
Expected:
    -830809815 
Got:
    201042552
**********************************************************************
1 item had failures:
   2 of   8 in sage.modular.arithgroup.arithgroup_generic.ArithmeticSubgroup.__hash__
    [159 tests, 2 failures, 5.60 s]
----------------------------------------------------------------------
sage -t --warn-long 47.4 src/sage/modular/arithgroup/arithgroup_generic.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 5.7 seconds
    cpu time: 3.5 seconds
    cumulative wall time: 5.6 seconds
```


Which is consistent with your latest commit.


---

Comment by vdelecroix created at 2017-09-01 23:58:31

Replying to [comment:12 mderickx]:
> Hi Thierry Monteil,
> 
> I saw at https://wiki.sagemath.org/buildbot/owners that you have a 32bit patchbot. Could you test this ticket so that I know what hashes are returned on a 32bit machine.

Hashing on a 32 bit is just the same thing but modulo `2^32`

```
sage: 3713075136762760156 % (2**32)
118770652
```

(though the result are in (-2<sup>31</sup>, 2<sup>31</sup>])


---

Comment by chapoton created at 2017-09-06 05:47:31

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-09-06 05:47:31

ok


---

Comment by vbraun created at 2017-09-10 22:05:58

Resolution: fixed
