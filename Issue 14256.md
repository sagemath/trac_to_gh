# Issue 14256: GCC-4.8.0 miscompiles some sig_on() statements

archive/issues_014256.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nWith #14452 and #14453, the are crashes in libGAP due to a GCC bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)\n\nCompiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14460\n\n",
    "created_at": "2013-04-16T14:37:47Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "GCC-4.8.0 miscompiles some sig_on() statements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14256",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: GeorgSWeber

With #14452 and #14453, the are crashes in libGAP due to a GCC bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)

Compiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.

Issue created by migration from https://trac.sagemath.org/ticket/14460





---

archive/issue_comments_179123.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2013-04-16T18:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179123",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to critical.



---

archive/issue_comments_179124.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-16T18:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179124",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_179125.json:
```json
{
    "body": "I guess the plan is to patch Sage again when GCC fixes the problem (hopefully in 4.8.1 and 4.9.?)?",
    "created_at": "2013-04-16T20:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179125",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I guess the plan is to patch Sage again when GCC fixes the problem (hopefully in 4.8.1 and 4.9.?)?



---

archive/issue_comments_179126.json:
```json
{
    "body": "Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-) \n\nIn fact, the imho best way is to stick it into the compiler wrapper so that everything (and not just the sage library) gets no-tree-dominator-opts enforced if and only if the gcc version is affected. Though thats a bit of a longer project...\n\nSo, if you want to go on with this bandaid then thats good enough for now.",
    "created_at": "2013-04-16T21:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179126",
    "user": "https://github.com/vbraun"
}
```

Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-) 

In fact, the imho best way is to stick it into the compiler wrapper so that everything (and not just the sage library) gets no-tree-dominator-opts enforced if and only if the gcc version is affected. Though thats a bit of a longer project...

So, if you want to go on with this bandaid then thats good enough for now.



---

archive/issue_comments_179127.json:
```json
{
    "body": "Replying to [comment:6 vbraun]:\n> Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)\nWell, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.\n\nAbout this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?",
    "created_at": "2013-04-16T21:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179127",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 vbraun]:
> Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)
Well, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.

About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?



---

archive/issue_comments_179128.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Replying to [comment:6 vbraun]:\n> > Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)\n> Well, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.\n> \n> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?\nI agree its a saner approach to hope archeologists will limit the GCC versions for which the fix is applied.\nAt worst, it won't be applied when GCC 4.10 gets stable.\n\nGreat you mentioned both the upstream bug and this track ticket in the patch.\nMaybe a direct indication of what the bug is could help, e.g. adding \"which let sig_on() miscompile\" after \"bug\".\nEven without it I'll give it positive_review, when I can reproduce the problem and check its indeed solved with the patch.\n(I assume the space between 'null' and '\"\"\"' is there for ease of reading.)\nFrom #14460, I thought the crash appeared when doctesting sage/structure/element.pyx?\nBut after recompiling libgap, this file, and everything in sage/libs/gap, using gcc-4.8 from debian running \"./sage -t\" on this file is fine.\nYou mention that there are no failing doctests, so I may have missed something.\n\nUsing the code you posted at gcc bugtracker I get\n\n```\n[jp@jp-x220]% cd ../bla                            ~/boulot/sage/sage-5.9.beta5\n[jp@jp-x220]% gcc-4.8 -Og jmp.c                               ~/boulot/sage/bla\n[jp@jp-x220]% ./a.out                                         ~/boulot/sage/bla\nReturning 1\nx = 0, n = 1\nReturning 0\nx = 42, n = 1\nzsh: abort      ./a.out\n```\n\nSo I guess debian's gcc does not include a magical fix.",
    "created_at": "2013-04-16T22:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179128",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:7 jdemeyer]:
> Replying to [comment:6 vbraun]:
> > Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)
> Well, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.
> 
> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?
I agree its a saner approach to hope archeologists will limit the GCC versions for which the fix is applied.
At worst, it won't be applied when GCC 4.10 gets stable.

Great you mentioned both the upstream bug and this track ticket in the patch.
Maybe a direct indication of what the bug is could help, e.g. adding "which let sig_on() miscompile" after "bug".
Even without it I'll give it positive_review, when I can reproduce the problem and check its indeed solved with the patch.
(I assume the space between 'null' and '"""' is there for ease of reading.)
From #14460, I thought the crash appeared when doctesting sage/structure/element.pyx?
But after recompiling libgap, this file, and everything in sage/libs/gap, using gcc-4.8 from debian running "./sage -t" on this file is fine.
You mention that there are no failing doctests, so I may have missed something.

Using the code you posted at gcc bugtracker I get

```
[jp@jp-x220]% cd ../bla                            ~/boulot/sage/sage-5.9.beta5
[jp@jp-x220]% gcc-4.8 -Og jmp.c                               ~/boulot/sage/bla
[jp@jp-x220]% ./a.out                                         ~/boulot/sage/bla
Returning 1
x = 0, n = 1
Returning 0
x = 42, n = 1
zsh: abort      ./a.out
```

So I guess debian's gcc does not include a magical fix.



---

archive/issue_comments_179129.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n\n> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?\n\nWould it be easily doable to include a doctest that DOES fail in the presence of this bug?",
    "created_at": "2013-04-17T00:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179129",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:7 jdemeyer]:

> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?

Would it be easily doable to include a doctest that DOES fail in the presence of this bug?



---

archive/issue_comments_179130.json:
```json
{
    "body": "Replying to [comment:9 nbruin]:\n> Would it be easily doable to include a doctest that DOES fail in the presence of this bug?\nYes, as I mentioned #14453 does that.",
    "created_at": "2013-04-17T06:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179130",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 nbruin]:
> Would it be easily doable to include a doctest that DOES fail in the presence of this bug?
Yes, as I mentioned #14453 does that.



---

archive/issue_comments_179131.json:
```json
{
    "body": "Replying to [comment:8 jpflori]:\n> Maybe a direct indication of what the bug is could help, e.g. adding \"which let sig_on() miscompile\" after \"bug\".\n\nDone.",
    "created_at": "2013-04-17T06:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179131",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 jpflori]:
> Maybe a direct indication of what the bug is could help, e.g. adding "which let sig_on() miscompile" after "bug".

Done.



---

archive/issue_comments_179132.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Replying to [comment:9 nbruin]:\n> > Would it be easily doable to include a doctest that DOES fail in the presence of this bug?\n> Yes, as I mentioned #14453 does that.\nI meant #14453 in my previous post.\nI'll rebuild the Sage library and retry doctesting sage/libs/gap/element.pyx",
    "created_at": "2013-04-17T07:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179132",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:10 jdemeyer]:
> Replying to [comment:9 nbruin]:
> > Would it be easily doable to include a doctest that DOES fail in the presence of this bug?
> Yes, as I mentioned #14453 does that.
I meant #14453 in my previous post.
I'll rebuild the Sage library and retry doctesting sage/libs/gap/element.pyx



---

archive/issue_comments_179133.json:
```json
{
    "body": "I've rebuilt Sage (5.9.beta5 + #10508) completely using Debian gcc/g++/gfortran 4.8.0 without any env variables except for MAKE, CC, GXX, FC and SAGE_ATLAS_ARCH, then applied #14453, rerun \"./sage -b\", but \"./sage -t devel/sage/sage/libs/gap/element.pyx\" still passes its doctests...\n\nI don't doubt GCC is broken as I can reproduce its buggy behavior on the piece of code you provided, but it would have been nice to confirm the fix indeed fixes potential problems in Sage.\n\nLast minute info: ok I just needed to set CFLAGS=\"-Og\" to reproduce the bug, I guess this should be more explicitely documented.\nIt's stated on the GCC ticket but nowhere on Sage's Trac.",
    "created_at": "2013-04-17T09:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179133",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I've rebuilt Sage (5.9.beta5 + #10508) completely using Debian gcc/g++/gfortran 4.8.0 without any env variables except for MAKE, CC, GXX, FC and SAGE_ATLAS_ARCH, then applied #14453, rerun "./sage -b", but "./sage -t devel/sage/sage/libs/gap/element.pyx" still passes its doctests...

I don't doubt GCC is broken as I can reproduce its buggy behavior on the piece of code you provided, but it would have been nice to confirm the fix indeed fixes potential problems in Sage.

Last minute info: ok I just needed to set CFLAGS="-Og" to reproduce the bug, I guess this should be more explicitely documented.
It's stated on the GCC ticket but nowhere on Sage's Trac.



---

archive/issue_comments_179134.json:
```json
{
    "body": "And when \"-Og\" is used, then the fix indeed fixes the problem.\n\nSo let's mention \"-Og\" that in the patch as well (let's say in setup.py where the fix is triggered, not sure it will be easy to find near the problematic doctest itself, for that the archeologist will have to come to the trac ticket).",
    "created_at": "2013-04-17T09:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179134",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

And when "-Og" is used, then the fix indeed fixes the problem.

So let's mention "-Og" that in the patch as well (let's say in setup.py where the fix is triggered, not sure it will be easy to find near the problematic doctest itself, for that the archeologist will have to come to the trac ticket).



---

archive/issue_comments_179135.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-17T09:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179135",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_179136.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-17T10:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179136",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_179137.json:
```json
{
    "body": "Attachment [14460_gcc_bug.patch](tarball://root/attachments/some-uuid/ticket14460/14460_gcc_bug.patch) by @jdemeyer created at 2013-04-17 10:06:40",
    "created_at": "2013-04-17T10:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179137",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [14460_gcc_bug.patch](tarball://root/attachments/some-uuid/ticket14460/14460_gcc_bug.patch) by @jdemeyer created at 2013-04-17 10:06:40



---

archive/issue_comments_179138.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-17T10:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179138",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_179139.json:
```json
{
    "body": "By the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.",
    "created_at": "2013-04-17T10:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179139",
    "user": "https://github.com/jdemeyer"
}
```

By the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.



---

archive/issue_comments_179140.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> By the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.\n\nWell, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?\n\nOn the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?\n\n\n\n\nIMHO the scenario is specific enough that it's not worth fixing it within Sage at all (and there's an easy \"work-around\": just add `-fno-tree-dominator-opts` to `CFLAGS` in case it also contains -- not to say \"you added\" --  `-Og` [and GCC is 4.8.0]).\n\nWe do not add a potentially missing `-fno-strict-aliasing` for compiling Cython-generated code (which is a much more common or likely case, and btw. completely independent of the compiler version), nor do we add `-fno-ipa-cp-clone` when building R (with GCC 4.7.x and `-O3`).",
    "created_at": "2013-04-17T22:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179140",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:19 jdemeyer]:
> By the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.

Well, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?

On the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?




IMHO the scenario is specific enough that it's not worth fixing it within Sage at all (and there's an easy "work-around": just add `-fno-tree-dominator-opts` to `CFLAGS` in case it also contains -- not to say "you added" --  `-Og` [and GCC is 4.8.0]).

We do not add a potentially missing `-fno-strict-aliasing` for compiling Cython-generated code (which is a much more common or likely case, and btw. completely independent of the compiler version), nor do we add `-fno-ipa-cp-clone` when building R (with GCC 4.7.x and `-O3`).



---

archive/issue_comments_179141.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n> On the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?\nGood point.\n\n> nor do we add -fno-ipa-cp-clone when building R (with GCC 4.7.x and -O3).\nMaybe we should :) especially that we ship 4.7.x in Sage.",
    "created_at": "2013-04-17T23:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179141",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:20 leif]:
> On the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?
Good point.

> nor do we add -fno-ipa-cp-clone when building R (with GCC 4.7.x and -O3).
Maybe we should :) especially that we ship 4.7.x in Sage.



---

archive/issue_comments_179142.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n> Well, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?\nPerhaps...\n\n> the bug only shows up in conjunction with `-Og`\nThis is unfounded speculation.\n\n> does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?\nAbsolutely, since we don't know the precise conditions which trigger the bug. As I said, `sig_on()` error handling is rarely doctested, so we cannot rely on doctests to check for this bug.",
    "created_at": "2013-04-18T06:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179142",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:20 leif]:
> Well, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?
Perhaps...

> the bug only shows up in conjunction with `-Og`
This is unfounded speculation.

> does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?
Absolutely, since we don't know the precise conditions which trigger the bug. As I said, `sig_on()` error handling is rarely doctested, so we cannot rely on doctests to check for this bug.



---

archive/issue_comments_179143.json:
```json
{
    "body": "So, what is your opinion on adding `-fno-dominator-opts` for all GCC versions >= 4.1?",
    "created_at": "2013-04-18T07:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179143",
    "user": "https://github.com/jdemeyer"
}
```

So, what is your opinion on adding `-fno-dominator-opts` for all GCC versions >= 4.1?



---

archive/issue_comments_179144.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> Replying to [comment:20 leif]:\n> > the bug only shows up in conjunction with `-Og`\n> This is unfounded speculation.\n\nBesides that I wrote *\"if ...\"*, it's as \"founded\" as the conclusion that (solely) adding `-fno-tree-dominator-opts` solves the issue.",
    "created_at": "2013-04-18T11:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179144",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:22 jdemeyer]:
> Replying to [comment:20 leif]:
> > the bug only shows up in conjunction with `-Og`
> This is unfounded speculation.

Besides that I wrote *"if ..."*, it's as "founded" as the conclusion that (solely) adding `-fno-tree-dominator-opts` solves the issue.



---

archive/issue_comments_179145.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-19T13:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179145",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_014049.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2013-04-19T13:53:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14256#event-14049"
}
```



---

archive/issue_comments_179146.json:
```json
{
    "body": "Bug still exists in GCC-4.8.1.",
    "created_at": "2013-05-31T11:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179146",
    "user": "https://github.com/jdemeyer"
}
```

Bug still exists in GCC-4.8.1.



---

archive/issue_comments_179147.json:
```json
{
    "body": "Too bad.\n\nI was thinking about this and must admit Volker had a point.\nWe unconditionnally pass \"-fno-...\" whereas without further tweaking gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.\nOf course according to Jeroen we don't really know (or do we now?) what options trigger the miscompile, so it is the safest choice to always pass \"-fno-...\".\n\nBut then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...\n\n(By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)",
    "created_at": "2013-05-31T11:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179147",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Too bad.

I was thinking about this and must admit Volker had a point.
We unconditionnally pass "-fno-..." whereas without further tweaking gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.
Of course according to Jeroen we don't really know (or do we now?) what options trigger the miscompile, so it is the safest choice to always pass "-fno-...".

But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...

(By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)



---

archive/issue_comments_179148.json:
```json
{
    "body": "Replying to [comment:27 jpflori]:\n> gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.\nSame answer as I made before: what makes you think that this is true?\n\n> But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...\nI never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.\n\n> (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)\nAt least, the flags added by Sage come at the very end of the command line.",
    "created_at": "2013-05-31T12:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179148",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 jpflori]:
> gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.
Same answer as I made before: what makes you think that this is true?

> But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...
I never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.

> (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)
At least, the flags added by Sage come at the very end of the command line.



---

archive/issue_comments_179149.json:
```json
{
    "body": "Replying to [comment:28 jdemeyer]:\n> Replying to [comment:27 jpflori]:\n> > gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.\n> Same answer as I made before: what makes you think that this is true?\nOr that it is not true?\nFrom your report it seemed you got segfaults only when passing\n> \n> > But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...\n> I never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.\nI agree, I only posted all of this here so that I don't lose it in my mind.\n> \n> > (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)\n> At least, the flags added by Sage come at the very end of the command line.\nNot really sure, I had a really painful experience lately building Python on a Raspberry Pi.\nDoing something like \"CFLAGS=\"-O -g\" ./sage -i python.spkg\" does not work.\nDoing \"OPT= CFLAG=\"-O -g\" ...\" would work.\nLook at configure.ac and Makefile.pre.in, the only thing that comes in $CFLAGS after $OPT is $EXTRA_CFLAGS (which is surely meant to be mostly user defined).\nAnyway it's not really the place to discuss this.",
    "created_at": "2013-05-31T12:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179149",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:28 jdemeyer]:
> Replying to [comment:27 jpflori]:
> > gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.
> Same answer as I made before: what makes you think that this is true?
Or that it is not true?
From your report it seemed you got segfaults only when passing
> 
> > But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...
> I never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.
I agree, I only posted all of this here so that I don't lose it in my mind.
> 
> > (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)
> At least, the flags added by Sage come at the very end of the command line.
Not really sure, I had a really painful experience lately building Python on a Raspberry Pi.
Doing something like "CFLAGS="-O -g" ./sage -i python.spkg" does not work.
Doing "OPT= CFLAG="-O -g" ..." would work.
Look at configure.ac and Makefile.pre.in, the only thing that comes in $CFLAGS after $OPT is $EXTRA_CFLAGS (which is surely meant to be mostly user defined).
Anyway it's not really the place to discuss this.



---

archive/issue_comments_179150.json:
```json
{
    "body": "Replying to [comment:29 jpflori]:\n> Or that it is not true?\nThe principle of being on the safe side means that, in the case of doubt, assume something can go wrong.\n\n> From your report it seemed you got segfaults only when passing\n...the `-Og` flag. (I guess this is what you wanted to write).\n\nAnd that's even true: the particular segfault in libGAP only occurs with `-Og`. But there could very well be other segfaults, not found by doctests, in other parts of Sage, with the default flags.",
    "created_at": "2013-05-31T12:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179150",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:29 jpflori]:
> Or that it is not true?
The principle of being on the safe side means that, in the case of doubt, assume something can go wrong.

> From your report it seemed you got segfaults only when passing
...the `-Og` flag. (I guess this is what you wanted to write).

And that's even true: the particular segfault in libGAP only occurs with `-Og`. But there could very well be other segfaults, not found by doctests, in other parts of Sage, with the default flags.



---

archive/issue_comments_179151.json:
```json
{
    "body": "Let me copy this sentence from the ticket description:\n\nlibGAP is one of the few places in Sage where non-trivial use of the sig_on() signal handling is actually tested, so there might be many more places where the problem could occur.",
    "created_at": "2013-05-31T12:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179151",
    "user": "https://github.com/jdemeyer"
}
```

Let me copy this sentence from the ticket description:

libGAP is one of the few places in Sage where non-trivial use of the sig_on() signal handling is actually tested, so there might be many more places where the problem could occur.



---

archive/issue_comments_179152.json:
```json
{
    "body": "Yeah I agree, no harm meant at all.\n\nThe best solution would be to live in a world where GCC never exposes bugs.\nAnd as I've said before, I'm ok with the solution which was merged, I even gave positive_review, I just hope the situation would be better.\nAt some point we'll have to rule out all versions of GCC :)",
    "created_at": "2013-05-31T12:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14256#issuecomment-179152",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Yeah I agree, no harm meant at all.

The best solution would be to live in a world where GCC never exposes bugs.
And as I've said before, I'm ok with the solution which was merged, I even gave positive_review, I just hope the situation would be better.
At some point we'll have to rule out all versions of GCC :)
