# Issue 23672: GCD for univariate polynomials over fraction fields

Issue created by migration from Trac.

Original creator: mfrancis

Original creation time: 2017-09-21 09:32:32

CC:  mmezzarobba

Keywords: gcd, univariate polynomials, fraction fields as coefficients

Some of the sagemath packages we use requires us to compute the GCD of univariate polynomials whose coefficient ring is the fraction field of multivariate polynomials over integral domains like Z, e.g: polynomials in the ring Frac(Z[x,y])[z]. 
\\
Right now in Sagemath if we run  the following example, the regular Euclidean algorithm implemented in rings.py for computing gcd is called. It is very slow and the implementation hangs for degrees >4. 
\\
**Example :**
\\
sage: A.<x,y>=ZZ[]
\\
sage: B= Frac(A)
\\
sage: C.<z> = B[]
\\
sage: p = C.random_element(6)
\\
sage: q = C.random_element(6)
\\
sage: gcd(p,q)
\\
Hangs!
\\
**Reason for the function to hang :** It repeatedly has to call the multiplication function which calls  the gcd function in multi_polynomial_libsingular.pyx and therefore is slow. 
\\
**Proposed Change:** Add a new function _gcd_univariate_polynomial()  inside the class, class FractionField_generic(ring.Field). It can be found in /src/sage/rings/fraction_field.py.
\\
\\
This new function flattens the polynomial (which has coefficients from a fractional field of a multivariate polynomial ring) by dividing with the GCD of the coefficient polynomials. It then considers the polynomial as a multivariate polynomial in all the variables and therefore there is only one call to the multivariate gcd function. Hence this new implementation even for degree = 30 returns the gcd within seconds.


---

Comment by git created at 2017-09-21 09:51:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mfrancis created at 2017-09-21 11:14:53

Changing status from new to needs_review.


---

Comment by msaaltink created at 2017-09-25 18:30:27

Changing status from needs_review to needs_work.


---

Comment by msaaltink created at 2017-09-25 18:30:27

This change breaks many gcd computations that now work.  For example

```
sage: Q.<x> = B[]
sage: F = Q.fraction_field()
sage: R.<y> = F[]
sage: f = (y + x)^2 * (y - 1/x)^3
sage: g = (y + x)^4 * (y - 1/x)^2
sage: gcd(f,g)
```

When `B` is `ZZ` or `Zmod(5)` or `GaussianIntegers()`, we get answers in Sage as it is. With your change, all of them raise a `TypeError` on some internal `gcd` call.

Moreover, the result of `gcd` should be in the same ring as the arguments.  We do not always get that with this change.


---

Comment by mfrancis created at 2018-02-24 21:56:10

Made the changes : 1. Corrected it for Z, finite fields ( fields defined as Z mod p call the previous implementation, the usual Euclidean algorithm), and the returned gcd is the same ring as the input polynomials. 
----
New commits:


---

Comment by mfrancis created at 2018-02-25 11:28:56

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-02-26 06:53:45

The documentation is badly misformatted. See http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings

And this is completely unreadable:

```
if (is_IntegerRing(f.base_ring().base_ring()) == True or is_IntegerRing(g.base_ring().base_ring())== True or (f.base_ring().base_ring().is_field() == True and (is_IntegerModRing(f.base_ring().base_ring()) == False or is_FiniteField(f.base_ring().base_ring()) == True)) or (g.base_ring().base_ring().is_field() == True and (is_IntegerModRing(g.base_ring().base_ring()) == False or is_FiniteField(g.base_ring().base_ring()) == True)) ) :
```



---

Comment by jdemeyer created at 2018-02-26 06:53:45

Changing status from needs_review to needs_work.


---

Comment by mmezzarobba created at 2018-04-23 16:41:37

Hi Maria,

As it turns out, most of the necessary work had already been done in the implementation of `gcd()` for polynomials over polynomial rings. Here is a simpler implementation that takes advantage of that.

(Sorry that it took me so incredibly long to have a stab at this as promised!)
----
New commits:


---

Comment by mmezzarobba created at 2018-04-23 16:41:37

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2018-04-23 16:45:51

~~Note: this does break~~

```
sage: Pol = Frac(QQ['x'])['x']
sage: p = Frac(QQ['x'])['x'].one()
sage: p.gcd(p)
...
ValueError: variable name 'x' appears more than once
```

~~because the same thing with polynomials over a _polynomial_ ring is already broken, see #25233. I think this is an acceptable regression, at least temporarily...~~ Edit: fixed at #25233!


---

Comment by mmezzarobba created at 2018-04-24 08:47:01

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-04-24 08:58:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-04-24 09:11:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-04-24 11:55:16

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-04-26 12:43:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-11 18:31:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-05-11 19:12:06

See also #25318 for an additional improvement.


---

Comment by mmezzarobba created at 2018-05-29 09:09:35

As far as I can tell, the last two patchbot failures are not related to this ticketâ€”i.e. the tests still pass with sage-8.3.beta3.


---

Comment by git created at 2018-06-10 09:16:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by bruno created at 2018-06-18 17:03:06

Looks good to me, except the docstring. Could you add a short description?


---

Comment by git created at 2018-06-19 07:24:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2018-06-19 07:25:00

Replying to [comment:20 bruno]:
> Looks good to me, except the docstring. Could you add a short description?

Done, thanks for your commment!


---

Comment by bruno created at 2018-06-19 07:37:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-21 17:36:02

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-06-21 17:36:02

Reviewer name is missing


---

Comment by mmezzarobba created at 2018-06-21 19:03:46

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-06-23 19:58:36

Resolution: fixed
