# Issue 14444: MPIR fails to configure on Cygwin64

Issue created by migration from Trac.

Original creator: jpflori

Original creation time: 2013-05-26 19:36:39

Assignee: jdemeyer

CC:  kcrisman dimpase leif tscrim

Keywords: mpir spkg cygwin cygwin64

The config.guess and config.sub shipped with MPIR 2.6.0 seem very old (timestamp says 2003) and fail to recognize Cygwin64.
Latest upstream files at:
* http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
* http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD
solves this issue.

MPIR report at:
* https://groups.google.com/d/msg/mpir-devel/kas57nK3UCU/li5-MMsEk_4J

The Sage spkg-install should also be modified not to force ABI=32 on Cygwin.


---

Comment by jpflori created at 2013-05-26 19:45:22

There is a planned update to MPIR spkg at #13948.


---

Comment by jpflori created at 2013-05-26 19:45:48

sqlite spkg (even the latest upstream packaged in 5.10.beta*) fails for the same reason.


---

Comment by jpflori created at 2013-06-09 15:42:25

Same problem when configuring ECL, it fails in the provided gmp subdir (that we don't even use...).


---

Comment by leif created at 2013-06-21 17:11:26

Replying to [comment:4 jpflori]:
> Same problem when configuring ECL, it fails in the provided gmp subdir (that we don't even use...).

I proposed a patch to allow removing the GMP folder a couple of times... 8/


---

Comment by jpflori created at 2013-06-21 17:25:02

I'm changing this ticket to only take care of the outdated fsf config.* scripts.

The further problems with MPIR should go elsewher.


---

Comment by jpflori created at 2013-06-21 17:25:02

Changing keywords from "mpir spkg cygwin cygwin64" to "spkg cygwin cygwin64".


---

Comment by leif created at 2013-06-21 19:53:18

Replying to [comment:5 leif]:
> Replying to [comment:4 jpflori]:
> > Same problem when configuring ECL, it fails in the provided gmp subdir (that we don't even use...).
> 
> I proposed a patch to allow removing the GMP folder a couple of times... 8/

ROFL, three years ago: #9493.

(No idea whether the patch w.r.t. `install-sh` still applies or is at all still necessary.)


---

Comment by tscrim created at 2014-01-05 06:07:34

Given the above, shall we put the new scripts as a patch and start the review?


---

Comment by tscrim created at 2014-01-08 23:15:02

Here's my attempt at a patch.
----
New commits:


---

Comment by git created at 2014-01-08 23:28:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-01-08 23:28:41

Now with the correct thing pushed.


---

Comment by jdemeyer created at 2014-01-09 07:29:36

This patch is very bad. MPIR's `config.guess` is a custom script, it is not the autotools' version. See also the thread you linked to.

For example, it detects my machine as `sandybridge-unknown-linux-gnu`. With this patch, this becomes `x86_64-unknown-linux-gnu`.

Also, `Initial attempt.` is obviously a bad commit message.


---

Comment by jpflori created at 2014-01-09 07:32:18

Hey Travis, I'll up my working (hopefully not only for me) branch a little later today.
In this very ticket I'll only update the FSF scripts.
In another one I'll put the magic needed for MPIR to build the correct ABI.


---

Comment by jpflori created at 2014-01-09 13:00:25

Maybe some other spkgs are missing, I'll add them while buillding Sage.
----
New commits:


---

Comment by git created at 2014-01-09 13:03:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-09 13:44:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-09 13:49:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2014-01-14 16:22:48

IML needs updating.


---

Comment by jdemeyer created at 2014-01-16 15:30:59

Since #15580, you could also consider copying `config.guess` from `$SAGE_ROOT/config/config.guess`.


---

Comment by jpflori created at 2014-01-16 15:32:14

Yes, that's a very good idea!


---

Comment by jdemeyer created at 2014-01-16 15:35:49

Be sure to check which version of Automake you require (`config.guess` belongs to Automake) and edit `configure.ac` accordingly.


---

Comment by jpflori created at 2014-01-16 15:37:41

I guess there is some magic in configure which checks for consistency between configure.ac and config.guess?


---

Comment by jdemeyer created at 2014-01-16 15:42:10

I meant edit `$SAGE_ROOT/configure.ac`, in particular the line

```
AM_INIT_AUTOMAKE([1.9.6 foreign])
```


And no, I don't think autotools cares about the version of `config.guess`, it just requires it to be available.


---

Comment by jpflori created at 2014-01-16 16:43:17

After a quick look through automake versions it would be 1.10.


---

Comment by tscrim created at 2014-01-17 06:11:08

FTR, this currently doesn't work for me on my cygwin32 and ubuntu machines. I believe it's the same issue as comment:14:

```
checking build system type... Invalid configuration `k8-pc-linux-gnu': machine `k8-pc' not recognized
configure: error: /bin/bash ./config.sub k8-pc-linux-gnu failed
Error configuring MPIR (with CFLAGS unset).
```



---

Comment by jpflori created at 2014-01-17 07:46:37

Replying to [comment:28 tscrim]:
> FTR, this currently doesn't work for me on my cygwin32 and ubuntu machines. I believe it's the same issue as comment:14:
> {{{
> checking build system type... Invalid configuration `k8-pc-linux-gnu': machine `k8-pc' not recognized
> configure: error: /bin/bash ./config.sub k8-pc-linux-gnu failed
> Error configuring MPIR (with CFLAGS unset).
> }}}
I assume the previous version of the pkg does work?


---

Comment by jpflori created at 2014-01-17 07:48:07

(And you are using my branch and not yours?)


---

Comment by tscrim created at 2014-01-17 16:13:04

Yes (and yes).


---

Comment by git created at 2014-01-18 23:11:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2014-01-18 23:16:25

Changing status from new to needs_review.


---

Comment by jpflori created at 2014-01-18 23:43:00

For the k8 issue, did any previous version work?


---

Comment by jpflori created at 2014-01-18 23:58:45

Ok, I guess the problem is with https://github.com/wbhart/mpir/commit/3b410a80565eb71fd32a86630d550098ebc85f82

In fact, the MPIR wrapper should be modified to map k8 and so on to something else.


---

Comment by jpflori created at 2014-01-18 23:59:02

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2014-04-08 13:11:31

Latest sqlite is wroking on Cygwin64 (or rather "at least it builds now").
See #16098.


---

Comment by jpflori created at 2014-04-13 19:51:46

Latest MPIR at #15015 will work as well.


---

Comment by jpflori created at 2014-04-13 19:52:17

ECL fixed at #9493.

So only dealing with IML here.


---

Comment by git created at 2014-04-13 19:53:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jpflori created at 2014-04-13 19:55:25

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2014-04-14 09:10:39

Thats a kind of vile hack to use some of the Sage autoconf output. Did you contact IML upstream?


---

Comment by jpflori created at 2014-04-14 09:15:50

Note that this vile hack just use standard files distributed by autoconf, not some files specifically crafted (well, the exact version is) by configure when it's run.

Not contacted IML though, I though the project was dead.
If not we should really work more with them to deal with the BLAS/linking hell in their build system.


---

Comment by vbraun created at 2014-04-14 09:22:30

Well we could give it a try. If there is no response then we should just make our own tarball with updated autoconf. Its not exactly a moving target ;-)  

I agree that the hack works, but its ugly and fragile if we change anything in the sage autoconf files (e.g. move to a different directory).


---

Comment by jpflori created at 2014-04-14 09:24:38

Replying to [comment:45 vbraun]:
> Well we could give it a try. If there is no response then we should just make our own tarball with updated autoconf. Its not exactly a moving target ;-)  
I'll drop them an email (without specific patches first, just getting the temperature there).
> 
> I agree that the hack works, but its ugly and fragile if we change anything in the sage autoconf files (e.g. move to a different directory). 
Sure, I realize I should at least check the return code for such cases.


---

Comment by jpflori created at 2014-04-14 09:30:39

Sent an email upstream.


---

Comment by leif created at 2014-04-14 09:46:24

Replying to [comment:47 jpflori]:
> Sent an email upstream.

`/dev/null`?


---

Comment by jpflori created at 2014-04-14 09:48:35

Maybe...
At least the mail address given here: https://cs.uwaterloo.ca/~astorjoh/iml.html#bug
Don't know where the authors are working now.


---

Comment by git created at 2014-04-14 09:50:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2014-04-16 16:29:47

Replying to [comment:49 jpflori]:
> Maybe...
> At least the mail address given here: https://cs.uwaterloo.ca/~astorjoh/iml.html#bug
> Don't know where the authors are working now.
Got a reply and Arne would be very happy to make a new release.
Now it's time to think about what we should push upstream with regard to the build system (it may be a good time to provide support for different BLAS implem than ATLAS), bug fixes and so on.


---

Comment by leif created at 2014-04-16 16:37:33

Replying to [comment:51 jpflori]:
> Replying to [comment:49 jpflori]:
> > Maybe...
> > At least the mail address given here: https://cs.uwaterloo.ca/~astorjoh/iml.html#bug
> > Don't know where the authors are working now.
> Got a reply and Arne would be very happy to make a new release.

\o/ (after years of apparent death)

> Now it's time to think about what we should push upstream with regard to the build system (it may be a good time to provide support for different BLAS implem than ATLAS), bug fixes and so on.

Best post to sage-devel, such that the usual suspectives will notice, and/or cc some of those involved in the previous IML tickets (#748 (!), #9568 ...).


---

Comment by vbraun created at 2014-04-16 17:13:34

Replying to [comment:52 leif]:
> the previous IML tickets (#748

%-)


---

Comment by fbissey created at 2014-04-16 21:45:01

Thanks for the head up on IML :) the laundry list as far as I remember is
 * getting configure to accept other cblas. Cannot use gentoo patches as they rely on cblas installing .pc files which is not standard across implementation.
 * remove the "repl" subfolder which doesn't do anything and create problems on OS X [https://raw.githubusercontent.com/cschwan/sage-on-gentoo/master/sci-libs/iml/files/iml-1.0.3-repl_removal.patch](https://raw.githubusercontent.com/cschwan/sage-on-gentoo/master/sci-libs/iml/files/iml-1.0.3-repl_removal.patch)
 * fix undefined symbols in nullspace.c [https://raw.githubusercontent.com/cschwan/sage-on-gentoo/master/sci-libs/iml/files/iml-1.0.3-fix-undefined-symbol.patch](https://raw.githubusercontent.com/cschwan/sage-on-gentoo/master/sci-libs/iml/files/iml-1.0.3-fix-undefined-symbol.patch)
 * I have an extra fix in the s-o-g tree for automake 1.13 that probably should go in [https://raw.githubusercontent.com/cschwan/sage-on-gentoo/master/sci-libs/iml/files/iml-1.0.3-automake-1.13.patch](https://raw.githubusercontent.com/cschwan/sage-on-gentoo/master/sci-libs/iml/files/iml-1.0.3-automake-1.13.patch)


---

Comment by jpflori created at 2014-07-22 20:26:58

Better late than never, I've forwaded our patches (except the emamples one, what is that for? quicker test?) and two new ones for inclusion in a potential new release of IML (one for shared libs on Cygwin (who cares? :)) and on to add a --with-cblas configure flag to pass the ld flags for linking to cblas, falling back to the old atlas detection code in case of failure).

Best,
JP


---

Comment by jpflori created at 2014-11-25 14:38:23

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2014-11-25 14:38:23

All packages are now recent enough except for MPIR which will get updated in #15015.


---

Comment by vbraun created at 2014-11-28 18:39:36

Resolution: duplicate
