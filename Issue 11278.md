# Issue 11278: Updates to BooleanFunction class

archive/issues_011278.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  jpflori @rusydi @pfasante\n\nKeywords: boolean function, cryptography, walsh hadamard transform\n\nI've commited several changes to the BooleanFunction class:\n\n1. The walsh hadamard transform compute the transform of the opposite, I corrected it\n\n2. A lot of computation were made using ints, I change most of them to longs, also adding a warning when computations will overflow. I changed the code to compute the hamming weight to deal with 64 bits integers.\n\n3. I typed some variables and now store the result of walsh hdamard transform and autocorrelation in c arrays for faster computations, because of that I deleted the _compute_walsh_hadamard_cached method. Of course everything still gets resetted when one modifies the boolean function.\n\n4. I added sig_on/sig_off around some c loops.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11450\n\n",
    "created_at": "2011-06-08T15:41:43Z",
    "labels": [
        "component: cryptography"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Updates to BooleanFunction class",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11278",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
Assignee: mvngu

CC:  jpflori @rusydi @pfasante

Keywords: boolean function, cryptography, walsh hadamard transform

I've commited several changes to the BooleanFunction class:

1. The walsh hadamard transform compute the transform of the opposite, I corrected it

2. A lot of computation were made using ints, I change most of them to longs, also adding a warning when computations will overflow. I changed the code to compute the hamming weight to deal with 64 bits integers.

3. I typed some variables and now store the result of walsh hdamard transform and autocorrelation in c arrays for faster computations, because of that I deleted the _compute_walsh_hadamard_cached method. Of course everything still gets resetted when one modifies the boolean function.

4. I added sig_on/sig_off around some c loops.

Issue created by migration from https://trac.sagemath.org/ticket/11450





---

archive/issue_comments_124071.json:
```json
{
    "body": "Attachment [trac_11450-bf_long.patch](tarball://root/attachments/some-uuid/ticket11450/trac_11450-bf_long.patch) by jpflori created at 2011-06-08 15:43:11\n\nFixes and optimizations.",
    "created_at": "2011-06-08T15:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124071",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [trac_11450-bf_long.patch](tarball://root/attachments/some-uuid/ticket11450/trac_11450-bf_long.patch) by jpflori created at 2011-06-08 15:43:11

Fixes and optimizations.



---

archive/issue_comments_124072.json:
```json
{
    "body": "I must acknowledge that this patch could be considered temporary, but IMHO gives better results on modern computers currently.\n\nA more complete solution should involve (transparently) different implementations according to the lenth of integers involved as is done e.g.for integer_mod, i.e. use fixed length integer or gmp/mpir according to the the length of integers involved.",
    "created_at": "2011-06-14T21:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124072",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I must acknowledge that this patch could be considered temporary, but IMHO gives better results on modern computers currently.

A more complete solution should involve (transparently) different implementations according to the lenth of integers involved as is done e.g.for integer_mod, i.e. use fixed length integer or gmp/mpir according to the the length of integers involved.



---

archive/issue_comments_124073.json:
```json
{
    "body": "This surely needs more work, especially on 32 bits.",
    "created_at": "2013-06-11T22:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124073",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

This surely needs more work, especially on 32 bits.



---

archive/issue_comments_124074.json:
```json
{
    "body": "Some parts of this old patch could be integrated.\nEspecially fixing the sign of the walsh-hadamard transform.\nThe rest is more discussable.",
    "created_at": "2017-05-17T12:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124074",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Some parts of this old patch could be integrated.
Especially fixing the sign of the walsh-hadamard transform.
The rest is more discussable.



---

archive/issue_comments_124075.json:
```json
{
    "body": "Maybe this should also be split up in several commits -- at the moment it looks a bit like a patchbomb.\n\nI looked at the attached patch and at least in the comments it says the Walsh(-Hadamard)-Transform of f is `f(\\alpha) = \\sum_{x \\in \\GF(2)^n} f(x) \\cdot {-1}^{\\langle \\alpha, x \\rangle`} (line 61 vs 70) - in the literature this seems to not be used consistently. In Claude Carlets chapters on boolean functions from \"Boolean Models and Methods in Mathematics, Computer Science, and Engineering\" this definition is for the Fourier-Transform where the Walsh-Transform is the Fourier-Transform of the sign function of f (what equals the old line). I think the code also computes the Walsh-Transform, but I'll check this again.",
    "created_at": "2017-05-17T13:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124075",
    "user": "https://github.com/pfasante"
}
```

Maybe this should also be split up in several commits -- at the moment it looks a bit like a patchbomb.

I looked at the attached patch and at least in the comments it says the Walsh(-Hadamard)-Transform of f is `f(\alpha) = \sum_{x \in \GF(2)^n} f(x) \cdot {-1}^{\langle \alpha, x \rangle`} (line 61 vs 70) - in the literature this seems to not be used consistently. In Claude Carlets chapters on boolean functions from "Boolean Models and Methods in Mathematics, Computer Science, and Engineering" this definition is for the Fourier-Transform where the Walsh-Transform is the Fourier-Transform of the sign function of f (what equals the old line). I think the code also computes the Walsh-Transform, but I'll check this again.



---

archive/issue_comments_124076.json:
```json
{
    "body": "Sure the patch cannot be used as is.",
    "created_at": "2017-05-17T13:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124076",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Sure the patch cannot be used as is.



---

archive/issue_comments_124077.json:
```json
{
    "body": "As far as the WH is concerned, I'd say it's the fourier transform of the \"sign\" function.\nAs stated in the doc it is\n\n```\nsum_{i\\in\\{0,1\\}^n} (-1)^{f(i)\\oplus i \\cdot j}\n```\n\n(apart from a bizarre wrong change in the patch.)\n\nBut the code uses for the sign function:\n\n```\n(bitset_in(self._truth_table,i)<<1)-1\n```\n\nthat is\n\n```\n2*f(i)-1 = -(-1)^f(i)\n```\n\n\nFor crypto applications it changes nothing and it also could be valid mathematically, but still this additional minus is not so natural.",
    "created_at": "2017-05-17T13:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124077",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

As far as the WH is concerned, I'd say it's the fourier transform of the "sign" function.
As stated in the doc it is

```
sum_{i\in\{0,1\}^n} (-1)^{f(i)\oplus i \cdot j}
```

(apart from a bizarre wrong change in the patch.)

But the code uses for the sign function:

```
(bitset_in(self._truth_table,i)<<1)-1
```

that is

```
2*f(i)-1 = -(-1)^f(i)
```


For crypto applications it changes nothing and it also could be valid mathematically, but still this additional minus is not so natural.



---

archive/issue_comments_124078.json:
```json
{
    "body": "A ticket of 6-years ago :-o\n\n+1 for fixing the sign in Walsh-Hadamard transform. And as far as I know, in the context of Boolean function for cryptography, the Walsh-Hadamard transform is a Fourier transform of the sign function.\n\nThe fix for the sign must also be applied in the implementation of linear approximation matrix of SBox (see https://github.com/sagemath/sage/blob/master/src/sage/crypto/mq/sbox.py#L483). Its just a matter of removing the \"negative\" sign when calling A.transpose() in line 535.\n\nI suggest this ticket can be changed into a meta-ticket. Then create separate sub-tickets for each issue addressed in the description.",
    "created_at": "2017-05-17T14:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124078",
    "user": "https://github.com/rusydi"
}
```

A ticket of 6-years ago :-o

+1 for fixing the sign in Walsh-Hadamard transform. And as far as I know, in the context of Boolean function for cryptography, the Walsh-Hadamard transform is a Fourier transform of the sign function.

The fix for the sign must also be applied in the implementation of linear approximation matrix of SBox (see https://github.com/sagemath/sage/blob/master/src/sage/crypto/mq/sbox.py#L483). Its just a matter of removing the "negative" sign when calling A.transpose() in line 535.

I suggest this ticket can be changed into a meta-ticket. Then create separate sub-tickets for each issue addressed in the description.



---

archive/issue_comments_124079.json:
```json
{
    "body": "We can also just close this ticket as wontfix.\n\nI just wanted to draw your attention on the changes I proposed here a long time ago as you seem to be interested in this topic.",
    "created_at": "2017-05-17T14:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124079",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

We can also just close this ticket as wontfix.

I just wanted to draw your attention on the changes I proposed here a long time ago as you seem to be interested in this topic.



---

archive/issue_comments_124080.json:
```json
{
    "body": "Replying to [comment:12 jpflori]:\n> We can also just close this ticket as wontfix.\n> \n\nYes, thats also possible.\n\n> I just wanted to draw your attention on the changes I proposed here a long time ago as you seem to be interested in this topic.\n\nYes, I am :-) and I do think these changes are important. I never notice this ticket before. Now I know why.\n\nRegards,\nRusydi",
    "created_at": "2017-05-17T14:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124080",
    "user": "https://github.com/rusydi"
}
```

Replying to [comment:12 jpflori]:
> We can also just close this ticket as wontfix.
> 

Yes, thats also possible.

> I just wanted to draw your attention on the changes I proposed here a long time ago as you seem to be interested in this topic.

Yes, I am :-) and I do think these changes are important. I never notice this ticket before. Now I know why.

Regards,
Rusydi



---

archive/issue_comments_124081.json:
```json
{
    "body": "Changing keywords from \"boolean function, cryptography, walsh hadamard transform\" to \"boolean function, cryptography, walsh hadamard transform, days94\".",
    "created_at": "2018-07-02T14:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124081",
    "user": "https://github.com/pfasante"
}
```

Changing keywords from "boolean function, cryptography, walsh hadamard transform" to "boolean function, cryptography, walsh hadamard transform, days94".



---

archive/issue_comments_124082.json:
```json
{
    "body": "OK, so in order to make this a meta ticket, I guess we should split it in some new tickets and put them as dependencies for this ticket?\n\nWe have the following things in this ticket:\n\n1. The walsh hadamard transform compute the transform of the opposite, I corrected it \n    this is already fixed\n\n2. A lot of computation were made using ints, I change most of them to longs, also adding a warning when computations will overflow. I changed the code to compute the hamming weight to deal with 64 bits integers. \n    change to 64-bit integers - ticket: #25742\n\n3. I typed some variables and now store the result of walsh hdamard transform and autocorrelation in c arrays for faster computations, because of that I deleted the _compute_walsh_hadamard_cached method. Of course everything still gets resetted when one modifies the boolean function.\n    type variables in cython code - ticket: #25740\n\n4. I added sig_on/sig_off around some c loops. \n    sig_check in c loops - ticket: #25739",
    "created_at": "2018-07-02T14:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124082",
    "user": "https://github.com/pfasante"
}
```

OK, so in order to make this a meta ticket, I guess we should split it in some new tickets and put them as dependencies for this ticket?

We have the following things in this ticket:

1. The walsh hadamard transform compute the transform of the opposite, I corrected it 
    this is already fixed

2. A lot of computation were made using ints, I change most of them to longs, also adding a warning when computations will overflow. I changed the code to compute the hamming weight to deal with 64 bits integers. 
    change to 64-bit integers - ticket: #25742

3. I typed some variables and now store the result of walsh hdamard transform and autocorrelation in c arrays for faster computations, because of that I deleted the _compute_walsh_hadamard_cached method. Of course everything still gets resetted when one modifies the boolean function.
    type variables in cython code - ticket: #25740

4. I added sig_on/sig_off around some c loops. 
    sig_check in c loops - ticket: #25739



---

archive/issue_comments_124083.json:
```json
{
    "body": "Changing assignee from mvngu to @pfasante.",
    "created_at": "2018-07-02T14:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11278#issuecomment-124083",
    "user": "https://github.com/pfasante"
}
```

Changing assignee from mvngu to @pfasante.
