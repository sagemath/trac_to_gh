# Issue 14005: Interface to maxima / ecl broken

archive/issues_014005.json:
```json
{
    "body": "Assignee: tbd\n\nKeywords: maxima ecl\n\nFrom: https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/jIjYSSCPrrY\n\nInitial symptom:\nsage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)           \n2*log(2)\nsage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n\nA closer look:\nsage: from sage.interfaces.maxima_lib import sr_to_max\nsage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))\n<ECL: ((MTIMES) ((%LOG) 2) 2)>\nsage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\nIssue created by migration from https://trac.sagemath.org/ticket/14209\n\n",
    "created_at": "2013-03-01T14:13:50Z",
    "labels": [
        "component: please change",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Interface to maxima / ecl broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14005",
    "user": "https://github.com/pipedream"
}
```
Assignee: tbd

Keywords: maxima ecl

From: https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/jIjYSSCPrrY

Initial symptom:
sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)           
2*log(2)
sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)


A closer look:
sage: from sage.interfaces.maxima_lib import sr_to_max
sage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))
<ECL: ((MTIMES) ((%LOG) 2) 2)>
sage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

Issue created by migration from https://trac.sagemath.org/ticket/14209





---

archive/issue_comments_174599.json:
```json
{
    "body": "Replying to [ticket:14209 pipedream]:\n> From: https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/jIjYSSCPrrY\n> \n> Initial symptom:\n> sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)           \n> 2*log(2)\n> sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)\n> ---------------------------------------------------------------------------\n> ValueError                                Traceback (most recent call last)\n> \n> \n> A closer look:\n> sage: from sage.interfaces.maxima_lib import sr_to_max\n> sage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))\n> <ECL: ((MTIMES) ((%LOG) 2) 2)>\n> sage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))\n> ---------------------------------------------------------------------------\n> ValueError                                Traceback (most recent call last)\n>",
    "created_at": "2013-03-01T14:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174599",
    "user": "https://github.com/pipedream"
}
```

Replying to [ticket:14209 pipedream]:
> From: https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/jIjYSSCPrrY
> 
> Initial symptom:
> sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)           
> 2*log(2)
> sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)
> ---------------------------------------------------------------------------
> ValueError                                Traceback (most recent call last)
> 
> 
> A closer look:
> sage: from sage.interfaces.maxima_lib import sr_to_max
> sage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))
> <ECL: ((MTIMES) ((%LOG) 2) 2)>
> sage: sr_to_max(integral(e^(-abs(x))/cosh(x),x,-infinity,infinity))
> ---------------------------------------------------------------------------
> ValueError                                Traceback (most recent call last)
>



---

archive/issue_comments_174600.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to calculus.",
    "created_at": "2013-03-01T16:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174600",
    "user": "https://github.com/kcrisman"
}
```

Changing component from PLEASE CHANGE to calculus.



---

archive/issue_comments_174601.json:
```json
{
    "body": "Changing assignee from tbd to @burcin.",
    "created_at": "2013-03-01T16:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174601",
    "user": "https://github.com/kcrisman"
}
```

Changing assignee from tbd to @burcin.



---

archive/issue_comments_174602.json:
```json
{
    "body": "Just a couple of notes:\n- we patch maxima to throw an error rather than print \"Principal Value\".\n- internally, maxima has a flag that gets set if Principal Value has already been printed, to prevent it from being printed repeatedly.\n- this flag also gets used to suppress the \"Principal Value\" warning in certain cases where their integration code apparently knows it's safe to take a principal value.\n- so we don't throw an error if maxima wouldn't print the warning.\n\nIt would seem something about this setting gets messed up. My guess it's the way maxima deals internally with the doubly infinite integral:\n\n```\nsage: integrate(exp(-abs(x))/cosh(x),x,-oo,0)\nlog(2)\nsage: integrate(exp(-abs(x))/cosh(x),x,0,oo)\nlog(2)\nsage: integrate(exp(-abs(x))/cosh(x),x,-oo,0)\nlog(2)\nsage: integrate(exp(-abs(x))/cosh(x),x,0,oo)\nlog(2)\nsage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)\n2*log(2)\nsage: integrate(exp(-abs(x))/cosh(x),x,0,oo)\nlog(2)\nsage: integrate(exp(-abs(x))/cosh(x),x,-oo,0)\nValueError: Integral is divergent.\nsage: integrate(exp(-abs(x))/cosh(x),x,0,oo)\nlog(2)\n```\n\nAt this point it can hardly be anything in the way we translate things for maxima. It's got to be in the internals in maxima. They may have changed something internally in maxima that doesn't jive well with our patch (see `maxima_lib.py`):\n\n```\necl_eval('(defun principal nil (cond ($noprincipal (diverg)) ((not pcprntd) (merror \"Divergent Integral\"))))')\n```\n\nFor instance, in sage 4.7.1, which uses maxima 5.23.2, this problem does not arise. \n\nIn fact, when you look at the message that is returned, it's:\n\n```\nECL says: Error executing code in Maxima: defint: integral is divergent.\n```\n\nwhich is the error message that gets generated by `diverg`. So it seems the second time around, this code is executed with `$noprincipal` set.\n\nBEWARE: both `noprincipal` and `pcprntd` are \"special\" variables, which means they are dynamically scoped. That's different from what you're probably used to.\n\nFurthermore, the definition of `diverg` is:\n\n```\n(defun diverg nil\n  (cond (*nodiverg (throw 'divergent 'divergent))\n\t(t (merror (intl:gettext \"defint: integral is divergent.\")))))\n```\n\nwhich shows the behaviour can be influenced by yet another special variable, `*nodiverg`. In `defint.lisp` this really gets used: they sometimes prefer a condition thrown that they catch rather than generate an `merror`. If you compare the `defint.lisp` between 5.26.0 and 5.29.1 (sage 5.0 uses the former and does not have this problem. sage 5.7 uses the latter), you'll find some changes that look like they might change behaviour around such constructs, but I wasn't able to detect a smoking gun. And of course the problem may lie in a different file and/or a bug in how the new ECL handles dynamic variables (which is unlikely and would be disconcerting, because they form a basic component of CL)",
    "created_at": "2013-03-01T18:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174602",
    "user": "https://github.com/nbruin"
}
```

Just a couple of notes:
- we patch maxima to throw an error rather than print "Principal Value".
- internally, maxima has a flag that gets set if Principal Value has already been printed, to prevent it from being printed repeatedly.
- this flag also gets used to suppress the "Principal Value" warning in certain cases where their integration code apparently knows it's safe to take a principal value.
- so we don't throw an error if maxima wouldn't print the warning.

It would seem something about this setting gets messed up. My guess it's the way maxima deals internally with the doubly infinite integral:

```
sage: integrate(exp(-abs(x))/cosh(x),x,-oo,0)
log(2)
sage: integrate(exp(-abs(x))/cosh(x),x,0,oo)
log(2)
sage: integrate(exp(-abs(x))/cosh(x),x,-oo,0)
log(2)
sage: integrate(exp(-abs(x))/cosh(x),x,0,oo)
log(2)
sage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)
2*log(2)
sage: integrate(exp(-abs(x))/cosh(x),x,0,oo)
log(2)
sage: integrate(exp(-abs(x))/cosh(x),x,-oo,0)
ValueError: Integral is divergent.
sage: integrate(exp(-abs(x))/cosh(x),x,0,oo)
log(2)
```

At this point it can hardly be anything in the way we translate things for maxima. It's got to be in the internals in maxima. They may have changed something internally in maxima that doesn't jive well with our patch (see `maxima_lib.py`):

```
ecl_eval('(defun principal nil (cond ($noprincipal (diverg)) ((not pcprntd) (merror "Divergent Integral"))))')
```

For instance, in sage 4.7.1, which uses maxima 5.23.2, this problem does not arise. 

In fact, when you look at the message that is returned, it's:

```
ECL says: Error executing code in Maxima: defint: integral is divergent.
```

which is the error message that gets generated by `diverg`. So it seems the second time around, this code is executed with `$noprincipal` set.

BEWARE: both `noprincipal` and `pcprntd` are "special" variables, which means they are dynamically scoped. That's different from what you're probably used to.

Furthermore, the definition of `diverg` is:

```
(defun diverg nil
  (cond (*nodiverg (throw 'divergent 'divergent))
	(t (merror (intl:gettext "defint: integral is divergent.")))))
```

which shows the behaviour can be influenced by yet another special variable, `*nodiverg`. In `defint.lisp` this really gets used: they sometimes prefer a condition thrown that they catch rather than generate an `merror`. If you compare the `defint.lisp` between 5.26.0 and 5.29.1 (sage 5.0 uses the former and does not have this problem. sage 5.7 uses the latter), you'll find some changes that look like they might change behaviour around such constructs, but I wasn't able to detect a smoking gun. And of course the problem may lie in a different file and/or a bug in how the new ECL handles dynamic variables (which is unlikely and would be disconcerting, because they form a basic component of CL)



---

archive/issue_comments_174603.json:
```json
{
    "body": "I don't think it has anything to do with `principal` or with `diverg`. I think there is an assumption on `x` that sticks around so that `abs(x)` gets simplified to `x`. Of course, `integrate(exp(-abs(x))/cosh(x),x,-oo,oo)` really is divergent. Evidence:\n\n```\nsage: maxima_calculus.eval(\"facts()\")\n'[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing)]'\nsage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)\n2*log(2)\nsage: maxima_calculus.eval(\"facts()\")\n'[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing),x>0]'\n```\n\nIndeed, if we subsequently do\n\n```\nsage: maxima_calculus.eval(\"forget(x>0)\")\n'[x>0]'\nsage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)\n2*log(2)\n```\n\nwe see the damage is undone (and redone with the second line of course).\n\nThe fact that we have a problem here and maxima itself doesn't seem to have a problem suggests that we are handling contexts differently from what maxima is doing. See maxima's documentation.\n\nmaxima's `defint.lisp` contains plenty of `assume` commands, but very little seems to have changed in how they're used. I don't know where the change comes from.",
    "created_at": "2013-03-02T03:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174603",
    "user": "https://github.com/nbruin"
}
```

I don't think it has anything to do with `principal` or with `diverg`. I think there is an assumption on `x` that sticks around so that `abs(x)` gets simplified to `x`. Of course, `integrate(exp(-abs(x))/cosh(x),x,-oo,oo)` really is divergent. Evidence:

```
sage: maxima_calculus.eval("facts()")
'[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing)]'
sage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)
2*log(2)
sage: maxima_calculus.eval("facts()")
'[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing),x>0]'
```

Indeed, if we subsequently do

```
sage: maxima_calculus.eval("forget(x>0)")
'[x>0]'
sage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)
2*log(2)
```

we see the damage is undone (and redone with the second line of course).

The fact that we have a problem here and maxima itself doesn't seem to have a problem suggests that we are handling contexts differently from what maxima is doing. See maxima's documentation.

maxima's `defint.lisp` contains plenty of `assume` commands, but very little seems to have changed in how they're used. I don't know where the change comes from.



---

archive/issue_comments_174604.json:
```json
{
    "body": "> {{{\n> sage: maxima_calculus.eval(\"facts()\")\n> '[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing)]'\n> sage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)\n> 2*log(2)\n> sage: maxima_calculus.eval(\"facts()\")\n> '[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing),x>0]'\n> }}}\nYeah, that sounds like a bug or something.  Huh.",
    "created_at": "2013-03-02T04:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174604",
    "user": "https://github.com/kcrisman"
}
```

> {{{
> sage: maxima_calculus.eval("facts()")
> '[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing)]'
> sage: integrate(exp(-abs(x))/cosh(x),x,-oo,oo)
> 2*log(2)
> sage: maxima_calculus.eval("facts()")
> '[kind(sinh,one_to_one),kind(log,one_to_one),kind(tanh,one_to_one),kind(log,increasing),x>0]'
> }}}
Yeah, that sounds like a bug or something.  Huh.



---

archive/issue_comments_174605.json:
```json
{
    "body": "Cool. It's not our fault. It's an error in `abs_integrate.mac`, which we load:\n\n```\nMaxima 5.29.1 http://maxima.sourceforge.net\nusing Lisp ECL 12.12.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) load(abs_integrate);\ndefint(exp(-abs(x))/cosh(x),x,minf,inf);\ndefint(exp(-abs(x))/cosh(x),x,minf,inf);\n(%o1) /usr/local/sage/5.7/local/share/maxima/5.29.1/share/contrib/integration/\\\nabs_integrate.mac\n(%i2) (%o2)                              2 log(2)\n(%i3) \ndefint: integral is divergent.\n -- an error. To debug this try: debugmode(true);\n```\n\nThis is now [maxima #2557](https://sourceforge.net/p/maxima/bugs/2557/).",
    "created_at": "2013-03-02T05:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174605",
    "user": "https://github.com/nbruin"
}
```

Cool. It's not our fault. It's an error in `abs_integrate.mac`, which we load:

```
Maxima 5.29.1 http://maxima.sourceforge.net
using Lisp ECL 12.12.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) load(abs_integrate);
defint(exp(-abs(x))/cosh(x),x,minf,inf);
defint(exp(-abs(x))/cosh(x),x,minf,inf);
(%o1) /usr/local/sage/5.7/local/share/maxima/5.29.1/share/contrib/integration/\
abs_integrate.mac
(%i2) (%o2)                              2 log(2)
(%i3) 
defint: integral is divergent.
 -- an error. To debug this try: debugmode(true);
```

This is now [maxima #2557](https://sourceforge.net/p/maxima/bugs/2557/).



---

archive/issue_comments_174606.json:
```json
{
    "body": "There has been a fair amount of activity on this, see the [thread starting here](http://www.math.utexas.edu/pipermail/maxima/2013/032109.html) on the Maxima list.",
    "created_at": "2013-03-15T18:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174606",
    "user": "https://github.com/kcrisman"
}
```

There has been a fair amount of activity on this, see the [thread starting here](http://www.math.utexas.edu/pipermail/maxima/2013/032109.html) on the Maxima list.



---

archive/issue_comments_174607.json:
```json
{
    "body": "Maxima bug #2557 [1] fixed by commit 4b8a98648d4 [2]. Thanks for the bug report.\n\n[1] https://sourceforge.net/p/maxima/bugs/2557/\n[2] https://sourceforge.net/p/maxima/code/ci/4b8a98648d4da26805ea3238eee216611245e14a/",
    "created_at": "2013-03-23T04:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174607",
    "user": "https://trac.sagemath.org/admin/accounts/users/robert_dodier"
}
```

Maxima bug #2557 [1] fixed by commit 4b8a98648d4 [2]. Thanks for the bug report.

[1] https://sourceforge.net/p/maxima/bugs/2557/
[2] https://sourceforge.net/p/maxima/code/ci/4b8a98648d4da26805ea3238eee216611245e14a/



---

archive/issue_comments_174608.json:
```json
{
    "body": "This will be in the upcoming 5.30.  Needs patch to verify at that time.",
    "created_at": "2013-03-23T12:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174608",
    "user": "https://github.com/kcrisman"
}
```

This will be in the upcoming 5.30.  Needs patch to verify at that time.



---

archive/issue_comments_174609.json:
```json
{
    "body": "This is indeed fixed upstream and after #13973 we get\n\n```\nsage: sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)           \n2*log(2)\nsage: sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)\n2*log(2)\n```\n",
    "created_at": "2014-05-17T14:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174609",
    "user": "https://github.com/pjbruin"
}
```

This is indeed fixed upstream and after #13973 we get

```
sage: sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)           
2*log(2)
sage: sage: integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)
2*log(2)
```




---

archive/issue_comments_174610.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-30T13:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174610",
    "user": "https://github.com/kcrisman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_174611.json:
```json
{
    "body": "Again, my apologies for all the dependencies, not knowing how to do this so it doesn't depend on previous stuff - I'm still in the hg queue mode.\n----\nLast 10 new commits:",
    "created_at": "2014-05-30T13:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174611",
    "user": "https://github.com/kcrisman"
}
```

Again, my apologies for all the dependencies, not knowing how to do this so it doesn't depend on previous stuff - I'm still in the hg queue mode.
----
Last 10 new commits:



---

archive/issue_comments_174612.json:
```json
{
    "body": "Just commit 54d0609 matters.",
    "created_at": "2014-05-30T13:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174612",
    "user": "https://github.com/kcrisman"
}
```

Just commit 54d0609 matters.



---

archive/issue_comments_174613.json:
```json
{
    "body": "LGTM (as well `:p`)",
    "created_at": "2014-05-30T13:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174613",
    "user": "https://github.com/tscrim"
}
```

LGTM (as well `:p`)



---

archive/issue_comments_174614.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-30T13:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174614",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_174615.json:
```json
{
    "body": "Doctests fail on my system:\n\n```\nsage -t --long src/sage/symbolic/integration/integral.py\n**********************************************************************\nFile \"src/sage/symbolic/integration/integral.py\", line 684, in sage.symbolic.int\negration.integral.integrate\nFailed example:\n    integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)\nException raised:\n    Traceback (most recent call last):\n    ...\n    ValueError: Integral is divergent.\n**********************************************************************\nFile \"src/sage/symbolic/integration/integral.py\", line 686, in sage.symbolic.int\negration.integral.integrate\nFailed example:\n    integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)\nException raised:\n    Traceback (most recent call last):\n    ...\n    ValueError: Integral is divergent.\n**********************************************************************\n```\n\nThere is no error when running the example directly from the Sage prompt.  Maybe a bad assumption made elsewhere in `integral.py` is creeping in?  [Edit: it seems to be caused by \"assume(x>0)\" a few lines above.]",
    "created_at": "2014-05-30T14:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174615",
    "user": "https://github.com/pjbruin"
}
```

Doctests fail on my system:

```
sage -t --long src/sage/symbolic/integration/integral.py
**********************************************************************
File "src/sage/symbolic/integration/integral.py", line 684, in sage.symbolic.int
egration.integral.integrate
Failed example:
    integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)
Exception raised:
    Traceback (most recent call last):
    ...
    ValueError: Integral is divergent.
**********************************************************************
File "src/sage/symbolic/integration/integral.py", line 686, in sage.symbolic.int
egration.integral.integrate
Failed example:
    integral(e^(-abs(x))/cosh(x),x,-infinity,infinity)
Exception raised:
    Traceback (most recent call last):
    ...
    ValueError: Integral is divergent.
**********************************************************************
```

There is no error when running the example directly from the Sage prompt.  Maybe a bad assumption made elsewhere in `integral.py` is creeping in?  [Edit: it seems to be caused by "assume(x>0)" a few lines above.]



---

archive/issue_comments_174616.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-05-30T14:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174616",
    "user": "https://github.com/pjbruin"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_174617.json:
```json
{
    "body": "Integrating over *x* in **R** after assuming *x* > 0 is problematic in Maxima:\n\n```\n$ sage --maxima\n...\n(%i1) load(abs_integrate)$\n\n(%i2) defint(exp(-abs(x))/cosh(x),x,minf,inf);\n(%o2)                              2 log(2)\n(%i3) assume(x>0);\n(%o3)                               [x > 0]\n(%i4) defint(exp(-abs(x))/cosh(x),x,minf,inf);\n\ndefint: integral is divergent.\n -- an error. To debug this try: debugmode(true);\n```\n\nThe easiest solution is to put `forget(x > 0)` at the end of the doctest with `assume(x > 0)`.",
    "created_at": "2014-05-30T14:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174617",
    "user": "https://github.com/pjbruin"
}
```

Integrating over *x* in **R** after assuming *x* > 0 is problematic in Maxima:

```
$ sage --maxima
...
(%i1) load(abs_integrate)$

(%i2) defint(exp(-abs(x))/cosh(x),x,minf,inf);
(%o2)                              2 log(2)
(%i3) assume(x>0);
(%o3)                               [x > 0]
(%i4) defint(exp(-abs(x))/cosh(x),x,minf,inf);

defint: integral is divergent.
 -- an error. To debug this try: debugmode(true);
```

The easiest solution is to put `forget(x > 0)` at the end of the doctest with `assume(x > 0)`.



---

archive/issue_comments_174618.json:
```json
{
    "body": "> The easiest solution is to put `forget(x > 0)` at the end of the doctest with `assume(x > 0)`.\nSorry, I didn't run tests because it worked in my local Sage, as you say.  Certainly if we assumed this above we should forget it - preferably immediately after the assumption - that is the usual practice here.\n\nAnyway, I'll update this momentarily.",
    "created_at": "2014-05-30T16:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174618",
    "user": "https://github.com/kcrisman"
}
```

> The easiest solution is to put `forget(x > 0)` at the end of the doctest with `assume(x > 0)`.
Sorry, I didn't run tests because it worked in my local Sage, as you say.  Certainly if we assumed this above we should forget it - preferably immediately after the assumption - that is the usual practice here.

Anyway, I'll update this momentarily.



---

archive/issue_comments_174619.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-30T16:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174619",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_174620.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-30T16:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174620",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_174621.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-30T16:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174621",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_174622.json:
```json
{
    "body": "Thanks.",
    "created_at": "2014-05-30T16:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174622",
    "user": "https://github.com/kcrisman"
}
```

Thanks.



---

archive/issue_comments_174623.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-02T12:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14005#issuecomment-174623",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_013820.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-02T12:54:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14005",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14005#event-13820"
}
```
