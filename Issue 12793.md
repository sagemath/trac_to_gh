# Issue 12793: X.Kaehler_cone().lattice() is not a lattice

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2012-05-17 18:50:38

Assignee: AlexGhitza

CC:  vbraun

Keywords: toric

In Sage-5.0 we have

```
sage: toric_varieties.P2().Kaehler_cone().lattice()
The toric rational divisor class group of a 2-d CPR-Fano toric variety covered by 3 affine patches
sage: _.base_ring()
Rational Field
```

which is wrong since this lattice is not a lattice.


---

Comment by novoselt created at 2012-05-17 19:10:33

Hi Volker,

Any thoughts on what would be the proper way to fix it? Modify `Cone` constructor to take as the lattice of a cone in a vector space the integral span of the basis and normalize/convert rays to live in this span?

It seems to be correct, but it screws up printing where these rays live in - this integral span shows as row span of the identity matrix without mention of any class groups. It also means that rays cannot be lifted to divisors, without first converting them to the rational class group explicitly.

A half-way solution is to use span of the basis for normalization of rays, but let rays be still elements of the rational divisor class group. However, in this case, it seems that rays of a cone in the N-lattice must have N_R as their parent and if we let rays live in the extension all the customization work of toric lattices becomes irrelevant.

So I am inclining to the first solution - if `Cone` gets a rational vector space V for the lattice, it actually works with `span(ZZ, V.gens())`.

Let me know what you think!


---

Comment by novoselt created at 2012-05-17 19:19:06

Another thought: instead of rational divisor class group have free divisor class group (does it have an actual name?) which is just the class group without torsion. As I understand, this is exactly the Z-span of the basis of the current one.


---

Attachment

Here is a more or less minimal solution, just a ZZ-module with the same elements.


---

Comment by novoselt created at 2012-05-29 00:08:35

Changing status from new to needs_review.


---

Comment by novoselt created at 2012-05-29 00:09:03

Changing keywords from "toric" to "toric, sd40.5".


---

Comment by vbraun created at 2012-06-29 13:13:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-06-29 13:13:12

Looks good to me!


---

Comment by jdemeyer created at 2012-07-07 22:30:24

Resolution: fixed
