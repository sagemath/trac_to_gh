# Issue 22016: Incorrect json representation for graphics

Issue created by migration from https://trac.sagemath.org/ticket/22253

Original creator: chapoton

Original creation time: 2017-01-25 10:14:08

CC:  novoselt egourgoulhon

see https://groups.google.com/forum/#!topic/sage-devel/Wjo7NkmvCks


---

Comment by chapoton created at 2017-01-25 10:22:00

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-01-25 10:22:00

New commits:


---

Comment by git created at 2017-01-25 10:27:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-25 11:02:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-25 12:28:31

Seems ok with the canvas3d viewer (in sagenb):

```
sage: u,v = var('u,v')
sage: def cf(u,v): return sin(u+v/2)**2
sage: P = parametric_plot3d((cos(u), sin(u)+cos(v), sin(v)),
....: (u,0,2*pi), (v,-pi,pi), color=(cf,colormaps.PiYG), plot_points=[60,60])
sage: P.show(viewer='canvas3d')
```

Needs to be tested in other kinds of notebooks.

Ok also in jupyter notebook. Remains to check in cloud (not that easy).


---

Comment by paulmasson created at 2017-01-25 23:55:35

All doctests pass in sage/plot/plot3d. Works with the new native Three.js viewer.

I would like to point out that this modification will bloat Three.js files without any change to the rendering, since JavaScript doesn't care whether array keys are quoted or not. Presumably that was part of the motivation for using formally incorrect JSON to begin with, so I didn't change it when writing the Three.js viewer.


---

Comment by git created at 2017-01-27 12:33:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-27 12:35:01

one still needs to change

```
local/share/sage/ext/doctest/rich_output/example.canvas3d
```

but this is not under git control ?


---

Attachment

I have attached the modified example file. What now ?


---

Comment by git created at 2017-02-10 20:55:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-02-13 08:15:06

This should be good now, but patchbots will not have a look. Please check and review.


---

Comment by paulmasson created at 2017-02-16 01:09:02

Failing doctest from most recent alterations:


```
File "src/sage/repl/rich_output/output_graphics3d.py", line 159, in sage.repl.rich_output.output_graphics3d.OutputSceneCanvas3d.example
Failed example:
    rich_output.canvas3d
Expected:
    buffer containing 649 bytes
Got:
    buffer containing 829 bytes
```



---

Comment by git created at 2017-02-21 12:46:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-02-21 12:47:17

done, should be good now.


---

Comment by paulmasson created at 2017-02-22 00:20:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-24 14:49:04

Resolution: fixed
