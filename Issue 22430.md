# Issue 22430: Fix computation of inverse metric on parallelizable manifolds

Issue created by migration from Trac.

Original creator: egourgoulhon

Original creation time: 2017-03-21 15:35:17

CC:  tscrim

Keywords: metric, manifold

The following is a bug:

```
sage: S1 = Manifold(1, 'S^1') # the circle
sage: U = S1.open_subset('U') # the complement of one point
sage: Xt.<t> =  U.chart('t:(0,2*pi)') # the standard angle coordinate
sage: V = S1.open_subset('V') # the complement of the point t=pi
sage: Xu.<u> = V.chart('u:(0,2*pi)') # the angle t-pi
sage: S1.declare_union(U, V)
sage: e = S1.vector_frame('e') # a global vector frame (makes S^1 parallelizable)
sage: g = S1.metric('g')
sage: g[e,0,0] = 1
sage: g[This is the Trac macro *e,0,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#e,0,0-macro).display()
S^1 --> R
on U: t |--> 1
on V: u |--> 1
sage: g.inverse()[This is the Trac macro *e,0,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#e,0,0-macro).display()
S^1 --> R
on U: t |--> 1
```

The last output should be 

```
S^1 --> R
on U: t |--> 1
on V: u |--> 1
```

since the component g<sup>00</sup> of the inverse metric in the global frame e is the constant scalar field 1, which must have a representation on both open subsets U and V.
The current ticket fixes this.



---

Comment by egourgoulhon created at 2017-03-21 15:41:32

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2017-03-21 15:41:32

This should be the last of the manifold bug fixes relative to Sage 7.5.1 ;-)
----
New commits:


---

Comment by tscrim created at 2017-03-22 17:54:32

One little thing: you should put the try/except block on the minimal number of lines as it makes for easier maintenance/debugging. So I think it should just include the assignment of `gmat`. Otherwise LGTM.


---

Comment by git created at 2017-03-23 10:53:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2017-03-23 10:58:38

Replying to [comment:2 tscrim]:
> One little thing: you should put the try/except block on the minimal number of lines as it makes for easier maintenance/debugging. So I think it should just include the assignment of `gmat`. 

Done (I've also included the computation of the matrix inverse in the try block).


---

Comment by tscrim created at 2017-03-23 14:19:03

Thanks.


---

Comment by tscrim created at 2017-03-23 14:19:03

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-03 20:59:43

Resolution: fixed
