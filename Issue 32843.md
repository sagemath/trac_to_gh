# Issue 32843: Fix scipy-3.7.2 build failure on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/33080

Original creator: slelievre

Original creation time: 2021-12-25 04:52:44

CC:  dimpase mkoeppe slelievre

Keywords: build, cygwin, scipy

Sage 9.5.beta9 + #33043 fails to build scipy-3.7.2
on Cygwin.

- [report on sage-release, 2021-12](https://groups.google.com/g/sage-release/c/V9KflJYxHrk/m/gJIZHkegDQAJ)


---

Comment by dimpase created at 2021-12-25 08:52:48

logs please


---

Comment by mkoeppe created at 2021-12-26 19:06:59

I see this build failure now also in https://github.com/mkoeppe/sage/runs/4635610425?check_suite_focus=true (tested with the update to 1.7.3 in #33049)


---

Comment by mkoeppe created at 2021-12-26 19:11:36


```
  scipy/stats/_boost/src/beta_ufunc.cxx:3903:46:   required from here
  /opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/var/tmp/sage/build/scipy-1.7.3/src/scipy/_lib/boost/boost/math/tools/promotion.hpp:148:37: error: static assertion failed: Sorry, but this platform does not have sufficient long double support for the special functions to be reliably implemented.
    148 |          BOOST_STATIC_ASSERT_MSG((0 == ::boost::is_same<type, long double>::value), "Sorry, but this platform does not have sufficient long double support for the special functions to be reliably implemented.");
error: Command "g++ -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -ggdb -O2 -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fstack-protector-strong --param=ssp-buffer-size=4 -DOPENSSL_NO_SSL3=1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/build=/usr/src/debug/python38-3.8.12-1 -fdebug-prefix-map=/pub/devel/python/python38/python38-3.8.12-1.x86_64/src/Python-3.8.12=/usr/src/debug/python38-3.8.12-1 -D_GNU_SOURCE -DBOOST_MATH_DOMAIN_ERROR_POLICY=ignore_error -DBOOST_MATH_EVALUATION_ERROR_POLICY=user_error -DBOOST_MATH_PROMOTE_DOUBLE_POLICY=false -Iscipy/stats/_boost/include/ -Iscipy/stats/_boost/src/ -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/lib/python3.8/site-packages/numpy/core/include -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/var/tmp/sage/build/scipy-1.7.3/src/scipy/_lib/boost -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/lib/python3.8/site-packages/numpy/core/include -Ibuild/src.cygwin-3.3.3-x86_64-3.8/numpy/distutils/include -I/opt/sage-4525b51c9c556e7d1bf7a4d90ee129c6b7f1d9a7/include -I/usr/include/python3.8 -c scipy/stats/_boost/src/beta_ufunc.cxx -o build/temp.cygwin-3.3.3-x86_64-3.8/scipy/stats/_boost/src/beta_ufunc.o -MMD -MF build/temp.cygwin-3.3.3-x86_64-3.8/scipy/stats/_boost/src/beta_ufunc.o.d -std=c++14 -msse -msse2 -msse3" failed with exit status 1
```



---

Comment by mkoeppe created at 2021-12-26 19:15:39

Use of (vendored) `boost` was introduced in scipy 1.7.0


---

Comment by mkoeppe created at 2021-12-26 19:26:54

This is with gcc-g++ 11.2.0-1


---

Comment by mkoeppe created at 2021-12-26 19:31:28

This is coming in through https://github.com/scipy/boost-headers-only/blob/ca02b3b71579fe4913e3e4d1153c34868ec95769/boost/math/tools/config.hpp#L31


---

Comment by mkoeppe created at 2021-12-26 19:49:46

Also affects FreeBSD apparently, and the porters just patch it out: https://cgit.freebsd.org/ports/tree/science/py-scipy/files/patch-scipy___lib_boost_boost_math_tools_config.hpp


---

Comment by mkoeppe created at 2021-12-26 19:54:53

Upstream boost: https://github.com/boostorg/math/blob/develop/include/boost/math/tools/config.hpp


---

Comment by mkoeppe created at 2021-12-26 20:00:03

Neither of these projects has a Cygwin CI (and obviously no FreeBSD CI):
- https://github.com/boostorg/math/blob/develop/.github/workflows/ci.yml
- https://github.com/scipy/scipy/tree/master/.github/workflows


---

Comment by mkoeppe created at 2021-12-26 20:03:23

Changing priority from major to blocker.


---

Comment by git created at 2021-12-26 20:23:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-26 20:24:15

Changing status from new to needs_review.


---

Comment by git created at 2021-12-26 21:13:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-27 00:46:51

I don't seem to be getting Windows runners on GH Actions at the moment, so manual testing of this branch on Cygwin would be helpful


---

Comment by mkoeppe created at 2021-12-28 04:52:03

This branch fixes the issue, as can be seen in the successful run https://github.com/mkoeppe/sage/runs/4646463107?check_suite_focus=true


---

Comment by slelievre created at 2021-12-28 07:24:33

This lets the scipy-1.7.2 spkg build for me.

Thanks for the fix and for sending pull requests
to Boost and opening an issue for SciPy.

Should the the patch or the commit messages
mention the inspiration is from FreeBSD?

Or is the discussion here enough?

One way or the other, you can set to
positive review on my behalf.


---

Comment by mkoeppe created at 2021-12-28 08:58:31

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-12-28 08:58:31

Thanks for testing!


---

Comment by mkoeppe created at 2021-12-28 08:58:49

Replying to [comment:23 slelievre]:
> Should the the patch or the commit messages
> mention the inspiration is from FreeBSD?
> 
> Or is the discussion here enough?

I think it's fine as is.


---

Comment by vbraun created at 2022-01-01 00:23:00

Resolution: fixed
