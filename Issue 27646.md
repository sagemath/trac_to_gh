# Issue 27646: AsymptoticRing: pass log-function more systematically

Issue created by migration from https://trac.sagemath.org/ticket/27883

Original creator: dkrenn

Original creation time: 2019-05-28 11:45:46

CC:  behackl

In #22154 (merged in a recent beta), a new `log` parameter was introduced. This was very specifically done for this parameter and does not allow any easy extensions. The aim of this ticket is to generalize this by using a general `locals` parameter.

(Note that no deprecation for `log` is needed, as this was only merged in a recent beta and not yet in a stable release.)


---

Comment by dkrenn created at 2019-05-28 11:53:51

Changing status from new to needs_review.


---

Comment by dkrenn created at 2019-05-28 11:53:51

Last 10 new commits:


---

Comment by dkrenn created at 2019-05-28 12:33:47

Trivial dependency #27837 added.


---

Comment by chapoton created at 2019-05-28 19:19:47

You are using incompatible-with-python3 syntax, see patchbot report. As said on sage-devel, developers should rather switch now to python3-sage.


---

Comment by dkrenn created at 2019-05-28 23:52:50

Replying to [comment:5 chapoton]:
> You are using incompatible-with-python3 syntax, see patchbot report.

Without the parenthesis it doesn't work either

```
>>> di={1:2, 3:4}
>>> sorted(di.items(), key=lambda k,v: k)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: <lambda>() missing 1 required positional argument: 'v'
```

Not sure, how to nicely rewrite this (I am now using `lambda e: e[0]` which I find less nice but it works.)


---

Comment by git created at 2019-05-28 23:52:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2019-05-28 23:54:12

Replying to [comment:5 chapoton]:
> You are using incompatible-with-python3 syntax, see patchbot report. As said on sage-devel, developers should rather switch now to python3-sage.

Thank you for telling; I wasn't aware that this is not Py3. (FWIW, I have a Py3-Sage, but I see this ticket more like a fixup of a recent change, so still using my "old" Sage for this. But I will switch soon. ;) )


---

Comment by git created at 2019-05-28 23:55:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2019-05-29 00:04:32

Replying to [comment:6 dkrenn]:
> Replying to [comment:5 chapoton]:
> > You are using incompatible-with-python3 syntax, see patchbot report.
> 
> Without the parenthesis it doesn't work either
> {{{
> >>> di={1:2, 3:4}
> >>> sorted(di.items(), key=lambda k,v: k)
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
> TypeError: <lambda>() missing 1 required positional argument: 'v'
> }}}
> Not sure, how to nicely rewrite this (I am now using `lambda e: e[0]` which I find less nice but it works.)

Ok, seems to be just this way according to 
https://www.python.org/dev/peps/pep-3113/
They say I should rather use `lambda k_v: k_v[0]`.


---

Comment by git created at 2019-05-29 00:05:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2019-05-29 02:08:22

Now patchbots seem to be happy :)


---

Comment by behackl created at 2019-05-29 11:38:42

Changing status from needs_review to needs_info.


---

Comment by behackl created at 2019-05-29 11:38:42

I reviewed the changes and overall, I like this approach to make the module more flexible.

Personally, I would prefer if the `log` function in the `AsymptoticRing` still had a parameter to which an alternative log could be passed directly, instead of passing it inside a `locals`-dictionary; just as a convenience method. What do you think about that?


---

Comment by dkrenn created at 2019-05-29 13:26:07

Replying to [comment:13 behackl]:
> Personally, I would prefer if the `log` function in the `AsymptoticRing` still had a parameter to which an alternative log could be passed directly, instead of passing it inside a `locals`-dictionary; just as a convenience method. What do you think about that?

I thought exactly about doing this. However, I decided not not use it, so that all these kind of parameter passing because:
- When usually something is defined in [SageMath](SageMath) globally, it should be overridden in a well defined manner and that's `locals`.
- This scales to other (future) extensions.
- By using `locals` (only), it is somehow self explanatory (when knowing what locals is), what it does, whereas I find a `log` parameter less obvious (although not too bad either).

Therefore, I removed the `log` parameter completely.


---

Comment by behackl created at 2019-05-29 13:39:51

Replying to [comment:14 dkrenn]:
> Replying to [comment:13 behackl]:
> > Personally, I would prefer if the `log` function in the `AsymptoticRing` still had a parameter to which an alternative log could be passed directly, instead of passing it inside a `locals`-dictionary; just as a convenience method. What do you think about that?
> 
> I thought exactly about doing this. However, I decided not not use it, so that all these kind of parameter passing because:
> - When usually something is defined in [SageMath](SageMath) globally, it should be overridden in a well defined manner and that's `locals`.
> - This scales to other (future) extensions.
> - By using `locals` (only), it is somehow self explanatory (when knowing what locals is), what it does, whereas I find a `log` parameter less obvious (although not too bad either).
> 
> Therefore, I removed the `log` parameter completely. 

Alright. I see, and agree with your conclusion. (Besides, I would assume that if someone wants to use a custom log function, then they should set it globally for their entire `AsymptoticRing` anyways; adapting the log locally probably isn't really that common anyways.)

I want to do some further investigations regarding this ticket; I should be done soon.


---

Comment by behackl created at 2019-05-29 13:39:51

Changing status from needs_info to needs_review.


---

Comment by behackl created at 2019-06-03 17:26:32

Changing status from needs_review to positive_review.


---

Comment by behackl created at 2019-06-03 17:26:32

Of course, I forgot to set this to `positive_review` after I was done.

I reviewed the changes carefully, everything looks good to me and also the patchbot seems to be happy.


---

Comment by dkrenn created at 2019-06-11 07:30:39

Replying to [comment:17 chapoton]:
> Dependencies #22154, #27837 deleted 

I am curious: Why were the (closed) dependencies deleted? Is there any advantage for doing this and should we do this on a regular basis? (However, I do not mind that it was done, just curious as said.) ;)


---

Comment by chapoton created at 2019-06-11 08:07:25

This _may_ be blocking the merge by the release manager. Not sure, but just to be safe.


---

Comment by dkrenn created at 2019-06-11 10:59:50

Replying to [comment:19 chapoton]:
> This _may_ be blocking the merge by the release manager. Not sure, but just to be safe.

I see; I think this is not an issue here, see https://groups.google.com/d/msg/sage-release/E4vp20O2FN0/Sk5IynzSAwAJ (it will be in rc1).


---

Comment by vbraun created at 2019-06-11 23:03:09

Resolution: fixed
