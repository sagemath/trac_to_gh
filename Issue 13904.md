# Issue 13904: bug in is_isomorphic

Issue created by migration from https://trac.sagemath.org/ticket/14108

Original creator: zimmerma

Original creation time: 2013-02-13 16:00:09

Assignee: jason, ncohen, rlm

CC:  ncohen

This seems similar to #13114 but still buggy in Sage 5.6:

```
sage: G=DiGraph([[0,0],[0,0],[0,0],[1,1],[1,1],[1,1]])
sage: H=DiGraph([[0,0],[0,0],[0,0],[0,0],[1,1],[1,1]])
sage: G.is_isomorphic(H)  
True
sage: G.is_isomorphic(H,certify=true)
(True, {0: 0, 1: 1})
```

Paul



---

Comment by ncohen created at 2013-02-13 16:29:47

Seems to be equivalent to 

```
sage: G=DiGraph([[0,0,0],[1,1,0]])      
sage: H=DiGraph([[0,0,0],[1,1,1]])
sage: G.is_isomorphic(H)                                    
True
```

But there I have no idea what to do. Deep down, the isomorphism routines for G1,G2 accept a partition for G1, but not fo G2.

No idea how to fix that `O_o`

Nathann


---

Comment by zimmerma created at 2013-02-13 16:53:29

at least one could call `is_isomorphic` with `certify=true`, and check that permuting the labels
of G with the given permutation one finds H.

Paul


---

Comment by zimmerma created at 2013-02-13 16:54:04

sorry I meant "permuting the vertices of G".

Paul


---

Comment by ncohen created at 2013-02-13 17:04:53

And raise an exception then ? Well, you can write that if you want. But it would be heavy for all graphs, while what is needed here is a bugfix.

Nathann


---

Comment by zimmerma created at 2013-02-13 21:54:17

> And raise an exception then ?

no, I would assume that in the case the check fails, the graphs are not isomorphic, and then return `false`.

Paul


---

Comment by ncohen created at 2013-02-13 21:55:46

That would be an incorrect answer. How can you rule out the possibility that among the (many) isomorphisms that may exist between two graphs Sage returns a bad one, which does not change the fact that the two graphs *are* isomorphic ?

Nathann


---

Comment by zimmerma created at 2013-02-13 22:01:25

then at least one could issue a warning to the user when the check fails.

Paul


---

Comment by ncohen created at 2013-02-13 22:02:08

> then at least one could issue a warning to the user when the check fails.

Like... an exception ?

Nathann


---

Comment by zimmerma created at 2013-02-14 06:47:08

here is the workaround I use in my code:

```
def my_is_isomorphic(G,H):
   r, p = G.is_isomorphic(H,certify=true)
   if r==False:
      return r
   for p in Permutations(range(G.order())):
      l = []
      for e in G.edges():
         l.append([p[e[0]],p[e[1]]])
      if DiGraph(l) == H:
         return true
   return false
```

Paul


---

Comment by rlm created at 2013-02-15 17:15:32

Changing status from new to needs_review.


---

Comment by ncohen created at 2013-02-15 20:39:25

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2013-02-15 20:39:25

That would be too easy `:-P`
It's not just a "local thing". That's really something that changes the isomorphism test I fear.


```
sage: H=DiGraph([[0,0],[0,0],[0,0],[0,0],[0,0],[1,1],[1,1]]) 
sage: HH=DiGraph([[0,0],[0,0],[0,0],[0,0],[1,1],[1,1],[1,1]])
sage: H.is_isomorphic(HH)
True
```


Actually, I think that these two graphs should not be isomorphic. That's the same problem, considering how multiple edges are translated into labels.

```
sage: Graph([(0,1,1)]).is_isomorphic(Graph([(0,1,2)]))
True
```


Nathann


---

Attachment


---

Comment by rlm created at 2013-02-17 18:46:13

Changing status from needs_work to needs_review.


---

Comment by rlm created at 2013-02-17 18:46:13

Try this one.


---

Comment by rlm created at 2013-02-17 18:49:51

In your second example, you need to use edge_labels=True, as the default is to ignore labels.


---

Comment by zimmerma created at 2013-02-18 13:07:38

looks fine to me. All tests pass and the reported bug is fixed. Positive review.

Paul


---

Comment by zimmerma created at 2013-02-18 13:07:38

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-02-22 19:13:06

Resolution: fixed
