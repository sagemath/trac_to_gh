# Issue 25681: Queer supercrystals

archive/issues_025681.json:
```json
{
    "body": "CC:  wpoh tscrim bsalisbury1 bump aschilling\n\nKeywords: crystals, super Lie algebras\n\nWe implement the standard queer supercrystals as a crystal of Letters and the tensor product rule.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25918\n\n",
    "created_at": "2018-07-24T18:22:38Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Queer supercrystals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25681",
    "user": "aschilling"
}
```
CC:  wpoh tscrim bsalisbury1 bump aschilling

Keywords: crystals, super Lie algebras

We implement the standard queer supercrystals as a crystal of Letters and the tensor product rule.

Issue created by migration from https://trac.sagemath.org/ticket/25918





---

archive/issue_comments_362401.json:
```json
{
    "body": "Changing keywords from \"crystals, super Lie algebras\" to \"crystals, super Lie algebras, sagedays@icerm\".",
    "created_at": "2018-07-25T01:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362401",
    "user": "aschilling"
}
```

Changing keywords from "crystals, super Lie algebras" to "crystals, super Lie algebras, sagedays@icerm".



---

archive/issue_comments_362402.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2018-07-26T22:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362402",
    "user": "aschilling"
}
```

Last 10 new commits:



---

archive/issue_comments_362403.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-26T22:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362403",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362404.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-26T22:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362404",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-26T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362405",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362406.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T00:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362406",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T02:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362407",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T02:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362408",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362409.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T02:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362409",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362410.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T02:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362410",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T03:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362411",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362412.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-27T03:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362412",
    "user": "aschilling"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_362413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T13:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362413",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362414.json:
```json
{
    "body": "I get the same error as the patchbot (trivial ordering fix likely due to the new way you are constructing the digraph) in `crystals/kac_modules.py`.\n\nTo make this Python3 compatible:\n\n```diff\n-w = range(2,j+1) + range(1,j)\n+w = list(range(2,j+1)) + list(range(1,j))\n```\n\n\n\n```diff\n-Return enlarged index set.\n+Return the enlarged index set.\n```\n\nplus the same comment as above. Actually, you want to make this an ``@`cached_method` and return a tuple with how frequently it gets called.\n\nThere is no need to call `self[k].weight()` twice:\n\n```diff\n-w += self[k].weight()[0] + self[k].weight()[1]\n+wt = self[k].weight()\n+w = wt[0] + wt[1]\n```\n\n\nThis seems inefficient: `n = max(self.index_set())`. Isn't this something you can get from the Cartan type (rather than recomputing it)?\n\nIMO, you are better off writing a little helper function (in Cython) to get `w0` instead of this:\n\n```\n           from sage.combinat.permutation import Permutations\n           w = Permutations(n+1).long_element().reduced_word()\n```\n\n\nYou should define `w` to be a list in `e` and `f`. Similarly define `k` to be an `int` (although you may not want to use `k` to loop over elements in `w`).\n\n```\ncdef list w\ncdef int k\n```\n\nAlso, in the `while` loops, you don't want to repeatedly call `len(self)` (as that does not change). You can get a little bit of extra time by pulling that out as a variable.",
    "created_at": "2018-07-27T13:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362414",
    "user": "tscrim"
}
```

I get the same error as the patchbot (trivial ordering fix likely due to the new way you are constructing the digraph) in `crystals/kac_modules.py`.

To make this Python3 compatible:

```diff
-w = range(2,j+1) + range(1,j)
+w = list(range(2,j+1)) + list(range(1,j))
```



```diff
-Return enlarged index set.
+Return the enlarged index set.
```

plus the same comment as above. Actually, you want to make this an ``@`cached_method` and return a tuple with how frequently it gets called.

There is no need to call `self[k].weight()` twice:

```diff
-w += self[k].weight()[0] + self[k].weight()[1]
+wt = self[k].weight()
+w = wt[0] + wt[1]
```


This seems inefficient: `n = max(self.index_set())`. Isn't this something you can get from the Cartan type (rather than recomputing it)?

IMO, you are better off writing a little helper function (in Cython) to get `w0` instead of this:

```
           from sage.combinat.permutation import Permutations
           w = Permutations(n+1).long_element().reduced_word()
```


You should define `w` to be a list in `e` and `f`. Similarly define `k` to be an `int` (although you may not want to use `k` to loop over elements in `w`).

```
cdef list w
cdef int k
```

Also, in the `while` loops, you don't want to repeatedly call `len(self)` (as that does not change). You can get a little bit of extra time by pulling that out as a variable.



---

archive/issue_comments_362415.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T14:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362415",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362416.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T14:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362416",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362417.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T15:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362417",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362418.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-27T15:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362418",
    "user": "aschilling"
}
```

New commits:



---

archive/issue_comments_362419.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T20:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362419",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362420.json:
```json
{
    "body": "I made some additional changes; in particular, cached results should not return mutable objects such as lists. I also did some additional (micro)optimizations with the Cython code. If my changes are good, then you can set a positive review.",
    "created_at": "2018-07-27T20:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362420",
    "user": "tscrim"
}
```

I made some additional changes; in particular, cached results should not return mutable objects such as lists. I also did some additional (micro)optimizations with the Cython code. If my changes are good, then you can set a positive review.



---

archive/issue_comments_362421.json:
```json
{
    "body": "the choice for the branch name was so remarkable that I decided to check whether it's some rogue pr0n ;-)\n\nSorry for noise...",
    "created_at": "2018-07-27T21:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362421",
    "user": "dimpase"
}
```

the choice for the branch name was so remarkable that I decided to check whether it's some rogue pr0n ;-)

Sorry for noise...



---

archive/issue_comments_362422.json:
```json
{
    "body": "Thank you for the review, Travis!",
    "created_at": "2018-07-27T23:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362422",
    "user": "aschilling"
}
```

Thank you for the review, Travis!



---

archive/issue_comments_362423.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-27T23:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362423",
    "user": "aschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_362424.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-07T20:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25681#issuecomment-362424",
    "user": "vbraun"
}
```

Resolution: fixed
