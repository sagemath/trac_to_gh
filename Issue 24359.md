# Issue 24359: port Sage to SPARC Solaris 11

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2018-01-26 14:59:02

CC:  dimpase

with access to SPARC T4 system, this looks not too hard.

We track here the resulting issues and tickets.

* no need to pre-build any tools, apparently. Everything is available via Solaris `pkg` or `pkgutil` (i.e. opencsw). 

* MPFR configure fails with MPIR. Can be resolved quickly by a patch, see MPIR [issue 242](https://github.com/wbhart/mpir/issues/242).

* python2/3 building needs `CFLAGS="-D_XPG6"`

* tuning of `gf2x` fails, set `SAGE_TUNE_GF2X=no`

* to take care of the above, `.` the following before building

```
export ABI=64
export SAGE64=yes
export CFLAGS="-D_XPG6"
export SAGE_TUNE_GF2X=no
export PATH=/opt/csw/gnu:/usr/sfw/bin:$PATH
```



---

Comment by dimpase created at 2018-01-28 18:33:22

I've managed to build `gcc 7.2.0` from source configuring as follows:

```
./configure --prefix=/datapool/dima --with-gmp-include=/usr/include/gmp --with-mpfr-include=/usr/include/mpfr --with-mpc=/usr --without-gnu-ld --with-ld=/usr/bin/ld --with-gnu-as --enable-languages=c,c++,fortran  --enable-shared --enable-initfini-array  --with-system-zlib  --with-as=/usr/gnu/bin/as --build=sparcv9-sun-solaris2.11
```

using system-provided gmp, mpfr, and mpc.
Building it in Sage did not work, it failed in building gfrortan with some obscure MPFR-related linking error.


---

Comment by jdemeyer created at 2018-01-29 17:20:36

Lots of issues mentioned in the ticket description do not have a ticket yet. Should I create tickets for each?


---

Comment by dimpase created at 2018-01-29 17:27:47

One more issue is just reported here: http://www.singular.uni-kl.de:8002/trac/ticket/816

Singular uses specific -Wl linker syntax in libpolys/polys/Makefile.am
which nukes linking (as Solaris linker does not accept `dynamic_lookup` parameter).
(By right, it's autotools that should generate such platform-specific arguments, it's asking for trouble to give them explicitly).

Feel free to open as many tickets as needed- making sure that we don't duplicate each other.


---

Comment by dimpase created at 2018-01-29 23:30:30

Opened #24611 to deal with Singular linking problems


---

Comment by dimpase created at 2018-01-30 11:02:29

the next snag is R, a bus error during installation of 'tools' package:

```
...
gcc -shared -L../../../../lib -m64 -L/datapool/dima/Sage/sagetrac-mirror/local/lib -Wl,-rpath,/datapool/dima/Sage/sagetrac-mirror/local/lib -o tools.so text.o init.o Rmd5.o md5.o signals.o install.o getfmts.o http.o gramLatex.o gramRd.o -L../../../../lib -lR
make[9]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools/src'
mkdir -p -- ../../../../library/tools/libs
/src'
make[7]: Leaving directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'
make[7]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'
installing 'sysdata.rda'
make[7]: Leaving directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'

 *** caught bus error ***
address 101556b6c, cause 'invalid alignment'

Traceback:
 1: strsplit(x, "\n[ \t\n]*\n", perl = TRUE)
 2: is.vector(X)
 3: lapply(strsplit(x, "\n[ \t\n]*\n", perl = TRUE), strsplit, "[ \t\n]",     perl = TRUE)
 4: strwrap(paste0(x, ": ", y), exdent = indent, width = width, simplify = FALSE)
 5: formatDL(rep.int(tag, length(val)), val, style = "list", width = width,     indent = indent)
 6: fmt(nmx[j], xj[i], foldable[j])
 7: write.dcf(rbind(x), dfile, keep.white = c(.keep_white_description_fields,     "Maintainer", "BugReports"))
 8: .write_description(db, file.path(outDir, "DESCRIPTION"))
 9: tools:::.install_package_description(".", "../../../library/tools")
An irrecoverable exception occurred. R is aborting now ...
/bin/sh: 13985: Bus error(coredump)
make[6]: *** [Makefile:36: all] Bus Error
```



---

Comment by dimpase created at 2018-01-30 11:06:12

The complete log of R installation is here. http://users.ox.ac.uk/~coml0531/tmp/r-343-solaris11.log

I suppose this is a compiler bug (with gcc 7.2.0). I'll try different gcc versions.


---

Comment by jdemeyer created at 2018-01-30 14:25:19

To avoid the MPIR trouble, I'm trying `./configure --with-mp=gmp`.


---

Comment by dimpase created at 2018-01-30 17:29:58

Replying to [comment:14 dimpase]:
> The complete log of R installation is here. http://users.ox.ac.uk/~coml0531/tmp/r-343-solaris11.log
> 
> I suppose this is a compiler bug (with gcc 7.2.0). I'll try different gcc versions.
Same error with gcc 7.3.0. Will try gcc 5.4 now.


---

Comment by dimpase created at 2018-01-31 01:01:44

the problem of R is in pcre (that's where it crashes), and pcre fails its self-tests:

```
[pcre-8.40.p1] make[5]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/pcre-8.40.p1/src'
[pcre-8.40.p1] PASS: pcre_stringpiece_unittest
[pcre-8.40.p1] PASS: pcre_scanner_unittest
[pcre-8.40.p1] PASS: pcrecpp_unittest
[pcre-8.40.p1] ./test-driver: line 107: 25794 Bus Error               (core dumped) "$`@`" > $log_file 2>&1
[pcre-8.40.p1] FAIL: pcre_jit_test
[pcre-8.40.p1] FAIL: RunTest
[pcre-8.40.p1] FAIL: RunGrepTest
[pcre-8.40.p1] ============================================================================
[pcre-8.40.p1] Testsuite summary for PCRE 8.40
[pcre-8.40.p1] ============================================================================
[pcre-8.40.p1] # TOTAL: 6
[pcre-8.40.p1] # PASS:  3
[pcre-8.40.p1] # SKIP:  0
[pcre-8.40.p1] # XFAIL: 0
[pcre-8.40.p1] # FAIL:  3
[pcre-8.40.p1] # XPASS: 0
[pcre-8.40.p1] # ERROR: 0
```

----
New commits:


---

Comment by git created at 2018-01-31 06:24:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-01-31 06:36:19

Replying to [ticket:24596 dimpase]:
> * gcc 7.2 builds glpk and fplll, whereas gcc 5.4 cannot do it.

I had no problems to build GLPK with GCC 5.4.0.


---

Comment by git created at 2018-01-31 09:57:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-01-31 10:33:37

By the way, I can't reproduce any problems with gf2x tuning.


---

Comment by jdemeyer created at 2018-01-31 12:46:16

By the way, I think that it _should_ be possible to build openblas. I don't see any fundamental obstructions.


---

Comment by dimpase created at 2018-01-31 12:53:42

Replying to [comment:30 jdemeyer]:
> By the way, I think that it _should_ be possible to build openblas. I don't see any fundamental obstructions.

I think that openblas for non-x86* architectures does not exist.


---

Comment by jdemeyer created at 2018-01-31 15:33:05

Replying to [comment:31 dimpase]:
> I think that openblas for non-x86* architectures does not exist.

I am challenging your hypotheses:

```
Install OK!
make[3]: Leaving directory '/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/src'
make[2]: Leaving directory '/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/src'
Wrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/blas.pc
Wrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/cblas.pc
Wrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/lapack.pc

real    55m45.102s
user    99m54.598s
sys     35m15.907s
Copying package files from temporary location /datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/inst to /datapool/jeroen/sage-openblas/local
Successfully installed openblas-0.2.20.p1
Deleting temporary build directory
/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1
Finished installing openblas-0.2.20.p1.spkg
```



---

Comment by dimpase created at 2018-02-01 01:39:46

Replying to [comment:21 dimpase]:
> the problem of R is in pcre (that's where it crashes),

trying to build R with system's pcre (remove the dependence on pcre from R, and remove pcre stuff from SAGEROOT/local/[bin,lib])
gets me past this ugly segfault.

Stuck later in some linking error, which should be manageable
(need to rebuild with -j1 for a meaningful log).


---

Comment by dimpase created at 2018-02-01 01:43:18

Replying to [comment:33 dimpase]:
> Replying to [comment:21 dimpase]:
> > the problem of R is in pcre (that's where it crashes),
> 
> trying to build R with system's pcre (remove the dependence on pcre from R, and remove pcre stuff from SAGEROOT/local/[bin,lib])
> gets me past this ugly segfault.
> 
> Stuck later in some linking error, which should be manageable
> (need to rebuild with -j1 for a meaningful log).
 
deal with pcre here: #24628


---

Comment by dimpase created at 2018-02-01 01:46:29

deal with R on #24629


---

Comment by jdemeyer created at 2018-02-01 05:54:02

By the way, how did you manage to build GCC? I have tried with several variations on `CFLAGS` and `CC` but I never managed to have a successful build of GCC.


---

Comment by dimpase created at 2018-02-01 09:31:12

Replying to [comment:36 jdemeyer]:
> By the way, how did you manage to build GCC? I have tried with several variations on `CFLAGS` and `CC` but I never managed to have a successful build of GCC.

I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed. This is what I did to build
gcc 7.2 in /datapool/dima/bin

```
./configure --prefix=/datapool/dima --with-gmp-include=/usr/include/gmp --with-mpfr-include=/usr/include/mpfr --with-mpc=/usr --without-gnu-ld --with-ld=/usr/bin/ld --with-gnu-as --enable-languages=c,c++,fortran  --enable-shared --enable-initfini-array  --with-system-zlib  --with-as=/usr/gnu/bin/as --build=sparcv9-sun-solaris2.11
```

You need to make sure that Solaris `ld` is 1st in the PATH (I have a dedicated directory `/datapool/dima/tools` with a link to /usr/bin/ld which is 1st in my PATH), and also I used the same
flags as for building Sage:

```
CFLAGS=-D_XPG6
PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin
```

Probably if I tried harder it would also have worked with Sage's gcc - we don't set `--build=`, do we?

To use gfortran built there one needs 

```
export LD_LIBRARY_PATH=/datapool/dima/lib/sparcv9
```

(perhaps there is a better way)


---

Comment by jdemeyer created at 2018-02-01 11:52:37

Replying to [comment:38 dimpase]:
> I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed.

So, it's a GCC build _outside_ of Sage. I was simply trying to build with `SAGE_INSTALL_GCC=yes`.

> also I used the same
> flags as for building Sage:
> {{{
> CFLAGS=-D_XPG6
> PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin
> }}}

So no `-m64` to build GCC?


---

Comment by dimpase created at 2018-02-01 12:28:24

Replying to [comment:39 jdemeyer]:
> Replying to [comment:38 dimpase]:
> > I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed.
> 
> So, it's a GCC build _outside_ of Sage. I was simply trying to build with `SAGE_INSTALL_GCC=yes`.

This did not work for me either, I merely wanted to see whether it's an internal Sage issue, or a bigger problem. (So yes, it's a Sage internal issue, not sure we must fix it no matter what; after all, the system's gcc 5.4.0 appears to be doing the job just as well.)

> 
> > also I used the same
> > flags as for building Sage:
> > {{{
> > CFLAGS=-D_XPG6
> > PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin
> > }}}
> 
> So no `-m64` to build GCC?

I did `export ABI=64`. I ended up with 64-bit results. It might be managed by `--build`, perhaps. However, I suppose one ends up with tools capable of building 64- and 32-bit programs. In $PREFIX/lib/ it has installed a bunch of 32-bit ELFs, and in 
$PREFIX/lib/sparcv9/ 64-bit ELFs.


---

Comment by dimpase created at 2018-02-02 09:14:12

With all the fixes we got, my build went to an error about conflicting headers while building sagelib:

```
[sagelib-8.2.beta4] [ 26/430] creating build/temp.solaris-2.11-sun4v.64bit-2.7/build/cythonized/sage/data_structures
[sagelib-8.2.beta4] gcc -DNDEBUG -g -O3 -Wall -D_XPG6 -fPIC -I/datapool/dima/Sage/sagetrac-mirror/local/include -I/datapool/dima/Sage/sagetrac-mirror/local/inc
lude/python2.7 -I/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/numpy/core/include -I/datapool/dima/Sage/sagetrac-mirror/src -I/datapool
/dima/Sage/sagetrac-mirror/src/sage/ext -Ibuild/cythonized -I/datapool/dima/Sage/sagetrac-mirror/local/include/python2.7 -c build/cythonized/sage/data_structur
es/binary_search.c -o build/temp.solaris-2.11-sun4v.64bit-2.7/build/cythonized/sage/data_structures/binary_search.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRAC
EBACK=1 -std=c99
[sagelib-8.2.beta4] In file included from build/cythonized/sage/combinat/partitions.cpp:597:0:
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions_c.h: In function ‘int isinf(double)’:
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions_c.h:3:19: error: ‘int isinf(double)’ conflicts with a previous declaration
[sagelib-8.2.beta4]  int isinf(double x) { return !finite(x) && x==x; }
[sagelib-8.2.beta4]                    ^
[sagelib-8.2.beta4] In file included from /datapool/dima/lib/gcc/sparcv9-sun-solaris2.11/7.2.0/include-fixed/math.h:25:0,
[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/bits/std_abs.h:40,
[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/cstdlib:77,
[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/stdlib.h:36,
[sagelib-8.2.beta4]                  from ../local/include/python2.7/Python.h:42,
[sagelib-8.2.beta4]                  from build/cythonized/sage/combinat/partitions.cpp:58:
[sagelib-8.2.beta4] /usr/include/iso/math_c99.h:711:14: note: previous declaration ‘bool std::isinf(double)’
[sagelib-8.2.beta4]   inline bool isinf(double __X) { return __builtin_isinf(__X); }
[sagelib-8.2.beta4]               ^~~~~
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp: At global scope:
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4778:18: warning: ‘PyObject* __pyx_pw_4sage_9structure_7element_3have_same_parent(PyObject*, 
PyObject*, PyObject*)’ defined but not used [-Wunused-function]
[sagelib-8.2.beta4]  static PyObject *__pyx_pw_4sage_9structure_7element_3have_same_parent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
[sagelib-8.2.beta4]                   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4777:13: warning: ‘__pyx_doc_4sage_9structure_7element_2have_same_parent’ defined but not use
d [-Wunused-variable]
[sagelib-8.2.beta4]  static char __pyx_doc_4sage_9structure_7element_2have_same_parent[] = "have_same_parent(left, right) -> bool\nFile: sage/structure/element
.pxd (starting at line 112)\n\n    Return ``True`` if and only if ``left`` and ``right`` have the\n    same parent.\n\n    .. WARNING::\n\n        This functio
n assumes that at least one of the arguments is a\n        Sage :class:`Element`. When in doubt, use the slower\n        ``parent(left) is parent(right)`` inst
ead.\n\n    EXAMPLES::\n\n        sage: from sage.structure.element import have_same_parent\n        sage: have_same_parent(1, 3)\n        True\n        sage: 
have_same_parent(1, 1/2)\n        False\n        sage: have_same_parent(gap(1), gap(1/2))\n        True\n\n    These have different types but the same parent::
\n\n        sage: a = RLF(2)\n        sage: b = exp(a)\n        sage: type(a)\n        <... 'sage.rings.real_lazy.LazyWrapper'>\n        sage: type(b)\n       
 <... 'sage.rings.real_lazy.LazyNamedUnop'>\n        sage: have_same_parent(a, b)\n        True\n    ";
[sagelib-8.2.beta4]              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4436:18: warning: ‘PyObject* __pyx_pw_4sage_9structure_7element_1parent(PyObject*, PyObject*)’ defined but not used [-Wunused-function]
[sagelib-8.2.beta4]  static PyObject *__pyx_pw_4sage_9structure_7element_1parent(PyObject *__pyx_self, PyObject *__pyx_v_x) {
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4435:13: warning: ‘__pyx_doc_4sage_9structure_7element_parent’ defined but not used [-Wunused-variable]
[sagelib-8.2.beta4]  static char __pyx_doc_4sage_9structure_7element_parent[] = "parent(x)\nFile: sage/structure/element.pxd (starting at line 7)\n\n    Return the parent of the element ``x``.\n\n    Usually, this means the mathematical object of which ``x`` is an\n    element.\n\n    INPUT:\n\n    - ``x`` -- an element\n\n    OUTPUT:\n\n    - If ``x`` is a Sage :class:`Element`, return ``x.parent()``.\n\n    - Otherwise, return ``type(x)``.\n\n    .. SEEALSO::\n\n        `Parents, Conversion and Coercion <http://doc.sagemath.org/html/en/tutorial/tour_coercion.html>`_\n        Section in the Sage Tutorial\n\n    EXAMPLES::\n\n        sage: a = 42\n        sage: parent(a)\n        Integer Ring\n        sage: b = 42/1\n        sage: parent(b)\n        Rational Field\n        sage: c = 42.0\n        sage: parent(c)\n        Real Field with 53 bits of precision\n\n    Some more complicated examples::\n\n        sage: x = Partition([3,2,1,1,1])\n        sage: parent(x)\n        Partitions\n        sage: v = vector(RDF, [1,2,3])\n        sage: parent(v)\n        Vector space of dimension 3 over Real Double Field\n\n    The following are not considered to be elements, so the type is\n    returned::\n\n        sage: d = int(42)  # Python int\n        sage: parent(d)\n        <... 'int'>\n        sage: L = list(range(10))\n        sage: parent(L)\n        <... 'list'>\n    ";
[sagelib-8.2.beta4]              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-8.2.beta4] error: command 'gcc' failed with exit status 1
```


I don't know why `sage/combinat/partitions` needs to redefine `isinf(double)` - it is something about C++ vs plain C?


---

Comment by jdemeyer created at 2018-02-02 09:21:03

Replying to [comment:42 dimpase]:
> I did `export ABI=64`.

I'm sure if that actually changes anything for GCC. In any case, it doesn't help for building GCC in Sage.


---

Comment by dimpase created at 2018-02-02 09:38:36

trying now the obvious

```
diff --git a/src/sage/combinat/partitions_c.h b/src/sage/combinat/partitions_c.h
index e82ac77..7bc7398 100644
--- a/src/sage/combinat/partitions_c.h
+++ b/src/sage/combinat/partitions_c.h
`@``@` -1,8 +1,3 `@``@`
-#if defined(__sun)
-#include <ieeefp.h>
-int isinf(double x) { return !finite(x) && x==x; }
-#endif
-
 #include <gmp.h>
 
 int part(mpz_t answer, unsigned int n);
```


which is undoing true vintage stuff: commit 29fd8e9662c (Michael Abshoff 2008-01-29...)


---

Comment by dimpase created at 2018-02-02 09:46:06

I will inspect the whole commit 29fd8e9662c - there is quite a bit of Sun-only funky stuff...


---

Comment by dimpase created at 2018-02-02 10:20:57

Replying to [comment:46 dimpase]:
> I will inspect the whole commit 29fd8e9662c - there is quite a bit of Sun-only funky stuff...

I've opened #24642 for this.


---

Comment by dimpase created at 2018-02-02 11:31:04

My build has completed, but `./sage` crashes on startup. Undertaking more cleaning of `_sun` stuff, perhaps it helps.


---

Comment by dimpase created at 2018-02-02 11:39:37

OK, it's merely 

```
ImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory
```

Opened #24643 to deal with it.


---

Comment by drkirkby created at 2018-02-02 14:38:03

Do recent Sage's work on any Solaris platform? I know at one point it worked on Solaris 10 (SPARC) and passed all doc tests as a 32-bit application, but whilst I managed to build a 64-bit version, it was **very** unstable. I believe later version of Sage were not tested on Solaris, and I found it would not build. 

I recently installed the latest Solaris 10 on a Sun Blade 2000 (SPARC), but can't install Solaris 11 on there, as the CPU is too old. I also have OpenSolaris (sort of Solaris 11) on an x86 box. 

**If I can be any assistance I will be, but I don't have access to any Solaris 11 SPARC box.**

I am guessing that this T4 box will be like the old t2.math, which was very slow on Sage. The T2, T3 and T4 CPUs are not designed for this application. Apparently they work very well on busy webservers and databases, but if only one thread is in use most of the time, they are not going to work well. 

I don't think enough people see the benefit of having software compile on several platforms. Often bugs show up on one platform that don't on another, but may bite on that other platform in the future. 

Dave


---

Comment by jdemeyer created at 2018-02-02 15:13:47

Replying to [comment:50 drkirkby]:
> I don't think enough people see the benefit of having software compile on several platforms.

My opinion is that compiling software on "exotic" platforms helps portability in general. So it's not wasted effort.


---

Comment by dimpase created at 2018-02-02 19:51:06

Replying to [comment:50 drkirkby]:
> Do recent Sage's work on any Solaris platform? I know at one point it worked on Solaris 10 (SPARC) and passed all doc tests as a 32-bit application, but whilst I managed to build a 64-bit version, it was **very** unstable. I believe later version of Sage were not tested on Solaris, and I found it would not build. 

For years we did not have access to a well-working Solaris box, and so the port bitrotted quite a bit.
> 
> I recently installed the latest Solaris 10 on a Sun Blade 2000 (SPARC), but can't install Solaris 11 on there, as the CPU is too old. I also have OpenSolaris (sort of Solaris 11) on an x86 box. 
> 
> **If I can be any assistance I will be, but I don't have access to any Solaris 11 SPARC box.**
> 

I believe that with recent [openCSW](https://www.opencsw.org/manual/for-administrators/getting-started.html) you basically get the same tools for Solaris 11 and 10, 
so it should not matter too much whether it's 10 or 11. (YMMV, naturally).

One can get gcc 5.4 and all the g-stuff (gtar, gawk, etc), so nothing needs to be built manually.
Give it a try once we have this ticket in a reasonable shape.

At the moment I get working Sage (with all this slew of tickets we opened here, and patches there), but building some bits of documentation (3d plots built with tachyon) fails.


> I am guessing that this T4 box will be like the old t2.math, which was very slow on Sage. The T2, T3 and T4 CPUs are not designed for this application. Apparently they work very well on busy webservers and databases, but if only one thread is in use most of the time, they are not going to work well. 
> 
T4 is not too slow, it seems.


---

Comment by dimpase created at 2018-02-03 14:30:31

The next problem is with plotting (docs won't build due to errors in matplotlib).
As #23696 is imminent, I don't want to look at errors with matplotlib 1.5.
The first problem is in subprocess32: #24650 (ought to be fixed upstream)


---

Comment by dimpase created at 2018-02-03 20:11:47

pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used), e.g.

```
sage -t src/sage/interfaces/singular.py  # 172 doctests failed
```

see #24651 for full details and traces. Here is a typical error:

```
sage: t=singular(0)
---------------------------------------------------------------------------
IOError                                   Traceback (most recent call last)
...
IOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.
sage:  
```



---

Comment by dimpase created at 2018-02-05 10:13:48

Are you sure it's a good idea not to pass `-D_XPG6` to g++, too?


---

Comment by jdemeyer created at 2018-02-05 10:35:40

Replying to [comment:57 dimpase]:
> Are you sure it's a good idea not to pass `-D_XPG6` to g++, too?

It seems in particular needed to compile C99 code. But I guess it doesn't hurt to add it to `CXXFLAGS`.


---

Comment by git created at 2018-02-06 11:46:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2018-02-07 06:37:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-02-11 10:09:59

testing:

```
sage -t src/sage/plot/plot3d/list_plot3d.py  # 1 doctest failed
sage -t src/sage/plot/plot3d/base.pyx  # Killed due to bus error
sage -t src/sage/modular/abvar/abvar.py  # Timed out
sage -t src/sage/modular/abvar/lseries.py  # Timed out
sage -t src/sage/modular/modform/element.py  # Timed out
sage -t src/sage/modular/modform_hecketriangle/element.py  # Timed out
sage -t src/sage/modular/modform_hecketriangle/readme.py  # Timed out
sage -t src/sage/schemes/elliptic_curves/ell_point.py  # 1 doctest failed
sage -t src/sage/functions/wigner.py  # 1 doctest failed
sage -t src/sage/rings/bernmm.pyx  # 2 doctests failed
sage -t src/sage/rings/number_field/number_field.py  # Timed out
sage -t src/sage/rings/padics/padic_extension_leaves.py  # Timed out
sage -t src/sage/geometry/riemannian_manifolds/surface3d_generators.py  # 1 doctest failed
sage -t src/sage/misc/cython.py  # 1 doctest failed
sage -t src/sage/misc/compat.py  # 1 doctest failed
sage -t src/sage/tests/parigp.py  # Timed out
sage -t src/sage/tests/cmdline.py  # 1 doctest failed
sage -t src/sage/lfunctions/dokchitser.py  # Timed out
sage -t src/sage/graphs/generators/smallgraphs.py  # 1 doctest failed
sage -t src/sage/repl/image.py  # Killed due to bus error
sage -t src/sage/matrix/matrix2.pyx  # Killed due to bus error
sage -t src/sage/dynamics/complex_dynamics/mandel_julia.py  # Killed due to bus error
sage -t src/sage/dynamics/complex_dynamics/mandel_julia_helper.pyx  # Killed due to bus error
sage -t src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/l_series.rst  # Timed out
```


here is the log for failing tests:
http://users.ox.ac.uk/~coml0531/tmp/test5.log


---

Comment by dimpase created at 2018-02-17 22:12:56

see #24765 for a GAP problem.


---

Comment by mkoeppe created at 2020-03-22 15:52:43

Do "we" have still access to the system? Can it be configured as a self-hosted runner for [GitHub](GitHub) actions? https://help.github.com/en/actions/hosting-your-own-runners


---

Comment by dimpase created at 2020-03-26 02:40:23

no access since last year, no reply from the sysadmin.
I can offer an OpenBSD box as a replacement :-)


---

Comment by mkoeppe created at 2020-07-08 16:51:35

Outdated, should be closed


---

Comment by mkoeppe created at 2020-07-08 16:51:35

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-07-09 13:35:21

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-08-14 12:54:34

Resolution: invalid
