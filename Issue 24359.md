# Issue 24359: port Sage to SPARC Solaris 11

archive/issues_024359.json:
```json
{
    "body": "CC:  @dimpase\n\nwith access to SPARC T4 system, this looks not too hard.\n\nWe track here the resulting issues and tickets.\n\n* no need to pre-build any tools, apparently. Everything is available via Solaris `pkg` or `pkgutil` (i.e. opencsw). \n\n* MPFR configure fails with MPIR. Can be resolved quickly by a patch, see MPIR [issue 242](https://github.com/wbhart/mpir/issues/242).\n\n* python2/3 building needs `CFLAGS=\"-D_XPG6\"`\n\n* tuning of `gf2x` fails, set `SAGE_TUNE_GF2X=no`\n\n* to take care of the above, `.` the following before building\n\n```\nexport ABI=64\nexport SAGE64=yes\nexport CFLAGS=\"-D_XPG6\"\nexport SAGE_TUNE_GF2X=no\nexport PATH=/opt/csw/gnu:/usr/sfw/bin:$PATH\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24596\n\n",
    "created_at": "2018-01-26T14:59:02Z",
    "labels": [
        "porting: Solaris",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "port Sage to SPARC Solaris 11",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24359",
    "user": "@dimpase"
}
```
CC:  @dimpase

with access to SPARC T4 system, this looks not too hard.

We track here the resulting issues and tickets.

* no need to pre-build any tools, apparently. Everything is available via Solaris `pkg` or `pkgutil` (i.e. opencsw). 

* MPFR configure fails with MPIR. Can be resolved quickly by a patch, see MPIR [issue 242](https://github.com/wbhart/mpir/issues/242).

* python2/3 building needs `CFLAGS="-D_XPG6"`

* tuning of `gf2x` fails, set `SAGE_TUNE_GF2X=no`

* to take care of the above, `.` the following before building

```
export ABI=64
export SAGE64=yes
export CFLAGS="-D_XPG6"
export SAGE_TUNE_GF2X=no
export PATH=/opt/csw/gnu:/usr/sfw/bin:$PATH
```


Issue created by migration from https://trac.sagemath.org/ticket/24596





---

archive/issue_comments_341293.json:
```json
{
    "body": "I've managed to build `gcc 7.2.0` from source configuring as follows:\n\n```\n./configure --prefix=/datapool/dima --with-gmp-include=/usr/include/gmp --with-mpfr-include=/usr/include/mpfr --with-mpc=/usr --without-gnu-ld --with-ld=/usr/bin/ld --with-gnu-as --enable-languages=c,c++,fortran  --enable-shared --enable-initfini-array  --with-system-zlib  --with-as=/usr/gnu/bin/as --build=sparcv9-sun-solaris2.11\n```\n\nusing system-provided gmp, mpfr, and mpc.\nBuilding it in Sage did not work, it failed in building gfrortan with some obscure MPFR-related linking error.",
    "created_at": "2018-01-28T18:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341293",
    "user": "@dimpase"
}
```

I've managed to build `gcc 7.2.0` from source configuring as follows:

```
./configure --prefix=/datapool/dima --with-gmp-include=/usr/include/gmp --with-mpfr-include=/usr/include/mpfr --with-mpc=/usr --without-gnu-ld --with-ld=/usr/bin/ld --with-gnu-as --enable-languages=c,c++,fortran  --enable-shared --enable-initfini-array  --with-system-zlib  --with-as=/usr/gnu/bin/as --build=sparcv9-sun-solaris2.11
```

using system-provided gmp, mpfr, and mpc.
Building it in Sage did not work, it failed in building gfrortan with some obscure MPFR-related linking error.



---

archive/issue_comments_341294.json:
```json
{
    "body": "Lots of issues mentioned in the ticket description do not have a ticket yet. Should I create tickets for each?",
    "created_at": "2018-01-29T17:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341294",
    "user": "@jdemeyer"
}
```

Lots of issues mentioned in the ticket description do not have a ticket yet. Should I create tickets for each?



---

archive/issue_comments_341295.json:
```json
{
    "body": "One more issue is just reported here: http://www.singular.uni-kl.de:8002/trac/ticket/816\n\nSingular uses specific -Wl linker syntax in libpolys/polys/Makefile.am\nwhich nukes linking (as Solaris linker does not accept `dynamic_lookup` parameter).\n(By right, it's autotools that should generate such platform-specific arguments, it's asking for trouble to give them explicitly).\n\nFeel free to open as many tickets as needed- making sure that we don't duplicate each other.",
    "created_at": "2018-01-29T17:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341295",
    "user": "@dimpase"
}
```

One more issue is just reported here: http://www.singular.uni-kl.de:8002/trac/ticket/816

Singular uses specific -Wl linker syntax in libpolys/polys/Makefile.am
which nukes linking (as Solaris linker does not accept `dynamic_lookup` parameter).
(By right, it's autotools that should generate such platform-specific arguments, it's asking for trouble to give them explicitly).

Feel free to open as many tickets as needed- making sure that we don't duplicate each other.



---

archive/issue_comments_341296.json:
```json
{
    "body": "Opened #24611 to deal with Singular linking problems",
    "created_at": "2018-01-29T23:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341296",
    "user": "@dimpase"
}
```

Opened #24611 to deal with Singular linking problems



---

archive/issue_comments_341297.json:
```json
{
    "body": "the next snag is R, a bus error during installation of 'tools' package:\n\n```\n...\ngcc -shared -L../../../../lib -m64 -L/datapool/dima/Sage/sagetrac-mirror/local/lib -Wl,-rpath,/datapool/dima/Sage/sagetrac-mirror/local/lib -o tools.so text.o init.o Rmd5.o md5.o signals.o install.o getfmts.o http.o gramLatex.o gramRd.o -L../../../../lib -lR\nmake[9]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools/src'\nmkdir -p -- ../../../../library/tools/libs\n/src'\nmake[7]: Leaving directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'\nmake[7]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'\ninstalling 'sysdata.rda'\nmake[7]: Leaving directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'\n\n *** caught bus error ***\naddress 101556b6c, cause 'invalid alignment'\n\nTraceback:\n 1: strsplit(x, \"\\n[ \\t\\n]*\\n\", perl = TRUE)\n 2: is.vector(X)\n 3: lapply(strsplit(x, \"\\n[ \\t\\n]*\\n\", perl = TRUE), strsplit, \"[ \\t\\n]\",     perl = TRUE)\n 4: strwrap(paste0(x, \": \", y), exdent = indent, width = width, simplify = FALSE)\n 5: formatDL(rep.int(tag, length(val)), val, style = \"list\", width = width,     indent = indent)\n 6: fmt(nmx[j], xj[i], foldable[j])\n 7: write.dcf(rbind(x), dfile, keep.white = c(.keep_white_description_fields,     \"Maintainer\", \"BugReports\"))\n 8: .write_description(db, file.path(outDir, \"DESCRIPTION\"))\n 9: tools:::.install_package_description(\".\", \"../../../library/tools\")\nAn irrecoverable exception occurred. R is aborting now ...\n/bin/sh: 13985: Bus error(coredump)\nmake[6]: *** [Makefile:36: all] Bus Error\n```\n",
    "created_at": "2018-01-30T11:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341297",
    "user": "@dimpase"
}
```

the next snag is R, a bus error during installation of 'tools' package:

```
...
gcc -shared -L../../../../lib -m64 -L/datapool/dima/Sage/sagetrac-mirror/local/lib -Wl,-rpath,/datapool/dima/Sage/sagetrac-mirror/local/lib -o tools.so text.o init.o Rmd5.o md5.o signals.o install.o getfmts.o http.o gramLatex.o gramRd.o -L../../../../lib -lR
make[9]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools/src'
mkdir -p -- ../../../../library/tools/libs
/src'
make[7]: Leaving directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'
make[7]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'
installing 'sysdata.rda'
make[7]: Leaving directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/r-3.4.3/src/src/library/tools'

 *** caught bus error ***
address 101556b6c, cause 'invalid alignment'

Traceback:
 1: strsplit(x, "\n[ \t\n]*\n", perl = TRUE)
 2: is.vector(X)
 3: lapply(strsplit(x, "\n[ \t\n]*\n", perl = TRUE), strsplit, "[ \t\n]",     perl = TRUE)
 4: strwrap(paste0(x, ": ", y), exdent = indent, width = width, simplify = FALSE)
 5: formatDL(rep.int(tag, length(val)), val, style = "list", width = width,     indent = indent)
 6: fmt(nmx[j], xj[i], foldable[j])
 7: write.dcf(rbind(x), dfile, keep.white = c(.keep_white_description_fields,     "Maintainer", "BugReports"))
 8: .write_description(db, file.path(outDir, "DESCRIPTION"))
 9: tools:::.install_package_description(".", "../../../library/tools")
An irrecoverable exception occurred. R is aborting now ...
/bin/sh: 13985: Bus error(coredump)
make[6]: *** [Makefile:36: all] Bus Error
```




---

archive/issue_comments_341298.json:
```json
{
    "body": "The complete log of R installation is here. http://users.ox.ac.uk/~coml0531/tmp/r-343-solaris11.log\n\nI suppose this is a compiler bug (with gcc 7.2.0). I'll try different gcc versions.",
    "created_at": "2018-01-30T11:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341298",
    "user": "@dimpase"
}
```

The complete log of R installation is here. http://users.ox.ac.uk/~coml0531/tmp/r-343-solaris11.log

I suppose this is a compiler bug (with gcc 7.2.0). I'll try different gcc versions.



---

archive/issue_comments_341299.json:
```json
{
    "body": "To avoid the MPIR trouble, I'm trying `./configure --with-mp=gmp`.",
    "created_at": "2018-01-30T14:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341299",
    "user": "@jdemeyer"
}
```

To avoid the MPIR trouble, I'm trying `./configure --with-mp=gmp`.



---

archive/issue_comments_341300.json:
```json
{
    "body": "Replying to [comment:14 dimpase]:\n> The complete log of R installation is here. http://users.ox.ac.uk/~coml0531/tmp/r-343-solaris11.log\n> \n> I suppose this is a compiler bug (with gcc 7.2.0). I'll try different gcc versions.\nSame error with gcc 7.3.0. Will try gcc 5.4 now.",
    "created_at": "2018-01-30T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341300",
    "user": "@dimpase"
}
```

Replying to [comment:14 dimpase]:
> The complete log of R installation is here. http://users.ox.ac.uk/~coml0531/tmp/r-343-solaris11.log
> 
> I suppose this is a compiler bug (with gcc 7.2.0). I'll try different gcc versions.
Same error with gcc 7.3.0. Will try gcc 5.4 now.



---

archive/issue_comments_341301.json:
```json
{
    "body": "the problem of R is in pcre (that's where it crashes), and pcre fails its self-tests:\n\n```\n[pcre-8.40.p1] make[5]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/pcre-8.40.p1/src'\n[pcre-8.40.p1] PASS: pcre_stringpiece_unittest\n[pcre-8.40.p1] PASS: pcre_scanner_unittest\n[pcre-8.40.p1] PASS: pcrecpp_unittest\n[pcre-8.40.p1] ./test-driver: line 107: 25794 Bus Error               (core dumped) \"$@\" > $log_file 2>&1\n[pcre-8.40.p1] FAIL: pcre_jit_test\n[pcre-8.40.p1] FAIL: RunTest\n[pcre-8.40.p1] FAIL: RunGrepTest\n[pcre-8.40.p1] ============================================================================\n[pcre-8.40.p1] Testsuite summary for PCRE 8.40\n[pcre-8.40.p1] ============================================================================\n[pcre-8.40.p1] # TOTAL: 6\n[pcre-8.40.p1] # PASS:  3\n[pcre-8.40.p1] # SKIP:  0\n[pcre-8.40.p1] # XFAIL: 0\n[pcre-8.40.p1] # FAIL:  3\n[pcre-8.40.p1] # XPASS: 0\n[pcre-8.40.p1] # ERROR: 0\n```\n\n----\nNew commits:",
    "created_at": "2018-01-31T01:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341301",
    "user": "@dimpase"
}
```

the problem of R is in pcre (that's where it crashes), and pcre fails its self-tests:

```
[pcre-8.40.p1] make[5]: Entering directory '/datapool/dima/Sage/sagetrac-mirror/local/var/tmp/sage/build/pcre-8.40.p1/src'
[pcre-8.40.p1] PASS: pcre_stringpiece_unittest
[pcre-8.40.p1] PASS: pcre_scanner_unittest
[pcre-8.40.p1] PASS: pcrecpp_unittest
[pcre-8.40.p1] ./test-driver: line 107: 25794 Bus Error               (core dumped) "$@" > $log_file 2>&1
[pcre-8.40.p1] FAIL: pcre_jit_test
[pcre-8.40.p1] FAIL: RunTest
[pcre-8.40.p1] FAIL: RunGrepTest
[pcre-8.40.p1] ============================================================================
[pcre-8.40.p1] Testsuite summary for PCRE 8.40
[pcre-8.40.p1] ============================================================================
[pcre-8.40.p1] # TOTAL: 6
[pcre-8.40.p1] # PASS:  3
[pcre-8.40.p1] # SKIP:  0
[pcre-8.40.p1] # XFAIL: 0
[pcre-8.40.p1] # FAIL:  3
[pcre-8.40.p1] # XPASS: 0
[pcre-8.40.p1] # ERROR: 0
```

----
New commits:



---

archive/issue_comments_341302.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-31T06:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341302",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_341303.json:
```json
{
    "body": "Replying to [ticket:24596 dimpase]:\n> * gcc 7.2 builds glpk and fplll, whereas gcc 5.4 cannot do it.\n\nI had no problems to build GLPK with GCC 5.4.0.",
    "created_at": "2018-01-31T06:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341303",
    "user": "@jdemeyer"
}
```

Replying to [ticket:24596 dimpase]:
> * gcc 7.2 builds glpk and fplll, whereas gcc 5.4 cannot do it.

I had no problems to build GLPK with GCC 5.4.0.



---

archive/issue_comments_341304.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-31T09:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341304",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_341305.json:
```json
{
    "body": "By the way, I can't reproduce any problems with gf2x tuning.",
    "created_at": "2018-01-31T10:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341305",
    "user": "@jdemeyer"
}
```

By the way, I can't reproduce any problems with gf2x tuning.



---

archive/issue_comments_341306.json:
```json
{
    "body": "By the way, I think that it *should* be possible to build openblas. I don't see any fundamental obstructions.",
    "created_at": "2018-01-31T12:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341306",
    "user": "@jdemeyer"
}
```

By the way, I think that it *should* be possible to build openblas. I don't see any fundamental obstructions.



---

archive/issue_comments_341307.json:
```json
{
    "body": "Replying to [comment:30 jdemeyer]:\n> By the way, I think that it *should* be possible to build openblas. I don't see any fundamental obstructions.\n\nI think that openblas for non-x86* architectures does not exist.",
    "created_at": "2018-01-31T12:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341307",
    "user": "@dimpase"
}
```

Replying to [comment:30 jdemeyer]:
> By the way, I think that it *should* be possible to build openblas. I don't see any fundamental obstructions.

I think that openblas for non-x86* architectures does not exist.



---

archive/issue_comments_341308.json:
```json
{
    "body": "Replying to [comment:31 dimpase]:\n> I think that openblas for non-x86* architectures does not exist.\n\nI am challenging your hypotheses:\n\n```\nInstall OK!\nmake[3]: Leaving directory '/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/src'\nmake[2]: Leaving directory '/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/src'\nWrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/blas.pc\nWrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/cblas.pc\nWrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/lapack.pc\n\nreal    55m45.102s\nuser    99m54.598s\nsys     35m15.907s\nCopying package files from temporary location /datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/inst to /datapool/jeroen/sage-openblas/local\nSuccessfully installed openblas-0.2.20.p1\nDeleting temporary build directory\n/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1\nFinished installing openblas-0.2.20.p1.spkg\n```\n",
    "created_at": "2018-01-31T15:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341308",
    "user": "@jdemeyer"
}
```

Replying to [comment:31 dimpase]:
> I think that openblas for non-x86* architectures does not exist.

I am challenging your hypotheses:

```
Install OK!
make[3]: Leaving directory '/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/src'
make[2]: Leaving directory '/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/src'
Wrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/blas.pc
Wrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/cblas.pc
Wrote /datapool/jeroen/sage-openblas/local/lib/pkgconfig/lapack.pc

real    55m45.102s
user    99m54.598s
sys     35m15.907s
Copying package files from temporary location /datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1/inst to /datapool/jeroen/sage-openblas/local
Successfully installed openblas-0.2.20.p1
Deleting temporary build directory
/datapool/jeroen/sage-openblas/local/var/tmp/sage/build/openblas-0.2.20.p1
Finished installing openblas-0.2.20.p1.spkg
```




---

archive/issue_comments_341309.json:
```json
{
    "body": "Replying to [comment:21 dimpase]:\n> the problem of R is in pcre (that's where it crashes),\n\ntrying to build R with system's pcre (remove the dependence on pcre from R, and remove pcre stuff from SAGEROOT/local/[bin,lib])\ngets me past this ugly segfault.\n\nStuck later in some linking error, which should be manageable\n(need to rebuild with -j1 for a meaningful log).",
    "created_at": "2018-02-01T01:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341309",
    "user": "@dimpase"
}
```

Replying to [comment:21 dimpase]:
> the problem of R is in pcre (that's where it crashes),

trying to build R with system's pcre (remove the dependence on pcre from R, and remove pcre stuff from SAGEROOT/local/[bin,lib])
gets me past this ugly segfault.

Stuck later in some linking error, which should be manageable
(need to rebuild with -j1 for a meaningful log).



---

archive/issue_comments_341310.json:
```json
{
    "body": "Replying to [comment:33 dimpase]:\n> Replying to [comment:21 dimpase]:\n> > the problem of R is in pcre (that's where it crashes),\n> \n> trying to build R with system's pcre (remove the dependence on pcre from R, and remove pcre stuff from SAGEROOT/local/[bin,lib])\n> gets me past this ugly segfault.\n> \n> Stuck later in some linking error, which should be manageable\n> (need to rebuild with -j1 for a meaningful log).\n \ndeal with pcre here: #24628",
    "created_at": "2018-02-01T01:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341310",
    "user": "@dimpase"
}
```

Replying to [comment:33 dimpase]:
> Replying to [comment:21 dimpase]:
> > the problem of R is in pcre (that's where it crashes),
> 
> trying to build R with system's pcre (remove the dependence on pcre from R, and remove pcre stuff from SAGEROOT/local/[bin,lib])
> gets me past this ugly segfault.
> 
> Stuck later in some linking error, which should be manageable
> (need to rebuild with -j1 for a meaningful log).
 
deal with pcre here: #24628



---

archive/issue_comments_341311.json:
```json
{
    "body": "deal with R on #24629",
    "created_at": "2018-02-01T01:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341311",
    "user": "@dimpase"
}
```

deal with R on #24629



---

archive/issue_comments_341312.json:
```json
{
    "body": "By the way, how did you manage to build GCC? I have tried with several variations on `CFLAGS` and `CC` but I never managed to have a successful build of GCC.",
    "created_at": "2018-02-01T05:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341312",
    "user": "@jdemeyer"
}
```

By the way, how did you manage to build GCC? I have tried with several variations on `CFLAGS` and `CC` but I never managed to have a successful build of GCC.



---

archive/issue_comments_341313.json:
```json
{
    "body": "Replying to [comment:36 jdemeyer]:\n> By the way, how did you manage to build GCC? I have tried with several variations on `CFLAGS` and `CC` but I never managed to have a successful build of GCC.\n\nI managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed. This is what I did to build\ngcc 7.2 in /datapool/dima/bin\n\n```\n./configure --prefix=/datapool/dima --with-gmp-include=/usr/include/gmp --with-mpfr-include=/usr/include/mpfr --with-mpc=/usr --without-gnu-ld --with-ld=/usr/bin/ld --with-gnu-as --enable-languages=c,c++,fortran  --enable-shared --enable-initfini-array  --with-system-zlib  --with-as=/usr/gnu/bin/as --build=sparcv9-sun-solaris2.11\n```\n\nYou need to make sure that Solaris `ld` is 1st in the PATH (I have a dedicated directory `/datapool/dima/tools` with a link to /usr/bin/ld which is 1st in my PATH), and also I used the same\nflags as for building Sage:\n\n```\nCFLAGS=-D_XPG6\nPATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin\n```\n\nProbably if I tried harder it would also have worked with Sage's gcc - we don't set `--build=`, do we?\n\nTo use gfortran built there one needs \n\n```\nexport LD_LIBRARY_PATH=/datapool/dima/lib/sparcv9\n```\n\n(perhaps there is a better way)",
    "created_at": "2018-02-01T09:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341313",
    "user": "@dimpase"
}
```

Replying to [comment:36 jdemeyer]:
> By the way, how did you manage to build GCC? I have tried with several variations on `CFLAGS` and `CC` but I never managed to have a successful build of GCC.

I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed. This is what I did to build
gcc 7.2 in /datapool/dima/bin

```
./configure --prefix=/datapool/dima --with-gmp-include=/usr/include/gmp --with-mpfr-include=/usr/include/mpfr --with-mpc=/usr --without-gnu-ld --with-ld=/usr/bin/ld --with-gnu-as --enable-languages=c,c++,fortran  --enable-shared --enable-initfini-array  --with-system-zlib  --with-as=/usr/gnu/bin/as --build=sparcv9-sun-solaris2.11
```

You need to make sure that Solaris `ld` is 1st in the PATH (I have a dedicated directory `/datapool/dima/tools` with a link to /usr/bin/ld which is 1st in my PATH), and also I used the same
flags as for building Sage:

```
CFLAGS=-D_XPG6
PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin
```

Probably if I tried harder it would also have worked with Sage's gcc - we don't set `--build=`, do we?

To use gfortran built there one needs 

```
export LD_LIBRARY_PATH=/datapool/dima/lib/sparcv9
```

(perhaps there is a better way)



---

archive/issue_comments_341314.json:
```json
{
    "body": "Replying to [comment:38 dimpase]:\n> I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed.\n\nSo, it's a GCC build *outside* of Sage. I was simply trying to build with `SAGE_INSTALL_GCC=yes`.\n\n> also I used the same\n> flags as for building Sage:\n> {{{\n> CFLAGS=-D_XPG6\n> PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin\n> }}}\n\nSo no `-m64` to build GCC?",
    "created_at": "2018-02-01T11:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341314",
    "user": "@jdemeyer"
}
```

Replying to [comment:38 dimpase]:
> I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed.

So, it's a GCC build *outside* of Sage. I was simply trying to build with `SAGE_INSTALL_GCC=yes`.

> also I used the same
> flags as for building Sage:
> {{{
> CFLAGS=-D_XPG6
> PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin
> }}}

So no `-m64` to build GCC?



---

archive/issue_comments_341315.json:
```json
{
    "body": "Replying to [comment:39 jdemeyer]:\n> Replying to [comment:38 dimpase]:\n> > I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed.\n> \n> So, it's a GCC build *outside* of Sage. I was simply trying to build with `SAGE_INSTALL_GCC=yes`.\n\nThis did not work for me either, I merely wanted to see whether it's an internal Sage issue, or a bigger problem. (So yes, it's a Sage internal issue, not sure we must fix it no matter what; after all, the system's gcc 5.4.0 appears to be doing the job just as well.)\n\n> \n> > also I used the same\n> > flags as for building Sage:\n> > {{{\n> > CFLAGS=-D_XPG6\n> > PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin\n> > }}}\n> \n> So no `-m64` to build GCC?\n\nI did `export ABI=64`. I ended up with 64-bit results. It might be managed by `--build`, perhaps. However, I suppose one ends up with tools capable of building 64- and 32-bit programs. In $PREFIX/lib/ it has installed a bunch of 32-bit ELFs, and in \n$PREFIX/lib/sparcv9/ 64-bit ELFs.",
    "created_at": "2018-02-01T12:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341315",
    "user": "@dimpase"
}
```

Replying to [comment:39 jdemeyer]:
> Replying to [comment:38 dimpase]:
> > I managed it with the system GMP, MPFR, and MPC, which have non-standard header locations (thus lots of these flags). Also, `--build=` is needed.
> 
> So, it's a GCC build *outside* of Sage. I was simply trying to build with `SAGE_INSTALL_GCC=yes`.

This did not work for me either, I merely wanted to see whether it's an internal Sage issue, or a bigger problem. (So yes, it's a Sage internal issue, not sure we must fix it no matter what; after all, the system's gcc 5.4.0 appears to be doing the job just as well.)

> 
> > also I used the same
> > flags as for building Sage:
> > {{{
> > CFLAGS=-D_XPG6
> > PATH=/datapool/dima/tools:/opt/csw/gnu:/opt/csw/bin:/usr/sfw/bin:/usr/bin:/usr/sbin
> > }}}
> 
> So no `-m64` to build GCC?

I did `export ABI=64`. I ended up with 64-bit results. It might be managed by `--build`, perhaps. However, I suppose one ends up with tools capable of building 64- and 32-bit programs. In $PREFIX/lib/ it has installed a bunch of 32-bit ELFs, and in 
$PREFIX/lib/sparcv9/ 64-bit ELFs.



---

archive/issue_comments_341316.json:
```json
{
    "body": "With all the fixes we got, my build went to an error about conflicting headers while building sagelib:\n\n```\n[sagelib-8.2.beta4] [ 26/430] creating build/temp.solaris-2.11-sun4v.64bit-2.7/build/cythonized/sage/data_structures\n[sagelib-8.2.beta4] gcc -DNDEBUG -g -O3 -Wall -D_XPG6 -fPIC -I/datapool/dima/Sage/sagetrac-mirror/local/include -I/datapool/dima/Sage/sagetrac-mirror/local/inc\nlude/python2.7 -I/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/numpy/core/include -I/datapool/dima/Sage/sagetrac-mirror/src -I/datapool\n/dima/Sage/sagetrac-mirror/src/sage/ext -Ibuild/cythonized -I/datapool/dima/Sage/sagetrac-mirror/local/include/python2.7 -c build/cythonized/sage/data_structur\nes/binary_search.c -o build/temp.solaris-2.11-sun4v.64bit-2.7/build/cythonized/sage/data_structures/binary_search.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRAC\nEBACK=1 -std=c99\n[sagelib-8.2.beta4] In file included from build/cythonized/sage/combinat/partitions.cpp:597:0:\n[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions_c.h: In function \u2018int isinf(double)\u2019:\n[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions_c.h:3:19: error: \u2018int isinf(double)\u2019 conflicts with a previous declaration\n[sagelib-8.2.beta4]  int isinf(double x) { return !finite(x) && x==x; }\n[sagelib-8.2.beta4]                    ^\n[sagelib-8.2.beta4] In file included from /datapool/dima/lib/gcc/sparcv9-sun-solaris2.11/7.2.0/include-fixed/math.h:25:0,\n[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/bits/std_abs.h:40,\n[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/cstdlib:77,\n[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/stdlib.h:36,\n[sagelib-8.2.beta4]                  from ../local/include/python2.7/Python.h:42,\n[sagelib-8.2.beta4]                  from build/cythonized/sage/combinat/partitions.cpp:58:\n[sagelib-8.2.beta4] /usr/include/iso/math_c99.h:711:14: note: previous declaration \u2018bool std::isinf(double)\u2019\n[sagelib-8.2.beta4]   inline bool isinf(double __X) { return __builtin_isinf(__X); }\n[sagelib-8.2.beta4]               ^~~~~\n[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp: At global scope:\n[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4778:18: warning: \u2018PyObject* __pyx_pw_4sage_9structure_7element_3have_same_parent(PyObject*, \nPyObject*, PyObject*)\u2019 defined but not used [-Wunused-function]\n[sagelib-8.2.beta4]  static PyObject *__pyx_pw_4sage_9structure_7element_3have_same_parent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {\n[sagelib-8.2.beta4]                   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4777:13: warning: \u2018__pyx_doc_4sage_9structure_7element_2have_same_parent\u2019 defined but not use\nd [-Wunused-variable]\n[sagelib-8.2.beta4]  static char __pyx_doc_4sage_9structure_7element_2have_same_parent[] = \"have_same_parent(left, right) -> bool\\nFile: sage/structure/element\n.pxd (starting at line 112)\\n\\n    Return ``True`` if and only if ``left`` and ``right`` have the\\n    same parent.\\n\\n    .. WARNING::\\n\\n        This functio\nn assumes that at least one of the arguments is a\\n        Sage :class:`Element`. When in doubt, use the slower\\n        ``parent(left) is parent(right)`` inst\nead.\\n\\n    EXAMPLES::\\n\\n        sage: from sage.structure.element import have_same_parent\\n        sage: have_same_parent(1, 3)\\n        True\\n        sage: \nhave_same_parent(1, 1/2)\\n        False\\n        sage: have_same_parent(gap(1), gap(1/2))\\n        True\\n\\n    These have different types but the same parent::\n\\n\\n        sage: a = RLF(2)\\n        sage: b = exp(a)\\n        sage: type(a)\\n        <... 'sage.rings.real_lazy.LazyWrapper'>\\n        sage: type(b)\\n       \n <... 'sage.rings.real_lazy.LazyNamedUnop'>\\n        sage: have_same_parent(a, b)\\n        True\\n    \";\n[sagelib-8.2.beta4]              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4436:18: warning: \u2018PyObject* __pyx_pw_4sage_9structure_7element_1parent(PyObject*, PyObject*)\u2019 defined but not used [-Wunused-function]\n[sagelib-8.2.beta4]  static PyObject *__pyx_pw_4sage_9structure_7element_1parent(PyObject *__pyx_self, PyObject *__pyx_v_x) {\n[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4435:13: warning: \u2018__pyx_doc_4sage_9structure_7element_parent\u2019 defined but not used [-Wunused-variable]\n[sagelib-8.2.beta4]  static char __pyx_doc_4sage_9structure_7element_parent[] = \"parent(x)\\nFile: sage/structure/element.pxd (starting at line 7)\\n\\n    Return the parent of the element ``x``.\\n\\n    Usually, this means the mathematical object of which ``x`` is an\\n    element.\\n\\n    INPUT:\\n\\n    - ``x`` -- an element\\n\\n    OUTPUT:\\n\\n    - If ``x`` is a Sage :class:`Element`, return ``x.parent()``.\\n\\n    - Otherwise, return ``type(x)``.\\n\\n    .. SEEALSO::\\n\\n        `Parents, Conversion and Coercion <http://doc.sagemath.org/html/en/tutorial/tour_coercion.html>`_\\n        Section in the Sage Tutorial\\n\\n    EXAMPLES::\\n\\n        sage: a = 42\\n        sage: parent(a)\\n        Integer Ring\\n        sage: b = 42/1\\n        sage: parent(b)\\n        Rational Field\\n        sage: c = 42.0\\n        sage: parent(c)\\n        Real Field with 53 bits of precision\\n\\n    Some more complicated examples::\\n\\n        sage: x = Partition([3,2,1,1,1])\\n        sage: parent(x)\\n        Partitions\\n        sage: v = vector(RDF, [1,2,3])\\n        sage: parent(v)\\n        Vector space of dimension 3 over Real Double Field\\n\\n    The following are not considered to be elements, so the type is\\n    returned::\\n\\n        sage: d = int(42)  # Python int\\n        sage: parent(d)\\n        <... 'int'>\\n        sage: L = list(range(10))\\n        sage: parent(L)\\n        <... 'list'>\\n    \";\n[sagelib-8.2.beta4]              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n[sagelib-8.2.beta4] error: command 'gcc' failed with exit status 1\n```\n\n\nI don't know why `sage/combinat/partitions` needs to redefine `isinf(double)` - it is something about C++ vs plain C?",
    "created_at": "2018-02-02T09:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341316",
    "user": "@dimpase"
}
```

With all the fixes we got, my build went to an error about conflicting headers while building sagelib:

```
[sagelib-8.2.beta4] [ 26/430] creating build/temp.solaris-2.11-sun4v.64bit-2.7/build/cythonized/sage/data_structures
[sagelib-8.2.beta4] gcc -DNDEBUG -g -O3 -Wall -D_XPG6 -fPIC -I/datapool/dima/Sage/sagetrac-mirror/local/include -I/datapool/dima/Sage/sagetrac-mirror/local/inc
lude/python2.7 -I/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/numpy/core/include -I/datapool/dima/Sage/sagetrac-mirror/src -I/datapool
/dima/Sage/sagetrac-mirror/src/sage/ext -Ibuild/cythonized -I/datapool/dima/Sage/sagetrac-mirror/local/include/python2.7 -c build/cythonized/sage/data_structur
es/binary_search.c -o build/temp.solaris-2.11-sun4v.64bit-2.7/build/cythonized/sage/data_structures/binary_search.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRAC
EBACK=1 -std=c99
[sagelib-8.2.beta4] In file included from build/cythonized/sage/combinat/partitions.cpp:597:0:
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions_c.h: In function ‘int isinf(double)’:
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions_c.h:3:19: error: ‘int isinf(double)’ conflicts with a previous declaration
[sagelib-8.2.beta4]  int isinf(double x) { return !finite(x) && x==x; }
[sagelib-8.2.beta4]                    ^
[sagelib-8.2.beta4] In file included from /datapool/dima/lib/gcc/sparcv9-sun-solaris2.11/7.2.0/include-fixed/math.h:25:0,
[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/bits/std_abs.h:40,
[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/cstdlib:77,
[sagelib-8.2.beta4]                  from /datapool/dima/include/c++/7.2.0/stdlib.h:36,
[sagelib-8.2.beta4]                  from ../local/include/python2.7/Python.h:42,
[sagelib-8.2.beta4]                  from build/cythonized/sage/combinat/partitions.cpp:58:
[sagelib-8.2.beta4] /usr/include/iso/math_c99.h:711:14: note: previous declaration ‘bool std::isinf(double)’
[sagelib-8.2.beta4]   inline bool isinf(double __X) { return __builtin_isinf(__X); }
[sagelib-8.2.beta4]               ^~~~~
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp: At global scope:
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4778:18: warning: ‘PyObject* __pyx_pw_4sage_9structure_7element_3have_same_parent(PyObject*, 
PyObject*, PyObject*)’ defined but not used [-Wunused-function]
[sagelib-8.2.beta4]  static PyObject *__pyx_pw_4sage_9structure_7element_3have_same_parent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
[sagelib-8.2.beta4]                   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4777:13: warning: ‘__pyx_doc_4sage_9structure_7element_2have_same_parent’ defined but not use
d [-Wunused-variable]
[sagelib-8.2.beta4]  static char __pyx_doc_4sage_9structure_7element_2have_same_parent[] = "have_same_parent(left, right) -> bool\nFile: sage/structure/element
.pxd (starting at line 112)\n\n    Return ``True`` if and only if ``left`` and ``right`` have the\n    same parent.\n\n    .. WARNING::\n\n        This functio
n assumes that at least one of the arguments is a\n        Sage :class:`Element`. When in doubt, use the slower\n        ``parent(left) is parent(right)`` inst
ead.\n\n    EXAMPLES::\n\n        sage: from sage.structure.element import have_same_parent\n        sage: have_same_parent(1, 3)\n        True\n        sage: 
have_same_parent(1, 1/2)\n        False\n        sage: have_same_parent(gap(1), gap(1/2))\n        True\n\n    These have different types but the same parent::
\n\n        sage: a = RLF(2)\n        sage: b = exp(a)\n        sage: type(a)\n        <... 'sage.rings.real_lazy.LazyWrapper'>\n        sage: type(b)\n       
 <... 'sage.rings.real_lazy.LazyNamedUnop'>\n        sage: have_same_parent(a, b)\n        True\n    ";
[sagelib-8.2.beta4]              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4436:18: warning: ‘PyObject* __pyx_pw_4sage_9structure_7element_1parent(PyObject*, PyObject*)’ defined but not used [-Wunused-function]
[sagelib-8.2.beta4]  static PyObject *__pyx_pw_4sage_9structure_7element_1parent(PyObject *__pyx_self, PyObject *__pyx_v_x) {
[sagelib-8.2.beta4] build/cythonized/sage/combinat/partitions.cpp:4435:13: warning: ‘__pyx_doc_4sage_9structure_7element_parent’ defined but not used [-Wunused-variable]
[sagelib-8.2.beta4]  static char __pyx_doc_4sage_9structure_7element_parent[] = "parent(x)\nFile: sage/structure/element.pxd (starting at line 7)\n\n    Return the parent of the element ``x``.\n\n    Usually, this means the mathematical object of which ``x`` is an\n    element.\n\n    INPUT:\n\n    - ``x`` -- an element\n\n    OUTPUT:\n\n    - If ``x`` is a Sage :class:`Element`, return ``x.parent()``.\n\n    - Otherwise, return ``type(x)``.\n\n    .. SEEALSO::\n\n        `Parents, Conversion and Coercion <http://doc.sagemath.org/html/en/tutorial/tour_coercion.html>`_\n        Section in the Sage Tutorial\n\n    EXAMPLES::\n\n        sage: a = 42\n        sage: parent(a)\n        Integer Ring\n        sage: b = 42/1\n        sage: parent(b)\n        Rational Field\n        sage: c = 42.0\n        sage: parent(c)\n        Real Field with 53 bits of precision\n\n    Some more complicated examples::\n\n        sage: x = Partition([3,2,1,1,1])\n        sage: parent(x)\n        Partitions\n        sage: v = vector(RDF, [1,2,3])\n        sage: parent(v)\n        Vector space of dimension 3 over Real Double Field\n\n    The following are not considered to be elements, so the type is\n    returned::\n\n        sage: d = int(42)  # Python int\n        sage: parent(d)\n        <... 'int'>\n        sage: L = list(range(10))\n        sage: parent(L)\n        <... 'list'>\n    ";
[sagelib-8.2.beta4]              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[sagelib-8.2.beta4] error: command 'gcc' failed with exit status 1
```


I don't know why `sage/combinat/partitions` needs to redefine `isinf(double)` - it is something about C++ vs plain C?



---

archive/issue_comments_341317.json:
```json
{
    "body": "Replying to [comment:42 dimpase]:\n> I did `export ABI=64`.\n\nI'm sure if that actually changes anything for GCC. In any case, it doesn't help for building GCC in Sage.",
    "created_at": "2018-02-02T09:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341317",
    "user": "@jdemeyer"
}
```

Replying to [comment:42 dimpase]:
> I did `export ABI=64`.

I'm sure if that actually changes anything for GCC. In any case, it doesn't help for building GCC in Sage.



---

archive/issue_comments_341318.json:
```json
{
    "body": "trying now the obvious\n\n```\ndiff --git a/src/sage/combinat/partitions_c.h b/src/sage/combinat/partitions_c.h\nindex e82ac77..7bc7398 100644\n--- a/src/sage/combinat/partitions_c.h\n+++ b/src/sage/combinat/partitions_c.h\n@@ -1,8 +1,3 @@\n-#if defined(__sun)\n-#include <ieeefp.h>\n-int isinf(double x) { return !finite(x) && x==x; }\n-#endif\n-\n #include <gmp.h>\n \n int part(mpz_t answer, unsigned int n);\n```\n\n\nwhich is undoing true vintage stuff: commit 29fd8e9662c (Michael Abshoff 2008-01-29...)",
    "created_at": "2018-02-02T09:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341318",
    "user": "@dimpase"
}
```

trying now the obvious

```
diff --git a/src/sage/combinat/partitions_c.h b/src/sage/combinat/partitions_c.h
index e82ac77..7bc7398 100644
--- a/src/sage/combinat/partitions_c.h
+++ b/src/sage/combinat/partitions_c.h
@@ -1,8 +1,3 @@
-#if defined(__sun)
-#include <ieeefp.h>
-int isinf(double x) { return !finite(x) && x==x; }
-#endif
-
 #include <gmp.h>
 
 int part(mpz_t answer, unsigned int n);
```


which is undoing true vintage stuff: commit 29fd8e9662c (Michael Abshoff 2008-01-29...)



---

archive/issue_comments_341319.json:
```json
{
    "body": "I will inspect the whole commit 29fd8e9662c - there is quite a bit of Sun-only funky stuff...",
    "created_at": "2018-02-02T09:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341319",
    "user": "@dimpase"
}
```

I will inspect the whole commit 29fd8e9662c - there is quite a bit of Sun-only funky stuff...



---

archive/issue_comments_341320.json:
```json
{
    "body": "Replying to [comment:46 dimpase]:\n> I will inspect the whole commit 29fd8e9662c - there is quite a bit of Sun-only funky stuff...\n\nI've opened #24642 for this.",
    "created_at": "2018-02-02T10:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341320",
    "user": "@dimpase"
}
```

Replying to [comment:46 dimpase]:
> I will inspect the whole commit 29fd8e9662c - there is quite a bit of Sun-only funky stuff...

I've opened #24642 for this.



---

archive/issue_comments_341321.json:
```json
{
    "body": "My build has completed, but `./sage` crashes on startup. Undertaking more cleaning of `_sun` stuff, perhaps it helps.",
    "created_at": "2018-02-02T11:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341321",
    "user": "@dimpase"
}
```

My build has completed, but `./sage` crashes on startup. Undertaking more cleaning of `_sun` stuff, perhaps it helps.



---

archive/issue_comments_341322.json:
```json
{
    "body": "OK, it's merely \n\n```\nImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory\n```\n\nOpened #24643 to deal with it.",
    "created_at": "2018-02-02T11:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341322",
    "user": "@dimpase"
}
```

OK, it's merely 

```
ImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory
```

Opened #24643 to deal with it.



---

archive/issue_comments_341323.json:
```json
{
    "body": "Do recent Sage's work on any Solaris platform? I know at one point it worked on Solaris 10 (SPARC) and passed all doc tests as a 32-bit application, but whilst I managed to build a 64-bit version, it was **very** unstable. I believe later version of Sage were not tested on Solaris, and I found it would not build. \n\nI recently installed the latest Solaris 10 on a Sun Blade 2000 (SPARC), but can't install Solaris 11 on there, as the CPU is too old. I also have OpenSolaris (sort of Solaris 11) on an x86 box. \n\n**If I can be any assistance I will be, but I don't have access to any Solaris 11 SPARC box.**\n\nI am guessing that this T4 box will be like the old t2.math, which was very slow on Sage. The T2, T3 and T4 CPUs are not designed for this application. Apparently they work very well on busy webservers and databases, but if only one thread is in use most of the time, they are not going to work well. \n\nI don't think enough people see the benefit of having software compile on several platforms. Often bugs show up on one platform that don't on another, but may bite on that other platform in the future. \n\nDave",
    "created_at": "2018-02-02T14:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341323",
    "user": "drkirkby"
}
```

Do recent Sage's work on any Solaris platform? I know at one point it worked on Solaris 10 (SPARC) and passed all doc tests as a 32-bit application, but whilst I managed to build a 64-bit version, it was **very** unstable. I believe later version of Sage were not tested on Solaris, and I found it would not build. 

I recently installed the latest Solaris 10 on a Sun Blade 2000 (SPARC), but can't install Solaris 11 on there, as the CPU is too old. I also have OpenSolaris (sort of Solaris 11) on an x86 box. 

**If I can be any assistance I will be, but I don't have access to any Solaris 11 SPARC box.**

I am guessing that this T4 box will be like the old t2.math, which was very slow on Sage. The T2, T3 and T4 CPUs are not designed for this application. Apparently they work very well on busy webservers and databases, but if only one thread is in use most of the time, they are not going to work well. 

I don't think enough people see the benefit of having software compile on several platforms. Often bugs show up on one platform that don't on another, but may bite on that other platform in the future. 

Dave



---

archive/issue_comments_341324.json:
```json
{
    "body": "Replying to [comment:50 drkirkby]:\n> I don't think enough people see the benefit of having software compile on several platforms.\n\nMy opinion is that compiling software on \"exotic\" platforms helps portability in general. So it's not wasted effort.",
    "created_at": "2018-02-02T15:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341324",
    "user": "@jdemeyer"
}
```

Replying to [comment:50 drkirkby]:
> I don't think enough people see the benefit of having software compile on several platforms.

My opinion is that compiling software on "exotic" platforms helps portability in general. So it's not wasted effort.



---

archive/issue_comments_341325.json:
```json
{
    "body": "Replying to [comment:50 drkirkby]:\n> Do recent Sage's work on any Solaris platform? I know at one point it worked on Solaris 10 (SPARC) and passed all doc tests as a 32-bit application, but whilst I managed to build a 64-bit version, it was **very** unstable. I believe later version of Sage were not tested on Solaris, and I found it would not build. \n\nFor years we did not have access to a well-working Solaris box, and so the port bitrotted quite a bit.\n> \n> I recently installed the latest Solaris 10 on a Sun Blade 2000 (SPARC), but can't install Solaris 11 on there, as the CPU is too old. I also have OpenSolaris (sort of Solaris 11) on an x86 box. \n> \n> **If I can be any assistance I will be, but I don't have access to any Solaris 11 SPARC box.**\n> \n\nI believe that with recent [openCSW](https://www.opencsw.org/manual/for-administrators/getting-started.html) you basically get the same tools for Solaris 11 and 10, \nso it should not matter too much whether it's 10 or 11. (YMMV, naturally).\n\nOne can get gcc 5.4 and all the g-stuff (gtar, gawk, etc), so nothing needs to be built manually.\nGive it a try once we have this ticket in a reasonable shape.\n\nAt the moment I get working Sage (with all this slew of tickets we opened here, and patches there), but building some bits of documentation (3d plots built with tachyon) fails.\n\n\n> I am guessing that this T4 box will be like the old t2.math, which was very slow on Sage. The T2, T3 and T4 CPUs are not designed for this application. Apparently they work very well on busy webservers and databases, but if only one thread is in use most of the time, they are not going to work well. \n> \nT4 is not too slow, it seems.",
    "created_at": "2018-02-02T19:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341325",
    "user": "@dimpase"
}
```

Replying to [comment:50 drkirkby]:
> Do recent Sage's work on any Solaris platform? I know at one point it worked on Solaris 10 (SPARC) and passed all doc tests as a 32-bit application, but whilst I managed to build a 64-bit version, it was **very** unstable. I believe later version of Sage were not tested on Solaris, and I found it would not build. 

For years we did not have access to a well-working Solaris box, and so the port bitrotted quite a bit.
> 
> I recently installed the latest Solaris 10 on a Sun Blade 2000 (SPARC), but can't install Solaris 11 on there, as the CPU is too old. I also have OpenSolaris (sort of Solaris 11) on an x86 box. 
> 
> **If I can be any assistance I will be, but I don't have access to any Solaris 11 SPARC box.**
> 

I believe that with recent [openCSW](https://www.opencsw.org/manual/for-administrators/getting-started.html) you basically get the same tools for Solaris 11 and 10, 
so it should not matter too much whether it's 10 or 11. (YMMV, naturally).

One can get gcc 5.4 and all the g-stuff (gtar, gawk, etc), so nothing needs to be built manually.
Give it a try once we have this ticket in a reasonable shape.

At the moment I get working Sage (with all this slew of tickets we opened here, and patches there), but building some bits of documentation (3d plots built with tachyon) fails.


> I am guessing that this T4 box will be like the old t2.math, which was very slow on Sage. The T2, T3 and T4 CPUs are not designed for this application. Apparently they work very well on busy webservers and databases, but if only one thread is in use most of the time, they are not going to work well. 
> 
T4 is not too slow, it seems.



---

archive/issue_comments_341326.json:
```json
{
    "body": "The next problem is with plotting (docs won't build due to errors in matplotlib).\nAs #23696 is imminent, I don't want to look at errors with matplotlib 1.5.\nThe first problem is in subprocess32: #24650 (ought to be fixed upstream)",
    "created_at": "2018-02-03T14:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341326",
    "user": "@dimpase"
}
```

The next problem is with plotting (docs won't build due to errors in matplotlib).
As #23696 is imminent, I don't want to look at errors with matplotlib 1.5.
The first problem is in subprocess32: #24650 (ought to be fixed upstream)



---

archive/issue_comments_341327.json:
```json
{
    "body": "pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used), e.g.\n\n```\nsage -t src/sage/interfaces/singular.py  # 172 doctests failed\n```\n\nsee #24651 for full details and traces. Here is a typical error:\n\n```\nsage: t=singular(0)\n---------------------------------------------------------------------------\nIOError                                   Traceback (most recent call last)\n...\nIOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.\nsage:  \n```\n",
    "created_at": "2018-02-03T20:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341327",
    "user": "@dimpase"
}
```

pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used), e.g.

```
sage -t src/sage/interfaces/singular.py  # 172 doctests failed
```

see #24651 for full details and traces. Here is a typical error:

```
sage: t=singular(0)
---------------------------------------------------------------------------
IOError                                   Traceback (most recent call last)
...
IOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.
sage:  
```




---

archive/issue_comments_341328.json:
```json
{
    "body": "Are you sure it's a good idea not to pass `-D_XPG6` to g++, too?",
    "created_at": "2018-02-05T10:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341328",
    "user": "@dimpase"
}
```

Are you sure it's a good idea not to pass `-D_XPG6` to g++, too?



---

archive/issue_comments_341329.json:
```json
{
    "body": "Replying to [comment:57 dimpase]:\n> Are you sure it's a good idea not to pass `-D_XPG6` to g++, too?\n\nIt seems in particular needed to compile C99 code. But I guess it doesn't hurt to add it to `CXXFLAGS`.",
    "created_at": "2018-02-05T10:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341329",
    "user": "@jdemeyer"
}
```

Replying to [comment:57 dimpase]:
> Are you sure it's a good idea not to pass `-D_XPG6` to g++, too?

It seems in particular needed to compile C99 code. But I guess it doesn't hurt to add it to `CXXFLAGS`.



---

archive/issue_comments_341330.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-02-06T11:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341330",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_341331.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-07T06:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341331",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_341332.json:
```json
{
    "body": "testing:\n\n```\nsage -t src/sage/plot/plot3d/list_plot3d.py  # 1 doctest failed\nsage -t src/sage/plot/plot3d/base.pyx  # Killed due to bus error\nsage -t src/sage/modular/abvar/abvar.py  # Timed out\nsage -t src/sage/modular/abvar/lseries.py  # Timed out\nsage -t src/sage/modular/modform/element.py  # Timed out\nsage -t src/sage/modular/modform_hecketriangle/element.py  # Timed out\nsage -t src/sage/modular/modform_hecketriangle/readme.py  # Timed out\nsage -t src/sage/schemes/elliptic_curves/ell_point.py  # 1 doctest failed\nsage -t src/sage/functions/wigner.py  # 1 doctest failed\nsage -t src/sage/rings/bernmm.pyx  # 2 doctests failed\nsage -t src/sage/rings/number_field/number_field.py  # Timed out\nsage -t src/sage/rings/padics/padic_extension_leaves.py  # Timed out\nsage -t src/sage/geometry/riemannian_manifolds/surface3d_generators.py  # 1 doctest failed\nsage -t src/sage/misc/cython.py  # 1 doctest failed\nsage -t src/sage/misc/compat.py  # 1 doctest failed\nsage -t src/sage/tests/parigp.py  # Timed out\nsage -t src/sage/tests/cmdline.py  # 1 doctest failed\nsage -t src/sage/lfunctions/dokchitser.py  # Timed out\nsage -t src/sage/graphs/generators/smallgraphs.py  # 1 doctest failed\nsage -t src/sage/repl/image.py  # Killed due to bus error\nsage -t src/sage/matrix/matrix2.pyx  # Killed due to bus error\nsage -t src/sage/dynamics/complex_dynamics/mandel_julia.py  # Killed due to bus error\nsage -t src/sage/dynamics/complex_dynamics/mandel_julia_helper.pyx  # Killed due to bus error\nsage -t src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/l_series.rst  # Timed out\n```\n\n\nhere is the log for failing tests:\nhttp://users.ox.ac.uk/~coml0531/tmp/test5.log",
    "created_at": "2018-02-11T10:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341332",
    "user": "@dimpase"
}
```

testing:

```
sage -t src/sage/plot/plot3d/list_plot3d.py  # 1 doctest failed
sage -t src/sage/plot/plot3d/base.pyx  # Killed due to bus error
sage -t src/sage/modular/abvar/abvar.py  # Timed out
sage -t src/sage/modular/abvar/lseries.py  # Timed out
sage -t src/sage/modular/modform/element.py  # Timed out
sage -t src/sage/modular/modform_hecketriangle/element.py  # Timed out
sage -t src/sage/modular/modform_hecketriangle/readme.py  # Timed out
sage -t src/sage/schemes/elliptic_curves/ell_point.py  # 1 doctest failed
sage -t src/sage/functions/wigner.py  # 1 doctest failed
sage -t src/sage/rings/bernmm.pyx  # 2 doctests failed
sage -t src/sage/rings/number_field/number_field.py  # Timed out
sage -t src/sage/rings/padics/padic_extension_leaves.py  # Timed out
sage -t src/sage/geometry/riemannian_manifolds/surface3d_generators.py  # 1 doctest failed
sage -t src/sage/misc/cython.py  # 1 doctest failed
sage -t src/sage/misc/compat.py  # 1 doctest failed
sage -t src/sage/tests/parigp.py  # Timed out
sage -t src/sage/tests/cmdline.py  # 1 doctest failed
sage -t src/sage/lfunctions/dokchitser.py  # Timed out
sage -t src/sage/graphs/generators/smallgraphs.py  # 1 doctest failed
sage -t src/sage/repl/image.py  # Killed due to bus error
sage -t src/sage/matrix/matrix2.pyx  # Killed due to bus error
sage -t src/sage/dynamics/complex_dynamics/mandel_julia.py  # Killed due to bus error
sage -t src/sage/dynamics/complex_dynamics/mandel_julia_helper.pyx  # Killed due to bus error
sage -t src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/l_series.rst  # Timed out
```


here is the log for failing tests:
http://users.ox.ac.uk/~coml0531/tmp/test5.log



---

archive/issue_comments_341333.json:
```json
{
    "body": "see #24765 for a GAP problem.",
    "created_at": "2018-02-17T22:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341333",
    "user": "@dimpase"
}
```

see #24765 for a GAP problem.



---

archive/issue_comments_341334.json:
```json
{
    "body": "Do \"we\" have still access to the system? Can it be configured as a self-hosted runner for [GitHub](GitHub) actions? https://help.github.com/en/actions/hosting-your-own-runners",
    "created_at": "2020-03-22T15:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341334",
    "user": "@mkoeppe"
}
```

Do "we" have still access to the system? Can it be configured as a self-hosted runner for [GitHub](GitHub) actions? https://help.github.com/en/actions/hosting-your-own-runners



---

archive/issue_comments_341335.json:
```json
{
    "body": "no access since last year, no reply from the sysadmin.\nI can offer an OpenBSD box as a replacement :-)",
    "created_at": "2020-03-26T02:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341335",
    "user": "@dimpase"
}
```

no access since last year, no reply from the sysadmin.
I can offer an OpenBSD box as a replacement :-)



---

archive/issue_comments_341336.json:
```json
{
    "body": "Outdated, should be closed",
    "created_at": "2020-07-08T16:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341336",
    "user": "@mkoeppe"
}
```

Outdated, should be closed



---

archive/issue_comments_341337.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-08T16:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341337",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_341338.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-09T13:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341338",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_341339.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-08-14T12:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-341339",
    "user": "@fchapoton"
}
```

Resolution: invalid
