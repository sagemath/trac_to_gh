# Issue 20001: Make the Sage <-> PARI interface a stand-alone package

Issue created by migration from https://trac.sagemath.org/ticket/20238

Original creator: jdemeyer

Original creation time: 2016-03-21 13:07:46

CC:  defeo slelievre vdelecroix mmarco jpflori

Needs cysignals:

* #20002: Move interrupt.pyx to package cysignals
* #20210: Move memory functions to cysignals

Cleanup of PARI interface:

* #20205: Clean up factoring PARI interface
* #20213: Replace pari_catch_sig_on by sig_on
* #20216: Deprecate PARI nth_prime, prime_list, primes_up_to_n
* #20217: Remove redundant functions from pari_instance.pyx
* #20219: Remove redundant functions from gen.pyx
* #20224: Auto-generated PARI functions sometimes return 0 instead of None
* #20226: Implement conversion PARI <-> Python int/long without GMP/MPIR


---

Comment by slelievre created at 2016-03-21 17:18:29

Changing keywords from "" to "Pari".


---

Comment by defeo created at 2016-04-09 13:54:49

A comment by [ticket:20241#comment:3 kedlaya] on #20241:
> Regarding the utility functions: I think `primes` belongs in `sage.rings.fast_arith` along with `prime_range`, while `genus2red` should be in `sage.schemes.hyperelliptic_curves.HyperellipticCurve_g2_rational_field` which is otherwise completely empty! The other functions don't provide any new functionality (factorials, Chebyshev polynomials, etc.).


---

Comment by nbruin created at 2016-05-11 21:18:39

Just a question: presently we have efficient sage.Integer <-> pari-gp integer conversion, right? `CyPari` would probably not support this directly, because that would make sage.Integer a dependency of the package. Where would the efficient conversion fit? (we wouldn't want to go through Python integers if we don't have to)


---

Comment by defeo created at 2016-10-19 11:34:03

So, what's left to be done? Are we ready to externalize the interface?


---

Comment by jdemeyer created at 2016-10-21 07:52:58

When the next beta with #20241 is released, I will have a look.


---

Comment by jdemeyer created at 2017-03-31 10:22:17

There is one issue which comes up regularly when dealing with Cython code. When you do something like

```
cdef extern from "cypari.h":
    GEN set_gel(GEN x, long n, GEN z)              # gel(x, n) = z
    GEN set_gmael(GEN x, long i, long j, GEN z)    # gmael(x, i, j) = z
    GEN set_gcoeff(GEN x, long i, long j, GEN z)   # gcoeff(x, i, j) = z
    GEN set_uel(GEN x, long n, ulong z)            # uel(x, n) = z
```

the C compiler does not know where to find `cypari.h`. I had a similar issue in `cysignals`, for which I implemented an ugly work-around by auto-generating some `__init__.pxd` file (this wasn't so bad, since I needed to auto-generate that file anyway).

However, for a proper solution, Cython should add the include directory because Cython does know where to find `cypari.h`


---

Comment by jdemeyer created at 2017-03-31 10:24:40

So the plan is now to add a Cython patch: #22728.


---

Comment by git created at 2017-03-31 16:49:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-03-31 18:29:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-03-31 20:16:16

Changing status from new to needs_review.


---

Comment by git created at 2017-04-01 09:20:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by isuruf created at 2017-04-22 01:53:30

Another solution would be to install the header into a standard location using `headers` option of `distutils.core.setup`. See https://docs.python.org/3/distutils/setupscript.html#preprocessor-options for why that works.

If you do that, you need to change `cdef extern from "cypari.h":` to `cdef extern from "cypari2/cypari.h":` because distutils will install `cypari.h` to `cypari2/cypari.h`


---

Comment by jdemeyer created at 2017-04-22 13:33:02

Replying to [comment:60 isuruf]:
> Another solution would be to install the header into a standard location using `headers` option of `distutils.core.setup`. See https://docs.python.org/3/distutils/setupscript.html#preprocessor-options for why that works.

Right. However, it seems that Python packages rarely use this option. I wonder if there is a reason for that...


---

Comment by jdemeyer created at 2017-04-23 08:05:58

Reading that page https://docs.python.org/3/distutils/setupscript.html#preprocessor-options better, it only talks about what you need to do in order to compile against the header. It doesn't say how to actually install the headers.

Here is a "interesting" post about Python header files: https://github.com/pypa/packaging-problems/issues/84


---

Comment by jpflori created at 2017-04-25 12:14:34

This looks pretty trivial and good.
My only concern is: is it cypari or cypari2?


---

Comment by jdemeyer created at 2017-04-25 12:36:41

Replying to [comment:64 jpflori]:
> My only concern is: is it cypari or cypari2?

The Python package is currently called CyPari2, but the goal is to merge it with CyPari.


---

Comment by jpflori created at 2017-04-25 12:50:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-27 20:11:55

Resolution: fixed


---

Comment by jdemeyer created at 2017-04-28 07:00:59

Great news! I will officially release CyPari2-1.0.0 then and put it on pypi.


---

Comment by jhpalmieri created at 2017-04-28 20:17:26

After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?


---

Comment by vdelecroix created at 2017-04-28 20:21:03

Replying to [comment:69 jhpalmieri]:
> After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?

They were just not removed because not tracked by git, aren't they?


---

Comment by jhpalmieri created at 2017-04-28 20:53:19

Replying to [comment:70 vdelecroix]:
> Replying to [comment:69 jhpalmieri]:
> > After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?
> 
> They were just not removed because not tracked by git, aren't they?

Right: since they are not tracked by git, they were not removed. And since the `src/sage/libs/cypari2/.gitignore` file was removed, they are no longer ignored.


---

Comment by jdemeyer created at 2017-04-29 09:16:56

Replying to [comment:69 jhpalmieri]:
> Should it be the job of the CyPari2 `spkg-install` file to delete those?

Certainly not (separation of concerns: the `cypari2` package and the Sage library are two independent things).

But `src/setup.py` could delete those files.
