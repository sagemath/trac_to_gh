# Issue 20001: Make the Sage <-> PARI interface a stand-alone package

archive/issues_020001.json:
```json
{
    "body": "CC:  @defeo @slel @videlec @miguelmarco jpflori\n\nNeeds cysignals:\n\n* #20002: Move interrupt.pyx to package cysignals\n* #20210: Move memory functions to cysignals\n\nCleanup of PARI interface:\n\n* #20205: Clean up factoring PARI interface\n* #20213: Replace pari_catch_sig_on by sig_on\n* #20216: Deprecate PARI nth_prime, prime_list, primes_up_to_n\n* #20217: Remove redundant functions from pari_instance.pyx\n* #20219: Remove redundant functions from gen.pyx\n* #20224: Auto-generated PARI functions sometimes return 0 instead of None\n* #20226: Implement conversion PARI <-> Python int/long without GMP/MPIR\n\nIssue created by migration from https://trac.sagemath.org/ticket/20238\n\n",
    "created_at": "2016-03-21T13:07:46Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Make the Sage <-> PARI interface a stand-alone package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20001",
    "user": "@jdemeyer"
}
```
CC:  @defeo @slel @videlec @miguelmarco jpflori

Needs cysignals:

* #20002: Move interrupt.pyx to package cysignals
* #20210: Move memory functions to cysignals

Cleanup of PARI interface:

* #20205: Clean up factoring PARI interface
* #20213: Replace pari_catch_sig_on by sig_on
* #20216: Deprecate PARI nth_prime, prime_list, primes_up_to_n
* #20217: Remove redundant functions from pari_instance.pyx
* #20219: Remove redundant functions from gen.pyx
* #20224: Auto-generated PARI functions sometimes return 0 instead of None
* #20226: Implement conversion PARI <-> Python int/long without GMP/MPIR

Issue created by migration from https://trac.sagemath.org/ticket/20238





---

archive/issue_comments_275434.json:
```json
{
    "body": "Changing keywords from \"\" to \"Pari\".",
    "created_at": "2016-03-21T17:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275434",
    "user": "@slel"
}
```

Changing keywords from "" to "Pari".



---

archive/issue_comments_275435.json:
```json
{
    "body": "A comment by [ticket:20241#comment:3 kedlaya] on #20241:\n> Regarding the utility functions: I think `primes` belongs in `sage.rings.fast_arith` along with `prime_range`, while `genus2red` should be in `sage.schemes.hyperelliptic_curves.HyperellipticCurve_g2_rational_field` which is otherwise completely empty! The other functions don't provide any new functionality (factorials, Chebyshev polynomials, etc.).",
    "created_at": "2016-04-09T13:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275435",
    "user": "@defeo"
}
```

A comment by [ticket:20241#comment:3 kedlaya] on #20241:
> Regarding the utility functions: I think `primes` belongs in `sage.rings.fast_arith` along with `prime_range`, while `genus2red` should be in `sage.schemes.hyperelliptic_curves.HyperellipticCurve_g2_rational_field` which is otherwise completely empty! The other functions don't provide any new functionality (factorials, Chebyshev polynomials, etc.).



---

archive/issue_comments_275436.json:
```json
{
    "body": "Just a question: presently we have efficient sage.Integer <-> pari-gp integer conversion, right? `CyPari` would probably not support this directly, because that would make sage.Integer a dependency of the package. Where would the efficient conversion fit? (we wouldn't want to go through Python integers if we don't have to)",
    "created_at": "2016-05-11T21:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275436",
    "user": "@nbruin"
}
```

Just a question: presently we have efficient sage.Integer <-> pari-gp integer conversion, right? `CyPari` would probably not support this directly, because that would make sage.Integer a dependency of the package. Where would the efficient conversion fit? (we wouldn't want to go through Python integers if we don't have to)



---

archive/issue_comments_275437.json:
```json
{
    "body": "So, what's left to be done? Are we ready to externalize the interface?",
    "created_at": "2016-10-19T11:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275437",
    "user": "@defeo"
}
```

So, what's left to be done? Are we ready to externalize the interface?



---

archive/issue_comments_275438.json:
```json
{
    "body": "When the next beta with #20241 is released, I will have a look.",
    "created_at": "2016-10-21T07:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275438",
    "user": "@jdemeyer"
}
```

When the next beta with #20241 is released, I will have a look.



---

archive/issue_comments_275439.json:
```json
{
    "body": "There is one issue which comes up regularly when dealing with Cython code. When you do something like\n\n```\ncdef extern from \"cypari.h\":\n    GEN set_gel(GEN x, long n, GEN z)              # gel(x, n) = z\n    GEN set_gmael(GEN x, long i, long j, GEN z)    # gmael(x, i, j) = z\n    GEN set_gcoeff(GEN x, long i, long j, GEN z)   # gcoeff(x, i, j) = z\n    GEN set_uel(GEN x, long n, ulong z)            # uel(x, n) = z\n```\n\nthe C compiler does not know where to find `cypari.h`. I had a similar issue in `cysignals`, for which I implemented an ugly work-around by auto-generating some `__init__.pxd` file (this wasn't so bad, since I needed to auto-generate that file anyway).\n\nHowever, for a proper solution, Cython should add the include directory because Cython does know where to find `cypari.h`",
    "created_at": "2017-03-31T10:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275439",
    "user": "@jdemeyer"
}
```

There is one issue which comes up regularly when dealing with Cython code. When you do something like

```
cdef extern from "cypari.h":
    GEN set_gel(GEN x, long n, GEN z)              # gel(x, n) = z
    GEN set_gmael(GEN x, long i, long j, GEN z)    # gmael(x, i, j) = z
    GEN set_gcoeff(GEN x, long i, long j, GEN z)   # gcoeff(x, i, j) = z
    GEN set_uel(GEN x, long n, ulong z)            # uel(x, n) = z
```

the C compiler does not know where to find `cypari.h`. I had a similar issue in `cysignals`, for which I implemented an ugly work-around by auto-generating some `__init__.pxd` file (this wasn't so bad, since I needed to auto-generate that file anyway).

However, for a proper solution, Cython should add the include directory because Cython does know where to find `cypari.h`



---

archive/issue_comments_275440.json:
```json
{
    "body": "So the plan is now to add a Cython patch: #22728.",
    "created_at": "2017-03-31T10:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275440",
    "user": "@jdemeyer"
}
```

So the plan is now to add a Cython patch: #22728.



---

archive/issue_comments_275441.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-31T16:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275441",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_275442.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-31T18:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275442",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_275443.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-31T20:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275443",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_275444.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-01T09:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275444",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_275445.json:
```json
{
    "body": "Another solution would be to install the header into a standard location using `headers` option of `distutils.core.setup`. See https://docs.python.org/3/distutils/setupscript.html#preprocessor-options for why that works.\n\nIf you do that, you need to change `cdef extern from \"cypari.h\":` to `cdef extern from \"cypari2/cypari.h\":` because distutils will install `cypari.h` to `cypari2/cypari.h`",
    "created_at": "2017-04-22T01:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275445",
    "user": "@isuruf"
}
```

Another solution would be to install the header into a standard location using `headers` option of `distutils.core.setup`. See https://docs.python.org/3/distutils/setupscript.html#preprocessor-options for why that works.

If you do that, you need to change `cdef extern from "cypari.h":` to `cdef extern from "cypari2/cypari.h":` because distutils will install `cypari.h` to `cypari2/cypari.h`



---

archive/issue_comments_275446.json:
```json
{
    "body": "Replying to [comment:60 isuruf]:\n> Another solution would be to install the header into a standard location using `headers` option of `distutils.core.setup`. See https://docs.python.org/3/distutils/setupscript.html#preprocessor-options for why that works.\n\nRight. However, it seems that Python packages rarely use this option. I wonder if there is a reason for that...",
    "created_at": "2017-04-22T13:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275446",
    "user": "@jdemeyer"
}
```

Replying to [comment:60 isuruf]:
> Another solution would be to install the header into a standard location using `headers` option of `distutils.core.setup`. See https://docs.python.org/3/distutils/setupscript.html#preprocessor-options for why that works.

Right. However, it seems that Python packages rarely use this option. I wonder if there is a reason for that...



---

archive/issue_comments_275447.json:
```json
{
    "body": "Reading that page https://docs.python.org/3/distutils/setupscript.html#preprocessor-options better, it only talks about what you need to do in order to compile against the header. It doesn't say how to actually install the headers.\n\nHere is a \"interesting\" post about Python header files: https://github.com/pypa/packaging-problems/issues/84",
    "created_at": "2017-04-23T08:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275447",
    "user": "@jdemeyer"
}
```

Reading that page https://docs.python.org/3/distutils/setupscript.html#preprocessor-options better, it only talks about what you need to do in order to compile against the header. It doesn't say how to actually install the headers.

Here is a "interesting" post about Python header files: https://github.com/pypa/packaging-problems/issues/84



---

archive/issue_comments_275448.json:
```json
{
    "body": "This looks pretty trivial and good.\nMy only concern is: is it cypari or cypari2?",
    "created_at": "2017-04-25T12:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275448",
    "user": "jpflori"
}
```

This looks pretty trivial and good.
My only concern is: is it cypari or cypari2?



---

archive/issue_comments_275449.json:
```json
{
    "body": "Replying to [comment:64 jpflori]:\n> My only concern is: is it cypari or cypari2?\n\nThe Python package is currently called CyPari2, but the goal is to merge it with CyPari.",
    "created_at": "2017-04-25T12:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275449",
    "user": "@jdemeyer"
}
```

Replying to [comment:64 jpflori]:
> My only concern is: is it cypari or cypari2?

The Python package is currently called CyPari2, but the goal is to merge it with CyPari.



---

archive/issue_comments_275450.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-25T12:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275450",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_275451.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-27T20:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275451",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_275452.json:
```json
{
    "body": "Great news! I will officially release CyPari2-1.0.0 then and put it on pypi.",
    "created_at": "2017-04-28T07:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275452",
    "user": "@jdemeyer"
}
```

Great news! I will officially release CyPari2-1.0.0 then and put it on pypi.



---

archive/issue_comments_275453.json:
```json
{
    "body": "After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?",
    "created_at": "2017-04-28T20:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275453",
    "user": "@jhpalmieri"
}
```

After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?



---

archive/issue_comments_275454.json:
```json
{
    "body": "Replying to [comment:69 jhpalmieri]:\n> After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?\n\nThey were just not removed because not tracked by git, aren't they?",
    "created_at": "2017-04-28T20:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275454",
    "user": "@videlec"
}
```

Replying to [comment:69 jhpalmieri]:
> After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?

They were just not removed because not tracked by git, aren't they?



---

archive/issue_comments_275455.json:
```json
{
    "body": "Replying to [comment:70 vdelecroix]:\n> Replying to [comment:69 jhpalmieri]:\n> > After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?\n> \n> They were just not removed because not tracked by git, aren't they?\n\nRight: since they are not tracked by git, they were not removed. And since the `src/sage/libs/cypari2/.gitignore` file was removed, they are no longer ignored.",
    "created_at": "2017-04-28T20:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275455",
    "user": "@jhpalmieri"
}
```

Replying to [comment:70 vdelecroix]:
> Replying to [comment:69 jhpalmieri]:
> > After updating to the latest beta, I have some stale autogenerated files in `src/sage/lib/cypari2`: the ones listed in the now deleted `.gitignore` file. Should it be the job of the CyPari2 `spkg-install` file to delete those?
> 
> They were just not removed because not tracked by git, aren't they?

Right: since they are not tracked by git, they were not removed. And since the `src/sage/libs/cypari2/.gitignore` file was removed, they are no longer ignored.



---

archive/issue_comments_275456.json:
```json
{
    "body": "Replying to [comment:69 jhpalmieri]:\n> Should it be the job of the CyPari2 `spkg-install` file to delete those?\n\nCertainly not (separation of concerns: the `cypari2` package and the Sage library are two independent things).\n\nBut `src/setup.py` could delete those files.",
    "created_at": "2017-04-29T09:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20001",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20001#issuecomment-275456",
    "user": "@jdemeyer"
}
```

Replying to [comment:69 jhpalmieri]:
> Should it be the job of the CyPari2 `spkg-install` file to delete those?

Certainly not (separation of concerns: the `cypari2` package and the Sage library are two independent things).

But `src/setup.py` could delete those files.
