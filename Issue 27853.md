# Issue 27853: Genus calculation crashes

archive/issues_027853.json:
```json
{
    "body": "CC:  @bhutz\n\nI came up with a complicated curve that I was trying to analyze and perform a genus calculation:\n\n\n```\nF.<c> = FunctionField(QQ)\nPP1.<x,y> = ProjectiveSpace(F,1)\nf = DynamicalSystem([x^4 + c*y^4, y^4])\n\nR.<x, c> = QQ[]\np = f.dynatomic_polynomial(3)\n# P is the second dynatomic polynomial in the correct ring\nP = eval(str(p.specialization({y:1})).replace(\"^\", \"**\"))\nprint P\nprint \"\\n\\n\"\nprint Curve(P).genus()\n```\n\n\n(I'm showing a way to generate the same curve that's a bit hack-y, but it makes it a self-contained example rather than copy-pasting a very long expression for the curve)\n\nAfter 30 minutes of running the `genus()` function, sage exits with no stack trace, with a message like\n\n\n```\n(...)/sage/src/bin/sage-python: line 2: 19676 Killed                  sage -python \"$@\"\n```\n\n\nAccording to the documentation (page 44 of [http://doc.sagemath.org/pdf/en/reference/curves/curves.pdf](http://doc.sagemath.org/pdf/en/reference/curves/curves.pdf) ), Sage uses Singular for this calculation, so I'd assume it's a bug in Singular that makes it crash. Interestingly though, Maplesoft is able to compute this genus in around 10 seconds in contrast to the 30 minutes it took Sage before it crashed. Using Singular for this calculation is probably very un-optimal, and leaves a lot of room for improvement.\n\nHere's equivalent Maple code for reference (f is the expression printed from sage for `P`):\n\n\n```\nwith(algcurves):\nf := ...\ngenus(f, x, y)\n# Outputs: 28\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28090\n\n",
    "created_at": "2019-07-01T14:52:57Z",
    "labels": [
        "component: geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Genus calculation crashes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27853",
    "user": "https://github.com/Torrencem"
}
```
CC:  @bhutz

I came up with a complicated curve that I was trying to analyze and perform a genus calculation:


```
F.<c> = FunctionField(QQ)
PP1.<x,y> = ProjectiveSpace(F,1)
f = DynamicalSystem([x^4 + c*y^4, y^4])

R.<x, c> = QQ[]
p = f.dynatomic_polynomial(3)
# P is the second dynatomic polynomial in the correct ring
P = eval(str(p.specialization({y:1})).replace("^", "**"))
print P
print "\n\n"
print Curve(P).genus()
```


(I'm showing a way to generate the same curve that's a bit hack-y, but it makes it a self-contained example rather than copy-pasting a very long expression for the curve)

After 30 minutes of running the `genus()` function, sage exits with no stack trace, with a message like


```
(...)/sage/src/bin/sage-python: line 2: 19676 Killed                  sage -python "$@"
```


According to the documentation (page 44 of [http://doc.sagemath.org/pdf/en/reference/curves/curves.pdf](http://doc.sagemath.org/pdf/en/reference/curves/curves.pdf) ), Sage uses Singular for this calculation, so I'd assume it's a bug in Singular that makes it crash. Interestingly though, Maplesoft is able to compute this genus in around 10 seconds in contrast to the 30 minutes it took Sage before it crashed. Using Singular for this calculation is probably very un-optimal, and leaves a lot of room for improvement.

Here's equivalent Maple code for reference (f is the expression printed from sage for `P`):


```
with(algcurves):
f := ...
genus(f, x, y)
# Outputs: 28
```


Issue created by migration from https://trac.sagemath.org/ticket/28090





---

archive/issue_comments_392918.json:
```json
{
    "body": "I ran into the same issue with this complicated curve:\n\n```\nP.<z, c, h> = ProjectiveSpace(QQ, 2)\nC2 = Curve(z^54 + 18*z^51*c*h^2 + 153*z^48*c^2*h^4 + 816*z^45*c^3*h^6 + 6*z^45*c*h^8 + 3060*z^42*c^4*h^8 + 90*z^42*c^2*h^10 + 8568*z^39*c^5*h^10 + 630*z^39*c^3*h^12 + 18564*z^36*c^6*h^12 + 2730*z^36*c^4*h^14 + 31824*z^33*c^7*h^14 + 15*z^36*c^2*h^16 + 8190*z^33*c^5*h^16 + 43758*z^30*c^8*h^16 + z^36*h^18 + 180*z^33*c^3*h^18 + 18018*z^30*c^6*h^18 + 48620*z^27*c^9*h^18 + 12*z^33*c*h^20 + 990*z^30*c^4*h^20 + 30030*z^27*c^7*h^20 + 43758*z^24*c^10*h^20 + 66*z^30*c^2*h^22 + 3300*z^27*c^5*h^22 + 38610*z^24*c^8*h^22 + 31824*z^21*c^11*h^22 + 240*z^27*c^3*h^24 + 7425*z^24*c^6*h^24 + 38610*z^21*c^9*h^24 + 18564*z^18*c^12*h^24 + 6*z^27*c*h^26 + 675*z^24*c^4*h^26 + 11880*z^21*c^7*h^26 + 30030*z^18*c^10*h^26 + 8568*z^15*c^13*h^26 + 54*z^24*c^2*h^28 + 1512*z^21*c^5*h^28 + 13860*z^18*c^8*h^28 + 18018*z^15*c^11*h^28 + 3060*z^12*c^14*h^28 + 216*z^21*c^3*h^30 + 2604*z^18*c^6*h^30 + 11880*z^15*c^9*h^30 + 8190*z^12*c^12*h^30 + 816*z^9*c^15*h^30 + 519*z^18*c^4*h^32 + 3312*z^15*c^7*h^32 + 7425*z^12*c^10*h^32 + 2730*z^9*c^13*h^32 + 153*z^6*c^16*h^32 + 12*z^18*c^2*h^34 + 846*z^15*c^5*h^34 + 3015*z^12*c^8*h^34 + 3300*z^9*c^11*h^34 + 630*z^6*c^14*h^34 + 18*z^3*c^17*h^34 + z^18*h^36 + 72*z^15*c^3*h^36 + 981*z^12*c^6*h^36 + 1900*z^9*c^9*h^36 + 990*z^6*c^12*h^36 + 90*z^3*c^15*h^36 + c^18*h^36 + 6*z^15*c*h^38 + 180*z^12*c^4*h^38 + 804*z^9*c^7*h^38 + 786*z^6*c^10*h^38 + 180*z^3*c^13*h^38 + 6*c^16*h^38 + 15*z^12*c^2*h^40 + 246*z^9*c^5*h^40 + 441*z^6*c^8*h^40 + 192*z^3*c^11*h^40 + 15*c^14*h^40 + 30*z^9*c^3*h^42 + 198*z^6*c^6*h^42 + 144*z^3*c^9*h^42 + 21*c^12*h^42 + 3*z^9*c*h^44 + 45*z^6*c^4*h^44 + 90*z^3*c^7*h^44 + 21*c^10*h^44 + 9*z^6*c^2*h^46 + 36*z^3*c^5*h^46 + 18*c^8*h^46 + 9*z^3*c^3*h^48 + 12*c^6*h^48 + 6*c^4*h^50 + 3*c^2*h^52)\nC2.genus()\n```\n\n\nThe kernel died multiple times. Is there any way to work around this??",
    "created_at": "2019-07-08T18:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27853#issuecomment-392918",
    "user": "https://github.com/meggrip"
}
```

I ran into the same issue with this complicated curve:

```
P.<z, c, h> = ProjectiveSpace(QQ, 2)
C2 = Curve(z^54 + 18*z^51*c*h^2 + 153*z^48*c^2*h^4 + 816*z^45*c^3*h^6 + 6*z^45*c*h^8 + 3060*z^42*c^4*h^8 + 90*z^42*c^2*h^10 + 8568*z^39*c^5*h^10 + 630*z^39*c^3*h^12 + 18564*z^36*c^6*h^12 + 2730*z^36*c^4*h^14 + 31824*z^33*c^7*h^14 + 15*z^36*c^2*h^16 + 8190*z^33*c^5*h^16 + 43758*z^30*c^8*h^16 + z^36*h^18 + 180*z^33*c^3*h^18 + 18018*z^30*c^6*h^18 + 48620*z^27*c^9*h^18 + 12*z^33*c*h^20 + 990*z^30*c^4*h^20 + 30030*z^27*c^7*h^20 + 43758*z^24*c^10*h^20 + 66*z^30*c^2*h^22 + 3300*z^27*c^5*h^22 + 38610*z^24*c^8*h^22 + 31824*z^21*c^11*h^22 + 240*z^27*c^3*h^24 + 7425*z^24*c^6*h^24 + 38610*z^21*c^9*h^24 + 18564*z^18*c^12*h^24 + 6*z^27*c*h^26 + 675*z^24*c^4*h^26 + 11880*z^21*c^7*h^26 + 30030*z^18*c^10*h^26 + 8568*z^15*c^13*h^26 + 54*z^24*c^2*h^28 + 1512*z^21*c^5*h^28 + 13860*z^18*c^8*h^28 + 18018*z^15*c^11*h^28 + 3060*z^12*c^14*h^28 + 216*z^21*c^3*h^30 + 2604*z^18*c^6*h^30 + 11880*z^15*c^9*h^30 + 8190*z^12*c^12*h^30 + 816*z^9*c^15*h^30 + 519*z^18*c^4*h^32 + 3312*z^15*c^7*h^32 + 7425*z^12*c^10*h^32 + 2730*z^9*c^13*h^32 + 153*z^6*c^16*h^32 + 12*z^18*c^2*h^34 + 846*z^15*c^5*h^34 + 3015*z^12*c^8*h^34 + 3300*z^9*c^11*h^34 + 630*z^6*c^14*h^34 + 18*z^3*c^17*h^34 + z^18*h^36 + 72*z^15*c^3*h^36 + 981*z^12*c^6*h^36 + 1900*z^9*c^9*h^36 + 990*z^6*c^12*h^36 + 90*z^3*c^15*h^36 + c^18*h^36 + 6*z^15*c*h^38 + 180*z^12*c^4*h^38 + 804*z^9*c^7*h^38 + 786*z^6*c^10*h^38 + 180*z^3*c^13*h^38 + 6*c^16*h^38 + 15*z^12*c^2*h^40 + 246*z^9*c^5*h^40 + 441*z^6*c^8*h^40 + 192*z^3*c^11*h^40 + 15*c^14*h^40 + 30*z^9*c^3*h^42 + 198*z^6*c^6*h^42 + 144*z^3*c^9*h^42 + 21*c^12*h^42 + 3*z^9*c*h^44 + 45*z^6*c^4*h^44 + 90*z^3*c^7*h^44 + 21*c^10*h^44 + 9*z^6*c^2*h^46 + 36*z^3*c^5*h^46 + 18*c^8*h^46 + 9*z^3*c^3*h^48 + 12*c^6*h^48 + 6*c^4*h^50 + 3*c^2*h^52)
C2.genus()
```


The kernel died multiple times. Is there any way to work around this??



---

archive/issue_comments_392919.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27853#issuecomment-392919",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_392920.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27853#issuecomment-392920",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_392921.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27853#issuecomment-392921",
    "user": "https://github.com/mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.
