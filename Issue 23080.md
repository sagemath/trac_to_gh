# Issue 23080: Very weird bug in digraphs or posets

Issue created by migration from https://trac.sagemath.org/ticket/23317

Original creator: mantepse

Original creation time: 2017-06-23 05:50:55


```
V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]
def _covers_P(w, v):
    def covers(c):
        for i in range(len(c)+1):
            d = list(c)
            d.insert(i, 1)
            yield Word(d, alphabet=[1,2])
            if i < len(c) and c[i] == 1:
                d = list(c)
                d[i] = 2
                yield Word(d, alphabet=[1,2])
                break
    return sum(w) == sum(v) + 1 and w in covers(v)

Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram().vertices()
```

yields

```
SystemError: NULL result without error in PyObject_Call
```


This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', I had no chance to test in earlier versions.  Yes, the code is stupid, but that's not the issue...


---

Comment by dcoudert created at 2017-06-23 06:58:44

I know nothing about `Poset`, but this is a side effect of the first `word` of your list

```
sage: print V
[word: , word: 1, word: 2, word: 11, word: 21, word: 12, word: 111, word: 22, word: 211, word: 121, word: 112, word: 1111]
sage: P = Poset((V, lambda x,y: _covers_P(y, x)))
sage: H = P.hasse_diagram()
sage: print H.vertices()
SystemError                               Traceback (most recent call last)
...
SystemError: NULL result without error in PyObject_Call
sage:
sage: V.pop(0)
word: 
sage: P = Poset((V, lambda x,y: _covers_P(y, x)))
sage: H = P.hasse_diagram()
sage: print H.vertices()
[word: 1, word: 11, word: 111, word: 1111, word: 112, word: 12, word: 121, word: 2, word: 21, word: 211, word: 22]
```

Don't know how to fix that.


---

Comment by jdemeyer created at 2017-06-23 07:42:46

When reporting bugs *please copy the traceback* too in the ticket description.


---

Comment by jdemeyer created at 2017-06-23 07:49:51

Changing component from graph theory to cython.


---

Comment by jdemeyer created at 2017-06-23 10:09:46

New commits:


---

Comment by jdemeyer created at 2017-06-23 10:09:46

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-06-23 10:13:02

I also fixed `longest_common_prefix/suffix` which was not handling correctly the case of an empty second argument.


---

Comment by mantepse created at 2017-06-23 11:05:02

Cool! I checked what I could, it seems to work flawlessly.  Thank you so much!


---

Comment by mantepse created at 2017-06-23 11:05:23

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2017-06-23 11:06:47

Thank you Jeroen.


---

Comment by vbraun created at 2017-06-25 15:44:57

Resolution: fixed
