# Issue 23080: Very weird bug in digraphs or posets

archive/issues_023080.json:
```json
{
    "body": "\n```\nV = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]\ndef _covers_P(w, v):\n    def covers(c):\n        for i in range(len(c)+1):\n            d = list(c)\n            d.insert(i, 1)\n            yield Word(d, alphabet=[1,2])\n            if i < len(c) and c[i] == 1:\n                d = list(c)\n                d[i] = 2\n                yield Word(d, alphabet=[1,2])\n                break\n    return sum(w) == sum(v) + 1 and w in covers(v)\n\nPoset((V, lambda x,y: _covers_P(y, x))).hasse_diagram().vertices()\n```\n\nyields\n\n```\nSystemError: NULL result without error in PyObject_Call\n```\n\n\nThis is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', I had no chance to test in earlier versions.  Yes, the code is stupid, but that's not the issue...\n\nIssue created by migration from https://trac.sagemath.org/ticket/23317\n\n",
    "created_at": "2017-06-23T05:50:55Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Very weird bug in digraphs or posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23080",
    "user": "@mantepse"
}
```

```
V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]
def _covers_P(w, v):
    def covers(c):
        for i in range(len(c)+1):
            d = list(c)
            d.insert(i, 1)
            yield Word(d, alphabet=[1,2])
            if i < len(c) and c[i] == 1:
                d = list(c)
                d[i] = 2
                yield Word(d, alphabet=[1,2])
                break
    return sum(w) == sum(v) + 1 and w in covers(v)

Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram().vertices()
```

yields

```
SystemError: NULL result without error in PyObject_Call
```


This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', I had no chance to test in earlier versions.  Yes, the code is stupid, but that's not the issue...

Issue created by migration from https://trac.sagemath.org/ticket/23317





---

archive/issue_comments_322563.json:
```json
{
    "body": "I know nothing about `Poset`, but this is a side effect of the first `word` of your list\n\n```\nsage: print V\n[word: , word: 1, word: 2, word: 11, word: 21, word: 12, word: 111, word: 22, word: 211, word: 121, word: 112, word: 1111]\nsage: P = Poset((V, lambda x,y: _covers_P(y, x)))\nsage: H = P.hasse_diagram()\nsage: print H.vertices()\nSystemError                               Traceback (most recent call last)\n...\nSystemError: NULL result without error in PyObject_Call\nsage:\nsage: V.pop(0)\nword: \nsage: P = Poset((V, lambda x,y: _covers_P(y, x)))\nsage: H = P.hasse_diagram()\nsage: print H.vertices()\n[word: 1, word: 11, word: 111, word: 1111, word: 112, word: 12, word: 121, word: 2, word: 21, word: 211, word: 22]\n```\n\nDon't know how to fix that.",
    "created_at": "2017-06-23T06:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322563",
    "user": "@dcoudert"
}
```

I know nothing about `Poset`, but this is a side effect of the first `word` of your list

```
sage: print V
[word: , word: 1, word: 2, word: 11, word: 21, word: 12, word: 111, word: 22, word: 211, word: 121, word: 112, word: 1111]
sage: P = Poset((V, lambda x,y: _covers_P(y, x)))
sage: H = P.hasse_diagram()
sage: print H.vertices()
SystemError                               Traceback (most recent call last)
...
SystemError: NULL result without error in PyObject_Call
sage:
sage: V.pop(0)
word: 
sage: P = Poset((V, lambda x,y: _covers_P(y, x)))
sage: H = P.hasse_diagram()
sage: print H.vertices()
[word: 1, word: 11, word: 111, word: 1111, word: 112, word: 12, word: 121, word: 2, word: 21, word: 211, word: 22]
```

Don't know how to fix that.



---

archive/issue_comments_322564.json:
```json
{
    "body": "When reporting bugs **please copy the traceback** too in the ticket description.",
    "created_at": "2017-06-23T07:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322564",
    "user": "@jdemeyer"
}
```

When reporting bugs **please copy the traceback** too in the ticket description.



---

archive/issue_comments_322565.json:
```json
{
    "body": "Changing component from graph theory to cython.",
    "created_at": "2017-06-23T07:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322565",
    "user": "@jdemeyer"
}
```

Changing component from graph theory to cython.



---

archive/issue_comments_322566.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-23T10:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322566",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_322567.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-23T10:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322567",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_322568.json:
```json
{
    "body": "I also fixed `longest_common_prefix/suffix` which was not handling correctly the case of an empty second argument.",
    "created_at": "2017-06-23T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322568",
    "user": "@jdemeyer"
}
```

I also fixed `longest_common_prefix/suffix` which was not handling correctly the case of an empty second argument.



---

archive/issue_comments_322569.json:
```json
{
    "body": "Cool! I checked what I could, it seems to work flawlessly.  Thank you so much!",
    "created_at": "2017-06-23T11:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322569",
    "user": "@mantepse"
}
```

Cool! I checked what I could, it seems to work flawlessly.  Thank you so much!



---

archive/issue_comments_322570.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-23T11:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322570",
    "user": "@mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_322571.json:
```json
{
    "body": "Thank you Jeroen.",
    "created_at": "2017-06-23T11:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322571",
    "user": "@dcoudert"
}
```

Thank you Jeroen.



---

archive/issue_comments_322572.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-25T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23080#issuecomment-322572",
    "user": "@vbraun"
}
```

Resolution: fixed
