# Issue 33498: Silence some docbuilding warnings

Issue created by migration from https://trac.sagemath.org/ticket/33735

Original creator: jhpalmieri

Original creation time: 2022-04-20 18:37:55

There are at least three types of warnings we might silence:

- `UserWarning: The soupsieve package is not installed` — this appears multiple times and I think it can be ignored.
- Several modules have been deprecated and as a result have no documentation anymore, so we should remove them from the reference manual. The corresponding warnings are `Warning: Missing title for sage.libs.pynac.pynac` and also for `sage.finance.time_series`, `sage.symbolic.getitem`, and `sage.symbolic.constants_c`.
- We might also remove other deprecated modules/packages from the reference manual, and in particular `sage.media` and `sage.finance`. I don't know if this is a good idea or not. Do it now or wait until the packages are actually removed?


---

Comment by jhpalmieri created at 2022-04-20 20:24:59

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2022-04-20 20:24:59

This branch removes many of these warnings. For reasons I don't understand, there is still one instance of `UserWarning: The soupsieve package is not installed...` and one of `warnings.warn(` remaining.
----
New commits:


---

Comment by mkoeppe created at 2022-04-23 19:38:23

The soupsieve warning will go away with #33738


---

Comment by tscrim created at 2022-04-25 00:33:59

I am not sure I support removing deprecated modules from the doc. I think they should be removed at the same time (with the doc saying they are deprecated).


---

Comment by jhpalmieri created at 2022-04-25 04:47:57

Replying to [comment:10 tscrim]:
> I am not sure I support removing deprecated modules from the doc. I think they should be removed at the same time (with the doc saying they are deprecated).

I haven't made any changes to the items in the third bullet point. I removed the items in the second, but they all look like this: [sage.symbolic.getitem page](https://doc.sagemath.org/html/en/reference/calculus/sage/symbolic/getitem.html).


---

Comment by jhpalmieri created at 2022-04-25 04:48:19

Replying to [comment:8 mkoeppe]:
> The soupsieve warning will go away with #33738

Should I remove that part of this ticket?


---

Comment by mkoeppe created at 2022-04-25 05:25:05

Yes, I think so


---

Comment by git created at 2022-04-25 22:07:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2022-04-25 22:08:42

Here is a new trimmed down version.


---

Comment by tscrim created at 2022-04-26 01:19:12

Replying to [comment:11 jhpalmieri]:
> Replying to [comment:10 tscrim]:
> > I am not sure I support removing deprecated modules from the doc. I think they should be removed at the same time (with the doc saying they are deprecated).
> 
> I haven't made any changes to the items in the third bullet point. I removed the items in the second, but they all look like this: [sage.symbolic.getitem page](https://doc.sagemath.org/html/en/reference/calculus/sage/symbolic/getitem.html).

Indeed, I agree it should be fixed. However, I propose doing it by adding a proper docstring with a title that says it is deprecated.


---

Comment by jhpalmieri created at 2022-04-26 03:44:08

Replying to [comment:18 tscrim]:
> Replying to [comment:11 jhpalmieri]:
> > Replying to [comment:10 tscrim]:
> > > I am not sure I support removing deprecated modules from the doc. I think they should be removed at the same time (with the doc saying they are deprecated).
> > 
> > I haven't made any changes to the items in the third bullet point. I removed the items in the second, but they all look like this: [sage.symbolic.getitem page](https://doc.sagemath.org/html/en/reference/calculus/sage/symbolic/getitem.html).
> 
> Indeed, I agree it should be fixed. However, I propose doing it by adding a proper docstring with a title that says it is deprecated.

Are you talking about deprecated modules like `sage.media` which still have proper docstrings, but which might say that they are deprecated, or are you talking about the ones with no current content? I hope that in the second case, the people who did the deprecation paid attention to what needed to be documented at the time and just forgot to clean up the reference manual. Further, the relevant tickets were closed 7 months ago and were in Sage 9.5, released at the end of January. So it will likely be 3 months with the documentation in its current stage, and I just don't believe that it's worth restoring them. Have there been any complaints about these pages?

That is, I prefer my approach. If you want to create docstrings for those files, I think it's a waste of time, but don't let that stop you.


---

Comment by tscrim created at 2022-04-26 04:01:42

Replying to [comment:19 jhpalmieri]:
> Replying to [comment:18 tscrim]:
> > Replying to [comment:11 jhpalmieri]:
> > > Replying to [comment:10 tscrim]:
> > > > I am not sure I support removing deprecated modules from the doc. I think they should be removed at the same time (with the doc saying they are deprecated).
> > > 
> > > I haven't made any changes to the items in the third bullet point. I removed the items in the second, but they all look like this: [sage.symbolic.getitem page](https://doc.sagemath.org/html/en/reference/calculus/sage/symbolic/getitem.html).
> > 
> > Indeed, I agree it should be fixed. However, I propose doing it by adding a proper docstring with a title that says it is deprecated.
> 
> Are you talking about deprecated modules like `sage.media` which still have proper docstrings, but which might say that they are deprecated, or are you talking about the ones with no current content? I hope that in the second case, the people who did the deprecation paid attention to what needed to be documented at the time and just forgot to clean up the reference manual. Further, the relevant tickets were closed 7 months ago and were in Sage 9.5, released at the end of January. So it will likely be 3 months with the documentation in its current stage, and I just don't believe that it's worth restoring them. Have there been any complaints about these pages?

I was thinking of the former case. Files with truely no content should be deleted altogether, but I am guessing you mean no docstring content. All I am thinking is having a title of something like:

```
"""
Media (deprecated)
"""
```

Nothing else is needed beyond this (other than possibly adding a ref to the deprecating ticket).

> That is, I prefer my approach. If you want to create docstrings for those files, I think it's a waste of time, but don't let that stop you.

These docstrings last a bit longer on the the Sage doc since they only get updated between major versions. Thus, it is possible it lasts longer than the files within beta versions of Sage.

Unfortunately I don't have my computer with me for the next few days. I won't be able to push something until Sunday.


---

Comment by jhpalmieri created at 2022-04-26 05:33:05

Replying to [comment:20 tscrim]:
> Replying to [comment:19 jhpalmieri]:
> > Are you talking about deprecated modules like `sage.media` which still have proper docstrings, but which might say that they are deprecated, or are you talking about the ones with no current content? I hope that in the second case, the people who did the deprecation paid attention to what needed to be documented at the time and just forgot to clean up the reference manual. Further, the relevant tickets were closed 7 months ago and were in Sage 9.5, released at the end of January. So it will likely be 3 months with the documentation in its current stage, and I just don't believe that it's worth restoring them. Have there been any complaints about these pages?
> 
> I was thinking of the former case.

Good, that makes sense.

> Files with truely no content should be deleted altogether, but I am guessing you mean no docstring content.

The pages I'm currently removing from the reference manual come from Python files that look like, for example (`symbolic/getitem.py`):

```
from sage.misc.lazy_import import lazy_import
lazy_import('sage.symbolic.expression',
            ['normalize_index_for_doctests', 'OperandsWrapper', 'restore_op_wrapper'],
            deprecation=32386)
```

(That's the entire file.)

> All I am thinking is having a title of something like:
> {{{
> """
> Media (deprecated)
> """
> }}}
> Nothing else is needed beyond this (other than possibly adding a ref to the deprecating ticket).

That could be done on this ticket or on a future ticket. Could the deprecation function somehow take care of this automatically, when you're deprecating a module or a package?

Anyway, as of now:
- `sage.media.wav` already has a line in its top-level docstring saying "This module (and all of sage.media) is deprecated."
- `sage.structure.graphics_file` has no such message.
- `sage.finance` doesn't have any such messages, either. 

We could change the reference manual `.rst` files instead:

```diff
diff --git a/src/doc/en/reference/finance/index.rst b/src/doc/en/reference/finance/index.rst
index 28bddb84cd..d47df818e2 100644
--- a/src/doc/en/reference/finance/index.rst
+++ b/src/doc/en/reference/finance/index.rst
@@ -1,6 +1,8 @@
 Quantitative Finance
 ======================
 
+This module is deprecated.
+
 .. toctree::
    :maxdepth: 2
 
diff --git a/src/doc/en/reference/misc/index.rst b/src/doc/en/reference/misc/index.rst
index 801af043f4..e1ac8e97e6 100644
--- a/src/doc/en/reference/misc/index.rst
+++ b/src/doc/en/reference/misc/index.rst
@@ -71,6 +71,8 @@ Database Access
 Media
 ~~~~~
 
+These modules are deprecated.
+
 .. toctree::
    :maxdepth: 1
 
```



---

Comment by mkoeppe created at 2022-04-26 21:12:29

Replying to [comment:21 jhpalmieri]:
> The pages I'm currently removing from the reference manual come from Python files that look like, for example (`symbolic/getitem.py`):
> {{{
> from sage.misc.lazy_import import lazy_import
> lazy_import('sage.symbolic.expression',
>             ['normalize_index_for_doctests', 'OperandsWrapper', 'restore_op_wrapper'],
>             deprecation=32386)
> }}}
> (That's the entire file.)

My mistake when working on the pynac integration ticket. I'll add the missing titles.


---

Comment by jhpalmieri created at 2022-04-26 21:51:03

Do we need the missing titles restored, or is it better to just remove the pages from the reference manual? There is no actual content in the file from the point of view of documentation.


---

Comment by mkoeppe created at 2022-04-26 21:58:08

I don't really have an opinion on this, just currently these files violate our style guide


---

Comment by tscrim created at 2022-04-26 22:00:37

Replying to [comment:24 mkoeppe]:
> I don't really have an opinion on this, just currently these files violate our style guide

IMO, we want the files there with the title in the documentation (and a deprecation message) because we should be documenting all of our files and changes. Even though it is deprecated, I don’t think it is good for a project to have “hidden” files.

This should be done on this ticket IMO as adding it back on.a future ticket would effectively be reverting this one.


---

Comment by jhpalmieri created at 2022-04-26 23:10:41

We already omit some Python files from the reference manual. For example we routinely omit files like `BLAH/all.py`, and there are other examples. Anyone who adds a major piece to Sage can decide to include, or not, the various component pieces; for example, several files in `modules/fp_graded/steenrod` are not in the reference manual, and I think it's not fair to call those "hidden"; rather, the authors used editorial discretion to decide whether something warranted inclusion. The recently deprecated files under discussion now just contain a deprecation warning and some import statements, and so they are an awful lot like `all.py` files.

I don't object to the files matching our style guidelines and having a title, but we don't need to keep them in the reference manual, and their presence there serves no purpose that I can see. Anyone who is interested enough to know what's going on with them will be able to understand the deprecation message. That is, they are documented, just not in the reference manual.


---

Comment by tscrim created at 2022-04-26 23:23:41

I would argue that those files (other than `all.py`, which are special and we have some general guidelines, or at least practices/conventions, about those) should be included in the reference manual. They are describing Sage’s functionality in a public-facing way. In this case, these files were previously there, but they would be apparently disappearing without a deprecation from that perspective.


---

Comment by jhpalmieri created at 2022-04-27 22:25:37

New commits:


---

Comment by git created at 2022-04-28 17:46:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-04-29 09:00:03

Thank you Matthias.

Are there any other issues to address? I am ready to set a positive review.


---

Comment by jhpalmieri created at 2022-04-29 15:39:14

I am happy to move ahead and deal with any other issues, as they arise, on future tickets.


---

Comment by tscrim created at 2022-04-29 23:38:40

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-04-29 23:38:40

Then positive review.


---

Comment by jhpalmieri created at 2022-04-30 03:23:40

Thanks!


---

Comment by mkoeppe created at 2022-05-07 18:35:50

Changing priority from major to blocker.


---

Comment by vbraun created at 2022-05-12 21:42:26

Resolution: fixed
