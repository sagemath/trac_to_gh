# Issue 10228: Deleting attached files causes major problems

Issue created by migration from https://trac.sagemath.org/ticket/10229

Original creator: flawrence

Original creation time: 2010-11-06 13:50:51

Assignee: was

Create a file, attach it in a Sage session, then delete/move the file.  Sage does not like this - and every command results in `OSError: [Errno 2] No such file or directory: '/path/to/attached/file.py`.  It won't even let you detach the file.

At the moment before each command is executed, Sage checks to see if any attached files have been modified.  Presumably instead it should except this error, remove the file from the list of attached files, and inform the user.

Discovered by rossk when reviewing #378.


---

Comment by mboratko created at 2011-11-17 06:47:33

Changing status from new to needs_info.


---

Comment by mboratko created at 2011-11-17 06:47:33

I wish I could include a patch here, but my sage install is having an unrelated issue right now, but this is an easy fix so it may be worth mentioning.

For sage/misc/preparser.py, wrap lines 1790 to 1794 in a try block, and use

{{except OSError, e:
      if e.errno==2:
          pass
}}

This will at least make it continue working. What would be our desired response to a moved/deleted file? I think it would make sense to detach it, since otherwise it will just keep attempting to go through this. Do we want to display a message to the user as well?

Sorry for not posting a patch, I will try to when I fix my sage install.


---

Attachment

Suppress exception message for moved or deleted attachments


---

Comment by mboratko created at 2011-11-17 07:05:55

Changing status from needs_info to needs_review.


---

Comment by ltw created at 2012-02-24 00:24:38

Here is a new patch that detaches inaccessible files and issues warnings. Doctests for the re-written function `modified_attached_files` have been overhauled as well. Please review!


---

Comment by ltw created at 2012-02-29 05:05:16

Changing status from needs_review to needs_work.


---

Comment by ltw created at 2012-02-29 05:05:16

Oops, looks like the patchbot isn't happy. Changing this to "needs work" until I (or someone else) has time to investigate.


---

Comment by ltw created at 2012-02-29 19:30:42

Changing status from needs_work to needs_review.


---

Comment by ltw created at 2012-02-29 19:30:42

Apply trac_10229-2.patch


---

Comment by ltw created at 2012-03-01 01:43:11

fixed `modified_attached_files()`


---

Attachment

Apply trac_10229-2.patch


---

Comment by johanbosman created at 2012-03-18 15:02:29

It looks like something introduced in sage-5.0.beta8 interferes with this as the following test fails:

```
sage -t  "devel/sage-main/sage/misc/preparser.py"
```



---

Comment by johanbosman created at 2012-03-18 15:02:29

Changing status from needs_review to needs_work.
