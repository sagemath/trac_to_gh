# Issue 31805: some work on intervals in posets

archive/issues_031805.json:
```json
{
    "body": "CC:  @tscrim @slel\n\ntrying to disentangle the situation, a little bit\n\nadding more explanations\n\nadding some typing annotations in one file\n\nIssue created by migration from https://trac.sagemath.org/ticket/32042\n\n",
    "created_at": "2021-06-23T15:34:06Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "some work on intervals in posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31805",
    "user": "@fchapoton"
}
```
CC:  @tscrim @slel

trying to disentangle the situation, a little bit

adding more explanations

adding some typing annotations in one file

Issue created by migration from https://trac.sagemath.org/ticket/32042





---

archive/issue_comments_454567.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-23T15:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454567",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454568.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-23T15:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454568",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_454569.json:
```json
{
    "body": "bot is morally green, please review",
    "created_at": "2021-06-24T15:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454569",
    "user": "@fchapoton"
}
```

bot is morally green, please review



---

archive/issue_comments_454570.json:
```json
{
    "body": "How does this compare with the timings before? I am not sure if the list comprehension might be faster.\n\nI guess in terms of documentation, it is better to just have one method...",
    "created_at": "2021-06-25T02:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454570",
    "user": "@tscrim"
}
```

How does this compare with the timings before? I am not sure if the list comprehension might be faster.

I guess in terms of documentation, it is better to just have one method...



---

archive/issue_comments_454571.json:
```json
{
    "body": "I have added some timings in the description. It seems that we may lose something when not storing any information.\n\nThe situation is quite complicated. There are two different levels at which stored information can make the computations faster. The first level is just to store in \"_leq_storage\" lazy attribute all the principal upper ideals as sets. The second level is to store all intervals. Both are somewhat memory-intensive (especially the second one) and could use something like bitset to be more compact.\n\nThe call of \"_leq_storage\" is speeding all posets computations. The pre-computation of intervals is useful in some specific methods, about computing congruences.\n\nI have no ideal solution. Suggestions are welcome.",
    "created_at": "2021-06-27T08:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454571",
    "user": "@fchapoton"
}
```

I have added some timings in the description. It seems that we may lose something when not storing any information.

The situation is quite complicated. There are two different levels at which stored information can make the computations faster. The first level is just to store in "_leq_storage" lazy attribute all the principal upper ideals as sets. The second level is to store all intervals. Both are somewhat memory-intensive (especially the second one) and could use something like bitset to be more compact.

The call of "_leq_storage" is speeding all posets computations. The pre-computation of intervals is useful in some specific methods, about computing congruences.

I have no ideal solution. Suggestions are welcome.



---

archive/issue_comments_454572.json:
```json
{
    "body": "Since there doesn't seem to be too significant of a slowdown, I propose we go with the code that is more concise. Thank you.",
    "created_at": "2021-06-28T04:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454572",
    "user": "@tscrim"
}
```

Since there doesn't seem to be too significant of a slowdown, I propose we go with the code that is more concise. Thank you.



---

archive/issue_comments_454573.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-28T04:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454573",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454574.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-06T21:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31805#issuecomment-454574",
    "user": "@vbraun"
}
```

Resolution: fixed
