# Issue 29994: Fix gp2c spkg-configure

Issue created by migration from https://trac.sagemath.org/ticket/30231

Original creator: mkoeppe

Original creation time: 2020-07-27 06:05:30

CC:  dimpase mjo slelievre

https://groups.google.com/d/msg/sage-devel/rZpwyAT2EZU/jiNWFinQBgAJ

Broken in b5d16d9927a (#29491)


---

Comment by mjo created at 2020-07-28 16:45:51

Changing status from new to needs_review.


---

Comment by mjo created at 2020-07-28 16:45:51

I need to think about this a little harder, but this new spkg-configure seems to do the trick. The basic problem is that the check phase itself can be skipped with `--with-system-gp2c=no`, but the location of pari.cfg is needed regardless. Therefore we can't do any calculation that affects discovery of pari.cfg in the check phase. The new version does it all in pre/post-check instead.
----
New commits:


---

Comment by git created at 2020-07-28 16:47:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2020-07-29 09:25:08

`SAGE_SPKG_DEPCHECK` was never meant to be called in pre-post/check (certainly never tested to do this, I think).
Not sure whether this will work, without testing all the corner cases.


---

Comment by mkoeppe created at 2020-07-29 17:32:48

Please run it on [GitHub](GitHub) CI and post the link...


---

Comment by slelievre created at 2020-07-30 00:53:41

Lacking m4 skills to do a full review, but this
solves the problem I reported on sage-devel for me.


---

Comment by mkoeppe created at 2020-07-30 17:25:48

Tests run at https://github.com/mkoeppe/sage/actions/runs/188912339


---

Comment by mkoeppe created at 2020-07-31 00:33:37

The run hasn't quite completed yet, but it's looking fine (as expected)


---

Comment by mkoeppe created at 2020-07-31 00:33:37

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-07-31 00:34:41

Changing priority from major to critical.


---

Comment by mjo created at 2020-07-31 00:53:43

Someday pari should be able to tell us where it put that stupid file, but until then, I can't think of a better way to do it than this.


---

Comment by slelievre created at 2020-07-31 01:09:09

Changing keywords from "" to "pari, gp2c, pari.cfg".


---

Comment by dimpase created at 2020-07-31 10:08:03

Replying to [comment:10 mjo]:
> Someday pari should be able to tell us where it put that stupid file, but until then, I can't think of a better way to do it than this.

I discussed this with upstream. The response was that it is left to pari/gp users to place it anywhere they want, full stop.


---

Comment by vbraun created at 2020-08-07 19:07:43

Resolution: fixed
