# Issue 31294: Update topcom to 0.17.8, fix cddlib header search

Issue created by migration from https://trac.sagemath.org/ticket/31531

Original creator: mkoeppe

Original creation time: 2021-03-21 17:36:49

CC:  fbissey @kliem mjo slelievre arojas tscrim

http://www.rambau.wm.uni-bayreuth.de/TOPCOM/

Changelog at http://www.rambau.wm.uni-bayreuth.de/TOPCOM/ChangeLog does not say what's new in 0.17.8

Our 0.17.7 tarball was built using `spkg-src` and deposited in https://github.com/mkoeppe/topcom; but there is no git repository


---

Comment by slelievre created at 2021-03-23 01:59:07

> Changelog at ​http://www.rambau.wm.uni-bayreuth.de/TOPCOM/ChangeLog does not say what's new in 0.17.8

The [TOPCOM home page](http://www.rambau.wm.uni-bayreuth.de/TOPCOM/)
has this about changes in 0.17.8:

> TOPCOM version 0.17.8 updates to gmp-6.1.1 and current
> automake/autoconf initialization. In the previous
> version 0.17.7, accidentally a wrong version of gmp
> was included. Furthermore, a bug was fixed where
> a `new[]` was not followed by a `delete[]` but a `delete`.


---

Comment by slelievre created at 2021-03-23 22:29:07

For very large problems, one can use Jordan-Joswig-Kastner's
parallel *[mptopcom](https://polymake.org/doku.php/mptopcom)* which
in addition to [TOPCOM](http://www.rambau.wm.uni-bayreuth.de/TOPCOM/),
is based on [Polymake](https://polymake.org/)
and [mts](http://cgm.cs.mcgill.ca/~avis/doc/tutorial.html).


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-09-18 01:38:32

Last package to fix for the cddlib header situation... #29413


---

Comment by slelievre created at 2021-11-12 10:34:30

Changing keywords from "" to "upgrade, topcom".


---

Comment by slelievre created at 2021-11-12 10:40:31

The TOPCOM homepage announces an upcoming new version:

> current version is 0.17.8,
> improved multi-threaded version 1.0.5 currently in test phase

and also points to [MTOPCOM](https://polymake.org/doku.php/mptopcom).


---

Comment by @kliem created at 2021-12-06 10:50:55

I didn't have any luck with it. I tried to figure it out the entire forenoon, which is way more time then I wanted to spend with it.

Tried to use the check from latte, but it always ends like this:


```
[topcom-0.17.8-beta.11] checking for CDDLIB >= 093c... configure: headers are not in cddlib/
[topcom-0.17.8-beta.11] configure: headers are not in inclusion directory
[topcom-0.17.8-beta.11] configure: headers are not in cdd/
[topcom-0.17.8-beta.11] not found
[topcom-0.17.8-beta.11] checking for CDDLIB >= 093c... configure: headers are not in cddlib/
[topcom-0.17.8-beta.11] configure: headers are not in inclusion directory
[topcom-0.17.8-beta.11] configure: headers are not in cdd/
[topcom-0.17.8-beta.11] not found
[topcom-0.17.8-beta.11] configure: error: The cddlib headers and library are required for topcom.
```


Probably didn't have gmp linked in and thus couldn't compile the tests.

I pushed the tries here: https://github.com/kliem/topcom/

All that seems to be needed is to modify `lib-src-reg/LPinterface.hh` to use `#include CDDLIB_SETOPER_H` and `#include CDDLIB_CDD_H`.

Anyway, it seems to be one big mess.


---

Comment by slelievre created at 2022-07-07 14:30:57

TOPCOM homepage now has TOPCOM 0.17.10, and pre-announces:

> improved multi-threaded version 1.0.x currently in test phase


---

Comment by mkoeppe created at 2022-09-28 22:47:05

Upstream topcom still doesn't handle the changed cddlib header locations

```
[topcom-1.1.1] mv -f .deps/SPXinterface.Tpo .deps/SPXinterface.Po
[topcom-1.1.1] mv -f .deps/QSOinterface.Tpo .deps/QSOinterface.Po
[topcom-1.1.1] In file included from LPinterface.cc:12:
[topcom-1.1.1] ./LPinterface.hh:24:10: fatal error: 'setoper.h' file not found
[topcom-1.1.1] #include "setoper.h"
[topcom-1.1.1]          ^~~~~~~~~~~
[topcom-1.1.1] 1 error generated.
[topcom-1.1.1] make[4]: *** [LPinterface.o] Error 1
[topcom-1.1.1] make[4]: *** Waiting for unfinished jobs....
[topcom-1.1.1] In file included from RegularityCheck.cc:13:
[topcom-1.1.1] In file included from ./RegularityCheck.hh:27:
[topcom-1.1.1] ./LPinterface.hh:24:10: fatal error: 'setoper.h' file not found
[topcom-1.1.1] #include "setoper.h"
[topcom-1.1.1]          ^~~~~~~~~~~
[topcom-1.1.1] 1 error generated.
```



---

Comment by arojas created at 2022-09-29 06:35:00

In 1.1.1 they finally support using system gmp, so for the Arch package I decided to give up on patching/rewriting the makefiles to use system cddlib and I'm just using the vendored one (not as bad as vendoring gmp IMO).
----
New commits:


---

Comment by dimpase created at 2022-10-03 09:29:41

we'd need to patch `./configure`, as there is still unconditional

```
make -C external cdd
```

in `configure.ac`


---

Comment by dimpase created at 2022-10-03 10:33:54


```
[topcom-1.1.1] Attempting to download from https://www.wm.uni-bayreuth.de/de/team/rambau_joerg/TOPCOM-Downloads/TOPCOM-1_1_1.tgz
[topcom-1.1.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[topcom-1.1.1] ERROR [transfer|run:135]: [Errno socket error] [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1123)
```


their website setup :-(


```
$ wget https://www.wm.uni-bayreuth.de/de/team/rambau_joerg/TOPCOM-Downloads/TOPCOM-1_1_1.tgz
--2022-10-03 11:35:16--  
https://www.wm.uni-bayreuth.de/de/team/rambau_joerg/TOPCOM-Downloads/TOPCOM-1_1_1.tgz
Resolving www.wm.uni-bayreuth.de (www.wm.uni-bayreuth.de)... 132.180.6.1
Connecting to www.wm.uni-bayreuth.de (www.wm.uni-bayreuth.de)|132.180.6.1|:443... connected.
ERROR: The certificate of ‘www.wm.uni-bayreuth.de’ is not trusted.
ERROR: The certificate of ‘www.wm.uni-bayreuth.de’ doesn't have a known issuer.
```



---

Comment by mkoeppe created at 2022-10-03 11:54:57

Upstream confirmed by email that they are not interested in having a github repo.
So I'd suggest that we create a repo for tracking upstream in github.com/sagemath, updating ​https://github.com/kliem/topcom/


---

Comment by dimpase created at 2022-10-03 17:04:07

Meanwhile I have patches for 1.1.1, which make it build. Testing now.


---

Comment by dimpase created at 2022-10-03 17:50:48

New commits:


---

Comment by dimpase created at 2022-10-03 17:51:51

not sure whether this works with Sage-built cddlib, but it does with system cddlib


---

Comment by dimpase created at 2022-10-03 20:07:06

Replying to [comment:22 Matthias Köppe]:
> Upstream confirmed by email that they are not interested in having a github repo.
> So I'd suggest that we create a repo for tracking upstream in github.com/sagemath, updating ​https://github.com/kliem/topcom/
> 
I am not sure whether proper updating makes much sense. It seems topcom underwent a serious rewrite since the last changes in https://github.com/kliem/topcom/, with qiute a bit of C++ and examples added - while changes in https://github.com/kliem/topcom/ were not used.
I sure can overwrite https://github.com/kliem/topcom/ with 1.1.1+my patches, otherwise it looks like too much work for little gain.


---

Comment by dimpase created at 2022-10-03 21:00:54

Changing status from new to needs_review.


---

Comment by dimpase created at 2022-10-03 21:00:54

apart from the issue of proper tarball hosting (Rambau asked his IT to look into it), looks good, and works on Linux (and on M1 macOS), with or without cddlib from the system.


---

Comment by git created at 2022-10-03 21:36:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-10-03 21:45:09

automatic downloading should work now, I put the tarball on my pages.


---

Comment by mkoeppe created at 2022-10-04 04:31:26

seems to work on macOS Intel too.


---

Comment by dimpase created at 2022-10-13 09:44:13

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2022-10-13 09:44:13

topcom 1.1.2 has been released


---

Comment by dimpase created at 2022-10-17 12:00:35

New commits:


---

Comment by git created at 2022-10-18 15:51:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-10-18 15:56:25

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2022-10-18 15:56:25

While our (or any system) `cddlib` is not thead-safe, TOPCOM interface does not use multithreading, so it can be used as it is. So this can go forward. (TOPCOM bundles an oldish (0.94j) cddlib with multithreading patches).

The next release of cddlib will contain the necessary for multithreading patch, see
https://github.com/cddlib/cddlib/commit/1210faf9ee9cf02e29fc67e11a8ea4e847c58ddd


---

Comment by mkoeppe created at 2022-10-19 00:47:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-10-23 20:49:35

Resolution: fixed
