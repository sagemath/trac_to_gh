# Issue 30153: Update PyPI url and a few others

archive/issues_030153.json:
```json
{
    "body": "CC:  slelievre\n\nKeywords: https, pypi, optional packages\n\nThis ticket updates the PyPI url in `src/sage/misc/package.py`.\n\nThis makes `sage --optional` work properly for PyPI packages.\n\nIn passing we update a few more urls.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30390\n\n",
    "created_at": "2020-08-19T13:16:30Z",
    "labels": [
        "scripts",
        "critical",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Update PyPI url and a few others",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30153",
    "user": "slelievre"
}
```
CC:  slelievre

Keywords: https, pypi, optional packages

This ticket updates the PyPI url in `src/sage/misc/package.py`.

This makes `sage --optional` work properly for PyPI packages.

In passing we update a few more urls.

Issue created by migration from https://trac.sagemath.org/ticket/30390





---

archive/issue_comments_429600.json:
```json
{
    "body": "I put component \"scripts\", please change if needed.\n----\nNew commits:",
    "created_at": "2020-08-19T13:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429600",
    "user": "slelievre"
}
```

I put component "scripts", please change if needed.
----
New commits:



---

archive/issue_comments_429601.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-19T13:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429601",
    "user": "slelievre"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_429602.json:
```json
{
    "body": "Changing type from enhancement to defect.",
    "created_at": "2020-08-19T13:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429602",
    "user": "slelievre"
}
```

Changing type from enhancement to defect.



---

archive/issue_comments_429603.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-19T14:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429603",
    "user": "slabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_429604.json:
```json
{
    "body": "I can confirm the bug on 9.2.beta9:\n\n\n```\n$ sage -optional\n[package]...............................[latest version] ([version])\n\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyx' at https://pypi.python.org/pypi\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pybtex' at https://pypi.python.org/pypi\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='nibabel' at https://pypi.python.org/pypi\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyflakes' at https://pypi.python.org/pypi\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n...\n```\n\n\nWith the branch applied, I still get a problem:\n\n\n```\n$ sage -optional\n[package]...............................[latest version] ([version])\n\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyx' at https://pypi.org/project\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pybtex' at https://pypi.org/project\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='nibabel' at https://pypi.org/project\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyflakes' at https://pypi.org/project\n  warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n...\n```\n",
    "created_at": "2020-08-19T14:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429604",
    "user": "slabbe"
}
```

I can confirm the bug on 9.2.beta9:


```
$ sage -optional
[package]...............................[latest version] ([version])

/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyx' at https://pypi.python.org/pypi
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pybtex' at https://pypi.python.org/pypi
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='nibabel' at https://pypi.python.org/pypi
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyflakes' at https://pypi.python.org/pypi
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
...
```


With the branch applied, I still get a problem:


```
$ sage -optional
[package]...............................[latest version] ([version])

/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyx' at https://pypi.org/project
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pybtex' at https://pypi.org/project
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='nibabel' at https://pypi.org/project
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/package.py:120: UserWarning: failed to fetch the version of pkg='pyflakes' at https://pypi.org/project
  warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
...
```




---

archive/issue_comments_429605.json:
```json
{
    "body": "Maybe this would improve the warning which get printed:\n\n\n```diff\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex 2b065b8..ef032d7 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -117,7 +117,7 @@ def pip_remote_version(pkg, pypi_url=DEFAULT_PYPI, ignore_URLError=False):\n     except URLError:\n         if ignore_URLError:\n             import warnings\n-            warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, pypi_url))\n+            warnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, url))\n             return\n         else:\n             raise\n```\n",
    "created_at": "2020-08-19T14:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429605",
    "user": "slabbe"
}
```

Maybe this would improve the warning which get printed:


```diff
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index 2b065b8..ef032d7 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -117,7 +117,7 @@ def pip_remote_version(pkg, pypi_url=DEFAULT_PYPI, ignore_URLError=False):
     except URLError:
         if ignore_URLError:
             import warnings
-            warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, pypi_url))
+            warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, url))
             return
         else:
             raise
```




---

archive/issue_comments_429606.json:
```json
{
    "body": "Also, it is true that url `https://pypi.org/project/pyflakes/json/` is now broken. That function needs to be updated.",
    "created_at": "2020-08-19T14:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429606",
    "user": "slabbe"
}
```

Also, it is true that url `https://pypi.org/project/pyflakes/json/` is now broken. That function needs to be updated.



---

archive/issue_comments_429607.json:
```json
{
    "body": "could you improve the text about `patches` ? There are no patches to be submitted on trac since, what, 2014?",
    "created_at": "2020-08-19T14:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429607",
    "user": "dimpase"
}
```

could you improve the text about `patches` ? There are no patches to be submitted on trac since, what, 2014?



---

archive/issue_comments_429608.json:
```json
{
    "body": "Main task here: fix `DEFAULT_PYPI` url in `src/sage/misc/package.py`.\n\nSorry I failed at that. Please help me figure it out.\n\nI went for fixing PyPI urls in any file that had them,\nand for fixing other urls in those files; maybe that\ngoes to a different ticket. Feel free to simplify here.\n\nAny further documentation updates are welcome but\nin my opinion belong in a separate ticket.",
    "created_at": "2020-08-19T14:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429608",
    "user": "slelievre"
}
```

Main task here: fix `DEFAULT_PYPI` url in `src/sage/misc/package.py`.

Sorry I failed at that. Please help me figure it out.

I went for fixing PyPI urls in any file that had them,
and for fixing other urls in those files; maybe that
goes to a different ticket. Feel free to simplify here.

Any further documentation updates are welcome but
in my opinion belong in a separate ticket.



---

archive/issue_comments_429609.json:
```json
{
    "body": "Got it.",
    "created_at": "2020-08-19T15:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429609",
    "user": "slelievre"
}
```

Got it.



---

archive/issue_comments_429610.json:
```json
{
    "body": "Changing `/pypi` to `/project` in the url after the domain name was wrong.",
    "created_at": "2020-08-19T15:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429610",
    "user": "slelievre"
}
```

Changing `/pypi` to `/project` in the url after the domain name was wrong.



---

archive/issue_comments_429611.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-19T15:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429611",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429612.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-19T15:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429612",
    "user": "slelievre"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_429613.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-19T18:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429613",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429614.json:
```json
{
    "body": "The documentation fixes regarding patch vs branch look good to me.\n\nPlease check that the url changes are an improvement, and that `sage --optional` now works with the changed `DEFAULT_PYPI` url used to get the json file for PyPI packages. Ideally, test with some optional packages installed.",
    "created_at": "2020-08-19T18:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429614",
    "user": "slelievre"
}
```

The documentation fixes regarding patch vs branch look good to me.

Please check that the url changes are an improvement, and that `sage --optional` now works with the changed `DEFAULT_PYPI` url used to get the json file for PyPI packages. Ideally, test with some optional packages installed.



---

archive/issue_comments_429615.json:
```json
{
    "body": "I have a problem with my current sage installation which can't access to internet. So, I can't properly review this ticket. But the new url seems good in the browser.",
    "created_at": "2020-08-20T08:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429615",
    "user": "slabbe"
}
```

I have a problem with my current sage installation which can't access to internet. So, I can't properly review this ticket. But the new url seems good in the browser.



---

archive/issue_comments_429616.json:
```json
{
    "body": "could you give a full example of a call that did not work before this branch, and is meant to work with it merged?",
    "created_at": "2020-08-20T15:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429616",
    "user": "dimpase"
}
```

could you give a full example of a call that did not work before this branch, and is meant to work with it merged?



---

archive/issue_comments_429617.json:
```json
{
    "body": "you are right, just updated description of the ticket to answer your question",
    "created_at": "2020-08-20T16:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429617",
    "user": "slabbe"
}
```

you are right, just updated description of the ticket to answer your question



---

archive/issue_comments_429618.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-21T07:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429618",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_429619.json:
```json
{
    "body": "lgtm",
    "created_at": "2020-08-21T07:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429619",
    "user": "dimpase"
}
```

lgtm



---

archive/issue_comments_429620.json:
```json
{
    "body": "\n```\n[dochtml] OSError: /home/release/Sage/src/doc/en/faq/faq-contribute.rst:169: WARNING: Title underline too short.\n```\n",
    "created_at": "2020-08-24T22:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429620",
    "user": "vbraun"
}
```


```
[dochtml] OSError: /home/release/Sage/src/doc/en/faq/faq-contribute.rst:169: WARNING: Title underline too short.
```




---

archive/issue_comments_429621.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-08-24T22:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429621",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_429622.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-25T06:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429622",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429623.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-08-25T07:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429623",
    "user": "dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_429624.json:
```json
{
    "body": "oops. Should be fixed now (docs build, checked)",
    "created_at": "2020-08-25T07:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429624",
    "user": "dimpase"
}
```

oops. Should be fixed now (docs build, checked)



---

archive/issue_comments_429625.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-30T08:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-429625",
    "user": "vbraun"
}
```

Resolution: fixed
