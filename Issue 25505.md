# Issue 25505: Change C variables to 64bit in BooleanFunction cython code

archive/issues_025505.json:
```json
{
    "body": "Keywords: Boolean Functions, days94\n\nFrom the metaticket #11450:\n\"A lot of computation were made using ints, I change most of them to longs, also adding a warning when computations will overflow. I changed the code to compute the hamming weight to deal with 64 bits integers.\"\n\nIssue created by migration from https://trac.sagemath.org/ticket/25742\n\n",
    "created_at": "2018-07-02T14:11:22Z",
    "labels": [
        "component: cryptography",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Change C variables to 64bit in BooleanFunction cython code",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25505",
    "user": "https://github.com/pfasante"
}
```
Keywords: Boolean Functions, days94

From the metaticket #11450:
"A lot of computation were made using ints, I change most of them to longs, also adding a warning when computations will overflow. I changed the code to compute the hamming weight to deal with 64 bits integers."

Issue created by migration from https://trac.sagemath.org/ticket/25742





---

archive/issue_comments_359341.json:
```json
{
    "body": "You want to use\n\n```\nfrom libc.stdint cimport uint64_t    # or int64_t\n```\n\nfor this.",
    "created_at": "2018-07-02T14:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359341",
    "user": "https://github.com/jdemeyer"
}
```

You want to use

```
from libc.stdint cimport uint64_t    # or int64_t
```

for this.



---

archive/issue_comments_359342.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-03T10:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359342",
    "user": "https://github.com/pfasante"
}
```

New commits:



---

archive/issue_comments_359343.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-03T10:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359343",
    "user": "https://github.com/pfasante"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_359344.json:
```json
{
    "body": "Trivial nitpick:\n\n```diff\n-raise NotImplementedError(\"Currently Walsh-hadamard transform can only be computed for up to %d variables.\" % (slong,))\n+raise NotImplementedError(\"currently Walsh-Hadamard transform can only be computed for up to %d variables\" % (slong,))\n```\n\nit is a Python convention that error messages are not sentences.",
    "created_at": "2018-07-03T11:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359344",
    "user": "https://github.com/tscrim"
}
```

Trivial nitpick:

```diff
-raise NotImplementedError("Currently Walsh-hadamard transform can only be computed for up to %d variables." % (slong,))
+raise NotImplementedError("currently Walsh-Hadamard transform can only be computed for up to %d variables" % (slong,))
```

it is a Python convention that error messages are not sentences.



---

archive/issue_comments_359345.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T11:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359345",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359346.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-23T20:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359346",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359347.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-11-23T20:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359347",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359348.json:
```json
{
    "body": "A `cdef enum` corresponds to an `int` in C. So this won't work correctly on 32-bit systems.",
    "created_at": "2018-11-23T20:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359348",
    "user": "https://github.com/jdemeyer"
}
```

A `cdef enum` corresponds to an `int` in C. So this won't work correctly on 32-bit systems.



---

archive/issue_comments_359349.json:
```json
{
    "body": "If you need `CHAR_BITS`, you can `cimport` it from `libc.limits`.",
    "created_at": "2018-11-23T20:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359349",
    "user": "https://github.com/jdemeyer"
}
```

If you need `CHAR_BITS`, you can `cimport` it from `libc.limits`.



---

archive/issue_comments_359350.json:
```json
{
    "body": "`1UL` is not the same as `<uint64_t>1`, so again this may not work correctly on 32-bit systems.",
    "created_at": "2018-11-23T20:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359350",
    "user": "https://github.com/jdemeyer"
}
```

`1UL` is not the same as `<uint64_t>1`, so again this may not work correctly on 32-bit systems.



---

archive/issue_comments_359351.json:
```json
{
    "body": "This looks wrong or at least very misleading:\n\n```\ntemp = <int64_t *>check_allocarray(n, sizeof(long))\n```\n\nYou allocate an array of `n` items of type `long` but assign it to an `int64_t` array.",
    "created_at": "2018-11-23T20:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359351",
    "user": "https://github.com/jdemeyer"
}
```

This looks wrong or at least very misleading:

```
temp = <int64_t *>check_allocarray(n, sizeof(long))
```

You allocate an array of `n` items of type `long` but assign it to an `int64_t` array.



---

archive/issue_comments_359352.json:
```json
{
    "body": "Thanks for checking Jeroen. I'll have a look into these things.",
    "created_at": "2018-11-23T22:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359352",
    "user": "https://github.com/pfasante"
}
```

Thanks for checking Jeroen. I'll have a look into these things.



---

archive/issue_comments_359353.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-24T11:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359353",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359354.json:
```json
{
    "body": "Oh noes, how did #25766 ended up in here? :/",
    "created_at": "2018-11-24T11:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359354",
    "user": "https://github.com/pfasante"
}
```

Oh noes, how did #25766 ended up in here? :/



---

archive/issue_comments_359355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-11-24T19:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_359356.json:
```json
{
    "body": "OK, I removed the wrong commits.\n\nNot super sure thou about my changes, as I'm not experienced in 32bit compatible coding. Is it ok like this?",
    "created_at": "2018-11-24T19:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359356",
    "user": "https://github.com/pfasante"
}
```

OK, I removed the wrong commits.

Not super sure thou about my changes, as I'm not experienced in 32bit compatible coding. Is it ok like this?



---

archive/issue_comments_359357.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-11-24T19:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359357",
    "user": "https://github.com/pfasante"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359358.json:
```json
{
    "body": "1. There is still this: `cdef uint64_t m = (~0UL) >> s`\n\n2. Change `hamming_weight_int` -> `hamming_weight` also in the comment\n\n3. The return value of `hamming_weight` is a small number, so it might be more efficient to return an `int` instead of a `uint64_t`.\n\n4. It would be more efficient to change the signature of `walsh_hadamard` to `cdef int walsh_hadamard(int64_t *f, uint64_t ldn) except -1` (to avoid returning the Python object `None`). Same for `reed_muller`.\n\n5. You need to explain what the inputs of `reed_muller` mean. What is `f` and what is `ldn`?\n\n6. In the `reed_muller` doctest: add some larger examples. Right now, the doctest is not even using 32 bits, so it doesn't really test the new code.",
    "created_at": "2018-11-24T20:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359358",
    "user": "https://github.com/jdemeyer"
}
```

1. There is still this: `cdef uint64_t m = (~0UL) >> s`

2. Change `hamming_weight_int` -> `hamming_weight` also in the comment

3. The return value of `hamming_weight` is a small number, so it might be more efficient to return an `int` instead of a `uint64_t`.

4. It would be more efficient to change the signature of `walsh_hadamard` to `cdef int walsh_hadamard(int64_t *f, uint64_t ldn) except -1` (to avoid returning the Python object `None`). Same for `reed_muller`.

5. You need to explain what the inputs of `reed_muller` mean. What is `f` and what is `ldn`?

6. In the `reed_muller` doctest: add some larger examples. Right now, the doctest is not even using 32 bits, so it doesn't really test the new code.



---

archive/issue_comments_359359.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-11-24T20:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359359",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359360.json:
```json
{
    "body": "Taking a step back, what's the motivation for all these changes? For `hamming_weight`, I can see why you want to use 64 bits.  But why for `yellow_code` for example?",
    "created_at": "2018-11-26T08:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359360",
    "user": "https://github.com/jdemeyer"
}
```

Taking a step back, what's the motivation for all these changes? For `hamming_weight`, I can see why you want to use 64 bits.  But why for `yellow_code` for example?



---

archive/issue_comments_359361.json:
```json
{
    "body": "Mh maybe you are right Jeroen.\nI just started to convert every 32bit variable to 64bit..\n\nI'll rework the patch to use 64bit only where it makes sense.",
    "created_at": "2018-11-26T12:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25505#issuecomment-359361",
    "user": "https://github.com/pfasante"
}
```

Mh maybe you are right Jeroen.
I just started to convert every 32bit variable to 64bit..

I'll rework the patch to use 64bit only where it makes sense.
