# Issue 25505: Change C variables to 64bit in BooleanFunction cython code

Issue created by migration from https://trac.sagemath.org/ticket/25742

Original creator: asante

Original creation time: 2018-07-02 14:11:22

Keywords: Boolean Functions, days94

From the metaticket #11450:
"A lot of computation were made using ints, I change most of them to longs, also adding a warning when computations will overflow. I changed the code to compute the hamming weight to deal with 64 bits integers."


---

Comment by jdemeyer created at 2018-07-02 14:13:31

You want to use

```
from libc.stdint cimport uint64_t    # or int64_t
```

for this.


---

Comment by asante created at 2018-07-03 10:57:00

New commits:


---

Comment by asante created at 2018-07-03 10:57:00

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-07-03 11:06:22

Trivial nitpick:

```diff
-raise NotImplementedError("Currently Walsh-hadamard transform can only be computed for up to %d variables." % (slong,))
+raise NotImplementedError("currently Walsh-Hadamard transform can only be computed for up to %d variables" % (slong,))
```

it is a Python convention that error messages are not sentences.


---

Comment by git created at 2018-07-03 11:09:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-11-23 20:08:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-11-23 20:17:55

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-11-23 20:17:55

A `cdef enum` corresponds to an `int` in C. So this won't work correctly on 32-bit systems.


---

Comment by jdemeyer created at 2018-11-23 20:18:35

If you need `CHAR_BITS`, you can `cimport` it from `libc.limits`.


---

Comment by jdemeyer created at 2018-11-23 20:19:34

`1UL` is not the same as `<uint64_t>1`, so again this may not work correctly on 32-bit systems.


---

Comment by jdemeyer created at 2018-11-23 20:21:44

This looks wrong or at least very misleading:

```
temp = <int64_t *>check_allocarray(n, sizeof(long))
```

You allocate an array of `n` items of type `long` but assign it to an `int64_t` array.


---

Comment by asante created at 2018-11-23 22:28:01

Thanks for checking Jeroen. I'll have a look into these things.


---

Comment by git created at 2018-11-24 11:37:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2018-11-24 11:39:54

Oh noes, how did #25766 ended up in here? :/


---

Comment by git created at 2018-11-24 19:01:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by asante created at 2018-11-24 19:04:11

OK, I removed the wrong commits.

Not super sure thou about my changes, as I'm not experienced in 32bit compatible coding. Is it ok like this?


---

Comment by asante created at 2018-11-24 19:04:11

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-11-24 20:54:13

1. There is still this: `cdef uint64_t m = (~0UL) >> s`

2. Change `hamming_weight_int` -> `hamming_weight` also in the comment

3. The return value of `hamming_weight` is a small number, so it might be more efficient to return an `int` instead of a `uint64_t`.

4. It would be more efficient to change the signature of `walsh_hadamard` to `cdef int walsh_hadamard(int64_t *f, uint64_t ldn) except -1` (to avoid returning the Python object `None`). Same for `reed_muller`.

5. You need to explain what the inputs of `reed_muller` mean. What is `f` and what is `ldn`?

6. In the `reed_muller` doctest: add some larger examples. Right now, the doctest is not even using 32 bits, so it doesn't really test the new code.


---

Comment by jdemeyer created at 2018-11-24 20:54:13

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-11-26 08:56:30

Taking a step back, what's the motivation for all these changes? For `hamming_weight`, I can see why you want to use 64 bits.  But why for `yellow_code` for example?


---

Comment by asante created at 2018-11-26 12:17:50

Mh maybe you are right Jeroen.
I just started to convert every 32bit variable to 64bit..

I'll rework the patch to use 64bit only where it makes sense.
