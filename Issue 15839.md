# Issue 15839: Python 3 preparation: Py3 has no more the special object-function "__nonzero__"

Issue created by migration from Trac.

Original creator: wluebbe

Original creation time: 2014-04-07 08:53:31

CC:  embray

Keywords: python3

The tool 2to3 renames `__nonzero__` to `__bool__`.


But the code has to depend on the Python version!

There are 25 effected modules. 

This ticket is tracked as a dependency of meta-ticket ticket:16052.


---

Comment by jdemeyer created at 2016-05-02 13:35:29

Changing component from distribution to python3.


---

Comment by chapoton created at 2016-11-17 16:16:41

one step done (for the rings folder) in #21887


---

Comment by chapoton created at 2016-11-18 20:55:30

another step in #21898


---

Comment by chapoton created at 2017-01-22 14:32:14

Here is a brute-force tentative

* search and replace `__nonzero__` by `__bool__`
* remove the former lines that have become `__bool__ = __bool__`

Let us see what happens..
----
New commits:


---

Comment by chapoton created at 2017-01-25 10:24:49

ok, this was too brutal.


---

Comment by git created at 2017-01-25 10:32:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2017-01-25 15:24:07

ok, still not subtle enough..


---

Comment by tscrim created at 2017-01-25 16:17:22

The way I've seen for this to be 2/3 compatible is to have `__bool__` be an alias for `__nonzero__` (or vice versa). The other way we could hack this is have in `SageObject`, as almost everything has this as a base class, we implement:

```python
def __bool__(self):
    return self.__nonzero__()
```



---

Comment by chapoton created at 2017-01-25 16:24:12

Hello Travis,

if you feel like giving it a try, please do. There is an abstract method `__nonzero__` somewhere, which is the last place where `__nonzero__` is not an alias (in python files).


---

Comment by tscrim created at 2017-01-25 18:15:01

I think we should keep things as `__nonzero__` for right now (up to having an explicit alias) for right now since we are in Python2 and to avoid the extra redirection. Although I guess to test how much this would cover things for Python3, it would have to be with a Python3 build.


---

Comment by chapoton created at 2017-11-23 13:05:31

why sage-pending ?


---

Comment by embray created at 2017-11-23 13:59:18

I might be misusing the milestone but this seems to be a very general task ticket not tied to a specific release milestone...?


---

Comment by chapoton created at 2017-11-29 07:36:24

is this fixed by #24294?


---

Comment by chapoton created at 2017-11-29 07:36:24

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-11-29 14:47:54

Replying to [comment:13 tscrim]:
> The way I've seen for this to be 2/3 compatible is to have `__bool__` be an alias for `__nonzero__` (or vice versa). The other way we could hack this is have in `SageObject`, as almost everything has this as a base class, we implement:
> {{{#!python
> def __bool__(self):
>     return self.__nonzero__()
> }}}

I know that this reply is pointless is now, but I guess that something like that would have worked :-)

We are doing something similar for division in `CategoryObject`:

```
from __future__ import division

cdef class CategoryObject(SageObject):
    def __div__(self, other):
        return self / other
```



---

Comment by jdemeyer created at 2017-11-29 14:47:54

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-11-29 15:21:13

Replying to [comment:20 chapoton]:
> is this fixed by #24294?

I don't think so by itself--I believe I've found some other examples affected by this (in non-Cython modules) but I could be mistaken.


---

Comment by embray created at 2017-12-12 08:23:33

Resolution: wontfix
