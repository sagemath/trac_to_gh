# Issue 29025: Combination unranking new algorithm

Issue created by migration from https://trac.sagemath.org/ticket/29262

Original creator: @agenitrini

Original creation time: 2020-02-29 15:54:45




---

Comment by @agenitrini created at 2020-02-29 16:03:58

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by @agenitrini created at 2020-02-29 16:03:58

Changing keywords from "" to "combination unranking".


---

Comment by @agenitrini created at 2020-02-29 16:03:58

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @agenitrini created at 2020-02-29 16:07:18

Changing status from new to needs_review.


---

Comment by git created at 2020-02-29 16:12:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-03-02 00:42:13

This is quite a nice improvement. So it would be good to add `[DGH20]` to the master references file (as `[DGH2020]`) and then cite it as `[DGH20]_` (or with the changed name `[DGH2020]_`). Other than that, a few PEP8 space around operators:

```diff
-if k < n/2:
+if k < n / 2:

-k = n-k
+k = n - k

-while d < k-1:
+while d < k - 1:

-if n-1-m==0:
+if n - 1 - m == 0:

-B = (B * (k-1-i))//(n-1-m)
+B = (B * (k-1-i)) // (n-1-m)

-D[k-1] = n+r+k-1-B
+D[k-1] = n + r + k - 1 - B
```

and these can be simplified:

```diff
-D = [0 for i in range(k)]
+D = [0]*k

-d = d + 1
+d += 1

-i = i + 1
+i += 1

-n = n - 1
+n += 1

-r = r - B
+r -= B

-m = m + 1
+m += 1

-j = j + 1
+j += 1
```

Also would it be possible to keep the same variable names as before? While I doubt anyone is explicitly calling it with `n=foo`, it is still good in terms of being fully backwards compatible. Plus I feel it would be better to define `n0 = n` instead of the other way around.


---

Comment by git created at 2020-03-02 17:58:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-03-04 02:24:58

Looks like you have some corner case issues appearing in `src/sage/combinat/subset.py`.


---

Comment by tscrim created at 2020-03-04 02:24:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-03-04 09:10:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-04 13:21:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @agenitrini created at 2020-03-05 11:57:02

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2020-03-05 12:17:43

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-03-05 12:17:43

Thank you. LGTM.


---

Comment by vbraun created at 2020-03-08 23:56:40

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-03-08 23:56:40


```
sage -t --long --warn-long 35.8 src/sage/rings/polynomial/pbori.pyx  # 3 doctests failed
sage -t --long --warn-long 35.8 src/sage/matrix/matrix_mpolynomial_dense.pyx  # 4 doctests failed
```



---

Comment by tscrim created at 2020-03-09 03:05:01

So here is the problem:

```
sage: from sage.combinat.combination import from_rank
sage: from_rank(0, 2, 1)
(1,)
sage: from_rank(1, 2, 1)
(2,)
```

instead this should be `(0,)` and `(1,)`. I haven't traced through the algorithm, but from testing, this seems to be just some special corner case (if indeed there is no bug in the implementation). It works on larger values of `n` and `k`.


---

Comment by git created at 2020-03-09 08:33:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @agenitrini created at 2020-03-09 08:38:29

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2020-03-09 12:22:04

Thank you. Green patchbot now. (Interestingly, there was a green patchbot on the previous version, so I was disregarding the other failing tests.) However, I am going to add a more systematic test (which is how I caught the corner case) on a push tomorrow morning. Should be trivial to review.


---

Comment by tscrim created at 2020-03-09 23:59:13

Here is my trivial change and additional doctest.
----
New commits:


---

Comment by tscrim created at 2020-03-11 02:35:18

Green bot. If you agree with my changes, then please set it back to a positive review.


---

Comment by @agenitrini created at 2020-03-11 06:46:08

The tests are fine to me, thanks.


---

Comment by tscrim created at 2020-03-11 07:35:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-03-12 22:48:16

Resolution: fixed
