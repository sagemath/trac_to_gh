# Issue 29025: Combination unranking new algorithm

archive/issues_029025.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/29262\n\n",
    "created_at": "2020-02-29T15:54:45Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Combination unranking new algorithm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29025",
    "user": "@agenitrini"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/29262





---

archive/issue_comments_410779.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2020-02-29T16:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410779",
    "user": "@agenitrini"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_410780.json:
```json
{
    "body": "Changing keywords from \"\" to \"combination unranking\".",
    "created_at": "2020-02-29T16:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410780",
    "user": "@agenitrini"
}
```

Changing keywords from "" to "combination unranking".



---

archive/issue_comments_410781.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2020-02-29T16:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410781",
    "user": "@agenitrini"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_410782.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-29T16:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410782",
    "user": "@agenitrini"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_410783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-29T16:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410783",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410784.json:
```json
{
    "body": "This is quite a nice improvement. So it would be good to add `[DGH20]` to the master references file (as `[DGH2020]`) and then cite it as `[DGH20]_` (or with the changed name `[DGH2020]_`). Other than that, a few PEP8 space around operators:\n\n```diff\n-if k < n/2:\n+if k < n / 2:\n\n-k = n-k\n+k = n - k\n\n-while d < k-1:\n+while d < k - 1:\n\n-if n-1-m==0:\n+if n - 1 - m == 0:\n\n-B = (B * (k-1-i))//(n-1-m)\n+B = (B * (k-1-i)) // (n-1-m)\n\n-D[k-1] = n+r+k-1-B\n+D[k-1] = n + r + k - 1 - B\n```\n\nand these can be simplified:\n\n```diff\n-D = [0 for i in range(k)]\n+D = [0]*k\n\n-d = d + 1\n+d += 1\n\n-i = i + 1\n+i += 1\n\n-n = n - 1\n+n += 1\n\n-r = r - B\n+r -= B\n\n-m = m + 1\n+m += 1\n\n-j = j + 1\n+j += 1\n```\n\nAlso would it be possible to keep the same variable names as before? While I doubt anyone is explicitly calling it with `n=foo`, it is still good in terms of being fully backwards compatible. Plus I feel it would be better to define `n0 = n` instead of the other way around.",
    "created_at": "2020-03-02T00:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410784",
    "user": "tscrim"
}
```

This is quite a nice improvement. So it would be good to add `[DGH20]` to the master references file (as `[DGH2020]`) and then cite it as `[DGH20]_` (or with the changed name `[DGH2020]_`). Other than that, a few PEP8 space around operators:

```diff
-if k < n/2:
+if k < n / 2:

-k = n-k
+k = n - k

-while d < k-1:
+while d < k - 1:

-if n-1-m==0:
+if n - 1 - m == 0:

-B = (B * (k-1-i))//(n-1-m)
+B = (B * (k-1-i)) // (n-1-m)

-D[k-1] = n+r+k-1-B
+D[k-1] = n + r + k - 1 - B
```

and these can be simplified:

```diff
-D = [0 for i in range(k)]
+D = [0]*k

-d = d + 1
+d += 1

-i = i + 1
+i += 1

-n = n - 1
+n += 1

-r = r - B
+r -= B

-m = m + 1
+m += 1

-j = j + 1
+j += 1
```

Also would it be possible to keep the same variable names as before? While I doubt anyone is explicitly calling it with `n=foo`, it is still good in terms of being fully backwards compatible. Plus I feel it would be better to define `n0 = n` instead of the other way around.



---

archive/issue_comments_410785.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-02T17:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410785",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410786.json:
```json
{
    "body": "Looks like you have some corner case issues appearing in `src/sage/combinat/subset.py`.",
    "created_at": "2020-03-04T02:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410786",
    "user": "tscrim"
}
```

Looks like you have some corner case issues appearing in `src/sage/combinat/subset.py`.



---

archive/issue_comments_410787.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-04T02:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410787",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_410788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-04T09:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410788",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-04T13:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410789",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410790.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-05T11:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410790",
    "user": "@agenitrini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_410791.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-05T12:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410791",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410792.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2020-03-05T12:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410792",
    "user": "tscrim"
}
```

Thank you. LGTM.



---

archive/issue_comments_410793.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-03-08T23:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410793",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_410794.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 35.8 src/sage/rings/polynomial/pbori.pyx  # 3 doctests failed\nsage -t --long --warn-long 35.8 src/sage/matrix/matrix_mpolynomial_dense.pyx  # 4 doctests failed\n```\n",
    "created_at": "2020-03-08T23:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410794",
    "user": "vbraun"
}
```


```
sage -t --long --warn-long 35.8 src/sage/rings/polynomial/pbori.pyx  # 3 doctests failed
sage -t --long --warn-long 35.8 src/sage/matrix/matrix_mpolynomial_dense.pyx  # 4 doctests failed
```




---

archive/issue_comments_410795.json:
```json
{
    "body": "So here is the problem:\n\n```\nsage: from sage.combinat.combination import from_rank\nsage: from_rank(0, 2, 1)\n(1,)\nsage: from_rank(1, 2, 1)\n(2,)\n```\n\ninstead this should be `(0,)` and `(1,)`. I haven't traced through the algorithm, but from testing, this seems to be just some special corner case (if indeed there is no bug in the implementation). It works on larger values of `n` and `k`.",
    "created_at": "2020-03-09T03:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410795",
    "user": "tscrim"
}
```

So here is the problem:

```
sage: from sage.combinat.combination import from_rank
sage: from_rank(0, 2, 1)
(1,)
sage: from_rank(1, 2, 1)
(2,)
```

instead this should be `(0,)` and `(1,)`. I haven't traced through the algorithm, but from testing, this seems to be just some special corner case (if indeed there is no bug in the implementation). It works on larger values of `n` and `k`.



---

archive/issue_comments_410796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-09T08:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410796",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410797.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-09T08:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410797",
    "user": "@agenitrini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_410798.json:
```json
{
    "body": "Thank you. Green patchbot now. (Interestingly, there was a green patchbot on the previous version, so I was disregarding the other failing tests.) However, I am going to add a more systematic test (which is how I caught the corner case) on a push tomorrow morning. Should be trivial to review.",
    "created_at": "2020-03-09T12:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410798",
    "user": "tscrim"
}
```

Thank you. Green patchbot now. (Interestingly, there was a green patchbot on the previous version, so I was disregarding the other failing tests.) However, I am going to add a more systematic test (which is how I caught the corner case) on a push tomorrow morning. Should be trivial to review.



---

archive/issue_comments_410799.json:
```json
{
    "body": "Here is my trivial change and additional doctest.\n----\nNew commits:",
    "created_at": "2020-03-09T23:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410799",
    "user": "tscrim"
}
```

Here is my trivial change and additional doctest.
----
New commits:



---

archive/issue_comments_410800.json:
```json
{
    "body": "Green bot. If you agree with my changes, then please set it back to a positive review.",
    "created_at": "2020-03-11T02:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410800",
    "user": "tscrim"
}
```

Green bot. If you agree with my changes, then please set it back to a positive review.



---

archive/issue_comments_410801.json:
```json
{
    "body": "The tests are fine to me, thanks.",
    "created_at": "2020-03-11T06:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410801",
    "user": "@agenitrini"
}
```

The tests are fine to me, thanks.



---

archive/issue_comments_410802.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-11T07:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410802",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410803.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-12T22:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29025#issuecomment-410803",
    "user": "vbraun"
}
```

Resolution: fixed
