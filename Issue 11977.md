# Issue 11977: float('nan')>1 crashes Sage.

archive/issues_011977.json:
```json
{
    "body": "Assignee: @aghitza\n\nThe optimizations in #10314 ignored the fact that floating point numbers can be nan, which leads to it being trivial to completely crash Sage.  I ran into exactly this when doing real work, so I'm annoyed. \n\n\n```\nsage: float('nan') > 1\n\nProgram received signal SIGFPE, Arithmetic exception.\n0x00007fff89c3b82a in __kill ()\n(gdb) bt\n#0  0x00007fff89c3b82a in __kill ()\n#1  0x00000001013c530e in __gmp_invalid_operation ()\n#2  0x00000001013cf579 in __gmpz_cmp_d ()\n#3  0x00000001035fd09e in __pyx_pf_4sage_5rings_7integer_7Integer_7__richcmp__ (__pyx_v_left=0x5bd7, __pyx_v_right=0x10b2a0470, __pyx_v_op=0) at integer.c:7855\n```\n\n\nThe traceback points to this code integer.pyx:\n\n```\n            elif PyFloat_CheckExact(left):\n                c = -mpz_cmp_d((<Integer>right).value, PyFloat_AsDouble(left))\n```\n\n\nThere is similar code a few lines down for the other direction, hence this also crashes\n\n```\nsage: 1 < float('nan')\nUnhandled SIGFPE:\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12149\n\n",
    "created_at": "2011-12-13T05:08:19Z",
    "labels": [
        "component: basic arithmetic",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "float('nan')>1 crashes Sage.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11977",
    "user": "https://github.com/williamstein"
}
```
Assignee: @aghitza

The optimizations in #10314 ignored the fact that floating point numbers can be nan, which leads to it being trivial to completely crash Sage.  I ran into exactly this when doing real work, so I'm annoyed. 


```
sage: float('nan') > 1

Program received signal SIGFPE, Arithmetic exception.
0x00007fff89c3b82a in __kill ()
(gdb) bt
#0  0x00007fff89c3b82a in __kill ()
#1  0x00000001013c530e in __gmp_invalid_operation ()
#2  0x00000001013cf579 in __gmpz_cmp_d ()
#3  0x00000001035fd09e in __pyx_pf_4sage_5rings_7integer_7Integer_7__richcmp__ (__pyx_v_left=0x5bd7, __pyx_v_right=0x10b2a0470, __pyx_v_op=0) at integer.c:7855
```


The traceback points to this code integer.pyx:

```
            elif PyFloat_CheckExact(left):
                c = -mpz_cmp_d((<Integer>right).value, PyFloat_AsDouble(left))
```


There is similar code a few lines down for the other direction, hence this also crashes

```
sage: 1 < float('nan')
Unhandled SIGFPE:
```


Issue created by migration from https://trac.sagemath.org/ticket/12149





---

archive/issue_comments_137611.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-13T05:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137611",
    "user": "https://github.com/williamstein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_137612.json:
```json
{
    "body": "One can be more careful by adding `sig_on()`/`sig_off()`: [http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling).  I'm not saying one should, I'll leave that to the author of this ticket.",
    "created_at": "2011-12-13T08:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137612",
    "user": "https://github.com/jdemeyer"
}
```

One can be more careful by adding `sig_on()`/`sig_off()`: [http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling).  I'm not saying one should, I'll leave that to the author of this ticket.



---

archive/issue_comments_137613.json:
```json
{
    "body": "Replying to [comment:2 jdemeyer]:\n> One can be more careful by adding `sig_on()`/`sig_off()`: [http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling). \n>  I'm not saying one should, I'll leave that to the author of this ticket.\n\nTo me, using signal handling instead of simply checking whether or not the float is a nan (using isfinite) is a much worse solution to this problem.    Do you think otherwise, and if so, why?",
    "created_at": "2011-12-13T08:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137613",
    "user": "https://github.com/williamstein"
}
```

Replying to [comment:2 jdemeyer]:
> One can be more careful by adding `sig_on()`/`sig_off()`: [http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling](http://sagemath.org/doc/developer/coding_in_cython.html#interrupt-and-signal-handling). 
>  I'm not saying one should, I'll leave that to the author of this ticket.

To me, using signal handling instead of simply checking whether or not the float is a nan (using isfinite) is a much worse solution to this problem.    Do you think otherwise, and if so, why?



---

archive/issue_comments_137614.json:
```json
{
    "body": "Replying to [comment:3 was]:\n> To me, using signal handling instead of simply checking whether or not the float is a nan (using isfinite) is a much worse solution to this problem.    Do you think otherwise, and if so, why?\nI was not proposing it as a solution to this problem, just to add the signal handling in addition as an extra safeguard.\n\nIdeally there would have been `sig_on()`/`sig_off()` already, such that this ticket would say:\n\n```\nsage: float('nan') > 1\nTracback (most recent call last):\n...\nRuntimeError: Floating Point Error\n```\n\nwhich doesn't crash Sage.",
    "created_at": "2011-12-13T08:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137614",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 was]:
> To me, using signal handling instead of simply checking whether or not the float is a nan (using isfinite) is a much worse solution to this problem.    Do you think otherwise, and if so, why?
I was not proposing it as a solution to this problem, just to add the signal handling in addition as an extra safeguard.

Ideally there would have been `sig_on()`/`sig_off()` already, such that this ticket would say:

```
sage: float('nan') > 1
Tracback (most recent call last):
...
RuntimeError: Floating Point Error
```

which doesn't crash Sage.



---

archive/issue_comments_137615.json:
```json
{
    "body": "`float('nan')` does not result in an error. Comparison must not result in an error, according to Python specifications, if I remember correctly.\n\nHence, using sigon/sigoff seems the wrong thing to do, because of the raised floating point error. In addition: Wouldn't sigon/sigoff slow the code down? I don't know by how much, though.",
    "created_at": "2011-12-13T09:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137615",
    "user": "https://github.com/simon-king-jena"
}
```

`float('nan')` does not result in an error. Comparison must not result in an error, according to Python specifications, if I remember correctly.

Hence, using sigon/sigoff seems the wrong thing to do, because of the raised floating point error. In addition: Wouldn't sigon/sigoff slow the code down? I don't know by how much, though.



---

archive/issue_comments_137616.json:
```json
{
    "body": "Replying to [comment:5 SimonKing]:\n> Hence, using sigon/sigoff seems the wrong thing to do\nWithin Cython code, sig_on/sig_off is **never** the wrong thing to do.  It might be unneeded, might slow things down, but it is never wrong.\n\n> Wouldn't sigon/sigoff slow the code down?\nYes, it would.  Typically, the slowdown is in the 10ns~20ns range which is very little unless it's done in a tight loop.",
    "created_at": "2011-12-13T09:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137616",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 SimonKing]:
> Hence, using sigon/sigoff seems the wrong thing to do
Within Cython code, sig_on/sig_off is **never** the wrong thing to do.  It might be unneeded, might slow things down, but it is never wrong.

> Wouldn't sigon/sigoff slow the code down?
Yes, it would.  Typically, the slowdown is in the 10ns~20ns range which is very little unless it's done in a tight loop.



---

archive/issue_comments_137617.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Replying to [comment:5 SimonKing]:\n> > Hence, using sigon/sigoff seems the wrong thing to do\n> Within Cython code, sig_on/sig_off is **never** the wrong thing to do.\n\nOK, let me rephrase it: It is wrong to use sig_on/sig_off in comparison code without \"try-except\". And, if I am not mistaken, \"try-except\" adds another small overhead. I presume that comparison occurs very frequently in many applications, and thus I'd go for speed.\n\nThat's to say: We should test both versions, William's and the \"try-sigon-sigoff-except\" version, and compare timings.",
    "created_at": "2011-12-13T09:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137617",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:6 jdemeyer]:
> Replying to [comment:5 SimonKing]:
> > Hence, using sigon/sigoff seems the wrong thing to do
> Within Cython code, sig_on/sig_off is **never** the wrong thing to do.

OK, let me rephrase it: It is wrong to use sig_on/sig_off in comparison code without "try-except". And, if I am not mistaken, "try-except" adds another small overhead. I presume that comparison occurs very frequently in many applications, and thus I'd go for speed.

That's to say: We should test both versions, William's and the "try-sigon-sigoff-except" version, and compare timings.



---

archive/issue_comments_137618.json:
```json
{
    "body": "I tried\n\n```\n                try:\n                    sig_on()\n                    c = mpz_cmp_d((<Integer>left).value, PyFloat_AsDouble(right))\n                    sig_off()\n                except RuntimeError:\n                    sig_off()\n                    return False\n```\n\nbut when I test it, then the error is not silently caught. Instead, I get:\n\n```\nsage: a = float('nan'); b = 1 \nsage: a<b, a>b, b<a, b>a \n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libcsage.so(print_backtrace+0x31)[0x7fdb346132d0]\n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libcsage.so(_sig_off_warning+0x6f)[0x7fdb34613050]\n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/python2.6/site-packages/sage/rings/integer.so(+0x2a0ba)[0x7fdb2ca390ba]\n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyObject_RichCompare+0x61)[0x7fdb39c538b1]\n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x3355)[0x7fdb39cb11d5]\n...\n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyRun_FileExFlags+0xb0)[0x7fdb39cd4c90]\n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyRun_SimpleFileExFlags+0xdc)[0x7fdb39cd4e5c]\n/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(Py_Main+0xb36)[0x7fdb39ce2186]\n/lib/libc.so.6(__libc_start_main+0xfd)[0x7fdb38fe0c4d]\npython[0x400699]\n(False, False, False, False)\n```\n\n\nWhat did I do wrong?",
    "created_at": "2011-12-13T10:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137618",
    "user": "https://github.com/simon-king-jena"
}
```

I tried

```
                try:
                    sig_on()
                    c = mpz_cmp_d((<Integer>left).value, PyFloat_AsDouble(right))
                    sig_off()
                except RuntimeError:
                    sig_off()
                    return False
```

but when I test it, then the error is not silently caught. Instead, I get:

```
sage: a = float('nan'); b = 1 
sage: a<b, a>b, b<a, b>a 
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libcsage.so(print_backtrace+0x31)[0x7fdb346132d0]
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libcsage.so(_sig_off_warning+0x6f)[0x7fdb34613050]
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/python2.6/site-packages/sage/rings/integer.so(+0x2a0ba)[0x7fdb2ca390ba]
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyObject_RichCompare+0x61)[0x7fdb39c538b1]
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x3355)[0x7fdb39cb11d5]
...
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyRun_FileExFlags+0xb0)[0x7fdb39cd4c90]
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(PyRun_SimpleFileExFlags+0xdc)[0x7fdb39cd4e5c]
/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/local/lib/libpython2.6.so.1.0(Py_Main+0xb36)[0x7fdb39ce2186]
/lib/libc.so.6(__libc_start_main+0xfd)[0x7fdb38fe0c4d]
python[0x400699]
(False, False, False, False)
```


What did I do wrong?



---

archive/issue_comments_137619.json:
```json
{
    "body": "Replying to [comment:8 SimonKing]:\n> What did I do wrong?\nYou should not put the second `sig_off()`, see the example in [http://sagemath.org/doc/developer/coding_in_cython.html#using-sig-on-and-sig-off](http://sagemath.org/doc/developer/coding_in_cython.html#using-sig-on-and-sig-off)",
    "created_at": "2011-12-13T10:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137619",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 SimonKing]:
> What did I do wrong?
You should not put the second `sig_off()`, see the example in [http://sagemath.org/doc/developer/coding_in_cython.html#using-sig-on-and-sig-off](http://sagemath.org/doc/developer/coding_in_cython.html#using-sig-on-and-sig-off)



---

archive/issue_comments_137620.json:
```json
{
    "body": "Replying to [comment:7 SimonKing]:\n> It is wrong to use sig_on/sig_off in comparison code without \"try-except\".\nWhy is that?",
    "created_at": "2011-12-13T10:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137620",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 SimonKing]:
> It is wrong to use sig_on/sig_off in comparison code without "try-except".
Why is that?



---

archive/issue_comments_137621.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Replying to [comment:7 SimonKing]:\n> > It is wrong to use sig_on/sig_off in comparison code without \"try-except\".\n> Why is that?\n\nBecause comparison in Python must not result in an error, if I remember correctly the Python specifications.\n\nHere are timings, using `a = 1, b = 2, c = 1\".\n\nVanilla sage-4.8.alpha3:\n\n```\nsage: timeit(\"a==b\",number=10^5)\n100000 loops, best of 3: 271 ns per loop\nsage: timeit(\"a==c\",number=10^5)\n100000 loops, best of 3: 268 ns per loop\nsage: timeit(\"a==x\",number=10^5)\n100000 loops, best of 3: 13.8 \u00b5s per loop\n```\n\n\nWilliam's patch:\n\n```\nsage: timeit(\"a==b\",number=10^5)\n100000 loops, best of 3: 260 ns per loop\nsage: timeit(\"a==c\",number=10^5)\n100000 loops, best of 3: 266 ns per loop\nsage: timeit(\"a==x\",number=10^5)\n100000 loops, best of 3: 14.7 \u00b5s per loop\n```\n\n\ntry-sigon-sigoff-except:\n\n```\nsage: timeit(\"a==b\",number=10^5)\n100000 loops, best of 3: 272 ns per loop\nsage: timeit(\"a==c\",number=10^5)\n100000 loops, best of 3: 266 ns per loop\nsage: timeit(\"a==x\",number=10^5)\n100000 loops, best of 3: 13.6 \u00b5s per loop\n```\n\n\nSo, it is not really that much of a difference.",
    "created_at": "2011-12-13T10:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137621",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:10 jdemeyer]:
> Replying to [comment:7 SimonKing]:
> > It is wrong to use sig_on/sig_off in comparison code without "try-except".
> Why is that?

Because comparison in Python must not result in an error, if I remember correctly the Python specifications.

Here are timings, using `a = 1, b = 2, c = 1".

Vanilla sage-4.8.alpha3:

```
sage: timeit("a==b",number=10^5)
100000 loops, best of 3: 271 ns per loop
sage: timeit("a==c",number=10^5)
100000 loops, best of 3: 268 ns per loop
sage: timeit("a==x",number=10^5)
100000 loops, best of 3: 13.8 µs per loop
```


William's patch:

```
sage: timeit("a==b",number=10^5)
100000 loops, best of 3: 260 ns per loop
sage: timeit("a==c",number=10^5)
100000 loops, best of 3: 266 ns per loop
sage: timeit("a==x",number=10^5)
100000 loops, best of 3: 14.7 µs per loop
```


try-sigon-sigoff-except:

```
sage: timeit("a==b",number=10^5)
100000 loops, best of 3: 272 ns per loop
sage: timeit("a==c",number=10^5)
100000 loops, best of 3: 266 ns per loop
sage: timeit("a==x",number=10^5)
100000 loops, best of 3: 13.6 µs per loop
```


So, it is not really that much of a difference.



---

archive/issue_comments_137622.json:
```json
{
    "body": "Replying to [comment:11 SimonKing]:\n> Because comparison in Python must not result in an error, if I remember correctly the Python specifications.\nSo it's a minor issue about specifications, not a big deal.  Doing something against the Python specifications isn't an issue if you're trying to avoid complete crashes of Sage.\n\nIt's like airbags: sure, people might have hearing problems because of an airbag deployment, but that's a minor issue compared to what the airbag prevents.",
    "created_at": "2011-12-13T11:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137622",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 SimonKing]:
> Because comparison in Python must not result in an error, if I remember correctly the Python specifications.
So it's a minor issue about specifications, not a big deal.  Doing something against the Python specifications isn't an issue if you're trying to avoid complete crashes of Sage.

It's like airbags: sure, people might have hearing problems because of an airbag deployment, but that's a minor issue compared to what the airbag prevents.



---

archive/issue_comments_137623.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 SimonKing]:\n> > Because comparison in Python must not result in an error, if I remember correctly the Python specifications.\n> So it's a minor issue about specifications, not a big deal.  Doing something against the Python specifications isn't an issue if you're trying to avoid complete crashes of Sage.\n\nAnd what does that mean? Use William's patch, or a try-sig_on-sig_off-except patch?",
    "created_at": "2011-12-13T17:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137623",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 SimonKing]:
> > Because comparison in Python must not result in an error, if I remember correctly the Python specifications.
> So it's a minor issue about specifications, not a big deal.  Doing something against the Python specifications isn't an issue if you're trying to avoid complete crashes of Sage.

And what does that mean? Use William's patch, or a try-sig_on-sig_off-except patch?



---

archive/issue_comments_137624.json:
```json
{
    "body": "Replying to [comment:13 SimonKing]:\n> Replying to [comment:12 jdemeyer]:\n> > So it's a minor issue about specifications, not a big deal.  Doing something against the Python specifications isn't an issue if you're trying to avoid complete crashes of Sage.\n> \n> And what does that mean? Use William's patch, or a try-sig_on-sig_off-except patch?\n\njdemeyer is remarking that as a general rule we should wrap code that might send SIGFPE signals  in sig_on/sig_off.    With the patch I've attached, I believe there is no possible way that the relevant code will ever send a SIGFPE signal.  For such code, it would make no sense at all to use sig_on/sig_off.\n\nI think SimonKing's timings above are bogus, because you say that you use \"a = 1, b = 2, c = 1\", which are all integers, yet the relevant code path will only be hit if one operand is a Sage integer and the other is a Python float.   You need to test with a Sage integer, a Python float that isn't float('nan'), and also with one that is.  Probably your differences in timings are meaningless noise.   I wish timeout output both a mean and standard deviation, so one could tell whether comparisons are meaningful.",
    "created_at": "2011-12-13T20:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137624",
    "user": "https://github.com/williamstein"
}
```

Replying to [comment:13 SimonKing]:
> Replying to [comment:12 jdemeyer]:
> > So it's a minor issue about specifications, not a big deal.  Doing something against the Python specifications isn't an issue if you're trying to avoid complete crashes of Sage.
> 
> And what does that mean? Use William's patch, or a try-sig_on-sig_off-except patch?

jdemeyer is remarking that as a general rule we should wrap code that might send SIGFPE signals  in sig_on/sig_off.    With the patch I've attached, I believe there is no possible way that the relevant code will ever send a SIGFPE signal.  For such code, it would make no sense at all to use sig_on/sig_off.

I think SimonKing's timings above are bogus, because you say that you use "a = 1, b = 2, c = 1", which are all integers, yet the relevant code path will only be hit if one operand is a Sage integer and the other is a Python float.   You need to test with a Sage integer, a Python float that isn't float('nan'), and also with one that is.  Probably your differences in timings are meaningless noise.   I wish timeout output both a mean and standard deviation, so one could tell whether comparisons are meaningful.



---

archive/issue_comments_137625.json:
```json
{
    "body": "Replying to [comment:14 was]:\n> I think SimonKing's timings above are bogus, because you say that you use \"a = 1, b = 2, c = 1\", which are all integers, yet the relevant code path will only be hit if one operand is a Sage integer and the other is a Python float.\n\nOops, you're right, I didn't notice that your changes are in a code block where one operand is a Python float.",
    "created_at": "2011-12-13T20:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137625",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:14 was]:
> I think SimonKing's timings above are bogus, because you say that you use "a = 1, b = 2, c = 1", which are all integers, yet the relevant code path will only be hit if one operand is a Sage integer and the other is a Python float.

Oops, you're right, I didn't notice that your changes are in a code block where one operand is a Python float.



---

archive/issue_comments_137626.json:
```json
{
    "body": "Here are better timings (I hope):\n\nUnpatched 4.8.alpha3:\n\n```\nsage: a = 1\nsage: b = float(1)\nsage: c = float(2.5)\nsage: timeit(\"a==b\",number=10^5)\n100000 loops, best of 3: 320 ns per loop\nsage: timeit(\"a==c\",number=10^5)\n100000 loops, best of 3: 323 ns per loop\n```\n\n\nWith William's patch:\n\n```\nsage: a = 1\nsage: b = float(1)\nsage: c = float(2.5)\nsage: d = float('nan')\nsage: timeit(\"a==b\",number=10^5)\n100000 loops, best of 3: 336 ns per loop\nsage: timeit(\"a==c\",number=10^5)\n100000 loops, best of 3: 333 ns per loop\nsage: timeit(\"a==d\",number=10^5)\n100000 loops, best of 3: 281 ns per loop\n```\n\n\nWith the sig_on/off alternative:\n\n```\nsage: a = 1\nsage: b = float(1)\nsage: c = float(2.5)\nsage: d = float('nan')\nsage: timeit(\"a==b\",number=10^5)\n100000 loops, best of 3: 369 ns per loop\nsage: timeit(\"a==c\",number=10^5)\n100000 loops, best of 3: 369 ns per loop\nsage: timeit(\"a==c\",number=10^5)\n100000 loops, best of 3: 369 ns per loop\nsage: timeit(\"a==d\",number=10^5)\n100000 loops, best of 3: 3.92 \u00b5s per loop\n```\n\n\nI don't know the standard deviation of these timings (does \"timeit\" offer such statistics?) - when repeating the tests, I sometimes got 380 ns, not 369 ns.\n\nBut the timings seem to suggest that William's patch is 10% faster in the \"number\" case and is a lot faster in the \"not a number\" case.",
    "created_at": "2011-12-13T21:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137626",
    "user": "https://github.com/simon-king-jena"
}
```

Here are better timings (I hope):

Unpatched 4.8.alpha3:

```
sage: a = 1
sage: b = float(1)
sage: c = float(2.5)
sage: timeit("a==b",number=10^5)
100000 loops, best of 3: 320 ns per loop
sage: timeit("a==c",number=10^5)
100000 loops, best of 3: 323 ns per loop
```


With William's patch:

```
sage: a = 1
sage: b = float(1)
sage: c = float(2.5)
sage: d = float('nan')
sage: timeit("a==b",number=10^5)
100000 loops, best of 3: 336 ns per loop
sage: timeit("a==c",number=10^5)
100000 loops, best of 3: 333 ns per loop
sage: timeit("a==d",number=10^5)
100000 loops, best of 3: 281 ns per loop
```


With the sig_on/off alternative:

```
sage: a = 1
sage: b = float(1)
sage: c = float(2.5)
sage: d = float('nan')
sage: timeit("a==b",number=10^5)
100000 loops, best of 3: 369 ns per loop
sage: timeit("a==c",number=10^5)
100000 loops, best of 3: 369 ns per loop
sage: timeit("a==c",number=10^5)
100000 loops, best of 3: 369 ns per loop
sage: timeit("a==d",number=10^5)
100000 loops, best of 3: 3.92 µs per loop
```


I don't know the standard deviation of these timings (does "timeit" offer such statistics?) - when repeating the tests, I sometimes got 380 ns, not 369 ns.

But the timings seem to suggest that William's patch is 10% faster in the "number" case and is a lot faster in the "not a number" case.



---

archive/issue_comments_137627.json:
```json
{
    "body": "I think this is pretty definitive that in this particular case the best approach is to use isfinite instead of signals and exceptions.  Even in the non-exceptional case, the overhead of signals and exceptions exceeds that of just calling isfinite.",
    "created_at": "2011-12-13T21:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137627",
    "user": "https://github.com/williamstein"
}
```

I think this is pretty definitive that in this particular case the best approach is to use isfinite instead of signals and exceptions.  Even in the non-exceptional case, the overhead of signals and exceptions exceeds that of just calling isfinite.



---

archive/issue_comments_137628.json:
```json
{
    "body": "Replying to [comment:14 was]:\n> jdemeyer is remarking that as a general rule we should wrap code that might send SIGFPE signals  in sig_on/sig_off.\nYes, that's what I meant.  I never said this code must be wrapped in `sig_on()`/`sig_off()`, just that you should be aware of this.  You thought about the possibility and decided not to add `sig_on()`/`sig_off()` which is a choice that can be defended.\n\nBy the way: it's almost impossible that simply adding `sig_on()`/`sig_off()` would make the execution time jump from 281ns to 3.92\u00b5s, so probably you did something wrong there.",
    "created_at": "2011-12-14T09:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137628",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 was]:
> jdemeyer is remarking that as a general rule we should wrap code that might send SIGFPE signals  in sig_on/sig_off.
Yes, that's what I meant.  I never said this code must be wrapped in `sig_on()`/`sig_off()`, just that you should be aware of this.  You thought about the possibility and decided not to add `sig_on()`/`sig_off()` which is a choice that can be defended.

By the way: it's almost impossible that simply adding `sig_on()`/`sig_off()` would make the execution time jump from 281ns to 3.92µs, so probably you did something wrong there.



---

archive/issue_comments_137629.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n> By the way: it's almost impossible that simply adding `sig_on()`/`sig_off()` would make the execution time jump from 281ns to 3.92\u00b5s, so probably you did something wrong there.\n\nDon't forget the time for catching the error. My code looks like\n\n```\n               try:\n                   sig_on()\n                   c = mpz_cmp_d((<Integer>left).value, PyFloat_AsDouble(right))\n                   sig_off()\n               except RuntimeError:\n                   return False\n```\n\nI doubt that this is obviously wrong, provided that we want to return \"False\" instead of letting the runtime error be raised.",
    "created_at": "2011-12-14T10:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137629",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:18 jdemeyer]:
> By the way: it's almost impossible that simply adding `sig_on()`/`sig_off()` would make the execution time jump from 281ns to 3.92µs, so probably you did something wrong there.

Don't forget the time for catching the error. My code looks like

```
               try:
                   sig_on()
                   c = mpz_cmp_d((<Integer>left).value, PyFloat_AsDouble(right))
                   sig_off()
               except RuntimeError:
                   return False
```

I doubt that this is obviously wrong, provided that we want to return "False" instead of letting the runtime error be raised.



---

archive/issue_comments_137630.json:
```json
{
    "body": "SimonKing -- could you please, please referee my patch?   You're the best person to do it at this point, since you've done the hard work of checking that it doesn't introduce a major speed regression etc.  It's only a few lines of code -- much less than you wrote just doing tests.  Thanks!!",
    "created_at": "2011-12-14T19:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137630",
    "user": "https://github.com/williamstein"
}
```

SimonKing -- could you please, please referee my patch?   You're the best person to do it at this point, since you've done the hard work of checking that it doesn't introduce a major speed regression etc.  It's only a few lines of code -- much less than you wrote just doing tests.  Thanks!!



---

archive/issue_comments_137631.json:
```json
{
    "body": "Replying to [comment:20 was]:\n> SimonKing -- could you please, please referee my patch?\n\nSure! Right now I am preparing my talk for the Sage-Flint days, but I can certainly run the doc tests. And I think if they pass then we have a positive review, since we checked that the timings are fine and the patch looks fine, and (of course) the original problem is fixed.",
    "created_at": "2011-12-14T20:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137631",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:20 was]:
> SimonKing -- could you please, please referee my patch?

Sure! Right now I am preparing my talk for the Sage-Flint days, but I can certainly run the doc tests. And I think if they pass then we have a positive review, since we checked that the timings are fine and the patch looks fine, and (of course) the original problem is fixed.



---

archive/issue_comments_137632.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-14T21:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137632",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_137633.json:
```json
{
    "body": "It needs work. I find the following errors:\n\n```\n$ ./sage -t -long devel/sage/sage/functions/min_max.py\nsage -t -long \"devel/sage/sage/functions/min_max.py\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 22:\n    sage: min_symbolic(3,5,x)\nExpected:\n    min(x, 3)\nGot:\n    min(x, inf)\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 74:\n    sage: min_symbolic(3,5,x)\nExpected:\n    min(x, 3)\nGot:\n    min(x, inf)\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 78:\n    sage: min_symbolic([3,5,x])\nExpected:\n    min(x, 3)\nGot:\n    min(x, inf)\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 237:\n    sage: min_symbolic(3, x).subs(x=5)\nExpected:\n    3\nGot:\n    inf\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 239:\n    sage: min_symbolic(3, 5, x)\nExpected:\n    min(x, 3)\nGot:\n    min(x, inf)\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 241:\n    sage: min_symbolic([3,5,x])\nExpected:\n    min(x, 3)\nGot:\n    min(x, inf)\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 259:\n    sage: t.subs(x=3) # indirect doctest\nExpected:\n    3\nGot:\n    inf\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 261:\n    sage: min_symbolic(5,3)\nExpected:\n    3\nGot:\n    inf\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 265:\n    sage: u.subs(x=-1)\nExpected:\n    -1\nGot:\n    0\n**********************************************************************\nFile \"/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py\", line 269:\n    sage: min_symbolic([3,x])\nExpected:\n    min(x, 3)\nGot:\n    min(x, inf)\n**********************************************************************\n4 items had failures:\n   1 of   5 in __main__.example_0\n   2 of  19 in __main__.example_1\n   3 of   9 in __main__.example_5\n   4 of  11 in __main__.example_6\n***Test Failed*** 10 failures.\nFor whitespace errors, see the file /mnt/local/king/.sage/tmp/min_max_5906.py\n         [2.4 s]\n```\n",
    "created_at": "2011-12-14T21:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137633",
    "user": "https://github.com/simon-king-jena"
}
```

It needs work. I find the following errors:

```
$ ./sage -t -long devel/sage/sage/functions/min_max.py
sage -t -long "devel/sage/sage/functions/min_max.py"
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 22:
    sage: min_symbolic(3,5,x)
Expected:
    min(x, 3)
Got:
    min(x, inf)
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 74:
    sage: min_symbolic(3,5,x)
Expected:
    min(x, 3)
Got:
    min(x, inf)
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 78:
    sage: min_symbolic([3,5,x])
Expected:
    min(x, 3)
Got:
    min(x, inf)
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 237:
    sage: min_symbolic(3, x).subs(x=5)
Expected:
    3
Got:
    inf
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 239:
    sage: min_symbolic(3, 5, x)
Expected:
    min(x, 3)
Got:
    min(x, inf)
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 241:
    sage: min_symbolic([3,5,x])
Expected:
    min(x, 3)
Got:
    min(x, inf)
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 259:
    sage: t.subs(x=3) # indirect doctest
Expected:
    3
Got:
    inf
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 261:
    sage: min_symbolic(5,3)
Expected:
    3
Got:
    inf
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 265:
    sage: u.subs(x=-1)
Expected:
    -1
Got:
    0
**********************************************************************
File "/mnt/local/king/SAGE/rebase/sage-4.8.alpha3/devel/sage/sage/functions/min_max.py", line 269:
    sage: min_symbolic([3,x])
Expected:
    min(x, 3)
Got:
    min(x, inf)
**********************************************************************
4 items had failures:
   1 of   5 in __main__.example_0
   2 of  19 in __main__.example_1
   3 of   9 in __main__.example_5
   4 of  11 in __main__.example_6
***Test Failed*** 10 failures.
For whitespace errors, see the file /mnt/local/king/.sage/tmp/min_max_5906.py
         [2.4 s]
```




---

archive/issue_comments_137634.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-15T01:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137634",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_137635.json:
```json
{
    "body": "Simon -- nice find.  I've fixed the code to use isnan instead, so that the infinite comparison is still done by GMP (correctly).  Please referee again.",
    "created_at": "2011-12-15T01:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137635",
    "user": "https://github.com/williamstein"
}
```

Simon -- nice find.  I've fixed the code to use isnan instead, so that the infinite comparison is still done by GMP (correctly).  Please referee again.



---

archive/issue_comments_137636.json:
```json
{
    "body": "Do we want this?\n\n```\nsage: 1==float('nan')\nFalse\nsage: 1!=float('nan')\nFalse\n```\n\nI think One should differ from \"not a number\".",
    "created_at": "2011-12-15T06:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137636",
    "user": "https://github.com/simon-king-jena"
}
```

Do we want this?

```
sage: 1==float('nan')
False
sage: 1!=float('nan')
False
```

I think One should differ from "not a number".



---

archive/issue_comments_137637.json:
```json
{
    "body": "PS:\n\n```\nsage: 1!=float('nan')\nFalse\nsage: float(1)!=float('nan')\nTrue\n```\n",
    "created_at": "2011-12-15T06:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137637",
    "user": "https://github.com/simon-king-jena"
}
```

PS:

```
sage: 1!=float('nan')
False
sage: float(1)!=float('nan')
True
```




---

archive/issue_comments_137638.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-15T06:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137638",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_137639.json:
```json
{
    "body": "Attachment [trac_12149.3.patch](tarball://root/attachments/some-uuid/ticket12149/trac_12149.3.patch) by @williamstein created at 2011-12-15 20:22:21\n\napply *only* this (none above)",
    "created_at": "2011-12-15T20:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137639",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_12149.3.patch](tarball://root/attachments/some-uuid/ticket12149/trac_12149.3.patch) by @williamstein created at 2011-12-15 20:22:21

apply *only* this (none above)



---

archive/issue_comments_137640.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-15T20:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137640",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_137641.json:
```json
{
    "body": "I've posted a new patch.",
    "created_at": "2011-12-15T20:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137641",
    "user": "https://github.com/williamstein"
}
```

I've posted a new patch.



---

archive/issue_comments_137642.json:
```json
{
    "body": "Do we also want to fix the following inconsistency?\n\n```\nsage: float(1.1) < float('nan')\nFalse\nsage: 1.1 < float('nan')\nTrue\n```\n\n\nIf we want to fix it: Here, or on a different ticket?",
    "created_at": "2011-12-15T20:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137642",
    "user": "https://github.com/simon-king-jena"
}
```

Do we also want to fix the following inconsistency?

```
sage: float(1.1) < float('nan')
False
sage: 1.1 < float('nan')
True
```


If we want to fix it: Here, or on a different ticket?



---

archive/issue_comments_137643.json:
```json
{
    "body": "Replying to [comment:27 SimonKing]:\n> Do we also want to fix the following inconsistency?\n> {{{\n> sage: float(1.1) < float('nan')\n> False\n> sage: 1.1 < float('nan')\n> True\n> }}}\n> \n> If we want to fix it: Here, or on a different ticket?\n\nYes, we should fix that, but since the relevant code will be in a completely different file, I think it should *definitely* be a new ticket.  Please open one and post a link here.",
    "created_at": "2011-12-15T21:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137643",
    "user": "https://github.com/williamstein"
}
```

Replying to [comment:27 SimonKing]:
> Do we also want to fix the following inconsistency?
> {{{
> sage: float(1.1) < float('nan')
> False
> sage: 1.1 < float('nan')
> True
> }}}
> 
> If we want to fix it: Here, or on a different ticket?

Yes, we should fix that, but since the relevant code will be in a completely different file, I think it should *definitely* be a new ticket.  Please open one and post a link here.



---

archive/issue_comments_137644.json:
```json
{
    "body": "Replying to [comment:28 was]:\n> Yes, we should fix that, but since the relevant code will be in a completely different file, I think it should *definitely* be a new ticket.  Please open one and post a link here. \n\nSee #12160.",
    "created_at": "2011-12-15T21:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137644",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:28 was]:
> Yes, we should fix that, but since the relevant code will be in a completely different file, I think it should *definitely* be a new ticket.  Please open one and post a link here. 

See #12160.



---

archive/issue_comments_137645.json:
```json
{
    "body": "All doctests pass with this installed, and it fixes the crash. I don't want to tread on Simon's toes, but we should probably get this fixed quickly, so I'm going to give this a positive review.",
    "created_at": "2011-12-31T12:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137645",
    "user": "https://github.com/loefflerd"
}
```

All doctests pass with this installed, and it fixes the crash. I don't want to tread on Simon's toes, but we should probably get this fixed quickly, so I'm going to give this a positive review.



---

archive/issue_comments_137646.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-31T12:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137646",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_137647.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-01-03T08:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11977#issuecomment-137647",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_012022.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-01-03T08:49:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11977",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11977#event-12022"
}
```
