# Issue 20964: Add a global is_trivial_zero function

archive/issues_020964.json:
```json
{
    "body": "CC:  @nbruin @videlec @mezzarobba\n\n`expr.is_trivial_zero()` is designed as a fast way to check whether an expression `expr` is zero (whereas `expr == 0` can be expensive and may, via `Expression.__nonzero__`, even end up calling Maxima).\n\nA common use case, for instance, in the evaluation of special functions (see #17678 for an example) is to have special code if an argument, say, `x` is zero (or some other fixed value).  In many places, this is done using just `if x == 0:`, which works fine in simple examples but can be expensive is `x` is a complicated expression. To avoid that issue, `if not isinstance(x, Expression) and x == 0:` is sometimes used (in `Hypergeometric_M._eval_`, for instance). Another solution might be `(isinstance(sth, Expression) and sth.is_trivial_zero()) or (not isinstance(sth, Expression) and sth == 0)` but that's not brief and convenient enough to actually use.\n\nWould it be beneficial to have a global function `is_trivial_zero` for such purposes?  So that, in the above example, one could use `is_trivial_zero(x)` without worrying about the type of `x`. One possible implementation could be:\n\n\n```\ndef is_trivial_zero(x):\n    try: return x.is_trivial_zero()\n    except AttributeError: return x == 0\n```\n\n\nA place for such a function might be `sage/misc/functional.py` which already contains things like `is_even` (which I used as a blueprint here). (But see #17158.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/21201\n\n",
    "created_at": "2016-08-10T12:19:13Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Add a global is_trivial_zero function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20964",
    "user": "https://github.com/arminstraub"
}
```
CC:  @nbruin @videlec @mezzarobba

`expr.is_trivial_zero()` is designed as a fast way to check whether an expression `expr` is zero (whereas `expr == 0` can be expensive and may, via `Expression.__nonzero__`, even end up calling Maxima).

A common use case, for instance, in the evaluation of special functions (see #17678 for an example) is to have special code if an argument, say, `x` is zero (or some other fixed value).  In many places, this is done using just `if x == 0:`, which works fine in simple examples but can be expensive is `x` is a complicated expression. To avoid that issue, `if not isinstance(x, Expression) and x == 0:` is sometimes used (in `Hypergeometric_M._eval_`, for instance). Another solution might be `(isinstance(sth, Expression) and sth.is_trivial_zero()) or (not isinstance(sth, Expression) and sth == 0)` but that's not brief and convenient enough to actually use.

Would it be beneficial to have a global function `is_trivial_zero` for such purposes?  So that, in the above example, one could use `is_trivial_zero(x)` without worrying about the type of `x`. One possible implementation could be:


```
def is_trivial_zero(x):
    try: return x.is_trivial_zero()
    except AttributeError: return x == 0
```


A place for such a function might be `sage/misc/functional.py` which already contains things like `is_even` (which I used as a blueprint here). (But see #17158.)

Issue created by migration from https://trac.sagemath.org/ticket/21201





---

archive/issue_comments_289669.json:
```json
{
    "body": "A plan would be in symbolics to use a fast zero comparison like the one in `comparison.pyx:mixed order` in `is_zero` and additionally change the expensive symbolic zero comparison (the main code is in `__nonzero__`, see also #19040) to something being able to return Yes/No/Maybe, which is incompatible with the global boolean `is_zero` and therefore should have a new name. Having a global `is_trivial_zero` would fit with this.",
    "created_at": "2016-09-18T07:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289669",
    "user": "https://github.com/rwst"
}
```

A plan would be in symbolics to use a fast zero comparison like the one in `comparison.pyx:mixed order` in `is_zero` and additionally change the expensive symbolic zero comparison (the main code is in `__nonzero__`, see also #19040) to something being able to return Yes/No/Maybe, which is incompatible with the global boolean `is_zero` and therefore should have a new name. Having a global `is_trivial_zero` would fit with this.



---

archive/issue_comments_289670.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-14T07:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289670",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_events_056534.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-14T07:31:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20964#event-56534"
}
```



---

archive/issue_comments_289671.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-14T07:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289671",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_289672.json:
```json
{
    "body": "I am against such a terrible name in the global namespace that is furthermore almost not specified.\n\nThough it would be good to design a general solution for the different semantics of equality.",
    "created_at": "2018-03-14T07:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289672",
    "user": "https://github.com/videlec"
}
```

I am against such a terrible name in the global namespace that is furthermore almost not specified.

Though it would be good to design a general solution for the different semantics of equality.



---

archive/issue_comments_289673.json:
```json
{
    "body": "FYI, about 320 files under `src/sage` have doctests that, directly or indirectly, call `Expression.__nonzero__`. A quick glance shows in most cases a simplification/proof of equality is not needed.",
    "created_at": "2018-03-14T09:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289673",
    "user": "https://github.com/rwst"
}
```

FYI, about 320 files under `src/sage` have doctests that, directly or indirectly, call `Expression.__nonzero__`. A quick glance shows in most cases a simplification/proof of equality is not needed.



---

archive/issue_comments_289674.json:
```json
{
    "body": "Replying to [comment:5 rws]:\n> FYI, about 320 files under `src/sage` have doctests that, directly or indirectly, call `Expression.__nonzero__`. A quick glance shows in most cases a simplification/proof of equality is not needed.\n\nThis is a bad measure. And anway, 320 files is 12% of the number of files in the Sage source tree...",
    "created_at": "2018-03-14T09:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289674",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:5 rws]:
> FYI, about 320 files under `src/sage` have doctests that, directly or indirectly, call `Expression.__nonzero__`. A quick glance shows in most cases a simplification/proof of equality is not needed.

This is a bad measure. And anway, 320 files is 12% of the number of files in the Sage source tree...



---

archive/issue_comments_289675.json:
```json
{
    "body": "You aim to introduce a feature that concerns only the symbolic ring. Then simply implement it as a method of `SR` (or the elements of SR). Ne need to clutter even more the global namespace.",
    "created_at": "2018-03-14T09:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289675",
    "user": "https://github.com/videlec"
}
```

You aim to introduce a feature that concerns only the symbolic ring. Then simply implement it as a method of `SR` (or the elements of SR). Ne need to clutter even more the global namespace.



---

archive/issue_comments_289676.json:
```json
{
    "body": "So in every case (e.g. in polynomial_element.pyx) the code has to check for expression, and call that member function?",
    "created_at": "2018-03-14T10:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289676",
    "user": "https://github.com/rwst"
}
```

So in every case (e.g. in polynomial_element.pyx) the code has to check for expression, and call that member function?



---

archive/issue_comments_289677.json:
```json
{
    "body": "[ticket:21201 Ticket description]:\n> Some rings have a polymorphic comparison with zero, e.g., comparison in `SR` can mean 1. \"try to prove with certainty\" or 2. \"check if numeric zero\". Other rings may have different features. This ticket implements a global `is_trivial_zero` that explicity requests the object's `is_trivial_zero` member if it exists, otherwise checks `obj==0`.\n\nJust to be sure: what do you mean by \"check if numeric zero\": check if something seems to be zero based on it numerical evaluation, or check if is syntactically zero? If the latter: yes, this is a very useful feature to have, for many, many types of objects. But in the case of `SR`, is there any strong reason to have `==` do more than check for syntactic equality?",
    "created_at": "2018-03-15T07:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289677",
    "user": "https://github.com/mezzarobba"
}
```

[ticket:21201 Ticket description]:
> Some rings have a polymorphic comparison with zero, e.g., comparison in `SR` can mean 1. "try to prove with certainty" or 2. "check if numeric zero". Other rings may have different features. This ticket implements a global `is_trivial_zero` that explicity requests the object's `is_trivial_zero` member if it exists, otherwise checks `obj==0`.

Just to be sure: what do you mean by "check if numeric zero": check if something seems to be zero based on it numerical evaluation, or check if is syntactically zero? If the latter: yes, this is a very useful feature to have, for many, many types of objects. But in the case of `SR`, is there any strong reason to have `==` do more than check for syntactic equality?



---

archive/issue_comments_289678.json:
```json
{
    "body": "Replying to [comment:9 mmezzarobba]:\n> Just to be sure: what do you mean by \"check if numeric zero\": check if something seems to be zero based on it numerical evaluation, or check if is syntactically zero? If the latter: yes, this is a very useful feature to have, for many, many types of objects. But in the case of `SR`, is there any strong reason to have `==` do more than check for syntactic equality?\n\nClearly not but unfortunately `bool()` with symbolic arguments does more by default. Please see https://trac.sagemath.org/wiki/symbolics/nonzero for a summary. The goal is to design a better interface to the existing functionality.",
    "created_at": "2018-03-15T07:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289678",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:9 mmezzarobba]:
> Just to be sure: what do you mean by "check if numeric zero": check if something seems to be zero based on it numerical evaluation, or check if is syntactically zero? If the latter: yes, this is a very useful feature to have, for many, many types of objects. But in the case of `SR`, is there any strong reason to have `==` do more than check for syntactic equality?

Clearly not but unfortunately `bool()` with symbolic arguments does more by default. Please see https://trac.sagemath.org/wiki/symbolics/nonzero for a summary. The goal is to design a better interface to the existing functionality.



---

archive/issue_comments_289679.json:
```json
{
    "body": "Replying to [comment:10 rws]:\n> Clearly not but unfortunately `bool()` with symbolic arguments does more by default.\n\nWell, IMO (though I haven't really thought it through):\n* `bool(expr)` should return `False` iff `expr` is exactly `SR(0)`, without any simplification, even trivial ones,\n* `expr == 0` should return `True` when `bool(expr)` returns `False`, and may return `True` in some cases where trivial simplifications show that `expr` is zero, but shouldn't perform any nontrivial computation (I would say simplifying `x - x` to zero is okay, attempting to expand a polynomial is not\u2014but this is of course debatable),\n* there should be methods `expr.foo()` that attempt to prove that `expr` is zero (e.g. by simplifying it), that `expr` is nonzero (e.g. by substituting values for the variable and performing interval evaluation), that `expr` could be zero (for some values of the variables), and probably more. At least some variants of these methods should take into account assumptions on the variables. I'm not sure what exact set of such methods would be needed, whether they should return plain booleans or use `Unknown`, nor how they should be named (and in particular, whether using the names `is_zero()` and `is_nonzero()` would conflict with their semantics elsewhere in Sage).",
    "created_at": "2018-03-15T08:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289679",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:10 rws]:
> Clearly not but unfortunately `bool()` with symbolic arguments does more by default.

Well, IMO (though I haven't really thought it through):
* `bool(expr)` should return `False` iff `expr` is exactly `SR(0)`, without any simplification, even trivial ones,
* `expr == 0` should return `True` when `bool(expr)` returns `False`, and may return `True` in some cases where trivial simplifications show that `expr` is zero, but shouldn't perform any nontrivial computation (I would say simplifying `x - x` to zero is okay, attempting to expand a polynomial is not—but this is of course debatable),
* there should be methods `expr.foo()` that attempt to prove that `expr` is zero (e.g. by simplifying it), that `expr` is nonzero (e.g. by substituting values for the variable and performing interval evaluation), that `expr` could be zero (for some values of the variables), and probably more. At least some variants of these methods should take into account assumptions on the variables. I'm not sure what exact set of such methods would be needed, whether they should return plain booleans or use `Unknown`, nor how they should be named (and in particular, whether using the names `is_zero()` and `is_nonzero()` would conflict with their semantics elsewhere in Sage).



---

archive/issue_comments_289680.json:
```json
{
    "body": "That is pretty much in line with #19162, and I find William Stein's suggestion of `expr.is_zero(simplify=False/True)` an especially good idea.",
    "created_at": "2018-03-15T09:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289680",
    "user": "https://github.com/rwst"
}
```

That is pretty much in line with #19162, and I find William Stein's suggestion of `expr.is_zero(simplify=False/True)` an especially good idea.



---

archive/issue_comments_289681.json:
```json
{
    "body": "The original ticket will not be implemented.",
    "created_at": "2018-03-16T16:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289681",
    "user": "https://github.com/rwst"
}
```

The original ticket will not be implemented.



---

archive/issue_events_056535.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T16:06:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20964#event-56535"
}
```



---

archive/issue_events_056536.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T16:06:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20964#event-56536"
}
```



---

archive/issue_comments_289682.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-16T16:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289682",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289683.json:
```json
{
    "body": "closing positively reviewed duplicates",
    "created_at": "2018-05-18T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289683",
    "user": "https://github.com/videlec"
}
```

closing positively reviewed duplicates



---

archive/issue_events_056537.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-18T17:16:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20964#event-56537"
}
```



---

archive/issue_comments_289684.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2018-05-18T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20964#issuecomment-289684",
    "user": "https://github.com/videlec"
}
```

Resolution: wontfix
