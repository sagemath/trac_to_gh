# Issue 23999: Structural comparison of expressions

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2017-11-18 07:48:06

In many cases it is not necessary to prove equality of expressions but just check structural identity. An undocumented trick for doing this is `(ex1-ex2).is_trivial_zero()`. This ticket implements a well visible member function for this task.


---

Comment by rws created at 2017-11-18 08:50:55

Changing status from new to needs_review.


---

Comment by git created at 2017-11-18 09:07:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2017-11-18 17:54:18

Thanks for implementing this!


A quick question: is this strictly equivalent to `(ex1-ex2).is_trivial_zero()`? I mean, can we have expressions `ex1` and `ex2` for which `(ex1-ex2).is_trivial_zero()` and `ex1.is_trivially_equal(ex2)` do not give the same result?


---

Comment by rws created at 2017-11-19 06:47:46

One case is:

```
sage: inf = SR(oo)
sage: inf-inf
...
RuntimeError: indeterminate expression: infinity - infinity encountered.
sage: inf.is_trivially_equal(inf)
True
```

When I tried to construct another I found a segfault:

```
sage: half = SR(QQbar(1/2))
sage: (half-1/2).is_trivial_zero()
True
sage: half.is_trivially_equal(1/2)
BOOM
```

which is fixed in the next commit. Nice question! It turns out this gives True as well.


---

Comment by git created at 2017-11-19 06:52:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-11-19 06:57:59

So to answer your question, no, except for objects that can't be subtracted the result is the same, and for those objects the answer is now correct.


---

Comment by egourgoulhon created at 2017-11-19 10:27:07

LGTM. Thanks!

One last question: `ex1.is_trivially_equal(ex2)` is always faster than `(ex1-ex2).is_trivial_zero()`, isn't it?


---

Comment by egourgoulhon created at 2017-11-19 10:27:07

Changing status from needs_review to positive_review.


---

Comment by rws created at 2017-11-20 07:32:27

Replying to [comment:8 egourgoulhon]:
> One last question: `ex1.is_trivially_equal(ex2)` is always faster than `(ex1-ex2).is_trivial_zero()`, isn't it?

Yes, it's a tree walk in C++ that returns as soon as a difference in the tree is seen.


---

Comment by vbraun created at 2017-12-11 01:01:58

Resolution: fixed
