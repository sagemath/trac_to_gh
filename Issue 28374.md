# Issue 28374: Genus Representative

archive/issues_028374.json:
```json
{
    "body": "CC:  annahaensch\n\nCompute a representative quadratic form from a genus.\nThis should be added as a method `representative` of the `GenusSymbol_global_ring` class.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28611\n\n",
    "created_at": "2019-10-15T22:43:49Z",
    "labels": [
        "quadratic forms",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Genus Representative",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28374",
    "user": "sbrandhorst"
}
```
CC:  annahaensch

Compute a representative quadratic form from a genus.
This should be added as a method `representative` of the `GenusSymbol_global_ring` class.

Issue created by migration from https://trac.sagemath.org/ticket/28611





---

archive/issue_comments_400654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-05T20:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400654",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400655.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400655",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_400656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-07T12:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400656",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400657.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-07T12:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400657",
    "user": "sbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-08T09:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400658",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400659.json:
```json
{
    "body": "I believe you can change `(-b.q().lift().valuation(p)/2).ceil()` to `((-b.q().lift().valuation(p)+1) // 2)`, which will avoid going through `QQ`.\n\nAlso, I don't understand the logic behind `_compute_representative`. Why not make `representative` a ``@`cached_method`? You also do not have public access to the `LLL` option, nor is it used anywhere. If you still want to keep it and use the ``@`cached_method`, you can do\n\n```python\n@cached_method\ndef representative(self, LLL=True):\n    if LLL:\n        rep = self.representative(LLL=False)\n        return result_of_LLL\n    return computation_of_represenative\n```\n\nAlthough this does have a drawback of storing both the representatives in memory.\n\nCould you make the `# long time` doctest a little shorter, say, maybe only to `15`? 40s is a little long IMO.",
    "created_at": "2020-01-14T16:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400659",
    "user": "tscrim"
}
```

I believe you can change `(-b.q().lift().valuation(p)/2).ceil()` to `((-b.q().lift().valuation(p)+1) // 2)`, which will avoid going through `QQ`.

Also, I don't understand the logic behind `_compute_representative`. Why not make `representative` a ``@`cached_method`? You also do not have public access to the `LLL` option, nor is it used anywhere. If you still want to keep it and use the ``@`cached_method`, you can do

```python
@cached_method
def representative(self, LLL=True):
    if LLL:
        rep = self.representative(LLL=False)
        return result_of_LLL
    return computation_of_represenative
```

Although this does have a drawback of storing both the representatives in memory.

Could you make the `# long time` doctest a little shorter, say, maybe only to `15`? 40s is a little long IMO.



---

archive/issue_comments_400660.json:
```json
{
    "body": "A thought just occurred to me: You could clear the cache when `LLL=True` to avoid double storing the representative.",
    "created_at": "2020-01-14T16:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400660",
    "user": "tscrim"
}
```

A thought just occurred to me: You could clear the cache when `LLL=True` to avoid double storing the representative.



---

archive/issue_comments_400661.json:
```json
{
    "body": "The reason why I did not use the cached_method decorator is that\n\n\n```\nsage: Genus(matrix(ZZ,[1]))\nGenus of\n[1]\nSignature:  (1, 0)\nGenus symbol at 2:    [1^1]_1\n```\n\nstores the representative matrix at object creation in `_representative`.\nSo it is an optional argument in the genus class. \nCan this be achieved (better?) with `cached_method` as well?",
    "created_at": "2020-01-14T18:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400661",
    "user": "sbrandhorst"
}
```

The reason why I did not use the cached_method decorator is that


```
sage: Genus(matrix(ZZ,[1]))
Genus of
[1]
Signature:  (1, 0)
Genus symbol at 2:    [1^1]_1
```

stores the representative matrix at object creation in `_representative`.
So it is an optional argument in the genus class. 
Can this be achieved (better?) with `cached_method` as well?



---

archive/issue_comments_400662.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-14T20:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400662",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400663.json:
```json
{
    "body": "Ah, I see, that was what I didn't get because I was looking too locally at the changes. The way you have it is good. One other option would be to have `_representative` be a ``@`lazy_attribute`, but for this, you couldn't have the `LLL` option to pass to it.",
    "created_at": "2020-01-15T01:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400663",
    "user": "tscrim"
}
```

Ah, I see, that was what I didn't get because I was looking too locally at the changes. The way you have it is good. One other option would be to have `_representative` be a ``@`lazy_attribute`, but for this, you couldn't have the `LLL` option to pass to it.



---

archive/issue_comments_400664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-15T08:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400664",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400665.json:
```json
{
    "body": "o.k. this should be it.",
    "created_at": "2020-01-15T08:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400665",
    "user": "sbrandhorst"
}
```

o.k. this should be it.



---

archive/issue_comments_400666.json:
```json
{
    "body": "Thanks. Author name, and then you can set a positive review.",
    "created_at": "2020-01-15T16:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400666",
    "user": "tscrim"
}
```

Thanks. Author name, and then you can set a positive review.



---

archive/issue_comments_400667.json:
```json
{
    "body": "Thank you travis",
    "created_at": "2020-01-15T16:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400667",
    "user": "sbrandhorst"
}
```

Thank you travis



---

archive/issue_comments_400668.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-15T16:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400668",
    "user": "sbrandhorst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400669.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-20T21:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28374",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28374#issuecomment-400669",
    "user": "vbraun"
}
```

Resolution: fixed
