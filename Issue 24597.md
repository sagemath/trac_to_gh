# Issue 24597: py3: fixes for encoding in subprocess.Popen in sage.interfaces

Issue created by migration from https://trac.sagemath.org/ticket/24834

Original creator: embray

Original creation time: 2018-02-26 11:36:06

The easiest way I've found for dealing with interfaces that use `subprocess.Popen` is, on Python 3, to simply specify an encoding for the subprocess I/O.  Unfortunately this argument doesn't exist on Python 2 (a wrapper for this might be nice but the examples are few enough that I haven't been compelled to bother).


---

Comment by embray created at 2018-02-26 14:35:49

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-02-27 09:17:31

Why `latin-1`? That's a strange choice.


---

Comment by embray created at 2018-02-27 09:23:24

As usual, I explained in my commit messages:
> In these cases we go with latin-1, because the interface parsing does not anticipate any non-ASCII output from these programs, but we also allow any non-ASCII garbage that might come out (in which case any exceptions will occur in output parsing, not decoding).


---

Comment by embray created at 2018-02-27 09:25:58

The reason I might use latin-1 here, but not in some other interfaces, is that these are just very simple programs that output some ASCII text, and aren't likely to involve non-ASCII text. I could be wrong there but looking over how they work it seems unlikely.  This is true for most of the interfaces actually, but not quite all (e.g. some could produce error messages that contain system errors in whatever the system's language is, but not so here).


---

Comment by saraedum created at 2018-03-06 13:57:07

I think it would be nice if you added the comment about latin-1 in the source code where you use it. Sure, it's in the commit history, but once we drop Python 2 support (and remove the `if` clause,) it will not be the commit message for the last change in that lineâ€¦and it's certainly something that is very suprising to read there.

Once this is documented, I am very happy to give this a positive review.


---

Comment by saraedum created at 2018-03-06 13:57:17

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-05-25 20:21:08

branch does not apply, needs rebase


---

Comment by git created at 2018-05-28 09:51:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2018-05-29 07:48:55

Is this "needs_review" ? Looks good to me. Could you please fix the pyflakes plugin complaint ?


---

Comment by embray created at 2018-05-29 09:33:16

There was some comment about leaving a comment as to why I used latin-1 in one case, but I don't think it's necessary...


---

Comment by git created at 2018-05-30 07:16:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-05-30 07:16:36

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-05-30 07:19:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-05-31 06:13:02

ok, let it be


---

Comment by chapoton created at 2018-05-31 06:13:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-01 15:41:56

Resolution: fixed
