# Issue 28451: fix buckygen for modern C/C++

Issue created by migration from https://trac.sagemath.org/ticket/28688

Original creator: dimpase

Original creation time: 2019-11-02 10:46:30

CC:  dcoudert nvcleemp




---

Comment by dcoudert created at 2019-11-02 11:01:44

it should be an upstream change, right?


---

Comment by dcoudert created at 2019-11-13 19:56:01

See discussion [https://groups.google.com/forum/#!topic/sage-devel/ukJgMweHszU](https://groups.google.com/forum/#!topic/sage-devel/ukJgMweHszU)

File `splay.c` has changed in `nauty` (at least in 26r12). The main difference is 


```diff
- static SPLAYNODE* 
- SPLAY_DELETE(SPLAYNODE **to_root, SPLAYNODE *p)
+ void
+ SPLAY_DELETE(SPLAYNODE **to_root, SPLAYNODE *p)
```

With this change, I can do `gcc -O3 -std=c89 buckygen.c -o buckygen`.

So upstream must be updated.


---

Comment by dimpase created at 2019-12-30 02:21:46

Upstream has posted version 1.1.


---

Comment by dimpase created at 2019-12-30 02:49:29

Still, it's on C89. I've reported this to upstream

```
In file included from buckygen.c:272:
./splay.c:141:6: warning: implicit declaration of function 'outputnode' is invalid in C99 [-Wimplicit-function-declaration]
            ACTION(p);
            ^
buckygen.c:254:19: note: expanded from macro 'ACTION'
#define ACTION(p) outputnode(p)
                  ^
In file included from buckygen.c:272:
./splay.c:257:15: warning: implicit declaration of function 'comparenodes' is invalid in C99 [-Wimplicit-function-declaration]
        cmp = COMPARE(p);
              ^
buckygen.c:260:20: note: expanded from macro 'COMPARE'
#define COMPARE(p) comparenodes(canong, codelength, type, p)
                   ^
In file included from buckygen.c:272:
./splay.c:322:15: warning: implicit declaration of function 'comparenodes' is invalid in C99 [-Wimplicit-function-declaration]
        cmp = COMPARE(p);
              ^
buckygen.c:260:20: note: expanded from macro 'COMPARE'
#define COMPARE(p) comparenodes(canong, codelength, type, p)
                   ^
buckygen.c:943:1: warning: type specifier missing, defaults to 'int' [-Wimplicit-int]
outputnode(SPLAYNODE *liste)
^
```



---

Comment by dimpase created at 2020-01-01 17:12:58

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-01-01 17:12:58

New commits:


---

Comment by dcoudert created at 2020-01-04 10:19:14

LGTM.


---

Comment by dcoudert created at 2020-01-04 10:19:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-01-09 23:44:33

Resolution: fixed
