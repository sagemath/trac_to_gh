# Issue 12331: Convenient history fetch commands

Issue created by migration from Trac.

Original creator: klee

Original creation time: 2012-02-12 19:23:02

Assignee: was

Using Sage, you are missing a feature of the Magma command line interface. In Magma, if you enter a line found in history using up arrow key and then press down arrow key, then the next line in history is fetched. This feature allows you to fetch as many successive lines in history as you like. However, Sage does not have a similar feature. The  IPython command prompt uses the readline library (via pyreadline), which evidently does not support this feature. Magma has its own custom “readline-like” library, which does support this feature. (Since so many people have requested this feature, if anybody can figure out how to implement it, then such an implementation would certainly be welcome!)

This ticket addresses the above implementation.


---

Comment by jhpalmieri created at 2012-02-12 20:51:37

Is this a duplicate of #10289?


---

Comment by klee created at 2012-02-12 23:58:33

Replying to [comment:1 jhpalmieri]:
> Is this a duplicate of #10289?

Yes. I created this because I found no way to trigger the patchbot for the patch in #10289. I hope the patchbot works for this duplicate ticket.

I will add a comment on #10289 right now.


---

Comment by klee created at 2012-02-15 21:27:27

Changing status from new to needs_review.


---

Comment by kcrisman created at 2012-02-16 04:18:52

Replying to [comment:2 klee]:
> Replying to [comment:1 jhpalmieri]:
> > Is this a duplicate of #10289?
> 
> Yes. I created this because I found no way to trigger the patchbot for the patch in #10289. I hope the patchbot works for this duplicate ticket.

Just FYI, we can still give patches positive review even if the patchbot is screwing up.  Maybe you should give #10289 positive review with milestone sage-duplicate?   (Or maybe this one should be the duplicate, since it's a later-opened ticket.)

Also, you might want to rename the patch and change the commit message :-)


---

Comment by klee created at 2012-02-16 10:01:58

I think I am paranoic with the patchbot! Anyway the last patch would pass the patchbot. How can I remove the first patch, and trigger the patchbot with the new patch? :-)

Please someone review this patch.


---

Attachment

the same


---

Comment by klee created at 2012-02-18 01:39:16

The three patches are the same with different names. Sorry.


---

Comment by klee created at 2012-04-05 06:09:43

changed the commit message


---

Attachment

apply trac_12503.patch


---

Comment by klee created at 2012-04-06 11:17:11

Apply trac_12503.patch


---

Comment by klee created at 2012-04-06 14:59:37

rebased on 5.0.beta12


---

Attachment

removed trailing spaces


---

Attachment


---

Comment by klee created at 2012-04-13 09:03:45

Apply trac_12503_v2.patch


---

Attachment

rebased on 5.0.beta12


---

Comment by klee created at 2012-06-26 06:40:20

apply trac_12503_v3.patch


---

Comment by kini created at 2012-07-10 05:52:03

abra cadabra!

apply trac_12503_v3.patch

voila!


---

Attachment

rebased on 5.1.rc0


---

Comment by klee created at 2012-07-14 02:01:24

apply trac_12503_v3.patch


---

Comment by iandrus created at 2012-07-16 09:01:10

I tried using this a few times before but could never bind it to Control-o so I gave up.  I have an `inputrc` file and several other customizations that I thought might be interfering, but could never figure it out.  Today I finally took the time and so I'm putting it here in case others have the same problem.  Below is what happens as best I understand it.  I'm on OS X 10.6.

Before readline gets a character sequence it's interpreted by the terminal emulator and can be used to do things like turn flow control on and off.  These are generally bound to Control-s and Control-q and is, I think, fairly well known (at least I knew it).  However, there are other actions as well which can be determined by running `stty -a` and reading the `cchars` section.  In my case control-o was bound to discard.  These extra bindings can be turned of by running 

```
# Enable Ctrl-o
stty -iexten
# Enable Ctrl-s and Ctrl-q
stty -ixon
```

or by unbinding them individually like

```
stty discard undef
...
```



---

Comment by kcrisman created at 2012-07-16 13:40:21

I just have to ask whether this would change current behavior in the command line.   That is, would anything change for someone who didn't bind any metakeys, or didn't even really know what it was all about and was afraid of things like Emacs?


---

Comment by iandrus created at 2012-07-16 19:29:04

Replying to [comment:16 kcrisman]:
> I just have to ask whether this would change current behavior in the command line.   That is, would anything change for someone who didn't bind any metakeys, or didn't even really know what it was all about and was afraid of things like Emacs?

The current patch doesn't bind them, though I think it should.  If they were bound by default (to whatever Magma uses) then they would be more discoverable, and I think the only difference (beyond perhaps a minuscule performance penalty) would be `Ctl-o`, which I think isn't used for anything right now.  It would be good to have it confirmed that `Ctl-n` and `Ctl-p` are backwards compatible and `Ctl-o` is unused.

I skimmed the code and documentation and I noticed that on line 245 unbounded should be unbound.  Sadly, I don't know Cython well enough to feel comfortable reviewing it, though I can say it has been working fine for me (after I got my issues sorted out).  I think it would be nice to add a sentence to the documentation about `stty -iexten` etc.


---

Comment by klee created at 2012-07-17 05:21:44

Replying to [comment:15 iandrus]:
> I tried using this a few times before but could never bind it to Control-o so I gave up.  I have an `inputrc` file and several other customizations that I thought might be interfering, but could never figure it out.  Today I finally took the time and so I'm putting it here in case others have the same problem.  Below is what happens as best I understand it.  I'm on OS X 10.6.

Did you add the relevant lines into the "ipythonrc" as indicated in the documentation? You don't modify `inputrc` file in your home folder.


```
To bind these commands with keys, insert the relevant lines into the ``$DOT_SAGE/ipython/ipythonrc``
file. Note that ``$DOT_SAGE`` is ``$HOME/.sage`` by default. For example,

::

    readline_parse_and_bind "\C-o": operate-and-get-next
    readline_parse_and_bind "\e[A": history-search-backward-and-save
    readline_parse_and_bind "\e[B": history-search-forward-and-save

binds the three commands with the control-o key, the up arrow key, and the down arrow key,
respectively.           
```



---

Comment by klee created at 2012-07-17 05:24:04

Replying to [comment:16 kcrisman]:
> I just have to ask whether this would change current behavior in the command line.   That is, would anything change for someone who didn't bind any metakeys, or didn't even really know what it was all about and was afraid of things like Emacs?

This patch does not chanage anything before you put some relevant lines to the "ipythonrc" file in your dot_sage folder.


---

Comment by dimpase created at 2012-07-17 05:26:15

Replying to [comment:18 klee]:

I can confirm that this (GAP history settings) works on OSX 10.6. Shouldn't this go into documentation?


---

Comment by dimpase created at 2012-07-17 05:27:52

Replying to [comment:20 dimpase]:
> Replying to [comment:18 klee]:
> 
> I can confirm that this (GAP history settings) works on OSX 10.6. Shouldn't this go into documentation?
> 
OK, it is there already! Positive review :)


---

Comment by dimpase created at 2012-07-17 05:27:52

Changing status from needs_review to positive_review.


---

Attachment

modified to respond to the reviews


---

Comment by klee created at 2012-07-17 06:26:13

Apply trac_12503_v4.patch

Thank you for all reviews!


---

Comment by iandrus created at 2012-07-17 07:18:33

Replying to [comment:18 klee]:
> Replying to [comment:15 iandrus]:
> > I tried using this a few times before but could never bind it to Control-o so I gave up.  I have an `inputrc` file and several other customizations that I thought might be interfering, but could never figure it out.  Today I finally took the time and so I'm putting it here in case others have the same problem.  Below is what happens as best I understand it.  I'm on OS X 10.6.
> 
> Did you add the relevant lines into the "ipythonrc" as indicated in the documentation? You don't modify `inputrc` file in your home folder.

Yes.  I tried both and several other variations as well.  My problem was due entirely to the fact that somewhere `stty iexten` (or the equivalent) was being called and so it was impossible to get the `C-o` binding to work in any terminal application.


---

Comment by kcrisman created at 2012-07-17 13:25:53

> > I just have to ask whether this would change current behavior in the command line.   That is, would anything change for someone who didn't bind any metakeys, or didn't even really know what it was all about and was afraid of things like Emacs?
> 
> This patch does not chanage anything before you put some relevant lines to the "ipythonrc" file in your dot_sage folder. 

Sweet, thanks for confirming.  Of course, now I might be tempted to do so...


---

Comment by jdemeyer created at 2012-08-01 12:10:25

Resolution: fixed
