# Issue 25751: Bug in vertex cover for BipartiteGraph

Issue created by migration from Trac.

Original creator: dcoudert

Original creation time: 2018-08-02 09:47:55

CC:  zgershkoff saraedum


```
sage: B = BipartiteGraph(graphs.CycleGraph(6))
sage: B.vertex_cover()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-28-65ab8f66d68f> in <module>()
----> 1 B.vertex_cover()

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.pyc in vertex_cover(self, algorithm, value_only, reduction_rules, solver, verbosity)
   6627                         g.delete_vertex(w)
   6628                         for z in neigh:
-> 6629                             g.add_edge(u,z)
   6630 
   6631                         folded_vertices.append((u, v, w))

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/bipartite_graph.pyc in add_edge(self, u, v, label)
    826         if self.left.issuperset((u, v)) or self.right.issuperset((u, v)):
    827             raise RuntimeError(
--> 828                 "Edge vertices must lie in different partitions.")
    829 
    830         # automatically decide partitions for the newly created vertices

RuntimeError: Edge vertices must lie in different partitions.
```



---

Comment by dcoudert created at 2018-08-02 10:14:02

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-08-02 10:14:02

New commits:


---

Comment by zgershkoff created at 2018-08-02 16:52:40

I was thinking there might be something more efficient for bipartite graphs than the algorithms for general graphs, but nothing really comes to mind.

If you're rebuilding the graph like this:

```
+            g = Graph(data=self.edges(), format='list_of_edges',
+                          multiedges=self.allows_multiple_edges())
             g.allow_multiple_edges(False)
```

Wouldn't it be cleaner to just have `multiedges=False`?


---

Comment by dcoudert created at 2018-08-02 19:27:00

If we set `multiedges=False`, then the constructor will raise an error if the input list of edges has multiple edges.

Concerning the algorithm. We can compute vertex cover in polynomial time in bipartite graph. See https://en.wikipedia.org/wiki/K%C5%91nig%27s_theorem_(graph_theory). We can try to implement it if you like. The algorithm itself is easy (see my quick trial below). I did some tests and directly raises other issues like the matching algorithm that do not work for non connected bipartite graphs, etc.


```
def vertex_cover(B): 
    M = Graph(B.matching())
    left = set(B.left)
    right = set(B.right)

    # Initialize Z with vertices in left that are not involved in the
    # matching
    Z = left.difference(M.vertex_iterator())

    # Alternate: extend Z with all vertices reacheable by alternate paths
    # (match / non-match edges).
    X = set(Z)
    while X:
        # Follow non matched edges
        Y = set()
        for u in X:
            for v in B.neighbors(u):
                if not v in Z and not M.has_edge(u, v):
                    Y.add(v)
        Z.update(Y)

        # Follow matched edges
        X = set()
        for u in Y:
            for v in M.neighbor_iterator(u):
                if not v in Z:
                    X.add(v)
        Z.update(X)

    return list((left.difference(Z)).union(right.intersection(Z)))
```



---

Comment by zgershkoff created at 2018-08-03 06:19:48

Right, Konig's Theorem. That seems like the right way to do it (provided the matching works).

Replying to [comment:3 dcoudert]:
> If we set `multiedges=False`, then the constructor will raise an error if the input list of edges has multiple edges.
You sure? When I use a list of edges with redundant entries as input, I get a deprecation warning when multiedges is not specified, and the redundant entries are ignored if multiedges is False.


---

Comment by git created at 2018-08-04 08:09:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-08-04 08:13:17

I have:
- added necessary methods to get methods like `connected_components_subgraphs` and `subgraph` return a `BipartiteGraph`. 
- modified the `matching` to work properly with non-connected graphs. I have also remove code about weighted edges as the algorithms we have don't use weights
- implement Konig's algorithm for vertex cover.

Please do many tests !


---

Comment by git created at 2018-08-04 08:14:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-08-04 08:15:00

rebuild on top of last develop branch.


---

Comment by git created at 2018-08-28 11:06:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-08-28 11:07:39

I just rebuild on top of beta2 to check that its working well.


---

Comment by git created at 2018-08-29 13:04:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @bryangingechen created at 2018-09-01 02:17:31

Should `BipartiteGraph.vertex_cover()` and `BipartiteGraph.matching()` be able to handle the empty graph? They currently throw `NetworkXPointlessConcept` errors (with the default algorithm), but the corresponding methods in `GenericGraph` return empty lists.


---

Comment by git created at 2018-09-01 06:47:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-09-01 06:49:09

Right. Fixed.


---

Comment by @bryangingechen created at 2018-09-01 16:47:29

Changing status from needs_review to positive_review.


---

Comment by @bryangingechen created at 2018-09-01 16:47:29

Thanks, this now looks good to me!


---

Comment by vbraun created at 2018-09-02 09:36:59

Resolution: fixed
