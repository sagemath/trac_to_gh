# Issue 25751: Bug in vertex cover for BipartiteGraph

archive/issues_025751.json:
```json
{
    "body": "CC:  zgershkoff saraedum\n\n\n```\nsage: B = BipartiteGraph(graphs.CycleGraph(6))\nsage: B.vertex_cover()\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-28-65ab8f66d68f> in <module>()\n----> 1 B.vertex_cover()\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.pyc in vertex_cover(self, algorithm, value_only, reduction_rules, solver, verbosity)\n   6627                         g.delete_vertex(w)\n   6628                         for z in neigh:\n-> 6629                             g.add_edge(u,z)\n   6630 \n   6631                         folded_vertices.append((u, v, w))\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/bipartite_graph.pyc in add_edge(self, u, v, label)\n    826         if self.left.issuperset((u, v)) or self.right.issuperset((u, v)):\n    827             raise RuntimeError(\n--> 828                 \"Edge vertices must lie in different partitions.\")\n    829 \n    830         # automatically decide partitions for the newly created vertices\n\nRuntimeError: Edge vertices must lie in different partitions.\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25988\n\n",
    "created_at": "2018-08-02T09:47:55Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "Bug in vertex cover for BipartiteGraph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25751",
    "user": "dcoudert"
}
```
CC:  zgershkoff saraedum


```
sage: B = BipartiteGraph(graphs.CycleGraph(6))
sage: B.vertex_cover()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-28-65ab8f66d68f> in <module>()
----> 1 B.vertex_cover()

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.pyc in vertex_cover(self, algorithm, value_only, reduction_rules, solver, verbosity)
   6627                         g.delete_vertex(w)
   6628                         for z in neigh:
-> 6629                             g.add_edge(u,z)
   6630 
   6631                         folded_vertices.append((u, v, w))

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/bipartite_graph.pyc in add_edge(self, u, v, label)
    826         if self.left.issuperset((u, v)) or self.right.issuperset((u, v)):
    827             raise RuntimeError(
--> 828                 "Edge vertices must lie in different partitions.")
    829 
    830         # automatically decide partitions for the newly created vertices

RuntimeError: Edge vertices must lie in different partitions.
```


Issue created by migration from https://trac.sagemath.org/ticket/25988





---

archive/issue_comments_363362.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-02T10:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363362",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_363363.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-08-02T10:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363363",
    "user": "dcoudert"
}
```

New commits:



---

archive/issue_comments_363364.json:
```json
{
    "body": "I was thinking there might be something more efficient for bipartite graphs than the algorithms for general graphs, but nothing really comes to mind.\n\nIf you're rebuilding the graph like this:\n\n```\n+            g = Graph(data=self.edges(), format='list_of_edges',\n+                          multiedges=self.allows_multiple_edges())\n             g.allow_multiple_edges(False)\n```\n\nWouldn't it be cleaner to just have `multiedges=False`?",
    "created_at": "2018-08-02T16:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363364",
    "user": "zgershkoff"
}
```

I was thinking there might be something more efficient for bipartite graphs than the algorithms for general graphs, but nothing really comes to mind.

If you're rebuilding the graph like this:

```
+            g = Graph(data=self.edges(), format='list_of_edges',
+                          multiedges=self.allows_multiple_edges())
             g.allow_multiple_edges(False)
```

Wouldn't it be cleaner to just have `multiedges=False`?



---

archive/issue_comments_363365.json:
```json
{
    "body": "If we set `multiedges=False`, then the constructor will raise an error if the input list of edges has multiple edges.\n\nConcerning the algorithm. We can compute vertex cover in polynomial time in bipartite graph. See https://en.wikipedia.org/wiki/K%C5%91nig%27s_theorem_(graph_theory). We can try to implement it if you like. The algorithm itself is easy (see my quick trial below). I did some tests and directly raises other issues like the matching algorithm that do not work for non connected bipartite graphs, etc.\n\n\n```\ndef vertex_cover(B): \n    M = Graph(B.matching())\n    left = set(B.left)\n    right = set(B.right)\n\n    # Initialize Z with vertices in left that are not involved in the\n    # matching\n    Z = left.difference(M.vertex_iterator())\n\n    # Alternate: extend Z with all vertices reacheable by alternate paths\n    # (match / non-match edges).\n    X = set(Z)\n    while X:\n        # Follow non matched edges\n        Y = set()\n        for u in X:\n            for v in B.neighbors(u):\n                if not v in Z and not M.has_edge(u, v):\n                    Y.add(v)\n        Z.update(Y)\n\n        # Follow matched edges\n        X = set()\n        for u in Y:\n            for v in M.neighbor_iterator(u):\n                if not v in Z:\n                    X.add(v)\n        Z.update(X)\n\n    return list((left.difference(Z)).union(right.intersection(Z)))\n```\n",
    "created_at": "2018-08-02T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363365",
    "user": "dcoudert"
}
```

If we set `multiedges=False`, then the constructor will raise an error if the input list of edges has multiple edges.

Concerning the algorithm. We can compute vertex cover in polynomial time in bipartite graph. See https://en.wikipedia.org/wiki/K%C5%91nig%27s_theorem_(graph_theory). We can try to implement it if you like. The algorithm itself is easy (see my quick trial below). I did some tests and directly raises other issues like the matching algorithm that do not work for non connected bipartite graphs, etc.


```
def vertex_cover(B): 
    M = Graph(B.matching())
    left = set(B.left)
    right = set(B.right)

    # Initialize Z with vertices in left that are not involved in the
    # matching
    Z = left.difference(M.vertex_iterator())

    # Alternate: extend Z with all vertices reacheable by alternate paths
    # (match / non-match edges).
    X = set(Z)
    while X:
        # Follow non matched edges
        Y = set()
        for u in X:
            for v in B.neighbors(u):
                if not v in Z and not M.has_edge(u, v):
                    Y.add(v)
        Z.update(Y)

        # Follow matched edges
        X = set()
        for u in Y:
            for v in M.neighbor_iterator(u):
                if not v in Z:
                    X.add(v)
        Z.update(X)

    return list((left.difference(Z)).union(right.intersection(Z)))
```




---

archive/issue_comments_363366.json:
```json
{
    "body": "Right, Konig's Theorem. That seems like the right way to do it (provided the matching works).\n\nReplying to [comment:3 dcoudert]:\n> If we set `multiedges=False`, then the constructor will raise an error if the input list of edges has multiple edges.\nYou sure? When I use a list of edges with redundant entries as input, I get a deprecation warning when multiedges is not specified, and the redundant entries are ignored if multiedges is False.",
    "created_at": "2018-08-03T06:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363366",
    "user": "zgershkoff"
}
```

Right, Konig's Theorem. That seems like the right way to do it (provided the matching works).

Replying to [comment:3 dcoudert]:
> If we set `multiedges=False`, then the constructor will raise an error if the input list of edges has multiple edges.
You sure? When I use a list of edges with redundant entries as input, I get a deprecation warning when multiedges is not specified, and the redundant entries are ignored if multiedges is False.



---

archive/issue_comments_363367.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-04T08:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363367",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363368.json:
```json
{
    "body": "I have:\n- added necessary methods to get methods like `connected_components_subgraphs` and `subgraph` return a `BipartiteGraph`. \n- modified the `matching` to work properly with non-connected graphs. I have also remove code about weighted edges as the algorithms we have don't use weights\n- implement Konig's algorithm for vertex cover.\n\nPlease do many tests !",
    "created_at": "2018-08-04T08:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363368",
    "user": "dcoudert"
}
```

I have:
- added necessary methods to get methods like `connected_components_subgraphs` and `subgraph` return a `BipartiteGraph`. 
- modified the `matching` to work properly with non-connected graphs. I have also remove code about weighted edges as the algorithms we have don't use weights
- implement Konig's algorithm for vertex cover.

Please do many tests !



---

archive/issue_comments_363369.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-04T08:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363369",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363370.json:
```json
{
    "body": "rebuild on top of last develop branch.",
    "created_at": "2018-08-04T08:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363370",
    "user": "dcoudert"
}
```

rebuild on top of last develop branch.



---

archive/issue_comments_363371.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-28T11:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363371",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363372.json:
```json
{
    "body": "I just rebuild on top of beta2 to check that its working well.",
    "created_at": "2018-08-28T11:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363372",
    "user": "dcoudert"
}
```

I just rebuild on top of beta2 to check that its working well.



---

archive/issue_comments_363373.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-29T13:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363373",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363374.json:
```json
{
    "body": "Should `BipartiteGraph.vertex_cover()` and `BipartiteGraph.matching()` be able to handle the empty graph? They currently throw `NetworkXPointlessConcept` errors (with the default algorithm), but the corresponding methods in `GenericGraph` return empty lists.",
    "created_at": "2018-09-01T02:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363374",
    "user": "@bryangingechen"
}
```

Should `BipartiteGraph.vertex_cover()` and `BipartiteGraph.matching()` be able to handle the empty graph? They currently throw `NetworkXPointlessConcept` errors (with the default algorithm), but the corresponding methods in `GenericGraph` return empty lists.



---

archive/issue_comments_363375.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-01T06:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363375",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363376.json:
```json
{
    "body": "Right. Fixed.",
    "created_at": "2018-09-01T06:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363376",
    "user": "dcoudert"
}
```

Right. Fixed.



---

archive/issue_comments_363377.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-01T16:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363377",
    "user": "@bryangingechen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_363378.json:
```json
{
    "body": "Thanks, this now looks good to me!",
    "created_at": "2018-09-01T16:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363378",
    "user": "@bryangingechen"
}
```

Thanks, this now looks good to me!



---

archive/issue_comments_363379.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-02T09:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25751",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25751#issuecomment-363379",
    "user": "vbraun"
}
```

Resolution: fixed
