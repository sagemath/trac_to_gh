# Issue 12283: Make Airy functions symbolical

Issue created by migration from https://trac.sagemath.org/ticket/12455

Original creator: olazo

Original creation time: 2012-02-07 04:47:04

Assignee: tbd

CC:  kcrisman burcin benjaminfjones fredrik.johansson eviatarbach

Keywords: Airy functions

Currently sage can evaluate airy functions numerically:

```
sage: airy_ai(1.4)
0.0820380498076
```


but it doesn't work symbolically


```
sage: airy_ai(x)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/oscar/Escritorio/tesis/calculos/<ipython console> in <module>()

/home/oscar/sage/sage-4.7.1/local/lib/python2.6/site-packages/sage/functions/special.pyc in airy_ai(x)
    621    """
    622    _init()
--> 623    return RDF(meval("airy_ai(%s)"%RDF(x)))
    624 
    625 def airy_bi(x):

/home/oscar/sage/sage-4.7.1/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7102)()

/home/oscar/sage/sage-4.7.1/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.NamedConvertMap._call_ (sage/structure/coerce_maps.c:4221)()

/home/oscar/sage/sage-4.7.1/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._real_double_ (sage/symbolic/expression.cpp:5391)()

/home/oscar/sage/sage-4.7.1/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._eval_self (sage/symbolic/expression.cpp:4898)()

TypeError: Cannot evaluate symbolic expression to a numeric value.
```


We should make it symbolical for both airy_ai and airy_bi, as well as their derivatives.


---

Comment by olazo created at 2012-02-07 04:47:41

Changing assignee from tbd to burcin.


---

Comment by olazo created at 2012-02-07 04:47:41

Changing component from PLEASE CHANGE to symbolics.


---

Comment by olazo created at 2012-02-07 04:48:52

Changing assignee from burcin to olazo.


---

Attachment

I've added a patch, which should do the job, but it has a few shortcomings:

1.-The resulting symbolic functions seem to remain on hold:

```
sage: airy_ai(1.0)
airy_ai(1.00000000000000)
```

You need to force it to evaluate:

```
sage: airy_ai(1.0).n()
0.135292416313
```


2.- This doesn't work:

```
sage: airy_ai(2.0).n(digits=100)
0.0349241304233
```

3.- There is no evaluation for airy_ai_prime or airy_bi_prime

4.- I'm not sure about how should the functions be called, some possible schemes are

{ai,bi,aip,bip}
{ai,bai,aip,baip}
{airy_ai,airy_bi,airy_ai_prime,airy_bi_prime}

And also whether the latex representation should be capitalized or not. I chose the third scheme, and capitalized typesetting.


---

Comment by olazo created at 2012-02-07 08:06:12

Changing status from new to needs_review.


---

Comment by kcrisman created at 2012-02-07 13:59:30

Good start.  A few responses.
 * You'll need to have more methods.  We should probably use [mpmath](http://mpmath.googlecode.com/svn/trunk/doc/build/functions/bessel.html#airy-and-scorer-functions) to evaluate these functions in general, though using [the SciPy version](http://docs.scipy.org/doc/scipy/reference/generated/scipy.special.airy.html) could be useful over RDF.  See #11888 for a very recent example of this kind of thing and how to implement it.
 * That should also fix precision issues, if properly done, I think.
 * SciPy has evaluation for the airy primes.  I think that Maxima has these too.  (Cc:ing FJ in case he has plans to add these to mpmath.)
 * We should have translations of these to Maxima and friends.  That will probably help us name them.   What do Mathematica and Maple call them?
 * All methods, including initialization methods, need doctests.  Many of the new symbolic functions added at [symbolics](symbolics)/functions will have nice models to follow.

Thanks for getting us a start on this!   That's great.


---

Comment by kcrisman created at 2012-02-07 13:59:30

Changing status from needs_review to needs_work.


---

Comment by fredrik.johansson created at 2012-02-07 14:03:06

mpmath has the derivatives (as well as integrals) -- just use the optional 'derivative' parameter.


---

Comment by kcrisman created at 2012-02-07 14:05:49

> mpmath has the derivatives (as well as integrals) -- just use the optional 'derivative' parameter.
Ok, I didn't realize that was what that parameter was about.  Though in retrospect it seems obvious!


---

Comment by olazo created at 2012-02-07 22:14:07

On second thought, I think it would be better to use the airy equation to calculate derivatives or order higher than 1. Like


```
sage: airy_ai(2,x)
x*airy_ai(x)
sage: airy_ai(3,x)
airy_ai(x)+x*airy_ai_prime(x)
sage: diff(airy_ai(x),x,2)
x*airy_ai(x)
sage: diff(airy_ai(x),x,3)
airy_ai(x)+x*airy_ai_prime(x)
```


which is very likey to be the way mpmath calculates higher order derivatives. Integrals however, would be returned as:


```
sage: airy_ai(-1,x)
airy_ai(-1,x)
sage: integral(airy_ai(x),x)
airy_ai(-1,x)
```


what do you think?


---

Attachment

I just added a new patch. The new version includes generalized derivatives, evaluation with mpmath, and special values of the functions and their derivatives. Just a one doubt, the coverage is:


```
oscar@oscar-netbook:~$ sage -coverage airy.py
SCORE /home/oscar/sage/my_patches/airy.py: 76% (20 of 26)

Missing documentation:
	 * __init__(self):
	 * __init__(self):
	 * __init__(self):
	 * __init__(self):
	 * __init__(self):
	 * __init__(self):


Possibly wrong (function name doesn't occur in doctests):
	 * _derivative_(self, x, diff_param=None):
	 * _eval_(self, x):
	 * _evalf_(self, x, parent=None):
	 * _derivative_(self, x, diff_param=None):
	 * _eval_(self, x):
	 * _evalf_(self, x, parent=None):
	 * _derivative_(self, alpha, *args, **kwds):
	 * _eval_(self, alpha, *args):
	 * _evalf_(self, alpha, x, parent=None):
	 * _derivative_(self, x, diff_param=None):
	 * _eval_(self, x):
	 * _evalf_(self, x, parent=None):
	 * _derivative_(self, x, diff_param=None):
	 * _eval_(self, x):
	 * _evalf_(self, x, parent=None):
	 * _derivative_(self, alpha, *args, **kwds):
	 * _eval_(self, alpha, *args):
	 * _evalf_(self, alpha, x, parent=None):
```


Is that important?


---

Comment by olazo created at 2012-02-19 01:01:55

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2012-02-19 01:12:14

> Is that important?
The second part isn't, as you are implicitly testing these 'hidden' functions.  By the way,

```
Examples::
```

should be 

```
EXAMPLES::
```

However, the first part (the initialization methods) is important for our coverage.   You can just do a couple from the big examples that you have.

Do these pass doctests?  I'm surprised that 

```
sage: airy_ai_simple= FunctionAiryAiSimple()
```

would work when you run tests, assuming you didn't import `FunctionAiryAiSimple` into the global namespace.

Anyway, overall on a quick glance this looks great; unfortunately, I won't have time to review it properly soon - hopefully someone else will, because you put a lot of great work into it and we should totally have these symbolic.  Thanks!


---

Comment by olazo created at 2012-02-19 02:46:41

> Do these pass doctests?  I'm surprised that 
> {{{
> sage: airy_ai_simple= FunctionAiryAiSimple()
> }}}
> would work when you run tests, assuming you didn't import `FunctionAiryAiSimple` into the global namespace.

It looks like they do:

```
oscar@oscar-netbook:~$ sage -coverage airy.py
sage -t  "/home/oscar/sage/my_patches/airy.py"              
	 [51.5 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 51.7 seconds
```

Why shouldn't they? I'll take care of the __init__ functions.


---

Comment by olazo created at 2012-02-19 02:49:00

I'm sorry, that should be:

```
oscar@oscar-netbook:~$ sage -t airy.py
sage -t  "/home/oscar/sage/my_patches/airy.py"              
	 [51.5 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 51.7 seconds
```

(the command was sage -t)


---

Comment by kcrisman created at 2012-02-19 03:19:16

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2012-02-19 03:19:16


```
sage: airy_ai_simple= FunctionAiryAiSimple()
```

> would work when you run tests, assuming you didn't import `FunctionAiryAiSimple` into the global namespace.

I'm just surprised this doesn't cause trouble.  

On another note, this apparently does something weird when applied to 5.0.beta4.   Namely, Sage won't start:

```
---> 65 from sage.functions.all import sin, cos

ImportError: cannot import name sin
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.
```

I'll spare you the rest of the traceback.  I think there is some kind of circular import thing going on here, but I don't understand imports that well.  Perhaps moving the import of airy to further down (after trig functions) would help - that's a totally uninformed guess, of course.


---

Attachment

I just added a new patch, now with 100 % test coverage, but I still get this message:


```
oscar@oscar-netbook:~$ sage -coverage /home/oscar/sage/my_patches/airy.py ----------------------------------------------------------------------
/home/oscar/sage/my_patches/airy.py
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE /home/oscar/sage/my_patches/airy.py: 100% (26 of 26)
----------------------------------------------------------------------
```


What is this TestSuite thing? I also changed the order in which functions are initialized, so that airy_ai_general is initialized first. Doing it last made some symbolic operations, such as simplify not work (It said something about airy_ai requiring 2 arguments).


---

Comment by olazo created at 2012-02-21 18:44:12

Changing status from needs_work to needs_review.


---

Comment by benjaminfjones created at 2012-02-21 19:03:43

Hi Oscar,
I haven't looked over your patch very closely yet, but I plan to. One comment on first glance: in several places you call


```
return mpmath_utils.call(airy_bi_mpmath, x, derivative=1, parent=RR) 
```


but I think we want to preserve the parent of `x` instead of forcing it to be `RR`. Importing the `parent` function from `sage.structure.coerce` using a different name like `sage_parent` (because as burcin pointed out in one of my tickets, parent is the name of the parameter in `_evalf_`) and doing something like


```
from sage.structure.coerce import parent as sage_parent
R = parent or sage_parent(x)
return mpmath_utils.call(airy_bi_mpmath, x, derivative=1, parent=R)
```


would do the trick I think. 

Other comment: can we add conversions to Maxima along with the Mma conversion you included? Here is a link to the appropriate chapter in the manual: http://maxima.sourceforge.net/docs/manual/en/maxima_15.html#SEC80


---

Comment by benjaminfjones created at 2012-02-29 02:33:39

The patch applies to 5.0.beta6 cleanly, but upon `sage -br` I get an import error ending with:


```
/home/jonesbe/sage/sage-5.0.beta6/local/lib/python2.7/site-packages/sage/gsl/dft.py in <module>()
     63 from sage.rings.real_mpfr import RR
     64 from sage.rings.all import I
---> 65 from sage.functions.all import sin, cos
     66 from sage.gsl.fft import FastFourierTransform
     67 from sage.gsl.dwt import WaveletTransform

ImportError: cannot import name sin
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.
```


Seems like the same thing kcrisman ran into with the previous patch applied to 5.0.beta4.


---

Comment by benjaminfjones created at 2012-02-29 02:33:39

Changing status from needs_review to needs_work.


---

Comment by benjaminfjones created at 2012-03-24 16:38:51

I found the cause of the problem in comment [comment:17]. There is a circular import going on because

```
from airy import airy_ai, airy_bi
```

occurs at the top of `sage/functions/all.py`. If you move it to the bottom of the file, sage starts just fine.

There a several doctests that fail, however. Oscar, I think that running `sage -coverage` only checks to see if there are doctest for every function, it doesn't actually run the tests. Use


```
sage -t devel/sage/sage/functions/airy.py
```


to run the tests and get feedback.


---

Comment by benjaminfjones created at 2012-05-26 17:45:08

Here at SD 40.5, we're going to pick this ticket up, do the work, and get it into sage.


---

Comment by benjaminfjones created at 2012-05-26 17:57:42

Changing keywords from "Airy functions" to "Airy functions sd40.5".


---

Comment by dsm created at 2012-05-29 05:11:18

Okay, I'm posting this for future reference.  I've attempted to preserve as much as possible of the original code while switching to the "new-style" dictionary-argument .n() approach we're working on in #12289, but I'm setting it to "needs work" myself while we think through some of the consequences of the switch.  Some of the _evalf_ stuff violates DRY and I'm not yet sure of the best way to deal with it.

As well, the patch currently segfaults in testing when it computes beta(0.5, 0.5) due to some problem with the current #12289 package, which I suspect is unrelated.  But I think the new approach is beginning to take shape.


---

Attachment

newstyle rewrite, version 1


---

Comment by dsm created at 2012-05-29 05:15:04

Oh, yeah: and #13028 was a significant nuisance while working on this.


---

Attachment


---

Comment by eviatarbach created at 2013-06-19 00:09:19

New patch, which should pass all doctests once #12289 is merged.

It makes the following changes:
* Changing an incorrect `airy_bi` identity
* Adding `airy.py` to the documentation
* Checking whether `n` is an integer (for some reason mpmath is able to evaluate numerically with non-integral `n`)
* Formatting changes
* Removing the parent's precision check because it wasn't used
* Removing the check for the `parent` keyword because Burcin told me to

Patchbot apply trac_12455_newstyle_airy.patch trac_12455_newstyle_airy2.patch


---

Comment by eviatarbach created at 2013-06-19 00:19:04

Changing keywords from "Airy functions sd40.5" to "Airy functions sd40.5 sd48".


---

Comment by kcrisman created at 2013-06-19 01:48:58

Needs review, then?  Note that I had to rebase #12289.


---

Comment by kcrisman created at 2013-06-19 01:48:58

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2013-06-19 20:12:57

Patchbot apply trac_12455-newstyle-airy-rebase.patch and trac_12455_newstyle_airy2.patch

I don't know that either of the needs work issues are still there...


---

Comment by kcrisman created at 2013-06-19 20:19:36

This needs a trivial extra patch to fix

```

sage -t sage/functions/special.py
**********************************************************************
File "sage/functions/special.py", line 389, in sage.functions.special._init
Failed example:
    spherical_harmonic(3,2,1,2)
Expected:
    15/4*sqrt(7/30)*e^(4*I)*sin(1)^2*cos(1)/sqrt(pi)
Got:
    15/4*sqrt(7/30)*cos(1)*e^(4*I)*sin(1)^2/sqrt(pi)
**********************************************************************
```

which is really a rebase issue off of #9880, no worries.


---

Comment by kcrisman created at 2013-06-19 21:18:58

Okay, a little more rebasing for #12289.  Patches coming up.


---

Comment by kcrisman created at 2013-06-19 21:27:04

Apply trac_12455-newstyle-airy-rebase.patch and trac_12455-newstyle-airy2-rebase.patch


---

Comment by kcrisman created at 2013-06-19 21:28:12

Eviatar, how much would you say still needs to be reviewed?  (In the sense that you have not yet given it positive review.)  Just your patch?

(I'm running doctests now.)


---

Comment by kcrisman created at 2013-06-19 21:32:55

I made some mistake while rebasing - one moment.


---

Comment by eviatarbach created at 2013-06-19 21:35:03

I think I was fairly thorough, but I haven't positive-reviewed since my patch hasn't been looked at by someone else.


---

Attachment

Okay, now I have to fix something in the other one... sigh.  Final version coming soon, it _does_ pass tests!


---

Attachment


---

Comment by kcrisman created at 2013-06-19 21:56:19

Patchbot, apply trac_12455-newstyle-airy-rebase.patch and trac_12455-newstyle-airy2-rebase.patch


---

Comment by kcrisman created at 2013-06-19 22:54:38

> (for some reason mpmath is able to evaluate numerically with non-integral n)
But this is even in the documentation you wrote!

```
Return the `\alpha`-th order fractional derivative with respect to `z`.
```

"Fractional", right?  So ... ?  Plus, you do _not_ make this change in airy_bi, only airy_ai, for some reason.

Another question:

```
sage: (plot(airy_bi(x), (x, -10, 5)) +\ 
```

Are we allowing this kind of continuation in doctests still?  I can't remember but seem to recall something about this being a problem.

Otherwise this all seems fine.


---

Comment by eviatarbach created at 2013-06-19 23:07:53

I didn't write it. But looking at the mpmath documentation, it should work. It didn't work for most values before my patch anyway, but I'll see what I can do.


---

Comment by eviatarbach created at 2013-06-19 23:07:53

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2013-06-19 23:29:47

> I didn't write it. 
Good point, sorry!  In fact, it's just copied from [the mpmath doc](http://mpmath.googlecode.com/svn/tags/0.17/doc/build/functions/bessel.html#airyai).  But now you have taken charge :-)  Unfortunately, I can't find a lot of independent implementations of this...


---

Attachment


---

Comment by burcin created at 2013-06-20 01:43:31

[attachment:trac_12455-airy_review.patch] fixes a couple of problems:

 * `airy_{a,b}i_general` should evaluate to `airy_{a,b}i_simple`, `airy_{a,b}i_prime`, etc. depending on the first parameter

 * differentiating `airy_{a,b}i_general` in the first parameter is not allowed

 * `_evalf_` should not raise errors for unrecognized algorithm argument


This is still needs work because we use indirect doctests everywhere. There is no reason to go through the `airy_{a,b}i` wrapper functions. We should call the symbolic functions directly in the doctests. There are also a lot of code paths that are not tested. I changed the fractional order behavior, but didn't need to change any doctests.

It would be great if someone else can fix/add doctests. I will move on to something else now.


---

Comment by eviatarbach created at 2013-09-10 03:48:35

This patch depends on a new release of Pynac and other fixes to make the `algorithm` keyword work sensibly. Also, I don't see much point in having the Maxima implementation as an option, considering the fact that it doesn't accept complex input, doesn't have arbitrary precision, and is slower than mpmath (doesn't appear to scale better either).

I'd hate to delay this patch longer, especially considering that the Airy functions are probably among the most-used special functions. Could we remove the Maxima option for now and perhaps add it in the future, maybe along with a patch that adds a SciPy option as suggested in one of the comments?


---

Comment by benjaminfjones created at 2013-09-10 06:03:25

I'm fine with removing Maxima from the options for numerical evaluation (numerical is not generally where Maxima shines). I agree with `@`burcin, though, that indirect doctests should be fixed wherever possible and become direct tests and that the branch coverage should be higher.

What exactly is the issue with having the Maxima option? Is it the limited precision and domain? We could always check that inputs are okay whenever Maxima is selected and raise an exception otherwise.


---

Comment by git created at 2014-07-24 08:16:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-07-24 08:16:32

Replying to [comment:43 benjaminfjones]:
> What exactly is the issue with having the Maxima option? Is it the limited precision and domain? We could always check that inputs are okay whenever Maxima is selected and raise an exception otherwise.
It's useless, especially when scipy is implemented as algorithm. OTOH, it introduces more code paths to test and deepens a dependency that is unwanted.

Oh, and scipy is a bit faster:

```
sage: timeit("airy_bi(2).n(algorithm='maxima')")
625 loops, best of 3: 685 µs per loop
sage: timeit("airy_bi(2).n(algorithm='scipy')")
625 loops, best of 3: 124 µs per loop
```



---

Comment by git created at 2014-07-24 15:05:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-07-24 15:15:05

Changing status from needs_work to needs_review.


---

Comment by rws created at 2014-07-24 15:15:05

Everything was reviewed up to my recent changes:

* merged develop
* removal of maxima and inclusion of scipy for numerics
* replacement of indirect with direct doctests (still 100% coverage)
* removal of hold_derivate keyword from `airy_ai/bi_general()` where it wasn't implemented (it is still in `airy_ai/bi()` wrapper functions
* small index at the top of documentation for orientation, because of confusing presentation order of functions, which cannot be controlled, sadly

So please review.


---

Comment by chapoton created at 2014-08-23 12:20:55

one failing doctest, see patchbot report


---

Comment by chapoton created at 2014-08-23 12:20:55

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-08-26 11:19:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-08-26 11:20:54

Changing assignee from olazo to rws.


---

Comment by rws created at 2014-08-26 11:22:05

Changing assignee from rws to olazo.


---

Comment by rws created at 2014-08-26 11:22:31

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2014-09-25 19:59:03

Rebased on 6.4.beta3, and add a few `# rel tol` to the scipy results.
----
New commits:


---

Comment by git created at 2014-09-28 07:29:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-09-30 14:07:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-09-30 14:13:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-10-02 09:21:14

Changing status from needs_review to needs_work.


---

Comment by rws created at 2014-10-02 09:21:14


```
sage -t --long src/sage/functions/airy.py
**********************************************************************
File "src/sage/functions/airy.py", line 404, in sage.functions.airy.airy_ai
Failed example:
    plot(airy_ai(x), (x, -10, 5)) + plot(airy_ai_prime(x),
     (x, -10, 5), color='red')
Expected nothing
Got:
    Graphics object consisting of 2 graphics primitives
**********************************************************************
File "src/sage/functions/airy.py", line 799, in sage.functions.airy.airy_bi
Failed example:
    plot(airy_bi(x), (x, -10, 5)) + plot(airy_bi_prime(x),
     (x, -10, 5), color='red')
Expected nothing
Got:
    Graphics object consisting of 2 graphics primitives
```



---

Comment by git created at 2014-10-03 14:48:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-10-03 14:49:18

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-10-11 18:57:04

Just to make you aware: this conflicts with #17130. When either of these tickets gets positive_review, the other should be rebased.


---

Comment by jdemeyer created at 2014-10-11 18:59:45

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2014-10-11 18:59:45

And why the change to `def hypergeometric_U`? The new code seems quite hackish, why is it needed and how does it relate to this ticket?


---

Comment by jdemeyer created at 2014-10-11 19:12:53

These should be an error:

```
sage: airy_ai(3).n(algorithm='scipy', prec=200)
0.006591139357460719
sage: airy_ai(3).n(algorithm='whatever')
0.00659113935746072
```


And I don't like this either (parent should be `RR`):

```
sage: parent(airy_ai(3).n(algorithm='scipy'))
Real Double Field
```



---

Comment by jdemeyer created at 2014-10-11 19:12:53

Changing status from needs_info to needs_work.


---

Comment by jdemeyer created at 2014-10-11 19:22:28

What's the point of

```
if len(args) > 0:
   raise TypeError(("symbolic function airy_ai takes at most 3 arguments "
      "({} given)").format(len(args) + 3))
```

why not simply remove `*args` completely then?


---

Comment by rws created at 2014-10-12 16:47:13

Replying to [comment:66 jdemeyer]:
> And why the change to `def hypergeometric_U`? The new code seems quite hackish, why is it needed and how does it relate to this ticket?
I think that unrelated patch can be safely removed because scipy evaluation is replaced by mpmath in #14896 (of course hoping that that gets reviewed at some time).


---

Comment by git created at 2014-10-13 14:39:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-10-13 14:40:16

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-11-29 15:34:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2015-02-03 02:47:54

Frédéric, how much of this did you positively review up to now?  In principle you and rws can review each other's contributions here.  It would take me a while to get up to speed here.


---

Comment by chapoton created at 2015-03-10 20:13:52

a typo in line 5 of the doc:

```
Airy functions are solutions to the differential equation `f''(z) +f(z)x=0`.
```

The differential equation is wrong, should be `f'' - x f = 0`


---

Comment by git created at 2015-03-11 13:58:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-03-11 13:59:20

Changing assignee from olazo to rws.


---

Comment by mmezzarobba created at 2015-03-12 10:11:19

x should be z in the differential equation


---

Comment by mmezzarobba created at 2015-03-12 10:45:22

What exactly still needs review here?

The code looks pretty good to me overall, but there are lots of things I don't understand in detail. (For a simple example, what is the motivation for splitting the implementation in so many unrelated classes?) And yet I'm tempted to give this ticket positive review (leaving possible remaining issues for later), since many other people have looked at it and it is clearly an improvement over what sage currently has.


---

Comment by mmezzarobba created at 2015-03-12 11:12:57

More nitpicking, not necessarily for this ticket:
* Raising a `ValueError` in `FunctionAiryAiGeneral._derivative_` when `diff_param == 0` may not be the most appropriate, since (if I'm not mistaken) the partial derivative would make sense mathematically.
* Is it necessary to special-case `alpha == 0` etc. in `FunctionAiryAiGeneral._evalf_`?


---

Comment by mmezzarobba created at 2015-03-12 12:26:37

Replying to [comment:80 mmezzarobba]:
> * Is it necessary to special-case `alpha == 0` etc. in `FunctionAiryAiGeneral._evalf_`?

Scratch that, I misread the code.


---

Comment by git created at 2015-03-12 12:42:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2015-03-12 13:22:26

One last thing: IMO `hold_derivative` should be `True` by default in `airy_ai` and `airy_bi`, except perhaps when the differentiation order is one. But I don't know if that's consistent with the way things are done in other parts of sage symbolics. Thoughts?


---

Comment by rws created at 2015-03-12 14:20:47

Replying to [comment:80 mmezzarobba]:
> x should be z in the differential equation
Strange typo.
> * Raising a `ValueError` in `FunctionAiryAiGeneral._derivative_` when `diff_param == 0` may not be the most appropriate, since (if I'm not mistaken) the partial derivative would make sense mathematically.
A quick look at old and new code shows 1. `ValueError`, 2. `NotImplementedError`, 3. `assert`. So, this needs to be unified to `NotImplementedError`.
> One last thing: IMO `hold_derivative` should be `True` by default in `airy_ai` and `airy_bi`, except perhaps when the differentiation order is one. But I don't know if that's consistent with the way things are done in other parts of sage symbolics. Thoughts?
I believe the code of this ticket is the only one that has such a parameter, so please feel free to improve it.

I have looked at your patch and it's fine, so if you think the rest is OK please set positive.


---

Comment by git created at 2015-03-12 14:57:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2015-03-12 15:01:23

Replying to [comment:84 rws]:
> > * Raising a `ValueError` in `FunctionAiryAiGeneral._derivative_` when `diff_param == 0` may not be the most appropriate, since (if I'm not mistaken) the partial derivative would make sense mathematically.
> A quick look at old and new code shows 1. `ValueError`, 2. `NotImplementedError`, 3. `assert`. So, this needs to be unified to `NotImplementedError`.
> > One last thing: IMO `hold_derivative` should be `True` by default in `airy_ai` and `airy_bi`, except perhaps when the differentiation order is one. But I don't know if that's consistent with the way things are done in other parts of sage symbolics. Thoughts?
> I believe the code of this ticket is the only one that has such a parameter, so please feel free to improve it.

Both done (now rather than later to avoid breaking the interface).

> I have looked at your patch and it's fine, so if you think the rest is OK please set positive.

I'm okay with everything prior to my commits. Could you (or someone else) have a quick look at my last changes and set the ticket to positive review? Thanks!


---

Comment by rws created at 2015-03-12 15:14:32

Changing status from needs_review to positive_review.


---

Comment by rws created at 2015-03-12 15:14:32

Is fine and passes tests in `functions/`. Thank you too.


---

Comment by vbraun created at 2015-03-12 23:06:43

Resolution: fixed
