# Issue 25581: Fix build issue with libpng

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2018-07-10 17:44:18

I just noticed this small bug in the DESTDIR build support for libpng.  This might explain why I and others sometimes have build problems surrounding libpng.

This symlink should get deleted before it's installed in `$SAGE_LOCAL`.  Otherwise it takes a re-installation of libpng in order to force the symlink to be removed.


---

Comment by embray created at 2018-07-10 17:44:39

Changing status from new to needs_review.


---

Comment by embray created at 2018-07-10 18:20:34

Fixing this (and in some cases also not fixing it) seems to break giac, which is linking with `-lpng` instead of `-lpng16`.

That would explain some of the spurious patchbot build failures I've been seeing.


---

Comment by embray created at 2018-07-10 18:46:03

Hmm, it seems we need to patch giac.


---

Comment by git created at 2018-07-10 19:18:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-07-10 19:19:21

Adds a patch to giac to ensure that it links against `-lpng16` when available, rather than `-lpng`.

Amusingly, _almost_ the correct incantation, albeit a bit misspelled, was already in its `configure.in` but commented out.


---

Comment by embray created at 2018-07-11 12:32:07

I e-mailed the upstream patch to Bernard Parisse.


---

Comment by embray created at 2018-07-11 16:38:18

I guess?

> Hi,
>
> Thanks for the patch, it will be included in the next releases.


---

Comment by saraedum created at 2018-07-17 15:28:55

Changing status from needs_review to positive_review.


---

Comment by embray created at 2018-07-17 17:26:09

Several patchbots appear to be in some kind of broken state. I don't think it's due to this ticket; rather their owners should probably reset them.


---

Comment by embray created at 2018-07-18 11:47:03

I believe this issue can reasonably be addressed for Sage 8.4.


---

Comment by vbraun created at 2018-08-05 08:43:30

Resolution: fixed
