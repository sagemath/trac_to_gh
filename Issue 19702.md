# Issue 19702: Fix EuclideanRings.ParentMethods._test_quo_rem to use `not r.is_zero()` rather than `r!=0`

Issue created by migration from https://trac.sagemath.org/ticket/19939

Original creator: nthiery

Original creation time: 2016-01-21 17:41:16

CC:  slelievre vdelecroix




---

Comment by nthiery created at 2016-01-21 17:53:33

Changing type from PLEASE CHANGE to defect.


---

Comment by nthiery created at 2016-01-21 17:53:33

Changing component from PLEASE CHANGE to categories.


---

Comment by nthiery created at 2016-01-21 17:53:33

New commits:


---

Comment by nthiery created at 2016-01-21 17:53:33

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-01-23 19:03:57

Trivial comment, but why not replace

```
if r != 0:
```

by

```
if r:
```

If this works, this will be the fastest way.


---

Comment by nthiery created at 2016-01-23 20:09:06

I indered pondered about this. I went for using `r.is_zero()` for
style consistency with the nearby zero tests. But I don't have a
strong opinion, and I am fine switching to `if r`. In that case, maybe
the nearby zero tests should be changed accordingly for
consistency. What do you think?

By the way: I looked at the current tests failure. They are due to the
default implementation of `quo_rem` for `Fields` which return a plain
`0` for the remainder instead of the zero of the field:


```
    sage: K.<a> = NumberField(x^3 - 2); K
    Number Field in a with defining polynomial x^3 - 2
    sage: y = K.an_element()
    sage: y.parent()
    Number Field in a with defining polynomial x^3 - 2
    sage: q,r = y.quo_rem(y-1)
    sage: q,r
    sage: parent(q)               # OK
    Number Field in a with defining polynomial x^3 - 2
    sage: type(r)                 # GASP!!!
    <type 'int'>
```

I am going to handle this right now by:

1. Updating `EuclideanRings.ParentMethods._test_quo_rem` to test for this
2. Fixing the default implementation of quo_rem


---

Comment by jdemeyer created at 2016-01-23 20:17:57

Replying to [comment:5 nthiery]:
> I indered pondered about this. I went for using `r.is_zero()` for
> style consistency with the nearby zero tests. But I don't have a
> strong opinion, and I am fine switching to `if r`. In that case, maybe
> the nearby zero tests should be changed accordingly for
> consistency. What do you think?

I don't have a strong opinion. When choosing between different equivalent options like this, I would choose depending on efficiency and you cannot beat `if r` then. Feel free to change all zero tests like this.


---

Comment by nthiery created at 2016-01-23 20:38:24

`FieldElement.quo_rem` almost duplicates `Fields.ElementMethods.quo_rem`, with the same bug of returning a plain zero, but with the additional feature of doing coercion on rem.

Do you see any situation where this method could be time critical, or should I just remove `FieldElement.quo_rem` (and move up the coercion feature)?


---

Comment by git created at 2016-01-23 22:27:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-23 22:41:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-23 23:00:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2016-01-24 00:09:14

Replying to [comment:6 jdemeyer]:
> I don't have a strong opinion. When choosing between different equivalent options like this, I would choose depending on efficiency and you cannot beat `if r` then. Feel free to change all zero tests like this.

Thinking twice about it: this `_test_method` is going to be run just once for each parent, so speed is not an issue here. Besides `is_zero` is more explicit for the reader, especially for new developers who may stumble upon this while learning to implement an EuclideanRing.

Changing all `is_zero` consistently can be done in a later ticket, if someone cares.

Thanks for your feedback though!


---

Comment by slelievre created at 2016-01-24 00:23:07

Polishing. Jeroen, I'll let you give positive review if you're satisfied.


---

Comment by nthiery created at 2016-01-24 00:27:34

New commits:


---

Comment by slelievre created at 2016-01-24 00:29:08

Re-setting to the polished branch.
----
New commits:


---

Comment by nthiery created at 2016-01-24 00:30:12

For the record: I proofread Sam's latest commit over his shoulder.


---

Comment by nthiery created at 2016-01-24 00:32:57

Changing keywords from "" to "days70.5".


---

Comment by nthiery created at 2016-04-26 10:42:46

The patchbot reported a ReST typo which I now fixed. The test failures that it reports seem unrelated. I am rerunning them here. Let's also see what the new patchbot run says.


---

Comment by nthiery created at 2016-04-26 20:19:32

Hi Jeroen,

The patchbot is now ok. Could you confirm that you are ok with how your comments have been taken care of, and if yes set a positive review?

Thanks!
----
New commits:


---

Comment by jdemeyer created at 2016-05-30 13:31:25

I don't like this:

```
if not have_same_parent(self, other):
    other = self.parent()(other)
```

You should use coercion instead.


---

Comment by jdemeyer created at 2016-05-30 13:31:25

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-05-30 13:32:26

But really, you don't even need coercion. You can just compute `self/other` and that will do the coercion for you.


---

Comment by jdemeyer created at 2016-05-30 13:33:07

The question is: what should be the parent of the zero remainder?


---

Comment by jdemeyer created at 2016-05-31 16:28:41

I think that the parent of the remainder should be equal to the parent of the quotient. So I propose something like

```
def quo_rem(self, other):
    quo = self / other
    return quo, quo.parent().zero()
```



---

Comment by nthiery created at 2016-05-31 16:30:30

+1!
Will try to do this change soon.


---

Comment by jdemeyer created at 2016-05-31 17:43:37

Maybe it's safer to do

```
def quo_rem(self, other):
    quo = self / other
    return quo, parent(quo)(0)
```

since we're not guaranteed that the quotient is a Sage `Element`.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
