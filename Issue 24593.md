# Issue 24593: port uncompress/tar_file.py to python3

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2018-02-23 22:39:17

CC:  vbraun embray chapoton

the internals of python's tarfile.py have changed, and the override of `_extract_member` in `uncompress/tar_file.py` misses parameters. Namely, if your system python is python3, you will get

```
Setting up build directory for patch-2.7.5
Traceback (most recent call last):
  File "/mnt/opt/Sage/sage-clang/build/bin/sage-uncompress-spkg", line 23, in <module>
    run()
  File "/mnt/opt/Sage/sage-clang/build/bin/../sage_bootstrap/uncompress/cmdline.py", line 72, in run
    unpack_archive(archive, dirname)
  File "/mnt/opt/Sage/sage-clang/build/bin/../sage_bootstrap/uncompress/action.py", line 68, in unpack_archive
    archive.extractall(members=archive.names)
  File "/mnt/opt/Sage/sage-clang/build/bin/../sage_bootstrap/uncompress/tar_file.py", line 90, in extractall
    members=members)
  File "/usr/lib64/python3.5/tarfile.py", line 1998, in extractall
    numeric_owner=numeric_owner)
  File "/usr/lib64/python3.5/tarfile.py", line 2040, in extract
    numeric_owner=numeric_owner)
TypeError: _extract_member() got an unexpected keyword argument 'set_attrs'
```

as soon as you start a clean build of Sage.


---

Comment by dimpase created at 2018-02-23 23:02:47

while I am at it:

```
$ pylint tar_file.py 
No config file found, using default configuration
************* Module sage_bootstrap.uncompress.tar_file
W: 67, 4: Parameters differ from overridden 'chmod' method (arguments-differ)
W: 74, 4: Parameters differ from overridden 'utime' method (arguments-differ)
W: 79, 4: Parameters differ from overridden 'extractall' method (arguments-differ)
W:103, 4: Parameters differ from overridden '_extract_member' method (arguments-differ)
W:153,15: Catching too general exception Exception (broad-except)

------------------------------------------------------------------
Your code has been rated at 9.09/10 (previous run: 9.09/10, +0.00)
```



---

Comment by embray created at 2018-02-27 16:35:47

I don't think I've tried building Sage with Python 3 as the default "bootstrap" Python, but indeed that should definitely work, especially as more distros are finally defaulting to Python 3.

Is this the only issue you've encountered so far?


---

Comment by embray created at 2018-02-27 16:36:45

Set assignee to embray.


---

Comment by dimpase created at 2018-02-27 17:11:46

This is the first bug one hits, I didn't go further. I suppose that merely adding the extra (Python3-only) key arguments to the functions overriding the ones in the library will do here (as key args are optional, and so more is OK for Python2 as well).


---

Comment by embray created at 2018-03-02 11:09:54

Changing priority from major to blocker.


---

Comment by embray created at 2018-03-02 11:09:54

From the sound of things this is a regression too, since it used to work on Python 3 but now it doesn't.


---

Comment by embray created at 2018-03-02 11:10:35

Changing type from enhancement to defect.


---

Comment by embray created at 2018-03-02 12:02:15

Changing status from new to needs_review.


---

Comment by embray created at 2018-03-02 12:02:15

New commits:


---

Comment by chapoton created at 2018-03-02 12:19:01

missing blank lines after `.. note::` twice


---

Comment by @embray created at 2018-03-02 15:23:41

Okay, but that isn't strictly needed by RST I don't think.


---

Comment by chapoton created at 2018-03-02 15:25:43

sorry for the bikesheding. I would be happy to give a positive review, but I would prefer  if Dima tests if it works.

This seems to have hurt somebody : https://groups.google.com/forum/#!topic/sage-support/UmGFtjcnm6Y


---

Comment by @embray created at 2018-03-02 15:26:59

Yeah, I've already talked to Viviane about it.


---

Comment by chapoton created at 2018-03-02 15:59:38

Did she try the branch here ?


---

Comment by dimpase created at 2018-03-03 07:04:49

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2018-03-03 07:04:49

works, and docs build


---

Comment by vbraun created at 2018-03-04 23:29:21

Resolution: fixed
