# Issue 19830: Change ring to QQbar fails for subschemes

Issue created by migration from Trac.

Original creator: bhutz

Original creation time: 2016-02-16 17:40:19

Assignee: bhutz

Change ring for subschemes does not let the user specify an embedding and so fails for QQbar


```
K.<w>=QuadraticField(2)
P.<x,y> = ProjectiveSpace(K,1)
X = P.subscheme(x-y)
X.change_ring(QQbar)
```



```
K.<w>=QuadraticField(2)
P.<x,y> = ProjectiveSpace(K,1)
X = P.subscheme(x-y)
H = End(X)
f = H([6*x^2+2*x*y+16*y^2,-3*x^2-4*x*y-4*y^2])
f.change_ring(QQbar)
```



---

Comment by git created at 2016-02-16 19:38:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2016-02-16 19:40:43

I added the embedding option for subschemes and made some other improvements to change_ring() in general to make it a little more robust.


---

Comment by bhutz created at 2016-02-16 19:40:43

Changing status from new to needs_review.


---

Comment by git created at 2016-02-18 02:49:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2016-02-18 17:47:19

1. Has coerce map from instead of try accept
2. raise warning if embedding not specified and no coerce map

Still doing functionality testing.


---

Comment by git created at 2016-02-25 18:49:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2016-02-25 18:50:25

changing the try/except to has_coerce_map_from reduced the functionality. For example QQ to GF(3) does not have a coerce map from, but can be done.

Consequently, I only added the warning.


---

Comment by nbruin created at 2016-02-25 20:07:53

Can't we just make sure that `base_change` or `change_ring` can also be given a ring homomorphism from the base ring, to base extend to the codomain of the homomorphism? Then

```
X=Scheme(Q,...)
k=GF(3)
Xk=X.base_change(k.convert_map_from(QQ))
```

would work (provided we don't check if the map really is a homomorphism).
Then we can have that `X.base_change(GF(3))` can still raise an error (because it's not well-defined), but we can still get an answer.


---

Comment by bhutz created at 2016-02-25 20:20:37

Not sure exactly what you are suggesting here.  If it is just the ability to supply the mapping, then that is actually the main change here. There is now an optional `embedding` parameter that can be specified

```
Xk=X_change_ring(embedding=k.convert_map_from(QQ))
```

The remaining issue was what to do if not specified. In this case, one is attempted to be constructed (the try/except parts...). When this is not unique, you seem to be suggesting raising an error and having the user construct the particular map they want. It seemed more user friendly to me to simply choose one and provide a warning that happened.


---

Comment by nbruin created at 2016-02-25 21:51:49

Replying to [comment:11 bhutz]:
> The remaining issue was what to do if not specified. In this case, one is attempted to be constructed (the try/except parts...). When this is not unique, you seem to be suggesting raising an error and having the user construct the particular map they want. It seemed more user friendly to me to simply choose one and provide a warning that happened.

The problem is that we don't have a channel to reliably report warnings through. If you print them in places where people aren't particularly looking for output, they are easily missed. In fact, STDOUT might be redirected to /dev/null, and messages on STDERR might be hard to match up with the rest of the data (if it gets read at all).

To quote the Zen of Python: "In the face of ambiguity, refuse the temptation to guess.". I'm not for following the Zen religiously, but I think it's a good principle. In this case, I think the error is a more honest and ultimately more reliable solution than making some non-canonical guess.


---

Comment by bhutz created at 2016-02-25 22:47:49

I understand the concern and definitely didn't want to silently guess, hence the verbose warning. However, there was some precedent since

```
K.<w>=CyclotomicField(3)
CC(w)
```

just works and 'guesses' what embedding to use.

However, if just raising an error is more in-line with similar other functionality, I can do that instead.


---

Comment by git created at 2016-02-26 00:09:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2016-02-26 00:10:44

on further looking, that wasn't a precedent since cyclotomic fields create an embedding by default as part of their creation.

So here is a version where I've removed the 'guessing'


---

Comment by git created at 2016-02-26 00:13:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2016-02-26 13:01:09

I don't like the embedding keyword syntax. I'm going to check this to accept passing the ring in. This is more compatible with the other existing change_ring functions.


---

Comment by bhutz created at 2016-02-26 13:01:09

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-02-26 20:41:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-26 20:45:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2016-02-26 20:48:01

Changing status from needs_work to positive_review.


---

Comment by bhutz created at 2016-02-26 20:48:01

I think this new version is cleaner and is ready to be reviewed.

btw, there seems to be a doc failure on 7.1.beta5 which is merged with this ticket that is unrelated.


```
src/sage/matrix/matrix_double_dense.pyx
```


It fails with and without these changes.


---

Comment by vbraun created at 2016-02-26 21:28:54

Reviewer name is missing


---

Comment by vbraun created at 2016-02-26 21:28:54

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-02-26 21:29:06

I mean, Author name


---

Comment by bhutz created at 2016-02-26 22:30:24

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2016-02-26 22:30:24

I meant to set this to needs review.  Added author.


---

Comment by rlmiller created at 2016-03-03 16:43:29

Changing status from needs_review to positive_review.


---

Comment by rlmiller created at 2016-03-03 16:43:29

Looks good to me!


---

Comment by vbraun created at 2016-03-03 21:22:25

Merge conflict, please merge in the latest beta...


---

Comment by vbraun created at 2016-03-03 21:22:25

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-03-04 02:26:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2016-03-04 02:27:10

Changing status from needs_work to needs_review.


---

Comment by rlmiller created at 2016-03-05 07:25:04

Changing status from needs_review to positive_review.


---

Comment by rlmiller created at 2016-03-05 07:25:04

Looks good to me. No error with new commits in the latest beta.


---

Comment by vbraun created at 2016-03-05 18:11:46

Resolution: fixed


---

Comment by jdemeyer created at 2016-03-22 13:38:23

What do you prefer: "Rebecca Lauren Miller" or "Rebecca Miller"?


---

Comment by kcrisman created at 2016-03-22 14:00:48

Given that comment:6 was done by rlmiller, I would guess the "Lauren" version.


---

Comment by rlmiller created at 2016-03-22 21:04:51

Yes,  The Lauren Version. I will update all previous tickets.
