# Issue 25144: py3: adding .items iterator to vectors

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2018-05-17 08:20:53

CC:  embray jdemeyer

to help build doc in python3


---

Comment by chapoton created at 2018-05-17 08:21:44

New commits:


---

Comment by chapoton created at 2018-05-17 08:21:44

Changing status from new to needs_review.


---

Comment by embray created at 2018-05-17 15:45:12

+1 in principle.

I have a different approach to this in my python3 branch that I haven't made a ticket for yet.  What do you think?


```diff
diff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx
index 29b2de1..814afa7 100644
--- a/src/sage/modules/free_module_element.pyx
+++ b/src/sage/modules/free_module_element.pyx
`@``@` -821,6 +821,7 `@``@` def random_vector(ring, degree=None, *args, **kwds):
     entries = [ring.random_element(*args, **kwds) for _ in range(degree)]
     return vector(ring, degree, entries, sparse)

+
 cdef class FreeModuleElement(Vector):   # abstract base class
     """
     An element of a generic free module.
`@``@` -1545,6 +1546,28 `@``@` cdef class FreeModuleElement(Vector):   # abstract base class
         from sage.arith.all import lcm
         return lcm(v)

+    def items(self):
+        """
+        Return an iterable over self.
+
+        On Python 2 this returns the same as ``list(self.iteritems())``, while
+        on Python 3 this is an alias for ``self.items()``.  This is for
+        congruence with ``dict.items()``.
+
+        EXAMPLES::
+
+            sage: v = vector([1, 2/3, pi])
+            sage: v.items()  # py2
+            [(0, 1), (1, 2/3), (2, pi)]
+            sage: v.items()  # py3
+            <generator object at ...>
+        """
+
+        IF PY_MAJOR_VERSION < 3:
+            return list(self.iteritems())
+        ELSE:
+            return self.iteritems()
+
     def iteritems(self):
         """
         Return iterator over self.
`@``@` -4543,7 +4566,7 `@``@` cdef class FreeModuleElement_generic_sparse(FreeModuleElement):
                 e = entries
                 entries = {}
                 try:
-                    for k, x in e.iteritems():
+                    for k, x in e.items():
                         x = coefficient_ring(x)
                         if x:
                             entries[k] = x
`@``@` -4734,11 +4757,11 `@``@` cdef class FreeModuleElement_generic_sparse(FreeModuleElement):

             sage: v = vector([1,2/3,pi], sparse=True)
             sage: v.iteritems()
-            <dictionary-itemiterator object at ...>
+            <dict...itemiterator object at ...>
             sage: list(v.iteritems())
             [(0, 1), (1, 2/3), (2, pi)]
         """
-        return self._entries.iteritems()
+        return iter(self._entries.iteritems())

     def __reduce__(self):
         """
```



---

Comment by chapoton created at 2018-05-17 17:07:03

oh, well. Given that "items" currently does not exist, one can just provide it directly with the python3 behaviour. Otherwise, this opens the possibility that someone will use that "items" in a python3-incompatible way, and that we will have to fix this bad use later..


---

Comment by embray created at 2018-05-18 12:26:49

That is true--the question is to be compatible with Python 2 semantics on Python 2, or just be immediately forward-compatible with Python 3.  Since `FreeModuleElement` is not _actually_ a `dict` subclass I think we have some freedom to pick the latter.

In that case though what you might do instead is actually rename the `iteritems()` method to just `items()` and make `iteritems()` and deprecated (perhaps just informally?) alias for `items()`.


---

Comment by git created at 2018-05-18 13:25:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-05-18 13:32:13

Done.

I do not think that one should deprecate formally anything.


---

Comment by embray created at 2018-05-18 13:34:18

I'm inclined to agree in this case, though I can't quite articulate why.


---

Comment by embray created at 2018-05-18 13:34:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-19 15:56:46

Resolution: fixed
