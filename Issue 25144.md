# Issue 25144: py3: adding .items iterator to vectors

archive/issues_025144.json:
```json
{
    "body": "CC:  embray jdemeyer\n\nto help build doc in python3\n\nIssue created by migration from https://trac.sagemath.org/ticket/25381\n\n",
    "created_at": "2018-05-17T08:20:53Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "py3: adding .items iterator to vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25144",
    "user": "chapoton"
}
```
CC:  embray jdemeyer

to help build doc in python3

Issue created by migration from https://trac.sagemath.org/ticket/25381





---

archive/issue_comments_354008.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-17T08:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354008",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_354009.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-17T08:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354009",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354010.json:
```json
{
    "body": "+1 in principle.\n\nI have a different approach to this in my python3 branch that I haven't made a ticket for yet.  What do you think?\n\n\n```diff\ndiff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx\nindex 29b2de1..814afa7 100644\n--- a/src/sage/modules/free_module_element.pyx\n+++ b/src/sage/modules/free_module_element.pyx\n@@ -821,6 +821,7 @@ def random_vector(ring, degree=None, *args, **kwds):\n     entries = [ring.random_element(*args, **kwds) for _ in range(degree)]\n     return vector(ring, degree, entries, sparse)\n\n+\n cdef class FreeModuleElement(Vector):   # abstract base class\n     \"\"\"\n     An element of a generic free module.\n@@ -1545,6 +1546,28 @@ cdef class FreeModuleElement(Vector):   # abstract base class\n         from sage.arith.all import lcm\n         return lcm(v)\n\n+    def items(self):\n+        \"\"\"\n+        Return an iterable over self.\n+\n+        On Python 2 this returns the same as ``list(self.iteritems())``, while\n+        on Python 3 this is an alias for ``self.items()``.  This is for\n+        congruence with ``dict.items()``.\n+\n+        EXAMPLES::\n+\n+            sage: v = vector([1, 2/3, pi])\n+            sage: v.items()  # py2\n+            [(0, 1), (1, 2/3), (2, pi)]\n+            sage: v.items()  # py3\n+            <generator object at ...>\n+        \"\"\"\n+\n+        IF PY_MAJOR_VERSION < 3:\n+            return list(self.iteritems())\n+        ELSE:\n+            return self.iteritems()\n+\n     def iteritems(self):\n         \"\"\"\n         Return iterator over self.\n@@ -4543,7 +4566,7 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):\n                 e = entries\n                 entries = {}\n                 try:\n-                    for k, x in e.iteritems():\n+                    for k, x in e.items():\n                         x = coefficient_ring(x)\n                         if x:\n                             entries[k] = x\n@@ -4734,11 +4757,11 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):\n\n             sage: v = vector([1,2/3,pi], sparse=True)\n             sage: v.iteritems()\n-            <dictionary-itemiterator object at ...>\n+            <dict...itemiterator object at ...>\n             sage: list(v.iteritems())\n             [(0, 1), (1, 2/3), (2, pi)]\n         \"\"\"\n-        return self._entries.iteritems()\n+        return iter(self._entries.iteritems())\n\n     def __reduce__(self):\n         \"\"\"\n```\n",
    "created_at": "2018-05-17T15:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354010",
    "user": "embray"
}
```

+1 in principle.

I have a different approach to this in my python3 branch that I haven't made a ticket for yet.  What do you think?


```diff
diff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx
index 29b2de1..814afa7 100644
--- a/src/sage/modules/free_module_element.pyx
+++ b/src/sage/modules/free_module_element.pyx
@@ -821,6 +821,7 @@ def random_vector(ring, degree=None, *args, **kwds):
     entries = [ring.random_element(*args, **kwds) for _ in range(degree)]
     return vector(ring, degree, entries, sparse)

+
 cdef class FreeModuleElement(Vector):   # abstract base class
     """
     An element of a generic free module.
@@ -1545,6 +1546,28 @@ cdef class FreeModuleElement(Vector):   # abstract base class
         from sage.arith.all import lcm
         return lcm(v)

+    def items(self):
+        """
+        Return an iterable over self.
+
+        On Python 2 this returns the same as ``list(self.iteritems())``, while
+        on Python 3 this is an alias for ``self.items()``.  This is for
+        congruence with ``dict.items()``.
+
+        EXAMPLES::
+
+            sage: v = vector([1, 2/3, pi])
+            sage: v.items()  # py2
+            [(0, 1), (1, 2/3), (2, pi)]
+            sage: v.items()  # py3
+            <generator object at ...>
+        """
+
+        IF PY_MAJOR_VERSION < 3:
+            return list(self.iteritems())
+        ELSE:
+            return self.iteritems()
+
     def iteritems(self):
         """
         Return iterator over self.
@@ -4543,7 +4566,7 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):
                 e = entries
                 entries = {}
                 try:
-                    for k, x in e.iteritems():
+                    for k, x in e.items():
                         x = coefficient_ring(x)
                         if x:
                             entries[k] = x
@@ -4734,11 +4757,11 @@ cdef class FreeModuleElement_generic_sparse(FreeModuleElement):

             sage: v = vector([1,2/3,pi], sparse=True)
             sage: v.iteritems()
-            <dictionary-itemiterator object at ...>
+            <dict...itemiterator object at ...>
             sage: list(v.iteritems())
             [(0, 1), (1, 2/3), (2, pi)]
         """
-        return self._entries.iteritems()
+        return iter(self._entries.iteritems())

     def __reduce__(self):
         """
```




---

archive/issue_comments_354011.json:
```json
{
    "body": "oh, well. Given that \"items\" currently does not exist, one can just provide it directly with the python3 behaviour. Otherwise, this opens the possibility that someone will use that \"items\" in a python3-incompatible way, and that we will have to fix this bad use later..",
    "created_at": "2018-05-17T17:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354011",
    "user": "chapoton"
}
```

oh, well. Given that "items" currently does not exist, one can just provide it directly with the python3 behaviour. Otherwise, this opens the possibility that someone will use that "items" in a python3-incompatible way, and that we will have to fix this bad use later..



---

archive/issue_comments_354012.json:
```json
{
    "body": "That is true--the question is to be compatible with Python 2 semantics on Python 2, or just be immediately forward-compatible with Python 3.  Since `FreeModuleElement` is not *actually* a `dict` subclass I think we have some freedom to pick the latter.\n\nIn that case though what you might do instead is actually rename the `iteritems()` method to just `items()` and make `iteritems()` and deprecated (perhaps just informally?) alias for `items()`.",
    "created_at": "2018-05-18T12:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354012",
    "user": "embray"
}
```

That is true--the question is to be compatible with Python 2 semantics on Python 2, or just be immediately forward-compatible with Python 3.  Since `FreeModuleElement` is not *actually* a `dict` subclass I think we have some freedom to pick the latter.

In that case though what you might do instead is actually rename the `iteritems()` method to just `items()` and make `iteritems()` and deprecated (perhaps just informally?) alias for `items()`.



---

archive/issue_comments_354013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-18T13:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354013",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354014.json:
```json
{
    "body": "Done.\n\nI do not think that one should deprecate formally anything.",
    "created_at": "2018-05-18T13:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354014",
    "user": "chapoton"
}
```

Done.

I do not think that one should deprecate formally anything.



---

archive/issue_comments_354015.json:
```json
{
    "body": "I'm inclined to agree in this case, though I can't quite articulate why.",
    "created_at": "2018-05-18T13:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354015",
    "user": "embray"
}
```

I'm inclined to agree in this case, though I can't quite articulate why.



---

archive/issue_comments_354016.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-18T13:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354016",
    "user": "embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_354017.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-19T15:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25144#issuecomment-354017",
    "user": "vbraun"
}
```

Resolution: fixed
