# Issue 7071: palp-1.1.p1 ignores CC variable and uses gcc, so fails with Sun Studio.

Issue created by migration from Trac.

Original creator: drkirkby

Original creation time: 2009-09-29 13:27:04

Assignee: tbd

CC:  mjo

Using

    * Solaris 10 update 7 on SPARC
    * sage-4.1.2.alpha4
    * Sun Studio 12.1
    * An updated configure script to allow the Sun compiler to be used #7021

This is one of the many packages that ignore the setting of the variable CC. 

```
palp-1.1.p1/src/GNUmakefile
palp-1.1.p1/src/mori.c
Finished extraction
****************************************************
Host system
uname -a:
SunOS swan 5.10 Generic_139555-08 sun4u sparc SUNW,Sun-Blade-1000
****************************************************
****************************************************
CC Version
/opt/xxxsunstudio12.1/bin/cc -v
usage: cc [ options] files.  Use 'cc -flags' for details
****************************************************
make[2]: Entering directory `/export/home/drkirkby/sage/sage-4.1.2.alpha4/spkg/build/palp-1.1.p1/src'
gcc -O3 -g -W -Wall -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE   -c -o poly.o poly.c
gcc -O3 -g -W -Wall -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE   -c -o Coord.o Coord.c
gcc -O3 -g -W -Wall -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE   -c -o Rat.o Rat.c
gcc -O3 -g -W -Wall -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE   -c -o Vertex.o Vertex.c

```



---

Comment by ohanar created at 2012-02-09 14:45:38

Changing status from new to needs_review.


---

Attachment

for review purposes


---

Comment by mjo created at 2012-02-25 23:15:22

Changing status from needs_review to needs_work.


---

Comment by mjo created at 2012-02-25 23:15:22

Can we pass CFLAGS, too? That will allow us to get rid of that horrible `sed`. Might as well fix the "xyes" test also


---

Comment by vbraun created at 2012-02-26 19:37:58

Palp 2 is out and I have a preliminary spkg at #12055. Please base your work on the new version.


---

Comment by ohanar created at 2012-02-27 00:35:05

Changing status from needs_work to needs_review.


---

Comment by ohanar created at 2012-02-27 00:35:05

ok, I've based my changes off of the new version at #12055 and have made `CFLAGS` respected as well.


---

Attachment

for review purposes


---

Comment by vbraun created at 2012-02-27 01:02:40

Looks good!


---

Comment by vbraun created at 2012-02-27 01:02:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-02-27 01:07:44

Patch from #12055 needs to be applied


---

Attachment

I've switched the old ticket #12055 to invalid to not make Jeroen replace the spkg twice. But we still need the patch to the Sage library from there.


---

Comment by drkirkby created at 2012-02-28 22:52:06

Replying to [comment:2 mjo]:
> Can we pass CFLAGS, too? That will allow us to get rid of that horrible `sed`. Might as well fix the "xyes" test also

The "xyes" test, as it is called above, is the safest, most portable way to test for a string, as other methods, like the proposed change, can fail under obscure conditions. One might argue they don't fail with modern versions of bash, but IMHO is it worthwhile to write scripts which will always work under all conditions. The original code will always work - the proposed change is less portable. I suggest you take a look at the scripts created by autoconf. You will find they use a similar method to what was in Sage, as it is known to always work. 

As such, I believe the change is a retrograde step. 

Dave


---

Comment by drkirkby created at 2012-02-28 22:52:19

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2012-03-02 22:09:39

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2012-03-02 22:09:39

I disagree. The xblah test makes it more difficult to read the test, which both increases the chance for errors as well as the long-term maintenance effort. 

A quick survey shows that at least half of the Sage spkgs use the simplified test, so clearly nobody has yet encountered a shell ancient enough to not work. I'm pretty sure many upstream sources use simplified tests, too, so there is basically no hope of ever compiling Sage on such a system without installing a shell that isn't from the middle ages. Autotools output really is a totally different issue, since their scripts are autogenerated readability is not an issue (and usually is pretty bad, in fact).

If you disagree we can discuss this on the sage-devel, but its such a pervasive issue throughout Sage that it doesn't really matter if we use the simplified test in one spkg more or less.


---

Comment by jdemeyer created at 2012-03-04 21:19:52

Resolution: fixed
