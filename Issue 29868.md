# Issue 29868: sage.libs.ecl: Add Python function ecl_make_string

Issue created by migration from https://trac.sagemath.org/ticket/30105

Original creator: mkoeppe

Original creation time: 2020-07-10 19:03:41

CC:  nbruin dimpase @spaghettisalat @mwageringel

`sage.libs.ecl` exposes no Python function that converts a Python string to a Lisp string as an `EclObject`. 

(`python_to_ecl`, which is used by ``EclObject.__init__`, handles strings by `READ`ing from them, so `EclObject("abc")` returns an interned symbol, not a string.)

We add a Python function `ecl_make_simple_string` to fill this gap.


---

Comment by mkoeppe created at 2020-07-10 19:06:45

In fact, perhaps it would also make sense to add an optional argument to `python_to_ecl` and `EclObject.__init__` that controls whether Python strings (which may also be nested in lists etc.) are merely converted (using the new function) or `READ` from.


---

Comment by dimpase created at 2020-07-10 19:20:56

how about making use of things like `ecl_to_double()` to send data between Python and Maxima?


---

Comment by mkoeppe created at 2020-07-10 19:33:06

Replying to [comment:4 dimpase]:
> how about making use of things like `ecl_to_double()` to send data between Python and Maxima?
This is the opposite direction of conversion, and these functions are already used in `ecl_to_python`.


---

Comment by mkoeppe created at 2020-07-10 19:33:32

Replying to [comment:2 mkoeppe]:
> In fact, perhaps it would also make sense to add an optional argument to `python_to_ecl` and `EclObject.__init__` that controls whether Python strings (which may also be nested in lists etc.) are merely converted (using the new function) or `READ` from.
I have revised the ticket description accordingly.


---

Comment by mkoeppe created at 2020-07-10 20:28:41

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-07-10 20:28:41

New commits:


---

Comment by mkoeppe created at 2020-07-10 20:40:47

This works but the unicode handling needs to be improved.

```
sage: from sage.libs.ecl import *
sage: fire = EclObject('ðŸ”¥', False)
sage: fire
<ECL: "ðŸ”¥">
sage: _length = ecl_eval('''#'length''')
sage: _length(fire)
<ECL: 4>
sage: _type_of = ecl_eval('''#'type-of''')
sage: _type_of(fire)
<ECL: (SIMPLE-ARRAY BASE-CHAR (4))>
```



---

Comment by mkoeppe created at 2020-07-10 21:12:56

For unicode issues, see #30106.

Let's ignore them here to keep the ticket limited in scope.


---

Comment by git created at 2020-07-11 19:46:19

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2020-07-12 17:39:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-12 17:40:37

Merged latest version of #30106. Needs review


---

Comment by dimpase created at 2020-07-18 11:04:04

lgtm


---

Comment by dimpase created at 2020-07-18 11:04:04

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-07-18 16:35:04

Thanks!


---

Comment by vbraun created at 2020-07-28 22:34:21

Resolution: fixed
