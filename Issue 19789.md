# Issue 19789: Reverse the scale of colors in Matrix.plot

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2016-02-09 11:14:13

CC:  jason

Currently, a plot of the identity matrix yields a mostly black square, with white squares on the diagonal. Don't we all expect the opposite?

In particular, the current choice of color map attributes the background color (white) to the maximum intensity, while we usually expect the maximum intensity to 'stand out', and not be invisible.

This branch fixes it.

Nathann


---

Comment by ncohen created at 2016-02-09 11:14:45

Changing status from new to needs_review.


---

Comment by ncohen created at 2016-02-09 11:14:45

New commits:


---

Comment by jmantysalo created at 2016-02-09 15:32:14

At least for me this is more logical now. Also test passed -> positive review.

IMO this can't be said as a clear bug, so I changed this to enhancement.


---

Comment by jmantysalo created at 2016-02-09 15:32:14

Changing type from defect to enhancement.


---

Comment by jmantysalo created at 2016-02-09 15:32:14

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2016-02-09 15:36:14

Yooooo !

Thanks,

Nathann


---

Comment by kcrisman created at 2016-02-09 16:15:42

Changing status from positive_review to needs_info.


---

Comment by kcrisman created at 2016-02-09 16:15:42

I don't feel like it's really appropriate to change this without some extra discussion somewhere.  It's clearly not a bug.  Remember, long-time "customers" may be used to this behavior (I can't even find a ticket for when this was added!), so a change within five hours seems a little on the quick side.  E.g., what is matplotlib's actual default for `imshow()` in this situation?

And the branch doesn't even mention any changes in the documentation alerting people that this is now different!

Compare to #18463 which (eventually) fixed an actual bug.


---

Comment by kcrisman created at 2016-02-09 16:18:28

Replying to [comment:4 kcrisman]:
> I don't feel like it's really appropriate to change this without some extra discussion somewhere.  It's clearly not a bug.  Remember, long-time "customers" may be used to this behavior (I can't even find a ticket for when this was added!), so a change within five hours seems a little on the quick side.  E.g., what is matplotlib's actual default for `imshow()` in this situation?

(On the other hand, if this was the previous default and was broken as some point, more power to this.)


---

Comment by kcrisman created at 2016-02-09 16:27:49

See also http://stackoverflow.com/questions/22121239/matplotlib-imshow-default-colour-normalisation


---

Comment by ncohen created at 2016-02-09 16:30:50

> I don't feel like it's really appropriate to change this without some extra discussion somewhere.  It's clearly not a bug.  Remember, long-time "customers" may be used to this behavior (I can't even find a ticket for when this was added!), so a change within five hours seems a little on the quick side.  E.g., what is matplotlib's actual default for `imshow()` in this situation?

The default behaviour seems to be what you get by setting 'cmap' to None:


```
sage: matrix.random(IntegerModRing(5),5,5).plot(cmap=None)
```


It also matches the examples given there:

http://matplotlib.org/examples/pylab_examples/image_interp.html

> And the branch doesn't even mention any changes in the documentation alerting people that this is now different!

If you see a smart way to do it, you are welcome to add a commit. I'm 100% sure that none of those who call this method will read the docstring *before* they notice the change. And if they do read the doc afterwards, all they can learn there is "Yeah, there has been a change".

> Compare to #18463 which (eventually) fixed an actual bug.

This ticket seems unrelated to the color scale.

Nathann


---

Comment by kcrisman created at 2016-02-09 16:32:25

Discussion at https://github.com/matplotlib/matplotlib/issues/875 suggests that `gray` is still popular.


---

Comment by ncohen created at 2016-02-09 16:36:38

Do you have any question that would force us to keep this in `needs_info`? Do you want to start a sage-devel thread?

Alternatively, and to prove some intellectual honesty:

Can you show the two pictures to any colleague of yours, and ask them which one they feel is the most natural to represent the identity matrix?


```
sage: matrix.identity(15).plot(cmap='gray')
sage: matrix.identity(15).plot(cmap='Greys')
```


I did it with two colleagues of mine, both of which gave the same answer. I was very careful to not give them any hint of what I was thinking. The second even said that "it's even better to have a lot of white for sparse matrices, as having mostly black uses more ink when printed".

None of then had any hesitation.

Nathann


---

Comment by ncohen created at 2016-02-09 16:38:32

> Discussion at https://github.com/matplotlib/matplotlib/issues/875 suggests that `gray` is still popular.

What do you mean by that? Of course there are people around who use 'gray'. It is probably useful for this of that kind of plot. I'm not saying that 'gray' is inherently bad, I'm just saying that representing zeros with black and 1 with the background color is probably the worst default behaviour you can find.

Even blue+red would be clearer.

Nathann


---

Comment by kcrisman created at 2016-02-09 16:39:06

> The default behaviour seems to be what you get by setting 'cmap' to None:
> 


Correct, the much-maligned `jet`.  Apparently there is not default grayscale, though as I say above `gray` seems to be the most-used.

So there are a few questions here.
* Do we want to change the scale
* Do we want to keep it grayscale
* What is the "most popular" way to deal with grayscale in mpl and matlab
* If we change, how to alert users to this change in an efficient manner.

I would have agreed with your colleagues, personally, before getting used to Sage's way of doing it.

Shall we take this to sage-devel?  I'm emailing Jason Grout about it since his perspective from mostly doing IPython stuff nowadays will be valuable, having also worked on this stuff in the past.


---

Comment by ncohen created at 2016-02-09 16:42:39

I'm sick of having people defending senseless ideas for the sake of people who are not here. Especially when we are all convinced that those people, if asked, would answer that the new standard is better. This is madness.

Nathann


---

Comment by kcrisman created at 2016-02-09 16:53:05

My point is that it is worth doing the forensic work to find out whether the *original default* (if such it was) had a _reason_!  Especially if it can be done by emailing a few people.  Rather than just up and deciding.  You can say all you want that people will not really care because they can easily switch, but tell that to someone doing a presentation who all at once is befuddled because the default has changed and they are sitting in front of 20 people who really want to know what that matrix represents and the speaker has no clue any more...

(Compare to how matplotlib is giving huge warning to their default change in colormap.  Not that this issue is anywhere near as important to Sage as that is to them, but it still is good practice, which we are very bad at following.)


---

Comment by ncohen created at 2016-02-09 17:01:40

> My point is that it is worth doing the forensic work to find out whether the *original default* (if such it was) had a _reason_! 

The fact that this information may not have ever appeared on a public forum is a sufficient reason to not require of a ticket's author to produce it: otherwise every non-explained design decision becomes impossible to fix.

I don't think you should be allowed to revert `positive_review` status because of such a request. If you find it, however, and if the reason you find there is compelling, then of course that would not be a problem as it reopens the discussion.

> Especially if it can be done by emailing a few people.  Rather than just up and deciding.

You are overlooking that this patch was reviewed by a Free Man. I'm not being overly 
authoritarian here.

> You can say all you want that people will not really care because they can easily switch, but tell that to someone doing a presentation who all at once is befuddled because the default has changed and they are sitting in front of 20 people who really want to know what that matrix represents and the speaker has no clue any more...

My hope is that they will stop wondering what the former output means, and that the new one will be more natural. It is declared to be 'more natural' by 100% of the people I asked in my lab (without telling them which was my choice).

> (Compare to how matplotlib is giving huge warning to their default change in colormap.  Not that this issue is anywhere near as important to Sage as that is to them, but it still is good practice, which we are very bad at following.)

What do you propose to give a warning? I don't see any way, but if you see an efficient way to warn people please explain it.

Nathann


---

Comment by kcrisman created at 2016-02-09 18:06:04

> 
> What do you propose to give a warning? I don't see any way, but if you see an efficient way to warn people please explain it.
> 


I don't mean a warning like a printed message, but rather documentation change, in our case.  But well-organized software lets people know about such changes in many forums well ahead of time - again, see the matplotlib page for a good example of that, though of course our change is much more minor with respect to our user base.


---

Comment by ncohen created at 2016-02-09 19:41:21

You are welcome to add a commit that does that as you see fit.


---

Comment by jmantysalo created at 2016-02-09 19:42:12

Replying to [comment:15 kcrisman]:

> I don't mean a warning like a printed message, but rather documentation change, in our case.

Well... There could be strings like "NOTE: default changed in version 7.1", but they should not be there when we are at version 9.3...

> But well-organized software lets people know about such changes in many forums well ahead of time 

A suggestion: add a keyword "user-visible-change" to trac. When making new version of Sage, make a list of those as a special part of README.


---

Comment by ncohen created at 2016-02-09 19:43:56

> A suggestion: add a keyword "user-visible-change" to trac. When making new version of Sage, make a list of those as a special part of README.

That's a good idea. Could you ask it on a sage-devel thread, and see if we should do something like that on a large scale? I'm sure that a lot of people will like the idea of such a list being generated from trac data.

Nathann


---

Comment by kcrisman created at 2016-02-09 20:24:06

Indeed; there haven't been proper release announcements in years, mainly because it's too hard to keep track for any person who is interested and has time.  Some way of auto-generating what we think is actually interesting to end users would be very helpful.


---

Comment by kcrisman created at 2016-02-11 15:33:15

Ok, here is a question.  What should we expect about these?

```
sage: matrix([[0,0,],[1,1]]).plot()
sage: matrix([[-1,-1],[1,1]]).plot()
sage: matrix([[-10,-10],[0,0]]).plot()
sage: matrix([[0,0],[0,0]]).plot()
sage: matrix([[-100,0],[100,0]]).plot()
```


As to modifying documentation, I think it would be good to be more specific about the default here (writing for the current)


```
    If the matrix is dense, each matrix element is given a different
    color value depending on its relative size compared to the other
    elements in the matrix. 
+   The default is for the lowest number to be black and the highest
+   number to be white in a greyscale pattern; see the information about
+   normalizing below.
```

One could add

```
+   To achieve the lowest number to be white and the highest black, use
+   `cmap='Greys'` (see below for syntax).
```

or whatever is appropriate.  Similarly, with the sparse matrices it would be super-helpful to say why the "unexpected" is done - compatibility with matplotlib/matlab.

I can document whatever we do once we agree on something, since it appears that no one on sage-devel cares about this, so hopefully we can find a consensus here.  But I am not really sure there is an "obvious" answer for the last matrix.  See also the `norm` and `vmin` and `vmax`, e.g.

```
sage: matrix([[-100,0],[100,0]]).plot(norm='value')
<three black squares, currently>
```


Or even compare

```
sage: matrix([[-10,0],[0,10]],sparse=True).plot()
sage: matrix([[-10,0],[0,10]],sparse=False).plot() # current default
sage: matrix([[-10,0],[0,10]],sparse=False).plot(cmap='Greys') # your suggestion
```

So I'm not really sure what to do about this, as the whole point of a scale is that it goes negative to positive.

```
sage: identity_matrix(10).plot() # agreed, not ideal
sage: (-1*identity_matrix(10)).plot() # ?!#$$!
```

There is a fundamental discord between wanting things to behave like the sparse where zero is white, and wanting to be able to do a whole range from negative to positive.

----

Also annoying but probably not worth doing on this ticket: `matrix_plot?` is helpful but `matrix().plot?` is not.


---

Comment by ncohen created at 2016-02-11 15:43:42

Karl-Dieter: from what I understood of your examples you seem to defend that the way the colors are picked, i.e. according to color scale, is not very smart when in presence of negative values.

I agree with you, there are many faults in this design. The best example I have of this is that both 'matrix.zero(10)' and 'matrix.ones(10)' are represented the same way, for in both case the maximum value is equal to the minimum one.

This ticket, however, does not plan to do anything about that. I merely want to change the color scale, for it is much more natural for positive matrices than the previous one.

As for the doc you proposed, it is fine by me.

Nathann


---

Comment by ncohen created at 2016-02-18 13:28:08

Karl-Dieter, you came on this ticket which was in `positive_review` and changed its status. Unless you have a change in mind and intend to add it quickly, or have any other question which would justify this situation to last longer, I would appreciate it if you could stop delaying this branch and set the ticket back to its original status.

Nathann


---

Comment by kcrisman created at 2016-02-18 13:53:40

Nathann, you have to recognize that some people's lives and jobs simply cannot revolve around Trac.  As you often point out, no one is paid to do this, so it is unreasonable to expect that everyone has the ability or time to respond quickly, for any definition of quickly.  There certainly is no malice in my delay.

You said in a previous comment that the type of doc proposed is fine by you.  There was no response on sage-devel, so by a 2-1 vote I am okay with changing to this color scheme.  I will update it.  But I cannot do it at anyone's beck and call, and I simply have had no time.   I haven't even had time to finish releasing a new sagenb package, which is now considered a blocker for the next Sage release.  Please have patience; it _will_ get done.


---

Comment by ncohen created at 2016-02-18 13:59:59

I can hear that you have other things to do.

Please hear that I work with matrices, that I created a ticket to fix a bug I meet, and that by making this work wait you create more work for me, because I have to keep reapplying this branch over and over, while I juggle between what I need to work and other tickets I review.

So this 'waiting to get this merged', which you may think has a zero cost, actually has a cost for me.

I will bear that cost a bit longer as you ask me to. On the other hand, if you don't think you will have time soon, you can also let this ticket pass: I will be quite happy to (quickly) review a doc addition in another ticket when you will find the time you need.

Nathann


---

Comment by jmantysalo created at 2016-04-21 05:14:48

Just pinging this one... I would be happy to mark this as _positive_review_. Karl-Dieter, what you think?


---

Comment by kcrisman created at 2016-04-21 12:15:35

If you can just update that documentation as outlined in comment:20, yes it would be fine.  Since ncohen was pretty dismissive of the fact that I only have time for brief comments like this nowadays (without even asking me offline why), I was not particularly motivated to do so myself.  Given that depending on context both types of examples are likely and that people using this may be less likely to go through all the arcana needed to figure out how to get the result they want, I think it's pretty necessary to update doc for that reason.


---

Comment by git created at 2016-04-22 07:24:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-04-22 07:27:02

Replying to [comment:26 kcrisman]:
> If you can just update that documentation as outlined in comment:20, yes it would be fine.

Done. Mostly I just copy what you have written.


---

Comment by jmantysalo created at 2016-04-22 07:27:02

Changing priority from major to minor.


---

Comment by jmantysalo created at 2016-04-22 07:27:02

Changing status from needs_info to needs_review.


---

Comment by kcrisman created at 2016-04-22 14:34:52

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2016-04-22 14:34:52

Assuming this passes doctests and such, we can do this.  I still think it is unnecessary, but 2-1 wins ;-)


---

Comment by jmantysalo created at 2016-04-23 05:19:34

Replying to [comment:29 kcrisman]:
> Assuming this passes doctests and such, we can do this.  I still think it is unnecessary, but 2-1 wins ;-)

Thanks. Good attitude!


---

Comment by vbraun created at 2016-04-23 08:45:44

Resolution: fixed
