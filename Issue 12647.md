# Issue 12647: Fix crossreferences in latex equations

Issue created by migration from Trac.

Original creator: ppurka

Original creation time: 2012-04-09 09:34:53

Assignee: jason

CC:  kcrisman

Keywords: latex cross-reference

This is a tiny patch to fix [cross references in %latex blocks](https://groups.google.com/forum/?hl=en#!topic/sage-support/jA3Q1WxzPEw). Suggested by jason on that thread.


---

Attachment

apply to devel/sage


---

Comment by ppurka created at 2012-04-09 09:37:25

Changing status from new to needs_review.


---

Comment by novoselt created at 2012-04-09 17:47:04

What about performance hit? All latex cells and latex output that was not handled by jsmath will get twice as slow, which kind of concerns me.

On the other hand, as far as I understand we only gain labels/references support within a single cell, not within a whole worksheet. It seems to me that it is not a very often needed functionality, i.e. you need it only for relatively large block of latex without computational cells in it. Can it be made optional? I.e. if someone needs it, then latex is called twice but only after calling some function, say `latex_calls(2)`.


---

Comment by ppurka created at 2012-04-09 22:46:31

Will the performance hit be significant? I wonder if anyone will be writing big blocks of latex text in a cell. Even for a single journal-like page (or maybe two such pages), the latex compilation process is plenty fast.

You are right about the fact that the labels will be effective only within the cell. Is it better to be correct than (just a bit more) efficient in this case? After all, if I am writing small pieces of latex on the notebook, I would want it to "just work."


---

Comment by novoselt created at 2012-04-09 23:01:50

The performance hit is one system call (which seems to be about 0.1sec using cache depending on the system) plus the actual running time of LaTeX. This may seem small, but I think it can be an issue in two situations: a heavily used server for many users and a worksheet with a lot of latex pieces, e.g. all outputs of cells can be run through the actual LaTeX if they are using something not supported by jsmath.

I don't have any numbers to support my concerns and I am not quite sure how to get them, but it seems to me that latex should not be run the second time unless necessary, because usually it is not necessary. And sometimes two times are not sufficient.

A better solution would be to keep the crossreference data from the previous run, so that second evaluation of the cell would make the references work. Perhaps we can even show the warning from LaTeX about possibly wrong references (and any other warnings for that matter). This will make it work closer to the actual LaTeX and I expect those who use label to know that the second run is necessary and not be surprised by question marks.

Even better would be to support sectioning and labels and hyperlinks across the whole worksheet, which I think would be much more useful then references within a single sell, but I have no idea how difficult it is to make it work this way. I imagine - not easy.

I am not volunteering to implement either of these approach and perhaps the posted patch is just fine, I just want the reviewer who sets it to positive review think about this issues.


---

Comment by ppurka created at 2012-04-09 23:16:07

Maybe it is best to maintain the status quo, and not make any changes after all.

If we try to parse the latex log file and try to find out if a second or third run is needed then this parsing itself will take some time (disc access, search within file almost till the end for phrase like "rerun to get crossreferenc.", etc). This will defeat the purpose of saving server load by reducing unnecessary latex runs.


---

Comment by novoselt created at 2012-04-09 23:40:02

Well, if evaluating the same %latex cell the second time would actually run LaTeX the second time, it should not cost any time in execution and would allow using references.


---

Comment by jdemeyer created at 2012-07-27 20:40:15

Please fill in your real name as Author.


---

Comment by rws created at 2014-02-12 19:56:52

Agree with `@`novoselt: in the case this is needed the user should give the second command herself. So wontfix?


---

Comment by ppurka created at 2014-02-13 13:26:50

I don't care.

It is choice between compiling more than once (easy fix) and changing the latex build system (big change).

Feel free to close the ticket.


---

Comment by rws created at 2014-02-13 14:25:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-19 18:58:36

Resolution: wontfix
