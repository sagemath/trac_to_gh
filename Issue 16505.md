# Issue 16505: overload for faster weak_popov_form

Issue created by migration from https://trac.sagemath.org/ticket/16742

Original creator: ketzu

Original creation time: 2014-07-30 13:00:06

CC:  jsrn dlucas cpernet




---

Comment by ketzu created at 2014-08-19 11:29:42

Changing component from PLEASE CHANGE to performance.


---

Comment by ketzu created at 2014-08-19 11:29:42

Changing keywords from "" to "matrix weak-popov-form".


---

Comment by ketzu created at 2014-08-19 11:29:42

Changing priority from major to minor.


---

Comment by ketzu created at 2014-08-19 11:30:20

Changing keywords from "matrix weak-popov-form" to "matrix weak-popov-form #16739".


---

Comment by ketzu created at 2014-08-19 12:01:16

Changing type from PLEASE CHANGE to enhancement.


---

Comment by jsrn created at 2014-08-20 09:01:13

Note to passers-by: ketzu is in the process of writing a patch for this.


---

Comment by ketzu created at 2014-08-21 15:57:59

Doctests / Examples are still missing

----
New commits:



---

Comment by git created at 2014-08-25 13:41:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-25 13:43:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-25 13:54:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-26 11:22:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-05-06 13:15:10

Hello,

I'm working on the review for tickets related to the weal Popov form problem. Even if this one was not on `needs_review` state, I considered that it was quite old, and did not change for a while, so I took the liberty to review it.

## General comments

g1) Several conflicts arise if merge with latest Sage beta. They need to be fixed.

g2) There are some trailing whitespaces in the files you modified. It will be nice to remove them.

g3) There are errors while building the documentation. To check if the documentation builds as it should, and check if the html output looks good or not, you can use `sage --docbuild reference/myFolder html`, replacing my folder by the part of Sage you were working on. Here, it will be `reference/matrices`.

## Documentation-related comments

d1) While writing documentation, you can use double backticks to have a nice formatting for variables. If you use simple backticks, it will format it as LaTeX test, which will just be italic if used on simple text. It is advised in [Sage documentation](http://www.sagemath.org/doc/developer/coding_basics.html#documentation-strings) to use double backticks around variables in the output block. Besides, it looks better for variables, or Python-related keyworkds (like `True`, or `None`) to use this syntax.

d2) The title of the file `weak_popov.pyx` is splitted on the html documentation. Write the title in one line, or use an underscore to avoid this.

d3) After the merge with latest beta, especially with the content of #16888, doctests of `weak_popov.pyx` are broken as `weak_popov_form` method throws a deprecation warning.

d4) I think it's better to call directly the method you're doctesting. In `mulders_storjohann`'s doctests, call `mulders_storjohann` instead of `weak_popov`.

d5) On line 152 (examples for `mulders_storjohann`) in `weak_popov`, you say "Generally matrices in weak popov form will just be returned". I think they will always be returned. In that case, can you remove "generally"? If I'm wrong, can you add an example in which we input a matrix in wPf which is not returned as is?

d6) You can get a nice formatting on the `ALGORITHM` block (`weak_popov.py:102`) if you use only one colon instead of two after the `ALGORITHM` keyword.

d7) On both helper methods you wrote in `weak_popov.pyx`, you have this block:

```
  .. note::
    
        This method is used in the mulders-storjohann algorithm.
```


I think it will be more explicit for the user to say something like "This is a helper function for Mulders-Storjohann algorithm and should only be used internally".

d8) At the beginning of each function, you write something like "Function to do something". You can go straight to the point, and write directly "Returns this" or "Computes that".

d9) In `simmple_transformation`'s doc, input parameter `U` is not documented.

## Code and design related comments

c1) `mulders-storjohann` method takes a matrix `M` as an input, then modifies it in place, and outputs the modified matrix. I think it's not an intuitive behaviour. It should either modify the input in place, and output nothing or copy the input and output the modified copy.

c2) With the merge of #16888, old `weak_popov_form` method will be deprecated and renamed `row_reduced_form`. Which means that, without any changes, one will need to call `M.row_reduced_form(implementation="cython")` to get the weak Popov form of `M`... Which is not intuitive at all. What I suggest here is to reinstate the method `weak_popov_form` (as it will compute the wPf, we can de-deprecate it) which will do the transformations to get the wPf of the input using `mulders-storjohann` method. By doing that, we keep the `row_reduced_form` method for users who absolutely want the row reduced form of their matrices, and have a real weak Popov form computation with methods explicitely named.

c3) As #16896 changes the calling conventions of `row_reduced_from`, I think one the two tickets should depend on the other one to be sure we get what we want in the end, namely a wPf method and a rrf method with simplfied calling conventions.


---

Comment by dlucas created at 2015-05-06 13:15:10

Changing status from new to needs_review.


---

Comment by dlucas created at 2015-05-06 13:15:23

Changing status from needs_review to needs_work.


---

Comment by cpernet created at 2016-08-22 14:38:39

Changing keywords from "matrix weak-popov-form #16739" to "matrix weak-popov-form #16739 sd75".


---

Comment by klee created at 2016-12-15 15:23:39

In #21024, I reimplemented this "reimplementation of weak popov form" in the `_weak_popov_form` in a newly added `matrix_polynomial_dense.pyx` file. I did timing comparisons between my implementation of MS algorithm with the implementation in this ticket.  The result is that the implementation in `_weak_popov_form` is much faster than the latter. So if #21024 is merged, then this ticket can be safely discarded.


---

Comment by jsrn created at 2017-02-07 16:14:50

Changing status from needs_work to positive_review.


---

Comment by jsrn created at 2017-02-07 16:14:50

Closing as wontfix cf #21024.


---

Comment by embray created at 2017-07-13 07:54:31

Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).


---

Comment by embray created at 2017-07-13 07:54:31

Resolution: wontfix
