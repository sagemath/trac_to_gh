# Issue 27566: Fix polymake 3.4's lrslib detection

Issue created by migration from https://trac.sagemath.org/ticket/27803

Original creator: mkoeppe

Original creation time: 2019-05-09 09:43:03

CC:  dimpase paffenholz@mathematik.tu-darmstadt.de lorenz@math.tu-berlin.de vbraun

polymake 3.4 has an updated lrslib detection code that fails to recognize the installed lrslib from Sage on macOS.



---

Comment by mkoeppe created at 2019-05-09 09:49:36

Dima - of course, adding `--with-lrs="$SAGE_LOCAL"` to polymake's configure conflicts with your efforts with `spkg-configure.m4`.
What should I do?
----
Last 10 new commits:


---

Comment by dimpase created at 2019-05-09 10:01:03

Replying to [comment:2 mkoeppe]:
> Dima - of course, adding `--with-lrs="$SAGE_LOCAL"` to polymake's configure conflicts with your efforts with `spkg-configure.m4`.
> What should I do?

No worries, `lrs` has not been spkg-configurified yet, see #27330 (your help in reviewing there is most welcome, by the way, e.g. all these readline and curses packages...). We should do `lrs` too, I just opened #27804 for this. So we will need to change that hardcoded value of its prefix to whatever configure finds. Already did this for GMP etc, so no big problem
I gather.


---

Comment by dimpase created at 2019-05-09 11:25:24

ready for review?


---

Comment by mkoeppe created at 2019-05-09 12:00:55

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2019-05-09 13:20:25

The relevant output (without this patch) from polymake's configure in `build/bundled.log`:

```
---- lrs ----

Could not compile a test program checking for lrs library.
The most probable reasons are that the library is installed at a non-standard location,
is not configured to build a shared module, or missing at all.
The complete error log follows:

ld: library not found for -llrs
clang: error: linker command failed with exit code 1 (use -v to see invocation)

Please install the library and specify its location using --with-lrs option, if needed.
Please remember to enable shared modules when configuring the lrs library!
```

As Benjamin pointed out, the error message does not match the one expected by `bundled/lrs/support/configure.pl` script, which tries to be too helpful.


---

Comment by dimpase created at 2019-05-10 10:55:01

tests fine.


---

Comment by dimpase created at 2019-05-10 10:55:01

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2019-06-08 06:45:52

Resolution: fixed


---

Comment by mkoeppe created at 2019-06-08 06:45:52

This branch has been merged already as part of #22704.
