# Issue 15309: Maxima build hangs on invoking emacs

Issue created by migration from https://trac.sagemath.org/ticket/15546

Original creator: mraum

Original creation time: 2013-12-19 11:14:50

CC:  mraum

Keywords: maxima, build

line 2384 of the maxima configuration calls emacs to eval load-path.  On my system (Fedora 19, few additional emacs packages, including ecb and flycheck) emacs hangs.

Maxima's configuration:

```
  { (echo "$as_me:$LINENO: \$EMACS -batch -q -eval '(while load-path (princ (concat (car load-path) \"\\n\")) (setq load-path (cdr load-path)))' </dev/null >conftest.out") >&5
```


Emacs command in command line. This does not terminate.

```
[martin] emacs -batch -q -eval '(while load-path (princ (concat (car load-path) "\n")) (setq load-path (cdr load-path)))'
Loading /usr/share/emacs/site-lisp/site-start.d/auctex.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/auto-complete-init.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/desktop-entry-mode-init.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/emacs-goodies-loaddefs.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/gnus-bonus-init.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/haskell-mode-init.el (source)...
Loading haskell-site-file...
Loading /usr/share/emacs/site-lisp/site-start.d/preview-latex.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/pymacs-init.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/rpmdev-init.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/systemtap-init.el (source)...
Loading /usr/share/emacs/site-lisp/site-start.d/vala-init.el (source)...
Invalid comphist db.
/usr/share/emacs/site-lisp/haskell-mode/
/usr/share/emacs/site-lisp/gnus-bonus/
/usr/share/emacs/site-lisp/auctex
/usr/share/emacs/24.3/site-lisp
/usr/share/emacs/site-lisp
/usr/share/emacs/site-lisp/auto-complete
/usr/share/emacs/site-lisp/desktop-file-utils
/usr/share/emacs/site-lisp/gnus-bonus
/usr/share/emacs/site-lisp/goodies
/usr/share/emacs/site-lisp/haskell-mode
/usr/share/emacs/site-lisp/site-start.d
/usr/share/emacs/site-lisp/vala
/usr/share/emacs/site-lisp/auto-complete/ac-dict
/usr/share/emacs/24.3/lisp
/usr/share/emacs/24.3/lisp/vc
/usr/share/emacs/24.3/lisp/url
/usr/share/emacs/24.3/lisp/textmodes
/usr/share/emacs/24.3/lisp/progmodes
/usr/share/emacs/24.3/lisp/play
/usr/share/emacs/24.3/lisp/org
/usr/share/emacs/24.3/lisp/nxml
/usr/share/emacs/24.3/lisp/net
/usr/share/emacs/24.3/lisp/mh-e
/usr/share/emacs/24.3/lisp/mail
/usr/share/emacs/24.3/lisp/language
/usr/share/emacs/24.3/lisp/international
/usr/share/emacs/24.3/lisp/gnus
/usr/share/emacs/24.3/lisp/eshell
/usr/share/emacs/24.3/lisp/erc
/usr/share/emacs/24.3/lisp/emulation
/usr/share/emacs/24.3/lisp/emacs-lisp
/usr/share/emacs/24.3/lisp/cedet
/usr/share/emacs/24.3/lisp/calendar
/usr/share/emacs/24.3/lisp/calc
/usr/share/emacs/24.3/lisp/obsolete
/usr/share/emacs/24.3/leim
Cannot open load file: pp
```


Log file (maxima hangs while 

```
Found local metadata for maxima-5.29.1.p4
Attempting to download package maxima-5.29.1.p4
>>> Trying to download http://www.sagemath.org/packages/upstream//maxima/maxima-5.29.1.tar.bz2
[............................................................]
Checksum: 40b01a718ddba1c8364d76a1e5d35d8f vs 40b01a718ddba1c8364d76a1e5d35d8f
maxima-5.29.1.p4
====================================================
Setting up build directory for maxima-5.29.1.p4
Finished set up
****************************************************
Host system:
Linux montauk 3.11.10-200.fc19.x86_64 #1 SMP Mon Dec 2 20:28:03 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.2/lto-wrapper
Target: x86_64-redhat-linux
Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-multifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-isl=/builddir/build/BUILD/gcc-4.8.2-20131017/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.2-20131017/obj-x86_64-redhat-linux/cloog-install --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux
Thread model: posix
gcc version 4.8.2 20131017 (Red Hat 4.8.2-1) (GCC) 
****************************************************
Applying patches (if any)...
patching file src/hayat.lisp
patching file tests/rtest_taylor.mac
patching file src/init-cl.lisp
patching file share/contrib/integration/abs_integrate.mac
patching file share/contrib/integration/rtest_abs_integrate.mac
patching file src/maxima.system
patching file src/grind.lisp

Now configuring Maxima...
```



---

Comment by pbruin created at 2013-12-19 13:17:37

The Emacs option `-q` disables loading the `.emacs` file, but it still loads the system-wide startup file (probably in `/usr/share/emacs/site-lisp`).  The option `-Q` also avoids loading this file and other things.  What happens if you replace `-q` by `-Q`?


---

Comment by vbraun created at 2013-12-23 22:42:18

Emil Widmann reports that `EMACS=no` works.


---

Comment by vbraun created at 2013-12-23 22:46:23

Somebody who ran into this, please test!
----
New commits:


---

Comment by vbraun created at 2013-12-23 22:46:23

Changing status from new to needs_review.


---

Comment by mraum created at 2014-01-08 07:44:47

Changing status from needs_review to positive_review.


---

Comment by mraum created at 2014-01-08 07:44:47

This solves the problem for me. Since emacs is not involved anymore in the build process, it should solve it for everyone.


---

Comment by vbraun created at 2014-01-20 23:51:38

Resolution: fixed
