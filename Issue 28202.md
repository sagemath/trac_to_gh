# Issue 28202: Fix output formatting in interact mode of interfaces

Issue created by migration from https://trac.sagemath.org/ticket/28439

Original creator: @mwageringel

Original creation time: 2019-09-01 11:42:23

Keywords: macaulay2, gap

The function `Interface.interact()` gives interactive access to the interpreter session of a pexpect interface that is running in the background. This ticket fixes the following issues with the output:

- whitespace is incorrectly stripped from the front of the output string
- special characters are not properly escaped

The whitespace issues are particular frequent with interfaces that use ASCII art for printing like Mathematica and Macaulay2:


```
sage: macaulay2.interact()

  --> Switching to Macaulay2 <--

macaulay2: M = ZZ^2
2
ZZ

ZZ-module, free
```


An artificial example using a standard interface which shows whitespace and escaping issue:


```
sage: gap.interact()

  --> Switching to Gap <--

gap: Print("  \\\\")
\
```


With the usual `gap.eval()` the escaping is done correctly, but in the case of Gap, whitespace is still stripped from the front.


```
sage: gap.eval(r'Print("  \\\\")')
\\
```


I changed the Gap interface to preserve whitespace at the front in order to be able to add a doctest for `interact` using a standard interface.


---

Comment by @mwageringel created at 2019-09-01 11:51:18

New commits:


---

Comment by @mwageringel created at 2019-09-01 11:51:18

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2019-09-01 11:54:53

I suggest testing this in the terminal, as in the Jupyter notebook there does not seem to be a way to exit the subshells.

The remaining pyflakes warning is a false positive.


---

Comment by @mwageringel created at 2019-09-01 14:52:55

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-09-01 15:59:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mwageringel created at 2019-09-01 16:12:46

Changing status from needs_work to needs_review.


---

Comment by @mwageringel created at 2019-09-01 16:12:46

I have fixed another problem, see the description.


---

Comment by git created at 2019-09-01 18:54:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mwageringel created at 2019-09-01 19:00:04

Rebased to fix an incorrect trac link in the first commit spotted by the patchbot.


---

Comment by tscrim created at 2019-09-03 00:42:18

All of these changes make sense and look good.


---

Comment by tscrim created at 2019-09-03 00:42:18

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2019-09-03 06:43:39

Thanks.


---

Comment by slelievre created at 2019-09-04 14:46:09

I kept noticing incorrect stripping of initial whitespace without ever
doing anything about it.

Finally initial whitespace will be preserved. Wholehearted thanks for that!


---

Comment by vbraun created at 2019-09-05 21:32:56

Resolution: fixed
