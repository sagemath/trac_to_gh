# Issue 28202: Fix output formatting in interact mode of interfaces

archive/issues_028202.json:
```json
{
    "body": "Keywords: macaulay2, gap\n\nThe function `Interface.interact()` gives interactive access to the interpreter session of a pexpect interface that is running in the background. This ticket fixes the following issues with the output:\n\n- whitespace is incorrectly stripped from the front of the output string\n- special characters are not properly escaped\n\nThe whitespace issues are particular frequent with interfaces that use ASCII art for printing like Mathematica and Macaulay2:\n\n\n```\nsage: macaulay2.interact()\n\n  --> Switching to Macaulay2 <--\n\nmacaulay2: M = ZZ^2\n2\nZZ\n\nZZ-module, free\n```\n\n\nAn artificial example using a standard interface which shows whitespace and escaping issue:\n\n\n```\nsage: gap.interact()\n\n  --> Switching to Gap <--\n\ngap: Print(\"  \\\\\\\\\")\n\\\n```\n\n\nWith the usual `gap.eval()` the escaping is done correctly, but in the case of Gap, whitespace is still stripped from the front.\n\n\n```\nsage: gap.eval(r'Print(\"  \\\\\\\\\")')\n\\\\\n```\n\n\nI changed the Gap interface to preserve whitespace at the front in order to be able to add a doctest for `interact` using a standard interface.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28439\n\n",
    "created_at": "2019-09-01T11:42:23Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Fix output formatting in interact mode of interfaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28202",
    "user": "https://github.com/mwageringel"
}
```
Keywords: macaulay2, gap

The function `Interface.interact()` gives interactive access to the interpreter session of a pexpect interface that is running in the background. This ticket fixes the following issues with the output:

- whitespace is incorrectly stripped from the front of the output string
- special characters are not properly escaped

The whitespace issues are particular frequent with interfaces that use ASCII art for printing like Mathematica and Macaulay2:


```
sage: macaulay2.interact()

  --> Switching to Macaulay2 <--

macaulay2: M = ZZ^2
2
ZZ

ZZ-module, free
```


An artificial example using a standard interface which shows whitespace and escaping issue:


```
sage: gap.interact()

  --> Switching to Gap <--

gap: Print("  \\\\")
\
```


With the usual `gap.eval()` the escaping is done correctly, but in the case of Gap, whitespace is still stripped from the front.


```
sage: gap.eval(r'Print("  \\\\")')
\\
```


I changed the Gap interface to preserve whitespace at the front in order to be able to add a doctest for `interact` using a standard interface.

Issue created by migration from https://trac.sagemath.org/ticket/28439





---

archive/issue_comments_397801.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-09-01T11:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397801",
    "user": "https://github.com/mwageringel"
}
```

New commits:



---

archive/issue_comments_397802.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-01T11:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397802",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_397803.json:
```json
{
    "body": "I suggest testing this in the terminal, as in the Jupyter notebook there does not seem to be a way to exit the subshells.\n\nThe remaining pyflakes warning is a false positive.",
    "created_at": "2019-09-01T11:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397803",
    "user": "https://github.com/mwageringel"
}
```

I suggest testing this in the terminal, as in the Jupyter notebook there does not seem to be a way to exit the subshells.

The remaining pyflakes warning is a false positive.



---

archive/issue_comments_397804.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-09-01T14:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397804",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_397805.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-01T15:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397806.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-09-01T16:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397806",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_397807.json:
```json
{
    "body": "I have fixed another problem, see the description.",
    "created_at": "2019-09-01T16:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397807",
    "user": "https://github.com/mwageringel"
}
```

I have fixed another problem, see the description.



---

archive/issue_comments_397808.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-01T18:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397808",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_397809.json:
```json
{
    "body": "Rebased to fix an incorrect trac link in the first commit spotted by the patchbot.",
    "created_at": "2019-09-01T19:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397809",
    "user": "https://github.com/mwageringel"
}
```

Rebased to fix an incorrect trac link in the first commit spotted by the patchbot.



---

archive/issue_comments_397810.json:
```json
{
    "body": "All of these changes make sense and look good.",
    "created_at": "2019-09-03T00:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397810",
    "user": "https://github.com/tscrim"
}
```

All of these changes make sense and look good.



---

archive/issue_comments_397811.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-03T00:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397811",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_397812.json:
```json
{
    "body": "Thanks.",
    "created_at": "2019-09-03T06:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397812",
    "user": "https://github.com/mwageringel"
}
```

Thanks.



---

archive/issue_comments_397813.json:
```json
{
    "body": "I kept noticing incorrect stripping of initial whitespace without ever\ndoing anything about it.\n\nFinally initial whitespace will be preserved. Wholehearted thanks for that!",
    "created_at": "2019-09-04T14:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397813",
    "user": "https://github.com/slel"
}
```

I kept noticing incorrect stripping of initial whitespace without ever
doing anything about it.

Finally initial whitespace will be preserved. Wholehearted thanks for that!



---

archive/issue_comments_397814.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-09-05T21:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28202#issuecomment-397814",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026126.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-09-05T21:32:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28202",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28202#event-26126"
}
```
