# Issue 15343: prereq tarball is missing

archive/issues_015343.json:
```json
{
    "body": "CC:  @ohanar @vbraun\n\nAfter downloading Sage 6.0 either from git or from the `.tar.gz` sdist tarball, the prereq tarball `prereq-1.2.tar.gz` is missing. This is a huge problem, because many checks are skipped because of this.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15580\n\n",
    "created_at": "2013-12-24T09:40:37Z",
    "labels": [
        "component: distribution",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "prereq tarball is missing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15343",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @ohanar @vbraun

After downloading Sage 6.0 either from git or from the `.tar.gz` sdist tarball, the prereq tarball `prereq-1.2.tar.gz` is missing. This is a huge problem, because many checks are skipped because of this.

Issue created by migration from https://trac.sagemath.org/ticket/15580





---

archive/issue_comments_197329.json:
```json
{
    "body": "Actually `prereq-1.2.tar.gz` should work if you drop it into the `upstream` directory, but since it was different, it didn't receive any of the extra treatment the other packages got.",
    "created_at": "2013-12-24T11:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197329",
    "user": "https://github.com/ohanar"
}
```

Actually `prereq-1.2.tar.gz` should work if you drop it into the `upstream` directory, but since it was different, it didn't receive any of the extra treatment the other packages got.



---

archive/issue_comments_197330.json:
```json
{
    "body": "Replying to [comment:2 ohanar]:\n> Actually `prereq-1.2.tar.gz` should work if you drop it into the `upstream` directory\nOK, I see that. But it's not distributed by default.",
    "created_at": "2013-12-24T11:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197330",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:2 ohanar]:
> Actually `prereq-1.2.tar.gz` should work if you drop it into the `upstream` directory
OK, I see that. But it's not distributed by default.



---

archive/issue_comments_197331.json:
```json
{
    "body": "If somebody can merge the prereq tarball contents in the git repo, I can easily do the rest.",
    "created_at": "2013-12-27T12:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197331",
    "user": "https://github.com/jdemeyer"
}
```

If somebody can merge the prereq tarball contents in the git repo, I can easily do the rest.



---

archive/issue_comments_197332.json:
```json
{
    "body": "I've exported `prereq-1.2`'s history to the root directory with no cleanup (e.g. there is still the hgignore).\n----\nNew commits:",
    "created_at": "2013-12-28T09:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197332",
    "user": "https://github.com/ohanar"
}
```

I've exported `prereq-1.2`'s history to the root directory with no cleanup (e.g. there is still the hgignore).
----
New commits:



---

archive/issue_comments_197333.json:
```json
{
    "body": "I have a patch ready, but I need to rebuild Sage before it can be uploaded...",
    "created_at": "2013-12-28T17:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197333",
    "user": "https://github.com/jdemeyer"
}
```

I have a patch ready, but I need to rebuild Sage before it can be uploaded...



---

archive/issue_comments_197334.json:
```json
{
    "body": "Not yet ready for review, requires more work.",
    "created_at": "2013-12-28T21:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197334",
    "user": "https://github.com/jdemeyer"
}
```

Not yet ready for review, requires more work.



---

archive/issue_comments_197335.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-28T23:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197335",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_197336.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-29T00:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197337.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-29T10:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197337",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197338.json:
```json
{
    "body": "Looks fine to me, so long as someone can review my reviewer commit. (It is just restoring a small regression of `sage-sdist`.)\n----\nNew commits:",
    "created_at": "2013-12-30T05:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197338",
    "user": "https://github.com/ohanar"
}
```

Looks fine to me, so long as someone can review my reviewer commit. (It is just restoring a small regression of `sage-sdist`.)
----
New commits:



---

archive/issue_comments_197339.json:
```json
{
    "body": "One comment I have is that having a toplevel configure script might confuse those not familiar with sage's odd build system. Maybe we should move it to be under the build directory?",
    "created_at": "2013-12-30T05:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197339",
    "user": "https://github.com/ohanar"
}
```

One comment I have is that having a toplevel configure script might confuse those not familiar with sage's odd build system. Maybe we should move it to be under the build directory?



---

archive/issue_comments_197340.json:
```json
{
    "body": "Replying to [comment:15 ohanar]:\n> One comment I have is that having a toplevel configure script might confuse those not familiar with sage's odd build system. Maybe we should move it to be under the build directory?\n\nMy hope is to converge to a more standard build system, so having `./configure` at the top-level makes the most sense. And even if it confuses people, doing `./configure && make` like the usual packages still works.",
    "created_at": "2013-12-30T10:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197340",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:15 ohanar]:
> One comment I have is that having a toplevel configure script might confuse those not familiar with sage's odd build system. Maybe we should move it to be under the build directory?

My hope is to converge to a more standard build system, so having `./configure` at the top-level makes the most sense. And even if it confuses people, doing `./configure && make` like the usual packages still works.



---

archive/issue_comments_197341.json:
```json
{
    "body": "Replying to [comment:14 ohanar]:\n> Looks fine to me, so long as someone can review my reviewer commit. (It is just restoring a small regression of `sage-sdist`.)\nI don't think there is a regression to be fixed there. It's true that `python setup.py` is run indeed because of my patch, but why is that a problem? I never liked the `[ -z \"$$SAGE_INSTALL_FETCH_ONLY\" ]` in `build/deps` and I want to remove that. The only reason I didn't do that on this ticket is to avoid potential merge conflicts. And reusing the `$(INST)/sage` build rule to copy the sources makes both `build/deps` and `sage-sdist` harder to understand for no good reason.\n\nSo my proposal is still to merge my patch as-is, but of course I'm listening to suggestions...",
    "created_at": "2013-12-30T10:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197341",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 ohanar]:
> Looks fine to me, so long as someone can review my reviewer commit. (It is just restoring a small regression of `sage-sdist`.)
I don't think there is a regression to be fixed there. It's true that `python setup.py` is run indeed because of my patch, but why is that a problem? I never liked the `[ -z "$$SAGE_INSTALL_FETCH_ONLY" ]` in `build/deps` and I want to remove that. The only reason I didn't do that on this ticket is to avoid potential merge conflicts. And reusing the `$(INST)/sage` build rule to copy the sources makes both `build/deps` and `sage-sdist` harder to understand for no good reason.

So my proposal is still to merge my patch as-is, but of course I'm listening to suggestions...



---

archive/issue_comments_197342.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> I don't think there is a regression to be fixed there. It's true that `python setup.py` is run indeed because of my patch, but why is that a problem?\nIt requires that all of the sage libraries dependencies to already be built (otherwise it will bail). Before this branch, you could clone a sage repository, and without running `make`, you could run (without error) `sage -sdist`.\n\nThis was not true back in mercurial land, but then again, `sage-sdist` had to be a lot more complicated since there were a number of repositories to manage.\n\nI think that the best solution to these issues are to include the package type (and dependencies) in the metadata of each individual package. Right now you have to do this psuedo-build to pull just the standard packages (since the only thing that records them as standard is that they are a dependency of sage in `build/deps`).\n\nI would propose my additional commit for now (or some alternative to restore `sage -sdist` for freshly cloned repos), and open a new ticket to introduce the extra metadata.",
    "created_at": "2013-12-30T11:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197342",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:17 jdemeyer]:
> I don't think there is a regression to be fixed there. It's true that `python setup.py` is run indeed because of my patch, but why is that a problem?
It requires that all of the sage libraries dependencies to already be built (otherwise it will bail). Before this branch, you could clone a sage repository, and without running `make`, you could run (without error) `sage -sdist`.

This was not true back in mercurial land, but then again, `sage-sdist` had to be a lot more complicated since there were a number of repositories to manage.

I think that the best solution to these issues are to include the package type (and dependencies) in the metadata of each individual package. Right now you have to do this psuedo-build to pull just the standard packages (since the only thing that records them as standard is that they are a dependency of sage in `build/deps`).

I would propose my additional commit for now (or some alternative to restore `sage -sdist` for freshly cloned repos), and open a new ticket to introduce the extra metadata.



---

archive/issue_comments_197343.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> My hope is to converge to a more standard build system, so having `./configure` at the top-level makes the most sense. And even if it confuses people, doing `./configure && make` like the usual packages still works.\n\nOk, sounds good.",
    "created_at": "2013-12-30T11:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197343",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:16 jdemeyer]:
> My hope is to converge to a more standard build system, so having `./configure` at the top-level makes the most sense. And even if it confuses people, doing `./configure && make` like the usual packages still works.

Ok, sounds good.



---

archive/issue_comments_197344.json:
```json
{
    "body": "Replying to [comment:18 ohanar]:\n> and open a new ticket to introduce the extra metadata.\nOn the other hand, I don't like the idea of storing the same information (which packages are \"standard\") twice.",
    "created_at": "2013-12-30T11:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197344",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 ohanar]:
> and open a new ticket to introduce the extra metadata.
On the other hand, I don't like the idea of storing the same information (which packages are "standard") twice.



---

archive/issue_comments_197345.json:
```json
{
    "body": "Replying to [comment:18 ohanar]:\n> Replying to [comment:17 jdemeyer]:\n> > I don't think there is a regression to be fixed there. It's true that `python setup.py` is run indeed because of my patch, but why is that a problem?\n> It requires that all of the sage libraries dependencies to already be built (otherwise it will bail). Before this branch, you could clone a sage repository, and without running `make`, you could run (without error) `sage -sdist`.\nOK, I get it. I'm not convinced that the extra complication is justified for this use-case, but I'll fix it (but hopefully in a simpler way than your patch).",
    "created_at": "2013-12-30T11:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197345",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 ohanar]:
> Replying to [comment:17 jdemeyer]:
> > I don't think there is a regression to be fixed there. It's true that `python setup.py` is run indeed because of my patch, but why is that a problem?
> It requires that all of the sage libraries dependencies to already be built (otherwise it will bail). Before this branch, you could clone a sage repository, and without running `make`, you could run (without error) `sage -sdist`.
OK, I get it. I'm not convinced that the extra complication is justified for this use-case, but I'll fix it (but hopefully in a simpler way than your patch).



---

archive/issue_comments_197346.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-12-30T11:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197346",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_197347.json:
```json
{
    "body": "I think this is sufficient\n\n```diff\ncommit 0255a2a53e9aebaf54c0fab335ef0202a6b77ae8\nAuthor: Jeroen Demeyer <jdemeyer@cage.ugent.be>\nDate:   Mon Dec 30 12:47:06 2013 +0100\n\n    Allow sage --sdist without building Sage\n\ndiff --git a/src/bin/sage-clone-source b/src/bin/sage-clone-source\nindex aabc452..090466b 100755\n--- a/src/bin/sage-clone-source\n+++ b/src/bin/sage-clone-source\n@@ -20,7 +20,7 @@ SRC=\"$1\"\n DST=\"$2\"\n \n rm -rf \"$DST\"\n-mkdir \"$DST\"\n+mkdir -p \"$DST\"\n \n git clone \"$SRC\" \"$DST\"\n \ndiff --git a/src/bin/sage-sdist b/src/bin/sage-sdist\nindex 3a554b6..1aee0cc 100755\n--- a/src/bin/sage-sdist\n+++ b/src/bin/sage-sdist\n@@ -46,7 +46,9 @@ sage-clone-source \"$SAGE_ROOT\" \"$TMP_DIR/$TARGET\"\n # Download and copy all upstream tarballs (the -B option to make forces\n # all targets to be built unconditionally)\n cd \"$SAGE_ROOT/build\"\n-SAGE_INSTALL_GCC=yes SAGE_SPKG_OPTS=\"-f -d\" SAGE_SPKG_COPY_UPSTREAM=\"$TMP_DIR/$TARGET/upstream\" ./install -B all\n+SAGE_INSTALL_GCC=yes SAGE_SPKG_COPY_UPSTREAM=\"$TMP_DIR/$TARGET/upstream\" \\\n+SAGE_INSTALL_FETCH_ONLY=yes SAGE_SPKG_OPTS=\"-f -d\" \\\n+./install -B all\n \n # Create source .tar.gz\n cd \"$TMP_DIR\"\n```\n",
    "created_at": "2013-12-30T11:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197347",
    "user": "https://github.com/jdemeyer"
}
```

I think this is sufficient

```diff
commit 0255a2a53e9aebaf54c0fab335ef0202a6b77ae8
Author: Jeroen Demeyer <jdemeyer@cage.ugent.be>
Date:   Mon Dec 30 12:47:06 2013 +0100

    Allow sage --sdist without building Sage

diff --git a/src/bin/sage-clone-source b/src/bin/sage-clone-source
index aabc452..090466b 100755
--- a/src/bin/sage-clone-source
+++ b/src/bin/sage-clone-source
@@ -20,7 +20,7 @@ SRC="$1"
 DST="$2"
 
 rm -rf "$DST"
-mkdir "$DST"
+mkdir -p "$DST"
 
 git clone "$SRC" "$DST"
 
diff --git a/src/bin/sage-sdist b/src/bin/sage-sdist
index 3a554b6..1aee0cc 100755
--- a/src/bin/sage-sdist
+++ b/src/bin/sage-sdist
@@ -46,7 +46,9 @@ sage-clone-source "$SAGE_ROOT" "$TMP_DIR/$TARGET"
 # Download and copy all upstream tarballs (the -B option to make forces
 # all targets to be built unconditionally)
 cd "$SAGE_ROOT/build"
-SAGE_INSTALL_GCC=yes SAGE_SPKG_OPTS="-f -d" SAGE_SPKG_COPY_UPSTREAM="$TMP_DIR/$TARGET/upstream" ./install -B all
+SAGE_INSTALL_GCC=yes SAGE_SPKG_COPY_UPSTREAM="$TMP_DIR/$TARGET/upstream" \
+SAGE_INSTALL_FETCH_ONLY=yes SAGE_SPKG_OPTS="-f -d" \
+./install -B all
 
 # Create source .tar.gz
 cd "$TMP_DIR"
```




---

archive/issue_comments_197348.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-30T13:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197348",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_197349.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-12-30T13:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197349",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_197350.json:
```json
{
    "body": "Sure, this is fine.",
    "created_at": "2013-12-31T05:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197350",
    "user": "https://github.com/ohanar"
}
```

Sure, this is fine.



---

archive/issue_comments_197351.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-31T05:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197351",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_197352.json:
```json
{
    "body": "Does this imply also a positive review to #15596 by transitivity?",
    "created_at": "2013-12-31T10:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197352",
    "user": "https://github.com/jdemeyer"
}
```

Does this imply also a positive review to #15596 by transitivity?



---

archive/issue_comments_197353.json:
```json
{
    "body": "Fails on mod:\n\n```\nconfigure.ac:21: error: Autoconf version 2.63 or higher is required\nconfigure.ac:21: the top level\nautom4te: /usr/bin/m4 failed with exit status: 63\naclocal: autom4te failed with exit status: 63\n```\n",
    "created_at": "2014-01-04T02:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197353",
    "user": "https://github.com/vbraun"
}
```

Fails on mod:

```
configure.ac:21: error: Autoconf version 2.63 or higher is required
configure.ac:21: the top level
autom4te: /usr/bin/m4 failed with exit status: 63
aclocal: autom4te failed with exit status: 63
```




---

archive/issue_comments_197354.json:
```json
{
    "body": "Replying to [comment:26 vbraun]:\n> Fails on mod:\n> {{{\n> configure.ac:21: error: Autoconf version 2.63 or higher is required\n> configure.ac:21: the top level\n> autom4te: /usr/bin/m4 failed with exit status: 63\n> aclocal: autom4te failed with exit status: 63\n> }}}\nOf course it fails, installing from `git` now requires a recent enough version of autotools (this is true for many projects, it's not the fault of Sage).\n\nIf you're bothered by this, you could drop the `git` builder on `mod` and only build from the source tarball (which doesn't require autotools).",
    "created_at": "2014-01-04T10:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197354",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 vbraun]:
> Fails on mod:
> {{{
> configure.ac:21: error: Autoconf version 2.63 or higher is required
> configure.ac:21: the top level
> autom4te: /usr/bin/m4 failed with exit status: 63
> aclocal: autom4te failed with exit status: 63
> }}}
Of course it fails, installing from `git` now requires a recent enough version of autotools (this is true for many projects, it's not the fault of Sage).

If you're bothered by this, you could drop the `git` builder on `mod` and only build from the source tarball (which doesn't require autotools).



---

archive/issue_comments_197355.json:
```json
{
    "body": "Why does it say \"does not merge cleanly\"? It merges cleanly for me...",
    "created_at": "2014-01-04T12:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197355",
    "user": "https://github.com/jdemeyer"
}
```

Why does it say "does not merge cleanly"? It merges cleanly for me...



---

archive/issue_comments_197356.json:
```json
{
    "body": "Andrew is working on the git plugin this week, so its possibly not accurate at the moment.\n\nDo we really need ac 2.63, which is only about 5 years old? 2.61 doesn't work? Also I don't see the new dependency being documented.\n\nIn any case, I think OSX users will be in a world of hurt if we merge this. I take it you are volunteering to walk them through autoconf installation? ;-)",
    "created_at": "2014-01-04T18:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197356",
    "user": "https://github.com/vbraun"
}
```

Andrew is working on the git plugin this week, so its possibly not accurate at the moment.

Do we really need ac 2.63, which is only about 5 years old? 2.61 doesn't work? Also I don't see the new dependency being documented.

In any case, I think OSX users will be in a world of hurt if we merge this. I take it you are volunteering to walk them through autoconf installation? ;-)



---

archive/issue_comments_197357.json:
```json
{
    "body": "Replying to [comment:28 jdemeyer]:\n> Why does it say \"does not merge cleanly\"? It merges cleanly for me...\n\nThis particular merge confuses a lot of git tools since there is a new root in your branch. I should be rolling out the new plugin later today, but it won't fix this ticket (or this sort of issue). In the long run, these sorts of merge issues should disappear as all the old repositories get merged.",
    "created_at": "2014-01-04T21:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197357",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:28 jdemeyer]:
> Why does it say "does not merge cleanly"? It merges cleanly for me...

This particular merge confuses a lot of git tools since there is a new root in your branch. I should be rolling out the new plugin later today, but it won't fix this ticket (or this sort of issue). In the long run, these sorts of merge issues should disappear as all the old repositories get merged.



---

archive/issue_comments_197358.json:
```json
{
    "body": "I discussed this with Andrew and we agreed to just package the autogenerated files into a tarball, and make it so that the \"make configure\" target automatically updates the tarball / checksum.ini. Objections?",
    "created_at": "2014-01-05T00:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197358",
    "user": "https://github.com/vbraun"
}
```

I discussed this with Andrew and we agreed to just package the autogenerated files into a tarball, and make it so that the "make configure" target automatically updates the tarball / checksum.ini. Objections?



---

archive/issue_comments_197359.json:
```json
{
    "body": "Replying to [comment:29 vbraun]:\n> Andrew is working on the git plugin this week, so its possibly not accurate at the moment.\n> \n> Do we really need ac 2.63, which is only about 5 years old? 2.61 doesn't work?\nProbably, but I can easily check to be sure.\n\n> Also I don't see the new dependency being documented.\nWell, building directly from the git repo isn't documented anywhere AFAIK, that would be the natural place to document the extra dependency.",
    "created_at": "2014-01-05T09:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197359",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:29 vbraun]:
> Andrew is working on the git plugin this week, so its possibly not accurate at the moment.
> 
> Do we really need ac 2.63, which is only about 5 years old? 2.61 doesn't work?
Probably, but I can easily check to be sure.

> Also I don't see the new dependency being documented.
Well, building directly from the git repo isn't documented anywhere AFAIK, that would be the natural place to document the extra dependency.



---

archive/issue_comments_197360.json:
```json
{
    "body": "Replying to [comment:31 vbraun]:\n> I discussed this with Andrew and we agreed to just package the autogenerated files into a tarball. Objections?\nNo objections in principle. But this tarball should not be treated like other \"upstream\" tarballs. I prefer a direct call to `sage-download-file`, without going through `sage-spkg` and checksum checking.\n\nI think creating this tarball should be left to `sage --sdist`, I don't see the point of recreating it every time you run `autoconf`.",
    "created_at": "2014-01-05T09:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197360",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:31 vbraun]:
> I discussed this with Andrew and we agreed to just package the autogenerated files into a tarball. Objections?
No objections in principle. But this tarball should not be treated like other "upstream" tarballs. I prefer a direct call to `sage-download-file`, without going through `sage-spkg` and checksum checking.

I think creating this tarball should be left to `sage --sdist`, I don't see the point of recreating it every time you run `autoconf`.



---

archive/issue_comments_197361.json:
```json
{
    "body": "I am working on this.",
    "created_at": "2014-01-05T10:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197361",
    "user": "https://github.com/jdemeyer"
}
```

I am working on this.



---

archive/issue_comments_197362.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-01-05T10:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197362",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_197363.json:
```json
{
    "body": "You're right, `autoconf` version 2.60 does work (2.59 does not).",
    "created_at": "2014-01-05T10:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197363",
    "user": "https://github.com/jdemeyer"
}
```

You're right, `autoconf` version 2.60 does work (2.59 does not).



---

archive/issue_comments_197364.json:
```json
{
    "body": "Replying to [comment:34 jdemeyer]:\n> I think creating this tarball should be left to `sage --sdist`, I don't see the point of recreating it every time you run `autoconf`.\n\nIf we want to treat that tarball like all other tarballs then we need to commit its checksum *before* running `sage -sdist`. Also, for testing it would be nice to run the new tarball through the buildbot before releasing it. Of course that can be worked around by running `sage -sdist` twice but then thats hardly ideal. \n\nAnd while one could treat it completely different from the other tarballs, I don't see why we have to give up checksumming here.",
    "created_at": "2014-01-05T18:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197364",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:34 jdemeyer]:
> I think creating this tarball should be left to `sage --sdist`, I don't see the point of recreating it every time you run `autoconf`.

If we want to treat that tarball like all other tarballs then we need to commit its checksum *before* running `sage -sdist`. Also, for testing it would be nice to run the new tarball through the buildbot before releasing it. Of course that can be worked around by running `sage -sdist` twice but then thats hardly ideal. 

And while one could treat it completely different from the other tarballs, I don't see why we have to give up checksumming here.



---

archive/issue_comments_197365.json:
```json
{
    "body": "Replying to [comment:37 vbraun]:\n> I don't see why we have to give up checksumming here.\nBecause checksumming is done is `sage-spkg` and this tarball wouldn't `sage-spkg`. And I would very much be against using `sage-spkg` for this, since it would be the upside-down world. Normally, `configure` is run as very first thing in a build and it might for example be used to configure `sage-spkg`. This currently isn't the case, but we should plan for it.",
    "created_at": "2014-01-05T18:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197365",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:37 vbraun]:
> I don't see why we have to give up checksumming here.
Because checksumming is done is `sage-spkg` and this tarball wouldn't `sage-spkg`. And I would very much be against using `sage-spkg` for this, since it would be the upside-down world. Normally, `configure` is run as very first thing in a build and it might for example be used to configure `sage-spkg`. This currently isn't the case, but we should plan for it.



---

archive/issue_comments_197366.json:
```json
{
    "body": "Either way you need a script somewhere that a) does not depend on configure output and b) downloads a tarball and run the `spkg-install` script. If we want to auto-generate the equivalent of a `sage-spkg` script then we can just give it a different name, no?",
    "created_at": "2014-01-05T19:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197366",
    "user": "https://github.com/vbraun"
}
```

Either way you need a script somewhere that a) does not depend on configure output and b) downloads a tarball and run the `spkg-install` script. If we want to auto-generate the equivalent of a `sage-spkg` script then we can just give it a different name, no?



---

archive/issue_comments_197367.json:
```json
{
    "body": "Replying to [comment:39 vbraun]:\n> Either way you need a script somewhere that a) does not depend on configure output and b) downloads a tarball and run the `spkg-install` script.\nI don't understand what you're saying here. We need a script that\n1. does not depend on configure output\n2. downloads a tarball\nbut that script does not need to\n1. check checksums\n2. run `spkg-install`\n\nI also really don't want to come up with an overkill solution for this. Personally, I'd be happy to simply say \"if you want to build from `git`, make sure you have autotools installed\". There's always the source tarball which doesn't require autotools and once you've built Sage, you could install the autotools package, or simply hope that an outdated `configure` script is still fine.",
    "created_at": "2014-01-05T19:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197367",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:39 vbraun]:
> Either way you need a script somewhere that a) does not depend on configure output and b) downloads a tarball and run the `spkg-install` script.
I don't understand what you're saying here. We need a script that
1. does not depend on configure output
2. downloads a tarball
but that script does not need to
1. check checksums
2. run `spkg-install`

I also really don't want to come up with an overkill solution for this. Personally, I'd be happy to simply say "if you want to build from `git`, make sure you have autotools installed". There's always the source tarball which doesn't require autotools and once you've built Sage, you could install the autotools package, or simply hope that an outdated `configure` script is still fine.



---

archive/issue_comments_197368.json:
```json
{
    "body": "I also want to make it as easy as possible, this is why I'm suggesting to just treat it as every other tarball instead of a custom script just for that one.",
    "created_at": "2014-01-05T19:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197368",
    "user": "https://github.com/vbraun"
}
```

I also want to make it as easy as possible, this is why I'm suggesting to just treat it as every other tarball instead of a custom script just for that one.



---

archive/issue_comments_197369.json:
```json
{
    "body": "Attachment [configure-6.1.beta2.tar.gz](tarball://root/attachments/some-uuid/ticket15580/configure-6.1.beta2.tar.gz) by @jdemeyer created at 2014-01-05 21:37:53\n\nVolker, are you able to put files in the `upstream` directory on the server? If so, please do that for [attachment:configure-6.1.beta2.tar.gz]",
    "created_at": "2014-01-05T21:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197369",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [configure-6.1.beta2.tar.gz](tarball://root/attachments/some-uuid/ticket15580/configure-6.1.beta2.tar.gz) by @jdemeyer created at 2014-01-05 21:37:53

Volker, are you able to put files in the `upstream` directory on the server? If so, please do that for [attachment:configure-6.1.beta2.tar.gz]



---

archive/issue_comments_197370.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-05T21:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197370",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197371.json:
```json
{
    "body": "This is the simplest solution I could come up with which should work...\n----\nNew commits:\n----\nNew commits:",
    "created_at": "2014-01-05T21:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197371",
    "user": "https://github.com/jdemeyer"
}
```

This is the simplest solution I could come up with which should work...
----
New commits:
----
New commits:



---

archive/issue_comments_197372.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-05T21:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197372",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_197373.json:
```json
{
    "body": "I don't like the fact that I can't test the updated tarball on the buildbot without bumping the version. This slows down the release process as I have to bump version and re-run the buildbot. For a release I just want to bump the version and publish it immediately afterward. Any other change can break things, so requres testing, ie. another day twiddling thumbs.",
    "created_at": "2014-01-06T04:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197373",
    "user": "https://github.com/vbraun"
}
```

I don't like the fact that I can't test the updated tarball on the buildbot without bumping the version. This slows down the release process as I have to bump version and re-run the buildbot. For a release I just want to bump the version and publish it immediately afterward. Any other change can break things, so requres testing, ie. another day twiddling thumbs.



---

archive/issue_comments_197374.json:
```json
{
    "body": "Replying to [comment:46 vbraun]:\n> I don't like the fact that I can't test the updated tarball on the buildbot without bumping the version. This slows down the release process as I have to bump version and re-run the buildbot.\nI thought you were using a private git repo for the buildbot? In that case, you could easily do the version bump only in your private repo. Alternatively, point `$SAGE_UPSTREAM` to a place you control.\n\nMy philosophy with the buildbot was to always test the **exact** source tarball that I would release. If you're testing first, then changing the version number, then `sdist`, something could go wrong in those last two steps and you would never notice.\n\nAnd yes, there has been at least one bug which dependended on the length of the Sage version number, so it can happen.",
    "created_at": "2014-01-06T08:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197374",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:46 vbraun]:
> I don't like the fact that I can't test the updated tarball on the buildbot without bumping the version. This slows down the release process as I have to bump version and re-run the buildbot.
I thought you were using a private git repo for the buildbot? In that case, you could easily do the version bump only in your private repo. Alternatively, point `$SAGE_UPSTREAM` to a place you control.

My philosophy with the buildbot was to always test the **exact** source tarball that I would release. If you're testing first, then changing the version number, then `sdist`, something could go wrong in those last two steps and you would never notice.

And yes, there has been at least one bug which dependended on the length of the Sage version number, so it can happen.



---

archive/issue_comments_197375.json:
```json
{
    "body": "I'm not testing the source tarball at all, its much faster to do incremental builds for git commits with occasional full rebuilds.",
    "created_at": "2014-01-06T08:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197375",
    "user": "https://github.com/vbraun"
}
```

I'm not testing the source tarball at all, its much faster to do incremental builds for git commits with occasional full rebuilds.



---

archive/issue_comments_197376.json:
```json
{
    "body": "Replying to [comment:48 vbraun]:\n> its much faster to do incremental builds for git commits with occasional full rebuilds.\nEven then, I still don't understand why this patch prevents you from testing properly.",
    "created_at": "2014-01-06T08:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197376",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:48 vbraun]:
> its much faster to do incremental builds for git commits with occasional full rebuilds.
Even then, I still don't understand why this patch prevents you from testing properly.



---

archive/issue_comments_197377.json:
```json
{
    "body": "It doesn't prevent me from testing, but it makes it slower and involves more steps than it should.",
    "created_at": "2014-01-06T08:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197377",
    "user": "https://github.com/vbraun"
}
```

It doesn't prevent me from testing, but it makes it slower and involves more steps than it should.



---

archive/issue_comments_197378.json:
```json
{
    "body": "Replying to [comment:50 vbraun]:\n> It doesn't prevent me from testing, but it makes it slower and involves more steps than it should.\nWhy slower? I don't understand the problem...",
    "created_at": "2014-01-06T08:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197378",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:50 vbraun]:
> It doesn't prevent me from testing, but it makes it slower and involves more steps than it should.
Why slower? I don't understand the problem...



---

archive/issue_comments_197379.json:
```json
{
    "body": "I want to have a workflow where I merge branches, test, and once it works slap on the new version and release. Bumping the version should not require another test run. Bumping the version just to make the new configure-x.y.z tarball and then resetting to before the version bump is also not desirable.",
    "created_at": "2014-01-06T08:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197379",
    "user": "https://github.com/vbraun"
}
```

I want to have a workflow where I merge branches, test, and once it works slap on the new version and release. Bumping the version should not require another test run. Bumping the version just to make the new configure-x.y.z tarball and then resetting to before the version bump is also not desirable.



---

archive/issue_comments_197380.json:
```json
{
    "body": "Replying to [comment:52 vbraun]:\n> I want to have a workflow where I merge branches, test, and once it works slap on the new version and release. Bumping the version should not require another test run. Bumping the version just to make the new configure-x.y.z tarball and then resetting to before the version bump is also not desirable. \n\nWhy not the following workflow:\n1. In volker's private repo, bump the version number and merge various patches\n2. Run `sage --sdist` to generate the configure tarball\n3. Put the configure tarball in some accessible place\n4. Run the buildbots on Volker's private repo\n5. If tests pass, merge Volker's repo with the official repo.\n\n(Ideally, I would argue there should also be a 4b. Run at least one buildbot on the source tarball instead of the git repo)\n\nWhat alternative would you propose? You need to generate the configure tarball anyway before you can test it, regardless of any version bumps...",
    "created_at": "2014-01-06T09:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197380",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:52 vbraun]:
> I want to have a workflow where I merge branches, test, and once it works slap on the new version and release. Bumping the version should not require another test run. Bumping the version just to make the new configure-x.y.z tarball and then resetting to before the version bump is also not desirable. 

Why not the following workflow:
1. In volker's private repo, bump the version number and merge various patches
2. Run `sage --sdist` to generate the configure tarball
3. Put the configure tarball in some accessible place
4. Run the buildbots on Volker's private repo
5. If tests pass, merge Volker's repo with the official repo.

(Ideally, I would argue there should also be a 4b. Run at least one buildbot on the source tarball instead of the git repo)

What alternative would you propose? You need to generate the configure tarball anyway before you can test it, regardless of any version bumps...



---

archive/issue_comments_197381.json:
```json
{
    "body": "Since we don't put the version into `AC_INIT` we don't have to bump the tarball at all with each version. Not doing anything is always the easiest and least error-prone.\n\nJust increment configure-n.tar, configure-(n+1).tar, ... each time you have to re-run autoconf (i.e. `make configure` / `autogen.sh`).",
    "created_at": "2014-01-06T09:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197381",
    "user": "https://github.com/vbraun"
}
```

Since we don't put the version into `AC_INIT` we don't have to bump the tarball at all with each version. Not doing anything is always the easiest and least error-prone.

Just increment configure-n.tar, configure-(n+1).tar, ... each time you have to re-run autoconf (i.e. `make configure` / `autogen.sh`).



---

archive/issue_comments_197382.json:
```json
{
    "body": "Also, I've been bumping the version in the source and tagging the new version at the same commit. IMHO having version and tag match is the easiest to understand for others. That requires me to bump the version at the end of the beta series.",
    "created_at": "2014-01-06T09:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197382",
    "user": "https://github.com/vbraun"
}
```

Also, I've been bumping the version in the source and tagging the new version at the same commit. IMHO having version and tag match is the easiest to understand for others. That requires me to bump the version at the end of the beta series.



---

archive/issue_comments_197383.json:
```json
{
    "body": "Replying to [comment:54 vbraun]:\n> we don't put the version into `AC_INIT`\nThat's \"fixed\" in #15606, but it's not really important anyway.\n\n> Not doing anything is always the easiest and least error-prone.\nI disagree. Doing the same thing every time (i.e. always changing the version number) is always the easiest and least error-prone. Special cases are often the cause for errors.\n\n> Just increment configure-n.tar, configure-(n+1).tar, ... each time you have to re-run autoconf (i.e. make configure / autogen.sh).\nAnd how are you going to implement this auto-incrementing and keeping track of which number to use... this seems far more complicated than my proposal.",
    "created_at": "2014-01-06T09:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197383",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:54 vbraun]:
> we don't put the version into `AC_INIT`
That's "fixed" in #15606, but it's not really important anyway.

> Not doing anything is always the easiest and least error-prone.
I disagree. Doing the same thing every time (i.e. always changing the version number) is always the easiest and least error-prone. Special cases are often the cause for errors.

> Just increment configure-n.tar, configure-(n+1).tar, ... each time you have to re-run autoconf (i.e. make configure / autogen.sh).
And how are you going to implement this auto-incrementing and keeping track of which number to use... this seems far more complicated than my proposal.



---

archive/issue_comments_197384.json:
```json
{
    "body": "Replying to [comment:55 vbraun]:\n> Also, I've been bumping the version in the source and tagging the new version at the same commit. IMHO having version and tag match is the easiest to understand for others. That requires me to bump the version at the end of the beta series.\nOne could argue that the new version \"starts\" right after the old tag. The first commit after sage-6.1.beta4 belongs to sage-6.1.beta5, so I would find it logical that checking out that commit would give the new version number.",
    "created_at": "2014-01-06T09:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197384",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:55 vbraun]:
> Also, I've been bumping the version in the source and tagging the new version at the same commit. IMHO having version and tag match is the easiest to understand for others. That requires me to bump the version at the end of the beta series.
One could argue that the new version "starts" right after the old tag. The first commit after sage-6.1.beta4 belongs to sage-6.1.beta5, so I would find it logical that checking out that commit would give the new version number.



---

archive/issue_comments_197385.json:
```json
{
    "body": "On can certainly argue for other ways of labeling things. In the end, doing it this way is one step vs. two separate steps, so its easier for me.\n\nReplying to [comment:56 jdemeyer]:\n> And how are you going to implement this auto-incrementing and keeping track of which number to use..\n\nEasy, there will be a `build/pkgs/configure/package-version.txt` that contains the integer `n`. Reading it and incrementing it by one is standard bash `$[n+1]`",
    "created_at": "2014-01-06T09:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197385",
    "user": "https://github.com/vbraun"
}
```

On can certainly argue for other ways of labeling things. In the end, doing it this way is one step vs. two separate steps, so its easier for me.

Replying to [comment:56 jdemeyer]:
> And how are you going to implement this auto-incrementing and keeping track of which number to use..

Easy, there will be a `build/pkgs/configure/package-version.txt` that contains the integer `n`. Reading it and incrementing it by one is standard bash `$[n+1]`



---

archive/issue_comments_197386.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-06T10:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197386",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197387.json:
```json
{
    "body": "Do you like this better?",
    "created_at": "2014-01-06T10:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197387",
    "user": "https://github.com/jdemeyer"
}
```

Do you like this better?



---

archive/issue_comments_197388.json:
```json
{
    "body": "Looks good. Is there an argument against automatically increasing the version number whenever you re-run autoconf? Skipping configure-$version numbers costs us nothing, but forgetting to increase it will potentially cause major problems. \n\nAlso, filling out the other files (e.g. checksums.ini) in the `build/pkgs/configure` files will make it easier to manage the upstream directory on the sagemath web server in a unified manner.",
    "created_at": "2014-01-06T22:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197388",
    "user": "https://github.com/vbraun"
}
```

Looks good. Is there an argument against automatically increasing the version number whenever you re-run autoconf? Skipping configure-$version numbers costs us nothing, but forgetting to increase it will potentially cause major problems. 

Also, filling out the other files (e.g. checksums.ini) in the `build/pkgs/configure` files will make it easier to manage the upstream directory on the sagemath web server in a unified manner.



---

archive/issue_comments_197389.json:
```json
{
    "body": "Replying to [comment:61 vbraun]:\n> Looks good. Is there an argument against automatically increasing the version number whenever you re-run autoconf? Skipping configure-$version numbers costs us nothing, but forgetting to increase it will potentially cause major problems.\nWould you agree with increasing the version number automatically in `sage-update-version`?",
    "created_at": "2014-01-07T07:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197389",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:61 vbraun]:
> Looks good. Is there an argument against automatically increasing the version number whenever you re-run autoconf? Skipping configure-$version numbers costs us nothing, but forgetting to increase it will potentially cause major problems.
Would you agree with increasing the version number automatically in `sage-update-version`?



---

archive/issue_comments_197390.json:
```json
{
    "body": "My main question is whether we are going to hardcode the current version into the autogenerated scripts or not (see #15606). If that is the case then we of course should save the new autogenerated stuff in `sage-update-version`. If not then there would be no need to tie version to the autogenerated scripts, so we should not.",
    "created_at": "2014-01-07T07:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197390",
    "user": "https://github.com/vbraun"
}
```

My main question is whether we are going to hardcode the current version into the autogenerated scripts or not (see #15606). If that is the case then we of course should save the new autogenerated stuff in `sage-update-version`. If not then there would be no need to tie version to the autogenerated scripts, so we should not.



---

archive/issue_comments_197391.json:
```json
{
    "body": "Replying to [comment:63 vbraun]:\n> My main question is whether we are going to hardcode the current version into the autogenerated scripts or not (see #15606).\nI propose to do so indeed.",
    "created_at": "2014-01-07T08:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197391",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:63 vbraun]:
> My main question is whether we are going to hardcode the current version into the autogenerated scripts or not (see #15606).
I propose to do so indeed.



---

archive/issue_comments_197392.json:
```json
{
    "body": "Ok, fine. Thats imho the right thing to do, keep the version in configure.ac and then generate all other files that contain the version form .in files at configure time.\n\nI'd still prefer to not use the Sage version as the configure tarball version since it'll be potentially confusing to test different configure tarballs on the buildbot if it needs to be debugged.",
    "created_at": "2014-01-07T09:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197392",
    "user": "https://github.com/vbraun"
}
```

Ok, fine. Thats imho the right thing to do, keep the version in configure.ac and then generate all other files that contain the version form .in files at configure time.

I'd still prefer to not use the Sage version as the configure tarball version since it'll be potentially confusing to test different configure tarballs on the buildbot if it needs to be debugged.



---

archive/issue_comments_197393.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-07T11:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197394.json:
```json
{
    "body": "OK, new approach. I now have a script `src/bin/sage-autogen` which takes care of creating the configure tarball and computing the checksum. It can optionally (with the `-i` option) increase the version number. This script is never run automatically, it must be explicitly called by the release manager. But then the release manager can freely choose when to do this.",
    "created_at": "2014-01-07T11:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197394",
    "user": "https://github.com/jdemeyer"
}
```

OK, new approach. I now have a script `src/bin/sage-autogen` which takes care of creating the configure tarball and computing the checksum. It can optionally (with the `-i` option) increase the version number. This script is never run automatically, it must be explicitly called by the release manager. But then the release manager can freely choose when to do this.



---

archive/issue_comments_197395.json:
```json
{
    "body": "Replying to [comment:48 vbraun]:\n> I'm not testing the source tarball at all\nI think that's a mistake. If something breaks `sage-sdist`, you need to know.",
    "created_at": "2014-01-08T15:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197395",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:48 vbraun]:
> I'm not testing the source tarball at all
I think that's a mistake. If something breaks `sage-sdist`, you need to know.



---

archive/issue_comments_197396.json:
```json
{
    "body": "At the end of the day, the git repo is the authorative download. The source tarball is added as a convenience, but I don't think there is a point in worrying too much about it.",
    "created_at": "2014-01-11T22:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197396",
    "user": "https://github.com/vbraun"
}
```

At the end of the day, the git repo is the authorative download. The source tarball is added as a convenience, but I don't think there is a point in worrying too much about it.



---

archive/issue_comments_197397.json:
```json
{
    "body": "Gnu recommends `./bootstrap` (http://www.gnu.org/software/automake/faq/autotools-faq.html#What-does-_002e_002fbootstrap-or-_002e_002fautogen_002esh-do_003f} instead of autogen.\n\nAlso, the new configure tarball needs to be committed together with the version number change (and should eventually **become** the version number change) to end up with the correct tag.\n\nI'll implement these changes...",
    "created_at": "2014-01-12T02:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197397",
    "user": "https://github.com/vbraun"
}
```

Gnu recommends `./bootstrap` (http://www.gnu.org/software/automake/faq/autotools-faq.html#What-does-_002e_002fbootstrap-or-_002e_002fautogen_002esh-do_003f} instead of autogen.

Also, the new configure tarball needs to be committed together with the version number change (and should eventually **become** the version number change) to end up with the correct tag.

I'll implement these changes...



---

archive/issue_comments_197398.json:
```json
{
    "body": "I agree with everything so far, only my final commits need review.\n----\nNew commits:",
    "created_at": "2014-01-12T03:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197398",
    "user": "https://github.com/vbraun"
}
```

I agree with everything so far, only my final commits need review.
----
New commits:



---

archive/issue_comments_197399.json:
```json
{
    "body": "In `SPKG.txt`, *They are shippd* [sic] *with* is not a sentence.",
    "created_at": "2014-01-12T06:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197399",
    "user": "https://github.com/jdemeyer"
}
```

In `SPKG.txt`, *They are shippd* [sic] *with* is not a sentence.



---

archive/issue_comments_197400.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-12T06:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197400",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_197401.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-12T16:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197401",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197402.json:
```json
{
    "body": "Volker: I'm fine with your patch, modulo a few details in my reviewer commit.",
    "created_at": "2014-01-12T19:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197402",
    "user": "https://github.com/jdemeyer"
}
```

Volker: I'm fine with your patch, modulo a few details in my reviewer commit.



---

archive/issue_comments_197403.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-12T19:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197403",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_197404.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-12T19:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197404",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_197405.json:
```json
{
    "body": "Replying to [comment:69 vbraun]:\n> At the end of the day, the git repo is the authorative download. The source tarball is added as a convenience\nGiven that the [Sage home page](http://www.sagemath.org/) only has links to the source and binary tarballs, I'd say the opposite is true.\n\n> but I don't think there is a point in worrying too much about it.\nPerhaps not, but this ticket could certainly break sdists. So if you don't want automated testing, you should at least try building from an sdist generated after this ticket.",
    "created_at": "2014-01-13T09:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197405",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:69 vbraun]:
> At the end of the day, the git repo is the authorative download. The source tarball is added as a convenience
Given that the [Sage home page](http://www.sagemath.org/) only has links to the source and binary tarballs, I'd say the opposite is true.

> but I don't think there is a point in worrying too much about it.
Perhaps not, but this ticket could certainly break sdists. So if you don't want automated testing, you should at least try building from an sdist generated after this ticket.



---

archive/issue_comments_197406.json:
```json
{
    "body": "Breaks incremental builds on mod:\n\n```\nconfigure:2803: $? = 1\nconfigure:2826: checking for C compiler default output file name\nconfigure:2853: gcc   -I/mnt/SSD1/mod_buildslave/sage_git/build/local/include  -L/mnt/SSD1/mod_buildslave/sage_git/build/local/lib conftest.c  >&5\n/mnt/SSD1/mod_buildslave/sage_git/build/local/libexec/gcc/x86_64-unknown-linux-gnu/4.7.3/cc1: error while loading shared libraries: libmpc.so.3: cannot open shared object file: No such file or directory\nconfigure:2856: $? = 1\nconfigure:2894: result: \nconfigure: failed program was:\nconfigure:2901: error: C compiler cannot create executables\nSee `config.log' for more details\n```\n\nWhy does it even know about the `$SAGE_LOCAL` paths? The part should also set up `LD_LIBRARY_PATH`...",
    "created_at": "2014-01-14T05:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197406",
    "user": "https://github.com/vbraun"
}
```

Breaks incremental builds on mod:

```
configure:2803: $? = 1
configure:2826: checking for C compiler default output file name
configure:2853: gcc   -I/mnt/SSD1/mod_buildslave/sage_git/build/local/include  -L/mnt/SSD1/mod_buildslave/sage_git/build/local/lib conftest.c  >&5
/mnt/SSD1/mod_buildslave/sage_git/build/local/libexec/gcc/x86_64-unknown-linux-gnu/4.7.3/cc1: error while loading shared libraries: libmpc.so.3: cannot open shared object file: No such file or directory
configure:2856: $? = 1
configure:2894: result: 
configure: failed program was:
configure:2901: error: C compiler cannot create executables
See `config.log' for more details
```

Why does it even know about the `$SAGE_LOCAL` paths? The part should also set up `LD_LIBRARY_PATH`...



---

archive/issue_comments_197407.json:
```json
{
    "body": "Btw the \"See `config.log' for more details\" is kind of impractical. It would be nice if the config.log would be inserted into the prereq.log file, especially if something goes wrong.",
    "created_at": "2014-01-14T05:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197407",
    "user": "https://github.com/vbraun"
}
```

Btw the "See `config.log' for more details" is kind of impractical. It would be nice if the config.log would be inserted into the prereq.log file, especially if something goes wrong.



---

archive/issue_comments_197408.json:
```json
{
    "body": "Full rebuild works on mod, for the record.",
    "created_at": "2014-01-14T05:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197408",
    "user": "https://github.com/vbraun"
}
```

Full rebuild works on mod, for the record.



---

archive/issue_comments_197409.json:
```json
{
    "body": "Replying to [comment:79 vbraun]:\n> Why does it even know about the `$SAGE_LOCAL` paths? The part should also set up `LD_LIBRARY_PATH`...\n\nCould it be a bug in your build scripts?\n\nIn any case, if the full build works, I wouldn't worry too much...",
    "created_at": "2014-01-14T07:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197409",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:79 vbraun]:
> Why does it even know about the `$SAGE_LOCAL` paths? The part should also set up `LD_LIBRARY_PATH`...

Could it be a bug in your build scripts?

In any case, if the full build works, I wouldn't worry too much...



---

archive/issue_comments_197410.json:
```json
{
    "body": "Replying to [comment:80 vbraun]:\n> Btw the \"See `config.log' for more details\" is kind of impractical. It would be nice if the config.log would be inserted into the prereq.log file, especially if something goes wrong.\nOK, I'll have a look at that in #15606.",
    "created_at": "2014-01-14T07:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197410",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:80 vbraun]:
> Btw the "See `config.log' for more details" is kind of impractical. It would be nice if the config.log would be inserted into the prereq.log file, especially if something goes wrong.
OK, I'll have a look at that in #15606.



---

archive/issue_comments_197411.json:
```json
{
    "body": "Replying to [comment:79 vbraun]:\n> Why does it even know about the `$SAGE_LOCAL` paths? The part should also set up `LD_LIBRARY_PATH`...\nIt seems you discovered a very old bug. `build/install` adds `SAGE_LOCAL/bin` to the `PATH`, but doesn't change `LD_LIBRARY_PATH`.",
    "created_at": "2014-01-14T09:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197411",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:79 vbraun]:
> Why does it even know about the `$SAGE_LOCAL` paths? The part should also set up `LD_LIBRARY_PATH`...
It seems you discovered a very old bug. `build/install` adds `SAGE_LOCAL/bin` to the `PATH`, but doesn't change `LD_LIBRARY_PATH`.



---

archive/issue_comments_197412.json:
```json
{
    "body": "The reason that the bug hasn't been seen before is that `configure` was never re-run after upgrading.",
    "created_at": "2014-01-14T10:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197412",
    "user": "https://github.com/jdemeyer"
}
```

The reason that the bug hasn't been seen before is that `configure` was never re-run after upgrading.



---

archive/issue_comments_197413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-14T11:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197414.json:
```json
{
    "body": "Mirror directory layout is `SAGE_UPSTREAM/configure/configure-n.tar.gz`, for the record",
    "created_at": "2014-01-14T16:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197414",
    "user": "https://github.com/vbraun"
}
```

Mirror directory layout is `SAGE_UPSTREAM/configure/configure-n.tar.gz`, for the record



---

archive/issue_comments_197415.json:
```json
{
    "body": "Still fails on mark/skynet:\n\n```\nmake[1]: Entering directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nmake[1]: Warning: File `Makefile' has modification time 6.4e+02 s in the future\nmake -j2 base\nmake[2]: Entering directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\nmake[2]: Warning: File `Makefile' has modification time 6.4e+02 s in the future\n/home/buildbot/build/sage/mark-1/sage_git/build/build/pipestatus \"./prereq.sh 2>&1\" \"tee -a /home/buildbot/build/sage/mark-1/sage_git/build/logs/pkgs/prereq.log\"\nStarting prerequisite check.\nMachine: SunOS mark 5.10 Generic_127111-01 sun4u sparc SUNW,Sun-Blade-2500\n\nmake[3]: Entering directory `/home/buildbot/build/sage/mark-1/sage_git/build'\nmake[3]: warning: -jN forced in submake: disabling jobserver mode.\nmake[3]: Warning: File `Makefile' has modification time 5.5e+02 s in the future\ntest -f config/missing || make -j2 config/missing || \\\n\t\tbash -c 'source src/bin/sage-env; sage-download-file $SAGE_UPSTREAM/configure/configure-`cat build/pkgs/configure/package-version.txt`.tar.gz | tar zxf -'\nconfig/missing --run aclocal -I m4\nconfig/missing: aclocal: not found\nmake[3]: *** [configure] Error 1\nmake[3]: warning:  Clock skew detected.  Your build may be incomplete.\nmake[3]: Leaving directory `/home/buildbot/build/sage/mark-1/sage_git/build'\nmake[2]: *** [/home/buildbot/build/sage/mark-1/sage_git/build/local/var/lib/sage/installed/prereq] Error 2\nmake[2]: Target `base' not remade because of errors.\nmake[2]: warning:  Clock skew detected.  Your build may be incomplete.\nmake[2]: Leaving directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'\nmake[1]: *** [all] Error 2\nmake[1]: warning:  Clock skew detected.  Your build may be incomplete.\nmake[1]: Leaving directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'\n```\n\n----\nNew commits:",
    "created_at": "2014-01-14T16:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197415",
    "user": "https://github.com/vbraun"
}
```

Still fails on mark/skynet:

```
make[1]: Entering directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Warning: File `Makefile' has modification time 6.4e+02 s in the future
make -j2 base
make[2]: Entering directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: Warning: File `Makefile' has modification time 6.4e+02 s in the future
/home/buildbot/build/sage/mark-1/sage_git/build/build/pipestatus "./prereq.sh 2>&1" "tee -a /home/buildbot/build/sage/mark-1/sage_git/build/logs/pkgs/prereq.log"
Starting prerequisite check.
Machine: SunOS mark 5.10 Generic_127111-01 sun4u sparc SUNW,Sun-Blade-2500

make[3]: Entering directory `/home/buildbot/build/sage/mark-1/sage_git/build'
make[3]: warning: -jN forced in submake: disabling jobserver mode.
make[3]: Warning: File `Makefile' has modification time 5.5e+02 s in the future
test -f config/missing || make -j2 config/missing || \
		bash -c 'source src/bin/sage-env; sage-download-file $SAGE_UPSTREAM/configure/configure-`cat build/pkgs/configure/package-version.txt`.tar.gz | tar zxf -'
config/missing --run aclocal -I m4
config/missing: aclocal: not found
make[3]: *** [configure] Error 1
make[3]: warning:  Clock skew detected.  Your build may be incomplete.
make[3]: Leaving directory `/home/buildbot/build/sage/mark-1/sage_git/build'
make[2]: *** [/home/buildbot/build/sage/mark-1/sage_git/build/local/var/lib/sage/installed/prereq] Error 2
make[2]: Target `base' not remade because of errors.
make[2]: warning:  Clock skew detected.  Your build may be incomplete.
make[2]: Leaving directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'
make[1]: *** [all] Error 2
make[1]: warning:  Clock skew detected.  Your build may be incomplete.
make[1]: Leaving directory `/home/buildbot/build/sage/mark-1/sage_git/build/build'
```

----
New commits:



---

archive/issue_comments_197416.json:
```json
{
    "body": "Not tested, but I guess this should help.\n----\nNew commits:",
    "created_at": "2014-01-14T21:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197416",
    "user": "https://github.com/jdemeyer"
}
```

Not tested, but I guess this should help.
----
New commits:



---

archive/issue_comments_197417.json:
```json
{
    "body": "How is that supposed to change anything? The `aclocal.m4' is not in the confball, so you need aclocal to generate it. The job of the \"missing\" script is to mangle the timestamps as if aclocal has run, but you still need the file whose timestamp is to be changed.",
    "created_at": "2014-01-15T03:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197417",
    "user": "https://github.com/vbraun"
}
```

How is that supposed to change anything? The `aclocal.m4' is not in the confball, so you need aclocal to generate it. The job of the "missing" script is to mangle the timestamps as if aclocal has run, but you still need the file whose timestamp is to be changed.



---

archive/issue_comments_197418.json:
```json
{
    "body": "PS: What running with bash does give you is the proper warning before it errors out:\n\n```\nWARNING: 'aclocal' is missing on your system.\n         You should only need it if you modified 'acinclude.m4' or\n         'configure.ac' or m4 files included by 'configure.ac'.\n         The 'aclocal' program is part of the GNU Automake package:\n         <http://www.gnu.org/software/automake>\n         It also requires GNU Autoconf, GNU m4 and Perl in order to run:\n         <http://www.gnu.org/software/autoconf>\n         <http://www.gnu.org/software/m4/>\n         <http://www.perl.org/>\nmake[3]: *** [configure] Error 127\n```\n",
    "created_at": "2014-01-15T03:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197418",
    "user": "https://github.com/vbraun"
}
```

PS: What running with bash does give you is the proper warning before it errors out:

```
WARNING: 'aclocal' is missing on your system.
         You should only need it if you modified 'acinclude.m4' or
         'configure.ac' or m4 files included by 'configure.ac'.
         The 'aclocal' program is part of the GNU Automake package:
         <http://www.gnu.org/software/automake>
         It also requires GNU Autoconf, GNU m4 and Perl in order to run:
         <http://www.gnu.org/software/autoconf>
         <http://www.gnu.org/software/m4/>
         <http://www.perl.org/>
make[3]: *** [configure] Error 127
```




---

archive/issue_comments_197419.json:
```json
{
    "body": "PPS: any thoughts on enabling `AM_MAINTAINER_MODE`?",
    "created_at": "2014-01-15T03:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197419",
    "user": "https://github.com/vbraun"
}
```

PPS: any thoughts on enabling `AM_MAINTAINER_MODE`?



---

archive/issue_comments_197420.json:
```json
{
    "body": "I guess disabling maintainer mode is only interesting when you actually run the automake-generated makefile. But we probably should, then. I'll put it in for now.\n\nIn any case, we should only run autotools from the bootstrap script. As long as we don't use the automake output there are no timestamp issues.\n----\nNew commits:",
    "created_at": "2014-01-15T05:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197420",
    "user": "https://github.com/vbraun"
}
```

I guess disabling maintainer mode is only interesting when you actually run the automake-generated makefile. But we probably should, then. I'll put it in for now.

In any case, we should only run autotools from the bootstrap script. As long as we don't use the automake output there are no timestamp issues.
----
New commits:



---

archive/issue_comments_197421.json:
```json
{
    "body": "I disagree with `./sage -f configure` since I absolutely don't want `configure` to act like a spkg. I prefer `configure` to have as few dependencies as possible. I much prefer to not depend on `sage-spkg` (and preferably also not on `build/install` nor `sage-env`, but that's harder for now).\n\nAlso, what was wrong with bootstrapping from the top-level `Makefile`? Doesn't the `missing` script work properly? I like the fact that `configure` gets regenerated automatically when I edit `configure.ac`.",
    "created_at": "2014-01-15T07:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197421",
    "user": "https://github.com/jdemeyer"
}
```

I disagree with `./sage -f configure` since I absolutely don't want `configure` to act like a spkg. I prefer `configure` to have as few dependencies as possible. I much prefer to not depend on `sage-spkg` (and preferably also not on `build/install` nor `sage-env`, but that's harder for now).

Also, what was wrong with bootstrapping from the top-level `Makefile`? Doesn't the `missing` script work properly? I like the fact that `configure` gets regenerated automatically when I edit `configure.ac`.



---

archive/issue_comments_197422.json:
```json
{
    "body": "Replying to [comment:92 vbraun]:\n> How is that supposed to change anything? The `aclocal.m4' is not in the confball, so you need aclocal to generate it.\nOK, I forgot to add that file, no big deal.",
    "created_at": "2014-01-15T07:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197422",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:92 vbraun]:
> How is that supposed to change anything? The `aclocal.m4' is not in the confball, so you need aclocal to generate it.
OK, I forgot to add that file, no big deal.



---

archive/issue_comments_197423.json:
```json
{
    "body": "Hmm, it seems that `missing` has changed functionality. Now it doesn't really do anything, except for printing a more verbose error message. Old versions of `missing` did indeed touch the files.",
    "created_at": "2014-01-15T08:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197423",
    "user": "https://github.com/jdemeyer"
}
```

Hmm, it seems that `missing` has changed functionality. Now it doesn't really do anything, except for printing a more verbose error message. Old versions of `missing` did indeed touch the files.



---

archive/issue_comments_197424.json:
```json
{
    "body": "Volker, this patch simply stops using the `missing` script while keeping the rest of the bootstrap process.\n----\nNew commits:",
    "created_at": "2014-01-15T13:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197424",
    "user": "https://github.com/jdemeyer"
}
```

Volker, this patch simply stops using the `missing` script while keeping the rest of the bootstrap process.
----
New commits:



---

archive/issue_comments_197425.json:
```json
{
    "body": "bootstrap shouldn't call make to do its business, usually it would run automake to generate the makefile. But we can also disentangle that later if you prefer.\n\nAFAIK we do guarantee that \"sage -f\" works even before building Sage, so that you can install replacements for certain optional build-time dependencies (e.g. ccache). Not using that mechanism means that \"make download\" won't work, for example. Not to mention that it duplicates the sagemath upstream url, doesn't verify the checksum, etc. I don't necessarily care so much about using it, just wanted to make sure that you thought about the potential downsides of downloading the confball manually.",
    "created_at": "2014-01-15T14:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197425",
    "user": "https://github.com/vbraun"
}
```

bootstrap shouldn't call make to do its business, usually it would run automake to generate the makefile. But we can also disentangle that later if you prefer.

AFAIK we do guarantee that "sage -f" works even before building Sage, so that you can install replacements for certain optional build-time dependencies (e.g. ccache). Not using that mechanism means that "make download" won't work, for example. Not to mention that it duplicates the sagemath upstream url, doesn't verify the checksum, etc. I don't necessarily care so much about using it, just wanted to make sure that you thought about the potential downsides of downloading the confball manually.



---

archive/issue_comments_197426.json:
```json
{
    "body": "PS: I agree that missing changed and should be treated as implementation details for the autotools, i.e., do not call directly.",
    "created_at": "2014-01-15T14:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197426",
    "user": "https://github.com/vbraun"
}
```

PS: I agree that missing changed and should be treated as implementation details for the autotools, i.e., do not call directly.



---

archive/issue_comments_197427.json:
```json
{
    "body": "Replying to [comment:102 vbraun]:\n> AFAIK we do guarantee that \"sage -f\" works even before building Sage, so that you can install replacements for certain optional build-time dependencies (e.g. ccache). Not using that mechanism means that \"make download\" won't work, for example. Not to mention that it duplicates the sagemath upstream url, doesn't verify the checksum, etc. I don't necessarily care so much about using it, just wanted to make sure that you thought about the potential downsides of downloading the confball manually. \nI was thinking of moving towards a more typical \"configure + make\" model. Then `./sage -f` should be guaranteed to work only *after* `./configure` but before `make`. What we actually want for optional packages would be something like\n\n```\n$ ./configure --enable-ccache --enable-build-gcc --enable-mirror=http://example.com/ --optional-packages=database_gap\n$ make\n```\n",
    "created_at": "2014-01-15T14:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197427",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:102 vbraun]:
> AFAIK we do guarantee that "sage -f" works even before building Sage, so that you can install replacements for certain optional build-time dependencies (e.g. ccache). Not using that mechanism means that "make download" won't work, for example. Not to mention that it duplicates the sagemath upstream url, doesn't verify the checksum, etc. I don't necessarily care so much about using it, just wanted to make sure that you thought about the potential downsides of downloading the confball manually. 
I was thinking of moving towards a more typical "configure + make" model. Then `./sage -f` should be guaranteed to work only *after* `./configure` but before `make`. What we actually want for optional packages would be something like

```
$ ./configure --enable-ccache --enable-build-gcc --enable-mirror=http://example.com/ --optional-packages=database_gap
$ make
```




---

archive/issue_comments_197428.json:
```json
{
    "body": "Replying to [comment:102 vbraun]:\n> bootstrap shouldn't call make to do its business, usually it would run automake to generate the makefile. But we can also disentangle that later if you prefer.\nPerhaps you are right. But I would indeed prefer to do that later, especially since #15606 changes the bootstrap process also.",
    "created_at": "2014-01-15T14:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197428",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:102 vbraun]:
> bootstrap shouldn't call make to do its business, usually it would run automake to generate the makefile. But we can also disentangle that later if you prefer.
Perhaps you are right. But I would indeed prefer to do that later, especially since #15606 changes the bootstrap process also.



---

archive/issue_comments_197429.json:
```json
{
    "body": "Replying to [comment:104 jdemeyer]:\n> {{{\n> $ ./configure --enable-ccache --enable-build-gcc --enable-mirror=http://example.com/ --optional-packages=database_gap\n> }}}\n\nSounds good to me, but does not have to prevent `sage -f` from working (with sane defaults) before configure is run. If you want to change the mirror url then you just have to have your own set of autotools.",
    "created_at": "2014-01-15T15:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197429",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:104 jdemeyer]:
> {{{
> $ ./configure --enable-ccache --enable-build-gcc --enable-mirror=http://example.com/ --optional-packages=database_gap
> }}}

Sounds good to me, but does not have to prevent `sage -f` from working (with sane defaults) before configure is run. If you want to change the mirror url then you just have to have your own set of autotools.



---

archive/issue_comments_197430.json:
```json
{
    "body": "Replying to [comment:106 vbraun]:\n> Sounds good to me, but does not have to prevent `sage -f` from working (with sane defaults) before configure is run.\nI'd say: let's see how things evolve. I will not actively prevent `sage -f` from working.",
    "created_at": "2014-01-15T20:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197430",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:106 vbraun]:
> Sounds good to me, but does not have to prevent `sage -f` from working (with sane defaults) before configure is run.
I'd say: let's see how things evolve. I will not actively prevent `sage -f` from working.



---

archive/issue_comments_197431.json:
```json
{
    "body": "fine with me...",
    "created_at": "2014-01-15T20:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197431",
    "user": "https://github.com/vbraun"
}
```

fine with me...



---

archive/issue_comments_197432.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-15T20:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197432",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_197433.json:
```json
{
    "body": "Another side effect of treating the confball different:\n\n```\nvbraun@boxen:~/Sage/git$ git clone ...\nvbraun@boxen:~/Sage/git$ ./sage -sdist\nSage version 6.1.beta5, release date 2014-01-15\nError: configure tarball '/home/vbraun/Sage/git/upstream/configure-3.tar.gz' does not exist.\n```\n",
    "created_at": "2014-01-16T04:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197433",
    "user": "https://github.com/vbraun"
}
```

Another side effect of treating the confball different:

```
vbraun@boxen:~/Sage/git$ git clone ...
vbraun@boxen:~/Sage/git$ ./sage -sdist
Sage version 6.1.beta5, release date 2014-01-15
Error: configure tarball '/home/vbraun/Sage/git/upstream/configure-3.tar.gz' does not exist.
```




---

archive/issue_comments_197434.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-16T05:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15343#issuecomment-197434",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_014997.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-16T05:10:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15343",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15343#event-14997"
}
```
