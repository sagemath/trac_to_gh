# Issue 28791: bugs for binary quadratic forms whose discriminant is a square

Issue created by migration from https://trac.sagemath.org/ticket/29028

Original creator: @DaveWitteMorris

Original creation time: 2020-01-16 18:54:35

CC:  sbrandhorst

Keywords: binary quadratic form

Ticket #28989 fixes bugs for quadratic forms whose discriminant is positive, but not a square. This ticket addresses the remaining case where the discriminant is a square. Symptoms of the bugs include:

Two forms may be properly equivalent, but not equivalent, and equivalence is not reflexive:

```
sage: Q = BinaryQF(0, 2, 0)
sage: Q.discriminant()
4
sage: Q.is_equivalent(Q, proper=True)
True
sage: Q.is_equivalent(Q, proper=False)
False
```


The forms `-4*x^2 + 10*x*y`, `-2*x^2 + 10*x*y`, ` 10*x*y`, `2*x^2 + 10*x*y`, `4*x^2 + 10*x*y`, and `5*x^2 + 10*x*y` are not primitive (i.e., the gcd of the coefficients is not 1), but they appear in a list of primitive forms:

```
sage: BinaryQF_reduced_representatives(10^2, primitive_only=True)
[-4*x^2 + 10*x*y,
 -3*x^2 + 10*x*y,
 -2*x^2 + 10*x*y,
 -x^2 + 10*x*y,
 10*x*y,
 x^2 + 10*x*y,
 2*x^2 + 10*x*y,
 3*x^2 + 10*x*y,
 4*x^2 + 10*x*y,
 5*x^2 + 10*x*y]
```


I will upload a PR soon.


---

Comment by @DaveWitteMorris created at 2020-01-16 19:03:47

New commits:


---

Comment by @DaveWitteMorris created at 2020-01-16 19:03:47

Changing status from new to needs_review.


---

Comment by git created at 2020-01-17 18:56:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-01-22 03:36:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2020-01-22 03:37:33

Merged in #28989 again, to fix a merge conflict caused by the latest changes there.


---

Comment by tscrim created at 2020-01-29 05:44:30

Two little changes:

```diff
         We check that the first part of :trac:`29028` is fixed::
+
             sage: Q = BinaryQF(0, 2, 0)
             sage: Q.discriminant()
             4
```


```diff
     Test another part of :trac:`29028`::
+
         sage: BinaryQF_reduced_representatives(10^2, proper=False, primitive_only=False)
```

as you need a blankline after the `::` line.


---

Comment by git created at 2020-01-29 21:17:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2020-01-29 21:18:50

Thanks for the corrections.


---

Comment by tscrim created at 2020-01-29 23:44:28

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-01-29 23:44:28

Thanks. LGTM.


---

Comment by vbraun created at 2020-01-31 23:49:36

Resolution: fixed
