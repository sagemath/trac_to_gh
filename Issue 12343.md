# Issue 12343: Make mpc a standard package

archive/issues_012343.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  jpflori @nexttime\n\nSince `gcc-4.6.2` has `mpc` as dependency and since `mpc` could be useful for the rest of Sage, it would be good to include mpc as standard package.  There already is an optional `mpc` package.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12515\n\n",
    "created_at": "2012-02-15T13:18:11Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Make mpc a standard package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12343",
    "user": "@jdemeyer"
}
```
Assignee: tbd

CC:  jpflori @nexttime

Since `gcc-4.6.2` has `mpc` as dependency and since `mpc` could be useful for the rest of Sage, it would be good to include mpc as standard package.  There already is an optional `mpc` package.

Issue created by migration from https://trac.sagemath.org/ticket/12515





---

archive/issue_comments_145357.json:
```json
{
    "body": "I've tested just the patch from #12223, the\u00a0[12515_mpc_standard](http://trac.sagemath.org/sage_trac/attachment/ticket/12515/12515_mpc_standard.patch)\u00a0patch and the install of\u00a0[mpc-0.9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpc-0.9.spkg)\u00a0on top of sage-5.0.beta4. I have one failure:\n\n\n```\nsage -t -long  -force_lib devel/sage-main/sage/rings/complex_mpc.pyx\n**********************************************************************\nFile \"/storage/sage/sage-5.0.beta4/devel/sage-main/sage/rings/complex_mpc.pyx\", line 559:\n    sage: MPComplexField(10).random_element()\nExpected:\n    0.12 + 0.23*I\nGot:\n    0.75 + 0.12*I\n**********************************************************************\n```\n\nThe relevant portions of the test from complex_mpc.pyx are:\n\n\n```\nsage: from sage.rings.complex_mpc import MPComplexField\nsage: MPComplexField(100).random_element(-5, 10)\nsage: MPComplexField(10).random_element()\n```\n\nwhich, from the sage prompt give results that are all over the place, although there is only the indicated failure when the test is repeatedly run individually. I'm not sure how one really knows what the \"expected\" result really is? Now this was on x86.",
    "created_at": "2012-02-16T01:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145357",
    "user": "@strogdon"
}
```

I've tested just the patch from #12223, the [12515_mpc_standard](http://trac.sagemath.org/sage_trac/attachment/ticket/12515/12515_mpc_standard.patch) patch and the install of [mpc-0.9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpc-0.9.spkg) on top of sage-5.0.beta4. I have one failure:


```
sage -t -long  -force_lib devel/sage-main/sage/rings/complex_mpc.pyx
**********************************************************************
File "/storage/sage/sage-5.0.beta4/devel/sage-main/sage/rings/complex_mpc.pyx", line 559:
    sage: MPComplexField(10).random_element()
Expected:
    0.12 + 0.23*I
Got:
    0.75 + 0.12*I
**********************************************************************
```

The relevant portions of the test from complex_mpc.pyx are:


```
sage: from sage.rings.complex_mpc import MPComplexField
sage: MPComplexField(100).random_element(-5, 10)
sage: MPComplexField(10).random_element()
```

which, from the sage prompt give results that are all over the place, although there is only the indicated failure when the test is repeatedly run individually. I'm not sure how one really knows what the "expected" result really is? Now this was on x86.



---

archive/issue_comments_145358.json:
```json
{
    "body": "Attachment [12515_mpc_sage_root.patch](tarball://root/attachments/some-uuid/ticket12515/12515_mpc_sage_root.patch) by @jdemeyer created at 2012-02-16 09:34:47",
    "created_at": "2012-02-16T09:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145358",
    "user": "@jdemeyer"
}
```

Attachment [12515_mpc_sage_root.patch](tarball://root/attachments/some-uuid/ticket12515/12515_mpc_sage_root.patch) by @jdemeyer created at 2012-02-16 09:34:47



---

archive/issue_comments_145359.json:
```json
{
    "body": "Attachment [12515_mpc_standard.patch](tarball://root/attachments/some-uuid/ticket12515/12515_mpc_standard.patch) by @jdemeyer created at 2012-02-16 09:37:58\n\nI marked those tests \"# random\" since they obviously are...",
    "created_at": "2012-02-16T09:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145359",
    "user": "@jdemeyer"
}
```

Attachment [12515_mpc_standard.patch](tarball://root/attachments/some-uuid/ticket12515/12515_mpc_standard.patch) by @jdemeyer created at 2012-02-16 09:37:58

I marked those tests "# random" since they obviously are...



---

archive/issue_comments_145360.json:
```json
{
    "body": "I just completed a build from scratch of 5.0.beta4 with mpc-0.9 just prior to the spkg upgrade. Argh ... So I patched the sage and sage_scripts spkgs before the build. SAGE_ROOT was then patched before the make. Everything from #10492 and #12223 and this ticket was included. Everything built (including mpc) and the tests passed. The new spkg (mpc-1.0.0dev1123) was installed with sage -f and all the tests under sage/rings passed - I only did these again. A positive review here, although I don't see that that's the next action?",
    "created_at": "2012-02-17T23:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145360",
    "user": "@strogdon"
}
```

I just completed a build from scratch of 5.0.beta4 with mpc-0.9 just prior to the spkg upgrade. Argh ... So I patched the sage and sage_scripts spkgs before the build. SAGE_ROOT was then patched before the make. Everything from #10492 and #12223 and this ticket was included. Everything built (including mpc) and the tests passed. The new spkg (mpc-1.0.0dev1123) was installed with sage -f and all the tests under sage/rings passed - I only did these again. A positive review here, although I don't see that that's the next action?



---

archive/issue_comments_145361.json:
```json
{
    "body": "There are still some portability problems that I'm discussing with upstream.  It doesn't build on Solaris with GCC (it does build with Sun's compiler).",
    "created_at": "2012-02-18T09:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145361",
    "user": "@jdemeyer"
}
```

There are still some portability problems that I'm discussing with upstream.  It doesn't build on Solaris with GCC (it does build with Sun's compiler).



---

archive/issue_comments_145362.json:
```json
{
    "body": "Attachment [12515_norm.patch](tarball://root/attachments/some-uuid/ticket12515/12515_norm.patch) by @jdemeyer created at 2012-02-20 12:37:55",
    "created_at": "2012-02-20T12:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145362",
    "user": "@jdemeyer"
}
```

Attachment [12515_norm.patch](tarball://root/attachments/some-uuid/ticket12515/12515_norm.patch) by @jdemeyer created at 2012-02-20 12:37:55



---

archive/issue_comments_145363.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-22T13:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145363",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_145364.json:
```json
{
    "body": "Issues seem to be fixed in the latest svn version, needs review.",
    "created_at": "2012-02-22T13:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145364",
    "user": "@jdemeyer"
}
```

Issues seem to be fixed in the latest svn version, needs review.



---

archive/issue_comments_145365.json:
```json
{
    "body": "A fresh build of 5.0.beta5 with the patches from this ticket and #10492. I have the failure\n\n\n```\n\nsage -t -long  -force_lib devel/sage-main/sage/geometry/fan.py\n**********************************************************************\nFile \"/storage/sage/sage-5.0.beta5/devel/sage-main/sage/geometry/fan.py\", line 2779:\n    sage: fan.complex().homology()\nExpected:\n    {0: 0, 1: 0, 2: Z x Z, 3: 0}\nGot:\n    {2: Z x Z, 3: 0}\n**********************************************************************\nFile \"/storage/sage/sage-5.0.beta5/devel/sage-main/sage/geometry/fan.py\", line 2783:\n    sage: fan.complex().homology()\nExpected:\n    {0: 0, 1: 0, 2: Z, 3: 0}\nGot:\n    {2: Z, 3: 0}\n**********************************************************************\n```\n\npresumably because of #11384. The results for\u00a0#11384\u00a0were positive, so I'm wondering if this ticket is interacting with it?",
    "created_at": "2012-02-23T23:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145365",
    "user": "@strogdon"
}
```

A fresh build of 5.0.beta5 with the patches from this ticket and #10492. I have the failure


```

sage -t -long  -force_lib devel/sage-main/sage/geometry/fan.py
**********************************************************************
File "/storage/sage/sage-5.0.beta5/devel/sage-main/sage/geometry/fan.py", line 2779:
    sage: fan.complex().homology()
Expected:
    {0: 0, 1: 0, 2: Z x Z, 3: 0}
Got:
    {2: Z x Z, 3: 0}
**********************************************************************
File "/storage/sage/sage-5.0.beta5/devel/sage-main/sage/geometry/fan.py", line 2783:
    sage: fan.complex().homology()
Expected:
    {0: 0, 1: 0, 2: Z, 3: 0}
Got:
    {2: Z, 3: 0}
**********************************************************************
```

presumably because of #11384. The results for #11384 were positive, so I'm wondering if this ticket is interacting with it?



---

archive/issue_comments_145366.json:
```json
{
    "body": "Replying to [comment:13 strogdon]:\n> The results for\u00a0#11384\u00a0were positive, so I'm wondering if this ticket is interacting with it?\nThat would be quite unlikely.  Try removing just the patch from this ticket and test `sage/geometry/fan.py` again.",
    "created_at": "2012-02-24T08:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145366",
    "user": "@jdemeyer"
}
```

Replying to [comment:13 strogdon]:
> The results for #11384 were positive, so I'm wondering if this ticket is interacting with it?
That would be quite unlikely.  Try removing just the patch from this ticket and test `sage/geometry/fan.py` again.



---

archive/issue_comments_145367.json:
```json
{
    "body": "#11805 can be closed as won't fix/duplicate once this gets merged.\n\nAlso we might think of using mpc for our default complex numbers representation, although that's a different question.",
    "created_at": "2012-02-24T10:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145367",
    "user": "jpflori"
}
```

#11805 can be closed as won't fix/duplicate once this gets merged.

Also we might think of using mpc for our default complex numbers representation, although that's a different question.



---

archive/issue_comments_145368.json:
```json
{
    "body": "About the CFLAGS, CC stuff you could add some logic as in the mpir package.\n\nThis would let the user break its system if he really wants to.\n\nYou could also add the \"SAGE... undefined on top of spkg-check.\n\nIf at some point we allow to run the testsuite without rebuilding the package, it would avoid another trivial new spkg update.\n\nNot sure why you removed the error message in spg-check.\n\nOk, MPC will already complain about failing, but it will also do so while building, configuring and so on, won't it?",
    "created_at": "2012-02-24T11:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145368",
    "user": "jpflori"
}
```

About the CFLAGS, CC stuff you could add some logic as in the mpir package.

This would let the user break its system if he really wants to.

You could also add the "SAGE... undefined on top of spkg-check.

If at some point we allow to run the testsuite without rebuilding the package, it would avoid another trivial new spkg update.

Not sure why you removed the error message in spg-check.

Ok, MPC will already complain about failing, but it will also do so while building, configuring and so on, won't it?



---

archive/issue_comments_145369.json:
```json
{
    "body": "Replying to [comment:16 jpflori]:\n> About the CFLAGS, CC stuff you could add some logic as in the mpir package.\nI see little need for this.  Since mpc will use the same flags as mpir by default, why copy all that logic to mpc?",
    "created_at": "2012-02-24T14:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145369",
    "user": "@jdemeyer"
}
```

Replying to [comment:16 jpflori]:
> About the CFLAGS, CC stuff you could add some logic as in the mpir package.
I see little need for this.  Since mpc will use the same flags as mpir by default, why copy all that logic to mpc?



---

archive/issue_comments_145370.json:
```json
{
    "body": "Diff for the mpc spkg (w.r.t. the latest optional mpc spkg), for review only",
    "created_at": "2012-02-24T14:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145370",
    "user": "@jdemeyer"
}
```

Diff for the mpc spkg (w.r.t. the latest optional mpc spkg), for review only



---

archive/issue_comments_145371.json:
```json
{
    "body": "Attachment [mpc-1.0.0dev1126.diff](tarball://root/attachments/some-uuid/ticket12515/mpc-1.0.0dev1126.diff) by @jdemeyer created at 2012-02-24 14:58:24\n\nReplying to [comment:16 jpflori]:\n> You could also add the \"SAGE... undefined on top of spkg-check.\nDone.\n\n> Not sure why you removed the error message in spg-check.\nI thought it was superfluous, but it doesn't hurt.  So I put it back.",
    "created_at": "2012-02-24T14:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145371",
    "user": "@jdemeyer"
}
```

Attachment [mpc-1.0.0dev1126.diff](tarball://root/attachments/some-uuid/ticket12515/mpc-1.0.0dev1126.diff) by @jdemeyer created at 2012-02-24 14:58:24

Replying to [comment:16 jpflori]:
> You could also add the "SAGE... undefined on top of spkg-check.
Done.

> Not sure why you removed the error message in spg-check.
I thought it was superfluous, but it doesn't hurt.  So I put it back.



---

archive/issue_comments_145372.json:
```json
{
    "body": "For the CC, CFLAGS stuff we could imagine that someone wants to test  MPC with different flags from mpir. You could argue that if that's the  case, it should be done outside Sage, or that the user is smart enough  to modify the spkg. Anyhow, I agree that this should not prevent  positive review.\n\nI cannot test the spkg on exotic architectures, i.e. mainly Solaris, so that I don't put it as positive review.\n\nOtherwise the package looks fine for me now, so  Jeroen, if you tested it on such architectures, you can go ahead and do it.",
    "created_at": "2012-02-24T15:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145372",
    "user": "jpflori"
}
```

For the CC, CFLAGS stuff we could imagine that someone wants to test  MPC with different flags from mpir. You could argue that if that's the  case, it should be done outside Sage, or that the user is smart enough  to modify the spkg. Anyhow, I agree that this should not prevent  positive review.

I cannot test the spkg on exotic architectures, i.e. mainly Solaris, so that I don't put it as positive review.

Otherwise the package looks fine for me now, so  Jeroen, if you tested it on such architectures, you can go ahead and do it.



---

archive/issue_comments_145373.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-24T15:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145373",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145374.json:
```json
{
    "body": "Replying to [comment:19 jpflori]:\n> I cannot test the spkg on exotic architectures, i.e. mainly Solaris, so that I don't put it as positive review.\n\nJean-Pierre, it is never a requirement to test spkgs on \"exotic architectures\" in order to give positive review to a ticket (unless the ticket is specifically about fixing something on such an architecture).  If there are problems with building a spkg, those will be discovered when the build is tested on the buildbots.  I think reviewing should be mostly about human eyes looking at the patch, as that part can't be automated.",
    "created_at": "2012-02-24T15:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145374",
    "user": "@jdemeyer"
}
```

Replying to [comment:19 jpflori]:
> I cannot test the spkg on exotic architectures, i.e. mainly Solaris, so that I don't put it as positive review.

Jean-Pierre, it is never a requirement to test spkgs on "exotic architectures" in order to give positive review to a ticket (unless the ticket is specifically about fixing something on such an architecture).  If there are problems with building a spkg, those will be discovered when the build is tested on the buildbots.  I think reviewing should be mostly about human eyes looking at the patch, as that part can't be automated.



---

archive/issue_comments_145375.json:
```json
{
    "body": "Replying to [comment:14 jdemeyer]:\n\n> Replying to [comment:13 strogdon]:\n> > The results for #11384 were positive, so I'm wondering if this ticket is interacting with it?\n> That would be quite unlikely.  Try removing just the patch from this ticket and test `sage/geometry/fan.py` again.\n\nSorry for the delay. I had other stuff applied on top of mpc (twisted, jmol, flask) and it wasn't convenient to remove things. I didn't think it was the patches, but perhaps the mpc spkg. A build of just 5.0.beta5 with nothing else still produces the failure. So that belongs somewhere, but not this ticket.",
    "created_at": "2012-02-24T20:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145375",
    "user": "@strogdon"
}
```

Replying to [comment:14 jdemeyer]:

> Replying to [comment:13 strogdon]:
> > The results for #11384 were positive, so I'm wondering if this ticket is interacting with it?
> That would be quite unlikely.  Try removing just the patch from this ticket and test `sage/geometry/fan.py` again.

Sorry for the delay. I had other stuff applied on top of mpc (twisted, jmol, flask) and it wasn't convenient to remove things. I didn't think it was the patches, but perhaps the mpc spkg. A build of just 5.0.beta5 with nothing else still produces the failure. So that belongs somewhere, but not this ticket.



---

archive/issue_comments_145376.json:
```json
{
    "body": "I tried to apply 12515_mpc_sage_root.patch to the root directory, but it failed.\n\nI started with sage-5.0.beta7 and have\n\n```\nsimon@linux-sqwp:~/SAGE/sage-5.0.beta7> hg qpush\nWende 12515_mpc_sage_root.patch an\nWende Patch auf Datei spkg/install an\nFEHLSCHLAG von Teilst\u00fcck #1 in Zeile 179\n1 von 1 Teilst\u00fccken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei spkg/install.rej\nPatch schlug fehl und Fortsetzung unm\u00f6glich (versuche -v)\nPatch schlug fehl, Fehlerabschnitte noch im Arbeitsverzeichnis\nFehler beim Anwenden. Bitte beheben und 12515_mpc_sage_root.patch aktualisieren\nsimon@linux-sqwp:~/SAGE/sage-5.0.beta7> hg qapplied \n12602_spkg_download.patch\n10492_deps_to_Makefile.patch\n12515_mpc_sage_root.patch\n```\n\nIndeed, the spkg/install file looks totally different to what is expected in the patch:\n\n```\n...\nMAXIMA=`$newest maxima`\nexport MAXIMA\n\nMERCURIAL=`$newest mercurial`\nexport MERCURIAL\n\nMPFI=`$newest mpfi`\nexport MPFI\n\nMOIN=`$newest moin`\nexport MOIN\n\nMPFR=`$newest mpfr`\nexport MPFR\n\nMPMATH=`$newest mpmath`\nexport MPMATH\n\nNETWORKX=`$newest networkx`\nexport NETWORKX\n\nNUMPY=`$newest numpy`\nexport NUMPY\n...\n```\n\n\nIs there a dependency that is not stated here?",
    "created_at": "2012-03-13T15:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145376",
    "user": "@simon-king-jena"
}
```

I tried to apply 12515_mpc_sage_root.patch to the root directory, but it failed.

I started with sage-5.0.beta7 and have

```
simon@linux-sqwp:~/SAGE/sage-5.0.beta7> hg qpush
Wende 12515_mpc_sage_root.patch an
Wende Patch auf Datei spkg/install an
FEHLSCHLAG von Teilstück #1 in Zeile 179
1 von 1 Teilstücken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei spkg/install.rej
Patch schlug fehl und Fortsetzung unmöglich (versuche -v)
Patch schlug fehl, Fehlerabschnitte noch im Arbeitsverzeichnis
Fehler beim Anwenden. Bitte beheben und 12515_mpc_sage_root.patch aktualisieren
simon@linux-sqwp:~/SAGE/sage-5.0.beta7> hg qapplied 
12602_spkg_download.patch
10492_deps_to_Makefile.patch
12515_mpc_sage_root.patch
```

Indeed, the spkg/install file looks totally different to what is expected in the patch:

```
...
MAXIMA=`$newest maxima`
export MAXIMA

MERCURIAL=`$newest mercurial`
export MERCURIAL

MPFI=`$newest mpfi`
export MPFI

MOIN=`$newest moin`
export MOIN

MPFR=`$newest mpfr`
export MPFR

MPMATH=`$newest mpmath`
export MPMATH

NETWORKX=`$newest networkx`
export NETWORKX

NUMPY=`$newest numpy`
export NUMPY
...
```


Is there a dependency that is not stated here?



---

archive/issue_comments_145377.json:
```json
{
    "body": "Oops!! Me stupid!! I had a totally wrong version of the patch from #10429 (namely the attachment, not the raw attachment.\n\nCheers,\nSimon",
    "created_at": "2012-03-13T15:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145377",
    "user": "@simon-king-jena"
}
```

Oops!! Me stupid!! I had a totally wrong version of the patch from #10429 (namely the attachment, not the raw attachment.

Cheers,
Simon



---

archive/issue_comments_145378.json:
```json
{
    "body": "This doesn't compile on rosemary (RHEL 5.6 x86_64).  I'm investigating further.",
    "created_at": "2012-03-22T16:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145378",
    "user": "@jdemeyer"
}
```

This doesn't compile on rosemary (RHEL 5.6 x86_64).  I'm investigating further.



---

archive/issue_comments_145379.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-03-22T16:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145379",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_145380.json:
```json
{
    "body": "I'm having problems on the skynet machines cleo and iras (ia64), also.  Using the full tarball from #12369, I'm getting failures with `SAGE_INSTALL_GCC=yes` and with it unset.",
    "created_at": "2012-03-22T22:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145380",
    "user": "@jhpalmieri"
}
```

I'm having problems on the skynet machines cleo and iras (ia64), also.  Using the full tarball from #12369, I'm getting failures with `SAGE_INSTALL_GCC=yes` and with it unset.



---

archive/issue_comments_145381.json:
```json
{
    "body": "I discovered that *removing* the flags `-std=c99 -pedantic` makes the problem disappear.  I cannot explain why though.",
    "created_at": "2012-03-23T07:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145381",
    "user": "@jdemeyer"
}
```

I discovered that *removing* the flags `-std=c99 -pedantic` makes the problem disappear.  I cannot explain why though.



---

archive/issue_comments_145382.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-23T08:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145382",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_145383.json:
```json
{
    "body": "New spkg removes the -std=c99 -pedantic compiler flags.  I really cannot explain why it solves the problem though, especially since it seems to be a link issue:\n\n```\n/bin/sh ../libtool --tag=CC   --mode=link gcc  -O2 -D_FORTIFY_SOURCE=2 -g -std=c99 -pedantic -Wno-long-long -Wall -Wextra -Wdeclaration-af\nter-statement -Wundef -Wshadow -Wstrict-prototypes -Wmissing-prototypes -Wno-unused-value  -version-info 2:0:0 -L/home/buildbot/build/sage\n/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib -L/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib  -o l\nibmpc.la -rpath /home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib abs.lo acos.lo acosh.lo add.lo add_fr.lo add\n_si.lo add_ui.lo arg.lo asin.lo asinh.lo atan.lo atanh.lo clear.lo cmp.lo cmp_si_si.lo conj.lo cos.lo cosh.lo div_2exp.lo div.lo div_fr.lo\n div_ui.lo exp.lo fma.lo fr_div.lo fr_sub.lo get_prec2.lo get_prec.lo get_version.lo get_x.lo imag.lo init2.lo init3.lo inp_str.lo log.lo\nmem.lo mul_2exp.lo mul.lo mul_fr.lo mul_i.lo mul_si.lo mul_ui.lo neg.lo norm.lo out_str.lo pow.lo pow_fr.lo pow_ld.lo pow_d.lo pow_si.lo p\now_ui.lo pow_z.lo proj.lo real.lo urandom.lo set.lo set_prec.lo set_str.lo set_x.lo set_x_x.lo sin.lo sin_cos.lo sinh.lo sqr.lo sqrt.lo st\nrtoc.lo sub.lo sub_fr.lo sub_ui.lo swap.lo tan.lo tanh.lo uceil_log2.lo ui_div.lo ui_ui_sub.lo  -lmpfr -lgmp -lm\nlibtool: link: gcc -shared  -fPIC -DPIC  .libs/abs.o .libs/acos.o .libs/acosh.o .libs/add.o .libs/add_fr.o .libs/add_si.o .libs/add_ui.o .\nlibs/arg.o .libs/asin.o .libs/asinh.o .libs/atan.o .libs/atanh.o .libs/clear.o .libs/cmp.o .libs/cmp_si_si.o .libs/conj.o .libs/cos.o .lib\ns/cosh.o .libs/div_2exp.o .libs/div.o .libs/div_fr.o .libs/div_ui.o .libs/exp.o .libs/fma.o .libs/fr_div.o .libs/fr_sub.o .libs/get_prec2.\no .libs/get_prec.o .libs/get_version.o .libs/get_x.o .libs/imag.o .libs/init2.o .libs/init3.o .libs/inp_str.o .libs/log.o .libs/mem.o .lib\ns/mul_2exp.o .libs/mul.o .libs/mul_fr.o .libs/mul_i.o .libs/mul_si.o .libs/mul_ui.o .libs/neg.o .libs/norm.o .libs/out_str.o .libs/pow.o .\nlibs/pow_fr.o .libs/pow_ld.o .libs/pow_d.o .libs/pow_si.o .libs/pow_ui.o .libs/pow_z.o .libs/proj.o .libs/real.o .libs/urandom.o .libs/set\n.o .libs/set_prec.o .libs/set_str.o .libs/set_x.o .libs/set_x_x.o .libs/sin.o .libs/sin_cos.o .libs/sinh.o .libs/sqr.o .libs/sqrt.o .libs/\nstrtoc.o .libs/sub.o .libs/sub_fr.o .libs/sub_ui.o .libs/swap.o .libs/tan.o .libs/tanh.o .libs/uceil_log2.o .libs/ui_div.o .libs/ui_ui_sub\n.o   -Wl,-rpath -Wl,/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib -Wl,-rpath -Wl,/home/buildbot/build/sage\n/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib -L/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib /home\n/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib/libmpfr.so /home/buildbot/build/sage/cleo-1/cleo_full/build/sage-\n5.0.beta8-gcc/local/lib/libgmp.so -lm  -O2   -Wl,-soname -Wl,libmpc.so.2 -o .libs/libmpc.so.2.0.0\n.libs/acos.o: In function `realpath':\n/usr/include/bits/stdlib.h:33: multiple definition of `realpath'\n.libs/abs.o:/usr/include/bits/stdlib.h:33: first defined here\n.libs/acos.o: In function `ptsname_r':\n/usr/include/bits/stdlib.h:49: multiple definition of `ptsname_r'\n.libs/abs.o:/usr/include/bits/stdlib.h:49: first defined here\n.libs/acos.o: In function `wctomb':\n/usr/include/bits/stdlib.h:64: multiple definition of `wctomb'\n.libs/abs.o:/usr/include/bits/stdlib.h:64: first defined here\n.libs/acos.o: In function `mbstowcs':\n/usr/include/bits/stdlib.h:89: multiple definition of `mbstowcs'\n.libs/abs.o:/usr/include/bits/stdlib.h:89: first defined here\n.libs/acos.o: In function `wcstombs':\n/usr/include/bits/stdlib.h:110: multiple definition of `wcstombs'\n.libs/abs.o:/usr/include/bits/stdlib.h:110: first defined here\n[...]\n```\n\nWhy does C99 code get linked differently from C89 code?",
    "created_at": "2012-03-23T08:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145383",
    "user": "@jdemeyer"
}
```

New spkg removes the -std=c99 -pedantic compiler flags.  I really cannot explain why it solves the problem though, especially since it seems to be a link issue:

```
/bin/sh ../libtool --tag=CC   --mode=link gcc  -O2 -D_FORTIFY_SOURCE=2 -g -std=c99 -pedantic -Wno-long-long -Wall -Wextra -Wdeclaration-af
ter-statement -Wundef -Wshadow -Wstrict-prototypes -Wmissing-prototypes -Wno-unused-value  -version-info 2:0:0 -L/home/buildbot/build/sage
/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib -L/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib  -o l
ibmpc.la -rpath /home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib abs.lo acos.lo acosh.lo add.lo add_fr.lo add
_si.lo add_ui.lo arg.lo asin.lo asinh.lo atan.lo atanh.lo clear.lo cmp.lo cmp_si_si.lo conj.lo cos.lo cosh.lo div_2exp.lo div.lo div_fr.lo
 div_ui.lo exp.lo fma.lo fr_div.lo fr_sub.lo get_prec2.lo get_prec.lo get_version.lo get_x.lo imag.lo init2.lo init3.lo inp_str.lo log.lo
mem.lo mul_2exp.lo mul.lo mul_fr.lo mul_i.lo mul_si.lo mul_ui.lo neg.lo norm.lo out_str.lo pow.lo pow_fr.lo pow_ld.lo pow_d.lo pow_si.lo p
ow_ui.lo pow_z.lo proj.lo real.lo urandom.lo set.lo set_prec.lo set_str.lo set_x.lo set_x_x.lo sin.lo sin_cos.lo sinh.lo sqr.lo sqrt.lo st
rtoc.lo sub.lo sub_fr.lo sub_ui.lo swap.lo tan.lo tanh.lo uceil_log2.lo ui_div.lo ui_ui_sub.lo  -lmpfr -lgmp -lm
libtool: link: gcc -shared  -fPIC -DPIC  .libs/abs.o .libs/acos.o .libs/acosh.o .libs/add.o .libs/add_fr.o .libs/add_si.o .libs/add_ui.o .
libs/arg.o .libs/asin.o .libs/asinh.o .libs/atan.o .libs/atanh.o .libs/clear.o .libs/cmp.o .libs/cmp_si_si.o .libs/conj.o .libs/cos.o .lib
s/cosh.o .libs/div_2exp.o .libs/div.o .libs/div_fr.o .libs/div_ui.o .libs/exp.o .libs/fma.o .libs/fr_div.o .libs/fr_sub.o .libs/get_prec2.
o .libs/get_prec.o .libs/get_version.o .libs/get_x.o .libs/imag.o .libs/init2.o .libs/init3.o .libs/inp_str.o .libs/log.o .libs/mem.o .lib
s/mul_2exp.o .libs/mul.o .libs/mul_fr.o .libs/mul_i.o .libs/mul_si.o .libs/mul_ui.o .libs/neg.o .libs/norm.o .libs/out_str.o .libs/pow.o .
libs/pow_fr.o .libs/pow_ld.o .libs/pow_d.o .libs/pow_si.o .libs/pow_ui.o .libs/pow_z.o .libs/proj.o .libs/real.o .libs/urandom.o .libs/set
.o .libs/set_prec.o .libs/set_str.o .libs/set_x.o .libs/set_x_x.o .libs/sin.o .libs/sin_cos.o .libs/sinh.o .libs/sqr.o .libs/sqrt.o .libs/
strtoc.o .libs/sub.o .libs/sub_fr.o .libs/sub_ui.o .libs/swap.o .libs/tan.o .libs/tanh.o .libs/uceil_log2.o .libs/ui_div.o .libs/ui_ui_sub
.o   -Wl,-rpath -Wl,/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib -Wl,-rpath -Wl,/home/buildbot/build/sage
/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib -L/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib /home
/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8-gcc/local/lib/libmpfr.so /home/buildbot/build/sage/cleo-1/cleo_full/build/sage-
5.0.beta8-gcc/local/lib/libgmp.so -lm  -O2   -Wl,-soname -Wl,libmpc.so.2 -o .libs/libmpc.so.2.0.0
.libs/acos.o: In function `realpath':
/usr/include/bits/stdlib.h:33: multiple definition of `realpath'
.libs/abs.o:/usr/include/bits/stdlib.h:33: first defined here
.libs/acos.o: In function `ptsname_r':
/usr/include/bits/stdlib.h:49: multiple definition of `ptsname_r'
.libs/abs.o:/usr/include/bits/stdlib.h:49: first defined here
.libs/acos.o: In function `wctomb':
/usr/include/bits/stdlib.h:64: multiple definition of `wctomb'
.libs/abs.o:/usr/include/bits/stdlib.h:64: first defined here
.libs/acos.o: In function `mbstowcs':
/usr/include/bits/stdlib.h:89: multiple definition of `mbstowcs'
.libs/abs.o:/usr/include/bits/stdlib.h:89: first defined here
.libs/acos.o: In function `wcstombs':
/usr/include/bits/stdlib.h:110: multiple definition of `wcstombs'
.libs/abs.o:/usr/include/bits/stdlib.h:110: first defined here
[...]
```

Why does C99 code get linked differently from C89 code?



---

archive/issue_comments_145384.json:
```json
{
    "body": "New spkg compiles successfully on iras and rosemary.",
    "created_at": "2012-03-23T08:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145384",
    "user": "@jdemeyer"
}
```

New spkg compiles successfully on iras and rosemary.



---

archive/issue_comments_145385.json:
```json
{
    "body": "New spkg compiles successfully on bsd.math (OS X 10.6) with\n\n```\ni686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)\nCopyright (C) 2007 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n```\n\nand also with\n\n```\nApple clang version 1.7 (tags/Apple/clang-77) (based on LLVM 2.9svn)\nTarget: x86_64-apple-darwin10\nThread model: posix\n```\n",
    "created_at": "2012-03-23T10:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145385",
    "user": "@jdemeyer"
}
```

New spkg compiles successfully on bsd.math (OS X 10.6) with

```
i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666) (dot 3)
Copyright (C) 2007 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
```

and also with

```
Apple clang version 1.7 (tags/Apple/clang-77) (based on LLVM 2.9svn)
Target: x86_64-apple-darwin10
Thread model: posix
```




---

archive/issue_comments_145386.json:
```json
{
    "body": "The problem is really due to -D_FORTIFY_SOURCE=2.  Removed that flag instead.",
    "created_at": "2012-03-23T12:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145386",
    "user": "@jdemeyer"
}
```

The problem is really due to -D_FORTIFY_SOURCE=2.  Removed that flag instead.



---

archive/issue_comments_145387.json:
```json
{
    "body": "Diff for mpc-1.0.0dev1126.p1.spkg, for review only",
    "created_at": "2012-03-23T12:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145387",
    "user": "@jdemeyer"
}
```

Diff for mpc-1.0.0dev1126.p1.spkg, for review only



---

archive/issue_comments_145388.json:
```json
{
    "body": "Attachment [mpc-1.0.0dev1126.p1.diff](tarball://root/attachments/some-uuid/ticket12515/mpc-1.0.0dev1126.p1.diff) by @jdemeyer created at 2012-03-23 13:27:30",
    "created_at": "2012-03-23T13:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145388",
    "user": "@jdemeyer"
}
```

Attachment [mpc-1.0.0dev1126.p1.diff](tarball://root/attachments/some-uuid/ticket12515/mpc-1.0.0dev1126.p1.diff) by @jdemeyer created at 2012-03-23 13:27:30



---

archive/issue_comments_145389.json:
```json
{
    "body": "Looks good!",
    "created_at": "2012-03-27T11:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145389",
    "user": "@vbraun"
}
```

Looks good!



---

archive/issue_comments_145390.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-27T11:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145390",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145391.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-04T19:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12343#issuecomment-145391",
    "user": "@jdemeyer"
}
```

Resolution: fixed
