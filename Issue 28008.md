# Issue 28008: Implement center of a HyperplaneArrangement

Issue created by migration from https://trac.sagemath.org/ticket/28245

Original creator: nailuj

Original creation time: 2019-07-24 11:53:34

CC:  jipilab

Keywords: HyperplaneArrangements,days100

This ticket implements the following changes to the class `HyperplaneArrangementElement`:

* In the method `is_central`, add the argument `certificate=False`. If set to `True`, this will additionally return the center of the arrangement. The center is easily obtainable as a byproduct of the existing calculation. 
* Add the method `center()`. This will return the center of the arrangement as computed by `is_central(certificate=True)`.


---

Comment by git created at 2019-07-24 12:41:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-07-24 12:57:33

Here are few schönheitssachen:

 - space after comma in the definition (pep8 conventions...)

 - swap `(default: False)` and `boolean` in the docstring

 - I would use the verb return instead of include

 - `is_central` needs the appropriate doctests checking all possibilities.

 - `center` needs an example when the hyperplane arrangement is not central.

I would suggest to use the Polyhedra parents and then return `.universe()` and `.empty()` which are less costly to execute in principle.


---

Comment by git created at 2019-07-24 13:52:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nailuj created at 2019-07-24 13:55:10

Replying to [comment:3 jipilab]:
> Here are few schönheitssachen:
> 
>  - space after comma in the definition (pep8 conventions...)
Done.

>  - swap `(default: False)` and `boolean` in the docstring
Done.

>  - I would use the verb return instead of include
Done.
 
>  - `is_central` needs the appropriate doctests checking all possibilities.
Done.

>  - `center` needs an example when the hyperplane arrangement is not central.
Done.
 
> I would suggest to use the Polyhedra parents and then return `.universe()` and `.empty()` which are less costly to execute in principle.
Done.


---

Comment by nailuj created at 2019-07-24 13:55:10

Changing status from new to needs_review.


---

Comment by jipilab created at 2019-07-24 16:22:58

No need of a bullet list for one element:


```diff
-        If ``certificate`` is False:
-
-        - A boolean
+        If ``certificate`` is ``False``, returns a boolean
```


 - Missing empty lines before the doctests (in both functions).

 - I would shorten the output of `center` to simply say that it is a polyhedron. If you want to be explicit, I would do it in the longer description before input/output.


---

Comment by jipilab created at 2019-07-24 16:22:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-07-25 15:26:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nailuj created at 2019-07-25 15:30:09

Changing status from needs_work to needs_review.


---

Comment by nailuj created at 2019-07-25 15:30:09

Replying to [comment:6 jipilab]:
> No need of a bullet list for one element:
> 
> {{{
> #!diff
> -        If ``certificate`` is False:
> -
> -        - A boolean
> +        If ``certificate`` is ``False``, returns a boolean
> }}}
Rephrased.

>  - Missing empty lines before the doctests (in both functions).
Inserted.

>  - I would shorten the output of `center` to simply say that it is a polyhedron. If you want to be explicit, I would do it in the longer description before input/output.
Moved.


---

Comment by jipilab created at 2019-07-28 12:06:34

I noted another small thing:


```
+        If ``certificate`` is True, returns a tuple containing:
+
+        1. A boolean
+        2. The polyhedron defined to be the intersection of all the hyperplanes
+
+        If ``certificate`` is False, returns a boolean.
```


True and False should be between two back ticks... Otherwise, looks good. Just waiting that bots go over it again...


---

Comment by jipilab created at 2019-07-28 12:06:47

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-08-05 12:05:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nailuj created at 2019-08-05 12:06:19

Replying to [comment:9 jipilab]:
> I noted another small thing:
> 
> {{{
> +        If ``certificate`` is True, returns a tuple containing:
> +
> +        1. A boolean
> +        2. The polyhedron defined to be the intersection of all the hyperplanes
> +
> +        If ``certificate`` is False, returns a boolean.
> }}}
> 
> True and False should be between two back ticks...
Done.


---

Comment by nailuj created at 2019-08-05 12:06:19

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2019-08-09 20:31:14

A little doc change:

```diff
         - ``certificate`` -- boolean (default: ``False``); specifies whether
-        to return the center as a polyhedron (possibly empty) as part of the 
-        output.
           to return the center as a polyhedron (possibly empty) as part
           of the output
```

(Note also the lack of a period/full-stop and the removal of the trailing whitespace.)

Also, because of the ``@`cached_method`, there is no reason to do the computation twice. Constructing the certificate seems quite cheap to me, so I might instead put as the first lines:

```
if not certificate:
    return self.is_central(True)[0]
```

and then assume `certificate=True` for the rest. However, this really depends on how expensive that `right_kernel` is and how often you think the certificate will be requested. There is a balance to be had here and a judgement call to be made. I am just saying this is an alternative way to avoid doing the main computation twice should you ask for with a certificate and without.


---

Comment by chapoton created at 2019-08-22 18:49:02

doc does not build

```
HyperplaneArrangementElement.is_central:9:
WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

Comment by chapoton created at 2019-08-24 19:31:45

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-08-26 14:44:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nailuj created at 2019-08-26 15:12:09

Changing status from needs_work to needs_review.


---

Comment by nailuj created at 2019-08-26 15:12:09

Replying to [comment:14 tscrim]:
> A little doc change:
> {{{#!diff
>          - ``certificate`` -- boolean (default: ``False``); specifies whether
> -        to return the center as a polyhedron (possibly empty) as part of the 
> -        output.
>            to return the center as a polyhedron (possibly empty) as part
>            of the output
> }}}
> (Note also the lack of a period/full-stop and the removal of the trailing whitespace.)
Thanks, I was not careful enough with these conventions.


> Also, because of the ``@`cached_method`, there is no reason to do the computation twice. Constructing the certificate seems quite cheap to me, so I might instead put as the first lines:
> {{{
> if not certificate:
>     return self.is_central(True)[0]
> }}}
> and then assume `certificate=True` for the rest. However, this really depends on how expensive that `right_kernel` is and how often you think the certificate will be requested. There is a balance to be had here and a judgement call to be made. I am just saying this is an alternative way to avoid doing the main computation twice should you ask for with a certificate and without.
Thank you for sharing these thoughts. If both methods had been new, I probably would have done the `right_kernel` calculation and just decided to return it or not depending on the `certificate` switch. But as `is_central` was already implemented, I considered not slowing down the existing method more important than obtaining a faster computation of the new method `center`. Is this a good approach to deciding such issues?


---

Comment by jipilab created at 2019-09-09 14:10:11

Replying to [comment:18 nailuj]:
> Replying to [comment:14 tscrim]:
> > A little doc change:
> > {{{#!diff
> >          - ``certificate`` -- boolean (default: ``False``); specifies whether
> > -        to return the center as a polyhedron (possibly empty) as part of the 
> > -        output.
> >            to return the center as a polyhedron (possibly empty) as part
> >            of the output
> > }}}
> > (Note also the lack of a period/full-stop and the removal of the trailing whitespace.)
> Thanks, I was not careful enough with these conventions.
> 
> 
> > Also, because of the ``@`cached_method`, there is no reason to do the computation twice. Constructing the certificate seems quite cheap to me, so I might instead put as the first lines:
> > {{{
> > if not certificate:
> >     return self.is_central(True)[0]
> > }}}
> > and then assume `certificate=True` for the rest. However, this really depends on how expensive that `right_kernel` is and how often you think the certificate will be requested. There is a balance to be had here and a judgement call to be made. I am just saying this is an alternative way to avoid doing the main computation twice should you ask for with a certificate and without.
> Thank you for sharing these thoughts. If both methods had been new, I probably would have done the `right_kernel` calculation and just decided to return it or not depending on the `certificate` switch. But as `is_central` was already implemented, I considered not slowing down the existing method more important than obtaining a faster computation of the new method `center`. Is this a good approach to deciding such issues?

It sounds reasonable, yes. Though I actually like Travis's idea of not having to recompute the function, however it was called first. Is it hard to switch to this?


---

Comment by nailuj created at 2019-09-11 12:24:08

Replying to [comment:19 jipilab]:
> Replying to [comment:18 nailuj]:
> > Replying to [comment:14 tscrim]:
> > 
> > > Also, because of the ``@`cached_method`, there is no reason to do the computation twice. Constructing the certificate seems quite cheap to me, so I might instead put as the first lines:
> > > {{{
> > > if not certificate:
> > >     return self.is_central(True)[0]
> > > }}}
> > > and then assume `certificate=True` for the rest. However, this really depends on how expensive that `right_kernel` is and how often you think the certificate will be requested. There is a balance to be had here and a judgement call to be made. I am just saying this is an alternative way to avoid doing the main computation twice should you ask for with a certificate and without.
> > Thank you for sharing these thoughts. If both methods had been new, I probably would have done the `right_kernel` calculation and just decided to return it or not depending on the `certificate` switch. But as `is_central` was already implemented, I considered not slowing down the existing method more important than obtaining a faster computation of the new method `center`. Is this a good approach to deciding such issues?
> 
> It sounds reasonable, yes. Though I actually like Travis's idea of not having to recompute the function, however it was called first. Is it hard to switch to this?

As Travis wrote, there are two lines to be inserted and some lines to be deleted, that would be all. If you think the additional computation time for the `right_kernel` and the construction of the `Polyhedron` aren't slowing down `is_central` too much, I could do it.


---

Comment by jipilab created at 2019-09-12 06:44:30

Replying to [comment:20 nailuj]:
> Replying to [comment:19 jipilab]:
> > Replying to [comment:18 nailuj]:
> > > Replying to [comment:14 tscrim]:
> > > 
> > > > Also, because of the ``@`cached_method`, there is no reason to do the computation twice. Constructing the certificate seems quite cheap to me, so I might instead put as the first lines:
> > > > {{{
> > > > if not certificate:
> > > >     return self.is_central(True)[0]
> > > > }}}
> > > > and then assume `certificate=True` for the rest. However, this really depends on how expensive that `right_kernel` is and how often you think the certificate will be requested. There is a balance to be had here and a judgement call to be made. I am just saying this is an alternative way to avoid doing the main computation twice should you ask for with a certificate and without.
> > > Thank you for sharing these thoughts. If both methods had been new, I probably would have done the `right_kernel` calculation and just decided to return it or not depending on the `certificate` switch. But as `is_central` was already implemented, I considered not slowing down the existing method more important than obtaining a faster computation of the new method `center`. Is this a good approach to deciding such issues?
> > 
> > It sounds reasonable, yes. Though I actually like Travis's idea of not having to recompute the function, however it was called first. Is it hard to switch to this?
> 
> As Travis wrote, there are two lines to be inserted and some lines to be deleted, that would be all. If you think the additional computation time for the `right_kernel` and the construction of the `Polyhedron` aren't slowing down `is_central` too much, I could do it.

I would say it is fine yes. 

Unless you find an example where you have tons of hyperplanes (10 000+) I don't think it will take too much time. Just for the record, if speed is really important, you could benchmark the before and after for some relatively big example just to have an idea...


---

Comment by jipilab created at 2019-10-25 07:24:34

Hi Julian,

Are you going to do the suggested changes? It looks ok to me either way.

J-P


---

Comment by jipilab created at 2019-10-25 07:24:34

Changing status from needs_review to needs_info.


---

Comment by nailuj created at 2019-11-01 16:48:03

Replying to [comment:22 jipilab]:
> Hi Julian,
> 
> Are you going to do the suggested changes? It looks ok to me either way.
> 
> J-P

Hi, I forgot about implementing the suggested changes. If you ask me like that, I would prefer the way it is written right now.


---

Comment by jipilab created at 2019-11-01 16:59:10

Ok, sounds good.

I'm setting it to "needs review" to get another round of bots testing it, just for sanity reasons.


---

Comment by jipilab created at 2019-11-01 16:59:10

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2019-11-01 21:52:23

(Morally) Green patchbots.


---

Comment by jipilab created at 2019-11-02 21:27:06

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2019-11-02 21:27:06

Ok, may it be.


---

Comment by vbraun created at 2019-11-07 23:29:53

Resolution: fixed
