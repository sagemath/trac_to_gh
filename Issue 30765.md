# Issue 30765: Specify bdist temp folder for WSL compatibility

Issue created by migration from https://trac.sagemath.org/ticket/31002

Original creator: @tobiasdiez

Original creation time: 2020-12-04 10:46:26

CC:  mkoeppe

On WSL, `bdist_wheel` sometimes encounters strange permission errors (when the source folder is a Windows folder mounted in WSL), see https://github.com/pypa/packaging-problems/issues/258. In the linked issue, a solution is described by changing the permissions for authenticated users, but it didn't worked for me. Thus I've implemented the workaround mentioned in https://github.com/pypa/packaging-problems/issues/258#issuecomment-548148041 and specified an explicit bdist directory in the Linux system.


---

Comment by @tobiasdiez created at 2020-12-04 10:46:35

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-12-04 18:16:18

Thanks for tracking down this problem. 

I don't think using `~/temp/` is a good idea, though.
I think a better solution would be to use the command `mktemp -d` to create a directory in the system directory for temporary files.


---

Comment by git created at 2020-12-05 13:56:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2020-12-05 13:58:49

ok done


---

Comment by mkoeppe created at 2020-12-05 17:51:09

The temporary directory should probably be removed afterwards...

Probably best to create a new function `sdh_setup_bdist_wheel` in `build/bin/sage-dist-helpers` for that


---

Comment by @tobiasdiez created at 2020-12-05 19:32:03

Unless `--keep-temp` is specified, the bdist directory is cleaned up anyway. https://setuptools.readthedocs.io/en/latest/userguide/commands.html#bdist-egg-create-a-python-egg-for-the-project


---

Comment by mkoeppe created at 2020-12-05 19:40:20

But the directory is not removed as far as I can see


---

Comment by @tobiasdiez created at 2020-12-05 20:18:55

Replying to [comment:7 mkoeppe]:
> But the directory is not removed as far as I can see

Probably. If you think this is a problem, I would like to ask you to implement your suggestion with the `sage-dist-helpers`. My shell knowledge is sadly not good enough for this.


---

Comment by mkoeppe created at 2020-12-05 20:44:43

OK, will do


---

Comment by mkoeppe created at 2020-12-05 20:44:43

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-12-05 21:09:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-05 21:10:07

Replying to [comment:7 mkoeppe]:
> But the directory is not removed as far as I can see

Actually I was wrong about this


---

Comment by mkoeppe created at 2020-12-05 21:11:16

Replying to [comment:8 gh-tobiasdiez]:
> I would like to ask you to implement your suggestion with the `sage-dist-helpers`.

Nevertheless I have implemented this function. Better to have it in one place.

I have only changed it in the pillow install script, where it seems to work.

Could you change the other ones?


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by git created at 2020-12-07 04:29:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-07 04:30:16

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-12-07 04:30:16

Changed the remaining ones.


---

Comment by @tobiasdiez created at 2020-12-07 12:08:15

Thanks! LGTM


---

Comment by @tobiasdiez created at 2020-12-07 12:08:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-12-13 20:31:20

Resolution: fixed
