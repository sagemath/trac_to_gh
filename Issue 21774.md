# Issue 21774: Upgrade to newest giac using official tarball

Issue created by migration from https://trac.sagemath.org/ticket/22011

Original creator: rws

Original creation time: 2016-12-02 15:51:55

CC:  frederichan parisse

This ticket should prepare Giac for the status of standard package, where it's required to use tarballs from the official site under http://www-fourier.ujf-grenoble.fr/~parisse/debian/dists/stable/main/source/

Up to now patches to the tarballs were added and a new tarball created. These patches will now be added by the usual mechanism, i.e. under `build/pkg/giac/patches`.


---

Comment by rws created at 2016-12-04 06:38:31

Changing status from new to needs_review.


---

Comment by rws created at 2016-12-04 06:39:23

New commits:


---

Comment by frederichan created at 2016-12-04 18:41:06

What about all the

```
# optional - giac
```

in the doctests, should they be removed for a standard package?


---

Comment by git created at 2016-12-05 09:17:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-12-05 09:18:17

Right. Anything missing?


---

Comment by frederichan created at 2016-12-05 09:37:24

there are also some doctets in

```

src/sage/matrix/matrix1.pyx:            sage: giac(M)                              # optional - giac
src/sage/matrix/matrix1.pyx:            sage: giac(M)                                      # optional - giac
src/sage/matrix/matrix1.pyx:            sage: giac(M)                             # optional - giac
src/sage/modules/free_module_element.pyx:            sage: v = vector(ZZ, 4, range(4))              # optional - giac
src/sage/modules/free_module_element.pyx:            sage: giac(v)+v                                # optional -  giac
src/sage/modules/free_module_element.pyx:            sage: v = vector(QQ, 3, [2/3, 0, 5/4])         # optional -  giac
src/sage/modules/free_module_element.pyx:            sage: giac(v)                                  # optional -  giac
src/sage/modules/free_module_element.pyx:            sage: P.<x> = ZZ[]                                       # optional -  giac
src/sage/modules/free_module_element.pyx:            sage: v = vector(P, 3, [x^2 + 2, 2*x + 1, -2*x^2 + 4*x]) # optional -  giac
src/sage/modules/free_module_element.pyx:            sage: giac(v)                                            # optional -  giac
```



---

Comment by frederichan created at 2016-12-05 12:29:06

Also, you have removed some 

```
# random
```

they should be kept because of the output may vary


---

Comment by git created at 2016-12-05 14:15:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Attachment


---

Comment by frederichan created at 2016-12-06 10:19:40

So because of the removed 
`# random`
on linux there is one doctest to fix and  add again random at cputime example.

I had tested also on osx 10.12 just after an update from 10.7. The built of giac was broken at the end when trying make intl.


```
[giac-1.2.2.103] gcc -c -DLOCALEDIR=\"/Users/frederichan/dev/sage/local/share/locale\" -DLOCALE_ALIAS_PATH=\"/Users/frederichan/dev/sage/local/share/locale\" -DLIBDIR=\"/Users/frederichan/dev/sage/local/lib\" -DIN_LIBINTL -DENABLE_RELOCATABLE=1 -DIN_LIBRARY -DINSTALLDIR=\"/Users/frederichan/dev/sage/local/lib\" -DNO_XMALLOC -Dset_relocation_prefix=libintl_set_relocation_prefix -Drelocate=libintl_relocate -DDEPENDS_ON_LIBICONV=1 -DHAVE_CONFIG_H -I. -I. -I.. -I/System/Library/Frameworks/CoreFoundation.framework/Headers -g -O2  langprefs.c
[giac-1.2.2.103] In file included from /usr/include/Availability.h:180:0,
[giac-1.2.2.103]                  from /usr/include/stdlib.h:61,
[giac-1.2.2.103]                  from langprefs.c:25:
[giac-1.2.2.103] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:39: error: 'introduced' undeclared here (not in a function)
[giac-1.2.2.103]  const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
[giac-1.2.2.103]                                        ^
[giac-1.2.2.103] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:39: error: 'deprecated' undeclared here (not in a function)
[giac-1.2.2.103]  const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
[giac-1.2.2.103]                                        ^
[giac-1.2.2.103] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:39: error: 'message' undeclared here (not in a function)
[giac-1.2.2.103]  const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
[giac-1.2.2.103]                                        ^
[giac-1.2.2.103] make[5]: *** [langprefs.o] Error 1
[giac-1.2.2.103] make[4]: *** [all-recursive] Error 1
[giac-1.2.2.103] make[3]: *** [all] Error 2
```

but configuring the giac spkg with --disable-nls was successfull on osx 10.12 so I suggest the following diff:
https://trac.sagemath.org/attachment/ticket/22011/giacspkg.diff


---

Comment by git created at 2016-12-06 16:28:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-06 16:31:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-12-07 10:32:07

On fedora 25 amd64 I was able to build sage with

```
export MAKE='make -j3'
make
```

At the end giac was also built. I could run

```
make ptestlong
}}}  
then I could run
{{{
env SAGE_CHECK=yes make giacpy
}}}
On osx 10.12 I could built sage with make but something was missing psutil:
{{{
[sagelib-7.5.beta5] sys	0m1.710s
cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html ' logs/dochtml.log
[dochtml] /Users/frederichan/dev/sage/local/bin/python: No module named psutil; 'sage_setup.docbuild' is a package and cannot be directly executed
make[2]: *** [doc-html] Error 1
make[1]: *** [all] Error 2
}}}
so I made
{{{
make psutil
}}}
then I could build sage successfully, and giac was built. As it seems unreliated to giac I give a positive review


---

Comment by frederichan created at 2016-12-07 10:32:07

Changing status from needs_review to positive_review.


---

Comment by rws created at 2016-12-07 14:03:11

Thanks for the review.


---

Comment by rws created at 2016-12-07 14:23:32

Please add your name as reviewer.


---

Comment by vbraun created at 2016-12-14 00:21:02

Resolution: fixed
