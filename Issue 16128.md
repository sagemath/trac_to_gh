# Issue 16128: ChainComplex.betti uses wrong base_ring

Issue created by migration from https://trac.sagemath.org/ticket/16365

Original creator: dunfield

Original creation time: 2014-05-16 17:02:22

CC:  jhpalmieri vbraun

The docstring for `ChainComplex.betti` says

```
  - ``base_ring`` -- a commutative ring (optional, default is the
          base ring for the chain complex); compute homology with
          these coefficients -- must be either the integers or a
          field
```

however, in fact if `base_ring` is `None` then under the hood it defaults to QQ.  Thus the `betti` method will choke on examples where `ChainComplex.homology` work fine:

```
sage: K = QuadraticField(-1, 'i')
sage: C = ChainComplex({0:matrix(K, [K.gen(),0])})
sage: C.homology()
{0: Vector space of dimension 1 over Number Field in i with defining polynomial x^2 + 1,
 1: Vector space of dimension 0 over Number Field in i with defining polynomial x^2 + 1}
sage: C.betti()
[...huge traceback...] 
TypeError: Unable to coerce i to a rational
```

and moreover gives **incorrect** answers when it silently coerces the chain complex into QQ:

```
sage: C = ChainComplex({0:matrix(GF(5), [[3, 1],[1, 2]])})
sage: C.homology()
{0: Vector space of dimension 1 over Finite Field of size 5,
 1: Vector space of dimension 1 over Finite Field of size 5}
sage: C.betti()
{0: 0, 1: 0}
```

I think the fix is just to change line 1344 of `homology/chain_complex.py`.  I will test this and upload a patch.


---

Comment by dunfield created at 2014-05-16 17:47:51

Upload fix, including adding a doctest which would catch the wrong answer in the GF(5) example.  
----
New commits:


---

Comment by dunfield created at 2014-05-16 17:47:51

Changing status from new to needs_review.


---

Comment by dunfield created at 2014-05-16 17:48:18

Set assignee to dunfield.


---

Comment by jhpalmieri created at 2014-05-16 19:23:21

Looks good to me.


---

Comment by jhpalmieri created at 2014-05-16 19:23:21

Changing status from needs_review to positive_review.


---

Comment by dunfield created at 2014-05-16 19:25:05

That was quick, thanks!


---

Comment by vbraun created at 2014-05-19 12:53:25

Resolution: fixed
