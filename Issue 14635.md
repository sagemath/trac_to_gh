# Issue 14635: Calling latex(...) shouldn't typeset the result

Issue created by migration from Trac.

Original creator: iandrus

Original creation time: 2013-06-29 01:59:12

Assignee: was

Keywords: latex notebook typesetting

In the notebook with typesetting turned on, calling `latex(...)` should display the LaTeX as a string instead of typsetting the result.  This makes it easier to copy/paste the LaTeX which was explicitly asked for.  

I created this ticket on behalf of anonymous who [requested this feature for sage-mode](https://bitbucket.org/gvol/sage-mode/issue/24/sage-view-should-not-have-inline-view-when).  I'm pretty sure the fix for one will automatically apply to the other.  Also, it's a Sage change.


---

Comment by ppurka created at 2013-07-01 15:28:55

This is subtle.

`latex()` returns a `LatexExpr` object and that automatically gets typeset by `pretty_print`. If you want to turn it off then you will have to either
1. make `latex` return just a string, which will potentially break a lot of things (because some of us do want typeset stuff when typeset is on), or
2. you will have to modify `pretty_print`, or the toggle `pretty_print_default`,
3. or, add an extra keyword to `latex(..., pretty_print=False)` that defaults to false and that you can set to True in your sage mode (I am just guessing that perhaps you can do this automatically in sage mode - I don't use sage mode).


---

Comment by iandrus created at 2013-07-01 19:03:53

I'm definitely not in favor of 1.  I was thinking of 2, but 3 might be preferable.

FWIW, I'm not entirely convinced this is a useful feature, and I'm hoping that the original reporter will weigh in at some point.


---

Comment by ppurka created at 2013-07-01 23:22:56

Replying to [comment:2 iandrus]:
> FWIW, I'm not entirely convinced this is a useful feature, and I'm hoping that the original reporter will weigh in at some point.
Calling `latex()` _is_ how typeset works in the notebook. You will have to come with an entirely new way of enabling typeset in the notebook if you want to disable this feature.


---

Comment by jhpalmieri created at 2013-07-02 01:28:29

I'm in favor of closing this ticket. There are at least two obvious solutions: turn off typesetting, or use the `print` command, as in `print latex(...)`.


---

Comment by ppurka created at 2013-07-02 05:46:21

Replying to [comment:4 jhpalmieri]:
> I'm in favor of closing this ticket. There are at least two obvious solutions: turn off typesetting, or use the `print` command, as in `print latex(...)`.
I agree - the solution you mention is very simple. Just use print. So, in sage-mode, parse every latex call and pass it through print.


---

Comment by vbraun created at 2013-07-04 15:09:21

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-07-04 15:09:21

The best option would be to copy the latex source into the clipboard if the user selects the typeset output. Until then I'm with John, use `print` or turn typesetting off. Both are easier to find than a optional keyword argument to `latex`.


---

Comment by vbraun created at 2013-07-04 15:10:19

Changing status from needs_review to positive_review.


---

Comment by was created at 2013-07-04 16:44:37

The design of "typeset mode" in sagenb isn't so good in my opinion.  For the record, I've implemented something similar for https://cloud.sagemath.com, which correctly handles the above problem in an extensible way.  Here's the *complete* code for the entire thing:


```
_system_sys_displayhook = sys.displayhook
import sage.misc.latex, types
TYPESET_MODE_EXCLUDES = (sage.misc.latex.LatexExpr, types.NoneType)

def typeset_mode(on=True):
    """
    Turn typeset mode on or off.  When on, each output is typeset using LaTeX.

    EXAMPLES::

         typeset_mode()  # turns typesetting on
         typeset_mode(False)  # turn typesetting off
    """
    if on:
        def f(obj):
            if isinstance(obj, TYPESET_MODE_EXCLUDES):
                _system_sys_displayhook(obj)
            else:
                salvus.tex(obj)
        sys.displayhook = f
    else:
        sys.displayhook = _system_sys_displayhook
```



---

Comment by novoselt created at 2013-07-07 17:13:48

For a while Sage would show precisely the latex code when typesetting `LatexExpr`, but people didn't like it and it was changed in #12156.


---

Comment by was created at 2013-07-09 06:13:25

Replying to [comment:9 novoselt]:
> For a while Sage would show precisely the latex code when typesetting `LatexExpr`, but people didn't like it and it was changed in #12156.

That is probably the root cause of this issue.  So right now we have:

```
a = 2/3
latex(a)
# displays \frac{2}{3}

show(a) 
# shows a nice fraction

show(latex(a))
# shows a nice fraction... because

latex(a) == latex(latex(a))
```


To my mind this behavior is questionable.  When I wrote the latex function, I meant for it to have a docstring like this (evidently, I never wrote a docstring, or at least the docstring for latex promises nothing meaningful):   "latex(x) returns a chunk of latex, which when typeset in math mode provides a visual representation of the object x."    With this interpretation, if the object x is a `LatexExpr` such as `\frac{2}{3`}, then a visual representation of that `LatexExpr` would be `\verb|\frac{2}{3}|`.

What do you think?


---

Comment by novoselt created at 2013-07-09 06:22:56

That's exactly what I thought and #11498 made it work quite satisfactory (#14382 wraps strings even better than verb to allow using them as arguments, e.g. in SageTeX).


---

Comment by jdemeyer created at 2013-08-02 15:27:21

Replying to [comment:10 was]:
> With this interpretation, if the object x is a `LatexExpr` such as `\frac{2}{3`}, then a visual representation of that `LatexExpr` would be `\verb|\frac{2}{3}|`.
> 
> What do you think?
The problem is that you need a way to typeset LaTeX code as-is. Before #12156, there was no way to typeset hand-crafted LaTeX code in the notebook.

I agree that using

```
print latex(foo)
```

is a good solution, so there is no issue as far as I'm concerned.


---

Comment by jdemeyer created at 2013-08-13 08:45:05

Resolution: wontfix
