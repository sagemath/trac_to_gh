# Issue 29421: Update to BRiAl 1.2.8

Issue created by migration from https://trac.sagemath.org/ticket/29658

Original creator: jhpalmieri

Original creation time: 2020-05-07 01:52:26

CC:  arojas fbissey mjo

BRiAl 1.2.8 fixes some Python 3 issues present in the current version in Sage.


---

Comment by jhpalmieri created at 2020-05-07 01:54:06

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2020-05-07 01:54:06

New commits:


---

Comment by fbissey created at 2020-05-07 01:57:04

It is a trivial bump, and I should know, I am one the one doing the releases.


---

Comment by fbissey created at 2020-05-07 01:57:04

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2020-05-07 01:59:19

Thanks. Maybe you should be the author and I should be the reviewer. ;)


---

Comment by mkoeppe created at 2020-05-07 02:18:39

Shouldn't sage_brial be updated at the same time?


---

Comment by mkoeppe created at 2020-05-07 02:19:01

Changing status from positive_review to needs_info.


---

Comment by fbissey created at 2020-05-07 02:22:55

We share the tarball so yes. Plus John explicitly mention python stuff, that's in sage_brial. I should pay more attention to the fact that the package has been split in vanilla sage too.


---

Comment by git created at 2020-05-07 03:15:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2020-05-07 03:17:12

Changing status from needs_info to needs_review.


---

Comment by jhpalmieri created at 2020-05-07 03:17:12

Okay, this updates sage_brial also.


---

Comment by jhpalmieri created at 2020-05-07 03:19:24

By the way, to update sage_brial, I updated the version number in `package_version.txt` and ran `sage --package fix-checksum`, and was told

```
Updating checksum of brial-1.2.8.tar.bz2
```

Should it use the package name instead of the tarball name, or perhaps both? I find it a little misleading.


---

Comment by fbissey created at 2020-05-07 03:23:07

Replying to [comment:10 jhpalmieri]:
> By the way, to update sage_brial, I updated the version number in `package_version.txt` and ran `sage --package fix-checksum`, and was told
> {{{
> Updating checksum of brial-1.2.8.tar.bz2
> }}}
> Should it use the package name instead of the tarball name, or perhaps both? I find it a little misleading.

Well, it is updating what it sees in `checksum.ini` which is `brial` in this case. If we want say the "package name" corresponding to the tarball that's some extra code for `fix-checksum`.

And I am not touching sage's own packaging system anymore.


---

Comment by jhpalmieri created at 2020-05-07 03:23:43

I propose (for another ticket):

```diff
diff --git a/build/sage_bootstrap/app.py b/build/sage_bootstrap/app.py
index 45818546a1..6405527e4d 100644
--- a/build/sage_bootstrap/app.py
+++ b/build/sage_bootstrap/app.py
@@ -134,13 +134,13 @@ class Application(object):
         """
         for pkg in Package.all():
             if not os.path.exists(pkg.tarball.upstream_fqn):
-                log.debug('Ignoring {0} because tarball is not cached'.format(pkg.tarball_filename))
+                log.debug('Ignoring {0} because tarball is not cached'.format(pkg.name))
                 continue
             if pkg.tarball.checksum_verifies():
-                log.debug('Checksum of {0} unchanged'.format(pkg.tarball_filename))
+                log.debug('Checksum of {0} unchanged'.format(pkg.name))
                 continue
             update = ChecksumUpdater(pkg.name)
-            print('Updating checksum of {0}'.format(pkg.tarball_filename))
+            print('Updating checksum of {0} (tarball {1})'.format(pkg.name, pkg.tarball_filename))
             update.fix_checksum()
 
     def fix_checksum(self, package_name):
@@ -154,9 +154,9 @@ class Application(object):
         update = ChecksumUpdater(package_name)
         pkg = update.package
         if pkg.tarball.checksum_verifies():
-            print('Checksum of {0} unchanged'.format(pkg.tarball_filename))
+            print('Checksum of {0} unchanged'.format(package_name))
         else:
-            print('Updating checksum of {0}'.format(pkg.tarball_filename))
+            print('Updating checksum of {0} (tarball {1})'.format(package_name, pkg.tarball_filename))
             update.fix_checksum()
         
     def create(self, package_name, version, tarball, pkg_type, upstream_url):
```



---

Comment by jhpalmieri created at 2020-05-07 03:24:26

Sample output:

```
% ./sage --package fix-checksum sage_brial
Updating checksum of sage_brial (tarball brial-1.2.8.tar.bz2)
% ./sage --package fix-checksum sage_brial
Checksum of sage_brial unchanged
```



---

Comment by fbissey created at 2020-05-07 03:25:02

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2020-05-07 03:25:02

Otherwise, I cannot see anything else holding this ticket. Feel free to say I am wrong.


---

Comment by vbraun created at 2020-06-03 22:32:21

Resolution: fixed
