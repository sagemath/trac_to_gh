# Issue 24587: Update GLPK to 4.65

Issue created by migration from https://trac.sagemath.org/ticket/24824

Original creator: thansen

Original creation time: 2018-02-23 09:51:13

CC:  fbissey @timokau isuruf mkoeppe

GLPK 4.65 was released recently and it prints the warning "Long-step dual simplex will be used" all over the place, leading to many failing sagemath doctests in Debian. I'm not sure if sagemath already has a way to deal with such warnings from glpk, or if glpk just shouldn't print these warnings.

tarball: https://ftp.gnu.org/gnu/glpk/glpk-4.65.tar.gz


---

Comment by jdemeyer created at 2018-02-23 11:18:15

Replying to [ticket:24824 thansen]:
> or if glpk just shouldn't print these warnings.

Reminds me of #20876.

I have no idea what the message "Long-step dual simplex will be used" means. Is it supposed to be a warning?


---

Comment by thansen created at 2018-02-23 11:26:19

It's this change in src/draft/glpios03.c:


```
+ #if 0 /* 20/I-2018 */
           xprintf("WARNING: LONG-STEP DUAL SIMPLEX WILL BE USED\n");
+ #else
+          xprintf("Long-step dual simplex will be used\n");
+ #endif
```


So it seems that just the text of the message was changed. Does the content of the message influence whether it's printed?


---

Comment by jdemeyer created at 2018-02-23 14:30:08

No idea...


---

Comment by thansen created at 2018-02-28 10:44:42

Upstream (Andrew Makhorin) says this:

GLP_MSG_OFF is not a relevant option to disable terminal/stdout output. 
Please use glp_term_out(GLP_OFF) and glp_term_out(GLP_ON) instead--these
calls disable/enable terminal output on a lower level independently on
options passed to the solvers.

See https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#21


---

Comment by jdemeyer created at 2018-02-28 10:56:08

Replying to [comment:5 thansen]:
> GLP_MSG_OFF is not a relevant option to disable terminal/stdout output.

It's not our goal to completely disable terminal output. We still want to see error messages for example.


---

Comment by jdemeyer created at 2018-02-28 10:57:38

It would also be good to know what the message "Long-step dual simplex will be used" means. Is it supposed to be a warning to say that we are doing something wrong?


---

Comment by jdemeyer created at 2018-02-28 11:05:15

This suggestion from https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#20 is obviously the right thing to do:

> It would be very helpful if GLP_MSG_OFF suppressed this message as it does with other messages.

That would be essentially a one-line patch.


---

Comment by thansen created at 2018-03-02 09:38:18

Should be fixed in the next release. The patch is here:

https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#24


---

Comment by dimpase created at 2019-09-09 10:12:06

Changing status from new to needs_review.


---

Comment by dimpase created at 2019-09-09 10:12:06

New commits:


---

Comment by git created at 2019-09-09 10:19:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-09-09 10:20:23

made the version 4.65.p0, not merely 4.65


---

Comment by git created at 2019-09-09 12:39:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2019-09-09 13:40:26

w.r.t. the error_recovery patch, http://trac.sagemath.org/ticket/20710#comment:18 - one can ask upstream, instead of uncondionally applying our patch, make it conditional, on some new parameter that may be manipulated at runtime, how about this?


---

Comment by jdemeyer created at 2019-09-09 15:48:51

It's not that applying the patch upstream will break anything, they refused the patch on principle: they simply don't want to officially support the way how Sage is absusing their error handler. I highly doubt that making the patch conditional will convince upstream. We could ask again to apply the same patch, just in case that they changed their mind.


---

Comment by dimpase created at 2019-09-09 16:07:38

It's one thing to ask to unconditionlly change the default mode of operation, and quite another to ask to accept a patch for a possibility to manipulate the default mode.

Asking to apply the same patch again would be not welcome, I think, and might lessen our chances to get what I propose in.

Could you ask a question whether they'd welcome such a patch, before we spend time working on it?


---

Comment by fbissey created at 2019-09-10 02:53:19

Your strategy to remove blank lines doesn't work. At least with python2.7.


---

Comment by dimpase created at 2019-09-10 06:55:53

I only tested with python3. Surely it's a quirk that can be fixed.


---

Comment by dimpase created at 2019-09-10 08:20:27

Replying to [comment:22 dimpase]:
> I only tested with python3. Surely it's a quirk that can be fixed.

I just tested this branch with python 2.7, all good, too. I have no idea what's not working for you.


---

Comment by fbissey created at 2019-09-10 08:37:42

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2019-09-10 08:37:42

Indeed I had made a mistake! It is all good.


---

Comment by chapoton created at 2019-09-30 08:12:27

moving milestone to 9.0 (after release of 8.9)


---

Comment by vbraun created at 2019-10-03 17:58:28

Resolution: fixed


---

Comment by slelievre created at 2019-10-28 23:11:56

This breaks building [SageMath](SageMath) on Cygwin64 on Windows 7:

- https://groups.google.com/d/msg/sage-release/oDwzJ8wzbGE/wSLXPQwpCAAJ


---

Comment by jhpalmieri created at 2020-03-10 18:11:27

I'm seeing the message "Long-step dual simplex will be used" using a system installation of glpk, thereby causing lots of failed tests. Is there anything to be done about this? Refuse to use the system installation if it's version 4.65? Block the message somehow?


---

Comment by slelievre created at 2020-03-10 18:54:08

For GLPK 4.65, some package distributions ship a patched version
that removes these "Long-step dual simplex will be used" messages,
but some don't. Ideally when deciding whether to install GLPK or use
the system one, our install scripts should take that into account.


---

Comment by jhpalmieri created at 2020-03-10 20:37:22

Is there a good way to detect that? Is there a standard patch-level or some other indication in the version number that this change has been made?


---

Comment by thansen created at 2020-03-11 09:58:32

In Debian we patched the doctest parser to ignore these warnings:

https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch


---

Comment by @timokau created at 2020-03-11 10:25:25

Replying to [comment:30 jhpalmieri]:
> Is there a good way to detect that? Is there a standard patch-level or some other indication in the version number that this change has been made?

Couldn't we just run something that would print the warnings and check if the warnings are printed?


---

Comment by jhpalmieri created at 2020-03-11 23:06:35

Replying to [comment:31 thansen]:
> In Debian we patched the doctest parser to ignore these warnings:
> 
> https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch

This looks good. Why don't we add this to Sage?


---

Comment by dimpase created at 2020-03-11 23:38:34

Replying to [comment:33 jhpalmieri]:
> Replying to [comment:31 thansen]:
> > In Debian we patched the doctest parser to ignore these warnings:
> > 
> > https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch
> 
> This looks good. Why don't we add this to Sage?

+1


---

Comment by jhpalmieri created at 2020-03-12 02:10:01

Replying to [comment:34 dimpase]:
> Replying to [comment:33 jhpalmieri]:
> > Replying to [comment:31 thansen]:
> > > In Debian we patched the doctest parser to ignore these warnings:
> > > 
> > > https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch
> > 
> > This looks good. Why don't we add this to Sage?
> 
> +1

See #29317.
