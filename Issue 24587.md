# Issue 24587: Update GLPK to 4.65

archive/issues_024587.json:
```json
{
    "body": "CC:  @kiwifb @timokau @isuruf @mkoeppe\n\nGLPK 4.65 was released recently and it prints the warning \"Long-step dual simplex will be used\" all over the place, leading to many failing sagemath doctests in Debian. I'm not sure if sagemath already has a way to deal with such warnings from glpk, or if glpk just shouldn't print these warnings.\n\ntarball: https://ftp.gnu.org/gnu/glpk/glpk-4.65.tar.gz\n\nIssue created by migration from https://trac.sagemath.org/ticket/24824\n\n",
    "created_at": "2018-02-23T09:51:13Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Update GLPK to 4.65",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24587",
    "user": "@tobihan"
}
```
CC:  @kiwifb @timokau @isuruf @mkoeppe

GLPK 4.65 was released recently and it prints the warning "Long-step dual simplex will be used" all over the place, leading to many failing sagemath doctests in Debian. I'm not sure if sagemath already has a way to deal with such warnings from glpk, or if glpk just shouldn't print these warnings.

tarball: https://ftp.gnu.org/gnu/glpk/glpk-4.65.tar.gz

Issue created by migration from https://trac.sagemath.org/ticket/24824





---

archive/issue_comments_344885.json:
```json
{
    "body": "Replying to [ticket:24824 thansen]:\n> or if glpk just shouldn't print these warnings.\n\nReminds me of #20876.\n\nI have no idea what the message \"Long-step dual simplex will be used\" means. Is it supposed to be a warning?",
    "created_at": "2018-02-23T11:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344885",
    "user": "@jdemeyer"
}
```

Replying to [ticket:24824 thansen]:
> or if glpk just shouldn't print these warnings.

Reminds me of #20876.

I have no idea what the message "Long-step dual simplex will be used" means. Is it supposed to be a warning?



---

archive/issue_comments_344886.json:
```json
{
    "body": "It's this change in src/draft/glpios03.c:\n\n\n```\n+ #if 0 /* 20/I-2018 */\n           xprintf(\"WARNING: LONG-STEP DUAL SIMPLEX WILL BE USED\\n\");\n+ #else\n+          xprintf(\"Long-step dual simplex will be used\\n\");\n+ #endif\n```\n\n\nSo it seems that just the text of the message was changed. Does the content of the message influence whether it's printed?",
    "created_at": "2018-02-23T11:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344886",
    "user": "@tobihan"
}
```

It's this change in src/draft/glpios03.c:


```
+ #if 0 /* 20/I-2018 */
           xprintf("WARNING: LONG-STEP DUAL SIMPLEX WILL BE USED\n");
+ #else
+          xprintf("Long-step dual simplex will be used\n");
+ #endif
```


So it seems that just the text of the message was changed. Does the content of the message influence whether it's printed?



---

archive/issue_comments_344887.json:
```json
{
    "body": "No idea...",
    "created_at": "2018-02-23T14:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344887",
    "user": "@jdemeyer"
}
```

No idea...



---

archive/issue_comments_344888.json:
```json
{
    "body": "Upstream (Andrew Makhorin) says this:\n\nGLP_MSG_OFF is not a relevant option to disable terminal/stdout output. \nPlease use glp_term_out(GLP_OFF) and glp_term_out(GLP_ON) instead--these\ncalls disable/enable terminal output on a lower level independently on\noptions passed to the solvers.\n\nSee https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#21",
    "created_at": "2018-02-28T10:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344888",
    "user": "@tobihan"
}
```

Upstream (Andrew Makhorin) says this:

GLP_MSG_OFF is not a relevant option to disable terminal/stdout output. 
Please use glp_term_out(GLP_OFF) and glp_term_out(GLP_ON) instead--these
calls disable/enable terminal output on a lower level independently on
options passed to the solvers.

See https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#21



---

archive/issue_comments_344889.json:
```json
{
    "body": "Replying to [comment:5 thansen]:\n> GLP_MSG_OFF is not a relevant option to disable terminal/stdout output.\n\nIt's not our goal to completely disable terminal output. We still want to see error messages for example.",
    "created_at": "2018-02-28T10:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344889",
    "user": "@jdemeyer"
}
```

Replying to [comment:5 thansen]:
> GLP_MSG_OFF is not a relevant option to disable terminal/stdout output.

It's not our goal to completely disable terminal output. We still want to see error messages for example.



---

archive/issue_comments_344890.json:
```json
{
    "body": "It would also be good to know what the message \"Long-step dual simplex will be used\" means. Is it supposed to be a warning to say that we are doing something wrong?",
    "created_at": "2018-02-28T10:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344890",
    "user": "@jdemeyer"
}
```

It would also be good to know what the message "Long-step dual simplex will be used" means. Is it supposed to be a warning to say that we are doing something wrong?



---

archive/issue_comments_344891.json:
```json
{
    "body": "This suggestion from https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#20 is obviously the right thing to do:\n\n> It would be very helpful if GLP_MSG_OFF suppressed this message as it does with other messages.\n\nThat would be essentially a one-line patch.",
    "created_at": "2018-02-28T11:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344891",
    "user": "@jdemeyer"
}
```

This suggestion from https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#20 is obviously the right thing to do:

> It would be very helpful if GLP_MSG_OFF suppressed this message as it does with other messages.

That would be essentially a one-line patch.



---

archive/issue_comments_344892.json:
```json
{
    "body": "Should be fixed in the next release. The patch is here:\n\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#24",
    "created_at": "2018-03-02T09:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344892",
    "user": "@tobihan"
}
```

Should be fixed in the next release. The patch is here:

https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=891465#24



---

archive/issue_comments_344893.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-09T10:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344893",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_344894.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-09-09T10:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344894",
    "user": "@dimpase"
}
```

New commits:



---

archive/issue_comments_344895.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-09T10:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344895",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_344896.json:
```json
{
    "body": "made the version 4.65.p0, not merely 4.65",
    "created_at": "2019-09-09T10:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344896",
    "user": "@dimpase"
}
```

made the version 4.65.p0, not merely 4.65



---

archive/issue_comments_344897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-09T12:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344897",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344898.json:
```json
{
    "body": "w.r.t. the error_recovery patch, http://trac.sagemath.org/ticket/20710#comment:18 - one can ask upstream, instead of uncondionally applying our patch, make it conditional, on some new parameter that may be manipulated at runtime, how about this?",
    "created_at": "2019-09-09T13:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344898",
    "user": "@dimpase"
}
```

w.r.t. the error_recovery patch, http://trac.sagemath.org/ticket/20710#comment:18 - one can ask upstream, instead of uncondionally applying our patch, make it conditional, on some new parameter that may be manipulated at runtime, how about this?



---

archive/issue_comments_344899.json:
```json
{
    "body": "It's not that applying the patch upstream will break anything, they refused the patch on principle: they simply don't want to officially support the way how Sage is absusing their error handler. I highly doubt that making the patch conditional will convince upstream. We could ask again to apply the same patch, just in case that they changed their mind.",
    "created_at": "2019-09-09T15:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344899",
    "user": "@jdemeyer"
}
```

It's not that applying the patch upstream will break anything, they refused the patch on principle: they simply don't want to officially support the way how Sage is absusing their error handler. I highly doubt that making the patch conditional will convince upstream. We could ask again to apply the same patch, just in case that they changed their mind.



---

archive/issue_comments_344900.json:
```json
{
    "body": "It's one thing to ask to unconditionlly change the default mode of operation, and quite another to ask to accept a patch for a possibility to manipulate the default mode.\n\nAsking to apply the same patch again would be not welcome, I think, and might lessen our chances to get what I propose in.\n\nCould you ask a question whether they'd welcome such a patch, before we spend time working on it?",
    "created_at": "2019-09-09T16:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344900",
    "user": "@dimpase"
}
```

It's one thing to ask to unconditionlly change the default mode of operation, and quite another to ask to accept a patch for a possibility to manipulate the default mode.

Asking to apply the same patch again would be not welcome, I think, and might lessen our chances to get what I propose in.

Could you ask a question whether they'd welcome such a patch, before we spend time working on it?



---

archive/issue_comments_344901.json:
```json
{
    "body": "Your strategy to remove blank lines doesn't work. At least with python2.7.",
    "created_at": "2019-09-10T02:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344901",
    "user": "@kiwifb"
}
```

Your strategy to remove blank lines doesn't work. At least with python2.7.



---

archive/issue_comments_344902.json:
```json
{
    "body": "I only tested with python3. Surely it's a quirk that can be fixed.",
    "created_at": "2019-09-10T06:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344902",
    "user": "@dimpase"
}
```

I only tested with python3. Surely it's a quirk that can be fixed.



---

archive/issue_comments_344903.json:
```json
{
    "body": "Replying to [comment:22 dimpase]:\n> I only tested with python3. Surely it's a quirk that can be fixed.\n\nI just tested this branch with python 2.7, all good, too. I have no idea what's not working for you.",
    "created_at": "2019-09-10T08:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344903",
    "user": "@dimpase"
}
```

Replying to [comment:22 dimpase]:
> I only tested with python3. Surely it's a quirk that can be fixed.

I just tested this branch with python 2.7, all good, too. I have no idea what's not working for you.



---

archive/issue_comments_344904.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-10T08:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344904",
    "user": "@kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_344905.json:
```json
{
    "body": "Indeed I had made a mistake! It is all good.",
    "created_at": "2019-09-10T08:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344905",
    "user": "@kiwifb"
}
```

Indeed I had made a mistake! It is all good.



---

archive/issue_comments_344906.json:
```json
{
    "body": "moving milestone to 9.0 (after release of 8.9)",
    "created_at": "2019-09-30T08:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344906",
    "user": "@fchapoton"
}
```

moving milestone to 9.0 (after release of 8.9)



---

archive/issue_comments_344907.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-03T17:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344907",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_344908.json:
```json
{
    "body": "This breaks building [SageMath](SageMath) on Cygwin64 on Windows 7:\n\n- https://groups.google.com/d/msg/sage-release/oDwzJ8wzbGE/wSLXPQwpCAAJ",
    "created_at": "2019-10-28T23:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344908",
    "user": "@slel"
}
```

This breaks building [SageMath](SageMath) on Cygwin64 on Windows 7:

- https://groups.google.com/d/msg/sage-release/oDwzJ8wzbGE/wSLXPQwpCAAJ



---

archive/issue_comments_344909.json:
```json
{
    "body": "I'm seeing the message \"Long-step dual simplex will be used\" using a system installation of glpk, thereby causing lots of failed tests. Is there anything to be done about this? Refuse to use the system installation if it's version 4.65? Block the message somehow?",
    "created_at": "2020-03-10T18:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344909",
    "user": "@jhpalmieri"
}
```

I'm seeing the message "Long-step dual simplex will be used" using a system installation of glpk, thereby causing lots of failed tests. Is there anything to be done about this? Refuse to use the system installation if it's version 4.65? Block the message somehow?



---

archive/issue_comments_344910.json:
```json
{
    "body": "For GLPK 4.65, some package distributions ship a patched version\nthat removes these \"Long-step dual simplex will be used\" messages,\nbut some don't. Ideally when deciding whether to install GLPK or use\nthe system one, our install scripts should take that into account.",
    "created_at": "2020-03-10T18:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344910",
    "user": "@slel"
}
```

For GLPK 4.65, some package distributions ship a patched version
that removes these "Long-step dual simplex will be used" messages,
but some don't. Ideally when deciding whether to install GLPK or use
the system one, our install scripts should take that into account.



---

archive/issue_comments_344911.json:
```json
{
    "body": "Is there a good way to detect that? Is there a standard patch-level or some other indication in the version number that this change has been made?",
    "created_at": "2020-03-10T20:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344911",
    "user": "@jhpalmieri"
}
```

Is there a good way to detect that? Is there a standard patch-level or some other indication in the version number that this change has been made?



---

archive/issue_comments_344912.json:
```json
{
    "body": "In Debian we patched the doctest parser to ignore these warnings:\n\nhttps://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch",
    "created_at": "2020-03-11T09:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344912",
    "user": "@tobihan"
}
```

In Debian we patched the doctest parser to ignore these warnings:

https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch



---

archive/issue_comments_344913.json:
```json
{
    "body": "Replying to [comment:30 jhpalmieri]:\n> Is there a good way to detect that? Is there a standard patch-level or some other indication in the version number that this change has been made?\n\nCouldn't we just run something that would print the warnings and check if the warnings are printed?",
    "created_at": "2020-03-11T10:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344913",
    "user": "@timokau"
}
```

Replying to [comment:30 jhpalmieri]:
> Is there a good way to detect that? Is there a standard patch-level or some other indication in the version number that this change has been made?

Couldn't we just run something that would print the warnings and check if the warnings are printed?



---

archive/issue_comments_344914.json:
```json
{
    "body": "Replying to [comment:31 thansen]:\n> In Debian we patched the doctest parser to ignore these warnings:\n> \n> https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch\n\nThis looks good. Why don't we add this to Sage?",
    "created_at": "2020-03-11T23:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344914",
    "user": "@jhpalmieri"
}
```

Replying to [comment:31 thansen]:
> In Debian we patched the doctest parser to ignore these warnings:
> 
> https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch

This looks good. Why don't we add this to Sage?



---

archive/issue_comments_344915.json:
```json
{
    "body": "Replying to [comment:33 jhpalmieri]:\n> Replying to [comment:31 thansen]:\n> > In Debian we patched the doctest parser to ignore these warnings:\n> > \n> > https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch\n> \n> This looks good. Why don't we add this to Sage?\n\n+1",
    "created_at": "2020-03-11T23:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344915",
    "user": "@dimpase"
}
```

Replying to [comment:33 jhpalmieri]:
> Replying to [comment:31 thansen]:
> > In Debian we patched the doctest parser to ignore these warnings:
> > 
> > https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch
> 
> This looks good. Why don't we add this to Sage?

+1



---

archive/issue_comments_344916.json:
```json
{
    "body": "Replying to [comment:34 dimpase]:\n> Replying to [comment:33 jhpalmieri]:\n> > Replying to [comment:31 thansen]:\n> > > In Debian we patched the doctest parser to ignore these warnings:\n> > > \n> > > https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch\n> > \n> > This looks good. Why don't we add this to Sage?\n> \n> +1\n\nSee #29317.",
    "created_at": "2020-03-12T02:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24587#issuecomment-344916",
    "user": "@jhpalmieri"
}
```

Replying to [comment:34 dimpase]:
> Replying to [comment:33 jhpalmieri]:
> > Replying to [comment:31 thansen]:
> > > In Debian we patched the doctest parser to ignore these warnings:
> > > 
> > > https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/dt-version-glpk-4.65-ignore-warnings.patch
> > 
> > This looks good. Why don't we add this to Sage?
> 
> +1

See #29317.
