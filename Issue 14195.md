# Issue 14195: MPIR 2.6.0's test suite fails with GCC 4.8.0

archive/issues_014195.json:
```json
{
    "body": "Assignee: @nexttime\n\nCC:  jpflori\n\nKeywords: spkg t-scan segmentation fault segfault\n\nThe fix is fairly easy:\n\n```patch\n--- mpir-2.6.0/tests/mpz/t-scan.c.orig 2012-10-03 22:07:32.000000000 +0200\n+++ mpir-2.6.0/tests/mpz/t-scan.c 2013-04-02 18:39:17.704366985 +0200\n@@ -84,7 +84,7 @@\n \n               for (isize = 0; isize <= size; isize++)\n                 {\n-                  for (oindex = 0; oindex <= numberof (offset); oindex++)\n+                  for (oindex = 0; oindex < numberof (offset); oindex++)\n                     {\n                       o = offset[oindex];\n                       if ((int) isize*GMP_NUMB_BITS < -o)\n```\n\n---\n\n**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.6.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.6.0.p2.spkg)\n\n**md5sum:** `b54f86c06dac76947d47a7d0bb2f1dfc  mpir-2.6.0.p2.spkg`\n\n\n### mpir-2.6.0.p2 (Leif Leonhardy, April 3rd 2013)\n* #14399: MPIR 2.6.0's test suite fails with GCC 4.8.0\n  Rather surprisingly, this bug, now causing a segfault in MPIR's test suite,\n  apparently never showed up before.\n  Add patch (`mpz__t-scan-bugfix.patch`) fixing an invalid array access in\n  the test code.\n  Patch has been submitted upstream.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14399\n\n",
    "closed_at": "2013-04-04T17:41:01Z",
    "created_at": "2013-04-02T17:33:33Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "MPIR 2.6.0's test suite fails with GCC 4.8.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14195",
    "user": "https://github.com/nexttime"
}
```
Assignee: @nexttime

CC:  jpflori

Keywords: spkg t-scan segmentation fault segfault

The fix is fairly easy:

```patch
--- mpir-2.6.0/tests/mpz/t-scan.c.orig 2012-10-03 22:07:32.000000000 +0200
+++ mpir-2.6.0/tests/mpz/t-scan.c 2013-04-02 18:39:17.704366985 +0200
@@ -84,7 +84,7 @@
 
               for (isize = 0; isize <= size; isize++)
                 {
-                  for (oindex = 0; oindex <= numberof (offset); oindex++)
+                  for (oindex = 0; oindex < numberof (offset); oindex++)
                     {
                       o = offset[oindex];
                       if ((int) isize*GMP_NUMB_BITS < -o)
```

---

**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.6.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.6.0.p2.spkg)

**md5sum:** `b54f86c06dac76947d47a7d0bb2f1dfc  mpir-2.6.0.p2.spkg`


### mpir-2.6.0.p2 (Leif Leonhardy, April 3rd 2013)
* #14399: MPIR 2.6.0's test suite fails with GCC 4.8.0
  Rather surprisingly, this bug, now causing a segfault in MPIR's test suite,
  apparently never showed up before.
  Add patch (`mpz__t-scan-bugfix.patch`) fixing an invalid array access in
  the test code.
  Patch has been submitted upstream.


Issue created by migration from https://trac.sagemath.org/ticket/14399





---

archive/issue_comments_178143.json:
```json
{
    "body": "Upstream report is at [this mpir-devel thread](http://groups.google.com/group/mpir-devel/browse_thread/thread/a0b93780c50bc6ed).",
    "created_at": "2013-04-02T18:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14195#issuecomment-178143",
    "user": "https://github.com/kcrisman"
}
```

Upstream report is at [this mpir-devel thread](http://groups.google.com/group/mpir-devel/browse_thread/thread/a0b93780c50bc6ed).



---

archive/issue_comments_178144.json:
```json
{
    "body": "Attachment [mpir-2.6.0.p1-p2.diff](tarball://root/attachments/some-uuid/ticket14399/mpir-2.6.0.p1-p2.diff) by @nexttime created at 2013-04-03 13:36:21\n\nDiff between the `.p1` and the `.p2` spkg.  For reference / review only.",
    "created_at": "2013-04-03T13:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14195#issuecomment-178144",
    "user": "https://github.com/nexttime"
}
```

Attachment [mpir-2.6.0.p1-p2.diff](tarball://root/attachments/some-uuid/ticket14399/mpir-2.6.0.p1-p2.diff) by @nexttime created at 2013-04-03 13:36:21

Diff between the `.p1` and the `.p2` spkg.  For reference / review only.



---

archive/issue_comments_178145.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-03T13:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14195#issuecomment-178145",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_178146.json:
```json
{
    "body": "Looks ok and at least still works as expected on a usual system where the MPIR spkg used to work.",
    "created_at": "2013-04-03T16:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14195#issuecomment-178146",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Looks ok and at least still works as expected on a usual system where the MPIR spkg used to work.



---

archive/issue_comments_178147.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-03T16:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14195#issuecomment-178147",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178148.json:
```json
{
    "body": "Replying to [comment:4 jpflori]:\n> Looks ok and at least still works as expected on a usual system where the MPIR spkg used to work.\n\n\nThanks.  I guess using GCC 4.8 will become less \"unusual\" soon.  (Ubuntu tends to incorporate patches from later versions into their \"previous\" GCC versions anyway, and as mentioned, it's rather surprising this long-lasting bug never caused problems before.  Although note that only the test code was broken, not the library itself.)",
    "created_at": "2013-04-03T17:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14195#issuecomment-178148",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:4 jpflori]:
> Looks ok and at least still works as expected on a usual system where the MPIR spkg used to work.


Thanks.  I guess using GCC 4.8 will become less "unusual" soon.  (Ubuntu tends to incorporate patches from later versions into their "previous" GCC versions anyway, and as mentioned, it's rather surprising this long-lasting bug never caused problems before.  Although note that only the test code was broken, not the library itself.)



---

archive/issue_events_040883.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-04T17:41:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14195#event-40883"
}
```



---

archive/issue_comments_178149.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-04T17:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14195#issuecomment-178149",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
