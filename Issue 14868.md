# Issue 14868: hardwired paths in src/sage

archive/issues_014868.json:
```json
{
    "body": "CC:  @jondo @kiwifb @mkoeppe @dimpase @vbraun @kcrisman @miguelmarco @nbruin\n\nKeywords: environment, SAGE_LOCAL, hardwired, run time\n\nSeveral run time paths in the python library are hardwired, in most cases to `$SAGE_LOCAL`.\n`$SAGE_LOCAL` has no meaning outside of Sage (the distribution). So it's better to add them to sage-env.py and make them overridable.\n\nFor example in `libs.singular.singular_init`, the singular shared object is looked for in `$SAGE_LOCAL/lib`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15105\n\n",
    "created_at": "2013-08-27T07:25:18Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "hardwired paths in src/sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14868",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```
CC:  @jondo @kiwifb @mkoeppe @dimpase @vbraun @kcrisman @miguelmarco @nbruin

Keywords: environment, SAGE_LOCAL, hardwired, run time

Several run time paths in the python library are hardwired, in most cases to `$SAGE_LOCAL`.
`$SAGE_LOCAL` has no meaning outside of Sage (the distribution). So it's better to add them to sage-env.py and make them overridable.

For example in `libs.singular.singular_init`, the singular shared object is looked for in `$SAGE_LOCAL/lib`.

Issue created by migration from https://trac.sagemath.org/ticket/15105





---

archive/issue_comments_189403.json:
```json
{
    "body": "Removed the ipython-sage-location check, as it involves `$SAGE_LOCAL`. Thus dependency on #15100.",
    "created_at": "2013-08-27T16:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189403",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Removed the ipython-sage-location check, as it involves `$SAGE_LOCAL`. Thus dependency on #15100.



---

archive/issue_comments_189404.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-02T14:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189404",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-02T21:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189406.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-09-03T08:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189406",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_189407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-06T10:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189408.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-12-19T11:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189408",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_189409.json:
```json
{
    "body": "Needs to be rebased. Given that I totally disagree with #15100, preferably this ticket should not depend on that.",
    "created_at": "2013-12-19T11:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189409",
    "user": "https://github.com/jdemeyer"
}
```

Needs to be rebased. Given that I totally disagree with #15100, preferably this ticket should not depend on that.



---

archive/issue_comments_189410.json:
```json
{
    "body": "Replying to [comment:8 jdemeyer]:\n> Needs to be rebased. Given that I totally disagree with #15100, preferably this ticket should not depend on that.\n\n#15100 is not too important. particularly for standalone sagelib it doesn't matter. anyhow, the doctest checking the fist line of the ipython (or any other) executable needs to be removed.",
    "created_at": "2013-12-19T12:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189410",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:8 jdemeyer]:
> Needs to be rebased. Given that I totally disagree with #15100, preferably this ticket should not depend on that.

#15100 is not too important. particularly for standalone sagelib it doesn't matter. anyhow, the doctest checking the fist line of the ipython (or any other) executable needs to be removed.



---

archive/issue_comments_189411.json:
```json
{
    "body": "This patch needs rebasing",
    "created_at": "2016-09-13T22:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189411",
    "user": "https://github.com/mkoeppe"
}
```

This patch needs rebasing



---

archive/issue_comments_189412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-15T20:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-15T20:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189414.json:
```json
{
    "body": "this is now rebased.\n\ni tried to resolve the conflicts carefully, but i haven't compiled/tested anything. can't do that anytime soon (no time, no hardware).\n\nhth",
    "created_at": "2016-09-15T20:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189414",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

this is now rebased.

i tried to resolve the conflicts carefully, but i haven't compiled/tested anything. can't do that anytime soon (no time, no hardware).

hth



---

archive/issue_comments_189415.json:
```json
{
    "body": "You still have stuff from old version of sage that are not there anymore. All the files where the diff starts with `/dev/null`. Better get rid of them.",
    "created_at": "2016-09-15T20:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189415",
    "user": "https://github.com/kiwifb"
}
```

You still have stuff from old version of sage that are not there anymore. All the files where the diff starts with `/dev/null`. Better get rid of them.



---

archive/issue_comments_189416.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-15T21:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189416",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_189417.json:
```json
{
    "body": "Replying to [comment:19 fbissey]:\n> Better get rid of them.\n\nthanks. missed that. i took that opportunity to squash the three merges into one.",
    "created_at": "2016-09-15T21:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189417",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:19 fbissey]:
> Better get rid of them.

thanks. missed that. i took that opportunity to squash the three merges into one.



---

archive/issue_comments_189418.json:
```json
{
    "body": "Instead of `sage.misc.misc`, shouldn't it use `sage.env`?",
    "created_at": "2016-09-15T21:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189418",
    "user": "https://github.com/mkoeppe"
}
```

Instead of `sage.misc.misc`, shouldn't it use `sage.env`?



---

archive/issue_comments_189419.json:
```json
{
    "body": "\n```\n--- a/src/bin/sage-location\n+++ b/src/bin/sage-location\n@@ -6,6 +6,7 @@ import os, sys, re\n \n SAGE_ROOT     = os.path.realpath(os.environ['SAGE_ROOT'])\n SAGE_LOCAL    = os.environ['SAGE_LOCAL']\n+SAGE_ETC      = os.environ['SAGE_ETC']\n \n location_file = os.path.join(SAGE_LOCAL, 'lib', 'sage-current-location.txt')\n force_file    = os.path.join(SAGE_LOCAL, 'lib', 'sage-force-relocate.txt')\n@@ -215,8 +216,8 @@ def write_config_files():\n     path.\n     \"\"\"\n     # Currently only one file (for the experimental package qepcad):\n-    # $SAGE_ROOT/local/default.qepcadrc\n-    f = open(os.path.join(SAGE_LOCAL, 'default.qepcadrc'), 'w')\n+    # $SAGE_ROOT/local/etc/default.qepcadrc\n+    f = open(os.path.join(SAGE_ETC, 'default.qepcadrc'), 'w')\n     text = \\\n \"\"\"# THIS FILE IS AUTOMATICALLY GENERATED by sage-location -- DO NOT EDIT\n```\n\nI raised the issue of `qepcadrc` before,but it has to be done in conjunction of fixing the spkg in question.\n\nIn sage-on-gentoo I just got rid of `sage-started.txt` it is one of those appendages that don't really belong anywhere sensible. `/var/lib/sage`?\n\nI am not sure about the catalogue of `DATA_DIR` and `INCLUDE_DIR` (and in line with my previous post `csage` is gone).\n\nDid you know that lib{s,S}ingular is the only file that is dlopen-ed in sage. There should be a better way of getting to it.\n\nDo not ever use `SAGE_SRC` for something that's needed at runtime. I could let go of that for doctesting as you do, but that makes things harder to test in sage-on-gentoo.\n\nOverall I am not overly impressed by the amount of stuff showed in `env.py`. Some of that stuff may also conflict with #20382 which I very much would like to see merged.",
    "created_at": "2016-09-15T21:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189419",
    "user": "https://github.com/kiwifb"
}
```


```
--- a/src/bin/sage-location
+++ b/src/bin/sage-location
@@ -6,6 +6,7 @@ import os, sys, re
 
 SAGE_ROOT     = os.path.realpath(os.environ['SAGE_ROOT'])
 SAGE_LOCAL    = os.environ['SAGE_LOCAL']
+SAGE_ETC      = os.environ['SAGE_ETC']
 
 location_file = os.path.join(SAGE_LOCAL, 'lib', 'sage-current-location.txt')
 force_file    = os.path.join(SAGE_LOCAL, 'lib', 'sage-force-relocate.txt')
@@ -215,8 +216,8 @@ def write_config_files():
     path.
     """
     # Currently only one file (for the experimental package qepcad):
-    # $SAGE_ROOT/local/default.qepcadrc
-    f = open(os.path.join(SAGE_LOCAL, 'default.qepcadrc'), 'w')
+    # $SAGE_ROOT/local/etc/default.qepcadrc
+    f = open(os.path.join(SAGE_ETC, 'default.qepcadrc'), 'w')
     text = \
 """# THIS FILE IS AUTOMATICALLY GENERATED by sage-location -- DO NOT EDIT
```

I raised the issue of `qepcadrc` before,but it has to be done in conjunction of fixing the spkg in question.

In sage-on-gentoo I just got rid of `sage-started.txt` it is one of those appendages that don't really belong anywhere sensible. `/var/lib/sage`?

I am not sure about the catalogue of `DATA_DIR` and `INCLUDE_DIR` (and in line with my previous post `csage` is gone).

Did you know that lib{s,S}ingular is the only file that is dlopen-ed in sage. There should be a better way of getting to it.

Do not ever use `SAGE_SRC` for something that's needed at runtime. I could let go of that for doctesting as you do, but that makes things harder to test in sage-on-gentoo.

Overall I am not overly impressed by the amount of stuff showed in `env.py`. Some of that stuff may also conflict with #20382 which I very much would like to see merged.



---

archive/issue_comments_189420.json:
```json
{
    "body": "> I raised the issue of qepcadrc before,but it has to be done in conjunction of fixing the spkg in question.\n\nsage_location (whatever it tries to do) should be moved out of sagelib. it's not needed there. i don't remember what qepcadrc was exactly about, but there was headache involved.\n\n> In sage-on-gentoo I just got rid of sage-started.txt\n\nmaybe sage should touch ~/.sage/started instead? this is often writable... does sage-started.txt implement anything useful at all?\n\n> Did you know that lib{s,S}ingular is the only file that is dlopen-ed in sage. There should be a better way of getting to it.\n\nit's hard to get a broken implementation right. iirc theres has never been a technical reason for not just linking. so maybe... just link? (see my ancient comment in env.py).\n\n> Do not ever use SAGE_SRC for something that's needed at runtime. I could let go of that for doctesting as you do, but that makes things harder to test in sage-on-gentoo.\n\nthere is some sort of interactive source browser. how would that work without SAGE_SRC? i think i did this [1] (also installed the source) to fix it.\n\n> stuff showed in env.py\n\ntoo many *DIR variables? true. there are better ways: each extension should have its own configuration (read: should be a standalone package depending on sagelib). i think, we are simply not there yet. cf. [2] for the intended (workaround) implementation.\n\n> #20382 \n\nplease go ahead and finish that first. this ticket was never meant to interfere with #20382.\n\n[1] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L103\n[2] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L134",
    "created_at": "2016-09-15T22:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189420",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

> I raised the issue of qepcadrc before,but it has to be done in conjunction of fixing the spkg in question.

sage_location (whatever it tries to do) should be moved out of sagelib. it's not needed there. i don't remember what qepcadrc was exactly about, but there was headache involved.

> In sage-on-gentoo I just got rid of sage-started.txt

maybe sage should touch ~/.sage/started instead? this is often writable... does sage-started.txt implement anything useful at all?

> Did you know that lib{s,S}ingular is the only file that is dlopen-ed in sage. There should be a better way of getting to it.

it's hard to get a broken implementation right. iirc theres has never been a technical reason for not just linking. so maybe... just link? (see my ancient comment in env.py).

> Do not ever use SAGE_SRC for something that's needed at runtime. I could let go of that for doctesting as you do, but that makes things harder to test in sage-on-gentoo.

there is some sort of interactive source browser. how would that work without SAGE_SRC? i think i did this [1] (also installed the source) to fix it.

> stuff showed in env.py

too many *DIR variables? true. there are better ways: each extension should have its own configuration (read: should be a standalone package depending on sagelib). i think, we are simply not there yet. cf. [2] for the intended (workaround) implementation.

> #20382 

please go ahead and finish that first. this ticket was never meant to interfere with #20382.

[1] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L103
[2] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L134



---

archive/issue_comments_189421.json:
```json
{
    "body": "Replying to [comment:24 felixs]:\n> > stuff showed in env.py\n> \n> too many *DIR variables? true. there are better ways: each extension should have its own configuration (read: should be a standalone package depending on sagelib). i think, we are simply not there yet. cf. [2] for the intended (workaround) implementation.\n\nI agree with Felix on this. \n\nWe do need lots of these variables, because we no longer want to assume that everything lives in the same prefix hierarchy (\"SAGE_LOCAL\").\n\nWhether these kind of configuration variables should go into env or into another centralized module, is another question.",
    "created_at": "2016-09-15T22:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189421",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:24 felixs]:
> > stuff showed in env.py
> 
> too many *DIR variables? true. there are better ways: each extension should have its own configuration (read: should be a standalone package depending on sagelib). i think, we are simply not there yet. cf. [2] for the intended (workaround) implementation.

I agree with Felix on this. 

We do need lots of these variables, because we no longer want to assume that everything lives in the same prefix hierarchy ("SAGE_LOCAL").

Whether these kind of configuration variables should go into env or into another centralized module, is another question.



---

archive/issue_comments_189422.json:
```json
{
    "body": "Replying to [comment:24 felixs]:\n> > I raised the issue of qepcadrc before,but it has to be done in conjunction of fixing the spkg in question.\n> \n> sage_location (whatever it tries to do) should be moved out of sagelib. it's not needed there. i don't remember what qepcadrc was exactly about, but there was headache involved.\n> \n> > In sage-on-gentoo I just got rid of sage-started.txt\n> \n> maybe sage should touch ~/.sage/started instead? this is often writable... does sage-started.txt implement anything useful at all?\n\nNo, it was introduced as a check by Jeroen (when he was the release manager) to check that sage does starts. So it is produced at the end of the build process and checked and regenerated if missing when sage is started.\n\n> \n> > Did you know that lib{s,S}ingular is the only file that is dlopen-ed in sage. There should be a better way of getting to it.\n> \n> it's hard to get a broken implementation right. iirc theres has never been a technical reason for not just linking. so maybe... just link? (see my ancient comment in env.py).\n\nThat a novel idea :) but even the singular4 ticket isn't going there.\n\n> \n> > Do not ever use SAGE_SRC for something that's needed at runtime. I could let go of that for doctesting as you do, but that makes things harder to test in sage-on-gentoo.\n> \n> there is some sort of interactive source browser. how would that work without SAGE_SRC? i think i did this [1] (also installed the source) to fix it.\n\nI don't really know what that does. Never used it. So in sage-on-gentoo `SAGE_SRC` points to `/usr/lib{,64}/python2.7/site-packages/sage` and I install the necessary `pxd` and `pyx` to run test. So that probably works. But my attitude on that is that the source shouldn't be considered available at runtime and of course you should be able to run tests before installing. The possibility of doing the last bit is shot down by #21221.\n \n> \n> > stuff showed in env.py\n> \n> too many *DIR variables? true. there are better ways: each extension should have its own configuration (read: should be a standalone package depending on sagelib). i think, we are simply not there yet. cf. [2] for the intended (workaround) implementation.\n> \n> > #20382 \n> \n> please go ahead and finish that first. this ticket was never meant to interfere with #20382.\n> \n> [1] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L103\n> [2] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L134\n\nYes I guess if you are thinking of a modular approach where components can be installed anywhere on the system, like hashdist or spack, you want to use variable like CPATH and LIBRARY_PATH, set when you load the components in the environment. Stuff under SAGE_LOCAL/share is still an issue in that case.\n\nOn a system like sage-on-gentoo where things still live under a single prefix (but is a more conventional one) keeping SAGE_LOCAL is not a big deal. Apart from `etc` I just use it like it was `--prefix=/usr`.",
    "created_at": "2016-09-15T23:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189422",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:24 felixs]:
> > I raised the issue of qepcadrc before,but it has to be done in conjunction of fixing the spkg in question.
> 
> sage_location (whatever it tries to do) should be moved out of sagelib. it's not needed there. i don't remember what qepcadrc was exactly about, but there was headache involved.
> 
> > In sage-on-gentoo I just got rid of sage-started.txt
> 
> maybe sage should touch ~/.sage/started instead? this is often writable... does sage-started.txt implement anything useful at all?

No, it was introduced as a check by Jeroen (when he was the release manager) to check that sage does starts. So it is produced at the end of the build process and checked and regenerated if missing when sage is started.

> 
> > Did you know that lib{s,S}ingular is the only file that is dlopen-ed in sage. There should be a better way of getting to it.
> 
> it's hard to get a broken implementation right. iirc theres has never been a technical reason for not just linking. so maybe... just link? (see my ancient comment in env.py).

That a novel idea :) but even the singular4 ticket isn't going there.

> 
> > Do not ever use SAGE_SRC for something that's needed at runtime. I could let go of that for doctesting as you do, but that makes things harder to test in sage-on-gentoo.
> 
> there is some sort of interactive source browser. how would that work without SAGE_SRC? i think i did this [1] (also installed the source) to fix it.

I don't really know what that does. Never used it. So in sage-on-gentoo `SAGE_SRC` points to `/usr/lib{,64}/python2.7/site-packages/sage` and I install the necessary `pxd` and `pyx` to run test. So that probably works. But my attitude on that is that the source shouldn't be considered available at runtime and of course you should be able to run tests before installing. The possibility of doing the last bit is shot down by #21221.
 
> 
> > stuff showed in env.py
> 
> too many *DIR variables? true. there are better ways: each extension should have its own configuration (read: should be a standalone package depending on sagelib). i think, we are simply not there yet. cf. [2] for the intended (workaround) implementation.
> 
> > #20382 
> 
> please go ahead and finish that first. this ticket was never meant to interfere with #20382.
> 
> [1] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L103
> [2] https://github.com/felix-salfelder/sage/blob/autotools/src/sage/env.py.in#L134

Yes I guess if you are thinking of a modular approach where components can be installed anywhere on the system, like hashdist or spack, you want to use variable like CPATH and LIBRARY_PATH, set when you load the components in the environment. Stuff under SAGE_LOCAL/share is still an issue in that case.

On a system like sage-on-gentoo where things still live under a single prefix (but is a more conventional one) keeping SAGE_LOCAL is not a big deal. Apart from `etc` I just use it like it was `--prefix=/usr`.



---

archive/issue_comments_189423.json:
```json
{
    "body": "Replying to [comment:26 fbissey]:\n\ni appreciate your clear reply. but i'm out of time. maybe next week.",
    "created_at": "2016-09-15T23:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189423",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:26 fbissey]:

i appreciate your clear reply. but i'm out of time. maybe next week.



---

archive/issue_comments_189424.json:
```json
{
    "body": "About `sage-started.txt`: it has two purposes:\n\n1. Check that Sage starts.\n\n2. Initialize any files which should be initialized at build time (this includes running `sage-location` and generating `.pyc` files). See #11926.",
    "created_at": "2016-09-16T14:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189424",
    "user": "https://github.com/jdemeyer"
}
```

About `sage-started.txt`: it has two purposes:

1. Check that Sage starts.

2. Initialize any files which should be initialized at build time (this includes running `sage-location` and generating `.pyc` files). See #11926.



---

archive/issue_comments_189425.json:
```json
{
    "body": "Regarding\n\n```\n# hmm, who is going to create sage_started if SAGE_ETC is readonly?\n```\n\n\nThis isn't going to happen since this file should be written only by the build process. At that point, `SAGE_ETC` should be writable.\n\nSo please remove this comment.",
    "created_at": "2016-09-16T14:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189425",
    "user": "https://github.com/jdemeyer"
}
```

Regarding

```
# hmm, who is going to create sage_started if SAGE_ETC is readonly?
```


This isn't going to happen since this file should be written only by the build process. At that point, `SAGE_ETC` should be writable.

So please remove this comment.



---

archive/issue_comments_189426.json:
```json
{
    "body": "What is the point of this?\n\n```\n    # Do nothing if the file already exists\n    if os.path.isfile(started_file):\n        return\n```\n\n`make` expects the timestamp to be updated.",
    "created_at": "2016-09-16T14:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189426",
    "user": "https://github.com/jdemeyer"
}
```

What is the point of this?

```
    # Do nothing if the file already exists
    if os.path.isfile(started_file):
        return
```

`make` expects the timestamp to be updated.



---

archive/issue_comments_189427.json:
```json
{
    "body": "sage_started is now in #21510",
    "created_at": "2016-09-16T23:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189427",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

sage_started is now in #21510



---

archive/issue_comments_189428.json:
```json
{
    "body": "OK, best to remove anything about sage_started from the present ticket's branch then.",
    "created_at": "2016-09-16T23:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189428",
    "user": "https://github.com/mkoeppe"
}
```

OK, best to remove anything about sage_started from the present ticket's branch then.



---

archive/issue_comments_189429.json:
```json
{
    "body": "sage_location now is #21511.",
    "created_at": "2016-09-16T23:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189429",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

sage_location now is #21511.



---

archive/issue_comments_189430.json:
```json
{
    "body": "See also #21591.",
    "created_at": "2016-09-24T23:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189430",
    "user": "https://github.com/mkoeppe"
}
```

See also #21591.



---

archive/issue_comments_189431.json:
```json
{
    "body": "Definitely agree that none of Sage's external dependencies should be assumed to live under the same prefix.  I think it's fine for the sake of using Sage-the-distribution to have defaults that assume everything is under `$SAGE_LOCAL`, but all these paths should be easy for system integrator to change (it might nice to even have a simple config file read at build time).",
    "created_at": "2016-09-29T13:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189431",
    "user": "https://github.com/embray"
}
```

Definitely agree that none of Sage's external dependencies should be assumed to live under the same prefix.  I think it's fine for the sake of using Sage-the-distribution to have defaults that assume everything is under `$SAGE_LOCAL`, but all these paths should be easy for system integrator to change (it might nice to even have a simple config file read at build time).



---

archive/issue_comments_189432.json:
```json
{
    "body": "I rebased this properly on top of develop, rather than trying to merge develop into it, if anyone would like to have a look.  I think I got everything right but I might be missing one or two things.  I'm not sure what to do with the new `SAGE_MAXIMA_INIT` this adds.",
    "created_at": "2016-09-29T14:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189432",
    "user": "https://github.com/embray"
}
```

I rebased this properly on top of develop, rather than trying to merge develop into it, if anyone would like to have a look.  I think I got everything right but I might be missing one or two things.  I'm not sure what to do with the new `SAGE_MAXIMA_INIT` this adds.



---

archive/issue_comments_189433.json:
```json
{
    "body": "Replying to [comment:37 embray]:\n> I rebased this properly on top of develop\n\nthanks. can you update the \"Branch\" field? (is it supposed to work like that?)\n\n> I'm not sure what to do with the new `SAGE_MAXIMA_INIT` this adds.\n\niirc, this variable was needed to point to some maxima fragment, which is in different places, depending on where sage is run from. obviously there must be a better solution (including one that does not use a file like this one).",
    "created_at": "2016-09-29T18:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189433",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:37 embray]:
> I rebased this properly on top of develop

thanks. can you update the "Branch" field? (is it supposed to work like that?)

> I'm not sure what to do with the new `SAGE_MAXIMA_INIT` this adds.

iirc, this variable was needed to point to some maxima fragment, which is in different places, depending on where sage is run from. obviously there must be a better solution (including one that does not use a file like this one).



---

archive/issue_comments_189434.json:
```json
{
    "body": "Replying to [comment:38 felixs]:\n> Replying to [comment:37 embray]:\n> > I rebased this properly on top of develop\n> \n> thanks. can you update the \"Branch\" field? (is it supposed to work like that?)\n> \n\nThe branch definitely needs to be changed unless Erik has the right to write to `felixs`' branches ;) Cannot comment until I see the new branch.",
    "created_at": "2016-09-29T20:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189434",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:38 felixs]:
> Replying to [comment:37 embray]:
> > I rebased this properly on top of develop
> 
> thanks. can you update the "Branch" field? (is it supposed to work like that?)
> 

The branch definitely needs to be changed unless Erik has the right to write to `felixs`' branches ;) Cannot comment until I see the new branch.



---

archive/issue_comments_189435.json:
```json
{
    "body": "I can change the branch to mine, but only if it's ok with felixs.  I think I need to pull out the `SAGE_MAXIMA_INIT` stuff which isn't ready, but otherwise I think it brings it most other changes from the old version of his branch that are still relevant.",
    "created_at": "2016-09-30T09:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189435",
    "user": "https://github.com/embray"
}
```

I can change the branch to mine, but only if it's ok with felixs.  I think I need to pull out the `SAGE_MAXIMA_INIT` stuff which isn't ready, but otherwise I think it brings it most other changes from the old version of his branch that are still relevant.



---

archive/issue_comments_189436.json:
```json
{
    "body": "Replying to [comment:40 embray]:\n> [..] if it's ok with felixs.\n\nsure it is. please do!",
    "created_at": "2016-09-30T10:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189436",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:40 embray]:
> [..] if it's ok with felixs.

sure it is. please do!



---

archive/issue_comments_189437.json:
```json
{
    "body": "Here's my version of Felix's branch, rebased on a recent develop branch.  I think I preserved all the changes between the original version of his branch, and the more recent version from https://git.sagemath.org/sage.git/commit/?id=4846a73aad7cf7361c69a6ae43628b8cae821b9f  So this removed many changes from the original branch, such as the change to how sage-maxima.lisp is located.\n\nIt would still be good to have a solution for that.  But for now, this will let us look at what changes this branch does make (that are still relevant).\n----\nNew commits:",
    "created_at": "2016-10-03T10:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189437",
    "user": "https://github.com/embray"
}
```

Here's my version of Felix's branch, rebased on a recent develop branch.  I think I preserved all the changes between the original version of his branch, and the more recent version from https://git.sagemath.org/sage.git/commit/?id=4846a73aad7cf7361c69a6ae43628b8cae821b9f  So this removed many changes from the original branch, such as the change to how sage-maxima.lisp is located.

It would still be good to have a solution for that.  But for now, this will let us look at what changes this branch does make (that are still relevant).
----
New commits:



---

archive/issue_comments_189438.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-03T10:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189438",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_189439.json:
```json
{
    "body": "In `src/sage/databases/sql_db.py`\n\n```\n-    from sage.env import SAGE_SHARE\n+    from sage.misc.misc import GRAPHS_DATA_DIR\n```\n\nGo back to using `sage.env` rather than `sage.misc.misc`.",
    "created_at": "2016-10-03T11:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189439",
    "user": "https://github.com/kiwifb"
}
```

In `src/sage/databases/sql_db.py`

```
-    from sage.env import SAGE_SHARE
+    from sage.misc.misc import GRAPHS_DATA_DIR
```

Go back to using `sage.env` rather than `sage.misc.misc`.



---

archive/issue_comments_189440.json:
```json
{
    "body": "`sage.env` is the wrong place for this. (not saying that, sage.misc.misc is any better, i hardly remember why it ended up there.).\n\nGRAPHS_DATA_DIR certainly belongs to the part of code that uses graphs data... not to the core library (which i think env.py belongs to).\n\nfor the transition it might make sense to open a `to be sorted` section in env.py... if you agree that doing it right[tm] is not within the scope of this ticket.",
    "created_at": "2016-10-03T11:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189440",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

`sage.env` is the wrong place for this. (not saying that, sage.misc.misc is any better, i hardly remember why it ended up there.).

GRAPHS_DATA_DIR certainly belongs to the part of code that uses graphs data... not to the core library (which i think env.py belongs to).

for the transition it might make sense to open a `to be sorted` section in env.py... if you agree that doing it right[tm] is not within the scope of this ticket.



---

archive/issue_comments_189441.json:
```json
{
    "body": "Historically, variables where stored in `sage.misc.misc`. When we started to setup `sage.env` as the (more comprehensive) variable store we deprecated the use of `sage.misc.misc`.\n\nI initially needed such a store in sage-on-gentoo anyway because my shell environment didn't contain them. It allowed me to do `import sage.all` from the system python prompt amongst other things.\n\nNow I am curious as to why `sage.env` is not the right place for runtime variables - I would agree that now we should split the build time only variables somewhere else. But I am interested in your reasoning. Bear in mind that any answer from me will be several hours away (need to catch some zzzz).",
    "created_at": "2016-10-03T11:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189441",
    "user": "https://github.com/kiwifb"
}
```

Historically, variables where stored in `sage.misc.misc`. When we started to setup `sage.env` as the (more comprehensive) variable store we deprecated the use of `sage.misc.misc`.

I initially needed such a store in sage-on-gentoo anyway because my shell environment didn't contain them. It allowed me to do `import sage.all` from the system python prompt amongst other things.

Now I am curious as to why `sage.env` is not the right place for runtime variables - I would agree that now we should split the build time only variables somewhere else. But I am interested in your reasoning. Bear in mind that any answer from me will be several hours away (need to catch some zzzz).



---

archive/issue_comments_189442.json:
```json
{
    "body": "Ah, I thought I replaced most of the `sage.misc.misc` to with `sage.env` bug I guess I missed that one.\n\nI don't think there's really any problem with it being in `sage.env`.  If I were to do anything different it would be toward the goal of keeping environment variable definitions close to the code that actually uses them.  It might be nice if a subpackage can have a `sage.<foo>.env` describing variable specifically relevant to that sub-package, but still allow all variables to imported from `sage.env` (lazily evaluated if necessary).\n\nBut I think that's all beyond the scope of this ticket--for now I think throwing everything in `sage.env` is appropriate.",
    "created_at": "2016-10-03T11:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189442",
    "user": "https://github.com/embray"
}
```

Ah, I thought I replaced most of the `sage.misc.misc` to with `sage.env` bug I guess I missed that one.

I don't think there's really any problem with it being in `sage.env`.  If I were to do anything different it would be toward the goal of keeping environment variable definitions close to the code that actually uses them.  It might be nice if a subpackage can have a `sage.<foo>.env` describing variable specifically relevant to that sub-package, but still allow all variables to imported from `sage.env` (lazily evaluated if necessary).

But I think that's all beyond the scope of this ticket--for now I think throwing everything in `sage.env` is appropriate.



---

archive/issue_comments_189443.json:
```json
{
    "body": "> Now I am curious as to why sage.env is not the right place for runtime variables\n\nbecause it breaks modularity. the core library should not have to know about extensions.\n\nor the other way: there should be a way to extend sage/sagelib by merely installing something. then GRAPH_DATA (as well as some others listed in sage.env), should use that mechanism.\n\nanother remark: this is not just about environment variables. an extension should possibly add *anything*. but environment might be a good example, then generalize.\n\n> for now [..] throwing everything in sage.env is appropriate. \n\nagreed.",
    "created_at": "2016-10-03T11:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189443",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

> Now I am curious as to why sage.env is not the right place for runtime variables

because it breaks modularity. the core library should not have to know about extensions.

or the other way: there should be a way to extend sage/sagelib by merely installing something. then GRAPH_DATA (as well as some others listed in sage.env), should use that mechanism.

another remark: this is not just about environment variables. an extension should possibly add *anything*. but environment might be a good example, then generalize.

> for now [..] throwing everything in sage.env is appropriate. 

agreed.



---

archive/issue_comments_189444.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-03T12:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189444",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_189445.json:
```json
{
    "body": "You cannot just unilaterally change the path for `default.qepcadrc`, see [comment:23]",
    "created_at": "2016-10-03T12:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189445",
    "user": "https://github.com/jdemeyer"
}
```

You cannot just unilaterally change the path for `default.qepcadrc`, see [comment:23]



---

archive/issue_comments_189446.json:
```json
{
    "body": "In `pselect.pyx`, maybe it's better to use `sys.executable` instead of `os.path.join(SAGE_LOCAL, 'bin', 'python')`.\n\nBecause now the patch just replaces one hard-coded path by another.",
    "created_at": "2016-10-03T12:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189446",
    "user": "https://github.com/jdemeyer"
}
```

In `pselect.pyx`, maybe it's better to use `sys.executable` instead of `os.path.join(SAGE_LOCAL, 'bin', 'python')`.

Because now the patch just replaces one hard-coded path by another.



---

archive/issue_comments_189447.json:
```json
{
    "body": "I also don't agree with the removal of the test in `src/sage/tests/cmdline.py`. The doctest has a function (it checks that `sage-location` was run), you should not just remove it.",
    "created_at": "2016-10-03T12:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189447",
    "user": "https://github.com/jdemeyer"
}
```

I also don't agree with the removal of the test in `src/sage/tests/cmdline.py`. The doctest has a function (it checks that `sage-location` was run), you should not just remove it.



---

archive/issue_comments_189448.json:
```json
{
    "body": "There is #15146 to deal with `sage-location` and the test in `src/sage/tests/cmdline.py`",
    "created_at": "2016-10-03T12:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189448",
    "user": "https://github.com/jdemeyer"
}
```

There is #15146 to deal with `sage-location` and the test in `src/sage/tests/cmdline.py`



---

archive/issue_comments_189449.json:
```json
{
    "body": "In `sage.env`, use `SAGE_LOCAL` instead of `os.environ['SAGE_LOCAL']`.",
    "created_at": "2016-10-03T12:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189449",
    "user": "https://github.com/jdemeyer"
}
```

In `sage.env`, use `SAGE_LOCAL` instead of `os.environ['SAGE_LOCAL']`.



---

archive/issue_comments_189450.json:
```json
{
    "body": "The Singular changes will conflict with #17254.",
    "created_at": "2016-10-03T12:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189450",
    "user": "https://github.com/jdemeyer"
}
```

The Singular changes will conflict with #17254.



---

archive/issue_comments_189451.json:
```json
{
    "body": "Replace `GAP_DATA_DIR` with `GAP_DIR`. It's not a data dir, it's the installation directory of the whole GAP package.",
    "created_at": "2016-10-03T12:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189451",
    "user": "https://github.com/jdemeyer"
}
```

Replace `GAP_DATA_DIR` with `GAP_DIR`. It's not a data dir, it's the installation directory of the whole GAP package.



---

archive/issue_comments_189452.json:
```json
{
    "body": "In `src/sage/geometry/lattice_polytope.py`, instead of assigning `data_location = POLYTOPE_DATA_DIR`, it is cleaner to just use the variable `POLYTOPE_DATA_DIR` directly.",
    "created_at": "2016-10-03T13:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189452",
    "user": "https://github.com/jdemeyer"
}
```

In `src/sage/geometry/lattice_polytope.py`, instead of assigning `data_location = POLYTOPE_DATA_DIR`, it is cleaner to just use the variable `POLYTOPE_DATA_DIR` directly.



---

archive/issue_comments_189453.json:
```json
{
    "body": "Same comment in `src/sage/schemes/elliptic_curves/ec_database.py`: you can shorten\n\n```\n        from sage.env import ELLCURVE_DATA_DIR\n        db = ELLCURVE_DATA_DIR\n        data = os.path.join(db,'rank%s'%rank)\n```\n\nto\n\n```\n        from sage.env import ELLCURVE_DATA_DIR\n        data = os.path.join(ELLCURVE_DATA_DIR, 'rank%s'%rank)\n```\n",
    "created_at": "2016-10-03T13:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189453",
    "user": "https://github.com/jdemeyer"
}
```

Same comment in `src/sage/schemes/elliptic_curves/ec_database.py`: you can shorten

```
        from sage.env import ELLCURVE_DATA_DIR
        db = ELLCURVE_DATA_DIR
        data = os.path.join(db,'rank%s'%rank)
```

to

```
        from sage.env import ELLCURVE_DATA_DIR
        data = os.path.join(ELLCURVE_DATA_DIR, 'rank%s'%rank)
```




---

archive/issue_comments_189454.json:
```json
{
    "body": "These seem unused:\n\n```\n# used by cython.py\n_add_variable_or_fallback('SINGULAR_INCLUDEDIR', opj('$SAGE_LOCAL','include','singular'))\n_add_variable_or_fallback('FACTORY_INCLUDEDIR',  opj('$SAGE_LOCAL','include','factory'))\n```\n",
    "created_at": "2016-10-03T13:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189454",
    "user": "https://github.com/jdemeyer"
}
```

These seem unused:

```
# used by cython.py
_add_variable_or_fallback('SINGULAR_INCLUDEDIR', opj('$SAGE_LOCAL','include','singular'))
_add_variable_or_fallback('FACTORY_INCLUDEDIR',  opj('$SAGE_LOCAL','include','factory'))
```




---

archive/issue_comments_189455.json:
```json
{
    "body": "Replace `CONWAY_DATA_DIR` by `CONWAY_POLYNOMIALS_DATA_DIR` because both the package and directory are named `conway_polynomials` and not just `conway`.",
    "created_at": "2016-10-03T13:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189455",
    "user": "https://github.com/jdemeyer"
}
```

Replace `CONWAY_DATA_DIR` by `CONWAY_POLYNOMIALS_DATA_DIR` because both the package and directory are named `conway_polynomials` and not just `conway`.



---

archive/issue_comments_189456.json:
```json
{
    "body": "Replying to [comment:56 jdemeyer]:\n> Replace `GAP_DATA_DIR` with `GAP_DIR`. It's not a data dir, it's the installation directory of the whole GAP package.\n\nthanks for the feedback.\n\nwhat do you mean by 'installation directory of the whole GAP package'? the prefix?\n\nnote that the datadir (ought to be platform independent!) usually/generally/commonly not hardcoded to the prefix, hence the different name.",
    "created_at": "2016-10-03T14:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189456",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:56 jdemeyer]:
> Replace `GAP_DATA_DIR` with `GAP_DIR`. It's not a data dir, it's the installation directory of the whole GAP package.

thanks for the feedback.

what do you mean by 'installation directory of the whole GAP package'? the prefix?

note that the datadir (ought to be platform independent!) usually/generally/commonly not hardcoded to the prefix, hence the different name.



---

archive/issue_comments_189457.json:
```json
{
    "body": "Replying to [comment:61 felixs]:\n> what do you mean by 'installation directory of the whole GAP package'? the prefix?\n\nGAP has an unusual installation process, it doesn't really have a prefix in the usual sense.",
    "created_at": "2016-10-03T15:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189457",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:61 felixs]:
> what do you mean by 'installation directory of the whole GAP package'? the prefix?

GAP has an unusual installation process, it doesn't really have a prefix in the usual sense.



---

archive/issue_comments_189458.json:
```json
{
    "body": "Replying to [comment:62 jdemeyer]:\n> GAP has an unusual installation process, it doesn't really have a prefix in the usual sense.\n\nso, it's not prefix (it does not seem relevant, does it?).\n\npaths are subject to the conventions and standards on particular platforms (e.g. FSH), not to an \"unusual installation process\". package data usually goes to /usr/share/$packagename, and thats where i can find the gap data on my platform. hence, here, /usr/share/gap is GAP_DATA_DIR, and not GAP_DIR as you suggest.\n\n(on a different platform it might be in a different place, but it's still \"the place where the gap data is).",
    "created_at": "2016-10-03T15:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189458",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:62 jdemeyer]:
> GAP has an unusual installation process, it doesn't really have a prefix in the usual sense.

so, it's not prefix (it does not seem relevant, does it?).

paths are subject to the conventions and standards on particular platforms (e.g. FSH), not to an "unusual installation process". package data usually goes to /usr/share/$packagename, and thats where i can find the gap data on my platform. hence, here, /usr/share/gap is GAP_DATA_DIR, and not GAP_DIR as you suggest.

(on a different platform it might be in a different place, but it's still "the place where the gap data is).



---

archive/issue_comments_189459.json:
```json
{
    "body": "For reference, I believe Felix is referring to https://www.gnu.org/prep/standards/standards.html#Directory-Variables\nand https://www.gnu.org/software/automake/manual/automake.html#Uniform",
    "created_at": "2016-10-03T18:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189459",
    "user": "https://github.com/mkoeppe"
}
```

For reference, I believe Felix is referring to https://www.gnu.org/prep/standards/standards.html#Directory-Variables
and https://www.gnu.org/software/automake/manual/automake.html#Uniform



---

archive/issue_comments_189460.json:
```json
{
    "body": "yes. and not just GNU, see https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard",
    "created_at": "2016-10-03T19:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189460",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

yes. and not just GNU, see https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard



---

archive/issue_comments_189461.json:
```json
{
    "body": "Replying to [comment:63 felixs]:\n> package data usually goes to /usr/share/$packagename, and thats where i can find the gap data on my platform.\n\nWhat do you mean with \"gap data\"?\n\nAnyway, where **your distro** installs GAP does not matter. We are working on Sage here, and `$SAGE_LOCAL/gap/latest` is the directory where GAP as a whole is installed. It's not a directory containing data files, so `GAP_DATA_DIR` is a bad name.",
    "created_at": "2016-10-03T20:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189461",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:63 felixs]:
> package data usually goes to /usr/share/$packagename, and thats where i can find the gap data on my platform.

What do you mean with "gap data"?

Anyway, where **your distro** installs GAP does not matter. We are working on Sage here, and `$SAGE_LOCAL/gap/latest` is the directory where GAP as a whole is installed. It's not a directory containing data files, so `GAP_DATA_DIR` is a bad name.



---

archive/issue_comments_189462.json:
```json
{
    "body": "Replying to [comment:63 felixs]:\n> paths are subject to the conventions and standards on particular platforms (e.g. FSH), not to an \"unusual installation process\".\n\nAccept the current reality: GAP has an \"unusual installation process\". We should use names which refer to the reality, not to some standard which doesn't apply for GAP.",
    "created_at": "2016-10-03T20:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189462",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:63 felixs]:
> paths are subject to the conventions and standards on particular platforms (e.g. FSH), not to an "unusual installation process".

Accept the current reality: GAP has an "unusual installation process". We should use names which refer to the reality, not to some standard which doesn't apply for GAP.



---

archive/issue_comments_189463.json:
```json
{
    "body": "Replying to [comment:66 jdemeyer]:\n> What do you mean with \"gap data\"?\n\nthe platform independent data files shipped with (\"installed by\", \"included in\", \"belonging to\") the gap package.",
    "created_at": "2016-10-03T21:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189463",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:66 jdemeyer]:
> What do you mean with "gap data"?

the platform independent data files shipped with ("installed by", "included in", "belonging to") the gap package.



---

archive/issue_comments_189464.json:
```json
{
    "body": "I agree with Jeroen that the current practice of the GAP installation cannot be described in terms of standards. Let's call it \"unusual\" in writing.\n\nDo we know how distributions like Debian handle GAP?",
    "created_at": "2016-10-03T21:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189464",
    "user": "https://github.com/mkoeppe"
}
```

I agree with Jeroen that the current practice of the GAP installation cannot be described in terms of standards. Let's call it "unusual" in writing.

Do we know how distributions like Debian handle GAP?



---

archive/issue_comments_189465.json:
```json
{
    "body": "> Do we know how distributions like Debian handle GAP?\n\non debian (and derivatives), you can find the platform independent gap data files in /usr/share/gap.",
    "created_at": "2016-10-03T22:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189465",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

> Do we know how distributions like Debian handle GAP?

on debian (and derivatives), you can find the platform independent gap data files in /usr/share/gap.



---

archive/issue_comments_189466.json:
```json
{
    "body": "Jeroen, Felix: I don't have time to look into any specifics with GAP, but I would suggest that the directory variables are defined and named in a way that works both with \n- with the status quo of how the Sage spkg installs GAP into `$SAGE_LOCAL`, \n- and with the way how a distribution such as Debian installs GAP into `/usr`.\n\nOn the other hand, if there's a wish to change the way how the Sage spkg install GAP, then that clearly belongs on a different ticket (please open it if it does not exist yet), not on this one.",
    "created_at": "2016-10-04T00:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189466",
    "user": "https://github.com/mkoeppe"
}
```

Jeroen, Felix: I don't have time to look into any specifics with GAP, but I would suggest that the directory variables are defined and named in a way that works both with 
- with the status quo of how the Sage spkg installs GAP into `$SAGE_LOCAL`, 
- and with the way how a distribution such as Debian installs GAP into `/usr`.

On the other hand, if there's a wish to change the way how the Sage spkg install GAP, then that clearly belongs on a different ticket (please open it if it does not exist yet), not on this one.



---

archive/issue_comments_189467.json:
```json
{
    "body": "Replying to [comment:68 felixs]:\n> Replying to [comment:66 jdemeyer]:\n> > What do you mean with \"gap data\"?\n> \n> the platform independent data files shipped with (\"installed by\", \"included in\", \"belonging to\") the gap package.\n\nRight. With that definition, `$SAGE_LOCAL/gap/latest` is **not** the GAP data dir so `GAP_DATA_DIR` is a bad name.",
    "created_at": "2016-10-04T06:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189467",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:68 felixs]:
> Replying to [comment:66 jdemeyer]:
> > What do you mean with "gap data"?
> 
> the platform independent data files shipped with ("installed by", "included in", "belonging to") the gap package.

Right. With that definition, `$SAGE_LOCAL/gap/latest` is **not** the GAP data dir so `GAP_DATA_DIR` is a bad name.



---

archive/issue_comments_189468.json:
```json
{
    "body": "> GAP_DATA_DIR is a bad name. \n\nno it's not. it specifies the location of the (platform indepentdent static, package specific) data shipped with the gap package. it's meant to be used to lead to exactly that. no more, no less.\n\ni really don't see your problem here, Jeroen. can you explain what you want to use GAP_DIR for?\n\nif you intend to use GAP)DIR for something other than the (platform indepentdent static, package specific) gap data, then you will break a standard FHS install. i know you are against standards, but why would you want that terrible implicit breakage here?\n\nmkoeppe: no, nobody said the spkg needs to be changed, and in fact it does not have to.",
    "created_at": "2016-10-04T07:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189468",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

> GAP_DATA_DIR is a bad name. 

no it's not. it specifies the location of the (platform indepentdent static, package specific) data shipped with the gap package. it's meant to be used to lead to exactly that. no more, no less.

i really don't see your problem here, Jeroen. can you explain what you want to use GAP_DIR for?

if you intend to use GAP)DIR for something other than the (platform indepentdent static, package specific) gap data, then you will break a standard FHS install. i know you are against standards, but why would you want that terrible implicit breakage here?

mkoeppe: no, nobody said the spkg needs to be changed, and in fact it does not have to.



---

archive/issue_comments_189469.json:
```json
{
    "body": "Replying to [comment:73 felixs]:\n> i know you are against standards\n\nPlease read https://en.wikipedia.org/wiki/Ad_hominem\n\nI am not against standards, I am against denying reality. If the current reality is that GAP is not installed following the FHS standards, then we should just accept that fact.",
    "created_at": "2016-10-04T07:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189469",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:73 felixs]:
> i know you are against standards

Please read https://en.wikipedia.org/wiki/Ad_hominem

I am not against standards, I am against denying reality. If the current reality is that GAP is not installed following the FHS standards, then we should just accept that fact.



---

archive/issue_comments_189470.json:
```json
{
    "body": "Replying to [comment:48 felixs]:\n> > Now I am curious as to why sage.env is not the right place for runtime variables\n> \n> because it breaks modularity. the core library should not have to know about extensions.\n> \n> or the other way: there should be a way to extend sage/sagelib by merely installing something. then GRAPH_DATA (as well as some others listed in sage.env), should use that mechanism.\n> \n> another remark: this is not just about environment variables. an extension should possibly add *anything*. but environment might be a good example, then generalize.\n> \n> > for now [..] throwing everything in sage.env is appropriate. \n> \n> agreed.\n\nOK your new requirements and goals are different from the ones that lead to the emergence of `env.py`. I can accept that we have to move on to a new state at some point in the future.",
    "created_at": "2016-10-04T07:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189470",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:48 felixs]:
> > Now I am curious as to why sage.env is not the right place for runtime variables
> 
> because it breaks modularity. the core library should not have to know about extensions.
> 
> or the other way: there should be a way to extend sage/sagelib by merely installing something. then GRAPH_DATA (as well as some others listed in sage.env), should use that mechanism.
> 
> another remark: this is not just about environment variables. an extension should possibly add *anything*. but environment might be a good example, then generalize.
> 
> > for now [..] throwing everything in sage.env is appropriate. 
> 
> agreed.

OK your new requirements and goals are different from the ones that lead to the emergence of `env.py`. I can accept that we have to move on to a new state at some point in the future.



---

archive/issue_comments_189471.json:
```json
{
    "body": "The current `gap` situation is a hack at best. The problem is that `gap` doesn't have a real install target. So everything is copied in a versioned folder in`SAGE_LOCAL/gap/gap-$version` and then it is linked to `SAGE_LOCAL/gap/latest`. Clean in that it is all in its own container that you can delete afterwards.\n\nI would imagine that debian does something like I do in Gentoo. Shoves most of the stuff under `/usr/lib{,64}/gap` with appropriate links or script in standard location pointing there. In that scheme GAP_DATA_DIR is `/usr/lib{,64}/gap/pkg` although some of the databases live under `/usr/lib{,64}/gap` directly.\n\nThere is a lot to do upstream to get `gap` to install nicely in any kind of fashion. In my latest ebuild I have been quite drastic compared to what sage does or previous version of my own ebuilds. So for the foreseeable future `gap` will remain a hack and I think `GAP_DIR` is more apt than `GAP_DATA_DIR`.",
    "created_at": "2016-10-04T08:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189471",
    "user": "https://github.com/kiwifb"
}
```

The current `gap` situation is a hack at best. The problem is that `gap` doesn't have a real install target. So everything is copied in a versioned folder in`SAGE_LOCAL/gap/gap-$version` and then it is linked to `SAGE_LOCAL/gap/latest`. Clean in that it is all in its own container that you can delete afterwards.

I would imagine that debian does something like I do in Gentoo. Shoves most of the stuff under `/usr/lib{,64}/gap` with appropriate links or script in standard location pointing there. In that scheme GAP_DATA_DIR is `/usr/lib{,64}/gap/pkg` although some of the databases live under `/usr/lib{,64}/gap` directly.

There is a lot to do upstream to get `gap` to install nicely in any kind of fashion. In my latest ebuild I have been quite drastic compared to what sage does or previous version of my own ebuilds. So for the foreseeable future `gap` will remain a hack and I think `GAP_DIR` is more apt than `GAP_DATA_DIR`.



---

archive/issue_comments_189472.json:
```json
{
    "body": "Replying to [comment:76 fbissey]:\n> I would imagine that debian does something like I do in Gentoo.\n\nwith all do respect, you got it wrong.\n\non debian, the (platform indepentdent static, package specific) gap data goes to /usr/share/gap\n\n> Shoves most of the stuff under `/usr/lib{,64}/gap` with appropriate links or script in standard location pointing there. In that scheme GAP_DATA_DIR is `/usr/lib{,64}/gap/pkg` although some of the databases live under `/usr/lib{,64}/gap` directly.\n\nnot quite. /usr/lib is for platform dependent stuff. that's why you need lib{32,64} but only shared (not shared{32,64}). GAP_DATA_DIR is about *platform independent data*.\n\n> There is a lot to do upstream to get `gap` to install nicely in any kind of fashion.\n\nwrong again. you can install gap any way you like, despite the broken build/install system\n\n> I think `GAP_DIR` is more apt than `GAP_DATA_DIR`.\n\nnow with three wrong premises, you end up on the wrong track.\n\ninstead, you could (plan to) fix the gap ebuild to adhere to FHS, as most other gentoo packages do.\n\nReplying to Jeroen\n> I am not against standards (... but)\n\ni feel the need for a gowdin's style law for this sentence, but it's not there. so i will better stop posting here now.",
    "created_at": "2016-10-04T08:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189472",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:76 fbissey]:
> I would imagine that debian does something like I do in Gentoo.

with all do respect, you got it wrong.

on debian, the (platform indepentdent static, package specific) gap data goes to /usr/share/gap

> Shoves most of the stuff under `/usr/lib{,64}/gap` with appropriate links or script in standard location pointing there. In that scheme GAP_DATA_DIR is `/usr/lib{,64}/gap/pkg` although some of the databases live under `/usr/lib{,64}/gap` directly.

not quite. /usr/lib is for platform dependent stuff. that's why you need lib{32,64} but only shared (not shared{32,64}). GAP_DATA_DIR is about *platform independent data*.

> There is a lot to do upstream to get `gap` to install nicely in any kind of fashion.

wrong again. you can install gap any way you like, despite the broken build/install system

> I think `GAP_DIR` is more apt than `GAP_DATA_DIR`.

now with three wrong premises, you end up on the wrong track.

instead, you could (plan to) fix the gap ebuild to adhere to FHS, as most other gentoo packages do.

Replying to Jeroen
> I am not against standards (... but)

i feel the need for a gowdin's style law for this sentence, but it's not there. so i will better stop posting here now.



---

archive/issue_comments_189473.json:
```json
{
    "body": "I certainly could improve things, thanks for pointing stuff out [although using /usr/share/gap means patching, I guess debian has the patch I am thinking about]. The main point here is that installing gap in a proper way is a lot of hand holding. debian and gentoo have a proper package management system - which track files belonging to a package so upgrading or otherwise changing the package version is clean. \n\nsagemath on the other hand only installs and \"uninstall\" manually where we can/have to [I guess there are `pip` packages now and we know what happened with those in another ticket ;) ]. What I am getting at, is that sagemath's packaging system is not sophisticated enough to deal with the hand holding when changing version. Lots of work.\n\nFeel free to improve `gap`'s installation (without forgetting to make provision for upgrade) in another ticket.\n\nOnce it is done the discussion between `GAP_DATA_DIR` and `GAP_DIR` will be non-sensical. Should we wait until this is ready or should we move on with the current situation?",
    "created_at": "2016-10-04T09:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189473",
    "user": "https://github.com/kiwifb"
}
```

I certainly could improve things, thanks for pointing stuff out [although using /usr/share/gap means patching, I guess debian has the patch I am thinking about]. The main point here is that installing gap in a proper way is a lot of hand holding. debian and gentoo have a proper package management system - which track files belonging to a package so upgrading or otherwise changing the package version is clean. 

sagemath on the other hand only installs and "uninstall" manually where we can/have to [I guess there are `pip` packages now and we know what happened with those in another ticket ;) ]. What I am getting at, is that sagemath's packaging system is not sophisticated enough to deal with the hand holding when changing version. Lots of work.

Feel free to improve `gap`'s installation (without forgetting to make provision for upgrade) in another ticket.

Once it is done the discussion between `GAP_DATA_DIR` and `GAP_DIR` will be non-sensical. Should we wait until this is ready or should we move on with the current situation?



---

archive/issue_comments_189474.json:
```json
{
    "body": "Replying to [comment:73 felixs]:\n> > GAP_DATA_DIR is a bad name. \n> \n> no it's not. it specifies the location of the (platform indepentdent static, package specific) data shipped with the gap package. it's meant to be used to lead to exactly that. no more, no less.\n\nI agree with Felix here.  I don't care how gap happens to be installed in Sage.  The use that variable is to find where the GAP data lives (which in Sage, which I guess obeys GAP's \"unusual\" installation, happens to be the directory where all of GAP is installed).  On a different platform the two are not necessarily the same.",
    "created_at": "2016-10-04T09:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189474",
    "user": "https://github.com/embray"
}
```

Replying to [comment:73 felixs]:
> > GAP_DATA_DIR is a bad name. 
> 
> no it's not. it specifies the location of the (platform indepentdent static, package specific) data shipped with the gap package. it's meant to be used to lead to exactly that. no more, no less.

I agree with Felix here.  I don't care how gap happens to be installed in Sage.  The use that variable is to find where the GAP data lives (which in Sage, which I guess obeys GAP's "unusual" installation, happens to be the directory where all of GAP is installed).  On a different platform the two are not necessarily the same.



---

archive/issue_comments_189475.json:
```json
{
    "body": "Replying to [comment:79 embray]:\n> The use [of] that variable is to find where the GAP data lives\n\nDo you have evidence for this claim? Because this statement is the crux of the discussion.\n\nEdit: if the above claim is indeed correct, I totally agree that `GAP_DATA_DIR` is a good name.",
    "created_at": "2016-10-04T10:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189475",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:79 embray]:
> The use [of] that variable is to find where the GAP data lives

Do you have evidence for this claim? Because this statement is the crux of the discussion.

Edit: if the above claim is indeed correct, I totally agree that `GAP_DATA_DIR` is a good name.



---

archive/issue_comments_189476.json:
```json
{
    "body": "Anyway, back to reality: `$SAGE_LOCAL/gap/latest` is what GAP calls a [GAP Root Directory](http://www.gap-system.org/Manuals/doc/ref/chap9.html#X7A4973627A5DB27D). It seems to be used for everything, not just \"data files\".",
    "created_at": "2016-10-04T10:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189476",
    "user": "https://github.com/jdemeyer"
}
```

Anyway, back to reality: `$SAGE_LOCAL/gap/latest` is what GAP calls a [GAP Root Directory](http://www.gap-system.org/Manuals/doc/ref/chap9.html#X7A4973627A5DB27D). It seems to be used for everything, not just "data files".



---

archive/issue_comments_189477.json:
```json
{
    "body": "Replying to [comment:80 jdemeyer]:\n> Replying to [comment:79 embray]:\n> > The use [of] that variable is to find where the GAP data lives\n> \n> Do you have evidence for this claim? Because this statement is the crux of the discussion.\n> \n> Edit: if the above claim is indeed correct, I totally agree that `GAP_DATA_DIR` is a good name.\n\nIt seems to me all this argument might be for not much then.  It seems to me all it's really used for is in the utility function `gap_root()`, which itself is not actually used anywhere in Sage (which is not to say nobody uses it for something).\n\nPerhaps we can call it `GAP_ROOT_DIR` for now and leave it at that.  Distros that try to break GAP up into a standard hierarchy would have to have their own definition of what `GAP_ROOT_DIR` means I guess.\n\nAgreed with all of Jeroen's other comments from before the `GAP_DIR` argument--I don't at all understand the issue with `default.qepcadrc` but I'll have a closer look.",
    "created_at": "2016-10-04T10:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189477",
    "user": "https://github.com/embray"
}
```

Replying to [comment:80 jdemeyer]:
> Replying to [comment:79 embray]:
> > The use [of] that variable is to find where the GAP data lives
> 
> Do you have evidence for this claim? Because this statement is the crux of the discussion.
> 
> Edit: if the above claim is indeed correct, I totally agree that `GAP_DATA_DIR` is a good name.

It seems to me all this argument might be for not much then.  It seems to me all it's really used for is in the utility function `gap_root()`, which itself is not actually used anywhere in Sage (which is not to say nobody uses it for something).

Perhaps we can call it `GAP_ROOT_DIR` for now and leave it at that.  Distros that try to break GAP up into a standard hierarchy would have to have their own definition of what `GAP_ROOT_DIR` means I guess.

Agreed with all of Jeroen's other comments from before the `GAP_DIR` argument--I don't at all understand the issue with `default.qepcadrc` but I'll have a closer look.



---

archive/issue_comments_189478.json:
```json
{
    "body": "Replying to [comment:82 embray]:\n> It seems to me all it's really used for is in the utility function `gap_root()`, which itself is not actually used anywhere in Sage (which is not to say nobody uses it for something).\n\nIt is used to initialize libGAP. From `src/sage/libs/gap/util.pyx`:\n\n```cython\ncdef initialize():\n    \"\"\"\n    Initialize the GAP library, if it hasn't already been\n    initialized.  It is safe to call this multiple times.\n\n    TESTS::\n\n        sage: libgap(123)   # indirect doctest\n        123\n    \"\"\"\n    global _gap_is_initialized\n    if _gap_is_initialized: return\n\n    # Define argv and environ variables, which we will pass in to\n    # initialize GAP. Note that we must pass define the memory pool\n    # size!\n    cdef char* argv[14]\n    argv[0] = \"sage\"\n    argv[1] = \"-l\"\n    s = gap_root()\n    argv[2] = s\n```\n",
    "created_at": "2016-10-06T14:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189478",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:82 embray]:
> It seems to me all it's really used for is in the utility function `gap_root()`, which itself is not actually used anywhere in Sage (which is not to say nobody uses it for something).

It is used to initialize libGAP. From `src/sage/libs/gap/util.pyx`:

```cython
cdef initialize():
    """
    Initialize the GAP library, if it hasn't already been
    initialized.  It is safe to call this multiple times.

    TESTS::

        sage: libgap(123)   # indirect doctest
        123
    """
    global _gap_is_initialized
    if _gap_is_initialized: return

    # Define argv and environ variables, which we will pass in to
    # initialize GAP. Note that we must pass define the memory pool
    # size!
    cdef char* argv[14]
    argv[0] = "sage"
    argv[1] = "-l"
    s = gap_root()
    argv[2] = s
```




---

archive/issue_comments_189479.json:
```json
{
    "body": "That makes sense, obviously.  Not sure how my grepping missed that.",
    "created_at": "2016-10-07T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189479",
    "user": "https://github.com/embray"
}
```

That makes sense, obviously.  Not sure how my grepping missed that.



---

archive/issue_comments_189480.json:
```json
{
    "body": "Cc'ing some people who worked on libgap (#6391) in the hope that we can settle the GAP_DIR / GAP_ROOT_DIR / GAP_DATA_DIR question and move this ticket forward.",
    "created_at": "2016-10-11T20:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189480",
    "user": "https://github.com/mkoeppe"
}
```

Cc'ing some people who worked on libgap (#6391) in the hope that we can settle the GAP_DIR / GAP_ROOT_DIR / GAP_DATA_DIR question and move this ticket forward.



---

archive/issue_comments_189481.json:
```json
{
    "body": "Replying to [comment:85 mkoeppe]:\n> Cc'ing some people who worked on libgap (#6391) in the hope that we can settle the GAP_DIR / GAP_ROOT_DIR / GAP_DATA_DIR question and move this ticket forward.\n\nOK, so what is your proposal in this regard? GAP suffers from the same \"missing `install` target\" illness as Sage....",
    "created_at": "2016-10-11T20:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189481",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:85 mkoeppe]:
> Cc'ing some people who worked on libgap (#6391) in the hope that we can settle the GAP_DIR / GAP_ROOT_DIR / GAP_DATA_DIR question and move this ticket forward.

OK, so what is your proposal in this regard? GAP suffers from the same "missing `install` target" illness as Sage....



---

archive/issue_comments_189482.json:
```json
{
    "body": "We are looking for the correct naming of the variable that holds the directory passed to libgap at initialization time.\nThe naming should make sense both for GAP's traditional (upstream) installation and for Debian's or other distributions' cleaned up installation.",
    "created_at": "2016-10-11T20:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189482",
    "user": "https://github.com/mkoeppe"
}
```

We are looking for the correct naming of the variable that holds the directory passed to libgap at initialization time.
The naming should make sense both for GAP's traditional (upstream) installation and for Debian's or other distributions' cleaned up installation.



---

archive/issue_comments_189483.json:
```json
{
    "body": "Replying to [comment:87 mkoeppe]:\n> We are looking for the correct naming of the variable that holds the directory passed to libgap at initialization time.\n> The naming should make sense both for GAP's traditional (upstream) installation and for Debian's or other distributions' cleaned up installation.\n\nlibGAP is a purely Sage affair, there is no real upstream, so there is no \"tradition\" in this sense.",
    "created_at": "2016-10-11T21:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189483",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:87 mkoeppe]:
> We are looking for the correct naming of the variable that holds the directory passed to libgap at initialization time.
> The naming should make sense both for GAP's traditional (upstream) installation and for Debian's or other distributions' cleaned up installation.

libGAP is a purely Sage affair, there is no real upstream, so there is no "tradition" in this sense.



---

archive/issue_comments_189484.json:
```json
{
    "body": "but libgap does seem to depend on GAP's installation, no?",
    "created_at": "2016-10-11T22:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189484",
    "user": "https://github.com/mkoeppe"
}
```

but libgap does seem to depend on GAP's installation, no?



---

archive/issue_comments_189485.json:
```json
{
    "body": "Replying to [comment:89 mkoeppe]:\n> but libgap does seem to depend on GAP's installation, no? \n\nyes it does, sure, as enshrined in `build/pkgs/libgap/dependencies`",
    "created_at": "2016-10-11T22:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189485",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:89 mkoeppe]:
> but libgap does seem to depend on GAP's installation, no? 

yes it does, sure, as enshrined in `build/pkgs/libgap/dependencies`



---

archive/issue_comments_189486.json:
```json
{
    "body": "Replying to [comment:89 mkoeppe]:\n> but libgap does seem to depend on GAP's installation, no? \n\nIt absolutely does. In fact it needs to know where gap packages are if it want to use them. So it really need what gap calls `GAP_ROOT_DIR`.",
    "created_at": "2016-10-11T22:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189486",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:89 mkoeppe]:
> but libgap does seem to depend on GAP's installation, no? 

It absolutely does. In fact it needs to know where gap packages are if it want to use them. So it really need what gap calls `GAP_ROOT_DIR`.



---

archive/issue_comments_189487.json:
```json
{
    "body": "The Debian/Ubuntu gap package splits the gap installation into `/usr/lib/gap` and `/usr/share/gap`. \n\n```\nroot@2f38a5ed7694:/src# ls -l /usr/lib/gap\ntotal 8\ndrwxr-xr-x 2 root root 4096 Oct 27 23:24 bin\nlrwxrwxrwx 1 root root   17 Jun 18  2015 src -> ../../include/gap\n-rw-r--r-- 1 root root  110 Jun 18  2015 sysinfo.gap\nroot@2f38a5ed7694:/src# ls -l /usr/share/gap\ntotal 56\ndrwxr-xr-x 5 root root  4096 Oct 27 23:24 doc\ndrwxr-xr-x 2 root root  4096 Oct 27 23:24 etc\ndrwxr-xr-x 2 root root  4096 Oct 27 23:24 grp\ndrwxr-xr-x 2 root root 20480 Oct 27 23:24 lib\ndrwxr-xr-x 3 root root  4096 Oct 27 23:24 pkg\ndrwxr-xr-x 3 root root  4096 Oct 27 23:24 prim\ndrwxr-xr-x 4 root root  4096 Oct 27 23:24 small\nlrwxrwxrwx 1 root root    25 Jun 18  2015 sysinfo.gap -> ../../lib/gap/sysinfo.gap\ndrwxr-xr-x 2 root root 12288 Oct 27 23:24 trans\n```\n\nI did a quick check of building libgap using the gap package on Ubuntu. The relevant directory for libgap seems to be `/usr/share/gap`.",
    "created_at": "2016-10-28T00:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189487",
    "user": "https://github.com/mkoeppe"
}
```

The Debian/Ubuntu gap package splits the gap installation into `/usr/lib/gap` and `/usr/share/gap`. 

```
root@2f38a5ed7694:/src# ls -l /usr/lib/gap
total 8
drwxr-xr-x 2 root root 4096 Oct 27 23:24 bin
lrwxrwxrwx 1 root root   17 Jun 18  2015 src -> ../../include/gap
-rw-r--r-- 1 root root  110 Jun 18  2015 sysinfo.gap
root@2f38a5ed7694:/src# ls -l /usr/share/gap
total 56
drwxr-xr-x 5 root root  4096 Oct 27 23:24 doc
drwxr-xr-x 2 root root  4096 Oct 27 23:24 etc
drwxr-xr-x 2 root root  4096 Oct 27 23:24 grp
drwxr-xr-x 2 root root 20480 Oct 27 23:24 lib
drwxr-xr-x 3 root root  4096 Oct 27 23:24 pkg
drwxr-xr-x 3 root root  4096 Oct 27 23:24 prim
drwxr-xr-x 4 root root  4096 Oct 27 23:24 small
lrwxrwxrwx 1 root root    25 Jun 18  2015 sysinfo.gap -> ../../lib/gap/sysinfo.gap
drwxr-xr-x 2 root root 12288 Oct 27 23:24 trans
```

I did a quick check of building libgap using the gap package on Ubuntu. The relevant directory for libgap seems to be `/usr/share/gap`.



---

archive/issue_comments_189488.json:
```json
{
    "body": "I've split out some commits to #21783 and #21784.\n\nRebased the remaining commits on top of 7.5.beta0.\n----\nNew commits:",
    "created_at": "2016-10-30T05:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189488",
    "user": "https://github.com/mkoeppe"
}
```

I've split out some commits to #21783 and #21784.

Rebased the remaining commits on top of 7.5.beta0.
----
New commits:



---

archive/issue_comments_189489.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-30T05:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189489",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_189490.json:
```json
{
    "body": "Many of my comments starting with [comment:56] have not been taken into account.",
    "created_at": "2016-10-31T08:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189490",
    "user": "https://github.com/jdemeyer"
}
```

Many of my comments starting with [comment:56] have not been taken into account.



---

archive/issue_comments_189491.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-31T08:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189491",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_189492.json:
```json
{
    "body": "Replying to [comment:91 fbissey]:\n> It absolutely does. In fact it needs to know where gap packages are if it want to use them. So it really need what gap calls `GAP_ROOT_DIR`. \n\n`GAP_ROOT_DIR` would indeed be a much better name than the misleading `GAP_DATA_DIR`.",
    "created_at": "2016-11-01T08:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189492",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:91 fbissey]:
> It absolutely does. In fact it needs to know where gap packages are if it want to use them. So it really need what gap calls `GAP_ROOT_DIR`. 

`GAP_ROOT_DIR` would indeed be a much better name than the misleading `GAP_DATA_DIR`.



---

archive/issue_comments_189493.json:
```json
{
    "body": "There are also doctest failures (see patchbot).\n\nWhy was this ticket set to needs_review?",
    "created_at": "2016-11-01T08:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189493",
    "user": "https://github.com/jdemeyer"
}
```

There are also doctest failures (see patchbot).

Why was this ticket set to needs_review?



---

archive/issue_comments_189494.json:
```json
{
    "body": "Someone insists on importing variables from `sage.misc.misc` instead of `sage.env` ergo doctest failures.",
    "created_at": "2016-11-01T08:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189494",
    "user": "https://github.com/kiwifb"
}
```

Someone insists on importing variables from `sage.misc.misc` instead of `sage.env` ergo doctest failures.



---

archive/issue_comments_189495.json:
```json
{
    "body": "Right, I set `needs_review` by mistake.",
    "created_at": "2016-11-01T21:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189495",
    "user": "https://github.com/mkoeppe"
}
```

Right, I set `needs_review` by mistake.



---

archive/issue_comments_189496.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-01T21:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189496",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189497.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-01T21:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189497",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_189498.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-02T01:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189499.json:
```json
{
    "body": "Replying to [comment:78 fbissey]:\n>  using /usr/share/gap means patching, I guess debian has the patch I am thinking about\n\nI've created ticket #21796 for adopting Debian's layout of GAP.",
    "created_at": "2016-11-02T01:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189499",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:78 fbissey]:
>  using /usr/share/gap means patching, I guess debian has the patch I am thinking about

I've created ticket #21796 for adopting Debian's layout of GAP.



---

archive/issue_comments_189500.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-02T01:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189500",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_189501.json:
```json
{
    "body": "The present ticket now passes doctests (on my machine), and I believe I have taken care of the various comments.\n\nNeeds review.",
    "created_at": "2016-11-02T01:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189501",
    "user": "https://github.com/mkoeppe"
}
```

The present ticket now passes doctests (on my machine), and I believe I have taken care of the various comments.

Needs review.



---

archive/issue_comments_189502.json:
```json
{
    "body": "Replying to [comment:104 mkoeppe]:\n> The present ticket now passes doctests (on my machine), and I believe I have taken care of the various comments.\n\nTwo more details:\n\n1. in `src/sage/env.py`, remove\n\n```\nUNAME = os.uname()[0]\n```\n\nas `UNAME` is actually one of the standard variables.\n\n2. In `src/sage/libs/gap/util.pyx`, remove `gapdir = GAP_ROOT_DIR` and just use `GAP_ROOT_DIR` instead of `gapdir`.\n\nIf you fix these and all tests pass, then this can be set to positive_review.",
    "created_at": "2016-11-02T09:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189502",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:104 mkoeppe]:
> The present ticket now passes doctests (on my machine), and I believe I have taken care of the various comments.

Two more details:

1. in `src/sage/env.py`, remove

```
UNAME = os.uname()[0]
```

as `UNAME` is actually one of the standard variables.

2. In `src/sage/libs/gap/util.pyx`, remove `gapdir = GAP_ROOT_DIR` and just use `GAP_ROOT_DIR` instead of `gapdir`.

If you fix these and all tests pass, then this can be set to positive_review.



---

archive/issue_comments_189503.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-02T09:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189503",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_189504.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-03T04:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_189505.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-03T04:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189505",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_189506.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-04T13:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189506",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_189507.json:
```json
{
    "body": "thank you guys for making that happen.",
    "created_at": "2016-11-04T13:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189507",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

thank you guys for making that happen.



---

archive/issue_comments_189508.json:
```json
{
    "body": "Replying to [comment:110 felixs]:\n> thank you guys for making that happen.\n\nWell, we did postpone all controversial changes to other tickets :-)",
    "created_at": "2016-11-04T13:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189508",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:110 felixs]:
> thank you guys for making that happen.

Well, we did postpone all controversial changes to other tickets :-)



---

archive/issue_comments_189509.json:
```json
{
    "body": "Let me mention one more follow-up: #21821",
    "created_at": "2016-11-04T15:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189509",
    "user": "https://github.com/jdemeyer"
}
```

Let me mention one more follow-up: #21821



---

archive/issue_comments_189510.json:
```json
{
    "body": "Now that it has made it onto Volker's branch and I can see easily how it interact with sage-on-gentoo, I feel sorry about all that `GAP_ROOT_DIR` business.\n\nWe should just have eliminated it because it is totally unnecessary. The variable is only used in `sage/libs/gap/util.pyx` in the function `gap_root` which basically return the value of `GAP_ROOT_DIR`\n\n```\ndef gap_root():\n    \"\"\"\n    Find the location of the GAP root install which is stored in the gap\n    startup script.\n    EXAMPLES::\n        sage: from sage.libs.gap.util import gap_root\n        sage: gap_root()   # random output\n        '/home/vbraun/opt/sage-5.3.rc0/local/gap/latest'\n    \"\"\"\n    import os.path\n    if os.path.exists(GAP_ROOT_DIR):\n        return GAP_ROOT_DIR\n    print('The gap-4.5.5.spkg (or later) seems to be not installed!')\n    gap_sh = open(os.path.join(SAGE_LOCAL, 'bin', 'gap')).read().splitlines()\n    gapdir = filter(lambda dir:dir.strip().startswith('GAP_DIR'), gap_sh)[0]\n    gapdir = gapdir.split('\"')[1]\n    gapdir = gapdir.replace('$SAGE_LOCAL', SAGE_LOCAL)\n    return gapdir\n```\n\nSo if `GAP_ROOT_DIR` is not defined, a mwarning is issued and then the `gap` script is looked over for `GAP_DIR` which gives the right result both in Gentoo [sage-on-gentoo relies solely on the automated procedure] and in vanilla sage. Not sure about debian, I must say.\n\nBut I feel we were silly because the automated procedure works well so we don't really need the variable. And if we decide to use the variable, what is the point of keeping the function `gap_root`? Apart from searching for all the instances of `gap_root` to replace them that is.\n\nAnyway, that's a potential clean up for another ticket.",
    "created_at": "2016-11-06T20:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189510",
    "user": "https://github.com/kiwifb"
}
```

Now that it has made it onto Volker's branch and I can see easily how it interact with sage-on-gentoo, I feel sorry about all that `GAP_ROOT_DIR` business.

We should just have eliminated it because it is totally unnecessary. The variable is only used in `sage/libs/gap/util.pyx` in the function `gap_root` which basically return the value of `GAP_ROOT_DIR`

```
def gap_root():
    """
    Find the location of the GAP root install which is stored in the gap
    startup script.
    EXAMPLES::
        sage: from sage.libs.gap.util import gap_root
        sage: gap_root()   # random output
        '/home/vbraun/opt/sage-5.3.rc0/local/gap/latest'
    """
    import os.path
    if os.path.exists(GAP_ROOT_DIR):
        return GAP_ROOT_DIR
    print('The gap-4.5.5.spkg (or later) seems to be not installed!')
    gap_sh = open(os.path.join(SAGE_LOCAL, 'bin', 'gap')).read().splitlines()
    gapdir = filter(lambda dir:dir.strip().startswith('GAP_DIR'), gap_sh)[0]
    gapdir = gapdir.split('"')[1]
    gapdir = gapdir.replace('$SAGE_LOCAL', SAGE_LOCAL)
    return gapdir
```

So if `GAP_ROOT_DIR` is not defined, a mwarning is issued and then the `gap` script is looked over for `GAP_DIR` which gives the right result both in Gentoo [sage-on-gentoo relies solely on the automated procedure] and in vanilla sage. Not sure about debian, I must say.

But I feel we were silly because the automated procedure works well so we don't really need the variable. And if we decide to use the variable, what is the point of keeping the function `gap_root`? Apart from searching for all the instances of `gap_root` to replace them that is.

Anyway, that's a potential clean up for another ticket.



---

archive/issue_comments_189511.json:
```json
{
    "body": "Replying to [comment:113 fbissey]:\n>[...] I feel sorry about all that `GAP_ROOT_DIR` business.\n> We should just have eliminated it because it is totally unnecessary. The variable is only used in `sage/libs/gap/util.pyx` in the function `gap_root` which basically return the value of `GAP_ROOT_DIR` [...]\n> So if `GAP_ROOT_DIR` is not defined, a mwarning is issued and then the `gap` script is looked over for `GAP_DIR` which gives the right result both in Gentoo [sage-on-gentoo relies solely on the automated procedure] and in vanilla sage. \n\nYes, I saw this code. I think it does not belong into sagelib proper, but we should move it to compile-time configuration of sagelib (which would set the GAP_ROOT_DIR variable). So I do think that introducing the GAP_ROOT_DIR variable was a good step.",
    "created_at": "2016-11-06T20:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189511",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:113 fbissey]:
>[...] I feel sorry about all that `GAP_ROOT_DIR` business.
> We should just have eliminated it because it is totally unnecessary. The variable is only used in `sage/libs/gap/util.pyx` in the function `gap_root` which basically return the value of `GAP_ROOT_DIR` [...]
> So if `GAP_ROOT_DIR` is not defined, a mwarning is issued and then the `gap` script is looked over for `GAP_DIR` which gives the right result both in Gentoo [sage-on-gentoo relies solely on the automated procedure] and in vanilla sage. 

Yes, I saw this code. I think it does not belong into sagelib proper, but we should move it to compile-time configuration of sagelib (which would set the GAP_ROOT_DIR variable). So I do think that introducing the GAP_ROOT_DIR variable was a good step.



---

archive/issue_comments_189512.json:
```json
{
    "body": "A lot of stuff should be moved to \"configuration\" time proper. Definitely for another day. \n\nBut is there a point in having a variable when you can just query its value from the application itself? Plus that means we can further decouple `gap` from `sagelib`. We don't need to know anything about where `gap` is really installed, we get the right value so long as `gap` is in the `PATH`. In short eliminating that variable makes it easier to switch to a system install of `gap` (cross fingers about debian).",
    "created_at": "2016-11-06T21:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189512",
    "user": "https://github.com/kiwifb"
}
```

A lot of stuff should be moved to "configuration" time proper. Definitely for another day. 

But is there a point in having a variable when you can just query its value from the application itself? Plus that means we can further decouple `gap` from `sagelib`. We don't need to know anything about where `gap` is really installed, we get the right value so long as `gap` is in the `PATH`. In short eliminating that variable makes it easier to switch to a system install of `gap` (cross fingers about debian).



---

archive/issue_comments_189513.json:
```json
{
    "body": "OK at the moment we still need to know where the `gap` executable is located to populate `gap_sh` but that could be dealt with.",
    "created_at": "2016-11-06T21:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189513",
    "user": "https://github.com/kiwifb"
}
```

OK at the moment we still need to know where the `gap` executable is located to populate `gap_sh` but that could be dealt with.



---

archive/issue_comments_189514.json:
```json
{
    "body": "I wouldn't call parsing that script \"querying the application\"...",
    "created_at": "2016-11-06T21:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189514",
    "user": "https://github.com/mkoeppe"
}
```

I wouldn't call parsing that script "querying the application"...



---

archive/issue_comments_189515.json:
```json
{
    "body": "And, really, actually it belongs into libgap configuration.",
    "created_at": "2016-11-06T21:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189515",
    "user": "https://github.com/mkoeppe"
}
```

And, really, actually it belongs into libgap configuration.



---

archive/issue_comments_189516.json:
```json
{
    "body": "Have to agree, it is a `libgap` problem. Once sorted in `libgap` it is all moot.",
    "created_at": "2016-11-06T21:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189516",
    "user": "https://github.com/kiwifb"
}
```

Have to agree, it is a `libgap` problem. Once sorted in `libgap` it is all moot.



---

archive/issue_comments_189517.json:
```json
{
    "body": "I recently created a pull request for libgap in this direction: https://bitbucket.org/vbraun/libgap/pull-requests/9",
    "created_at": "2016-11-06T21:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189517",
    "user": "https://github.com/mkoeppe"
}
```

I recently created a pull request for libgap in this direction: https://bitbucket.org/vbraun/libgap/pull-requests/9



---

archive/issue_comments_189518.json:
```json
{
    "body": "Replying to [comment:115 fbissey]:\n> A lot of stuff should be moved to \"configuration\" time proper. Definitely for another day. \n> \n> But is there a point in having a variable when you can just query its value from the application itself?\n\nYes.  I can think of at least two reasons:\n\n1) Helpful for some system (not that I have one in mind) where the search code doesn't work--it's always kind to provide some way to configure an alternate path.\n\n2) For testing against alternate GAP installs.",
    "created_at": "2016-11-07T14:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189518",
    "user": "https://github.com/embray"
}
```

Replying to [comment:115 fbissey]:
> A lot of stuff should be moved to "configuration" time proper. Definitely for another day. 
> 
> But is there a point in having a variable when you can just query its value from the application itself?

Yes.  I can think of at least two reasons:

1) Helpful for some system (not that I have one in mind) where the search code doesn't work--it's always kind to provide some way to configure an alternate path.

2) For testing against alternate GAP installs.



---

archive/issue_comments_189519.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-07T18:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189519",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_014580.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-11-07T18:27:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14868#event-14580"
}
```



---

archive/issue_comments_189520.json:
```json
{
    "body": "Replying to [comment:121 embray]:\n> Replying to [comment:115 fbissey]:\n> > A lot of stuff should be moved to \"configuration\" time proper. Definitely for another day. \n> > \n> > But is there a point in having a variable when you can just query its value from the application itself?\n> \n> Yes.  I can think of at least two reasons:\n> \n> 1) Helpful for some system (not that I have one in mind) where the search code doesn't work--it's always kind to provide some way to configure an alternate path.\n> \n> 2) For testing against alternate GAP installs. \n\n1) a good case is probably cross compilation of some kind, where things will be available at runtime but not when you build.\n\n2) well I was thinking of asking `gap` directly (I have tested this) so the only requirement is for the `gap` executable to be in the `PATH`. However technically there is more than one valid path that should be looked up and libgap only look at one (the default system one).",
    "created_at": "2016-11-08T00:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14868#issuecomment-189520",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:121 embray]:
> Replying to [comment:115 fbissey]:
> > A lot of stuff should be moved to "configuration" time proper. Definitely for another day. 
> > 
> > But is there a point in having a variable when you can just query its value from the application itself?
> 
> Yes.  I can think of at least two reasons:
> 
> 1) Helpful for some system (not that I have one in mind) where the search code doesn't work--it's always kind to provide some way to configure an alternate path.
> 
> 2) For testing against alternate GAP installs. 

1) a good case is probably cross compilation of some kind, where things will be available at runtime but not when you build.

2) well I was thinking of asking `gap` directly (I have tested this) so the only requirement is for the `gap` executable to be in the `PATH`. However technically there is more than one valid path that should be looked up and libgap only look at one (the default system one).
