# Issue 22224: Implement cython() using cythonize()

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-02-27 14:17:16

CC:  thansen vdelecroix tscrim

This would ensure that `cython()` supports `# distutils` declarations. We should also deprecate the Sage-specific `#clang` and related directives.


---

Comment by jdemeyer created at 2017-04-29 10:41:35

Changing priority from major to critical.


---

Comment by jdemeyer created at 2017-09-07 12:18:27

Changing component from misc to cython.


---

Comment by jdemeyer created at 2017-09-07 15:25:21

New commits:


---

Comment by jdemeyer created at 2017-09-07 15:25:21

Changing status from new to needs_review.


---

Comment by git created at 2017-09-07 15:33:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2017-09-29 21:23:55

Needs rebase


---

Comment by tscrim created at 2017-09-29 21:23:55

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-09-29 22:12:18

No, it doesn't. You just need to apply the dependency.


---

Comment by jdemeyer created at 2017-09-29 22:12:24

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-09-29 22:15:30

Is there a policy about this by the way? When should a branch on Trac be merged with some other branch? Should the dependencies always be merged into the branch of a ticket? Or should we avoid useless merges? How much should we trust the Trac git plugin?


---

Comment by tscrim created at 2017-09-29 23:15:46

I don't think there is an official policy about this. In this case, I saw the closed dependency and the patchbot(s) also reporting merge conflicts. So didn't realize that #23799 was not merged in the latest beta. However, because there is (supposedly) a conflict, I think it would be good have a merge; in particular, it would allow the patchbot to test it. To contrast, I would not merge in if it was fixing an unconnected part such as failing doctests.


---

Comment by git created at 2017-09-30 13:16:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-09-30 13:17:32

#23799 merged (without merge conflicts)


---

Comment by jdemeyer created at 2017-09-30 13:18:10

Note that the diff on Trac will still show the changes in #23799.


---

Comment by tscrim created at 2017-09-30 16:32:00

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2017-09-30 16:32:00

I get the same errors reported by the patchbots:

```
sage -t --long src/sage/ext/cdefs.pxi  # 1 doctest failed
sage -t --long src/sage/ext/stdsage.pxi  # 1 doctest failed
```



---

Comment by git created at 2017-10-01 09:39:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-10-01 09:39:39

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-10-01 15:10:19

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2017-10-01 15:10:19

That took care of one of them, but this one is still failing:

```
sage -t --long src/sage/ext/stdsage.pxi  # 1 doctest failed
```



---

Comment by jdemeyer created at 2017-10-01 20:47:23

Sorry for that. I just assumed that both tests failed for the same reason.


---

Comment by tscrim created at 2017-10-01 23:07:50

No problem. I was thinking your last would fix both of them too.


---

Comment by git created at 2017-10-04 08:39:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-10-04 09:17:06

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-10-04 09:17:06

OK, this is hopefully the final attempt.


---

Comment by jdemeyer created at 2017-10-04 12:46:43

Tests pass!


---

Comment by tscrim created at 2017-10-04 15:27:27

Thanks.


---

Comment by tscrim created at 2017-10-04 15:27:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-10-05 06:55:48

Resolution: fixed


---

Comment by vbraun created at 2017-10-13 21:37:35

This is borked on OSX:

```
sage -t --long --warn-long 153.2 src/sage/libs/pynac/pynac.pxd
**********************************************************************
File "src/sage/libs/pynac/pynac.pxd", line 10, in sage.libs.pynac.pynac
Failed example:
    cython(  # long time
    '''
    #clang c++
    #clib pynac
    #cargs --std=c++11
    cimport sage.libs.pynac.pynac
    ''')
Expected nothing
Got:
    /var/folders/hj/rs3k66f91zddr7hvc6yf_90m0000gp/T//cctBDHai.s:3350:11: warning: section "__textcoal_nt" is deprecated
            .section __TEXT,__textcoal_nt,coalesced,pure_instructions
                     ^      ~~~~~~~~~~~~~
    /var/folders/hj/rs3k66f91zddr7hvc6yf_90m0000gp/T//cctBDHai.s:3350:11: note: change section name to "__text"
            .section __TEXT,__textcoal_nt,coalesced,pure_instructions
                     ^      ~~~~~~~~~~~~~
    /var/folders/hj/rs3k66f91zddr7hvc6yf_90m0000gp/T//cctBDHai.s:3731:11: warning: section "__textcoal_nt" is deprecated
            .section __TEXT,__textcoal_nt,coalesced,pure_instructions
                     ^      ~~~~~~~~~~~~~
    /var/folders/hj/rs3k66f91zddr7hvc6yf_90m0000gp/T//cctBDHai.s:3731:11: note: change section name to "__text"
            .section __TEXT,__textcoal_nt,coalesced,pure_instructions
                     ^      ~~~~~~~~~~~~~
**********************************************************************
1 item had failures:
   1 of   2 in sage.libs.pynac.pynac
    [1 test, 1 failure, 4.42 s]
```



---

Comment by vbraun created at 2017-10-13 21:37:35

Changing status from closed to new.


---

Comment by vbraun created at 2017-10-13 21:37:35

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2017-10-14 09:06:01

Not really borked, we just need to ignore those warnings.


---

Comment by jdemeyer created at 2017-10-14 10:49:03

New commits:


---

Comment by jdemeyer created at 2017-10-14 10:49:03

Changing status from new to needs_review.


---

Comment by vbraun created at 2017-10-15 09:21:58

Resolution: fixed
