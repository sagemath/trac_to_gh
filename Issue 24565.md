# Issue 24565: berlekamp_massey: undefined behavior / silent invalid answer

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2018-02-21 09:30:46

CC:  tscrim

That's what we expect:

```
sage: berlekamp_massey([1,2,4,8])
x - 2
```


My students got surprised by this though:

```
sage: berlekamp_massey([1,2,4,9])
x - 2
sage: berlekamp_massey([2,2,4,8])
x - 2
```


The point is that `berlekamp_massey` on a list of 2n elements searches for a linear recurrence of length less than `n`, while `1,2,4,9` satisfies no such recurrence. The current documentation does not specify the behavior in this case.

Two options:
- Either the obtained relation should be checked against the full sequence, and an error be returned if the relation is not valid
- Or the documentation should spell explicitly that the result is only guaranteed to be correct on the full sequence if there exist a linear recurrence of length less than `n`



---

Comment by msaaltink created at 2019-07-29 00:46:09

I'd also like to see some improvement in this function.  The Berlekamp-Massey algorithm, as described in Massey's paper, determines an annihilating polynomial (well, actually, the reciprocal of this polynomial) of smallest possible degree for the given sequence.  Such a polynomial is unique if that degree is at most half the length of the input, but the polynomial exists in all cases.

So I'd add a third option: implement the actual algorithm as originally published (but computing the annihilating polynomial rather than the "connection" polynomial in the original), and document the output more carefully.

I'm not a big fan of the second option above; I'd rather see first option, raising an error, than silently accepting parameters not satisfying the algorithm's assumptions---if we stick with the existing implementation.


---

Comment by chapoton created at 2020-09-27 09:52:02

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-09-27 09:52:02

Changing type from defect to enhancement.


---

Comment by chapoton created at 2020-09-27 09:52:02

New commits:


---

Comment by chapoton created at 2020-09-30 17:02:39

green bot, please review


---

Comment by tscrim created at 2020-10-01 02:56:35

I cannot say really anything about comment:1, but this is an improvement on the current situation. So positive review unless there are any objections.


---

Comment by tscrim created at 2020-10-01 02:56:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-10-05 20:13:26

Resolution: fixed
