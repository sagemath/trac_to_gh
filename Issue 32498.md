# Issue 32498: Remove import of CC from sage.rings.all

archive/issues_032498.json:
```json
{
    "body": "CC:  @tobiasdiez vdelecroix mmezzarobba\n\n`git grep 'import CC'`\n\n`CC` is actually defined in `src/sage/rings/all.py` (as well as locally in several other modules), not in `src/sage/rings/complex_mpfr.pyx`, possibly because of cyclic imports. It should be checked if the definition can be moved there.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32735\n\n",
    "created_at": "2021-10-21T07:00:39Z",
    "labels": [
        "refactoring",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Remove import of CC from sage.rings.all",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32498",
    "user": "mkoeppe"
}
```
CC:  @tobiasdiez vdelecroix mmezzarobba

`git grep 'import CC'`

`CC` is actually defined in `src/sage/rings/all.py` (as well as locally in several other modules), not in `src/sage/rings/complex_mpfr.pyx`, possibly because of cyclic imports. It should be checked if the definition can be moved there.

Issue created by migration from https://trac.sagemath.org/ticket/32735





---

archive/issue_comments_463542.json:
```json
{
    "body": "This change would lead to a segfault.\n\n```\ndiff --git a/src/sage/rings/complex_mpfr.pyx b/src/sage/rings/complex_mpfr.pyx\nindex b419914f23..8b120c4341 100644\n--- a/src/sage/rings/complex_mpfr.pyx\n+++ b/src/sage/rings/complex_mpfr.pyx\n@@ -3610,3 +3610,6 @@ def _format_complex_number(real, imag, format_spec):\n                              \"complex format specifier\")\n         result = format(result, align + width)\n     return result\n+\n+\n+CC = ComplexField()\n```\n",
    "created_at": "2021-10-21T17:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463542",
    "user": "mkoeppe"
}
```

This change would lead to a segfault.

```
diff --git a/src/sage/rings/complex_mpfr.pyx b/src/sage/rings/complex_mpfr.pyx
index b419914f23..8b120c4341 100644
--- a/src/sage/rings/complex_mpfr.pyx
+++ b/src/sage/rings/complex_mpfr.pyx
@@ -3610,3 +3610,6 @@ def _format_complex_number(real, imag, format_spec):
                              "complex format specifier")
         result = format(result, align + width)
     return result
+
+
+CC = ComplexField()
```




---

archive/issue_comments_463543.json:
```json
{
    "body": "Maybe we should just create a small module `sage.rings.cc` for the definition of `CC`.",
    "created_at": "2021-12-09T20:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463543",
    "user": "mkoeppe"
}
```

Maybe we should just create a small module `sage.rings.cc` for the definition of `CC`.



---

archive/issue_comments_463544.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T21:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463544",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463545.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-12-09T21:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463545",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_463546.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T23:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463546",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463547.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-09T23:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463547",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_463548.json:
```json
{
    "body": "What about creating one central module (say `rings.abbrv`) that defines and exposes the abbreviations for all fields, i.e. also RR, ZZ etc? Feels more consistent. I think this would help preventing cyclic imports as one then could import the corresponding ring modules without them being directly executed.",
    "created_at": "2021-12-10T20:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463548",
    "user": "@tobiasdiez"
}
```

What about creating one central module (say `rings.abbrv`) that defines and exposes the abbreviations for all fields, i.e. also RR, ZZ etc? Feels more consistent. I think this would help preventing cyclic imports as one then could import the corresponding ring modules without them being directly executed.



---

archive/issue_comments_463549.json:
```json
{
    "body": "That would run counter to modularization",
    "created_at": "2021-12-10T20:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463549",
    "user": "mkoeppe"
}
```

That would run counter to modularization



---

archive/issue_comments_463550.json:
```json
{
    "body": "Did you tried to change\nhttps://github.com/sagemath/sagetrac-mirror/compare/develop...u/mkoeppe/remove_import_of_cc_from_sage_rings_all#diff-5b40c947b3304ad98f2f7bb93dea2bf496a967563cf297c2aa3cd049d6abcd83R446-R447\nto an import of the new `CC`?",
    "created_at": "2021-12-10T20:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463550",
    "user": "@tobiasdiez"
}
```

Did you tried to change
https://github.com/sagemath/sagetrac-mirror/compare/develop...u/mkoeppe/remove_import_of_cc_from_sage_rings_all#diff-5b40c947b3304ad98f2f7bb93dea2bf496a967563cf297c2aa3cd049d6abcd83R446-R447
to an import of the new `CC`?



---

archive/issue_comments_463551.json:
```json
{
    "body": "What do you suggest to change?",
    "created_at": "2021-12-10T20:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463551",
    "user": "mkoeppe"
}
```

What do you suggest to change?



---

archive/issue_comments_463552.json:
```json
{
    "body": "These two lines linked above\n\n```\n        from .complex_mpfr import ComplexField\n        CC = ComplexField()\n```\n\nto `from sage.rings.cc import CC`",
    "created_at": "2021-12-10T21:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463552",
    "user": "@tobiasdiez"
}
```

These two lines linked above

```
        from .complex_mpfr import ComplexField
        CC = ComplexField()
```

to `from sage.rings.cc import CC`



---

archive/issue_comments_463553.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-10T21:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463553",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463554.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-15T07:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463554",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463555.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-15T07:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463555",
    "user": "mmezzarobba"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_463556.json:
```json
{
    "body": "Some doctests need updating.",
    "created_at": "2021-12-15T07:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463556",
    "user": "mmezzarobba"
}
```

Some doctests need updating.



---

archive/issue_comments_463557.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-15T20:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463557",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463558.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-15T20:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463558",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_463559.json:
```json
{
    "body": "Some doctests that reference line numbers in `*_homset.py` still need to be fixed.",
    "created_at": "2021-12-16T08:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463559",
    "user": "mmezzarobba"
}
```

Some doctests that reference line numbers in `*_homset.py` still need to be fixed.



---

archive/issue_comments_463560.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-16T08:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463560",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_463561.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T20:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463561",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463562.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-16T20:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463562",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_463563.json:
```json
{
    "body": "Thanks - I had mistaken this failure for a numerical issue.",
    "created_at": "2021-12-16T20:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463563",
    "user": "mkoeppe"
}
```

Thanks - I had mistaken this failure for a numerical issue.



---

archive/issue_comments_463564.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T20:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463564",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463565.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-16T20:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463565",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_463566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-12-16T20:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463566",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_463567.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-16T20:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463567",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_463568.json:
```json
{
    "body": "Merged #32714 for the fix to doctest markup in `src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py`.",
    "created_at": "2021-12-16T20:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463568",
    "user": "mkoeppe"
}
```

Merged #32714 for the fix to doctest markup in `src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py`.



---

archive/issue_comments_463569.json:
```json
{
    "body": "Oh, good, I didn't realize this had been fixed elsewhere.",
    "created_at": "2021-12-17T08:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463569",
    "user": "mmezzarobba"
}
```

Oh, good, I didn't realize this had been fixed elsewhere.



---

archive/issue_comments_463570.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-17T08:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463570",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463571.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-23T20:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32498#issuecomment-463571",
    "user": "vbraun"
}
```

Resolution: fixed
