# Issue 32498: Remove import of CC from sage.rings.all

Issue created by migration from https://trac.sagemath.org/ticket/32735

Original creator: mkoeppe

Original creation time: 2021-10-21 07:00:39

CC:  @tobiasdiez vdelecroix mmezzarobba

`git grep 'import CC'`

`CC` is actually defined in `src/sage/rings/all.py` (as well as locally in several other modules), not in `src/sage/rings/complex_mpfr.pyx`, possibly because of cyclic imports. It should be checked if the definition can be moved there.


---

Comment by mkoeppe created at 2021-10-21 17:04:54

This change would lead to a segfault.

```
diff --git a/src/sage/rings/complex_mpfr.pyx b/src/sage/rings/complex_mpfr.pyx
index b419914f23..8b120c4341 100644
--- a/src/sage/rings/complex_mpfr.pyx
+++ b/src/sage/rings/complex_mpfr.pyx
@@ -3610,3 +3610,6 @@ def _format_complex_number(real, imag, format_spec):
                              "complex format specifier")
         result = format(result, align + width)
     return result
+
+
+CC = ComplexField()
```



---

Comment by mkoeppe created at 2021-12-09 20:01:54

Maybe we should just create a small module `sage.rings.cc` for the definition of `CC`.


---

Comment by git created at 2021-12-09 21:17:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-12-09 21:47:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-12-09 23:08:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-09 23:08:40

Changing status from new to needs_review.


---

Comment by @tobiasdiez created at 2021-12-10 20:30:48

What about creating one central module (say `rings.abbrv`) that defines and exposes the abbreviations for all fields, i.e. also RR, ZZ etc? Feels more consistent. I think this would help preventing cyclic imports as one then could import the corresponding ring modules without them being directly executed.


---

Comment by mkoeppe created at 2021-12-10 20:32:15

That would run counter to modularization


---

Comment by @tobiasdiez created at 2021-12-10 20:32:58

Did you tried to change
https://github.com/sagemath/sagetrac-mirror/compare/develop...u/mkoeppe/remove_import_of_cc_from_sage_rings_all#diff-5b40c947b3304ad98f2f7bb93dea2bf496a967563cf297c2aa3cd049d6abcd83R446-R447
to an import of the new `CC`?


---

Comment by mkoeppe created at 2021-12-10 20:57:44

What do you suggest to change?


---

Comment by @tobiasdiez created at 2021-12-10 21:22:25

These two lines linked above

```
        from .complex_mpfr import ComplexField
        CC = ComplexField()
```

to `from sage.rings.cc import CC`


---

Comment by git created at 2021-12-10 21:39:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2021-12-15 07:08:23

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2021-12-15 07:12:09

Changing status from positive_review to needs_work.


---

Comment by mmezzarobba created at 2021-12-15 07:12:09

Some doctests need updating.


---

Comment by git created at 2021-12-15 20:38:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-15 20:39:13

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2021-12-16 08:16:38

Some doctests that reference line numbers in `*_homset.py` still need to be fixed.


---

Comment by mmezzarobba created at 2021-12-16 08:16:38

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-12-16 20:04:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-16 20:05:09

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-12-16 20:05:09

Thanks - I had mistaken this failure for a numerical issue.


---

Comment by git created at 2021-12-16 20:06:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-16 20:08:06

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-12-16 20:10:23

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2021-12-16 20:10:52

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-12-16 20:10:52

Merged #32714 for the fix to doctest markup in `src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py`.


---

Comment by mmezzarobba created at 2021-12-17 08:25:21

Oh, good, I didn't realize this had been fixed elsewhere.


---

Comment by mmezzarobba created at 2021-12-17 08:25:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-12-23 20:26:05

Resolution: fixed
