# Issue 33154: Remove compile dependency on flint from CombinatorialPolyhedron

Issue created by migration from https://trac.sagemath.org/ticket/33391

Original creator: @kliem

Original creation time: 2022-02-21 06:25:59

CC:  mkoeppe

As a preparation of #33385, we cimport from `Matrix_dense` instead of `Matrix_integer_dense`. In particular this removes the compile time dependency on flint.


---

Comment by @kliem created at 2022-02-21 06:27:39

New commits:


---

Comment by @kliem created at 2022-02-21 06:31:01

The difference is measurable (for larger instances), but I think this is fine. Those operations are still pretty fast in comparison to anything related:

Before:


```
sage: P = polytopes.permutahedron(8, backend='field')
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
653 ms ± 2.62 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
61.9 ms ± 60.8 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: P = polytopes.hypercube(10)
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
1.08 ms ± 538 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
1.06 ms ± 922 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```


After:

```
sage: P = polytopes.permutahedron(8, backend='field')
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
656 ms ± 3.06 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
62.9 ms ± 61.4 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: P = polytopes.hypercube(10)
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
1.07 ms ± 2.1 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
1.06 ms ± 1.02 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```



---

Comment by @kliem created at 2022-02-21 06:31:12

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-02-21 06:44:42

For the larger instances, would using a generic sparse matrix be faster?


---

Comment by mkoeppe created at 2022-02-21 20:18:48

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-02-21 20:18:48

This seems to work well, thanks a lot!


---

Comment by vbraun created at 2022-02-27 22:00:08

Resolution: fixed
