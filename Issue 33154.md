# Issue 33154: Remove compile dependency on flint from CombinatorialPolyhedron

archive/issues_033154.json:
```json
{
    "body": "CC:  @mkoeppe\n\nAs a preparation of #33385, we cimport from `Matrix_dense` instead of `Matrix_integer_dense`. In particular this removes the compile time dependency on flint.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33391\n\n",
    "created_at": "2022-02-21T06:25:59Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Remove compile dependency on flint from CombinatorialPolyhedron",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33154",
    "user": "@kliem"
}
```
CC:  @mkoeppe

As a preparation of #33385, we cimport from `Matrix_dense` instead of `Matrix_integer_dense`. In particular this removes the compile time dependency on flint.

Issue created by migration from https://trac.sagemath.org/ticket/33391





---

archive/issue_comments_472355.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-02-21T06:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33154#issuecomment-472355",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_472356.json:
```json
{
    "body": "The difference is measurable (for larger instances), but I think this is fine. Those operations are still pretty fast in comparison to anything related:\n\nBefore:\n\n\n```\nsage: P = polytopes.permutahedron(8, backend='field')\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n653 ms \u00b1 2.62 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n61.9 ms \u00b1 60.8 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: P = polytopes.hypercube(10)\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n1.08 ms \u00b1 538 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n1.06 ms \u00b1 922 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```\n\n\nAfter:\n\n```\nsage: P = polytopes.permutahedron(8, backend='field')\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n656 ms \u00b1 3.06 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n62.9 ms \u00b1 61.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: P = polytopes.hypercube(10)\nsage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()\n1.07 ms \u00b1 2.1 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: C = P.combinatorial_polyhedron()\nsage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()\n1.06 ms \u00b1 1.02 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```\n",
    "created_at": "2022-02-21T06:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33154#issuecomment-472356",
    "user": "@kliem"
}
```

The difference is measurable (for larger instances), but I think this is fine. Those operations are still pretty fast in comparison to anything related:

Before:


```
sage: P = polytopes.permutahedron(8, backend='field')
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
653 ms ± 2.62 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
61.9 ms ± 60.8 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: P = polytopes.hypercube(10)
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
1.08 ms ± 538 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
1.06 ms ± 922 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```


After:

```
sage: P = polytopes.permutahedron(8, backend='field')
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
656 ms ± 3.06 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
62.9 ms ± 61.4 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: P = polytopes.hypercube(10)
sage: %timeit P.combinatorial_polyhedron.clear_cache(); P.combinatorial_polyhedron()
1.07 ms ± 2.1 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: C = P.combinatorial_polyhedron()
sage: %timeit C.incidence_matrix.clear_cache(); C.incidence_matrix()
1.06 ms ± 1.02 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```




---

archive/issue_comments_472357.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-21T06:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33154#issuecomment-472357",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_472358.json:
```json
{
    "body": "For the larger instances, would using a generic sparse matrix be faster?",
    "created_at": "2022-02-21T06:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33154#issuecomment-472358",
    "user": "@mkoeppe"
}
```

For the larger instances, would using a generic sparse matrix be faster?



---

archive/issue_comments_472359.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-21T20:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33154#issuecomment-472359",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_472360.json:
```json
{
    "body": "This seems to work well, thanks a lot!",
    "created_at": "2022-02-21T20:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33154#issuecomment-472360",
    "user": "@mkoeppe"
}
```

This seems to work well, thanks a lot!



---

archive/issue_comments_472361.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-27T22:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33154#issuecomment-472361",
    "user": "@vbraun"
}
```

Resolution: fixed
