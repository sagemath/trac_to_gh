# Issue 13499: special matrices

Issue created by migration from Trac.

Original creator: jason

Original creation time: 2012-11-12 20:38:52

Assignee: jason, was

CC:  rbeezer kcrisman mforets

It would be great to have a matrices namespace to put special matrix commands, sort of like the graphs.* namespace or groups.* namespace.  Here are some starter definitions:


```
def hilbert(R,n): return matrix(R, n, lambda i,j: 1/(i+j+1))
def vandermonde(R, v): return matrix(R, len(v), lambda i,j: v[i]^j)
def toeplitz(R,c,r): return matrix(R, len(c), len(r), lambda i,j: c[i-j] if i>=j else r[j-i])
def hankel(R,c,r): entries=c+r[1:]; return matrix(R, len(c), len(r), lambda i,j: entries[i+j])
def circulant(R,E): return hankel(R, E, E[-1:]+E[:-1])
```


Additionally, we could use scipy to create more matrices (or do it ourselves): http://docs.scipy.org/doc/scipy/reference/linalg.html#special-matrices


---

Comment by rbeezer created at 2012-11-12 21:00:05

Like this:  #13678 ?  (Which I should finish reviewing.)


---

Comment by jason created at 2012-11-12 21:10:22

Ah, yes, nice.  Should we close this ticket and move these examples over or make it an addition to that ticket?


---

Comment by rbeezer created at 2012-11-13 00:47:31

I'd vote for implementing the new matrices on this ticket, making sure they build on the namespace/tab-completion decorator in #13678.  Just change the description slightly to speak of just the special matrices.

Note:  These could be named, e.g., `hilbert_matrix()`, and the `_matrix` part gets stripped put when found with tab-completion.


---

Comment by jason created at 2012-12-01 17:44:26

More code, this time for Hadamard matrices.  Thanks to wikipedia and a paper by Alex Kramer summarizing these ideas.  I can't seem to find a source for the Paley type 2 matrix construction, but it seems to check out for small values of p^n, and it looks like a reasonable modification of the wikipedia method.


---

Comment by ppurka created at 2013-03-15 08:01:14

Maybe just convert the example definitions to actual functions, add a few examples, and add them to Sage. It's better than letting this code "bitrot" in trac :)


---

Attachment


---

Comment by jason created at 2013-03-15 15:10:48

Changing status from new to needs_review.


---

Comment by jason created at 2013-03-15 15:12:11

Changing status from needs_review to needs_work.


---

Comment by jason created at 2013-03-15 15:12:11

Documentation (and doctests) should still be added to the new functions, as well as the offset argument for the diagonal matrix constructor.

Ideally, we should have a new decorator that handles the optional ring argument automatically.


---

Comment by kcrisman created at 2013-03-15 18:17:25

Adding that documentation sounds like a great student project...


---

Attachment

take 2, apply this patch *or* the other patch, but not both.


---

Comment by Bouillaguet created at 2013-03-16 09:13:48

I would be happy to review this patch. Should I ?


---

Comment by jason created at 2013-03-16 09:52:42

The functions still need documentation, so it's not quite ready to go in yet.  However, if you want to add docs, or if you want to check correctness of the functions, that would be great too.


---

Comment by mforets created at 2017-04-23 18:56:59

- added documentation and tests to hankel, vandermonde, toeplitz and hilbert
- using the approach from the 1st patch (matrix method) decorator, because it is more in line with the current `special.py`
- added the file `special.py` to the html reference, because it was not there at all
- added a table with the available constructions, in the same lines as with the polytopes library

it is missing to document and add doctests for the Paley construction. perhaps a person with a number theory background can continue that part.

---

this is related to documentation here but less important issue: since we are using the matrix method decorator, it adds the strings `This function is available as xxx(...) and matrix.xxx(...).`, although this is not true in general. it applies not only for this ticket; see for instance the help for `random_rref_matrix`.
----
New commits:


---

Comment by dimpase created at 2017-04-24 21:00:42

note that there is now a lot on Hadamard matrices in `src/sage/combinat/matrices/hadamard_matrix.py` so no need to duplicate this in `special.py`. (Perhaps more docs can be added and/or cross-linked)


---

Comment by dimpase created at 2017-04-24 21:03:06

regarding `is available as xxx(...) and matrix.xxx(...)`, I think there is a consensus that nothing should be added to the global namespace, which is already quite full, rather, it should be pruned...


---

Comment by mforets created at 2017-04-25 00:48:07

Replying to [comment:21 dimpase]:
> regarding `is available as xxx(...) and matrix.xxx(...)`, I think there is a consensus that nothing should be added to the global namespace, which is already quite full, rather, it should be pruned...

the ``@`matrix_method` decorator adds the possibility for tab-completion, hence `matrix.xxx` works. this is good. but it also adds a string to the inline help saying that 

```
...
prefix = "    This function is available as %s(...) and matrix.%s(...)." 
% (func.__name__, name
...
```

but the `%s(...)` is not true; it is only true if the function is included in `all.py`. 

i was not proposing to add anything to `all.py`, just that someone revises and eventually confirms that this prefix to the docstring is false and should be fixed (or not).


---

Comment by mforets created at 2017-04-25 00:54:37

Replying to [comment:20 dimpase]:
> note that there is now a lot on Hadamard matrices in `src/sage/combinat/matrices/hadamard_matrix.py` so no need to duplicate this in `special.py`. (Perhaps more docs can be added and/or cross-linked)

this is great, thanks for pointing it out! i'll take care to add the relevant cross-link, in the new class docstring of `special.py`


---

Comment by git created at 2017-04-25 11:30:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-04-25 11:39:09

Changing status from needs_work to needs_review.


---

Comment by mforets created at 2017-04-25 11:39:09

- added Jason Grout as author, because this applies his patch to 4 special matrices (uploaded the original patches)
- leaving the (minor) issue that i didn't understand about the meaning of the `prefix` string of the ``@`matrix_method` decorator outside the scope of this ticket.
- adding myself as reviewer (?) 
- added cross links to combinat

can someone else have a look? thanks !


---

Comment by git created at 2017-04-25 11:46:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-04-25 16:31:00

looks good to me.


---

Comment by dimpase created at 2017-04-25 16:31:00

Changing status from needs_review to positive_review.


---

Comment by mforets created at 2017-04-26 06:02:47

Changing status from positive_review to needs_work.


---

Comment by mforets created at 2017-04-26 06:02:47

Thanks dimpase for the review!!! I've realized the word "vector" is innacurate in the docstring of hankel, because `entries = c + r[1:]` makes sense for lists. 

do you have some recommendation about being permissible with arguments? (only list/only vector/both). from my side i'll check how other parts of sage handle a similar issue.


---

Comment by git created at 2017-04-26 17:15:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-04-26 17:26:01

Changing status from needs_work to needs_review.


---

Comment by mforets created at 2017-04-26 17:26:01

propose to do the computation by accessing directly to the elements (as in the other cases). this way without type checking we are a little more robust in the sense that it accepts both lists and vectors. it is mathematically equivalent. 

there is a price to pay indeed if we use a lambda function instead of straightforward concatenation of lists,  but i judge "small" (~30ms for a 300x600 hankel matrix).  

in sage there are indeed a couple of docstrings which explicitly say "vector or list" (or "list or vector") as a search shows, eg. setting rows/cols in a matrix, or a polyhedral fan. in our case i'm just keeping the word "vector"..


---

Comment by dimpase created at 2017-04-26 17:56:20

actually, I don't like the interface for Hankel matrices. The normal
convention is that you have a potentially infinite matrix 

```
a b c d e f.....
b c d e f ......
c d e f ........
................
```

corresponding to the sequence (a,b,c,d,e,f,...) and then you just cut out the first
n rows and columns. (so it's square by default), see https://en.wikipedia.org/wiki/Hankel_matrix


---

Comment by mforets created at 2017-04-26 19:15:35

Replying to [comment:32 dimpase]:
> actually, I don't like the interface for Hankel matrices. The normal
> convention is that you have a potentially infinite matrix 
> {{{
> a b c d e f.....
> b c d e f ......
> c d e f ........
> ................
> }}}
> corresponding to the sequence (a,b,c,d,e,f,...) and then you just cut out the first
> n rows and columns. (so it's square by default), see https://en.wikipedia.org/wiki/Hankel_matrix

ok. square by default is:


```
def hankel(c, r=None):

    m = len(c)
    if r is not None:
        n = len(r)
        entries = lambda i: c[i] if i < m else r[i-m+1]
    else:
        n = len(c)
        entries = lambda i: c[i] if i < m else c[i-m+1]
    return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n)
```


i don't have any particular opinion about allowing rectangular matrices as optional, or removing it altogether. 

notice that the original code was like that, and there a similar Matlab command: `hankel(c, r)`.


---

Comment by git created at 2017-04-28 17:50:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-04-28 17:54:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-02 21:19:05

`@`dimpase : done with the suggested interface to the Hankel matrices. let me know if you'd like me to add other special matrices or related issues to this ticket (eg. custom specification of the `base_ring`).

something i have needed before (and there are several requests for this in asksage as you know) is to provide an "abstract matrix" constructor like `matrix.symbolic(5)` or `matrix.abstract('a', 5)` to return the matrix with SR coefficients labelled `aij`.


---

Comment by git created at 2017-05-09 20:19:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-09 20:27:06

from my side this ticket is good to go :) i've run tests and built the html doc. please let me now if you have changes or improvements so i can make them. Thanks.


---

Comment by dimpase created at 2017-05-14 23:03:23

Please add an example illustrating the rule about row/column "conflict" for Hankel matrices.


---

Comment by git created at 2017-05-15 07:05:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-22 08:44:21

Replying to [comment:39 dimpase]:
> Please add an example illustrating the rule about row/column "conflict" for Hankel matrices.

Good idea, done.


---

Comment by dimpase created at 2017-05-22 12:04:03

OK, at least now I understand the rule implemented easily. But why is this chosen?

Would it be more natural to just 
ignore the "conflict" thing completely and assume that the
the 2nd argument is the last row without the 1st entry?
This way the users do not even need to know the last entry of the 1st column to
have full control over the matrix they create. E.g., in the present design
one can have a match by accident, resulting in an wrong matrix. 
In the design I propose the user does not need to worry about this.


---

Comment by mforets created at 2017-05-23 06:28:24

Replying to [comment:42 dimpase]:
> OK, at least now I understand the rule implemented easily. But why is this chosen?
> 
it was there in the patch in this thread, and it seemed ok since it is similar in [matlab](https://fr.mathworks.com/help/matlab/ref/hankel.html) software, [scipy](https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.linalg.hankel.html), and [mathematica](https://reference.wolfram.com/language/ref/HankelMatrix.html). But ok to improve things.
 
> Would it be more natural to just 
> ignore the "conflict" thing completely and assume that the
> the 2nd argument is the last row without the 1st entry?
> This way the users do not even need to know the last entry of the 1st column to
> have full control over the matrix they create. E.g., in the present design
> one can have a match by accident, resulting in an wrong matrix. 
> In the design I propose the user does not need to worry about this.

sorry i didnt't follow the suggestion; do you mean at the docstring level?
(e.g. `conflict -> ignore`? that sounds good) if it's in the code could you reformulate please? maybe an example would help.


---

Comment by dimpase created at 2017-05-23 10:05:37

In the branch implementation of`hankel(a,b)`, the 1st entry of `b`, i.e. `b[0]` is always ignored. While this is what Matlab does (Mathematica too, and Mathematica [documentation](https://reference.wolfram.com/language/ref/HankelMatrix.html) requires the last entry of `a` to be equal to the 1st entry of `b`), it is ugly and illogical.

I propose that `hankel(a,b)` should do the same what `hankel(a,[None]+b)` does in the implementation on the branch.

Same applies to `toeplitz()` - it suffers from the same inconsistency.


---

Comment by mforets created at 2017-05-23 10:10:46

ok, we are on the same page now. i'll take care.


---

Comment by git created at 2017-05-24 11:10:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-24 11:10:42

Replying to [comment:44 dimpase]:
> In the branch implementation of`hankel(a,b)`, the 1st entry of `b`, i.e. `b[0]` is always ignored. While this is what Matlab does (Mathematica too, and Mathematica [documentation](https://reference.wolfram.com/language/ref/HankelMatrix.html) requires the last entry of `a` to be equal to the 1st entry of `b`), it is ugly and illogical.
> 
> I propose that `hankel(a,b)` should do the same what `hankel(a,[None]+b)` does in the implementation on the branch.
> 
> Same applies to `toeplitz()` - it suffers from the same inconsistency.
>  

done ==> needs review


---

Comment by dimpase created at 2017-05-24 12:41:50

this is nitpicking, I know, sorry, but why do you prepend [None] to `r` in

```
+    r = c if r is None else [None] + list(r)
+    n = len(r)
+    entries = lambda i: c[i] if i < m else r[i-m+1]
```

instead of adjusting the indexing (i.e. removing `+1`) of `r` in the last line (and adding `1` to `n`)?


---

Comment by dimpase created at 2017-05-24 14:32:12

While we are at it, I don't understand the choice made for r if it is not supplied. Would all 0s be more natural, i.e.? (This is what MMa's do, in fact).

```
if r is None:
    r = [0*c[0]]*(m-1)
```



---

Comment by mforets created at 2017-05-25 09:47:17

no worries, i'm here to learn.

if instead of the code in the branch one has:


```
sage: r = c if r is None else list(r)
sage: n = len(r)
sage: entries = lambda i: c[i] if i < m else r[i-m]
sage: return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n+1, ring=ring)
```


then the behaviour when r is not given does change (of course the matrix is no longer square):


```
Failed example:
    matrix.hankel([1..3])
Expected:

    [1 2 3]
    [2 3 2]
    [3 2 3]
Got:
    [1 2 3 1]
    [2 3 1 2]
    [3 1 2 3]
```


i think this was the reason i kept the None. 

however and in relation to your newer comment, i understand correctly, you've suggested to have this:


```
sage: r = c[1:] if r is None else list(r)
sage: n = len(r)
sage: entries = lambda i: c[i] if i < m else r[i-m]
sage: return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n+1, ring=ring)
}}} 

in this situation, all current tests pass.


---

Comment by mforets created at 2017-05-25 09:49:23

well, sorry i read too fast :/ let me think about all zeros.


---

Comment by git created at 2017-05-25 10:33:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-25 10:42:11

_To summarize:_ 

the current behaviour for `hankel(c)` is the same as in matlab and mathematica. for example,


```
sage: matrix.hankel([1, 2, 3, 4])

[1 2 3 4]
[2 3 4 0]
[3 4 0 0]
[4 0 0 0]

sage: matlab('hankel([1, 2, 3, 4])')

1     2     3     4
2     3     4     0
3     4     0     0
4     0     0     0
```


however, if row and column are passed all the data in the row is considered:


```
sage: matrix.hankel([1, 2, 3], [7, 8, 9, 10])

[ 1  2  3  7  8]
[ 2  3  7  8  9]
[ 3  7  8  9 10]
```


while:


```
sage: matlab('hankel([1, 2, 3], [7, 8, 9, 10])')

1     2     3     8
2     3     8     9
3     8     9    10
```



---

Comment by dimpase created at 2017-05-26 08:07:51

Looks good to me.


---

Comment by dimpase created at 2017-05-26 08:07:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-05-27 23:42:20

Resolution: fixed
