# Issue 13499: special matrices

archive/issues_013499.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  rbeezer kcrisman mforets\n\nIt would be great to have a matrices namespace to put special matrix commands, sort of like the graphs.* namespace or groups.* namespace.  Here are some starter definitions:\n\n\n```\ndef hilbert(R,n): return matrix(R, n, lambda i,j: 1/(i+j+1))\ndef vandermonde(R, v): return matrix(R, len(v), lambda i,j: v[i]^j)\ndef toeplitz(R,c,r): return matrix(R, len(c), len(r), lambda i,j: c[i-j] if i>=j else r[j-i])\ndef hankel(R,c,r): entries=c+r[1:]; return matrix(R, len(c), len(r), lambda i,j: entries[i+j])\ndef circulant(R,E): return hankel(R, E, E[-1:]+E[:-1])\n```\n\n\nAdditionally, we could use scipy to create more matrices (or do it ourselves): http://docs.scipy.org/doc/scipy/reference/linalg.html#special-matrices\n\nIssue created by migration from https://trac.sagemath.org/ticket/13703\n\n",
    "created_at": "2012-11-12T20:38:52Z",
    "labels": [
        "linear algebra",
        "minor",
        "enhancement"
    ],
    "title": "special matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13499",
    "user": "jason"
}
```
Assignee: jason, was

CC:  rbeezer kcrisman mforets

It would be great to have a matrices namespace to put special matrix commands, sort of like the graphs.* namespace or groups.* namespace.  Here are some starter definitions:


```
def hilbert(R,n): return matrix(R, n, lambda i,j: 1/(i+j+1))
def vandermonde(R, v): return matrix(R, len(v), lambda i,j: v[i]^j)
def toeplitz(R,c,r): return matrix(R, len(c), len(r), lambda i,j: c[i-j] if i>=j else r[j-i])
def hankel(R,c,r): entries=c+r[1:]; return matrix(R, len(c), len(r), lambda i,j: entries[i+j])
def circulant(R,E): return hankel(R, E, E[-1:]+E[:-1])
```


Additionally, we could use scipy to create more matrices (or do it ourselves): http://docs.scipy.org/doc/scipy/reference/linalg.html#special-matrices

Issue created by migration from https://trac.sagemath.org/ticket/13703





---

archive/issue_comments_166558.json:
```json
{
    "body": "Like this:  #13678 ?  (Which I should finish reviewing.)",
    "created_at": "2012-11-12T21:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166558",
    "user": "rbeezer"
}
```

Like this:  #13678 ?  (Which I should finish reviewing.)



---

archive/issue_comments_166559.json:
```json
{
    "body": "Ah, yes, nice.  Should we close this ticket and move these examples over or make it an addition to that ticket?",
    "created_at": "2012-11-12T21:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166559",
    "user": "jason"
}
```

Ah, yes, nice.  Should we close this ticket and move these examples over or make it an addition to that ticket?



---

archive/issue_comments_166560.json:
```json
{
    "body": "I'd vote for implementing the new matrices on this ticket, making sure they build on the namespace/tab-completion decorator in #13678.  Just change the description slightly to speak of just the special matrices.\n\nNote:  These could be named, e.g., `hilbert_matrix()`, and the `_matrix` part gets stripped put when found with tab-completion.",
    "created_at": "2012-11-13T00:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166560",
    "user": "rbeezer"
}
```

I'd vote for implementing the new matrices on this ticket, making sure they build on the namespace/tab-completion decorator in #13678.  Just change the description slightly to speak of just the special matrices.

Note:  These could be named, e.g., `hilbert_matrix()`, and the `_matrix` part gets stripped put when found with tab-completion.



---

archive/issue_comments_166561.json:
```json
{
    "body": "More code, this time for Hadamard matrices.  Thanks to wikipedia and a paper by Alex Kramer summarizing these ideas.  I can't seem to find a source for the Paley type 2 matrix construction, but it seems to check out for small values of p^n, and it looks like a reasonable modification of the wikipedia method.",
    "created_at": "2012-12-01T17:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166561",
    "user": "jason"
}
```

More code, this time for Hadamard matrices.  Thanks to wikipedia and a paper by Alex Kramer summarizing these ideas.  I can't seem to find a source for the Paley type 2 matrix construction, but it seems to check out for small values of p^n, and it looks like a reasonable modification of the wikipedia method.



---

archive/issue_comments_166562.json:
```json
{
    "body": "Maybe just convert the example definitions to actual functions, add a few examples, and add them to Sage. It's better than letting this code \"bitrot\" in trac :)",
    "created_at": "2013-03-15T08:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166562",
    "user": "ppurka"
}
```

Maybe just convert the example definitions to actual functions, add a few examples, and add them to Sage. It's better than letting this code "bitrot" in trac :)



---

archive/issue_comments_166563.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-03-15T15:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166563",
    "user": "jason"
}
```

Attachment



---

archive/issue_comments_166564.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-15T15:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166564",
    "user": "jason"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_166565.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-15T15:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166565",
    "user": "jason"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_166566.json:
```json
{
    "body": "Documentation (and doctests) should still be added to the new functions, as well as the offset argument for the diagonal matrix constructor.\n\nIdeally, we should have a new decorator that handles the optional ring argument automatically.",
    "created_at": "2013-03-15T15:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166566",
    "user": "jason"
}
```

Documentation (and doctests) should still be added to the new functions, as well as the offset argument for the diagonal matrix constructor.

Ideally, we should have a new decorator that handles the optional ring argument automatically.



---

archive/issue_comments_166567.json:
```json
{
    "body": "Adding that documentation sounds like a great student project...",
    "created_at": "2013-03-15T18:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166567",
    "user": "kcrisman"
}
```

Adding that documentation sounds like a great student project...



---

archive/issue_comments_166568.json:
```json
{
    "body": "Attachment\n\ntake 2, apply this patch *or* the other patch, but not both.",
    "created_at": "2013-03-15T22:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166568",
    "user": "jason"
}
```

Attachment

take 2, apply this patch *or* the other patch, but not both.



---

archive/issue_comments_166569.json:
```json
{
    "body": "I would be happy to review this patch. Should I ?",
    "created_at": "2013-03-16T09:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166569",
    "user": "Bouillaguet"
}
```

I would be happy to review this patch. Should I ?



---

archive/issue_comments_166570.json:
```json
{
    "body": "The functions still need documentation, so it's not quite ready to go in yet.  However, if you want to add docs, or if you want to check correctness of the functions, that would be great too.",
    "created_at": "2013-03-16T09:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166570",
    "user": "jason"
}
```

The functions still need documentation, so it's not quite ready to go in yet.  However, if you want to add docs, or if you want to check correctness of the functions, that would be great too.



---

archive/issue_comments_166571.json:
```json
{
    "body": "- added documentation and tests to hankel, vandermonde, toeplitz and hilbert\n- using the approach from the 1st patch (matrix method) decorator, because it is more in line with the current `special.py`\n- added the file `special.py` to the html reference, because it was not there at all\n- added a table with the available constructions, in the same lines as with the polytopes library\n\nit is missing to document and add doctests for the Paley construction. perhaps a person with a number theory background can continue that part.\n\n---\n\nthis is related to documentation here but less important issue: since we are using the matrix method decorator, it adds the strings `This function is available as xxx(...) and matrix.xxx(...).`, although this is not true in general. it applies not only for this ticket; see for instance the help for `random_rref_matrix`.\n----\nNew commits:",
    "created_at": "2017-04-23T18:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166571",
    "user": "mforets"
}
```

- added documentation and tests to hankel, vandermonde, toeplitz and hilbert
- using the approach from the 1st patch (matrix method) decorator, because it is more in line with the current `special.py`
- added the file `special.py` to the html reference, because it was not there at all
- added a table with the available constructions, in the same lines as with the polytopes library

it is missing to document and add doctests for the Paley construction. perhaps a person with a number theory background can continue that part.

---

this is related to documentation here but less important issue: since we are using the matrix method decorator, it adds the strings `This function is available as xxx(...) and matrix.xxx(...).`, although this is not true in general. it applies not only for this ticket; see for instance the help for `random_rref_matrix`.
----
New commits:



---

archive/issue_comments_166572.json:
```json
{
    "body": "note that there is now a lot on Hadamard matrices in `src/sage/combinat/matrices/hadamard_matrix.py` so no need to duplicate this in `special.py`. (Perhaps more docs can be added and/or cross-linked)",
    "created_at": "2017-04-24T21:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166572",
    "user": "dimpase"
}
```

note that there is now a lot on Hadamard matrices in `src/sage/combinat/matrices/hadamard_matrix.py` so no need to duplicate this in `special.py`. (Perhaps more docs can be added and/or cross-linked)



---

archive/issue_comments_166573.json:
```json
{
    "body": "regarding `is available as xxx(...) and matrix.xxx(...)`, I think there is a consensus that nothing should be added to the global namespace, which is already quite full, rather, it should be pruned...",
    "created_at": "2017-04-24T21:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166573",
    "user": "dimpase"
}
```

regarding `is available as xxx(...) and matrix.xxx(...)`, I think there is a consensus that nothing should be added to the global namespace, which is already quite full, rather, it should be pruned...



---

archive/issue_comments_166574.json:
```json
{
    "body": "Replying to [comment:21 dimpase]:\n> regarding `is available as xxx(...) and matrix.xxx(...)`, I think there is a consensus that nothing should be added to the global namespace, which is already quite full, rather, it should be pruned...\n\nthe ``@`matrix_method` decorator adds the possibility for tab-completion, hence `matrix.xxx` works. this is good. but it also adds a string to the inline help saying that \n\n```\n...\nprefix = \"    This function is available as %s(...) and matrix.%s(...).\" \n% (func.__name__, name\n...\n```\n\nbut the `%s(...)` is not true; it is only true if the function is included in `all.py`. \n\ni was not proposing to add anything to `all.py`, just that someone revises and eventually confirms that this prefix to the docstring is false and should be fixed (or not).",
    "created_at": "2017-04-25T00:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166574",
    "user": "mforets"
}
```

Replying to [comment:21 dimpase]:
> regarding `is available as xxx(...) and matrix.xxx(...)`, I think there is a consensus that nothing should be added to the global namespace, which is already quite full, rather, it should be pruned...

the ``@`matrix_method` decorator adds the possibility for tab-completion, hence `matrix.xxx` works. this is good. but it also adds a string to the inline help saying that 

```
...
prefix = "    This function is available as %s(...) and matrix.%s(...)." 
% (func.__name__, name
...
```

but the `%s(...)` is not true; it is only true if the function is included in `all.py`. 

i was not proposing to add anything to `all.py`, just that someone revises and eventually confirms that this prefix to the docstring is false and should be fixed (or not).



---

archive/issue_comments_166575.json:
```json
{
    "body": "Replying to [comment:20 dimpase]:\n> note that there is now a lot on Hadamard matrices in `src/sage/combinat/matrices/hadamard_matrix.py` so no need to duplicate this in `special.py`. (Perhaps more docs can be added and/or cross-linked)\n\nthis is great, thanks for pointing it out! i'll take care to add the relevant cross-link, in the new class docstring of `special.py`",
    "created_at": "2017-04-25T00:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166575",
    "user": "mforets"
}
```

Replying to [comment:20 dimpase]:
> note that there is now a lot on Hadamard matrices in `src/sage/combinat/matrices/hadamard_matrix.py` so no need to duplicate this in `special.py`. (Perhaps more docs can be added and/or cross-linked)

this is great, thanks for pointing it out! i'll take care to add the relevant cross-link, in the new class docstring of `special.py`



---

archive/issue_comments_166576.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-25T11:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166576",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166577.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-25T11:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166577",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166578.json:
```json
{
    "body": "- added Jason Grout as author, because this applies his patch to 4 special matrices (uploaded the original patches)\n- leaving the (minor) issue that i didn't understand about the meaning of the `prefix` string of the ``@`matrix_method` decorator outside the scope of this ticket.\n- adding myself as reviewer (?) \n- added cross links to combinat\n\ncan someone else have a look? thanks !",
    "created_at": "2017-04-25T11:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166578",
    "user": "mforets"
}
```

- added Jason Grout as author, because this applies his patch to 4 special matrices (uploaded the original patches)
- leaving the (minor) issue that i didn't understand about the meaning of the `prefix` string of the ``@`matrix_method` decorator outside the scope of this ticket.
- adding myself as reviewer (?) 
- added cross links to combinat

can someone else have a look? thanks !



---

archive/issue_comments_166579.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-25T11:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166579",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166580.json:
```json
{
    "body": "looks good to me.",
    "created_at": "2017-04-25T16:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166580",
    "user": "dimpase"
}
```

looks good to me.



---

archive/issue_comments_166581.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-25T16:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166581",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166582.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-04-26T06:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166582",
    "user": "mforets"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_166583.json:
```json
{
    "body": "Thanks dimpase for the review!!! I've realized the word \"vector\" is innacurate in the docstring of hankel, because `entries = c + r[1:]` makes sense for lists. \n\ndo you have some recommendation about being permissible with arguments? (only list/only vector/both). from my side i'll check how other parts of sage handle a similar issue.",
    "created_at": "2017-04-26T06:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166583",
    "user": "mforets"
}
```

Thanks dimpase for the review!!! I've realized the word "vector" is innacurate in the docstring of hankel, because `entries = c + r[1:]` makes sense for lists. 

do you have some recommendation about being permissible with arguments? (only list/only vector/both). from my side i'll check how other parts of sage handle a similar issue.



---

archive/issue_comments_166584.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-26T17:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166584",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166585.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-26T17:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166585",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_166586.json:
```json
{
    "body": "propose to do the computation by accessing directly to the elements (as in the other cases). this way without type checking we are a little more robust in the sense that it accepts both lists and vectors. it is mathematically equivalent. \n\nthere is a price to pay indeed if we use a lambda function instead of straightforward concatenation of lists,  but i judge \"small\" (~30ms for a 300x600 hankel matrix).  \n\nin sage there are indeed a couple of docstrings which explicitly say \"vector or list\" (or \"list or vector\") as a search shows, eg. setting rows/cols in a matrix, or a polyhedral fan. in our case i'm just keeping the word \"vector\"..",
    "created_at": "2017-04-26T17:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166586",
    "user": "mforets"
}
```

propose to do the computation by accessing directly to the elements (as in the other cases). this way without type checking we are a little more robust in the sense that it accepts both lists and vectors. it is mathematically equivalent. 

there is a price to pay indeed if we use a lambda function instead of straightforward concatenation of lists,  but i judge "small" (~30ms for a 300x600 hankel matrix).  

in sage there are indeed a couple of docstrings which explicitly say "vector or list" (or "list or vector") as a search shows, eg. setting rows/cols in a matrix, or a polyhedral fan. in our case i'm just keeping the word "vector"..



---

archive/issue_comments_166587.json:
```json
{
    "body": "actually, I don't like the interface for Hankel matrices. The normal\nconvention is that you have a potentially infinite matrix \n\n```\na b c d e f.....\nb c d e f ......\nc d e f ........\n................\n```\n\ncorresponding to the sequence (a,b,c,d,e,f,...) and then you just cut out the first\nn rows and columns. (so it's square by default), see https://en.wikipedia.org/wiki/Hankel_matrix",
    "created_at": "2017-04-26T17:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166587",
    "user": "dimpase"
}
```

actually, I don't like the interface for Hankel matrices. The normal
convention is that you have a potentially infinite matrix 

```
a b c d e f.....
b c d e f ......
c d e f ........
................
```

corresponding to the sequence (a,b,c,d,e,f,...) and then you just cut out the first
n rows and columns. (so it's square by default), see https://en.wikipedia.org/wiki/Hankel_matrix



---

archive/issue_comments_166588.json:
```json
{
    "body": "Replying to [comment:32 dimpase]:\n> actually, I don't like the interface for Hankel matrices. The normal\n> convention is that you have a potentially infinite matrix \n> {{{\n> a b c d e f.....\n> b c d e f ......\n> c d e f ........\n> ................\n> }}}\n> corresponding to the sequence (a,b,c,d,e,f,...) and then you just cut out the first\n> n rows and columns. (so it's square by default), see https://en.wikipedia.org/wiki/Hankel_matrix\n\nok. square by default is:\n\n\n```\ndef hankel(c, r=None):\n\n    m = len(c)\n    if r is not None:\n        n = len(r)\n        entries = lambda i: c[i] if i < m else r[i-m+1]\n    else:\n        n = len(c)\n        entries = lambda i: c[i] if i < m else c[i-m+1]\n    return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n)\n```\n\n\ni don't have any particular opinion about allowing rectangular matrices as optional, or removing it altogether. \n\nnotice that the original code was like that, and there a similar Matlab command: `hankel(c, r)`.",
    "created_at": "2017-04-26T19:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166588",
    "user": "mforets"
}
```

Replying to [comment:32 dimpase]:
> actually, I don't like the interface for Hankel matrices. The normal
> convention is that you have a potentially infinite matrix 
> {{{
> a b c d e f.....
> b c d e f ......
> c d e f ........
> ................
> }}}
> corresponding to the sequence (a,b,c,d,e,f,...) and then you just cut out the first
> n rows and columns. (so it's square by default), see https://en.wikipedia.org/wiki/Hankel_matrix

ok. square by default is:


```
def hankel(c, r=None):

    m = len(c)
    if r is not None:
        n = len(r)
        entries = lambda i: c[i] if i < m else r[i-m+1]
    else:
        n = len(c)
        entries = lambda i: c[i] if i < m else c[i-m+1]
    return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n)
```


i don't have any particular opinion about allowing rectangular matrices as optional, or removing it altogether. 

notice that the original code was like that, and there a similar Matlab command: `hankel(c, r)`.



---

archive/issue_comments_166589.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-28T17:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166589",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166590.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-28T17:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166590",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166591.json:
```json
{
    "body": "`@`dimpase : done with the suggested interface to the Hankel matrices. let me know if you'd like me to add other special matrices or related issues to this ticket (eg. custom specification of the `base_ring`).\n\nsomething i have needed before (and there are several requests for this in asksage as you know) is to provide an \"abstract matrix\" constructor like `matrix.symbolic(5)` or `matrix.abstract('a', 5)` to return the matrix with SR coefficients labelled `aij`.",
    "created_at": "2017-05-02T21:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166591",
    "user": "mforets"
}
```

`@`dimpase : done with the suggested interface to the Hankel matrices. let me know if you'd like me to add other special matrices or related issues to this ticket (eg. custom specification of the `base_ring`).

something i have needed before (and there are several requests for this in asksage as you know) is to provide an "abstract matrix" constructor like `matrix.symbolic(5)` or `matrix.abstract('a', 5)` to return the matrix with SR coefficients labelled `aij`.



---

archive/issue_comments_166592.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-09T20:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166592",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166593.json:
```json
{
    "body": "from my side this ticket is good to go :) i've run tests and built the html doc. please let me now if you have changes or improvements so i can make them. Thanks.",
    "created_at": "2017-05-09T20:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166593",
    "user": "mforets"
}
```

from my side this ticket is good to go :) i've run tests and built the html doc. please let me now if you have changes or improvements so i can make them. Thanks.



---

archive/issue_comments_166594.json:
```json
{
    "body": "Please add an example illustrating the rule about row/column \"conflict\" for Hankel matrices.",
    "created_at": "2017-05-14T23:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166594",
    "user": "dimpase"
}
```

Please add an example illustrating the rule about row/column "conflict" for Hankel matrices.



---

archive/issue_comments_166595.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-15T07:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166595",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166596.json:
```json
{
    "body": "Replying to [comment:39 dimpase]:\n> Please add an example illustrating the rule about row/column \"conflict\" for Hankel matrices.\n\nGood idea, done.",
    "created_at": "2017-05-22T08:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166596",
    "user": "mforets"
}
```

Replying to [comment:39 dimpase]:
> Please add an example illustrating the rule about row/column "conflict" for Hankel matrices.

Good idea, done.



---

archive/issue_comments_166597.json:
```json
{
    "body": "OK, at least now I understand the rule implemented easily. But why is this chosen?\n\nWould it be more natural to just \nignore the \"conflict\" thing completely and assume that the\nthe 2nd argument is the last row without the 1st entry?\nThis way the users do not even need to know the last entry of the 1st column to\nhave full control over the matrix they create. E.g., in the present design\none can have a match by accident, resulting in an wrong matrix. \nIn the design I propose the user does not need to worry about this.",
    "created_at": "2017-05-22T12:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166597",
    "user": "dimpase"
}
```

OK, at least now I understand the rule implemented easily. But why is this chosen?

Would it be more natural to just 
ignore the "conflict" thing completely and assume that the
the 2nd argument is the last row without the 1st entry?
This way the users do not even need to know the last entry of the 1st column to
have full control over the matrix they create. E.g., in the present design
one can have a match by accident, resulting in an wrong matrix. 
In the design I propose the user does not need to worry about this.



---

archive/issue_comments_166598.json:
```json
{
    "body": "Replying to [comment:42 dimpase]:\n> OK, at least now I understand the rule implemented easily. But why is this chosen?\n> \nit was there in the patch in this thread, and it seemed ok since it is similar in [matlab](https://fr.mathworks.com/help/matlab/ref/hankel.html) software, [scipy](https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.linalg.hankel.html), and [mathematica](https://reference.wolfram.com/language/ref/HankelMatrix.html). But ok to improve things.\n \n> Would it be more natural to just \n> ignore the \"conflict\" thing completely and assume that the\n> the 2nd argument is the last row without the 1st entry?\n> This way the users do not even need to know the last entry of the 1st column to\n> have full control over the matrix they create. E.g., in the present design\n> one can have a match by accident, resulting in an wrong matrix. \n> In the design I propose the user does not need to worry about this.\n\nsorry i didnt't follow the suggestion; do you mean at the docstring level?\n(e.g. `conflict -> ignore`? that sounds good) if it's in the code could you reformulate please? maybe an example would help.",
    "created_at": "2017-05-23T06:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166598",
    "user": "mforets"
}
```

Replying to [comment:42 dimpase]:
> OK, at least now I understand the rule implemented easily. But why is this chosen?
> 
it was there in the patch in this thread, and it seemed ok since it is similar in [matlab](https://fr.mathworks.com/help/matlab/ref/hankel.html) software, [scipy](https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.linalg.hankel.html), and [mathematica](https://reference.wolfram.com/language/ref/HankelMatrix.html). But ok to improve things.
 
> Would it be more natural to just 
> ignore the "conflict" thing completely and assume that the
> the 2nd argument is the last row without the 1st entry?
> This way the users do not even need to know the last entry of the 1st column to
> have full control over the matrix they create. E.g., in the present design
> one can have a match by accident, resulting in an wrong matrix. 
> In the design I propose the user does not need to worry about this.

sorry i didnt't follow the suggestion; do you mean at the docstring level?
(e.g. `conflict -> ignore`? that sounds good) if it's in the code could you reformulate please? maybe an example would help.



---

archive/issue_comments_166599.json:
```json
{
    "body": "In the branch implementation of`hankel(a,b)`, the 1st entry of `b`, i.e. `b[0]` is always ignored. While this is what Matlab does (Mathematica too, and Mathematica [documentation](https://reference.wolfram.com/language/ref/HankelMatrix.html) requires the last entry of `a` to be equal to the 1st entry of `b`), it is ugly and illogical.\n\nI propose that `hankel(a,b)` should do the same what `hankel(a,[None]+b)` does in the implementation on the branch.\n\nSame applies to `toeplitz()` - it suffers from the same inconsistency.",
    "created_at": "2017-05-23T10:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166599",
    "user": "dimpase"
}
```

In the branch implementation of`hankel(a,b)`, the 1st entry of `b`, i.e. `b[0]` is always ignored. While this is what Matlab does (Mathematica too, and Mathematica [documentation](https://reference.wolfram.com/language/ref/HankelMatrix.html) requires the last entry of `a` to be equal to the 1st entry of `b`), it is ugly and illogical.

I propose that `hankel(a,b)` should do the same what `hankel(a,[None]+b)` does in the implementation on the branch.

Same applies to `toeplitz()` - it suffers from the same inconsistency.



---

archive/issue_comments_166600.json:
```json
{
    "body": "ok, we are on the same page now. i'll take care.",
    "created_at": "2017-05-23T10:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166600",
    "user": "mforets"
}
```

ok, we are on the same page now. i'll take care.



---

archive/issue_comments_166601.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-24T11:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166601",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166602.json:
```json
{
    "body": "Replying to [comment:44 dimpase]:\n> In the branch implementation of`hankel(a,b)`, the 1st entry of `b`, i.e. `b[0]` is always ignored. While this is what Matlab does (Mathematica too, and Mathematica [documentation](https://reference.wolfram.com/language/ref/HankelMatrix.html) requires the last entry of `a` to be equal to the 1st entry of `b`), it is ugly and illogical.\n> \n> I propose that `hankel(a,b)` should do the same what `hankel(a,[None]+b)` does in the implementation on the branch.\n> \n> Same applies to `toeplitz()` - it suffers from the same inconsistency.\n>  \n\ndone ==> needs review",
    "created_at": "2017-05-24T11:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166602",
    "user": "mforets"
}
```

Replying to [comment:44 dimpase]:
> In the branch implementation of`hankel(a,b)`, the 1st entry of `b`, i.e. `b[0]` is always ignored. While this is what Matlab does (Mathematica too, and Mathematica [documentation](https://reference.wolfram.com/language/ref/HankelMatrix.html) requires the last entry of `a` to be equal to the 1st entry of `b`), it is ugly and illogical.
> 
> I propose that `hankel(a,b)` should do the same what `hankel(a,[None]+b)` does in the implementation on the branch.
> 
> Same applies to `toeplitz()` - it suffers from the same inconsistency.
>  

done ==> needs review



---

archive/issue_comments_166603.json:
```json
{
    "body": "this is nitpicking, I know, sorry, but why do you prepend [None] to `r` in\n\n```\n+    r = c if r is None else [None] + list(r)\n+    n = len(r)\n+    entries = lambda i: c[i] if i < m else r[i-m+1]\n```\n\ninstead of adjusting the indexing (i.e. removing `+1`) of `r` in the last line (and adding `1` to `n`)?",
    "created_at": "2017-05-24T12:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166603",
    "user": "dimpase"
}
```

this is nitpicking, I know, sorry, but why do you prepend [None] to `r` in

```
+    r = c if r is None else [None] + list(r)
+    n = len(r)
+    entries = lambda i: c[i] if i < m else r[i-m+1]
```

instead of adjusting the indexing (i.e. removing `+1`) of `r` in the last line (and adding `1` to `n`)?



---

archive/issue_comments_166604.json:
```json
{
    "body": "While we are at it, I don't understand the choice made for r if it is not supplied. Would all 0s be more natural, i.e.? (This is what MMa's do, in fact).\n\n```\nif r is None:\n    r = [0*c[0]]*(m-1)\n```\n",
    "created_at": "2017-05-24T14:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166604",
    "user": "dimpase"
}
```

While we are at it, I don't understand the choice made for r if it is not supplied. Would all 0s be more natural, i.e.? (This is what MMa's do, in fact).

```
if r is None:
    r = [0*c[0]]*(m-1)
```




---

archive/issue_comments_166605.json:
```json
{
    "body": "no worries, i'm here to learn.\n\nif instead of the code in the branch one has:\n\n\n```\nsage: r = c if r is None else list(r)\nsage: n = len(r)\nsage: entries = lambda i: c[i] if i < m else r[i-m]\nsage: return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n+1, ring=ring)\n```\n\n\nthen the behaviour when r is not given does change (of course the matrix is no longer square):\n\n\n```\nFailed\u00a0example:\n\u00a0\u00a0\u00a0\u00a0matrix.hankel([1..3])\nExpected:\n\n\u00a0\u00a0\u00a0\u00a0[1\u00a02\u00a03]\n\u00a0\u00a0\u00a0\u00a0[2\u00a03\u00a02]\n\u00a0\u00a0\u00a0\u00a0[3\u00a02\u00a03]\nGot:\n\u00a0\u00a0\u00a0\u00a0[1\u00a02\u00a03\u00a01]\n\u00a0\u00a0\u00a0\u00a0[2\u00a03\u00a01\u00a02]\n\u00a0\u00a0\u00a0\u00a0[3\u00a01\u00a02\u00a03]\n```\n\n\ni think this was the reason i kept the None. \n\nhowever and in relation to your newer comment, i understand correctly, you've suggested to have this:\n\n\n```\nsage: r = c[1:] if r is None else list(r)\nsage: n = len(r)\nsage: entries = lambda i: c[i] if i < m else r[i-m]\nsage: return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n+1, ring=ring)\n```\n \n\nin this situation, all current tests pass.",
    "created_at": "2017-05-25T09:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166605",
    "user": "mforets"
}
```

no worries, i'm here to learn.

if instead of the code in the branch one has:


```
sage: r = c if r is None else list(r)
sage: n = len(r)
sage: entries = lambda i: c[i] if i < m else r[i-m]
sage: return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n+1, ring=ring)
```


then the behaviour when r is not given does change (of course the matrix is no longer square):


```
Failed example:
    matrix.hankel([1..3])
Expected:

    [1 2 3]
    [2 3 2]
    [3 2 3]
Got:
    [1 2 3 1]
    [2 3 1 2]
    [3 1 2 3]
```


i think this was the reason i kept the None. 

however and in relation to your newer comment, i understand correctly, you've suggested to have this:


```
sage: r = c[1:] if r is None else list(r)
sage: n = len(r)
sage: entries = lambda i: c[i] if i < m else r[i-m]
sage: return matrix(lambda i,j: entries(i+j), nrows=m, ncols=n+1, ring=ring)
```
 

in this situation, all current tests pass.



---

archive/issue_comments_166606.json:
```json
{
    "body": "well, sorry i read too fast :/ let me think about all zeros.",
    "created_at": "2017-05-25T09:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166606",
    "user": "mforets"
}
```

well, sorry i read too fast :/ let me think about all zeros.



---

archive/issue_comments_166607.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-25T10:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166607",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_166608.json:
```json
{
    "body": "*To summarize:* \n\nthe current behaviour for `hankel(c)` is the same as in matlab and mathematica. for example,\n\n\n```\nsage: matrix.hankel([1, 2, 3, 4])\n\n[1 2 3 4]\n[2 3 4 0]\n[3 4 0 0]\n[4 0 0 0]\n\nsage: matlab('hankel([1, 2, 3, 4])')\n\n1     2     3     4\n2     3     4     0\n3     4     0     0\n4     0     0     0\n```\n\n\nhowever, if row and column are passed all the data in the row is considered:\n\n\n```\nsage: matrix.hankel([1, 2, 3], [7, 8, 9, 10])\n\n[ 1  2  3  7  8]\n[ 2  3  7  8  9]\n[ 3  7  8  9 10]\n```\n\n\nwhile:\n\n\n```\nsage: matlab('hankel([1, 2, 3], [7, 8, 9, 10])')\n\n1     2     3     8\n2     3     8     9\n3     8     9    10\n```\n",
    "created_at": "2017-05-25T10:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166608",
    "user": "mforets"
}
```

*To summarize:* 

the current behaviour for `hankel(c)` is the same as in matlab and mathematica. for example,


```
sage: matrix.hankel([1, 2, 3, 4])

[1 2 3 4]
[2 3 4 0]
[3 4 0 0]
[4 0 0 0]

sage: matlab('hankel([1, 2, 3, 4])')

1     2     3     4
2     3     4     0
3     4     0     0
4     0     0     0
```


however, if row and column are passed all the data in the row is considered:


```
sage: matrix.hankel([1, 2, 3], [7, 8, 9, 10])

[ 1  2  3  7  8]
[ 2  3  7  8  9]
[ 3  7  8  9 10]
```


while:


```
sage: matlab('hankel([1, 2, 3], [7, 8, 9, 10])')

1     2     3     8
2     3     8     9
3     8     9    10
```




---

archive/issue_comments_166609.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2017-05-26T08:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166609",
    "user": "dimpase"
}
```

Looks good to me.



---

archive/issue_comments_166610.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-26T08:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166610",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166611.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-27T23:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13499#issuecomment-166611",
    "user": "vbraun"
}
```

Resolution: fixed
