# Issue 17820: Cython interface to libhomfly

Issue created by migration from https://trac.sagemath.org/ticket/18057

Original creator: mmarco

Original creation time: 2015-03-25 20:50:44

CC:  vbraun kcrisman amitjadagni fugelde tscrim

This implements a cython interface to the libhomfly library in #18047


---

Comment by jdemeyer created at 2015-06-23 14:04:06

Changing component from interfaces to interfaces: optional.


---

Comment by jdemeyer created at 2015-06-23 14:04:06

New commits:


---

Comment by git created at 2016-05-30 15:17:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-05-30 15:18:02

Changing keywords from "" to "days74".


---

Comment by mmarco created at 2016-05-30 15:18:02

Changing status from new to needs_review.


---

Comment by mmarco created at 2016-05-30 15:18:02

Rebased to 7.3 beta2
----
New commits:


---

Comment by git created at 2016-05-30 15:43:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-05-31 07:42:53

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-05-31 07:42:53

Delete this commented-out code:

```
#clib homfly
#clib gc
```



---

Comment by jdemeyer created at 2016-05-31 07:59:26

You should use `OptionalExtension`, see other examples in `module_list.py`.


---

Comment by git created at 2016-05-31 15:00:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-05-31 17:52:08

This technically does not depend on #18047.


---

Comment by tscrim created at 2016-05-31 22:27:32

The resulting `Poly` object was created under `GC_malloc`, do we have to worry about deleting it after we are done translating it into a `dict`?


---

Comment by mmarco created at 2016-06-01 06:22:33

I think you are right, we should free it.


---

Comment by mmarco created at 2016-06-01 06:23:39

Wait, it was created by malloc or by boehm's version of malloc? If it is the latter, the garbage collector should take care of that.


---

Comment by tscrim created at 2016-06-01 06:56:13

Replying to [comment:13 mmarco]:
> Wait, it was created by malloc or by boehm's version of malloc? If it is the latter, the garbage collector should take care of that.

It was the latter (i.e., the memory was given by a call to `GC_MALLOC`). Although I think we are okay in doing the free-ing ourselves.


---

Comment by tscrim created at 2016-06-01 07:31:55

I've made this `OptionalExtension` and removed the commented out code.
----
New commits:


---

Comment by tscrim created at 2016-06-01 07:43:26

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-06-01 08:53:52

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-06-01 08:53:52

When `libhomfly` is not installed:

```
sage -t src/sage/libs/homfly.pyx
**********************************************************************
File "src/sage/libs/homfly.pyx", line 65, in sage.libs.homfly.homfly_polynomial_string
Failed example:
    from sage.libs.homfly import homfly_polynomial_string
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.homfly.homfly_polynomial_string[0]>", line 1, in <module>
        from sage.libs.homfly import homfly_polynomial_string
    ImportError: No module named homfly
**********************************************************************
File "src/sage/libs/homfly.pyx", line 91, in sage.libs.homfly.homfly_polynomial_dict
Failed example:
    from sage.libs.homfly import homfly_polynomial_dict
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.homfly.homfly_polynomial_dict[0]>", line 1, in <module>
        from sage.libs.homfly import homfly_polynomial_dict
    ImportError: No module named homfly
**********************************************************************
```



---

Comment by git created at 2016-06-01 08:58:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-06-01 08:59:00

Changing status from needs_work to needs_review.


---

Comment by mmarco created at 2016-06-01 10:11:13

Looks good to me. It all seems to work ok.


---

Comment by tscrim created at 2016-06-01 11:55:49

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-06-01 11:55:49

I am going to treat that as a positive review.


---

Comment by vbraun created at 2016-06-01 23:00:21

Documentation doesn't build if you don't have libhomfly


---

Comment by vbraun created at 2016-06-01 23:00:21

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-06-02 07:06:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-06-02 07:07:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2016-06-02 07:07:59

No, that was not the right solution.


---

Comment by git created at 2016-06-02 07:13:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-06-02 07:14:03

Okay, I just copied what was done for the other optional packages.


---

Comment by tscrim created at 2016-06-02 07:14:03

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-06-02 20:58:09

Resolution: fixed
