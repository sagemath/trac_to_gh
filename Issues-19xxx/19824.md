# Issue 19824: Faster comparison code in (real embedded) number fields

archive/issues_019587.json:
```json
{
    "body": "Using #19822 we provide a faster comparison code for number field elements when a real embedding is defined (see #17830). We obtain `x10` speed up for small elements and `x2` speed up for larger ones. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!).\n\nFor the benchmarks, we used the following comparison function\n\n```\ndef test(a,n):\n    cf = continued_fraction(a)\n    cv1 = a.parent()(cf.convergent(2*n+1))\n    cv2 = a.parent()(cf.convergent(2*n+2))\n    for _ in range(200):\n        assert cv1 > a > cv2\n```\nBefore\n\n```\nsage: x = polygen(ZZ)\nsage: K.<a> = NumberField(x^3 - 2, embedding=1.26)\nsage: %timeit test(a,10)\n10 loops, best of 3: 51.1 ms per loop\nsage: %timeit test(a,20)\n10 loops, best of 3: 67 ms per loop\nsage: %timeit test(a,100)\n10 loops, best of 3: 108 ms per loop\nsage: %timeit test(a,200)\n1 loops, best of 3: 154 ms per loop\n```\nafter\n\n```\nsage: x = polygen(ZZ)\nsage: K.<a> = NumberField(x^3 - 2, embedding=1.26)\nsage: %timeit test(a,10)\n100 loops, best of 3: 5.84 ms per loop\nsage: %timeit test(a,20)\n100 loops, best of 3: 10.2 ms per loop\nsage: %timeit test(a,100)\n10 loops, best of 3: 33.5 ms per loop\nsage: %timeit test(a,200)\n10 loops, best of 3: 64.8 ms per loop\n```\nTo be compared with\n\n```\nsage: a = AA(2)**(1/3)\nsage: a.exactify()\nsage: %timeit test(a,10)\n10 loops, best of 3: 97.7 ms per loop\nsage: %timeit test(a,20)\n10 loops, best of 3: 133 ms per loop\nsage: %timeit test(a,100)\n1 loops, best of 3: 224 ms per loop\nsage: %timeit test(a,200)\n1 loops, best of 3: 305 ms per loop\n```\n\nBranch/Commit: c9c7133322fe7d762d7fb5c95f5d105c60788f90\n\nReviewer: Marc Mezzarobba\n\nAuthor: Vincent Delecroix\n\nDependencies: #19822\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19824\n\n",
    "closed_at": "2016-03-27T07:44:28Z",
    "created_at": "2016-01-02T17:25:22Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Faster comparison code in (real embedded) number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19824",
    "user": "https://github.com/videlec"
}
```
Using #19822 we provide a faster comparison code for number field elements when a real embedding is defined (see #17830). We obtain `x10` speed up for small elements and `x2` speed up for larger ones. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!).

For the benchmarks, we used the following comparison function

```
def test(a,n):
    cf = continued_fraction(a)
    cv1 = a.parent()(cf.convergent(2*n+1))
    cv2 = a.parent()(cf.convergent(2*n+2))
    for _ in range(200):
        assert cv1 > a > cv2
```
Before

```
sage: x = polygen(ZZ)
sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
sage: %timeit test(a,10)
10 loops, best of 3: 51.1 ms per loop
sage: %timeit test(a,20)
10 loops, best of 3: 67 ms per loop
sage: %timeit test(a,100)
10 loops, best of 3: 108 ms per loop
sage: %timeit test(a,200)
1 loops, best of 3: 154 ms per loop
```
after

```
sage: x = polygen(ZZ)
sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
sage: %timeit test(a,10)
100 loops, best of 3: 5.84 ms per loop
sage: %timeit test(a,20)
100 loops, best of 3: 10.2 ms per loop
sage: %timeit test(a,100)
10 loops, best of 3: 33.5 ms per loop
sage: %timeit test(a,200)
10 loops, best of 3: 64.8 ms per loop
```
To be compared with

```
sage: a = AA(2)**(1/3)
sage: a.exactify()
sage: %timeit test(a,10)
10 loops, best of 3: 97.7 ms per loop
sage: %timeit test(a,20)
10 loops, best of 3: 133 ms per loop
sage: %timeit test(a,100)
1 loops, best of 3: 224 ms per loop
sage: %timeit test(a,200)
1 loops, best of 3: 305 ms per loop
```

Branch/Commit: c9c7133322fe7d762d7fb5c95f5d105c60788f90

Reviewer: Marc Mezzarobba

Author: Vincent Delecroix

Dependencies: #19822

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19824





---

archive/issue_comments_286465.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-02T17:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286465",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286466.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2016-01-02T17:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286466",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_286467.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-Using #19822 we provide a faster comparison code for number field elements when real embedding is defined (see #17830). We obtain `x10` speed up. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!). For the benchmarks, we used the following comparison function\n+Using #19822 we provide a faster comparison code for number field elements when a real embedding is defined (see #17830). We obtain `x10` speed up. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!).\n+\n+For the benchmarks, we used the following comparison function\n \n ```\n def test(a,n):\n@@ -13,13 +15,13 @@\n ```\n sage: x = polygen(ZZ)\n sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)\n-sage: sage: %timeit test(a,10)\n+sage: %timeit test(a,10)\n 10 loops, best of 3: 51.1 ms per loop\n-sage: sage: %timeit test(a,20)\n+sage: %timeit test(a,20)\n 10 loops, best of 3: 67 ms per loop\n-sage: sage: %timeit test(a,100)\n+sage: %timeit test(a,100)\n 10 loops, best of 3: 108 ms per loop\n-sage: sage: %timeit test(a,200)\n+sage: %timeit test(a,200)\n 1 loops, best of 3: 154 ms per loop\n ```\n after\n@@ -27,13 +29,13 @@\n ```\n sage: x = polygen(ZZ)\n sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)\n-sage: sage: sage: %timeit test(a,10)\n+sage: %timeit test(a,10)\n 100 loops, best of 3: 5.84 ms per loop\n-sage: sage: sage: %timeit test(a,20)\n+sage: %timeit test(a,20)\n 100 loops, best of 3: 10.2 ms per loop\n-sage: sage: sage: %timeit test(a,100)\n+sage: %timeit test(a,100)\n 10 loops, best of 3: 33.5 ms per loop\n-sage: sage: sage: %timeit test(a,200)\n+sage: %timeit test(a,200)\n 10 loops, best of 3: 64.8 ms per loop\n ```\n To be compared with\n@@ -41,13 +43,13 @@\n ```\n sage: a = AA(2)**(1/3)\n sage: a.exactify()\n-sage: sage: %timeit test(a,10)\n+sage: %timeit test(a,10)\n 10 loops, best of 3: 97.7 ms per loop\n-sage: sage: %timeit test(a,20)\n+sage: %timeit test(a,20)\n 10 loops, best of 3: 133 ms per loop\n-sage: sage: %timeit test(a,100)\n+sage: %timeit test(a,100)\n 1 loops, best of 3: 224 ms per loop\n-sage: sage: %timeit test(a,200)\n+sage: %timeit test(a,200)\n 1 loops, best of 3: 305 ms per loop\n ```\n \n```\n",
    "created_at": "2016-01-06T20:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286467",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
-Using #19822 we provide a faster comparison code for number field elements when real embedding is defined (see #17830). We obtain `x10` speed up. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!). For the benchmarks, we used the following comparison function
+Using #19822 we provide a faster comparison code for number field elements when a real embedding is defined (see #17830). We obtain `x10` speed up. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!).
+
+For the benchmarks, we used the following comparison function
 
 ```
 def test(a,n):
@@ -13,13 +15,13 @@
 ```
 sage: x = polygen(ZZ)
 sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
-sage: sage: %timeit test(a,10)
+sage: %timeit test(a,10)
 10 loops, best of 3: 51.1 ms per loop
-sage: sage: %timeit test(a,20)
+sage: %timeit test(a,20)
 10 loops, best of 3: 67 ms per loop
-sage: sage: %timeit test(a,100)
+sage: %timeit test(a,100)
 10 loops, best of 3: 108 ms per loop
-sage: sage: %timeit test(a,200)
+sage: %timeit test(a,200)
 1 loops, best of 3: 154 ms per loop
 ```
 after
@@ -27,13 +29,13 @@
 ```
 sage: x = polygen(ZZ)
 sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
-sage: sage: sage: %timeit test(a,10)
+sage: %timeit test(a,10)
 100 loops, best of 3: 5.84 ms per loop
-sage: sage: sage: %timeit test(a,20)
+sage: %timeit test(a,20)
 100 loops, best of 3: 10.2 ms per loop
-sage: sage: sage: %timeit test(a,100)
+sage: %timeit test(a,100)
 10 loops, best of 3: 33.5 ms per loop
-sage: sage: sage: %timeit test(a,200)
+sage: %timeit test(a,200)
 10 loops, best of 3: 64.8 ms per loop
 ```
 To be compared with
@@ -41,13 +43,13 @@
 ```
 sage: a = AA(2)**(1/3)
 sage: a.exactify()
-sage: sage: %timeit test(a,10)
+sage: %timeit test(a,10)
 10 loops, best of 3: 97.7 ms per loop
-sage: sage: %timeit test(a,20)
+sage: %timeit test(a,20)
 10 loops, best of 3: 133 ms per loop
-sage: sage: %timeit test(a,100)
+sage: %timeit test(a,100)
 1 loops, best of 3: 224 ms per loop
-sage: sage: %timeit test(a,200)
+sage: %timeit test(a,200)
 1 loops, best of 3: 305 ms per loop
 ```
 
```




---

archive/issue_comments_286468.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-06T20:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_286469.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,57 @@\n+Using #19822 we provide a faster comparison code for number field elements when a real embedding is defined (see #17830). We obtain `x10` speed up for small elements and `x2` speed up for larger ones. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!).\n \n+For the benchmarks, we used the following comparison function\n+\n+```\n+def test(a,n):\n+    cf = continued_fraction(a)\n+    cv1 = a.parent()(cf.convergent(2*n+1))\n+    cv2 = a.parent()(cf.convergent(2*n+2))\n+    for _ in range(200):\n+        assert cv1 > a > cv2\n+```\n+Before\n+\n+```\n+sage: x = polygen(ZZ)\n+sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)\n+sage: %timeit test(a,10)\n+10 loops, best of 3: 51.1 ms per loop\n+sage: %timeit test(a,20)\n+10 loops, best of 3: 67 ms per loop\n+sage: %timeit test(a,100)\n+10 loops, best of 3: 108 ms per loop\n+sage: %timeit test(a,200)\n+1 loops, best of 3: 154 ms per loop\n+```\n+after\n+\n+```\n+sage: x = polygen(ZZ)\n+sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)\n+sage: %timeit test(a,10)\n+100 loops, best of 3: 5.84 ms per loop\n+sage: %timeit test(a,20)\n+100 loops, best of 3: 10.2 ms per loop\n+sage: %timeit test(a,100)\n+10 loops, best of 3: 33.5 ms per loop\n+sage: %timeit test(a,200)\n+10 loops, best of 3: 64.8 ms per loop\n+```\n+To be compared with\n+\n+```\n+sage: a = AA(2)**(1/3)\n+sage: a.exactify()\n+sage: %timeit test(a,10)\n+10 loops, best of 3: 97.7 ms per loop\n+sage: %timeit test(a,20)\n+10 loops, best of 3: 133 ms per loop\n+sage: %timeit test(a,100)\n+1 loops, best of 3: 224 ms per loop\n+sage: %timeit test(a,200)\n+1 loops, best of 3: 305 ms per loop\n+```\n \n Author: Vincent Delecroix\n \n```\n",
    "created_at": "2016-01-24T13:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286469",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,57 @@
+Using #19822 we provide a faster comparison code for number field elements when a real embedding is defined (see #17830). We obtain `x10` speed up for small elements and `x2` speed up for larger ones. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!).
 
+For the benchmarks, we used the following comparison function
+
+```
+def test(a,n):
+    cf = continued_fraction(a)
+    cv1 = a.parent()(cf.convergent(2*n+1))
+    cv2 = a.parent()(cf.convergent(2*n+2))
+    for _ in range(200):
+        assert cv1 > a > cv2
+```
+Before
+
+```
+sage: x = polygen(ZZ)
+sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
+sage: %timeit test(a,10)
+10 loops, best of 3: 51.1 ms per loop
+sage: %timeit test(a,20)
+10 loops, best of 3: 67 ms per loop
+sage: %timeit test(a,100)
+10 loops, best of 3: 108 ms per loop
+sage: %timeit test(a,200)
+1 loops, best of 3: 154 ms per loop
+```
+after
+
+```
+sage: x = polygen(ZZ)
+sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
+sage: %timeit test(a,10)
+100 loops, best of 3: 5.84 ms per loop
+sage: %timeit test(a,20)
+100 loops, best of 3: 10.2 ms per loop
+sage: %timeit test(a,100)
+10 loops, best of 3: 33.5 ms per loop
+sage: %timeit test(a,200)
+10 loops, best of 3: 64.8 ms per loop
+```
+To be compared with
+
+```
+sage: a = AA(2)**(1/3)
+sage: a.exactify()
+sage: %timeit test(a,10)
+10 loops, best of 3: 97.7 ms per loop
+sage: %timeit test(a,20)
+10 loops, best of 3: 133 ms per loop
+sage: %timeit test(a,100)
+1 loops, best of 3: 224 ms per loop
+sage: %timeit test(a,200)
+1 loops, best of 3: 305 ms per loop
+```
 
 Author: Vincent Delecroix
 
```




---

archive/issue_comments_286470.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-01-24T13:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286470",
    "user": "https://github.com/videlec"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_286471.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-25T10:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286471",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_054243.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-27T07:44:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19824#event-54243"
}
```



---

archive/issue_comments_286472.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-27T07:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-286472",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
