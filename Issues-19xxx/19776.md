# Issue 19776: Globally set -L library search path

archive/issues_019539.json:
```json
{
    "body": "Add `-L$SAGE_LOCAL/lib` to `LDFLAGS` in `sage-env`\n\n---\n\nSee #19782 for symlinking `$SAGE_LOCAL/lib64` to `$SAGE_LOCAL/lib` (which rather incidentally is *not* a prerequisite for adding just `-L$SAGE_LOCAL/lib` here).\n\n\nCC:  @nathanncohen jpflori @kiwifb\n\nKeywords: LDFLAGS sage-env\n\nBranch/Commit: 34cba4c7171e9b3cc77d819cf0082243173dd267\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19776\n\n",
    "closed_at": "2016-01-06T12:03:36Z",
    "created_at": "2015-12-24T10:22:06Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Globally set -L library search path",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19776",
    "user": "https://github.com/vbraun"
}
```
Add `-L$SAGE_LOCAL/lib` to `LDFLAGS` in `sage-env`

---

See #19782 for symlinking `$SAGE_LOCAL/lib64` to `$SAGE_LOCAL/lib` (which rather incidentally is *not* a prerequisite for adding just `-L$SAGE_LOCAL/lib` here).


CC:  @nathanncohen jpflori @kiwifb

Keywords: LDFLAGS sage-env

Branch/Commit: 34cba4c7171e9b3cc77d819cf0082243173dd267

Reviewer: Fran√ßois Bissey

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19776





---

archive/issue_comments_285547.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2015-12-24T10:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285547",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_285548.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-12-24T10:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285548",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_285549.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-24T11:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285550.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-24T11:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285550",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_285551.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+Add `-L$SAGE_LOCAL/lib` to `LDFLAGS` in `sage-env`\n \n Component: PLEASE CHANGE\n \n```\n",
    "created_at": "2015-12-24T11:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285551",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+Add `-L$SAGE_LOCAL/lib` to `LDFLAGS` in `sage-env`
 
 Component: PLEASE CHANGE
 
```




---

archive/issue_comments_285552.json:
```json
{
    "body": "<a id='comment:7'></a>Can we get rid of the `-Wl,-rpath,$SAGE_LOCAL/lib64`?  (Otherwise, we'd presumably have to add `-L$SAGE_LOCAL/lib64` for consistency as well, which on the other hand doesn't make sense on 32-bit systems.)\n\nAfter all, `lib64` should be a symlink to `lib` (or the other way around), and we had tons of changes adding `--libdir=$SAGE_LOCAL/lib` to `configure` invocations a while ago.  Probably meanwhile some are missing again.",
    "created_at": "2015-12-24T13:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285552",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>Can we get rid of the `-Wl,-rpath,$SAGE_LOCAL/lib64`?  (Otherwise, we'd presumably have to add `-L$SAGE_LOCAL/lib64` for consistency as well, which on the other hand doesn't make sense on 32-bit systems.)

After all, `lib64` should be a symlink to `lib` (or the other way around), and we had tons of changes adding `--libdir=$SAGE_LOCAL/lib` to `configure` invocations a while ago.  Probably meanwhile some are missing again.



---

archive/issue_comments_285553.json:
```json
{
    "body": "Changing keywords from \"\" to \"LDFLAGS sage-env\".",
    "created_at": "2015-12-24T13:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285553",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "LDFLAGS sage-env".



---

archive/issue_comments_285554.json:
```json
{
    "body": "<a id='comment:9'></a>GCC installs to /lib64, nothing else. GCC knows to link to its own libraries (so -L not needed) but at runtime it can fail (so rpath is needed).\n\nI thought about the symlink solution and I would prefer that, but it should go to another ticket.",
    "created_at": "2015-12-24T14:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285554",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>GCC installs to /lib64, nothing else. GCC knows to link to its own libraries (so -L not needed) but at runtime it can fail (so rpath is needed).

I thought about the symlink solution and I would prefer that, but it should go to another ticket.



---

archive/issue_comments_285555.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 vbraun]:\n> GCC installs to /lib64, nothing else. GCC knows to link to its own libraries (so -L not needed) but at runtime it can fail (so rpath is needed).\n> \n> I thought about the symlink solution and I would prefer that, but it should go to another ticket.\n\n\nOk.  Probably upon updating the GCC spkg... :P",
    "created_at": "2015-12-24T14:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285555",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>Replying to [comment:9 vbraun]:
> GCC installs to /lib64, nothing else. GCC knows to link to its own libraries (so -L not needed) but at runtime it can fail (so rpath is needed).
> 
> I thought about the symlink solution and I would prefer that, but it should go to another ticket.


Ok.  Probably upon updating the GCC spkg... :P



---

archive/issue_comments_285556.json:
```json
{
    "body": "<a id='comment:11'></a>I rebuilt Sage from scratch with this patch, and it does the job for me when building the latest release ended in a failure.\n\nThanks,\n\nNathann",
    "created_at": "2015-12-24T16:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285556",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>I rebuilt Sage from scratch with this patch, and it does the job for me when building the latest release ended in a failure.

Thanks,

Nathann



---

archive/issue_comments_285557.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-12-24T23:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285557",
    "user": "https://github.com/vbraun"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_285558.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+Add `-L$SAGE_LOCAL/lib` to `LDFLAGS` in `sage-env`\n+\n+---\n+\n+See #19782 for symlinking `$SAGE_LOCAL/lib64` to `$SAGE_LOCAL/lib` (which rather incidentally is *not* a prerequisite for adding just `-L$SAGE_LOCAL/lib` here).\n \n \n Component: PLEASE CHANGE\n```\n",
    "created_at": "2015-12-25T17:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285558",
    "user": "https://github.com/nexttime"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,8 @@
+Add `-L$SAGE_LOCAL/lib` to `LDFLAGS` in `sage-env`
+
+---
+
+See #19782 for symlinking `$SAGE_LOCAL/lib64` to `$SAGE_LOCAL/lib` (which rather incidentally is *not* a prerequisite for adding just `-L$SAGE_LOCAL/lib` here).
 
 
 Component: PLEASE CHANGE
```




---

archive/issue_comments_285559.json:
```json
{
    "body": "<a id='comment:13'></a>While the patch looks sane, I'd rather leave it up to sage-on-$foo maintainers / repackagers and users of exotic platforms to comment on and give it positive review, as it's a major change.",
    "created_at": "2015-12-25T17:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285559",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>While the patch looks sane, I'd rather leave it up to sage-on-$foo maintainers / repackagers and users of exotic platforms to comment on and give it positive review, as it's a major change.



---

archive/issue_comments_285560.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 leif]:\n> While the patch looks sane, I'd rather leave it up to sage-on-$foo maintainers / repackagers and users of exotic platforms to comment on and give it positive review, as it's a major change.\n\n\nWell I don't use any of this mechanic to install sage-on-gentoo. I have a very simple `sage-env` that I ship in `/etc` but it is nowhere like the beast in vanilla. It just mirrors `sage/env.py`. On Gentoo prefix on the other hand I believe everything is wrapped to add the equivalent of your `LDFLAGS` and probably `CPATH` (for include path) but I am not sure of the details, I would have to dig - my own preference would be to wrap `ld` but I give hashdist a patch to insert a rpath in gcc's spec [this is highly platform dependent, I gave them x86_64 and arm but my OS X patch is not complete].\n\nOn `gcc` installing in `lib64`, hashdist's gcc doesn't. gcc on my prefix on a linux x86_64 machine doesn't.",
    "created_at": "2015-12-25T19:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285560",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>Replying to [comment:13 leif]:
> While the patch looks sane, I'd rather leave it up to sage-on-$foo maintainers / repackagers and users of exotic platforms to comment on and give it positive review, as it's a major change.


Well I don't use any of this mechanic to install sage-on-gentoo. I have a very simple `sage-env` that I ship in `/etc` but it is nowhere like the beast in vanilla. It just mirrors `sage/env.py`. On Gentoo prefix on the other hand I believe everything is wrapped to add the equivalent of your `LDFLAGS` and probably `CPATH` (for include path) but I am not sure of the details, I would have to dig - my own preference would be to wrap `ld` but I give hashdist a patch to insert a rpath in gcc's spec [this is highly platform dependent, I gave them x86_64 and arm but my OS X patch is not complete].

On `gcc` installing in `lib64`, hashdist's gcc doesn't. gcc on my prefix on a linux x86_64 machine doesn't.



---

archive/issue_comments_285561.json:
```json
{
    "body": "<a id='comment:15'></a>Hashstack gcc.yaml does\n\n```\n  - name: link_lib64_to_lib\n    after: install\n    handler: bash\n    bash: |\n      # Create symbolic links from lib64/* to lib/\n      cd ${ARTIFACT}/lib\n      ln -s ../lib64/* .\n```",
    "created_at": "2015-12-25T20:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285561",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>Hashstack gcc.yaml does

```
  - name: link_lib64_to_lib
    after: install
    handler: bash
    bash: |
      # Create symbolic links from lib64/* to lib/
      cd ${ARTIFACT}/lib
      ln -s ../lib64/* .
```



---

archive/issue_comments_285562.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-30T16:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285562",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_285563.json:
```json
{
    "body": "<a id='comment:17'></a>bump",
    "created_at": "2016-01-04T17:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285563",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>bump



---

archive/issue_comments_285564.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-04T18:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285564",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285565.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-06T12:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19776#issuecomment-285565",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054168.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-06T12:03:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19776",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19776#event-54168"
}
```
