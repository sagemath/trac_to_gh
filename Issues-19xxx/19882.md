# Issue 19882: Let "make doc" always work.

archive/issues_019645.json:
```json
{
    "assignees": [],
    "body": "As requested in #18464. Currently `make doc` can fail when some previous documentation was built.\n\n\n\n**Branch:** [u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_)\n\n**Commit:** [83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)\n\n**Reviewer:** John Palmieri, Thierry Monteil\n\nIssue created by migration from https://trac.sagemath.org/ticket/19882\n\n",
    "closed_at": "2017-12-12T08:23:33Z",
    "created_at": "2016-01-13T17:39:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Let \"make doc\" always work.",
    "type": "issue",
    "updated_at": "2017-12-12T08:23:33Z",
    "url": "https://github.com/sagemath/sage/issues/19882",
    "user": "https://github.com/sagetrac-tmonteil"
}
```
As requested in #18464. Currently `make doc` can fail when some previous documentation was built.



**Branch:** [u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_)

**Commit:** [83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)

**Reviewer:** John Palmieri, Thierry Monteil

Issue created by migration from https://trac.sagemath.org/ticket/19882





---

archive/issue_events_242596.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:39:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "08517b",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242596"
}
```



---

archive/issue_events_242597.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:39:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242597"
}
```



---

archive/issue_events_242598.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:39:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "008080",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242598"
}
```



---

archive/issue_comments_286900.json:
```json
{
    "body": "**Branch:** [u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_)",
    "created_at": "2016-01-13T17:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286900",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

**Branch:** [u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_)



---

archive/issue_comments_286901.json:
```json
{
    "body": "**Author:** Thierry Monteil",
    "created_at": "2016-01-13T17:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286901",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

**Author:** Thierry Monteil



---

archive/issue_comments_286902.json:
```json
{
    "body": "**Commit:** [131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)",
    "created_at": "2016-01-13T17:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286902",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

**Commit:** [131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)



---

archive/issue_events_242599.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:42:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242599"
}
```



---

archive/issue_comments_286903.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe proposed fix is to just let the `doc` target depend on `doc-clean`. Perhaps is there a lighter solution ?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54\">131ff97</a></td><td><code>#19882 : let doc target depend on doc-clean.</code></td></tr></table>\n",
    "created_at": "2016-01-13T17:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286903",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:2'></a>
The proposed fix is to just let the `doc` target depend on `doc-clean`. Perhaps is there a lighter solution ?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54">131ff97</a></td><td><code>#19882 : let doc target depend on doc-clean.</code></td></tr></table>




---

archive/issue_events_242600.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-13T18:03:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242600"
}
```



---

archive/issue_events_242601.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-13T18:03:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242601"
}
```



---

archive/issue_comments_286904.json:
```json
{
    "body": "<a id='comment:3'></a>\nNo, this would force the doc to be rebuilt everytime you run `make`.",
    "created_at": "2016-01-13T18:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286904",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
No, this would force the doc to be rebuilt everytime you run `make`.



---

archive/issue_comments_286905.json:
```json
{
    "body": "<a id='comment:4'></a>\nSo, what should be done ?",
    "created_at": "2016-01-13T18:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286905",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:4'></a>
So, what should be done ?



---

archive/issue_comments_286906.json:
```json
{
    "body": "<a id='comment:5'></a>\nFigure out **why** the docbuilder sometimes fails and fix that.",
    "created_at": "2016-01-13T18:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286906",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Figure out **why** the docbuilder sometimes fails and fix that.



---

archive/issue_comments_286907.json:
```json
{
    "body": "<a id='comment:6'></a>\nDo we have ideas why? If a `.py` or `.pyx` file is present in one branch and not in another, this confuses the docbuilder. What else goes wrong?",
    "created_at": "2016-01-13T21:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286907",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
Do we have ideas why? If a `.py` or `.pyx` file is present in one branch and not in another, this confuses the docbuilder. What else goes wrong?



---

archive/issue_comments_286908.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tmonteil](#comment%3A4):\n> So, what should be done ?\n\nAs quick fix, the following might work:\n\n1. try to build the documentation normally.\n2. if that fails, run `make doc-clean` and rebuild the documentation.\n\nStep 1 is crucial to avoid a lot of needless rebuilds of the documentation.",
    "created_at": "2016-01-14T22:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286908",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [tmonteil](#comment%3A4):
> So, what should be done ?

As quick fix, the following might work:

1. try to build the documentation normally.
2. if that fails, run `make doc-clean` and rebuild the documentation.

Step 1 is crucial to avoid a lot of needless rebuilds of the documentation.



---

archive/issue_comments_286909.json:
```json
{
    "body": "**Changing commit** from \"[131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)\" to \"[80a0a522ccc5c0768558ae32ea98c995a3c8e9ca](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)\".",
    "created_at": "2016-01-15T17:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286909",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)" to "[80a0a522ccc5c0768558ae32ea98c995a3c8e9ca](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)".



---

archive/issue_comments_286910.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca\">80a0a52</a></td><td><code>#19882 : run doc-clean only if doc-html lead to an error.</code></td></tr></table>\n",
    "created_at": "2016-01-15T17:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286910",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca">80a0a52</a></td><td><code>#19882 : run doc-clean only if doc-html lead to an error.</code></td></tr></table>




---

archive/issue_comments_286911.json:
```json
{
    "body": "<a id='comment:9'></a>\nI am wondering if the recursive call of `$(MAKE)` is a good idea (I'm not saying it's bad, I just need to think about it).",
    "created_at": "2016-01-15T17:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286911",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
I am wondering if the recursive call of `$(MAKE)` is a good idea (I'm not saying it's bad, I just need to think about it).



---

archive/issue_comments_286912.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe current Makefile already calls `$(MAKE)`, see e.g. in #18710:\n\n```\nbdist-clean: clean\n        $(MAKE) misc-clean\n```\n\nThat said, there is no real recursivity since the `doc` target depends on `doc-html` and `doc-clean`, and none of those depend on `doc`, so i do not see any loop possibility. I am currently doing a few tests to see how it works in various cases.",
    "created_at": "2016-01-15T19:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286912",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:10'></a>
The current Makefile already calls `$(MAKE)`, see e.g. in #18710:

```
bdist-clean: clean
        $(MAKE) misc-clean
```

That said, there is no real recursivity since the `doc` target depends on `doc-html` and `doc-clean`, and none of those depend on `doc`, so i do not see any loop possibility. I am currently doing a few tests to see how it works in various cases.



---

archive/issue_comments_286913.json:
```json
{
    "body": "<a id='comment:11'></a>\nIt's problematic that `doc-html` has dependencies which also appear as dependencies of `all-sage`. So we can end up in a situation where there are two instances of `make` building the same targets.",
    "created_at": "2016-01-16T10:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286913",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
It's problematic that `doc-html` has dependencies which also appear as dependencies of `all-sage`. So we can end up in a situation where there are two instances of `make` building the same targets.



---

archive/issue_comments_286914.json:
```json
{
    "body": "<a id='comment:12'></a>\nMaybe you can solve this with an extra level of indirection:\n\n```\ndoc-html: $(DOC_DEPENDENCIES)\n    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )\n\ndocbuild-html:\n    cd ../.. && sage-logger './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log\n```\n\nUgly, but I guess it would work.",
    "created_at": "2016-01-16T11:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286914",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Maybe you can solve this with an extra level of indirection:

```
doc-html: $(DOC_DEPENDENCIES)
    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )

docbuild-html:
    cd ../.. && sage-logger './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log
```

Ugly, but I guess it would work.



---

archive/issue_comments_286915.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd\">5b555ae</a></td><td><code>#19882 add one level of indirection (comment 12)</code></td></tr></table>\n",
    "created_at": "2016-01-26T10:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286915",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd">5b555ae</a></td><td><code>#19882 add one level of indirection (comment 12)</code></td></tr></table>




---

archive/issue_comments_286916.json:
```json
{
    "body": "**Changing commit** from \"[80a0a522ccc5c0768558ae32ea98c995a3c8e9ca](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)\" to \"[5b555ae3493879c81f7f7ba7190dd1e272f54dbd](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)\".",
    "created_at": "2016-01-26T10:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286916",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[80a0a522ccc5c0768558ae32ea98c995a3c8e9ca](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)" to "[5b555ae3493879c81f7f7ba7190dd1e272f54dbd](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)".



---

archive/issue_events_242602.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-27T21:59:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242602"
}
```



---

archive/issue_events_242603.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-27T21:59:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242603"
}
```



---

archive/issue_comments_286917.json:
```json
{
    "body": "<a id='comment:14'></a>\nIt seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?",
    "created_at": "2016-01-27T21:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286917",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:14'></a>
It seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?



---

archive/issue_comments_286918.json:
```json
{
    "body": "<a id='comment:15'></a>\nDid you try `make -q` too? I am afraid that will break.",
    "created_at": "2016-01-29T07:16:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286918",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Did you try `make -q` too? I am afraid that will break.



---

archive/issue_comments_286919.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [tmonteil](#comment%3A14):\n> It seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?\n\nI would just create a dummy file with some simple doc<sup>1</sup>, build the doc, delete the file, and rebuild the doc (perhaps on a branch based on this one).\n\nAlternatively, you could create a branch where you just remove a file and try to build the doc.\n\n<sup>1</sup> - Don't forget to add an entry in the `.rst` files.",
    "created_at": "2016-01-29T15:19:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286919",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Replying to [tmonteil](#comment%3A14):
> It seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?

I would just create a dummy file with some simple doc<sup>1</sup>, build the doc, delete the file, and rebuild the doc (perhaps on a branch based on this one).

Alternatively, you could create a branch where you just remove a file and try to build the doc.

<sup>1</sup> - Don't forget to add an entry in the `.rst` files.



---

archive/issue_comments_286920.json:
```json
{
    "body": "<a id='comment:17'></a>\n#21378 got positive review (duplicate won't fix) saying that this ticket (#19882) is a better solution. But there was no update on #19882 since 8 months...\n\nNo later than yesterday, I run `make ptestlong` overnight to realize the day after that the doc failed and no test at all were ever made:\n\n```\n[dochtml] OSError: [homology ] Exception occurred:\n[dochtml] \n[dochtml] \n[dochtml] Note: incremental documentation builds sometimes cause spurious\n[dochtml] error messages. To be certain that these are real errors, run\n[dochtml] \"make doc-clean\" first and try again.\nMakefile:1061\u00a0: la recette pour la cible \u00ab\u00a0doc-html\u00a0\u00bb a \u00e9chou\u00e9e\n```\n\nI would like that `make ptestlong` always work...",
    "created_at": "2016-10-05T15:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286920",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:17'></a>
#21378 got positive review (duplicate won't fix) saying that this ticket (#19882) is a better solution. But there was no update on #19882 since 8 months...

No later than yesterday, I run `make ptestlong` overnight to realize the day after that the doc failed and no test at all were ever made:

```
[dochtml] OSError: [homology ] Exception occurred:
[dochtml] 
[dochtml] 
[dochtml] Note: incremental documentation builds sometimes cause spurious
[dochtml] error messages. To be certain that these are real errors, run
[dochtml] "make doc-clean" first and try again.
Makefile:1061 : la recette pour la cible « doc-html » a échouée
```

I would like that `make ptestlong` always work...



---

archive/issue_events_242604.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242604"
}
```



---

archive/issue_events_242605.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242605"
}
```



---

archive/issue_comments_286921.json:
```json
{
    "body": "<a id='comment:18'></a>\nMerge conflict...",
    "created_at": "2016-10-21T08:07:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286921",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Merge conflict...



---

archive/issue_events_242606.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "milestone_number": null,
    "milestone_title": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242606"
}
```



---

archive/issue_events_242607.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242607"
}
```



---

archive/issue_comments_286922.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5\">e80667d</a></td><td><code>#19882 : rebased on 7.6.beta6.</code></td></tr></table>\n",
    "created_at": "2017-03-10T09:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286922",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5">e80667d</a></td><td><code>#19882 : rebased on 7.6.beta6.</code></td></tr></table>




---

archive/issue_comments_286923.json:
```json
{
    "body": "**Changing commit** from \"[5b555ae3493879c81f7f7ba7190dd1e272f54dbd](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)\" to \"[e80667dee0e1ad2fff59c3b3007a724d80c0aed5](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)\".",
    "created_at": "2017-03-10T09:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286923",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5b555ae3493879c81f7f7ba7190dd1e272f54dbd](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)" to "[e80667dee0e1ad2fff59c3b3007a724d80c0aed5](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)".



---

archive/issue_comments_286924.json:
```json
{
    "body": "<a id='comment:20'></a>\nHere is a rebased version. Unfortunately, my laptop does not have enough memory anymore to build Sage doc, so that i can not test it seriously :(",
    "created_at": "2017-03-10T09:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286924",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:20'></a>
Here is a rebased version. Unfortunately, my laptop does not have enough memory anymore to build Sage doc, so that i can not test it seriously :(



---

archive/issue_events_242608.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-03-10T09:06:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242608"
}
```



---

archive/issue_events_242609.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-03-10T09:06:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242609"
}
```



---

archive/issue_comments_286925.json:
```json
{
    "body": "<a id='comment:21'></a>\nI got the error\n\n```\n***********************************************\nMakefile:1093: *** missing separator.  Stop.\n```\nwith this, until I made the change\n\n```diff\ndiff --git a/build/make/deps b/build/make/deps\nindex e18fd6f..da0a4e9 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -206,7 +206,7 @@ DOC_DEPENDENCIES = sagelib $(inst_sphinx) $(inst_sagenb) \\\n doc: doc-html\n \n doc-html: $(DOC_DEPENDENCIES)\n-    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )\n+       $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )\n \n docbuild-html:\n        $(AM_V_at)cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log\n```\n(that is, replacing spaces with a tab).",
    "created_at": "2017-03-10T18:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286925",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>
I got the error

```
***********************************************
Makefile:1093: *** missing separator.  Stop.
```
with this, until I made the change

```diff
diff --git a/build/make/deps b/build/make/deps
index e18fd6f..da0a4e9 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -206,7 +206,7 @@ DOC_DEPENDENCIES = sagelib $(inst_sphinx) $(inst_sagenb) \
 doc: doc-html
 
 doc-html: $(DOC_DEPENDENCIES)
-    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )
+       $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )
 
 docbuild-html:
        $(AM_V_at)cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log
```
(that is, replacing spaces with a tab).



---

archive/issue_comments_286926.json:
```json
{
    "body": "**Changing commit** from \"[e80667dee0e1ad2fff59c3b3007a724d80c0aed5](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)\" to \"[83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)\".",
    "created_at": "2017-03-10T18:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286926",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e80667dee0e1ad2fff59c3b3007a724d80c0aed5](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)" to "[83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)".



---

archive/issue_comments_286927.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889\">83d8cc8</a></td><td><code>#19882 : replace spaces by tabs.</code></td></tr></table>\n",
    "created_at": "2017-03-10T18:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286927",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889">83d8cc8</a></td><td><code>#19882 : replace spaces by tabs.</code></td></tr></table>




---

archive/issue_comments_286928.json:
```json
{
    "body": "<a id='comment:23'></a>\nOops, thanks for noticing, i did a 'hand rebase', without noticing that my editor behave as for python files. Sorry.",
    "created_at": "2017-03-10T18:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286928",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:23'></a>
Oops, thanks for noticing, i did a 'hand rebase', without noticing that my editor behave as for python files. Sorry.



---

archive/issue_comments_286929.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis works. I wish there were a less drastic solution, but let's merge it now and see if someone comes up with something better later.",
    "created_at": "2017-03-10T20:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286929",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>
This works. I wish there were a less drastic solution, but let's merge it now and see if someone comes up with something better later.



---

archive/issue_events_242610.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:25:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242610"
}
```



---

archive/issue_events_242611.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:25:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242611"
}
```



---

archive/issue_comments_286930.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2017-03-10T20:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286930",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_286931.json:
```json
{
    "body": "<a id='comment:25'></a>\nDid you check that `make -q` still works as expected?",
    "created_at": "2017-03-10T20:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286931",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Did you check that `make -q` still works as expected?



---

archive/issue_events_242612.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:35:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242612"
}
```



---

archive/issue_events_242613.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:35:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242613"
}
```



---

archive/issue_comments_286932.json:
```json
{
    "body": "<a id='comment:26'></a>\nNo, good point.",
    "created_at": "2017-03-10T20:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286932",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
No, good point.



---

archive/issue_comments_286933.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [@jdemeyer](#comment%3A25):\n> Did you check that `make -q` still works as expected?\n\nI guess I don't know what you mean, now that I've tested it. With the current develop branch, if I run `make` successfully, then I see\n\n```\n$ make -q\n$ echo $?\n1\n```\nSo it doesn't work (IMHO) with the develop branch. It continues to not work with this branch. Is that working \"as expected\"?",
    "created_at": "2017-03-10T20:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286933",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>
Replying to [@jdemeyer](#comment%3A25):
> Did you check that `make -q` still works as expected?

I guess I don't know what you mean, now that I've tested it. With the current develop branch, if I run `make` successfully, then I see

```
$ make -q
$ echo $?
1
```
So it doesn't work (IMHO) with the develop branch. It continues to not work with this branch. Is that working "as expected"?



---

archive/issue_comments_286934.json:
```json
{
    "body": "<a id='comment:28'></a>\nCheck this out for alternative solution.\n\nhttps://trac.sagemath.org/ticket/22588",
    "created_at": "2017-03-13T00:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286934",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:28'></a>
Check this out for alternative solution.

https://trac.sagemath.org/ticket/22588



---

archive/issue_comments_286935.json:
```json
{
    "body": "<a id='comment:29'></a>\nI think that the alternate solution at #22588 and this one both have advantages. For example, if you change your version of Sphinx, you may need to delete the docs and rebuild from scratch (maybe because of the inventory files? I'm not sure). I'm not sure that #22588 will catch that. So why not use both approaches?\n\nThat said, my question above about `make -q` still remains.",
    "created_at": "2017-03-14T18:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286935",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>
I think that the alternate solution at #22588 and this one both have advantages. For example, if you change your version of Sphinx, you may need to delete the docs and rebuild from scratch (maybe because of the inventory files? I'm not sure). I'm not sure that #22588 will catch that. So why not use both approaches?

That said, my question above about `make -q` still remains.



---

archive/issue_comments_286936.json:
```json
{
    "body": "<a id='comment:30'></a>\nJeroen: can you explain what you meant in [comment:25](#comment%3A25) about `make -q`? With or without this branch, `make -q` leads to `echo $?` reporting \"1\", not \"0\". Do you object to a positive review for this?\n\n(As I said, I also think that there is reason to keep both this and #22588.)",
    "created_at": "2017-08-03T23:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286936",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>
Jeroen: can you explain what you meant in [comment:25](#comment%3A25) about `make -q`? With or without this branch, `make -q` leads to `echo $?` reporting "1", not "0". Do you object to a positive review for this?

(As I said, I also think that there is reason to keep both this and #22588.)



---

archive/issue_comments_286937.json:
```json
{
    "body": "<a id='comment:31'></a>\nSo what should we do here, given #22588? Close as wontfix?",
    "created_at": "2017-09-05T13:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286937",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
So what should we do here, given #22588? Close as wontfix?



---

archive/issue_comments_286938.json:
```json
{
    "body": "<a id='comment:32'></a>\nWill #22588 always work, or will the docs still fail to build some time (I guessed at one scenario in [comment:29](#comment%3A29))?",
    "created_at": "2017-09-05T14:09:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286938",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
Will #22588 always work, or will the docs still fail to build some time (I guessed at one scenario in [comment:29](#comment%3A29))?



---

archive/issue_comments_286939.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [@jhpalmieri](#comment%3A32):\n> Will #22588 always work, or will the docs still fail to build some time\n\nThat's something to be seen I guess. The question is: if issues arise with #22588, should we try to fix those issues or should we implement the \"nuclear option\" of this ticket?",
    "created_at": "2017-09-05T14:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286939",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Replying to [@jhpalmieri](#comment%3A32):
> Will #22588 always work, or will the docs still fail to build some time

That's something to be seen I guess. The question is: if issues arise with #22588, should we try to fix those issues or should we implement the "nuclear option" of this ticket?



---

archive/issue_comments_286940.json:
```json
{
    "body": "<a id='comment:34'></a>\nI don't have strong feelings about it. Since it took so long to get an attempted fix, I'm not that optimistic that future problems will be dealt with, but I don't mind closing this and seeing what happens.",
    "created_at": "2017-09-05T15:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286940",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>
I don't have strong feelings about it. Since it took so long to get an attempted fix, I'm not that optimistic that future problems will be dealt with, but I don't mind closing this and seeing what happens.



---

archive/issue_comments_286941.json:
```json
{
    "body": "<a id='comment:35'></a>\nNow with #22588, I hope that the doc builder is reliable.  I mean: if doc build fails, then the reason is genuine, that is, there is a problem with the doc source, and doc build would fail even after doc-clean. Then the solution of this ticket is actually just to delay the time to recognize the problem of the doc source.  \n\nBut time will tell whether I am just too optimistic..",
    "created_at": "2017-09-05T15:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286941",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:35'></a>
Now with #22588, I hope that the doc builder is reliable.  I mean: if doc build fails, then the reason is genuine, that is, there is a problem with the doc source, and doc build would fail even after doc-clean. Then the solution of this ticket is actually just to delay the time to recognize the problem of the doc source.  

But time will tell whether I am just too optimistic..



---

archive/issue_comments_286942.json:
```json
{
    "body": "<a id='comment:36'></a>\nI just did an incremental build from 8.1.beta3 to 8.1.beta4 and got\n\n```\n[dochtml] Building reference manual, first pass.\n[dochtml] \n[dochtml] Error building the documentation.\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n[dochtml]     \"__main__\", fname, loader, pkg_name)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py\", line 72, in _run_code\n[dochtml]     exec code in run_globals\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1675, in main\n[dochtml]     builder()\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 310, in _wrapper\n[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 505, in _wrapper\n[dochtml]     build_many(build_ref_doc, L)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 246, in build_many\n[dochtml]     ret = x.get(99999)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/multiprocessing/pool.py\", line 567, in get\n[dochtml]     raise self._value\n[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'\n[dochtml] \n[dochtml] Note: incremental documentation builds sometimes cause spurious\n[dochtml] error messages. To be certain that these are real errors, run\n[dochtml] \"make doc-clean\" first and try again.\n```",
    "created_at": "2017-09-06T01:54:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286942",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>
I just did an incremental build from 8.1.beta3 to 8.1.beta4 and got

```
[dochtml] Building reference manual, first pass.
[dochtml] 
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1675, in main
[dochtml]     builder()
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 310, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 505, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 246, in build_many
[dochtml]     ret = x.get(99999)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/multiprocessing/pool.py", line 567, in get
[dochtml]     raise self._value
[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'
[dochtml] 
[dochtml] Note: incremental documentation builds sometimes cause spurious
[dochtml] error messages. To be certain that these are real errors, run
[dochtml] "make doc-clean" first and try again.
```



---

archive/issue_comments_286943.json:
```json
{
    "body": "<a id='comment:37'></a>\nAnd this seems to be repeatable for me: I switched back to 8.1.beta3, did `make doc-clean; make`, and then when I tried to build 8.1.beta4, same error.",
    "created_at": "2017-09-06T04:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286943",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'></a>
And this seems to be repeatable for me: I switched back to 8.1.beta3, did `make doc-clean; make`, and then when I tried to build 8.1.beta4, same error.



---

archive/issue_comments_286944.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [@jhpalmieri](#comment%3A36):\n> `[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'`\n\nThis is very likely due to the Sphinx upgrade #23023. It makes sense to require a complete rebuild of the docs when changing Sphinx versions. This should be automated, just like we automatically re-cythonize the Sage library whenever the Cython version changes.",
    "created_at": "2017-09-06T11:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286944",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
Replying to [@jhpalmieri](#comment%3A36):
> `[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'`

This is very likely due to the Sphinx upgrade #23023. It makes sense to require a complete rebuild of the docs when changing Sphinx versions. This should be automated, just like we automatically re-cythonize the Sage library whenever the Cython version changes.



---

archive/issue_comments_286945.json:
```json
{
    "body": "<a id='comment:39'></a>\nWe could delete the docs in the Sphinx `spkg-install` script. We used to do this, but then at some point (#11665) we decided to try to keep the old docs.",
    "created_at": "2017-09-07T15:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286945",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'></a>
We could delete the docs in the Sphinx `spkg-install` script. We used to do this, but then at some point (#11665) we decided to try to keep the old docs.



---

archive/issue_comments_286946.json:
```json
{
    "body": "<a id='comment:40'></a>\nFor example like this:\n\n```diff\ndiff --git a/build/pkgs/sphinx/spkg-install b/build/pkgs/sphinx/spkg-install\nindex 200965b566..05085aaa79 100644\n--- a/build/pkgs/sphinx/spkg-install\n+++ b/build/pkgs/sphinx/spkg-install\n@@ -23,6 +23,12 @@ $PIP_INSTALL .\n success 'Error installing Sphinx'\n echo\n \n+echo \"A new version of Sphinx was installed, so deleting old Sage documentation output...\"\n+echo \"Removing \\\"$SAGE_DOC\\\"...\"\n+rm -rf \"$SAGE_DOC\"\n+success 'Error removing the old documentation'\n+echo\n+\n cd \"$CUR\"\n echo \"Creating grammar pickle...\"\n sage-python23 create_grammar_pickle.py\n```",
    "created_at": "2017-09-07T17:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286946",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>
For example like this:

```diff
diff --git a/build/pkgs/sphinx/spkg-install b/build/pkgs/sphinx/spkg-install
index 200965b566..05085aaa79 100644
--- a/build/pkgs/sphinx/spkg-install
+++ b/build/pkgs/sphinx/spkg-install
@@ -23,6 +23,12 @@ $PIP_INSTALL .
 success 'Error installing Sphinx'
 echo
 
+echo "A new version of Sphinx was installed, so deleting old Sage documentation output..."
+echo "Removing \"$SAGE_DOC\"..."
+rm -rf "$SAGE_DOC"
+success 'Error removing the old documentation'
+echo
+
 cd "$CUR"
 echo "Creating grammar pickle..."
 sage-python23 create_grammar_pickle.py
```



---

archive/issue_comments_286947.json:
```json
{
    "body": "<a id='comment:41'></a>\nIf this is a good idea, we can do it here or open another ticket.",
    "created_at": "2017-09-07T17:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286947",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>
If this is a good idea, we can do it here or open another ticket.



---

archive/issue_comments_286948.json:
```json
{
    "body": "<a id='comment:42'></a>\nI like the principle, but not the approach of using the Sphinx installer to remove the docs. It goes against seperation of concerns. Better would be to implement this in the docbuilder: find out the timestamp or version of the installed Sphinx and then take action.",
    "created_at": "2017-09-08T07:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286948",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
I like the principle, but not the approach of using the Sphinx installer to remove the docs. It goes against seperation of concerns. Better would be to implement this in the docbuilder: find out the timestamp or version of the installed Sphinx and then take action.



---

archive/issue_comments_286949.json:
```json
{
    "body": "<a id='comment:43'></a>\nSee #23803",
    "created_at": "2017-09-08T07:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286949",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'></a>
See #23803



---

archive/issue_events_242614.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242614"
}
```



---

archive/issue_events_242615.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242615"
}
```



---

archive/issue_events_242616.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242616"
}
```



---

archive/issue_comments_286950.json:
```json
{
    "body": "<a id='comment:44'></a>\nOkay, let's close this.",
    "created_at": "2017-09-08T18:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286950",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>
Okay, let's close this.



---

archive/issue_comments_286951.json:
```json
{
    "body": "**Changing reviewer** from \"John Palmieri\" to \"John Palmieri, Thierry Monteil\".",
    "created_at": "2017-10-31T10:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286951",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "John Palmieri" to "John Palmieri, Thierry Monteil".



---

archive/issue_comments_286952.json:
```json
{
    "body": "**Changing author** from \"Thierry Monteil\" to \"\".",
    "created_at": "2017-10-31T10:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286952",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Thierry Monteil" to "".



---

archive/issue_events_242617.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-31T10:56:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242617"
}
```



---

archive/issue_events_242618.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-31T10:56:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242618"
}
```



---

archive/issue_events_242619.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242619"
}
```



---

archive/issue_events_242620.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242620"
}
```



---

archive/issue_events_242621.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "008080",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-242621"
}
```
