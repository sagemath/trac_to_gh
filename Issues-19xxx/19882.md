# Issue 19882: Let "make doc" always work.

archive/issues_019645.json:
```json
{
    "assignees": [],
    "body": "As requested in #18464. Currently `make doc` can fail when some previous documentation was built.\n\n\n\nBranch/Commit: **[u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_) @ [83d8cc8](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)**\n\nReviewer: **John Palmieri, Thierry Monteil**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19882_\n\n",
    "closed_at": "2017-12-12T08:23:33Z",
    "created_at": "2016-01-13T17:39:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Let \"make doc\" always work.",
    "type": "issue",
    "updated_at": "2017-12-12T08:23:33Z",
    "url": "https://github.com/sagemath/sage/issues/19882",
    "user": "https://github.com/sagetrac-tmonteil"
}
```
As requested in #18464. Currently `make doc` can fail when some previous documentation was built.



Branch/Commit: **[u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_) @ [83d8cc8](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)**

Reviewer: **John Palmieri, Thierry Monteil**

_Issue created by migration from https://trac.sagemath.org/ticket/19882_





---

archive/issue_events_263214.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:39:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "milestone_number": null,
    "milestone_title": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263214"
}
```



---

archive/issue_events_263215.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:39:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263215"
}
```



---

archive/issue_events_263216.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:39:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263216"
}
```



---

archive/issue_events_263217.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:39:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263217"
}
```



---

archive/issue_comments_286969.json:
```json
{
    "body": "Branch: **[u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_)**",
    "created_at": "2016-01-13T17:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286969",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Branch: **[u/tmonteil/let__make_doc__always_work_](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/let__make_doc__always_work_)**



---

archive/issue_comments_286970.json:
```json
{
    "body": "Author: **Thierry Monteil**",
    "created_at": "2016-01-13T17:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286970",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Author: **Thierry Monteil**



---

archive/issue_comments_286971.json:
```json
{
    "body": "Commit: **[131ff97](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)**",
    "created_at": "2016-01-13T17:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286971",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Commit: **[131ff97](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)**



---

archive/issue_events_263218.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-13T17:42:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263218"
}
```



---

archive/issue_comments_286972.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThe proposed fix is to just let the `doc` target depend on `doc-clean`. Perhaps is there a lighter solution ?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54\">131ff97</a></td><td><code>#19882 : let doc target depend on doc-clean.</code></td></tr></table>\n",
    "created_at": "2016-01-13T17:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286972",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:2" align="right">Comment 2</div>

The proposed fix is to just let the `doc` target depend on `doc-clean`. Perhaps is there a lighter solution ?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54">131ff97</a></td><td><code>#19882 : let doc target depend on doc-clean.</code></td></tr></table>




---

archive/issue_events_263219.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-13T18:03:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263219"
}
```



---

archive/issue_events_263220.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-13T18:03:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263220"
}
```



---

archive/issue_comments_286973.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nNo, this would force the doc to be rebuilt everytime you run `make`.",
    "created_at": "2016-01-13T18:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286973",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">Comment 3</div>

No, this would force the doc to be rebuilt everytime you run `make`.



---

archive/issue_comments_286974.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nSo, what should be done ?",
    "created_at": "2016-01-13T18:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286974",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:4" align="right">Comment 4</div>

So, what should be done ?



---

archive/issue_comments_286975.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nFigure out **why** the docbuilder sometimes fails and fix that.",
    "created_at": "2016-01-13T18:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286975",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">Comment 5</div>

Figure out **why** the docbuilder sometimes fails and fix that.



---

archive/issue_comments_286976.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nDo we have ideas why? If a `.py` or `.pyx` file is present in one branch and not in another, this confuses the docbuilder. What else goes wrong?",
    "created_at": "2016-01-13T21:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286976",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">Comment 6</div>

Do we have ideas why? If a `.py` or `.pyx` file is present in one branch and not in another, this confuses the docbuilder. What else goes wrong?



---

archive/issue_comments_286977.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@sagetrac-tmonteil](#comment%3A4):\n> So, what should be done ?\n\nAs quick fix, the following might work:\n\n1. try to build the documentation normally.\n2. if that fails, run `make doc-clean` and rebuild the documentation.\n\nStep 1 is crucial to avoid a lot of needless rebuilds of the documentation.",
    "created_at": "2016-01-14T22:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286977",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@sagetrac-tmonteil](#comment%3A4):
> So, what should be done ?

As quick fix, the following might work:

1. try to build the documentation normally.
2. if that fails, run `make doc-clean` and rebuild the documentation.

Step 1 is crucial to avoid a lot of needless rebuilds of the documentation.



---

archive/issue_comments_286978.json:
```json
{
    "body": "Changed commit from **[131ff97](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)** to **[80a0a52](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)**",
    "created_at": "2016-01-15T17:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286978",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[131ff97](https://github.com/sagemath/sagetrac-mirror/commit/131ff97a5e7fa8dfb33c907ad68dc2bfe6151a54)** to **[80a0a52](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)**



---

archive/issue_comments_286979.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca\">80a0a52</a></td><td><code>#19882 : run doc-clean only if doc-html lead to an error.</code></td></tr></table>\n",
    "created_at": "2016-01-15T17:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286979",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca">80a0a52</a></td><td><code>#19882 : run doc-clean only if doc-html lead to an error.</code></td></tr></table>




---

archive/issue_comments_286980.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI am wondering if the recursive call of `$(MAKE)` is a good idea (I'm not saying it's bad, I just need to think about it).",
    "created_at": "2016-01-15T17:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286980",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">Comment 9</div>

I am wondering if the recursive call of `$(MAKE)` is a good idea (I'm not saying it's bad, I just need to think about it).



---

archive/issue_comments_286981.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThe current Makefile already calls `$(MAKE)`, see e.g. in #18710:\n\n```\nbdist-clean: clean\n        $(MAKE) misc-clean\n```\n\nThat said, there is no real recursivity since the `doc` target depends on `doc-html` and `doc-clean`, and none of those depend on `doc`, so i do not see any loop possibility. I am currently doing a few tests to see how it works in various cases.",
    "created_at": "2016-01-15T19:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286981",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:10" align="right">Comment 10</div>

The current Makefile already calls `$(MAKE)`, see e.g. in #18710:

```
bdist-clean: clean
        $(MAKE) misc-clean
```

That said, there is no real recursivity since the `doc` target depends on `doc-html` and `doc-clean`, and none of those depend on `doc`, so i do not see any loop possibility. I am currently doing a few tests to see how it works in various cases.



---

archive/issue_comments_286982.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nIt's problematic that `doc-html` has dependencies which also appear as dependencies of `all-sage`. So we can end up in a situation where there are two instances of `make` building the same targets.",
    "created_at": "2016-01-16T10:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286982",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">Comment 11</div>

It's problematic that `doc-html` has dependencies which also appear as dependencies of `all-sage`. So we can end up in a situation where there are two instances of `make` building the same targets.



---

archive/issue_comments_286983.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nMaybe you can solve this with an extra level of indirection:\n\n```\ndoc-html: $(DOC_DEPENDENCIES)\n    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )\n\ndocbuild-html:\n    cd ../.. && sage-logger './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log\n```\n\nUgly, but I guess it would work.",
    "created_at": "2016-01-16T11:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286983",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">Comment 12</div>

Maybe you can solve this with an extra level of indirection:

```
doc-html: $(DOC_DEPENDENCIES)
    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )

docbuild-html:
    cd ../.. && sage-logger './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log
```

Ugly, but I guess it would work.



---

archive/issue_comments_286984.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd\">5b555ae</a></td><td><code>#19882 add one level of indirection (comment 12)</code></td></tr></table>\n",
    "created_at": "2016-01-26T10:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286984",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13" align="right">Comment 13</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd">5b555ae</a></td><td><code>#19882 add one level of indirection (comment 12)</code></td></tr></table>




---

archive/issue_comments_286985.json:
```json
{
    "body": "Changed commit from **[80a0a52](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)** to **[5b555ae](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)**",
    "created_at": "2016-01-26T10:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286985",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[80a0a52](https://github.com/sagemath/sagetrac-mirror/commit/80a0a522ccc5c0768558ae32ea98c995a3c8e9ca)** to **[5b555ae](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)**



---

archive/issue_events_263221.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-27T21:59:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263221"
}
```



---

archive/issue_events_263222.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2016-01-27T21:59:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263222"
}
```



---

archive/issue_comments_286986.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nIt seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?",
    "created_at": "2016-01-27T21:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286986",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:14" align="right">Comment 14</div>

It seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?



---

archive/issue_comments_286987.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nDid you try `make -q` too? I am afraid that will break.",
    "created_at": "2016-01-29T07:16:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286987",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

Did you try `make -q` too? I am afraid that will break.



---

archive/issue_comments_286988.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@sagetrac-tmonteil](#comment%3A14):\n> It seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?\n\nI would just create a dummy file with some simple doc<sup>1</sup>, build the doc, delete the file, and rebuild the doc (perhaps on a branch based on this one).\n\nAlternatively, you could create a branch where you just remove a file and try to build the doc.\n\n<sup>1</sup> - Don't forget to add an entry in the `.rst` files.",
    "created_at": "2016-01-29T15:19:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286988",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@sagetrac-tmonteil](#comment%3A14):
> It seems to work. Do someone know a way to reproduce that kind of docbuild error that disappears after a `doc-clean` ?

I would just create a dummy file with some simple doc<sup>1</sup>, build the doc, delete the file, and rebuild the doc (perhaps on a branch based on this one).

Alternatively, you could create a branch where you just remove a file and try to build the doc.

<sup>1</sup> - Don't forget to add an entry in the `.rst` files.



---

archive/issue_comments_286989.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\n#21378 got positive review (duplicate won't fix) saying that this ticket (#19882) is a better solution. But there was no update on #19882 since 8 months...\n\nNo later than yesterday, I run `make ptestlong` overnight to realize the day after that the doc failed and no test at all were ever made:\n\n```\n[dochtml] OSError: [homology ] Exception occurred:\n[dochtml] \n[dochtml] \n[dochtml] Note: incremental documentation builds sometimes cause spurious\n[dochtml] error messages. To be certain that these are real errors, run\n[dochtml] \"make doc-clean\" first and try again.\nMakefile:1061\u00a0: la recette pour la cible \u00ab\u00a0doc-html\u00a0\u00bb a \u00e9chou\u00e9e\n```\n\nI would like that `make ptestlong` always work...",
    "created_at": "2016-10-05T15:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286989",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:17" align="right">Comment 17</div>

#21378 got positive review (duplicate won't fix) saying that this ticket (#19882) is a better solution. But there was no update on #19882 since 8 months...

No later than yesterday, I run `make ptestlong` overnight to realize the day after that the doc failed and no test at all were ever made:

```
[dochtml] OSError: [homology ] Exception occurred:
[dochtml] 
[dochtml] 
[dochtml] Note: incremental documentation builds sometimes cause spurious
[dochtml] error messages. To be certain that these are real errors, run
[dochtml] "make doc-clean" first and try again.
Makefile:1061 : la recette pour la cible « doc-html » a échouée
```

I would like that `make ptestlong` always work...



---

archive/issue_events_263223.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263223"
}
```



---

archive/issue_events_263224.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263224"
}
```



---

archive/issue_comments_286990.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nMerge conflict...",
    "created_at": "2016-10-21T08:07:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286990",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">Comment 18</div>

Merge conflict...



---

archive/issue_events_263225.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "milestone_number": null,
    "milestone_title": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263225"
}
```



---

archive/issue_events_263226.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:07:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263226"
}
```



---

archive/issue_comments_286991.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5\">e80667d</a></td><td><code>#19882 : rebased on 7.6.beta6.</code></td></tr></table>\n",
    "created_at": "2017-03-10T09:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286991",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19" align="right">Comment 19</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5">e80667d</a></td><td><code>#19882 : rebased on 7.6.beta6.</code></td></tr></table>




---

archive/issue_comments_286992.json:
```json
{
    "body": "Changed commit from **[5b555ae](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)** to **[e80667d](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)**",
    "created_at": "2017-03-10T09:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286992",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5b555ae](https://github.com/sagemath/sagetrac-mirror/commit/5b555ae3493879c81f7f7ba7190dd1e272f54dbd)** to **[e80667d](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)**



---

archive/issue_comments_286993.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nHere is a rebased version. Unfortunately, my laptop does not have enough memory anymore to build Sage doc, so that i can not test it seriously :(",
    "created_at": "2017-03-10T09:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286993",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:20" align="right">Comment 20</div>

Here is a rebased version. Unfortunately, my laptop does not have enough memory anymore to build Sage doc, so that i can not test it seriously :(



---

archive/issue_events_263227.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-03-10T09:06:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263227"
}
```



---

archive/issue_events_263228.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-03-10T09:06:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263228"
}
```



---

archive/issue_comments_286994.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI got the error\n\n```\n***********************************************\nMakefile:1093: *** missing separator.  Stop.\n```\nwith this, until I made the change\n\n```diff\ndiff --git a/build/make/deps b/build/make/deps\nindex e18fd6f..da0a4e9 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -206,7 +206,7 @@ DOC_DEPENDENCIES = sagelib $(inst_sphinx) $(inst_sagenb) \\\n doc: doc-html\n \n doc-html: $(DOC_DEPENDENCIES)\n-    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )\n+       $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )\n \n docbuild-html:\n        $(AM_V_at)cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log\n```\n(that is, replacing spaces with a tab).",
    "created_at": "2017-03-10T18:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286994",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">Comment 21</div>

I got the error

```
***********************************************
Makefile:1093: *** missing separator.  Stop.
```
with this, until I made the change

```diff
diff --git a/build/make/deps b/build/make/deps
index e18fd6f..da0a4e9 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -206,7 +206,7 @@ DOC_DEPENDENCIES = sagelib $(inst_sphinx) $(inst_sagenb) \
 doc: doc-html
 
 doc-html: $(DOC_DEPENDENCIES)
-    $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )
+       $(MAKE) docbuild-html || ( $(MAKE) doc-clean ; $(MAKE) docbuild-html )
 
 docbuild-html:
        $(AM_V_at)cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html $(SAGE_DOCBUILD_OPTS)' logs/dochtml.log
```
(that is, replacing spaces with a tab).



---

archive/issue_comments_286995.json:
```json
{
    "body": "Changed commit from **[e80667d](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)** to **[83d8cc8](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)**",
    "created_at": "2017-03-10T18:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286995",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e80667d](https://github.com/sagemath/sagetrac-mirror/commit/e80667dee0e1ad2fff59c3b3007a724d80c0aed5)** to **[83d8cc8](https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889)**



---

archive/issue_comments_286996.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889\">83d8cc8</a></td><td><code>#19882 : replace spaces by tabs.</code></td></tr></table>\n",
    "created_at": "2017-03-10T18:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286996",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22" align="right">Comment 22</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83d8cc8c87a6c4bb32a8bb9ffad22bfa59872889">83d8cc8</a></td><td><code>#19882 : replace spaces by tabs.</code></td></tr></table>




---

archive/issue_comments_286997.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nOops, thanks for noticing, i did a 'hand rebase', without noticing that my editor behave as for python files. Sorry.",
    "created_at": "2017-03-10T18:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286997",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:23" align="right">Comment 23</div>

Oops, thanks for noticing, i did a 'hand rebase', without noticing that my editor behave as for python files. Sorry.



---

archive/issue_comments_286998.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nThis works. I wish there were a less drastic solution, but let's merge it now and see if someone comes up with something better later.",
    "created_at": "2017-03-10T20:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286998",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">Comment 24</div>

This works. I wish there were a less drastic solution, but let's merge it now and see if someone comes up with something better later.



---

archive/issue_events_263229.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:25:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263229"
}
```



---

archive/issue_events_263230.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:25:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263230"
}
```



---

archive/issue_comments_286999.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2017-03-10T20:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-286999",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_287000.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nDid you check that `make -q` still works as expected?",
    "created_at": "2017-03-10T20:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287000",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">Comment 25</div>

Did you check that `make -q` still works as expected?



---

archive/issue_events_263231.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:35:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263231"
}
```



---

archive/issue_events_263232.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-03-10T20:35:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263232"
}
```



---

archive/issue_comments_287001.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nNo, good point.",
    "created_at": "2017-03-10T20:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287001",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">Comment 26</div>

No, good point.



---

archive/issue_comments_287002.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nReplying to [@jdemeyer](#comment%3A25):\n> Did you check that `make -q` still works as expected?\n\nI guess I don't know what you mean, now that I've tested it. With the current develop branch, if I run `make` successfully, then I see\n\n```\n$ make -q\n$ echo $?\n1\n```\nSo it doesn't work (IMHO) with the develop branch. It continues to not work with this branch. Is that working \"as expected\"?",
    "created_at": "2017-03-10T20:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287002",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">Comment 27</div>

Replying to [@jdemeyer](#comment%3A25):
> Did you check that `make -q` still works as expected?

I guess I don't know what you mean, now that I've tested it. With the current develop branch, if I run `make` successfully, then I see

```
$ make -q
$ echo $?
1
```
So it doesn't work (IMHO) with the develop branch. It continues to not work with this branch. Is that working "as expected"?



---

archive/issue_comments_287003.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nCheck this out for alternative solution.\n\nhttps://trac.sagemath.org/ticket/22588",
    "created_at": "2017-03-13T00:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287003",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:28" align="right">Comment 28</div>

Check this out for alternative solution.

https://trac.sagemath.org/ticket/22588



---

archive/issue_comments_287004.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nI think that the alternate solution at #22588 and this one both have advantages. For example, if you change your version of Sphinx, you may need to delete the docs and rebuild from scratch (maybe because of the inventory files? I'm not sure). I'm not sure that #22588 will catch that. So why not use both approaches?\n\nThat said, my question above about `make -q` still remains.",
    "created_at": "2017-03-14T18:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287004",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">Comment 29</div>

I think that the alternate solution at #22588 and this one both have advantages. For example, if you change your version of Sphinx, you may need to delete the docs and rebuild from scratch (maybe because of the inventory files? I'm not sure). I'm not sure that #22588 will catch that. So why not use both approaches?

That said, my question above about `make -q` still remains.



---

archive/issue_comments_287005.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nJeroen: can you explain what you meant in [comment:25](#comment%3A25) about `make -q`? With or without this branch, `make -q` leads to `echo $?` reporting \"1\", not \"0\". Do you object to a positive review for this?\n\n(As I said, I also think that there is reason to keep both this and #22588.)",
    "created_at": "2017-08-03T23:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287005",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">Comment 30</div>

Jeroen: can you explain what you meant in [comment:25](#comment%3A25) about `make -q`? With or without this branch, `make -q` leads to `echo $?` reporting "1", not "0". Do you object to a positive review for this?

(As I said, I also think that there is reason to keep both this and #22588.)



---

archive/issue_comments_287006.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nSo what should we do here, given #22588? Close as wontfix?",
    "created_at": "2017-09-05T13:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287006",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">Comment 31</div>

So what should we do here, given #22588? Close as wontfix?



---

archive/issue_comments_287007.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nWill #22588 always work, or will the docs still fail to build some time (I guessed at one scenario in [comment:29](#comment%3A29))?",
    "created_at": "2017-09-05T14:09:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287007",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">Comment 32</div>

Will #22588 always work, or will the docs still fail to build some time (I guessed at one scenario in [comment:29](#comment%3A29))?



---

archive/issue_comments_287008.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nReplying to [@jhpalmieri](#comment%3A32):\n> Will #22588 always work, or will the docs still fail to build some time\n\nThat's something to be seen I guess. The question is: if issues arise with #22588, should we try to fix those issues or should we implement the \"nuclear option\" of this ticket?",
    "created_at": "2017-09-05T14:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287008",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">Comment 33</div>

Replying to [@jhpalmieri](#comment%3A32):
> Will #22588 always work, or will the docs still fail to build some time

That's something to be seen I guess. The question is: if issues arise with #22588, should we try to fix those issues or should we implement the "nuclear option" of this ticket?



---

archive/issue_comments_287009.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nI don't have strong feelings about it. Since it took so long to get an attempted fix, I'm not that optimistic that future problems will be dealt with, but I don't mind closing this and seeing what happens.",
    "created_at": "2017-09-05T15:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287009",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">Comment 34</div>

I don't have strong feelings about it. Since it took so long to get an attempted fix, I'm not that optimistic that future problems will be dealt with, but I don't mind closing this and seeing what happens.



---

archive/issue_comments_287010.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nNow with #22588, I hope that the doc builder is reliable.  I mean: if doc build fails, then the reason is genuine, that is, there is a problem with the doc source, and doc build would fail even after doc-clean. Then the solution of this ticket is actually just to delay the time to recognize the problem of the doc source.  \n\nBut time will tell whether I am just too optimistic..",
    "created_at": "2017-09-05T15:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287010",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:35" align="right">Comment 35</div>

Now with #22588, I hope that the doc builder is reliable.  I mean: if doc build fails, then the reason is genuine, that is, there is a problem with the doc source, and doc build would fail even after doc-clean. Then the solution of this ticket is actually just to delay the time to recognize the problem of the doc source.  

But time will tell whether I am just too optimistic..



---

archive/issue_comments_287011.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nI just did an incremental build from 8.1.beta3 to 8.1.beta4 and got\n\n```\n[dochtml] Building reference manual, first pass.\n[dochtml] \n[dochtml] Error building the documentation.\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n[dochtml]     \"__main__\", fname, loader, pkg_name)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py\", line 72, in _run_code\n[dochtml]     exec code in run_globals\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1675, in main\n[dochtml]     builder()\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 310, in _wrapper\n[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 505, in _wrapper\n[dochtml]     build_many(build_ref_doc, L)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 246, in build_many\n[dochtml]     ret = x.get(99999)\n[dochtml]   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/multiprocessing/pool.py\", line 567, in get\n[dochtml]     raise self._value\n[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'\n[dochtml] \n[dochtml] Note: incremental documentation builds sometimes cause spurious\n[dochtml] error messages. To be certain that these are real errors, run\n[dochtml] \"make doc-clean\" first and try again.\n```",
    "created_at": "2017-09-06T01:54:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287011",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:36" align="right">Comment 36</div>

I just did an incremental build from 8.1.beta3 to 8.1.beta4 and got

```
[dochtml] Building reference manual, first pass.
[dochtml] 
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1675, in main
[dochtml]     builder()
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 310, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 505, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 246, in build_many
[dochtml]     ret = x.get(99999)
[dochtml]   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/multiprocessing/pool.py", line 567, in get
[dochtml]     raise self._value
[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'
[dochtml] 
[dochtml] Note: incremental documentation builds sometimes cause spurious
[dochtml] error messages. To be certain that these are real errors, run
[dochtml] "make doc-clean" first and try again.
```



---

archive/issue_comments_287012.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nAnd this seems to be repeatable for me: I switched back to 8.1.beta3, did `make doc-clean; make`, and then when I tried to build 8.1.beta4, same error.",
    "created_at": "2017-09-06T04:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287012",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">Comment 37</div>

And this seems to be repeatable for me: I switched back to 8.1.beta3, did `make doc-clean; make`, and then when I tried to build 8.1.beta4, same error.



---

archive/issue_comments_287013.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@jhpalmieri](#comment%3A36):\n> `[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'`\n\nThis is very likely due to the Sphinx upgrade #23023. It makes sense to require a complete rebuild of the docs when changing Sphinx versions. This should be automated, just like we automatically re-cythonize the Sage library whenever the Cython version changes.",
    "created_at": "2017-09-06T11:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287013",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@jhpalmieri](#comment%3A36):
> `[dochtml] AttributeError: 'module' object has no attribute 'WarningStream'`

This is very likely due to the Sphinx upgrade #23023. It makes sense to require a complete rebuild of the docs when changing Sphinx versions. This should be automated, just like we automatically re-cythonize the Sage library whenever the Cython version changes.



---

archive/issue_comments_287014.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nWe could delete the docs in the Sphinx `spkg-install` script. We used to do this, but then at some point (#11665) we decided to try to keep the old docs.",
    "created_at": "2017-09-07T15:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287014",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">Comment 39</div>

We could delete the docs in the Sphinx `spkg-install` script. We used to do this, but then at some point (#11665) we decided to try to keep the old docs.



---

archive/issue_comments_287015.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nFor example like this:\n\n```diff\ndiff --git a/build/pkgs/sphinx/spkg-install b/build/pkgs/sphinx/spkg-install\nindex 200965b566..05085aaa79 100644\n--- a/build/pkgs/sphinx/spkg-install\n+++ b/build/pkgs/sphinx/spkg-install\n@@ -23,6 +23,12 @@ $PIP_INSTALL .\n success 'Error installing Sphinx'\n echo\n \n+echo \"A new version of Sphinx was installed, so deleting old Sage documentation output...\"\n+echo \"Removing \\\"$SAGE_DOC\\\"...\"\n+rm -rf \"$SAGE_DOC\"\n+success 'Error removing the old documentation'\n+echo\n+\n cd \"$CUR\"\n echo \"Creating grammar pickle...\"\n sage-python23 create_grammar_pickle.py\n```",
    "created_at": "2017-09-07T17:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287015",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:40" align="right">Comment 40</div>

For example like this:

```diff
diff --git a/build/pkgs/sphinx/spkg-install b/build/pkgs/sphinx/spkg-install
index 200965b566..05085aaa79 100644
--- a/build/pkgs/sphinx/spkg-install
+++ b/build/pkgs/sphinx/spkg-install
@@ -23,6 +23,12 @@ $PIP_INSTALL .
 success 'Error installing Sphinx'
 echo
 
+echo "A new version of Sphinx was installed, so deleting old Sage documentation output..."
+echo "Removing \"$SAGE_DOC\"..."
+rm -rf "$SAGE_DOC"
+success 'Error removing the old documentation'
+echo
+
 cd "$CUR"
 echo "Creating grammar pickle..."
 sage-python23 create_grammar_pickle.py
```



---

archive/issue_comments_287016.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nIf this is a good idea, we can do it here or open another ticket.",
    "created_at": "2017-09-07T17:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287016",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">Comment 41</div>

If this is a good idea, we can do it here or open another ticket.



---

archive/issue_comments_287017.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nI like the principle, but not the approach of using the Sphinx installer to remove the docs. It goes against seperation of concerns. Better would be to implement this in the docbuilder: find out the timestamp or version of the installed Sphinx and then take action.",
    "created_at": "2017-09-08T07:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287017",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">Comment 42</div>

I like the principle, but not the approach of using the Sphinx installer to remove the docs. It goes against seperation of concerns. Better would be to implement this in the docbuilder: find out the timestamp or version of the installed Sphinx and then take action.



---

archive/issue_comments_287018.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nSee #23803",
    "created_at": "2017-09-08T07:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287018",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">Comment 43</div>

See #23803



---

archive/issue_events_263233.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263233"
}
```



---

archive/issue_events_263234.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263234"
}
```



---

archive/issue_events_263235.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263235"
}
```



---

archive/issue_events_263236.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263236"
}
```



---

archive/issue_events_263237.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-08T18:39:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263237"
}
```



---

archive/issue_comments_287019.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nOkay, let's close this.",
    "created_at": "2017-09-08T18:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287019",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:44" align="right">Comment 44</div>

Okay, let's close this.



---

archive/issue_comments_287020.json:
```json
{
    "body": "Changed reviewer from **John Palmieri** to **John Palmieri, Thierry Monteil**",
    "created_at": "2017-10-31T10:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287020",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **John Palmieri** to **John Palmieri, Thierry Monteil**



---

archive/issue_comments_287021.json:
```json
{
    "body": "Changed author from **Thierry Monteil** to none",
    "created_at": "2017-10-31T10:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19882#issuecomment-287021",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Thierry Monteil** to none



---

archive/issue_events_263238.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-31T10:56:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263238"
}
```



---

archive/issue_events_263239.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-31T10:56:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263239"
}
```



---

archive/issue_events_263240.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263240"
}
```



---

archive/issue_events_263241.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263241"
}
```



---

archive/issue_events_263242.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19882",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "a6a6a6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19882#event-263242"
}
```
