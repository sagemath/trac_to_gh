# Issue 19742: CyclotomicField.zeta() inconsistent with zeta_order() and docs

archive/issues_019505.json:
```json
{
    "body": "`CyclotomicField(k).zeta()` is documented as\n\n```\n        -  ``n`` - integer (default: None, returns element of\n           maximal order)\n```\nHowever, this is not actually the reality:\n\n```\nsage: C = CyclotomicField(5)\nsage: C.zeta().multiplicative_order()  # NOT of maximal order!\n5\nsage: C.zeta(10).multiplicative_order()\n10\n```\n\nThis branch will change `zeta()` to be consistent with what was documented. It will also make it consistent with `zeta_order()`, such that `C.zeta().multiplicative_order()` is equal to `C.zeta_order()`.\n\nBranch/Commit: 748110b4e08ff4b1a61ec13e792c6250d787085e\n\nReviewer: Julian R\u00fcth\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19742\n\n",
    "closed_at": "2015-12-23T11:06:29Z",
    "created_at": "2015-12-18T13:03:58Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "CyclotomicField.zeta() inconsistent with zeta_order() and docs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19742",
    "user": "https://github.com/jdemeyer"
}
```
`CyclotomicField(k).zeta()` is documented as

```
        -  ``n`` - integer (default: None, returns element of
           maximal order)
```
However, this is not actually the reality:

```
sage: C = CyclotomicField(5)
sage: C.zeta().multiplicative_order()  # NOT of maximal order!
5
sage: C.zeta(10).multiplicative_order()
10
```

This branch will change `zeta()` to be consistent with what was documented. It will also make it consistent with `zeta_order()`, such that `C.zeta().multiplicative_order()` is equal to `C.zeta_order()`.

Branch/Commit: 748110b4e08ff4b1a61ec13e792c6250d787085e

Reviewer: Julian Rüth

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19742





---

archive/issue_comments_350380.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,17 @@\n+`CyclotomicField(k).zeta()` is documented as\n \n+```\n+        -  ``n`` - integer (default: None, returns element of\n+           maximal order)\n+```\n+However, this is not actually the reality:\n+\n+```\n+sage: C = CyclotomicField(5)\n+sage: C.zeta().multiplicative_order()  # NOT of maximal order!\n+5\n+sage: C.zeta(10).multiplicative_order()\n+10\n+```\n+\n+This branch will change `zeta()` to be consistent with what was documented. It will also make it consistent with `zeta_order()`, such that `C.zeta().multiplicative_order()` is equal to `C.zeta_order()`.\n``````\n",
    "created_at": "2015-12-18T14:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350380",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,17 @@
+`CyclotomicField(k).zeta()` is documented as
 
+```
+        -  ``n`` - integer (default: None, returns element of
+           maximal order)
+```
+However, this is not actually the reality:
+
+```
+sage: C = CyclotomicField(5)
+sage: C.zeta().multiplicative_order()  # NOT of maximal order!
+5
+sage: C.zeta(10).multiplicative_order()
+10
+```
+
+This branch will change `zeta()` to be consistent with what was documented. It will also make it consistent with `zeta_order()`, such that `C.zeta().multiplicative_order()` is equal to `C.zeta_order()`.
``````




---

archive/issue_comments_350381.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/cyclotomicfield_zeta___inconsistent_with_zeta_order___and_docs\"",
    "created_at": "2015-12-18T15:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350381",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/cyclotomicfield_zeta___inconsistent_with_zeta_order___and_docs"



---

archive/issue_comments_350382.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-18T15:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350382",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_350383.json:
```json
{
    "body": "Changing commit from \"\" to \"748110b4e08ff4b1a61ec13e792c6250d787085e\"",
    "created_at": "2015-12-18T15:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350383",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "748110b4e08ff4b1a61ec13e792c6250d787085e"



---

archive/issue_comments_350384.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[748110b](https://github.com/sagemath/sagetrac-mirror/commit/748110b4e08ff4b1a61ec13e792c6250d787085e)|`Fix CyclotomicField.zeta()`|",
    "created_at": "2015-12-18T15:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350384",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[748110b](https://github.com/sagemath/sagetrac-mirror/commit/748110b4e08ff4b1a61ec13e792c6250d787085e)|`Fix CyclotomicField.zeta()`|



---

archive/issue_comments_350385.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Julian R\u00fcth\"",
    "created_at": "2015-12-20T20:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350385",
    "user": "https://github.com/saraedum"
}
```

Changing reviewer from "" to "Julian Rüth"



---

archive/issue_comments_350386.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-20T20:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350386",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350387.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't think this is quite ready.\n\nIt would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.  But\n\n```\nsage: C = CyclotomicField(5)\nsage: C.primitive_root_of_unity(), C.zeta()\n(-zeta5, -zeta5^3)\n```\n\nThe new error message\n\n```\nsage: C.zeta(4)\n...\nValueError: 4 does not divide order of generator (10)\n```\nis somewhat misleading, since\n\n```\nsage: C.gen().multiplicative_order()\n5\n```\nThe error message for generic fields is better:\n\n```\nsage: K.<a> = NumberField(x^3 - 5)\nsage: K.zeta(3)\n...\nValueError: There are no 3rd roots of unity in self.\n```\nand negative arguments are handled differently:\n\n```\nsage: C.zeta(-2)\n-1\nsage: K.zeta(-2)\nTraceback (most recent call last)\n...\nValueError: n (=-2) must be positive\n```\nBut there is incompatibility with generic fields, for which n=2 is the default (surely a mistake):\n\n```\nsage: K = NumberField(x^2 - x + 1, 'a')\nsage: C = CyclotomicField(6)\nsage: K.zeta(), C.zeta()\n(-1, zeta6)\nsage: C.is_isomorphic(K)\nTrue\n```",
    "created_at": "2015-12-23T07:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350387",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:5'></a>
I don't think this is quite ready.

It would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.  But

```
sage: C = CyclotomicField(5)
sage: C.primitive_root_of_unity(), C.zeta()
(-zeta5, -zeta5^3)
```

The new error message

```
sage: C.zeta(4)
...
ValueError: 4 does not divide order of generator (10)
```
is somewhat misleading, since

```
sage: C.gen().multiplicative_order()
5
```
The error message for generic fields is better:

```
sage: K.<a> = NumberField(x^3 - 5)
sage: K.zeta(3)
...
ValueError: There are no 3rd roots of unity in self.
```
and negative arguments are handled differently:

```
sage: C.zeta(-2)
-1
sage: K.zeta(-2)
Traceback (most recent call last)
...
ValueError: n (=-2) must be positive
```
But there is incompatibility with generic fields, for which n=2 is the default (surely a mistake):

```
sage: K = NumberField(x^2 - x + 1, 'a')
sage: C = CyclotomicField(6)
sage: K.zeta(), C.zeta()
(-1, zeta6)
sage: C.is_isomorphic(K)
True
```



---

archive/issue_comments_350388.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-12-23T07:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350388",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_350389.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-12-23T08:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350389",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_350390.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe title of this ticket is not \"fix all possible issues with `zeta()`\". Open a new ticket if you want other things to be fixed.",
    "created_at": "2015-12-23T08:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350390",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
The title of this ticket is not "fix all possible issues with `zeta()`". Open a new ticket if you want other things to be fixed.



---

archive/issue_comments_350391.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [fwclarke](#comment%3A5):\n> It would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.\n\n\nMaybe reasonable, but there are good reasons why this is not the case:\n\n1. `C.zeta()` is a very fast, almost trivial operation because it's specialized for cyclotomic fields.\n\n2. `C.primitive_root_of_unity()` uses a computation in PARI. This must be so, in order to be consistent with other uses of the PARI unit group.\n\nSo neither making `zeta` an alias of `primitive_root_of_unity` nor making `primitive_root_of_unity` an alias of `zeta` looks like a good idea.",
    "created_at": "2015-12-23T08:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350391",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [fwclarke](#comment%3A5):
> It would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.


Maybe reasonable, but there are good reasons why this is not the case:

1. `C.zeta()` is a very fast, almost trivial operation because it's specialized for cyclotomic fields.

2. `C.primitive_root_of_unity()` uses a computation in PARI. This must be so, in order to be consistent with other uses of the PARI unit group.

So neither making `zeta` an alias of `primitive_root_of_unity` nor making `primitive_root_of_unity` an alias of `zeta` looks like a good idea.



---

archive/issue_comments_350392.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [fwclarke](#comment%3A5):\n> The new error message\n> \n> ```\n> sage: C.zeta(4)\n> ...\n> ValueError: 4 does not divide order of generator (10)\n> ```\n> is somewhat misleading\n\n\nIt's not a *new* error message, only a rephrasing of the old message. But I see your point.",
    "created_at": "2015-12-23T08:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350392",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [fwclarke](#comment%3A5):
> The new error message
> 
> ```
> sage: C.zeta(4)
> ...
> ValueError: 4 does not divide order of generator (10)
> ```
> is somewhat misleading


It's not a *new* error message, only a rephrasing of the old message. But I see your point.



---

archive/issue_comments_350393.json:
```json
{
    "body": "<a id='comment:9'></a>\nFeel free to open a new ticket to make the error messages consistent.",
    "created_at": "2015-12-23T08:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350393",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Feel free to open a new ticket to make the error messages consistent.



---

archive/issue_events_069336.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-23T11:06:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19742#event-69336"
}
```



---

archive/issue_comments_350394.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-23T11:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350394",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_350395.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/cyclotomicfield_zeta___inconsistent_with_zeta_order___and_docs\" to \"748110b4e08ff4b1a61ec13e792c6250d787085e\"",
    "created_at": "2015-12-23T11:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19742#issuecomment-350395",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/cyclotomicfield_zeta___inconsistent_with_zeta_order___and_docs" to "748110b4e08ff4b1a61ec13e792c6250d787085e"
