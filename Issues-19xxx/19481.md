# Issue 19481: No cardinality for virtual crystals

archive/issues_019244.json:
```json
{
    "body": "Cardinality does not work for virtual crystals:\n\n```\n        sage: from sage.combinat.crystals.virtual_crystal import VirtualCrystal\n        sage: A = crystals.Tableaux(['A',3], shape=[2,1,1])\n        sage: V = VirtualCrystal(A, {1:(1,3), 2:(2,)}, {1:1, 2:2}, cartan_type=['C',2])\n        sage: V.cardinality()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-9-36235162fdc4> in <module>()\n----> 1 V.cardinality()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/subcrystal.pyc in cardinality(self)\n    262             if self in FiniteCrystals():\n    263                 return Integer(len(self.list()))\n--> 264             card = super(Subcrystal, self).cardinality()\n    265             if card == infinity:\n    266                 self._cardinality = card\n\nAttributeError: 'super' object has no attribute 'cardinality'\n```\n\nCC:  @tscrim alubovsky @dwbump\n\nKeywords: crystals\n\nBranch/Commit: 8184b387caa77679b05608b4fb68eeed314d732f\n\nReviewer: Anne Schilling\n\nAuthor: Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19481\n\n",
    "closed_at": "2015-10-28T17:59:43Z",
    "created_at": "2015-10-26T22:22:02Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "No cardinality for virtual crystals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19481",
    "user": "https://github.com/anneschilling"
}
```
Cardinality does not work for virtual crystals:

```
        sage: from sage.combinat.crystals.virtual_crystal import VirtualCrystal
        sage: A = crystals.Tableaux(['A',3], shape=[2,1,1])
        sage: V = VirtualCrystal(A, {1:(1,3), 2:(2,)}, {1:1, 2:2}, cartan_type=['C',2])
        sage: V.cardinality()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-9-36235162fdc4> in <module>()
----> 1 V.cardinality()

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/subcrystal.pyc in cardinality(self)
    262             if self in FiniteCrystals():
    263                 return Integer(len(self.list()))
--> 264             card = super(Subcrystal, self).cardinality()
    265             if card == infinity:
    266                 self._cardinality = card

AttributeError: 'super' object has no attribute 'cardinality'
```

CC:  @tscrim alubovsky @dwbump

Keywords: crystals

Branch/Commit: 8184b387caa77679b05608b4fb68eeed314d732f

Reviewer: Anne Schilling

Author: Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19481





---

archive/issue_comments_263735.json:
```json
{
    "body": "<a id='comment:1'></a>Your first issue is that it should be\n\n```diff\n-G = crystals.LSPaths(La[1])\n+G = crystals.LSPaths(La[1]).digraph()\n```\nThe second is more of a problem, in that it doesn't know at present that it is a finite crystal. So it should error out, but with a different error of `NotImplementedError: unknown cardinality`. Part of it is that `Subcrystal` (and hence `VirtualCrystal`) should be smarter about its category. Another part is the desired interface (which, admittedly, is not the most discoverable), which sets the correct category, is:\n\n```\nsage: LaC = RootSystem(['C',2]).weight_space().fundamental_weights()\nsage: C = crystals.LSPaths(LaC[1])\nsage: A = crystals.Tableaux(['A',3], shape=[2,1,1])\nsage: phi = C.crystal_morphism(A.module_generators)\nsage: V = phi.image()\nsage: V\nVirtual crystal of The crystal of tableaux of type ['A', 3] and shape(s) [[2, 1, 1]] of type ['C', 2]\nsage: V.cardinality()\n4\nsage: V.category()\nCategory of classical crystals\n```\nYet another part is that this will have to raise an error message because `(Enumerated)Sets` does not want a default `cardinality` to avoid namespace pollution.\n\n---\n\nI also just ran across this problem today too:\n\n```\nsage: La = RootSystem(['A',3]).weight_space().fundamental_weights()\nsage: LaC = RootSystem(['C',2]).weight_space().fundamental_weights()\nsage: B = crystals.AlcovePaths(La[1]+La[3])\nsage: V = crystals.AlcovePaths(LaC[1])\nsage: phi = V.crystal_morphism(B.module_generators)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: (1, -1) is not in the coroot space\n```\nThis comes from the fact that the weights of the alcove path model do not lie in the weight lattice realization.\n\n---\n\nFixes will follow shortly.",
    "created_at": "2015-10-26T23:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19481#issuecomment-263735",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>Your first issue is that it should be

```diff
-G = crystals.LSPaths(La[1])
+G = crystals.LSPaths(La[1]).digraph()
```
The second is more of a problem, in that it doesn't know at present that it is a finite crystal. So it should error out, but with a different error of `NotImplementedError: unknown cardinality`. Part of it is that `Subcrystal` (and hence `VirtualCrystal`) should be smarter about its category. Another part is the desired interface (which, admittedly, is not the most discoverable), which sets the correct category, is:

```
sage: LaC = RootSystem(['C',2]).weight_space().fundamental_weights()
sage: C = crystals.LSPaths(LaC[1])
sage: A = crystals.Tableaux(['A',3], shape=[2,1,1])
sage: phi = C.crystal_morphism(A.module_generators)
sage: V = phi.image()
sage: V
Virtual crystal of The crystal of tableaux of type ['A', 3] and shape(s) [[2, 1, 1]] of type ['C', 2]
sage: V.cardinality()
4
sage: V.category()
Category of classical crystals
```
Yet another part is that this will have to raise an error message because `(Enumerated)Sets` does not want a default `cardinality` to avoid namespace pollution.

---

I also just ran across this problem today too:

```
sage: La = RootSystem(['A',3]).weight_space().fundamental_weights()
sage: LaC = RootSystem(['C',2]).weight_space().fundamental_weights()
sage: B = crystals.AlcovePaths(La[1]+La[3])
sage: V = crystals.AlcovePaths(LaC[1])
sage: phi = V.crystal_morphism(B.module_generators)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: (1, -1) is not in the coroot space
```
This comes from the fact that the weights of the alcove path model do not lie in the weight lattice realization.

---

Fixes will follow shortly.



---

archive/issue_comments_263736.json:
```json
{
    "body": "<a id='comment:2'></a>Or perhaps you want this interface:\n\n```\nsage: V = A.subcrystal(cartan_type=['C',2], virtualization={1:[1,3], 2:[2]}, scaling_factors={1:1,2:2})\nsage: V.cardinality()\n4\nsage: V.is_isomorphic(C)\nsage: V.digraph().is_isomorphic(C.digraph(), edge_labels=True)\nTrue\n```",
    "created_at": "2015-10-26T23:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19481#issuecomment-263736",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>Or perhaps you want this interface:

```
sage: V = A.subcrystal(cartan_type=['C',2], virtualization={1:[1,3], 2:[2]}, scaling_factors={1:1,2:2})
sage: V.cardinality()
4
sage: V.is_isomorphic(C)
sage: V.digraph().is_isomorphic(C.digraph(), edge_labels=True)
True
```



---

archive/issue_comments_263737.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2015-10-27T14:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19481#issuecomment-263737",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_263738.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-27T14:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19481#issuecomment-263738",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_263739.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-28T06:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19481#issuecomment-263739",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_263740.json:
```json
{
    "body": "<a id='comment:7'></a>Ok, these fixes look good to me.",
    "created_at": "2015-10-28T06:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19481#issuecomment-263740",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:7'></a>Ok, these fixes look good to me.



---

archive/issue_comments_263741.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-28T17:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19481#issuecomment-263741",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053742.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-28T17:59:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19481",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19481#event-53742"
}
```
