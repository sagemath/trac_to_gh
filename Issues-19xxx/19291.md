# Issue 19291: Graph.spanning_trees does not like loops

archive/issues_019054.json:
```json
{
    "body": "\n```\nG = Graph({0:{0:'a', 1:'b'}, 1:{2: 'c'}, 2:{0: 'e'}}, loops=True)\nS = G.spanning_trees()\n```\ngoes \"boom\" (recursion depth exceeded). It also destroys G in the process, which shouldn't happen, I think.\n\nBranch/Commit: 6a86e239c68f0d66cc182a98e74f72b34df4f961\n\nReviewer: Stefan van Zwam\n\nAuthor: Nathann Cohen\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19291\n\n",
    "closed_at": "2015-10-12T07:15:51Z",
    "created_at": "2015-09-25T04:45:06Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Graph.spanning_trees does not like loops",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19291",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

```
G = Graph({0:{0:'a', 1:'b'}, 1:{2: 'c'}, 2:{0: 'e'}}, loops=True)
S = G.spanning_trees()
```
goes "boom" (recursion depth exceeded). It also destroys G in the process, which shouldn't happen, I think.

Branch/Commit: 6a86e239c68f0d66cc182a98e74f72b34df4f961

Reviewer: Stefan van Zwam

Author: Nathann Cohen

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19291





---

archive/issue_comments_344876.json:
```json
{
    "body": "Changing branch from \"\" to \"u/ncohen/19291\"",
    "created_at": "2015-09-25T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344876",
    "user": "https://github.com/nathanncohen"
}
```

Changing branch from "" to "u/ncohen/19291"



---

archive/issue_comments_344877.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-25T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344877",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_344878.json:
```json
{
    "body": "<a id='comment:1'></a>\nHere is a fix. By the way, if you need this function for some hard computations know that there is room for much improvement in there.\n\nNathann\n\n---\nNew commits:\n|                                                                                                                                          |                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[6a86e23](http://git.sagemath.org/sage.git/commit/?id=6a86e239c68f0d66cc182a98e74f72b34df4f961)|`trac #19291: Graph.spanning_trees does not like loops`|",
    "created_at": "2015-09-25T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344878",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>
Here is a fix. By the way, if you need this function for some hard computations know that there is room for much improvement in there.

Nathann

---
New commits:
|                                                                                                                                          |                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[6a86e23](http://git.sagemath.org/sage.git/commit/?id=6a86e239c68f0d66cc182a98e74f72b34df4f961)|`trac #19291: Graph.spanning_trees does not like loops`|



---

archive/issue_comments_344879.json:
```json
{
    "body": "Changing commit from \"\" to \"6a86e239c68f0d66cc182a98e74f72b34df4f961\"",
    "created_at": "2015-09-25T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344879",
    "user": "https://github.com/nathanncohen"
}
```

Changing commit from "" to "6a86e239c68f0d66cc182a98e74f72b34df4f961"



---

archive/issue_comments_344880.json:
```json
{
    "body": "Changing author from \"\" to \"Nathann Cohen\"",
    "created_at": "2015-09-25T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344880",
    "user": "https://github.com/nathanncohen"
}
```

Changing author from "" to "Nathann Cohen"



---

archive/issue_comments_344881.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Stefan van Zwam\"",
    "created_at": "2015-09-25T16:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344881",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Changing reviewer from "" to "Stefan van Zwam"



---

archive/issue_comments_344882.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-25T16:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344882",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_344883.json:
```json
{
    "body": "<a id='comment:2'></a>\nI was just exploring some graph methods, I don't actually need to use it for now.\n\nYour change forces a copy of the graph to be made regardless of whether there are loops. That's definitely safer than what happened before, but could be costly in terms of memory for big graphs. Still, I prefer the corresponding increase in safety of the code, so I will approve.",
    "created_at": "2015-09-25T16:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344883",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:2'></a>
I was just exploring some graph methods, I don't actually need to use it for now.

Your change forces a copy of the graph to be made regardless of whether there are loops. That's definitely safer than what happened before, but could be costly in terms of memory for big graphs. Still, I prefer the corresponding increase in safety of the code, so I will approve.



---

archive/issue_comments_344884.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [Stefan](#comment%3A2):\n>  but could be costly in terms of memory for big graphs.\n\n\nWell, considering such running time, it is likely that no one will use this method for \"big graphs\".\n\n```\nsage: g = graphs.GridGraph([2,2,2])\nsage: %timeit g.spanning_trees()\n10 loops, best of 3: 99.4 ms per loop\nsage: g = graphs.GridGraph([2,2,3])\nsage: %timeit g.spanning_trees()\n1 loops, best of 3: 13.4 s per loop\nsage: g.order(),g.size()\n(12, 20)\n```",
    "created_at": "2015-09-26T09:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344884",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>
Replying to [Stefan](#comment%3A2):
>  but could be costly in terms of memory for big graphs.


Well, considering such running time, it is likely that no one will use this method for "big graphs".

```
sage: g = graphs.GridGraph([2,2,2])
sage: %timeit g.spanning_trees()
10 loops, best of 3: 99.4 ms per loop
sage: g = graphs.GridGraph([2,2,3])
sage: %timeit g.spanning_trees()
1 loops, best of 3: 13.4 s per loop
sage: g.order(),g.size()
(12, 20)
```



---

archive/issue_comments_344885.json:
```json
{
    "body": "<a id='comment:4'></a>\nYeah, precisely. Stefan: to answer your question, I did not mind adding a graph copy to this method because, well, given the way it is written, the amount of wasted time is so high that this copy makes no difference. If you ever need this method \"seriously\", it will have to be reimplemented.\n\nNathann",
    "created_at": "2015-09-26T11:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344885",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>
Yeah, precisely. Stefan: to answer your question, I did not mind adding a graph copy to this method because, well, given the way it is written, the amount of wasted time is so high that this copy makes no difference. If you ever need this method "seriously", it will have to be reimplemented.

Nathann



---

archive/issue_comments_344886.json:
```json
{
    "body": "Changing branch from \"u/ncohen/19291\" to \"6a86e239c68f0d66cc182a98e74f72b34df4f961\"",
    "created_at": "2015-10-12T07:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344886",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/ncohen/19291" to "6a86e239c68f0d66cc182a98e74f72b34df4f961"



---

archive/issue_events_053437.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-12T07:15:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19291#event-53437"
}
```



---

archive/issue_comments_344887.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T07:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19291#issuecomment-344887",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
