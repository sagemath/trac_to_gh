# Issue 19607: Return properly formatted GAP output when using a temporary file

archive/issues_019370.json:
```json
{
    "body": "As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `\"\"`, but not when they are `Print`ed, as would happen when fetched using a file.\n\nThis patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.\n\nHowever, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.\n\nThe branch includes commits from #19585, since it builds upon the changes made there.\n\nCC:  @tscrim\n\nKeywords: GAP interface temporary file\n\nAuthor: Jano\u0161 Vidali\n\nBranch: u/jaanos/return_properly_formatted_gap_output_when_using_a_temporary_file\n\nStatus: needs_work\n\nCommit: 0bfbd684405cf02f9b87581dcabfa10137d3f8b0\n\nIssue created by migration from https://trac.sagemath.org/ticket/19607\n\n",
    "created_at": "2015-11-21T00:33:22Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Return properly formatted GAP output when using a temporary file",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19607",
    "user": "https://github.com/jaanos"
}
```
As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `""`, but not when they are `Print`ed, as would happen when fetched using a file.

This patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.

However, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.

The branch includes commits from #19585, since it builds upon the changes made there.

CC:  @tscrim

Keywords: GAP interface temporary file

Author: Jano≈° Vidali

Branch: u/jaanos/return_properly_formatted_gap_output_when_using_a_temporary_file

Status: needs_work

Commit: 0bfbd684405cf02f9b87581dcabfa10137d3f8b0

Issue created by migration from https://trac.sagemath.org/ticket/19607





---

archive/issue_comments_283040.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-21T01:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283040",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_283041.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283041",
    "user": "https://github.com/jaanos"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_283042.json:
```json
{
    "body": "Changing keywords from \"\" to \"GAP interface temporary file\".",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283042",
    "user": "https://github.com/jaanos"
}
```

Changing keywords from "" to "GAP interface temporary file".



---

archive/issue_comments_283043.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `\"\"`, but not when they are `Print`ed, as would happen when fetched using a file.\n \n+This patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.\n+\n+However, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.\n+\n+The branch includes commits from #19585, since it builds upon the changes made there.\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283043",
    "user": "https://github.com/jaanos"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `""`, but not when they are `Print`ed, as would happen when fetched using a file.
 
+This patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.
+
+However, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.
+
+The branch includes commits from #19585, since it builds upon the changes made there.
 
 Comment: 1
 
``````




---

archive/issue_comments_283044.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283044",
    "user": "https://github.com/jaanos"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_283045.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to interfaces.",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283045",
    "user": "https://github.com/jaanos"
}
```

Changing component from PLEASE CHANGE to interfaces.



---

archive/issue_comments_283046.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-21T01:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_283047.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-26T12:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283047",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_283048.json:
```json
{
    "body": "<a id='comment:6'></a>Needs to be rebased on sage8.1beta3",
    "created_at": "2017-08-30T18:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283048",
    "user": "https://github.com/koffie"
}
```

<a id='comment:6'></a>Needs to be rebased on sage8.1beta3



---

archive/issue_comments_283049.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-30T18:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-283049",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_review to needs_work.
