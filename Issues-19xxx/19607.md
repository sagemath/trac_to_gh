# Issue 19607: Return properly formatted GAP output when using a temporary file

archive/issues_019370.json:
```json
{
    "body": "As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `\"\"`, but not when they are `Print`ed, as would happen when fetched using a file.\n\nThis patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.\n\nHowever, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.\n\nThe branch includes commits from #19585, since it builds upon the changes made there.\n\nCC:  @tscrim\n\nKeywords: GAP interface temporary file\n\nAuthor: Jano\u0161 Vidali\n\nBranch: u/jaanos/return_properly_formatted_gap_output_when_using_a_temporary_file\n\nStatus: needs_work\n\nCommit: 0bfbd684405cf02f9b87581dcabfa10137d3f8b0\n\nIssue created by migration from https://trac.sagemath.org/ticket/19607\n\n",
    "created_at": "2015-11-21T00:33:22Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Return properly formatted GAP output when using a temporary file",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19607",
    "user": "https://github.com/jaanos"
}
```
As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `""`, but not when they are `Print`ed, as would happen when fetched using a file.

This patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.

However, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.

The branch includes commits from #19585, since it builds upon the changes made there.

CC:  @tscrim

Keywords: GAP interface temporary file

Author: Janoš Vidali

Branch: u/jaanos/return_properly_formatted_gap_output_when_using_a_temporary_file

Status: needs_work

Commit: 0bfbd684405cf02f9b87581dcabfa10137d3f8b0

Issue created by migration from https://trac.sagemath.org/ticket/19607





---

archive/issue_comments_355564.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jaanos/return_properly_formatted_gap_output_when_using_a_temporary_file\"",
    "created_at": "2015-11-21T00:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355564",
    "user": "https://github.com/jaanos"
}
```

Changing branch from "" to "u/jaanos/return_properly_formatted_gap_output_when_using_a_temporary_file"



---

archive/issue_comments_355565.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[07a3d6c](https://github.com/sagemath/sagetrac-mirror/commit/07a3d6c4dd1676146f08766d77f3c95691ac81a4)|`Weirdly, code blocks will be executed by GAP when parenthesised`|",
    "created_at": "2015-11-21T01:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355565",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[07a3d6c](https://github.com/sagemath/sagetrac-mirror/commit/07a3d6c4dd1676146f08766d77f3c95691ac81a4)|`Weirdly, code blocks will be executed by GAP when parenthesised`|



---

archive/issue_comments_355566.json:
```json
{
    "body": "Changing commit from \"\" to \"07a3d6c4dd1676146f08766d77f3c95691ac81a4\"",
    "created_at": "2015-11-21T01:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355566",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "07a3d6c4dd1676146f08766d77f3c95691ac81a4"



---

archive/issue_comments_355567.json:
```json
{
    "body": "Changing keywords from \"\" to \"GAP interface temporary file\".",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355567",
    "user": "https://github.com/jaanos"
}
```

Changing keywords from "" to "GAP interface temporary file".



---

archive/issue_comments_355568.json:
```json
{
    "body": "Changing author from \"\" to \"Jano\u0161 Vidali\"",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355568",
    "user": "https://github.com/jaanos"
}
```

Changing author from "" to "Janoš Vidali"



---

archive/issue_comments_355569.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n+As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `\"\"`, but not when they are `Print`ed, as would happen when fetched using a file.\n \n+This patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.\n+\n+However, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.\n+\n+The branch includes commits from #19585, since it builds upon the changes made there.\n``````\n",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355569",
    "user": "https://github.com/jaanos"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,7 @@
+As observed in #19585, evaluating GAP commands using a temporary file can cause problems as the output is handled differently - for example, strings printed from the console are wrapped in `""`, but not when they are `Print`ed, as would happen when fetched using a file.
 
+This patch aims to fix the difference by assigning the results of a command to an auxiliary value when applicable, and then print the contents of the variable from the console. This replaces the call to `Print`, which gave possibly malformed results. It still causes an error when calling a function that does not return a variable, but since the side effects still apply, the behaviour doesn't change in these cases.
+
+However, now we attempt to detect whether `Print` or `Display` is being called. In this case, the command is passed on unchanged, as trying to assign would cause us to lose the output due to the error. Of course, this does in no way cover all cases when such an output may be lost.
+
+The branch includes commits from #19585, since it builds upon the changes made there.
``````




---

archive/issue_comments_355570.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-21T01:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355570",
    "user": "https://github.com/jaanos"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_355571.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|\n|[dca7939](https://github.com/sagemath/sagetrac-mirror/commit/dca793967db2e6bde379bdb8b8d348c8283305a1)|`Remove superfluous changes to Gap.get since the issues are now handled elsewhere`|",
    "created_at": "2015-11-21T01:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355571",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
|[dca7939](https://github.com/sagemath/sagetrac-mirror/commit/dca793967db2e6bde379bdb8b8d348c8283305a1)|`Remove superfluous changes to Gap.get since the issues are now handled elsewhere`|



---

archive/issue_comments_355572.json:
```json
{
    "body": "Changing commit from \"07a3d6c4dd1676146f08766d77f3c95691ac81a4\" to \"dca793967db2e6bde379bdb8b8d348c8283305a1\"",
    "created_at": "2015-11-21T01:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355572",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "07a3d6c4dd1676146f08766d77f3c95691ac81a4" to "dca793967db2e6bde379bdb8b8d348c8283305a1"



---

archive/issue_comments_355573.json:
```json
{
    "body": "Changing commit from \"dca793967db2e6bde379bdb8b8d348c8283305a1\" to \"0bfbd684405cf02f9b87581dcabfa10137d3f8b0\"",
    "created_at": "2015-11-26T12:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355573",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dca793967db2e6bde379bdb8b8d348c8283305a1" to "0bfbd684405cf02f9b87581dcabfa10137d3f8b0"



---

archive/issue_comments_355574.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|\n|[5fba891](https://github.com/sagemath/sagetrac-mirror/commit/5fba891a391e2b345842bf07e1be5b8d91283fef)|`Fix the doctests so that long variable names are only used in a separate GAP session`|\n|[0bfbd68](https://github.com/sagemath/sagetrac-mirror/commit/0bfbd684405cf02f9b87581dcabfa10137d3f8b0)|`Merge branch 'gap_function_efficiency' into gap_temp_file`|",
    "created_at": "2015-11-26T12:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355574",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
|[5fba891](https://github.com/sagemath/sagetrac-mirror/commit/5fba891a391e2b345842bf07e1be5b8d91283fef)|`Fix the doctests so that long variable names are only used in a separate GAP session`|
|[0bfbd68](https://github.com/sagemath/sagetrac-mirror/commit/0bfbd684405cf02f9b87581dcabfa10137d3f8b0)|`Merge branch 'gap_function_efficiency' into gap_temp_file`|



---

archive/issue_comments_355575.json:
```json
{
    "body": "<a id='comment:6'></a>\nNeeds to be rebased on sage8.1beta3",
    "created_at": "2017-08-30T18:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355575",
    "user": "https://github.com/koffie"
}
```

<a id='comment:6'></a>
Needs to be rebased on sage8.1beta3



---

archive/issue_comments_355576.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-30T18:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19607#issuecomment-355576",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_review to needs_work.
