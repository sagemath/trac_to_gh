# Issue 19945: Fix Rational.__pow__

archive/issues_019708.json:
```json
{
    "assignees": [],
    "body": "The following is unexpected:\n\n```\nsage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-18-784db7f7676d> in <module>()\n----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n\n\n/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()\n   2549 \n   2550             if isinstance(n, Element):\n-> 2551                 return (<Element>n)._parent(self)**n\n   2552             try:\n   2553                 return n.parent()(self)**n\n\n/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n    916         if mor is not None:\n    917             if no_extra_args:\n--> 918                 return mor._call_(x)\n    919             else:\n    920                 return mor._call_with_args(x, args, kwds)\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n    153                 print(type(C), C)\n    154                 print(type(C._element_constructor), C._element_constructor)\n--> 155             raise\n    156 \n    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n    148         cdef Parent C = self._codomain\n    149         try:\n--> 150             return C._element_constructor(x)\n    151         except Exception:\n    152             if print_warnings:\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)\n   3891             return result\n   3892 \n-> 3893         return self.create_summand('exact', data)\n   3894 \n   3895 \n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)\n   4335 \n   4336         try:\n-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)\n   4338         except ZeroCoefficientError:\n   4339             return self.zero()\n\n/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n    916         if mor is not None:\n    917             if no_extra_args:\n--> 918                 return mor._call_(x)\n    919             else:\n    920                 return mor._call_with_args(x, args, kwds)\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n    153                 print(type(C), C)\n    154                 print(type(C._element_constructor), C._element_constructor)\n--> 155             raise\n    156 \n    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n    148         cdef Parent C = self._codomain\n    149         try:\n--> 150             return C._element_constructor(x)\n    151         except Exception:\n    152             if print_warnings:\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)\n   1670         except ValueError as e:\n   1671             raise combine_exceptions(\n-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)\n   1673 \n   1674         return self._create_element_(growth, coefficient)\n\nValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.\n> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).\n```\n\nCC:  @dkrenn @behackl\n\nComponent: **basic arithmetic**\n\nAuthor: **Jeroen Demeyer**\n\nBranch/Commit: **[`5706029`](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)**\n\nReviewer: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19945_\n\n",
    "closed_at": "2018-12-01T13:43:40Z",
    "created_at": "2016-01-23T05:08:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix Rational.__pow__",
    "type": "issue",
    "updated_at": "2018-12-01T13:43:40Z",
    "url": "https://github.com/sagemath/sage/issues/19945",
    "user": "https://github.com/cheuberg"
}
```
The following is unexpected:

```
sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-18-784db7f7676d> in <module>()
----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n

/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()
   2549 
   2550             if isinstance(n, Element):
-> 2551                 return (<Element>n)._parent(self)**n
   2552             try:
   2553                 return n.parent()(self)**n

/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
    916         if mor is not None:
    917             if no_extra_args:
--> 918                 return mor._call_(x)
    919             else:
    920                 return mor._call_with_args(x, args, kwds)

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
    153                 print(type(C), C)
    154                 print(type(C._element_constructor), C._element_constructor)
--> 155             raise
    156 
    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
    148         cdef Parent C = self._codomain
    149         try:
--> 150             return C._element_constructor(x)
    151         except Exception:
    152             if print_warnings:

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)
   3891             return result
   3892 
-> 3893         return self.create_summand('exact', data)
   3894 
   3895 

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)
   4335 
   4336         try:
-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)
   4338         except ZeroCoefficientError:
   4339             return self.zero()

/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
    916         if mor is not None:
    917             if no_extra_args:
--> 918                 return mor._call_(x)
    919             else:
    920                 return mor._call_with_args(x, args, kwds)

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
    153                 print(type(C), C)
    154                 print(type(C._element_constructor), C._element_constructor)
--> 155             raise
    156 
    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
    148         cdef Parent C = self._codomain
    149         try:
--> 150             return C._element_constructor(x)
    151         except Exception:
    152             if print_warnings:

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)
   1670         except ValueError as e:
   1671             raise combine_exceptions(
-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)
   1673 
   1674         return self._create_element_(growth, coefficient)

ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.
> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).
```

CC:  @dkrenn @behackl

Component: **basic arithmetic**

Author: **Jeroen Demeyer**

Branch/Commit: **[`5706029`](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)**

Reviewer: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/19945_





---

archive/issue_events_279412.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2016-01-23T05:08:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279412"
}
```



---

archive/issue_events_279413.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2016-01-23T05:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20asymptotic%20expansions",
    "label_color": "0000ff",
    "label_name": "c: asymptotic expansions",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279413"
}
```



---

archive/issue_events_279414.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2016-01-23T05:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279414"
}
```



---

archive/issue_events_279415.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2016-01-23T05:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279415"
}
```



---

archive/issue_comments_285527.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\n\n```\nsage: A.<n> = AsymptoticRing('QQ^n*n^QQ', QQ)\nsage: (1/2)^n\n(1/2)^n\n```\ndoes work.",
    "created_at": "2016-01-23T06:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285527",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:1" align="right">comment:1</div>


```
sage: A.<n> = AsymptoticRing('QQ^n*n^QQ', QQ)
sage: (1/2)^n
(1/2)^n
```
does work.



---

archive/issue_comments_285528.json:
```json
{
    "body": "Replying to [ticket:19945 cheuberg]:\n> \n> ```\n> sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)\n> sage: (1/2)^n\n> ```\n\nThe problem is that `(1/2)^n` calls `__pow__` of the rational `1/2`. This tries `A(1/2)^n`, which fails since `1/2` is not in `A`. This also explains why it works with coefficient ring `QQ` as in [comment:1](#comment%3A1).\n\nAs a workaround you can use\n\n```\nsage: n.rpow(1/2)\n```",
    "created_at": "2016-01-25T18:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285528",
    "user": "https://github.com/dkrenn"
}
```

Replying to [ticket:19945 cheuberg]:
> 
> ```
> sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)
> sage: (1/2)^n
> ```

The problem is that `(1/2)^n` calls `__pow__` of the rational `1/2`. This tries `A(1/2)^n`, which fails since `1/2` is not in `A`. This also explains why it works with coefficient ring `QQ` as in [comment:1](#comment%3A1).

As a workaround you can use

```
sage: n.rpow(1/2)
```



---

archive/issue_comments_285529.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nDocumented at #19961.",
    "created_at": "2016-01-26T08:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285529",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:3" align="right">comment:3</div>

Documented at #19961.



---

archive/issue_comments_285530.json:
```json
{
    "body": "Dependencies: **#24247**",
    "created_at": "2018-01-08T09:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285530",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#24247**



---

archive/issue_events_279416.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-08T09:08:00Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "title_is": "Fix Rational.__pow__",
    "title_was": "Asymptotic Ring: cannot construct (1/2)^n",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279416"
}
```



---

archive/issue_events_279417.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-08T09:08:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20asymptotic%20expansions",
    "label_color": "0000ff",
    "label_name": "c: asymptotic expansions",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279417"
}
```



---

archive/issue_events_279418.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-08T09:08:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279418"
}
```



---

archive/issue_comments_285531.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,82 @@\n The following is unexpected:\n \n ```\n-sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)\n-sage: (1/2)^n\n-Traceback (most recent call last):\n-...\n-ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ\n-with coefficients in Integer Ring.\n-> *previous* ValueError: Factor 1/2 of 1/2 is neither\n-a coefficient (in Integer Ring) nor growth\n-(in Growth Group QQ^n * n^QQ).\n-sage: 1/2^n\n-(1/2)^n\n+sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n\n+---------------------------------------------------------------------------\n+ValueError                                Traceback (most recent call last)\n+<ipython-input-18-784db7f7676d> in <module>()\n+----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n\n+\n+/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()\n+   2549 \n+   2550             if isinstance(n, Element):\n+-> 2551                 return (<Element>n)._parent(self)**n\n+   2552             try:\n+   2553                 return n.parent()(self)**n\n+\n+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n+    916         if mor is not None:\n+    917             if no_extra_args:\n+--> 918                 return mor._call_(x)\n+    919             else:\n+    920                 return mor._call_with_args(x, args, kwds)\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n+    153                 print(type(C), C)\n+    154                 print(type(C._element_constructor), C._element_constructor)\n+--> 155             raise\n+    156 \n+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n+    148         cdef Parent C = self._codomain\n+    149         try:\n+--> 150             return C._element_constructor(x)\n+    151         except Exception:\n+    152             if print_warnings:\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)\n+   3891             return result\n+   3892 \n+-> 3893         return self.create_summand('exact', data)\n+   3894 \n+   3895 \n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)\n+   4335 \n+   4336         try:\n+-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)\n+   4338         except ZeroCoefficientError:\n+   4339             return self.zero()\n+\n+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n+    916         if mor is not None:\n+    917             if no_extra_args:\n+--> 918                 return mor._call_(x)\n+    919             else:\n+    920                 return mor._call_with_args(x, args, kwds)\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n+    153                 print(type(C), C)\n+    154                 print(type(C._element_constructor), C._element_constructor)\n+--> 155             raise\n+    156 \n+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n+    148         cdef Parent C = self._codomain\n+    149         try:\n+--> 150             return C._element_constructor(x)\n+    151         except Exception:\n+    152             if print_warnings:\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)\n+   1670         except ValueError as e:\n+   1671             raise combine_exceptions(\n+-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)\n+   1673 \n+   1674         return self._create_element_(growth, coefficient)\n+\n+ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.\n+> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).\n ```\n``````\n",
    "created_at": "2018-01-08T09:08:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285531",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,82 @@
 The following is unexpected:
 
 ```
-sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)
-sage: (1/2)^n
-Traceback (most recent call last):
-...
-ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ
-with coefficients in Integer Ring.
-> *previous* ValueError: Factor 1/2 of 1/2 is neither
-a coefficient (in Integer Ring) nor growth
-(in Growth Group QQ^n * n^QQ).
-sage: 1/2^n
-(1/2)^n
+sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n
+---------------------------------------------------------------------------
+ValueError                                Traceback (most recent call last)
+<ipython-input-18-784db7f7676d> in <module>()
+----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n
+
+/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()
+   2549 
+   2550             if isinstance(n, Element):
+-> 2551                 return (<Element>n)._parent(self)**n
+   2552             try:
+   2553                 return n.parent()(self)**n
+
+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
+    916         if mor is not None:
+    917             if no_extra_args:
+--> 918                 return mor._call_(x)
+    919             else:
+    920                 return mor._call_with_args(x, args, kwds)
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
+    153                 print(type(C), C)
+    154                 print(type(C._element_constructor), C._element_constructor)
+--> 155             raise
+    156 
+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
+    148         cdef Parent C = self._codomain
+    149         try:
+--> 150             return C._element_constructor(x)
+    151         except Exception:
+    152             if print_warnings:
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)
+   3891             return result
+   3892 
+-> 3893         return self.create_summand('exact', data)
+   3894 
+   3895 
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)
+   4335 
+   4336         try:
+-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)
+   4338         except ZeroCoefficientError:
+   4339             return self.zero()
+
+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
+    916         if mor is not None:
+    917             if no_extra_args:
+--> 918                 return mor._call_(x)
+    919             else:
+    920                 return mor._call_with_args(x, args, kwds)
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
+    153                 print(type(C), C)
+    154                 print(type(C._element_constructor), C._element_constructor)
+--> 155             raise
+    156 
+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
+    148         cdef Parent C = self._codomain
+    149         try:
+--> 150             return C._element_constructor(x)
+    151         except Exception:
+    152             if print_warnings:
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)
+   1670         except ValueError as e:
+   1671             raise combine_exceptions(
+-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)
+   1673 
+   1674         return self._create_element_(growth, coefficient)
+
+ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.
+> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).
 ```
``````




---

archive/issue_comments_285532.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)**",
    "created_at": "2018-01-08T10:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285532",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)**



---

archive/issue_comments_285533.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae\"><code>1c9bb4f</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-08T10:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285533",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae"><code>1c9bb4f</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_285534.json:
```json
{
    "body": "Commit: **[`1c9bb4f`](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)**",
    "created_at": "2018-01-08T10:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285534",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`1c9bb4f`](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)**



---

archive/issue_comments_285535.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2018-01-08T10:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285535",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_events_279419.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-08T10:21:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279419"
}
```



---

archive/issue_comments_285536.json:
```json
{
    "body": "Changed commit from **[`1c9bb4f`](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)** to **[`05b066d`](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)**",
    "created_at": "2018-01-08T10:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285536",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1c9bb4f`](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)** to **[`05b066d`](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)**



---

archive/issue_comments_285537.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e\"><code>05b066d</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-08T10:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285537",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e"><code>05b066d</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_285538.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9\"><code>84c056b</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-08T10:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285538",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9"><code>84c056b</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_285539.json:
```json
{
    "body": "Changed commit from **[`05b066d`](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)** to **[`84c056b`](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)**",
    "created_at": "2018-01-08T10:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285539",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`05b066d`](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)** to **[`84c056b`](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)**



---

archive/issue_events_279420.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-02-21T12:42:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279420"
}
```



---

archive/issue_events_279421.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-02-21T12:42:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279421"
}
```



---

archive/issue_comments_285540.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n\n```\nsage -t --long --warn-long 63.9 src/sage/rings/rational.pyx\n**********************************************************************\nFile \"src/sage/rings/rational.pyx\", line 302, in sage.rings.rational.rational_power_parts\nFailed example:\n    (-1)^(-1/3)\nExpected:\n    -(-1)^(2/3)\nGot:\n    -1.0*(-1)^(2/3)\n**********************************************************************\n```",
    "created_at": "2018-02-21T12:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285540",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:11" align="right">comment:11</div>


```
sage -t --long --warn-long 63.9 src/sage/rings/rational.pyx
**********************************************************************
File "src/sage/rings/rational.pyx", line 302, in sage.rings.rational.rational_power_parts
Failed example:
    (-1)^(-1/3)
Expected:
    -(-1)^(2/3)
Got:
    -1.0*(-1)^(2/3)
**********************************************************************
```



---

archive/issue_comments_285541.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSeriously? How did that happen?",
    "created_at": "2018-02-21T12:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285541",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Seriously? How did that happen?



---

archive/issue_comments_285542.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jdemeyer](#comment%3A12):\n> Seriously? How did that happen?\n\nNo idea. I just thought I would review this ticket, merged your branch in the current `develop`, and ran the test suite.",
    "created_at": "2018-02-21T13:34:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285542",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jdemeyer](#comment%3A12):
> Seriously? How did that happen?

No idea. I just thought I would review this ticket, merged your branch in the current `develop`, and ran the test suite.



---

archive/issue_comments_285543.json:
```json
{
    "body": "Changed dependencies from **#24247** to none",
    "created_at": "2018-11-26T11:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285543",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24247** to none



---

archive/issue_comments_285544.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936\"><code>b74fb20</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-11-26T12:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285544",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936"><code>b74fb20</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_285545.json:
```json
{
    "body": "Changed commit from **[`84c056b`](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)** to **[`b74fb20`](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)**",
    "created_at": "2018-11-26T12:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285545",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`84c056b`](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)** to **[`b74fb20`](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)**



---

archive/issue_comments_285546.json:
```json
{
    "body": "Changed commit from **[`b74fb20`](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)** to **[`b862b7e`](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)**",
    "created_at": "2018-11-26T12:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285546",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b74fb20`](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)** to **[`b862b7e`](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)**



---

archive/issue_comments_285547.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7\"><code>b862b7e</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-11-26T12:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285547",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7"><code>b862b7e</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_events_279422.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-26T12:26:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279422"
}
```



---

archive/issue_events_279423.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-26T12:26:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279423"
}
```



---

archive/issue_comments_285548.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nRebased to 8.5.beta5.",
    "created_at": "2018-11-26T12:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285548",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Rebased to 8.5.beta5.



---

archive/issue_events_279424.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-26T12:26:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279424"
}
```



---

archive/issue_events_279425.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-26T12:26:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279425"
}
```



---

archive/issue_comments_285549.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIn general, this LGTM. Have you run any timings to see if there is any change for **Q**<sup>**Z**</sup>, **Q**<sup>**Q**</sup>, and **Z**<sup>**Q**</sup>? Since these are common operations and they now go through the coercion framework (if I understand everything correctly), I want to make sure they are not (significantly) affected.",
    "created_at": "2018-11-27T03:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285549",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

In general, this LGTM. Have you run any timings to see if there is any change for **Q**<sup>**Z**</sup>, **Q**<sup>**Q**</sup>, and **Z**<sup>**Q**</sup>? Since these are common operations and they now go through the coercion framework (if I understand everything correctly), I want to make sure they are not (significantly) affected.



---

archive/issue_comments_285550.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-11-27T03:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285550",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_285551.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI did some timings with mixed results:\n\n1. `QQ^ZZ` became slower by a factor 1.4 (404ns to 575ns). This is because of the overhead of `IntegerPowAction` and it's really hard to avoid this slow-down. It's also a large relative slow-down because the actual powering is very fast.\n\n2. The old code optimized the case of powering to a rational integer (an element of `QQ` with denominator 1). The new code doesn't, leading to a slow-down for `QQ^QQ` with integral exponent.\n\n3. `QQ^QQ` is faster if the exponent is not a rational integer.\n\n4. `ZZ^QQ` simply delegates to `QQ^QQ` (this code is not changed), so speed gains/losses are similar to the `QQ^QQ` case.\n\nI'm not entirely sure whether I should implement a special case for powering to a rational integer. Is this case common enough to warrant the extra code?\n\nI also noticed that #24500 gives an additional slight slow-down for `QQ^ZZ` (about 5%). This is because powering is always a right action, so the problem that #24500 fixes does not occur for `IntegerPowAction`.",
    "created_at": "2018-11-27T11:10:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285551",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I did some timings with mixed results:

1. `QQ^ZZ` became slower by a factor 1.4 (404ns to 575ns). This is because of the overhead of `IntegerPowAction` and it's really hard to avoid this slow-down. It's also a large relative slow-down because the actual powering is very fast.

2. The old code optimized the case of powering to a rational integer (an element of `QQ` with denominator 1). The new code doesn't, leading to a slow-down for `QQ^QQ` with integral exponent.

3. `QQ^QQ` is faster if the exponent is not a rational integer.

4. `ZZ^QQ` simply delegates to `QQ^QQ` (this code is not changed), so speed gains/losses are similar to the `QQ^QQ` case.

I'm not entirely sure whether I should implement a special case for powering to a rational integer. Is this case common enough to warrant the extra code?

I also noticed that #24500 gives an additional slight slow-down for `QQ^ZZ` (about 5%). This is because powering is always a right action, so the problem that #24500 fixes does not occur for `IntegerPowAction`.



---

archive/issue_comments_285552.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n#26775 should solve most of the slow-down for `QQ^ZZ`.",
    "created_at": "2018-11-27T11:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285552",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

#26775 should solve most of the slow-down for `QQ^ZZ`.



---

archive/issue_comments_285553.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNever mind, my analysis at #26775 was wrong.\n\nStill, there is something strange with benchmarks: without changing any code, the old code slowed down from 404ns to 446ns and the new code (on top of #24500) sped up from about 600ns to 515ns. So without really changing anything (but recompiling the new code), I now have a slow-down of a factor only 1.15 for `QQ^ZZ`. Benchmarks are a strange thing...",
    "created_at": "2018-11-27T11:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285553",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Never mind, my analysis at #26775 was wrong.

Still, there is something strange with benchmarks: without changing any code, the old code slowed down from 404ns to 446ns and the new code (on top of #24500) sped up from about 600ns to 515ns. So without really changing anything (but recompiling the new code), I now have a slow-down of a factor only 1.15 for `QQ^ZZ`. Benchmarks are a strange thing...



---

archive/issue_comments_285554.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe wildly differing timings must be something like a memory layout/cache issue.\n\nAnyway, for `QQ^ZZ`, I give the best timings for\n\n```\nsage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)\n```\n\nVanilla 8.5.beta5:\n\n```\n100000 loops, best of 20: 397 ns per loop\n```\n\nWith #19945:\n\n```\n100000 loops, best of 20: 512 ns per loop\n```\n\nWith #24500 and #19945:\n\n```\n100000 loops, best of 20: 509 ns per loop\n```",
    "created_at": "2018-11-27T11:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285554",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

The wildly differing timings must be something like a memory layout/cache issue.

Anyway, for `QQ^ZZ`, I give the best timings for

```
sage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)
```

Vanilla 8.5.beta5:

```
100000 loops, best of 20: 397 ns per loop
```

With #19945:

```
100000 loops, best of 20: 512 ns per loop
```

With #24500 and #19945:

```
100000 loops, best of 20: 509 ns per loop
```



---

archive/issue_comments_285555.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nMost of the slowdown in this ticket is due to\n\n```\nsage: g = coercion_model.get_action; args = (QQ, ZZ, operator.pow)\nsage: timeit('g(*args)', repeat=20, number=100000)\n100000 loops, best of 20: 133 ns per loop\n```",
    "created_at": "2018-11-27T11:55:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285555",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Most of the slowdown in this ticket is due to

```
sage: g = coercion_model.get_action; args = (QQ, ZZ, operator.pow)
sage: timeit('g(*args)', repeat=20, number=100000)
100000 loops, best of 20: 133 ns per loop
```



---

archive/issue_comments_285556.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThat is what I expected. I was wondering if we wanted to special case such things to avoid going through the coercion framework. I also think it is worthwhile to special case rational powers that are integers.",
    "created_at": "2018-11-27T12:11:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285556",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

That is what I expected. I was wondering if we wanted to special case such things to avoid going through the coercion framework. I also think it is worthwhile to special case rational powers that are integers.



---

archive/issue_comments_285557.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n#26776 should gain about 20ns.",
    "created_at": "2018-11-27T12:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285557",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

#26776 should gain about 20ns.



---

archive/issue_comments_285558.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@tscrim](#comment%3A24):\n> I was wondering if we wanted to special case such things to avoid going through the coercion framework.\n\nMore useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.",
    "created_at": "2018-11-28T15:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285558",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@tscrim](#comment%3A24):
> I was wondering if we wanted to special case such things to avoid going through the coercion framework.

More useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.



---

archive/issue_comments_285559.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nWith #26776 + #19945:\n\n```\nsage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)\n100000 loops, best of 20: 479 ns per loop\n```",
    "created_at": "2018-11-28T15:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285559",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

With #26776 + #19945:

```
sage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)
100000 loops, best of 20: 479 ns per loop
```



---

archive/issue_comments_285560.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nWith the improvements from #26776, the slow-down is \"only\" 20%.",
    "created_at": "2018-11-28T20:24:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285560",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

With the improvements from #26776, the slow-down is "only" 20%.



---

archive/issue_comments_285561.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jdemeyer](#comment%3A26):\n> Replying to [@tscrim](#comment%3A24):\n> > I was wondering if we wanted to special case such things to avoid going through the coercion framework.\n\n> \n> More useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.\n\nI thought we already had some special casing for this with `IntegerPowAction`?\n\nIMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that. However, I don't know how often this occurs in practice. My gut tells me that exponentiation of rationals is usually not a bottleneck in most computations, so I might be being too precious here.",
    "created_at": "2018-11-29T00:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285561",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jdemeyer](#comment%3A26):
> Replying to [@tscrim](#comment%3A24):
> > I was wondering if we wanted to special case such things to avoid going through the coercion framework.

> 
> More useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.

I thought we already had some special casing for this with `IntegerPowAction`?

IMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that. However, I don't know how often this occurs in practice. My gut tells me that exponentiation of rationals is usually not a bottleneck in most computations, so I might be being too precious here.



---

archive/issue_comments_285562.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@tscrim](#comment%3A29):\n> I thought we already had some special casing for this with `IntegerPowAction`?\n\nNo, we don't. It's just an ordinary action.\n\n> IMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that.\n\nSure, I'll do that.",
    "created_at": "2018-11-29T06:43:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285562",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@tscrim](#comment%3A29):
> I thought we already had some special casing for this with `IntegerPowAction`?

No, we don't. It's just an ordinary action.

> IMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that.

Sure, I'll do that.



---

archive/issue_events_279426.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-29T06:48:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279426"
}
```



---

archive/issue_events_279427.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-29T06:48:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279427"
}
```



---

archive/issue_comments_285563.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c\"><code>5706029</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-11-29T12:36:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285563",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c"><code>5706029</code></a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_285564.json:
```json
{
    "body": "Changed commit from **[`b862b7e`](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)** to **[`5706029`](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)**",
    "created_at": "2018-11-29T12:36:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285564",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b862b7e`](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)** to **[`5706029`](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)**



---

archive/issue_events_279428.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-29T12:37:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279428"
}
```



---

archive/issue_events_279429.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-29T12:37:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279429"
}
```



---

archive/issue_comments_285565.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI optimized powering by rational integers, which is now much faster than before.",
    "created_at": "2018-11-29T12:37:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285565",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

I optimized powering by rational integers, which is now much faster than before.



---

archive/issue_comments_285566.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThank you and also for doing the initial timings as well. When the patchbot comes back green, you can set this to a positive review.",
    "created_at": "2018-11-29T13:44:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285566",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

Thank you and also for doing the initial timings as well. When the patchbot comes back green, you can set this to a positive review.



---

archive/issue_events_279430.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-29T16:08:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279430"
}
```



---

archive/issue_events_279431.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-29T16:08:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279431"
}
```



---

archive/issue_events_279432.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-01T13:43:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279432"
}
```



---

archive/issue_events_279433.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d68123f47e26928a6c6a8fdda174915f21588e13",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-12-01T13:43:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19945#event-279433"
}
```



---

archive/issue_comments_285567.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)** to **[`5706029`](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)**",
    "created_at": "2018-12-01T13:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19945#issuecomment-285567",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)** to **[`5706029`](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)**
