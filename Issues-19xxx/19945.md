# Issue 19945: Fix Rational.__pow__

archive/issues_019708.json:
```json
{
    "body": "The following is unexpected:\n\n```\nsage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-18-784db7f7676d> in <module>()\n----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n\n\n/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()\n   2549 \n   2550             if isinstance(n, Element):\n-> 2551                 return (<Element>n)._parent(self)**n\n   2552             try:\n   2553                 return n.parent()(self)**n\n\n/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n    916         if mor is not None:\n    917             if no_extra_args:\n--> 918                 return mor._call_(x)\n    919             else:\n    920                 return mor._call_with_args(x, args, kwds)\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n    153                 print(type(C), C)\n    154                 print(type(C._element_constructor), C._element_constructor)\n--> 155             raise\n    156 \n    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n    148         cdef Parent C = self._codomain\n    149         try:\n--> 150             return C._element_constructor(x)\n    151         except Exception:\n    152             if print_warnings:\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)\n   3891             return result\n   3892 \n-> 3893         return self.create_summand('exact', data)\n   3894 \n   3895 \n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)\n   4335 \n   4336         try:\n-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)\n   4338         except ZeroCoefficientError:\n   4339             return self.zero()\n\n/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n    916         if mor is not None:\n    917             if no_extra_args:\n--> 918                 return mor._call_(x)\n    919             else:\n    920                 return mor._call_with_args(x, args, kwds)\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n    153                 print(type(C), C)\n    154                 print(type(C._element_constructor), C._element_constructor)\n--> 155             raise\n    156 \n    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n    148         cdef Parent C = self._codomain\n    149         try:\n--> 150             return C._element_constructor(x)\n    151         except Exception:\n    152             if print_warnings:\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)\n   1670         except ValueError as e:\n   1671             raise combine_exceptions(\n-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)\n   1673 \n   1674         return self._create_element_(growth, coefficient)\n\nValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.\n> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).\n```\n\n**CC:**  @dkrenn @behackl\n\n**Branch/Commit:** [5706029d8199f2e7d0e66ba84f19a44f3336e04c](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/19945\n\n",
    "closed_at": "2018-12-01T13:43:40Z",
    "created_at": "2016-01-23T05:08:54Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Fix Rational.__pow__",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19945",
    "user": "https://github.com/cheuberg"
}
```
The following is unexpected:

```
sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-18-784db7f7676d> in <module>()
----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n

/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()
   2549 
   2550             if isinstance(n, Element):
-> 2551                 return (<Element>n)._parent(self)**n
   2552             try:
   2553                 return n.parent()(self)**n

/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
    916         if mor is not None:
    917             if no_extra_args:
--> 918                 return mor._call_(x)
    919             else:
    920                 return mor._call_with_args(x, args, kwds)

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
    153                 print(type(C), C)
    154                 print(type(C._element_constructor), C._element_constructor)
--> 155             raise
    156 
    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
    148         cdef Parent C = self._codomain
    149         try:
--> 150             return C._element_constructor(x)
    151         except Exception:
    152             if print_warnings:

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)
   3891             return result
   3892 
-> 3893         return self.create_summand('exact', data)
   3894 
   3895 

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)
   4335 
   4336         try:
-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)
   4338         except ZeroCoefficientError:
   4339             return self.zero()

/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
    916         if mor is not None:
    917             if no_extra_args:
--> 918                 return mor._call_(x)
    919             else:
    920                 return mor._call_with_args(x, args, kwds)

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
    153                 print(type(C), C)
    154                 print(type(C._element_constructor), C._element_constructor)
--> 155             raise
    156 
    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
    148         cdef Parent C = self._codomain
    149         try:
--> 150             return C._element_constructor(x)
    151         except Exception:
    152             if print_warnings:

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)
   1670         except ValueError as e:
   1671             raise combine_exceptions(
-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)
   1673 
   1674         return self._create_element_(growth, coefficient)

ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.
> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).
```

**CC:**  @dkrenn @behackl

**Branch/Commit:** [5706029d8199f2e7d0e66ba84f19a44f3336e04c](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)

**Reviewer:** Travis Scrimshaw

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/19945





---

archive/issue_comments_344027.json:
```json
{
    "body": "<a id='comment:1'></a>\n\n```\nsage: A.<n> = AsymptoticRing('QQ^n*n^QQ', QQ)\nsage: (1/2)^n\n(1/2)^n\n```\ndoes work.",
    "created_at": "2016-01-23T06:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344027",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:1'></a>

```
sage: A.<n> = AsymptoticRing('QQ^n*n^QQ', QQ)
sage: (1/2)^n
(1/2)^n
```
does work.



---

archive/issue_comments_344028.json:
```json
{
    "body": "Replying to [ticket:19945 cheuberg]:\n> \n> ```\n> sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)\n> sage: (1/2)^n\n> ```\n\n\nThe problem is that `(1/2)^n` calls `__pow__` of the rational `1/2`. This tries `A(1/2)^n`, which fails since `1/2` is not in `A`. This also explains why it works with coefficient ring `QQ` as in [comment:1](#comment%3A1).\n\nAs a workaround you can use\n\n```\nsage: n.rpow(1/2)\n```",
    "created_at": "2016-01-25T18:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344028",
    "user": "https://github.com/dkrenn"
}
```

Replying to [ticket:19945 cheuberg]:
> 
> ```
> sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)
> sage: (1/2)^n
> ```


The problem is that `(1/2)^n` calls `__pow__` of the rational `1/2`. This tries `A(1/2)^n`, which fails since `1/2` is not in `A`. This also explains why it works with coefficient ring `QQ` as in [comment:1](#comment%3A1).

As a workaround you can use

```
sage: n.rpow(1/2)
```



---

archive/issue_comments_344029.json:
```json
{
    "body": "<a id='comment:3'></a>\nDocumented at #19961.",
    "created_at": "2016-01-26T08:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344029",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:3'></a>
Documented at #19961.



---

archive/issue_comments_344030.json:
```json
{
    "body": "**Dependencies:** #24247",
    "created_at": "2018-01-08T09:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344030",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #24247



---

archive/issue_events_062175.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "rename": {
        "from": "Asymptotic Ring: cannot construct (1/2)^n",
        "to": "Fix Rational.__pow__"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19945#event-62175"
}
```



---

archive/issue_comments_344031.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,82 @@\n The following is unexpected:\n \n ```\n-sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)\n-sage: (1/2)^n\n-Traceback (most recent call last):\n-...\n-ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ\n-with coefficients in Integer Ring.\n-> *previous* ValueError: Factor 1/2 of 1/2 is neither\n-a coefficient (in Integer Ring) nor growth\n-(in Growth Group QQ^n * n^QQ).\n-sage: 1/2^n\n-(1/2)^n\n+sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n\n+---------------------------------------------------------------------------\n+ValueError                                Traceback (most recent call last)\n+<ipython-input-18-784db7f7676d> in <module>()\n+----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n\n+\n+/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()\n+   2549 \n+   2550             if isinstance(n, Element):\n+-> 2551                 return (<Element>n)._parent(self)**n\n+   2552             try:\n+   2553                 return n.parent()(self)**n\n+\n+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n+    916         if mor is not None:\n+    917             if no_extra_args:\n+--> 918                 return mor._call_(x)\n+    919             else:\n+    920                 return mor._call_with_args(x, args, kwds)\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n+    153                 print(type(C), C)\n+    154                 print(type(C._element_constructor), C._element_constructor)\n+--> 155             raise\n+    156 \n+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n+    148         cdef Parent C = self._codomain\n+    149         try:\n+--> 150             return C._element_constructor(x)\n+    151         except Exception:\n+    152             if print_warnings:\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)\n+   3891             return result\n+   3892 \n+-> 3893         return self.create_summand('exact', data)\n+   3894 \n+   3895 \n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)\n+   4335 \n+   4336         try:\n+-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)\n+   4338         except ZeroCoefficientError:\n+   4339             return self.zero()\n+\n+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()\n+    916         if mor is not None:\n+    917             if no_extra_args:\n+--> 918                 return mor._call_(x)\n+    919             else:\n+    920                 return mor._call_with_args(x, args, kwds)\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()\n+    153                 print(type(C), C)\n+    154                 print(type(C._element_constructor), C._element_constructor)\n+--> 155             raise\n+    156 \n+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n+\n+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()\n+    148         cdef Parent C = self._codomain\n+    149         try:\n+--> 150             return C._element_constructor(x)\n+    151         except Exception:\n+    152             if print_warnings:\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)\n+   1670         except ValueError as e:\n+   1671             raise combine_exceptions(\n+-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)\n+   1673 \n+   1674         return self._create_element_(growth, coefficient)\n+\n+ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.\n+> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).\n ```\n``````\n",
    "created_at": "2018-01-08T09:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344031",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,82 @@
 The following is unexpected:
 
 ```
-sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ)
-sage: (1/2)^n
-Traceback (most recent call last):
-...
-ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ
-with coefficients in Integer Ring.
-> *previous* ValueError: Factor 1/2 of 1/2 is neither
-a coefficient (in Integer Ring) nor growth
-(in Growth Group QQ^n * n^QQ).
-sage: 1/2^n
-(1/2)^n
+sage: A.<n> = AsymptoticRing('QQ^n * n^QQ', ZZ); (1/2)^n
+---------------------------------------------------------------------------
+ValueError                                Traceback (most recent call last)
+<ipython-input-18-784db7f7676d> in <module>()
+----> 1 A = AsymptoticRing('QQ^n * n^QQ', ZZ, names=('n',)); (n,) = A._first_ngens(1); (Integer(1)/Integer(2))**n
+
+/usr/local/src/sage-config/src/sage/rings/rational.pyx in sage.rings.rational.Rational.__pow__ (build/cythonized/sage/rings/rational.c:23638)()
+   2549 
+   2550             if isinstance(n, Element):
+-> 2551                 return (<Element>n)._parent(self)**n
+   2552             try:
+   2553                 return n.parent()(self)**n
+
+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
+    916         if mor is not None:
+    917             if no_extra_args:
+--> 918                 return mor._call_(x)
+    919             else:
+    920                 return mor._call_with_args(x, args, kwds)
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
+    153                 print(type(C), C)
+    154                 print(type(C._element_constructor), C._element_constructor)
+--> 155             raise
+    156 
+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
+    148         cdef Parent C = self._codomain
+    149         try:
+--> 150             return C._element_constructor(x)
+    151         except Exception:
+    152             if print_warnings:
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in _element_constructor_(self, data, simplify, convert)
+   3891             return result
+   3892 
+-> 3893         return self.create_summand('exact', data)
+   3894 
+   3895 
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/asymptotic_ring.pyc in create_summand(self, type, data, **kwds)
+   4335 
+   4336         try:
+-> 4337             return self(TM(data, **kwds), simplify=False, convert=False)
+   4338         except ZeroCoefficientError:
+   4339             return self.zero()
+
+/usr/local/src/sage-config/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9529)()
+    916         if mor is not None:
+    917             if no_extra_args:
+--> 918                 return mor._call_(x)
+    919             else:
+    920                 return mor._call_with_args(x, args, kwds)
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4978)()
+    153                 print(type(C), C)
+    154                 print(type(C._element_constructor), C._element_constructor)
+--> 155             raise
+    156 
+    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):
+
+/usr/local/src/sage-config/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4846)()
+    148         cdef Parent C = self._codomain
+    149         try:
+--> 150             return C._element_constructor(x)
+    151         except Exception:
+    152             if print_warnings:
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/asymptotic/term_monoid.pyc in _element_constructor_(self, data, coefficient)
+   1670         except ValueError as e:
+   1671             raise combine_exceptions(
+-> 1672                 ValueError('%s is not in %s.' % (data, self)), e)
+   1673 
+   1674         return self._create_element_(growth, coefficient)
+
+ValueError: 1/2 is not in Exact Term Monoid QQ^n * n^QQ with coefficients in Integer Ring.
+> *previous* ValueError: Factor 1/2 of 1/2 is neither a coefficient (in Integer Ring) nor growth (in Growth Group QQ^n * n^QQ).
 ```
``````




---

archive/issue_comments_344032.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)",
    "created_at": "2018-01-08T10:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344032",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)



---

archive/issue_comments_344033.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae\">1c9bb4f</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-08T10:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344033",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae">1c9bb4f</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_344034.json:
```json
{
    "body": "**Commit:** [1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)",
    "created_at": "2018-01-08T10:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)



---

archive/issue_comments_344035.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2018-01-08T10:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344035",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_344036.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-01-08T10:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344036",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_344037.json:
```json
{
    "body": "**Changing commit** from \"[1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)\" to \"[05b066dda9ce103a4ea48a6c97596d29f085ad2e](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)\".",
    "created_at": "2018-01-08T10:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae](https://github.com/sagemath/sagetrac-mirror/commit/1c9bb4f78f10157d7b02a385bbfbb1f3d313e9ae)" to "[05b066dda9ce103a4ea48a6c97596d29f085ad2e](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)".



---

archive/issue_comments_344038.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e\">05b066d</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-08T10:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e">05b066d</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_344039.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9\">84c056b</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-08T10:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344039",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9">84c056b</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_344040.json:
```json
{
    "body": "**Changing commit** from \"[05b066dda9ce103a4ea48a6c97596d29f085ad2e](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)\" to \"[84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)\".",
    "created_at": "2018-01-08T10:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344040",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[05b066dda9ce103a4ea48a6c97596d29f085ad2e](https://github.com/sagemath/sagetrac-mirror/commit/05b066dda9ce103a4ea48a6c97596d29f085ad2e)" to "[84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)".



---

archive/issue_comments_344041.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-02-21T12:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344041",
    "user": "https://github.com/mezzarobba"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_344042.json:
```json
{
    "body": "<a id='comment:11'></a>\n\n```\nsage -t --long --warn-long 63.9 src/sage/rings/rational.pyx\n**********************************************************************\nFile \"src/sage/rings/rational.pyx\", line 302, in sage.rings.rational.rational_power_parts\nFailed example:\n    (-1)^(-1/3)\nExpected:\n    -(-1)^(2/3)\nGot:\n    -1.0*(-1)^(2/3)\n**********************************************************************\n```",
    "created_at": "2018-02-21T12:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344042",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'></a>

```
sage -t --long --warn-long 63.9 src/sage/rings/rational.pyx
**********************************************************************
File "src/sage/rings/rational.pyx", line 302, in sage.rings.rational.rational_power_parts
Failed example:
    (-1)^(-1/3)
Expected:
    -(-1)^(2/3)
Got:
    -1.0*(-1)^(2/3)
**********************************************************************
```



---

archive/issue_comments_344043.json:
```json
{
    "body": "<a id='comment:12'></a>\nSeriously? How did that happen?",
    "created_at": "2018-02-21T12:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344043",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Seriously? How did that happen?



---

archive/issue_comments_344044.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A12):\n> Seriously? How did that happen?\n\n\nNo idea. I just thought I would review this ticket, merged your branch in the current `develop`, and ran the test suite.",
    "created_at": "2018-02-21T13:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344044",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A12):
> Seriously? How did that happen?


No idea. I just thought I would review this ticket, merged your branch in the current `develop`, and ran the test suite.



---

archive/issue_comments_344045.json:
```json
{
    "body": "**Changing dependencies** from \"#24247\" to \"\".",
    "created_at": "2018-11-26T11:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344045",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#24247" to "".



---

archive/issue_comments_344046.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936\">b74fb20</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-11-26T12:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936">b74fb20</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_344047.json:
```json
{
    "body": "**Changing commit** from \"[84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)\" to \"[b74fb2005c709b90eb2821de3b20615bea6ed936](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)\".",
    "created_at": "2018-11-26T12:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344047",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9](https://github.com/sagemath/sagetrac-mirror/commit/84c056bc5aefc9c7525cc2d1c7a5758e0f33dfe9)" to "[b74fb2005c709b90eb2821de3b20615bea6ed936](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)".



---

archive/issue_comments_344048.json:
```json
{
    "body": "**Changing commit** from \"[b74fb2005c709b90eb2821de3b20615bea6ed936](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)\" to \"[b862b7eedff3d9c75ea821ce4bdec379e06a82c7](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)\".",
    "created_at": "2018-11-26T12:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344048",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b74fb2005c709b90eb2821de3b20615bea6ed936](https://github.com/sagemath/sagetrac-mirror/commit/b74fb2005c709b90eb2821de3b20615bea6ed936)" to "[b862b7eedff3d9c75ea821ce4bdec379e06a82c7](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)".



---

archive/issue_comments_344049.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7\">b862b7e</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-11-26T12:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7">b862b7e</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_events_062176.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-11-26T12:26:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19945#event-62176"
}
```



---

archive/issue_comments_344050.json:
```json
{
    "body": "<a id='comment:17'></a>\nRebased to 8.5.beta5.",
    "created_at": "2018-11-26T12:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344050",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Rebased to 8.5.beta5.



---

archive/issue_comments_344051.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-11-26T12:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344051",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_344052.json:
```json
{
    "body": "<a id='comment:18'></a>\nIn general, this LGTM. Have you run any timings to see if there is any change for **Q**<sup>**Z**</sup>, **Q**<sup>**Q**</sup>, and **Z**<sup>**Q**</sup>? Since these are common operations and they now go through the coercion framework (if I understand everything correctly), I want to make sure they are not (significantly) affected.",
    "created_at": "2018-11-27T03:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344052",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
In general, this LGTM. Have you run any timings to see if there is any change for **Q**<sup>**Z**</sup>, **Q**<sup>**Q**</sup>, and **Z**<sup>**Q**</sup>? Since these are common operations and they now go through the coercion framework (if I understand everything correctly), I want to make sure they are not (significantly) affected.



---

archive/issue_comments_344053.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-11-27T03:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344053",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_344054.json:
```json
{
    "body": "<a id='comment:19'></a>\nI did some timings with mixed results:\n\n1. `QQ^ZZ` became slower by a factor 1.4 (404ns to 575ns). This is because of the overhead of `IntegerPowAction` and it's really hard to avoid this slow-down. It's also a large relative slow-down because the actual powering is very fast.\n\n2. The old code optimized the case of powering to a rational integer (an element of `QQ` with denominator 1). The new code doesn't, leading to a slow-down for `QQ^QQ` with integral exponent.\n\n3. `QQ^QQ` is faster if the exponent is not a rational integer.\n\n4. `ZZ^QQ` simply delegates to `QQ^QQ` (this code is not changed), so speed gains/losses are similar to the `QQ^QQ` case.\n\nI'm not entirely sure whether I should implement a special case for powering to a rational integer. Is this case common enough to warrant the extra code?\n\nI also noticed that #24500 gives an additional slight slow-down for `QQ^ZZ` (about 5%). This is because powering is always a right action, so the problem that #24500 fixes does not occur for `IntegerPowAction`.",
    "created_at": "2018-11-27T11:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344054",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
I did some timings with mixed results:

1. `QQ^ZZ` became slower by a factor 1.4 (404ns to 575ns). This is because of the overhead of `IntegerPowAction` and it's really hard to avoid this slow-down. It's also a large relative slow-down because the actual powering is very fast.

2. The old code optimized the case of powering to a rational integer (an element of `QQ` with denominator 1). The new code doesn't, leading to a slow-down for `QQ^QQ` with integral exponent.

3. `QQ^QQ` is faster if the exponent is not a rational integer.

4. `ZZ^QQ` simply delegates to `QQ^QQ` (this code is not changed), so speed gains/losses are similar to the `QQ^QQ` case.

I'm not entirely sure whether I should implement a special case for powering to a rational integer. Is this case common enough to warrant the extra code?

I also noticed that #24500 gives an additional slight slow-down for `QQ^ZZ` (about 5%). This is because powering is always a right action, so the problem that #24500 fixes does not occur for `IntegerPowAction`.



---

archive/issue_comments_344055.json:
```json
{
    "body": "<a id='comment:20'></a>\n#26775 should solve most of the slow-down for `QQ^ZZ`.",
    "created_at": "2018-11-27T11:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344055",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
#26775 should solve most of the slow-down for `QQ^ZZ`.



---

archive/issue_comments_344056.json:
```json
{
    "body": "<a id='comment:21'></a>\nNever mind, my analysis at #26775 was wrong.\n\nStill, there is something strange with benchmarks: without changing any code, the old code slowed down from 404ns to 446ns and the new code (on top of #24500) sped up from about 600ns to 515ns. So without really changing anything (but recompiling the new code), I now have a slow-down of a factor only 1.15 for `QQ^ZZ`. Benchmarks are a strange thing...",
    "created_at": "2018-11-27T11:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344056",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Never mind, my analysis at #26775 was wrong.

Still, there is something strange with benchmarks: without changing any code, the old code slowed down from 404ns to 446ns and the new code (on top of #24500) sped up from about 600ns to 515ns. So without really changing anything (but recompiling the new code), I now have a slow-down of a factor only 1.15 for `QQ^ZZ`. Benchmarks are a strange thing...



---

archive/issue_comments_344057.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe wildly differing timings must be something like a memory layout/cache issue.\n\nAnyway, for `QQ^ZZ`, I give the best timings for\n\n```\nsage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)\n```\n\nVanilla 8.5.beta5:\n\n```\n100000 loops, best of 20: 397 ns per loop\n```\n\nWith #19945:\n\n```\n100000 loops, best of 20: 512 ns per loop\n```\n\nWith #24500 and #19945:\n\n```\n100000 loops, best of 20: 509 ns per loop\n```",
    "created_at": "2018-11-27T11:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344057",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
The wildly differing timings must be something like a memory layout/cache issue.

Anyway, for `QQ^ZZ`, I give the best timings for

```
sage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)
```

Vanilla 8.5.beta5:

```
100000 loops, best of 20: 397 ns per loop
```

With #19945:

```
100000 loops, best of 20: 512 ns per loop
```

With #24500 and #19945:

```
100000 loops, best of 20: 509 ns per loop
```



---

archive/issue_comments_344058.json:
```json
{
    "body": "<a id='comment:23'></a>\nMost of the slowdown in this ticket is due to\n\n```\nsage: g = coercion_model.get_action; args = (QQ, ZZ, operator.pow)\nsage: timeit('g(*args)', repeat=20, number=100000)\n100000 loops, best of 20: 133 ns per loop\n```",
    "created_at": "2018-11-27T11:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344058",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Most of the slowdown in this ticket is due to

```
sage: g = coercion_model.get_action; args = (QQ, ZZ, operator.pow)
sage: timeit('g(*args)', repeat=20, number=100000)
100000 loops, best of 20: 133 ns per loop
```



---

archive/issue_comments_344059.json:
```json
{
    "body": "<a id='comment:24'></a>\nThat is what I expected. I was wondering if we wanted to special case such things to avoid going through the coercion framework. I also think it is worthwhile to special case rational powers that are integers.",
    "created_at": "2018-11-27T12:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344059",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
That is what I expected. I was wondering if we wanted to special case such things to avoid going through the coercion framework. I also think it is worthwhile to special case rational powers that are integers.



---

archive/issue_comments_344060.json:
```json
{
    "body": "<a id='comment:25'></a>\n#26776 should gain about 20ns.",
    "created_at": "2018-11-27T12:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344060",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
#26776 should gain about 20ns.



---

archive/issue_comments_344061.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [tscrim](#comment%3A24):\n> I was wondering if we wanted to special case such things to avoid going through the coercion framework.\n\n\nMore useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.",
    "created_at": "2018-11-28T15:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344061",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [tscrim](#comment%3A24):
> I was wondering if we wanted to special case such things to avoid going through the coercion framework.


More useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.



---

archive/issue_comments_344062.json:
```json
{
    "body": "<a id='comment:27'></a>\nWith #26776 + #19945:\n\n```\nsage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)\n100000 loops, best of 20: 479 ns per loop\n```",
    "created_at": "2018-11-28T15:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344062",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
With #26776 + #19945:

```
sage: a = QQ(25); b = ZZ(2); timeit('a**b', repeat=20, number=100000)
100000 loops, best of 20: 479 ns per loop
```



---

archive/issue_comments_344063.json:
```json
{
    "body": "<a id='comment:28'></a>\nWith the improvements from #26776, the slow-down is \"only\" 20%.",
    "created_at": "2018-11-28T20:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344063",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
With the improvements from #26776, the slow-down is "only" 20%.



---

archive/issue_comments_344064.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [jdemeyer](#comment%3A26):\n> Replying to [tscrim](#comment%3A24):\n> > I was wondering if we wanted to special case such things to avoid going through the coercion framework.\n\n> \n> More useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.\n\n\nI thought we already had some special casing for this with `IntegerPowAction`?\n\nIMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that. However, I don't know how often this occurs in practice. My gut tells me that exponentiation of rationals is usually not a bottleneck in most computations, so I might be being too precious here.",
    "created_at": "2018-11-29T00:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344064",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>
Replying to [jdemeyer](#comment%3A26):
> Replying to [tscrim](#comment%3A24):
> > I was wondering if we wanted to special case such things to avoid going through the coercion framework.

> 
> More useful (if you want to do this optimization) would be to special-case integer powering in general in the coercion model.


I thought we already had some special casing for this with `IntegerPowAction`?

IMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that. However, I don't know how often this occurs in practice. My gut tells me that exponentiation of rationals is usually not a bottleneck in most computations, so I might be being too precious here.



---

archive/issue_comments_344065.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [tscrim](#comment%3A29):\n> I thought we already had some special casing for this with `IntegerPowAction`?\n\n\nNo, we don't. It's just an ordinary action.\n\n> IMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that.\n\n\nSure, I'll do that.",
    "created_at": "2018-11-29T06:43:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344065",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Replying to [tscrim](#comment%3A29):
> I thought we already had some special casing for this with `IntegerPowAction`?


No, we don't. It's just an ordinary action.

> IMO, it is really easy to accidentally construct integers that are rational numbers, so that is why I think there is some merit to special casing that.


Sure, I'll do that.



---

archive/issue_comments_344066.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-11-29T06:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344066",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_344067.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c\">5706029</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>\n",
    "created_at": "2018-11-29T12:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c">5706029</a></td><td><code>Implement Rational.__pow__ using the coercion model</code></td></tr></table>




---

archive/issue_comments_344068.json:
```json
{
    "body": "**Changing commit** from \"[b862b7eedff3d9c75ea821ce4bdec379e06a82c7](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)\" to \"[5706029d8199f2e7d0e66ba84f19a44f3336e04c](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)\".",
    "created_at": "2018-11-29T12:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b862b7eedff3d9c75ea821ce4bdec379e06a82c7](https://github.com/sagemath/sagetrac-mirror/commit/b862b7eedff3d9c75ea821ce4bdec379e06a82c7)" to "[5706029d8199f2e7d0e66ba84f19a44f3336e04c](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)".



---

archive/issue_comments_344069.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-11-29T12:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344069",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_344070.json:
```json
{
    "body": "<a id='comment:33'></a>\nI optimized powering by rational integers, which is now much faster than before.",
    "created_at": "2018-11-29T12:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344070",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
I optimized powering by rational integers, which is now much faster than before.



---

archive/issue_comments_344071.json:
```json
{
    "body": "<a id='comment:34'></a>\nThank you and also for doing the initial timings as well. When the patchbot comes back green, you can set this to a positive review.",
    "created_at": "2018-11-29T13:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344071",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>
Thank you and also for doing the initial timings as well. When the patchbot comes back green, you can set this to a positive review.



---

archive/issue_comments_344072.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-11-29T16:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344072",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_062177.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-01T13:43:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19945#event-62177"
}
```



---

archive/issue_comments_344073.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)\" to \"[5706029d8199f2e7d0e66ba84f19a44f3336e04c](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)\".",
    "created_at": "2018-12-01T13:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19945#issuecomment-344073",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/19945](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/19945)" to "[5706029d8199f2e7d0e66ba84f19a44f3336e04c](https://github.com/sagemath/sagetrac-mirror/commit/5706029d8199f2e7d0e66ba84f19a44f3336e04c)".
