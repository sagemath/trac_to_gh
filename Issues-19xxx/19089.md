# Issue 19089: freetype 2.6 fails to build on scientific linux 7.1

archive/issues_018852.json:
```json
{
    "body": "Building freetype fails with:\n\n```\n/autofit.lo /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c\nlibtool: compile:  gcc -pedantic -ansi -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs -I./builds/unix -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/include -c -Wall -g -O2 -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_SYSTEM_ZLIB -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_USE_BZIP2 -I/home/frb15/sagemath/sage-brial/local/include/libpng12 -DFT_CONFIG_OPTION_USE_PNG -I/usr/include/harfbuzz -DFT_CONFIG_OPTION_USE_HARFBUZZ \"-DFT_CONFIG_CONFIG_H=<ftconfig.h>\" -DFT2_BUILD_LIBRARY \"-DFT_CONFIG_MODULES_H=<ftmodule.h>\" /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c  -fPIC -DPIC -o /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs/.libs/autofit.o\nIn file included from /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c:37:0:\n/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c: In function 'af_get_coverage':\n/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: error: 'HB_SET_VALUE_INVALID' undeclared (first use in this function)\n     for ( idx = HB_SET_VALUE_INVALID; hb_set_next( gsub_lookups, &idx ); )\n                 ^\n/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: note: each undeclared identifier is reported only once for each function it appears in\n```\nIt appears `HB_SET_VALUE_INVALID` is defined in the `harfbuzz` library and the version shipped with scientific linux 7.1 (0.9.20) doesn't have it (0.9.38 in gentoo does). \n\nBranch/Commit: 4afa106419b7a603d77bb2c316f776226dd87fc0\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fran\u00e7ois Bissey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19089\n\n",
    "closed_at": "2015-08-29T23:56:42Z",
    "created_at": "2015-08-26T02:38:30Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "freetype 2.6 fails to build on scientific linux 7.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19089",
    "user": "https://github.com/kiwifb"
}
```
Building freetype fails with:

```
/autofit.lo /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c
libtool: compile:  gcc -pedantic -ansi -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs -I./builds/unix -I/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/include -c -Wall -g -O2 -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_SYSTEM_ZLIB -I/home/frb15/sagemath/sage-brial/local/include -DFT_CONFIG_OPTION_USE_BZIP2 -I/home/frb15/sagemath/sage-brial/local/include/libpng12 -DFT_CONFIG_OPTION_USE_PNG -I/usr/include/harfbuzz -DFT_CONFIG_OPTION_USE_HARFBUZZ "-DFT_CONFIG_CONFIG_H=<ftconfig.h>" -DFT2_BUILD_LIBRARY "-DFT_CONFIG_MODULES_H=<ftmodule.h>" /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c  -fPIC -DPIC -o /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/objs/.libs/autofit.o
In file included from /home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/autofit.c:37:0:
/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c: In function 'af_get_coverage':
/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: error: 'HB_SET_VALUE_INVALID' undeclared (first use in this function)
     for ( idx = HB_SET_VALUE_INVALID; hb_set_next( gsub_lookups, &idx ); )
                 ^
/home/frb15/sagemath/sage-brial/local/var/tmp/sage/build/freetype-2.6/src/src/autofit/hbshim.c:190:17: note: each undeclared identifier is reported only once for each function it appears in
```
It appears `HB_SET_VALUE_INVALID` is defined in the `harfbuzz` library and the version shipped with scientific linux 7.1 (0.9.20) doesn't have it (0.9.38 in gentoo does). 

Branch/Commit: 4afa106419b7a603d77bb2c316f776226dd87fc0

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Jeroen Demeyer

Author: Fran√ßois Bissey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19089





---

archive/issue_comments_335202.json:
```json
{
    "body": "<a id='comment:1'></a>\nSetting `--with-harfbuzz=no` in `spkg-install` is somehow insufficient.",
    "created_at": "2015-08-26T02:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335202",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
Setting `--with-harfbuzz=no` in `spkg-install` is somehow insufficient.



---

archive/issue_comments_335203.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe option does work I had a stray `\"` in `spkg-install` branch to follow in a bit.",
    "created_at": "2015-08-26T02:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335203",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
The option does work I had a stray `"` in `spkg-install` branch to follow in a bit.



---

archive/issue_comments_335204.json:
```json
{
    "body": "<a id='comment:3'></a>\nReady for review. Note that freetype checks to see if `harfbuzz` is higher than `0.9.19` but it is obviously too low.\n\n---\nLast 10 new commits:\n|                                                                                                                                          |                                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[60725e3](https://github.com/sagemath/sagetrac-mirror/commit/60725e3ad40b79e2bcfbf0d82435eb4e8a12989e)|`Merge remote-tracking branch 'trac/develop' into polybori_autotools`|\n|[da49082](https://github.com/sagemath/sagetrac-mirror/commit/da490827368885a4370fe1f8352c07c107a938c4)|`update to a polybori which includes python bindings`|\n|[c30cf70](https://github.com/sagemath/sagetrac-mirror/commit/c30cf70daf27791feb128534cb1fad4d5b0dd652)|`Revert \"move polybori python interface into sage\"`|\n|[72965f6](https://github.com/sagemath/sagetrac-mirror/commit/72965f60ff05452ee3af79b463afcf42ee1ad814)|`Merge branch 'polybori_autotools' into HEAD`|\n|[fdff733](https://github.com/sagemath/sagetrac-mirror/commit/fdff73302359b87ab524b5a7f3722e36a550ca7f)|`switch to BRiAl`|\n|[5cbf983](https://github.com/sagemath/sagetrac-mirror/commit/5cbf983ee15dd61d8ad4aec707b58e743def3c72)|`rename error messages PolyBoRi -> BRiAl`|\n|[51a1e98](https://github.com/sagemath/sagetrac-mirror/commit/51a1e98e18acc7f127ef6a5f9a0f0993c867f800)|`fix imports polybori -> brial`|\n|[bf3c56f](https://github.com/sagemath/sagetrac-mirror/commit/bf3c56f1ca605b04ff60e0ab9f72c19158c6f9d6)|`brial: clean out old polybori and brial installations before installing`|\n|[7aadcf2](https://github.com/sagemath/sagetrac-mirror/commit/7aadcf2a49b065b56cb737e325c5e47d01c4a710)|`remove unused library gd from pbori`|\n|[d3b9d9e](https://github.com/sagemath/sagetrac-mirror/commit/d3b9d9e7d3ed98895aa73efa0a6080d3a97bfe87)|`disable harfbuzz for distro with a version of harfbuzz that is not high enough`|",
    "created_at": "2015-08-26T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335204",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Ready for review. Note that freetype checks to see if `harfbuzz` is higher than `0.9.19` but it is obviously too low.

---
Last 10 new commits:
|                                                                                                                                          |                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[60725e3](https://github.com/sagemath/sagetrac-mirror/commit/60725e3ad40b79e2bcfbf0d82435eb4e8a12989e)|`Merge remote-tracking branch 'trac/develop' into polybori_autotools`|
|[da49082](https://github.com/sagemath/sagetrac-mirror/commit/da490827368885a4370fe1f8352c07c107a938c4)|`update to a polybori which includes python bindings`|
|[c30cf70](https://github.com/sagemath/sagetrac-mirror/commit/c30cf70daf27791feb128534cb1fad4d5b0dd652)|`Revert "move polybori python interface into sage"`|
|[72965f6](https://github.com/sagemath/sagetrac-mirror/commit/72965f60ff05452ee3af79b463afcf42ee1ad814)|`Merge branch 'polybori_autotools' into HEAD`|
|[fdff733](https://github.com/sagemath/sagetrac-mirror/commit/fdff73302359b87ab524b5a7f3722e36a550ca7f)|`switch to BRiAl`|
|[5cbf983](https://github.com/sagemath/sagetrac-mirror/commit/5cbf983ee15dd61d8ad4aec707b58e743def3c72)|`rename error messages PolyBoRi -> BRiAl`|
|[51a1e98](https://github.com/sagemath/sagetrac-mirror/commit/51a1e98e18acc7f127ef6a5f9a0f0993c867f800)|`fix imports polybori -> brial`|
|[bf3c56f](https://github.com/sagemath/sagetrac-mirror/commit/bf3c56f1ca605b04ff60e0ab9f72c19158c6f9d6)|`brial: clean out old polybori and brial installations before installing`|
|[7aadcf2](https://github.com/sagemath/sagetrac-mirror/commit/7aadcf2a49b065b56cb737e325c5e47d01c4a710)|`remove unused library gd from pbori`|
|[d3b9d9e](https://github.com/sagemath/sagetrac-mirror/commit/d3b9d9e7d3ed98895aa73efa0a6080d3a97bfe87)|`disable harfbuzz for distro with a version of harfbuzz that is not high enough`|



---

archive/issue_comments_335205.json:
```json
{
    "body": "Changing commit from \"\" to \"d3b9d9e7d3ed98895aa73efa0a6080d3a97bfe87\"",
    "created_at": "2015-08-26T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335205",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "" to "d3b9d9e7d3ed98895aa73efa0a6080d3a97bfe87"



---

archive/issue_comments_335206.json:
```json
{
    "body": "Changing author from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2015-08-26T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335206",
    "user": "https://github.com/kiwifb"
}
```

Changing author from "" to "Fran√ßois Bissey"



---

archive/issue_comments_335207.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-26T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335207",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_335208.json:
```json
{
    "body": "Changing branch from \"\" to \"u/fbissey/freetype\"",
    "created_at": "2015-08-26T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335208",
    "user": "https://github.com/kiwifb"
}
```

Changing branch from "" to "u/fbissey/freetype"



---

archive/issue_comments_335209.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2015-08-26T03:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335209",
    "user": "https://github.com/kiwifb"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_335210.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-26T03:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335210",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_335211.json:
```json
{
    "body": "<a id='comment:4'></a>\nDidn't mean to pull #18437, I will have to redo the branch. Reported upstream:\nhttps://savannah.nongnu.org/bugs/index.php?45828",
    "created_at": "2015-08-26T03:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335211",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Didn't mean to pull #18437, I will have to redo the branch. Reported upstream:
https://savannah.nongnu.org/bugs/index.php?45828



---

archive/issue_comments_335212.json:
```json
{
    "body": "Changing commit from \"d3b9d9e7d3ed98895aa73efa0a6080d3a97bfe87\" to \"4afa106419b7a603d77bb2c316f776226dd87fc0\"",
    "created_at": "2015-08-26T03:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d3b9d9e7d3ed98895aa73efa0a6080d3a97bfe87" to "4afa106419b7a603d77bb2c316f776226dd87fc0"



---

archive/issue_comments_335213.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------|\n|[4afa106](https://github.com/sagemath/sagetrac-mirror/commit/4afa106419b7a603d77bb2c316f776226dd87fc0)|`disable harfbuzz for distro with a version of harfbuzz that is not high enough`|",
    "created_at": "2015-08-26T03:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335213",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------|
|[4afa106](https://github.com/sagemath/sagetrac-mirror/commit/4afa106419b7a603d77bb2c316f776226dd87fc0)|`disable harfbuzz for distro with a version of harfbuzz that is not high enough`|



---

archive/issue_comments_335214.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-26T03:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335214",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_335215.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\"",
    "created_at": "2015-08-26T04:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335215",
    "user": "https://github.com/kiwifb"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release."



---

archive/issue_comments_335216.json:
```json
{
    "body": "<a id='comment:9'></a>\nI can't test that it fixes the problem, but at least the fix makes sense.",
    "created_at": "2015-08-28T10:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335216",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
I can't test that it fixes the problem, but at least the fix makes sense.



---

archive/issue_comments_335217.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-08-28T10:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335217",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_335218.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-28T10:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335218",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_335219.json:
```json
{
    "body": "<a id='comment:10'></a>\nIt is probably a rare condition as you need to have the development packages for harfbuzz in the first place. And you need to have just the \"right\" version from 0.9.19 to 0.9.21.",
    "created_at": "2015-08-28T10:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335219",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
It is probably a rare condition as you need to have the development packages for harfbuzz in the first place. And you need to have just the "right" version from 0.9.19 to 0.9.21.



---

archive/issue_comments_335220.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-29T23:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335220",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_335221.json:
```json
{
    "body": "Changing branch from \"u/fbissey/freetype\" to \"4afa106419b7a603d77bb2c316f776226dd87fc0\"",
    "created_at": "2015-08-29T23:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19089#issuecomment-335221",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/fbissey/freetype" to "4afa106419b7a603d77bb2c316f776226dd87fc0"



---

archive/issue_events_068125.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-29T23:56:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19089",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19089#event-68125"
}
```
