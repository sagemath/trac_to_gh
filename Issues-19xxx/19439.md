# Issue 19439: Corrections to infinities returned by mpmath

archive/issues_019202.json:
```json
{
    "body": "It seems in some cases the infinities returned from mpmath need to be changed by the function's `evalf()` in order to be correct:\nBefore:\n\n```\nsage: zeta(SR(1))\nInfinity\nsage: zeta(SR(1.))   <---------\n+infinity\nsage: type(zeta(SR(1)))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(zeta(SR(1)).pyobject())\n<class 'sage.rings.infinity.UnsignedInfinity'>\nsage: type(zeta(SR(1.)))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(zeta(SR(1.)).pyobject())\n<type 'sage.rings.real_mpfr.RealNumber'>\n```\n\nThe ticket should result in:\n\n```\nsage: zeta(SR(1))\nInfinity\nsage: zeta(SR(1.))\nInfinity\nsage: type(zeta(SR(1)))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(zeta(SR(1)).pyobject())\n<class 'sage.rings.infinity.UnsignedInfinity'>\nsage: type(zeta(SR(1.)))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(zeta(SR(1.)).pyobject())\n<class 'sage.rings.infinity.UnsignedInfinity'>\n```\n\nIdeally, fix other such cases too in this ticket.\n\nCC:  @paulmasson\n\nBranch/Commit: 5d2d8604975fb8bd16159720ed3f45296ff88210\n\nReviewer: Travis Scrimshaw\n\nAuthor: Ralf Stephan\n\nDependencies: #22838\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19439\n\n",
    "closed_at": "2017-04-28T23:54:57Z",
    "created_at": "2015-10-20T12:41:08Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Corrections to infinities returned by mpmath",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19439",
    "user": "https://github.com/rwst"
}
```
It seems in some cases the infinities returned from mpmath need to be changed by the function's `evalf()` in order to be correct:
Before:

```
sage: zeta(SR(1))
Infinity
sage: zeta(SR(1.))   <---------
+infinity
sage: type(zeta(SR(1)))
<type 'sage.symbolic.expression.Expression'>
sage: type(zeta(SR(1)).pyobject())
<class 'sage.rings.infinity.UnsignedInfinity'>
sage: type(zeta(SR(1.)))
<type 'sage.symbolic.expression.Expression'>
sage: type(zeta(SR(1.)).pyobject())
<type 'sage.rings.real_mpfr.RealNumber'>
```

The ticket should result in:

```
sage: zeta(SR(1))
Infinity
sage: zeta(SR(1.))
Infinity
sage: type(zeta(SR(1)))
<type 'sage.symbolic.expression.Expression'>
sage: type(zeta(SR(1)).pyobject())
<class 'sage.rings.infinity.UnsignedInfinity'>
sage: type(zeta(SR(1.)))
<type 'sage.symbolic.expression.Expression'>
sage: type(zeta(SR(1.)).pyobject())
<class 'sage.rings.infinity.UnsignedInfinity'>
```

Ideally, fix other such cases too in this ticket.

CC:  @paulmasson

Branch/Commit: 5d2d8604975fb8bd16159720ed3f45296ff88210

Reviewer: Travis Scrimshaw

Author: Ralf Stephan

Dependencies: #22838

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19439





---

archive/issue_comments_343489.json:
```json
{
    "body": "<a id='comment:1'></a>\nPolylog uses zeta here, so it's mainly because of `RR(1).zeta()` not being converted in `symbolic/function.pyx` or the `RR` functions not using the `InfinityRing` elements.",
    "created_at": "2016-06-11T13:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343489",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
Polylog uses zeta here, so it's mainly because of `RR(1).zeta()` not being converted in `symbolic/function.pyx` or the `RR` functions not using the `InfinityRing` elements.



---

archive/issue_comments_343490.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,5 +11,11 @@\n +infinity\n sage: type(_)\n <type 'sage.rings.real_mpfr.RealNumber'>\n+sage: polylog(SR(1.),SR(1.))\n++infinity\n+sage: zeta(SR(1.))\n++infinity\n+sage: type(_)\n+<type 'sage.symbolic.expression.Expression'>\n ```\n \n``````\n",
    "created_at": "2016-07-19T06:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343490",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,5 +11,11 @@
 +infinity
 sage: type(_)
 <type 'sage.rings.real_mpfr.RealNumber'>
+sage: polylog(SR(1.),SR(1.))
++infinity
+sage: zeta(SR(1.))
++infinity
+sage: type(_)
+<type 'sage.symbolic.expression.Expression'>
 ```
 
``````




---

archive/issue_events_068798.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-07-19T06:58:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68798"
}
```



---

archive/issue_comments_343491.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe problematic output is rather for the last lines, ie symbolic input, which should produce symbolic output. It does, by wrapping FP infinity into SR. It would be better if that would rather produce the infinity from the ring.",
    "created_at": "2016-07-19T06:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343491",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
The problematic output is rather for the last lines, ie symbolic input, which should produce symbolic output. It does, by wrapping FP infinity into SR. It would be better if that would rather produce the infinity from the ring.



---

archive/issue_comments_343492.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,3 +19,4 @@\n <type 'sage.symbolic.expression.Expression'>\n ```\n \n+Additionally, evaluating the beta function at poles returns `NaN` rather than unsigned infinity.\n``````\n",
    "created_at": "2016-07-27T20:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343492",
    "user": "https://github.com/paulmasson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,3 +19,4 @@
 <type 'sage.symbolic.expression.Expression'>
 ```
 
+Additionally, evaluating the beta function at poles returns `NaN` rather than unsigned infinity.
``````




---

archive/issue_events_068799.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "rename": {
        "from": "Different infinities returned by zeta/polylog",
        "to": "Convert FP subpackage infinities and NaNs to ring inifinities and symbolic NaN"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68799"
}
```



---

archive/issue_comments_343493.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,4 +19,4 @@\n <type 'sage.symbolic.expression.Expression'>\n ```\n \n-Additionally, evaluating the beta function at poles returns `NaN` rather than unsigned infinity.\n+These are mpmath infinities. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.\n``````\n",
    "created_at": "2016-08-17T07:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343493",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,4 +19,4 @@
 <type 'sage.symbolic.expression.Expression'>
 ```
 
-Additionally, evaluating the beta function at poles returns `NaN` rather than unsigned infinity.
+These are mpmath infinities. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.
``````




---

archive/issue_events_068800.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-17T07:45:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68800"
}
```



---

archive/issue_events_068801.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-17T07:45:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68801"
}
```



---

archive/issue_comments_343494.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,4 +19,4 @@\n <type 'sage.symbolic.expression.Expression'>\n ```\n \n-These are mpmath infinities. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.\n+These are MPFR infinities, mpmath may do this too. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.\n``````\n",
    "created_at": "2016-08-17T07:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343494",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,4 +19,4 @@
 <type 'sage.symbolic.expression.Expression'>
 ```
 
-These are mpmath infinities. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.
+These are MPFR infinities, mpmath may do this too. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.
``````




---

archive/issue_events_068802.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-18T08:10:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68802"
}
```



---

archive/issue_events_068803.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-18T08:10:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68803"
}
```



---

archive/issue_comments_343495.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,22 +1,36 @@\n-The type of return value of some functions (`polylog`, `zeta`) is inconsistent:\n+It seems in some cases the infinities returned from mpmath need to be changed by the function's `evalf()` in order to be correct:\n+Before:\n \n ```\n-sage: zeta(1)\n+sage: zeta(SR(1))\n Infinity\n-sage: zeta(1.)\n+sage: zeta(SR(1.))   <---------\n +infinity\n-sage: polylog(1,1)\n-Infinity\n-sage: polylog(1.,1.)\n-+infinity\n-sage: type(_)\n+sage: type(zeta(SR(1)))\n+<type 'sage.symbolic.expression.Expression'>\n+sage: type(zeta(SR(1)).pyobject())\n+<class 'sage.rings.infinity.UnsignedInfinity'>\n+sage: type(zeta(SR(1.)))\n+<type 'sage.symbolic.expression.Expression'>\n+sage: type(zeta(SR(1.)).pyobject())\n <type 'sage.rings.real_mpfr.RealNumber'>\n-sage: polylog(SR(1.),SR(1.))\n-+infinity\n-sage: zeta(SR(1.))\n-+infinity\n-sage: type(_)\n-<type 'sage.symbolic.expression.Expression'>\n ```\n \n-These are MPFR infinities, mpmath may do this too. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.\n+The ticket should result in:\n+\n+```\n+sage: zeta(SR(1))\n+Infinity\n+sage: zeta(SR(1.))\n+Infinity\n+sage: type(zeta(SR(1)))\n+<type 'sage.symbolic.expression.Expression'>\n+sage: type(zeta(SR(1)).pyobject())\n+<class 'sage.rings.infinity.UnsignedInfinity'>\n+sage: type(zeta(SR(1.)))\n+<type 'sage.symbolic.expression.Expression'>\n+sage: type(zeta(SR(1.)).pyobject())\n+<class 'sage.rings.infinity.UnsignedInfinity'>\n+```\n+\n+Ideally, fix other such cases too in this ticket.\n``````\n",
    "created_at": "2017-04-18T08:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343495",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,22 +1,36 @@
-The type of return value of some functions (`polylog`, `zeta`) is inconsistent:
+It seems in some cases the infinities returned from mpmath need to be changed by the function's `evalf()` in order to be correct:
+Before:
 
 ```
-sage: zeta(1)
+sage: zeta(SR(1))
 Infinity
-sage: zeta(1.)
+sage: zeta(SR(1.))   <---------
 +infinity
-sage: polylog(1,1)
-Infinity
-sage: polylog(1.,1.)
-+infinity
-sage: type(_)
+sage: type(zeta(SR(1)))
+<type 'sage.symbolic.expression.Expression'>
+sage: type(zeta(SR(1)).pyobject())
+<class 'sage.rings.infinity.UnsignedInfinity'>
+sage: type(zeta(SR(1.)))
+<type 'sage.symbolic.expression.Expression'>
+sage: type(zeta(SR(1.)).pyobject())
 <type 'sage.rings.real_mpfr.RealNumber'>
-sage: polylog(SR(1.),SR(1.))
-+infinity
-sage: zeta(SR(1.))
-+infinity
-sage: type(_)
-<type 'sage.symbolic.expression.Expression'>
 ```
 
-These are MPFR infinities, mpmath may do this too. In #18386 the same problem with arb comes up. As an exception to the what-goes-in-goes-out rule they should be converted upon return to elements of the infinity ring. The conversion should additionally convert all FP NaNs to the symbolic constant NaN.
+The ticket should result in:
+
+```
+sage: zeta(SR(1))
+Infinity
+sage: zeta(SR(1.))
+Infinity
+sage: type(zeta(SR(1)))
+<type 'sage.symbolic.expression.Expression'>
+sage: type(zeta(SR(1)).pyobject())
+<class 'sage.rings.infinity.UnsignedInfinity'>
+sage: type(zeta(SR(1.)))
+<type 'sage.symbolic.expression.Expression'>
+sage: type(zeta(SR(1.)).pyobject())
+<class 'sage.rings.infinity.UnsignedInfinity'>
+```
+
+Ideally, fix other such cases too in this ticket.
``````




---

archive/issue_events_068804.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "rename": {
        "from": "Convert FP subpackage infinities and NaNs to ring inifinities and symbolic NaN",
        "to": "Corrections to infinities returned by mpmath"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68804"
}
```



---

archive/issue_comments_343496.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/corrections_to_infinities_returned_by_mpmath\"",
    "created_at": "2017-04-19T06:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343496",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/corrections_to_infinities_returned_by_mpmath"



---

archive/issue_comments_343497.json:
```json
{
    "body": "<a id='comment:10'></a>\nNew commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[5d2d860](https://github.com/sagemath/sagetrac-mirror/commit/5d2d8604975fb8bd16159720ed3f45296ff88210)|`19439: Corrections to infinities returned by mpmath`|",
    "created_at": "2017-04-19T06:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343497",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[5d2d860](https://github.com/sagemath/sagetrac-mirror/commit/5d2d8604975fb8bd16159720ed3f45296ff88210)|`19439: Corrections to infinities returned by mpmath`|



---

archive/issue_comments_343498.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2017-04-19T06:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343498",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_343499.json:
```json
{
    "body": "Changing dependencies from \"\" to \"pynac-0.7.6\"",
    "created_at": "2017-04-19T06:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343499",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "pynac-0.7.6"



---

archive/issue_comments_343500.json:
```json
{
    "body": "Changing commit from \"\" to \"5d2d8604975fb8bd16159720ed3f45296ff88210\"",
    "created_at": "2017-04-19T06:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343500",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "5d2d8604975fb8bd16159720ed3f45296ff88210"



---

archive/issue_comments_343501.json:
```json
{
    "body": "Changing dependencies from \"pynac-0.7.6\" to \"#22838\"",
    "created_at": "2017-04-20T08:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343501",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "pynac-0.7.6" to "#22838"



---

archive/issue_comments_343502.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-20T08:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343502",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_343503.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-20T13:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343503",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343504.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2017-04-20T13:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343504",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_343505.json:
```json
{
    "body": "<a id='comment:12'></a>\nLGTM.",
    "created_at": "2017-04-20T13:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343505",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
LGTM.



---

archive/issue_comments_343506.json:
```json
{
    "body": "Changing branch from \"u/rws/corrections_to_infinities_returned_by_mpmath\" to \"5d2d8604975fb8bd16159720ed3f45296ff88210\"",
    "created_at": "2017-04-28T23:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343506",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/rws/corrections_to_infinities_returned_by_mpmath" to "5d2d8604975fb8bd16159720ed3f45296ff88210"



---

archive/issue_events_068805.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-28T23:54:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19439#event-68805"
}
```



---

archive/issue_comments_343507.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-28T23:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19439#issuecomment-343507",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
