# Issue 19695: Remove duplicate code in cachefunc.pyx

archive/issues_019458.json:
```json
{
    "body": "There is a lot of duplicate code in the `CachedFunction` and `WeakCachedFunction` types. Several methods are literally copied, with the only difference that `CachedFunction` uses `<dict>self.cache` while `WeakCachedFunction` uses `self.cache`.\n\nThe speed gain of using `<dict>self.cache` instead of `self.cache` is so tiny that it doesn't justify the code duplication. In the light of future optimizations to `CachedFunction`, it is better to remove this duplicate code.\n\nBranch/Commit: 75002e6a8b33c4188e21fa0968bb2a1f5fb2c627\n\nReviewer: Julian R\u00fcth\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19695\n\n",
    "closed_at": "2015-12-22T19:49:37Z",
    "created_at": "2015-12-12T14:53:36Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Remove duplicate code in cachefunc.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19695",
    "user": "https://github.com/jdemeyer"
}
```
There is a lot of duplicate code in the `CachedFunction` and `WeakCachedFunction` types. Several methods are literally copied, with the only difference that `CachedFunction` uses `<dict>self.cache` while `WeakCachedFunction` uses `self.cache`.

The speed gain of using `<dict>self.cache` instead of `self.cache` is so tiny that it doesn't justify the code duplication. In the light of future optimizations to `CachedFunction`, it is better to remove this duplicate code.

Branch/Commit: 75002e6a8b33c4188e21fa0968bb2a1f5fb2c627

Reviewer: Julian Rüth

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19695





---

archive/issue_comments_354195.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/ticket/19695\"",
    "created_at": "2015-12-12T14:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354195",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/ticket/19695"



---

archive/issue_comments_354196.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-12T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354196",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354197.json:
```json
{
    "body": "Changing commit from \"\" to \"75002e6a8b33c4188e21fa0968bb2a1f5fb2c627\"",
    "created_at": "2015-12-12T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354197",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "75002e6a8b33c4188e21fa0968bb2a1f5fb2c627"



---

archive/issue_comments_354198.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2015-12-12T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354198",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_354199.json:
```json
{
    "body": "<a id='comment:3'></a>The description is not quite clear to me, so I am not sure what to look at in the code. What exactly were the purposes of two classes, which one should be gone, and should the class be gone eventually or just some methods?",
    "created_at": "2015-12-15T03:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354199",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:3'></a>The description is not quite clear to me, so I am not sure what to look at in the code. What exactly were the purposes of two classes, which one should be gone, and should the class be gone eventually or just some methods?



---

archive/issue_comments_354200.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-There is a lot of duplicate code in the `CachedFunction` and `WeakCachedFunction` types. The version of `CachedFunction` uses `<dict>self.cache` typing, but the speed gain is so tiny that it doesn't justify the code duplication. In the light of future optimizations to `CachedFunction`, it is better to remove this duplicate code.\n+There is a lot of duplicate code in the `CachedFunction` and `WeakCachedFunction` types. Several methods are literally copied, with the only difference that `CachedFunction` uses `<dict>self.cache` while `WeakCachedFunction` uses `self.cache`.\n+\n+The speed gain of using `<dict>self.cache` instead of `self.cache` is so tiny that it doesn't justify the code duplication. In the light of future optimizations to `CachedFunction`, it is better to remove this duplicate code.\n``````\n",
    "created_at": "2015-12-15T22:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354200",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-There is a lot of duplicate code in the `CachedFunction` and `WeakCachedFunction` types. The version of `CachedFunction` uses `<dict>self.cache` typing, but the speed gain is so tiny that it doesn't justify the code duplication. In the light of future optimizations to `CachedFunction`, it is better to remove this duplicate code.
+There is a lot of duplicate code in the `CachedFunction` and `WeakCachedFunction` types. Several methods are literally copied, with the only difference that `CachedFunction` uses `<dict>self.cache` while `WeakCachedFunction` uses `self.cache`.
+
+The speed gain of using `<dict>self.cache` instead of `self.cache` is so tiny that it doesn't justify the code duplication. In the light of future optimizations to `CachedFunction`, it is better to remove this duplicate code.
``````




---

archive/issue_comments_354201.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 novoselt]:\n> The description is not quite clear to me, so I am not sure what to look at in the code. What exactly were the purposes of two classes, which one should be gone, and should the class be gone eventually or just some methods?\n\n\nNo, the class should not be gone. The two classes are `CachedFunction` and `WeakCachedFunction` which are exactly the same except for the type of `self.cache`. The two classes are both useful.",
    "created_at": "2015-12-15T22:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354201",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Replying to [comment:3 novoselt]:
> The description is not quite clear to me, so I am not sure what to look at in the code. What exactly were the purposes of two classes, which one should be gone, and should the class be gone eventually or just some methods?


No, the class should not be gone. The two classes are `CachedFunction` and `WeakCachedFunction` which are exactly the same except for the type of `self.cache`. The two classes are both useful.



---

archive/issue_comments_354202.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-17T04:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354202",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_354203.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Julian R\u00fcth\"",
    "created_at": "2015-12-17T04:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354203",
    "user": "https://github.com/saraedum"
}
```

Changing reviewer from "" to "Julian Rüth"



---

archive/issue_comments_354204.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/19695\" to \"75002e6a8b33c4188e21fa0968bb2a1f5fb2c627\"",
    "created_at": "2015-12-22T19:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354204",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/ticket/19695" to "75002e6a8b33c4188e21fa0968bb2a1f5fb2c627"



---

archive/issue_comments_354205.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-22T19:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19695#issuecomment-354205",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054056.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-22T19:49:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19695",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19695#event-54056"
}
```
