# Issue 19831: Add random_element() for cones

archive/issues_019594.json:
```json
{
    "body": "For testing and demonstration it's sometimes useful to be able to get \"any\" element of a cone. Other structures use `random_element` for the same purpose.\n\n\nCC:  @novoselt\n\nBranch/Commit: 690071f972423a123b07b0b7d6051ec25e335cb7\n\nReviewer: Andrey Novoseltsev\n\nAuthor: Michael Orlitzky\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19831\n\n",
    "closed_at": "2016-01-12T17:03:30Z",
    "created_at": "2016-01-04T17:04:09Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Add random_element() for cones",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19831",
    "user": "https://github.com/orlitzky"
}
```
For testing and demonstration it's sometimes useful to be able to get "any" element of a cone. Other structures use `random_element` for the same purpose.


CC:  @novoselt

Branch/Commit: 690071f972423a123b07b0b7d6051ec25e335cb7

Reviewer: Andrey Novoseltsev

Author: Michael Orlitzky

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19831





---

archive/issue_comments_286517.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2016-01-04T17:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286517",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_286518.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-04T17:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286518",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286519.json:
```json
{
    "body": "<a id='comment:2'></a>In the end comment \"coercion\" is not the right word - it is what happens automatically when mixing objects. Explicit one is \"conversion\".\n\nI am a bit unsure about rationality. Seems like returning a random element of the lattice would be more natural and those who want can then scale by a rational or even real factor. Or there could be an optional parameter for this, defaulting to all integral weights?",
    "created_at": "2016-01-05T04:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286519",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>In the end comment "coercion" is not the right word - it is what happens automatically when mixing objects. Explicit one is "conversion".

I am a bit unsure about rationality. Seems like returning a random element of the lattice would be more natural and those who want can then scale by a rational or even real factor. Or there could be an optional parameter for this, defaulting to all integral weights?



---

archive/issue_comments_286520.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-05T14:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286521.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:2 novoselt]:\n> I am a bit unsure about rationality. Seems like returning a random element of the lattice would be more natural and those who want can then scale by a rational or even real factor.\n\n\nThis wouldn't be too bad but it makes all of my uses of it ugly. Each invocation is `K.random_element()` versus `QQ.random_element().abs()*vector(K.random_element())`.\n\nI'm using rationals because some of the properties I'm testing involve norms (say, in a denominator) where you really want to test a value between zero and one.\n\n> Or there could be an optional parameter for this, defaulting to all integral weights?\n\n\nThis would be no problem, but how should the return type work? If we use integral weights we could return a lattice element but with any other field it would have to be a vector.",
    "created_at": "2016-01-05T14:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286521",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>Replying to [comment:2 novoselt]:
> I am a bit unsure about rationality. Seems like returning a random element of the lattice would be more natural and those who want can then scale by a rational or even real factor.


This wouldn't be too bad but it makes all of my uses of it ugly. Each invocation is `K.random_element()` versus `QQ.random_element().abs()*vector(K.random_element())`.

I'm using rationals because some of the properties I'm testing involve norms (say, in a denominator) where you really want to test a value between zero and one.

> Or there could be an optional parameter for this, defaulting to all integral weights?


This would be no problem, but how should the return type work? If we use integral weights we could return a lattice element but with any other field it would have to be a vector.



---

archive/issue_comments_286522.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 mjo]:\n> Replying to [comment:2 novoselt]:\n> > Or there could be an optional parameter for this, defaulting to all integral weights?\n\n> \n> This would be no problem, but how should the return type work? If we use integral weights we could return a lattice element but with any other field it would have to be a vector.\n\n\nI definitely would like to get an appropriate lattice element for (default) integral weights and with anything else a vector is fine, that's consistent with other places that attempt to work with lattices but fall back to generic vectors/modules when this is not possible/implemented.",
    "created_at": "2016-01-07T05:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286522",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>Replying to [comment:4 mjo]:
> Replying to [comment:2 novoselt]:
> > Or there could be an optional parameter for this, defaulting to all integral weights?

> 
> This would be no problem, but how should the return type work? If we use integral weights we could return a lattice element but with any other field it would have to be a vector.


I definitely would like to get an appropriate lattice element for (default) integral weights and with anything else a vector is fine, that's consistent with other places that attempt to work with lattices but fall back to generic vectors/modules when this is not possible/implemented.



---

archive/issue_comments_286523.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-07T16:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286523",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286524.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 novoselt]:\n> I definitely would like to get an appropriate lattice element for (default) integral weights and with anything else a vector is fine, that's consistent with other places that attempt to work with lattices but fall back to generic vectors/modules when this is not possible/implemented.\n\n\nThat works for me; it only adds two characters to most invocations.\n\nI decided to limit the possible choices to `ZZ`/`QQ` for a few reasons. First, for \"nonnegative\" to make any sense, we need to have a subthing of `RR`. But `RR.is_subring(RR)` doesn't work, and more importantly, the resulting elements don't live in either the cone's lattice or its ambient vector space. That means matrix multiplication (on the ambient space) might crash even though `K.contains(x)` still returns `True`.\n\nMaybe it makes more sense to have e.g. `latticial=True` instead of `ring=ZZ` when there are only two choices (ambient lattice or ambient vector space)?",
    "created_at": "2016-01-07T16:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286524",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>Replying to [comment:5 novoselt]:
> I definitely would like to get an appropriate lattice element for (default) integral weights and with anything else a vector is fine, that's consistent with other places that attempt to work with lattices but fall back to generic vectors/modules when this is not possible/implemented.


That works for me; it only adds two characters to most invocations.

I decided to limit the possible choices to `ZZ`/`QQ` for a few reasons. First, for "nonnegative" to make any sense, we need to have a subthing of `RR`. But `RR.is_subring(RR)` doesn't work, and more importantly, the resulting elements don't live in either the cone's lattice or its ambient vector space. That means matrix multiplication (on the ambient space) might crash even though `K.contains(x)` still returns `True`.

Maybe it makes more sense to have e.g. `latticial=True` instead of `ring=ZZ` when there are only two choices (ambient lattice or ambient vector space)?



---

archive/issue_comments_286525.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mjo]:\n> Maybe it makes more sense to have e.g. `latticial=True` instead of `ring=ZZ` when there are only two choices (ambient lattice or ambient vector space)?\n\nThat's the first time I hear such a word ;-) In the toric geometry cones live in real vector spaces. The fact that Sage associates a rational and not real one to free modules is just the way how Sage is, in part due to technical reasons of working with reals on computers, I guess. In any case there is no reason why eventually we can't accept any kind of real field with different precision or perhaps some other subrings. So I am more in favour of `NotImplementedError` rather than `ValueError` since `RR`, `RDF` etc are very sensible choices.",
    "created_at": "2016-01-08T03:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286525",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>Replying to [comment:7 mjo]:
> Maybe it makes more sense to have e.g. `latticial=True` instead of `ring=ZZ` when there are only two choices (ambient lattice or ambient vector space)?

That's the first time I hear such a word ;-) In the toric geometry cones live in real vector spaces. The fact that Sage associates a rational and not real one to free modules is just the way how Sage is, in part due to technical reasons of working with reals on computers, I guess. In any case there is no reason why eventually we can't accept any kind of real field with different precision or perhaps some other subrings. So I am more in favour of `NotImplementedError` rather than `ValueError` since `RR`, `RDF` etc are very sensible choices.



---

archive/issue_comments_286526.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-08T04:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286527.json:
```json
{
    "body": "<a id='comment:10'></a>I made up the word, but it sounds very official =P\n\n`NotImplementedError` is fine with me. My cones are real, too, but nothing works when we use floating point numbers.",
    "created_at": "2016-01-08T04:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286527",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'></a>I made up the word, but it sounds very official =P

`NotImplementedError` is fine with me. My cones are real, too, but nothing works when we use floating point numbers.



---

archive/issue_comments_286528.json:
```json
{
    "body": "<a id='comment:11'></a>Thank you!",
    "created_at": "2016-01-11T00:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286528",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:11'></a>Thank you!



---

archive/issue_comments_286529.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-11T00:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286529",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_054250.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-12T17:03:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19831#event-54250"
}
```



---

archive/issue_comments_286530.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-12T17:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19831#issuecomment-286530",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
