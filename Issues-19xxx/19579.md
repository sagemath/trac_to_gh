# Issue 19579: AlarmInterrupt in sage.rings.integer.Integer.divisors

archive/issues_019579.json:
```json
{
    "body": "CC:  @videlec\n\nReported at https://groups.google.com/d/msg/sage-release/KrpyE8h-UO4/oW9r8EeKCQAJ\n\n```\n./sage -t src/sage/rings/integer.pyx\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2015-12-31-11-59-48-9f43f0a3.\nGit branch: develop\nUsing --optional=mpir,python2,sage\nDoctesting 1 file.\nsage -t src/sage/rings/integer.pyx\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 2622, in sage.rings.integer.Integer.divisors\nFailed example:\n    6.divisors()\nException raised:\n    Traceback (most recent call last):\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.integer.Integer.divisors[1]>\", line 1, in <module>\n        Integer(6).divisors()\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 745, in displayhook\n        plain_text, rich_output = self._rich_output_formatter(obj, dict())\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 610, in _rich_output_formatter\n        plain_text = self._backend.plain_text_formatter(obj, **rich_repr_kwds)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py\", line 305, in plain_text_formatter\n        plain_text = self._apply_pretty_printer(SagePrettyPrinter, obj)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py\", line 250, in _apply_pretty_printer\n        printer.pretty(obj)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/pretty_print.py\", line 147, in pretty\n        ok = representation(obj, self, cycle)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/fancy_repr.py\", line 157, in __call__\n        pretty_repr(obj, p, cycle)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.py\", line 550, in inner\n        p.text(',')\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.py\", line 211, in text\n        self.output.write(obj)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python/StringIO.py\", line 213, in write\n        _complain_ifclosed(self.closed)\n      File \"sage/ext/interrupt/interrupt.pyx\", line 204, in sage.ext.interrupt.interrupt.sage_python_check_interrupt (/64bitdev/storage/sage-git_develop/sage/src/build/cythonized/sage/ext/interrupt/interrupt.c:1904)\n        sig_check()\n      File \"sage/ext/interrupt/interrupt.pyx\", line 91, in sage.ext.interrupt.interrupt.sig_raise_exception (/64bitdev/storage/sage-git_develop/sage/src/build/cythonized/sage/ext/interrupt/interrupt.c:970)\n        raise AlarmInterrupt\n    AlarmInterrupt\n**********************************************************************\n1 item had failures:\n   1 of  21 in sage.rings.integer.Integer.divisors\n    [1055 tests, 1 failure, 11.65 s]\n----------------------------------------------------------------------\nsage -t src/sage/rings/integer.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 12.2 seconds\n    cpu time: 5.2 seconds\n    cumulative wall time: 11.6 seconds\n```\nThis is because the preceeding doctest\n\n```\n            sage: n = prod(primes_first_n(9))\n            sage: try:\n            ....:     alarm(1e-5)\n            ....:     _ = n._pari_divisors_small()\n            ....: except AlarmInterrupt:\n            ....:     pass\n```\nis too quick and does not catch the alarm\n\nIssue created by migration from https://trac.sagemath.org/ticket/19816\n\n",
    "closed_at": "2016-01-02T19:14:10Z",
    "created_at": "2015-12-31T19:31:19Z",
    "labels": [
        "component: number theory",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "AlarmInterrupt in sage.rings.integer.Integer.divisors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19579",
    "user": "https://github.com/vbraun"
}
```
CC:  @videlec

Reported at https://groups.google.com/d/msg/sage-release/KrpyE8h-UO4/oW9r8EeKCQAJ

```
./sage -t src/sage/rings/integer.pyx
too many failed tests, not using stored timings
Running doctests with ID 2015-12-31-11-59-48-9f43f0a3.
Git branch: develop
Using --optional=mpir,python2,sage
Doctesting 1 file.
sage -t src/sage/rings/integer.pyx
**********************************************************************
File "src/sage/rings/integer.pyx", line 2622, in sage.rings.integer.Integer.divisors
Failed example:
    6.divisors()
Exception raised:
    Traceback (most recent call last):
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer.divisors[1]>", line 1, in <module>
        Integer(6).divisors()
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 745, in displayhook
        plain_text, rich_output = self._rich_output_formatter(obj, dict())
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 610, in _rich_output_formatter
        plain_text = self._backend.plain_text_formatter(obj, **rich_repr_kwds)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 305, in plain_text_formatter
        plain_text = self._apply_pretty_printer(SagePrettyPrinter, obj)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 250, in _apply_pretty_printer
        printer.pretty(obj)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/pretty_print.py", line 147, in pretty
        ok = representation(obj, self, cycle)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/fancy_repr.py", line 157, in __call__
        pretty_repr(obj, p, cycle)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.py", line 550, in inner
        p.text(',')
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.py", line 211, in text
        self.output.write(obj)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python/StringIO.py", line 213, in write
        _complain_ifclosed(self.closed)
      File "sage/ext/interrupt/interrupt.pyx", line 204, in sage.ext.interrupt.interrupt.sage_python_check_interrupt (/64bitdev/storage/sage-git_develop/sage/src/build/cythonized/sage/ext/interrupt/interrupt.c:1904)
        sig_check()
      File "sage/ext/interrupt/interrupt.pyx", line 91, in sage.ext.interrupt.interrupt.sig_raise_exception (/64bitdev/storage/sage-git_develop/sage/src/build/cythonized/sage/ext/interrupt/interrupt.c:970)
        raise AlarmInterrupt
    AlarmInterrupt
**********************************************************************
1 item had failures:
   1 of  21 in sage.rings.integer.Integer.divisors
    [1055 tests, 1 failure, 11.65 s]
----------------------------------------------------------------------
sage -t src/sage/rings/integer.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 12.2 seconds
    cpu time: 5.2 seconds
    cumulative wall time: 11.6 seconds
```
This is because the preceeding doctest

```
            sage: n = prod(primes_first_n(9))
            sage: try:
            ....:     alarm(1e-5)
            ....:     _ = n._pari_divisors_small()
            ....: except AlarmInterrupt:
            ....:     pass
```
is too quick and does not catch the alarm

Issue created by migration from https://trac.sagemath.org/ticket/19816





---

archive/issue_comments_268663.json:
```json
{
    "body": "I would remove the doctest. The number in the doctest is not the one with the most divisors, but even computing the divisors of 2095133040 (*) only takes about 1e-4 seconds.\n\n(*) Exercise: of all numbers less than 2<sup>31</sup>, the number 2095133040 has the maximal number of divisors, namely 1600.",
    "created_at": "2016-01-02T12:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19579#issuecomment-268663",
    "user": "https://github.com/jdemeyer"
}
```

I would remove the doctest. The number in the doctest is not the one with the most divisors, but even computing the divisors of 2095133040 (*) only takes about 1e-4 seconds.

(*) Exercise: of all numbers less than 2<sup>31</sup>, the number 2095133040 has the maximal number of divisors, namely 1600.



---

archive/issue_comments_268664.json:
```json
{
    "body": "+1\n\nThe doctests probably should always have `alarm` / `cancel_alarm` pairs to avoid such non-local effects, though that would be material for another ticket.",
    "created_at": "2016-01-02T12:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19579#issuecomment-268664",
    "user": "https://github.com/vbraun"
}
```

+1

The doctests probably should always have `alarm` / `cancel_alarm` pairs to avoid such non-local effects, though that would be material for another ticket.



---

archive/issue_comments_268665.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-02T13:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19579#issuecomment-268665",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_268666.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-01-02T13:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19579#issuecomment-268666",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_268667.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2016-01-02T13:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19579#issuecomment-268667",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_268668.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-02T14:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19579#issuecomment-268668",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_268669.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-02T19:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19579#issuecomment-268669",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054222.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-02T19:14:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19579",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19579#event-54222"
}
```
