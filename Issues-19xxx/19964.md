# Issue 19964: tight complex interval inverse

archive/issues_019727.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThe current method to compute the multiplicative inverse of a complex interval uses schoolbok formula that produces intervals much bigger than the actual result.\n\nThis ticket implements a method that produces a tight interval enclosure of the result.\n\nAs a result, we get better precission in root isolating methods (and hence, less steps needed).\n\n\nHere are some examples that illustrate the impact of the changes:\n\nOld behaviour:\n\n\n```\nsage: a = CIF((1, 2), (3, 4))\nsage: a.real().lower(), a.real().upper()\n(1.00000000000000, 2.00000000000000)\nsage: a = CIF((1, 2), (3, 4))\nsage: b = a.__invert__()\nsage: b.real().lower(), b.real().upper()\n(0.0499999999999999, 0.200000000000001)\nsage: b.imag().lower(), b.imag().upper()\n(-0.400000000000001, -0.149999999999999)\nsage: b.diameter()\n1.20000000000000\nsage: %time a.__invert__()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 23.1 \u00b5s\n1.? - 1.?*I\n```\n\n\nnew behaviour:\n\n\n```\nsage: a = CIF((1, 2), (3, 4))\nsage: a.real().lower(), a.real().upper()\n(1.00000000000000, 2.00000000000000)\nsage: b = a.__invert__()\nsage: b.real().lower(), b.real().upper()\n(0.0588235294117647, 0.153846153846154)\nsage: b.imag().lower(), b.imag().upper()\n(-0.300000000000001, -0.200000000000000)\nsage: b.diameter()\n0.893617021276596\nsage: %time a.__invert__()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 19.1 \u00b5s\n0.1? - 0.3?*I\n```\n\n\nAnother example with a smaller interval,\n\nold:\n\n```\nsage: a = CIF((5, 5.01), (7, 7.01))\nsage: b = a.__invert__()\nsage: b.diameter()\n0.00523867991752868\nsage: b.real().lower(), b.real().upper()\n(0.0673489564952680, 0.0677027027027028)\nsage: b.imag().lower(), b.imag().upper()\n(-0.0947297297297298, -0.0942885390933752)\nsage: %time a.__invert__()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 23.1 \u00b5s\n-0.068? - 0.095?*I\n```\n\nnew:\n\n```\nsage: a = CIF((5, 5.01), (7, 7.01))\nsage: b = a.__invert__()\nsage: b.diameter()\n0.00253766599329326\nsage: b.real().lower(), b.real().upper()\n(0.0674398874563158, 0.0676112447891434)\nsage: b.imag().lower(), b.imag().upper()\n(-0.0945945945945946, -0.0944232370063658)\nsage: a = CIF((-5.01, -5), (7, 7.01))\nsage: %time a.__invert__()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 49.1 \u00b5s\n-0.068? - 0.0945?*I\n```\n\nAs you can see, the diameter of the result can easily get cut to half or even smaller.\n\nThe timings of the inversion can vary, but they remain in the same order of magnitude as before. It has a noticeable effect in root isolation:\n\nold:\n\n```\nsage: R.<x> = QQ[]\nsage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9\nsage: %time f.roots(CC)\nCPU times: user 6 ms, sys: 0 ns, total: 6 ms\nWall time: 5.34 ms\n[(-1.03157268729039, 1),\n (-1.18964736821330 - 0.850802715570186*I, 1),\n (-1.18964736821330 + 0.850802715570186*I, 1),\n (0.0780792982605128 - 1.39288589462175*I, 1),\n (0.0780792982605128 + 1.39288589462175*I, 1),\n (1.19878298502655 - 0.599304323571307*I, 1),\n (1.19878298502655 + 0.599304323571307*I, 1)]\nsage: %time f.roots(QQbar)\nCPU times: user 17 ms, sys: 0 ns, total: 17 ms\nWall time: 15.7 ms\n[(-1.031572687290387?, 1),\n (-1.189647368213303? - 0.8508027155701860?*I, 1),\n (-1.189647368213303? + 0.8508027155701860?*I, 1),\n (0.07807929826051275? - 1.392885894621755?*I, 1),\n (0.07807929826051275? + 1.392885894621755?*I, 1),\n (1.198782985026555? - 0.5993043235713073?*I, 1),\n (1.198782985026555? + 0.5993043235713073?*I, 1)]\n```\n\nnew:\n\n```\nsage: R.<x>=QQ[]\nsage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9\nsage: %time f.roots(CC)\nCPU times: user 4 ms, sys: 0 ns, total: 4 ms\nWall time: 3.28 ms\n[(-1.03157268729039, 1),\n (-1.18964736821330 - 0.850802715570186*I, 1),\n (-1.18964736821330 + 0.850802715570186*I, 1),\n (0.0780792982605128 - 1.39288589462175*I, 1),\n (0.0780792982605128 + 1.39288589462175*I, 1),\n (1.19878298502655 - 0.599304323571307*I, 1),\n (1.19878298502655 + 0.599304323571307*I, 1)]\nsage: %time f.roots(QQbar)\nCPU times: user 9 ms, sys: 1 ms, total: 10 ms\nWall time: 9.3 ms\n[(-1.031572687290387?, 1),\n (-1.189647368213303? - 0.8508027155701860?*I, 1),\n (-1.189647368213303? + 0.8508027155701860?*I, 1),\n (0.07807929826051275? - 1.392885894621755?*I, 1),\n (0.07807929826051275? + 1.392885894621755?*I, 1),\n (1.198782985026555? - 0.5993043235713073?*I, 1),\n (1.198782985026555? + 0.5993043235713073?*I, 1)]\n```\n\nCC:  @tscrim @videlec @dkrenn @jdemeyer @sagetrac-tmonteil @cheuberg\n\nComponent: **numerical**\n\nKeywords: **interval, root**\n\nAuthor: **Miguel Marco**\n\nBranch: **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)**\n\nReviewer: **Vincent Delecroix, Marc Mezzarobba**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19964_\n\n",
    "closed_at": "2016-04-13T17:05:18Z",
    "created_at": "2016-01-26T15:47:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20numerical",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "tight complex interval inverse",
    "type": "issue",
    "updated_at": "2017-04-20T08:51:17Z",
    "url": "https://github.com/sagemath/sage/issues/19964",
    "user": "https://github.com/miguelmarco"
}
```
<div id="comment:0"></div>

The current method to compute the multiplicative inverse of a complex interval uses schoolbok formula that produces intervals much bigger than the actual result.

This ticket implements a method that produces a tight interval enclosure of the result.

As a result, we get better precission in root isolating methods (and hence, less steps needed).


Here are some examples that illustrate the impact of the changes:

Old behaviour:


```
sage: a = CIF((1, 2), (3, 4))
sage: a.real().lower(), a.real().upper()
(1.00000000000000, 2.00000000000000)
sage: a = CIF((1, 2), (3, 4))
sage: b = a.__invert__()
sage: b.real().lower(), b.real().upper()
(0.0499999999999999, 0.200000000000001)
sage: b.imag().lower(), b.imag().upper()
(-0.400000000000001, -0.149999999999999)
sage: b.diameter()
1.20000000000000
sage: %time a.__invert__()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 23.1 µs
1.? - 1.?*I
```


new behaviour:


```
sage: a = CIF((1, 2), (3, 4))
sage: a.real().lower(), a.real().upper()
(1.00000000000000, 2.00000000000000)
sage: b = a.__invert__()
sage: b.real().lower(), b.real().upper()
(0.0588235294117647, 0.153846153846154)
sage: b.imag().lower(), b.imag().upper()
(-0.300000000000001, -0.200000000000000)
sage: b.diameter()
0.893617021276596
sage: %time a.__invert__()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 19.1 µs
0.1? - 0.3?*I
```


Another example with a smaller interval,

old:

```
sage: a = CIF((5, 5.01), (7, 7.01))
sage: b = a.__invert__()
sage: b.diameter()
0.00523867991752868
sage: b.real().lower(), b.real().upper()
(0.0673489564952680, 0.0677027027027028)
sage: b.imag().lower(), b.imag().upper()
(-0.0947297297297298, -0.0942885390933752)
sage: %time a.__invert__()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 23.1 µs
-0.068? - 0.095?*I
```

new:

```
sage: a = CIF((5, 5.01), (7, 7.01))
sage: b = a.__invert__()
sage: b.diameter()
0.00253766599329326
sage: b.real().lower(), b.real().upper()
(0.0674398874563158, 0.0676112447891434)
sage: b.imag().lower(), b.imag().upper()
(-0.0945945945945946, -0.0944232370063658)
sage: a = CIF((-5.01, -5), (7, 7.01))
sage: %time a.__invert__()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 49.1 µs
-0.068? - 0.0945?*I
```

As you can see, the diameter of the result can easily get cut to half or even smaller.

The timings of the inversion can vary, but they remain in the same order of magnitude as before. It has a noticeable effect in root isolation:

old:

```
sage: R.<x> = QQ[]
sage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9
sage: %time f.roots(CC)
CPU times: user 6 ms, sys: 0 ns, total: 6 ms
Wall time: 5.34 ms
[(-1.03157268729039, 1),
 (-1.18964736821330 - 0.850802715570186*I, 1),
 (-1.18964736821330 + 0.850802715570186*I, 1),
 (0.0780792982605128 - 1.39288589462175*I, 1),
 (0.0780792982605128 + 1.39288589462175*I, 1),
 (1.19878298502655 - 0.599304323571307*I, 1),
 (1.19878298502655 + 0.599304323571307*I, 1)]
sage: %time f.roots(QQbar)
CPU times: user 17 ms, sys: 0 ns, total: 17 ms
Wall time: 15.7 ms
[(-1.031572687290387?, 1),
 (-1.189647368213303? - 0.8508027155701860?*I, 1),
 (-1.189647368213303? + 0.8508027155701860?*I, 1),
 (0.07807929826051275? - 1.392885894621755?*I, 1),
 (0.07807929826051275? + 1.392885894621755?*I, 1),
 (1.198782985026555? - 0.5993043235713073?*I, 1),
 (1.198782985026555? + 0.5993043235713073?*I, 1)]
```

new:

```
sage: R.<x>=QQ[]
sage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9
sage: %time f.roots(CC)
CPU times: user 4 ms, sys: 0 ns, total: 4 ms
Wall time: 3.28 ms
[(-1.03157268729039, 1),
 (-1.18964736821330 - 0.850802715570186*I, 1),
 (-1.18964736821330 + 0.850802715570186*I, 1),
 (0.0780792982605128 - 1.39288589462175*I, 1),
 (0.0780792982605128 + 1.39288589462175*I, 1),
 (1.19878298502655 - 0.599304323571307*I, 1),
 (1.19878298502655 + 0.599304323571307*I, 1)]
sage: %time f.roots(QQbar)
CPU times: user 9 ms, sys: 1 ms, total: 10 ms
Wall time: 9.3 ms
[(-1.031572687290387?, 1),
 (-1.189647368213303? - 0.8508027155701860?*I, 1),
 (-1.189647368213303? + 0.8508027155701860?*I, 1),
 (0.07807929826051275? - 1.392885894621755?*I, 1),
 (0.07807929826051275? + 1.392885894621755?*I, 1),
 (1.198782985026555? - 0.5993043235713073?*I, 1),
 (1.198782985026555? + 0.5993043235713073?*I, 1)]
```

CC:  @tscrim @videlec @dkrenn @jdemeyer @sagetrac-tmonteil @cheuberg

Component: **numerical**

Keywords: **interval, root**

Author: **Miguel Marco**

Branch: **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)**

Reviewer: **Vincent Delecroix, Marc Mezzarobba**

_Issue created by migration from https://trac.sagemath.org/ticket/19964_





---

archive/issue_events_279648.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2016-01-26T15:47:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279648"
}
```



---

archive/issue_events_279649.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2016-01-26T15:47:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279649"
}
```



---

archive/issue_comments_285827.json:
```json
{
    "body": "Branch: **[u/mmarco/tight_complex_interval_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/tight_complex_interval_inverse)**",
    "created_at": "2016-01-26T15:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285827",
    "user": "https://github.com/miguelmarco"
}
```

Branch: **[u/mmarco/tight_complex_interval_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/tight_complex_interval_inverse)**



---

archive/issue_comments_285828.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84ab655f8438b505837df8f1179cafabba5e85f9\"><code>84ab655</code></a></td><td><code>compute tightly the inverse of complex interval.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7a64ace373da32989e3361a34e434abeb303689\"><code>a7a64ac</code></a></td><td><code>adapted division to new inverse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b7082d02101925b23c6704dde4e43da9a22addb\"><code>5b7082d</code></a></td><td><code>fixed doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3\"><code>97f4504</code></a></td><td><code>Merge branch 'inversecomplexintervals' into t/19964/tight_complex_interval_inverse</code></td></tr></table>\n",
    "created_at": "2016-01-26T15:55:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285828",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84ab655f8438b505837df8f1179cafabba5e85f9"><code>84ab655</code></a></td><td><code>compute tightly the inverse of complex interval.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7a64ace373da32989e3361a34e434abeb303689"><code>a7a64ac</code></a></td><td><code>adapted division to new inverse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b7082d02101925b23c6704dde4e43da9a22addb"><code>5b7082d</code></a></td><td><code>fixed doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3"><code>97f4504</code></a></td><td><code>Merge branch 'inversecomplexintervals' into t/19964/tight_complex_interval_inverse</code></td></tr></table>




---

archive/issue_comments_285829.json:
```json
{
    "body": "Commit: **[`97f4504`](https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3)**",
    "created_at": "2016-01-26T15:55:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285829",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`97f4504`](https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3)**



---

archive/issue_events_279650.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2016-01-26T15:59:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279650"
}
```



---

archive/issue_comments_285830.json:
```json
{
    "body": "Author: **Miguel Marco**",
    "created_at": "2016-01-26T15:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285830",
    "user": "https://github.com/miguelmarco"
}
```

Author: **Miguel Marco**



---

archive/issue_events_279651.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2016-01-26T15:59:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20numerical",
    "label_color": "0000ff",
    "label_name": "c: numerical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279651"
}
```



---

archive/issue_comments_285831.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84ab655f8438b505837df8f1179cafabba5e85f9\"><code>84ab655</code></a></td><td><code>compute tightly the inverse of complex interval.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7a64ace373da32989e3361a34e434abeb303689\"><code>a7a64ac</code></a></td><td><code>adapted division to new inverse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b7082d02101925b23c6704dde4e43da9a22addb\"><code>5b7082d</code></a></td><td><code>fixed doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3\"><code>97f4504</code></a></td><td><code>Merge branch 'inversecomplexintervals' into t/19964/tight_complex_interval_inverse</code></td></tr></table>\n",
    "created_at": "2016-01-26T15:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285831",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84ab655f8438b505837df8f1179cafabba5e85f9"><code>84ab655</code></a></td><td><code>compute tightly the inverse of complex interval.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7a64ace373da32989e3361a34e434abeb303689"><code>a7a64ac</code></a></td><td><code>adapted division to new inverse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b7082d02101925b23c6704dde4e43da9a22addb"><code>5b7082d</code></a></td><td><code>fixed doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3"><code>97f4504</code></a></td><td><code>Merge branch 'inversecomplexintervals' into t/19964/tight_complex_interval_inverse</code></td></tr></table>




---

archive/issue_events_279652.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2016-01-26T15:59:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279652"
}
```



---

archive/issue_comments_285832.json:
```json
{
    "body": "Changed keywords from none to **interval, root**",
    "created_at": "2016-01-26T15:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285832",
    "user": "https://github.com/miguelmarco"
}
```

Changed keywords from none to **interval, root**



---

archive/issue_comments_285833.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n+The current method to compute the multiplicative inverse of a complex interval uses schoolbok formula that produces intervals much bigger than the actual result.\n \n+This ticket implements a method that produces a tight interval enclosure of the result.\n+\n+As a result, we get better precission in root isolating methods (and hence, less steps needed).\n``````\n",
    "created_at": "2016-01-26T15:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285833",
    "user": "https://github.com/miguelmarco"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
+The current method to compute the multiplicative inverse of a complex interval uses schoolbok formula that produces intervals much bigger than the actual result.
 
+This ticket implements a method that produces a tight interval enclosure of the result.
+
+As a result, we get better precission in root isolating methods (and hence, less steps needed).
``````




---

archive/issue_comments_285834.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nCan you give an example which clearly illustrates the better bounds? Also, have you run timings versus the schoolbook version? (I don't have the technical abilities to review this ticket though.)",
    "created_at": "2016-01-26T16:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285834",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Can you give an example which clearly illustrates the better bounds? Also, have you run timings versus the schoolbook version? (I don't have the technical abilities to review this ticket though.)



---

archive/issue_comments_285835.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,144 @@\n This ticket implements a method that produces a tight interval enclosure of the result.\n \n As a result, we get better precission in root isolating methods (and hence, less steps needed).\n+\n+\n+Here are some examples that illustrate the impact of the changes:\n+\n+Old behaviour:\n+\n+\n+```\n+sage: a = CIF((1, 2), (3, 4))\n+sage: a.real().lower(), a.real().upper()\n+(1.00000000000000, 2.00000000000000)\n+sage: a = CIF((1, 2), (3, 4))\n+sage: b = a.__invert__()\n+sage: b.real().lower(), b.real().upper()\n+(0.0499999999999999, 0.200000000000001)\n+sage: b.imag().lower(), b.imag().upper()\n+(-0.400000000000001, -0.149999999999999)\n+sage: b.diameter()\n+1.20000000000000\n+sage: %time a.__invert__()\n+CPU times: user 0 ns, sys: 0 ns, total: 0 ns\n+Wall time: 23.1 \u00b5s\n+1.? - 1.?*I\n+```\n+\n+\n+new behaviour:\n+\n+\n+```\n+sage: a = CIF((1, 2), (3, 4))\n+sage: a.real().lower(), a.real().upper()\n+(1.00000000000000, 2.00000000000000)\n+sage: b = a.__invert__()\n+sage: b.real().lower(), b.real().upper()\n+(0.0588235294117647, 0.153846153846154)\n+sage: b.imag().lower(), b.imag().upper()\n+(-0.300000000000001, -0.200000000000000)\n+sage: b.diameter()\n+0.893617021276596\n+sage: %time a.__invert__()\n+CPU times: user 0 ns, sys: 0 ns, total: 0 ns\n+Wall time: 19.1 \u00b5s\n+0.1? - 0.3?*I\n+```\n+\n+\n+Another example with a smaller interval,\n+\n+old:\n+\n+```\n+sage: a = CIF((5, 5.01), (7, 7.01))\n+sage: b = a.__invert__()\n+sage: b.diameter()\n+0.00523867991752868\n+sage: b.real().lower(), b.real().upper()\n+(0.0673489564952680, 0.0677027027027028)\n+sage: b.imag().lower(), b.imag().upper()\n+(-0.0947297297297298, -0.0942885390933752)\n+sage: %time a.__invert__()\n+CPU times: user 0 ns, sys: 0 ns, total: 0 ns\n+Wall time: 23.1 \u00b5s\n+-0.068? - 0.095?*I\n+```\n+\n+new:\n+\n+```\n+sage: a = CIF((5, 5.01), (7, 7.01))\n+sage: b = a.__invert__()\n+sage: b.diameter()\n+0.00253766599329326\n+sage: b.real().lower(), b.real().upper()\n+(0.0674398874563158, 0.0676112447891434)\n+sage: b.imag().lower(), b.imag().upper()\n+(-0.0945945945945946, -0.0944232370063658)\n+sage: a = CIF((-5.01, -5), (7, 7.01))\n+sage: %time a.__invert__()\n+CPU times: user 0 ns, sys: 0 ns, total: 0 ns\n+Wall time: 49.1 \u00b5s\n+-0.068? - 0.0945?*I\n+```\n+\n+As you can see, the diameter of the result can easily get cut to half or even smaller.\n+\n+The timings of the inversion can vary, but they remain in the same order of magnitude as before. It has a noticeable effect in root isolation:\n+\n+old:\n+\n+```\n+sage: R.<x> = QQ[]\n+sage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9\n+sage: %time f.roots(CC)\n+CPU times: user 6 ms, sys: 0 ns, total: 6 ms\n+Wall time: 5.34 ms\n+[(-1.03157268729039, 1),\n+ (-1.18964736821330 - 0.850802715570186*I, 1),\n+ (-1.18964736821330 + 0.850802715570186*I, 1),\n+ (0.0780792982605128 - 1.39288589462175*I, 1),\n+ (0.0780792982605128 + 1.39288589462175*I, 1),\n+ (1.19878298502655 - 0.599304323571307*I, 1),\n+ (1.19878298502655 + 0.599304323571307*I, 1)]\n+sage: %time f.roots(QQbar)\n+CPU times: user 17 ms, sys: 0 ns, total: 17 ms\n+Wall time: 15.7 ms\n+[(-1.031572687290387?, 1),\n+ (-1.189647368213303? - 0.8508027155701860?*I, 1),\n+ (-1.189647368213303? + 0.8508027155701860?*I, 1),\n+ (0.07807929826051275? - 1.392885894621755?*I, 1),\n+ (0.07807929826051275? + 1.392885894621755?*I, 1),\n+ (1.198782985026555? - 0.5993043235713073?*I, 1),\n+ (1.198782985026555? + 0.5993043235713073?*I, 1)]\n+```\n+\n+new:\n+\n+```\n+sage: R.<x>=QQ[]\n+sage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9\n+sage: %time f.roots(CC)\n+CPU times: user 4 ms, sys: 0 ns, total: 4 ms\n+Wall time: 3.28 ms\n+[(-1.03157268729039, 1),\n+ (-1.18964736821330 - 0.850802715570186*I, 1),\n+ (-1.18964736821330 + 0.850802715570186*I, 1),\n+ (0.0780792982605128 - 1.39288589462175*I, 1),\n+ (0.0780792982605128 + 1.39288589462175*I, 1),\n+ (1.19878298502655 - 0.599304323571307*I, 1),\n+ (1.19878298502655 + 0.599304323571307*I, 1)]\n+sage: %time f.roots(QQbar)\n+CPU times: user 9 ms, sys: 1 ms, total: 10 ms\n+Wall time: 9.3 ms\n+[(-1.031572687290387?, 1),\n+ (-1.189647368213303? - 0.8508027155701860?*I, 1),\n+ (-1.189647368213303? + 0.8508027155701860?*I, 1),\n+ (0.07807929826051275? - 1.392885894621755?*I, 1),\n+ (0.07807929826051275? + 1.392885894621755?*I, 1),\n+ (1.198782985026555? - 0.5993043235713073?*I, 1),\n+ (1.198782985026555? + 0.5993043235713073?*I, 1)]\n+```\n``````\n",
    "created_at": "2016-01-26T17:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285835",
    "user": "https://github.com/miguelmarco"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,144 @@
 This ticket implements a method that produces a tight interval enclosure of the result.
 
 As a result, we get better precission in root isolating methods (and hence, less steps needed).
+
+
+Here are some examples that illustrate the impact of the changes:
+
+Old behaviour:
+
+
+```
+sage: a = CIF((1, 2), (3, 4))
+sage: a.real().lower(), a.real().upper()
+(1.00000000000000, 2.00000000000000)
+sage: a = CIF((1, 2), (3, 4))
+sage: b = a.__invert__()
+sage: b.real().lower(), b.real().upper()
+(0.0499999999999999, 0.200000000000001)
+sage: b.imag().lower(), b.imag().upper()
+(-0.400000000000001, -0.149999999999999)
+sage: b.diameter()
+1.20000000000000
+sage: %time a.__invert__()
+CPU times: user 0 ns, sys: 0 ns, total: 0 ns
+Wall time: 23.1 µs
+1.? - 1.?*I
+```
+
+
+new behaviour:
+
+
+```
+sage: a = CIF((1, 2), (3, 4))
+sage: a.real().lower(), a.real().upper()
+(1.00000000000000, 2.00000000000000)
+sage: b = a.__invert__()
+sage: b.real().lower(), b.real().upper()
+(0.0588235294117647, 0.153846153846154)
+sage: b.imag().lower(), b.imag().upper()
+(-0.300000000000001, -0.200000000000000)
+sage: b.diameter()
+0.893617021276596
+sage: %time a.__invert__()
+CPU times: user 0 ns, sys: 0 ns, total: 0 ns
+Wall time: 19.1 µs
+0.1? - 0.3?*I
+```
+
+
+Another example with a smaller interval,
+
+old:
+
+```
+sage: a = CIF((5, 5.01), (7, 7.01))
+sage: b = a.__invert__()
+sage: b.diameter()
+0.00523867991752868
+sage: b.real().lower(), b.real().upper()
+(0.0673489564952680, 0.0677027027027028)
+sage: b.imag().lower(), b.imag().upper()
+(-0.0947297297297298, -0.0942885390933752)
+sage: %time a.__invert__()
+CPU times: user 0 ns, sys: 0 ns, total: 0 ns
+Wall time: 23.1 µs
+-0.068? - 0.095?*I
+```
+
+new:
+
+```
+sage: a = CIF((5, 5.01), (7, 7.01))
+sage: b = a.__invert__()
+sage: b.diameter()
+0.00253766599329326
+sage: b.real().lower(), b.real().upper()
+(0.0674398874563158, 0.0676112447891434)
+sage: b.imag().lower(), b.imag().upper()
+(-0.0945945945945946, -0.0944232370063658)
+sage: a = CIF((-5.01, -5), (7, 7.01))
+sage: %time a.__invert__()
+CPU times: user 0 ns, sys: 0 ns, total: 0 ns
+Wall time: 49.1 µs
+-0.068? - 0.0945?*I
+```
+
+As you can see, the diameter of the result can easily get cut to half or even smaller.
+
+The timings of the inversion can vary, but they remain in the same order of magnitude as before. It has a noticeable effect in root isolation:
+
+old:
+
+```
+sage: R.<x> = QQ[]
+sage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9
+sage: %time f.roots(CC)
+CPU times: user 6 ms, sys: 0 ns, total: 6 ms
+Wall time: 5.34 ms
+[(-1.03157268729039, 1),
+ (-1.18964736821330 - 0.850802715570186*I, 1),
+ (-1.18964736821330 + 0.850802715570186*I, 1),
+ (0.0780792982605128 - 1.39288589462175*I, 1),
+ (0.0780792982605128 + 1.39288589462175*I, 1),
+ (1.19878298502655 - 0.599304323571307*I, 1),
+ (1.19878298502655 + 0.599304323571307*I, 1)]
+sage: %time f.roots(QQbar)
+CPU times: user 17 ms, sys: 0 ns, total: 17 ms
+Wall time: 15.7 ms
+[(-1.031572687290387?, 1),
+ (-1.189647368213303? - 0.8508027155701860?*I, 1),
+ (-1.189647368213303? + 0.8508027155701860?*I, 1),
+ (0.07807929826051275? - 1.392885894621755?*I, 1),
+ (0.07807929826051275? + 1.392885894621755?*I, 1),
+ (1.198782985026555? - 0.5993043235713073?*I, 1),
+ (1.198782985026555? + 0.5993043235713073?*I, 1)]
+```
+
+new:
+
+```
+sage: R.<x>=QQ[]
+sage: f = -7/6*x^7 - x^6 + 1/2*x^4 + 2/17*x^3 + 2*x^2 - 6*x - 9
+sage: %time f.roots(CC)
+CPU times: user 4 ms, sys: 0 ns, total: 4 ms
+Wall time: 3.28 ms
+[(-1.03157268729039, 1),
+ (-1.18964736821330 - 0.850802715570186*I, 1),
+ (-1.18964736821330 + 0.850802715570186*I, 1),
+ (0.0780792982605128 - 1.39288589462175*I, 1),
+ (0.0780792982605128 + 1.39288589462175*I, 1),
+ (1.19878298502655 - 0.599304323571307*I, 1),
+ (1.19878298502655 + 0.599304323571307*I, 1)]
+sage: %time f.roots(QQbar)
+CPU times: user 9 ms, sys: 1 ms, total: 10 ms
+Wall time: 9.3 ms
+[(-1.031572687290387?, 1),
+ (-1.189647368213303? - 0.8508027155701860?*I, 1),
+ (-1.189647368213303? + 0.8508027155701860?*I, 1),
+ (0.07807929826051275? - 1.392885894621755?*I, 1),
+ (0.07807929826051275? + 1.392885894621755?*I, 1),
+ (1.198782985026555? - 0.5993043235713073?*I, 1),
+ (1.198782985026555? + 0.5993043235713073?*I, 1)]
+```
``````




---

archive/issue_comments_285836.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAdded some examples to the description.",
    "created_at": "2016-01-26T17:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285836",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:6" align="right">comment:6</div>

Added some examples to the description.



---

archive/issue_comments_285837.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIs this better in all cases?\n\n```diff\n-             0.?e-182 - 0.7598602580415435?*I,\n-             0.?e-249 + 0.7598602580415435?*I,\n+             0.?e-215 - 0.7598602580415435?*I,\n+             0.?e-229 + 0.7598602580415435?*I,\n```",
    "created_at": "2016-03-09T19:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285837",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

Is this better in all cases?

```diff
-             0.?e-182 - 0.7598602580415435?*I,
-             0.?e-249 + 0.7598602580415435?*I,
+             0.?e-215 - 0.7598602580415435?*I,
+             0.?e-229 + 0.7598602580415435?*I,
```



---

archive/issue_comments_285838.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIt should be, up to floating point artifacts. I don't know much about the subtleties of floating point numbers though.",
    "created_at": "2016-03-09T19:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285838",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:8" align="right">comment:8</div>

It should be, up to floating point artifacts. I don't know much about the subtleties of floating point numbers though.



---

archive/issue_comments_285839.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI was wondering about the `e-249` becoming a `e-229` in the above example...",
    "created_at": "2016-03-09T19:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285839",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

I was wondering about the `e-249` becoming a `e-229` in the above example...



---

archive/issue_comments_285840.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYes, that is what i imagined, but i would guess that in those two cases the discrepancy is due to those pesky numerical artifacts that can appear just by, for example, performing the same operations in different order.",
    "created_at": "2016-03-09T19:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285840",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:10" align="right">comment:10</div>

Yes, that is what i imagined, but i would guess that in those two cases the discrepancy is due to those pesky numerical artifacts that can appear just by, for example, performing the same operations in different order.



---

archive/issue_comments_285841.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIMHO the tests should cover all branches of the new implementation (ideally with test cases where the rounding modes matter, if that's not too hard to achieve).",
    "created_at": "2016-03-25T10:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285841",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:12" align="right">comment:12</div>

IMHO the tests should cover all branches of the new implementation (ideally with test cases where the rounding modes matter, if that's not too hard to achieve).



---

archive/issue_comments_285842.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nFollowing [comment:12](#comment%3A12) I added a doctest. And I also removed the trailing whitespaces in a second commit.\n\nThis is good for me to go. Any remarks?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e5fe260e0c56e16b42e03e5a3e0bf44cc0bc15b\"><code>1e5fe26</code></a></td><td><code>Trac 19964: add doctest for all branches</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d57c62632a612d8f098515ff604ba153a3566ec2\"><code>d57c626</code></a></td><td><code>Trac 19964: get rid of trailing whitespaces</code></td></tr></table>\n",
    "created_at": "2016-04-05T19:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285842",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Following [comment:12](#comment%3A12) I added a doctest. And I also removed the trailing whitespaces in a second commit.

This is good for me to go. Any remarks?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e5fe260e0c56e16b42e03e5a3e0bf44cc0bc15b"><code>1e5fe26</code></a></td><td><code>Trac 19964: add doctest for all branches</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d57c62632a612d8f098515ff604ba153a3566ec2"><code>d57c626</code></a></td><td><code>Trac 19964: get rid of trailing whitespaces</code></td></tr></table>




---

archive/issue_comments_285843.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2016-04-05T19:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285843",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_285844.json:
```json
{
    "body": "Changed commit from **[`97f4504`](https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3)** to **[`d57c626`](https://github.com/sagemath/sagetrac-mirror/commit/d57c62632a612d8f098515ff604ba153a3566ec2)**",
    "created_at": "2016-04-05T19:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285844",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`97f4504`](https://github.com/sagemath/sagetrac-mirror/commit/97f4504c20b5bfbf315f5e00013dab27df25fbd3)** to **[`d57c626`](https://github.com/sagemath/sagetrac-mirror/commit/d57c62632a612d8f098515ff604ba153a3566ec2)**



---

archive/issue_events_279653.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-05T19:28:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279653"
}
```



---

archive/issue_events_279654.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-05T19:28:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279654"
}
```



---

archive/issue_comments_285845.json:
```json
{
    "body": "Changed branch from **[u/mmarco/tight_complex_interval_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/tight_complex_interval_inverse)** to **[u/vdelecroix/19964](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/19964)**",
    "created_at": "2016-04-05T19:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285845",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/mmarco/tight_complex_interval_inverse](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/tight_complex_interval_inverse)** to **[u/vdelecroix/19964](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/19964)**



---

archive/issue_comments_285846.json:
```json
{
    "body": "Changed commit from **[`d57c626`](https://github.com/sagemath/sagetrac-mirror/commit/d57c62632a612d8f098515ff604ba153a3566ec2)** to **[`d57fee2`](https://github.com/sagemath/sagetrac-mirror/commit/d57fee2259bf69d0f0471f1bc89c3a81f1e12e27)**",
    "created_at": "2016-04-05T19:30:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285846",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d57c626`](https://github.com/sagemath/sagetrac-mirror/commit/d57c62632a612d8f098515ff604ba153a3566ec2)** to **[`d57fee2`](https://github.com/sagemath/sagetrac-mirror/commit/d57fee2259bf69d0f0471f1bc89c3a81f1e12e27)**



---

archive/issue_comments_285847.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/421b3b3e7a36b66b6d4d87e2c37f155e5e6514c5\"><code>421b3b3</code></a></td><td><code>Trac 19964: add doctest for all branches</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d57fee2259bf69d0f0471f1bc89c3a81f1e12e27\"><code>d57fee2</code></a></td><td><code>Trac 19964: get rid of trailing whitespaces</code></td></tr></table>\n",
    "created_at": "2016-04-05T19:30:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285847",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/421b3b3e7a36b66b6d4d87e2c37f155e5e6514c5"><code>421b3b3</code></a></td><td><code>Trac 19964: add doctest for all branches</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d57fee2259bf69d0f0471f1bc89c3a81f1e12e27"><code>d57fee2</code></a></td><td><code>Trac 19964: get rid of trailing whitespaces</code></td></tr></table>




---

archive/issue_comments_285848.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nlgtm except that I'd suggest the following change in order to really test all possible cases:\n\n```\n@@ -1130,12 +1130,15 @@ cdef class ComplexIntervalFieldElement(sage.structure.element.FieldElement):\n         Check that the code is valid in all regions of the complex plane::\n \n             sage: rats = [15423/906, 337/59976, 145151/145112]\n-            sage: for a in rats:\n-            ....:     for b in rats:\n-            ....:         x = CIF(a, b)\n-            ....:         assert (x * (~x) - 1).contains_zero()\n-            ....:         x = -CIF(a,b)\n-            ....:         assert (x * (~x) - 1).contains_zero()\n+            sage: ivs = [RIF(aa, bb) for a in rats for b in rats\n+            ....:                   for aa in [-a, a] for bb in [-b, b]\n+            ....:                   if aa <= bb]\n+            sage: for x in ivs:\n+            ....:     for y in ivs:\n+            ....:         z = CIF(x, y)\n+            ....:         inv = ~z\n+            ....:         assert ((z*inv - 1).contains_zero()\n+            ....:                 or z.contains_zero() and inv.real().is_NaN())\n```",
    "created_at": "2016-04-06T08:10:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285848",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:15" align="right">comment:15</div>

lgtm except that I'd suggest the following change in order to really test all possible cases:

```
@@ -1130,12 +1130,15 @@ cdef class ComplexIntervalFieldElement(sage.structure.element.FieldElement):
         Check that the code is valid in all regions of the complex plane::
 
             sage: rats = [15423/906, 337/59976, 145151/145112]
-            sage: for a in rats:
-            ....:     for b in rats:
-            ....:         x = CIF(a, b)
-            ....:         assert (x * (~x) - 1).contains_zero()
-            ....:         x = -CIF(a,b)
-            ....:         assert (x * (~x) - 1).contains_zero()
+            sage: ivs = [RIF(aa, bb) for a in rats for b in rats
+            ....:                   for aa in [-a, a] for bb in [-b, b]
+            ....:                   if aa <= bb]
+            sage: for x in ivs:
+            ....:     for y in ivs:
+            ....:         z = CIF(x, y)
+            ....:         inv = ~z
+            ....:         assert ((z*inv - 1).contains_zero()
+            ....:                 or z.contains_zero() and inv.real().is_NaN())
```



---

archive/issue_comments_285849.json:
```json
{
    "body": "Changed commit from **[`d57fee2`](https://github.com/sagemath/sagetrac-mirror/commit/d57fee2259bf69d0f0471f1bc89c3a81f1e12e27)** to **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)**",
    "created_at": "2016-04-07T20:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285849",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d57fee2`](https://github.com/sagemath/sagetrac-mirror/commit/d57fee2259bf69d0f0471f1bc89c3a81f1e12e27)** to **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)**



---

archive/issue_comments_285850.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3\"><code>39558b6</code></a></td><td><code>Trac 19964: extend doctest</code></td></tr></table>\n",
    "created_at": "2016-04-07T20:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285850",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3"><code>39558b6</code></a></td><td><code>Trac 19964: extend doctest</code></td></tr></table>




---

archive/issue_comments_285851.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYou really don't want to test the cases where the interval contains zero `;-)`. But so be it.",
    "created_at": "2016-04-12T16:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285851",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:17" align="right">comment:17</div>

You really don't want to test the cases where the interval contains zero `;-)`. But so be it.



---

archive/issue_comments_285852.json:
```json
{
    "body": "Changed reviewer from **Vincent Delecroix** to **Vincent Delecroix, Marc Mezzarobba**",
    "created_at": "2016-04-12T16:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285852",
    "user": "https://github.com/mezzarobba"
}
```

Changed reviewer from **Vincent Delecroix** to **Vincent Delecroix, Marc Mezzarobba**



---

archive/issue_events_279655.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-04-12T16:01:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279655"
}
```



---

archive/issue_events_279656.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-04-12T16:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279656"
}
```



---

archive/issue_events_279657.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-13T17:05:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279657"
}
```



---

archive/issue_events_279658.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "db5a87ec7b7e62dcbdd73c97d0ebf61b6f877ea3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-04-13T17:05:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19964#event-279658"
}
```



---

archive/issue_comments_285853.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/19964](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/19964)** to **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)**",
    "created_at": "2016-04-13T17:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285853",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/19964](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/19964)** to **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)**



---

archive/issue_comments_285854.json:
```json
{
    "body": "Changed commit from **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)** to none",
    "created_at": "2017-04-20T08:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285854",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`39558b6`](https://github.com/sagemath/sagetrac-mirror/commit/39558b6299664e10bd008e2f97bb9c64e62096b3)** to none



---

archive/issue_comments_285855.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nBreakage: #22834",
    "created_at": "2017-04-20T08:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19964",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19964#issuecomment-285855",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Breakage: #22834
