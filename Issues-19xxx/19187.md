# Issue 19187: Add rules for installing packages with pip

archive/issues_018950.json:
```json
{
    "body": "With the infrastructure of #19101, we can make it such that\n\n```\nsage -i pyopenssl\n```\nactually runs `pip`.\n\nAll the following optional packages need to be removed from the server as they are now supported by the above command:\n- beautifulsoup\n- biopython\n- brian\n- guppy\n- mercurial\n- mpi4py\n- nibabel\n- pybtex\n- pyflakes\n- pyopenssl\n- sqlalchemy\n- trac\n\nfollow-up: #19213, #19220\n\nIssue created by migration from https://trac.sagemath.org/ticket/19187\n\n",
    "closed_at": "2015-09-20T17:03:53Z",
    "created_at": "2015-09-11T08:45:49Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Add rules for installing packages with pip",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19187",
    "user": "https://github.com/jdemeyer"
}
```
With the infrastructure of #19101, we can make it such that

```
sage -i pyopenssl
```
actually runs `pip`.

All the following optional packages need to be removed from the server as they are now supported by the above command:
- beautifulsoup
- biopython
- brian
- guppy
- mercurial
- mpi4py
- nibabel
- pybtex
- pyflakes
- pyopenssl
- sqlalchemy
- trac

follow-up: #19213, #19220

Issue created by migration from https://trac.sagemath.org/ticket/19187





---

archive/issue_comments_259482.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-11T09:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259482",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_259483.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-11T09:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259483",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_259484.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2015-09-11T09:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259484",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to critical.



---

archive/issue_comments_259485.json:
```json
{
    "body": "Can we do that for all packages that are installable that way (brian, biopython, etc.) then?  (I tried to look at the commit to see if it did that but my internet is very flaky until I get to work.)",
    "created_at": "2015-09-11T12:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259485",
    "user": "https://github.com/kcrisman"
}
```

Can we do that for all packages that are installable that way (brian, biopython, etc.) then?  (I tried to look at the commit to see if it did that but my internet is very flaky until I get to work.)



---

archive/issue_comments_259486.json:
```json
{
    "body": "Replying to [comment:4 kcrisman]:\n> Can we do that for all packages that are installable that way?\n\n\nThe current branch deals with\n\n```\nbeautifulsoup\nbiopython\nbrian\nguppy\nmpi4py\nnibabel\npybtex\npyflakes\npyopenssl\ntrac\n```",
    "created_at": "2015-09-11T12:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259486",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 kcrisman]:
> Can we do that for all packages that are installable that way?


The current branch deals with

```
beautifulsoup
biopython
brian
guppy
mpi4py
nibabel
pybtex
pyflakes
pyopenssl
trac
```



---

archive/issue_comments_259487.json:
```json
{
    "body": "Thanks - I actually saw that just before my internet cut out on the train :-( so I couldn't edit my post - but I appreciate the quick followup :-) and good thinking to do this, of course, we should have long ago.",
    "created_at": "2015-09-11T13:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259487",
    "user": "https://github.com/kcrisman"
}
```

Thanks - I actually saw that just before my internet cut out on the train :-( so I couldn't edit my post - but I appreciate the quick followup :-) and good thinking to do this, of course, we should have long ago.



---

archive/issue_comments_259488.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-11T21:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259489.json:
```json
{
    "body": "(You know, this could be very helpful for disentangling the many packages in sagenb.)",
    "created_at": "2015-09-12T00:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259489",
    "user": "https://github.com/kcrisman"
}
```

(You know, this could be very helpful for disentangling the many packages in sagenb.)



---

archive/issue_comments_259490.json:
```json
{
    "body": "Replying to [comment:8 kcrisman]:\n> (You know, this could be very helpful for disentangling the many packages in sagenb.)\n\nActually not, because these special `pip` rules are not standard packages.",
    "created_at": "2015-09-12T07:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259490",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 kcrisman]:
> (You know, this could be very helpful for disentangling the many packages in sagenb.)

Actually not, because these special `pip` rules are not standard packages.



---

archive/issue_comments_259491.json:
```json
{
    "body": "Hi Jeroen,,\n\nDo you consider your solution as temporary? I am afraid that it would become an open door to have thousands of packages in `piprules`. Shouldn't we reorient users toward `sage -pip install X`?\n\nVincent",
    "created_at": "2015-09-13T12:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259491",
    "user": "https://github.com/videlec"
}
```

Hi Jeroen,,

Do you consider your solution as temporary? I am afraid that it would become an open door to have thousands of packages in `piprules`. Shouldn't we reorient users toward `sage -pip install X`?

Vincent



---

archive/issue_comments_259492.json:
```json
{
    "body": "Could this also be modified to work for `nzmath` and `pyx`?",
    "created_at": "2015-09-13T16:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259492",
    "user": "https://github.com/tscrim"
}
```

Could this also be modified to work for `nzmath` and `pyx`?



---

archive/issue_comments_259493.json:
```json
{
    "body": "> Do you consider your solution as temporary? I am afraid that it would become an open door to have thousands of packages in `piprules`. \n\n\n\nThat could be regarded as a feature.  After all, we'd still want to have some test with respect to doctests or something.  If people just want to add a pip package, whatever.  If they want to add a documentation file with interactions with standard Sage, why not?  Or is it just a flood waiting to get in?",
    "created_at": "2015-09-14T01:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259493",
    "user": "https://github.com/kcrisman"
}
```

> Do you consider your solution as temporary? I am afraid that it would become an open door to have thousands of packages in `piprules`. 



That could be regarded as a feature.  After all, we'd still want to have some test with respect to doctests or something.  If people just want to add a pip package, whatever.  If they want to add a documentation file with interactions with standard Sage, why not?  Or is it just a flood waiting to get in?



---

archive/issue_comments_259494.json:
```json
{
    "body": "Replying to [comment:10 vdelecroix]:\n> Do you consider your solution as temporary?\n\nNo.\n\n> I am afraid that it would become an open door to have thousands of packages in `piprules`.\n\nwhich is problem because...? Besides, we didn't have \"thousands\" of optional/experimental packages before, so I don't see why this would suddenly become thousands now.\n\n> Shouldn't we reorient users toward `sage -pip install X`?\n\nI don't think so, because how is the user supposed to know if he should use `sage -i PKG` or `sage --pip install PKG`? With my patch here, the user just needs to know `sage -i PKG`.",
    "created_at": "2015-09-14T07:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259494",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 vdelecroix]:
> Do you consider your solution as temporary?

No.

> I am afraid that it would become an open door to have thousands of packages in `piprules`.

which is problem because...? Besides, we didn't have "thousands" of optional/experimental packages before, so I don't see why this would suddenly become thousands now.

> Shouldn't we reorient users toward `sage -pip install X`?

I don't think so, because how is the user supposed to know if he should use `sage -i PKG` or `sage --pip install PKG`? With my patch here, the user just needs to know `sage -i PKG`.



---

archive/issue_comments_259495.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n> Could this also be modified to work for `nzmath` and `pyx`?\n\nIf you successfully installed any of those two using `pip`, please tell me how. The obvious `sage --pip install pyx` or `sage --pip install nzmath` does not work.",
    "created_at": "2015-09-14T07:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259495",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 tscrim]:
> Could this also be modified to work for `nzmath` and `pyx`?

If you successfully installed any of those two using `pip`, please tell me how. The obvious `sage --pip install pyx` or `sage --pip install nzmath` does not work.



---

archive/issue_comments_259496.json:
```json
{
    "body": "Vincent was able to install them, although you need to pass additional arguments to `pip`. See [this thread](https://groups.google.com/forum/#!searchin/sage-devel/install$20pip/sage-devel/c9joE12sqDg/JJzhG7h4ZNQJ). I will try later today to see if I can get those to work.\n\nHowever, perhaps nzmath should (continue to) be a spkg as the latest version is 1.2 and pip would install 1.1?",
    "created_at": "2015-09-14T12:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259496",
    "user": "https://github.com/tscrim"
}
```

Vincent was able to install them, although you need to pass additional arguments to `pip`. See [this thread](https://groups.google.com/forum/#!searchin/sage-devel/install$20pip/sage-devel/c9joE12sqDg/JJzhG7h4ZNQJ). I will try later today to see if I can get those to work.

However, perhaps nzmath should (continue to) be a spkg as the latest version is 1.2 and pip would install 1.1?



---

archive/issue_comments_259497.json:
```json
{
    "body": "Seems to not work anymore:\n\n```\nsage -pip install --allow-external pyx --allow-unverified pyx pyx\n```\nended up with\n\n```\nNo files/directories in /tmp/pip-build-d6xYvF/pyx/pip-egg-info (from PKG-INFO)\n```\n\nand\n\n```\nsage -pip install --allow-external nzmath --allow-unverified nzmath nzmath\n```\nended up with some timeout",
    "created_at": "2015-09-14T13:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259497",
    "user": "https://github.com/videlec"
}
```

Seems to not work anymore:

```
sage -pip install --allow-external pyx --allow-unverified pyx pyx
```
ended up with

```
No files/directories in /tmp/pip-build-d6xYvF/pyx/pip-egg-info (from PKG-INFO)
```

and

```
sage -pip install --allow-external nzmath --allow-unverified nzmath nzmath
```
ended up with some timeout



---

archive/issue_comments_259498.json:
```json
{
    "body": "I just tested all the list of packages provied in [comment:5 comment:5] and everything worked fine.\n\nReplying to [comment:13 jdemeyer]:\n> Replying to [comment:10 vdelecroix]:\n> > Do you consider your solution as temporary?\n\n> No.\n\nThen it should be complient with `sage --optional` which lists the packages. Right now (after installing all the packages supported) I got:\n\n```\n$ sage --optional\nbeautifulsoup........................... 3.2.1 (not_installed)\nbiopython............................... 1.61 (not_installed)\nbrian................................... 1.4.1.p0 (not_installed)\nmpi4py.................................. 1.2.2 (not_installed)\ntrac.................................... 0.11.5.p0 (not_installed)\netc\n```\n\nAnd also with `sage -t` that uses optional packages.\n\n```\n$ sage -t whatever\n...\nUsing --optional=cbc,mpir,python2,sage,scons\n...\n```\n\n> > I am afraid that it would become an open door to have thousands of packages in `piprules`.\n\n> which is problem because...? Besides, we didn't have \"thousands\" of optional/experimental packages before, so I don't see why this would suddenly become thousands now.\n\nBecause it becomes now very easy. But you might be right.\n\n> > Shouldn't we reorient users toward `sage -pip install X`?\n\n> I don't think so, because how is the user supposed to know if he should use `sage -i PKG` or `sage --pip install PKG`? With my patch here, the user just needs to know `sage -i PKG`.\n\nNo. And as Karl-Dieter said it would be good to add tests for them `# optional - biopython`.\n\nVincent",
    "created_at": "2015-09-14T18:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259498",
    "user": "https://github.com/videlec"
}
```

I just tested all the list of packages provied in [comment:5 comment:5] and everything worked fine.

Replying to [comment:13 jdemeyer]:
> Replying to [comment:10 vdelecroix]:
> > Do you consider your solution as temporary?

> No.

Then it should be complient with `sage --optional` which lists the packages. Right now (after installing all the packages supported) I got:

```
$ sage --optional
beautifulsoup........................... 3.2.1 (not_installed)
biopython............................... 1.61 (not_installed)
brian................................... 1.4.1.p0 (not_installed)
mpi4py.................................. 1.2.2 (not_installed)
trac.................................... 0.11.5.p0 (not_installed)
etc
```

And also with `sage -t` that uses optional packages.

```
$ sage -t whatever
...
Using --optional=cbc,mpir,python2,sage,scons
...
```

> > I am afraid that it would become an open door to have thousands of packages in `piprules`.

> which is problem because...? Besides, we didn't have "thousands" of optional/experimental packages before, so I don't see why this would suddenly become thousands now.

Because it becomes now very easy. But you might be right.

> > Shouldn't we reorient users toward `sage -pip install X`?

> I don't think so, because how is the user supposed to know if he should use `sage -i PKG` or `sage --pip install PKG`? With my patch here, the user just needs to know `sage -i PKG`.

No. And as Karl-Dieter said it would be good to add tests for them `# optional - biopython`.

Vincent



---

archive/issue_comments_259499.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-14T18:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259499",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_259500.json:
```json
{
    "body": "Sorry Vincent, but that's currently too much to ask. It's hard to make these \"real\" packages without major changes to the package system.\n\nSo either this ticket get accepted as-is (potentially with minor modifications) or closed as \"wontfix\".",
    "created_at": "2015-09-14T18:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259500",
    "user": "https://github.com/jdemeyer"
}
```

Sorry Vincent, but that's currently too much to ask. It's hard to make these "real" packages without major changes to the package system.

So either this ticket get accepted as-is (potentially with minor modifications) or closed as "wontfix".



---

archive/issue_comments_259501.json:
```json
{
    "body": "Think of these packages as forming a new category: we have standard packages, optional packages, experimental packages and pip packages. They are not optional packages and cannot be listed by some `sage --whatever` command.",
    "created_at": "2015-09-14T18:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259501",
    "user": "https://github.com/jdemeyer"
}
```

Think of these packages as forming a new category: we have standard packages, optional packages, experimental packages and pip packages. They are not optional packages and cannot be listed by some `sage --whatever` command.



---

archive/issue_comments_259502.json:
```json
{
    "body": "Although we can check existing optional packages to see if they've been installed by pip:\n\n```diff\ndiff --git a/src/bin/sage-list-packages b/src/bin/sage-list-packages\nindex e809e40..9162a30 100755\n--- a/src/bin/sage-list-packages\n+++ b/src/bin/sage-list-packages\n@@ -5,7 +5,7 @@\n \n from __future__ import print_function\n \n-import os, sys, argparse, re\n+import os, argparse, re, subprocess\n from string import join\n \n if \"SAGE_ROOT\" not in os.environ:\n@@ -98,13 +98,26 @@ if args['category'] == 'installed':\n # Any other categories\n else:\n     if args['version']:\n+        try:\n+            pip_output = subprocess.check_output(['pip', 'list'], stderr=subprocess.STDOUT)\n+        except CalledProcessError:\n+            pip_output = ''\n+\n         # Display the columns' name\n         if not args['dump']:\n             print(\"{:.<40} {} ({})\\n\".format(\"[package] \", \"[latest version]\",\n                                              \"[installed version]\"))\n         for p in sorted(set(local).union(remote)):\n+            if p in installed:\n+                installed_version = installed[p]\n+            else:\n+                s = re.search('\\n{}.*\\((.*)\\)\\n'.format(p), pip_output)\n+                if s:\n+                    installed_version = s.groups(0)[0]\n+                else:\n+                    installed_version = 'not_installed'\n             line = [p, local.get(p, remote.get(p, 'not_found')),\n-                    installed.get(p, 'not_installed')]\n+                    installed_version]\n             if args['dump']:\n                 print(join(line, ' '))\n             else:\n```\n(This is not a complete patch, just an idea.)",
    "created_at": "2015-09-14T19:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259502",
    "user": "https://github.com/jhpalmieri"
}
```

Although we can check existing optional packages to see if they've been installed by pip:

```diff
diff --git a/src/bin/sage-list-packages b/src/bin/sage-list-packages
index e809e40..9162a30 100755
--- a/src/bin/sage-list-packages
+++ b/src/bin/sage-list-packages
@@ -5,7 +5,7 @@
 
 from __future__ import print_function
 
-import os, sys, argparse, re
+import os, argparse, re, subprocess
 from string import join
 
 if "SAGE_ROOT" not in os.environ:
@@ -98,13 +98,26 @@ if args['category'] == 'installed':
 # Any other categories
 else:
     if args['version']:
+        try:
+            pip_output = subprocess.check_output(['pip', 'list'], stderr=subprocess.STDOUT)
+        except CalledProcessError:
+            pip_output = ''
+
         # Display the columns' name
         if not args['dump']:
             print("{:.<40} {} ({})\n".format("[package] ", "[latest version]",
                                              "[installed version]"))
         for p in sorted(set(local).union(remote)):
+            if p in installed:
+                installed_version = installed[p]
+            else:
+                s = re.search('\n{}.*\((.*)\)\n'.format(p), pip_output)
+                if s:
+                    installed_version = s.groups(0)[0]
+                else:
+                    installed_version = 'not_installed'
             line = [p, local.get(p, remote.get(p, 'not_found')),
-                    installed.get(p, 'not_installed')]
+                    installed_version]
             if args['dump']:
                 print(join(line, ' '))
             else:
```
(This is not a complete patch, just an idea.)



---

archive/issue_comments_259503.json:
```json
{
    "body": "And if we think this sort of patch is a good idea, it can go on a later ticket, not this one.",
    "created_at": "2015-09-14T19:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259503",
    "user": "https://github.com/jhpalmieri"
}
```

And if we think this sort of patch is a good idea, it can go on a later ticket, not this one.



---

archive/issue_comments_259504.json:
```json
{
    "body": "See #19213.",
    "created_at": "2015-09-14T21:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259504",
    "user": "https://github.com/jhpalmieri"
}
```

See #19213.



---

archive/issue_comments_259505.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> Think of these packages as forming a new category: we have standard packages, optional packages, experimental packages and pip packages. They are not optional packages and cannot be listed by some `sage --whatever` command.\n\n\nWhat is this piprules file then!? It is possible to check the last version of a package with their json api\n\n```\nimport urllib2\nimport json\ndef pip_versions(package_name):\n    url = \"https://pypi.python.org/pypi/{}/json\".format(package_name)\n    try:\n        data = json.load(urllib2.urlopen(urllib2.Request(url)))\n    except urllib2.HTTPError:\n        return []\n    else:\n        versions = data[\"releases\"].keys()\n        return versions\n```",
    "created_at": "2015-09-14T23:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259505",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:19 jdemeyer]:
> Think of these packages as forming a new category: we have standard packages, optional packages, experimental packages and pip packages. They are not optional packages and cannot be listed by some `sage --whatever` command.


What is this piprules file then!? It is possible to check the last version of a package with their json api

```
import urllib2
import json
def pip_versions(package_name):
    url = "https://pypi.python.org/pypi/{}/json".format(package_name)
    try:
        data = json.load(urllib2.urlopen(urllib2.Request(url)))
    except urllib2.HTTPError:
        return []
    else:
        versions = data["releases"].keys()
        return versions
```



---

archive/issue_comments_259506.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n> Sorry Vincent, but that's currently too much to ask. It's hard to make these \"real\" packages without major changes to the package system.\n> \n> So either this ticket get accepted as-is (potentially with minor modifications) or closed as \"wontfix\".\n\n\nI think this ticket is good, but it lacks integration. I would be also happy if all of `brian`, `trac`, ... would **not** appear in `sage --optional`.\n\nVincent",
    "created_at": "2015-09-14T23:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259506",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:18 jdemeyer]:
> Sorry Vincent, but that's currently too much to ask. It's hard to make these "real" packages without major changes to the package system.
> 
> So either this ticket get accepted as-is (potentially with minor modifications) or closed as "wontfix".


I think this ticket is good, but it lacks integration. I would be also happy if all of `brian`, `trac`, ... would **not** appear in `sage --optional`.

Vincent



---

archive/issue_comments_259507.json:
```json
{
    "body": "In other words, we could:\n- remove all of `brian`, `trac`, ... from the list of optional packages\n- postponed the pip listing and test support to #19213\n\nwhat do you think?",
    "created_at": "2015-09-14T23:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259507",
    "user": "https://github.com/videlec"
}
```

In other words, we could:
- remove all of `brian`, `trac`, ... from the list of optional packages
- postponed the pip listing and test support to #19213

what do you think?



---

archive/issue_comments_259508.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> In other words, we could:\n> - remove all of `brian`, `trac`, ... from the list of optional packages\n> - postponed the pip listing and test support to #19213\n> \n> what do you think?\n\n\nFine for me. Do you give positive to this ticket then?",
    "created_at": "2015-09-16T08:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259508",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 vdelecroix]:
> In other words, we could:
> - remove all of `brian`, `trac`, ... from the list of optional packages
> - postponed the pip listing and test support to #19213
> 
> what do you think?


Fine for me. Do you give positive to this ticket then?



---

archive/issue_comments_259509.json:
```json
{
    "body": "Should we explicit ask on sage-devel for removing them from the server?\n\nVincent",
    "created_at": "2015-09-16T13:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259509",
    "user": "https://github.com/videlec"
}
```

Should we explicit ask on sage-devel for removing them from the server?

Vincent



---

archive/issue_comments_259510.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-09-16T13:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259510",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_259511.json:
```json
{
    "body": "Replying to [comment:27 vdelecroix]:\n> Should we explicit ask on sage-devel for removing them from the server?\n\nSee #19220.",
    "created_at": "2015-09-16T14:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259511",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 vdelecroix]:
> Should we explicit ask on sage-devel for removing them from the server?

See #19220.



---

archive/issue_comments_259512.json:
```json
{
    "body": "Doesn't work\n\n```\n$ sage -f brian\n[... endless noise ...]\nsage --pip uninstall -y brian\nYou are using pip version 6.1.1, however version 7.1.2 is available.\nYou should consider upgrading via the 'pip install --upgrade pip' command.\nCannot uninstall requirement brian, not installed\nMakefile:2244: recipe for target 'brian-clean' failed\n```\nAlso breaks the buildbot script that assumes that `build/pkgs/*` has a corresponding log file etc. IMHO one dirent for one package is IMHO a better organization, stuffing multiple packages into lines of a single file doesn't scale (merge conflicts if its too popular).",
    "created_at": "2015-09-16T19:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259512",
    "user": "https://github.com/vbraun"
}
```

Doesn't work

```
$ sage -f brian
[... endless noise ...]
sage --pip uninstall -y brian
You are using pip version 6.1.1, however version 7.1.2 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
Cannot uninstall requirement brian, not installed
Makefile:2244: recipe for target 'brian-clean' failed
```
Also breaks the buildbot script that assumes that `build/pkgs/*` has a corresponding log file etc. IMHO one dirent for one package is IMHO a better organization, stuffing multiple packages into lines of a single file doesn't scale (merge conflicts if its too popular).



---

archive/issue_comments_259513.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-09-16T19:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259513",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_259514.json:
```json
{
    "body": "This might be a little ugly:\n\n```diff\ndiff --git a/build/make/install b/build/make/install\nindex 7469661..a164fc4 100755\n--- a/build/make/install\n+++ b/build/make/install\n@@ -473,7 +473,7 @@ while read PKG_NAME; do\n \n     # Add a target to remove the \"installed\" file for \"sage -f\"\n     echo >&5 \"$PKG_NAME-clean:\"\n-    echo >&5 \" sage --pip uninstall -y $PKG_NAME\"\n+    echo >&5 \" sage --pip list | grep $PKG_NAME && sage --pip uninstall -y $PKG_NAME || :\"\n     echo >&5\n done <\"$SAGE_ROOT/build/pkgs/piprules\"\n \n```\nOr the same but omitting `sage --pip list | grep $PKG_NAME &&`.",
    "created_at": "2015-09-16T20:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259514",
    "user": "https://github.com/jhpalmieri"
}
```

This might be a little ugly:

```diff
diff --git a/build/make/install b/build/make/install
index 7469661..a164fc4 100755
--- a/build/make/install
+++ b/build/make/install
@@ -473,7 +473,7 @@ while read PKG_NAME; do
 
     # Add a target to remove the "installed" file for "sage -f"
     echo >&5 "$PKG_NAME-clean:"
-    echo >&5 " sage --pip uninstall -y $PKG_NAME"
+    echo >&5 " sage --pip list | grep $PKG_NAME && sage --pip uninstall -y $PKG_NAME || :"
     echo >&5
 done <"$SAGE_ROOT/build/pkgs/piprules"
 
```
Or the same but omitting `sage --pip list | grep $PKG_NAME &&`.



---

archive/issue_comments_259515.json:
```json
{
    "body": "Replying to [comment:29 vbraun]:\n> Also breaks the buildbot script that assumes that `build/pkgs/*` has a corresponding log file etc. IMHO one dirent for one package is IMHO a better organization, stuffing multiple packages into lines of a single file doesn't scale (merge conflicts if its too popular).\n\n\nAn alternate version could introduce a new package type (\"pip\"?), with one directory for each of these packages, just containing `type` and `SPKG.txt`.",
    "created_at": "2015-09-16T21:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259515",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:29 vbraun]:
> Also breaks the buildbot script that assumes that `build/pkgs/*` has a corresponding log file etc. IMHO one dirent for one package is IMHO a better organization, stuffing multiple packages into lines of a single file doesn't scale (merge conflicts if its too popular).


An alternate version could introduce a new package type ("pip"?), with one directory for each of these packages, just containing `type` and `SPKG.txt`.



---

archive/issue_comments_259516.json:
```json
{
    "body": "Another benefit of making a file-per-package is that we could use them as requirements.txt files to pin versions if necessary. Or perhaps with directories as name/requirements.txt file.",
    "created_at": "2015-09-16T21:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259516",
    "user": "https://github.com/vbraun"
}
```

Another benefit of making a file-per-package is that we could use them as requirements.txt files to pin versions if necessary. Or perhaps with directories as name/requirements.txt file.



---

archive/issue_comments_259517.json:
```json
{
    "body": "Less fugly solution\n\n```\nsage --pip install --upgrade --force-reinstall <packagename>\n```",
    "created_at": "2015-09-16T21:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259517",
    "user": "https://github.com/vbraun"
}
```

Less fugly solution

```
sage --pip install --upgrade --force-reinstall <packagename>
```



---

archive/issue_comments_259518.json:
```json
{
    "body": "Replying to [comment:30 jhpalmieri]:\n> This might be a little ugly:\n> \n> ```\n> #!diff\n> diff --git a/build/make/install b/build/make/install\n> index 7469661..a164fc4 100755\n> --- a/build/make/install\n> +++ b/build/make/install\n> @@ -473,7 +473,7 @@ while read PKG_NAME; do\n>  \n>      # Add a target to remove the \"installed\" file for \"sage -f\"\n>      echo >&5 \"$PKG_NAME-clean:\"\n> -    echo >&5 \" sage --pip uninstall -y $PKG_NAME\"\n> +    echo >&5 \" sage --pip list | grep $PKG_NAME && sage --pip uninstall -y $PKG_NAME || :\"\n>      echo >&5\n>  done <\"$SAGE_ROOT/build/pkgs/piprules\"\n>  \n> ```\n> Or the same but omitting `sage --pip list | grep $PKG_NAME &&`.\n\n\nYou need to omit it since `pip list` does list `BeautifulSoup` and our package name is `beautifulsoup` (unless you grep without case sensitivity).",
    "created_at": "2015-09-16T22:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259518",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:30 jhpalmieri]:
> This might be a little ugly:
> 
> ```
> #!diff
> diff --git a/build/make/install b/build/make/install
> index 7469661..a164fc4 100755
> --- a/build/make/install
> +++ b/build/make/install
> @@ -473,7 +473,7 @@ while read PKG_NAME; do
>  
>      # Add a target to remove the "installed" file for "sage -f"
>      echo >&5 "$PKG_NAME-clean:"
> -    echo >&5 " sage --pip uninstall -y $PKG_NAME"
> +    echo >&5 " sage --pip list | grep $PKG_NAME && sage --pip uninstall -y $PKG_NAME || :"
>      echo >&5
>  done <"$SAGE_ROOT/build/pkgs/piprules"
>  
> ```
> Or the same but omitting `sage --pip list | grep $PKG_NAME &&`.


You need to omit it since `pip list` does list `BeautifulSoup` and our package name is `beautifulsoup` (unless you grep without case sensitivity).



---

archive/issue_comments_259519.json:
```json
{
    "body": "Replying to [comment:29 vbraun]:\n> Also breaks the buildbot script that assumes that `build/pkgs/*` has a corresponding log file\n\nDidn't you agree in #18993 that ordinary files in `build/pkgs` should be ignored?",
    "created_at": "2015-09-17T06:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259519",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:29 vbraun]:
> Also breaks the buildbot script that assumes that `build/pkgs/*` has a corresponding log file

Didn't you agree in #18993 that ordinary files in `build/pkgs` should be ignored?



---

archive/issue_comments_259520.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-19T09:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_259521.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-19T09:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259521",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_259522.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-19T11:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259522",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259523.json:
```json
{
    "body": "This is good for me. Volker?",
    "created_at": "2015-09-20T00:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259523",
    "user": "https://github.com/videlec"
}
```

This is good for me. Volker?



---

archive/issue_comments_259524.json:
```json
{
    "body": "Whats the point of whitelisting only specific packages? Including *trac*, which has no mathematical relevance nor any utility to non-developers (and for those only barely). Having special entries in the Sage package list only makes sense if there is a need for it, e.g. because they are dependencies of non-pip (optional) packages.\n\nIMHO if the user runs `sage -f packagename` and `packagename` is not a Sage package then either\n* always try to `pip install packagename`, or \n* finish with `pip search packagename` and, if it finds something, tell the user that it can be installed via `sage --pip`\n\nWe can merge the current to appease the cargo cultists and finally get rid of some of the broken packages, but its not entirely satisfactory.",
    "created_at": "2015-09-20T08:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259524",
    "user": "https://github.com/vbraun"
}
```

Whats the point of whitelisting only specific packages? Including *trac*, which has no mathematical relevance nor any utility to non-developers (and for those only barely). Having special entries in the Sage package list only makes sense if there is a need for it, e.g. because they are dependencies of non-pip (optional) packages.

IMHO if the user runs `sage -f packagename` and `packagename` is not a Sage package then either
* always try to `pip install packagename`, or 
* finish with `pip search packagename` and, if it finds something, tell the user that it can be installed via `sage --pip`

We can merge the current to appease the cargo cultists and finally get rid of some of the broken packages, but its not entirely satisfactory.



---

archive/issue_comments_259525.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-20T08:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259525",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_053277.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-20T17:03:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19187#event-53277"
}
```



---

archive/issue_comments_259526.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-20T17:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19187#issuecomment-259526",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
