# Issue 19195: Make tensor of CombinatorialFreeModule use cartesian_product, deprecate CartesianProduct_iters

archive/issues_018958.json:
```json
{
    "body": "The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. \n\nIt is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750\n\nThis will solve #18849 and probably #24900.\n\nPart of #15425: Meta-ticket: Cleanup cartesian products\n\nCC:  @nthiery @tscrim @yyyyx4 @videlec @jhpalmieri\n\nWork Issues: fix sage.rings.asymptotic\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton, Matthias Koeppe, ...\n\nBranch: public/19195\n\nStatus: needs_work\n\nDependencies: #34374\n\nCommit: 997cc7cc92bebcb491594ca586eadf5cfc591271\n\nIssue created by migration from https://trac.sagemath.org/ticket/19195\n\n",
    "created_at": "2015-09-13T02:06:58Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Make tensor of CombinatorialFreeModule use cartesian_product, deprecate CartesianProduct_iters",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19195",
    "user": "https://github.com/videlec"
}
```
The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. 

It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750

This will solve #18849 and probably #24900.

Part of #15425: Meta-ticket: Cleanup cartesian products

CC:  @nthiery @tscrim @yyyyx4 @videlec @jhpalmieri

Work Issues: fix sage.rings.asymptotic

Author: Frédéric Chapoton, Matthias Koeppe, ...

Branch: public/19195

Status: needs_work

Dependencies: #34374

Commit: 997cc7cc92bebcb491594ca586eadf5cfc591271

Issue created by migration from https://trac.sagemath.org/ticket/19195





---

archive/issue_comments_338207.json:
```json
{
    "body": "Changing branch from \"\" to \"public/19195\"",
    "created_at": "2018-02-03T20:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338207",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "public/19195"



---

archive/issue_comments_338208.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[1eac71e](https://github.com/sagemath/sagetrac-mirror/commit/1eac71e316a1d0c2d854092773bfa12af7330a8d)|`work on CartesianProduct_iter`|",
    "created_at": "2018-02-03T20:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338208",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[1eac71e](https://github.com/sagemath/sagetrac-mirror/commit/1eac71e316a1d0c2d854092773bfa12af7330a8d)|`work on CartesianProduct_iter`|



---

archive/issue_comments_338209.json:
```json
{
    "body": "Changing commit from \"\" to \"1eac71e316a1d0c2d854092773bfa12af7330a8d\"",
    "created_at": "2018-02-03T20:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338209",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "1eac71e316a1d0c2d854092773bfa12af7330a8d"



---

archive/issue_comments_338210.json:
```json
{
    "body": "Changing dependencies from \"#18411\" to \"\"",
    "created_at": "2018-02-03T20:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338210",
    "user": "https://github.com/fchapoton"
}
```

Changing dependencies from "#18411" to ""



---

archive/issue_events_068379.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-17T15:44:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68379"
}
```



---

archive/issue_events_068380.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68380"
}
```



---

archive/issue_events_068381.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68381"
}
```



---

archive/issue_comments_338211.json:
```json
{
    "body": "<a id='comment:3'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338211",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_068382.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68382"
}
```



---

archive/issue_events_068383.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68383"
}
```



---

archive/issue_events_068384.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68384"
}
```



---

archive/issue_events_068385.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68385"
}
```



---

archive/issue_events_068386.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68386"
}
```



---

archive/issue_events_068387.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T04:32:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68387"
}
```



---

archive/issue_comments_338212.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24).\n+\n+Part of #15425: Meta-ticket: Cleanup cartesian products\n``````\n",
    "created_at": "2022-08-10T21:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338212",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24).
+
+Part of #15425: Meta-ticket: Cleanup cartesian products
``````




---

archive/issue_events_068388.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "rename": {
        "from": "Make tensor of CombinatorialFreeModule use cartesian_product",
        "to": "Make tensor of CombinatorialFreeModule use cartesian_product, deprecate CartesianProduct_iters"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68388"
}
```



---

archive/issue_comments_338213.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24).\n+The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. \n+\n+It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750\n \n Part of #15425: Meta-ticket: Cleanup cartesian products\n``````\n",
    "created_at": "2022-08-10T21:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338213",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24).
+The last class to use `sage.combinat.cartesian_product.CartesianProduct_iters` is the `CombinatorialFreeModule`. 
+
+It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750
 
 Part of #15425: Meta-ticket: Cleanup cartesian products
``````




---

archive/issue_comments_338214.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[75bf2bd](https://github.com/sagemath/sagetrac-mirror/commit/75bf2bded5dec0e3d13f929b7a936b0a9e8d18fb)|`work on CartesianProduct_iter`|",
    "created_at": "2022-08-10T21:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338214",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[75bf2bd](https://github.com/sagemath/sagetrac-mirror/commit/75bf2bded5dec0e3d13f929b7a936b0a9e8d18fb)|`work on CartesianProduct_iter`|



---

archive/issue_comments_338215.json:
```json
{
    "body": "Changing commit from \"1eac71e316a1d0c2d854092773bfa12af7330a8d\" to \"75bf2bded5dec0e3d13f929b7a936b0a9e8d18fb\"",
    "created_at": "2022-08-10T21:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1eac71e316a1d0c2d854092773bfa12af7330a8d" to "75bf2bded5dec0e3d13f929b7a936b0a9e8d18fb"



---

archive/issue_comments_338216.json:
```json
{
    "body": "<a id='comment:11'></a>\nRebased. Some doctests need to be updated. In particular:\n\n```\n**********************************************************************\nFile \"src/sage/combinat/free_module.py\", line 1520, in sage.combinat.free_module.CombinatorialFreeModule.CombinatorialFreeModule_Tensor._coerce_map_from_\nFailed example:\n    S.an_element()\nExpected:\n    3*B[0] # B[-1] + 2*B[0] # B[0] + 2*B[0] # B[1]\n...\n    UserWarning: Sage is not able to determine whether the factors of this Cartesian product are finite. The lexicographic ordering might not go through all elements.\n    3*B[0] # B[-1] + B[0] # B[0] + 2*B[0] # B[1] + B[1] # B[1]\n```",
    "created_at": "2022-08-10T21:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338216",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Rebased. Some doctests need to be updated. In particular:

```
**********************************************************************
File "src/sage/combinat/free_module.py", line 1520, in sage.combinat.free_module.CombinatorialFreeModule.CombinatorialFreeModule_Tensor._coerce_map_from_
Failed example:
    S.an_element()
Expected:
    3*B[0] # B[-1] + 2*B[0] # B[0] + 2*B[0] # B[1]
...
    UserWarning: Sage is not able to determine whether the factors of this Cartesian product are finite. The lexicographic ordering might not go through all elements.
    3*B[0] # B[-1] + B[0] # B[0] + 2*B[0] # B[1] + B[1] # B[1]
```



---

archive/issue_comments_338217.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,6 @@\n \n It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750\n \n+This will solve #18849.\n+\n Part of #15425: Meta-ticket: Cleanup cartesian products\n``````\n",
    "created_at": "2022-08-10T21:43:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338217",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,6 @@
 
 It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750
 
+This will solve #18849.
+
 Part of #15425: Meta-ticket: Cleanup cartesian products
``````




---

archive/issue_comments_338218.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[2d81aa8](https://github.com/sagemath/sagetrac-mirror/commit/2d81aa8abd59adadff4a1d48a281f8da9450d12f)|`src/sage/combinat/cartesian_product.py: Deprecate CartesianProduct_iters`|",
    "created_at": "2022-08-11T04:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[2d81aa8](https://github.com/sagemath/sagetrac-mirror/commit/2d81aa8abd59adadff4a1d48a281f8da9450d12f)|`src/sage/combinat/cartesian_product.py: Deprecate CartesianProduct_iters`|



---

archive/issue_comments_338219.json:
```json
{
    "body": "Changing commit from \"75bf2bded5dec0e3d13f929b7a936b0a9e8d18fb\" to \"2d81aa8abd59adadff4a1d48a281f8da9450d12f\"",
    "created_at": "2022-08-11T04:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "75bf2bded5dec0e3d13f929b7a936b0a9e8d18fb" to "2d81aa8abd59adadff4a1d48a281f8da9450d12f"



---

archive/issue_comments_338220.json:
```json
{
    "body": "Changing author from \"\" to \"Fr\u00e9d\u00e9ric Chapoton, Matthias Koeppe\"",
    "created_at": "2022-08-11T04:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338220",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Frédéric Chapoton, Matthias Koeppe"



---

archive/issue_comments_338221.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [mkoeppe](#comment%3A11):\n> {{{\n>     UserWarning: Sage is not able to determine whether the factors of this Cartesian product are finite. The lexicographic ordering might not go through all elements.\n>     3*B[0] # B[-1] + B[0] # B[0] + 2*B[0] # B[1] + B[1] # B[1]\n> }}}\n\n\nRelated recent discussion in #33287",
    "created_at": "2022-08-11T05:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338221",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Replying to [mkoeppe](#comment%3A11):
> {{{
>     UserWarning: Sage is not able to determine whether the factors of this Cartesian product are finite. The lexicographic ordering might not go through all elements.
>     3*B[0] # B[-1] + B[0] # B[0] + 2*B[0] # B[1] + B[1] # B[1]
> }}}


Related recent discussion in #33287



---

archive/issue_comments_338222.json:
```json
{
    "body": "<a id='comment:16'></a>\nI think this warning (from `Sets.CartesianProducts.ParentMethods.__iter__`, added in #18411) is useless and is best removed. It's essentially warning that it may be constructing an infinite order of the wrong order type. But this is irrelevant for any algorithm",
    "created_at": "2022-08-11T05:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338222",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I think this warning (from `Sets.CartesianProducts.ParentMethods.__iter__`, added in #18411) is useless and is best removed. It's essentially warning that it may be constructing an infinite order of the wrong order type. But this is irrelevant for any algorithm



---

archive/issue_comments_338223.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [mkoeppe](#comment%3A16):\n> I think this warning (from `Sets.CartesianProducts.ParentMethods.__iter__`, added in #18411) is useless and is best removed. It's essentially warning that it may be constructing an infinite order of the wrong order type. But this is irrelevant for any algorithm\n\n\nI take this back. I now propose that instead of issuing a warning, Cartesian products of possibly infinite factors should be enumerated using the existing, poorly named function `sage.misc.mrange.cantor_product` (enumeration in the order of increasing sums-of-ranks).",
    "created_at": "2022-08-11T18:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338223",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Replying to [mkoeppe](#comment%3A16):
> I think this warning (from `Sets.CartesianProducts.ParentMethods.__iter__`, added in #18411) is useless and is best removed. It's essentially warning that it may be constructing an infinite order of the wrong order type. But this is irrelevant for any algorithm


I take this back. I now propose that instead of issuing a warning, Cartesian products of possibly infinite factors should be enumerated using the existing, poorly named function `sage.misc.mrange.cantor_product` (enumeration in the order of increasing sums-of-ranks).



---

archive/issue_comments_338224.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n|[8017fed](https://github.com/sagemath/sagetrac-mirror/commit/8017fed68ac3df9ca4cd5e8a2f3bfcdc3df17615)|`Sets.CartesianProducts.ParentMethods.__iter__: Use cantor_product if factors other than first are infinite`|",
    "created_at": "2022-08-11T18:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
|[8017fed](https://github.com/sagemath/sagetrac-mirror/commit/8017fed68ac3df9ca4cd5e8a2f3bfcdc3df17615)|`Sets.CartesianProducts.ParentMethods.__iter__: Use cantor_product if factors other than first are infinite`|



---

archive/issue_comments_338225.json:
```json
{
    "body": "Changing commit from \"2d81aa8abd59adadff4a1d48a281f8da9450d12f\" to \"8017fed68ac3df9ca4cd5e8a2f3bfcdc3df17615\"",
    "created_at": "2022-08-11T18:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2d81aa8abd59adadff4a1d48a281f8da9450d12f" to "8017fed68ac3df9ca4cd5e8a2f3bfcdc3df17615"



---

archive/issue_comments_338226.json:
```json
{
    "body": "Changing commit from \"8017fed68ac3df9ca4cd5e8a2f3bfcdc3df17615\" to \"97a381b413421e69f19d0a8ff995259b0d5bea14\"",
    "created_at": "2022-08-11T18:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8017fed68ac3df9ca4cd5e8a2f3bfcdc3df17615" to "97a381b413421e69f19d0a8ff995259b0d5bea14"



---

archive/issue_comments_338227.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n|[97a381b](https://github.com/sagemath/sagetrac-mirror/commit/97a381b413421e69f19d0a8ff995259b0d5bea14)|`Sets.CartesianProducts.ParentMethods.__iter__: Use cantor_product if factors other than first are infinite`|",
    "created_at": "2022-08-11T18:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338227",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
|[97a381b](https://github.com/sagemath/sagetrac-mirror/commit/97a381b413421e69f19d0a8ff995259b0d5bea14)|`Sets.CartesianProducts.ParentMethods.__iter__: Use cantor_product if factors other than first are infinite`|



---

archive/issue_comments_338228.json:
```json
{
    "body": "Changing commit from \"97a381b413421e69f19d0a8ff995259b0d5bea14\" to \"ea7af8b2c9174ad4ac80b0ffd12a9d563094e96b\"",
    "created_at": "2022-08-11T18:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338228",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "97a381b413421e69f19d0a8ff995259b0d5bea14" to "ea7af8b2c9174ad4ac80b0ffd12a9d563094e96b"



---

archive/issue_comments_338229.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[ea7af8b](https://github.com/sagemath/sagetrac-mirror/commit/ea7af8b2c9174ad4ac80b0ffd12a9d563094e96b)|`src/sage/combinat/free_module.py: Update doctests`|",
    "created_at": "2022-08-11T18:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[ea7af8b](https://github.com/sagemath/sagetrac-mirror/commit/ea7af8b2c9174ad4ac80b0ffd12a9d563094e96b)|`src/sage/combinat/free_module.py: Update doctests`|



---

archive/issue_comments_338230.json:
```json
{
    "body": "<a id='comment:22'></a>\nDoctest failures in 2 files remain:\n\n```\nsage -t --long --random-seed=231229664758049651431332547293032544509 src/sage/algebras/steenrod/steenrod_algebra.py  # Timed out\nsage -t --long --random-seed=231229664758049651431332547293032544509 src/sage/homology/hochschild_complex.py  # 10 doctests failed\n```",
    "created_at": "2022-08-11T21:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338230",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Doctest failures in 2 files remain:

```
sage -t --long --random-seed=231229664758049651431332547293032544509 src/sage/algebras/steenrod/steenrod_algebra.py  # Timed out
sage -t --long --random-seed=231229664758049651431332547293032544509 src/sage/homology/hochschild_complex.py  # 10 doctests failed
```



---

archive/issue_comments_338231.json:
```json
{
    "body": "<a id='comment:23'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|\n|[6e81270](https://github.com/sagemath/sagetrac-mirror/commit/6e8127049cb0014d574db6c3b39615cdac8128d0)|`src/sage/homology/hochschild_complex.py: Update doctest output (an_element changed)`|",
    "created_at": "2022-08-11T21:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338231",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
|[6e81270](https://github.com/sagemath/sagetrac-mirror/commit/6e8127049cb0014d574db6c3b39615cdac8128d0)|`src/sage/homology/hochschild_complex.py: Update doctest output (an_element changed)`|



---

archive/issue_comments_338232.json:
```json
{
    "body": "Changing commit from \"ea7af8b2c9174ad4ac80b0ffd12a9d563094e96b\" to \"6e8127049cb0014d574db6c3b39615cdac8128d0\"",
    "created_at": "2022-08-11T21:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338232",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ea7af8b2c9174ad4ac80b0ffd12a9d563094e96b" to "6e8127049cb0014d574db6c3b39615cdac8128d0"



---

archive/issue_comments_338233.json:
```json
{
    "body": "<a id='comment:24'></a>\nOnly one file, `src/sage/algebras/steenrod/steenrod_algebra.py` needs a closer look by experts:\n\n```\nUserWarning: Testing equality of infinite sets which will not end in case of equality\n\n    TypeError: <class 'sage.sets.set_from_iterator.EnumeratedSetFromIterator_with_category'> is not hashable and does not implement _cache_key()\n    ------------------------------------------------------------\n    The following tests failed: _test_antipode\n\n(times out)\n```",
    "created_at": "2022-08-11T21:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338233",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Only one file, `src/sage/algebras/steenrod/steenrod_algebra.py` needs a closer look by experts:

```
UserWarning: Testing equality of infinite sets which will not end in case of equality

    TypeError: <class 'sage.sets.set_from_iterator.EnumeratedSetFromIterator_with_category'> is not hashable and does not implement _cache_key()
    ------------------------------------------------------------
    The following tests failed: _test_antipode

(times out)
```



---

archive/issue_events_068389.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "rename": {
        "from": "Make tensor of CombinatorialFreeModule use cartesian_product, deprecate CartesianProduct_iters",
        "to": "Make tensor of CombinatorialFreeModule use cartesian_product, deprecate CartesianProduct_iters, use cantor_product for products of infinite sets"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68389"
}
```



---

archive/issue_comments_338234.json:
```json
{
    "body": "<a id='comment:26'></a>\nThis is the doctest that times out:\n\n```\nsage: d = a.change_basis('comm_long'); d.coproduct() ## line 3392 ##\n```\n\n`sage.sets.set_from_iterator.EnumeratedSetFromIterator.__eq__` gives the warning and then indeed times out trying to compare the following sets:\n\n```\n(Pdb) p self\nbasis key family of mod 2 Steenrod algebra, pst_revz basis\n(Pdb) p other\nbasis key family of mod 2 Steenrod algebra, comm_revz_long basis\n(Pdb) p type(self)\n<class 'sage.sets.set_from_iterator.EnumeratedSetFromIterator_with_category'>\n(Pdb) p type(other)\n<class 'sage.sets.set_from_iterator.EnumeratedSetFromIterator_with_category'>\n```",
    "created_at": "2022-08-12T06:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338234",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
This is the doctest that times out:

```
sage: d = a.change_basis('comm_long'); d.coproduct() ## line 3392 ##
```

`sage.sets.set_from_iterator.EnumeratedSetFromIterator.__eq__` gives the warning and then indeed times out trying to compare the following sets:

```
(Pdb) p self
basis key family of mod 2 Steenrod algebra, pst_revz basis
(Pdb) p other
basis key family of mod 2 Steenrod algebra, comm_revz_long basis
(Pdb) p type(self)
<class 'sage.sets.set_from_iterator.EnumeratedSetFromIterator_with_category'>
(Pdb) p type(other)
<class 'sage.sets.set_from_iterator.EnumeratedSetFromIterator_with_category'>
```



---

archive/issue_comments_338235.json:
```json
{
    "body": "<a id='comment:27'></a>\nThis equality test is needed by the `UniqueRepresentation` behavior of `sage.sets.cartesian_product.CartesianProduct`",
    "created_at": "2022-08-12T06:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338235",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
This equality test is needed by the `UniqueRepresentation` behavior of `sage.sets.cartesian_product.CartesianProduct`



---

archive/issue_comments_338236.json:
```json
{
    "body": "<a id='comment:28'></a>\nUnfortunately, while I see the doctest failure, I can't replicate it in an interactive session, so it's hard to debug. I think the problem arises in the lines\n\n```\n            for (a,b), coeff in x:\n                result.append((tensor((A._change_basis_on_basis(a, basis),\n                                       A._change_basis_on_basis(b, basis))),coeff))\n\n```\n(lines 1376-8).",
    "created_at": "2022-08-12T18:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338236",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>
Unfortunately, while I see the doctest failure, I can't replicate it in an interactive session, so it's hard to debug. I think the problem arises in the lines

```
            for (a,b), coeff in x:
                result.append((tensor((A._change_basis_on_basis(a, basis),
                                       A._change_basis_on_basis(b, basis))),coeff))

```
(lines 1376-8).



---

archive/issue_comments_338237.json:
```json
{
    "body": "<a id='comment:29'></a>\nHere's a minimal reproducer:\n\n```\n            sage: SteenrodAlgebra(basis='pst').Sq(0,1).coproduct()\n            sage: a = Sq(2)\n            sage: d = a.change_basis('comm_long'); d.coproduct()\n```",
    "created_at": "2022-08-12T20:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338237",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Here's a minimal reproducer:

```
            sage: SteenrodAlgebra(basis='pst').Sq(0,1).coproduct()
            sage: a = Sq(2)
            sage: d = a.change_basis('comm_long'); d.coproduct()
```



---

archive/issue_comments_338238.json:
```json
{
    "body": "<a id='comment:30'></a>\nThe bases for \"mod 2 Steenrod algebra, pst_revz basis\" and \"mod 2 Steenrod algebra, comm_revz_long basis\" have the same indexing sets, although the corresponding algebra elements are different. Therefore the same will be true for their tensor squares. As a result, I'm not sure what to do about this.",
    "created_at": "2022-08-12T20:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338238",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>
The bases for "mod 2 Steenrod algebra, pst_revz basis" and "mod 2 Steenrod algebra, comm_revz_long basis" have the same indexing sets, although the corresponding algebra elements are different. Therefore the same will be true for their tensor squares. As a result, I'm not sure what to do about this.



---

archive/issue_comments_338239.json:
```json
{
    "body": "<a id='comment:31'></a>\n\n```\nsage: s_pst = SteenrodAlgebra(basis='pst')\nsage: s_comm_long = SteenrodAlgebra(basis='comm_long')\nsage: s_pst.basis()\nLazy family (Term map from basis key family of mod 2 Steenrod algebra, pst_revz basis to mod 2 Steenrod algebra, pst_revz basis(i))_{i in basis key family of mod 2 Steenrod algebra, pst_revz basis}\nsage: s_comm_long.basis()\nLazy family (Term map from basis key family of mod 2 Steenrod algebra, comm_revz_long basis to mod 2 Steenrod algebra, comm_revz_long basis(i))_{i in basis key family of mod 2 Steenrod algebra, comm_revz_long basis}\nsage: s_pst.basis() == s_comm_long.basis()\n/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/sets/set_from_iterator.py:311: UserWarning: Testing equality of infinite sets basis key family of mod 2 Steenrod algebra, pst_revz basis and basis key family of mod 2 Steenrod algebra, comm_revz_long basis,  which will not end in case of equality\n```",
    "created_at": "2022-08-12T20:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338239",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>

```
sage: s_pst = SteenrodAlgebra(basis='pst')
sage: s_comm_long = SteenrodAlgebra(basis='comm_long')
sage: s_pst.basis()
Lazy family (Term map from basis key family of mod 2 Steenrod algebra, pst_revz basis to mod 2 Steenrod algebra, pst_revz basis(i))_{i in basis key family of mod 2 Steenrod algebra, pst_revz basis}
sage: s_comm_long.basis()
Lazy family (Term map from basis key family of mod 2 Steenrod algebra, comm_revz_long basis to mod 2 Steenrod algebra, comm_revz_long basis(i))_{i in basis key family of mod 2 Steenrod algebra, comm_revz_long basis}
sage: s_pst.basis() == s_comm_long.basis()
/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/sets/set_from_iterator.py:311: UserWarning: Testing equality of infinite sets basis key family of mod 2 Steenrod algebra, pst_revz basis and basis key family of mod 2 Steenrod algebra, comm_revz_long basis,  which will not end in case of equality
```



---

archive/issue_comments_338240.json:
```json
{
    "body": "<a id='comment:32'></a>\nIt seems we either need a better `__eq__` for `LazyFamily` in general, or just more specific `Family` implementation for these basis key families",
    "created_at": "2022-08-12T20:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338240",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
It seems we either need a better `__eq__` for `LazyFamily` in general, or just more specific `Family` implementation for these basis key families



---

archive/issue_comments_338241.json:
```json
{
    "body": "Changing commit from \"6e8127049cb0014d574db6c3b39615cdac8128d0\" to \"2a17576cdff070ab24e22cd5c317987e701e1071\"",
    "created_at": "2022-08-12T20:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6e8127049cb0014d574db6c3b39615cdac8128d0" to "2a17576cdff070ab24e22cd5c317987e701e1071"



---

archive/issue_comments_338242.json:
```json
{
    "body": "<a id='comment:33'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|\n|[2a17576](https://github.com/sagemath/sagetrac-mirror/commit/2a17576cdff070ab24e22cd5c317987e701e1071)|`LazyFamily.__eq__: Check hashes first, then check repr, then check the possibly infinite set of keys`|",
    "created_at": "2022-08-12T20:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
|[2a17576](https://github.com/sagemath/sagetrac-mirror/commit/2a17576cdff070ab24e22cd5c317987e701e1071)|`LazyFamily.__eq__: Check hashes first, then check repr, then check the possibly infinite set of keys`|



---

archive/issue_comments_338243.json:
```json
{
    "body": "<a id='comment:34'></a>\nThis fixes the comparison in[comment:31](#comment%3A31), but not the original problem",
    "created_at": "2022-08-12T21:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338243",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
This fixes the comparison in[comment:31](#comment%3A31), but not the original problem



---

archive/issue_comments_338244.json:
```json
{
    "body": "<a id='comment:35'></a>\n\n```\nsage: s_pst = SteenrodAlgebra(basis='pst')\nsage: s_comm_long = SteenrodAlgebra(basis='comm_long')\nsage: s_pst.basis().keys() == s_comm_long.basis().keys()\n/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/sets/set_from_iterator.py:311: UserWarning: Testing equality of infinite sets basis key family of mod 2 Steenrod algebra, pst_revz basis and basis key family of mod 2 Steenrod algebra, comm_revz_long basis,  which will not end in case of equality\n```",
    "created_at": "2022-08-12T21:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338244",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>

```
sage: s_pst = SteenrodAlgebra(basis='pst')
sage: s_comm_long = SteenrodAlgebra(basis='comm_long')
sage: s_pst.basis().keys() == s_comm_long.basis().keys()
/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/sets/set_from_iterator.py:311: UserWarning: Testing equality of infinite sets basis key family of mod 2 Steenrod algebra, pst_revz basis and basis key family of mod 2 Steenrod algebra, comm_revz_long basis,  which will not end in case of equality
```



---

archive/issue_comments_338245.json:
```json
{
    "body": "<a id='comment:36'></a>\nRight, these sets of keys are the same.",
    "created_at": "2022-08-12T21:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338245",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>
Right, these sets of keys are the same.



---

archive/issue_comments_338246.json:
```json
{
    "body": "<a id='comment:37'></a>\nAlthough they have different string representations, so I don't know why the latest change doesn't catch it.",
    "created_at": "2022-08-12T22:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338246",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'></a>
Although they have different string representations, so I don't know why the latest change doesn't catch it.



---

archive/issue_comments_338247.json:
```json
{
    "body": "<a id='comment:38'></a>\nThe latest change was for `LazyFamily`, not for `EnumeratedSetFromIterator`.",
    "created_at": "2022-08-12T22:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338247",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
The latest change was for `LazyFamily`, not for `EnumeratedSetFromIterator`.



---

archive/issue_comments_338248.json:
```json
{
    "body": "<a id='comment:39'></a>\n`EnumeratedSetFromIterator` does not look at names; `__eq__` is equality as sets",
    "created_at": "2022-08-12T22:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338248",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
`EnumeratedSetFromIterator` does not look at names; `__eq__` is equality as sets



---

archive/issue_comments_338249.json:
```json
{
    "body": "<a id='comment:40'></a>\nThis fixes the problem for me, but I don't know if it's the right thing to do:\n\n```diff\ndiff --git a/src/sage/sets/set_from_iterator.py b/src/sage/sets/set_from_iterator.py\nindex 3a2360383e..90218aa426 100644\n--- a/src/sage/sets/set_from_iterator.py\n+++ b/src/sage/sets/set_from_iterator.py\n@@ -297,6 +297,8 @@ class EnumeratedSetFromIterator(Parent):\n             True\n         \"\"\"\n         if isinstance(other, EnumeratedSetFromIterator):\n+            if repr(self) != repr(other):\n+                return False\n             # trick to allow equality between infinite sets\n             # this assume that the function does not return randomized data!\n             if (self._func == other._func and\n```",
    "created_at": "2022-08-12T22:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338249",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>
This fixes the problem for me, but I don't know if it's the right thing to do:

```diff
diff --git a/src/sage/sets/set_from_iterator.py b/src/sage/sets/set_from_iterator.py
index 3a2360383e..90218aa426 100644
--- a/src/sage/sets/set_from_iterator.py
+++ b/src/sage/sets/set_from_iterator.py
@@ -297,6 +297,8 @@ class EnumeratedSetFromIterator(Parent):
             True
         """
         if isinstance(other, EnumeratedSetFromIterator):
+            if repr(self) != repr(other):
+                return False
             # trick to allow equality between infinite sets
             # this assume that the function does not return randomized data!
             if (self._func == other._func and
```



---

archive/issue_comments_338250.json:
```json
{
    "body": "<a id='comment:41'></a>\nIf we want to go in the direction (making the factors \"less unique\"), I'd think we could give `EnumeratedSetFromIterator` an additional argument `unique_tag` (default None), which would be compared (instead of repr)",
    "created_at": "2022-08-12T22:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338250",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
If we want to go in the direction (making the factors "less unique"), I'd think we could give `EnumeratedSetFromIterator` an additional argument `unique_tag` (default None), which would be compared (instead of repr)



---

archive/issue_comments_338251.json:
```json
{
    "body": "<a id='comment:42'></a>\nThey have a \"name\" attribute already; we could use that. Edit: a \"name\" argument, not an attribute.",
    "created_at": "2022-08-12T22:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338251",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'></a>
They have a "name" attribute already; we could use that. Edit: a "name" argument, not an attribute.



---

archive/issue_comments_338252.json:
```json
{
    "body": "<a id='comment:43'></a>\nOf course that boils down to use repr.",
    "created_at": "2022-08-12T22:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338252",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:43'></a>
Of course that boils down to use repr.



---

archive/issue_comments_338253.json:
```json
{
    "body": "<a id='comment:44'></a>\n\n```diff\ndiff --git a/src/sage/sets/set_from_iterator.py b/src/sage/sets/set_from_iterator.py\nindex 3a2360383e..dbb448b829 100644\n--- a/src/sage/sets/set_from_iterator.py\n+++ b/src/sage/sets/set_from_iterator.py\n@@ -297,6 +297,9 @@ class EnumeratedSetFromIterator(Parent):\n             True\n         \"\"\"\n         if isinstance(other, EnumeratedSetFromIterator):\n+            if hasattr(self, '__custom_name') or hasattr(other, '__custom_name'):\n+                if repr(self) != repr(other):\n+                    return False\n             # trick to allow equality between infinite sets\n             # this assume that the function does not return randomized data!\n             if (self._func == other._func and\n```",
    "created_at": "2022-08-12T22:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338253",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>

```diff
diff --git a/src/sage/sets/set_from_iterator.py b/src/sage/sets/set_from_iterator.py
index 3a2360383e..dbb448b829 100644
--- a/src/sage/sets/set_from_iterator.py
+++ b/src/sage/sets/set_from_iterator.py
@@ -297,6 +297,9 @@ class EnumeratedSetFromIterator(Parent):
             True
         """
         if isinstance(other, EnumeratedSetFromIterator):
+            if hasattr(self, '__custom_name') or hasattr(other, '__custom_name'):
+                if repr(self) != repr(other):
+                    return False
             # trick to allow equality between infinite sets
             # this assume that the function does not return randomized data!
             if (self._func == other._func and
```



---

archive/issue_comments_338254.json:
```json
{
    "body": "<a id='comment:45'></a>\nI think this is too dangerous, it's breaking the extensionality of sets",
    "created_at": "2022-08-12T22:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338254",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
I think this is too dangerous, it's breaking the extensionality of sets



---

archive/issue_comments_338255.json:
```json
{
    "body": "<a id='comment:46'></a>\nI think a solution may be to change `sage.sets.cartesian_product.CartesianProduct` so that it only uses `UniqueRepresentation` if it can safely do so",
    "created_at": "2022-08-12T22:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338255",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>
I think a solution may be to change `sage.sets.cartesian_product.CartesianProduct` so that it only uses `UniqueRepresentation` if it can safely do so



---

archive/issue_comments_338256.json:
```json
{
    "body": "Changing commit from \"2a17576cdff070ab24e22cd5c317987e701e1071\" to \"377d0bfc11130123c21a686f21325d4581ffb774\"",
    "created_at": "2022-08-12T22:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2a17576cdff070ab24e22cd5c317987e701e1071" to "377d0bfc11130123c21a686f21325d4581ffb774"



---

archive/issue_comments_338257.json:
```json
{
    "body": "<a id='comment:47'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|\n|[377d0bf](https://github.com/sagemath/sagetrac-mirror/commit/377d0bfc11130123c21a686f21325d4581ffb774)|`src/sage/sets/cartesian_product.py: Do not use UniqueRepresentation when a factor is an EnumeratedSetFromIterator`|",
    "created_at": "2022-08-12T22:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
|[377d0bf](https://github.com/sagemath/sagetrac-mirror/commit/377d0bfc11130123c21a686f21325d4581ffb774)|`src/sage/sets/cartesian_product.py: Do not use UniqueRepresentation when a factor is an EnumeratedSetFromIterator`|



---

archive/issue_comments_338258.json:
```json
{
    "body": "<a id='comment:48'></a>\nThis fixes[comment:29](#comment%3A29). Haven't checked yet if it breaks anything",
    "created_at": "2022-08-12T22:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338258",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
This fixes[comment:29](#comment%3A29). Haven't checked yet if it breaks anything



---

archive/issue_comments_338259.json:
```json
{
    "body": "<a id='comment:49'></a>\nThis produces a lot of doctest failures:\n\n```\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/asymptotic_expansion_generators.py  # 86 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/symbolic/expression.pyx  # 3 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/doctest/forker.py  # 3 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/homology/hochschild_complex.py  # 2 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/categories/pushout.py  # 6 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/asymptotic_ring.py  # 236 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/algebras/hecke_algebras/ariki_koike_algebra.py  # 13 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/term_monoid.py  # 99 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/algebras/askey_wilson.py  # 2 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/growth_group.py  # 114 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/combinat/root_system/extended_affine_weyl_group.py  # 404 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/growth_group_cartesian.py  # 118 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/symbolic/ring.pyx  # 5 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/categories/sets_cat.py  # 2 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/algebras/schur_algebra.py  # 1 doctest failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/categories/magmas.py  # 4 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/doc/en/thematic_tutorials/lie/affine.rst  # 1 doctest failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/groups/group_semidirect_product.py  # 35 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/sets/family.py  # 3 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/big_oh.py  # 2 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/sets/cartesian_product.py  # 2 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/combinat/posets/cartesian_product.py  # 48 doctests failed\nsage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/combinat/cartesian_product.py  # 2 doctests failed\n```",
    "created_at": "2022-08-12T23:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338259",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:49'></a>
This produces a lot of doctest failures:

```
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/asymptotic_expansion_generators.py  # 86 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/symbolic/expression.pyx  # 3 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/doctest/forker.py  # 3 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/homology/hochschild_complex.py  # 2 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/categories/pushout.py  # 6 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/asymptotic_ring.py  # 236 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/algebras/hecke_algebras/ariki_koike_algebra.py  # 13 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/term_monoid.py  # 99 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/algebras/askey_wilson.py  # 2 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/growth_group.py  # 114 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/combinat/root_system/extended_affine_weyl_group.py  # 404 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/asymptotic/growth_group_cartesian.py  # 118 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/symbolic/ring.pyx  # 5 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/categories/sets_cat.py  # 2 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/algebras/schur_algebra.py  # 1 doctest failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/categories/magmas.py  # 4 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/doc/en/thematic_tutorials/lie/affine.rst  # 1 doctest failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/groups/group_semidirect_product.py  # 35 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/sets/family.py  # 3 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/rings/big_oh.py  # 2 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/sets/cartesian_product.py  # 2 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/combinat/posets/cartesian_product.py  # 48 doctests failed
sage -t --long --random-seed=269458505477710295233910752449959854719 src/sage/combinat/cartesian_product.py  # 2 doctests failed
```



---

archive/issue_comments_338260.json:
```json
{
    "body": "<a id='comment:50'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|\n|[6d5f261](https://github.com/sagemath/sagetrac-mirror/commit/6d5f261a6e6cfcd8a49b9f5af2ae0bfb21b1201e)|`src/sage/sets/cartesian_product.py: Do not use UniqueRepresentation when a factor is an EnumeratedSetFromIterator`|",
    "created_at": "2022-08-12T23:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338260",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
|[6d5f261](https://github.com/sagemath/sagetrac-mirror/commit/6d5f261a6e6cfcd8a49b9f5af2ae0bfb21b1201e)|`src/sage/sets/cartesian_product.py: Do not use UniqueRepresentation when a factor is an EnumeratedSetFromIterator`|



---

archive/issue_comments_338261.json:
```json
{
    "body": "Changing commit from \"377d0bfc11130123c21a686f21325d4581ffb774\" to \"6d5f261a6e6cfcd8a49b9f5af2ae0bfb21b1201e\"",
    "created_at": "2022-08-12T23:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338261",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "377d0bfc11130123c21a686f21325d4581ffb774" to "6d5f261a6e6cfcd8a49b9f5af2ae0bfb21b1201e"



---

archive/issue_comments_338262.json:
```json
{
    "body": "<a id='comment:51'></a>\nHere's a simpler version that also creates such failures",
    "created_at": "2022-08-12T23:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338262",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>
Here's a simpler version that also creates such failures



---

archive/issue_comments_338263.json:
```json
{
    "body": "<a id='comment:52'></a>\nBut hey, no failures in `algebras/steenrod`, `homology,` or `topology`, so it's all good with me. ;)",
    "created_at": "2022-08-13T00:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338263",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'></a>
But hey, no failures in `algebras/steenrod`, `homology,` or `topology`, so it's all good with me. ;)



---

archive/issue_comments_338264.json:
```json
{
    "body": "<a id='comment:53'></a>\nOK some of the failures were already present in 2a17576 (comment:33)",
    "created_at": "2022-08-13T00:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338264",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
OK some of the failures were already present in 2a17576 (comment:33)



---

archive/issue_comments_338265.json:
```json
{
    "body": "<a id='comment:54'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n|[e969448](https://github.com/sagemath/sagetrac-mirror/commit/e9694481061f271fbbedd3434629568ccf0b5928)|`LazyFamily.__eq__: Check hashes of the index sets only, not the hashes of self, other`|",
    "created_at": "2022-08-13T00:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
|[e969448](https://github.com/sagemath/sagetrac-mirror/commit/e9694481061f271fbbedd3434629568ccf0b5928)|`LazyFamily.__eq__: Check hashes of the index sets only, not the hashes of self, other`|



---

archive/issue_comments_338266.json:
```json
{
    "body": "Changing commit from \"6d5f261a6e6cfcd8a49b9f5af2ae0bfb21b1201e\" to \"e9694481061f271fbbedd3434629568ccf0b5928\"",
    "created_at": "2022-08-13T00:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6d5f261a6e6cfcd8a49b9f5af2ae0bfb21b1201e" to "e9694481061f271fbbedd3434629568ccf0b5928"



---

archive/issue_comments_338267.json:
```json
{
    "body": "<a id='comment:55'></a>\nI'm still seeing a lot of error messages of the form\n\n```\nFile \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.7.beta8/src/sage/rings/asymptotic/growth_group_cartesian.py\", line 320, in __init__\nGenericGrowthGroup.__init__(self, sets[0], Vars, self.category(), **kwds)\nTypeError: __init__() got an unexpected keyword argument 'flatten'\n```\nAlso a few in `pushout.py`:\n\n```\nFile \"sage/misc/classcall_metaclass.pyx\", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__\n return cls.classcall(cls, *args, **kwds)\nTypeError: __classcall__() missing 1 required positional argument: 'category'\n```",
    "created_at": "2022-08-13T02:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338267",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:55'></a>
I'm still seeing a lot of error messages of the form

```
File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.7.beta8/src/sage/rings/asymptotic/growth_group_cartesian.py", line 320, in __init__
GenericGrowthGroup.__init__(self, sets[0], Vars, self.category(), **kwds)
TypeError: __init__() got an unexpected keyword argument 'flatten'
```
Also a few in `pushout.py`:

```
File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__
 return cls.classcall(cls, *args, **kwds)
TypeError: __classcall__() missing 1 required positional argument: 'category'
```



---

archive/issue_comments_338268.json:
```json
{
    "body": "<a id='comment:56'></a>\nhttps://github.com/sagemath/sagetrac-mirror/actions/runs/2850051513 only sees the error in steenrod with e969448",
    "created_at": "2022-08-13T03:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338268",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>
https://github.com/sagemath/sagetrac-mirror/actions/runs/2850051513 only sees the error in steenrod with e969448



---

archive/issue_comments_338269.json:
```json
{
    "body": "<a id='comment:57'></a>\nNote I backed out 6d5f261",
    "created_at": "2022-08-13T03:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338269",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>
Note I backed out 6d5f261



---

archive/issue_comments_338270.json:
```json
{
    "body": "Changing commit from \"e9694481061f271fbbedd3434629568ccf0b5928\" to \"3de34ae68444f6a883a9e268f34f792e38042e0c\"",
    "created_at": "2022-08-13T04:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e9694481061f271fbbedd3434629568ccf0b5928" to "3de34ae68444f6a883a9e268f34f792e38042e0c"



---

archive/issue_comments_338271.json:
```json
{
    "body": "<a id='comment:58'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|\n|[3de34ae](https://github.com/sagemath/sagetrac-mirror/commit/3de34ae68444f6a883a9e268f34f792e38042e0c)|`src/sage/sets/cartesian_product.py: Do not use UniqueRepresentation when a factor is an EnumeratedSetFromIterator`|",
    "created_at": "2022-08-13T04:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338271",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
|[3de34ae](https://github.com/sagemath/sagetrac-mirror/commit/3de34ae68444f6a883a9e268f34f792e38042e0c)|`src/sage/sets/cartesian_product.py: Do not use UniqueRepresentation when a factor is an EnumeratedSetFromIterator`|



---

archive/issue_comments_338272.json:
```json
{
    "body": "<a id='comment:59'></a>\nOK here's a better version of the same approach, it passes all tests for me",
    "created_at": "2022-08-13T04:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338272",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
OK here's a better version of the same approach, it passes all tests for me



---

archive/issue_comments_338273.json:
```json
{
    "body": "Changing commit from \"3de34ae68444f6a883a9e268f34f792e38042e0c\" to \"c30e0da0df8e6798f78704876b3f636097f32dfa\"",
    "created_at": "2022-08-13T04:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3de34ae68444f6a883a9e268f34f792e38042e0c" to "c30e0da0df8e6798f78704876b3f636097f32dfa"



---

archive/issue_comments_338274.json:
```json
{
    "body": "<a id='comment:60'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|\n|[c30e0da](https://github.com/sagemath/sagetrac-mirror/commit/c30e0da0df8e6798f78704876b3f636097f32dfa)|`src/sage/sets/cartesian_product.py: Do use UniqueRepresentation when sets are finite; add tests`|",
    "created_at": "2022-08-13T04:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
|[c30e0da](https://github.com/sagemath/sagetrac-mirror/commit/c30e0da0df8e6798f78704876b3f636097f32dfa)|`src/sage/sets/cartesian_product.py: Do use UniqueRepresentation when sets are finite; add tests`|



---

archive/issue_comments_338275.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-13T04:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338275",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_338276.json:
```json
{
    "body": "Changing commit from \"c30e0da0df8e6798f78704876b3f636097f32dfa\" to \"1c303121d6e407fd0906f745826fc37b4db3bf58\"",
    "created_at": "2022-08-13T04:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c30e0da0df8e6798f78704876b3f636097f32dfa" to "1c303121d6e407fd0906f745826fc37b4db3bf58"



---

archive/issue_comments_338277.json:
```json
{
    "body": "<a id='comment:62'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|\n|[1c30312](https://github.com/sagemath/sagetrac-mirror/commit/1c303121d6e407fd0906f745826fc37b4db3bf58)|`src/sage/categories/sets_cat.py: Update documentation - cantor_product refines with revlex`|",
    "created_at": "2022-08-13T04:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
|[1c30312](https://github.com/sagemath/sagetrac-mirror/commit/1c303121d6e407fd0906f745826fc37b4db3bf58)|`src/sage/categories/sets_cat.py: Update documentation - cantor_product refines with revlex`|



---

archive/issue_comments_338278.json:
```json
{
    "body": "<a id='comment:63'></a>\nThank you for working on this. It definitely would be good to have things more centralized. Hopefully these comments are fairly simple to incorporate.\n\nI think this is a very dangerous test:\n\n```python\nif not repr(self) == repr(other):\n```\n(which it should use `!=` anyways) because\n\n```\nsage: x = 1.0\nsage: y = 1\nsage: repr(x) == repr(y)\nFalse\nsage: x == y\nTrue\nsage: hash(x) == hash(y)\nTrue\n```\nEqual objects need not have equal (string) representations. So you have introduced a change in behavior in a way that does not respect equality.\n\nOn the other hand, I disagree with this reasoning:\n\n```\nTwo :class:`EnumeratedSetFromIterator` objects that are not known to be finite\ncannot be reliably tested for equality. Therefore, we do not put such objects\nin the :class:`~sage.structure.unique_representation.UniqueRepresentation` cache.\n```\nIt depends on what you mean by equality. Now we normally think of equality of sets as containment in both ways, but it might be better to think of them like knots or polytopes. You might have the same polytope (same subset of **R**<sup>n</sup>) but different representations. So it could make sense for them to not be equal. Consequently, I do not support this disabling of `UniqueRepresentation`. Either you need to remove that altogether, which I strongly oppose because of the consequences with parents and how much nicer `UniqueRepresentation` behavior makes things, or you test by equality, which uses whatever definition of equality the object uses.\n\nThis statement is needs correcting:\n\n```diff\n-When the first factor is infinite (or not known to be finite), it still\n+When all but the first factor is known to be finite, it\n uses the lexicographic order::\n```\nI believe your code would produce\n\n```\nsage: list(islice(cantor_product(NN, NN, GF(2)), 6))\n[(0, 0, 0), (1, 0, 0), (0, 1, 0), (0, 0, 1), (2, 0, 0), (1, 1, 0)]\n```\n\nSomething else to be aware of is elements of `cartesian_product` are actual Sage elements rather than `list`s. So this could lead to performance regressions. Lots of things use the `CFM_tensor` class; all of the Hopf algebras basically. We might want a base or sub class of the `cartesian_product` that acts as a fa\u00e7ade parent for tuples. So the only difference is essentially in the `_element_constructor_` and/or `__call__`.\n\nI am wondering why we did not put `EnumeratedSets().CartesianProducts()` in the category of `EnumeratedSets()`. We might want to do this to have access to some of the generic methods from there, such as `unrank()`. Likewise, it would be good to port over some of these extra methods to `cartesian_product`, which would improve the (generic) implementation, and/or move things into the category.",
    "created_at": "2022-08-13T07:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338278",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:63'></a>
Thank you for working on this. It definitely would be good to have things more centralized. Hopefully these comments are fairly simple to incorporate.

I think this is a very dangerous test:

```python
if not repr(self) == repr(other):
```
(which it should use `!=` anyways) because

```
sage: x = 1.0
sage: y = 1
sage: repr(x) == repr(y)
False
sage: x == y
True
sage: hash(x) == hash(y)
True
```
Equal objects need not have equal (string) representations. So you have introduced a change in behavior in a way that does not respect equality.

On the other hand, I disagree with this reasoning:

```
Two :class:`EnumeratedSetFromIterator` objects that are not known to be finite
cannot be reliably tested for equality. Therefore, we do not put such objects
in the :class:`~sage.structure.unique_representation.UniqueRepresentation` cache.
```
It depends on what you mean by equality. Now we normally think of equality of sets as containment in both ways, but it might be better to think of them like knots or polytopes. You might have the same polytope (same subset of **R**<sup>n</sup>) but different representations. So it could make sense for them to not be equal. Consequently, I do not support this disabling of `UniqueRepresentation`. Either you need to remove that altogether, which I strongly oppose because of the consequences with parents and how much nicer `UniqueRepresentation` behavior makes things, or you test by equality, which uses whatever definition of equality the object uses.

This statement is needs correcting:

```diff
-When the first factor is infinite (or not known to be finite), it still
+When all but the first factor is known to be finite, it
 uses the lexicographic order::
```
I believe your code would produce

```
sage: list(islice(cantor_product(NN, NN, GF(2)), 6))
[(0, 0, 0), (1, 0, 0), (0, 1, 0), (0, 0, 1), (2, 0, 0), (1, 1, 0)]
```

Something else to be aware of is elements of `cartesian_product` are actual Sage elements rather than `list`s. So this could lead to performance regressions. Lots of things use the `CFM_tensor` class; all of the Hopf algebras basically. We might want a base or sub class of the `cartesian_product` that acts as a façade parent for tuples. So the only difference is essentially in the `_element_constructor_` and/or `__call__`.

I am wondering why we did not put `EnumeratedSets().CartesianProducts()` in the category of `EnumeratedSets()`. We might want to do this to have access to some of the generic methods from there, such as `unrank()`. Likewise, it would be good to port over some of these extra methods to `cartesian_product`, which would improve the (generic) implementation, and/or move things into the category.



---

archive/issue_comments_338279.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [tscrim](#comment%3A63):\n> I think this is a very dangerous test:\n> \n> ```python\n> if not repr(self) == repr(other):\n> ```\n> (which it should use `!=` anyways) because\n> \n> ```\n> sage: x = 1.0\n> sage: y = 1\n> sage: repr(x) == repr(y)\n> False\n> sage: x == y\n> True\n> sage: hash(x) == hash(y)\n> True\n> ```\n> Equal objects need not have equal (string) representations. So you have introduced a change in behavior in a way that does not respect equality.\n\n\nNo, the `repr` comparison was already in the old method. It's only reordered.",
    "created_at": "2022-08-13T07:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338279",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>
Replying to [tscrim](#comment%3A63):
> I think this is a very dangerous test:
> 
> ```python
> if not repr(self) == repr(other):
> ```
> (which it should use `!=` anyways) because
> 
> ```
> sage: x = 1.0
> sage: y = 1
> sage: repr(x) == repr(y)
> False
> sage: x == y
> True
> sage: hash(x) == hash(y)
> True
> ```
> Equal objects need not have equal (string) representations. So you have introduced a change in behavior in a way that does not respect equality.


No, the `repr` comparison was already in the old method. It's only reordered.



---

archive/issue_comments_338280.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [tscrim](#comment%3A63):\n> On the other hand, I disagree with this reasoning:\n> \n> ```\n> Two :class:`EnumeratedSetFromIterator` objects that are not known to be finite\n> cannot be reliably tested for equality. Therefore, we do not put such objects\n> in the :class:`~sage.structure.unique_representation.UniqueRepresentation` cache.\n> ```\n> It depends on what you mean by equality. Now we normally think of equality [...] or you test by equality, which uses whatever definition of equality the object uses.\n\n\nI think you are trying to tell me that when I disabled `UniqueRepresentation`, I also need to disable `WithEqualityById`.\n\nI agree with this, it needs to be corrected.\n\n```\nsage: from sage.sets.set_from_iterator import EnumeratedSetFromIterator\nsage: F = EnumeratedSetFromIterator(lambda: iter([1, 2]))\nsage: F.category()\nCategory of facade enumerated sets\nsage: cartesian_product([F, F]) is cartesian_product([F, F])   # as intended\nFalse\nsage: cartesian_product([F, F]) == cartesian_product([F, F])   # BUG\nFalse\n```",
    "created_at": "2022-08-13T07:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338280",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>
Replying to [tscrim](#comment%3A63):
> On the other hand, I disagree with this reasoning:
> 
> ```
> Two :class:`EnumeratedSetFromIterator` objects that are not known to be finite
> cannot be reliably tested for equality. Therefore, we do not put such objects
> in the :class:`~sage.structure.unique_representation.UniqueRepresentation` cache.
> ```
> It depends on what you mean by equality. Now we normally think of equality [...] or you test by equality, which uses whatever definition of equality the object uses.


I think you are trying to tell me that when I disabled `UniqueRepresentation`, I also need to disable `WithEqualityById`.

I agree with this, it needs to be corrected.

```
sage: from sage.sets.set_from_iterator import EnumeratedSetFromIterator
sage: F = EnumeratedSetFromIterator(lambda: iter([1, 2]))
sage: F.category()
Category of facade enumerated sets
sage: cartesian_product([F, F]) is cartesian_product([F, F])   # as intended
False
sage: cartesian_product([F, F]) == cartesian_product([F, F])   # BUG
False
```



---

archive/issue_comments_338281.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-13T07:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338281",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_338282.json:
```json
{
    "body": "<a id='comment:67'></a>\nReplying to [mkoeppe](#comment%3A64):\n> Replying to [tscrim](#comment%3A63):\n> > I think this is a very dangerous test:\n> > \n> > ```python\n> > if not repr(self) == repr(other):\n> > ```\n> > (which it should use `!=` anyways) because\n> > \n> > ```\n> > sage: x = 1.0\n> > sage: y = 1\n> > sage: repr(x) == repr(y)\n> > False\n> > sage: x == y\n> > True\n> > sage: hash(x) == hash(y)\n> > True\n> > ```\n> > Equal objects need not have equal (string) representations. So you have introduced a change in behavior in a way that does not respect equality.\n\n> \n> No, the `repr` comparison was already in the old method. It's only reordered.\n\n\nI misread the original code; after that test was true, it would compare the `repr`. This is very strange logic. I agree that it does not change the behavior. However, I still stand by my statement about it being a dangerous test.",
    "created_at": "2022-08-13T07:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338282",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:67'></a>
Replying to [mkoeppe](#comment%3A64):
> Replying to [tscrim](#comment%3A63):
> > I think this is a very dangerous test:
> > 
> > ```python
> > if not repr(self) == repr(other):
> > ```
> > (which it should use `!=` anyways) because
> > 
> > ```
> > sage: x = 1.0
> > sage: y = 1
> > sage: repr(x) == repr(y)
> > False
> > sage: x == y
> > True
> > sage: hash(x) == hash(y)
> > True
> > ```
> > Equal objects need not have equal (string) representations. So you have introduced a change in behavior in a way that does not respect equality.

> 
> No, the `repr` comparison was already in the old method. It's only reordered.


I misread the original code; after that test was true, it would compare the `repr`. This is very strange logic. I agree that it does not change the behavior. However, I still stand by my statement about it being a dangerous test.



---

archive/issue_comments_338283.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [tscrim](#comment%3A63):\n> I am wondering why we did not put `EnumeratedSets().CartesianProducts()` in the category of `EnumeratedSets()`. We might want to do this \n\n\n+1",
    "created_at": "2022-08-13T07:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338283",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>
Replying to [tscrim](#comment%3A63):
> I am wondering why we did not put `EnumeratedSets().CartesianProducts()` in the category of `EnumeratedSets()`. We might want to do this 


+1



---

archive/issue_comments_338284.json:
```json
{
    "body": "<a id='comment:69'></a>\nReplying to [mkoeppe](#comment%3A65):\n> Replying to [tscrim](#comment%3A63):\n> > On the other hand, I disagree with this reasoning:\n> > \n> > ```\n> > Two :class:`EnumeratedSetFromIterator` objects that are not known to be finite\n> > cannot be reliably tested for equality. Therefore, we do not put such objects\n> > in the :class:`~sage.structure.unique_representation.UniqueRepresentation` cache.\n> > ```\n> > It depends on what you mean by equality. Now we normally think of equality [...] or you test by equality, which uses whatever definition of equality the object uses.\n\n> \n> I think you are trying to tell me that when I disabled `UniqueRepresentation`, I also need to disable `WithEqualityById`.\n\n\nNo, that is not what I am saying. I am saying you should either fully and completely remove `UniqueRepresentation` from being a base class (likely downgrading to `CachedRepresentation`) or understand and learn to live with equality is not always mathematical equality. IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.",
    "created_at": "2022-08-13T07:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338284",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:69'></a>
Replying to [mkoeppe](#comment%3A65):
> Replying to [tscrim](#comment%3A63):
> > On the other hand, I disagree with this reasoning:
> > 
> > ```
> > Two :class:`EnumeratedSetFromIterator` objects that are not known to be finite
> > cannot be reliably tested for equality. Therefore, we do not put such objects
> > in the :class:`~sage.structure.unique_representation.UniqueRepresentation` cache.
> > ```
> > It depends on what you mean by equality. Now we normally think of equality [...] or you test by equality, which uses whatever definition of equality the object uses.

> 
> I think you are trying to tell me that when I disabled `UniqueRepresentation`, I also need to disable `WithEqualityById`.


No, that is not what I am saying. I am saying you should either fully and completely remove `UniqueRepresentation` from being a base class (likely downgrading to `CachedRepresentation`) or understand and learn to live with equality is not always mathematical equality. IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.



---

archive/issue_comments_338285.json:
```json
{
    "body": "<a id='comment:70'></a>\nReplying to [tscrim](#comment%3A67):\n> I still stand by my statement about it being a dangerous test.\n\n\nI fully agree, but I consider it beyond the scope of this ticket",
    "created_at": "2022-08-13T07:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338285",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>
Replying to [tscrim](#comment%3A67):
> I still stand by my statement about it being a dangerous test.


I fully agree, but I consider it beyond the scope of this ticket



---

archive/issue_comments_338286.json:
```json
{
    "body": "<a id='comment:71'></a>\nReplying to [tscrim](#comment%3A69):\n> IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.\n\n\nSure it is, but I don't agree with your conclusion.\n\nThere is a simple fix - we can just push this a level lower, namely into the implementation of CachedRepresentation/UniqueRepresentation.",
    "created_at": "2022-08-13T07:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338286",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>
Replying to [tscrim](#comment%3A69):
> IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.


Sure it is, but I don't agree with your conclusion.

There is a simple fix - we can just push this a level lower, namely into the implementation of CachedRepresentation/UniqueRepresentation.



---

archive/issue_comments_338287.json:
```json
{
    "body": "<a id='comment:72'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|\n|[278b7c7](https://github.com/sagemath/sagetrac-mirror/commit/278b7c7ec6eccc9125cd4066c15c3c16268b1382)|`src/sage/categories/enumerated_sets.py: Make (finitary) Cartesian products of enumerated enumerated`|",
    "created_at": "2022-08-13T07:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:72'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
|[278b7c7](https://github.com/sagemath/sagetrac-mirror/commit/278b7c7ec6eccc9125cd4066c15c3c16268b1382)|`src/sage/categories/enumerated_sets.py: Make (finitary) Cartesian products of enumerated enumerated`|



---

archive/issue_comments_338288.json:
```json
{
    "body": "Changing commit from \"1c303121d6e407fd0906f745826fc37b4db3bf58\" to \"278b7c7ec6eccc9125cd4066c15c3c16268b1382\"",
    "created_at": "2022-08-13T07:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1c303121d6e407fd0906f745826fc37b4db3bf58" to "278b7c7ec6eccc9125cd4066c15c3c16268b1382"



---

archive/issue_comments_338289.json:
```json
{
    "body": "<a id='comment:73'></a>\nHere's the fix for the category",
    "created_at": "2022-08-13T07:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338289",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>
Here's the fix for the category



---

archive/issue_comments_338290.json:
```json
{
    "body": "<a id='comment:74'></a>\nReplying to [mkoeppe](#comment%3A71):\n> Replying to [tscrim](#comment%3A69):\n> > IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.\n\n> \n> Sure it is, but I don't agree with your conclusion.\n\n>\n> There is a simple fix - we can just push this a level lower, namely into the implementation of CachedRepresentation/UniqueRepresentation.\n\n\nI don't understand this last part. The issue is you have a subclass of `UniqueRepresentation` that does not implement the `UniqueRepresentation` protocol (only a `CachedRepresentation`). So it should be a `CachedRepresentation`. This is okay, and you could have a subclass for those Cartesian products of finite sets that inherits from `UniqueRepresentation`. Not only does this make the code more complicated, it also effects the speed and reliability of other implementations.",
    "created_at": "2022-08-13T08:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338290",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:74'></a>
Replying to [mkoeppe](#comment%3A71):
> Replying to [tscrim](#comment%3A69):
> > IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.

> 
> Sure it is, but I don't agree with your conclusion.

>
> There is a simple fix - we can just push this a level lower, namely into the implementation of CachedRepresentation/UniqueRepresentation.


I don't understand this last part. The issue is you have a subclass of `UniqueRepresentation` that does not implement the `UniqueRepresentation` protocol (only a `CachedRepresentation`). So it should be a `CachedRepresentation`. This is okay, and you could have a subclass for those Cartesian products of finite sets that inherits from `UniqueRepresentation`. Not only does this make the code more complicated, it also effects the speed and reliability of other implementations.



---

archive/issue_comments_338291.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [git](#comment%3A72):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                                                                                     |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|\n> |[278b7c7](https://github.com/sagemath/sagetrac-mirror/commit/278b7c7ec6eccc9125cd4066c15c3c16268b1382)|`src/sage/categories/enumerated_sets.py: Make (finitary) Cartesian products of enumerated enumerated`|\n\n\nThis caused some doctest failures:\n\n```\nFile \"sage/categories/sets_cat.py\", line 2273, in sage.categories.sets_cat.Sets.CartesianProducts.ParentMethods.__iter__\nFailed example:\n    it = iter(cartesian_product([ZZ, GF(2)]))\nException raised:\n    Traceback (most recent call last):\n      File \"/__w/sagetrac-mirror/sagetrac-mirror/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/__w/sagetrac-mirror/sagetrac-mirror/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.categories.sets_cat.Sets.CartesianProducts.ParentMethods.__iter__[13]>\", line 1, in <module>\n        it = iter(cartesian_product([ZZ, GF(Integer(2))]))\n      File \"/__w/sagetrac-mirror/sagetrac-mirror/src/sage/categories/enumerated_sets.py\", line 238, in __iter__\n        raise NotImplementedError(\"iterator called but not implemented\")\n    NotImplementedError: iterator called but not implemented\n```",
    "created_at": "2022-08-13T16:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338291",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>
Replying to [git](#comment%3A72):
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                                                                                     |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
> |[278b7c7](https://github.com/sagemath/sagetrac-mirror/commit/278b7c7ec6eccc9125cd4066c15c3c16268b1382)|`src/sage/categories/enumerated_sets.py: Make (finitary) Cartesian products of enumerated enumerated`|


This caused some doctest failures:

```
File "sage/categories/sets_cat.py", line 2273, in sage.categories.sets_cat.Sets.CartesianProducts.ParentMethods.__iter__
Failed example:
    it = iter(cartesian_product([ZZ, GF(2)]))
Exception raised:
    Traceback (most recent call last):
      File "/__w/sagetrac-mirror/sagetrac-mirror/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/__w/sagetrac-mirror/sagetrac-mirror/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.sets_cat.Sets.CartesianProducts.ParentMethods.__iter__[13]>", line 1, in <module>
        it = iter(cartesian_product([ZZ, GF(Integer(2))]))
      File "/__w/sagetrac-mirror/sagetrac-mirror/src/sage/categories/enumerated_sets.py", line 238, in __iter__
        raise NotImplementedError("iterator called but not implemented")
    NotImplementedError: iterator called but not implemented
```



---

archive/issue_comments_338292.json:
```json
{
    "body": "<a id='comment:76'></a>\nLet's do these category improvements in a separate ticket, #34356.",
    "created_at": "2022-08-13T16:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338292",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>
Let's do these category improvements in a separate ticket, #34356.



---

archive/issue_comments_338293.json:
```json
{
    "body": "Changing commit from \"278b7c7ec6eccc9125cd4066c15c3c16268b1382\" to \"1c303121d6e407fd0906f745826fc37b4db3bf58\"",
    "created_at": "2022-08-13T16:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "278b7c7ec6eccc9125cd4066c15c3c16268b1382" to "1c303121d6e407fd0906f745826fc37b4db3bf58"



---

archive/issue_comments_338294.json:
```json
{
    "body": "<a id='comment:77'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-13T16:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:77'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_338295.json:
```json
{
    "body": "Changing commit from \"1c303121d6e407fd0906f745826fc37b4db3bf58\" to \"d132fb7f0808b421988bfccc9672038707ca960d\"",
    "created_at": "2022-08-13T16:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1c303121d6e407fd0906f745826fc37b4db3bf58" to "d132fb7f0808b421988bfccc9672038707ca960d"



---

archive/issue_comments_338296.json:
```json
{
    "body": "<a id='comment:78'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|\n|[ef18d05](https://github.com/sagemath/sagetrac-mirror/commit/ef18d05cd065aac9f328617dd80f497b7b4a123a)|`src/sage/structure/unique_representation.py: Refactor CachedRepresentation through new class WithPicklingByInitArgs`|\n|[d132fb7](https://github.com/sagemath/sagetrac-mirror/commit/d132fb7f0808b421988bfccc9672038707ca960d)|`src/sage/sets/cartesian_product.py: Remove code duplication`|",
    "created_at": "2022-08-13T16:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:78'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|
|[ef18d05](https://github.com/sagemath/sagetrac-mirror/commit/ef18d05cd065aac9f328617dd80f497b7b4a123a)|`src/sage/structure/unique_representation.py: Refactor CachedRepresentation through new class WithPicklingByInitArgs`|
|[d132fb7](https://github.com/sagemath/sagetrac-mirror/commit/d132fb7f0808b421988bfccc9672038707ca960d)|`src/sage/sets/cartesian_product.py: Remove code duplication`|



---

archive/issue_comments_338297.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [tscrim](#comment%3A74):\n> The issue is you have a subclass of `UniqueRepresentation` that does not implement the `UniqueRepresentation` protocol (only a `CachedRepresentation`). So it should be a `CachedRepresentation`.\n\n\nActually, not even a `CachedRepresentation`. I've now introduced a new class `WithPicklingByInitArgs`, which `CachedRepresentation` subclasses.",
    "created_at": "2022-08-13T16:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338297",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'></a>
Replying to [tscrim](#comment%3A74):
> The issue is you have a subclass of `UniqueRepresentation` that does not implement the `UniqueRepresentation` protocol (only a `CachedRepresentation`). So it should be a `CachedRepresentation`.


Actually, not even a `CachedRepresentation`. I've now introduced a new class `WithPicklingByInitArgs`, which `CachedRepresentation` subclasses.



---

archive/issue_comments_338298.json:
```json
{
    "body": "<a id='comment:80'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|\n|[85fd255](https://github.com/sagemath/sagetrac-mirror/commit/85fd255aa2df8003505ccce096d5e9baad3bd903)|`src/sage/categories/sets_cat.py: Rephrase cartesian product docstring`|",
    "created_at": "2022-08-13T16:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338298",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:80'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
|[85fd255](https://github.com/sagemath/sagetrac-mirror/commit/85fd255aa2df8003505ccce096d5e9baad3bd903)|`src/sage/categories/sets_cat.py: Rephrase cartesian product docstring`|



---

archive/issue_comments_338299.json:
```json
{
    "body": "Changing commit from \"d132fb7f0808b421988bfccc9672038707ca960d\" to \"85fd255aa2df8003505ccce096d5e9baad3bd903\"",
    "created_at": "2022-08-13T16:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338299",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d132fb7f0808b421988bfccc9672038707ca960d" to "85fd255aa2df8003505ccce096d5e9baad3bd903"



---

archive/issue_comments_338300.json:
```json
{
    "body": "<a id='comment:81'></a>\nReplying to [tscrim](#comment%3A63):\n> This statement is needs correcting:\n> \n> ```diff\n> -When the first factor is infinite (or not known to be finite), it still\n> +When all but the first factor is known to be finite, it\n>  uses the lexicographic order::\n> ```\n\n\nI have rephrased in a similar way for clarity",
    "created_at": "2022-08-13T17:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338300",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'></a>
Replying to [tscrim](#comment%3A63):
> This statement is needs correcting:
> 
> ```diff
> -When the first factor is infinite (or not known to be finite), it still
> +When all but the first factor is known to be finite, it
>  uses the lexicographic order::
> ```


I have rephrased in a similar way for clarity



---

archive/issue_comments_338301.json:
```json
{
    "body": "<a id='comment:82'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|\n|[2f84a4c](https://github.com/sagemath/sagetrac-mirror/commit/2f84a4c93b0d4bd0ba6f4cd888d343e62a489109)|`src/sage/categories/{sets_cat.py,category_singleton.pyx}: Update doctest output`|",
    "created_at": "2022-08-13T17:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338301",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
|[2f84a4c](https://github.com/sagemath/sagetrac-mirror/commit/2f84a4c93b0d4bd0ba6f4cd888d343e62a489109)|`src/sage/categories/{sets_cat.py,category_singleton.pyx}: Update doctest output`|



---

archive/issue_comments_338302.json:
```json
{
    "body": "Changing commit from \"85fd255aa2df8003505ccce096d5e9baad3bd903\" to \"2f84a4c93b0d4bd0ba6f4cd888d343e62a489109\"",
    "created_at": "2022-08-13T17:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338302",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "85fd255aa2df8003505ccce096d5e9baad3bd903" to "2f84a4c93b0d4bd0ba6f4cd888d343e62a489109"



---

archive/issue_comments_338303.json:
```json
{
    "body": "<a id='comment:83'></a>\nPasses tests for me.",
    "created_at": "2022-08-13T19:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338303",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:83'></a>
Passes tests for me.



---

archive/issue_comments_338304.json:
```json
{
    "body": "Changing commit from \"2f84a4c93b0d4bd0ba6f4cd888d343e62a489109\" to \"aea2ba69af0cdcf7fffa12c13ee042173fb63af1\"",
    "created_at": "2022-08-13T19:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2f84a4c93b0d4bd0ba6f4cd888d343e62a489109" to "aea2ba69af0cdcf7fffa12c13ee042173fb63af1"



---

archive/issue_comments_338305.json:
```json
{
    "body": "<a id='comment:84'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[aea2ba6](https://github.com/sagemath/sagetrac-mirror/commit/aea2ba69af0cdcf7fffa12c13ee042173fb63af1)|`src/sage/sets/cartesian_product.py: Remove unused import`|",
    "created_at": "2022-08-13T19:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:84'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[aea2ba6](https://github.com/sagemath/sagetrac-mirror/commit/aea2ba69af0cdcf7fffa12c13ee042173fb63af1)|`src/sage/sets/cartesian_product.py: Remove unused import`|



---

archive/issue_comments_338306.json:
```json
{
    "body": "Changing commit from \"aea2ba69af0cdcf7fffa12c13ee042173fb63af1\" to \"c91bcfa94e5a54c27238fc2e04c95679f4fff885\"",
    "created_at": "2022-08-13T20:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "aea2ba69af0cdcf7fffa12c13ee042173fb63af1" to "c91bcfa94e5a54c27238fc2e04c95679f4fff885"



---

archive/issue_comments_338307.json:
```json
{
    "body": "<a id='comment:85'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[c91bcfa](https://github.com/sagemath/sagetrac-mirror/commit/c91bcfa94e5a54c27238fc2e04c95679f4fff885)|`src/sage/sets/cartesian_product.py: Add doctest for equality (1 failure)`|",
    "created_at": "2022-08-13T20:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338307",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:85'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[c91bcfa](https://github.com/sagemath/sagetrac-mirror/commit/c91bcfa94e5a54c27238fc2e04c95679f4fff885)|`src/sage/sets/cartesian_product.py: Add doctest for equality (1 failure)`|



---

archive/issue_comments_338308.json:
```json
{
    "body": "<a id='comment:86'></a>\nReplying to [mkoeppe](#comment%3A65):\n> when I disabled `UniqueRepresentation`, I also need to disable `WithEqualityById`.\n> \n> I agree with this, it needs to be corrected.\n> \n> \n> ```\n> sage: from sage.sets.set_from_iterator import EnumeratedSetFromIterator\n> sage: F = EnumeratedSetFromIterator(lambda: iter([1, 2]))\n> sage: F.category()\n> Category of facade enumerated sets\n> sage: cartesian_product([F, F]) is cartesian_product([F, F])   # as intended\n> False\n> sage: cartesian_product([F, F]) == cartesian_product([F, F])   # BUG\n> False\n> ```\n\n\nI have added this test (still fails)",
    "created_at": "2022-08-13T20:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338308",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:86'></a>
Replying to [mkoeppe](#comment%3A65):
> when I disabled `UniqueRepresentation`, I also need to disable `WithEqualityById`.
> 
> I agree with this, it needs to be corrected.
> 
> 
> ```
> sage: from sage.sets.set_from_iterator import EnumeratedSetFromIterator
> sage: F = EnumeratedSetFromIterator(lambda: iter([1, 2]))
> sage: F.category()
> Category of facade enumerated sets
> sage: cartesian_product([F, F]) is cartesian_product([F, F])   # as intended
> False
> sage: cartesian_product([F, F]) == cartesian_product([F, F])   # BUG
> False
> ```


I have added this test (still fails)



---

archive/issue_comments_338309.json:
```json
{
    "body": "<a id='comment:87'></a>\nMaybe this is a stupid question, but should that doctest pass? According to the documentation for `EnumeratedSetFromIterator`:\n\n```\n    - ``category`` -- (default: ``None``) an optional category for that\n      enumerated set. If you know that your iterator will stop after a finite\n      number of steps you should set it as :class:`FiniteEnumeratedSets`, conversely if\n      you know that your iterator will run over and over you should set it as\n      :class:`InfiniteEnumeratedSets`.\n```\nIf we use \n\n```\nF = EnumeratedSetFromIterator(lambda: iter([1, 2]), category=FiniteEnumeratedSets())\n```\nthen the doctest passes. How is it supposed to function if it doesn't know whether the arguments are finite?",
    "created_at": "2022-08-13T21:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338309",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:87'></a>
Maybe this is a stupid question, but should that doctest pass? According to the documentation for `EnumeratedSetFromIterator`:

```
    - ``category`` -- (default: ``None``) an optional category for that
      enumerated set. If you know that your iterator will stop after a finite
      number of steps you should set it as :class:`FiniteEnumeratedSets`, conversely if
      you know that your iterator will run over and over you should set it as
      :class:`InfiniteEnumeratedSets`.
```
If we use 

```
F = EnumeratedSetFromIterator(lambda: iter([1, 2]), category=FiniteEnumeratedSets())
```
then the doctest passes. How is it supposed to function if it doesn't know whether the arguments are finite?



---

archive/issue_comments_338310.json:
```json
{
    "body": "<a id='comment:88'></a>\nAt the moment, there's no code for it because `CartesianProduct` just relies on `WithEqualityById`. \n\nTo give equality to Cartesian products without `WithEqualityById`, we could just compare the factors for equality (this is if-and-only-if because no flattening is implemented in our Cartesian products). In the example, the factors are `EnumeratedSetFromIterator`, and for these `__eq__` just loops to exhaustion to decide equality.",
    "created_at": "2022-08-13T21:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338310",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:88'></a>
At the moment, there's no code for it because `CartesianProduct` just relies on `WithEqualityById`. 

To give equality to Cartesian products without `WithEqualityById`, we could just compare the factors for equality (this is if-and-only-if because no flattening is implemented in our Cartesian products). In the example, the factors are `EnumeratedSetFromIterator`, and for these `__eq__` just loops to exhaustion to decide equality.



---

archive/issue_comments_338311.json:
```json
{
    "body": "<a id='comment:89'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|\n|[246a158](https://github.com/sagemath/sagetrac-mirror/commit/246a158cc3e1c4e87ec9ae2da0a73e30fdb636b7)|`src/sage/sets/cartesian_product.py: Implement __eq__, __hash__ for non-UniqueRepresentation case (mockup)`|",
    "created_at": "2022-08-13T21:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338311",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:89'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
|[246a158](https://github.com/sagemath/sagetrac-mirror/commit/246a158cc3e1c4e87ec9ae2da0a73e30fdb636b7)|`src/sage/sets/cartesian_product.py: Implement __eq__, __hash__ for non-UniqueRepresentation case (mockup)`|



---

archive/issue_comments_338312.json:
```json
{
    "body": "Changing commit from \"c91bcfa94e5a54c27238fc2e04c95679f4fff885\" to \"246a158cc3e1c4e87ec9ae2da0a73e30fdb636b7\"",
    "created_at": "2022-08-13T21:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c91bcfa94e5a54c27238fc2e04c95679f4fff885" to "246a158cc3e1c4e87ec9ae2da0a73e30fdb636b7"



---

archive/issue_comments_338313.json:
```json
{
    "body": "<a id='comment:90'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|\n|[f7f099c](https://github.com/sagemath/sagetrac-mirror/commit/f7f099c84585ba7bf1b2a722d67a856053f0939b)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_base`|",
    "created_at": "2022-08-13T23:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338313",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:90'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
|[f7f099c](https://github.com/sagemath/sagetrac-mirror/commit/f7f099c84585ba7bf1b2a722d67a856053f0939b)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_base`|



---

archive/issue_comments_338314.json:
```json
{
    "body": "Changing commit from \"246a158cc3e1c4e87ec9ae2da0a73e30fdb636b7\" to \"f7f099c84585ba7bf1b2a722d67a856053f0939b\"",
    "created_at": "2022-08-13T23:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "246a158cc3e1c4e87ec9ae2da0a73e30fdb636b7" to "f7f099c84585ba7bf1b2a722d67a856053f0939b"



---

archive/issue_comments_338315.json:
```json
{
    "body": "Changing commit from \"f7f099c84585ba7bf1b2a722d67a856053f0939b\" to \"5561d3fb4145516069cdc48f1fe2cf537f13544c\"",
    "created_at": "2022-08-13T23:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f7f099c84585ba7bf1b2a722d67a856053f0939b" to "5561d3fb4145516069cdc48f1fe2cf537f13544c"



---

archive/issue_comments_338316.json:
```json
{
    "body": "<a id='comment:91'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|\n|[5561d3f](https://github.com/sagemath/sagetrac-mirror/commit/5561d3fb4145516069cdc48f1fe2cf537f13544c)|`Fix comments`|",
    "created_at": "2022-08-13T23:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:91'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|
|[5561d3f](https://github.com/sagemath/sagetrac-mirror/commit/5561d3fb4145516069cdc48f1fe2cf537f13544c)|`Fix comments`|



---

archive/issue_comments_338317.json:
```json
{
    "body": "Changing commit from \"5561d3fb4145516069cdc48f1fe2cf537f13544c\" to \"7570978e7bab8af93860db866b2aadec75a1508b\"",
    "created_at": "2022-08-13T23:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5561d3fb4145516069cdc48f1fe2cf537f13544c" to "7570978e7bab8af93860db866b2aadec75a1508b"



---

archive/issue_comments_338318.json:
```json
{
    "body": "<a id='comment:92'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|\n|[7570978](https://github.com/sagemath/sagetrac-mirror/commit/7570978e7bab8af93860db866b2aadec75a1508b)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_with_element_wrapper`|",
    "created_at": "2022-08-13T23:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:92'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|
|[7570978](https://github.com/sagemath/sagetrac-mirror/commit/7570978e7bab8af93860db866b2aadec75a1508b)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_with_element_wrapper`|



---

archive/issue_comments_338319.json:
```json
{
    "body": "<a id='comment:93'></a>\nReplying to [tscrim](#comment%3A63):\n> Something else to be aware of is elements of `cartesian_product` are actual Sage elements rather than `list`s. So this could lead to performance regressions. Lots of things use the `CFM_tensor` class; all of the Hopf algebras basically. We might want a base or sub class of the `cartesian_product` that acts as a fa\u00e7ade parent for tuples. So the only difference is essentially in the `_element_constructor_` and/or `__call__`.\n\n\nThe choice of element class is now set in the subclass `CartesianProduct_with_element_wrapper` of `CartesianProduct_base`",
    "created_at": "2022-08-13T23:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338319",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:93'></a>
Replying to [tscrim](#comment%3A63):
> Something else to be aware of is elements of `cartesian_product` are actual Sage elements rather than `list`s. So this could lead to performance regressions. Lots of things use the `CFM_tensor` class; all of the Hopf algebras basically. We might want a base or sub class of the `cartesian_product` that acts as a façade parent for tuples. So the only difference is essentially in the `_element_constructor_` and/or `__call__`.


The choice of element class is now set in the subclass `CartesianProduct_with_element_wrapper` of `CartesianProduct_base`



---

archive/issue_comments_338320.json:
```json
{
    "body": "<a id='comment:94'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|\n|[911b548](https://github.com/sagemath/sagetrac-mirror/commit/911b548ff955635a03c75da6652b56b460c857fb)|`src/sage/sets/cartesian_product.py (CartesianProduct): Dispatch to implementation classes CartesianProduct_eq_by_factors, CartesianProduct_unique`|",
    "created_at": "2022-08-14T00:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:94'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
|[911b548](https://github.com/sagemath/sagetrac-mirror/commit/911b548ff955635a03c75da6652b56b460c857fb)|`src/sage/sets/cartesian_product.py (CartesianProduct): Dispatch to implementation classes CartesianProduct_eq_by_factors, CartesianProduct_unique`|



---

archive/issue_comments_338321.json:
```json
{
    "body": "Changing commit from \"7570978e7bab8af93860db866b2aadec75a1508b\" to \"911b548ff955635a03c75da6652b56b460c857fb\"",
    "created_at": "2022-08-14T00:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7570978e7bab8af93860db866b2aadec75a1508b" to "911b548ff955635a03c75da6652b56b460c857fb"



---

archive/issue_comments_338322.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Add missing doctests\"",
    "created_at": "2022-08-14T00:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338322",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "" to "Add missing doctests"



---

archive/issue_comments_338323.json:
```json
{
    "body": "<a id='comment:96'></a>\nReplying to [mkoeppe](#comment%3A71):\n> Replying to [tscrim](#comment%3A69):\n> > IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.\n\n> \n> Sure it is\n\n\nI have a clean implementation now",
    "created_at": "2022-08-14T00:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338323",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:96'></a>
Replying to [mkoeppe](#comment%3A71):
> Replying to [tscrim](#comment%3A69):
> > IMO, what you are doing has a very strong code smell as it is breaking many rules of OOP.

> 
> Sure it is


I have a clean implementation now



---

archive/issue_comments_338324.json:
```json
{
    "body": "Changing commit from \"911b548ff955635a03c75da6652b56b460c857fb\" to \"434aaea4fed9738f7108f7bc11f75c1181802f70\"",
    "created_at": "2022-08-14T00:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338324",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "911b548ff955635a03c75da6652b56b460c857fb" to "434aaea4fed9738f7108f7bc11f75c1181802f70"



---

archive/issue_comments_338325.json:
```json
{
    "body": "<a id='comment:97'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|\n|[434aaea](https://github.com/sagemath/sagetrac-mirror/commit/434aaea4fed9738f7108f7bc11f75c1181802f70)|`src/sage/combinat/posets/cartesian_product.py: Fixup use of CartesianProduct`|",
    "created_at": "2022-08-14T00:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338325",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:97'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|
|[434aaea](https://github.com/sagemath/sagetrac-mirror/commit/434aaea4fed9738f7108f7bc11f75c1181802f70)|`src/sage/combinat/posets/cartesian_product.py: Fixup use of CartesianProduct`|



---

archive/issue_comments_338326.json:
```json
{
    "body": "Changing commit from \"434aaea4fed9738f7108f7bc11f75c1181802f70\" to \"1718618aea48ab99941c7e2bee4348bb15fe88c3\"",
    "created_at": "2022-08-14T01:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "434aaea4fed9738f7108f7bc11f75c1181802f70" to "1718618aea48ab99941c7e2bee4348bb15fe88c3"



---

archive/issue_comments_338327.json:
```json
{
    "body": "<a id='comment:98'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|\n|[1718618](https://github.com/sagemath/sagetrac-mirror/commit/1718618aea48ab99941c7e2bee4348bb15fe88c3)|`src/sage/sets/cartesian_product.py: Update copyright according to git blame -w --date=format:%Y FILE | sort -k2`|",
    "created_at": "2022-08-14T01:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:98'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
|[1718618](https://github.com/sagemath/sagetrac-mirror/commit/1718618aea48ab99941c7e2bee4348bb15fe88c3)|`src/sage/sets/cartesian_product.py: Update copyright according to git blame -w --date=format:%Y FILE | sort -k2`|



---

archive/issue_comments_338328.json:
```json
{
    "body": "<a id='comment:99'></a>\nSome MRO problems in sage/rings/asymptotic",
    "created_at": "2022-08-14T04:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338328",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:99'></a>
Some MRO problems in sage/rings/asymptotic



---

archive/issue_comments_338329.json:
```json
{
    "body": "<a id='comment:0'></a>\nYes, I see those, too.",
    "created_at": "2022-08-15T22:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338329",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:0'></a>
Yes, I see those, too.



---

archive/issue_comments_338330.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#34374\"",
    "created_at": "2022-08-16T18:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338330",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#34374"



---

archive/issue_events_068390.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "rename": {
        "from": "Make tensor of CombinatorialFreeModule use cartesian_product, deprecate CartesianProduct_iters, use cantor_product for products of infinite sets",
        "to": "Make tensor of CombinatorialFreeModule use cartesian_product, deprecate CartesianProduct_iters"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68390"
}
```



---

archive/issue_comments_338331.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[aabcca5](https://github.com/sagemath/sagetrac-mirror/commit/aabcca5aeb0336322b9a19fb6526ce0fe460b59b)|`src/sage/sets/cartesian_product.py: Add doctest for equality (1 failure)`|\n|[6268de8](https://github.com/sagemath/sagetrac-mirror/commit/6268de864c755802a8c017dc8f81bb92d7fbf5a2)|`src/sage/sets/cartesian_product.py: Implement __eq__, __hash__ for non-UniqueRepresentation case (mockup)`|\n|[ed7ddeb](https://github.com/sagemath/sagetrac-mirror/commit/ed7ddebf6ba7df1ab0488680d5940fd48099dd05)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_base`|\n|[9f16cef](https://github.com/sagemath/sagetrac-mirror/commit/9f16cef0741c5447a8d9ca7a53a610ff9a1ef95f)|`Fix comments`|\n|[be359bf](https://github.com/sagemath/sagetrac-mirror/commit/be359bf287a83be3e18ce10d5877faf978b283f0)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_with_element_wrapper`|\n|[7c303cb](https://github.com/sagemath/sagetrac-mirror/commit/7c303cbfddb505247ceffec1dcb4d3c7924f4059)|`src/sage/sets/cartesian_product.py (CartesianProduct): Dispatch to implementation classes CartesianProduct_eq_by_factors, CartesianProduct_unique`|\n|[e875dd2](https://github.com/sagemath/sagetrac-mirror/commit/e875dd20b695f16cc45f84a69441e2370e18bd7d)|`src/sage/combinat/posets/cartesian_product.py: Fixup use of CartesianProduct`|\n|[ca5ee17](https://github.com/sagemath/sagetrac-mirror/commit/ca5ee1780481bb3707b13b5832ead484fe141a84)|`src/sage/sets/cartesian_product.py: Update copyright according to git blame -w --date=format:%Y FILE | sort -k2`|\n|[d7af40f](https://github.com/sagemath/sagetrac-mirror/commit/d7af40f7f39e40ba205a9ee01103697641d9f463)|`WIP documentation`|\n|[32f227b](https://github.com/sagemath/sagetrac-mirror/commit/32f227b551a021de34c18ec862bc0327910b5b98)|`src/sage/sets/cartesian_product.py: Make MRO consistent`|",
    "created_at": "2022-08-17T00:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[aabcca5](https://github.com/sagemath/sagetrac-mirror/commit/aabcca5aeb0336322b9a19fb6526ce0fe460b59b)|`src/sage/sets/cartesian_product.py: Add doctest for equality (1 failure)`|
|[6268de8](https://github.com/sagemath/sagetrac-mirror/commit/6268de864c755802a8c017dc8f81bb92d7fbf5a2)|`src/sage/sets/cartesian_product.py: Implement __eq__, __hash__ for non-UniqueRepresentation case (mockup)`|
|[ed7ddeb](https://github.com/sagemath/sagetrac-mirror/commit/ed7ddebf6ba7df1ab0488680d5940fd48099dd05)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_base`|
|[9f16cef](https://github.com/sagemath/sagetrac-mirror/commit/9f16cef0741c5447a8d9ca7a53a610ff9a1ef95f)|`Fix comments`|
|[be359bf](https://github.com/sagemath/sagetrac-mirror/commit/be359bf287a83be3e18ce10d5877faf978b283f0)|`src/sage/sets/cartesian_product.py (CartesianProduct): Factor through new class CartesianProduct_with_element_wrapper`|
|[7c303cb](https://github.com/sagemath/sagetrac-mirror/commit/7c303cbfddb505247ceffec1dcb4d3c7924f4059)|`src/sage/sets/cartesian_product.py (CartesianProduct): Dispatch to implementation classes CartesianProduct_eq_by_factors, CartesianProduct_unique`|
|[e875dd2](https://github.com/sagemath/sagetrac-mirror/commit/e875dd20b695f16cc45f84a69441e2370e18bd7d)|`src/sage/combinat/posets/cartesian_product.py: Fixup use of CartesianProduct`|
|[ca5ee17](https://github.com/sagemath/sagetrac-mirror/commit/ca5ee1780481bb3707b13b5832ead484fe141a84)|`src/sage/sets/cartesian_product.py: Update copyright according to git blame -w --date=format:%Y FILE | sort -k2`|
|[d7af40f](https://github.com/sagemath/sagetrac-mirror/commit/d7af40f7f39e40ba205a9ee01103697641d9f463)|`WIP documentation`|
|[32f227b](https://github.com/sagemath/sagetrac-mirror/commit/32f227b551a021de34c18ec862bc0327910b5b98)|`src/sage/sets/cartesian_product.py: Make MRO consistent`|



---

archive/issue_comments_338332.json:
```json
{
    "body": "Changing commit from \"1718618aea48ab99941c7e2bee4348bb15fe88c3\" to \"32f227b551a021de34c18ec862bc0327910b5b98\"",
    "created_at": "2022-08-17T00:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1718618aea48ab99941c7e2bee4348bb15fe88c3" to "32f227b551a021de34c18ec862bc0327910b5b98"



---

archive/issue_comments_338333.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe MRO errors are gone now, but in the same files I get errors like the following.\n\n```\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/structure/unique_representation.py\", line 569, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 471, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2380)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/rings/asymptotic/growth_group_cartesian.py\", line 1444, in __init__\n        super(UnivariateProduct, self).__init__(\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/rings/asymptotic/growth_group_cartesian.py\", line 311, in __init__\n        CartesianProductPoset.__init__(self, sets, category, order, **kwds)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/combinat/posets/cartesian_product.py\", line 114, in __init__\n        super().__init__(sets, category, **kwargs)\n    TypeError: __init__() missing 1 required positional argument: 'category'\n```\n\nI think what's happening there is that `super().__init__` is being used in a situation where the `__init__` methods do not have compatible signatures.\n\n```\nclass GenericGrowthGroup(UniqueRepresentation, Parent, WithLocals):\n    def __init__(self, base, category, var): ...\nclass CartesianProduct_base(WithPicklingByInitArgs, Parent):\n    def __init__(self, sets, category, flatten=False): ...\nclass CartesianProductPoset(CartesianProduct_unique):\n    def __init__(self, sets, category, order=None, **kwargs):\n```",
    "created_at": "2022-08-17T01:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338333",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
The MRO errors are gone now, but in the same files I get errors like the following.

```
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/structure/unique_representation.py", line 569, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 471, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2380)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/rings/asymptotic/growth_group_cartesian.py", line 1444, in __init__
        super(UnivariateProduct, self).__init__(
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/rings/asymptotic/growth_group_cartesian.py", line 311, in __init__
        CartesianProductPoset.__init__(self, sets, category, order, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/combinat/posets/cartesian_product.py", line 114, in __init__
        super().__init__(sets, category, **kwargs)
    TypeError: __init__() missing 1 required positional argument: 'category'
```

I think what's happening there is that `super().__init__` is being used in a situation where the `__init__` methods do not have compatible signatures.

```
class GenericGrowthGroup(UniqueRepresentation, Parent, WithLocals):
    def __init__(self, base, category, var): ...
class CartesianProduct_base(WithPicklingByInitArgs, Parent):
    def __init__(self, sets, category, flatten=False): ...
class CartesianProductPoset(CartesianProduct_unique):
    def __init__(self, sets, category, order=None, **kwargs):
```



---

archive/issue_comments_338334.json:
```json
{
    "body": "Changing commit from \"32f227b551a021de34c18ec862bc0327910b5b98\" to \"997cc7cc92bebcb491594ca586eadf5cfc591271\"",
    "created_at": "2022-08-17T01:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338334",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "32f227b551a021de34c18ec862bc0327910b5b98" to "997cc7cc92bebcb491594ca586eadf5cfc591271"



---

archive/issue_comments_338335.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|\n|[46f4bf3](https://github.com/sagemath/sagetrac-mirror/commit/46f4bf343586248f87da223121e1db9fee801152)|`src/sage/rings/asymptotic/growth_group_cartesian.py: CartesianProduct -> CartesianProduct_unique`|\n|[997cc7c](https://github.com/sagemath/sagetrac-mirror/commit/997cc7cc92bebcb491594ca586eadf5cfc591271)|`src/sage/rings/asymptotic, src/sage/combinat/posets: Replace some super().__init__ by direct calls`|",
    "created_at": "2022-08-17T01:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
|[46f4bf3](https://github.com/sagemath/sagetrac-mirror/commit/46f4bf343586248f87da223121e1db9fee801152)|`src/sage/rings/asymptotic/growth_group_cartesian.py: CartesianProduct -> CartesianProduct_unique`|
|[997cc7c](https://github.com/sagemath/sagetrac-mirror/commit/997cc7cc92bebcb491594ca586eadf5cfc591271)|`src/sage/rings/asymptotic, src/sage/combinat/posets: Replace some super().__init__ by direct calls`|



---

archive/issue_comments_338336.json:
```json
{
    "body": "<a id='comment:6'></a>\nNow what remains are lots of infinite recursions involving `_element_constructor_` in sage/rings/asymptotic",
    "created_at": "2022-08-17T01:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338336",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Now what remains are lots of infinite recursions involving `_element_constructor_` in sage/rings/asymptotic



---

archive/issue_comments_338337.json:
```json
{
    "body": "Changing work_issues from \"Add missing doctests\" to \"fix sage.rings.asymptotic\"",
    "created_at": "2022-08-17T17:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338337",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "Add missing doctests" to "fix sage.rings.asymptotic"



---

archive/issue_comments_338338.json:
```json
{
    "body": "Changing author from \"Fr\u00e9d\u00e9ric Chapoton, Matthias Koeppe\" to \"Fr\u00e9d\u00e9ric Chapoton, Matthias Koeppe, ...\"",
    "created_at": "2022-08-17T17:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338338",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Frédéric Chapoton, Matthias Koeppe" to "Frédéric Chapoton, Matthias Koeppe, ..."



---

archive/issue_comments_338339.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750\n \n-This will solve #18849.\n+This will solve #18849 and probably #24900.\n \n Part of #15425: Meta-ticket: Cleanup cartesian products\n``````\n",
    "created_at": "2022-08-30T05:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19195#issuecomment-338339",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 It is not simple to get rid of this since there is no check in constructing element of a combinatorial free module... hence changing the basis from being tuples to be element of a cartesian product might lead to subtle errors (e.g. http://trac.sagemath.org/ticket/18411#comment:24). This is addressed in #18750
 
-This will solve #18849.
+This will solve #18849 and probably #24900.
 
 Part of #15425: Meta-ticket: Cleanup cartesian products
``````




---

archive/issue_events_068391.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68391"
}
```



---

archive/issue_events_068392.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19195",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19195#event-68392"
}
```
