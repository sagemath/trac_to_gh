# Issue 19610: Fix dependencies on PARI

archive/issues_019373.json:
```json
{
    "assignees": [],
    "body": "The extension modules linking against PARI should explicitly depend on the PARI headers. This is in particular true for `sage/ext/interrupt/interrupt.pyx`.\n\nSince every module cimporting something from PARI will cimport `sage.libs.pari.types`, we add the explicit dependency there.\n\nIn order to have the correct distutils keywords for `sage/ext/interrupt/interrupt.pyx`, we cimport `sage.libs.pari.paridecl` there.\n\nCC:  @kiwifb @jpflori\n\nBranch/Commit: **[`5d0e4d3`](https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035)**\n\nReviewer: **Jean-Pierre Flori**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **cython**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19610_\n\n",
    "closed_at": "2015-12-25T16:16:45Z",
    "created_at": "2015-11-21T08:23:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20cython",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix dependencies on PARI",
    "type": "issue",
    "updated_at": "2015-12-25T16:16:45Z",
    "url": "https://github.com/sagemath/sage/issues/19610",
    "user": "https://github.com/jdemeyer"
}
```
The extension modules linking against PARI should explicitly depend on the PARI headers. This is in particular true for `sage/ext/interrupt/interrupt.pyx`.

Since every module cimporting something from PARI will cimport `sage.libs.pari.types`, we add the explicit dependency there.

In order to have the correct distutils keywords for `sage/ext/interrupt/interrupt.pyx`, we cimport `sage.libs.pari.paridecl` there.

CC:  @kiwifb @jpflori

Branch/Commit: **[`5d0e4d3`](https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035)**

Reviewer: **Jean-Pierre Flori**

Author: **Jeroen Demeyer**

Component: **cython**

_Issue created by migration from https://trac.sagemath.org/ticket/19610_





---

archive/issue_events_277709.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:23:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277709"
}
```



---

archive/issue_events_277710.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:23:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "000080",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277710"
}
```



---

archive/issue_events_277711.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:23:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277711"
}
```



---

archive/issue_events_277712.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:23:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277712"
}
```



---

archive/issue_comments_279623.json:
```json
{
    "body": "Branch: **[u/jdemeyer/fix_dependencies_on_pari](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_dependencies_on_pari)**",
    "created_at": "2015-11-21T13:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279623",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/fix_dependencies_on_pari](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_dependencies_on_pari)**



---

archive/issue_comments_279624.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2015-11-21T13:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279624",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_events_277713.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T13:33:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277713"
}
```



---

archive/issue_comments_279625.json:
```json
{
    "body": "Commit: **[`5d0e4d3`](https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035)**",
    "created_at": "2015-11-21T13:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279625",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`5d0e4d3`](https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035)**



---

archive/issue_comments_279626.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035\">5d0e4d3</a></td><td><code>Fix dependencies on PARI</code></td></tr></table>\n",
    "created_at": "2015-11-21T13:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279626",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035">5d0e4d3</a></td><td><code>Fix dependencies on PARI</code></td></tr></table>




---

archive/issue_comments_279627.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n+Fixes overlinking `interrupt.so`; cf. [comment:ticket:19589:34].\n \n``````\n",
    "created_at": "2015-11-21T16:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279627",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,2 @@
+Fixes overlinking `interrupt.so`; cf. [comment:ticket:19589:34].
 
``````




---

archive/issue_comments_279628.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nMaybe I misunderstood the purpose of this ticket (cf. the description I added), but after pulling the branch here, `interrupt.so` still gets linked to both PARI and GMP (i.e., MPIR).\n\n(Probably you just intended a proper rebuild of it upon changes to libgmp, but the patch looks as if you intended to remove the libraries from the extension module.)\n\nIMHO at most PARI should get linked to it.",
    "created_at": "2015-11-21T19:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279628",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

Maybe I misunderstood the purpose of this ticket (cf. the description I added), but after pulling the branch here, `interrupt.so` still gets linked to both PARI and GMP (i.e., MPIR).

(Probably you just intended a proper rebuild of it upon changes to libgmp, but the patch looks as if you intended to remove the libraries from the extension module.)

IMHO at most PARI should get linked to it.



---

archive/issue_events_277714.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-11-21T19:46:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277714"
}
```



---

archive/issue_events_277715.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-11-21T19:46:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277715"
}
```



---

archive/issue_comments_279629.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOk, I see, in `sage/libs/pari/paridecl.pxd`, there's (still)\n\n```python\n# distutils: libraries = gmp pari\n```\n\nDo we really need `gmp` there as well?",
    "created_at": "2015-11-21T20:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279629",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Ok, I see, in `sage/libs/pari/paridecl.pxd`, there's (still)

```python
# distutils: libraries = gmp pari
```

Do we really need `gmp` there as well?



---

archive/issue_comments_279630.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nCertainly `interrupt.so` doesn't use/need GMP (but `PARI_SIGINT_*` from PARI), but can we (easily) remove GMP from it?\n\nAFAICS, the declarations are only needed/used in `sage/ext/interrupt/implementation.c`, i.e., genuine C code, not Cython.",
    "created_at": "2015-11-21T20:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279630",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

Certainly `interrupt.so` doesn't use/need GMP (but `PARI_SIGINT_*` from PARI), but can we (easily) remove GMP from it?

AFAICS, the declarations are only needed/used in `sage/ext/interrupt/implementation.c`, i.e., genuine C code, not Cython.



---

archive/issue_comments_279631.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe following works for me to get rid of GMP (i.e., avoids overlinking `interrupt.so` with libgmp):\n\n```diff\ndiff --git a/src/sage/ext/interrupt/implementation.c b/src/sage/ext/interrupt/implementation.c\nindex 7b96199..55dac47 100644\n--- a/src/sage/ext/interrupt/implementation.c\n+++ b/src/sage/ext/interrupt/implementation.c\n@@ -42,7 +42,18 @@ AUTHORS:\n #ifdef __linux__\n #include <sys/prctl.h>\n #endif\n-#include <pari/pari.h>\n+\n+#include <pari/paricfg.h>\n+#include <pari/parisys.h>      /* needed for THREAD and VOLATILE */\n+#if 0\n+/* further includes would be needed, see below */\n+#include <pari/paricom.h>      /* needed for PARI_SIGINT_* */\n+#else\n+/* It's hard to selectively include PARI headers (i.e., declarations), */\n+/* so we *copy* them (from pari/paricom.h): */\n+extern THREAD VOLATILE int PARI_SIGINT_block, PARI_SIGINT_pending;\n+#endif\n+\n #include \"interrupt/struct_signals.h\"\n #include \"interrupt/interrupt.h\"\n \ndiff --git a/src/sage/ext/interrupt/interrupt.pxd b/src/sage/ext/interrupt/interrupt.pxd\nindex 3818447..c1a3b54 100644\n--- a/src/sage/ext/interrupt/interrupt.pxd\n+++ b/src/sage/ext/interrupt/interrupt.pxd\n@@ -1,4 +1,5 @@\n # distutils: depends = INTERRUPT_DEPENDS\n+# distutils: libraries = pari\n #\n # NOTE: these functions are actually defined in \"macros.h\".\n # However, we intentionally do not mention that file here, because\ndiff --git a/src/sage/ext/interrupt/interrupt.pyx b/src/sage/ext/interrupt/interrupt.pyx\nindex ed4552a..97dd96d 100644\n--- a/src/sage/ext/interrupt/interrupt.pyx\n+++ b/src/sage/ext/interrupt/interrupt.pyx\n@@ -23,9 +23,6 @@ from libc.signal cimport *\n from libc.stdio cimport freopen, stdin\n from cpython.exc cimport PyErr_Occurred\n \n-# Needed for PARI_SIGINT_block in implementation.c:\n-cimport sage.libs.pari.paridecl\n-\n cdef extern from \"interrupt/implementation.c\":\n     sage_signals_t _signals \"_signals\"\n     void setup_sage_signal_handler() nogil\n```\n(preliminary hack)\n\nProbably another `distutils: depends` for PARI is needed in `sage/ext/interrupt/interrupt.pxd`.",
    "created_at": "2015-11-21T21:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279631",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

The following works for me to get rid of GMP (i.e., avoids overlinking `interrupt.so` with libgmp):

```diff
diff --git a/src/sage/ext/interrupt/implementation.c b/src/sage/ext/interrupt/implementation.c
index 7b96199..55dac47 100644
--- a/src/sage/ext/interrupt/implementation.c
+++ b/src/sage/ext/interrupt/implementation.c
@@ -42,7 +42,18 @@ AUTHORS:
 #ifdef __linux__
 #include <sys/prctl.h>
 #endif
-#include <pari/pari.h>
+
+#include <pari/paricfg.h>
+#include <pari/parisys.h>      /* needed for THREAD and VOLATILE */
+#if 0
+/* further includes would be needed, see below */
+#include <pari/paricom.h>      /* needed for PARI_SIGINT_* */
+#else
+/* It's hard to selectively include PARI headers (i.e., declarations), */
+/* so we *copy* them (from pari/paricom.h): */
+extern THREAD VOLATILE int PARI_SIGINT_block, PARI_SIGINT_pending;
+#endif
+
 #include "interrupt/struct_signals.h"
 #include "interrupt/interrupt.h"
 
diff --git a/src/sage/ext/interrupt/interrupt.pxd b/src/sage/ext/interrupt/interrupt.pxd
index 3818447..c1a3b54 100644
--- a/src/sage/ext/interrupt/interrupt.pxd
+++ b/src/sage/ext/interrupt/interrupt.pxd
@@ -1,4 +1,5 @@
 # distutils: depends = INTERRUPT_DEPENDS
+# distutils: libraries = pari
 #
 # NOTE: these functions are actually defined in "macros.h".
 # However, we intentionally do not mention that file here, because
diff --git a/src/sage/ext/interrupt/interrupt.pyx b/src/sage/ext/interrupt/interrupt.pyx
index ed4552a..97dd96d 100644
--- a/src/sage/ext/interrupt/interrupt.pyx
+++ b/src/sage/ext/interrupt/interrupt.pyx
@@ -23,9 +23,6 @@ from libc.signal cimport *
 from libc.stdio cimport freopen, stdin
 from cpython.exc cimport PyErr_Occurred
 
-# Needed for PARI_SIGINT_block in implementation.c:
-cimport sage.libs.pari.paridecl
-
 cdef extern from "interrupt/implementation.c":
     sage_signals_t _signals "_signals"
     void setup_sage_signal_handler() nogil
```
(preliminary hack)

Probably another `distutils: depends` for PARI is needed in `sage/ext/interrupt/interrupt.pxd`.



---

archive/issue_comments_279632.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nP.S.:  The copied declarations are IMHO unlikely to change.",
    "created_at": "2015-11-21T21:38:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279632",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

P.S.:  The copied declarations are IMHO unlikely to change.



---

archive/issue_comments_279633.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@nexttime](#comment:7):\n> The following works for me to get rid of GMP (i.e., avoids overlinking `interrupt.so` with libgmp):\n> ...\n> (preliminary hack)\n> \n> Probably another `distutils: depends` for PARI is needed in `sage/ext/interrupt/interrupt.pxd`.\n\nAnyway, I pushed a slightly cleaner version to [u/leif/19610_reviewer-remove_libgmp_from_interrupt.so](https://github.com/sagemath/sagetrac-mirror/commit/e12e9b61467b4109500c0da7f2490e25a4dbecc7).",
    "created_at": "2015-11-21T22:22:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279633",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@nexttime](#comment:7):
> The following works for me to get rid of GMP (i.e., avoids overlinking `interrupt.so` with libgmp):
> ...
> (preliminary hack)
> 
> Probably another `distutils: depends` for PARI is needed in `sage/ext/interrupt/interrupt.pxd`.

Anyway, I pushed a slightly cleaner version to [u/leif/19610_reviewer-remove_libgmp_from_interrupt.so](https://github.com/sagemath/sagetrac-mirror/commit/e12e9b61467b4109500c0da7f2490e25a4dbecc7).



---

archive/issue_comments_279634.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@nexttime](#comment:4):\n> Maybe I misunderstood the purpose of this ticket\n\nYou did.",
    "created_at": "2015-11-22T09:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279634",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@nexttime](#comment:4):
> Maybe I misunderstood the purpose of this ticket

You did.



---

archive/issue_comments_279635.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,5 @@\n-Fixes overlinking `interrupt.so`; cf. [comment:ticket:19589:34].\n+The extension modules linking against PARI should explicitly depend on the PARI headers. This is in particular true for `sage/ext/interrupt/interrupt.pyx`.\n \n+Since every module cimporting something from PARI will cimport `sage.libs.pari.types`, we add the explicit dependency there.\n+\n+In order to have the correct distutils keywords for `sage/ext/interrupt/interrupt.pyx`, we cimport `sage.libs.pari.paridecl` there.\n``````\n",
    "created_at": "2015-11-22T09:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279635",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,5 @@
-Fixes overlinking `interrupt.so`; cf. [comment:ticket:19589:34].
+The extension modules linking against PARI should explicitly depend on the PARI headers. This is in particular true for `sage/ext/interrupt/interrupt.pyx`.
 
+Since every module cimporting something from PARI will cimport `sage.libs.pari.types`, we add the explicit dependency there.
+
+In order to have the correct distutils keywords for `sage/ext/interrupt/interrupt.pyx`, we cimport `sage.libs.pari.paridecl` there.
``````




---

archive/issue_events_277716.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-22T09:44:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277716"
}
```



---

archive/issue_events_277717.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-22T09:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277717"
}
```



---

archive/issue_comments_279636.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@nexttime](#comment:5):\n> Ok, I see, in `sage/libs/pari/paridecl.pxd`, there's (still)\n> \n> ```python\n> # distutils: libraries = gmp pari\n> ```\n> \n> Do we really need `gmp` there as well?\n\nYes, because PARI needs gmp:\n\n```\n$ ldd local/lib/libpari.so \n        linux-vdso.so.1 (0x00007fffaa5fe000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007fb572c81000)\n        libm.so.6 => /lib64/libm.so.6 (0x00007fb572992000)\n        libgmp.so.16 => /usr/local/src/sage-git/local/lib/libgmp.so.16 (0x00007fb57271d000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fb572519000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fb5738fd000)\n```",
    "created_at": "2015-11-22T09:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279636",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@nexttime](#comment:5):
> Ok, I see, in `sage/libs/pari/paridecl.pxd`, there's (still)
> 
> ```python
> # distutils: libraries = gmp pari
> ```
> 
> Do we really need `gmp` there as well?

Yes, because PARI needs gmp:

```
$ ldd local/lib/libpari.so 
        linux-vdso.so.1 (0x00007fffaa5fe000)
        libc.so.6 => /lib64/libc.so.6 (0x00007fb572c81000)
        libm.so.6 => /lib64/libm.so.6 (0x00007fb572992000)
        libgmp.so.16 => /usr/local/src/sage-git/local/lib/libgmp.so.16 (0x00007fb57271d000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00007fb572519000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fb5738fd000)
```



---

archive/issue_comments_279637.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment:11):\n> Replying to [@nexttime](#comment:5):\n> > Ok, I see, in `sage/libs/pari/paridecl.pxd`, there's (still)\n> > \n> > ```python\n> > # distutils: libraries = gmp pari\n> > ```\n> > \n> > Do we really need `gmp` there as well?\n\n> \n> Yes, because PARI needs gmp:\n> \n> ```\n> $ ldd local/lib/libpari.so \n>         linux-vdso.so.1 (0x00007fffaa5fe000)\n>         libc.so.6 => /lib64/libc.so.6 (0x00007fb572c81000)\n>         libm.so.6 => /lib64/libm.so.6 (0x00007fb572992000)\n>         libgmp.so.16 => /usr/local/src/sage-git/local/lib/libgmp.so.16 (0x00007fb57271d000)\n>         libdl.so.2 => /lib64/libdl.so.2 (0x00007fb572519000)\n>         /lib64/ld-linux-x86-64.so.2 (0x00007fb5738fd000)\n> ```\n\nWell, of course **PARI** needs GMP, but not (necessarily) modules using PARI; that's a transitive dependency.  Unless you link statically, you don't have to explicitly specify GMP (and you shouldn't), because the dependency of PARI on GMP is recorded in `libpari.so`.\n\nIf GMP changes, PARI will get rebuilt, and hence also modules depending on PARI.\n\nThe reason `libgmp` was listed **twice** (and different versions of it!) [comment:ticket:19589:18 in your ldd output] is exactly such overlinking.",
    "created_at": "2015-11-22T11:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279637",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment:11):
> Replying to [@nexttime](#comment:5):
> > Ok, I see, in `sage/libs/pari/paridecl.pxd`, there's (still)
> > 
> > ```python
> > # distutils: libraries = gmp pari
> > ```
> > 
> > Do we really need `gmp` there as well?

> 
> Yes, because PARI needs gmp:
> 
> ```
> $ ldd local/lib/libpari.so 
>         linux-vdso.so.1 (0x00007fffaa5fe000)
>         libc.so.6 => /lib64/libc.so.6 (0x00007fb572c81000)
>         libm.so.6 => /lib64/libm.so.6 (0x00007fb572992000)
>         libgmp.so.16 => /usr/local/src/sage-git/local/lib/libgmp.so.16 (0x00007fb57271d000)
>         libdl.so.2 => /lib64/libdl.so.2 (0x00007fb572519000)
>         /lib64/ld-linux-x86-64.so.2 (0x00007fb5738fd000)
> ```

Well, of course **PARI** needs GMP, but not (necessarily) modules using PARI; that's a transitive dependency.  Unless you link statically, you don't have to explicitly specify GMP (and you shouldn't), because the dependency of PARI on GMP is recorded in `libpari.so`.

If GMP changes, PARI will get rebuilt, and hence also modules depending on PARI.

The reason `libgmp` was listed **twice** (and different versions of it!) [comment:ticket:19589:18 in your ldd output] is exactly such overlinking.



---

archive/issue_comments_279638.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@nexttime](#comment:12):\n> Well, of course **PARI** needs GMP, but not (necessarily) modules using PARI; that's a transitive dependency.  Unless you link statically, you don't have to explicitly specify GMP (and you shouldn't), because the dependency of PARI on GMP is recorded in `libpari.so`.\n\nDo you have a reference for this? It's the first time I hear somebody say this.",
    "created_at": "2015-11-23T06:58:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279638",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@nexttime](#comment:12):
> Well, of course **PARI** needs GMP, but not (necessarily) modules using PARI; that's a transitive dependency.  Unless you link statically, you don't have to explicitly specify GMP (and you shouldn't), because the dependency of PARI on GMP is recorded in `libpari.so`.

Do you have a reference for this? It's the first time I hear somebody say this.



---

archive/issue_comments_279639.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReferences: \n* https://wiki.openmandriva.org/en/Overlinking_issues_in_packaging\n* https://en.altlinux.org/UnderOverLinkProblems",
    "created_at": "2015-11-23T07:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279639",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">comment:14</div>

References: 
* https://wiki.openmandriva.org/en/Overlinking_issues_in_packaging
* https://en.altlinux.org/UnderOverLinkProblems



---

archive/issue_comments_279640.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe linked documents are only about Linux (thanks for the links though). I'm not at all convinced that the same holds for all operating systems.",
    "created_at": "2015-11-23T09:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279640",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

The linked documents are only about Linux (thanks for the links though). I'm not at all convinced that the same holds for all operating systems.



---

archive/issue_comments_279641.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIf we decide to stop \"overlinking\", that would be a major change in how we build Sage. It is something which should be discussed on `sage-devel` first. Given that I'm not convinced that there is a problem, I'm not going to write about this.",
    "created_at": "2015-11-23T09:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279641",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

If we decide to stop "overlinking", that would be a major change in how we build Sage. It is something which should be discussed on `sage-devel` first. Given that I'm not convinced that there is a problem, I'm not going to write about this.



---

archive/issue_comments_279642.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWhat you are proposing is not portable: see the first few slides of [https://people.debian.org/~vorlon/dependency-hell/img0.html](https://people.debian.org/~vorlon/dependency-hell/img0.html)",
    "created_at": "2015-11-23T09:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279642",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

What you are proposing is not portable: see the first few slides of [https://people.debian.org/~vorlon/dependency-hell/img0.html](https://people.debian.org/~vorlon/dependency-hell/img0.html)



---

archive/issue_comments_279643.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment:16):\n> If we decide to stop \"overlinking\", that would be a major change in how we build Sage.\n\nNo.  We've cleaned up `module_list.py` a couple of times in the past with respect to this.\n\nNote that it's (only) *the common case* that you don't have to specify libraries used by the libraries you use.  (In particular, building the whole Sage library with the linker option `--as-needed` doesn't work, but would work for most modules.)\n\nThe main exceptions are:\n\n* A library is *intentionally* \"underlinked\", e.g. to allow the user to choose from different (binary-compatible) alternatives at the final link stage or even at run-time, or the user/application has to provide some symbols the library uses (e.g. memory management functions, error handlers etc.).\n\n* The interface of the library (i.e., the header) exposes symbols of a library it uses, such that your code at least *may* contain references to the otherwise only indirectly used library.  This is in principle the same as if you would explicitly use the other library directly as well, but not always as obvious, and may (or usually does) depend on your code, not necessarily just the header(s) you include.  (Stupid example:  PARI could have a function `pari_foo(x)` implemented as a macro or inline function which expands to `gmp_bar(x)` or of course more complicated code containing calls of GMP functions.  Then you'd have to explicitly link with GMP *if your code actually uses that macro or inline function*.  But it's also a poor example, in that for especially PARI/GMP, this is *not* the case -- AFAIK.  A better example is probably MPC/MPFR, but you hardly ever use MPC without also *explicitly* using MPFR.)",
    "created_at": "2015-11-23T12:52:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279643",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment:16):
> If we decide to stop "overlinking", that would be a major change in how we build Sage.

No.  We've cleaned up `module_list.py` a couple of times in the past with respect to this.

Note that it's (only) *the common case* that you don't have to specify libraries used by the libraries you use.  (In particular, building the whole Sage library with the linker option `--as-needed` doesn't work, but would work for most modules.)

The main exceptions are:

* A library is *intentionally* "underlinked", e.g. to allow the user to choose from different (binary-compatible) alternatives at the final link stage or even at run-time, or the user/application has to provide some symbols the library uses (e.g. memory management functions, error handlers etc.).

* The interface of the library (i.e., the header) exposes symbols of a library it uses, such that your code at least *may* contain references to the otherwise only indirectly used library.  This is in principle the same as if you would explicitly use the other library directly as well, but not always as obvious, and may (or usually does) depend on your code, not necessarily just the header(s) you include.  (Stupid example:  PARI could have a function `pari_foo(x)` implemented as a macro or inline function which expands to `gmp_bar(x)` or of course more complicated code containing calls of GMP functions.  Then you'd have to explicitly link with GMP *if your code actually uses that macro or inline function*.  But it's also a poor example, in that for especially PARI/GMP, this is *not* the case -- AFAIK.  A better example is probably MPC/MPFR, but you hardly ever use MPC without also *explicitly* using MPFR.)



---

archive/issue_comments_279644.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@nexttime](#comment:18):\n> Replying to [@jdemeyer](#comment:16):\n> > If we decide to stop \"overlinking\", that would be a major change in how we build Sage.\n\n> \n> No.  We've cleaned up `module_list.py` a couple of times in the past with respect to this.\n\nAre you sure? We've certainly cleaned up `module_list.py` a couple of times, but I don't think it ever was to remove libraries only appearing as indirect dependencies.",
    "created_at": "2015-11-23T12:55:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279644",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@nexttime](#comment:18):
> Replying to [@jdemeyer](#comment:16):
> > If we decide to stop "overlinking", that would be a major change in how we build Sage.

> 
> No.  We've cleaned up `module_list.py` a couple of times in the past with respect to this.

Are you sure? We've certainly cleaned up `module_list.py` a couple of times, but I don't think it ever was to remove libraries only appearing as indirect dependencies.



---

archive/issue_comments_279645.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jdemeyer](#comment:17):\n> What you are proposing is not portable\n\nWhat exactly do you think is not portable, to which platform?",
    "created_at": "2015-11-23T12:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279645",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jdemeyer](#comment:17):
> What you are proposing is not portable

What exactly do you think is not portable, to which platform?



---

archive/issue_comments_279646.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment:19):\n> Replying to [@nexttime](#comment:18):\n> > Replying to [@jdemeyer](#comment:16):\n> > > If we decide to stop \"overlinking\", that would be a major change in how we build Sage.\n\n> > \n> > No.  We've cleaned up `module_list.py` a couple of times in the past with respect to this.\n\n> Are you sure? We've certainly cleaned up `module_list.py` a couple of times, but I don't think it ever was to remove libraries only appearing as indirect dependencies.\n\nROFL, e.g. #18777?  (The others date back much longer...)",
    "created_at": "2015-11-23T13:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279646",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment:19):
> Replying to [@nexttime](#comment:18):
> > Replying to [@jdemeyer](#comment:16):
> > > If we decide to stop "overlinking", that would be a major change in how we build Sage.

> > 
> > No.  We've cleaned up `module_list.py` a couple of times in the past with respect to this.

> Are you sure? We've certainly cleaned up `module_list.py` a couple of times, but I don't think it ever was to remove libraries only appearing as indirect dependencies.

ROFL, e.g. #18777?  (The others date back much longer...)



---

archive/issue_comments_279647.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@nexttime](#comment:21):\n> ROFL, e.g. #18777?  (The others date back much longer...)\n\n#18777 removed libraries which were unused by that module. You are here proposing something different: to remove libraries which are used indirectly by a module.",
    "created_at": "2015-11-23T13:18:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279647",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@nexttime](#comment:21):
> ROFL, e.g. #18777?  (The others date back much longer...)

#18777 removed libraries which were unused by that module. You are here proposing something different: to remove libraries which are used indirectly by a module.



---

archive/issue_comments_279648.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@nexttime](#comment:20):\n> What exactly do you think is not portable\n\nI doubt that the following statement is true on all operating systems:\n> Unless you link statically, you don't have to explicitly specify GMP, because the dependency of PARI on GMP is recorded in `libpari.so`.",
    "created_at": "2015-11-23T13:18:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279648",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@nexttime](#comment:20):
> What exactly do you think is not portable

I doubt that the following statement is true on all operating systems:
> Unless you link statically, you don't have to explicitly specify GMP, because the dependency of PARI on GMP is recorded in `libpari.so`.



---

archive/issue_comments_279649.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAnyway, can we please go back to the review of this ticket? If you want to discuss more general linking issues, open a thread on `sage-devel`.",
    "created_at": "2015-11-23T13:20:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279649",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Anyway, can we please go back to the review of this ticket? If you want to discuss more general linking issues, open a thread on `sage-devel`.



---

archive/issue_comments_279650.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jdemeyer](#comment:24):\n> If you want to discuss more general linking issues, open a thread on `sage-devel`.\n\nWell, *you* asked general questions.\n\n> Anyway, can we please go back to the review of this ticket?\n\n`interrupt.so` still does not need GMP, but with your current patch, GMP gets linked to it.  (Worse, not even the Cython code, `interrupt.*`, where `paridecl` gets imported, uses any PARI stuff.)  I agree that copy-pasting parts of PARI headers (although it's just a single line) is not nice, but that's more a problem of the PARI headers and I was simply getting bored of trying which to include and which not.  (Probably the top-level one is ok as well, but seems overkill to me.)\n\nI still don't like the IMHO redundant `libraries = pari gmp` (in `paridecl.pxd`), but it's not a major issue either (until we or some people switch to PARI with a different kernel at least).\n\nPerhaps cc some more reviewers, e.g. Fran\u00e7ois.",
    "created_at": "2015-11-23T14:43:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279650",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jdemeyer](#comment:24):
> If you want to discuss more general linking issues, open a thread on `sage-devel`.

Well, *you* asked general questions.

> Anyway, can we please go back to the review of this ticket?

`interrupt.so` still does not need GMP, but with your current patch, GMP gets linked to it.  (Worse, not even the Cython code, `interrupt.*`, where `paridecl` gets imported, uses any PARI stuff.)  I agree that copy-pasting parts of PARI headers (although it's just a single line) is not nice, but that's more a problem of the PARI headers and I was simply getting bored of trying which to include and which not.  (Probably the top-level one is ok as well, but seems overkill to me.)

I still don't like the IMHO redundant `libraries = pari gmp` (in `paridecl.pxd`), but it's not a major issue either (until we or some people switch to PARI with a different kernel at least).

Perhaps cc some more reviewers, e.g. Fran√ßois.



---

archive/issue_comments_279651.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jdemeyer](#comment:23):\n> Replying to [@nexttime](#comment:20):\n> I doubt that the following statement is true on all operating systems:\n> > Unless you link statically, you don't have to explicitly specify GMP, because the dependency of PARI on GMP is recorded in `libpari.so`.\n\nThere are certainly OSs which don't have shared/dynamic libraries...\n\nBut besides that their names/extensions vary, the above holds for all platforms supported by Sage, *AFAIK<sup>TM</sup>*.",
    "created_at": "2015-11-23T14:52:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279651",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jdemeyer](#comment:23):
> Replying to [@nexttime](#comment:20):
> I doubt that the following statement is true on all operating systems:
> > Unless you link statically, you don't have to explicitly specify GMP, because the dependency of PARI on GMP is recorded in `libpari.so`.

There are certainly OSs which don't have shared/dynamic libraries...

But besides that their names/extensions vary, the above holds for all platforms supported by Sage, *AFAIK<sup>TM</sup>*.



---

archive/issue_comments_279652.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@nexttime](#comment:25):\n> `interrupt.so` still does not need GMP, but with your current patch, GMP gets linked to it.\n\nIt does need GMP since it uses PARI which needs GMP. It's true that the Cython code doesn't use anything of PARI or GMP, but the C code in `implementation.c` does.",
    "created_at": "2015-11-23T16:13:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279652",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@nexttime](#comment:25):
> `interrupt.so` still does not need GMP, but with your current patch, GMP gets linked to it.

It does need GMP since it uses PARI which needs GMP. It's true that the Cython code doesn't use anything of PARI or GMP, but the C code in `implementation.c` does.



---

archive/issue_comments_279653.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOK, you wanted me in on this.\n\n```\nfbissey@QCD-nzi3 ~ $ ldd -r /usr/lib64/python2.7/site-packages/sage/ext/interrupt/interrupt.so\n        linux-vdso.so.1 (0x00007fffa4fff000)\n        libpari-gmp-2.8.so.0 => /usr/lib64/libpari-gmp-2.8.so.0 (0x00007fa7e3b1e000)\n        libpython2.7.so.1.0 => /usr/lib64/libpython2.7.so.1.0 (0x00007fa7e375e000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007fa7e33c3000)\n        libm.so.6 => /lib64/libm.so.6 (0x00007fa7e30bf000)\n        libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007fa7e2e4e000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fa7e2c49000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fa7e2a2d000)\n        libutil.so.1 => /lib64/libutil.so.1 (0x00007fa7e282a000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fa7e4564000)\n```\nbut \n\n```\nfbissey@QCD-nzi3 ~ $ readelf -d /usr/lib64/python2.7/site-packages/sage/ext/interrupt/interrupt.so\n\nDynamic section at offset 0x9d28 contains 26 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp-2.8.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0x2968\n 0x000000000000000d (FINI)               0x84b4\n 0x0000000000000019 (INIT_ARRAY)         0x209d10\n 0x000000000000001b (INIT_ARRAYSZ)       8 (bytes)\n 0x000000000000001a (FINI_ARRAY)         0x209d18\n 0x000000000000001c (FINI_ARRAYSZ)       8 (bytes)\n 0x000000006ffffef5 (GNU_HASH)           0x1c8\n 0x0000000000000005 (STRTAB)             0xd90\n 0x0000000000000006 (SYMTAB)             0x238\n 0x000000000000000a (STRSZ)              1956 (bytes)\n 0x000000000000000b (SYMENT)             24 (bytes)\n 0x0000000000000003 (PLTGOT)             0x20a000\n 0x0000000000000002 (PLTRELSZ)           2016 (bytes)\n 0x0000000000000014 (PLTREL)             RELA\n 0x0000000000000017 (JMPREL)             0x2188\n 0x0000000000000007 (RELA)               0x1678\n 0x0000000000000008 (RELASZ)             2832 (bytes)\n 0x0000000000000009 (RELAENT)            24 (bytes)\n 0x000000006ffffffe (VERNEED)            0x1628\n 0x000000006fffffff (VERNEEDNUM)         1\n 0x000000006ffffff0 (VERSYM)             0x1534\n 0x000000006ffffff9 (RELACOUNT)          87\n 0x0000000000000000 (NULL)               0x0\n```\nSo `sage-on-gentoo` is built with `-Wl,--as-needed` which discard unneeded libraries. Because `interrupt.so` doesn't directly use `gmp` it is not kept. For that to work libpari has to be properly linked to libgmp - by that I mean, libgmp has to be in the `NEEDED` section of libpari.\n\n```\nfbissey@QCD-nzi3 ~ $ readelf -d /usr/lib64/libpari-gmp-2.8.so.0.0.0 \n\nDynamic section at offset 0x5ca6d8 contains 28 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]\n 0x000000000000000e (SONAME)             Library soname: [libpari-gmp-2.8.so.0]\n 0x000000000000000c (INIT)               0x69900\n 0x000000000000000d (FINI)               0x4fb194\n 0x0000000000000019 (INIT_ARRAY)         0x7c98e8\n 0x000000000000001b (INIT_ARRAYSZ)       8 (bytes)\n 0x000000000000001a (FINI_ARRAY)         0x7c98f0\n 0x000000000000001c (FINI_ARRAYSZ)       8 (bytes)\n 0x000000006ffffef5 (GNU_HASH)           0x1c8\n 0x0000000000000005 (STRTAB)             0x26570\n 0x0000000000000006 (SYMTAB)             0x8090\n 0x000000000000000a (STRSZ)              57218 (bytes)\n 0x000000000000000b (SYMENT)             24 (bytes)\n 0x0000000000000003 (PLTGOT)             0x7cb000\n 0x0000000000000002 (PLTRELSZ)           85704 (bytes)\n 0x0000000000000014 (PLTREL)             RELA\n 0x0000000000000017 (JMPREL)             0x54a38\n 0x0000000000000007 (RELA)               0x36e10\n 0x0000000000000008 (RELASZ)             121896 (bytes)\n 0x0000000000000009 (RELAENT)            24 (bytes)\n 0x000000006ffffffe (VERNEED)            0x36d60\n 0x000000006fffffff (VERNEEDNUM)         3\n 0x000000006ffffff0 (VERSYM)             0x344f2\n 0x000000006ffffff9 (RELACOUNT)          3899\n 0x0000000000000000 (NULL)               0x0\n```\n\nEquivalently on OS X everything will be fine so long as all the `install_name`s are properly set to the right value.\n\nYes it will break if your system only use static libraries. Static libraries don't know where to get their other needed bits - unless you bundle them in in the first place.\n\nI don't know if cygwin is properly equipped to deal with something like a `needed` section or even if it exists on windows (I'll confess ignorance in that matter). I also don't know how things will go on BSD, they are using elf but some bits may depend on the libc implementation and of course `ld`.\n\nLinking with `gmp` is not useful on OS X and linux but it won't hurt.",
    "created_at": "2015-11-23T20:41:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279653",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:28" align="right">comment:28</div>

OK, you wanted me in on this.

```
fbissey@QCD-nzi3 ~ $ ldd -r /usr/lib64/python2.7/site-packages/sage/ext/interrupt/interrupt.so
        linux-vdso.so.1 (0x00007fffa4fff000)
        libpari-gmp-2.8.so.0 => /usr/lib64/libpari-gmp-2.8.so.0 (0x00007fa7e3b1e000)
        libpython2.7.so.1.0 => /usr/lib64/libpython2.7.so.1.0 (0x00007fa7e375e000)
        libc.so.6 => /lib64/libc.so.6 (0x00007fa7e33c3000)
        libm.so.6 => /lib64/libm.so.6 (0x00007fa7e30bf000)
        libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007fa7e2e4e000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00007fa7e2c49000)
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fa7e2a2d000)
        libutil.so.1 => /lib64/libutil.so.1 (0x00007fa7e282a000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fa7e4564000)
```
but 

```
fbissey@QCD-nzi3 ~ $ readelf -d /usr/lib64/python2.7/site-packages/sage/ext/interrupt/interrupt.so

Dynamic section at offset 0x9d28 contains 26 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp-2.8.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0x2968
 0x000000000000000d (FINI)               0x84b4
 0x0000000000000019 (INIT_ARRAY)         0x209d10
 0x000000000000001b (INIT_ARRAYSZ)       8 (bytes)
 0x000000000000001a (FINI_ARRAY)         0x209d18
 0x000000000000001c (FINI_ARRAYSZ)       8 (bytes)
 0x000000006ffffef5 (GNU_HASH)           0x1c8
 0x0000000000000005 (STRTAB)             0xd90
 0x0000000000000006 (SYMTAB)             0x238
 0x000000000000000a (STRSZ)              1956 (bytes)
 0x000000000000000b (SYMENT)             24 (bytes)
 0x0000000000000003 (PLTGOT)             0x20a000
 0x0000000000000002 (PLTRELSZ)           2016 (bytes)
 0x0000000000000014 (PLTREL)             RELA
 0x0000000000000017 (JMPREL)             0x2188
 0x0000000000000007 (RELA)               0x1678
 0x0000000000000008 (RELASZ)             2832 (bytes)
 0x0000000000000009 (RELAENT)            24 (bytes)
 0x000000006ffffffe (VERNEED)            0x1628
 0x000000006fffffff (VERNEEDNUM)         1
 0x000000006ffffff0 (VERSYM)             0x1534
 0x000000006ffffff9 (RELACOUNT)          87
 0x0000000000000000 (NULL)               0x0
```
So `sage-on-gentoo` is built with `-Wl,--as-needed` which discard unneeded libraries. Because `interrupt.so` doesn't directly use `gmp` it is not kept. For that to work libpari has to be properly linked to libgmp - by that I mean, libgmp has to be in the `NEEDED` section of libpari.

```
fbissey@QCD-nzi3 ~ $ readelf -d /usr/lib64/libpari-gmp-2.8.so.0.0.0 

Dynamic section at offset 0x5ca6d8 contains 28 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libdl.so.2]
 0x000000000000000e (SONAME)             Library soname: [libpari-gmp-2.8.so.0]
 0x000000000000000c (INIT)               0x69900
 0x000000000000000d (FINI)               0x4fb194
 0x0000000000000019 (INIT_ARRAY)         0x7c98e8
 0x000000000000001b (INIT_ARRAYSZ)       8 (bytes)
 0x000000000000001a (FINI_ARRAY)         0x7c98f0
 0x000000000000001c (FINI_ARRAYSZ)       8 (bytes)
 0x000000006ffffef5 (GNU_HASH)           0x1c8
 0x0000000000000005 (STRTAB)             0x26570
 0x0000000000000006 (SYMTAB)             0x8090
 0x000000000000000a (STRSZ)              57218 (bytes)
 0x000000000000000b (SYMENT)             24 (bytes)
 0x0000000000000003 (PLTGOT)             0x7cb000
 0x0000000000000002 (PLTRELSZ)           85704 (bytes)
 0x0000000000000014 (PLTREL)             RELA
 0x0000000000000017 (JMPREL)             0x54a38
 0x0000000000000007 (RELA)               0x36e10
 0x0000000000000008 (RELASZ)             121896 (bytes)
 0x0000000000000009 (RELAENT)            24 (bytes)
 0x000000006ffffffe (VERNEED)            0x36d60
 0x000000006fffffff (VERNEEDNUM)         3
 0x000000006ffffff0 (VERSYM)             0x344f2
 0x000000006ffffff9 (RELACOUNT)          3899
 0x0000000000000000 (NULL)               0x0
```

Equivalently on OS X everything will be fine so long as all the `install_name`s are properly set to the right value.

Yes it will break if your system only use static libraries. Static libraries don't know where to get their other needed bits - unless you bundle them in in the first place.

I don't know if cygwin is properly equipped to deal with something like a `needed` section or even if it exists on windows (I'll confess ignorance in that matter). I also don't know how things will go on BSD, they are using elf but some bits may depend on the libc implementation and of course `ld`.

Linking with `gmp` is not useful on OS X and linux but it won't hurt.



---

archive/issue_comments_279654.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI should say I haven't read the whole thread, and now that I see more of it. there are some points that can be made:\n* it is of course legal to underlink a library\n* only executable need to have all their symbols resolved\n\nA case in point is vanilla `gsl`. libgsl needs a `cblas` library but it is not linked against `cblas` implementation (unless you do something). So there is no entry for a `cblas` in the elf table. When you build an application against libgsl you have to provide a cblas library whether your application use cblas function or not, to resolve the `cblas` symbols in libgsl.\n\nIf libpari was underlinked like that you would have to provide your libgmp/libmpir all the time.\n\nRegarding your slides Gentoo applies \"the chasing your tail method\" (recompile on soname change). I think `sage` fits in that category too. I'll note that if you do it correctly a change in soname for libgmp will trigger a rebuild of libpari but not of interrupt.so _and it shouldn't have too_ if libpari didn't change its soname there is no impact on interrupt.so.\n\nIf your handling of soname is not done properly or your are overlinking you are exposing yourself to excessive rebuilding. Making sure your handling of soname is right is the hard bit. Only now do we have interesting mechanism that will trigger rebuild on soname change in Gentoo and I won't pretend that every gentoo dev understand them properly.",
    "created_at": "2015-11-23T21:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279654",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:29" align="right">comment:29</div>

I should say I haven't read the whole thread, and now that I see more of it. there are some points that can be made:
* it is of course legal to underlink a library
* only executable need to have all their symbols resolved

A case in point is vanilla `gsl`. libgsl needs a `cblas` library but it is not linked against `cblas` implementation (unless you do something). So there is no entry for a `cblas` in the elf table. When you build an application against libgsl you have to provide a cblas library whether your application use cblas function or not, to resolve the `cblas` symbols in libgsl.

If libpari was underlinked like that you would have to provide your libgmp/libmpir all the time.

Regarding your slides Gentoo applies "the chasing your tail method" (recompile on soname change). I think `sage` fits in that category too. I'll note that if you do it correctly a change in soname for libgmp will trigger a rebuild of libpari but not of interrupt.so _and it shouldn't have too_ if libpari didn't change its soname there is no impact on interrupt.so.

If your handling of soname is not done properly or your are overlinking you are exposing yourself to excessive rebuilding. Making sure your handling of soname is right is the hard bit. Only now do we have interesting mechanism that will trigger rebuild on soname change in Gentoo and I won't pretend that every gentoo dev understand them properly.



---

archive/issue_comments_279655.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nOne more to be in rant mode: dev that thinks soname and install_name are not important or even ignorant of them should be sent in re-education before touching a library (I am looking at you Fredrick Johansson with your `arb` package - and now that `arb` has been made standard it can contribute to the brokenness on OS X 10.11).",
    "created_at": "2015-11-23T21:16:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279655",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">comment:30</div>

One more to be in rant mode: dev that thinks soname and install_name are not important or even ignorant of them should be sent in re-education before touching a library (I am looking at you Fredrick Johansson with your `arb` package - and now that `arb` has been made standard it can contribute to the brokenness on OS X 10.11).



---

archive/issue_comments_279656.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jdemeyer](#comment:23):\n> I doubt that the following statement is true on all operating systems:\n> > Unless you link statically, you don't have to explicitly specify GMP, because the dependency of PARI on GMP is recorded in `libpari.so`.\n\nIt is (tautologically) true on every operating system where you can link shared libraries to other shared libraries.\n\nI don't know of an OS where you can't link libraries to libraries, but I'd bet that some obscure platform did that back in the old days. Today certainly not.",
    "created_at": "2015-11-24T21:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279656",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jdemeyer](#comment:23):
> I doubt that the following statement is true on all operating systems:
> > Unless you link statically, you don't have to explicitly specify GMP, because the dependency of PARI on GMP is recorded in `libpari.so`.

It is (tautologically) true on every operating system where you can link shared libraries to other shared libraries.

I don't know of an OS where you can't link libraries to libraries, but I'd bet that some obscure platform did that back in the old days. Today certainly not.



---

archive/issue_comments_279657.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@vbraun](#comment:31):\n> It is (tautologically) true on every operating system where you can link shared libraries to other shared libraries.\n\nI don't understand why this would be tautologically true. It might be true whenever the linker is sufficiently clever, but I don't know if that's the fact on all operating systems. I have particular doubts about Cygwin, because I know that linker command lines often have to be changed for Cygwin.",
    "created_at": "2015-11-25T08:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279657",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@vbraun](#comment:31):
> It is (tautologically) true on every operating system where you can link shared libraries to other shared libraries.

I don't understand why this would be tautologically true. It might be true whenever the linker is sufficiently clever, but I don't know if that's the fact on all operating systems. I have particular doubts about Cygwin, because I know that linker command lines often have to be changed for Cygwin.



---

archive/issue_comments_279658.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nWe should get rid of `decl.pxi`.\nAnd its several inclusions within other `pxd` files.",
    "created_at": "2015-12-04T14:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279658",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:34" align="right">comment:34</div>

We should get rid of `decl.pxi`.
And its several inclusions within other `pxd` files.



---

archive/issue_comments_279659.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@jpflori](#comment:34):\n> We should get rid of `decl.pxi`.\n> And its several inclusions within other `pxd` files.\n\nDid you mean to post this on #19590? But yes, of course we should.",
    "created_at": "2015-12-04T15:01:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279659",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@jpflori](#comment:34):
> We should get rid of `decl.pxi`.
> And its several inclusions within other `pxd` files.

Did you mean to post this on #19590? But yes, of course we should.



---

archive/issue_comments_279660.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nArgh yes, I did intend to post to the NTL ticket.",
    "created_at": "2015-12-04T15:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279660",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:36" align="right">comment:36</div>

Argh yes, I did intend to post to the NTL ticket.



---

archive/issue_comments_279661.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI'll check the recursive dep on Cygwin when I have some time.\nFor sure on Cygwin you have to explicitely specify every thing that is needed at link time.\nI don't remember how it goes when a linked lib itself needs another library but it might be the case you need to specify both in that case...\nIt sounds crazy but linking on Cygwin is.",
    "created_at": "2015-12-24T11:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279661",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:37" align="right">comment:37</div>

I'll check the recursive dep on Cygwin when I have some time.
For sure on Cygwin you have to explicitely specify every thing that is needed at link time.
I don't remember how it goes when a linked lib itself needs another library but it might be the case you need to specify both in that case...
It sounds crazy but linking on Cygwin is.



---

archive/issue_comments_279662.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nThis ticket has nothing to do with Cygwin, it's only about adding a dependency.",
    "created_at": "2015-12-24T11:50:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279662",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

This ticket has nothing to do with Cygwin, it's only about adding a dependency.



---

archive/issue_comments_279663.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThis is getting a bit too long, so let me try to summarize:\n\nReplying to [@jdemeyer](#comment:38):\n> This ticket has nothing to do with Cygwin, it's only about adding a dependency.\n\nBut the dependency is wrong (interrupt does not depend on gmp).\n\nCygwin doesn't really have shared libraries, it uses a static library hack (the Cygwin import library) at link time. \n\nSo the real question is should we\n* Overlink on all platforms\n* Artificially inject all libraries on Cygwin only (via LDFLAGS, say)",
    "created_at": "2015-12-24T12:09:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279663",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:39" align="right">comment:39</div>

This is getting a bit too long, so let me try to summarize:

Replying to [@jdemeyer](#comment:38):
> This ticket has nothing to do with Cygwin, it's only about adding a dependency.

But the dependency is wrong (interrupt does not depend on gmp).

Cygwin doesn't really have shared libraries, it uses a static library hack (the Cygwin import library) at link time. 

So the real question is should we
* Overlink on all platforms
* Artificially inject all libraries on Cygwin only (via LDFLAGS, say)



---

archive/issue_comments_279664.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@vbraun](#comment:39):\n> So the real question is should we\n> * Overlink on all platforms\n> * Artificially inject all libraries on Cygwin only (via LDFLAGS, say)\n\nSage has always chosen the first option, so there are probably many overlinked modules in Sage.\n\nSo: can we please just focus on the bug that this ticket is about? If you want to discuss overlinking, please do it somewhere else.",
    "created_at": "2015-12-24T12:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279664",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@vbraun](#comment:39):
> So the real question is should we
> * Overlink on all platforms
> * Artificially inject all libraries on Cygwin only (via LDFLAGS, say)

Sage has always chosen the first option, so there are probably many overlinked modules in Sage.

So: can we please just focus on the bug that this ticket is about? If you want to discuss overlinking, please do it somewhere else.



---

archive/issue_comments_279665.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nLet me also summarize: this ticket is about adding a dependency of `interrupt.pyx` on PARI.\n\nThis ticket has absolutely nothing to do with linking and it does not change anything related to linking.",
    "created_at": "2015-12-24T12:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279665",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Let me also summarize: this ticket is about adding a dependency of `interrupt.pyx` on PARI.

This ticket has absolutely nothing to do with linking and it does not change anything related to linking.



---

archive/issue_comments_279666.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nIt seems that we have a branch for each approach already so we might just as well merge the one we want to pursue in the future. \n\nJean-Pierre, do you have any thoughts on Cygwin?\n\nIMHO the \"always overlink\" approach is simpler and the cost of unnecessarily compiling an extension module is low (its just a single source file, no extra configure and recursive make).",
    "created_at": "2015-12-24T12:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279666",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:42" align="right">comment:42</div>

It seems that we have a branch for each approach already so we might just as well merge the one we want to pursue in the future. 

Jean-Pierre, do you have any thoughts on Cygwin?

IMHO the "always overlink" approach is simpler and the cost of unnecessarily compiling an extension module is low (its just a single source file, no extra configure and recursive make).



---

archive/issue_comments_279667.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nCan we please stop this? This has **NOTHING** to do with linking, why is that so hard to understand?",
    "created_at": "2015-12-24T12:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279667",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Can we please stop this? This has **NOTHING** to do with linking, why is that so hard to understand?



---

archive/issue_comments_279668.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nOr maybe I should turn the question around: why do you think that this ticket is somehow related to linking?",
    "created_at": "2015-12-24T12:42:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279668",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

Or maybe I should turn the question around: why do you think that this ticket is somehow related to linking?



---

archive/issue_events_277718.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2015-12-24T14:30:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277718"
}
```



---

archive/issue_events_277719.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2015-12-24T14:30:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277719"
}
```



---

archive/issue_comments_279669.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI suggest to fix the dependency here and fix the overlinking issue elsewhere (e.g. using leif branch).\n\nAs far as Cygwin is concerned, the situation is quite good actually: you just need to have at hand libs directly used by your executable/library and feed them to the linker with appropriate flags as I just tested on a VM.\nIf these libraries need further libraries then everything is resolved at run time.\nSo in the linking ticket, we can drop the `gmp` library.\n\nThe main issue with cygwin is that the need above is mandatory: if you wanna use a gmp function (whatever it relies on, even further libraries) then you need to tell it to the linker whereas linux is more negligent about that and just bet that at runtime every undefined symbol will be resolved.\nAnd many times people modified a random Sage cython file, use some gmp function (typically `mpn_popcount` don't ask me why :)) and forgott to make gmp a dependency.\nNowadays, thanks to Jeroen work, it should be less an issue as when people want to use `mpn_popcount` they have to cimport it and it will automagically tell the linker that gmp has to be linked in.",
    "created_at": "2015-12-24T14:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279669",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:45" align="right">comment:45</div>

I suggest to fix the dependency here and fix the overlinking issue elsewhere (e.g. using leif branch).

As far as Cygwin is concerned, the situation is quite good actually: you just need to have at hand libs directly used by your executable/library and feed them to the linker with appropriate flags as I just tested on a VM.
If these libraries need further libraries then everything is resolved at run time.
So in the linking ticket, we can drop the `gmp` library.

The main issue with cygwin is that the need above is mandatory: if you wanna use a gmp function (whatever it relies on, even further libraries) then you need to tell it to the linker whereas linux is more negligent about that and just bet that at runtime every undefined symbol will be resolved.
And many times people modified a random Sage cython file, use some gmp function (typically `mpn_popcount` don't ask me why :)) and forgott to make gmp a dependency.
Nowadays, thanks to Jeroen work, it should be less an issue as when people want to use `mpn_popcount` they have to cimport it and it will automagically tell the linker that gmp has to be linked in.



---

archive/issue_comments_279670.json:
```json
{
    "body": "Reviewer: **Jean-Pierre Flori**",
    "created_at": "2015-12-24T14:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279670",
    "user": "https://github.com/jpflori"
}
```

Reviewer: **Jean-Pierre Flori**



---

archive/issue_events_277720.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-25T16:16:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277720"
}
```



---

archive/issue_events_277721.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b6b70d012a6e7386e7d777ce1a9a45bd75f96ed1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-12-25T16:16:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19610#event-277721"
}
```



---

archive/issue_comments_279671.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/fix_dependencies_on_pari](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_dependencies_on_pari)** to **[`5d0e4d3`](https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035)**",
    "created_at": "2015-12-25T16:16:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19610#issuecomment-279671",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/fix_dependencies_on_pari](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_dependencies_on_pari)** to **[`5d0e4d3`](https://github.com/sagemath/sagetrac-mirror/commit/5d0e4d30588ab0f13bfc0770d2b4b407d7580035)**
