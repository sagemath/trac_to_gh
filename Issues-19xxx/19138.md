# Issue 19138: Discrete Gaussian Lattice Sampler Unexpected Behavour for _call_in_lattice()

archive/issues_018901.json:
```json
{
    "body": "The _call_in_lattice() method for DiscreteGaussianLatticeSampler is supposed to be a shortcut for __call__(), which outputs a sample from the discrete Gaussian distribution $D_{\\Lambda, c}$, in the case when the vector $c$ is in the lattice. The algorithm being used for sampling is [Gentry, Craig, Chris Peikert, and Vinod Vaikuntanathan. \"Trapdoors for hard lattices and new cryptographic constructions.\" Proceedings of the fortieth annual ACM symposium on Theory of computing. ACM, 2008]. \n\nHowever, this shortcut function seems to be oversimplifying the sampling process. For example, we take a non-standard basis of the standard lattice in dimension 2 and take $c = 0$:\n\n```\nsage: from sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler\nsage: B = Matrix([[1,1],[1,0]]); \nsage: D = DiscreteGaussianDistributionLatticeSampler(B, 5.0); \n\nsage: v0, v1 =[], []\nsage: for i in range(100):\n              v = D()\n              v0.append(v[0])\n              v1.append(v[1])\n\nsage: RR(std(v0))\n8.42768405826052\n\nsage: RR(std(v1))\n3.82193298177398\n```\nThe standard deviation of the two coordinates are visibly different, while they should be the same, since the Gaussian distribution on the standard lattice has spherical symmetry. \n\nI would guess a simple fix is to not use _call_in_lattice() and always use the more general _call().\n\nCC:  @malb\n\nKeywords: discrete gaussian lattice sampler call_in_lattice\n\nAuthor: Martin Albrecht\n\nBranch: u/malb/t19138-discrete-gaussian-lattice\n\nStatus: needs_work\n\nCommit: 8de8bed4dc46f4b912c411e2563516c468b3b4e9\n\nIssue created by migration from https://trac.sagemath.org/ticket/19138\n\n",
    "created_at": "2015-09-04T22:54:45Z",
    "labels": [
        "component: statistics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Discrete Gaussian Lattice Sampler Unexpected Behavour for _call_in_lattice()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19138",
    "user": "https://trac.sagemath.org/admin/accounts/users/haochen_uw"
}
```
The _call_in_lattice() method for DiscreteGaussianLatticeSampler is supposed to be a shortcut for __call__(), which outputs a sample from the discrete Gaussian distribution $D_{\Lambda, c}$, in the case when the vector $c$ is in the lattice. The algorithm being used for sampling is [Gentry, Craig, Chris Peikert, and Vinod Vaikuntanathan. "Trapdoors for hard lattices and new cryptographic constructions." Proceedings of the fortieth annual ACM symposium on Theory of computing. ACM, 2008]. 

However, this shortcut function seems to be oversimplifying the sampling process. For example, we take a non-standard basis of the standard lattice in dimension 2 and take $c = 0$:

```
sage: from sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler
sage: B = Matrix([[1,1],[1,0]]); 
sage: D = DiscreteGaussianDistributionLatticeSampler(B, 5.0); 

sage: v0, v1 =[], []
sage: for i in range(100):
              v = D()
              v0.append(v[0])
              v1.append(v[1])

sage: RR(std(v0))
8.42768405826052

sage: RR(std(v1))
3.82193298177398
```
The standard deviation of the two coordinates are visibly different, while they should be the same, since the Gaussian distribution on the standard lattice has spherical symmetry. 

I would guess a simple fix is to not use _call_in_lattice() and always use the more general _call().

CC:  @malb

Keywords: discrete gaussian lattice sampler call_in_lattice

Author: Martin Albrecht

Branch: u/malb/t19138-discrete-gaussian-lattice

Status: needs_work

Commit: 8de8bed4dc46f4b912c411e2563516c468b3b4e9

Issue created by migration from https://trac.sagemath.org/ticket/19138





---

archive/issue_comments_341168.json:
```json
{
    "body": "Changing commit from \"\" to \"4cd6b255ead3a345d271bafa6c06b550b89d804f\"",
    "created_at": "2015-09-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341168",
    "user": "https://github.com/malb"
}
```

Changing commit from "" to "4cd6b255ead3a345d271bafa6c06b550b89d804f"



---

archive/issue_comments_341169.json:
```json
{
    "body": "<a id='comment:1'></a>\nYou're right, I was being silly when I wrote that optimisation.\n\n---\nNew commits:\n|                                                                                                                                          |                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[0e0749d](http://git.sagemath.org/sage.git/commit/?id=0e0749dbf65d8a356a117cd1cd703f1d6cb679de)|`whitespace changes`|\n|[4cd6b25](http://git.sagemath.org/sage.git/commit/?id=4cd6b255ead3a345d271bafa6c06b550b89d804f)|`fix discrete gaussian distribution cf. #19138`|",
    "created_at": "2015-09-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341169",
    "user": "https://github.com/malb"
}
```

<a id='comment:1'></a>
You're right, I was being silly when I wrote that optimisation.

---
New commits:
|                                                                                                                                          |                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[0e0749d](http://git.sagemath.org/sage.git/commit/?id=0e0749dbf65d8a356a117cd1cd703f1d6cb679de)|`whitespace changes`|
|[4cd6b25](http://git.sagemath.org/sage.git/commit/?id=4cd6b255ead3a345d271bafa6c06b550b89d804f)|`fix discrete gaussian distribution cf. #19138`|



---

archive/issue_comments_341170.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Albrecht\"",
    "created_at": "2015-09-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341170",
    "user": "https://github.com/malb"
}
```

Changing author from "" to "Martin Albrecht"



---

archive/issue_comments_341171.json:
```json
{
    "body": "Changing branch from \"\" to \"u/malb/t19138-discrete-gaussian-lattice\"",
    "created_at": "2015-09-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341171",
    "user": "https://github.com/malb"
}
```

Changing branch from "" to "u/malb/t19138-discrete-gaussian-lattice"



---

archive/issue_comments_341172.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341172",
    "user": "https://github.com/malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_341173.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[647a482](http://git.sagemath.org/sage.git/commit/?id=647a4824953fe15eafeaf21dda483640cb8782b5)|`whitespace changes`|\n|[b4c52f0](http://git.sagemath.org/sage.git/commit/?id=b4c52f00db4be9900ef907e4a60cf434feae6ab3)|`fix discrete gaussian distribution cf. #19138`|",
    "created_at": "2016-05-13T20:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[647a482](http://git.sagemath.org/sage.git/commit/?id=647a4824953fe15eafeaf21dda483640cb8782b5)|`whitespace changes`|
|[b4c52f0](http://git.sagemath.org/sage.git/commit/?id=b4c52f00db4be9900ef907e4a60cf434feae6ab3)|`fix discrete gaussian distribution cf. #19138`|



---

archive/issue_comments_341174.json:
```json
{
    "body": "Changing commit from \"4cd6b255ead3a345d271bafa6c06b550b89d804f\" to \"b4c52f00db4be9900ef907e4a60cf434feae6ab3\"",
    "created_at": "2016-05-13T20:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4cd6b255ead3a345d271bafa6c06b550b89d804f" to "b4c52f00db4be9900ef907e4a60cf434feae6ab3"



---

archive/issue_comments_341175.json:
```json
{
    "body": "<a id='comment:3'></a>\nI've rebased this ticket to the current development branch. Anybody up for reviewing this ticket?",
    "created_at": "2016-05-13T20:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341175",
    "user": "https://github.com/malb"
}
```

<a id='comment:3'></a>
I've rebased this ticket to the current development branch. Anybody up for reviewing this ticket?



---

archive/issue_comments_341176.json:
```json
{
    "body": "<a id='comment:4'></a>\nwrong syntax here:\n\n```\nthat `trac:19138` is fixed\n```\nshould be\n\n```\nthat :trac:`19138` is fixed\n```",
    "created_at": "2016-05-13T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341176",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
wrong syntax here:

```
that `trac:19138` is fixed
```
should be

```
that :trac:`19138` is fixed
```



---

archive/issue_comments_341177.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[8de8bed](http://git.sagemath.org/sage.git/commit/?id=8de8bed4dc46f4b912c411e2563516c468b3b4e9)|`fix format in docstring`|",
    "created_at": "2016-05-13T22:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[8de8bed](http://git.sagemath.org/sage.git/commit/?id=8de8bed4dc46f4b912c411e2563516c468b3b4e9)|`fix format in docstring`|



---

archive/issue_comments_341178.json:
```json
{
    "body": "Changing commit from \"b4c52f00db4be9900ef907e4a60cf434feae6ab3\" to \"8de8bed4dc46f4b912c411e2563516c468b3b4e9\"",
    "created_at": "2016-05-13T22:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b4c52f00db4be9900ef907e4a60cf434feae6ab3" to "8de8bed4dc46f4b912c411e2563516c468b3b4e9"



---

archive/issue_comments_341179.json:
```json
{
    "body": "<a id='comment:6'></a>\ndoes not apply",
    "created_at": "2016-07-28T08:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341179",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
does not apply



---

archive/issue_comments_341180.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-28T08:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19138#issuecomment-341180",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.
