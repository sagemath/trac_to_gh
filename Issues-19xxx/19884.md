# Issue 19884: LatticePosets: Add is_relatively_complemented()

archive/issues_019647.json:
```json
{
    "body": "This patch adds a function to check if a lattice is relatively complemented or not.\n\nCC:  @fchapoton\n\nKeywords: latticeposet\n\nBranch/Commit: 3170b43a8966c7cb8be789cc52465dab375d71df\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jori M\u00e4ntysalo\n\nDependencies: #19878\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19884\n\n",
    "closed_at": "2016-03-26T11:30:57Z",
    "created_at": "2016-01-13T20:22:41Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "LatticePosets: Add is_relatively_complemented()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19884",
    "user": "https://github.com/jm58660"
}
```
This patch adds a function to check if a lattice is relatively complemented or not.

CC:  @fchapoton

Keywords: latticeposet

Branch/Commit: 3170b43a8966c7cb8be789cc52465dab375d71df

Reviewer: Travis Scrimshaw

Author: Jori Mäntysalo

Dependencies: #19878

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19884





---

archive/issue_comments_361572.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jmantysalo/relatively_complemented\"",
    "created_at": "2016-01-13T20:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361572",
    "user": "https://github.com/jm58660"
}
```

Changing branch from "" to "u/jmantysalo/relatively_complemented"



---

archive/issue_comments_361573.json:
```json
{
    "body": "Changing commit from \"\" to \"e93c8699d9a6ae4378164f152891985aceb74e99\"",
    "created_at": "2016-01-13T20:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361573",
    "user": "https://github.com/jm58660"
}
```

Changing commit from "" to "e93c8699d9a6ae4378164f152891985aceb74e99"



---

archive/issue_comments_361574.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[e93c869](https://github.com/sagemath/sagetrac-mirror/commit/e93c8699d9a6ae4378164f152891985aceb74e99)|`Add is_relatively_complemented().`|",
    "created_at": "2016-01-13T20:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361574",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[e93c869](https://github.com/sagemath/sagetrac-mirror/commit/e93c8699d9a6ae4378164f152891985aceb74e99)|`Add is_relatively_complemented().`|



---

archive/issue_comments_361575.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-13T20:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361575",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_361576.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[26725ab](https://github.com/sagemath/sagetrac-mirror/commit/26725ab54e1c090b2a2d64d711f19c6e6dece105)|`Iterator instead of list.`|",
    "created_at": "2016-01-27T06:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361576",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[26725ab](https://github.com/sagemath/sagetrac-mirror/commit/26725ab54e1c090b2a2d64d711f19c6e6dece105)|`Iterator instead of list.`|



---

archive/issue_comments_361577.json:
```json
{
    "body": "Changing commit from \"e93c8699d9a6ae4378164f152891985aceb74e99\" to \"26725ab54e1c090b2a2d64d711f19c6e6dece105\"",
    "created_at": "2016-01-27T06:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361577",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e93c8699d9a6ae4378164f152891985aceb74e99" to "26725ab54e1c090b2a2d64d711f19c6e6dece105"



---

archive/issue_comments_361578.json:
```json
{
    "body": "<a id='comment:4'></a>\nFr\u00e9d\u00e9ric, maybe you are not yet bored of reviewing...?",
    "created_at": "2016-01-27T07:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361578",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>
Frédéric, maybe you are not yet bored of reviewing...?



---

archive/issue_comments_361579.json:
```json
{
    "body": "<a id='comment:5'></a>\ntest, please ignore",
    "created_at": "2016-02-01T10:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361579",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
test, please ignore



---

archive/issue_events_061791.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-03-18T15:22:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19884#event-61791"
}
```



---

archive/issue_comments_361580.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2016-03-20T02:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361580",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_361581.json:
```json
{
    "body": "<a id='comment:7'></a>\nFor the reverse implication counterexample, could you also have it display that `L` is (co)atomic.\n\nAlso, could you make the following changes:\n\n```diff\n             sage: [Posets.ChainPoset(i).is_relatively_complemented() for\n-            ....: i in range(5)]\n+            ....:  i in range(5)]\n             [True, True, True, False, False]\n```\n\n```diff\n         Usually a lattice that is not relatively complemented contains elements\n-        `l`, `m`, and `u` such that rank(`l`)+1 == rank(`m`) == rank(`u`)-1\n-        and `m` is the only element in the interval `[l, u]`. We make an\n+        `l`, `m`, and `u` such that `r(l) + 1 = r(m) = r(u) - 1`, where `r` is\n+        the rank function and `m` is the only element in the interval `[l, u]`.\n+        We construct an example where this does not hold::\n```\n\n```diff\n         C = Counter(flatten([H.neighbors_out(e2) for e2 in H.neighbors_out(e1)]))\n-            for e3, c in C.iteritems():\n-                if c == 1:\n-                    if len(H.closed_interval(e1, e3)) == 3:\n-                        return False\n+            if any(c == 1 and len(H.closed_interval(e1, e3)) == 3 for e3, c in C.iteritems()):\n+                return False\n         return True\n```\n\nOtherwise it is a positive review.",
    "created_at": "2016-03-20T02:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361581",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
For the reverse implication counterexample, could you also have it display that `L` is (co)atomic.

Also, could you make the following changes:

```diff
             sage: [Posets.ChainPoset(i).is_relatively_complemented() for
-            ....: i in range(5)]
+            ....:  i in range(5)]
             [True, True, True, False, False]
```

```diff
         Usually a lattice that is not relatively complemented contains elements
-        `l`, `m`, and `u` such that rank(`l`)+1 == rank(`m`) == rank(`u`)-1
-        and `m` is the only element in the interval `[l, u]`. We make an
+        `l`, `m`, and `u` such that `r(l) + 1 = r(m) = r(u) - 1`, where `r` is
+        the rank function and `m` is the only element in the interval `[l, u]`.
+        We construct an example where this does not hold::
```

```diff
         C = Counter(flatten([H.neighbors_out(e2) for e2 in H.neighbors_out(e1)]))
-            for e3, c in C.iteritems():
-                if c == 1:
-                    if len(H.closed_interval(e1, e3)) == 3:
-                        return False
+            if any(c == 1 and len(H.closed_interval(e1, e3)) == 3 for e3, c in C.iteritems()):
+                return False
         return True
```

Otherwise it is a positive review.



---

archive/issue_comments_361582.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [tscrim](#comment%3A7):\n\n> For the reverse implication counterexample, could you also have it display that `L` is (co)atomic.\n\n\nI can do that, but `is_coatomic()` is not yet closed, see #19878.\n\nYour suggestions to code and documentation seems good.",
    "created_at": "2016-03-20T05:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361582",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:8'></a>
Replying to [tscrim](#comment%3A7):

> For the reverse implication counterexample, could you also have it display that `L` is (co)atomic.


I can do that, but `is_coatomic()` is not yet closed, see #19878.

Your suggestions to code and documentation seems good.



---

archive/issue_comments_361583.json:
```json
{
    "body": "<a id='comment:9'></a>\nThen we should merge it in and set it as a dependency. It's already positively reviewed, so there shouldn't be any issues.",
    "created_at": "2016-03-20T07:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361583",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
Then we should merge it in and set it as a dependency. It's already positively reviewed, so there shouldn't be any issues.



---

archive/issue_comments_361584.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[a08fac0](https://github.com/sagemath/sagetrac-mirror/commit/a08fac06be39a07de8f1c82ba0d0f2a3733579be)|`Changes suggested by tscrim.`|",
    "created_at": "2016-03-20T13:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                              |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[a08fac0](https://github.com/sagemath/sagetrac-mirror/commit/a08fac06be39a07de8f1c82ba0d0f2a3733579be)|`Changes suggested by tscrim.`|



---

archive/issue_comments_361585.json:
```json
{
    "body": "Changing commit from \"26725ab54e1c090b2a2d64d711f19c6e6dece105\" to \"a08fac06be39a07de8f1c82ba0d0f2a3733579be\"",
    "created_at": "2016-03-20T13:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "26725ab54e1c090b2a2d64d711f19c6e6dece105" to "a08fac06be39a07de8f1c82ba0d0f2a3733579be"



---

archive/issue_comments_361586.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-20T13:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361586",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_361587.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A9):\n> Then we should merge it in and set it as a dependency. It's already positively reviewed, so there shouldn't be any issues.\n\n\nBut if we just wait for the next beta, shouldn't this then work without any extra job to do?\n\nI made changes you suggested, but I'm compiling and testing - so this is in *needs_work*.",
    "created_at": "2016-03-20T13:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361587",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A9):
> Then we should merge it in and set it as a dependency. It's already positively reviewed, so there shouldn't be any issues.


But if we just wait for the next beta, shouldn't this then work without any extra job to do?

I made changes you suggested, but I'm compiling and testing - so this is in *needs_work*.



---

archive/issue_events_061792.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-03-21T05:31:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19884#event-61792"
}
```



---

archive/issue_events_061793.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-03-21T05:31:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19884#event-61793"
}
```



---

archive/issue_comments_361588.json:
```json
{
    "body": "<a id='comment:12'></a>\nI got error from docbuilding, but it seems not to relate `lattices.py`. Strange.",
    "created_at": "2016-03-21T05:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361588",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'></a>
I got error from docbuilding, but it seems not to relate `lattices.py`. Strange.



---

archive/issue_comments_361589.json:
```json
{
    "body": "Changing commit from \"a08fac06be39a07de8f1c82ba0d0f2a3733579be\" to \"3170b43a8966c7cb8be789cc52465dab375d71df\"",
    "created_at": "2016-03-22T14:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361589",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "a08fac06be39a07de8f1c82ba0d0f2a3733579be" to "3170b43a8966c7cb8be789cc52465dab375d71df"



---

archive/issue_comments_361590.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-03-22T14:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361590",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_361591.json:
```json
{
    "body": "<a id='comment:13'></a>\nChances are that it this will get merged, along with #19878, in beta1. So I have merged in #19878 because that is 0 additional work in reviewing. I did not get any docbuilding, no doctesting errors with #19878, and your changes look good. So I'm setting a positive review.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|\n|[e2e53d3](https://github.com/sagemath/sagetrac-mirror/commit/e2e53d30c98f92d91b99506b70ab8e7e6f5397b0)|`Merge branch 'u/jmantysalo/relatively_complemented' of trac.sagemath.org:sage into public/posets/add_is_relatively_complemented-19884`|\n|[9b0b30b](https://github.com/sagemath/sagetrac-mirror/commit/9b0b30bde968f4f0c697e81e2503e562b3ff31ea)|`Add coatomic, simpler code.`|\n|[533d660](https://github.com/sagemath/sagetrac-mirror/commit/533d660eaf56a4a19116e28759c5d408c860999b)|`Spaces removed.`|\n|[3170b43](https://github.com/sagemath/sagetrac-mirror/commit/3170b43a8966c7cb8be789cc52465dab375d71df)|`Merge branch 'u/jmantysalo/simpler_atomic' of trac.sagemath.org:sage into public/posets/add_is_relatively_complemented-19884`|",
    "created_at": "2016-03-22T14:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361591",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Chances are that it this will get merged, along with #19878, in beta1. So I have merged in #19878 because that is 0 additional work in reviewing. I did not get any docbuilding, no doctesting errors with #19878, and your changes look good. So I'm setting a positive review.

---
New commits:
|                                                                                                                                          |                                                                                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|
|[e2e53d3](https://github.com/sagemath/sagetrac-mirror/commit/e2e53d30c98f92d91b99506b70ab8e7e6f5397b0)|`Merge branch 'u/jmantysalo/relatively_complemented' of trac.sagemath.org:sage into public/posets/add_is_relatively_complemented-19884`|
|[9b0b30b](https://github.com/sagemath/sagetrac-mirror/commit/9b0b30bde968f4f0c697e81e2503e562b3ff31ea)|`Add coatomic, simpler code.`|
|[533d660](https://github.com/sagemath/sagetrac-mirror/commit/533d660eaf56a4a19116e28759c5d408c860999b)|`Spaces removed.`|
|[3170b43](https://github.com/sagemath/sagetrac-mirror/commit/3170b43a8966c7cb8be789cc52465dab375d71df)|`Merge branch 'u/jmantysalo/simpler_atomic' of trac.sagemath.org:sage into public/posets/add_is_relatively_complemented-19884`|



---

archive/issue_comments_361592.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#19878\"",
    "created_at": "2016-03-22T14:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361592",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "" to "#19878"



---

archive/issue_comments_361593.json:
```json
{
    "body": "Changing branch from \"u/jmantysalo/relatively_complemented\" to \"public/posets/add_is_relatively_complemented-19884\"",
    "created_at": "2016-03-22T14:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361593",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/jmantysalo/relatively_complemented" to "public/posets/add_is_relatively_complemented-19884"



---

archive/issue_comments_361594.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks!",
    "created_at": "2016-03-22T14:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361594",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:14'></a>
Thanks!



---

archive/issue_comments_361595.json:
```json
{
    "body": "<a id='comment:15'></a>\nThank you for all your work on posets.",
    "created_at": "2016-03-22T14:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361595",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
Thank you for all your work on posets.



---

archive/issue_comments_361596.json:
```json
{
    "body": "Changing branch from \"public/posets/add_is_relatively_complemented-19884\" to \"3170b43a8966c7cb8be789cc52465dab375d71df\"",
    "created_at": "2016-03-26T11:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361596",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/posets/add_is_relatively_complemented-19884" to "3170b43a8966c7cb8be789cc52465dab375d71df"



---

archive/issue_comments_361597.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-26T11:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19884#issuecomment-361597",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061794.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-26T11:30:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19884",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19884#event-61794"
}
```
