# Issue 19540: AsymptoticExpansion.factorial

archive/issues_019303.json:
```json
{
    "body": "CC:  @behackl @cheuberg\n\nUse existing Stirling approximation to calculate the factorial.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19540\n\n",
    "closed_at": "2016-02-18T08:24:44Z",
    "created_at": "2015-11-07T00:24:45Z",
    "labels": [
        "component: asymptotic expansions"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "AsymptoticExpansion.factorial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19540",
    "user": "https://github.com/dkrenn"
}
```
CC:  @behackl @cheuberg

Use existing Stirling approximation to calculate the factorial.

Issue created by migration from https://trac.sagemath.org/ticket/19540





---

archive/issue_comments_264762.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2015-11-07T00:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264762",
    "user": "https://github.com/dkrenn"
}
```

Last 10 new commits:



---

archive/issue_comments_264763.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-07T00:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264763",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_264764.json:
```json
{
    "body": "In principle, this would be fine; however, the following example fails:\n\n```\nsage: A.<m> = AsymptoticRing('m^QQ', QQ)\nsage: m.factorial()\nTraceback (most recent call last):\n...\nTypeError: ...\n>>>>>> *previous* ArithmeticError: Cannot build log(m)\nsince log(m) is not in Growth Group\nm^QQ * (e^(n*log(n)))^QQ * (e^n)^QQ * n^QQ * log(n)^QQ.\n```\nThe problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.\nAnd if we have something like `log(m).factorial()`, then everything gets more involved.\nThis either needs to be fixed or documented.",
    "created_at": "2016-02-04T16:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264764",
    "user": "https://github.com/cheuberg"
}
```

In principle, this would be fine; however, the following example fails:

```
sage: A.<m> = AsymptoticRing('m^QQ', QQ)
sage: m.factorial()
Traceback (most recent call last):
...
TypeError: ...
>>>>>> *previous* ArithmeticError: Cannot build log(m)
since log(m) is not in Growth Group
m^QQ * (e^(n*log(n)))^QQ * (e^n)^QQ * n^QQ * log(n)^QQ.
```
The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.
And if we have something like `log(m).factorial()`, then everything gets more involved.
This either needs to be fixed or documented.



---

archive/issue_comments_264765.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-02-04T16:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264765",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_053813.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2016-02-04T16:06:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19540#event-53813"
}
```



---

archive/issue_comments_264766.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-15T09:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264767.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-02-15T09:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264767",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_264768.json:
```json
{
    "body": "Replying to [comment:3 cheuberg]:\n> In principle, this would be fine; however, the following example fails:\n> \n> ```\n> sage: A.<m> = AsymptoticRing('m^QQ', QQ)\n> sage: m.factorial()\n> Traceback (most recent call last):\n> ...\n> TypeError: ...\n> >>>>>> *previous* ArithmeticError: Cannot build log(m)\n> since log(m) is not in Growth Group\n> m^QQ * (e^(n*log(n)))^QQ * (e^n)^QQ * n^QQ * log(n)^QQ.\n> ```\n> The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.\n\n\nCorrected (needed more rewriting than thought, but now `factorial` can do much better)\n\n> And if we have something like `log(m).factorial()`, then everything gets more involved.\n> This either needs to be fixed or documented.\n\n\nDocumented.",
    "created_at": "2016-02-15T09:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264768",
    "user": "https://github.com/dkrenn"
}
```

Replying to [comment:3 cheuberg]:
> In principle, this would be fine; however, the following example fails:
> 
> ```
> sage: A.<m> = AsymptoticRing('m^QQ', QQ)
> sage: m.factorial()
> Traceback (most recent call last):
> ...
> TypeError: ...
> >>>>>> *previous* ArithmeticError: Cannot build log(m)
> since log(m) is not in Growth Group
> m^QQ * (e^(n*log(n)))^QQ * (e^n)^QQ * n^QQ * log(n)^QQ.
> ```
> The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.


Corrected (needed more rewriting than thought, but now `factorial` can do much better)

> And if we have something like `log(m).factorial()`, then everything gets more involved.
> This either needs to be fixed or documented.


Documented.



---

archive/issue_comments_264769.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-02-15T09:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_264770.json:
```json
{
    "body": "Merged #19944 due to conflicts.",
    "created_at": "2016-02-15T09:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264770",
    "user": "https://github.com/dkrenn"
}
```

Merged #19944 due to conflicts.



---

archive/issue_comments_264771.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-02-16T15:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264771",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_264772.json:
```json
{
    "body": "1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.\n2. Why can't a generic growth element decide on its own? It could simply call\n\n```\nif self.is_one():\n   return tuple()\nelse:\n   return self.parent()._var_.variable_names()\n```\n   which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...\n\nThe rest is fine for me.",
    "created_at": "2016-02-16T15:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264772",
    "user": "https://github.com/cheuberg"
}
```

1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.
2. Why can't a generic growth element decide on its own? It could simply call

```
if self.is_one():
   return tuple()
else:
   return self.parent()._var_.variable_names()
```
   which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...

The rest is fine for me.



---

archive/issue_comments_264773.json:
```json
{
    "body": "Replying to [comment:9 cheuberg]:\n> 1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.\n> 2. Why can't a generic growth element decide on its own? It could simply call\n> \n> ```\n> if self.is_one():\n>    return tuple()\n> else:\n>    return self.parent()._var_.variable_names()\n> ```\n>    which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...\n\n\n1+2: In the way it is it allows to build `n.factorial()` starting in `AsymptoticRing('m^QQ * n^QQ', QQ)`; `self.parent().variable_names()` would not allow this.",
    "created_at": "2016-02-16T15:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264773",
    "user": "https://github.com/dkrenn"
}
```

Replying to [comment:9 cheuberg]:
> 1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.
> 2. Why can't a generic growth element decide on its own? It could simply call
> 
> ```
> if self.is_one():
>    return tuple()
> else:
>    return self.parent()._var_.variable_names()
> ```
>    which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...


1+2: In the way it is it allows to build `n.factorial()` starting in `AsymptoticRing('m^QQ * n^QQ', QQ)`; `self.parent().variable_names()` would not allow this.



---

archive/issue_comments_264774.json:
```json
{
    "body": "1. This would not change functionality, but the parent has a method, why not calling it.\n2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.",
    "created_at": "2016-02-16T17:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264774",
    "user": "https://github.com/cheuberg"
}
```

1. This would not change functionality, but the parent has a method, why not calling it.
2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.



---

archive/issue_comments_264775.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-16T19:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264775",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264776.json:
```json
{
    "body": "Replying to [comment:11 cheuberg]:\n> 1. This would not change functionality, but the parent has a method, why not calling it.\n> 2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.\n\n\nNow I understand. Code rewritten.",
    "created_at": "2016-02-16T19:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264776",
    "user": "https://github.com/dkrenn"
}
```

Replying to [comment:11 cheuberg]:
> 1. This would not change functionality, but the parent has a method, why not calling it.
> 2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.


Now I understand. Code rewritten.



---

archive/issue_comments_264777.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-02-16T19:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264777",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_264778.json:
```json
{
    "body": "I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.\n\nI noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says \"It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified.\" which is a relict from the past.\n\nFurthermore, we have\n\n```\n    # set everything up to determine category\n    from sage.categories.sets_cat import Sets\n    from sage.categories.posets import Posets\n    from sage.categories.magmas import Magmas\n    from sage.categories.additive_magmas import AdditiveMagmas\n```\nin the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.\n\nShall we fix those in a separate ticket or right here?\n\nPlease cross-review my commit and set to positive_review if you are satisfied.\n\n---\nNew commits:",
    "created_at": "2016-02-17T16:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264778",
    "user": "https://github.com/cheuberg"
}
```

I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.

I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says "It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified." which is a relict from the past.

Furthermore, we have

```
    # set everything up to determine category
    from sage.categories.sets_cat import Sets
    from sage.categories.posets import Posets
    from sage.categories.magmas import Magmas
    from sage.categories.additive_magmas import AdditiveMagmas
```
in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.

Shall we fix those in a separate ticket or right here?

Please cross-review my commit and set to positive_review if you are satisfied.

---
New commits:



---

archive/issue_comments_264779.json:
```json
{
    "body": "Replying to [comment:15 cheuberg]:\n> I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.\n> \n> I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says \"It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified.\" which is a relict from the past.\n> \n> Furthermore, we have\n> \n> ```\n>     # set everything up to determine category\n>     from sage.categories.sets_cat import Sets\n>     from sage.categories.posets import Posets\n>     from sage.categories.magmas import Magmas\n>     from sage.categories.additive_magmas import AdditiveMagmas\n> ```\n> in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.\n> \n> Shall we fix those in a separate ticket or right here?\n\n\nThis is now #20077.\n\n> Please cross-review my commit and set to positive_review if you are satisfied.\n\n\nDone.",
    "created_at": "2016-02-17T18:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264779",
    "user": "https://github.com/dkrenn"
}
```

Replying to [comment:15 cheuberg]:
> I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.
> 
> I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says "It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified." which is a relict from the past.
> 
> Furthermore, we have
> 
> ```
>     # set everything up to determine category
>     from sage.categories.sets_cat import Sets
>     from sage.categories.posets import Posets
>     from sage.categories.magmas import Magmas
>     from sage.categories.additive_magmas import AdditiveMagmas
> ```
> in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.
> 
> Shall we fix those in a separate ticket or right here?


This is now #20077.

> Please cross-review my commit and set to positive_review if you are satisfied.


Done.



---

archive/issue_comments_264780.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-17T18:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264780",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_264781.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-18T08:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19540#issuecomment-264781",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-18T08:24:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19540",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19540#event-53814"
}
```
