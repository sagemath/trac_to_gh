# Issue 19487: Support .zip upstream/ files

archive/issues_019250.json:
```json
{
    "body": "Here it is. It was not so tough, though the code is a bit clumsy.\n\nNathann\n\nThis ticket also updates our copy of bliss to use the original .zip file\nhttp://www.tcs.hut.fi/Software/bliss/bliss-0.73.zip\n\nCC:  @mkoeppe\n\nReviewer: Dima Pasechnik, Matthias Koeppe\n\nAuthor: Nathann Cohen\n\nBranch: b8f4d6af1650283791a53332e0b5a0eeacc46974\n\nDependencies: #19484\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19487\n\n",
    "closed_at": "2015-12-22T19:49:46Z",
    "created_at": "2015-10-27T14:42:20Z",
    "labels": [
        "component: distribution"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Support .zip upstream/ files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19487",
    "user": "https://github.com/nathanncohen"
}
```
Here it is. It was not so tough, though the code is a bit clumsy.

Nathann

This ticket also updates our copy of bliss to use the original .zip file
http://www.tcs.hut.fi/Software/bliss/bliss-0.73.zip

CC:  @mkoeppe

Reviewer: Dima Pasechnik, Matthias Koeppe

Author: Nathann Cohen

Branch: b8f4d6af1650283791a53332e0b5a0eeacc46974

Dependencies: #19484

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19487





---

archive/issue_comments_349203.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-27T14:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349203",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_349204.json:
```json
{
    "body": "Changing commit from \"\" to \"291bf3e6dd79cc18de67e9b213420fd66c98ff71\"",
    "created_at": "2015-10-27T14:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349204",
    "user": "https://github.com/nathanncohen"
}
```

Changing commit from "" to "291bf3e6dd79cc18de67e9b213420fd66c98ff71"



---

archive/issue_comments_349205.json:
```json
{
    "body": "Changing branch from \"\" to \"u/ncohen/19487\"",
    "created_at": "2015-10-27T14:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349205",
    "user": "https://github.com/nathanncohen"
}
```

Changing branch from "" to "u/ncohen/19487"



---

archive/issue_comments_349206.json:
```json
{
    "body": "<a id='comment:1'></a>The mosst obvious use-case for this ticket would be #19483 (whose original tarball is .zip) but it is already reviewed. I'll do what the reviewers ask.\n\nNathann\n\n---\nNew commits:",
    "created_at": "2015-10-27T14:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349206",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>The mosst obvious use-case for this ticket would be #19483 (whose original tarball is .zip) but it is already reviewed. I'll do what the reviewers ask.

Nathann

---
New commits:



---

archive/issue_comments_349207.json:
```json
{
    "body": "<a id='comment:2'></a>Ooh fugly, unzip and re-tar and pipe and untar? Of course its really the original script's fault for not being modular...\n\nCan we at least put sage-unzip into build/bin/ and not expose it via a `sage -unzip` command line argument? It has no mathematical purpose, its just an internal tool for building Sage packages.",
    "created_at": "2015-10-28T09:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349207",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>Ooh fugly, unzip and re-tar and pipe and untar? Of course its really the original script's fault for not being modular...

Can we at least put sage-unzip into build/bin/ and not expose it via a `sage -unzip` command line argument? It has no mathematical purpose, its just an internal tool for building Sage packages.



---

archive/issue_comments_349208.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 vbraun]:\n> Ooh fugly, unzip and re-tar and pipe and untar? Of course its really the original script's fault for not being modular...\n> \n> Can we at least put sage-unzip into build/bin/ and not expose it via a `sage -unzip` command line argument? It has no mathematical purpose, its just an internal tool for building Sage packages.\n\n\nneither `sage --git`, nor `sage --twisted` have any maths purpose, yet they are still there...",
    "created_at": "2015-10-28T09:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349208",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>Replying to [comment:2 vbraun]:
> Ooh fugly, unzip and re-tar and pipe and untar? Of course its really the original script's fault for not being modular...
> 
> Can we at least put sage-unzip into build/bin/ and not expose it via a `sage -unzip` command line argument? It has no mathematical purpose, its just an internal tool for building Sage packages.


neither `sage --git`, nor `sage --twisted` have any maths purpose, yet they are still there...



---

archive/issue_comments_349209.json:
```json
{
    "body": "<a id='comment:4'></a>> Ooh fugly, unzip and re-tar and pipe and untar? Of course its really the original script's fault for not being modular...\n\n\nYeah well. I minimize my changes to the current scripts. So I adapted to what was already there. I loved that line in particular:\n\n```\nlbzip2 -d -c \"$1\" 2>/dev/null || bzip2 -d -c \"$1\" 2>/dev/null || gzip -d -c \"$1\" 2>/dev/null || cat \"$1\"\n```\n\n> Can we at least put sage-unzip into build/bin/ and not expose it via a `sage -unzip` command line argument? It has no mathematical purpose, its just an internal tool for building Sage packages.\n\n\nCan you make this comment on the right ticket, i.e. #19484?\n\nNathann",
    "created_at": "2015-10-28T09:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349209",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>> Ooh fugly, unzip and re-tar and pipe and untar? Of course its really the original script's fault for not being modular...


Yeah well. I minimize my changes to the current scripts. So I adapted to what was already there. I loved that line in particular:

```
lbzip2 -d -c "$1" 2>/dev/null || bzip2 -d -c "$1" 2>/dev/null || gzip -d -c "$1" 2>/dev/null || cat "$1"
```

> Can we at least put sage-unzip into build/bin/ and not expose it via a `sage -unzip` command line argument? It has no mathematical purpose, its just an internal tool for building Sage packages.


Can you make this comment on the right ticket, i.e. #19484?

Nathann



---

archive/issue_comments_349210.json:
```json
{
    "body": "<a id='comment:5'></a>Discussion moved to #19484",
    "created_at": "2015-10-28T09:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349210",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>Discussion moved to #19484



---

archive/issue_comments_349211.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-10-28T13:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_349212.json:
```json
{
    "body": "Changing commit from \"291bf3e6dd79cc18de67e9b213420fd66c98ff71\" to \"ba21cc01a8b39ecf546560c85d0b128b9eea10c7\"",
    "created_at": "2015-10-28T13:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "291bf3e6dd79cc18de67e9b213420fd66c98ff71" to "ba21cc01a8b39ecf546560c85d0b128b9eea10c7"



---

archive/issue_comments_349213.json:
```json
{
    "body": "<a id='comment:7'></a>I guess what I'd like to see is a zipfile-based example to use this patch to install stuff. How about making one on #18708 ?",
    "created_at": "2015-11-22T12:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349213",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>I guess what I'd like to see is a zipfile-based example to use this patch to install stuff. How about making one on #18708 ?



---

archive/issue_comments_349214.json:
```json
{
    "body": "<a id='comment:8'></a>I can update bliss, but that's a bit silly since it is the latest version since #19483 (which is why I wrote this branch). I don't know what 'normalize' is: can you add this ticket as a dependency of #18708? This way you can check that it works (should be totally straightforward) and that other package will be udpated.\n\nNathann",
    "created_at": "2015-11-22T12:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349214",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>I can update bliss, but that's a bit silly since it is the latest version since #19483 (which is why I wrote this branch). I don't know what 'normalize' is: can you add this ticket as a dependency of #18708? This way you can check that it works (should be totally straightforward) and that other package will be udpated.

Nathann



---

archive/issue_comments_349215.json:
```json
{
    "body": "<a id='comment:9'></a>This does not work on Mac OS X because \"sed -s\" is a GNU extension.",
    "created_at": "2015-12-17T07:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349215",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>This does not work on Mac OS X because "sed -s" is a GNU extension.



---

archive/issue_comments_349216.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-17T07:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349216",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_349217.json:
```json
{
    "body": "<a id='comment:10'></a>I don't have Mac OS X, and I do not know how it must be written to work there. Can you fix what must be for it to work on your platform ?",
    "created_at": "2015-12-17T07:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349217",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>I don't have Mac OS X, and I do not know how it must be written to work there. Can you fix what must be for it to work on your platform ?



---

archive/issue_comments_349218.json:
```json
{
    "body": "<a id='comment:11'></a>Sure, I'll try to make it portable",
    "created_at": "2015-12-17T08:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349218",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Sure, I'll try to make it portable



---

archive/issue_comments_349219.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-17T12:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349220.json:
```json
{
    "body": "Changing commit from \"ba21cc01a8b39ecf546560c85d0b128b9eea10c7\" to \"1312500851383e2eb45c4ea4f1da0663659a2d62\"",
    "created_at": "2015-12-17T12:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ba21cc01a8b39ecf546560c85d0b128b9eea10c7" to "1312500851383e2eb45c4ea4f1da0663659a2d62"



---

archive/issue_comments_349221.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-17T12:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_349222.json:
```json
{
    "body": "Changing commit from \"1312500851383e2eb45c4ea4f1da0663659a2d62\" to \"a49b1e48d3bf4f673893637903974708325c53b9\"",
    "created_at": "2015-12-17T12:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1312500851383e2eb45c4ea4f1da0663659a2d62" to "a49b1e48d3bf4f673893637903974708325c53b9"



---

archive/issue_comments_349223.json:
```json
{
    "body": "<a id='comment:14'></a>Unless this does the trick? I removed the '-s', as I have no idea why it was there in the first place `O_o`\n\nNathann",
    "created_at": "2015-12-17T12:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349223",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Unless this does the trick? I removed the '-s', as I have no idea why it was there in the first place `O_o`

Nathann



---

archive/issue_comments_349224.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-17T12:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349224",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_349225.json:
```json
{
    "body": "Changing branch from \"u/ncohen/19487\" to \"u/mkoeppe/19487\"",
    "created_at": "2015-12-17T21:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349225",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/ncohen/19487" to "u/mkoeppe/19487"



---

archive/issue_comments_349226.json:
```json
{
    "body": "<a id='comment:17'></a>The regexp needed fixing also.\n\n---\nNew commits:",
    "created_at": "2015-12-17T21:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349226",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>The regexp needed fixing also.

---
New commits:



---

archive/issue_comments_349227.json:
```json
{
    "body": "Changing commit from \"a49b1e48d3bf4f673893637903974708325c53b9\" to \"7e464c1a8bf37422e30b36f5b99ff6a7748e6606\"",
    "created_at": "2015-12-17T21:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349227",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "a49b1e48d3bf4f673893637903974708325c53b9" to "7e464c1a8bf37422e30b36f5b99ff6a7748e6606"



---

archive/issue_comments_349228.json:
```json
{
    "body": "<a id='comment:18'></a>Err... You sure that there is no way to have a 'OR' in a regexp under MacOSX ?.... The readability has dramatically decreased, if I may say..\n\nAlso you seem to strip lz, but I do not think that our scripts can unpackage lz files.\n\nNathann",
    "created_at": "2015-12-18T07:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349228",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>Err... You sure that there is no way to have a 'OR' in a regexp under MacOSX ?.... The readability has dramatically decreased, if I may say..

Also you seem to strip lz, but I do not think that our scripts can unpackage lz files.

Nathann



---

archive/issue_comments_349229.json:
```json
{
    "body": "<a id='comment:19'></a>The GNU sed implementation explains pretty well what are GNU extensions. And yes, if one always used the GNU version it's stunning how restrictive the classic UNIX versions were.\n\nPerhaps best to rewrite the whole thing using a sequence of bash substitutions instead.\n\nI stripped a few more file extensions to future-proof the script.",
    "created_at": "2015-12-18T17:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349229",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>The GNU sed implementation explains pretty well what are GNU extensions. And yes, if one always used the GNU version it's stunning how restrictive the classic UNIX versions were.

Perhaps best to rewrite the whole thing using a sequence of bash substitutions instead.

I stripped a few more file extensions to future-proof the script.



---

archive/issue_comments_349230.json:
```json
{
    "body": "<a id='comment:20'></a>how about a python script instead?",
    "created_at": "2015-12-18T18:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349230",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>how about a python script instead?



---

archive/issue_comments_349231.json:
```json
{
    "body": "<a id='comment:21'></a>> The GNU sed implementation explains pretty well what are GNU extensions. And yes, if one always used the GNU version it's stunning how restrictive the classic UNIX versions were.\n\n\nI tried to rewrite this regexp in posix. Can you try whether this works in Mac OSX? The '--posix' flag is meant to disable whatever shouldn't be supported\n\n```\n~$ echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed --posix \"s/[\\.zip|\\.tar|\\.gz]*$//g\" \nwhatever.tar.2.0\n```\n\nNathann",
    "created_at": "2015-12-18T20:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349231",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:21'></a>> The GNU sed implementation explains pretty well what are GNU extensions. And yes, if one always used the GNU version it's stunning how restrictive the classic UNIX versions were.


I tried to rewrite this regexp in posix. Can you try whether this works in Mac OSX? The '--posix' flag is meant to disable whatever shouldn't be supported

```
~$ echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed --posix "s/[\.zip|\.tar|\.gz]*$//g" 
whatever.tar.2.0
```

Nathann



---

archive/issue_comments_349232.json:
```json
{
    "body": "<a id='comment:22'></a>The whole zip/re-tar stuff is hilarious. If anything, this ticket shows that the current sage-spkg script is just unmaintainable. \n\n+1 to a python script...",
    "created_at": "2015-12-18T20:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349232",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>The whole zip/re-tar stuff is hilarious. If anything, this ticket shows that the current sage-spkg script is just unmaintainable. 

+1 to a python script...



---

archive/issue_comments_349233.json:
```json
{
    "body": "<a id='comment:23'></a>> The whole zip/re-tar stuff is hilarious.\n\n\n+1. I couldn't believe when I first saw it `:-P`\n\n> If anything, this ticket shows that the current sage-spkg script is just unmaintainable. \n> \n> +1 to a python script...\n\n\nWell I don't mind if you want to write it, but given that the present ticket does not change it too much, honestly I don't think that it is very urgent to rewrite. But indeed, this script is... \"hacky\"? `:-P`\n\nNathann",
    "created_at": "2015-12-18T20:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349233",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:23'></a>> The whole zip/re-tar stuff is hilarious.


+1. I couldn't believe when I first saw it `:-P`

> If anything, this ticket shows that the current sage-spkg script is just unmaintainable. 
> 
> +1 to a python script...


Well I don't mind if you want to write it, but given that the present ticket does not change it too much, honestly I don't think that it is very urgent to rewrite. But indeed, this script is... "hacky"? `:-P`

Nathann



---

archive/issue_comments_349234.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:21 ncohen]:\n> > The GNU sed implementation explains pretty well what are GNU extensions. And yes, if one always used the GNU version it's stunning how restrictive the classic UNIX versions were.\n\n> \n> I tried to rewrite this regexp in posix. Can you try whether this works in Mac OSX? The '--posix' flag is meant to disable whatever shouldn't be supported\n> \n> \n> ```\n> ~$ echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed --posix \"s/[\\.zip|\\.tar|\\.gz]*$//g\" \n> whatever.tar.2.0\n> ```\n\n\nIt does not work. UNIX sed does not understand any command line option with double dashes.\n\nAnd, by the way, your original regexp does not work because you're confusing [] and \\( \\).",
    "created_at": "2015-12-18T21:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349234",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Replying to [comment:21 ncohen]:
> > The GNU sed implementation explains pretty well what are GNU extensions. And yes, if one always used the GNU version it's stunning how restrictive the classic UNIX versions were.

> 
> I tried to rewrite this regexp in posix. Can you try whether this works in Mac OSX? The '--posix' flag is meant to disable whatever shouldn't be supported
> 
> 
> ```
> ~$ echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed --posix "s/[\.zip|\.tar|\.gz]*$//g" 
> whatever.tar.2.0
> ```


It does not work. UNIX sed does not understand any command line option with double dashes.

And, by the way, your original regexp does not work because you're confusing [] and \( \).



---

archive/issue_comments_349235.json:
```json
{
    "body": "<a id='comment:25'></a>Helloooo,\n\n> It does not work. UNIX sed does not understand any command line option with double dashes.\n\n\nDo you mean the \" ? Are those called \"double dashes\" ? Does it still fail if you use simple quotes instead, i.e. `sed --posix 's/[\\.zip|\\.tar|\\.gz]*$//g'`\n\n> And, by the way, your original regexp does not work because you're confusing [] and \\( \\).\n\n\nYep yep sorry, I noticed that while working on this new version. Which seems to work reliably, on my distro at least.\n\nNathann",
    "created_at": "2015-12-18T21:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349235",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:25'></a>Helloooo,

> It does not work. UNIX sed does not understand any command line option with double dashes.


Do you mean the " ? Are those called "double dashes" ? Does it still fail if you use simple quotes instead, i.e. `sed --posix 's/[\.zip|\.tar|\.gz]*$//g'`

> And, by the way, your original regexp does not work because you're confusing [] and \( \).


Yep yep sorry, I noticed that while working on this new version. Which seems to work reliably, on my distro at least.

Nathann



---

archive/issue_comments_349236.json:
```json
{
    "body": "<a id='comment:26'></a>By double dashes, he meant the option `--posix`.\n\nOn OS X, use the `-E` flag for sed:\n\n```\necho whatever.tar.2.0.zip.tar.gz.tar.tgz | sed -E \"s/(\\.zip|\\.tar|\\.gz|\\.tgz)*$//g\" \n```\nBut `-E` is not a posix option or a GNU sed option, so I guess we can't use it. A Python script would avoid these compatibility issues.",
    "created_at": "2015-12-18T21:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349236",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>By double dashes, he meant the option `--posix`.

On OS X, use the `-E` flag for sed:

```
echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed -E "s/(\.zip|\.tar|\.gz|\.tgz)*$//g" 
```
But `-E` is not a posix option or a GNU sed option, so I guess we can't use it. A Python script would avoid these compatibility issues.



---

archive/issue_comments_349237.json:
```json
{
    "body": "<a id='comment:27'></a>> By double dashes, he meant the option `--posix`.\n\n\nOh, okay sorry. This being said, my command also works without the '--posix'. So if we can have \n\n```\n~$ echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed \"s/[\\.zip|\\.tar|\\.gz]*$//g\"  \nwhatever.tar.2.0\n```\n\nand if it works in OSX too, then it's good?.. Apparently it is posix, for it works even when --posix is added (though it is not necessary).\n\nNathann",
    "created_at": "2015-12-18T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349237",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:27'></a>> By double dashes, he meant the option `--posix`.


Oh, okay sorry. This being said, my command also works without the '--posix'. So if we can have 

```
~$ echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed "s/[\.zip|\.tar|\.gz]*$//g"  
whatever.tar.2.0
```

and if it works in OSX too, then it's good?.. Apparently it is posix, for it works even when --posix is added (though it is not necessary).

Nathann



---

archive/issue_comments_349238.json:
```json
{
    "body": "<a id='comment:28'></a>Your command works but is probably not what we want. The regular expression `[\\.zip|\\.tar|\\.gz]*` matches any string formed by the characters between the brackets, so it is equivalent to `[\\.ziptarg|]*`. So I think it matches too much: the `sed` invocation would convert `whatever.tar.2.0.zig.zag.rat` to `whatever.tar.2.0`. This was mkoeppe's comment about confusing `[]` with `\\(\\)`.\n\nOn OS X, \n\n```\necho whatever.tar.2.0.zip.tar.gz.tar.tgz | sed -E \"s/(\\.zip|\\.tar|\\.gz|\\.tgz)*$//g\"\n```\nworks, while omitting `-E`\n\n```\necho whatever.tar.2.0.zip.tar.gz.tar.tgz | sed \"s/(\\.zip|\\.tar|\\.gz|\\.tgz)*$//g\"\n```\ndoes not.",
    "created_at": "2015-12-18T21:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349238",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>Your command works but is probably not what we want. The regular expression `[\.zip|\.tar|\.gz]*` matches any string formed by the characters between the brackets, so it is equivalent to `[\.ziptarg|]*`. So I think it matches too much: the `sed` invocation would convert `whatever.tar.2.0.zig.zag.rat` to `whatever.tar.2.0`. This was mkoeppe's comment about confusing `[]` with `\(\)`.

On OS X, 

```
echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed -E "s/(\.zip|\.tar|\.gz|\.tgz)*$//g"
```
works, while omitting `-E`

```
echo whatever.tar.2.0.zip.tar.gz.tar.tgz | sed "s/(\.zip|\.tar|\.gz|\.tgz)*$//g"
```
does not.



---

archive/issue_comments_349239.json:
```json
{
    "body": "<a id='comment:29'></a>> Your command works but is probably not what we want. The regular expression `[\\.zip|\\.tar|\\.gz]*` matches any string formed by the characters between the brackets, so it is equivalent to `[\\.ziptarg|]*`.\n\n\nArg... Yeah, it just doesn't work at all. Sorry `:-/`\n\nI'll try to find something else `:-/`\n\nNathann",
    "created_at": "2015-12-19T08:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349239",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:29'></a>> Your command works but is probably not what we want. The regular expression `[\.zip|\.tar|\.gz]*` matches any string formed by the characters between the brackets, so it is equivalent to `[\.ziptarg|]*`.


Arg... Yeah, it just doesn't work at all. Sorry `:-/`

I'll try to find something else `:-/`

Nathann



---

archive/issue_comments_349240.json:
```json
{
    "body": "<a id='comment:30'></a>Okay okay.. Can't find much better. Bash substitution would be very verbose too so, well. Let's stick with the ugly/long sed command `:-/`",
    "created_at": "2015-12-19T09:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349240",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:30'></a>Okay okay.. Can't find much better. Bash substitution would be very verbose too so, well. Let's stick with the ugly/long sed command `:-/`



---

archive/issue_comments_349241.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n Here it is. It was not so tough, though the code is a bit clumsy.\n \n Nathann\n+\n+This ticket also updates our copy of bliss to use the original .zip file\n+http://www.tcs.hut.fi/Software/bliss/bliss-0.73.zip\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2015-12-19T10:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349241",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
 Here it is. It was not so tough, though the code is a bit clumsy.
 
 Nathann
+
+This ticket also updates our copy of bliss to use the original .zip file
+http://www.tcs.hut.fi/Software/bliss/bliss-0.73.zip
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_349242.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/19487\" to \"public/19487\"",
    "created_at": "2015-12-19T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349242",
    "user": "https://github.com/nathanncohen"
}
```

Changing branch from "u/mkoeppe/19487" to "public/19487"



---

archive/issue_comments_349243.json:
```json
{
    "body": "Changing commit from \"7e464c1a8bf37422e30b36f5b99ff6a7748e6606\" to \"81b0e6304a5f6374bcaf84481e07f66c1bf26d29\"",
    "created_at": "2015-12-19T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349243",
    "user": "https://github.com/nathanncohen"
}
```

Changing commit from "7e464c1a8bf37422e30b36f5b99ff6a7748e6606" to "81b0e6304a5f6374bcaf84481e07f66c1bf26d29"



---

archive/issue_comments_349244.json:
```json
{
    "body": "<a id='comment:32'></a>New commits:",
    "created_at": "2015-12-19T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349244",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:32'></a>New commits:



---

archive/issue_comments_349245.json:
```json
{
    "body": "<a id='comment:33'></a>Hello !\n\nI updated this ticket a bit in order to use the original .zip archive for the bliss package. It is the same version as the one we use, so it is not even a package update and there is no risk of anything. I used to test the ticket, and it works well: if you also agree with it, then we can get it merged.\n\nThanks,\n\nNathann",
    "created_at": "2015-12-19T10:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349245",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:33'></a>Hello !

I updated this ticket a bit in order to use the original .zip archive for the bliss package. It is the same version as the one we use, so it is not even a package update and there is no risk of anything. I used to test the ticket, and it works well: if you also agree with it, then we can get it merged.

Thanks,

Nathann



---

archive/issue_comments_349246.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik, Matthias Koeppe\"",
    "created_at": "2015-12-20T17:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349246",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik, Matthias Koeppe"



---

archive/issue_comments_349247.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-20T17:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349247",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_349248.json:
```json
{
    "body": "<a id='comment:34'></a>OK, good. I tested it with Sage 6.10  merged in, it works.\nI suppose the bliss zip file needs to be uploaded to the mirrors...",
    "created_at": "2015-12-20T17:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349248",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>OK, good. I tested it with Sage 6.10  merged in, it works.
I suppose the bliss zip file needs to be uploaded to the mirrors...



---

archive/issue_events_053750.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2015-12-20T17:33:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "milestone": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19487#event-53750"
}
```



---

archive/issue_comments_349249.json:
```json
{
    "body": "<a id='comment:35'></a>by the way, isn't the option to do checksum of just one file broken?",
    "created_at": "2015-12-20T19:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349249",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>by the way, isn't the option to do checksum of just one file broken?



---

archive/issue_comments_349250.json:
```json
{
    "body": "<a id='comment:36'></a>also, no upstream/*bz2 files are checksum'ed anymore!",
    "created_at": "2015-12-20T20:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349250",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>also, no upstream/*bz2 files are checksum'ed anymore!



---

archive/issue_comments_349251.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-12-20T20:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349251",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_349252.json:
```json
{
    "body": "<a id='comment:37'></a>if seems to work if I apply\n\n```\ndiff --git a/src/bin/sage-fix-pkg-checksums b/src/bin/sage-fix-pkg-checksums\nindex 149f68f..f16fab7 100755\n--- a/src/bin/sage-fix-pkg-checksums\n+++ b/src/bin/sage-fix-pkg-checksums\n@@ -14,7 +14,7 @@ do\n     pkg_name=${tarball%%-*}\n     # Convert to lowercase for the directory name:\n     pkg_name_lc=`echo $pkg_name | tr '[:upper:]' '[:lower:]'`\n-    extension=$(echo $tarball | grep -o -E \"(.tar|.gz|.zip)*$\") # file extension (.tar,.tar.gz,.zip)\n+    extension=$(echo $tarball | grep -o -E \"(.tar|.gz|.bz2|.zip)*$\") # file extension (.tar,.tar.gz,.zip)\n     if [ -d \"$SAGE_ROOT/build/pkgs/$pkg_name_lc\" ]; then\n         sage_version=`cat \"$SAGE_ROOT/build/pkgs/$pkg_name_lc/package-version.txt\" | sed 's/\\.p[0-9][0-9]*$//'`\n         if [ ${tarball%$extension*} = \"$pkg_name-$sage_version\" ]; then\n```",
    "created_at": "2015-12-20T20:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349252",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>if seems to work if I apply

```
diff --git a/src/bin/sage-fix-pkg-checksums b/src/bin/sage-fix-pkg-checksums
index 149f68f..f16fab7 100755
--- a/src/bin/sage-fix-pkg-checksums
+++ b/src/bin/sage-fix-pkg-checksums
@@ -14,7 +14,7 @@ do
     pkg_name=${tarball%%-*}
     # Convert to lowercase for the directory name:
     pkg_name_lc=`echo $pkg_name | tr '[:upper:]' '[:lower:]'`
-    extension=$(echo $tarball | grep -o -E "(.tar|.gz|.zip)*$") # file extension (.tar,.tar.gz,.zip)
+    extension=$(echo $tarball | grep -o -E "(.tar|.gz|.bz2|.zip)*$") # file extension (.tar,.tar.gz,.zip)
     if [ -d "$SAGE_ROOT/build/pkgs/$pkg_name_lc" ]; then
         sage_version=`cat "$SAGE_ROOT/build/pkgs/$pkg_name_lc/package-version.txt" | sed 's/\.p[0-9][0-9]*$//'`
         if [ ${tarball%$extension*} = "$pkg_name-$sage_version" ]; then
```



---

archive/issue_comments_349253.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-20T20:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349254.json:
```json
{
    "body": "Changing commit from \"81b0e6304a5f6374bcaf84481e07f66c1bf26d29\" to \"ab96b271f093272132427b6c147c1704d2dc370f\"",
    "created_at": "2015-12-20T20:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "81b0e6304a5f6374bcaf84481e07f66c1bf26d29" to "ab96b271f093272132427b6c147c1704d2dc370f"



---

archive/issue_comments_349255.json:
```json
{
    "body": "Changing commit from \"ab96b271f093272132427b6c147c1704d2dc370f\" to \"b8f4d6af1650283791a53332e0b5a0eeacc46974\"",
    "created_at": "2015-12-20T20:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ab96b271f093272132427b6c147c1704d2dc370f" to "b8f4d6af1650283791a53332e0b5a0eeacc46974"



---

archive/issue_comments_349256.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-20T20:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_349257.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-12-20T20:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349257",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_349258.json:
```json
{
    "body": "Changing branch from \"public/19487\" to \"b8f4d6af1650283791a53332e0b5a0eeacc46974\"",
    "created_at": "2015-12-22T19:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349258",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/19487" to "b8f4d6af1650283791a53332e0b5a0eeacc46974"



---

archive/issue_events_053751.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-22T19:49:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19487#event-53751"
}
```



---

archive/issue_comments_349259.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-22T19:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349259",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_349260.json:
```json
{
    "body": "<a id='comment:42'></a>See #20120 for a followup: replace the uncompressing stuff with a Python script.",
    "created_at": "2016-02-26T04:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349260",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'></a>See #20120 for a followup: replace the uncompressing stuff with a Python script.



---

archive/issue_comments_349261.json:
```json
{
    "body": "Changing commit from \"b8f4d6af1650283791a53332e0b5a0eeacc46974\" to \"\"",
    "created_at": "2016-02-26T04:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19487#issuecomment-349261",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "b8f4d6af1650283791a53332e0b5a0eeacc46974" to ""
