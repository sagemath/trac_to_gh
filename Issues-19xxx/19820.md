# Issue 19820: Improve __eq__ for triangular module morphisms

archive/issues_019583.json:
```json
{
    "body": "Right now, a comparison by the underlying `__dict__` is done, which causes problems when trying to define a cached method on a morphism. We need to implement a better `__eq__` for each subclass with more controllable behavior. See the discussion on #19609.\n\nSee also #21894 which collects similarly broken implementations of `__eq__`.\n\n**Assignee:** @tscrim\n\n**CC:**  @darijgr @nthiery @simon-king-jena\n\n**Keywords:** triangular module morphism, days85\n\n**Branch/Commit:** [5b1b761250b8c384d0cbd53695b73ad5f15f2aa4](https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4)\n\n**Reviewer:** Julian R\u00fcth, Travis Scrimshaw\n\n**Author:** Travis Scrimshaw, Julian R\u00fcth\n\nIssue created by migration from https://trac.sagemath.org/ticket/19820\n\n",
    "closed_at": "2017-03-27T20:43:00Z",
    "created_at": "2016-01-01T23:32:08Z",
    "labels": [
        "component: categories",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "title": "Improve __eq__ for triangular module morphisms",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/19820",
    "user": "https://github.com/tscrim"
}
```
Right now, a comparison by the underlying `__dict__` is done, which causes problems when trying to define a cached method on a morphism. We need to implement a better `__eq__` for each subclass with more controllable behavior. See the discussion on #19609.

See also #21894 which collects similarly broken implementations of `__eq__`.

**Assignee:** @tscrim

**CC:**  @darijgr @nthiery @simon-king-jena

**Keywords:** triangular module morphism, days85

**Branch/Commit:** [5b1b761250b8c384d0cbd53695b73ad5f15f2aa4](https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4)

**Reviewer:** Julian Rüth, Travis Scrimshaw

**Author:** Travis Scrimshaw, Julian Rüth

Issue created by migration from https://trac.sagemath.org/ticket/19820





---

archive/issue_events_178013.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-01-01T23:33:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178013"
}
```



---

archive/issue_comments_285748.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16c0bfa0f5855ce030239b14a9b1b806b5447cd6\">16c0bfa</a></td><td><code>Better `__eq__` for triangular module morphisms.</code></td></tr></table>\n",
    "created_at": "2016-01-01T23:33:41Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285748",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16c0bfa0f5855ce030239b14a9b1b806b5447cd6">16c0bfa</a></td><td><code>Better `__eq__` for triangular module morphisms.</code></td></tr></table>




---

archive/issue_comments_285749.json:
```json
{
    "body": "**Commit:** [16c0bfa0f5855ce030239b14a9b1b806b5447cd6](https://github.com/sagemath/sagetrac-mirror/commit/16c0bfa0f5855ce030239b14a9b1b806b5447cd6)",
    "created_at": "2016-01-01T23:33:41Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285749",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [16c0bfa0f5855ce030239b14a9b1b806b5447cd6](https://github.com/sagemath/sagetrac-mirror/commit/16c0bfa0f5855ce030239b14a9b1b806b5447cd6)



---

archive/issue_comments_285750.json:
```json
{
    "body": "**Branch:** [public/morphisms/triangular_module_morphism_eq-19820](https://github.com/sagemath/sagetrac-mirror/tree/public/morphisms/triangular_module_morphism_eq-19820)",
    "created_at": "2016-01-01T23:33:41Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285750",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/morphisms/triangular_module_morphism_eq-19820](https://github.com/sagemath/sagetrac-mirror/tree/public/morphisms/triangular_module_morphism_eq-19820)



---

archive/issue_comments_285751.json:
```json
{
    "body": "<a id='comment:2'></a>\nsome failing doctests, due to use of cmp instead of key",
    "created_at": "2016-11-04T19:58:00Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285751",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
some failing doctests, due to use of cmp instead of key



---

archive/issue_events_178014.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-04T19:58:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178014"
}
```



---

archive/issue_events_178015.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-04T19:58:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178015"
}
```



---

archive/issue_comments_285752.json:
```json
{
    "body": "<a id='comment:3'></a>\nWhy is there no `__ne__` implementation? I do not really see where such an implementation should come from, i.e., it just checks inequality on generators I believe. In fact (without claiming that this has any mathematical content)\n\n```\nsage: f = X.module_morphism(on_basis=X.monomial, zero=X.monomial(0), category=Sets())\nsage: \nsage: g = X.module_morphism(on_basis=X.monomial, zero=X.zero(), category=Sets())\nsage: \nsage: f == g\nFalse\nsage: f != g\nFalse\n```\nSo, I guess we should override the `_richcmp_` implementation instead.",
    "created_at": "2016-11-20T02:54:01Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285752",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:3'></a>
Why is there no `__ne__` implementation? I do not really see where such an implementation should come from, i.e., it just checks inequality on generators I believe. In fact (without claiming that this has any mathematical content)

```
sage: f = X.module_morphism(on_basis=X.monomial, zero=X.monomial(0), category=Sets())
sage: 
sage: g = X.module_morphism(on_basis=X.monomial, zero=X.zero(), category=Sets())
sage: 
sage: f == g
False
sage: f != g
False
```
So, I guess we should override the `_richcmp_` implementation instead.



---

archive/issue_comments_285753.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4625f45aeb83408d189c95138b6308b59849e05\">d4625f4</a></td><td><code>Merge branch 'develop' into t/19820/public/morphisms/triangular_module_morphism_eq-19820</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3f468da2b05cf53b99a4af3bfa9d2736b3ea63e\">f3f468d</a></td><td><code>Implement `__eq__` for PointwiseInverse properly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6093d57c987134506027600df3cfe24e15b5172\">c6093d5</a></td><td><code>Also implement `__ne__` as it is not magically added from somewhere else</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55ab282177ee959e276c72893bc19caeb940c60f\">55ab282</a></td><td><code>Implement `_richcmp_` for ModuleMorphismByLinearity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/031d86cd3b0448314c5879799153a459c4265f03\">031d86c</a></td><td><code>Implement TriangularModuleMorphism._richcmp_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7c99e74453d1a9c831df1615a843aa1816291d5\">b7c99e7</a></td><td><code>Implement TriangularModuleMorphismByLinearity._richcmp_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edef6c31d024e3b179e89013abe0fd69a8f44895\">edef6c3</a></td><td><code>Implement ModuleMorphismFromMatrix._richcmp_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a9a17fb35ff08ccf5400939b971afe130ccb2c8\">0a9a17f</a></td><td><code>Implement DiagonalModuleMorphism._richcmp_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f6f0d337cd53ccb0886e19d37e2731f625e4426\">6f6f0d3</a></td><td><code>Change `__eq__` docstring wording</code></td></tr></table>\n",
    "created_at": "2016-11-20T03:50:13Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4625f45aeb83408d189c95138b6308b59849e05">d4625f4</a></td><td><code>Merge branch 'develop' into t/19820/public/morphisms/triangular_module_morphism_eq-19820</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3f468da2b05cf53b99a4af3bfa9d2736b3ea63e">f3f468d</a></td><td><code>Implement `__eq__` for PointwiseInverse properly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6093d57c987134506027600df3cfe24e15b5172">c6093d5</a></td><td><code>Also implement `__ne__` as it is not magically added from somewhere else</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55ab282177ee959e276c72893bc19caeb940c60f">55ab282</a></td><td><code>Implement `_richcmp_` for ModuleMorphismByLinearity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/031d86cd3b0448314c5879799153a459c4265f03">031d86c</a></td><td><code>Implement TriangularModuleMorphism._richcmp_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7c99e74453d1a9c831df1615a843aa1816291d5">b7c99e7</a></td><td><code>Implement TriangularModuleMorphismByLinearity._richcmp_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edef6c31d024e3b179e89013abe0fd69a8f44895">edef6c3</a></td><td><code>Implement ModuleMorphismFromMatrix._richcmp_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a9a17fb35ff08ccf5400939b971afe130ccb2c8">0a9a17f</a></td><td><code>Implement DiagonalModuleMorphism._richcmp_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f6f0d337cd53ccb0886e19d37e2731f625e4426">6f6f0d3</a></td><td><code>Change `__eq__` docstring wording</code></td></tr></table>




---

archive/issue_comments_285754.json:
```json
{
    "body": "**Changing commit** from \"[16c0bfa0f5855ce030239b14a9b1b806b5447cd6](https://github.com/sagemath/sagetrac-mirror/commit/16c0bfa0f5855ce030239b14a9b1b806b5447cd6)\" to \"[6f6f0d337cd53ccb0886e19d37e2731f625e4426](https://github.com/sagemath/sagetrac-mirror/commit/6f6f0d337cd53ccb0886e19d37e2731f625e4426)\".",
    "created_at": "2016-11-20T03:50:13Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[16c0bfa0f5855ce030239b14a9b1b806b5447cd6](https://github.com/sagemath/sagetrac-mirror/commit/16c0bfa0f5855ce030239b14a9b1b806b5447cd6)" to "[6f6f0d337cd53ccb0886e19d37e2731f625e4426](https://github.com/sagemath/sagetrac-mirror/commit/6f6f0d337cd53ccb0886e19d37e2731f625e4426)".



---

archive/issue_comments_285755.json:
```json
{
    "body": "**Changing author** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Julian R\u00fcth\".",
    "created_at": "2016-11-20T03:52:52Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285755",
    "user": "https://github.com/saraedum"
}
```

**Changing author** from "Travis Scrimshaw" to "Travis Scrimshaw, Julian Rüth".



---

archive/issue_events_178016.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2016-11-20T03:52:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178016"
}
```



---

archive/issue_events_178017.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2016-11-20T03:52:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178017"
}
```



---

archive/issue_comments_285756.json:
```json
{
    "body": "<a id='comment:5'></a>\nTravis: Could you have a look at my changes? I implemented `_richcmp_`, to provide an implementation of `!=`. I also, removed the comparison on `_cmp` since I did not understand where this property would come from. Finally, I removed one call to the superclass, since `self._on_basis == other._on_basis` causes an infinite recursion when `_on_basis` is a normal method since comparing it triggers comparison of the `im_self` attribute\u2026\n\nTo be honest, I do not really understand what much if this code is about, so I might have broken something.",
    "created_at": "2016-11-20T03:52:52Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285756",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:5'></a>
Travis: Could you have a look at my changes? I implemented `_richcmp_`, to provide an implementation of `!=`. I also, removed the comparison on `_cmp` since I did not understand where this property would come from. Finally, I removed one call to the superclass, since `self._on_basis == other._on_basis` causes an infinite recursion when `_on_basis` is a normal method since comparing it triggers comparison of the `im_self` attribute…

To be honest, I do not really understand what much if this code is about, so I might have broken something.



---

archive/issue_comments_285757.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/256f4879fac574b963f4decb8e12a72c833ef844\">256f487</a></td><td><code>expanded tabs</code></td></tr></table>\n",
    "created_at": "2016-11-20T12:49:38Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285757",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/256f4879fac574b963f4decb8e12a72c833ef844">256f487</a></td><td><code>expanded tabs</code></td></tr></table>




---

archive/issue_comments_285758.json:
```json
{
    "body": "**Changing commit** from \"[6f6f0d337cd53ccb0886e19d37e2731f625e4426](https://github.com/sagemath/sagetrac-mirror/commit/6f6f0d337cd53ccb0886e19d37e2731f625e4426)\" to \"[256f4879fac574b963f4decb8e12a72c833ef844](https://github.com/sagemath/sagetrac-mirror/commit/256f4879fac574b963f4decb8e12a72c833ef844)\".",
    "created_at": "2016-11-20T12:49:38Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6f6f0d337cd53ccb0886e19d37e2731f625e4426](https://github.com/sagemath/sagetrac-mirror/commit/6f6f0d337cd53ccb0886e19d37e2731f625e4426)" to "[256f4879fac574b963f4decb8e12a72c833ef844](https://github.com/sagemath/sagetrac-mirror/commit/256f4879fac574b963f4decb8e12a72c833ef844)".



---

archive/issue_comments_285759.json:
```json
{
    "body": "<a id='comment:7'></a>\nJust my 2 cents: IIRC, the main motivation so far for the implementation of `__eq__` was to please pickling tests. We can't hope to have `==` on triangular module morphisms to be mathematical equality in general (this would require to have mathematical equality on arbitrary Python functions). If there is an easy way to get \"syntactical equality\" (e.g. when a morphism is built twice from the same function), that's a nice improvement.\n\nCheers,",
    "created_at": "2016-11-20T19:30:04Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285759",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:7'></a>
Just my 2 cents: IIRC, the main motivation so far for the implementation of `__eq__` was to please pickling tests. We can't hope to have `==` on triangular module morphisms to be mathematical equality in general (this would require to have mathematical equality on arbitrary Python functions). If there is an easy way to get "syntactical equality" (e.g. when a morphism is built twice from the same function), that's a nice improvement.

Cheers,



---

archive/issue_comments_285760.json:
```json
{
    "body": "<a id='comment:8'></a>\nnthiery: Sure. As we discussed at some point, mathematical equality is probably not what we should aim for in the first place: `==` should detect whether two objects are indistinguishable (in a reasonable sense,) everything else does not play well with dictionaries, hashes, \u2026 in the long run.\nAnyway, if we have `==` we should at least have a `!=`.",
    "created_at": "2016-11-20T21:07:34Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285760",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:8'></a>
nthiery: Sure. As we discussed at some point, mathematical equality is probably not what we should aim for in the first place: `==` should detect whether two objects are indistinguishable (in a reasonable sense,) everything else does not play well with dictionaries, hashes, … in the long run.
Anyway, if we have `==` we should at least have a `!=`.



---

archive/issue_comments_285761.json:
```json
{
    "body": "**Changing commit** from \"[256f4879fac574b963f4decb8e12a72c833ef844](https://github.com/sagemath/sagetrac-mirror/commit/256f4879fac574b963f4decb8e12a72c833ef844)\" to \"[af447b267f33d568a1dfcf9a60c7aa2e07f30dd4](https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4)\".",
    "created_at": "2016-11-24T23:26:39Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[256f4879fac574b963f4decb8e12a72c833ef844](https://github.com/sagemath/sagetrac-mirror/commit/256f4879fac574b963f4decb8e12a72c833ef844)" to "[af447b267f33d568a1dfcf9a60c7aa2e07f30dd4](https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4)".



---

archive/issue_comments_285762.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4\">af447b2</a></td><td><code>Expand cmp</code></td></tr></table>\n",
    "created_at": "2016-11-24T23:26:39Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4">af447b2</a></td><td><code>Expand cmp</code></td></tr></table>




---

archive/issue_comments_285763.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe patchbot still complains about a few `cmp`s. These are, however, not actual invocations of the cmp function of python but just a keyword argument that is called `cmp`.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4\">af447b2</a></td><td><code>Expand cmp</code></td></tr></table>\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4\">af447b2</a></td><td><code>Expand cmp</code></td></tr></table>\n",
    "created_at": "2016-11-24T23:26:46Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285763",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>
The patchbot still complains about a few `cmp`s. These are, however, not actual invocations of the cmp function of python but just a keyword argument that is called `cmp`.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4">af447b2</a></td><td><code>Expand cmp</code></td></tr></table>

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4">af447b2</a></td><td><code>Expand cmp</code></td></tr></table>




---

archive/issue_comments_285764.json:
```json
{
    "body": "<a id='comment:11'></a>\nwarning: this is going to conflict very heavily with one closed python3 ticket, which already did the same job\n\n**EDIT**: or maybe not, I confused two morphism files",
    "created_at": "2016-11-25T06:57:01Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285764",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
warning: this is going to conflict very heavily with one closed python3 ticket, which already did the same job

**EDIT**: or maybe not, I confused two morphism files



---

archive/issue_comments_285765.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Right now, a comparison by the underlying `__dict__` is done, which causes problems when trying to define a cached method on a morphism. We need to implement a better `__eq__` for each subclass with more controllable behavior. See the discussion on #19609.\n+\n+See also #21894 which collects similarly broken implementations of `__eq__`.\n``````\n",
    "created_at": "2016-11-29T23:30:45Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285765",
    "user": "https://github.com/saraedum"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Right now, a comparison by the underlying `__dict__` is done, which causes problems when trying to define a cached method on a morphism. We need to implement a better `__eq__` for each subclass with more controllable behavior. See the discussion on #19609.
+
+See also #21894 which collects similarly broken implementations of `__eq__`.
``````




---

archive/issue_comments_285766.json:
```json
{
    "body": "<a id='comment:13'></a>\nIt would be great if somebody who understands what these classes are supposed to do could have a look at my changes. This is a dependency of #21996. But sadly, the people who care about #21996 are not exactly sure what these classes here are doing, so we can not review this ourselves. Thanks!",
    "created_at": "2016-12-06T21:47:44Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285766",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:13'></a>
It would be great if somebody who understands what these classes are supposed to do could have a look at my changes. This is a dependency of #21996. But sadly, the people who care about #21996 are not exactly sure what these classes here are doing, so we can not review this ourselves. Thanks!



---

archive/issue_comments_285767.json:
```json
{
    "body": "<a id='comment:14'></a>\nI have been told not to use magic numbers \"op == 2\" but rather \"op == Py_NE\" or \"op == op_NE\", imported from somwhere.",
    "created_at": "2016-12-11T14:55:51Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285767",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
I have been told not to use magic numbers "op == 2" but rather "op == Py_NE" or "op == op_NE", imported from somwhere.



---

archive/issue_comments_285768.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4\">d9a4a75</a></td><td><code>Do not use magic constants in richcmp</code></td></tr></table>\n",
    "created_at": "2016-12-11T17:37:49Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4">d9a4a75</a></td><td><code>Do not use magic constants in richcmp</code></td></tr></table>




---

archive/issue_comments_285769.json:
```json
{
    "body": "**Changing commit** from \"[af447b267f33d568a1dfcf9a60c7aa2e07f30dd4](https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4)\" to \"[d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4](https://github.com/sagemath/sagetrac-mirror/commit/d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4)\".",
    "created_at": "2016-12-11T17:37:49Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[af447b267f33d568a1dfcf9a60c7aa2e07f30dd4](https://github.com/sagemath/sagetrac-mirror/commit/af447b267f33d568a1dfcf9a60c7aa2e07f30dd4)" to "[d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4](https://github.com/sagemath/sagetrac-mirror/commit/d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4)".



---

archive/issue_comments_285770.json:
```json
{
    "body": "<a id='comment:16'></a>\nThanks, I did not know that there was `op_NE`.",
    "created_at": "2016-12-11T17:38:18Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285770",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:16'></a>
Thanks, I did not know that there was `op_NE`.



---

archive/issue_comments_285771.json:
```json
{
    "body": "**Changing commit** from \"[d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4](https://github.com/sagemath/sagetrac-mirror/commit/d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4)\" to \"[bfcdfe5cddc243af2679ef1497f84edafcb2fb2d](https://github.com/sagemath/sagetrac-mirror/commit/bfcdfe5cddc243af2679ef1497f84edafcb2fb2d)\".",
    "created_at": "2017-03-16T16:55:06Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4](https://github.com/sagemath/sagetrac-mirror/commit/d9a4a75c1ad295650cd7f5bd172ab37a26d55bf4)" to "[bfcdfe5cddc243af2679ef1497f84edafcb2fb2d](https://github.com/sagemath/sagetrac-mirror/commit/bfcdfe5cddc243af2679ef1497f84edafcb2fb2d)".



---

archive/issue_comments_285772.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60a1ab4bbae6fd8c56841ccabe809b0412678329\">60a1ab4</a></td><td><code>Merge branch 'public/morphisms/triangular_module_morphism_eq-19820' of trac.sagemath.org:sage into public/morphisms/triangular_module_morphism_eq-19820</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfcdfe5cddc243af2679ef1497f84edafcb2fb2d\">bfcdfe5</a></td><td><code>Some little bits of cleanup.</code></td></tr></table>\n",
    "created_at": "2017-03-16T16:55:06Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60a1ab4bbae6fd8c56841ccabe809b0412678329">60a1ab4</a></td><td><code>Merge branch 'public/morphisms/triangular_module_morphism_eq-19820' of trac.sagemath.org:sage into public/morphisms/triangular_module_morphism_eq-19820</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfcdfe5cddc243af2679ef1497f84edafcb2fb2d">bfcdfe5</a></td><td><code>Some little bits of cleanup.</code></td></tr></table>




---

archive/issue_comments_285773.json:
```json
{
    "body": "**Changing keywords** from \"triangular module morphism\" to \"triangular module morphism, days85\".",
    "created_at": "2017-03-16T16:58:19Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285773",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "triangular module morphism" to "triangular module morphism, days85".



---

archive/issue_events_178018.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-16T16:58:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "milestone": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178018"
}
```



---

archive/issue_events_178019.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-16T16:58:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178019"
}
```



---

archive/issue_comments_285774.json:
```json
{
    "body": "<a id='comment:18'></a>\nI made it `return NotImplemented` instead of raising an error because that is the more standard way of doing things. Specifically it allows the other object to try its comparison operations. If my changes are good, then positive review.",
    "created_at": "2017-03-16T16:58:19Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285774",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
I made it `return NotImplemented` instead of raising an error because that is the more standard way of doing things. Specifically it allows the other object to try its comparison operations. If my changes are good, then positive review.



---

archive/issue_comments_285775.json:
```json
{
    "body": "**Reviewer:** Julian R\u00fcth, Travis Scrimshaw",
    "created_at": "2017-03-16T16:58:19Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285775",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Julian Rüth, Travis Scrimshaw



---

archive/issue_events_178020.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-16T18:18:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178020"
}
```



---

archive/issue_events_178021.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-16T18:18:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178021"
}
```



---

archive/issue_comments_285776.json:
```json
{
    "body": "<a id='comment:19'></a>\n`_richcmp_()` will only get called for equal parents. So this check is not needed: `self.parent() == other.parent()`\n\n(just pointing this point, I don't actually care about this ticket)",
    "created_at": "2017-03-16T18:18:20Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285776",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
`_richcmp_()` will only get called for equal parents. So this check is not needed: `self.parent() == other.parent()`

(just pointing this point, I don't actually care about this ticket)



---

archive/issue_comments_285777.json:
```json
{
    "body": "<a id='comment:20'></a>\nIn case that this parent only has one element class (which is often the case), also the check \n\n```\nself.__class__ is other.__class__\n```\ncan be skipped.",
    "created_at": "2017-03-16T18:20:14Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285777",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
In case that this parent only has one element class (which is often the case), also the check 

```
self.__class__ is other.__class__
```
can be skipped.



---

archive/issue_comments_285778.json:
```json
{
    "body": "<a id='comment:21'></a>\nJust remove this line instead of commenting it:\n\n```\n#from sage.misc.cachefunc import cached_method, cached_function\n```",
    "created_at": "2017-03-16T18:20:59Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285778",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Just remove this line instead of commenting it:

```
#from sage.misc.cachefunc import cached_method, cached_function
```



---

archive/issue_comments_285779.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [saraedum](#comment%3A16):\n> Thanks, I did not know that there was `op_NE`.\n\n\nIt was added pretty recently to Sage. It is there to allow pure Python code to use/implement rich comparisons the same way as Cython.",
    "created_at": "2017-03-16T18:22:25Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285779",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Replying to [saraedum](#comment%3A16):
> Thanks, I did not know that there was `op_NE`.


It was added pretty recently to Sage. It is there to allow pure Python code to use/implement rich comparisons the same way as Cython.



---

archive/issue_comments_285780.json:
```json
{
    "body": "**Changing commit** from \"[bfcdfe5cddc243af2679ef1497f84edafcb2fb2d](https://github.com/sagemath/sagetrac-mirror/commit/bfcdfe5cddc243af2679ef1497f84edafcb2fb2d)\" to \"[5b1b761250b8c384d0cbd53695b73ad5f15f2aa4](https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4)\".",
    "created_at": "2017-03-16T21:36:50Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285780",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bfcdfe5cddc243af2679ef1497f84edafcb2fb2d](https://github.com/sagemath/sagetrac-mirror/commit/bfcdfe5cddc243af2679ef1497f84edafcb2fb2d)" to "[5b1b761250b8c384d0cbd53695b73ad5f15f2aa4](https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4)".



---

archive/issue_comments_285781.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4\">5b1b761</a></td><td><code>Fixing some tidbits of ModuleMorphism.</code></td></tr></table>\n",
    "created_at": "2017-03-16T21:36:50Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4">5b1b761</a></td><td><code>Fixing some tidbits of ModuleMorphism.</code></td></tr></table>




---

archive/issue_events_178022.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-16T21:38:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178022"
}
```



---

archive/issue_events_178023.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-16T21:38:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178023"
}
```



---

archive/issue_comments_285782.json:
```json
{
    "body": "<a id='comment:24'></a>\nEssentially all of these could be created from the same parent (`Hom(V,W)`) as the classes represent certain special properties of the morphism. So we have to check the class. However, I've removed the commented line and the parent comparisons.",
    "created_at": "2017-03-16T21:38:58Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285782",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
Essentially all of these could be created from the same parent (`Hom(V,W)`) as the classes represent certain special properties of the morphism. So we have to check the class. However, I've removed the commented line and the parent comparisons.



---

archive/issue_events_178024.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2017-03-16T21:47:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178024"
}
```



---

archive/issue_events_178025.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2017-03-16T21:47:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178025"
}
```



---

archive/issue_comments_285783.json:
```json
{
    "body": "**Changing branch** from \"[public/morphisms/triangular_module_morphism_eq-19820](https://github.com/sagemath/sagetrac-mirror/tree/public/morphisms/triangular_module_morphism_eq-19820)\" to \"[5b1b761250b8c384d0cbd53695b73ad5f15f2aa4](https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4)\".",
    "created_at": "2017-03-27T20:43:00Z",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19820#issuecomment-285783",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/morphisms/triangular_module_morphism_eq-19820](https://github.com/sagemath/sagetrac-mirror/tree/public/morphisms/triangular_module_morphism_eq-19820)" to "[5b1b761250b8c384d0cbd53695b73ad5f15f2aa4](https://github.com/sagemath/sagetrac-mirror/commit/5b1b761250b8c384d0cbd53695b73ad5f15f2aa4)".



---

archive/issue_events_178026.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-27T20:43:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178026"
}
```



---

archive/issue_events_178027.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-27T20:43:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19820",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19820#event-178027"
}
```
