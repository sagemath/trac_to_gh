# Issue 19843: Improve location change error message

archive/issues_019606.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nRaise an error if the Sage installation tree was relocated.\n\nComponent: **build**\n\nAuthor: **Volker Braun, Jeroen Demeyer**\n\nBranch: **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)**\n\nReviewer: **Volker Braun**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19843_\n\n",
    "closed_at": "2016-01-18T12:49:48Z",
    "created_at": "2016-01-07T22:45:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve location change error message",
    "type": "issue",
    "updated_at": "2016-01-18T13:21:15Z",
    "url": "https://github.com/sagemath/sage/issues/19843",
    "user": "https://github.com/vbraun"
}
```
<div id="comment:0"></div>

Raise an error if the Sage installation tree was relocated.

Component: **build**

Author: **Volker Braun, Jeroen Demeyer**

Branch: **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)**

Reviewer: **Volker Braun**

_Issue created by migration from https://trac.sagemath.org/ticket/19843_





---

archive/issue_events_278067.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T22:45:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "milestone_number": null,
    "milestone_title": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278067"
}
```



---

archive/issue_events_278068.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T22:45:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278068"
}
```



---

archive/issue_comments_283642.json:
```json
{
    "body": "Branch: **[u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)**",
    "created_at": "2016-01-07T23:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283642",
    "user": "https://github.com/vbraun"
}
```

Branch: **[u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)**



---

archive/issue_comments_283643.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2016-01-07T23:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283643",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_comments_283644.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9e4adf03d05e7a9bb5d41428a3f4aa604355035\"><code>c9e4adf</code></a></td><td><code>Remove sage-force-relocate.txt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a149491f28b35554e60fd5b6baeeba27c229c9df\"><code>a149491</code></a></td><td><code>Remove lib/*.la modifications</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf\"><code>b46f637</code></a></td><td><code>Correct the relocation error message</code></td></tr></table>\n",
    "created_at": "2016-01-07T23:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283644",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9e4adf03d05e7a9bb5d41428a3f4aa604355035"><code>c9e4adf</code></a></td><td><code>Remove sage-force-relocate.txt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a149491f28b35554e60fd5b6baeeba27c229c9df"><code>a149491</code></a></td><td><code>Remove lib/*.la modifications</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf"><code>b46f637</code></a></td><td><code>Correct the relocation error message</code></td></tr></table>




---

archive/issue_events_278069.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T23:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278069"
}
```



---

archive/issue_comments_283645.json:
```json
{
    "body": "Commit: **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)**",
    "created_at": "2016-01-07T23:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283645",
    "user": "https://github.com/vbraun"
}
```

Commit: **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)**



---

archive/issue_events_278070.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T23:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278070"
}
```



---

archive/issue_events_278071.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T23:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278071"
}
```



---

archive/issue_comments_283646.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Change the sage-location script to match how the new binary builds work\n``````\n",
    "created_at": "2016-01-07T23:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283646",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Change the sage-location script to match how the new binary builds work
``````




---

archive/issue_comments_283647.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis seems reasonable but I have no way of testing it properly right now.  But if someone can do that I think the message and removal of other stuff is probably the right solution here.",
    "created_at": "2016-01-08T06:13:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283647",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:4" align="right">comment:4</div>

This seems reasonable but I have no way of testing it properly right now.  But if someone can do that I think the message and removal of other stuff is probably the right solution here.



---

archive/issue_comments_283648.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis warning is useful:\n\n```sh\n    # Display a message if we actually installed something (using this\n    # file, generated by sage-spkg, is a bit of a hack though)\n    if [ -f \"$SAGE_LOCAL/lib/sage-force-relocate.txt\" ]; then\n        echo\n        echo \"Warning: it might be needed to update the Sage library before\"\n        echo \"installed packages work: you should run 'make' from \\$SAGE_ROOT\"\n        echo \"before running Sage.\"\n    fi\n```\nUsing `sage-force-relocate.txt` to determine when to display this message is a hack, but the message itself still makes sense.",
    "created_at": "2016-01-16T13:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283648",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

This warning is useful:

```sh
    # Display a message if we actually installed something (using this
    # file, generated by sage-spkg, is a bit of a hack though)
    if [ -f "$SAGE_LOCAL/lib/sage-force-relocate.txt" ]; then
        echo
        echo "Warning: it might be needed to update the Sage library before"
        echo "installed packages work: you should run 'make' from \$SAGE_ROOT"
        echo "before running Sage."
    fi
```
Using `sage-force-relocate.txt` to determine when to display this message is a hack, but the message itself still makes sense.



---

archive/issue_comments_283649.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThere is no relocation any more, if you move the install tree without using the binary packaging script then it does not work. In particular, updating the Sage library isn't going to help.",
    "created_at": "2016-01-16T14:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283649",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

There is no relocation any more, if you move the install tree without using the binary packaging script then it does not work. In particular, updating the Sage library isn't going to help.



---

archive/issue_events_278072.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-16T14:19:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278072"
}
```



---

archive/issue_events_278073.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-16T14:19:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278073"
}
```



---

archive/issue_comments_283650.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nthis should really be in 7.0",
    "created_at": "2016-01-16T14:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283650",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

this should really be in 7.0



---

archive/issue_comments_283651.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nPlease read [comment:5] again. It's not about relocation at all. It just uses the file `sage-force-relocate.txt` as proxy to determine whether a package was installed.",
    "created_at": "2016-01-16T14:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283651",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Please read [comment:5] again. It's not about relocation at all. It just uses the file `sage-force-relocate.txt` as proxy to determine whether a package was installed.



---

archive/issue_comments_283652.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHmm OK, but its a bad implementation of a questionable feature. If you use \"make foo\" to install foo then its not needed, and if you manually mucked with packages then there are a million ways to break it so why try to catch this particular one?",
    "created_at": "2016-01-16T14:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283652",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

Hmm OK, but its a bad implementation of a questionable feature. If you use "make foo" to install foo then its not needed, and if you manually mucked with packages then there are a million ways to break it so why try to catch this particular one?



---

archive/issue_comments_283653.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@vbraun](#comment%3A9):\n> Hmm OK, but its a bad implementation of a questionable feature. If you use \"make foo\" to install foo then its not needed\n\nThat's not true. This is to catch \"reverse dependencies\": say you have a package A depending on B and you decide to (re)build B. Then you should also rebuild A before running Sage.",
    "created_at": "2016-01-16T19:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283653",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@vbraun](#comment%3A9):
> Hmm OK, but its a bad implementation of a questionable feature. If you use "make foo" to install foo then its not needed

That's not true. This is to catch "reverse dependencies": say you have a package A depending on B and you decide to (re)build B. Then you should also rebuild A before running Sage.



---

archive/issue_comments_283654.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nMake already has `--question` to check whether dependencies are satisfied. We should just use that. Or, even easier, print that warning simply after `make B`. But piggy-backing it on sage-force-relocation isnt' really an option. \n\nIn any case, I made #19902 for that.",
    "created_at": "2016-01-16T20:42:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283654",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

Make already has `--question` to check whether dependencies are satisfied. We should just use that. Or, even easier, print that warning simply after `make B`. But piggy-backing it on sage-force-relocation isnt' really an option. 

In any case, I made #19902 for that.



---

archive/issue_comments_283655.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@vbraun](#comment%3A11):\n> Make already has `--question` to check whether dependencies are satisfied. We should just use that.\n\nThe problem with `make --question` is that the Sage library (i.e. Cython + distutils) does not support that. You can't do `./setup.py --question` to ask if Python dependencies are up-to-date.\n\n> Or, even easier, print that warning simply after `make B`.\n\nOK, please move this message to the end of `sage-spkg` then.",
    "created_at": "2016-01-17T08:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283655",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@vbraun](#comment%3A11):
> Make already has `--question` to check whether dependencies are satisfied. We should just use that.

The problem with `make --question` is that the Sage library (i.e. Cython + distutils) does not support that. You can't do `./setup.py --question` to ask if Python dependencies are up-to-date.

> Or, even easier, print that warning simply after `make B`.

OK, please move this message to the end of `sage-spkg` then.



---

archive/issue_comments_283656.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSee #19902",
    "created_at": "2016-01-17T09:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283656",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

See #19902



---

archive/issue_comments_283657.json:
```json
{
    "body": "Changed commit from **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)** to **[`50ba4fe`](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)**",
    "created_at": "2016-01-17T13:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283657",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)** to **[`50ba4fe`](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)**



---

archive/issue_comments_283658.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240\"><code>50ba4fe</code></a></td><td><code>Add note at the end of sage-spkg</code></td></tr></table>\n",
    "created_at": "2016-01-17T13:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283658",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240"><code>50ba4fe</code></a></td><td><code>Add note at the end of sage-spkg</code></td></tr></table>




---

archive/issue_comments_283659.json:
```json
{
    "body": "Changed commit from **[`50ba4fe`](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)** to **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)**",
    "created_at": "2016-01-17T13:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283659",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`50ba4fe`](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)** to **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)**



---

archive/issue_comments_283660.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-17T13:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283660",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_278074.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T10:03:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278074"
}
```



---

archive/issue_events_278075.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T10:03:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278075"
}
```



---

archive/issue_comments_283661.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThis is a bit sloppy. Why keep all the functions `update_pkgconfig_files()`, `make_scripts_relative()`, `sage_relocate()` if they aren't used anymore? You might argue that they will still be called when running Sage *the first time*. However, they won't be called anymore when upgrading packages. So there is really no point in running them just once.\n\nEither you run them every time a package is installed (like it used to be) or you never run them.\n\nSecond, the `check_processor_flags()` function becomes pointless since it's only run on the machine which created the binary, not on the machine running the binary. But maybe we should consider `check_processor_flags()` obsolete and just remove it.",
    "created_at": "2016-01-18T10:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283661",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

This is a bit sloppy. Why keep all the functions `update_pkgconfig_files()`, `make_scripts_relative()`, `sage_relocate()` if they aren't used anymore? You might argue that they will still be called when running Sage *the first time*. However, they won't be called anymore when upgrading packages. So there is really no point in running them just once.

Either you run them every time a package is installed (like it used to be) or you never run them.

Second, the `check_processor_flags()` function becomes pointless since it's only run on the machine which created the binary, not on the machine running the binary. But maybe we should consider `check_processor_flags()` obsolete and just remove it.



---

archive/issue_comments_283662.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI suggest the following: apply just the part of this patch which adds an error message if the Sage installation was moved. Keep the old functionality, including the `sage-force-relocate.txt` file. Then make more serious changes to `sage-location` in Sage 7.1. That will have the least chances of breakage.",
    "created_at": "2016-01-18T10:06:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283662",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

I suggest the following: apply just the part of this patch which adds an error message if the Sage installation was moved. Keep the old functionality, including the `sage-force-relocate.txt` file. Then make more serious changes to `sage-location` in Sage 7.1. That will have the least chances of breakage.



---

archive/issue_events_278076.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:17:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278076"
}
```



---

archive/issue_events_278077.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:17:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278077"
}
```



---

archive/issue_comments_283663.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nMaking script paths relative is still a plus IMHO for the binary build, so I would keep them. Of course thats a bit of a matter of taste. But I have no intention of engaging in a bikeshedding session here over what to do, either change it yourself or live with it.\n\nThis branch is tested and works, any alternative implementation is just going to have lower chances of working. I'm at the sage gap workshop this week so I don't have time to rewrite this for no good reason whatsoever.\n\nFeature requests for `check_processor_flags` should also go to a separate ticket.",
    "created_at": "2016-01-18T12:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283663",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">comment:18</div>

Making script paths relative is still a plus IMHO for the binary build, so I would keep them. Of course thats a bit of a matter of taste. But I have no intention of engaging in a bikeshedding session here over what to do, either change it yourself or live with it.

This branch is tested and works, any alternative implementation is just going to have lower chances of working. I'm at the sage gap workshop this week so I don't have time to rewrite this for no good reason whatsoever.

Feature requests for `check_processor_flags` should also go to a separate ticket.



---

archive/issue_comments_283664.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@vbraun](#comment%3A18):\n> But I have no intention of engaging in a bikeshedding session here over what to do\n\nNot every discussion/disagreement is \"bikeshedding\". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).\n\n> either change it yourself\n\nFine.",
    "created_at": "2016-01-18T12:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283664",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@vbraun](#comment%3A18):
> But I have no intention of engaging in a bikeshedding session here over what to do

Not every discussion/disagreement is "bikeshedding". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).

> either change it yourself

Fine.



---

archive/issue_comments_283665.json:
```json
{
    "body": "Changed author from **Volker Braun** to **Volker Braun, Jeroen Demeyer**",
    "created_at": "2016-01-18T12:34:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283665",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Volker Braun** to **Volker Braun, Jeroen Demeyer**



---

archive/issue_events_278078.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:34:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278078"
}
```



---

archive/issue_events_278079.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:34:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278079"
}
```



---

archive/issue_comments_283666.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Change the sage-location script to match how the new binary builds work\n+Raise an error if the Sage installation tree was relocated.\n``````\n",
    "created_at": "2016-01-18T12:34:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283666",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Change the sage-location script to match how the new binary builds work
+Raise an error if the Sage installation tree was relocated.
``````




---

archive/issue_comments_283667.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment%3A19):\n> Not every discussion/disagreement is \"bikeshedding\". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).\n\nThat is intentional, there is no relocation after re-installing packages so we shouldn't mislead people into believing anything else.",
    "created_at": "2016-01-18T12:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283667",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment%3A19):
> Not every discussion/disagreement is "bikeshedding". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).

That is intentional, there is no relocation after re-installing packages so we shouldn't mislead people into believing anything else.



---

archive/issue_comments_283668.json:
```json
{
    "body": "Changed branch from **[u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)** to **[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)**",
    "created_at": "2016-01-18T12:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283668",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)** to **[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)**



---

archive/issue_comments_283669.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cea615d1046f0f9351ce4e20951b5e358fc049a\"><code>3cea615</code></a></td><td><code>Improve location change error message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5\"><code>cec4552</code></a></td><td><code>Raise an error if Sage has been relocated</code></td></tr></table>\n",
    "created_at": "2016-01-18T12:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283669",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cea615d1046f0f9351ce4e20951b5e358fc049a"><code>3cea615</code></a></td><td><code>Improve location change error message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5"><code>cec4552</code></a></td><td><code>Raise an error if Sage has been relocated</code></td></tr></table>




---

archive/issue_comments_283670.json:
```json
{
    "body": "Changed commit from **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)** to **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)**",
    "created_at": "2016-01-18T12:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283670",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`b46f637`](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)** to **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)**



---

archive/issue_events_278080.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:45:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278080"
}
```



---

archive/issue_events_278081.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:45:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278081"
}
```



---

archive/issue_comments_283671.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis implements [comment:17]: make a minimal patch for Sage 7.0 and deal with the deeper issues later on #19908.",
    "created_at": "2016-01-18T12:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283671",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

This implements [comment:17]: make a minimal patch for Sage 7.0 and deal with the deeper issues later on #19908.



---

archive/issue_events_278082.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:48:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278082"
}
```



---

archive/issue_events_278083.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:48:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278083"
}
```



---

archive/issue_comments_283672.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nmuch worse but at least we don't have to hold the release process hostage any more with this pointless exercise",
    "created_at": "2016-01-18T12:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283672",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

much worse but at least we don't have to hold the release process hostage any more with this pointless exercise



---

archive/issue_comments_283673.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2016-01-18T12:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283673",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_283674.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)** to **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)**",
    "created_at": "2016-01-18T12:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283674",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)** to **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)**



---

archive/issue_events_278084.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:49:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278084"
}
```



---

archive/issue_events_278085.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "94dd2e2dfeba82bbbdc4563ce7eb06fecb87b197",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-01-18T12:49:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19843#event-278085"
}
```



---

archive/issue_comments_283675.json:
```json
{
    "body": "Changed commit from **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)** to none",
    "created_at": "2016-01-18T12:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283675",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`cec4552`](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)** to none



---

archive/issue_comments_283676.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n> at least we don't have to hold the release process hostage\n\nIs that cynism really needed? Pointing out issues with a branch is not \"holding the release process hostage\".\n\nI think you are \"reverse bikeshedding\": you're destroying half of the nuclear reactor but pretending that you are only repainting the bikeshed.\n\nAt least my patch is much safer than yours, because it really only changes the color of the bikeshed.",
    "created_at": "2016-01-18T12:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283676",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

> at least we don't have to hold the release process hostage

Is that cynism really needed? Pointing out issues with a branch is not "holding the release process hostage".

I think you are "reverse bikeshedding": you're destroying half of the nuclear reactor but pretending that you are only repainting the bikeshed.

At least my patch is much safer than yours, because it really only changes the color of the bikeshed.



---

archive/issue_comments_283677.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIt still leaves lots of misleading messages about relocation that will be confusing to our users, which IMHO is terrible UX. But at least they eventually get a hard error even if it contradicts the signals before.",
    "created_at": "2016-01-18T13:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283677",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:28" align="right">comment:28</div>

It still leaves lots of misleading messages about relocation that will be confusing to our users, which IMHO is terrible UX. But at least they eventually get a hard error even if it contradicts the signals before.



---

archive/issue_comments_283678.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@vbraun](#comment%3A28):\n> It still leaves lots of misleading messages about relocation\n\nI don't believe that the messages are so misleading. The most common is\n\n```\nForcing sage-location, probably because a new package was installed.\nUpdating various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\n```\nwhich is not really wrong.\n\nMore seriously, you are of course right that the messages can be improved. However, having a properly functioning Sage is a much higher priority than getting the messages right (which *is* a bikeshedding issue!)",
    "created_at": "2016-01-18T13:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283678",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@vbraun](#comment%3A28):
> It still leaves lots of misleading messages about relocation

I don't believe that the messages are so misleading. The most common is

```
Forcing sage-location, probably because a new package was installed.
Updating various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
```
which is not really wrong.

More seriously, you are of course right that the messages can be improved. However, having a properly functioning Sage is a much higher priority than getting the messages right (which *is* a bikeshedding issue!)



---

archive/issue_comments_283679.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nHow is a user not going to interpret that as \"relocation is ok\", especially since it has been like that for the last years.",
    "created_at": "2016-01-18T13:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19843#issuecomment-283679",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:30" align="right">comment:30</div>

How is a user not going to interpret that as "relocation is ok", especially since it has been like that for the last years.
