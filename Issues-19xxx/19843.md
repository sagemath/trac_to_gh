# Issue 19843: Improve location change error message

archive/issues_019606.json:
```json
{
    "body": "Raise an error if the Sage installation tree was relocated.\n\n**Branch:** [cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)\n\n**Reviewer:** Volker Braun\n\n**Author:** Volker Braun, Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/19843\n\n",
    "closed_at": "2016-01-18T12:49:48Z",
    "created_at": "2016-01-07T22:45:47Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Improve location change error message",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19843",
    "user": "https://github.com/vbraun"
}
```
Raise an error if the Sage installation tree was relocated.

**Branch:** [cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)

**Reviewer:** Volker Braun

**Author:** Volker Braun, Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/19843





---

archive/issue_comments_286169.json:
```json
{
    "body": "**Branch:** [u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)",
    "created_at": "2016-01-07T23:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286169",
    "user": "https://github.com/vbraun"
}
```

**Branch:** [u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)



---

archive/issue_comments_286170.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2016-01-07T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286170",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_comments_286171.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9e4adf03d05e7a9bb5d41428a3f4aa604355035\">c9e4adf</a></td><td><code>Remove sage-force-relocate.txt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a149491f28b35554e60fd5b6baeeba27c229c9df\">a149491</a></td><td><code>Remove lib/*.la modifications</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf\">b46f637</a></td><td><code>Correct the relocation error message</code></td></tr></table>\n",
    "created_at": "2016-01-07T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286171",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9e4adf03d05e7a9bb5d41428a3f4aa604355035">c9e4adf</a></td><td><code>Remove sage-force-relocate.txt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a149491f28b35554e60fd5b6baeeba27c229c9df">a149491</a></td><td><code>Remove lib/*.la modifications</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf">b46f637</a></td><td><code>Correct the relocation error message</code></td></tr></table>




---

archive/issue_events_178209.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T23:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "component: build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178209"
}
```



---

archive/issue_comments_286172.json:
```json
{
    "body": "**Commit:** [b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)",
    "created_at": "2016-01-07T23:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286172",
    "user": "https://github.com/vbraun"
}
```

**Commit:** [b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)



---

archive/issue_events_178210.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T23:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178210"
}
```



---

archive/issue_events_178211.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-07T23:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178211"
}
```



---

archive/issue_comments_286173.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Change the sage-location script to match how the new binary builds work\n``````\n",
    "created_at": "2016-01-07T23:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286173",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Change the sage-location script to match how the new binary builds work
``````




---

archive/issue_comments_286174.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis seems reasonable but I have no way of testing it properly right now.  But if someone can do that I think the message and removal of other stuff is probably the right solution here.",
    "created_at": "2016-01-08T06:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286174",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>
This seems reasonable but I have no way of testing it properly right now.  But if someone can do that I think the message and removal of other stuff is probably the right solution here.



---

archive/issue_comments_286175.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis warning is useful:\n\n```sh\n    # Display a message if we actually installed something (using this\n    # file, generated by sage-spkg, is a bit of a hack though)\n    if [ -f \"$SAGE_LOCAL/lib/sage-force-relocate.txt\" ]; then\n        echo\n        echo \"Warning: it might be needed to update the Sage library before\"\n        echo \"installed packages work: you should run 'make' from \\$SAGE_ROOT\"\n        echo \"before running Sage.\"\n    fi\n```\nUsing `sage-force-relocate.txt` to determine when to display this message is a hack, but the message itself still makes sense.",
    "created_at": "2016-01-16T13:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286175",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
This warning is useful:

```sh
    # Display a message if we actually installed something (using this
    # file, generated by sage-spkg, is a bit of a hack though)
    if [ -f "$SAGE_LOCAL/lib/sage-force-relocate.txt" ]; then
        echo
        echo "Warning: it might be needed to update the Sage library before"
        echo "installed packages work: you should run 'make' from \$SAGE_ROOT"
        echo "before running Sage."
    fi
```
Using `sage-force-relocate.txt` to determine when to display this message is a hack, but the message itself still makes sense.



---

archive/issue_comments_286176.json:
```json
{
    "body": "<a id='comment:6'></a>\nThere is no relocation any more, if you move the install tree without using the binary packaging script then it does not work. In particular, updating the Sage library isn't going to help.",
    "created_at": "2016-01-16T14:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286176",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
There is no relocation any more, if you move the install tree without using the binary packaging script then it does not work. In particular, updating the Sage library isn't going to help.



---

archive/issue_events_178212.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-16T14:19:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178212"
}
```



---

archive/issue_comments_286177.json:
```json
{
    "body": "<a id='comment:7'></a>\nthis should really be in 7.0",
    "created_at": "2016-01-16T14:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286177",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
this should really be in 7.0



---

archive/issue_comments_286178.json:
```json
{
    "body": "<a id='comment:8'></a>\nPlease read [comment:5] again. It's not about relocation at all. It just uses the file `sage-force-relocate.txt` as proxy to determine whether a package was installed.",
    "created_at": "2016-01-16T14:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286178",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Please read [comment:5] again. It's not about relocation at all. It just uses the file `sage-force-relocate.txt` as proxy to determine whether a package was installed.



---

archive/issue_comments_286179.json:
```json
{
    "body": "<a id='comment:9'></a>\nHmm OK, but its a bad implementation of a questionable feature. If you use \"make foo\" to install foo then its not needed, and if you manually mucked with packages then there are a million ways to break it so why try to catch this particular one?",
    "created_at": "2016-01-16T14:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286179",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Hmm OK, but its a bad implementation of a questionable feature. If you use "make foo" to install foo then its not needed, and if you manually mucked with packages then there are a million ways to break it so why try to catch this particular one?



---

archive/issue_comments_286180.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [vbraun](#comment%3A9):\n> Hmm OK, but its a bad implementation of a questionable feature. If you use \"make foo\" to install foo then its not needed\n\n\nThat's not true. This is to catch \"reverse dependencies\": say you have a package A depending on B and you decide to (re)build B. Then you should also rebuild A before running Sage.",
    "created_at": "2016-01-16T19:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286180",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [vbraun](#comment%3A9):
> Hmm OK, but its a bad implementation of a questionable feature. If you use "make foo" to install foo then its not needed


That's not true. This is to catch "reverse dependencies": say you have a package A depending on B and you decide to (re)build B. Then you should also rebuild A before running Sage.



---

archive/issue_comments_286181.json:
```json
{
    "body": "<a id='comment:11'></a>\nMake already has `--question` to check whether dependencies are satisfied. We should just use that. Or, even easier, print that warning simply after `make B`. But piggy-backing it on sage-force-relocation isnt' really an option. \n\nIn any case, I made #19902 for that.",
    "created_at": "2016-01-16T20:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286181",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Make already has `--question` to check whether dependencies are satisfied. We should just use that. Or, even easier, print that warning simply after `make B`. But piggy-backing it on sage-force-relocation isnt' really an option. 

In any case, I made #19902 for that.



---

archive/issue_comments_286182.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [vbraun](#comment%3A11):\n> Make already has `--question` to check whether dependencies are satisfied. We should just use that.\n\nThe problem with `make --question` is that the Sage library (i.e. Cython + distutils) does not support that. You can't do `./setup.py --question` to ask if Python dependencies are up-to-date.\n\n> Or, even easier, print that warning simply after `make B`.\n\nOK, please move this message to the end of `sage-spkg` then.",
    "created_at": "2016-01-17T08:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286182",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [vbraun](#comment%3A11):
> Make already has `--question` to check whether dependencies are satisfied. We should just use that.

The problem with `make --question` is that the Sage library (i.e. Cython + distutils) does not support that. You can't do `./setup.py --question` to ask if Python dependencies are up-to-date.

> Or, even easier, print that warning simply after `make B`.

OK, please move this message to the end of `sage-spkg` then.



---

archive/issue_comments_286183.json:
```json
{
    "body": "<a id='comment:13'></a>\nSee #19902",
    "created_at": "2016-01-17T09:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286183",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
See #19902



---

archive/issue_comments_286184.json:
```json
{
    "body": "**Changing commit** from \"[b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)\" to \"[50ba4fefe079d750b83138b80b157561a85f7240](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)\".",
    "created_at": "2016-01-17T13:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)" to "[50ba4fefe079d750b83138b80b157561a85f7240](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)".



---

archive/issue_comments_286185.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240\">50ba4fe</a></td><td><code>Add note at the end of sage-spkg</code></td></tr></table>\n",
    "created_at": "2016-01-17T13:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240">50ba4fe</a></td><td><code>Add note at the end of sage-spkg</code></td></tr></table>




---

archive/issue_comments_286186.json:
```json
{
    "body": "**Changing commit** from \"[50ba4fefe079d750b83138b80b157561a85f7240](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)\" to \"[b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)\".",
    "created_at": "2016-01-17T13:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[50ba4fefe079d750b83138b80b157561a85f7240](https://github.com/sagemath/sagetrac-mirror/commit/50ba4fefe079d750b83138b80b157561a85f7240)" to "[b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)".



---

archive/issue_comments_286187.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** New commits:",
    "created_at": "2016-01-17T13:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** New commits:



---

archive/issue_events_178213.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T10:03:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178213"
}
```



---

archive/issue_events_178214.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T10:03:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178214"
}
```



---

archive/issue_comments_286188.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis is a bit sloppy. Why keep all the functions `update_pkgconfig_files()`, `make_scripts_relative()`, `sage_relocate()` if they aren't used anymore? You might argue that they will still be called when running Sage *the first time*. However, they won't be called anymore when upgrading packages. So there is really no point in running them just once.\n\nEither you run them every time a package is installed (like it used to be) or you never run them.\n\nSecond, the `check_processor_flags()` function becomes pointless since it's only run on the machine which created the binary, not on the machine running the binary. But maybe we should consider `check_processor_flags()` obsolete and just remove it.",
    "created_at": "2016-01-18T10:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286188",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
This is a bit sloppy. Why keep all the functions `update_pkgconfig_files()`, `make_scripts_relative()`, `sage_relocate()` if they aren't used anymore? You might argue that they will still be called when running Sage *the first time*. However, they won't be called anymore when upgrading packages. So there is really no point in running them just once.

Either you run them every time a package is installed (like it used to be) or you never run them.

Second, the `check_processor_flags()` function becomes pointless since it's only run on the machine which created the binary, not on the machine running the binary. But maybe we should consider `check_processor_flags()` obsolete and just remove it.



---

archive/issue_comments_286189.json:
```json
{
    "body": "<a id='comment:17'></a>\nI suggest the following: apply just the part of this patch which adds an error message if the Sage installation was moved. Keep the old functionality, including the `sage-force-relocate.txt` file. Then make more serious changes to `sage-location` in Sage 7.1. That will have the least chances of breakage.",
    "created_at": "2016-01-18T10:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286189",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
I suggest the following: apply just the part of this patch which adds an error message if the Sage installation was moved. Keep the old functionality, including the `sage-force-relocate.txt` file. Then make more serious changes to `sage-location` in Sage 7.1. That will have the least chances of breakage.



---

archive/issue_events_178215.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:17:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178215"
}
```



---

archive/issue_events_178216.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:17:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178216"
}
```



---

archive/issue_comments_286190.json:
```json
{
    "body": "<a id='comment:18'></a>\nMaking script paths relative is still a plus IMHO for the binary build, so I would keep them. Of course thats a bit of a matter of taste. But I have no intention of engaging in a bikeshedding session here over what to do, either change it yourself or live with it.\n\nThis branch is tested and works, any alternative implementation is just going to have lower chances of working. I'm at the sage gap workshop this week so I don't have time to rewrite this for no good reason whatsoever.\n\nFeature requests for `check_processor_flags` should also go to a separate ticket.",
    "created_at": "2016-01-18T12:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286190",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
Making script paths relative is still a plus IMHO for the binary build, so I would keep them. Of course thats a bit of a matter of taste. But I have no intention of engaging in a bikeshedding session here over what to do, either change it yourself or live with it.

This branch is tested and works, any alternative implementation is just going to have lower chances of working. I'm at the sage gap workshop this week so I don't have time to rewrite this for no good reason whatsoever.

Feature requests for `check_processor_flags` should also go to a separate ticket.



---

archive/issue_comments_286191.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [vbraun](#comment%3A18):\n> But I have no intention of engaging in a bikeshedding session here over what to do\n\n\nNot every discussion/disagreement is \"bikeshedding\". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).\n\n> either change it yourself\n\n\nFine.",
    "created_at": "2016-01-18T12:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286191",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Replying to [vbraun](#comment%3A18):
> But I have no intention of engaging in a bikeshedding session here over what to do


Not every discussion/disagreement is "bikeshedding". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).

> either change it yourself


Fine.



---

archive/issue_comments_286192.json:
```json
{
    "body": "**Changing author** from \"Volker Braun\" to \"Volker Braun, Jeroen Demeyer\".",
    "created_at": "2016-01-18T12:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286192",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Volker Braun" to "Volker Braun, Jeroen Demeyer".



---

archive/issue_events_178217.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:34:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178217"
}
```



---

archive/issue_events_178218.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:34:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178218"
}
```



---

archive/issue_comments_286193.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Change the sage-location script to match how the new binary builds work\n+Raise an error if the Sage installation tree was relocated.\n``````\n",
    "created_at": "2016-01-18T12:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286193",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-Change the sage-location script to match how the new binary builds work
+Raise an error if the Sage installation tree was relocated.
``````




---

archive/issue_comments_286194.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jdemeyer](#comment%3A19):\n> Not every discussion/disagreement is \"bikeshedding\". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).\n\n\nThat is intentional, there is no relocation after re-installing packages so we shouldn't mislead people into believing anything else.",
    "created_at": "2016-01-18T12:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286194",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>
Replying to [jdemeyer](#comment%3A19):
> Not every discussion/disagreement is "bikeshedding". I pointed out actual problems out with your branch (that `sage-location` is not re-run after re-installing packages).


That is intentional, there is no relocation after re-installing packages so we shouldn't mislead people into believing anything else.



---

archive/issue_comments_286195.json:
```json
{
    "body": "**Changing branch** from \"[u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)\" to \"[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)\".",
    "created_at": "2016-01-18T12:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286195",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/vbraun/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/improve_location_change_error_message)" to "[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)".



---

archive/issue_comments_286196.json:
```json
{
    "body": "<a id='comment:23'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cea615d1046f0f9351ce4e20951b5e358fc049a\">3cea615</a></td><td><code>Improve location change error message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5\">cec4552</a></td><td><code>Raise an error if Sage has been relocated</code></td></tr></table>\n",
    "created_at": "2016-01-18T12:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286196",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cea615d1046f0f9351ce4e20951b5e358fc049a">3cea615</a></td><td><code>Improve location change error message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5">cec4552</a></td><td><code>Raise an error if Sage has been relocated</code></td></tr></table>




---

archive/issue_comments_286197.json:
```json
{
    "body": "**Changing commit** from \"[b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)\" to \"[cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)\".",
    "created_at": "2016-01-18T12:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286197",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[b46f637d271f256c8b085adc599d921e7ae11dcf](https://github.com/sagemath/sagetrac-mirror/commit/b46f637d271f256c8b085adc599d921e7ae11dcf)" to "[cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)".



---

archive/issue_events_178219.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:45:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178219"
}
```



---

archive/issue_events_178220.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-18T12:45:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178220"
}
```



---

archive/issue_comments_286198.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis implements [comment:17]: make a minimal patch for Sage 7.0 and deal with the deeper issues later on #19908.",
    "created_at": "2016-01-18T12:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286198",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
This implements [comment:17]: make a minimal patch for Sage 7.0 and deal with the deeper issues later on #19908.



---

archive/issue_events_178221.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:48:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178221"
}
```



---

archive/issue_events_178222.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:48:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178222"
}
```



---

archive/issue_comments_286199.json:
```json
{
    "body": "<a id='comment:25'></a>\nmuch worse but at least we don't have to hold the release process hostage any more with this pointless exercise",
    "created_at": "2016-01-18T12:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286199",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
much worse but at least we don't have to hold the release process hostage any more with this pointless exercise



---

archive/issue_comments_286200.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2016-01-18T12:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286200",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_286201.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)\" to \"[cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)\".",
    "created_at": "2016-01-18T12:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286201",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/improve_location_change_error_message](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_location_change_error_message)" to "[cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)".



---

archive/issue_events_178223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:49:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178223"
}
```



---

archive/issue_events_178224.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-18T12:49:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19843#event-178224"
}
```



---

archive/issue_comments_286202.json:
```json
{
    "body": "**Changing commit** from \"[cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)\" to \"\".",
    "created_at": "2016-01-18T12:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286202",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[cec455227151d9d3b59ee195b87ac957f5c1d8d5](https://github.com/sagemath/sagetrac-mirror/commit/cec455227151d9d3b59ee195b87ac957f5c1d8d5)" to "".



---

archive/issue_comments_286203.json:
```json
{
    "body": "<a id='comment:27'></a>\n> at least we don't have to hold the release process hostage\n\nIs that cynism really needed? Pointing out issues with a branch is not \"holding the release process hostage\".\n\nI think you are \"reverse bikeshedding\": you're destroying half of the nuclear reactor but pretending that you are only repainting the bikeshed.\n\nAt least my patch is much safer than yours, because it really only changes the color of the bikeshed.",
    "created_at": "2016-01-18T12:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286203",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
> at least we don't have to hold the release process hostage

Is that cynism really needed? Pointing out issues with a branch is not "holding the release process hostage".

I think you are "reverse bikeshedding": you're destroying half of the nuclear reactor but pretending that you are only repainting the bikeshed.

At least my patch is much safer than yours, because it really only changes the color of the bikeshed.



---

archive/issue_comments_286204.json:
```json
{
    "body": "<a id='comment:28'></a>\nIt still leaves lots of misleading messages about relocation that will be confusing to our users, which IMHO is terrible UX. But at least they eventually get a hard error even if it contradicts the signals before.",
    "created_at": "2016-01-18T13:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286204",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>
It still leaves lots of misleading messages about relocation that will be confusing to our users, which IMHO is terrible UX. But at least they eventually get a hard error even if it contradicts the signals before.



---

archive/issue_comments_286205.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [vbraun](#comment%3A28):\n> It still leaves lots of misleading messages about relocation\n\n\nI don't believe that the messages are so misleading. The most common is\n\n```\nForcing sage-location, probably because a new package was installed.\nUpdating various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\n```\nwhich is not really wrong.\n\nMore seriously, you are of course right that the messages can be improved. However, having a properly functioning Sage is a much higher priority than getting the messages right (which *is* a bikeshedding issue!)",
    "created_at": "2016-01-18T13:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286205",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [vbraun](#comment%3A28):
> It still leaves lots of misleading messages about relocation


I don't believe that the messages are so misleading. The most common is

```
Forcing sage-location, probably because a new package was installed.
Updating various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
```
which is not really wrong.

More seriously, you are of course right that the messages can be improved. However, having a properly functioning Sage is a much higher priority than getting the messages right (which *is* a bikeshedding issue!)



---

archive/issue_comments_286206.json:
```json
{
    "body": "<a id='comment:30'></a>\nHow is a user not going to interpret that as \"relocation is ok\", especially since it has been like that for the last years.",
    "created_at": "2016-01-18T13:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19843",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19843#issuecomment-286206",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'></a>
How is a user not going to interpret that as "relocation is ok", especially since it has been like that for the last years.
