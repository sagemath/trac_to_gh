# Issue 19444: sage.misc.functional.log(float(3)) raises an AttributeError

archive/issues_019207.json:
```json
{
    "body": "`import_statements` suggest to import `log` this way:\n\n```\nsage: import_statements('log')\n# **Warning**: distinct objects with name 'log' in:\n#   - sage.functions.log\n#   - math\n#   - sage.functions\n#   - sage.misc.functional\nfrom sage.misc.functional import log\n```\n\nWhile those works:\n\n```\nsage: math.log(float(3))\n1.0986122886681098\nsage: sage.functions.log.log(float(3))\n1.0986122886681098\n```\n\nThis one raises an `AttributeError`:\n\n```\nsage: sage.misc.functional.log(float(3))\nTraceback (most recent call last):\n...\nAttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute '_log_base'\n```\n\nA subquestion is why do we have two implementations of `log`?\n\nCC:  @tscrim @jdemeyer @jhpalmieri\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nBranch: d2f7962a6ee8a2e6e0b174083a44b4ed067b5785\n\nCommit: d2f7962a6ee8a2e6e0b174083a44b4ed067b5785\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19444\n\n",
    "closed_at": "2017-09-15T07:47:39Z",
    "created_at": "2015-10-21T08:07:02Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "sage.misc.functional.log(float(3)) raises an AttributeError",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19444",
    "user": "https://github.com/seblabbe"
}
```
`import_statements` suggest to import `log` this way:

```
sage: import_statements('log')
# **Warning**: distinct objects with name 'log' in:
#   - sage.functions.log
#   - math
#   - sage.functions
#   - sage.misc.functional
from sage.misc.functional import log
```

While those works:

```
sage: math.log(float(3))
1.0986122886681098
sage: sage.functions.log.log(float(3))
1.0986122886681098
```

This one raises an `AttributeError`:

```
sage: sage.misc.functional.log(float(3))
Traceback (most recent call last):
...
AttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute '_log_base'
```

A subquestion is why do we have two implementations of `log`?

CC:  @tscrim @jdemeyer @jhpalmieri

Reviewer: Sébastien Labbé

Author: Frédéric Chapoton

Branch: d2f7962a6ee8a2e6e0b174083a44b4ed067b5785

Commit: d2f7962a6ee8a2e6e0b174083a44b4ed067b5785

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19444





---

archive/issue_comments_263179.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-03T19:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263179",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_events_053682.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-03T19:59:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19444#event-53682"
}
```



---

archive/issue_comments_263180.json:
```json
{
    "body": "<a id='comment:1'></a>Done. This should be an easy review.\n\nNOTA BENE: Getting rid of this log function (in favor of the one in functions.log) should be done in another ticket. I tried to do that, but sutmbled on the infamous import hell (import cycles everywhere).\n\n---\nNew commits:",
    "created_at": "2017-09-03T19:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263180",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>Done. This should be an easy review.

NOTA BENE: Getting rid of this log function (in favor of the one in functions.log) should be done in another ticket. I tried to do that, but sutmbled on the infamous import hell (import cycles everywhere).

---
New commits:



---

archive/issue_comments_263181.json:
```json
{
    "body": "<a id='comment:2'></a>This implementation is very weak. How can you assume that this is supposed to be the real logarithm?\n\n```\nsage: sage.misc.functional.log(complex(3j))\nTraceback (most recent call last):\n...\nTypeError: can't convert complex to float\n```\nversus\n\n```\nsage: sage.misc.functional.log(CDF(0,3))\n1.0986122886681098 + 1.5707963267948966*I\n```",
    "created_at": "2017-09-03T21:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263181",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>This implementation is very weak. How can you assume that this is supposed to be the real logarithm?

```
sage: sage.misc.functional.log(complex(3j))
Traceback (most recent call last):
...
TypeError: can't convert complex to float
```
versus

```
sage: sage.misc.functional.log(CDF(0,3))
1.0986122886681098 + 1.5707963267948966*I
```



---

archive/issue_comments_263182.json:
```json
{
    "body": "<a id='comment:3'></a>There is no need to make another perfect log, there is one already in functions.log, which is the one we provide as \"log\" in the global namespace. We should fix the issue raised here. And later get rid of this function, which is only used 10 times or so.",
    "created_at": "2017-09-04T05:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263182",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>There is no need to make another perfect log, there is one already in functions.log, which is the one we provide as "log" in the global namespace. We should fix the issue raised here. And later get rid of this function, which is only used 10 times or so.



---

archive/issue_comments_263183.json:
```json
{
    "body": "<a id='comment:4'></a>What is the point of fixing an issue on a useless function? If I open a ticket for the complex case will you fix it ;-? If useless, the log from functional would better be deprecated and this ticket closed as invalid.\n\nAnyway, the complaint is about `import_statements` that is not fixed by your branch.",
    "created_at": "2017-09-04T06:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263183",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>What is the point of fixing an issue on a useless function? If I open a ticket for the complex case will you fix it ;-? If useless, the log from functional would better be deprecated and this ticket closed as invalid.

Anyway, the complaint is about `import_statements` that is not fixed by your branch.



---

archive/issue_comments_263184.json:
```json
{
    "body": "<a id='comment:5'></a>And indeed, there is something wrong with `find_objects_from_name`\n\n```\nsage: \nsage: from sage.misc.dev_tools import find_objects_from_name\nsage: find_objects_from_name('log')\n[<function log at ...>,\n <function log at ...>,\n log,\n <built-in function log>,\n <module 'sage.functions.log' from '/opt/sage/local/lib/python2.7/site-packages/sage/functions/log.pyc'>]\n```\nThe above is wrong since `log` is in the global namespace and the answer should have been the log from the global namespace...",
    "created_at": "2017-09-04T06:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263184",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>And indeed, there is something wrong with `find_objects_from_name`

```
sage: 
sage: from sage.misc.dev_tools import find_objects_from_name
sage: find_objects_from_name('log')
[<function log at ...>,
 <function log at ...>,
 log,
 <built-in function log>,
 <module 'sage.functions.log' from '/opt/sage/local/lib/python2.7/site-packages/sage/functions/log.pyc'>]
```
The above is wrong since `log` is in the global namespace and the answer should have been the log from the global namespace...



---

archive/issue_comments_263185.json:
```json
{
    "body": "<a id='comment:6'></a>And indeed, `globals()` is restricted to the module where the function is defined... so that its usage is wrong.",
    "created_at": "2017-09-04T06:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263185",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>And indeed, `globals()` is restricted to the module where the function is defined... so that its usage is wrong.



---

archive/issue_comments_263186.json:
```json
{
    "body": "<a id='comment:7'></a>See #23779 for the fix to `import_statements`",
    "created_at": "2017-09-04T06:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263186",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>See #23779 for the fix to `import_statements`



---

archive/issue_comments_263187.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-09-04T07:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_263188.json:
```json
{
    "body": "<a id='comment:9'></a>ok, done",
    "created_at": "2017-09-04T07:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263188",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>ok, done



---

archive/issue_comments_263189.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-04T11:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263190.json:
```json
{
    "body": "<a id='comment:11'></a>If it turns out that for some reason I have used the bad log function in my code and I now get the following error message:\n\n```\nDeprecationWarning: this version of log is no longer used\n```\nI will not understand and I will lose time to understand what is happening.\n\nI much prefer\n\n```\nDeprecationWarning: function sage.misc.functional.log is deprecated, use sage.functions.log or log from the global sage namespace instead\n```",
    "created_at": "2017-09-04T12:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263190",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:11'></a>If it turns out that for some reason I have used the bad log function in my code and I now get the following error message:

```
DeprecationWarning: this version of log is no longer used
```
I will not understand and I will lose time to understand what is happening.

I much prefer

```
DeprecationWarning: function sage.misc.functional.log is deprecated, use sage.functions.log or log from the global sage namespace instead
```



---

archive/issue_comments_263191.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-04T12:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263191",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263192.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-04T12:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263193.json:
```json
{
    "body": "<a id='comment:13'></a>Done",
    "created_at": "2017-09-04T12:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263193",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>Done



---

archive/issue_comments_263194.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-04T12:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263194",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263195.json:
```json
{
    "body": "<a id='comment:14'></a>This is wrong:\n\n```diff\n-        k = int(ceil(log(n,2)))\n+        k = int(ceil(RDF(n).log(2)))\n```\nDo not use floating-point computations when you want an exact answer.\n\nAn exception to this would be MPFR (used in Sage by `RR`) because that does give a guarantee of exactness if possible.\n\nSo, you should either use `ZZ` or `RR` to do this computation.",
    "created_at": "2017-09-04T12:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263195",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>This is wrong:

```diff
-        k = int(ceil(log(n,2)))
+        k = int(ceil(RDF(n).log(2)))
```
Do not use floating-point computations when you want an exact answer.

An exception to this would be MPFR (used in Sage by `RR`) because that does give a guarantee of exactness if possible.

So, you should either use `ZZ` or `RR` to do this computation.



---

archive/issue_comments_263196.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-04T12:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263196",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263197.json:
```json
{
    "body": "<a id='comment:16'></a>I would replace `ceil(log(n,2))` by `(ZZ(n) - 1).nbits()` which is guaranteed to be correct and reasonably fast.",
    "created_at": "2017-09-04T12:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263197",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>I would replace `ceil(log(n,2))` by `(ZZ(n) - 1).nbits()` which is guaranteed to be correct and reasonably fast.



---

archive/issue_comments_263198.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-04T18:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263199.json:
```json
{
    "body": "<a id='comment:18'></a>ok ; but now there remains an RDF in \"src/sage/rings/finite_rings/element_ntl_gf2e.pyx\"",
    "created_at": "2017-09-04T20:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263199",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>ok ; but now there remains an RDF in "src/sage/rings/finite_rings/element_ntl_gf2e.pyx"



---

archive/issue_comments_263200.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-06T11:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263201.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-06T11:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263201",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263202.json:
```json
{
    "body": "<a id='comment:20'></a>should be good now",
    "created_at": "2017-09-06T11:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263202",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>should be good now



---

archive/issue_comments_263203.json:
```json
{
    "body": "<a id='comment:21'></a>In the light of `__future__ division`, it is better to use `// 8` instead of `/ 8`.",
    "created_at": "2017-09-06T11:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263203",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>In the light of `__future__ division`, it is better to use `// 8` instead of `/ 8`.



---

archive/issue_comments_263204.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-06T14:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263205.json:
```json
{
    "body": "<a id='comment:23'></a>done",
    "created_at": "2017-09-06T14:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263205",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>done



---

archive/issue_comments_263206.json:
```json
{
    "body": "<a id='comment:24'></a>bot is morally green",
    "created_at": "2017-09-06T16:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263206",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>bot is morally green



---

archive/issue_comments_263207.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-11T13:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263207",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_053683.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-15T07:47:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19444#event-53683"
}
```



---

archive/issue_comments_263208.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-15T07:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19444#issuecomment-263208",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
