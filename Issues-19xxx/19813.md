# Issue 19813: Sequence_generic needs to guard __iadd__, __imul__, __delitem__ if "immutable".

archive/issues_019576.json:
```json
{
    "assignees": [],
    "body": "I don't even:\n\n```\nsage: b = VectorSpace(QQ,3).basis()\nsage: b += [\"Hello, world!\"]\nsage: VectorSpace(QQ,3).basis()\n[\n(1, 0, 0),\n(0, 1, 0),\n(0, 0, 1),\n'Hello, world!'\n]\n```\n\nSee also #19251.\n\n**CC:**  @mjungmath @tscrim\n\n**Branch:** [u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__)\n\n**Commit:** [18bb870e917766d241121d88d137c720c216e7cf](https://github.com/sagemath/sagetrac-mirror/commit/18bb870e917766d241121d88d137c720c216e7cf)\n\n**Author:** Matthias Koeppe, ...\n\nIssue created by migration from https://trac.sagemath.org/ticket/19813\n\n",
    "created_at": "2015-12-31T02:05:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Sequence_generic needs to guard __iadd__, __imul__, __delitem__ if \"immutable\".",
    "type": "issue",
    "updated_at": "2022-08-31T02:51:13Z",
    "url": "https://github.com/sagemath/sage/issues/19813",
    "user": "https://github.com/orlitzky"
}
```
I don't even:

```
sage: b = VectorSpace(QQ,3).basis()
sage: b += ["Hello, world!"]
sage: VectorSpace(QQ,3).basis()
[
(1, 0, 0),
(0, 1, 0),
(0, 0, 1),
'Hello, world!'
]
```

See also #19251.

**CC:**  @mjungmath @tscrim

**Branch:** [u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__)

**Commit:** [18bb870e917766d241121d88d137c720c216e7cf](https://github.com/sagemath/sagetrac-mirror/commit/18bb870e917766d241121d88d137c720c216e7cf)

**Author:** Matthias Koeppe, ...

Issue created by migration from https://trac.sagemath.org/ticket/19813





---

archive/issue_events_241794.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2015-12-31T02:05:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241794"
}
```



---

archive/issue_events_241795.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2015-12-31T02:05:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "08517b",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241795"
}
```



---

archive/issue_events_241796.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2015-12-31T02:05:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241796"
}
```



---

archive/issue_comments_285604.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nIt makes sense to me that a vector basis should be mutable. For example, what if you wanted to normalize the basis, order it or replace a basis vector? The resulting contents of the instance could still be a valid basis. There could also be some abstract vector spaces whose basis vectors make sense as strings.",
    "created_at": "2015-12-31T02:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285604",
    "user": "https://github.com/sagetrac-DayneSorvisto"
}
```

<a id='comment:1'>**Comment 1:**</a>
It makes sense to me that a vector basis should be mutable. For example, what if you wanted to normalize the basis, order it or replace a basis vector? The resulting contents of the instance could still be a valid basis. There could also be some abstract vector spaces whose basis vectors make sense as strings.



---

archive/issue_comments_285605.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nNo, this is indeed quite a bad bug, since VectorSpaces are UniqueRepresentation:\n\n```\nsage: V=VectorSpace(QQ,3)\nsage: W=VectorSpace(QQ,3)\nsage: b=V.basis()\nsage: b+=\"a\"\nsage: len(W.basis())\n4\n```\nNote that V and W are (to the user) obtained independently, so a change on one should not affect the other.\n\nAlso note that some effort is undertaken to make the thing immutable:\n\n```\nsage: b.append(\"a\")\nValueError: object is immutable; please change a copy instead.\nsage: type(b)\n<class 'sage.structure.sequence.Sequence_generic'>\nsage: b.is_mutable()\nFalse\nsage: type(b).__iadd__\n<slot wrapper '__iadd__' of 'list' objects>\n```\nSo it seems we just failed to shadow the \"__iadd__\" method.",
    "created_at": "2015-12-31T02:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285605",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'>**Comment 2:**</a>
No, this is indeed quite a bad bug, since VectorSpaces are UniqueRepresentation:

```
sage: V=VectorSpace(QQ,3)
sage: W=VectorSpace(QQ,3)
sage: b=V.basis()
sage: b+="a"
sage: len(W.basis())
4
```
Note that V and W are (to the user) obtained independently, so a change on one should not affect the other.

Also note that some effort is undertaken to make the thing immutable:

```
sage: b.append("a")
ValueError: object is immutable; please change a copy instead.
sage: type(b)
<class 'sage.structure.sequence.Sequence_generic'>
sage: b.is_mutable()
False
sage: type(b).__iadd__
<slot wrapper '__iadd__' of 'list' objects>
```
So it seems we just failed to shadow the "__iadd__" method.



---

archive/issue_comments_285606.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nIntrospection seems to indicate:\n`__iadd__`, `__imul__`,`__delitem__`,`__delslice__` should be intercepted.\nGleaned from:\n\n```\nsage: T=sage.structure.sequence.Sequence_generic\nsage: [m for m in dir(T) if str(getattr(T,m)).find(\"list\") >=0]\n```",
    "created_at": "2015-12-31T07:28:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285606",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'>**Comment 3:**</a>
Introspection seems to indicate:
`__iadd__`, `__imul__`,`__delitem__`,`__delslice__` should be intercepted.
Gleaned from:

```
sage: T=sage.structure.sequence.Sequence_generic
sage: [m for m in dir(T) if str(getattr(T,m)).find("list") >=0]
```



---

archive/issue_events_241797.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-12-31T07:28:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "rename": {
        "from": "VectorSpace basis() is mutable",
        "to": "Sequence_generic needs to guard iadd, imul, delitem, delslice if \"immutable\"."
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241797"
}
```



---

archive/issue_comments_285607.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nLooks like all Sage objects which define a '+' and can be immutable are failing. I tried matrices and graphs, and both have it.\n\nNathann",
    "created_at": "2015-12-31T09:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285607",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'>**Comment 4:**</a>
Looks like all Sage objects which define a '+' and can be immutable are failing. I tried matrices and graphs, and both have it.

Nathann



---

archive/issue_events_241798.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T04:08:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241798"
}
```



---

archive/issue_events_241799.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T04:08:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241799"
}
```



---

archive/issue_comments_285608.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__)",
    "created_at": "2021-09-01T05:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285608",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sequence_generic_needs_to_guard_iadd__imul__delitem__delslice_if__immutable__)



---

archive/issue_comments_285609.json:
```json
{
    "body": "**Commit:** [4fce73d2355af3c7499bf6577c3c8b54df992bc9](https://github.com/sagemath/sagetrac-mirror/commit/4fce73d2355af3c7499bf6577c3c8b54df992bc9)",
    "created_at": "2021-09-01T05:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285609",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [4fce73d2355af3c7499bf6577c3c8b54df992bc9](https://github.com/sagemath/sagetrac-mirror/commit/4fce73d2355af3c7499bf6577c3c8b54df992bc9)



---

archive/issue_comments_285610.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fce73d2355af3c7499bf6577c3c8b54df992bc9\">4fce73d</a></td><td><code>Sequence_generic.__imul__: New</code></td></tr></table>\n",
    "created_at": "2021-09-01T05:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285610",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>**Comment 7:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fce73d2355af3c7499bf6577c3c8b54df992bc9">4fce73d</a></td><td><code>Sequence_generic.__imul__: New</code></td></tr></table>




---

archive/issue_comments_285611.json:
```json
{
    "body": "**Changing commit** from \"[4fce73d2355af3c7499bf6577c3c8b54df992bc9](https://github.com/sagemath/sagetrac-mirror/commit/4fce73d2355af3c7499bf6577c3c8b54df992bc9)\" to \"[d3bf0ac8baa69422f7d4fa1747ba2505adfc0487](https://github.com/sagemath/sagetrac-mirror/commit/d3bf0ac8baa69422f7d4fa1747ba2505adfc0487)\".",
    "created_at": "2021-09-01T05:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285611",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4fce73d2355af3c7499bf6577c3c8b54df992bc9](https://github.com/sagemath/sagetrac-mirror/commit/4fce73d2355af3c7499bf6577c3c8b54df992bc9)" to "[d3bf0ac8baa69422f7d4fa1747ba2505adfc0487](https://github.com/sagemath/sagetrac-mirror/commit/d3bf0ac8baa69422f7d4fa1747ba2505adfc0487)".



---

archive/issue_comments_285612.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3bf0ac8baa69422f7d4fa1747ba2505adfc0487\">d3bf0ac</a></td><td><code>Sequence_generic.__delitem__: New</code></td></tr></table>\n",
    "created_at": "2021-09-01T05:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285612",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3bf0ac8baa69422f7d4fa1747ba2505adfc0487">d3bf0ac</a></td><td><code>Sequence_generic.__delitem__: New</code></td></tr></table>




---

archive/issue_comments_285613.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nReplying to [@nbruin](#comment%3A3):\n> Introspection seems to indicate:\n> `__iadd__`, `__imul__`,`__delitem__`,`__delslice__` should be intercepted.\n\nDone (except for `__delslice__`, which does not exist any more in Python 3).",
    "created_at": "2021-09-01T05:19:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285613",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>**Comment 9:**</a>
Replying to [@nbruin](#comment%3A3):
> Introspection seems to indicate:
> `__iadd__`, `__imul__`,`__delitem__`,`__delslice__` should be intercepted.

Done (except for `__delslice__`, which does not exist any more in Python 3).



---

archive/issue_events_241800.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T05:19:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241800"
}
```



---

archive/issue_comments_285614.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-09-01T05:19:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285614",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_events_241801.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T05:19:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "rename": {
        "from": "Sequence_generic needs to guard iadd, imul, delitem, delslice if \"immutable\".",
        "to": "Sequence_generic needs to guard __iadd__, __imul__, __delitem__ if \"immutable\"."
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241801"
}
```



---

archive/issue_comments_285615.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nNote that Python's semantics for `A += B` are very close to `A = A + B`. The default is really that it is the latter (and NOT that `A += B` is an error). Some mutable types change the meaning to mutating behaviour instead of binding to a fresh object. Consider this:\n\n```\nsage: t1 = (1,2,3)\nsage: t2 = t1\nsage: t2 += (4,5,6) #this binds t2 to a new tuple\nsage: t1\n(1, 2, 3)\nsage: t2\n(1, 2, 3, 4, 5, 6)\nsage: l1 = [1,2,3]\nsage: l2 = l1\nsage: l2 += [4,5,6] #this mutates the list that l2 is bound to.\nsage: l1\n[1, 2, 3, 4, 5, 6]\nsage: l2\n[1, 2, 3, 4, 5, 6]\n```",
    "created_at": "2021-09-01T06:56:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285615",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:11'>**Comment 11:**</a>
Note that Python's semantics for `A += B` are very close to `A = A + B`. The default is really that it is the latter (and NOT that `A += B` is an error). Some mutable types change the meaning to mutating behaviour instead of binding to a fresh object. Consider this:

```
sage: t1 = (1,2,3)
sage: t2 = t1
sage: t2 += (4,5,6) #this binds t2 to a new tuple
sage: t1
(1, 2, 3)
sage: t2
(1, 2, 3, 4, 5, 6)
sage: l1 = [1,2,3]
sage: l2 = l1
sage: l2 += [4,5,6] #this mutates the list that l2 is bound to.
sage: l1
[1, 2, 3, 4, 5, 6]
sage: l2
[1, 2, 3, 4, 5, 6]
```



---

archive/issue_comments_285616.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nReplying to [@nbruin](#comment%3A11):\n> Note that Python's semantics for `A += B` are very close to `A = A + B`. The default is really that it is the latter (and NOT that `A += B` is an error). Some mutable types change the meaning to mutating behaviour instead of binding to a fresh object.\n\nSpecifically, in this case, the python docs (https://docs.python.org/3/library/operator.html) say that `x += y` is equivalent to `x = operator.iadd(x, y)`, and `Sequence_generic` is a subclass of `list`, which implements the in-place `iadd` via mutation.\n\nI guess we should fix the default value of `immutable` too, one way or the other:\n\n```python\nclass Sequence_generic(sage.structure.sage_object.SageObject, list):\n    \"\"\"\n    ...\n        - ``immutable`` - (default: True) whether or not this sequence is           \n          immutable\n    ...\n    \"\"\"\n    def __init__(self, x, universe=None, check=True, immutable=False,\n                 cr=False, cr_str=None, use_sage_types=False):\n```",
    "created_at": "2021-09-01T12:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285616",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'>**Comment 12:**</a>
Replying to [@nbruin](#comment%3A11):
> Note that Python's semantics for `A += B` are very close to `A = A + B`. The default is really that it is the latter (and NOT that `A += B` is an error). Some mutable types change the meaning to mutating behaviour instead of binding to a fresh object.

Specifically, in this case, the python docs (https://docs.python.org/3/library/operator.html) say that `x += y` is equivalent to `x = operator.iadd(x, y)`, and `Sequence_generic` is a subclass of `list`, which implements the in-place `iadd` via mutation.

I guess we should fix the default value of `immutable` too, one way or the other:

```python
class Sequence_generic(sage.structure.sage_object.SageObject, list):
    """
    ...
        - ``immutable`` - (default: True) whether or not this sequence is           
          immutable
    ...
    """
    def __init__(self, x, universe=None, check=True, immutable=False,
                 cr=False, cr_str=None, use_sage_types=False):
```



---

archive/issue_events_241802.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T18:26:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241802"
}
```



---

archive/issue_events_241803.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T18:26:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241803"
}
```



---

archive/issue_comments_285617.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ccc2776307346f45cd9e14eee913e0530f1527a\">9ccc277</a></td><td><code>Sequence_generic.__iadd__, __imul__: If immutable, just delegate to __add__/__mul__</code></td></tr></table>\n",
    "created_at": "2021-09-01T18:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285617",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>**Comment 14:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ccc2776307346f45cd9e14eee913e0530f1527a">9ccc277</a></td><td><code>Sequence_generic.__iadd__, __imul__: If immutable, just delegate to __add__/__mul__</code></td></tr></table>




---

archive/issue_comments_285618.json:
```json
{
    "body": "**Changing commit** from \"[d3bf0ac8baa69422f7d4fa1747ba2505adfc0487](https://github.com/sagemath/sagetrac-mirror/commit/d3bf0ac8baa69422f7d4fa1747ba2505adfc0487)\" to \"[9ccc2776307346f45cd9e14eee913e0530f1527a](https://github.com/sagemath/sagetrac-mirror/commit/9ccc2776307346f45cd9e14eee913e0530f1527a)\".",
    "created_at": "2021-09-01T18:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285618",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[d3bf0ac8baa69422f7d4fa1747ba2505adfc0487](https://github.com/sagemath/sagetrac-mirror/commit/d3bf0ac8baa69422f7d4fa1747ba2505adfc0487)" to "[9ccc2776307346f45cd9e14eee913e0530f1527a](https://github.com/sagemath/sagetrac-mirror/commit/9ccc2776307346f45cd9e14eee913e0530f1527a)".



---

archive/issue_comments_285619.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/607c31668853b478d858a548167cdbe46fac8074\">607c316</a></td><td><code>Sequence: Update doc of init arguments to match implementation</code></td></tr></table>\n",
    "created_at": "2021-09-01T18:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285619",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>**Comment 15:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/607c31668853b478d858a548167cdbe46fac8074">607c316</a></td><td><code>Sequence: Update doc of init arguments to match implementation</code></td></tr></table>




---

archive/issue_comments_285620.json:
```json
{
    "body": "**Changing commit** from \"[9ccc2776307346f45cd9e14eee913e0530f1527a](https://github.com/sagemath/sagetrac-mirror/commit/9ccc2776307346f45cd9e14eee913e0530f1527a)\" to \"[607c31668853b478d858a548167cdbe46fac8074](https://github.com/sagemath/sagetrac-mirror/commit/607c31668853b478d858a548167cdbe46fac8074)\".",
    "created_at": "2021-09-01T18:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285620",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[9ccc2776307346f45cd9e14eee913e0530f1527a](https://github.com/sagemath/sagetrac-mirror/commit/9ccc2776307346f45cd9e14eee913e0530f1527a)" to "[607c31668853b478d858a548167cdbe46fac8074](https://github.com/sagemath/sagetrac-mirror/commit/607c31668853b478d858a548167cdbe46fac8074)".



---

archive/issue_comments_285621.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nThanks for the comments! Here's a better version",
    "created_at": "2021-09-01T18:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285621",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>**Comment 16:**</a>
Thanks for the comments! Here's a better version



---

archive/issue_events_241804.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T18:36:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241804"
}
```



---

archive/issue_events_241805.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T18:36:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241805"
}
```



---

archive/issue_comments_285622.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nThe following sentence (with some fuzz) appears three times in `sequence.py`: \"A mutable sequence of elements with a common guaranteed category, which can be set immutable.\" The universe is not what can be set immutable, though; it's the sequence. I would suggest something like \"An (optionally mutable) sequence of elements with a common parent universe.\"",
    "created_at": "2021-09-01T22:55:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285622",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'>**Comment 17:**</a>
The following sentence (with some fuzz) appears three times in `sequence.py`: "A mutable sequence of elements with a common guaranteed category, which can be set immutable." The universe is not what can be set immutable, though; it's the sequence. I would suggest something like "An (optionally mutable) sequence of elements with a common parent universe."



---

archive/issue_comments_285623.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nThe delegation behavior of `iadd` and `imul` is reasonable, but I think the docs should mention that they'll give you back a copy when `immutable=True`.\n\nBut before we address **that**... there's actually another bug that the description highlights: should these methods always return another sequence? And when they do, what should its universe be? The immutable behavior now returns a list, which I personally would not expect:\n\n```python\nsage: s = Sequence([1,2], immutable=True)                                                                                                                                    \nsage: s += [3]                                                                                                                                                               \nsage: type(s)                                                                                                                                                                \n<class 'list'>\n```\n\nThe mutable behavior, on the other hand, can invalidate the universe:\n\n```python\nsage: s = Sequence([ZZ(1),ZZ(2)])                                                                                                                                            \nsage: s.universe()                                                                                                                                                           \nInteger Ring\nsage: s += [x]                                                                                                                                                               \nsage: s                                                                                                                                                                      \n[1, 2, x]\nsage: s.universe()                                                                                                                                                           \nInteger Ring\n```\n\nWe should probably think about that before worrying about the wording of the docs.",
    "created_at": "2021-09-01T22:56:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285623",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'>**Comment 18:**</a>
The delegation behavior of `iadd` and `imul` is reasonable, but I think the docs should mention that they'll give you back a copy when `immutable=True`.

But before we address **that**... there's actually another bug that the description highlights: should these methods always return another sequence? And when they do, what should its universe be? The immutable behavior now returns a list, which I personally would not expect:

```python
sage: s = Sequence([1,2], immutable=True)                                                                                                                                    
sage: s += [3]                                                                                                                                                               
sage: type(s)                                                                                                                                                                
<class 'list'>
```

The mutable behavior, on the other hand, can invalidate the universe:

```python
sage: s = Sequence([ZZ(1),ZZ(2)])                                                                                                                                            
sage: s.universe()                                                                                                                                                           
Integer Ring
sage: s += [x]                                                                                                                                                               
sage: s                                                                                                                                                                      
[1, 2, x]
sage: s.universe()                                                                                                                                                           
Integer Ring
```

We should probably think about that before worrying about the wording of the docs.



---

archive/issue_events_241806.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T23:43:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241806"
}
```



---

archive/issue_events_241807.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-01T23:43:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241807"
}
```



---

archive/issue_comments_285624.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nRight, and also the following does not even work:\n\n```\nsage: M = Sequence([1, 2, 3], immutable=False) \nsage: M * 2\nTypeError: unbound method SageObject.category() needs an argument\n```",
    "created_at": "2021-09-02T19:13:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285624",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>**Comment 20:**</a>
Right, and also the following does not even work:

```
sage: M = Sequence([1, 2, 3], immutable=False) 
sage: M * 2
TypeError: unbound method SageObject.category() needs an argument
```



---

archive/issue_comments_285625.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95334bb29be9901435e89e9df9273dfa13b9b1dc\">95334bb</a></td><td><code>Sequence_generic.__add__/__iadd__: Always create a new immutable / mutable sequence</code></td></tr></table>\n",
    "created_at": "2021-09-03T22:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285625",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>**Comment 21:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95334bb29be9901435e89e9df9273dfa13b9b1dc">95334bb</a></td><td><code>Sequence_generic.__add__/__iadd__: Always create a new immutable / mutable sequence</code></td></tr></table>




---

archive/issue_comments_285626.json:
```json
{
    "body": "**Changing commit** from \"[607c31668853b478d858a548167cdbe46fac8074](https://github.com/sagemath/sagetrac-mirror/commit/607c31668853b478d858a548167cdbe46fac8074)\" to \"[95334bb29be9901435e89e9df9273dfa13b9b1dc](https://github.com/sagemath/sagetrac-mirror/commit/95334bb29be9901435e89e9df9273dfa13b9b1dc)\".",
    "created_at": "2021-09-03T22:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285626",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[607c31668853b478d858a548167cdbe46fac8074](https://github.com/sagemath/sagetrac-mirror/commit/607c31668853b478d858a548167cdbe46fac8074)" to "[95334bb29be9901435e89e9df9273dfa13b9b1dc](https://github.com/sagemath/sagetrac-mirror/commit/95334bb29be9901435e89e9df9273dfa13b9b1dc)".



---

archive/issue_comments_285627.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nHere's another iteration for `__add__`, `__iadd__`...",
    "created_at": "2021-09-03T22:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285627",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>**Comment 22:**</a>
Here's another iteration for `__add__`, `__iadd__`...



---

archive/issue_comments_285628.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nReplying to [@mkoeppe](#comment%3A22):\n> Here's another iteration for `__add__`, `__iadd__`...\n\nLooks good. Is `list.add(self,other)` any faster than `list(self) + list(other)`?\n\nSomething similar for multiplication would work. Finally, we should document that adding sequences will choose a new \"universe\" that encompasses both arguments, while multiplication will reuse the existing universe.",
    "created_at": "2021-09-04T13:22:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285628",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:23'>**Comment 23:**</a>
Replying to [@mkoeppe](#comment%3A22):
> Here's another iteration for `__add__`, `__iadd__`...

Looks good. Is `list.add(self,other)` any faster than `list(self) + list(other)`?

Something similar for multiplication would work. Finally, we should document that adding sequences will choose a new "universe" that encompasses both arguments, while multiplication will reuse the existing universe.



---

archive/issue_comments_285629.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nReplying to [@orlitzky](#comment%3A23):\n\n> Something similar for multiplication would work. Finally, we should document that adding sequences will choose a new \"universe\" that encompasses both arguments,\n\nWe should probably specify how that common parent is constructed. I suspect it should be whatever `coercion_maps(universe(seq1), universe(seq2))` comes up with. For one thing, it should not be driven by the parents of the elements (think of joining sequences of length 0).\n\nIt looks like the present version just rederives the universe from the concatenation of lists of elements. That's not what we need. Instead, we need something like:\n\n```\nL = Sequence([1/2,2,3])                                                     \nM = Sequence([x,1])                                                         \nu,v = coercion_model.coercion_maps(L.universe(),M.universe())               \nimport itertools                                                          \nLplusM = Sequence(itertools.chain(map(u,L),map(v,M)),universe=u.codomain(),check=False)                          \n```\n(A reasonable defensive programming step might be to leave check True). The sole reason for existence of Sequences is that their universe manipulations can be derived from explicit information, rather than derive it from elements. The feature that Sequence allows the universe to be not specified explicitly is only for user convenience. Any systematic use should specify the universe explicitly. That will be much faster too, because the coercion framework doesn't have to scan through individual elements.",
    "created_at": "2021-09-04T15:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285629",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:24'>**Comment 24:**</a>
Replying to [@orlitzky](#comment%3A23):

> Something similar for multiplication would work. Finally, we should document that adding sequences will choose a new "universe" that encompasses both arguments,

We should probably specify how that common parent is constructed. I suspect it should be whatever `coercion_maps(universe(seq1), universe(seq2))` comes up with. For one thing, it should not be driven by the parents of the elements (think of joining sequences of length 0).

It looks like the present version just rederives the universe from the concatenation of lists of elements. That's not what we need. Instead, we need something like:

```
L = Sequence([1/2,2,3])                                                     
M = Sequence([x,1])                                                         
u,v = coercion_model.coercion_maps(L.universe(),M.universe())               
import itertools                                                          
LplusM = Sequence(itertools.chain(map(u,L),map(v,M)),universe=u.codomain(),check=False)                          
```
(A reasonable defensive programming step might be to leave check True). The sole reason for existence of Sequences is that their universe manipulations can be derived from explicit information, rather than derive it from elements. The feature that Sequence allows the universe to be not specified explicitly is only for user convenience. Any systematic use should specify the universe explicitly. That will be much faster too, because the coercion framework doesn't have to scan through individual elements.



---

archive/issue_comments_285630.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nReplying to [@orlitzky](#comment%3A23):\n> Is `list.add(self,other)` any faster than `list(self) + list(other)`?\n\nThere is no such method",
    "created_at": "2021-09-04T17:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285630",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'>**Comment 25:**</a>
Replying to [@orlitzky](#comment%3A23):
> Is `list.add(self,other)` any faster than `list(self) + list(other)`?

There is no such method



---

archive/issue_comments_285631.json:
```json
{
    "body": "**Changing commit** from \"[95334bb29be9901435e89e9df9273dfa13b9b1dc](https://github.com/sagemath/sagetrac-mirror/commit/95334bb29be9901435e89e9df9273dfa13b9b1dc)\" to \"[bb2407eec59af33bc1dc85e4e0865d896603fa44](https://github.com/sagemath/sagetrac-mirror/commit/bb2407eec59af33bc1dc85e4e0865d896603fa44)\".",
    "created_at": "2021-09-04T18:00:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285631",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[95334bb29be9901435e89e9df9273dfa13b9b1dc](https://github.com/sagemath/sagetrac-mirror/commit/95334bb29be9901435e89e9df9273dfa13b9b1dc)" to "[bb2407eec59af33bc1dc85e4e0865d896603fa44](https://github.com/sagemath/sagetrac-mirror/commit/bb2407eec59af33bc1dc85e4e0865d896603fa44)".



---

archive/issue_comments_285632.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb2407eec59af33bc1dc85e4e0865d896603fa44\">bb2407e</a></td><td><code>Sequence_generic: Remove python2-specific special methods</code></td></tr></table>\n",
    "created_at": "2021-09-04T18:00:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285632",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>**Comment 26:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb2407eec59af33bc1dc85e4e0865d896603fa44">bb2407e</a></td><td><code>Sequence_generic: Remove python2-specific special methods</code></td></tr></table>




---

archive/issue_comments_285633.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nThe `Sequence` constructor uses `sage.structure.element.canonical_coercion` on adjacent elements from left to right.\n\nIt could probably be simplified using `coercion_model.common_parent`, but the constructor's parameter `use_sage_types=False` and fallbacks for non-coercible inputs are a complication",
    "created_at": "2021-09-04T18:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285633",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'>**Comment 27:**</a>
The `Sequence` constructor uses `sage.structure.element.canonical_coercion` on adjacent elements from left to right.

It could probably be simplified using `coercion_model.common_parent`, but the constructor's parameter `use_sage_types=False` and fallbacks for non-coercible inputs are a complication



---

archive/issue_comments_285634.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nReplying to [@mkoeppe](#comment%3A27):\n> The `Sequence` constructor uses `sage.structure.element.canonical_coercion` on adjacent elements from left to right.\n\nYes, it does that *if no universe is specified*. However, if a universe is specified, then it just coerces the elements into the universe specified. There is no \"common parent discovery\" necessary in that case anymore.\n\nI maintain that operations on sequences should *not* look at individual elements (since a sequence of length 0 does not have any), but derive the universe from the universes of the input sequences.\n\nIn particular, I think it's fine to have:\n\n```\nSequence(list1) + Sequence(list2) != Sequence(list1+list2)\n```\n(although I'm pretty sure it will actually hold anyway in most/all reasonable cases)\n\n> It could probably be simplified using `coercion_model.common_parent`, but the constructor's parameter `use_sage_types=False` and fallbacks for non-coercible inputs are a complication\n\nYou should be able to tell those cases from the universes of the inputs. Perhaps if one of the input universes does not play nice with `coercion_maps`, other fallbacks are necessary (and perhaps just generate an error that no common parent can be found).\n\nGiven that previously these operations just generated a list (clearly not desirable), I don't think you need to be worried about backwards compatibility. So better start out with restrictive, well-defined behaviour. It'll become more relaxed and messy by incremental patching afterwards anyway.",
    "created_at": "2021-09-04T18:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285634",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:28'>**Comment 28:**</a>
Replying to [@mkoeppe](#comment%3A27):
> The `Sequence` constructor uses `sage.structure.element.canonical_coercion` on adjacent elements from left to right.

Yes, it does that *if no universe is specified*. However, if a universe is specified, then it just coerces the elements into the universe specified. There is no "common parent discovery" necessary in that case anymore.

I maintain that operations on sequences should *not* look at individual elements (since a sequence of length 0 does not have any), but derive the universe from the universes of the input sequences.

In particular, I think it's fine to have:

```
Sequence(list1) + Sequence(list2) != Sequence(list1+list2)
```
(although I'm pretty sure it will actually hold anyway in most/all reasonable cases)

> It could probably be simplified using `coercion_model.common_parent`, but the constructor's parameter `use_sage_types=False` and fallbacks for non-coercible inputs are a complication

You should be able to tell those cases from the universes of the inputs. Perhaps if one of the input universes does not play nice with `coercion_maps`, other fallbacks are necessary (and perhaps just generate an error that no common parent can be found).

Given that previously these operations just generated a list (clearly not desirable), I don't think you need to be worried about backwards compatibility. So better start out with restrictive, well-defined behaviour. It'll become more relaxed and messy by incremental patching afterwards anyway.



---

archive/issue_comments_285635.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nReplying to [@nbruin](#comment%3A28):\n> I maintain that operations on sequences should *not* look at individual elements (since a sequence of length 0 does not have any), but derive the universe from the universes of the input sequences.\n\nYes, I agree with you and have been working on the implementation.",
    "created_at": "2021-09-04T18:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285635",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'>**Comment 29:**</a>
Replying to [@nbruin](#comment%3A28):
> I maintain that operations on sequences should *not* look at individual elements (since a sequence of length 0 does not have any), but derive the universe from the universes of the input sequences.

Yes, I agree with you and have been working on the implementation.



---

archive/issue_comments_285636.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2aac25814bb839d5a7d270dee319f25541d6bf36\">2aac258</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements</code></td></tr></table>\n",
    "created_at": "2021-09-04T18:51:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285636",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>**Comment 30:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2aac25814bb839d5a7d270dee319f25541d6bf36">2aac258</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements</code></td></tr></table>




---

archive/issue_comments_285637.json:
```json
{
    "body": "**Changing commit** from \"[bb2407eec59af33bc1dc85e4e0865d896603fa44](https://github.com/sagemath/sagetrac-mirror/commit/bb2407eec59af33bc1dc85e4e0865d896603fa44)\" to \"[2aac25814bb839d5a7d270dee319f25541d6bf36](https://github.com/sagemath/sagetrac-mirror/commit/2aac25814bb839d5a7d270dee319f25541d6bf36)\".",
    "created_at": "2021-09-04T18:51:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285637",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bb2407eec59af33bc1dc85e4e0865d896603fa44](https://github.com/sagemath/sagetrac-mirror/commit/bb2407eec59af33bc1dc85e4e0865d896603fa44)" to "[2aac25814bb839d5a7d270dee319f25541d6bf36](https://github.com/sagemath/sagetrac-mirror/commit/2aac25814bb839d5a7d270dee319f25541d6bf36)".



---

archive/issue_comments_285638.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec0615b49231d1c9314f24c072eccf96145051f2\">ec0615b</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements (fixup)</code></td></tr></table>\n",
    "created_at": "2021-09-04T19:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285638",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:31'>**Comment 31:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec0615b49231d1c9314f24c072eccf96145051f2">ec0615b</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements (fixup)</code></td></tr></table>




---

archive/issue_comments_285639.json:
```json
{
    "body": "**Changing commit** from \"[2aac25814bb839d5a7d270dee319f25541d6bf36](https://github.com/sagemath/sagetrac-mirror/commit/2aac25814bb839d5a7d270dee319f25541d6bf36)\" to \"[ec0615b49231d1c9314f24c072eccf96145051f2](https://github.com/sagemath/sagetrac-mirror/commit/ec0615b49231d1c9314f24c072eccf96145051f2)\".",
    "created_at": "2021-09-04T19:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285639",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2aac25814bb839d5a7d270dee319f25541d6bf36](https://github.com/sagemath/sagetrac-mirror/commit/2aac25814bb839d5a7d270dee319f25541d6bf36)" to "[ec0615b49231d1c9314f24c072eccf96145051f2](https://github.com/sagemath/sagetrac-mirror/commit/ec0615b49231d1c9314f24c072eccf96145051f2)".



---

archive/issue_comments_285640.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nHere's a new version that implements this. I haven't tested ill-behaved elements yet.\n\nNext is to generalize the `Sequence` constructor so it can accept generators",
    "created_at": "2021-09-04T19:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285640",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'>**Comment 32:**</a>
Here's a new version that implements this. I haven't tested ill-behaved elements yet.

Next is to generalize the `Sequence` constructor so it can accept generators



---

archive/issue_comments_285641.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84aae71c196de28a336b1f8606f9f378aaf9212d\">84aae71</a></td><td><code>src/sage/structure/sequence.py: Update copyright according to \"git blame -w --date=format:%Y src/sage/structure/sequence.py | sort -k2\"</code></td></tr></table>\n",
    "created_at": "2021-09-04T20:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285641",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'>**Comment 33:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84aae71c196de28a336b1f8606f9f378aaf9212d">84aae71</a></td><td><code>src/sage/structure/sequence.py: Update copyright according to "git blame -w --date=format:%Y src/sage/structure/sequence.py | sort -k2"</code></td></tr></table>




---

archive/issue_comments_285642.json:
```json
{
    "body": "**Changing commit** from \"[ec0615b49231d1c9314f24c072eccf96145051f2](https://github.com/sagemath/sagetrac-mirror/commit/ec0615b49231d1c9314f24c072eccf96145051f2)\" to \"[84aae71c196de28a336b1f8606f9f378aaf9212d](https://github.com/sagemath/sagetrac-mirror/commit/84aae71c196de28a336b1f8606f9f378aaf9212d)\".",
    "created_at": "2021-09-04T20:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285642",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ec0615b49231d1c9314f24c072eccf96145051f2](https://github.com/sagemath/sagetrac-mirror/commit/ec0615b49231d1c9314f24c072eccf96145051f2)" to "[84aae71c196de28a336b1f8606f9f378aaf9212d](https://github.com/sagemath/sagetrac-mirror/commit/84aae71c196de28a336b1f8606f9f378aaf9212d)".



---

archive/issue_comments_285643.json:
```json
{
    "body": "**Changing commit** from \"[84aae71c196de28a336b1f8606f9f378aaf9212d](https://github.com/sagemath/sagetrac-mirror/commit/84aae71c196de28a336b1f8606f9f378aaf9212d)\" to \"[0c3f1185f9f70b137218765c078156a598e9d46b](https://github.com/sagemath/sagetrac-mirror/commit/0c3f1185f9f70b137218765c078156a598e9d46b)\".",
    "created_at": "2021-09-04T20:26:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285643",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[84aae71c196de28a336b1f8606f9f378aaf9212d](https://github.com/sagemath/sagetrac-mirror/commit/84aae71c196de28a336b1f8606f9f378aaf9212d)" to "[0c3f1185f9f70b137218765c078156a598e9d46b](https://github.com/sagemath/sagetrac-mirror/commit/0c3f1185f9f70b137218765c078156a598e9d46b)".



---

archive/issue_comments_285644.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c3f1185f9f70b137218765c078156a598e9d46b\">0c3f118</a></td><td><code>Sequence_generic.__mul__, `__rmul__`, __imul__: Create sequences in the same universe, not lists</code></td></tr></table>\n",
    "created_at": "2021-09-04T20:26:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285644",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:34'>**Comment 34:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c3f1185f9f70b137218765c078156a598e9d46b">0c3f118</a></td><td><code>Sequence_generic.__mul__, `__rmul__`, __imul__: Create sequences in the same universe, not lists</code></td></tr></table>




---

archive/issue_comments_285645.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nGiven that you're using the coercion maps in a coercion environment, I don't think you need to copy them. Maps in the coercion system are special since they try to reference their domain and codomain weakly whenever possible, so that there's still a chance these are garbage collected (the maps are globally cached, so if this would not be done, any structure that participates in the coercion system would become immortal. Even with this hack, it's still often the case structures are unexpectedly prevented from being deleted due to the coercion system -- the implementation of maps often hold references to domain and/or codomain as well). In your case, you already know you're holding a reference to the domains.\n\nI guess there may be a very small chance that the codomain is deleted just before you can get a hold of it (but the \"copy\" does not exclude that, because the codomain could vanish between the return of coercion_maps and the invocation of \"copy\"), so you could try and look if instead of coercion_maps, there is a routine that also returns the common parent (the codomain) explicitly with a strong reference. It looks like this low-probability event has been ignored and it hasn't led to big trouble (and in any case, your \"copy\" doesn't address it any better than just capturing the codomain explicitly). If you look in `discover_coercion` you see that `Z=pushout(R,S)` constructs the common parent, but that after that, internal coercion maps from R and S into Z are computed and that, upon return, the explicit reference to Z is dropped. So I suspect that `coerce_R` and `coerce_S` could be defunct once the return has completed, but I don't think it's ever been observed to happen.\n\nIn any case, watch out that `None` as a coercion map means identity map, so `coercion_maps(ZZ,ZZ)==(None,None)`.\n\nYes, the coercion model is a nasty beast to work with and has been a source of endless memory leaks.\n\nThe warning about copying the maps internal to the coercion system is only for the case when someone wants to extract a morphism for a longer time and expects that holding on to the morphism will keep domain and codomain alive.",
    "created_at": "2021-09-04T20:55:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285645",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:35'>**Comment 35:**</a>
Given that you're using the coercion maps in a coercion environment, I don't think you need to copy them. Maps in the coercion system are special since they try to reference their domain and codomain weakly whenever possible, so that there's still a chance these are garbage collected (the maps are globally cached, so if this would not be done, any structure that participates in the coercion system would become immortal. Even with this hack, it's still often the case structures are unexpectedly prevented from being deleted due to the coercion system -- the implementation of maps often hold references to domain and/or codomain as well). In your case, you already know you're holding a reference to the domains.

I guess there may be a very small chance that the codomain is deleted just before you can get a hold of it (but the "copy" does not exclude that, because the codomain could vanish between the return of coercion_maps and the invocation of "copy"), so you could try and look if instead of coercion_maps, there is a routine that also returns the common parent (the codomain) explicitly with a strong reference. It looks like this low-probability event has been ignored and it hasn't led to big trouble (and in any case, your "copy" doesn't address it any better than just capturing the codomain explicitly). If you look in `discover_coercion` you see that `Z=pushout(R,S)` constructs the common parent, but that after that, internal coercion maps from R and S into Z are computed and that, upon return, the explicit reference to Z is dropped. So I suspect that `coerce_R` and `coerce_S` could be defunct once the return has completed, but I don't think it's ever been observed to happen.

In any case, watch out that `None` as a coercion map means identity map, so `coercion_maps(ZZ,ZZ)==(None,None)`.

Yes, the coercion model is a nasty beast to work with and has been a source of endless memory leaks.

The warning about copying the maps internal to the coercion system is only for the case when someone wants to extract a morphism for a longer time and expects that holding on to the morphism will keep domain and codomain alive.



---

archive/issue_comments_285646.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nReplying to [@nbruin](#comment%3A35):\n> watch out that `None` as a coercion map means identity map, so `coercion_maps(ZZ,ZZ)==(None,None)`.\n\nYes, the code is handling that already",
    "created_at": "2021-09-04T20:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285646",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'>**Comment 36:**</a>
Replying to [@nbruin](#comment%3A35):
> watch out that `None` as a coercion map means identity map, so `coercion_maps(ZZ,ZZ)==(None,None)`.

Yes, the code is handling that already



---

archive/issue_comments_285647.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef9a375f1dca6eb28ee69dcf1790df86731f6ba8\">ef9a375</a></td><td><code>Sequence_generic._add: We hold strong references to domain/codomain, no need to copy the coercion map</code></td></tr></table>\n",
    "created_at": "2021-09-04T21:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285647",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:37'>**Comment 37:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef9a375f1dca6eb28ee69dcf1790df86731f6ba8">ef9a375</a></td><td><code>Sequence_generic._add: We hold strong references to domain/codomain, no need to copy the coercion map</code></td></tr></table>




---

archive/issue_comments_285648.json:
```json
{
    "body": "**Changing commit** from \"[0c3f1185f9f70b137218765c078156a598e9d46b](https://github.com/sagemath/sagetrac-mirror/commit/0c3f1185f9f70b137218765c078156a598e9d46b)\" to \"[ef9a375f1dca6eb28ee69dcf1790df86731f6ba8](https://github.com/sagemath/sagetrac-mirror/commit/ef9a375f1dca6eb28ee69dcf1790df86731f6ba8)\".",
    "created_at": "2021-09-04T21:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285648",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0c3f1185f9f70b137218765c078156a598e9d46b](https://github.com/sagemath/sagetrac-mirror/commit/0c3f1185f9f70b137218765c078156a598e9d46b)" to "[ef9a375f1dca6eb28ee69dcf1790df86731f6ba8](https://github.com/sagemath/sagetrac-mirror/commit/ef9a375f1dca6eb28ee69dcf1790df86731f6ba8)".



---

archive/issue_comments_285649.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nReplying to [@nbruin](#comment%3A35):\n> Given that you're using the coercion maps in a coercion environment, I don't think you need to copy them. [...]\n\nThanks for the explanation, I agree.",
    "created_at": "2021-09-04T21:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285649",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'>**Comment 38:**</a>
Replying to [@nbruin](#comment%3A35):
> Given that you're using the coercion maps in a coercion environment, I don't think you need to copy them. [...]

Thanks for the explanation, I agree.



---

archive/issue_comments_285650.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nI think in the failing testcase of `3 * M`, `Integer.__mul__` calls `coercion_model.bin_op`, which seems to get confused by `M` being a `Parent`, not an `Element`",
    "created_at": "2021-09-04T21:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285650",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>**Comment 39:**</a>
I think in the failing testcase of `3 * M`, `Integer.__mul__` calls `coercion_model.bin_op`, which seems to get confused by `M` being a `Parent`, not an `Element`



---

archive/issue_comments_285651.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\n(`3r * M` works.)",
    "created_at": "2021-09-04T21:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285651",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'>**Comment 40:**</a>
(`3r * M` works.)



---

archive/issue_comments_285652.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"Matthias Koeppe, ...\".",
    "created_at": "2021-10-13T17:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285652",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "Matthias Koeppe, ...".



---

archive/issue_comments_285653.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\nI think I need some help with this ticket",
    "created_at": "2021-10-13T17:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285653",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'>**Comment 41:**</a>
I think I need some help with this ticket



---

archive/issue_events_241808.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241808"
}
```



---

archive/issue_events_241809.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241809"
}
```



---

archive/issue_events_241810.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241810"
}
```



---

archive/issue_events_241811.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241811"
}
```



---

archive/issue_comments_285654.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/467c49c37e12a5b0bf5c13f9664ada9f5e62870a\">467c49c</a></td><td><code>Sequence_generic.__delitem__: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec47c71c9008d05002189215e96292f836b915d8\">ec47c71</a></td><td><code>Sequence_generic.__iadd__, __imul__: If immutable, just delegate to __add__/__mul__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4e0e3d45e2e41fde7b3907620bfa99af8f719c5\">d4e0e3d</a></td><td><code>Sequence: Update doc of init arguments to match implementation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a592f1e65c9a04ba6dd3b65c67fd49cb250dc37\">2a592f1</a></td><td><code>Sequence_generic.__add__/__iadd__: Always create a new immutable / mutable sequence</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8daa94c7a971ed448fd42846112e6c78a9f06d54\">8daa94c</a></td><td><code>Sequence_generic: Remove python2-specific special methods</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd5a47fba4d12664c636c30d83dc112a6b4774e9\">dd5a47f</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1289504baf0cc8929cff2b89ffe83c3de831eff\">a128950</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements (fixup)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcdb57a9f1fcc381ced97ee9c03ed24cc274efd9\">dcdb57a</a></td><td><code>src/sage/structure/sequence.py: Update copyright according to \"git blame -w --date=format:%Y src/sage/structure/sequence.py | sort -k2\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef206b7b171cd2324d02ee53625a31f097359fb4\">ef206b7</a></td><td><code>Sequence_generic.__mul__, `__rmul__`, __imul__: Create sequences in the same universe, not lists</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18bb870e917766d241121d88d137c720c216e7cf\">18bb870</a></td><td><code>Sequence_generic._add: We hold strong references to domain/codomain, no need to copy the coercion map</code></td></tr></table>\n",
    "created_at": "2022-08-30T23:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285654",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:44'>**Comment 44:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/467c49c37e12a5b0bf5c13f9664ada9f5e62870a">467c49c</a></td><td><code>Sequence_generic.__delitem__: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec47c71c9008d05002189215e96292f836b915d8">ec47c71</a></td><td><code>Sequence_generic.__iadd__, __imul__: If immutable, just delegate to __add__/__mul__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4e0e3d45e2e41fde7b3907620bfa99af8f719c5">d4e0e3d</a></td><td><code>Sequence: Update doc of init arguments to match implementation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a592f1e65c9a04ba6dd3b65c67fd49cb250dc37">2a592f1</a></td><td><code>Sequence_generic.__add__/__iadd__: Always create a new immutable / mutable sequence</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8daa94c7a971ed448fd42846112e6c78a9f06d54">8daa94c</a></td><td><code>Sequence_generic: Remove python2-specific special methods</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd5a47fba4d12664c636c30d83dc112a6b4774e9">dd5a47f</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1289504baf0cc8929cff2b89ffe83c3de831eff">a128950</a></td><td><code>Sequence_generic.__add__, __iadd__: Compute new universe from old universes, not elements (fixup)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcdb57a9f1fcc381ced97ee9c03ed24cc274efd9">dcdb57a</a></td><td><code>src/sage/structure/sequence.py: Update copyright according to "git blame -w --date=format:%Y src/sage/structure/sequence.py | sort -k2"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef206b7b171cd2324d02ee53625a31f097359fb4">ef206b7</a></td><td><code>Sequence_generic.__mul__, `__rmul__`, __imul__: Create sequences in the same universe, not lists</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18bb870e917766d241121d88d137c720c216e7cf">18bb870</a></td><td><code>Sequence_generic._add: We hold strong references to domain/codomain, no need to copy the coercion map</code></td></tr></table>




---

archive/issue_comments_285655.json:
```json
{
    "body": "**Changing commit** from \"[ef9a375f1dca6eb28ee69dcf1790df86731f6ba8](https://github.com/sagemath/sagetrac-mirror/commit/ef9a375f1dca6eb28ee69dcf1790df86731f6ba8)\" to \"[18bb870e917766d241121d88d137c720c216e7cf](https://github.com/sagemath/sagetrac-mirror/commit/18bb870e917766d241121d88d137c720c216e7cf)\".",
    "created_at": "2022-08-30T23:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19813#issuecomment-285655",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ef9a375f1dca6eb28ee69dcf1790df86731f6ba8](https://github.com/sagemath/sagetrac-mirror/commit/ef9a375f1dca6eb28ee69dcf1790df86731f6ba8)" to "[18bb870e917766d241121d88d137c720c216e7cf](https://github.com/sagemath/sagetrac-mirror/commit/18bb870e917766d241121d88d137c720c216e7cf)".



---

archive/issue_events_241812.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241812"
}
```



---

archive/issue_events_241813.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19813",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19813#event-241813"
}
```
