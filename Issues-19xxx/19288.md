# Issue 19288: Make real/complex number field embeddings more accurate

archive/issues_019051.json:
```json
{
    "assignees": [],
    "body": "We should detect and work around this catastrophic cancellation:\n\n```\nsage: K.<a> = NumberField(x^2-x-104)\nsage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152\nsage: [v(D) for v in K.embeddings(RR)]\n[0.000000000000000, -9.70868378243995e40]\n```\n\nThis is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.\n\nNote: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.\n\nNote 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.\n\nDepends on #19330\nDepends on #19361\nDepends on #19362\nDepends on #19356\n\nCC:  @JohnCremona @jdemeyer\n\nBranch/Commit: **[u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate) @ [`9f802de`](https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0)**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **number fields**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19288_\n\n",
    "created_at": "2015-09-24T21:03:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make real/complex number field embeddings more accurate",
    "type": "issue",
    "updated_at": "2022-12-29T01:33:44Z",
    "url": "https://github.com/sagemath/sage/issues/19288",
    "user": "https://github.com/pjbruin"
}
```
We should detect and work around this catastrophic cancellation:

```
sage: K.<a> = NumberField(x^2-x-104)
sage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152
sage: [v(D) for v in K.embeddings(RR)]
[0.000000000000000, -9.70868378243995e40]
```

This is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.

Note: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.

Note 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.

Depends on #19330
Depends on #19361
Depends on #19362
Depends on #19356

CC:  @JohnCremona @jdemeyer

Branch/Commit: **[u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate) @ [`9f802de`](https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0)**

Author: **Jeroen Demeyer**

Component: **number fields**

_Issue created by migration from https://trac.sagemath.org/ticket/19288_





---

archive/issue_events_271240.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-09-24T21:03:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271240"
}
```



---

archive/issue_events_271241.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-09-24T21:03:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271241"
}
```



---

archive/issue_events_271242.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-09-24T21:03:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271242"
}
```



---

archive/issue_events_271243.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-09-24T21:03:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271243"
}
```



---

archive/issue_comments_273508.json:
```json
{
    "body": "Dependencies: **#19276**",
    "created_at": "2015-09-24T21:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273508",
    "user": "https://github.com/pjbruin"
}
```

Dependencies: **#19276**



---

archive/issue_comments_273509.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI don't see the point of adding a method to compute `log |emb(x)|` in a special way. Why not just fix `emb(x)` itself?",
    "created_at": "2015-09-25T08:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273509",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

I don't see the point of adding a method to compute `log |emb(x)|` in a special way. Why not just fix `emb(x)` itself?



---

archive/issue_comments_273510.json:
```json
{
    "body": "Changed dependencies from **#19276** to none",
    "created_at": "2015-09-25T18:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273510",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#19276** to none



---

archive/issue_comments_273511.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis is independent of #19276.",
    "created_at": "2015-09-25T18:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273511",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

This is independent of #19276.



---

archive/issue_comments_273512.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHere is a concrete proposal:\n\nsubclass `NumberFieldHomomorphism_im_gens` with a new class `NumberFieldRealComplexEmbedding` for embeddings of number fields into `RR` or `CC`. The implementation can be close to [[#19276 comment:12](https://github.com/sagemath/sage/issues/19276#comment:12)] but more efficient.",
    "created_at": "2015-09-25T19:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273512",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Here is a concrete proposal:

subclass `NumberFieldHomomorphism_im_gens` with a new class `NumberFieldRealComplexEmbedding` for embeddings of number fields into `RR` or `CC`. The implementation can be close to [[#19276 comment:12](https://github.com/sagemath/sage/issues/19276#comment:12)] but more efficient.



---

archive/issue_comments_273513.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It would be useful to have a method `NumberFieldElement.logabs(emb)`, where `emb` is a real or complex embedding, such that `x.logabs(emb)` returns log |emb(x)|, increasing the precision of emb as needed, and raises an error if x = 0.\n+\n``````\n",
    "created_at": "2015-10-01T11:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273513",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-It would be useful to have a method `NumberFieldElement.logabs(emb)`, where `emb` is a real or complex embedding, such that `x.logabs(emb)` returns log |emb(x)|, increasing the precision of emb as needed, and raises an error if x = 0.
+
``````




---

archive/issue_events_271244.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-10-01T11:46:44Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "title_is": "Make real/complex number field embeddings more accurate",
    "title_was": "Method logabs() for number field elements",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271244"
}
```



---

archive/issue_comments_273514.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2015-10-01T11:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273514",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_273515.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,8 @@\n+We should detect and work around this catastrophic cancellation:\n \n+```\n+sage: K.<a> = NumberField(x^2-x-104)\n+sage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152\n+sage: [v(D) for v in K.embeddings(RR)]\n+[0.000000000000000, -9.70868378243995e40]\n+```\n``````\n",
    "created_at": "2015-10-01T12:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273515",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,8 @@
+We should detect and work around this catastrophic cancellation:
 
+```
+sage: K.<a> = NumberField(x^2-x-104)
+sage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152
+sage: [v(D) for v in K.embeddings(RR)]
+[0.000000000000000, -9.70868378243995e40]
+```
``````




---

archive/issue_comments_273516.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI don't completely agree with re-purposing this ticket.  In my opinion a method `logabs()` would still be useful.  It should implement *x* \u21a6 log |*x*|<sub>v</sub> for any place *v*: either an Archimedean place defined by a real or complex embedding, or a non-Archimedean place defined by a prime ideal of the ring of integers.  For Archimedean places it would do this by simply computing the embedding to sufficient precision and then taking the logarithm of the absolute value.  For non-Archimedean places it should return `-x.valuation(p) * RR(p.norm()).log()`, which would presumably be more efficient than `RR(p.norm()^-x.valuation(p)).log()`.\n\nAnyway, I'm not going to do that now, so I don't mind too much if this becomes the ticket for fixing the accuracy of real/complex embeddings.  Still, I would be in favour of having a `logabs()` method at some point (on a different ticket).",
    "created_at": "2015-10-01T13:26:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273516",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

I don't completely agree with re-purposing this ticket.  In my opinion a method `logabs()` would still be useful.  It should implement *x* ↦ log |*x*|<sub>v</sub> for any place *v*: either an Archimedean place defined by a real or complex embedding, or a non-Archimedean place defined by a prime ideal of the ring of integers.  For Archimedean places it would do this by simply computing the embedding to sufficient precision and then taking the logarithm of the absolute value.  For non-Archimedean places it should return `-x.valuation(p) * RR(p.norm()).log()`, which would presumably be more efficient than `RR(p.norm()^-x.valuation(p)).log()`.

Anyway, I'm not going to do that now, so I don't mind too much if this becomes the ticket for fixing the accuracy of real/complex embeddings.  Still, I would be in favour of having a `logabs()` method at some point (on a different ticket).



---

archive/issue_comments_273517.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@pjbruin](#comment:7):\n> In my opinion a method `logabs()` would still be useful.\n\nOK, fine. However, since I thought the motivation for this was to fix #19276, I decided to re-purpose this ticket with a different fix for #19276.",
    "created_at": "2015-10-01T13:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273517",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@pjbruin](#comment:7):
> In my opinion a method `logabs()` would still be useful.

OK, fine. However, since I thought the motivation for this was to fix #19276, I decided to re-purpose this ticket with a different fix for #19276.



---

archive/issue_comments_273518.json:
```json
{
    "body": "Dependencies: **#19330**",
    "created_at": "2015-10-01T21:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273518",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#19330**



---

archive/issue_comments_273519.json:
```json
{
    "body": "Changed dependencies from **#19330** to **#19330, #19333**",
    "created_at": "2015-10-02T09:10:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273519",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#19330** to **#19330, #19333**



---

archive/issue_comments_273520.json:
```json
{
    "body": "Changed dependencies from **#19330, #19333** to **#19330**",
    "created_at": "2015-10-02T11:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273520",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#19330, #19333** to **#19330**



---

archive/issue_comments_273521.json:
```json
{
    "body": "Branch: **[u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate)**",
    "created_at": "2015-10-02T13:10:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273521",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate)**



---

archive/issue_comments_273522.json:
```json
{
    "body": "Commit: **[`ceac430`](https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c)**",
    "created_at": "2015-10-02T13:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273522",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`ceac430`](https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c)**



---

archive/issue_comments_273523.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/048b036934efaefb3a4c38b8a5d0b90ff25dc995\"><code>048b036</code></a></td><td><code>Implement conversion of interval fields to real/complex fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/752c401b852050c48186439a727040e3d81d90be\"><code>752c401</code></a></td><td><code>Use the new conversions in qqbar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c\"><code>ceac430</code></a></td><td><code>Make real/complex number field embeddings more accurate</code></td></tr></table>\n",
    "created_at": "2015-10-02T13:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273523",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/048b036934efaefb3a4c38b8a5d0b90ff25dc995"><code>048b036</code></a></td><td><code>Implement conversion of interval fields to real/complex fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/752c401b852050c48186439a727040e3d81d90be"><code>752c401</code></a></td><td><code>Use the new conversions in qqbar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c"><code>ceac430</code></a></td><td><code>Make real/complex number field embeddings more accurate</code></td></tr></table>




---

archive/issue_events_271245.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-10-02T13:17:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271245"
}
```



---

archive/issue_comments_273524.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,9 @@\n sage: [v(D) for v in K.embeddings(RR)]\n [0.000000000000000, -9.70868378243995e40]\n ```\n+\n+This is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.\n+\n+Note: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.\n+\n+Note 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.\n``````\n",
    "created_at": "2015-10-02T13:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273524",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,9 @@
 sage: [v(D) for v in K.embeddings(RR)]
 [0.000000000000000, -9.70868378243995e40]
 ```
+
+This is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.
+
+Note: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.
+
+Note 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.
``````




---

archive/issue_comments_273525.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7\"><code>8f0d8ae</code></a></td><td><code>Fix for old pickles</code></td></tr></table>\n",
    "created_at": "2015-10-02T13:34:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273525",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7"><code>8f0d8ae</code></a></td><td><code>Fix for old pickles</code></td></tr></table>




---

archive/issue_comments_273526.json:
```json
{
    "body": "Changed commit from **[`ceac430`](https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c)** to **[`8f0d8ae`](https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7)**",
    "created_at": "2015-10-02T13:34:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273526",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ceac430`](https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c)** to **[`8f0d8ae`](https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7)**



---

archive/issue_comments_273527.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034\"><code>a987fd2</code></a></td><td><code>Minor fixes</code></td></tr></table>\n",
    "created_at": "2015-10-04T10:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273527",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034"><code>a987fd2</code></a></td><td><code>Minor fixes</code></td></tr></table>




---

archive/issue_comments_273528.json:
```json
{
    "body": "Changed commit from **[`8f0d8ae`](https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7)** to **[`a987fd2`](https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034)**",
    "created_at": "2015-10-04T10:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273528",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8f0d8ae`](https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7)** to **[`a987fd2`](https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034)**



---

archive/issue_comments_273529.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks for all the great work on this which I have not been able to follow as I was at a workshop last week.\nI think there will be other places where this functionality will be useful -- for examples, computation of periods and elliptic logs, where the result depends on an embedding and what is stored is an embedding into AA or QQbar, only converted to a RealField or ComplexField with some precision when needed.",
    "created_at": "2015-10-04T15:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273529",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks for all the great work on this which I have not been able to follow as I was at a workshop last week.
I think there will be other places where this functionality will be useful -- for examples, computation of periods and elliptic logs, where the result depends on an embedding and what is stored is an embedding into AA or QQbar, only converted to a RealField or ComplexField with some precision when needed.



---

archive/issue_comments_273530.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0\"><code>5356407</code></a></td><td><code>Add doctests for __init__</code></td></tr></table>\n",
    "created_at": "2015-10-05T06:11:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273530",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0"><code>5356407</code></a></td><td><code>Add doctests for __init__</code></td></tr></table>




---

archive/issue_comments_273531.json:
```json
{
    "body": "Changed commit from **[`a987fd2`](https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034)** to **[`5356407`](https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0)**",
    "created_at": "2015-10-05T06:11:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273531",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a987fd2`](https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034)** to **[`5356407`](https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0)**



---

archive/issue_comments_273532.json:
```json
{
    "body": "Changed commit from **[`5356407`](https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0)** to **[`43ce520`](https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a)**",
    "created_at": "2015-10-05T15:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273532",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5356407`](https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0)** to **[`43ce520`](https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a)**



---

archive/issue_comments_273533.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a\"><code>43ce520</code></a></td><td><code>Make real/complex number field embeddings more accurate</code></td></tr></table>\n",
    "created_at": "2015-10-05T15:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273533",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a"><code>43ce520</code></a></td><td><code>Make real/complex number field embeddings more accurate</code></td></tr></table>




---

archive/issue_comments_273534.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI moved part of this branch to #19351 and squashed the commits.",
    "created_at": "2015-10-05T15:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273534",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

I moved part of this branch to #19351 and squashed the commits.



---

archive/issue_comments_273535.json:
```json
{
    "body": "Changed dependencies from **#19330** to **#19330, #19361, #19362, #19356**",
    "created_at": "2015-10-06T11:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273535",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#19330** to **#19330, #19361, #19362, #19356**



---

archive/issue_events_271246.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-10-06T11:27:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271246"
}
```



---

archive/issue_events_271247.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-10-06T11:27:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271247"
}
```



---

archive/issue_comments_273536.json:
```json
{
    "body": "Changed commit from **[`43ce520`](https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a)** to **[`9f802de`](https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0)**",
    "created_at": "2015-10-06T11:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273536",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`43ce520`](https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a)** to **[`9f802de`](https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0)**



---

archive/issue_comments_273537.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2049f5a4f3143479395827f1ab82c0a0b39089bc\"><code>2049f5a</code></a></td><td><code>Move refine_root() to refine_root.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b34e49f73e7a0889d87aa43b26709c14e9b7492\"><code>3b34e49</code></a></td><td><code>Improve refine_root()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41aaf04d4d6dd021a53038c9410f568cc8977958\"><code>41aaf04</code></a></td><td><code>Allow approximate root in polynomial_root()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1a5c59019196536760aef7ffb0a465ecfb2c515\"><code>b1a5c59</code></a></td><td><code>Merge commit '41aaf04d4d6dd021a53038c9410f568cc8977958' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0\"><code>9f802de</code></a></td><td><code>Make real/complex number field embeddings more accurate</code></td></tr></table>\n",
    "created_at": "2015-10-06T11:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273537",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2049f5a4f3143479395827f1ab82c0a0b39089bc"><code>2049f5a</code></a></td><td><code>Move refine_root() to refine_root.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b34e49f73e7a0889d87aa43b26709c14e9b7492"><code>3b34e49</code></a></td><td><code>Improve refine_root()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41aaf04d4d6dd021a53038c9410f568cc8977958"><code>41aaf04</code></a></td><td><code>Allow approximate root in polynomial_root()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1a5c59019196536760aef7ffb0a465ecfb2c515"><code>b1a5c59</code></a></td><td><code>Merge commit '41aaf04d4d6dd021a53038c9410f568cc8977958' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0"><code>9f802de</code></a></td><td><code>Make real/complex number field embeddings more accurate</code></td></tr></table>




---

archive/issue_comments_273538.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAgain simplified by moving some changes to #19356.",
    "created_at": "2015-10-06T11:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273538",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Again simplified by moving some changes to #19356.



---

archive/issue_events_271248.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-10-06T12:04:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271248"
}
```



---

archive/issue_events_271249.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-10-06T12:04:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271249"
}
```



---

archive/issue_comments_273539.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nDoes this really depend on #19362, which needs work?\nI would be really interested in having this improved functionality and would be willing to review the ticket (but #19362 seems a bit tricky as jdemeyer wrote that he does not remember what exactly needs to be done...).",
    "created_at": "2016-06-22T18:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273539",
    "user": "https://github.com/sagetrac-ehlen"
}
```

<div id="comment:25" align="right">comment:25</div>

Does this really depend on #19362, which needs work?
I would be really interested in having this improved functionality and would be willing to review the ticket (but #19362 seems a bit tricky as jdemeyer wrote that he does not remember what exactly needs to be done...).



---

archive/issue_comments_273540.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAt least some of the commits on this ticket come from #19362 (in the sense that they are there too), but I don't see why that necessarily means that this ticket needs to wait for that one.  As long as all the changes in all the commits here are ok!\nI started all this with #19276, which thankfully was fixed and merged independently.  This and #19362 is one of those cases where well-meaning people wanted to make something perfect and not just good enough.",
    "created_at": "2016-06-22T22:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273540",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:26" align="right">comment:26</div>

At least some of the commits on this ticket come from #19362 (in the sense that they are there too), but I don't see why that necessarily means that this ticket needs to wait for that one.  As long as all the changes in all the commits here are ok!
I started all this with #19276, which thankfully was fixed and merged independently.  This and #19362 is one of those cases where well-meaning people wanted to make something perfect and not just good enough.



---

archive/issue_events_271250.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2017-01-08T06:38:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271250"
}
```



---

archive/issue_events_271251.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2017-01-08T06:38:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271251"
}
```



---

archive/issue_comments_273541.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\ndoes not merge with 7.5.rc2",
    "created_at": "2017-01-08T06:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273541",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:27" align="right">comment:27</div>

does not merge with 7.5.rc2



---

archive/issue_comments_273542.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIt is a pity that this ticket and the related #19362 have been abandoned, since the issues they are trying to solve still cause problems: see #29666 which I have fixed using a different approach.  Perhaps the approach used there is more generally applicable, so for the record I'll say something about it here.\n\nRight now if you define an embedding (real, say) of a number field with some precision using K.embeddings(RealField(prec)) and then use the embedding to map individual number field elements, the images you get are in RealField(prec)  but can be very far from the correct values.  Instead you can get an accurate value by using refine_embedding (as it is in Sage 9.1.rc anyway) to refine the embedding to precision Infinity, which embedds into AA (or Qbar for a complex embedding), use that to map individual elements and then push them into RealField(prec) afterwards.  This seems to work pretty well and is robust, though of course it will be slower, thgough as long as the only operations you do on AA elements are +,-,* and not division, so testing for 0 is not required, that should not be a problem.",
    "created_at": "2020-05-11T11:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19288#issuecomment-273542",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:28" align="right">comment:28</div>

It is a pity that this ticket and the related #19362 have been abandoned, since the issues they are trying to solve still cause problems: see #29666 which I have fixed using a different approach.  Perhaps the approach used there is more generally applicable, so for the record I'll say something about it here.

Right now if you define an embedding (real, say) of a number field with some precision using K.embeddings(RealField(prec)) and then use the embedding to map individual number field elements, the images you get are in RealField(prec)  but can be very far from the correct values.  Instead you can get an accurate value by using refine_embedding (as it is in Sage 9.1.rc anyway) to refine the embedding to precision Infinity, which embedds into AA (or Qbar for a complex embedding), use that to map individual elements and then push them into RealField(prec) afterwards.  This seems to work pretty well and is robust, though of course it will be slower, thgough as long as the only operations you do on AA elements are +,-,* and not division, so testing for 0 is not required, that should not be a problem.



---

archive/issue_events_271252.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:33:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19288",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19288#event-271252"
}
```
