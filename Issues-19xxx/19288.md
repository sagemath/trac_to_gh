# Issue 19288: Make real/complex number field embeddings more accurate

archive/issues_019051.json:
```json
{
    "body": "We should detect and work around this catastrophic cancellation:\n\n```\nsage: K.<a> = NumberField(x^2-x-104)\nsage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152\nsage: [v(D) for v in K.embeddings(RR)]\n[0.000000000000000, -9.70868378243995e40]\n```\n\nThis is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.\n\nNote: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.\n\nNote 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.\n\nCC:  @JohnCremona @jdemeyer\n\nBranch: [u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate)\n\nAuthor: Jeroen Demeyer\n\nStatus: needs_work\n\nDependencies: #19330, #19361, #19362, #19356\n\nCommit: 9f802de8a19c1bbddec08689a75c42eb8d43c7d0\n\nIssue created by migration from https://trac.sagemath.org/ticket/19288\n\n",
    "created_at": "2015-09-24T21:03:17Z",
    "labels": [
        "component: number fields",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Make real/complex number field embeddings more accurate",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19288",
    "user": "https://github.com/pjbruin"
}
```
We should detect and work around this catastrophic cancellation:

```
sage: K.<a> = NumberField(x^2-x-104)
sage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152
sage: [v(D) for v in K.embeddings(RR)]
[0.000000000000000, -9.70868378243995e40]
```

This is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.

Note: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.

Note 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.

CC:  @JohnCremona @jdemeyer

Branch: [u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate)

Author: Jeroen Demeyer

Status: needs_work

Dependencies: #19330, #19361, #19362, #19356

Commit: 9f802de8a19c1bbddec08689a75c42eb8d43c7d0

Issue created by migration from https://trac.sagemath.org/ticket/19288





---

archive/issue_comments_348320.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#19276\"",
    "created_at": "2015-09-24T21:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348320",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "" to "#19276"



---

archive/issue_comments_348321.json:
```json
{
    "body": "<a id='comment:2'></a>\nI don't see the point of adding a method to compute `log |emb(x)|` in a special way. Why not just fix `emb(x)` itself?",
    "created_at": "2015-09-25T08:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348321",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
I don't see the point of adding a method to compute `log |emb(x)|` in a special way. Why not just fix `emb(x)` itself?



---

archive/issue_comments_348322.json:
```json
{
    "body": "Changing dependencies from \"#19276\" to \"\"",
    "created_at": "2015-09-25T18:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348322",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#19276" to ""



---

archive/issue_comments_348323.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is independent of #19276.",
    "created_at": "2015-09-25T18:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348323",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
This is independent of #19276.



---

archive/issue_comments_348324.json:
```json
{
    "body": "<a id='comment:4'></a>\nHere is a concrete proposal:\n\nsubclass `NumberFieldHomomorphism_im_gens` with a new class `NumberFieldRealComplexEmbedding` for embeddings of number fields into `RR` or `CC`. The implementation can be close to [comment:12:ticket:19276] but more efficient.",
    "created_at": "2015-09-25T19:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348324",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Here is a concrete proposal:

subclass `NumberFieldHomomorphism_im_gens` with a new class `NumberFieldRealComplexEmbedding` for embeddings of number fields into `RR` or `CC`. The implementation can be close to [comment:12:ticket:19276] but more efficient.



---

archive/issue_comments_348325.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-10-01T11:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348325",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_348326.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It would be useful to have a method `NumberFieldElement.logabs(emb)`, where `emb` is a real or complex embedding, such that `x.logabs(emb)` returns log |emb(x)|, increasing the precision of emb as needed, and raises an error if x = 0.\n+\n``````\n",
    "created_at": "2015-10-01T11:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348326",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-It would be useful to have a method `NumberFieldElement.logabs(emb)`, where `emb` is a real or complex embedding, such that `x.logabs(emb)` returns log |emb(x)|, increasing the precision of emb as needed, and raises an error if x = 0.
+
``````




---

archive/issue_events_060749.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "rename": {
        "from": "Method logabs() for number field elements",
        "to": "Make real/complex number field embeddings more accurate"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19288#event-60749"
}
```



---

archive/issue_comments_348327.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,8 @@\n+We should detect and work around this catastrophic cancellation:\n \n+```\n+sage: K.<a> = NumberField(x^2-x-104)\n+sage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152\n+sage: [v(D) for v in K.embeddings(RR)]\n+[0.000000000000000, -9.70868378243995e40]\n+```\n``````\n",
    "created_at": "2015-10-01T12:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348327",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,8 @@
+We should detect and work around this catastrophic cancellation:
 
+```
+sage: K.<a> = NumberField(x^2-x-104)
+sage: D = -4754362903238080086532729679384769785488*a - 46166237460580684378417136025570042177152
+sage: [v(D) for v in K.embeddings(RR)]
+[0.000000000000000, -9.70868378243995e40]
+```
``````




---

archive/issue_comments_348328.json:
```json
{
    "body": "<a id='comment:7'></a>\nI don't completely agree with re-purposing this ticket.  In my opinion a method `logabs()` would still be useful.  It should implement *x* \u21a6 log |*x*|<sub>v</sub> for any place *v*: either an Archimedean place defined by a real or complex embedding, or a non-Archimedean place defined by a prime ideal of the ring of integers.  For Archimedean places it would do this by simply computing the embedding to sufficient precision and then taking the logarithm of the absolute value.  For non-Archimedean places it should return `-x.valuation(p) * RR(p.norm()).log()`, which would presumably be more efficient than `RR(p.norm()^-x.valuation(p)).log()`.\n\nAnyway, I'm not going to do that now, so I don't mind too much if this becomes the ticket for fixing the accuracy of real/complex embeddings.  Still, I would be in favour of having a `logabs()` method at some point (on a different ticket).",
    "created_at": "2015-10-01T13:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348328",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>
I don't completely agree with re-purposing this ticket.  In my opinion a method `logabs()` would still be useful.  It should implement *x* â†¦ log |*x*|<sub>v</sub> for any place *v*: either an Archimedean place defined by a real or complex embedding, or a non-Archimedean place defined by a prime ideal of the ring of integers.  For Archimedean places it would do this by simply computing the embedding to sufficient precision and then taking the logarithm of the absolute value.  For non-Archimedean places it should return `-x.valuation(p) * RR(p.norm()).log()`, which would presumably be more efficient than `RR(p.norm()^-x.valuation(p)).log()`.

Anyway, I'm not going to do that now, so I don't mind too much if this becomes the ticket for fixing the accuracy of real/complex embeddings.  Still, I would be in favour of having a `logabs()` method at some point (on a different ticket).



---

archive/issue_comments_348329.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [pbruin](#comment%3A7):\n> In my opinion a method `logabs()` would still be useful.\n\n\nOK, fine. However, since I thought the motivation for this was to fix #19276, I decided to re-purpose this ticket with a different fix for #19276.",
    "created_at": "2015-10-01T13:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348329",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [pbruin](#comment%3A7):
> In my opinion a method `logabs()` would still be useful.


OK, fine. However, since I thought the motivation for this was to fix #19276, I decided to re-purpose this ticket with a different fix for #19276.



---

archive/issue_comments_348330.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#19330\"",
    "created_at": "2015-10-01T21:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348330",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#19330"



---

archive/issue_comments_348331.json:
```json
{
    "body": "Changing dependencies from \"#19330\" to \"#19330, #19333\"",
    "created_at": "2015-10-02T09:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348331",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#19330" to "#19330, #19333"



---

archive/issue_comments_348332.json:
```json
{
    "body": "Changing dependencies from \"#19330, #19333\" to \"#19330\"",
    "created_at": "2015-10-02T11:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348332",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#19330, #19333" to "#19330"



---

archive/issue_comments_348333.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate\"",
    "created_at": "2015-10-02T13:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348333",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/make_real_complex_number_field_embeddings_more_accurate"



---

archive/issue_comments_348334.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-02T13:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348334",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348335.json:
```json
{
    "body": "<a id='comment:13'></a>\nNew commits:\n|                                                                                                                                          |                                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[048b036](https://github.com/sagemath/sagetrac-mirror/commit/048b036934efaefb3a4c38b8a5d0b90ff25dc995)|`Implement conversion of interval fields to real/complex fields`|\n|[752c401](https://github.com/sagemath/sagetrac-mirror/commit/752c401b852050c48186439a727040e3d81d90be)|`Use the new conversions in qqbar`|\n|[ceac430](https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c)|`Make real/complex number field embeddings more accurate`|",
    "created_at": "2015-10-02T13:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348335",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
New commits:
|                                                                                                                                          |                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[048b036](https://github.com/sagemath/sagetrac-mirror/commit/048b036934efaefb3a4c38b8a5d0b90ff25dc995)|`Implement conversion of interval fields to real/complex fields`|
|[752c401](https://github.com/sagemath/sagetrac-mirror/commit/752c401b852050c48186439a727040e3d81d90be)|`Use the new conversions in qqbar`|
|[ceac430](https://github.com/sagemath/sagetrac-mirror/commit/ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c)|`Make real/complex number field embeddings more accurate`|



---

archive/issue_comments_348336.json:
```json
{
    "body": "Changing commit from \"\" to \"ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c\"",
    "created_at": "2015-10-02T13:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348336",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c"



---

archive/issue_comments_348337.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,9 @@\n sage: [v(D) for v in K.embeddings(RR)]\n [0.000000000000000, -9.70868378243995e40]\n ```\n+\n+This is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.\n+\n+Note: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.\n+\n+Note 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.\n``````\n",
    "created_at": "2015-10-02T13:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348337",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,9 @@
 sage: [v(D) for v in K.embeddings(RR)]
 [0.000000000000000, -9.70868378243995e40]
 ```
+
+This is fixed by adding a new class `NumberFieldComplexEmbedding` (and also `NumberFieldRealEmbedding`) which automatically increases the precision when computing the image.
+
+Note: I also do some minor clean-up in this branch, like removing redundant methods (defined more than once in the same class) and cleaning up some imports.
+
+Note 2: When most of this patch was already written, I discovered there is a `NumberFieldEmbedding` in `src/sage/rings/number_field/number_field_morphisms.pyx` which seems to have the same purpose as my new class. I propose to deal with this redundancy later.
``````




---

archive/issue_comments_348338.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[8f0d8ae](https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7)|`Fix for old pickles`|",
    "created_at": "2015-10-02T13:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348338",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[8f0d8ae](https://github.com/sagemath/sagetrac-mirror/commit/8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7)|`Fix for old pickles`|



---

archive/issue_comments_348339.json:
```json
{
    "body": "Changing commit from \"ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c\" to \"8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7\"",
    "created_at": "2015-10-02T13:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ceac4303d2c1c3a6feaf4a7508e25d79d2dc578c" to "8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7"



---

archive/issue_comments_348340.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[a987fd2](https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034)|`Minor fixes`|",
    "created_at": "2015-10-04T10:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |             |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[a987fd2](https://github.com/sagemath/sagetrac-mirror/commit/a987fd28c715d09ac3373710120bb8cec5bf4034)|`Minor fixes`|



---

archive/issue_comments_348341.json:
```json
{
    "body": "Changing commit from \"8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7\" to \"a987fd28c715d09ac3373710120bb8cec5bf4034\"",
    "created_at": "2015-10-04T10:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348341",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8f0d8ae7bbf19aa9bffc8a5fb43868811e8157f7" to "a987fd28c715d09ac3373710120bb8cec5bf4034"



---

archive/issue_comments_348342.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks for all the great work on this which I have not been able to follow as I was at a workshop last week.\nI think there will be other places where this functionality will be useful -- for examples, computation of periods and elliptic logs, where the result depends on an embedding and what is stored is an embedding into AA or QQbar, only converted to a RealField or ComplexField with some precision when needed.",
    "created_at": "2015-10-04T15:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348342",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:17'></a>
Thanks for all the great work on this which I have not been able to follow as I was at a workshop last week.
I think there will be other places where this functionality will be useful -- for examples, computation of periods and elliptic logs, where the result depends on an embedding and what is stored is an embedding into AA or QQbar, only converted to a RealField or ComplexField with some precision when needed.



---

archive/issue_comments_348343.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[5356407](https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0)|`Add doctests for __init__`|",
    "created_at": "2015-10-05T06:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348343",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[5356407](https://github.com/sagemath/sagetrac-mirror/commit/53564075548514297b7dc8ceee5768cdd47eaab0)|`Add doctests for __init__`|



---

archive/issue_comments_348344.json:
```json
{
    "body": "Changing commit from \"a987fd28c715d09ac3373710120bb8cec5bf4034\" to \"53564075548514297b7dc8ceee5768cdd47eaab0\"",
    "created_at": "2015-10-05T06:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a987fd28c715d09ac3373710120bb8cec5bf4034" to "53564075548514297b7dc8ceee5768cdd47eaab0"



---

archive/issue_comments_348345.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[43ce520](https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a)|`Make real/complex number field embeddings more accurate`|",
    "created_at": "2015-10-05T15:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348345",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[43ce520](https://github.com/sagemath/sagetrac-mirror/commit/43ce520bb6c486d5660ebf531aefae960de4921a)|`Make real/complex number field embeddings more accurate`|



---

archive/issue_comments_348346.json:
```json
{
    "body": "Changing commit from \"53564075548514297b7dc8ceee5768cdd47eaab0\" to \"43ce520bb6c486d5660ebf531aefae960de4921a\"",
    "created_at": "2015-10-05T15:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348346",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "53564075548514297b7dc8ceee5768cdd47eaab0" to "43ce520bb6c486d5660ebf531aefae960de4921a"



---

archive/issue_comments_348347.json:
```json
{
    "body": "<a id='comment:20'></a>\nI moved part of this branch to #19351 and squashed the commits.",
    "created_at": "2015-10-05T15:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348347",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
I moved part of this branch to #19351 and squashed the commits.



---

archive/issue_comments_348348.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-06T11:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348348",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348349.json:
```json
{
    "body": "Changing dependencies from \"#19330\" to \"#19330, #19361, #19362, #19356\"",
    "created_at": "2015-10-06T11:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348349",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#19330" to "#19330, #19361, #19362, #19356"



---

archive/issue_comments_348350.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[2049f5a](https://github.com/sagemath/sagetrac-mirror/commit/2049f5a4f3143479395827f1ab82c0a0b39089bc)|`Move refine_root() to refine_root.pyx`|\n|[3b34e49](https://github.com/sagemath/sagetrac-mirror/commit/3b34e49f73e7a0889d87aa43b26709c14e9b7492)|`Improve refine_root()`|\n|[41aaf04](https://github.com/sagemath/sagetrac-mirror/commit/41aaf04d4d6dd021a53038c9410f568cc8977958)|`Allow approximate root in polynomial_root()`|\n|[b1a5c59](https://github.com/sagemath/sagetrac-mirror/commit/b1a5c59019196536760aef7ffb0a465ecfb2c515)|`Merge commit '41aaf04d4d6dd021a53038c9410f568cc8977958' into HEAD`|\n|[9f802de](https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0)|`Make real/complex number field embeddings more accurate`|",
    "created_at": "2015-10-06T11:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[2049f5a](https://github.com/sagemath/sagetrac-mirror/commit/2049f5a4f3143479395827f1ab82c0a0b39089bc)|`Move refine_root() to refine_root.pyx`|
|[3b34e49](https://github.com/sagemath/sagetrac-mirror/commit/3b34e49f73e7a0889d87aa43b26709c14e9b7492)|`Improve refine_root()`|
|[41aaf04](https://github.com/sagemath/sagetrac-mirror/commit/41aaf04d4d6dd021a53038c9410f568cc8977958)|`Allow approximate root in polynomial_root()`|
|[b1a5c59](https://github.com/sagemath/sagetrac-mirror/commit/b1a5c59019196536760aef7ffb0a465ecfb2c515)|`Merge commit '41aaf04d4d6dd021a53038c9410f568cc8977958' into HEAD`|
|[9f802de](https://github.com/sagemath/sagetrac-mirror/commit/9f802de8a19c1bbddec08689a75c42eb8d43c7d0)|`Make real/complex number field embeddings more accurate`|



---

archive/issue_comments_348351.json:
```json
{
    "body": "Changing commit from \"43ce520bb6c486d5660ebf531aefae960de4921a\" to \"9f802de8a19c1bbddec08689a75c42eb8d43c7d0\"",
    "created_at": "2015-10-06T11:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "43ce520bb6c486d5660ebf531aefae960de4921a" to "9f802de8a19c1bbddec08689a75c42eb8d43c7d0"



---

archive/issue_comments_348352.json:
```json
{
    "body": "<a id='comment:23'></a>\nAgain simplified by moving some changes to #19356.",
    "created_at": "2015-10-06T11:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348352",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Again simplified by moving some changes to #19356.



---

archive/issue_comments_348353.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-06T12:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348353",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348354.json:
```json
{
    "body": "<a id='comment:25'></a>\nDoes this really depend on #19362, which needs work?\nI would be really interested in having this improved functionality and would be willing to review the ticket (but #19362 seems a bit tricky as jdemeyer wrote that he does not remember what exactly needs to be done...).",
    "created_at": "2016-06-22T18:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348354",
    "user": "https://trac.sagemath.org/admin/accounts/users/ehlen"
}
```

<a id='comment:25'></a>
Does this really depend on #19362, which needs work?
I would be really interested in having this improved functionality and would be willing to review the ticket (but #19362 seems a bit tricky as jdemeyer wrote that he does not remember what exactly needs to be done...).



---

archive/issue_comments_348355.json:
```json
{
    "body": "<a id='comment:26'></a>\nAt least some of the commits on this ticket come from #19362 (in the sense that they are there too), but I don't see why that necessarily means that this ticket needs to wait for that one.  As long as all the changes in all the commits here are ok!\nI started all this with #19276, which thankfully was fixed and merged independently.  This and #19362 is one of those cases where well-meaning people wanted to make something perfect and not just good enough.",
    "created_at": "2016-06-22T22:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348355",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:26'></a>
At least some of the commits on this ticket come from #19362 (in the sense that they are there too), but I don't see why that necessarily means that this ticket needs to wait for that one.  As long as all the changes in all the commits here are ok!
I started all this with #19276, which thankfully was fixed and merged independently.  This and #19362 is one of those cases where well-meaning people wanted to make something perfect and not just good enough.



---

archive/issue_comments_348356.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-08T06:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348356",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348357.json:
```json
{
    "body": "<a id='comment:27'></a>\ndoes not merge with 7.5.rc2",
    "created_at": "2017-01-08T06:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348357",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:27'></a>
does not merge with 7.5.rc2



---

archive/issue_comments_348358.json:
```json
{
    "body": "<a id='comment:28'></a>\nIt is a pity that this ticket and the related #19362 have been abandoned, since the issues they are trying to solve still cause problems: see #29666 which I have fixed using a different approach.  Perhaps the approach used there is more generally applicable, so for the record I'll say something about it here.\n\nRight now if you define an embedding (real, say) of a number field with some precision using K.embeddings(RealField(prec)) and then use the embedding to map individual number field elements, the images you get are in RealField(prec)  but can be very far from the correct values.  Instead you can get an accurate value by using refine_embedding (as it is in Sage 9.1.rc anyway) to refine the embedding to precision Infinity, which embedds into AA (or Qbar for a complex embedding), use that to map individual elements and then push them into RealField(prec) afterwards.  This seems to work pretty well and is robust, though of course it will be slower, thgough as long as the only operations you do on AA elements are +,-,* and not division, so testing for 0 is not required, that should not be a problem.",
    "created_at": "2020-05-11T11:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-348358",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:28'></a>
It is a pity that this ticket and the related #19362 have been abandoned, since the issues they are trying to solve still cause problems: see #29666 which I have fixed using a different approach.  Perhaps the approach used there is more generally applicable, so for the record I'll say something about it here.

Right now if you define an embedding (real, say) of a number field with some precision using K.embeddings(RealField(prec)) and then use the embedding to map individual number field elements, the images you get are in RealField(prec)  but can be very far from the correct values.  Instead you can get an accurate value by using refine_embedding (as it is in Sage 9.1.rc anyway) to refine the embedding to precision Infinity, which embedds into AA (or Qbar for a complex embedding), use that to map individual elements and then push them into RealField(prec) afterwards.  This seems to work pretty well and is robust, though of course it will be slower, thgough as long as the only operations you do on AA elements are +,-,* and not division, so testing for 0 is not required, that should not be a problem.
