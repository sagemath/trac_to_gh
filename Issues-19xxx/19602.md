# Issue 19602: Fix dependencies on libraries

archive/issues_019365.json:
```json
{
    "assignees": [],
    "body": "Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n\nTo test this, first build Sage with this patch. Then run\n\n```\n$ touch local/lib/*.so\n$ ./sage -b\n```\nThis will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).\n\nAfter applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like\n\n```\n/* Generated by Cython 0.23.3 */\n\n/* BEGIN: Cython Metadata\n{\n    \"distutils\": {\n        \"depends\": [\n            \"/usr/local/src/sage-config/local/include/python2.7/Python.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h\", \n            \"/usr/local/src/sage-config/src/setup.py\", \n            \"setup.py\", \n            \"/usr/local/src/sage-config/local/lib/libpari.so\", \n            \"/usr/local/src/sage-config/local/lib/libpari.a\", \n            \"/usr/local/src/sage-config/local/lib/libgmp.so\", \n            \"/usr/local/src/sage-config/local/lib/libgmp.a\"\n        ], \n        \"extra_compile_args\": [\n            \"-fno-strict-aliasing\", \n            \"-w\", \n            \"-fno-tree-dominator-opts\"\n        ], \n        \"include_dirs\": [\n            \"/usr/local/src/sage-config/local/include\", \n            \"/usr/local/src/sage-config/local/include/python2.7\", \n            \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include\", \n            \"/usr/local/src/sage-config/src\", \n            \"/usr/local/src/sage-config/src/sage/ext\", \n            \"/usr/local/src/sage-config/src/build/cythonized\", \n            \"/usr/local/src/sage-config/src/build/cythonized/sage/ext\"\n        ], \n        \"libraries\": [\n            \"pari\", \n            \"gmp\"\n        ], \n        \"library_dirs\": [\n            \"/usr/local/src/sage-config/local/lib\"\n        ]\n    }\n}\nEND: Cython Metadata */\n```\nNote the added dependency on `libgmp.so`.\n\nCC:  @vbraun\n\nBranch/Commit: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends) @ [87834f0](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**\n\nReviewer: **Leif Leonhardy, Volker Braun**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19602_\n\n",
    "closed_at": "2015-11-22T20:57:46Z",
    "created_at": "2015-11-19T15:02:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix dependencies on libraries",
    "type": "issue",
    "updated_at": "2015-11-23T07:29:12Z",
    "url": "https://github.com/sagemath/sage/issues/19602",
    "user": "https://github.com/jdemeyer"
}
```
Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.

To test this, first build Sage with this patch. Then run

```
$ touch local/lib/*.so
$ ./sage -b
```
This will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).

After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like

```
/* Generated by Cython 0.23.3 */

/* BEGIN: Cython Metadata
{
    "distutils": {
        "depends": [
            "/usr/local/src/sage-config/local/include/python2.7/Python.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h", 
            "/usr/local/src/sage-config/src/setup.py", 
            "setup.py", 
            "/usr/local/src/sage-config/local/lib/libpari.so", 
            "/usr/local/src/sage-config/local/lib/libpari.a", 
            "/usr/local/src/sage-config/local/lib/libgmp.so", 
            "/usr/local/src/sage-config/local/lib/libgmp.a"
        ], 
        "extra_compile_args": [
            "-fno-strict-aliasing", 
            "-w", 
            "-fno-tree-dominator-opts"
        ], 
        "include_dirs": [
            "/usr/local/src/sage-config/local/include", 
            "/usr/local/src/sage-config/local/include/python2.7", 
            "/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include", 
            "/usr/local/src/sage-config/src", 
            "/usr/local/src/sage-config/src/sage/ext", 
            "/usr/local/src/sage-config/src/build/cythonized", 
            "/usr/local/src/sage-config/src/build/cythonized/sage/ext"
        ], 
        "libraries": [
            "pari", 
            "gmp"
        ], 
        "library_dirs": [
            "/usr/local/src/sage-config/local/lib"
        ]
    }
}
END: Cython Metadata */
```
Note the added dependency on `libgmp.so`.

CC:  @vbraun

Branch/Commit: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends) @ [87834f0](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**

Reviewer: **Leif Leonhardy, Volker Braun**

_Issue created by migration from https://trac.sagemath.org/ticket/19602_





---

archive/issue_events_250433.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T15:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250433"
}
```



---

archive/issue_events_250434.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T15:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20cython",
    "label_color": "000080",
    "label_name": "component: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250434"
}
```



---

archive/issue_events_250435.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T15:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250435"
}
```



---

archive/issue_comments_282027.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,9 @@\n+After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are\n \n+```\n+sage/ext/interrupt/interrupt.so\n+sage/symbolic/substitution_map.so\n+sage/symbolic/constants_c.so\n+sage/symbolic/expression.so\n+sage/symbolic/getitem.so\n+```\n``````\n",
    "created_at": "2015-11-19T15:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282027",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,9 @@
+After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are
 
+```
+sage/ext/interrupt/interrupt.so
+sage/symbolic/substitution_map.so
+sage/symbolic/constants_c.so
+sage/symbolic/expression.so
+sage/symbolic/getitem.so
+```
``````




---

archive/issue_comments_282028.json:
```json
{
    "body": "Branch: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends)**",
    "created_at": "2015-11-19T16:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282028",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends)**



---

archive/issue_comments_282029.json:
```json
{
    "body": "Commit: **[7cd8477](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)**",
    "created_at": "2015-11-19T17:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282029",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[7cd8477](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)**



---

archive/issue_comments_282030.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d\">7cd8477</a></td><td><code>Fix dependency checking for libraries</code></td></tr></table>\n",
    "created_at": "2015-11-19T17:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282030",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'>Comment 3:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d">7cd8477</a></td><td><code>Fix dependency checking for libraries</code></td></tr></table>




---

archive/issue_comments_282031.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,5 @@\n sage/symbolic/expression.so\n sage/symbolic/getitem.so\n ```\n+\n+This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n``````\n",
    "created_at": "2015-11-19T17:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282031",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,5 @@
 sage/symbolic/expression.so
 sage/symbolic/getitem.so
 ```
+
+This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
``````




---

archive/issue_events_250436.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:00:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "title_is": "Fix library dependencies",
    "title_was": "Fix dependencies on MPIR",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250436"
}
```



---

archive/issue_events_250437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:02:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20cython",
    "label_color": "000080",
    "label_name": "component: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250437"
}
```



---

archive/issue_events_250438.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:02:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250438"
}
```



---

archive/issue_events_250439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:02:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250439"
}
```



---

archive/issue_comments_282032.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,52 @@\n ```\n \n This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n+\n+After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like\n+\n+```\n+/* Generated by Cython 0.23.3 */\n+\n+/* BEGIN: Cython Metadata\n+{\n+    \"distutils\": {\n+        \"depends\": [\n+            \"/usr/local/src/sage-config/local/include/python2.7/Python.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h\", \n+            \"/usr/local/src/sage-config/src/setup.py\", \n+            \"setup.py\", \n+            \"/usr/local/src/sage-config/local/lib/libpari.so\", \n+            \"/usr/local/src/sage-config/local/lib/libpari.a\", \n+            \"/usr/local/src/sage-config/local/lib/libgmp.so\", \n+            \"/usr/local/src/sage-config/local/lib/libgmp.a\"\n+        ], \n+        \"extra_compile_args\": [\n+            \"-fno-strict-aliasing\", \n+            \"-w\", \n+            \"-fno-tree-dominator-opts\"\n+        ], \n+        \"include_dirs\": [\n+            \"/usr/local/src/sage-config/local/include\", \n+            \"/usr/local/src/sage-config/local/include/python2.7\", \n+            \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include\", \n+            \"/usr/local/src/sage-config/src\", \n+            \"/usr/local/src/sage-config/src/sage/ext\", \n+            \"/usr/local/src/sage-config/src/build/cythonized\", \n+            \"/usr/local/src/sage-config/src/build/cythonized/sage/ext\"\n+        ], \n+        \"libraries\": [\n+            \"pari\", \n+            \"gmp\"\n+        ], \n+        \"library_dirs\": [\n+            \"/usr/local/src/sage-config/local/lib\"\n+        ]\n+    }\n+}\n+END: Cython Metadata */\n+```\n+Note the added dependency on `libgmp.so`.\n``````\n",
    "created_at": "2015-11-19T17:05:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282032",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,52 @@
 ```
 
 This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
+
+After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like
+
+```
+/* Generated by Cython 0.23.3 */
+
+/* BEGIN: Cython Metadata
+{
+    "distutils": {
+        "depends": [
+            "/usr/local/src/sage-config/local/include/python2.7/Python.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h", 
+            "/usr/local/src/sage-config/src/setup.py", 
+            "setup.py", 
+            "/usr/local/src/sage-config/local/lib/libpari.so", 
+            "/usr/local/src/sage-config/local/lib/libpari.a", 
+            "/usr/local/src/sage-config/local/lib/libgmp.so", 
+            "/usr/local/src/sage-config/local/lib/libgmp.a"
+        ], 
+        "extra_compile_args": [
+            "-fno-strict-aliasing", 
+            "-w", 
+            "-fno-tree-dominator-opts"
+        ], 
+        "include_dirs": [
+            "/usr/local/src/sage-config/local/include", 
+            "/usr/local/src/sage-config/local/include/python2.7", 
+            "/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include", 
+            "/usr/local/src/sage-config/src", 
+            "/usr/local/src/sage-config/src/sage/ext", 
+            "/usr/local/src/sage-config/src/build/cythonized", 
+            "/usr/local/src/sage-config/src/build/cythonized/sage/ext"
+        ], 
+        "libraries": [
+            "pari", 
+            "gmp"
+        ], 
+        "library_dirs": [
+            "/usr/local/src/sage-config/local/lib"
+        ]
+    }
+}
+END: Cython Metadata */
+```
+Note the added dependency on `libgmp.so`.
``````




---

archive/issue_comments_282033.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nhow about putting wrap_create_extension_list into sage_setup?",
    "created_at": "2015-11-19T17:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282033",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'>Comment 6:</a>
how about putting wrap_create_extension_list into sage_setup?



---

archive/issue_events_250440.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T19:49:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250440"
}
```



---

archive/issue_events_250441.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T19:49:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250441"
}
```



---

archive/issue_comments_282034.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThere seems to be a problem with distutils...",
    "created_at": "2015-11-19T19:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282034",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
There seems to be a problem with distutils...



---

archive/issue_events_250442.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-20T06:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250442"
}
```



---

archive/issue_events_250443.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-20T06:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250443"
}
```



---

archive/issue_comments_282035.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,14 @@\n ```\n \n This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n+\n+To test this, first build Sage with this patch. Then run\n+\n+```\n+$ touch local/lib/*.so\n+$ ./sage -b\n+```\n+This will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).\n \n After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like\n \n``````\n",
    "created_at": "2015-11-20T06:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282035",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,14 @@
 ```
 
 This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
+
+To test this, first build Sage with this patch. Then run
+
+```
+$ touch local/lib/*.so
+$ ./sage -b
+```
+This will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).
 
 After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like
 
``````




---

archive/issue_comments_282036.json:
```json
{
    "body": "Changed commit from **[7cd8477](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)** to **[84ac62e](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)**",
    "created_at": "2015-11-20T06:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282036",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7cd8477](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)** to **[84ac62e](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)**



---

archive/issue_comments_282037.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08062a5aaad60eba27f0f4502137b3bf87331a1f\">08062a5</a></td><td><code>Remove unused \"sdist\" variable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202\">84ac62e</a></td><td><code>Add dependencies both to extension and metadata</code></td></tr></table>\n",
    "created_at": "2015-11-20T06:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282037",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08062a5aaad60eba27f0f4502137b3bf87331a1f">08062a5</a></td><td><code>Remove unused "sdist" variable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202">84ac62e</a></td><td><code>Add dependencies both to extension and metadata</code></td></tr></table>




---

archive/issue_comments_282038.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nWow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )\n\nYou could at least cache the mapping of library names to their (existing, probably single) pathnames (and reuse them instead of creating hundreds of copies); if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.  Not sure whether hardcoding the library folders (`SAGE_LOCAL/lib*/`) there makes sense, or is appropriate.\n\nAfter all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\n\n\n\n`libFOO.dll` is not the convention used on Windows AFAIK; we may specialize according to the platform, also avoiding unnecessary calls of `glob()`.\n\n\n\n\nDo you want to keep the verbose listing of (lengthy!) dependencies by default?\n\n\n\n\nYou've renamed the parameter `library_order` to `library_sort_key`, the docstring of `wrap_create_extension_list()` doesn't yet reflect that change.",
    "created_at": "2015-11-20T09:54:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282038",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'>Comment 10:</a>
Wow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )

You could at least cache the mapping of library names to their (existing, probably single) pathnames (and reuse them instead of creating hundreds of copies); if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.  Not sure whether hardcoding the library folders (`SAGE_LOCAL/lib*/`) there makes sense, or is appropriate.

After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.




`libFOO.dll` is not the convention used on Windows AFAIK; we may specialize according to the platform, also avoiding unnecessary calls of `glob()`.




Do you want to keep the verbose listing of (lengthy!) dependencies by default?




You've renamed the parameter `library_order` to `library_sort_key`, the docstring of `wrap_create_extension_list()` doesn't yet reflect that change.



---

archive/issue_comments_282039.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@nexttime](#comment%3A10):\n> Wow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )\n\nI'd love to, but I think neither upstream Cython nor upstream distutils will want to support that.\n\n> You could at least cache the mapping of library names to their (existing, probably single) pathnames\n\nRight.\n\n> if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.\n\nWell, it doesn't really hurt either. It's just to be safe.\n\n> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\nAgain, you are right but I don't see an easy way to express this in the build system.\n\n> Do you want to keep the verbose listing of (lengthy!) dependencies by default?\n\nWhich \"verbose listing of (lengthy!) dependencies\"?",
    "created_at": "2015-11-20T10:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282039",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@nexttime](#comment%3A10):
> Wow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )

I'd love to, but I think neither upstream Cython nor upstream distutils will want to support that.

> You could at least cache the mapping of library names to their (existing, probably single) pathnames

Right.

> if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.

Well, it doesn't really hurt either. It's just to be safe.

> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.

Again, you are right but I don't see an easy way to express this in the build system.

> Do you want to keep the verbose listing of (lengthy!) dependencies by default?

Which "verbose listing of (lengthy!) dependencies"?



---

archive/issue_comments_282040.json:
```json
{
    "body": "Changed commit from **[84ac62e](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)** to **[f3f3966](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)**",
    "created_at": "2015-11-20T11:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282040",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[84ac62e](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)** to **[f3f3966](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)**



---

archive/issue_comments_282041.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/339884252221473dbb5dc74abcacdadf1d546bfd\">3398842</a></td><td><code>Cache find_library_files()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581\">f3f3966</a></td><td><code>Minor fixes</code></td></tr></table>\n",
    "created_at": "2015-11-20T11:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282041",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/339884252221473dbb5dc74abcacdadf1d546bfd">3398842</a></td><td><code>Cache find_library_files()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581">f3f3966</a></td><td><code>Minor fixes</code></td></tr></table>




---

archive/issue_comments_282042.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@nexttime](#comment%3A10):\n> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\nI must say that I find some truth in this. Volker, do you agree that it's simply a bad idea to rely on timestamps of library files?",
    "created_at": "2015-11-20T11:02:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282042",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@nexttime](#comment%3A10):
> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.

I must say that I find some truth in this. Volker, do you agree that it's simply a bad idea to rely on timestamps of library files?



---

archive/issue_comments_282043.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@jdemeyer](#comment%3A13):\n> Replying to [@nexttime](#comment%3A10):\n> > After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\n> \n> I must say that I find some truth in this.\n\nIMHO rather a matter of enforcing [people to comply with] such convention.  Just like our \"manual\" spkg dependencies.  (As before, there could be more than one file per library reflecting a significant change that triggers a rebuild.  In fact, for [ELF] shared libraries, the `soname` -- containing the \"major\" version number -- matters, nothing else [should].)",
    "created_at": "2015-11-20T11:20:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282043",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@jdemeyer](#comment%3A13):
> Replying to [@nexttime](#comment%3A10):
> > After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.

> 
> I must say that I find some truth in this.

IMHO rather a matter of enforcing [people to comply with] such convention.  Just like our "manual" spkg dependencies.  (As before, there could be more than one file per library reflecting a significant change that triggers a rebuild.  In fact, for [ELF] shared libraries, the `soname` -- containing the "major" version number -- matters, nothing else [should].)



---

archive/issue_events_250444.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-20T12:43:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "title_is": "Fix dependencies on libraries",
    "title_was": "Fix library dependencies",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250444"
}
```



---

archive/issue_comments_282044.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,4 @@\n-After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are\n-\n-```\n-sage/ext/interrupt/interrupt.so\n-sage/symbolic/substitution_map.so\n-sage/symbolic/constants_c.so\n-sage/symbolic/expression.so\n-sage/symbolic/getitem.so\n-```\n-\n-This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n+Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n \n To test this, first build Sage with this patch. Then run\n \n``````\n",
    "created_at": "2015-11-20T12:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282044",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,4 @@
-After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are
-
-```
-sage/ext/interrupt/interrupt.so
-sage/symbolic/substitution_map.so
-sage/symbolic/constants_c.so
-sage/symbolic/expression.so
-sage/symbolic/getitem.so
-```
-
-This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
+Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
 
 To test this, first build Sage with this patch. Then run
 
``````




---

archive/issue_comments_282045.json:
```json
{
    "body": "Changed commit from **[f3f3966](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)** to **[87834f0](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**",
    "created_at": "2015-11-20T14:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282045",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f3f3966](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)** to **[87834f0](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**



---

archive/issue_comments_282046.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f\">87834f0</a></td><td><code>Use absolute import (otherwise doctesting doesn't work???)</code></td></tr></table>\n",
    "created_at": "2015-11-20T14:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282046",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f">87834f0</a></td><td><code>Use absolute import (otherwise doctesting doesn't work???)</code></td></tr></table>




---

archive/issue_comments_282047.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nRelying no the timestamp of the header sounds good to me.\n\nIt assumes that we don't overlink, but thats obviously to be avoided anyways.",
    "created_at": "2015-11-21T00:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282047",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'>Comment 17:</a>
Relying no the timestamp of the header sounds good to me.

It assumes that we don't overlink, but thats obviously to be avoided anyways.



---

archive/issue_events_250445.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250445"
}
```



---

archive/issue_comments_282048.json:
```json
{
    "body": "Reviewer: **Leif Leonhardy, Volker Braun**",
    "created_at": "2015-11-21T08:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282048",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Leif Leonhardy, Volker Braun**



---

archive/issue_comments_282049.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer** to none",
    "created_at": "2015-11-21T08:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282049",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Jeroen Demeyer** to none



---

archive/issue_events_250446.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250446"
}
```



---

archive/issue_events_250447.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250447"
}
```



---

archive/issue_comments_282050.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nSo are we confident that\n\n* this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,\n* all modules linking to them explicitly depend on those,\n* it's sufficiently documented, both for spkg maintainers creating or updating spkgs as well as for reviewers such that they check this still holds?\n\n(I recall in the past occasionally some updates only incidentally worked, but I'm not aware of current trouble besides what Jeroen discovered regarding \"overlinking\" either.  No idea of how well-documented or -known the potential problems are.)",
    "created_at": "2015-11-21T15:38:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282050",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'>Comment 19:</a>
So are we confident that

* this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,
* all modules linking to them explicitly depend on those,
* it's sufficiently documented, both for spkg maintainers creating or updating spkgs as well as for reviewers such that they check this still holds?

(I recall in the past occasionally some updates only incidentally worked, but I'm not aware of current trouble besides what Jeroen discovered regarding "overlinking" either.  No idea of how well-documented or -known the potential problems are.)



---

archive/issue_comments_282051.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nP.S.:  People adding (or significantly changing) extension modules, or changing `module_list.py` should also know the potential pitfalls.\n\nThere should probably be some document / file reflecting which header(s) to use (i.e., to add to a module's `depends`) when linking to some library.  In Sage's `setup.py` we intentionally only add a few `depends` automagically (namely in case a module links to one of the most prominent libraries such as GMP/MPIR).",
    "created_at": "2015-11-21T15:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282051",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'>Comment 20:</a>
P.S.:  People adding (or significantly changing) extension modules, or changing `module_list.py` should also know the potential pitfalls.

There should probably be some document / file reflecting which header(s) to use (i.e., to add to a module's `depends`) when linking to some library.  In Sage's `setup.py` we intentionally only add a few `depends` automagically (namely in case a module links to one of the most prominent libraries such as GMP/MPIR).



---

archive/issue_comments_282052.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@nexttime](#comment%3A19):\n> So are we confident that\n> \n> * this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,\n\nI just checked\n\n```\nfind local/ -type f |xargs ls -l --sort=time\n```\n\nand the only old files were from `numpy`. So everything except numpy seems to install everything with recent timestamps.",
    "created_at": "2015-11-22T10:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282052",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@nexttime](#comment%3A19):
> So are we confident that
> 
> * this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,

I just checked

```
find local/ -type f |xargs ls -l --sort=time
```

and the only old files were from `numpy`. So everything except numpy seems to install everything with recent timestamps.



---

archive/issue_comments_282053.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nLet me also add that using\n\n```\n# distutils: ...\n```\ndeclarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.",
    "created_at": "2015-11-22T10:09:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282053",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
Let me also add that using

```
# distutils: ...
```
declarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.



---

archive/issue_comments_282054.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@nexttime](#comment%3A20):\n> i.e., to add to a module's `depends`\n\nExplicitly using `depends` should only be done in exceptional cases where the normal dependency checking doesn't work. #19610 is such an exceptional case (because the dependency is through a `.c` or `.h` file).",
    "created_at": "2015-11-22T10:48:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282054",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@nexttime](#comment%3A20):
> i.e., to add to a module's `depends`

Explicitly using `depends` should only be done in exceptional cases where the normal dependency checking doesn't work. #19610 is such an exceptional case (because the dependency is through a `.c` or `.h` file).



---

archive/issue_comments_282055.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@jdemeyer](#comment%3A22):\n> Let me also add that using\n> \n> ```\n> # distutils: ...\n> ```\n> declarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.\n\nAs we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).  This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).",
    "created_at": "2015-11-22T12:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282055",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@jdemeyer](#comment%3A22):
> Let me also add that using
> 
> ```
> # distutils: ...
> ```
> declarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.

As we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).  This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).



---

archive/issue_events_250448.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-22T20:57:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250448"
}
```



---

archive/issue_events_250449.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-22T20:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-250449"
}
```



---

archive/issue_comments_282056.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@nexttime](#comment%3A24):\n> As we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).\n\nRight, **and this was the reason I created this ticket**.",
    "created_at": "2015-11-23T07:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282056",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@nexttime](#comment%3A24):
> As we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).

Right, **and this was the reason I created this ticket**.



---

archive/issue_comments_282057.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@nexttime](#comment%3A24):\n> This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).\n\nI completely disagree with this statement though. Listing libraries in `module_list.py` is much more prone to errors because you manually need to keep track of all libraries that a module uses. Using `module_list.py`, if some module uses PARI functions, I need to change `module_list.py`. With the `# distutils: libraries` declarations, I don't need special effort: I just `cimport sage.libs.pari.foo` and the library gets added automatically.\n\nSo I would say that using `# distutils` makes it easier to get it right (but it's still possible to make mistakes of course).",
    "created_at": "2015-11-23T07:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282057",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@nexttime](#comment%3A24):
> This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).

I completely disagree with this statement though. Listing libraries in `module_list.py` is much more prone to errors because you manually need to keep track of all libraries that a module uses. Using `module_list.py`, if some module uses PARI functions, I need to change `module_list.py`. With the `# distutils: libraries` declarations, I don't need special effort: I just `cimport sage.libs.pari.foo` and the library gets added automatically.

So I would say that using `# distutils` makes it easier to get it right (but it's still possible to make mistakes of course).



---

archive/issue_comments_282058.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nSome testing would be nice, e.g. use gcc include dependency output and compare with linked libraries.",
    "created_at": "2015-11-23T07:29:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-282058",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'>Comment 28:</a>
Some testing would be nice, e.g. use gcc include dependency output and compare with linked libraries.
