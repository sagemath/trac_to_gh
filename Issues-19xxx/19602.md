# Issue 19602: Fix dependencies on libraries

archive/issues_019365.json:
```json
{
    "assignees": [],
    "body": "Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n\nTo test this, first build Sage with this patch. Then run\n\n```\n$ touch local/lib/*.so\n$ ./sage -b\n```\nThis will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).\n\nAfter applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like\n\n```\n/* Generated by Cython 0.23.3 */\n\n/* BEGIN: Cython Metadata\n{\n    \"distutils\": {\n        \"depends\": [\n            \"/usr/local/src/sage-config/local/include/python2.7/Python.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h\", \n            \"/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h\", \n            \"/usr/local/src/sage-config/src/setup.py\", \n            \"setup.py\", \n            \"/usr/local/src/sage-config/local/lib/libpari.so\", \n            \"/usr/local/src/sage-config/local/lib/libpari.a\", \n            \"/usr/local/src/sage-config/local/lib/libgmp.so\", \n            \"/usr/local/src/sage-config/local/lib/libgmp.a\"\n        ], \n        \"extra_compile_args\": [\n            \"-fno-strict-aliasing\", \n            \"-w\", \n            \"-fno-tree-dominator-opts\"\n        ], \n        \"include_dirs\": [\n            \"/usr/local/src/sage-config/local/include\", \n            \"/usr/local/src/sage-config/local/include/python2.7\", \n            \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include\", \n            \"/usr/local/src/sage-config/src\", \n            \"/usr/local/src/sage-config/src/sage/ext\", \n            \"/usr/local/src/sage-config/src/build/cythonized\", \n            \"/usr/local/src/sage-config/src/build/cythonized/sage/ext\"\n        ], \n        \"libraries\": [\n            \"pari\", \n            \"gmp\"\n        ], \n        \"library_dirs\": [\n            \"/usr/local/src/sage-config/local/lib\"\n        ]\n    }\n}\nEND: Cython Metadata */\n```\nNote the added dependency on `libgmp.so`.\n\nCC:  @vbraun\n\nBranch/Commit: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends) @ [`87834f0`](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**\n\nReviewer: **Leif Leonhardy, Volker Braun**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19602_\n\n",
    "closed_at": "2015-11-22T20:57:46Z",
    "created_at": "2015-11-19T15:02:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix dependencies on libraries",
    "type": "issue",
    "updated_at": "2015-11-23T07:29:12Z",
    "url": "https://github.com/sagemath/sage/issues/19602",
    "user": "https://github.com/jdemeyer"
}
```
Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.

To test this, first build Sage with this patch. Then run

```
$ touch local/lib/*.so
$ ./sage -b
```
This will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).

After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like

```
/* Generated by Cython 0.23.3 */

/* BEGIN: Cython Metadata
{
    "distutils": {
        "depends": [
            "/usr/local/src/sage-config/local/include/python2.7/Python.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h", 
            "/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h", 
            "/usr/local/src/sage-config/src/setup.py", 
            "setup.py", 
            "/usr/local/src/sage-config/local/lib/libpari.so", 
            "/usr/local/src/sage-config/local/lib/libpari.a", 
            "/usr/local/src/sage-config/local/lib/libgmp.so", 
            "/usr/local/src/sage-config/local/lib/libgmp.a"
        ], 
        "extra_compile_args": [
            "-fno-strict-aliasing", 
            "-w", 
            "-fno-tree-dominator-opts"
        ], 
        "include_dirs": [
            "/usr/local/src/sage-config/local/include", 
            "/usr/local/src/sage-config/local/include/python2.7", 
            "/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include", 
            "/usr/local/src/sage-config/src", 
            "/usr/local/src/sage-config/src/sage/ext", 
            "/usr/local/src/sage-config/src/build/cythonized", 
            "/usr/local/src/sage-config/src/build/cythonized/sage/ext"
        ], 
        "libraries": [
            "pari", 
            "gmp"
        ], 
        "library_dirs": [
            "/usr/local/src/sage-config/local/lib"
        ]
    }
}
END: Cython Metadata */
```
Note the added dependency on `libgmp.so`.

CC:  @vbraun

Branch/Commit: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends) @ [`87834f0`](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**

Reviewer: **Leif Leonhardy, Volker Braun**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/19602_





---

archive/issue_events_277611.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T15:02:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277611"
}
```



---

archive/issue_events_277612.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T15:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "000080",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277612"
}
```



---

archive/issue_events_277613.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T15:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277613"
}
```



---

archive/issue_events_277614.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T15:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277614"
}
```



---

archive/issue_comments_279490.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,9 @@\n+After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are\n \n+```\n+sage/ext/interrupt/interrupt.so\n+sage/symbolic/substitution_map.so\n+sage/symbolic/constants_c.so\n+sage/symbolic/expression.so\n+sage/symbolic/getitem.so\n+```\n``````\n",
    "created_at": "2015-11-19T15:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279490",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,9 @@
+After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are
 
+```
+sage/ext/interrupt/interrupt.so
+sage/symbolic/substitution_map.so
+sage/symbolic/constants_c.so
+sage/symbolic/expression.so
+sage/symbolic/getitem.so
+```
``````




---

archive/issue_comments_279491.json:
```json
{
    "body": "Branch: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends)**",
    "created_at": "2015-11-19T16:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279491",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/cython_depends](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cython_depends)**



---

archive/issue_comments_279492.json:
```json
{
    "body": "Commit: **[`7cd8477`](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)**",
    "created_at": "2015-11-19T17:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279492",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`7cd8477`](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)**



---

archive/issue_comments_279493.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d\"><code>7cd8477</code></a></td><td><code>Fix dependency checking for libraries</code></td></tr></table>\n",
    "created_at": "2015-11-19T17:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279493",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d"><code>7cd8477</code></a></td><td><code>Fix dependency checking for libraries</code></td></tr></table>




---

archive/issue_comments_279494.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,5 @@\n sage/symbolic/expression.so\n sage/symbolic/getitem.so\n ```\n+\n+This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n``````\n",
    "created_at": "2015-11-19T17:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279494",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,5 @@
 sage/symbolic/expression.so
 sage/symbolic/getitem.so
 ```
+
+This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
``````




---

archive/issue_events_277615.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:00:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "title_is": "Fix library dependencies",
    "title_was": "Fix dependencies on MPIR",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277615"
}
```



---

archive/issue_events_277616.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:02:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "000080",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277616"
}
```



---

archive/issue_events_277617.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:02:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277617"
}
```



---

archive/issue_events_277618.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T17:02:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277618"
}
```



---

archive/issue_comments_279495.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,52 @@\n ```\n \n This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n+\n+After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like\n+\n+```\n+/* Generated by Cython 0.23.3 */\n+\n+/* BEGIN: Cython Metadata\n+{\n+    \"distutils\": {\n+        \"depends\": [\n+            \"/usr/local/src/sage-config/local/include/python2.7/Python.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h\", \n+            \"/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h\", \n+            \"/usr/local/src/sage-config/src/setup.py\", \n+            \"setup.py\", \n+            \"/usr/local/src/sage-config/local/lib/libpari.so\", \n+            \"/usr/local/src/sage-config/local/lib/libpari.a\", \n+            \"/usr/local/src/sage-config/local/lib/libgmp.so\", \n+            \"/usr/local/src/sage-config/local/lib/libgmp.a\"\n+        ], \n+        \"extra_compile_args\": [\n+            \"-fno-strict-aliasing\", \n+            \"-w\", \n+            \"-fno-tree-dominator-opts\"\n+        ], \n+        \"include_dirs\": [\n+            \"/usr/local/src/sage-config/local/include\", \n+            \"/usr/local/src/sage-config/local/include/python2.7\", \n+            \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include\", \n+            \"/usr/local/src/sage-config/src\", \n+            \"/usr/local/src/sage-config/src/sage/ext\", \n+            \"/usr/local/src/sage-config/src/build/cythonized\", \n+            \"/usr/local/src/sage-config/src/build/cythonized/sage/ext\"\n+        ], \n+        \"libraries\": [\n+            \"pari\", \n+            \"gmp\"\n+        ], \n+        \"library_dirs\": [\n+            \"/usr/local/src/sage-config/local/lib\"\n+        ]\n+    }\n+}\n+END: Cython Metadata */\n+```\n+Note the added dependency on `libgmp.so`.\n``````\n",
    "created_at": "2015-11-19T17:05:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279495",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,52 @@
 ```
 
 This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
+
+After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like
+
+```
+/* Generated by Cython 0.23.3 */
+
+/* BEGIN: Cython Metadata
+{
+    "distutils": {
+        "depends": [
+            "/usr/local/src/sage-config/local/include/python2.7/Python.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/debug.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/implementation.c", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/macros.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/pxi.h", 
+            "/usr/local/src/sage-config/src/sage/ext/interrupt/struct_signals.h", 
+            "/usr/local/src/sage-config/src/setup.py", 
+            "setup.py", 
+            "/usr/local/src/sage-config/local/lib/libpari.so", 
+            "/usr/local/src/sage-config/local/lib/libpari.a", 
+            "/usr/local/src/sage-config/local/lib/libgmp.so", 
+            "/usr/local/src/sage-config/local/lib/libgmp.a"
+        ], 
+        "extra_compile_args": [
+            "-fno-strict-aliasing", 
+            "-w", 
+            "-fno-tree-dominator-opts"
+        ], 
+        "include_dirs": [
+            "/usr/local/src/sage-config/local/include", 
+            "/usr/local/src/sage-config/local/include/python2.7", 
+            "/usr/local/src/sage-config/local/lib/python2.7/site-packages/numpy/core/include", 
+            "/usr/local/src/sage-config/src", 
+            "/usr/local/src/sage-config/src/sage/ext", 
+            "/usr/local/src/sage-config/src/build/cythonized", 
+            "/usr/local/src/sage-config/src/build/cythonized/sage/ext"
+        ], 
+        "libraries": [
+            "pari", 
+            "gmp"
+        ], 
+        "library_dirs": [
+            "/usr/local/src/sage-config/local/lib"
+        ]
+    }
+}
+END: Cython Metadata */
+```
+Note the added dependency on `libgmp.so`.
``````




---

archive/issue_comments_279496.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nhow about putting wrap_create_extension_list into sage_setup?",
    "created_at": "2015-11-19T17:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279496",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

how about putting wrap_create_extension_list into sage_setup?



---

archive/issue_events_277619.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T19:49:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277619"
}
```



---

archive/issue_events_277620.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-19T19:49:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277620"
}
```



---

archive/issue_comments_279497.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThere seems to be a problem with distutils...",
    "created_at": "2015-11-19T19:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279497",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

There seems to be a problem with distutils...



---

archive/issue_events_277621.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-20T06:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277621"
}
```



---

archive/issue_events_277622.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-20T06:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277622"
}
```



---

archive/issue_comments_279498.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,14 @@\n ```\n \n This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n+\n+To test this, first build Sage with this patch. Then run\n+\n+```\n+$ touch local/lib/*.so\n+$ ./sage -b\n+```\n+This will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).\n \n After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like\n \n``````\n",
    "created_at": "2015-11-20T06:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279498",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,14 @@
 ```
 
 This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
+
+To test this, first build Sage with this patch. Then run
+
+```
+$ touch local/lib/*.so
+$ ./sage -b
+```
+This will rebuild 223 Cython extensions (apparently 223 extensions depend on some library).
 
 After applying this patch and running `sage -f sagelib`, the top of `src/build/cythonized/sage/ext/interrupt/interrupt.c` looks like
 
``````




---

archive/issue_comments_279499.json:
```json
{
    "body": "Changed commit from **[`7cd8477`](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)** to **[`84ac62e`](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)**",
    "created_at": "2015-11-20T06:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279499",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7cd8477`](https://github.com/sagemath/sagetrac-mirror/commit/7cd8477bdb031b87607c185c9f2c96fde277943d)** to **[`84ac62e`](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)**



---

archive/issue_comments_279500.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08062a5aaad60eba27f0f4502137b3bf87331a1f\"><code>08062a5</code></a></td><td><code>Remove unused \"sdist\" variable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202\"><code>84ac62e</code></a></td><td><code>Add dependencies both to extension and metadata</code></td></tr></table>\n",
    "created_at": "2015-11-20T06:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279500",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08062a5aaad60eba27f0f4502137b3bf87331a1f"><code>08062a5</code></a></td><td><code>Remove unused "sdist" variable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202"><code>84ac62e</code></a></td><td><code>Add dependencies both to extension and metadata</code></td></tr></table>




---

archive/issue_comments_279501.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )\n\nYou could at least cache the mapping of library names to their (existing, probably single) pathnames (and reuse them instead of creating hundreds of copies); if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.  Not sure whether hardcoding the library folders (`SAGE_LOCAL/lib*/`) there makes sense, or is appropriate.\n\nAfter all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\n\n\n\n`libFOO.dll` is not the convention used on Windows AFAIK; we may specialize according to the platform, also avoiding unnecessary calls of `glob()`.\n\n\n\n\nDo you want to keep the verbose listing of (lengthy!) dependencies by default?\n\n\n\n\nYou've renamed the parameter `library_order` to `library_sort_key`, the docstring of `wrap_create_extension_list()` doesn't yet reflect that change.",
    "created_at": "2015-11-20T09:54:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279501",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:10" align="right">comment:10</div>

Wow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )

You could at least cache the mapping of library names to their (existing, probably single) pathnames (and reuse them instead of creating hundreds of copies); if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.  Not sure whether hardcoding the library folders (`SAGE_LOCAL/lib*/`) there makes sense, or is appropriate.

After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.




`libFOO.dll` is not the convention used on Windows AFAIK; we may specialize according to the platform, also avoiding unnecessary calls of `glob()`.




Do you want to keep the verbose listing of (lengthy!) dependencies by default?




You've renamed the parameter `library_order` to `library_sort_key`, the docstring of `wrap_create_extension_list()` doesn't yet reflect that change.



---

archive/issue_comments_279502.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@nexttime](#comment:10):\n> Wow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )\n\nI'd love to, but I think neither upstream Cython nor upstream distutils will want to support that.\n\n> You could at least cache the mapping of library names to their (existing, probably single) pathnames\n\nRight.\n\n> if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.\n\nWell, it doesn't really hurt either. It's just to be safe.\n\n> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\nAgain, you are right but I don't see an easy way to express this in the build system.\n\n> Do you want to keep the verbose listing of (lengthy!) dependencies by default?\n\nWhich \"verbose listing of (lengthy!) dependencies\"?",
    "created_at": "2015-11-20T10:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279502",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@nexttime](#comment:10):
> Wow, getting more and more inefficient (memory footprint, number of system calls/filesystem accesses).  (W.r.t. reinventing the wheel, we should probably consider dynamically creating Makefiles to build the Sage library... ;-) )

I'd love to, but I think neither upstream Cython nor upstream distutils will want to support that.

> You could at least cache the mapping of library names to their (existing, probably single) pathnames

Right.

> if there's a shared library, you don't have to record another potential static one of the same library -- on *nix at least.

Well, it doesn't really hurt either. It's just to be safe.

> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.

Again, you are right but I don't see an easy way to express this in the build system.

> Do you want to keep the verbose listing of (lengthy!) dependencies by default?

Which "verbose listing of (lengthy!) dependencies"?



---

archive/issue_comments_279503.json:
```json
{
    "body": "Changed commit from **[`84ac62e`](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)** to **[`f3f3966`](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)**",
    "created_at": "2015-11-20T11:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279503",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`84ac62e`](https://github.com/sagemath/sagetrac-mirror/commit/84ac62e907016499a336fd626d3b262a2e5e1202)** to **[`f3f3966`](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)**



---

archive/issue_comments_279504.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/339884252221473dbb5dc74abcacdadf1d546bfd\"><code>3398842</code></a></td><td><code>Cache find_library_files()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581\"><code>f3f3966</code></a></td><td><code>Minor fixes</code></td></tr></table>\n",
    "created_at": "2015-11-20T11:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279504",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/339884252221473dbb5dc74abcacdadf1d546bfd"><code>3398842</code></a></td><td><code>Cache find_library_files()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581"><code>f3f3966</code></a></td><td><code>Minor fixes</code></td></tr></table>




---

archive/issue_comments_279505.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@nexttime](#comment:10):\n> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\nI must say that I find some truth in this. Volker, do you agree that it's simply a bad idea to rely on timestamps of library files?",
    "created_at": "2015-11-20T11:02:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279505",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@nexttime](#comment:10):
> After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.

I must say that I find some truth in this. Volker, do you agree that it's simply a bad idea to rely on timestamps of library files?



---

archive/issue_comments_279506.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Replying to [@nexttime](#comment:10):\n> > After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.\n\n> \n> I must say that I find some truth in this.\n\nIMHO rather a matter of enforcing [people to comply with] such convention.  Just like our \"manual\" spkg dependencies.  (As before, there could be more than one file per library reflecting a significant change that triggers a rebuild.  In fact, for [ELF] shared libraries, the `soname` -- containing the \"major\" version number -- matters, nothing else [should].)",
    "created_at": "2015-11-20T11:20:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279506",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:13):
> Replying to [@nexttime](#comment:10):
> > After all, not relying on (say) timestamps of headers but recompiling and relinking on every change of a shared library is pretty much against one of their purposes.

> 
> I must say that I find some truth in this.

IMHO rather a matter of enforcing [people to comply with] such convention.  Just like our "manual" spkg dependencies.  (As before, there could be more than one file per library reflecting a significant change that triggers a rebuild.  In fact, for [ELF] shared libraries, the `soname` -- containing the "major" version number -- matters, nothing else [should].)



---

archive/issue_events_277623.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-20T12:43:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "title_is": "Fix dependencies on libraries",
    "title_was": "Fix library dependencies",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277623"
}
```



---

archive/issue_comments_279507.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,4 @@\n-After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are\n-\n-```\n-sage/ext/interrupt/interrupt.so\n-sage/symbolic/substitution_map.so\n-sage/symbolic/constants_c.so\n-sage/symbolic/expression.so\n-sage/symbolic/getitem.so\n-```\n-\n-This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n+Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.\n \n To test this, first build Sage with this patch. Then run\n \n``````\n",
    "created_at": "2015-11-20T12:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279507",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,4 @@
-After upgrading MPIR, not all modules depending on MPIR are rebuilt. The offending modules are
-
-```
-sage/ext/interrupt/interrupt.so
-sage/symbolic/substitution_map.so
-sage/symbolic/constants_c.so
-sage/symbolic/expression.so
-sage/symbolic/getitem.so
-```
-
-This is because dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
+Dependencies on library files (e.g. `.so` files) are not picked up by `distutils`. We monkeypatch Cython to add the missing dependencies.
 
 To test this, first build Sage with this patch. Then run
 
``````




---

archive/issue_comments_279508.json:
```json
{
    "body": "Changed commit from **[`f3f3966`](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)** to **[`87834f0`](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**",
    "created_at": "2015-11-20T14:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279508",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f3f3966`](https://github.com/sagemath/sagetrac-mirror/commit/f3f396625d70b1c1c21e3508cdbac5afc0b7e581)** to **[`87834f0`](https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f)**



---

archive/issue_comments_279509.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f\"><code>87834f0</code></a></td><td><code>Use absolute import (otherwise doctesting doesn't work???)</code></td></tr></table>\n",
    "created_at": "2015-11-20T14:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279509",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87834f093c507475c20e5c23991ad0f091aca03f"><code>87834f0</code></a></td><td><code>Use absolute import (otherwise doctesting doesn't work???)</code></td></tr></table>




---

archive/issue_comments_279510.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nRelying no the timestamp of the header sounds good to me.\n\nIt assumes that we don't overlink, but thats obviously to be avoided anyways.",
    "created_at": "2015-11-21T00:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279510",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

Relying no the timestamp of the header sounds good to me.

It assumes that we don't overlink, but thats obviously to be avoided anyways.



---

archive/issue_events_277624.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277624"
}
```



---

archive/issue_events_277625.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277625"
}
```



---

archive/issue_events_277626.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277626"
}
```



---

archive/issue_comments_279511.json:
```json
{
    "body": "Reviewer: **Leif Leonhardy, Volker Braun**",
    "created_at": "2015-11-21T08:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279511",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Leif Leonhardy, Volker Braun**



---

archive/issue_comments_279512.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer** to none",
    "created_at": "2015-11-21T08:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279512",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Jeroen Demeyer** to none



---

archive/issue_events_277627.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277627"
}
```



---

archive/issue_events_277628.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-21T08:21:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277628"
}
```



---

archive/issue_comments_279513.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nSo are we confident that\n\n* this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,\n* all modules linking to them explicitly depend on those,\n* it's sufficiently documented, both for spkg maintainers creating or updating spkgs as well as for reviewers such that they check this still holds?\n\n(I recall in the past occasionally some updates only incidentally worked, but I'm not aware of current trouble besides what Jeroen discovered regarding \"overlinking\" either.  No idea of how well-documented or -known the potential problems are.)",
    "created_at": "2015-11-21T15:38:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279513",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:19" align="right">comment:19</div>

So are we confident that

* this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,
* all modules linking to them explicitly depend on those,
* it's sufficiently documented, both for spkg maintainers creating or updating spkgs as well as for reviewers such that they check this still holds?

(I recall in the past occasionally some updates only incidentally worked, but I'm not aware of current trouble besides what Jeroen discovered regarding "overlinking" either.  No idea of how well-documented or -known the potential problems are.)



---

archive/issue_comments_279514.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nP.S.:  People adding (or significantly changing) extension modules, or changing `module_list.py` should also know the potential pitfalls.\n\nThere should probably be some document / file reflecting which header(s) to use (i.e., to add to a module's `depends`) when linking to some library.  In Sage's `setup.py` we intentionally only add a few `depends` automagically (namely in case a module links to one of the most prominent libraries such as GMP/MPIR).",
    "created_at": "2015-11-21T15:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279514",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">comment:20</div>

P.S.:  People adding (or significantly changing) extension modules, or changing `module_list.py` should also know the potential pitfalls.

There should probably be some document / file reflecting which header(s) to use (i.e., to add to a module's `depends`) when linking to some library.  In Sage's `setup.py` we intentionally only add a few `depends` automagically (namely in case a module links to one of the most prominent libraries such as GMP/MPIR).



---

archive/issue_comments_279515.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@nexttime](#comment:19):\n> So are we confident that\n> \n> * this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,\n\nI just checked\n\n```\nfind local/ -type f |xargs ls -l --sort=time\n```\n\nand the only old files were from `numpy`. So everything except numpy seems to install everything with recent timestamps.",
    "created_at": "2015-11-22T10:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279515",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@nexttime](#comment:19):
> So are we confident that
> 
> * this is currently true for all libraries, i.e., an update (or just reinstallation) of each of them causes some of their header(s) to have newer timestamps,

I just checked

```
find local/ -type f |xargs ls -l --sort=time
```

and the only old files were from `numpy`. So everything except numpy seems to install everything with recent timestamps.



---

archive/issue_comments_279516.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nLet me also add that using\n\n```\n# distutils: ...\n```\ndeclarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.",
    "created_at": "2015-11-22T10:09:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279516",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Let me also add that using

```
# distutils: ...
```
declarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.



---

archive/issue_comments_279517.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@nexttime](#comment:20):\n> i.e., to add to a module's `depends`\n\nExplicitly using `depends` should only be done in exceptional cases where the normal dependency checking doesn't work. #19610 is such an exceptional case (because the dependency is through a `.c` or `.h` file).",
    "created_at": "2015-11-22T10:48:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279517",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@nexttime](#comment:20):
> i.e., to add to a module's `depends`

Explicitly using `depends` should only be done in exceptional cases where the normal dependency checking doesn't work. #19610 is such an exceptional case (because the dependency is through a `.c` or `.h` file).



---

archive/issue_comments_279518.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@jdemeyer](#comment:22):\n> Let me also add that using\n> \n> ```\n> # distutils: ...\n> ```\n> declarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.\n\nAs we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).  This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).",
    "created_at": "2015-11-22T12:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279518",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@jdemeyer](#comment:22):
> Let me also add that using
> 
> ```
> # distutils: ...
> ```
> declarations, the dependency checking is actually easier than the old `src/module_list.py` system. You just need to add the right declarations to the library `.pxd` files.

As we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).  This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).



---

archive/issue_events_277629.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-22T20:57:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277629"
}
```



---

archive/issue_events_277630.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-22T20:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19602#event-277630"
}
```



---

archive/issue_comments_279519.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@nexttime](#comment:24):\n> As we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).\n\nRight, **and this was the reason I created this ticket**.",
    "created_at": "2015-11-23T07:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279519",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@nexttime](#comment:24):
> As we have seen, you can easily add `distutils: libraries = foo bar` **without** making the modules *depend* (in distutils' sense) on the libraries (i.e., their proper headers).

Right, **and this was the reason I created this ticket**.



---

archive/issue_comments_279520.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@nexttime](#comment:24):\n> This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).\n\nI completely disagree with this statement though. Listing libraries in `module_list.py` is much more prone to errors because you manually need to keep track of all libraries that a module uses. Using `module_list.py`, if some module uses PARI functions, I need to change `module_list.py`. With the `# distutils: libraries` declarations, I don't need special effort: I just `cimport sage.libs.pari.foo` and the library gets added automatically.\n\nSo I would say that using `# distutils` makes it easier to get it right (but it's still possible to make mistakes of course).",
    "created_at": "2015-11-23T07:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279520",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@nexttime](#comment:24):
> This was more transparent or obvious in our older `module_list.py` (where we by the way could also use things like `uname_specific()`).

I completely disagree with this statement though. Listing libraries in `module_list.py` is much more prone to errors because you manually need to keep track of all libraries that a module uses. Using `module_list.py`, if some module uses PARI functions, I need to change `module_list.py`. With the `# distutils: libraries` declarations, I don't need special effort: I just `cimport sage.libs.pari.foo` and the library gets added automatically.

So I would say that using `# distutils` makes it easier to get it right (but it's still possible to make mistakes of course).



---

archive/issue_comments_279521.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nSome testing would be nice, e.g. use gcc include dependency output and compare with linked libraries.",
    "created_at": "2015-11-23T07:29:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19602#issuecomment-279521",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:28" align="right">comment:28</div>

Some testing would be nice, e.g. use gcc include dependency output and compare with linked libraries.
