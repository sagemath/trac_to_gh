# Issue 19381: Refactor Graph.__init__

archive/issues_019144.json:
```json
{
    "body": "This (very unpleasant) ticket attempts to clean a bit more the content of `Graph.__init__`.\n\nTo this end, it creates a `graph_input` modules that gathers into individual functions the different pieces of code that build a graph from <any other data>.\n\nAdmittedly, this is just one step toward a cleaner graph constructor, but we are not there yet.\n\nNothing smart is done in this branch: the pieces of code from `Graph.__init__` are moved to new individual functions (some variables/parameters are renamed). One from `DiGraph.__init__` is moved too.\n\nIn particular, some pieces of code from `DiGraph.__init__` may eventually be merged with the functions that this branch creates, but this will be done later.\n\nThis branch is already sufficiently long and sufficiently unpleasant to write/review `:-/`\n\nNathann\n\nCC:  borassi @dcoudert @dimpase @videlec\n\nBranch/Commit: 9bdf527fd59509647ccefd86cbd87bb2e92071b4\n\nReviewer: David Coudert\n\nAuthor: Nathann Cohen\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19381\n\n",
    "closed_at": "2015-10-14T00:59:19Z",
    "created_at": "2015-10-09T10:53:10Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Refactor Graph.__init__",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19381",
    "user": "https://github.com/nathanncohen"
}
```
This (very unpleasant) ticket attempts to clean a bit more the content of `Graph.__init__`.

To this end, it creates a `graph_input` modules that gathers into individual functions the different pieces of code that build a graph from <any other data>.

Admittedly, this is just one step toward a cleaner graph constructor, but we are not there yet.

Nothing smart is done in this branch: the pieces of code from `Graph.__init__` are moved to new individual functions (some variables/parameters are renamed). One from `DiGraph.__init__` is moved too.

In particular, some pieces of code from `DiGraph.__init__` may eventually be merged with the functions that this branch creates, but this will be done later.

This branch is already sufficiently long and sufficiently unpleasant to write/review `:-/`

Nathann

CC:  borassi @dcoudert @dimpase @videlec

Branch/Commit: 9bdf527fd59509647ccefd86cbd87bb2e92071b4

Reviewer: David Coudert

Author: Nathann Cohen

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19381





---

archive/issue_comments_279493.json:
```json
{
    "body": "<a id='comment:1'></a>Last 10 new commits:",
    "created_at": "2015-10-09T10:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279493",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>Last 10 new commits:



---

archive/issue_comments_279494.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-09T10:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279494",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_279495.json:
```json
{
    "body": "<a id='comment:2'></a>Would it be possible in this ticket to add support for constructing a graph by `[V, E]` like this:\n\n```\nsage: V = [1,2,3,4]\nsage: E = [[1,2]]\nsage: Graph([V, E])\n```\nI know I can do it like this\n\n```\nsage: G = Graph({1:[2], 2:[], 3:[], 4:[]})\nsage: G.vertices()\n[1, 2, 3, 4]\n```\nbut this is somewhat cumbersome (and doesn't work for graphs with labeled (multiple) edges). The other way I know how to do this is I have to pass the edge set, then add the vertices.\n\nThe reason I ask is because I have wanted to create immutable graphs with larger vertex sets than the connectivity of the edges and I don't want to have to waste time copying a mutable graph backend into the static backend. (As an additional reason, it also follows the basic intro to combinatorics definition of a graph.)\n\nI should also be able to review this ticket too (and I definitely will if you make the above change).",
    "created_at": "2015-10-09T11:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279495",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>Would it be possible in this ticket to add support for constructing a graph by `[V, E]` like this:

```
sage: V = [1,2,3,4]
sage: E = [[1,2]]
sage: Graph([V, E])
```
I know I can do it like this

```
sage: G = Graph({1:[2], 2:[], 3:[], 4:[]})
sage: G.vertices()
[1, 2, 3, 4]
```
but this is somewhat cumbersome (and doesn't work for graphs with labeled (multiple) edges). The other way I know how to do this is I have to pass the edge set, then add the vertices.

The reason I ask is because I have wanted to create immutable graphs with larger vertex sets than the connectivity of the edges and I don't want to have to waste time copying a mutable graph backend into the static backend. (As an additional reason, it also follows the basic intro to combinatorics definition of a graph.)

I should also be able to review this ticket too (and I definitely will if you make the above change).



---

archive/issue_comments_279496.json:
```json
{
    "body": "<a id='comment:3'></a>> Would it be possible in this ticket to add support for constructing a graph by `[V, E]` like this:\n\n\nCertainly not in this ticket. It refactors code, and it is already (as you can see) a lot to review. I guess it can be done in another ticket, though, I don't thing that there is any problem. With 5-6 lines any ambiguity with the other kind of inputs can be cleared ([V,f], list_of_edges, ...)\n\n> I know I can do it like this\n> \n> ```\n> sage: G = Graph({1:[2], 2:[], 3:[], 4:[]})\n> sage: G.vertices()\n> [1, 2, 3, 4]\n> ```\n> but this is somewhat cumbersome (and doesn't work for graphs with labeled (multiple) edges).\n\n\n```\nsage: Graph({1:{2:['l1','l2']}},multiedges=True).edges()\n[(1, 2, 'l1'), (1, 2, 'l2')]\n```\n\nSee also `Graph.to_dictionary` which generates this kind of output.\n\nNathann",
    "created_at": "2015-10-09T12:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279496",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>> Would it be possible in this ticket to add support for constructing a graph by `[V, E]` like this:


Certainly not in this ticket. It refactors code, and it is already (as you can see) a lot to review. I guess it can be done in another ticket, though, I don't thing that there is any problem. With 5-6 lines any ambiguity with the other kind of inputs can be cleared ([V,f], list_of_edges, ...)

> I know I can do it like this
> 
> ```
> sage: G = Graph({1:[2], 2:[], 3:[], 4:[]})
> sage: G.vertices()
> [1, 2, 3, 4]
> ```
> but this is somewhat cumbersome (and doesn't work for graphs with labeled (multiple) edges).


```
sage: Graph({1:{2:['l1','l2']}},multiedges=True).edges()
[(1, 2, 'l1'), (1, 2, 'l2')]
```

See also `Graph.to_dictionary` which generates this kind of output.

Nathann



---

archive/issue_comments_279497.json:
```json
{
    "body": "<a id='comment:4'></a>- `Note: This is a internal...` -> 'an internal`?\n\nPreliminary tests are ok and the doc build and display properly.\nI'm currently running tests on `sage/graphs/`. I'll let you know soon.",
    "created_at": "2015-10-09T14:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279497",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>- `Note: This is a internal...` -> 'an internal`?

Preliminary tests are ok and the doc build and display properly.
I'm currently running tests on `sage/graphs/`. I'll let you know soon.



---

archive/issue_comments_279498.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-09T14:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279499.json:
```json
{
    "body": "<a id='comment:6'></a>hey, your commit messages have the ticket number wrong...",
    "created_at": "2015-10-09T16:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279499",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>hey, your commit messages have the ticket number wrong...



---

archive/issue_comments_279500.json:
```json
{
    "body": "<a id='comment:7'></a>For me the patch is good to go, but I don't know if Nathann has something to do about the commit ticket numbers...\n\nNote: the (possible) segfault in the test `src/sage/graphs` is independent from this patch and is resolved in #19337.",
    "created_at": "2015-10-09T16:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279500",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>For me the patch is good to go, but I don't know if Nathann has something to do about the commit ticket numbers...

Note: the (possible) segfault in the test `src/sage/graphs` is independent from this patch and is resolved in #19337.



---

archive/issue_comments_279501.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2015-10-09T16:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279501",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_279502.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 dcoudert]:\n> For me the patch is good to go, but I don't know if Nathann has something to do about the commit ticket numbers...\n\n\nwell, he adds these numbers by hand. \nIf you think it's OK, then it's OK with me, too.\n\n> \n> Note: the (possible) segfault in the test `src/sage/graphs` is independent from this patch and is resolved in #19337.",
    "created_at": "2015-10-09T16:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279502",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:7 dcoudert]:
> For me the patch is good to go, but I don't know if Nathann has something to do about the commit ticket numbers...


well, he adds these numbers by hand. 
If you think it's OK, then it's OK with me, too.

> 
> Note: the (possible) segfault in the test `src/sage/graphs` is independent from this patch and is resolved in #19337.



---

archive/issue_comments_279503.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-09T16:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279503",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_279504.json:
```json
{
    "body": "<a id='comment:10'></a>Then let's go!",
    "created_at": "2015-10-09T16:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279504",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>Then let's go!



---

archive/issue_comments_279505.json:
```json
{
    "body": "<a id='comment:11'></a>Thaaaaaaaaanks for this quick review `O_O`\n\nNathann",
    "created_at": "2015-10-09T18:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279505",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>Thaaaaaaaaanks for this quick review `O_O`

Nathann



---

archive/issue_comments_279506.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-14T00:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19381#issuecomment-279506",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053591.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-14T00:59:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19381",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19381#event-53591"
}
```
