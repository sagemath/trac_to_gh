# Issue 19771: Coefficient coercion for Steenrod algebra coproducts

archive/issues_019534.json:
```json
{
    "body": "This ticket fixes two small issues noticed in #18264, without having to wait for #18264:\n\n- The comultiplication in the Steenrod algebra would result in maltyped output (the output had coefficients in the integers rather than in the base ring).\n\n- The doc of NSym had some doctests that relied on the free-module framework being cavalier about coefficient types.\n\nCC:  @nthiery @tscrim sage-combinat\n\nKeywords: coercion, free modules, steenrod algebra, noncommutative symmetric functions\n\nBranch/Commit: 5a92963f3491891336a59740470c273ade394a28\n\nReviewer: John Palmieri\n\nAuthor: Darij Grinberg\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19771\n\n",
    "closed_at": "2015-12-25T16:16:39Z",
    "created_at": "2015-12-23T16:14:15Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Coefficient coercion for Steenrod algebra coproducts",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19771",
    "user": "https://github.com/darijgr"
}
```
This ticket fixes two small issues noticed in #18264, without having to wait for #18264:

- The comultiplication in the Steenrod algebra would result in maltyped output (the output had coefficients in the integers rather than in the base ring).

- The doc of NSym had some doctests that relied on the free-module framework being cavalier about coefficient types.

CC:  @nthiery @tscrim sage-combinat

Keywords: coercion, free modules, steenrod algebra, noncommutative symmetric functions

Branch/Commit: 5a92963f3491891336a59740470c273ade394a28

Reviewer: John Palmieri

Author: Darij Grinberg

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19771





---

archive/issue_comments_285509.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2015-12-23T16:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285509",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_285510.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-23T16:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285510",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_285511.json:
```json
{
    "body": "<a id='comment:2'></a>The Steenrod algebra change looks good, but I get doctest failures in `ncsf.py`.\n\n```\nsage -t --warn-long 53.1 src/sage/combinat/ncsf_qsym/ncsf.py\n**********************************************************************\nFile \"src/sage/combinat/ncsf_qsym/ncsf.py\", line 4221, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung\nFailed example:\n    test_phi(4, 2)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[18]>\", line 1, in <module>\n        test_phi(Integer(4), Integer(2))\n      File \"<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>\", line 3, in test_phi\n        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):\n      File \"sage/structure/parent.pyx\", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)\n        return C._element_constructor(x)\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py\", line 1325, in _element_constructor_\n        raise TypeError(\"do not know how to make x (= %s) an element of self (=%s)\"%(x,self))\n    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)\n**********************************************************************\nFile \"src/sage/combinat/ncsf_qsym/ncsf.py\", line 4223, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung\nFailed example:\n    test_phi(6, 2)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[19]>\", line 1, in <module>\n        test_phi(Integer(6), Integer(2))\n      File \"<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>\", line 3, in test_phi\n        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):\n      File \"sage/structure/parent.pyx\", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)\n        return C._element_constructor(x)\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py\", line 1325, in _element_constructor_\n        raise TypeError(\"do not know how to make x (= %s) an element of self (=%s)\"%(x,self))\n    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)\n**********************************************************************\nFile \"src/sage/combinat/ncsf_qsym/ncsf.py\", line 4225, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung\nFailed example:\n    test_phi(6, 3)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[20]>\", line 1, in <module>\n        test_phi(Integer(6), Integer(3))\n      File \"<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>\", line 3, in test_phi\n        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):\n      File \"sage/structure/parent.pyx\", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)\n        return C._element_constructor(x)\n      File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py\", line 1325, in _element_constructor_\n        raise TypeError(\"do not know how to make x (= %s) an element of self (=%s)\"%(x,self))\n    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)\n**********************************************************************\n1 item had failures:\n   3 of  22 in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung\n    [768 tests, 3 failures, 8.17 s]\n----------------------------------------------------------------------\nsage -t --warn-long 53.1 src/sage/combinat/ncsf_qsym/ncsf.py  # 3 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2015-12-23T21:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285511",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>The Steenrod algebra change looks good, but I get doctest failures in `ncsf.py`.

```
sage -t --warn-long 53.1 src/sage/combinat/ncsf_qsym/ncsf.py
**********************************************************************
File "src/sage/combinat/ncsf_qsym/ncsf.py", line 4221, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
Failed example:
    test_phi(4, 2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[18]>", line 1, in <module>
        test_phi(Integer(4), Integer(2))
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>", line 3, in test_phi
        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):
      File "sage/structure/parent.pyx", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)
        raise
      File "sage/structure/coerce_maps.pyx", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)
        return C._element_constructor(x)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py", line 1325, in _element_constructor_
        raise TypeError("do not know how to make x (= %s) an element of self (=%s)"%(x,self))
    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)
**********************************************************************
File "src/sage/combinat/ncsf_qsym/ncsf.py", line 4223, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
Failed example:
    test_phi(6, 2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[19]>", line 1, in <module>
        test_phi(Integer(6), Integer(2))
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>", line 3, in test_phi
        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):
      File "sage/structure/parent.pyx", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)
        raise
      File "sage/structure/coerce_maps.pyx", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)
        return C._element_constructor(x)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py", line 1325, in _element_constructor_
        raise TypeError("do not know how to make x (= %s) an element of self (=%s)"%(x,self))
    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)
**********************************************************************
File "src/sage/combinat/ncsf_qsym/ncsf.py", line 4225, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
Failed example:
    test_phi(6, 3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[20]>", line 1, in <module>
        test_phi(Integer(6), Integer(3))
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>", line 3, in test_phi
        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):
      File "sage/structure/parent.pyx", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)
        raise
      File "sage/structure/coerce_maps.pyx", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)
        return C._element_constructor(x)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py", line 1325, in _element_constructor_
        raise TypeError("do not know how to make x (= %s) an element of self (=%s)"%(x,self))
    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)
**********************************************************************
1 item had failures:
   3 of  22 in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
    [768 tests, 3 failures, 8.17 s]
----------------------------------------------------------------------
sage -t --warn-long 53.1 src/sage/combinat/ncsf_qsym/ncsf.py  # 3 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_comments_285512.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-23T21:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285512",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_285513.json:
```json
{
    "body": "<a id='comment:4'></a>Oops, this was me being stupid. Fixed, and thanks!",
    "created_at": "2015-12-24T09:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285513",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:4'></a>Oops, this was me being stupid. Fixed, and thanks!



---

archive/issue_comments_285514.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-24T09:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285514",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_285515.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-24T09:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285516.json:
```json
{
    "body": "<a id='comment:6'></a>Looks good.",
    "created_at": "2015-12-24T19:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285516",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>Looks good.



---

archive/issue_comments_285517.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-24T19:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285517",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285518.json:
```json
{
    "body": "<a id='comment:7'></a>Thank you! (And have some nice holidays.)",
    "created_at": "2015-12-24T19:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285518",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:7'></a>Thank you! (And have some nice holidays.)



---

archive/issue_events_054163.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-25T16:16:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19771#event-54163"
}
```



---

archive/issue_comments_285519.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-25T16:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19771#issuecomment-285519",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
