# Issue 19112: Add a function "isometry" to the quadratic forms package.

archive/issues_018875.json:
```json
{
    "assignees": [],
    "body": "Adds a function \"isometry\" that returns an isometry from one rational quadratic form to another, provided that it exists.\n\nCC:  @annahaensch @sagetrac-tgaona\n\nKeywords: **isometry**\n\nBranch: **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)**\n\nReviewer: **Simon Brandhorst**\n\nAuthor: **Tyler Gaona, Simon Brandhorst**\n\nComponent: **quadratic forms**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19112_\n\n",
    "closed_at": "2020-11-07T16:23:29Z",
    "created_at": "2015-08-30T20:00:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20quadratic%20forms",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add a function \"isometry\" to the quadratic forms package.",
    "type": "issue",
    "updated_at": "2021-05-09T23:14:21Z",
    "url": "https://github.com/sagemath/sage/issues/19112",
    "user": "https://github.com/sagetrac-tgaona"
}
```
Adds a function "isometry" that returns an isometry from one rational quadratic form to another, provided that it exists.

CC:  @annahaensch @sagetrac-tgaona

Keywords: **isometry**

Branch: **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)**

Reviewer: **Simon Brandhorst**

Author: **Tyler Gaona, Simon Brandhorst**

Component: **quadratic forms**

_Issue created by migration from https://trac.sagemath.org/ticket/19112_





---

archive/issue_events_271261.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-08-30T20:00:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271261"
}
```



---

archive/issue_events_271262.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-08-30T20:00:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20quadratic%20forms",
    "label_color": "0000ff",
    "label_name": "c: quadratic forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271262"
}
```



---

archive/issue_events_271263.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-08-30T20:00:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271263"
}
```



---

archive/issue_events_271264.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-08-30T20:00:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271264"
}
```



---

archive/issue_comments_269982.json:
```json
{
    "body": "Branch: **[u/tgaona/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/tgaona/ticket/19112)**",
    "created_at": "2015-11-01T21:44:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269982",
    "user": "https://github.com/sagetrac-tgaona"
}
```

Branch: **[u/tgaona/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/tgaona/ticket/19112)**



---

archive/issue_comments_269983.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d32f4be61421da6f14f8b871478dd3501fe5204\"><code>0d32f4b</code></a></td><td><code>Implements a method to compute isometries between positive definite quadratic forms.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e211fecd4b525ad30276d37d442a68ce9bec8f0\"><code>9e211fe</code></a></td><td><code>Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's</code></td></tr></table>\n",
    "created_at": "2015-11-01T21:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269983",
    "user": "https://github.com/sagetrac-tgaona"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d32f4be61421da6f14f8b871478dd3501fe5204"><code>0d32f4b</code></a></td><td><code>Implements a method to compute isometries between positive definite quadratic forms.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e211fecd4b525ad30276d37d442a68ce9bec8f0"><code>9e211fe</code></a></td><td><code>Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's</code></td></tr></table>




---

archive/issue_comments_269984.json:
```json
{
    "body": "Commit: **[`9e211fe`](https://github.com/sagemath/sagetrac-mirror/commit/9e211fecd4b525ad30276d37d442a68ce9bec8f0)**",
    "created_at": "2015-11-01T21:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269984",
    "user": "https://github.com/sagetrac-tgaona"
}
```

Commit: **[`9e211fe`](https://github.com/sagemath/sagetrac-mirror/commit/9e211fecd4b525ad30276d37d442a68ce9bec8f0)**



---

archive/issue_events_271265.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-11-01T21:46:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271265"
}
```



---

archive/issue_comments_269985.json:
```json
{
    "body": "Changed work issues from **needs implementation** to none",
    "created_at": "2015-11-02T18:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269985",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **needs implementation** to none



---

archive/issue_comments_269986.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis looks like it reinvents the already-existing method `is_globally_equivalent_to`. What does your code add?",
    "created_at": "2015-11-02T18:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269986",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

This looks like it reinvents the already-existing method `is_globally_equivalent_to`. What does your code add?



---

archive/issue_events_271266.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-02T18:22:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271266"
}
```



---

archive/issue_events_271267.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-02T18:22:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271267"
}
```



---

archive/issue_events_271268.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-02T18:22:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271268"
}
```



---

archive/issue_events_271269.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-02T18:22:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271269"
}
```



---

archive/issue_comments_269987.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHi Jeroen,\n\nSorry for the slow response. This method should be able to return isometries for forms over fields, where I believe is_globally_equivalent_to just works over the ring of integers. For example:\n\n```\nsage: Q = DiagonalQuadraticForm(QQ, [1, 5])\nsage: F = QuadraticForm(QQ, 2, [1, 12, 81])\nsage: Q.is_globally_equivalent_to(F)\nFalse\nsage: Q.is_rationally_isometric(F)\nTrue\nsage: T = Q.isometry(F)\nsage: T\n[  1  -2]\n[  0 1/3]\nsage: Q.Gram_matrix() == T.transpose() * F.Gram_matrix() * T\nTrue\n```\n\nSo Q is equivalent to F over the rationals, but is_globally_equivalent_to doesn't recognize this. This method was intended to complement the is_rationally_isometric method, so perhaps it should be refactored to work in a similar manner as is_globally_equivalent_to, i.e, adding an optional flag to is_rationally_isometric to return the transition matrix for the isometry.",
    "created_at": "2015-11-03T22:42:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269987",
    "user": "https://github.com/sagetrac-tgaona"
}
```

<div id="comment:4" align="right">comment:4</div>

Hi Jeroen,

Sorry for the slow response. This method should be able to return isometries for forms over fields, where I believe is_globally_equivalent_to just works over the ring of integers. For example:

```
sage: Q = DiagonalQuadraticForm(QQ, [1, 5])
sage: F = QuadraticForm(QQ, 2, [1, 12, 81])
sage: Q.is_globally_equivalent_to(F)
False
sage: Q.is_rationally_isometric(F)
True
sage: T = Q.isometry(F)
sage: T
[  1  -2]
[  0 1/3]
sage: Q.Gram_matrix() == T.transpose() * F.Gram_matrix() * T
True
```

So Q is equivalent to F over the rationals, but is_globally_equivalent_to doesn't recognize this. This method was intended to complement the is_rationally_isometric method, so perhaps it should be refactored to work in a similar manner as is_globally_equivalent_to, i.e, adding an optional flag to is_rationally_isometric to return the transition matrix for the isometry.



---

archive/issue_comments_269988.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nRight, I think it's better to mention this more clearly in the documentation (I always get confused when quadratic-form people talk about isomorphic/isometric/equivalent, I never know what they mean).",
    "created_at": "2015-11-04T13:55:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269988",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Right, I think it's better to mention this more clearly in the documentation (I always get confused when quadratic-form people talk about isomorphic/isometric/equivalent, I never know what they mean).



---

archive/issue_comments_269989.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThat being said, I think you are really over-complicating the algorithm.\n\nSuppose one of the forms is given by the diagonal `5*x0^2 + ...`. Then really all you need to do in the first step is to find a vector `v` of \"length\" 5. This can be done with some algorithm based on PARI's `qfsolve()`: the only issue is that `qfsolve()` finds a projective point, but you really want an affine point.\n\nSo I suggest to do the following:\n1. implement an affine version of `qfsolve()` to solve equations of the form `Q(x) = C` where `Q` is a quadratic form and `C` is a constant. Do this in a separate Sage ticket.\n2. use this new function to implement `isometry` on this ticket.\n\nThis will have several major advantages:\n1. your code will be a lot faster.\n2. it will no longer run forever if there is isometry (which is unacceptable).\n3. you can remove the assumption that your quadratic form is positive-definite.",
    "created_at": "2015-11-04T14:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269989",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

That being said, I think you are really over-complicating the algorithm.

Suppose one of the forms is given by the diagonal `5*x0^2 + ...`. Then really all you need to do in the first step is to find a vector `v` of "length" 5. This can be done with some algorithm based on PARI's `qfsolve()`: the only issue is that `qfsolve()` finds a projective point, but you really want an affine point.

So I suggest to do the following:
1. implement an affine version of `qfsolve()` to solve equations of the form `Q(x) = C` where `Q` is a quadratic form and `C` is a constant. Do this in a separate Sage ticket.
2. use this new function to implement `isometry` on this ticket.

This will have several major advantages:
1. your code will be a lot faster.
2. it will no longer run forever if there is isometry (which is unacceptable).
3. you can remove the assumption that your quadratic form is positive-definite.



---

archive/issue_comments_269990.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAlso, your branch is based on an old version of Sage. You should really develop from the latest beta version (currently `6.10.beta2`).",
    "created_at": "2015-11-04T14:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269990",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Also, your branch is based on an old version of Sage. You should really develop from the latest beta version (currently `6.10.beta2`).



---

archive/issue_comments_269991.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nPlease follow [http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings) for the correct formatting of docstrings.",
    "created_at": "2015-11-04T14:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269991",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Please follow [http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings) for the correct formatting of docstrings.



---

archive/issue_events_271270.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-04T14:12:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271270"
}
```



---

archive/issue_events_271271.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-04T14:12:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271271"
}
```



---

archive/issue_comments_269992.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI will make it more clear in the documentation that the method returns a transformation matrix, as opposed to saying it returns an isometry.\n\nAs to your second point, I agree that a cleaner, more efficient replacement for the first step of the algorithm is very desirable. However, I have looked at the source for PARI's `qfsolve()` and it isn't clear to me how to adapt it to return an affine vector `x` such that `Q(x) = C`. I would appreciate it if you could offer more guidance here, otherwise, I'm not sure how to proceed.\n\n> 2. it will no longer run forever if there is isometry (which is unacceptable).\n\nI can fix this by throwing an exception when `is_rationally_isometric()` returns false for the two forms. The reason I didn't include this initially is that I was working off of Sage 6.8 but `is_rationally_isometric()` was added in 6.9.\n\nI will fix the formatting in the docstring.",
    "created_at": "2015-11-04T22:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269992",
    "user": "https://github.com/sagetrac-tgaona"
}
```

<div id="comment:10" align="right">comment:10</div>

I will make it more clear in the documentation that the method returns a transformation matrix, as opposed to saying it returns an isometry.

As to your second point, I agree that a cleaner, more efficient replacement for the first step of the algorithm is very desirable. However, I have looked at the source for PARI's `qfsolve()` and it isn't clear to me how to adapt it to return an affine vector `x` such that `Q(x) = C`. I would appreciate it if you could offer more guidance here, otherwise, I'm not sure how to proceed.

> 2. it will no longer run forever if there is isometry (which is unacceptable).

I can fix this by throwing an exception when `is_rationally_isometric()` returns false for the two forms. The reason I didn't include this initially is that I was working off of Sage 6.8 but `is_rationally_isometric()` was added in 6.9.

I will fix the formatting in the docstring.



---

archive/issue_comments_269993.json:
```json
{
    "body": "Dependencies: **#18669**",
    "created_at": "2015-11-05T10:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269993",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#18669**



---

archive/issue_comments_269994.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nGiven that your new functionality relies on `rational_diagonal_form()`, it would be a lot better in fact to base your patch on top of #18669.",
    "created_at": "2015-11-05T10:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269994",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Given that your new functionality relies on `rational_diagonal_form()`, it would be a lot better in fact to base your patch on top of #18669.



---

archive/issue_comments_269995.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAbout solving quadratic forms:\n\nSuppose you want to solve `Q(x) = c`. Consider the quadratic form `Q(x) - c*z^2 = 0`, where `z` is an extra variable. Find a solution `(x,z)` to this quadratic form using `qfsolve()`.\n\n**Case 1**: If `z != 0`, then `Q(x/z) = c`.\n\n**Case 2**: We found a solution `Q(x) = 0`. Let `e` be any vector such that `B(x,e) != 0`, where `B` is the bilinear form corresponding to `Q`. To find `e`, just try all unit vectors `(0,..0,1,0...0)`. Let `a = (c - Q(e))/B(x,e)` and let `y = e + a*x`. Then `Q(y) = c`.\n\nIt would be great if you could implement this on a separate ticket.",
    "created_at": "2015-11-05T11:00:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269995",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

About solving quadratic forms:

Suppose you want to solve `Q(x) = c`. Consider the quadratic form `Q(x) - c*z^2 = 0`, where `z` is an extra variable. Find a solution `(x,z)` to this quadratic form using `qfsolve()`.

**Case 1**: If `z != 0`, then `Q(x/z) = c`.

**Case 2**: We found a solution `Q(x) = 0`. Let `e` be any vector such that `B(x,e) != 0`, where `B` is the bilinear form corresponding to `Q`. To find `e`, just try all unit vectors `(0,..0,1,0...0)`. Let `a = (c - Q(e))/B(x,e)` and let `y = e + a*x`. Then `Q(y) = c`.

It would be great if you could implement this on a separate ticket.



---

archive/issue_comments_269996.json:
```json
{
    "body": "Changed dependencies from **#18669** to **#18669 #19533**",
    "created_at": "2015-11-06T01:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269996",
    "user": "https://github.com/sagetrac-tgaona"
}
```

Changed dependencies from **#18669** to **#18669 #19533**



---

archive/issue_comments_269997.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThanks for the clear explanation. I've opened up a separate ticket for this, and will address the various changes you've suggested.",
    "created_at": "2015-11-06T01:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269997",
    "user": "https://github.com/sagetrac-tgaona"
}
```

<div id="comment:13" align="right">comment:13</div>

Thanks for the clear explanation. I've opened up a separate ticket for this, and will address the various changes you've suggested.



---

archive/issue_comments_269998.json:
```json
{
    "body": "Changed commit from **[`9e211fe`](https://github.com/sagemath/sagetrac-mirror/commit/9e211fecd4b525ad30276d37d442a68ce9bec8f0)** to **[`afcd21b`](https://github.com/sagemath/sagetrac-mirror/commit/afcd21b014a9c543b02c0b957c6d2c028d60b17f)**",
    "created_at": "2015-11-12T21:14:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269998",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9e211fe`](https://github.com/sagemath/sagetrac-mirror/commit/9e211fecd4b525ad30276d37d442a68ce9bec8f0)** to **[`afcd21b`](https://github.com/sagemath/sagetrac-mirror/commit/afcd21b014a9c543b02c0b957c6d2c028d60b17f)**



---

archive/issue_comments_269999.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51ba9f8f06040341cade6f602254ddc3ede7cee1\"><code>51ba9f8</code></a></td><td><code>Adds isometry method for quadratic forms.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/afcd21b014a9c543b02c0b957c6d2c028d60b17f\"><code>afcd21b</code></a></td><td><code>Merge branch 'research' into ticket/19112</code></td></tr></table>\n",
    "created_at": "2015-11-12T21:14:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-269999",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51ba9f8f06040341cade6f602254ddc3ede7cee1"><code>51ba9f8</code></a></td><td><code>Adds isometry method for quadratic forms.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/afcd21b014a9c543b02c0b957c6d2c028d60b17f"><code>afcd21b</code></a></td><td><code>Merge branch 'research' into ticket/19112</code></td></tr></table>




---

archive/issue_comments_270000.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a040f3e2bdc5b312bd14b1fe36e85dda87ead91\"><code>8a040f3</code></a></td><td><code>Merge branch 'develop' into ticket/19112</code></td></tr></table>\n",
    "created_at": "2015-11-12T21:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270000",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a040f3e2bdc5b312bd14b1fe36e85dda87ead91"><code>8a040f3</code></a></td><td><code>Merge branch 'develop' into ticket/19112</code></td></tr></table>




---

archive/issue_comments_270001.json:
```json
{
    "body": "Changed commit from **[`afcd21b`](https://github.com/sagemath/sagetrac-mirror/commit/afcd21b014a9c543b02c0b957c6d2c028d60b17f)** to **[`8a040f3`](https://github.com/sagemath/sagetrac-mirror/commit/8a040f3e2bdc5b312bd14b1fe36e85dda87ead91)**",
    "created_at": "2015-11-12T21:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270001",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`afcd21b`](https://github.com/sagemath/sagetrac-mirror/commit/afcd21b014a9c543b02c0b957c6d2c028d60b17f)** to **[`8a040f3`](https://github.com/sagemath/sagetrac-mirror/commit/8a040f3e2bdc5b312bd14b1fe36e85dda87ead91)**



---

archive/issue_comments_270002.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ee588dd37871a4a28e7db768e66ab4a44dacd3e\"><code>3ee588d</code></a></td><td><code>Use PARI to diagonalize quadratic forms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2689325b940f209728dd1a83091be2cdac2fcbc8\"><code>2689325</code></a></td><td><code>Merge tag '6.10.beta1' into t/18669/use_pari_to_compute_rational_diagonal_form__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45cbc2dea350f0adfbd366fe8048ce8ef840983e\"><code>45cbc2d</code></a></td><td><code>Further fixes to rational diagonal form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee778c87c15f75c5243ff5fd0da38efa85129335\"><code>ee778c8</code></a></td><td><code>Implements a method to compute isometries between positive definite quadratic forms.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27b21901366cf4dac41e41a247ab930a95d2df7a\"><code>27b2190</code></a></td><td><code>Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92de9efe06c5236871f5faeacabe36a24378114e\"><code>92de9ef</code></a></td><td><code>Adds isometry method for quadratic forms.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b1a5744240fc03a9dbbaa6ab3ef700f9d23f0e7\"><code>1b1a574</code></a></td><td><code>Merge branch 'ticket/19533' into ticket/19112</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f8ebc70a1b236e1ca765b7cbc982587694f6a77\"><code>2f8ebc7</code></a></td><td><code>Bug fixes in 'isometry' method and refactoring to utilize the 'solve' method for quadratic forms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f8ce1575dcfb53fee524a9e546d297d22aa82a0\"><code>8f8ce15</code></a></td><td><code>Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into ticket/19112</code></td></tr></table>\n",
    "created_at": "2015-12-01T22:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270002",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ee588dd37871a4a28e7db768e66ab4a44dacd3e"><code>3ee588d</code></a></td><td><code>Use PARI to diagonalize quadratic forms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2689325b940f209728dd1a83091be2cdac2fcbc8"><code>2689325</code></a></td><td><code>Merge tag '6.10.beta1' into t/18669/use_pari_to_compute_rational_diagonal_form__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45cbc2dea350f0adfbd366fe8048ce8ef840983e"><code>45cbc2d</code></a></td><td><code>Further fixes to rational diagonal form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee778c87c15f75c5243ff5fd0da38efa85129335"><code>ee778c8</code></a></td><td><code>Implements a method to compute isometries between positive definite quadratic forms.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27b21901366cf4dac41e41a247ab930a95d2df7a"><code>27b2190</code></a></td><td><code>Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92de9efe06c5236871f5faeacabe36a24378114e"><code>92de9ef</code></a></td><td><code>Adds isometry method for quadratic forms.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b1a5744240fc03a9dbbaa6ab3ef700f9d23f0e7"><code>1b1a574</code></a></td><td><code>Merge branch 'ticket/19533' into ticket/19112</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f8ebc70a1b236e1ca765b7cbc982587694f6a77"><code>2f8ebc7</code></a></td><td><code>Bug fixes in 'isometry' method and refactoring to utilize the 'solve' method for quadratic forms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f8ce1575dcfb53fee524a9e546d297d22aa82a0"><code>8f8ce15</code></a></td><td><code>Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into ticket/19112</code></td></tr></table>




---

archive/issue_comments_270003.json:
```json
{
    "body": "Changed commit from **[`8a040f3`](https://github.com/sagemath/sagetrac-mirror/commit/8a040f3e2bdc5b312bd14b1fe36e85dda87ead91)** to **[`8f8ce15`](https://github.com/sagemath/sagetrac-mirror/commit/8f8ce1575dcfb53fee524a9e546d297d22aa82a0)**",
    "created_at": "2015-12-01T22:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270003",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8a040f3`](https://github.com/sagemath/sagetrac-mirror/commit/8a040f3e2bdc5b312bd14b1fe36e85dda87ead91)** to **[`8f8ce15`](https://github.com/sagemath/sagetrac-mirror/commit/8f8ce1575dcfb53fee524a9e546d297d22aa82a0)**



---

archive/issue_events_271272.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-12-01T22:39:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271272"
}
```



---

archive/issue_events_271273.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-12-01T22:39:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271273"
}
```



---

archive/issue_comments_270004.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nCan you review #18669?",
    "created_at": "2015-12-02T08:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270004",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Can you review #18669?



---

archive/issue_comments_270005.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe patchbot complains about a TAB character.",
    "created_at": "2015-12-04T14:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270005",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

The patchbot complains about a TAB character.



---

archive/issue_comments_270006.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2b3dde11edb22ba199d4666b99ad753865c5322\"><code>d2b3dde</code></a></td><td><code>Removed errant TAB character in quadratic_form.py</code></td></tr></table>\n",
    "created_at": "2015-12-04T17:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270006",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2b3dde11edb22ba199d4666b99ad753865c5322"><code>d2b3dde</code></a></td><td><code>Removed errant TAB character in quadratic_form.py</code></td></tr></table>




---

archive/issue_comments_270007.json:
```json
{
    "body": "Changed commit from **[`8f8ce15`](https://github.com/sagemath/sagetrac-mirror/commit/8f8ce1575dcfb53fee524a9e546d297d22aa82a0)** to **[`d2b3dde`](https://github.com/sagemath/sagetrac-mirror/commit/d2b3dde11edb22ba199d4666b99ad753865c5322)**",
    "created_at": "2015-12-04T17:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270007",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8f8ce15`](https://github.com/sagemath/sagetrac-mirror/commit/8f8ce1575dcfb53fee524a9e546d297d22aa82a0)** to **[`d2b3dde`](https://github.com/sagemath/sagetrac-mirror/commit/d2b3dde11edb22ba199d4666b99ad753865c5322)**



---

archive/issue_comments_270008.json:
```json
{
    "body": "Changed dependencies from **#18669 #19533** to none",
    "created_at": "2015-12-05T09:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270008",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#18669 #19533** to none



---

archive/issue_comments_270009.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI haven't looked closely at the code, but some clean-up should be done:\n1. the function `diagonal_isometry` should have doctests\n2. remove commented code like `#print ...`",
    "created_at": "2015-12-05T21:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270009",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

I haven't looked closely at the code, but some clean-up should be done:
1. the function `diagonal_isometry` should have doctests
2. remove commented code like `#print ...`



---

archive/issue_comments_270010.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWhy does the final term need to be a special case? I don't like special cases unless they are justified.",
    "created_at": "2015-12-05T21:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270010",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Why does the final term need to be a special case? I don't like special cases unless they are justified.



---

archive/issue_comments_270011.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAre you sure it's worth to check `is_diagonal`? Is there significant gain?\n\nAre you sure it's worth to check `is_rationally_isometric`? I would just try to compute the isometry and let it fail if it doesn't exist.",
    "created_at": "2015-12-05T21:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270011",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Are you sure it's worth to check `is_diagonal`? Is there significant gain?

Are you sure it's worth to check `is_rationally_isometric`? I would just try to compute the isometry and let it fail if it doesn't exist.



---

archive/issue_comments_270012.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nDo you really need the `copy` in the function `isometry`?",
    "created_at": "2015-12-05T21:57:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270012",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Do you really need the `copy` in the function `isometry`?



---

archive/issue_comments_270013.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nCan you explain this block of code:\n\n```diff\n+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]\n+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)\n+            v = vector([0] * (n - i))\n+            index = 0;\n+            while True:\n+                v[index] = v[index] + 1\n+                index = (index + 1) % (n - i)\n+                c = Q(v)\n+                try:\n+                    w = F.solve(c)\n+                    #print(\"Find vectors {0} and {1} such that Q(v) = F(w)\".format(v, w))        \n+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):\n+                        break\n+                except ArithmeticError:\n+                    # No solution found, try another vector.\n+                    pass\n```",
    "created_at": "2015-12-05T21:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270013",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Can you explain this block of code:

```diff
+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]
+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)
+            v = vector([0] * (n - i))
+            index = 0;
+            while True:
+                v[index] = v[index] + 1
+                index = (index + 1) % (n - i)
+                c = Q(v)
+                try:
+                    w = F.solve(c)
+                    #print("Find vectors {0} and {1} such that Q(v) = F(w)".format(v, w))        
+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):
+                        break
+                except ArithmeticError:
+                    # No solution found, try another vector.
+                    pass
```



---

archive/issue_events_271274.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-05T21:59:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271274"
}
```



---

archive/issue_events_271275.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-05T21:59:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271275"
}
```



---

archive/issue_comments_270014.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nCan you move the helper functions out of the `diagonal_isometry` function and also doctest them?",
    "created_at": "2015-12-05T22:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270014",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Can you move the helper functions out of the `diagonal_isometry` function and also doctest them?



---

archive/issue_comments_270015.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b22c5155459c95fe2fac874c49d8bc7843f08c5\"><code>4b22c51</code></a></td><td><code>Added doctesting to helper methods of isometry</code></td></tr></table>\n",
    "created_at": "2015-12-10T17:51:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270015",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b22c5155459c95fe2fac874c49d8bc7843f08c5"><code>4b22c51</code></a></td><td><code>Added doctesting to helper methods of isometry</code></td></tr></table>




---

archive/issue_comments_270016.json:
```json
{
    "body": "Changed commit from **[`d2b3dde`](https://github.com/sagemath/sagetrac-mirror/commit/d2b3dde11edb22ba199d4666b99ad753865c5322)** to **[`4b22c51`](https://github.com/sagemath/sagetrac-mirror/commit/4b22c5155459c95fe2fac874c49d8bc7843f08c5)**",
    "created_at": "2015-12-10T17:51:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270016",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2b3dde`](https://github.com/sagemath/sagetrac-mirror/commit/d2b3dde11edb22ba199d4666b99ad753865c5322)** to **[`4b22c51`](https://github.com/sagemath/sagetrac-mirror/commit/4b22c5155459c95fe2fac874c49d8bc7843f08c5)**



---

archive/issue_comments_270017.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02\"><code>582ae45</code></a></td><td><code>Minor bugfixes/refactoring on isometry</code></td></tr></table>\n",
    "created_at": "2015-12-10T20:52:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270017",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02"><code>582ae45</code></a></td><td><code>Minor bugfixes/refactoring on isometry</code></td></tr></table>




---

archive/issue_comments_270018.json:
```json
{
    "body": "Changed commit from **[`4b22c51`](https://github.com/sagemath/sagetrac-mirror/commit/4b22c5155459c95fe2fac874c49d8bc7843f08c5)** to **[`582ae45`](https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02)**",
    "created_at": "2015-12-10T20:52:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270018",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4b22c51`](https://github.com/sagemath/sagetrac-mirror/commit/4b22c5155459c95fe2fac874c49d8bc7843f08c5)** to **[`582ae45`](https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02)**



---

archive/issue_comments_270019.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jdemeyer](#comment:23):\n> Why does the final term need to be a special case? I don't like special cases unless they are justified.\n\nIt was originally necessary because the `short_vector_list_up_to_length()` function didn't work for 1-dimensional quadratic forms, and the final iteration of the algorithm operates on two 1-dimensional forms. However, since that's been replaced by the PARI method, it's no longer necessary to have it as a special case, so thanks for pointing that out.\n\n> Are you sure it's worth to check `is_diagonal`? Is there significant gain?\n\nI suppose not, and simplifies the code to remove it, so I will.\n\n> Are you sure it's worth to check `is_rationally_isometric`?\n\nI believe this is necessary. The loop that looks for two vectors such that the modified bases including them will be non-singular will try vectors indefinitely until it finds a satisfactory pair. If the forms aren't equivalent there's no guarantee such a pair will be found.\n\n> Do you really need the `copy` in the function `isometry`?\n\nNope. That's a relic from an early version when `isometry` and `diagonal_isometry` were one function. I'll remove it, thanks for catching that.\n\n> Can you explain this block of code:\n\n\n```\n+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]\n+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)\n+            v = vector([0] * (n - i))\n+            index = 0;\n+            while True:\n+                v[index] = v[index] + 1\n+                index = (index + 1) % (n - i)\n+                c = Q(v)\n+                try:\n+                    w = F.solve(c)\n+                    #print(\"Find vectors {0} and {1} such that Q(v) = F(w)\".format(v, w))        \n+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):\n+                        break\n+                except ArithmeticError:\n+                    # No solution found, try another vector.\n+                    pass\n```\n\nThis block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`\n\nAlso, I realized that matrices have an `is_singular` function, so I'm getting rid of the `zero_row` function.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02\"><code>582ae45</code></a></td><td><code>Minor bugfixes/refactoring on isometry</code></td></tr></table>\n",
    "created_at": "2015-12-10T20:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270019",
    "user": "https://github.com/sagetrac-tgaona"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jdemeyer](#comment:23):
> Why does the final term need to be a special case? I don't like special cases unless they are justified.

It was originally necessary because the `short_vector_list_up_to_length()` function didn't work for 1-dimensional quadratic forms, and the final iteration of the algorithm operates on two 1-dimensional forms. However, since that's been replaced by the PARI method, it's no longer necessary to have it as a special case, so thanks for pointing that out.

> Are you sure it's worth to check `is_diagonal`? Is there significant gain?

I suppose not, and simplifies the code to remove it, so I will.

> Are you sure it's worth to check `is_rationally_isometric`?

I believe this is necessary. The loop that looks for two vectors such that the modified bases including them will be non-singular will try vectors indefinitely until it finds a satisfactory pair. If the forms aren't equivalent there's no guarantee such a pair will be found.

> Do you really need the `copy` in the function `isometry`?

Nope. That's a relic from an early version when `isometry` and `diagonal_isometry` were one function. I'll remove it, thanks for catching that.

> Can you explain this block of code:


```
+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]
+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)
+            v = vector([0] * (n - i))
+            index = 0;
+            while True:
+                v[index] = v[index] + 1
+                index = (index + 1) % (n - i)
+                c = Q(v)
+                try:
+                    w = F.solve(c)
+                    #print("Find vectors {0} and {1} such that Q(v) = F(w)".format(v, w))        
+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):
+                        break
+                except ArithmeticError:
+                    # No solution found, try another vector.
+                    pass
```

This block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`

Also, I realized that matrices have an `is_singular` function, so I'm getting rid of the `zero_row` function.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02"><code>582ae45</code></a></td><td><code>Minor bugfixes/refactoring on isometry</code></td></tr></table>




---

archive/issue_events_271276.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-12-10T20:54:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271276"
}
```



---

archive/issue_events_271277.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2015-12-10T20:54:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271277"
}
```



---

archive/issue_comments_270020.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nMore comments later, but already this: you make changes to `short_vector_list_up_to_length()` which I think do not belong to this ticket. In fact, it looks more likely that they belong to #14868. So I suggest you undo those changes here and move them to a new branch on #14868.",
    "created_at": "2015-12-12T16:24:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270020",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

More comments later, but already this: you make changes to `short_vector_list_up_to_length()` which I think do not belong to this ticket. In fact, it looks more likely that they belong to #14868. So I suggest you undo those changes here and move them to a new branch on #14868.



---

archive/issue_comments_270021.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@sagetrac-tgaona](#comment:31):\n> This block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`\n\nSorry, I still don't understand the algorithm. You really need more comments *in the code*. In particular, you need to explain the purpose of the variables `i`, `q_basis`, `f_basis`, `qb` and `fb`.\n\nMy feeling is that the current algorithm is too complicated (I don't think you need to loop for `v`), but I cannot really say how to improve it since I don't understand it.",
    "created_at": "2015-12-12T16:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270021",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@sagetrac-tgaona](#comment:31):
> This block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`

Sorry, I still don't understand the algorithm. You really need more comments *in the code*. In particular, you need to explain the purpose of the variables `i`, `q_basis`, `f_basis`, `qb` and `fb`.

My feeling is that the current algorithm is too complicated (I don't think you need to loop for `v`), but I cannot really say how to improve it since I don't understand it.



---

archive/issue_events_271278.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-22T13:45:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271278"
}
```



---

archive/issue_events_271279.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-22T13:45:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271279"
}
```



---

archive/issue_comments_270022.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI have looked over tgaona's algorithm, and it makes sense to me.  The block of code mentioned in comment 26 is a bit confusing, but I believe that it is necessary since its eventually necessary to invert, and therefore avoid the possibility of having a singular change of basis matrix.  \n\nAnother source of confusion, I believe, is in the description of the helper function `modify basis`.  I do believe that it does precisely what it needs to do in the context of the code, but the description is not quite correct, and a little bit misleading, since it is always a function acting on a submatrix of the original basis matrix. A better description might read \"Given a lattice L with basis matrix M and a vector, v=(v_1,...,v_n) of length n, this function extends the basis {b_1,...,b_n} of an underlying nxn orthogonal component of L to contain the vector v_1b_1+...+v_nb_n.\"   \n\nThe functions `diagonal_isometry`, `compute_gram_matrix_from_basis`, `modify_basis`, and `graham_schmidt` are all very particular to this parent function `isometry`, so (I believe) the standard Sage convention is to begin those with an underscore.  Also, I believe a better name for the parent function would be `explicit_isometry` just to differentiate this from the binary function returning True or False.  \n\nOther than that, I'll concede that there may very well be a faster way to run this algorithm, but as tgaona has it, it's certainly correct.",
    "created_at": "2016-01-11T03:21:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270022",
    "user": "https://github.com/annahaensch"
}
```

<div id="comment:36" align="right">comment:36</div>

I have looked over tgaona's algorithm, and it makes sense to me.  The block of code mentioned in comment 26 is a bit confusing, but I believe that it is necessary since its eventually necessary to invert, and therefore avoid the possibility of having a singular change of basis matrix.  

Another source of confusion, I believe, is in the description of the helper function `modify basis`.  I do believe that it does precisely what it needs to do in the context of the code, but the description is not quite correct, and a little bit misleading, since it is always a function acting on a submatrix of the original basis matrix. A better description might read "Given a lattice L with basis matrix M and a vector, v=(v_1,...,v_n) of length n, this function extends the basis {b_1,...,b_n} of an underlying nxn orthogonal component of L to contain the vector v_1b_1+...+v_nb_n."   

The functions `diagonal_isometry`, `compute_gram_matrix_from_basis`, `modify_basis`, and `graham_schmidt` are all very particular to this parent function `isometry`, so (I believe) the standard Sage convention is to begin those with an underscore.  Also, I believe a better name for the parent function would be `explicit_isometry` just to differentiate this from the binary function returning True or False.  

Other than that, I'll concede that there may very well be a faster way to run this algorithm, but as tgaona has it, it's certainly correct.



---

archive/issue_comments_270023.json:
```json
{
    "body": "Changed commit from **[`582ae45`](https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02)** to **[`17d12c6`](https://github.com/sagemath/sagetrac-mirror/commit/17d12c6faa5f18a9f822e30239bf201e2fe76c5f)**",
    "created_at": "2016-01-12T15:00:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270023",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`582ae45`](https://github.com/sagemath/sagetrac-mirror/commit/582ae4500eb3652446c6f829310298953f8dbd02)** to **[`17d12c6`](https://github.com/sagemath/sagetrac-mirror/commit/17d12c6faa5f18a9f822e30239bf201e2fe76c5f)**



---

archive/issue_comments_270024.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d9be4f9e02047514b90a32d0035bf26ffd6d2c2\"><code>6d9be4f</code></a></td><td><code>removed changes to 'short_vector_list_up_to_length()'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17d12c6faa5f18a9f822e30239bf201e2fe76c5f\"><code>17d12c6</code></a></td><td><code>Prefixed helper functions with an underscore and reworded documentation.</code></td></tr></table>\n",
    "created_at": "2016-01-12T15:00:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270024",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d9be4f9e02047514b90a32d0035bf26ffd6d2c2"><code>6d9be4f</code></a></td><td><code>removed changes to 'short_vector_list_up_to_length()'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17d12c6faa5f18a9f822e30239bf201e2fe76c5f"><code>17d12c6</code></a></td><td><code>Prefixed helper functions with an underscore and reworded documentation.</code></td></tr></table>




---

archive/issue_events_271280.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2016-01-17T02:52:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271280"
}
```



---

archive/issue_events_271281.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2016-01-17T02:52:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271281"
}
```



---

archive/issue_comments_270025.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nSorry, but [comment:34] hasn't been addressed yet. The code is simply too hard to understand and therefore impossible to review for me.\n\nAnd why did you rename `isometry` -> `explicit_isometry`? That's much harder to find.",
    "created_at": "2016-01-17T09:00:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270025",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Sorry, but [comment:34] hasn't been addressed yet. The code is simply too hard to understand and therefore impossible to review for me.

And why did you rename `isometry` -> `explicit_isometry`? That's much harder to find.



---

archive/issue_comments_270026.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nMerge conflicts with Sage 7.0",
    "created_at": "2016-01-20T09:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270026",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Merge conflicts with Sage 7.0



---

archive/issue_events_271282.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-20T09:49:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271282"
}
```



---

archive/issue_events_271283.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-20T09:49:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271283"
}
```



---

archive/issue_comments_270027.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56b5225a8caec33e4b4366a90d1686fc0a5f6768\"><code>56b5225</code></a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into ticket/19112</code></td></tr></table>\n",
    "created_at": "2016-01-30T18:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270027",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56b5225a8caec33e4b4366a90d1686fc0a5f6768"><code>56b5225</code></a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into ticket/19112</code></td></tr></table>




---

archive/issue_comments_270028.json:
```json
{
    "body": "Changed commit from **[`17d12c6`](https://github.com/sagemath/sagetrac-mirror/commit/17d12c6faa5f18a9f822e30239bf201e2fe76c5f)** to **[`56b5225`](https://github.com/sagemath/sagetrac-mirror/commit/56b5225a8caec33e4b4366a90d1686fc0a5f6768)**",
    "created_at": "2016-01-30T18:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270028",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`17d12c6`](https://github.com/sagemath/sagetrac-mirror/commit/17d12c6faa5f18a9f822e30239bf201e2fe76c5f)** to **[`56b5225`](https://github.com/sagemath/sagetrac-mirror/commit/56b5225a8caec33e4b4366a90d1686fc0a5f6768)**



---

archive/issue_comments_270029.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/132da46da12b3faa32c8cb22b25f25fb224cd80c\"><code>132da46</code></a></td><td><code>attempt to simplify algorithm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24e01fe5dfcbdb6e31947f20e9ddefd3746c20cc\"><code>24e01fe</code></a></td><td><code>Simplified algorithm and code for 'isometry' and its helpers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a56cb960a859fd2cb318d00bc06eacebb8cccb91\"><code>a56cb96</code></a></td><td><code>Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into isometry2</code></td></tr></table>\n",
    "created_at": "2016-03-09T19:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270029",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/132da46da12b3faa32c8cb22b25f25fb224cd80c"><code>132da46</code></a></td><td><code>attempt to simplify algorithm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24e01fe5dfcbdb6e31947f20e9ddefd3746c20cc"><code>24e01fe</code></a></td><td><code>Simplified algorithm and code for 'isometry' and its helpers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a56cb960a859fd2cb318d00bc06eacebb8cccb91"><code>a56cb96</code></a></td><td><code>Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into isometry2</code></td></tr></table>




---

archive/issue_comments_270030.json:
```json
{
    "body": "Changed commit from **[`56b5225`](https://github.com/sagemath/sagetrac-mirror/commit/56b5225a8caec33e4b4366a90d1686fc0a5f6768)** to **[`a56cb96`](https://github.com/sagemath/sagetrac-mirror/commit/a56cb960a859fd2cb318d00bc06eacebb8cccb91)**",
    "created_at": "2016-03-09T19:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270030",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`56b5225`](https://github.com/sagemath/sagetrac-mirror/commit/56b5225a8caec33e4b4366a90d1686fc0a5f6768)** to **[`a56cb96`](https://github.com/sagemath/sagetrac-mirror/commit/a56cb960a859fd2cb318d00bc06eacebb8cccb91)**



---

archive/issue_comments_270031.json:
```json
{
    "body": "Changed commit from **[`a56cb96`](https://github.com/sagemath/sagetrac-mirror/commit/a56cb960a859fd2cb318d00bc06eacebb8cccb91)** to **[`642df10`](https://github.com/sagemath/sagetrac-mirror/commit/642df1071e10e3a771abd7d02ceff017c0a3ef30)**",
    "created_at": "2016-03-09T19:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270031",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a56cb96`](https://github.com/sagemath/sagetrac-mirror/commit/a56cb960a859fd2cb318d00bc06eacebb8cccb91)** to **[`642df10`](https://github.com/sagemath/sagetrac-mirror/commit/642df1071e10e3a771abd7d02ceff017c0a3ef30)**



---

archive/issue_comments_270032.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/642df1071e10e3a771abd7d02ceff017c0a3ef30\"><code>642df10</code></a></td><td><code>Fixed typo in documentation example for _diagonal_isometry</code></td></tr></table>\n",
    "created_at": "2016-03-09T19:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270032",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/642df1071e10e3a771abd7d02ceff017c0a3ef30"><code>642df10</code></a></td><td><code>Fixed typo in documentation example for _diagonal_isometry</code></td></tr></table>




---

archive/issue_events_271284.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2016-03-09T19:53:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271284"
}
```



---

archive/issue_events_271285.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2016-03-09T19:53:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271285"
}
```



---

archive/issue_events_271286.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-10T07:22:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271286"
}
```



---

archive/issue_events_271287.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-10T07:22:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271287"
}
```



---

archive/issue_comments_270033.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nWhy this added line?\n\n```diff\n+            v = parilist[i]\n```",
    "created_at": "2016-03-10T07:22:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270033",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

Why this added line?

```diff
+            v = parilist[i]
```



---

archive/issue_events_271288.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-10T07:22:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271288"
}
```



---

archive/issue_events_271289.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-10T07:22:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271289"
}
```



---

archive/issue_comments_270034.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI am still missing some high-level explanation of the algorithm. For example, what is `FM`?",
    "created_at": "2016-03-10T07:33:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270034",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

I am still missing some high-level explanation of the algorithm. For example, what is `FM`?



---

archive/issue_comments_270035.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI understand the algorithm, I don't think it's so complicated.  It just looks for a vector w in W of length corresponding to, V[0][0], the upper left most entry in V.  Then it simply extends the basis of W to contain w, preforms Gram Schmidt (fixing w), and then picks off <Q(w)> as an orthogonal component of W and <V[0][0]> as an orthogonal component of V.  I feel satisfied the the algorithm does what it claims to do, and that it is mathematically correct. \n\nA few notes on the documentation: \n\n1.  In your documentation for `_diagonal_isometry()` you call the function `isometry()` (of course it works out to be the same thing here, since the forms are diagonal to begin with. \n\n2. Your documentation for `_gram_schmidt()` is a bit misleading, since it looks like you are treating the columns of a Gram matrix as a set of vectors to be orthogonalized, rather, do the process on some sort of (preferably basis) matrix.   \n\nIn response to comment 45, I'm also not sure why v=parilist[i] got added.  Is there a reason you're touching `short_vector_list_up_to_length()`?  I think something may have happened on the merge.",
    "created_at": "2016-03-10T22:30:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270035",
    "user": "https://github.com/annahaensch"
}
```

<div id="comment:47" align="right">comment:47</div>

I understand the algorithm, I don't think it's so complicated.  It just looks for a vector w in W of length corresponding to, V[0][0], the upper left most entry in V.  Then it simply extends the basis of W to contain w, preforms Gram Schmidt (fixing w), and then picks off <Q(w)> as an orthogonal component of W and <V[0][0]> as an orthogonal component of V.  I feel satisfied the the algorithm does what it claims to do, and that it is mathematically correct. 

A few notes on the documentation: 

1.  In your documentation for `_diagonal_isometry()` you call the function `isometry()` (of course it works out to be the same thing here, since the forms are diagonal to begin with. 

2. Your documentation for `_gram_schmidt()` is a bit misleading, since it looks like you are treating the columns of a Gram matrix as a set of vectors to be orthogonalized, rather, do the process on some sort of (preferably basis) matrix.   

In response to comment 45, I'm also not sure why v=parilist[i] got added.  Is there a reason you're touching `short_vector_list_up_to_length()`?  I think something may have happened on the merge.



---

archive/issue_comments_270036.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@annahaensch](#comment:47):\n> I understand the algorithm\n\nThe fact that **you** understand it, is not sufficient. It should be documented in the code such that **everybody** can understand it.",
    "created_at": "2016-03-11T08:34:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270036",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@annahaensch](#comment:47):
> I understand the algorithm

The fact that **you** understand it, is not sufficient. It should be documented in the code such that **everybody** can understand it.



---

archive/issue_comments_270037.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b8f69416667585a5d5d95bfb0272ffd059d066c\"><code>2b8f694</code></a></td><td><code>removed old line from quadratic_form__automorphisms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70ed4293b680ec8859683a8e1c3b7791c1c67e73\"><code>70ed429</code></a></td><td><code>Fixed documentation errors and added more comments to _diagonal_isometry</code></td></tr></table>\n",
    "created_at": "2016-03-11T19:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270037",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b8f69416667585a5d5d95bfb0272ffd059d066c"><code>2b8f694</code></a></td><td><code>removed old line from quadratic_form__automorphisms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70ed4293b680ec8859683a8e1c3b7791c1c67e73"><code>70ed429</code></a></td><td><code>Fixed documentation errors and added more comments to _diagonal_isometry</code></td></tr></table>




---

archive/issue_comments_270038.json:
```json
{
    "body": "Changed commit from **[`642df10`](https://github.com/sagemath/sagetrac-mirror/commit/642df1071e10e3a771abd7d02ceff017c0a3ef30)** to **[`70ed429`](https://github.com/sagemath/sagetrac-mirror/commit/70ed4293b680ec8859683a8e1c3b7791c1c67e73)**",
    "created_at": "2016-03-11T19:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270038",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`642df10`](https://github.com/sagemath/sagetrac-mirror/commit/642df1071e10e3a771abd7d02ceff017c0a3ef30)** to **[`70ed429`](https://github.com/sagemath/sagetrac-mirror/commit/70ed4293b680ec8859683a8e1c3b7791c1c67e73)**



---

archive/issue_events_271290.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2016-03-11T19:01:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271290"
}
```



---

archive/issue_events_271291.json:
```json
{
    "actor": "https://github.com/sagetrac-tgaona",
    "created_at": "2016-03-11T19:01:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271291"
}
```



---

archive/issue_comments_270039.json:
```json
{
    "body": "Changed commit from **[`70ed429`](https://github.com/sagemath/sagetrac-mirror/commit/70ed4293b680ec8859683a8e1c3b7791c1c67e73)** to **[`0b88414`](https://github.com/sagemath/sagetrac-mirror/commit/0b8841492ca2e5714879cadacb6076f595927bd7)**",
    "created_at": "2016-08-28T13:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270039",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`70ed429`](https://github.com/sagemath/sagetrac-mirror/commit/70ed4293b680ec8859683a8e1c3b7791c1c67e73)** to **[`0b88414`](https://github.com/sagemath/sagetrac-mirror/commit/0b8841492ca2e5714879cadacb6076f595927bd7)**



---

archive/issue_comments_270040.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44c29ef655f675bc8ad063913ffc5057543430bb\"><code>44c29ef</code></a></td><td><code>Merge branch 'master' into isometry2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b8841492ca2e5714879cadacb6076f595927bd7\"><code>0b88414</code></a></td><td><code>Changed 'from quadratic_form' to 'from sage.quadratic_forms.quadratic_form'</code></td></tr></table>\n",
    "created_at": "2016-08-28T13:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270040",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44c29ef655f675bc8ad063913ffc5057543430bb"><code>44c29ef</code></a></td><td><code>Merge branch 'master' into isometry2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b8841492ca2e5714879cadacb6076f595927bd7"><code>0b88414</code></a></td><td><code>Changed 'from quadratic_form' to 'from sage.quadratic_forms.quadratic_form'</code></td></tr></table>




---

archive/issue_comments_270041.json:
```json
{
    "body": "<div id=\"comment:52\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b394f41bd18eb22c6558a1441444692b79caec7\"><code>2b394f4</code></a></td><td><code>Removed trailing whitespace.</code></td></tr></table>\n",
    "created_at": "2016-08-29T12:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270041",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:52"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b394f41bd18eb22c6558a1441444692b79caec7"><code>2b394f4</code></a></td><td><code>Removed trailing whitespace.</code></td></tr></table>




---

archive/issue_comments_270042.json:
```json
{
    "body": "Changed commit from **[`0b88414`](https://github.com/sagemath/sagetrac-mirror/commit/0b8841492ca2e5714879cadacb6076f595927bd7)** to **[`2b394f4`](https://github.com/sagemath/sagetrac-mirror/commit/2b394f41bd18eb22c6558a1441444692b79caec7)**",
    "created_at": "2016-08-29T12:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270042",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b88414`](https://github.com/sagemath/sagetrac-mirror/commit/0b8841492ca2e5714879cadacb6076f595927bd7)** to **[`2b394f4`](https://github.com/sagemath/sagetrac-mirror/commit/2b394f41bd18eb22c6558a1441444692b79caec7)**



---

archive/issue_comments_270043.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThank you for writing this code. It is well documented and easy to read. \nThe basic algorithm works. Good job!\nAfter computing some examples I noticed that coefficients tend to explode and\nexamples beyond n=4 take ages. Is this expected? Is there an algorithm avoiding coefficient blowups?\n\nI can review it. Here are some comments:\n\n- use imperative in the docstrings: \"Computes something\". Should rather be: \"Compute something\" \n- There is no need to introduce a new method `isometry()`. Instead give `is_rationally_isometric` a new argument `return_matrix`. You can model analogous behavior as in `is_globally_equivalent_to`.\n\n- In the current implementation you do not check the `base_ring` is `ZZ` or `QQ`. This should be done. Or does it work more generally? For example the code does not work over the p-adics. \n- You do not need a new method`_compute_gram_matrix_from_basis`. Instead you can just use `Q(T).Gram_matrix_rational()`. Here `Q` is a quadratic form and `T` a transformation matrix.\n- make sure degenerate quadratic forms work as well and doctest it.\n- add a random doctest. For example something in the direction of:\n\n```\nsage: n = 4\nsage: G = matrix.random(QQ,n) #random\nsage: G = G + G.transpose()\nsage: Q = QuadraticForm(QQ,G)\nsage: T = matrix.random(QQ,n)\nsage: S = Q.isometry(Q(T))\nsage: Q == Q(S)\nTrue\n```",
    "created_at": "2017-10-15T19:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270043",
    "user": "https://github.com/simonbrandhorst"
}
```

<div id="comment:53" align="right">comment:53</div>

Thank you for writing this code. It is well documented and easy to read. 
The basic algorithm works. Good job!
After computing some examples I noticed that coefficients tend to explode and
examples beyond n=4 take ages. Is this expected? Is there an algorithm avoiding coefficient blowups?

I can review it. Here are some comments:

- use imperative in the docstrings: "Computes something". Should rather be: "Compute something" 
- There is no need to introduce a new method `isometry()`. Instead give `is_rationally_isometric` a new argument `return_matrix`. You can model analogous behavior as in `is_globally_equivalent_to`.

- In the current implementation you do not check the `base_ring` is `ZZ` or `QQ`. This should be done. Or does it work more generally? For example the code does not work over the p-adics. 
- You do not need a new method`_compute_gram_matrix_from_basis`. Instead you can just use `Q(T).Gram_matrix_rational()`. Here `Q` is a quadratic form and `T` a transformation matrix.
- make sure degenerate quadratic forms work as well and doctest it.
- add a random doctest. For example something in the direction of:

```
sage: n = 4
sage: G = matrix.random(QQ,n) #random
sage: G = G + G.transpose()
sage: Q = QuadraticForm(QQ,G)
sage: T = matrix.random(QQ,n)
sage: S = Q.isometry(Q(T))
sage: Q == Q(S)
True
```



---

archive/issue_comments_270044.json:
```json
{
    "body": "Reviewer: **Simon Brandhorst**",
    "created_at": "2017-10-15T19:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270044",
    "user": "https://github.com/simonbrandhorst"
}
```

Reviewer: **Simon Brandhorst**



---

archive/issue_events_271292.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2018-04-30T18:04:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271292"
}
```



---

archive/issue_events_271293.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2018-04-30T18:04:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271293"
}
```



---

archive/issue_comments_270045.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Adds a function \"isometry\" that returns an isometry from one quadratic form to another, provided that it exists.\n+Adds a function \"isometry\" that returns an isometry from one rational quadratic form to another, provided that it exists.\n``````\n",
    "created_at": "2018-05-25T05:34:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270045",
    "user": "https://github.com/simonbrandhorst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Adds a function "isometry" that returns an isometry from one quadratic form to another, provided that it exists.
+Adds a function "isometry" that returns an isometry from one rational quadratic form to another, provided that it exists.
``````




---

archive/issue_events_271294.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-28T12:43:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271294"
}
```



---

archive/issue_events_271295.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-28T12:43:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271295"
}
```



---

archive/issue_comments_270046.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nthe patchbot results look OK (apart from pyflake plugin, which might tell you how to improve the code).",
    "created_at": "2019-05-28T12:43:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270046",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:56" align="right">comment:56</div>

the patchbot results look OK (apart from pyflake plugin, which might tell you how to improve the code).



---

archive/issue_comments_270047.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nTickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270047",
    "user": "https://github.com/embray"
}
```

<div id="comment:57" align="right">comment:57</div>

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_events_271296.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271296"
}
```



---

archive/issue_events_271297.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271297"
}
```



---

archive/issue_comments_270048.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270048",
    "user": "https://github.com/embray"
}
```

<div id="comment:58" align="right">comment:58</div>

Ticket retargeted after milestone closed



---

archive/issue_events_271298.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271298"
}
```



---

archive/issue_events_271299.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271299"
}
```



---

archive/issue_comments_270049.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270049",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_271300.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271300"
}
```



---

archive/issue_events_271301.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271301"
}
```



---

archive/issue_events_271302.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271302"
}
```



---

archive/issue_events_271303.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271303"
}
```



---

archive/issue_comments_270050.json:
```json
{
    "body": "Changed branch from **[u/tgaona/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/tgaona/ticket/19112)** to **[u/sbrandhorst/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/ticket/19112)**",
    "created_at": "2020-10-02T09:24:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270050",
    "user": "https://github.com/simonbrandhorst"
}
```

Changed branch from **[u/tgaona/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/tgaona/ticket/19112)** to **[u/sbrandhorst/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/ticket/19112)**



---

archive/issue_comments_270051.json:
```json
{
    "body": "Changed commit from **[`2b394f4`](https://github.com/sagemath/sagetrac-mirror/commit/2b394f41bd18eb22c6558a1441444692b79caec7)** to **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)**",
    "created_at": "2020-10-02T09:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270051",
    "user": "https://github.com/simonbrandhorst"
}
```

Changed commit from **[`2b394f4`](https://github.com/sagemath/sagetrac-mirror/commit/2b394f41bd18eb22c6558a1441444692b79caec7)** to **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)**



---

archive/issue_comments_270052.json:
```json
{
    "body": "<div id=\"comment:62\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb76909579ad23e80562bbfc3a39749119b3e001\"><code>cb76909</code></a></td><td><code>Merge branch 'develop' into t/19112/ticket/19112</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943\"><code>ffa5295</code></a></td><td><code>is_rationally_equivalent_to cleanup</code></td></tr></table>\n",
    "created_at": "2020-10-02T09:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270052",
    "user": "https://github.com/simonbrandhorst"
}
```

<div id="comment:62"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb76909579ad23e80562bbfc3a39749119b3e001"><code>cb76909</code></a></td><td><code>Merge branch 'develop' into t/19112/ticket/19112</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943"><code>ffa5295</code></a></td><td><code>is_rationally_equivalent_to cleanup</code></td></tr></table>




---

archive/issue_events_271304.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2020-10-02T09:25:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271304"
}
```



---

archive/issue_events_271305.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2020-10-02T09:25:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271305"
}
```



---

archive/issue_comments_270053.json:
```json
{
    "body": "Changed author from **Tyler Gaona** to **Tyler Gaona, Simon Brandorst**",
    "created_at": "2020-10-02T09:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270053",
    "user": "https://github.com/simonbrandhorst"
}
```

Changed author from **Tyler Gaona** to **Tyler Gaona, Simon Brandorst**



---

archive/issue_events_271306.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2020-10-02T09:31:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271306"
}
```



---

archive/issue_events_271307.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2020-10-02T09:31:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271307"
}
```



---

archive/issue_comments_270054.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nI guess my contribution counts as a reviewer patch...",
    "created_at": "2020-10-02T09:31:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270054",
    "user": "https://github.com/simonbrandhorst"
}
```

<div id="comment:63" align="right">comment:63</div>

I guess my contribution counts as a reviewer patch...



---

archive/issue_comments_270055.json:
```json
{
    "body": "Changed branch from **[u/sbrandhorst/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/ticket/19112)** to **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)**",
    "created_at": "2020-11-07T16:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270055",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/sbrandhorst/ticket/19112](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/ticket/19112)** to **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)**



---

archive/issue_events_271308.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-07T16:23:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271308"
}
```



---

archive/issue_events_271309.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a0b507b5355292d6bdb97c94dcb4591a1587f69a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-11-07T16:23:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19112#event-271309"
}
```



---

archive/issue_comments_270056.json:
```json
{
    "body": "Changed author from **Tyler Gaona, Simon Brandorst** to **Tyler Gaona, Simon Brandhorst**",
    "created_at": "2021-05-09T23:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270056",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Tyler Gaona, Simon Brandorst** to **Tyler Gaona, Simon Brandhorst**



---

archive/issue_comments_270057.json:
```json
{
    "body": "Changed commit from **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)** to none",
    "created_at": "2021-05-09T23:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19112#issuecomment-270057",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`ffa5295`](https://github.com/sagemath/sagetrac-mirror/commit/ffa529517a8e0da5dc459e39b510737dca5d2943)** to none
