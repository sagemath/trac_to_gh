# Issue 19112: Add a function "isometry" to the quadratic forms package.

archive/issues_018875.json:
```json
{
    "body": "Adds a function \"isometry\" that returns an isometry from one rational quadratic form to another, provided that it exists.\n\nCC:  @annahaensch tgaona\n\nKeywords: isometry\n\nReviewer: Simon Brandhorst\n\nAuthor: Tyler Gaona, Simon Brandhorst\n\nBranch: ffa529517a8e0da5dc459e39b510737dca5d2943\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19112\n\n",
    "closed_at": "2020-11-07T16:23:29Z",
    "created_at": "2015-08-30T20:00:56Z",
    "labels": [
        "component: quadratic forms",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Add a function \"isometry\" to the quadratic forms package.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19112",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```
Adds a function "isometry" that returns an isometry from one rational quadratic form to another, provided that it exists.

CC:  @annahaensch tgaona

Keywords: isometry

Reviewer: Simon Brandhorst

Author: Tyler Gaona, Simon Brandhorst

Branch: ffa529517a8e0da5dc459e39b510737dca5d2943

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19112





---

archive/issue_comments_340404.json:
```json
{
    "body": "Changing branch from \"\" to \"u/tgaona/ticket/19112\"",
    "created_at": "2015-11-01T21:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340404",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing branch from "" to "u/tgaona/ticket/19112"



---

archive/issue_comments_340405.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|\n|[0d32f4b](http://git.sagemath.org/sage.git/commit/?id=0d32f4be61421da6f14f8b871478dd3501fe5204)|`Implements a method to compute isometries between positive definite quadratic forms.`|\n|[9e211fe](http://git.sagemath.org/sage.git/commit/?id=9e211fecd4b525ad30276d37d442a68ce9bec8f0)|`Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's`|",
    "created_at": "2015-11-01T21:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340405",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
|[0d32f4b](http://git.sagemath.org/sage.git/commit/?id=0d32f4be61421da6f14f8b871478dd3501fe5204)|`Implements a method to compute isometries between positive definite quadratic forms.`|
|[9e211fe](http://git.sagemath.org/sage.git/commit/?id=9e211fecd4b525ad30276d37d442a68ce9bec8f0)|`Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's`|



---

archive/issue_comments_340406.json:
```json
{
    "body": "Changing commit from \"\" to \"9e211fecd4b525ad30276d37d442a68ce9bec8f0\"",
    "created_at": "2015-11-01T21:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340406",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing commit from "" to "9e211fecd4b525ad30276d37d442a68ce9bec8f0"



---

archive/issue_comments_340407.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-01T21:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340407",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_340408.json:
```json
{
    "body": "Changing work_issues from \"needs implementation\" to \"\"",
    "created_at": "2015-11-02T18:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340408",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "needs implementation" to ""



---

archive/issue_comments_340409.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis looks like it reinvents the already-existing method `is_globally_equivalent_to`. What does your code add?",
    "created_at": "2015-11-02T18:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340409",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
This looks like it reinvents the already-existing method `is_globally_equivalent_to`. What does your code add?



---

archive/issue_comments_340410.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-11-02T18:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340410",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_events_053104.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-02T18:22:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53104"
}
```



---

archive/issue_comments_340411.json:
```json
{
    "body": "<a id='comment:4'></a>\nHi Jeroen,\n\nSorry for the slow response. This method should be able to return isometries for forms over fields, where I believe is_globally_equivalent_to just works over the ring of integers. For example:\n\n```\nsage: Q = DiagonalQuadraticForm(QQ, [1, 5])\nsage: F = QuadraticForm(QQ, 2, [1, 12, 81])\nsage: Q.is_globally_equivalent_to(F)\nFalse\nsage: Q.is_rationally_isometric(F)\nTrue\nsage: T = Q.isometry(F)\nsage: T\n[  1  -2]\n[  0 1/3]\nsage: Q.Gram_matrix() == T.transpose() * F.Gram_matrix() * T\nTrue\n```\n\nSo Q is equivalent to F over the rationals, but is_globally_equivalent_to doesn't recognize this. This method was intended to complement the is_rationally_isometric method, so perhaps it should be refactored to work in a similar manner as is_globally_equivalent_to, i.e, adding an optional flag to is_rationally_isometric to return the transition matrix for the isometry.",
    "created_at": "2015-11-03T22:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340411",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

<a id='comment:4'></a>
Hi Jeroen,

Sorry for the slow response. This method should be able to return isometries for forms over fields, where I believe is_globally_equivalent_to just works over the ring of integers. For example:

```
sage: Q = DiagonalQuadraticForm(QQ, [1, 5])
sage: F = QuadraticForm(QQ, 2, [1, 12, 81])
sage: Q.is_globally_equivalent_to(F)
False
sage: Q.is_rationally_isometric(F)
True
sage: T = Q.isometry(F)
sage: T
[  1  -2]
[  0 1/3]
sage: Q.Gram_matrix() == T.transpose() * F.Gram_matrix() * T
True
```

So Q is equivalent to F over the rationals, but is_globally_equivalent_to doesn't recognize this. This method was intended to complement the is_rationally_isometric method, so perhaps it should be refactored to work in a similar manner as is_globally_equivalent_to, i.e, adding an optional flag to is_rationally_isometric to return the transition matrix for the isometry.



---

archive/issue_comments_340412.json:
```json
{
    "body": "<a id='comment:5'></a>\nRight, I think it's better to mention this more clearly in the documentation (I always get confused when quadratic-form people talk about isomorphic/isometric/equivalent, I never know what they mean).",
    "created_at": "2015-11-04T13:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340412",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Right, I think it's better to mention this more clearly in the documentation (I always get confused when quadratic-form people talk about isomorphic/isometric/equivalent, I never know what they mean).



---

archive/issue_comments_340413.json:
```json
{
    "body": "<a id='comment:6'></a>\nThat being said, I think you are really over-complicating the algorithm.\n\nSuppose one of the forms is given by the diagonal `5*x0^2 + ...`. Then really all you need to do in the first step is to find a vector `v` of \"length\" 5. This can be done with some algorithm based on PARI's `qfsolve()`: the only issue is that `qfsolve()` finds a projective point, but you really want an affine point.\n\nSo I suggest to do the following:\n1. implement an affine version of `qfsolve()` to solve equations of the form `Q(x) = C` where `Q` is a quadratic form and `C` is a constant. Do this in a separate Sage ticket.\n2. use this new function to implement `isometry` on this ticket.\n\nThis will have several major advantages:\n1. your code will be a lot faster.\n2. it will no longer run forever if there is isometry (which is unacceptable).\n3. you can remove the assumption that your quadratic form is positive-definite.",
    "created_at": "2015-11-04T14:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340413",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
That being said, I think you are really over-complicating the algorithm.

Suppose one of the forms is given by the diagonal `5*x0^2 + ...`. Then really all you need to do in the first step is to find a vector `v` of "length" 5. This can be done with some algorithm based on PARI's `qfsolve()`: the only issue is that `qfsolve()` finds a projective point, but you really want an affine point.

So I suggest to do the following:
1. implement an affine version of `qfsolve()` to solve equations of the form `Q(x) = C` where `Q` is a quadratic form and `C` is a constant. Do this in a separate Sage ticket.
2. use this new function to implement `isometry` on this ticket.

This will have several major advantages:
1. your code will be a lot faster.
2. it will no longer run forever if there is isometry (which is unacceptable).
3. you can remove the assumption that your quadratic form is positive-definite.



---

archive/issue_comments_340414.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlso, your branch is based on an old version of Sage. You should really develop from the latest beta version (currently `6.10.beta2`).",
    "created_at": "2015-11-04T14:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340414",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Also, your branch is based on an old version of Sage. You should really develop from the latest beta version (currently `6.10.beta2`).



---

archive/issue_comments_340415.json:
```json
{
    "body": "<a id='comment:8'></a>\nPlease follow [http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings) for the correct formatting of docstrings.",
    "created_at": "2015-11-04T14:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340415",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Please follow [http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings) for the correct formatting of docstrings.



---

archive/issue_comments_340416.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-11-04T14:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340416",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_340417.json:
```json
{
    "body": "<a id='comment:10'></a>\nI will make it more clear in the documentation that the method returns a transformation matrix, as opposed to saying it returns an isometry.\n\nAs to your second point, I agree that a cleaner, more efficient replacement for the first step of the algorithm is very desirable. However, I have looked at the source for PARI's `qfsolve()` and it isn't clear to me how to adapt it to return an affine vector `x` such that `Q(x) = C`. I would appreciate it if you could offer more guidance here, otherwise, I'm not sure how to proceed.\n\n> 2. it will no longer run forever if there is isometry (which is unacceptable).\n\n\nI can fix this by throwing an exception when `is_rationally_isometric()` returns false for the two forms. The reason I didn't include this initially is that I was working off of Sage 6.8 but `is_rationally_isometric()` was added in 6.9.\n\nI will fix the formatting in the docstring.",
    "created_at": "2015-11-04T22:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340417",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

<a id='comment:10'></a>
I will make it more clear in the documentation that the method returns a transformation matrix, as opposed to saying it returns an isometry.

As to your second point, I agree that a cleaner, more efficient replacement for the first step of the algorithm is very desirable. However, I have looked at the source for PARI's `qfsolve()` and it isn't clear to me how to adapt it to return an affine vector `x` such that `Q(x) = C`. I would appreciate it if you could offer more guidance here, otherwise, I'm not sure how to proceed.

> 2. it will no longer run forever if there is isometry (which is unacceptable).


I can fix this by throwing an exception when `is_rationally_isometric()` returns false for the two forms. The reason I didn't include this initially is that I was working off of Sage 6.8 but `is_rationally_isometric()` was added in 6.9.

I will fix the formatting in the docstring.



---

archive/issue_comments_340418.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#18669\"",
    "created_at": "2015-11-05T10:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340418",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#18669"



---

archive/issue_comments_340419.json:
```json
{
    "body": "<a id='comment:11'></a>\nGiven that your new functionality relies on `rational_diagonal_form()`, it would be a lot better in fact to base your patch on top of #18669.",
    "created_at": "2015-11-05T10:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340419",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Given that your new functionality relies on `rational_diagonal_form()`, it would be a lot better in fact to base your patch on top of #18669.



---

archive/issue_comments_340420.json:
```json
{
    "body": "<a id='comment:12'></a>\nAbout solving quadratic forms:\n\nSuppose you want to solve `Q(x) = c`. Consider the quadratic form `Q(x) - c*z^2 = 0`, where `z` is an extra variable. Find a solution `(x,z)` to this quadratic form using `qfsolve()`.\n\n**Case 1**: If `z != 0`, then `Q(x/z) = c`.\n\n**Case 2**: We found a solution `Q(x) = 0`. Let `e` be any vector such that `B(x,e) != 0`, where `B` is the bilinear form corresponding to `Q`. To find `e`, just try all unit vectors `(0,..0,1,0...0)`. Let `a = (c - Q(e))/B(x,e)` and let `y = e + a*x`. Then `Q(y) = c`.\n\nIt would be great if you could implement this on a separate ticket.",
    "created_at": "2015-11-05T11:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340420",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
About solving quadratic forms:

Suppose you want to solve `Q(x) = c`. Consider the quadratic form `Q(x) - c*z^2 = 0`, where `z` is an extra variable. Find a solution `(x,z)` to this quadratic form using `qfsolve()`.

**Case 1**: If `z != 0`, then `Q(x/z) = c`.

**Case 2**: We found a solution `Q(x) = 0`. Let `e` be any vector such that `B(x,e) != 0`, where `B` is the bilinear form corresponding to `Q`. To find `e`, just try all unit vectors `(0,..0,1,0...0)`. Let `a = (c - Q(e))/B(x,e)` and let `y = e + a*x`. Then `Q(y) = c`.

It would be great if you could implement this on a separate ticket.



---

archive/issue_comments_340421.json:
```json
{
    "body": "Changing dependencies from \"#18669\" to \"#18669 #19533\"",
    "created_at": "2015-11-06T01:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340421",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing dependencies from "#18669" to "#18669 #19533"



---

archive/issue_comments_340422.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks for the clear explanation. I've opened up a separate ticket for this, and will address the various changes you've suggested.",
    "created_at": "2015-11-06T01:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340422",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

<a id='comment:13'></a>
Thanks for the clear explanation. I've opened up a separate ticket for this, and will address the various changes you've suggested.



---

archive/issue_comments_340423.json:
```json
{
    "body": "Changing commit from \"9e211fecd4b525ad30276d37d442a68ce9bec8f0\" to \"afcd21b014a9c543b02c0b957c6d2c028d60b17f\"",
    "created_at": "2015-11-12T21:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340423",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9e211fecd4b525ad30276d37d442a68ce9bec8f0" to "afcd21b014a9c543b02c0b957c6d2c028d60b17f"



---

archive/issue_comments_340424.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[51ba9f8](http://git.sagemath.org/sage.git/commit/?id=51ba9f8f06040341cade6f602254ddc3ede7cee1)|`Adds isometry method for quadratic forms.`|\n|[afcd21b](http://git.sagemath.org/sage.git/commit/?id=afcd21b014a9c543b02c0b957c6d2c028d60b17f)|`Merge branch 'research' into ticket/19112`|",
    "created_at": "2015-11-12T21:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[51ba9f8](http://git.sagemath.org/sage.git/commit/?id=51ba9f8f06040341cade6f602254ddc3ede7cee1)|`Adds isometry method for quadratic forms.`|
|[afcd21b](http://git.sagemath.org/sage.git/commit/?id=afcd21b014a9c543b02c0b957c6d2c028d60b17f)|`Merge branch 'research' into ticket/19112`|



---

archive/issue_comments_340425.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[8a040f3](http://git.sagemath.org/sage.git/commit/?id=8a040f3e2bdc5b312bd14b1fe36e85dda87ead91)|`Merge branch 'develop' into ticket/19112`|",
    "created_at": "2015-11-12T21:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[8a040f3](http://git.sagemath.org/sage.git/commit/?id=8a040f3e2bdc5b312bd14b1fe36e85dda87ead91)|`Merge branch 'develop' into ticket/19112`|



---

archive/issue_comments_340426.json:
```json
{
    "body": "Changing commit from \"afcd21b014a9c543b02c0b957c6d2c028d60b17f\" to \"8a040f3e2bdc5b312bd14b1fe36e85dda87ead91\"",
    "created_at": "2015-11-12T21:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340426",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "afcd21b014a9c543b02c0b957c6d2c028d60b17f" to "8a040f3e2bdc5b312bd14b1fe36e85dda87ead91"



---

archive/issue_comments_340427.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[3ee588d](http://git.sagemath.org/sage.git/commit/?id=3ee588dd37871a4a28e7db768e66ab4a44dacd3e)|`Use PARI to diagonalize quadratic forms`|\n|[2689325](http://git.sagemath.org/sage.git/commit/?id=2689325b940f209728dd1a83091be2cdac2fcbc8)|`Merge tag '6.10.beta1' into t/18669/use_pari_to_compute_rational_diagonal_form__`|\n|[45cbc2d](http://git.sagemath.org/sage.git/commit/?id=45cbc2dea350f0adfbd366fe8048ce8ef840983e)|`Further fixes to rational diagonal form`|\n|[ee778c8](http://git.sagemath.org/sage.git/commit/?id=ee778c87c15f75c5243ff5fd0da38efa85129335)|`Implements a method to compute isometries between positive definite quadratic forms.`|\n|[27b2190](http://git.sagemath.org/sage.git/commit/?id=27b21901366cf4dac41e41a247ab930a95d2df7a)|`Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's`|\n|[92de9ef](http://git.sagemath.org/sage.git/commit/?id=92de9efe06c5236871f5faeacabe36a24378114e)|`Adds isometry method for quadratic forms.`|\n|[1b1a574](http://git.sagemath.org/sage.git/commit/?id=1b1a5744240fc03a9dbbaa6ab3ef700f9d23f0e7)|`Merge branch 'ticket/19533' into ticket/19112`|\n|[2f8ebc7](http://git.sagemath.org/sage.git/commit/?id=2f8ebc70a1b236e1ca765b7cbc982587694f6a77)|`Bug fixes in 'isometry' method and refactoring to utilize the 'solve' method for quadratic forms`|\n|[8f8ce15](http://git.sagemath.org/sage.git/commit/?id=8f8ce1575dcfb53fee524a9e546d297d22aa82a0)|`Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into ticket/19112`|",
    "created_at": "2015-12-01T22:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[3ee588d](http://git.sagemath.org/sage.git/commit/?id=3ee588dd37871a4a28e7db768e66ab4a44dacd3e)|`Use PARI to diagonalize quadratic forms`|
|[2689325](http://git.sagemath.org/sage.git/commit/?id=2689325b940f209728dd1a83091be2cdac2fcbc8)|`Merge tag '6.10.beta1' into t/18669/use_pari_to_compute_rational_diagonal_form__`|
|[45cbc2d](http://git.sagemath.org/sage.git/commit/?id=45cbc2dea350f0adfbd366fe8048ce8ef840983e)|`Further fixes to rational diagonal form`|
|[ee778c8](http://git.sagemath.org/sage.git/commit/?id=ee778c87c15f75c5243ff5fd0da38efa85129335)|`Implements a method to compute isometries between positive definite quadratic forms.`|
|[27b2190](http://git.sagemath.org/sage.git/commit/?id=27b21901366cf4dac41e41a247ab930a95d2df7a)|`Adds a flag parameter to short_vector_list_up_to_length to pass to PARI's`|
|[92de9ef](http://git.sagemath.org/sage.git/commit/?id=92de9efe06c5236871f5faeacabe36a24378114e)|`Adds isometry method for quadratic forms.`|
|[1b1a574](http://git.sagemath.org/sage.git/commit/?id=1b1a5744240fc03a9dbbaa6ab3ef700f9d23f0e7)|`Merge branch 'ticket/19533' into ticket/19112`|
|[2f8ebc7](http://git.sagemath.org/sage.git/commit/?id=2f8ebc70a1b236e1ca765b7cbc982587694f6a77)|`Bug fixes in 'isometry' method and refactoring to utilize the 'solve' method for quadratic forms`|
|[8f8ce15](http://git.sagemath.org/sage.git/commit/?id=8f8ce1575dcfb53fee524a9e546d297d22aa82a0)|`Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into ticket/19112`|



---

archive/issue_comments_340428.json:
```json
{
    "body": "Changing commit from \"8a040f3e2bdc5b312bd14b1fe36e85dda87ead91\" to \"8f8ce1575dcfb53fee524a9e546d297d22aa82a0\"",
    "created_at": "2015-12-01T22:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8a040f3e2bdc5b312bd14b1fe36e85dda87ead91" to "8f8ce1575dcfb53fee524a9e546d297d22aa82a0"



---

archive/issue_comments_340429.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-01T22:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340429",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_340430.json:
```json
{
    "body": "<a id='comment:18'></a>\nCan you review #18669?",
    "created_at": "2015-12-02T08:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340430",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Can you review #18669?



---

archive/issue_comments_340431.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe patchbot complains about a TAB character.",
    "created_at": "2015-12-04T14:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340431",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
The patchbot complains about a TAB character.



---

archive/issue_comments_340432.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[d2b3dde](http://git.sagemath.org/sage.git/commit/?id=d2b3dde11edb22ba199d4666b99ad753865c5322)|`Removed errant TAB character in quadratic_form.py`|",
    "created_at": "2015-12-04T17:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[d2b3dde](http://git.sagemath.org/sage.git/commit/?id=d2b3dde11edb22ba199d4666b99ad753865c5322)|`Removed errant TAB character in quadratic_form.py`|



---

archive/issue_comments_340433.json:
```json
{
    "body": "Changing commit from \"8f8ce1575dcfb53fee524a9e546d297d22aa82a0\" to \"d2b3dde11edb22ba199d4666b99ad753865c5322\"",
    "created_at": "2015-12-04T17:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8f8ce1575dcfb53fee524a9e546d297d22aa82a0" to "d2b3dde11edb22ba199d4666b99ad753865c5322"



---

archive/issue_comments_340434.json:
```json
{
    "body": "Changing dependencies from \"#18669 #19533\" to \"\"",
    "created_at": "2015-12-05T09:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340434",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#18669 #19533" to ""



---

archive/issue_comments_340435.json:
```json
{
    "body": "<a id='comment:22'></a>\nI haven't looked closely at the code, but some clean-up should be done:\n1. the function `diagonal_isometry` should have doctests\n2. remove commented code like `#print ...`",
    "created_at": "2015-12-05T21:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340435",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
I haven't looked closely at the code, but some clean-up should be done:
1. the function `diagonal_isometry` should have doctests
2. remove commented code like `#print ...`



---

archive/issue_comments_340436.json:
```json
{
    "body": "<a id='comment:23'></a>\nWhy does the final term need to be a special case? I don't like special cases unless they are justified.",
    "created_at": "2015-12-05T21:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340436",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Why does the final term need to be a special case? I don't like special cases unless they are justified.



---

archive/issue_comments_340437.json:
```json
{
    "body": "<a id='comment:24'></a>\nAre you sure it's worth to check `is_diagonal`? Is there significant gain?\n\nAre you sure it's worth to check `is_rationally_isometric`? I would just try to compute the isometry and let it fail if it doesn't exist.",
    "created_at": "2015-12-05T21:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340437",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Are you sure it's worth to check `is_diagonal`? Is there significant gain?

Are you sure it's worth to check `is_rationally_isometric`? I would just try to compute the isometry and let it fail if it doesn't exist.



---

archive/issue_comments_340438.json:
```json
{
    "body": "<a id='comment:25'></a>\nDo you really need the `copy` in the function `isometry`?",
    "created_at": "2015-12-05T21:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340438",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Do you really need the `copy` in the function `isometry`?



---

archive/issue_comments_340439.json:
```json
{
    "body": "<a id='comment:26'></a>\nCan you explain this block of code:\n\n```diff\n+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]\n+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)\n+            v = vector([0] * (n - i))\n+            index = 0;\n+            while True:\n+                v[index] = v[index] + 1\n+                index = (index + 1) % (n - i)\n+                c = Q(v)\n+                try:\n+                    w = F.solve(c)\n+                    #print(\"Find vectors {0} and {1} such that Q(v) = F(w)\".format(v, w))        \n+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):\n+                        break\n+                except ArithmeticError:\n+                    # No solution found, try another vector.\n+                    pass\n```",
    "created_at": "2015-12-05T21:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340439",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Can you explain this block of code:

```diff
+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]
+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)
+            v = vector([0] * (n - i))
+            index = 0;
+            while True:
+                v[index] = v[index] + 1
+                index = (index + 1) % (n - i)
+                c = Q(v)
+                try:
+                    w = F.solve(c)
+                    #print("Find vectors {0} and {1} such that Q(v) = F(w)".format(v, w))        
+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):
+                        break
+                except ArithmeticError:
+                    # No solution found, try another vector.
+                    pass
```



---

archive/issue_comments_340440.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-05T21:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340440",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_340441.json:
```json
{
    "body": "<a id='comment:28'></a>\nCan you move the helper functions out of the `diagonal_isometry` function and also doctest them?",
    "created_at": "2015-12-05T22:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340441",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Can you move the helper functions out of the `diagonal_isometry` function and also doctest them?



---

archive/issue_comments_340442.json:
```json
{
    "body": "<a id='comment:29'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[4b22c51](http://git.sagemath.org/sage.git/commit/?id=4b22c5155459c95fe2fac874c49d8bc7843f08c5)|`Added doctesting to helper methods of isometry`|",
    "created_at": "2015-12-10T17:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[4b22c51](http://git.sagemath.org/sage.git/commit/?id=4b22c5155459c95fe2fac874c49d8bc7843f08c5)|`Added doctesting to helper methods of isometry`|



---

archive/issue_comments_340443.json:
```json
{
    "body": "Changing commit from \"d2b3dde11edb22ba199d4666b99ad753865c5322\" to \"4b22c5155459c95fe2fac874c49d8bc7843f08c5\"",
    "created_at": "2015-12-10T17:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340443",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d2b3dde11edb22ba199d4666b99ad753865c5322" to "4b22c5155459c95fe2fac874c49d8bc7843f08c5"



---

archive/issue_comments_340444.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[582ae45](http://git.sagemath.org/sage.git/commit/?id=582ae4500eb3652446c6f829310298953f8dbd02)|`Minor bugfixes/refactoring on isometry`|",
    "created_at": "2015-12-10T20:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340444",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[582ae45](http://git.sagemath.org/sage.git/commit/?id=582ae4500eb3652446c6f829310298953f8dbd02)|`Minor bugfixes/refactoring on isometry`|



---

archive/issue_comments_340445.json:
```json
{
    "body": "Changing commit from \"4b22c5155459c95fe2fac874c49d8bc7843f08c5\" to \"582ae4500eb3652446c6f829310298953f8dbd02\"",
    "created_at": "2015-12-10T20:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4b22c5155459c95fe2fac874c49d8bc7843f08c5" to "582ae4500eb3652446c6f829310298953f8dbd02"



---

archive/issue_comments_340446.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [jdemeyer](#comment%3A23):\n> Why does the final term need to be a special case? I don't like special cases unless they are justified.\n\n\nIt was originally necessary because the `short_vector_list_up_to_length()` function didn't work for 1-dimensional quadratic forms, and the final iteration of the algorithm operates on two 1-dimensional forms. However, since that's been replaced by the PARI method, it's no longer necessary to have it as a special case, so thanks for pointing that out.\n\n> Are you sure it's worth to check `is_diagonal`? Is there significant gain?\n\n\nI suppose not, and simplifies the code to remove it, so I will.\n\n> Are you sure it's worth to check `is_rationally_isometric`?\n\n\nI believe this is necessary. The loop that looks for two vectors such that the modified bases including them will be non-singular will try vectors indefinitely until it finds a satisfactory pair. If the forms aren't equivalent there's no guarantee such a pair will be found.\n\n> Do you really need the `copy` in the function `isometry`?\n\n\nNope. That's a relic from an early version when `isometry` and `diagonal_isometry` were one function. I'll remove it, thanks for catching that.\n\n> Can you explain this block of code:\n\n{{{\n+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]\n+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)\n+            v = vector([0] * (n - i))\n+            index = 0;\n+            while True:\n+                v[index] = v[index] + 1\n+                index = (index + 1) % (n - i)\n+                c = Q(v)\n+                try:\n+                    w = F.solve(c)\n+                    #print(\"Find vectors {0} and {1} such that Q(v) = F(w)\".format(v, w))        \n+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):\n+                        break\n+                except ArithmeticError:\n+                    # No solution found, try another vector.\n+                    pass\n}}}\n\nThis block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`\n\nAlso, I realized that matrices have an `is_singular` function, so I'm getting rid of the `zero_row` function.\n\n---\nNew commits:\n|                                                                                                                                          |                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[582ae45](http://git.sagemath.org/sage.git/commit/?id=582ae4500eb3652446c6f829310298953f8dbd02)|`Minor bugfixes/refactoring on isometry`|",
    "created_at": "2015-12-10T20:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340446",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

<a id='comment:31'></a>
Replying to [jdemeyer](#comment%3A23):
> Why does the final term need to be a special case? I don't like special cases unless they are justified.


It was originally necessary because the `short_vector_list_up_to_length()` function didn't work for 1-dimensional quadratic forms, and the final iteration of the algorithm operates on two 1-dimensional forms. However, since that's been replaced by the PARI method, it's no longer necessary to have it as a special case, so thanks for pointing that out.

> Are you sure it's worth to check `is_diagonal`? Is there significant gain?


I suppose not, and simplifies the code to remove it, so I will.

> Are you sure it's worth to check `is_rationally_isometric`?


I believe this is necessary. The loop that looks for two vectors such that the modified bases including them will be non-singular will try vectors indefinitely until it finds a satisfactory pair. If the forms aren't equivalent there's no guarantee such a pair will be found.

> Do you really need the `copy` in the function `isometry`?


Nope. That's a relic from an early version when `isometry` and `diagonal_isometry` were one function. I'll remove it, thanks for catching that.

> Can you explain this block of code:

{{{
+            # Find a vector w such that Q(v) = F(w) where v = [1, ..., 0]
+            # v, w = vectors_of_common_length_dev(Q, F, q_basis, f_basis, i)
+            v = vector([0] * (n - i))
+            index = 0;
+            while True:
+                v[index] = v[index] + 1
+                index = (index + 1) % (n - i)
+                c = Q(v)
+                try:
+                    w = F.solve(c)
+                    #print("Find vectors {0} and {1} such that Q(v) = F(w)".format(v, w))        
+                    if not zero_row(f_basis, w, i) and not zero_row(q_basis, v, i):
+                        break
+                except ArithmeticError:
+                    # No solution found, try another vector.
+                    pass
}}}

This block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`

Also, I realized that matrices have an `is_singular` function, so I'm getting rid of the `zero_row` function.

---
New commits:
|                                                                                                                                          |                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[582ae45](http://git.sagemath.org/sage.git/commit/?id=582ae4500eb3652446c6f829310298953f8dbd02)|`Minor bugfixes/refactoring on isometry`|



---

archive/issue_comments_340447.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-10T20:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340447",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_340448.json:
```json
{
    "body": "<a id='comment:33'></a>\nMore comments later, but already this: you make changes to `short_vector_list_up_to_length()` which I think do not belong to this ticket. In fact, it looks more likely that they belong to #14868. So I suggest you undo those changes here and move them to a new branch on #14868.",
    "created_at": "2015-12-12T16:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340448",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
More comments later, but already this: you make changes to `short_vector_list_up_to_length()` which I think do not belong to this ticket. In fact, it looks more likely that they belong to #14868. So I suggest you undo those changes here and move them to a new branch on #14868.



---

archive/issue_comments_340449.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [tgaona](#comment%3A31):\n> This block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`\n\n\nSorry, I still don't understand the algorithm. You really need more comments *in the code*. In particular, you need to explain the purpose of the variables `i`, `q_basis`, `f_basis`, `qb` and `fb`.\n\nMy feeling is that the current algorithm is too complicated (I don't think you need to loop for `v`), but I cannot really say how to improve it since I don't understand it.",
    "created_at": "2015-12-12T16:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340449",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
Replying to [tgaona](#comment%3A31):
> This block finds a pair of vectors `v` and `w` such that `Q(v) == F(v)`. These vectors will represent a linear combination of the vectors in the basis for each quadratic form. It's necessary that modifying the bases to include these vectors not produce a basis whose matrix is singular. So essentially this loop just looks for a pair of vectors satsifying these properties. It starts with `v = [1, 0, 0]` (for a 3-dimensional form) and finds `w` by calling `F.solve(Q(v))`. If this pair doesn't work, it finds a new `v` and starts over. I get new `v`'s by incrementing each term in the vector so the first few vectors that are generated are: `[1, 0, 0], [1, 1, 0], [1, 1, 1], [2, 1, 1]...`


Sorry, I still don't understand the algorithm. You really need more comments *in the code*. In particular, you need to explain the purpose of the variables `i`, `q_basis`, `f_basis`, `qb` and `fb`.

My feeling is that the current algorithm is too complicated (I don't think you need to loop for `v`), but I cannot really say how to improve it since I don't understand it.



---

archive/issue_comments_340450.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-12-22T13:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340450",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_340451.json:
```json
{
    "body": "<a id='comment:36'></a>\nI have looked over tgaona's algorithm, and it makes sense to me.  The block of code mentioned in comment 26 is a bit confusing, but I believe that it is necessary since its eventually necessary to invert, and therefore avoid the possibility of having a singular change of basis matrix.  \n\nAnother source of confusion, I believe, is in the description of the helper function `modify basis`.  I do believe that it does precisely what it needs to do in the context of the code, but the description is not quite correct, and a little bit misleading, since it is always a function acting on a submatrix of the original basis matrix. A better description might read \"Given a lattice L with basis matrix M and a vector, v=(v_1,...,v_n) of length n, this function extends the basis {b_1,...,b_n} of an underlying nxn orthogonal component of L to contain the vector v_1b_1+...+v_nb_n.\"   \n\nThe functions `diagonal_isometry`, `compute_gram_matrix_from_basis`, `modify_basis`, and `graham_schmidt` are all very particular to this parent function `isometry`, so (I believe) the standard Sage convention is to begin those with an underscore.  Also, I believe a better name for the parent function would be `explicit_isometry` just to differentiate this from the binary function returning True or False.  \n\nOther than that, I'll concede that there may very well be a faster way to run this algorithm, but as tgaona has it, it's certainly correct.",
    "created_at": "2016-01-11T03:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340451",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:36'></a>
I have looked over tgaona's algorithm, and it makes sense to me.  The block of code mentioned in comment 26 is a bit confusing, but I believe that it is necessary since its eventually necessary to invert, and therefore avoid the possibility of having a singular change of basis matrix.  

Another source of confusion, I believe, is in the description of the helper function `modify basis`.  I do believe that it does precisely what it needs to do in the context of the code, but the description is not quite correct, and a little bit misleading, since it is always a function acting on a submatrix of the original basis matrix. A better description might read "Given a lattice L with basis matrix M and a vector, v=(v_1,...,v_n) of length n, this function extends the basis {b_1,...,b_n} of an underlying nxn orthogonal component of L to contain the vector v_1b_1+...+v_nb_n."   

The functions `diagonal_isometry`, `compute_gram_matrix_from_basis`, `modify_basis`, and `graham_schmidt` are all very particular to this parent function `isometry`, so (I believe) the standard Sage convention is to begin those with an underscore.  Also, I believe a better name for the parent function would be `explicit_isometry` just to differentiate this from the binary function returning True or False.  

Other than that, I'll concede that there may very well be a faster way to run this algorithm, but as tgaona has it, it's certainly correct.



---

archive/issue_comments_340452.json:
```json
{
    "body": "Changing commit from \"582ae4500eb3652446c6f829310298953f8dbd02\" to \"17d12c6faa5f18a9f822e30239bf201e2fe76c5f\"",
    "created_at": "2016-01-12T15:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "582ae4500eb3652446c6f829310298953f8dbd02" to "17d12c6faa5f18a9f822e30239bf201e2fe76c5f"



---

archive/issue_comments_340453.json:
```json
{
    "body": "<a id='comment:37'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[6d9be4f](http://git.sagemath.org/sage.git/commit/?id=6d9be4f9e02047514b90a32d0035bf26ffd6d2c2)|`removed changes to 'short_vector_list_up_to_length()'`|\n|[17d12c6](http://git.sagemath.org/sage.git/commit/?id=17d12c6faa5f18a9f822e30239bf201e2fe76c5f)|`Prefixed helper functions with an underscore and reworded documentation.`|",
    "created_at": "2016-01-12T15:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340453",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[6d9be4f](http://git.sagemath.org/sage.git/commit/?id=6d9be4f9e02047514b90a32d0035bf26ffd6d2c2)|`removed changes to 'short_vector_list_up_to_length()'`|
|[17d12c6](http://git.sagemath.org/sage.git/commit/?id=17d12c6faa5f18a9f822e30239bf201e2fe76c5f)|`Prefixed helper functions with an underscore and reworded documentation.`|



---

archive/issue_comments_340454.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-01-17T02:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340454",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_340455.json:
```json
{
    "body": "<a id='comment:39'></a>\nSorry, but [comment:34] hasn't been addressed yet. The code is simply too hard to understand and therefore impossible to review for me.\n\nAnd why did you rename `isometry` -> `explicit_isometry`? That's much harder to find.",
    "created_at": "2016-01-17T09:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340455",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Sorry, but [comment:34] hasn't been addressed yet. The code is simply too hard to understand and therefore impossible to review for me.

And why did you rename `isometry` -> `explicit_isometry`? That's much harder to find.



---

archive/issue_comments_340456.json:
```json
{
    "body": "<a id='comment:40'></a>\nMerge conflicts with Sage 7.0",
    "created_at": "2016-01-20T09:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340456",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
Merge conflicts with Sage 7.0



---

archive/issue_comments_340457.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-20T09:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340457",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_340458.json:
```json
{
    "body": "<a id='comment:41'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[56b5225](http://git.sagemath.org/sage.git/commit/?id=56b5225a8caec33e4b4366a90d1686fc0a5f6768)|`Merge branch 'develop' of git://trac.sagemath.org/sage into ticket/19112`|",
    "created_at": "2016-01-30T18:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340458",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[56b5225](http://git.sagemath.org/sage.git/commit/?id=56b5225a8caec33e4b4366a90d1686fc0a5f6768)|`Merge branch 'develop' of git://trac.sagemath.org/sage into ticket/19112`|



---

archive/issue_comments_340459.json:
```json
{
    "body": "Changing commit from \"17d12c6faa5f18a9f822e30239bf201e2fe76c5f\" to \"56b5225a8caec33e4b4366a90d1686fc0a5f6768\"",
    "created_at": "2016-01-30T18:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340459",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "17d12c6faa5f18a9f822e30239bf201e2fe76c5f" to "56b5225a8caec33e4b4366a90d1686fc0a5f6768"



---

archive/issue_comments_340460.json:
```json
{
    "body": "<a id='comment:42'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[132da46](http://git.sagemath.org/sage.git/commit/?id=132da46da12b3faa32c8cb22b25f25fb224cd80c)|`attempt to simplify algorithm`|\n|[24e01fe](http://git.sagemath.org/sage.git/commit/?id=24e01fe5dfcbdb6e31947f20e9ddefd3746c20cc)|`Simplified algorithm and code for 'isometry' and its helpers`|\n|[a56cb96](http://git.sagemath.org/sage.git/commit/?id=a56cb960a859fd2cb318d00bc06eacebb8cccb91)|`Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into isometry2`|",
    "created_at": "2016-03-09T19:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340460",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[132da46](http://git.sagemath.org/sage.git/commit/?id=132da46da12b3faa32c8cb22b25f25fb224cd80c)|`attempt to simplify algorithm`|
|[24e01fe](http://git.sagemath.org/sage.git/commit/?id=24e01fe5dfcbdb6e31947f20e9ddefd3746c20cc)|`Simplified algorithm and code for 'isometry' and its helpers`|
|[a56cb96](http://git.sagemath.org/sage.git/commit/?id=a56cb960a859fd2cb318d00bc06eacebb8cccb91)|`Merge branch 'u/tgaona/ticket/19112' of git://trac.sagemath.org/sage into isometry2`|



---

archive/issue_comments_340461.json:
```json
{
    "body": "Changing commit from \"56b5225a8caec33e4b4366a90d1686fc0a5f6768\" to \"a56cb960a859fd2cb318d00bc06eacebb8cccb91\"",
    "created_at": "2016-03-09T19:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "56b5225a8caec33e4b4366a90d1686fc0a5f6768" to "a56cb960a859fd2cb318d00bc06eacebb8cccb91"



---

archive/issue_comments_340462.json:
```json
{
    "body": "Changing commit from \"a56cb960a859fd2cb318d00bc06eacebb8cccb91\" to \"642df1071e10e3a771abd7d02ceff017c0a3ef30\"",
    "created_at": "2016-03-09T19:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340462",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a56cb960a859fd2cb318d00bc06eacebb8cccb91" to "642df1071e10e3a771abd7d02ceff017c0a3ef30"



---

archive/issue_comments_340463.json:
```json
{
    "body": "<a id='comment:43'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[642df10](http://git.sagemath.org/sage.git/commit/?id=642df1071e10e3a771abd7d02ceff017c0a3ef30)|`Fixed typo in documentation example for _diagonal_isometry`|",
    "created_at": "2016-03-09T19:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[642df10](http://git.sagemath.org/sage.git/commit/?id=642df1071e10e3a771abd7d02ceff017c0a3ef30)|`Fixed typo in documentation example for _diagonal_isometry`|



---

archive/issue_comments_340464.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-09T19:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340464",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_053105.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-10T07:22:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53105"
}
```



---

archive/issue_events_053106.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-10T07:22:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53106"
}
```



---

archive/issue_comments_340465.json:
```json
{
    "body": "<a id='comment:45'></a>\nWhy this added line?\n\n```diff\n+            v = parilist[i]\n```",
    "created_at": "2016-03-10T07:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340465",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'></a>
Why this added line?

```diff
+            v = parilist[i]
```



---

archive/issue_comments_340466.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-10T07:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340466",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_340467.json:
```json
{
    "body": "<a id='comment:46'></a>\nI am still missing some high-level explanation of the algorithm. For example, what is `FM`?",
    "created_at": "2016-03-10T07:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340467",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'></a>
I am still missing some high-level explanation of the algorithm. For example, what is `FM`?



---

archive/issue_comments_340468.json:
```json
{
    "body": "<a id='comment:47'></a>\nI understand the algorithm, I don't think it's so complicated.  It just looks for a vector w in W of length corresponding to, V[0][0], the upper left most entry in V.  Then it simply extends the basis of W to contain w, preforms Gram Schmidt (fixing w), and then picks off <Q(w)> as an orthogonal component of W and <V[0][0]> as an orthogonal component of V.  I feel satisfied the the algorithm does what it claims to do, and that it is mathematically correct. \n\nA few notes on the documentation: \n\n1.  In your documentation for `_diagonal_isometry()` you call the function `isometry()` (of course it works out to be the same thing here, since the forms are diagonal to begin with. \n\n2. Your documentation for `_gram_schmidt()` is a bit misleading, since it looks like you are treating the columns of a Gram matrix as a set of vectors to be orthogonalized, rather, do the process on some sort of (preferably basis) matrix.   \n\nIn response to comment 45, I'm also not sure why v=parilist[i] got added.  Is there a reason you're touching `short_vector_list_up_to_length()`?  I think something may have happened on the merge.",
    "created_at": "2016-03-10T22:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340468",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:47'></a>
I understand the algorithm, I don't think it's so complicated.  It just looks for a vector w in W of length corresponding to, V[0][0], the upper left most entry in V.  Then it simply extends the basis of W to contain w, preforms Gram Schmidt (fixing w), and then picks off <Q(w)> as an orthogonal component of W and <V[0][0]> as an orthogonal component of V.  I feel satisfied the the algorithm does what it claims to do, and that it is mathematically correct. 

A few notes on the documentation: 

1.  In your documentation for `_diagonal_isometry()` you call the function `isometry()` (of course it works out to be the same thing here, since the forms are diagonal to begin with. 

2. Your documentation for `_gram_schmidt()` is a bit misleading, since it looks like you are treating the columns of a Gram matrix as a set of vectors to be orthogonalized, rather, do the process on some sort of (preferably basis) matrix.   

In response to comment 45, I'm also not sure why v=parilist[i] got added.  Is there a reason you're touching `short_vector_list_up_to_length()`?  I think something may have happened on the merge.



---

archive/issue_comments_340469.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [annahaensch](#comment%3A47):\n> I understand the algorithm\n\n\nThe fact that **you** understand it, is not sufficient. It should be documented in the code such that **everybody** can understand it.",
    "created_at": "2016-03-11T08:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340469",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>
Replying to [annahaensch](#comment%3A47):
> I understand the algorithm


The fact that **you** understand it, is not sufficient. It should be documented in the code such that **everybody** can understand it.



---

archive/issue_comments_340470.json:
```json
{
    "body": "<a id='comment:49'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[2b8f694](http://git.sagemath.org/sage.git/commit/?id=2b8f69416667585a5d5d95bfb0272ffd059d066c)|`removed old line from quadratic_form__automorphisms`|\n|[70ed429](http://git.sagemath.org/sage.git/commit/?id=70ed4293b680ec8859683a8e1c3b7791c1c67e73)|`Fixed documentation errors and added more comments to _diagonal_isometry`|",
    "created_at": "2016-03-11T19:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340470",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[2b8f694](http://git.sagemath.org/sage.git/commit/?id=2b8f69416667585a5d5d95bfb0272ffd059d066c)|`removed old line from quadratic_form__automorphisms`|
|[70ed429](http://git.sagemath.org/sage.git/commit/?id=70ed4293b680ec8859683a8e1c3b7791c1c67e73)|`Fixed documentation errors and added more comments to _diagonal_isometry`|



---

archive/issue_comments_340471.json:
```json
{
    "body": "Changing commit from \"642df1071e10e3a771abd7d02ceff017c0a3ef30\" to \"70ed4293b680ec8859683a8e1c3b7791c1c67e73\"",
    "created_at": "2016-03-11T19:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "642df1071e10e3a771abd7d02ceff017c0a3ef30" to "70ed4293b680ec8859683a8e1c3b7791c1c67e73"



---

archive/issue_comments_340472.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-11T19:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340472",
    "user": "https://trac.sagemath.org/admin/accounts/users/tgaona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_340473.json:
```json
{
    "body": "Changing commit from \"70ed4293b680ec8859683a8e1c3b7791c1c67e73\" to \"0b8841492ca2e5714879cadacb6076f595927bd7\"",
    "created_at": "2016-08-28T13:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340473",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "70ed4293b680ec8859683a8e1c3b7791c1c67e73" to "0b8841492ca2e5714879cadacb6076f595927bd7"



---

archive/issue_comments_340474.json:
```json
{
    "body": "<a id='comment:51'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[44c29ef](https://git.sagemath.org/sage.git/commit/?id=44c29ef655f675bc8ad063913ffc5057543430bb)|`Merge branch 'master' into isometry2`|\n|[0b88414](https://git.sagemath.org/sage.git/commit/?id=0b8841492ca2e5714879cadacb6076f595927bd7)|`Changed 'from quadratic_form' to 'from sage.quadratic_forms.quadratic_form'`|",
    "created_at": "2016-08-28T13:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[44c29ef](https://git.sagemath.org/sage.git/commit/?id=44c29ef655f675bc8ad063913ffc5057543430bb)|`Merge branch 'master' into isometry2`|
|[0b88414](https://git.sagemath.org/sage.git/commit/?id=0b8841492ca2e5714879cadacb6076f595927bd7)|`Changed 'from quadratic_form' to 'from sage.quadratic_forms.quadratic_form'`|



---

archive/issue_comments_340475.json:
```json
{
    "body": "<a id='comment:52'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[2b394f4](https://git.sagemath.org/sage.git/commit/?id=2b394f41bd18eb22c6558a1441444692b79caec7)|`Removed trailing whitespace.`|",
    "created_at": "2016-08-29T12:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340475",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[2b394f4](https://git.sagemath.org/sage.git/commit/?id=2b394f41bd18eb22c6558a1441444692b79caec7)|`Removed trailing whitespace.`|



---

archive/issue_comments_340476.json:
```json
{
    "body": "Changing commit from \"0b8841492ca2e5714879cadacb6076f595927bd7\" to \"2b394f41bd18eb22c6558a1441444692b79caec7\"",
    "created_at": "2016-08-29T12:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0b8841492ca2e5714879cadacb6076f595927bd7" to "2b394f41bd18eb22c6558a1441444692b79caec7"



---

archive/issue_comments_340477.json:
```json
{
    "body": "<a id='comment:53'></a>\nThank you for writing this code. It is well documented and easy to read. \nThe basic algorithm works. Good job!\nAfter computing some examples I noticed that coefficients tend to explode and\nexamples beyond n=4 take ages. Is this expected? Is there an algorithm avoiding coefficient blowups?\n\nI can review it. Here are some comments:\n\n- use imperative in the docstrings: \"Computes something\". Should rather be: \"Compute something\" \n- There is no need to introduce a new method `isometry()`. Instead give `is_rationally_isometric` a new argument `return_matrix`. You can model analogous behavior as in `is_globally_equivalent_to`.\n\n- In the current implementation you do not check the `base_ring` is `ZZ` or `QQ`. This should be done. Or does it work more generally? For example the code does not work over the p-adics. \n- You do not need a new method`_compute_gram_matrix_from_basis`. Instead you can just use `Q(T).Gram_matrix_rational()`. Here `Q` is a quadratic form and `T` a transformation matrix.\n- make sure degenerate quadratic forms work as well and doctest it.\n- add a random doctest. For example something in the direction of:\n\n```\nsage: n = 4\nsage: G = matrix.random(QQ,n) #random\nsage: G = G + G.transpose()\nsage: Q = QuadraticForm(QQ,G)\nsage: T = matrix.random(QQ,n)\nsage: S = Q.isometry(Q(T))\nsage: Q == Q(S)\nTrue\n```",
    "created_at": "2017-10-15T19:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340477",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:53'></a>
Thank you for writing this code. It is well documented and easy to read. 
The basic algorithm works. Good job!
After computing some examples I noticed that coefficients tend to explode and
examples beyond n=4 take ages. Is this expected? Is there an algorithm avoiding coefficient blowups?

I can review it. Here are some comments:

- use imperative in the docstrings: "Computes something". Should rather be: "Compute something" 
- There is no need to introduce a new method `isometry()`. Instead give `is_rationally_isometric` a new argument `return_matrix`. You can model analogous behavior as in `is_globally_equivalent_to`.

- In the current implementation you do not check the `base_ring` is `ZZ` or `QQ`. This should be done. Or does it work more generally? For example the code does not work over the p-adics. 
- You do not need a new method`_compute_gram_matrix_from_basis`. Instead you can just use `Q(T).Gram_matrix_rational()`. Here `Q` is a quadratic form and `T` a transformation matrix.
- make sure degenerate quadratic forms work as well and doctest it.
- add a random doctest. For example something in the direction of:

```
sage: n = 4
sage: G = matrix.random(QQ,n) #random
sage: G = G + G.transpose()
sage: Q = QuadraticForm(QQ,G)
sage: T = matrix.random(QQ,n)
sage: S = Q.isometry(Q(T))
sage: Q == Q(S)
True
```



---

archive/issue_comments_340478.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Simon Brandhorst\"",
    "created_at": "2017-10-15T19:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340478",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing reviewer from "" to "Simon Brandhorst"



---

archive/issue_comments_340479.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-30T18:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340479",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_340480.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Adds a function \"isometry\" that returns an isometry from one quadratic form to another, provided that it exists.\n+Adds a function \"isometry\" that returns an isometry from one rational quadratic form to another, provided that it exists.\n``````\n",
    "created_at": "2018-05-25T05:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340480",
    "user": "https://github.com/simonbrandhorst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Adds a function "isometry" that returns an isometry from one quadratic form to another, provided that it exists.
+Adds a function "isometry" that returns an isometry from one rational quadratic form to another, provided that it exists.
``````




---

archive/issue_events_053107.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-28T12:43:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53107"
}
```



---

archive/issue_events_053108.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-28T12:43:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53108"
}
```



---

archive/issue_comments_340481.json:
```json
{
    "body": "<a id='comment:56'></a>\nthe patchbot results look OK (apart from pyflake plugin, which might tell you how to improve the code).",
    "created_at": "2019-05-28T12:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340481",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:56'></a>
the patchbot results look OK (apart from pyflake plugin, which might tell you how to improve the code).



---

archive/issue_comments_340482.json:
```json
{
    "body": "<a id='comment:57'></a>\nTickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340482",
    "user": "https://github.com/embray"
}
```

<a id='comment:57'></a>
Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_events_053109.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53109"
}
```



---

archive/issue_events_053110.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53110"
}
```



---

archive/issue_comments_340483.json:
```json
{
    "body": "<a id='comment:58'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340483",
    "user": "https://github.com/embray"
}
```

<a id='comment:58'></a>
Ticket retargeted after milestone closed



---

archive/issue_events_053111.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53111"
}
```



---

archive/issue_events_053112.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53112"
}
```



---

archive/issue_comments_340484.json:
```json
{
    "body": "<a id='comment:59'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340484",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_053113.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53113"
}
```



---

archive/issue_events_053114.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53114"
}
```



---

archive/issue_events_053115.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53115"
}
```



---

archive/issue_events_053116.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53116"
}
```



---

archive/issue_comments_340485.json:
```json
{
    "body": "Changing branch from \"u/tgaona/ticket/19112\" to \"u/sbrandhorst/ticket/19112\"",
    "created_at": "2020-10-02T09:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340485",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing branch from "u/tgaona/ticket/19112" to "u/sbrandhorst/ticket/19112"



---

archive/issue_comments_340486.json:
```json
{
    "body": "Changing commit from \"2b394f41bd18eb22c6558a1441444692b79caec7\" to \"ffa529517a8e0da5dc459e39b510737dca5d2943\"",
    "created_at": "2020-10-02T09:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340486",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing commit from "2b394f41bd18eb22c6558a1441444692b79caec7" to "ffa529517a8e0da5dc459e39b510737dca5d2943"



---

archive/issue_comments_340487.json:
```json
{
    "body": "<a id='comment:62'></a>\nNew commits:\n|                                                                                                                                          |                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[cb76909](https://git.sagemath.org/sage.git/commit?id=cb76909579ad23e80562bbfc3a39749119b3e001)|`Merge branch 'develop' into t/19112/ticket/19112`|\n|[ffa5295](https://git.sagemath.org/sage.git/commit?id=ffa529517a8e0da5dc459e39b510737dca5d2943)|`is_rationally_equivalent_to cleanup`|",
    "created_at": "2020-10-02T09:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340487",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:62'></a>
New commits:
|                                                                                                                                          |                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[cb76909](https://git.sagemath.org/sage.git/commit?id=cb76909579ad23e80562bbfc3a39749119b3e001)|`Merge branch 'develop' into t/19112/ticket/19112`|
|[ffa5295](https://git.sagemath.org/sage.git/commit?id=ffa529517a8e0da5dc459e39b510737dca5d2943)|`is_rationally_equivalent_to cleanup`|



---

archive/issue_comments_340488.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-02T09:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340488",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_340489.json:
```json
{
    "body": "Changing author from \"Tyler Gaona\" to \"Tyler Gaona, Simon Brandorst\"",
    "created_at": "2020-10-02T09:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340489",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing author from "Tyler Gaona" to "Tyler Gaona, Simon Brandorst"



---

archive/issue_comments_340490.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-02T09:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340490",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_340491.json:
```json
{
    "body": "<a id='comment:63'></a>\nI guess my contribution counts as a reviewer patch...",
    "created_at": "2020-10-02T09:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340491",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:63'></a>
I guess my contribution counts as a reviewer patch...



---

archive/issue_comments_340492.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-07T16:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340492",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_340493.json:
```json
{
    "body": "Changing branch from \"u/sbrandhorst/ticket/19112\" to \"ffa529517a8e0da5dc459e39b510737dca5d2943\"",
    "created_at": "2020-11-07T16:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340493",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/sbrandhorst/ticket/19112" to "ffa529517a8e0da5dc459e39b510737dca5d2943"



---

archive/issue_events_053117.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-07T16:23:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19112#event-53117"
}
```



---

archive/issue_comments_340494.json:
```json
{
    "body": "Changing author from \"Tyler Gaona, Simon Brandorst\" to \"Tyler Gaona, Simon Brandhorst\"",
    "created_at": "2021-05-09T23:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340494",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Tyler Gaona, Simon Brandorst" to "Tyler Gaona, Simon Brandhorst"



---

archive/issue_comments_340495.json:
```json
{
    "body": "Changing commit from \"ffa529517a8e0da5dc459e39b510737dca5d2943\" to \"\"",
    "created_at": "2021-05-09T23:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19112#issuecomment-340495",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "ffa529517a8e0da5dc459e39b510737dca5d2943" to ""
