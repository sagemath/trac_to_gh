# Issue 19706: Upgrade GMP

archive/issues_019469.json:
```json
{
    "body": "**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.2.tar.bz2\n\nCC:  jpflori\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Jeroen Demeyer\n\nBranch: 171e35673ca2e6bfd95a86180d60d8efe3513f00\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19706\n\n",
    "closed_at": "2017-09-22T20:26:40Z",
    "created_at": "2015-12-15T08:56:14Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Upgrade GMP",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19706",
    "user": "https://github.com/jdemeyer"
}
```
**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.2.tar.bz2

CC:  jpflori

Reviewer: François Bissey

Author: Jeroen Demeyer

Branch: 171e35673ca2e6bfd95a86180d60d8efe3513f00

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19706





---

archive/issue_comments_354393.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.0.tar.bz2\n``````\n",
    "created_at": "2015-12-15T09:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354393",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.0.tar.bz2
``````




---

archive/issue_comments_354394.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/upgrade_gmp\"",
    "created_at": "2015-12-15T09:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354394",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/upgrade_gmp"



---

archive/issue_comments_354395.json:
```json
{
    "body": "Changing commit from \"\" to \"94ac0168fcb2c77883bd37b121f047ccd94d9e1a\"",
    "created_at": "2015-12-15T09:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354395",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "94ac0168fcb2c77883bd37b121f047ccd94d9e1a"



---

archive/issue_comments_354396.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2015-12-15T09:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354396",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_354397.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-15T09:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354397",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354398.json:
```json
{
    "body": "<a id='comment:4'></a>I haven't tried `6.1.0` yet but with `6.0.0a` there is a doctest failure in `sage/libs/libecm.pyx` (I contacted Paul Zimmerman about it and he basically said he prefered the convention used for the new result, I can fetch the emails if interested). Also it caused problems with maxima, or rather the underlying ecl. Upgrading ecl to 16.0.0 fixed that but brings some formatting noise (output format changed from `1.2E-3` to `0.12E-2`) see: https://github.com/cschwan/sage-on-gentoo/issues/356",
    "created_at": "2015-12-15T20:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354398",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>I haven't tried `6.1.0` yet but with `6.0.0a` there is a doctest failure in `sage/libs/libecm.pyx` (I contacted Paul Zimmerman about it and he basically said he prefered the convention used for the new result, I can fetch the emails if interested). Also it caused problems with maxima, or rather the underlying ecl. Upgrading ecl to 16.0.0 fixed that but brings some formatting noise (output format changed from `1.2E-3` to `0.12E-2`) see: https://github.com/cschwan/sage-on-gentoo/issues/356



---

archive/issue_comments_354399.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-15T21:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354399",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354400.json:
```json
{
    "body": "<a id='comment:6'></a>There is also this error, which is due to error handling in GMP which does not exist in MPIR:\n\n```\n**********************************************************************\nFile \"src/sage/ext/memory.pyx\", line 9, in sage.ext.memory\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes  \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.ext.memory[0]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"sage/rings/integer.pyx\", line 1921, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:13350)\n        sig_on()\n      File \"sage/ext/interrupt/interrupt.pyx\", line 98, in sage.ext.interrupt.interrupt.sig_raise_exception (build/cythonized/sage/ext/interrupt/interrupt.c:1113)\n        raise RuntimeError(msg)\n    RuntimeError: Aborted\n**********************************************************************\n```",
    "created_at": "2015-12-16T07:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354400",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>There is also this error, which is due to error handling in GMP which does not exist in MPIR:

```
**********************************************************************
File "src/sage/ext/memory.pyx", line 9, in sage.ext.memory
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes  
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.ext.memory[0]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "sage/rings/integer.pyx", line 1921, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:13350)
        sig_on()
      File "sage/ext/interrupt/interrupt.pyx", line 98, in sage.ext.interrupt.interrupt.sig_raise_exception (build/cythonized/sage/ext/interrupt/interrupt.c:1113)
        raise RuntimeError(msg)
    RuntimeError: Aborted
**********************************************************************
```



---

archive/issue_comments_354401.json:
```json
{
    "body": "<a id='comment:7'></a>I get these failures:\n\n```\n----------------------------------------------------------------------\nsage -t --long src/sage/structure/sage_object.pyx  # Killed due to abort\nsage -t --long src/sage/interfaces/maxima.py  # 2 doctests failed\nsage -t --long src/sage/libs/libecm.pyx  # 1 doctest failed\nsage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed\nsage -t --long src/sage/ext/memory.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2015-12-16T07:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354401",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I get these failures:

```
----------------------------------------------------------------------
sage -t --long src/sage/structure/sage_object.pyx  # Killed due to abort
sage -t --long src/sage/interfaces/maxima.py  # 2 doctests failed
sage -t --long src/sage/libs/libecm.pyx  # 1 doctest failed
sage -t --long src/doc/en/constructions/algebraic_geometry.rst  # 1 doctest failed
sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_354402.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 jdemeyer]:\n> There is also this error, which is due to error handling in GMP which does not exist in MPIR:\n> \n> ```\n> **********************************************************************\n> File \"src/sage/ext/memory.pyx\", line 9, in sage.ext.memory\n> Failed example:\n>     2^(2^63-2)\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     MemoryError: failed to allocate 1152921504606847008 bytes  \n> Got:\n>     gmp: overflow in mpz type\n>     Traceback (most recent call last):\n>       File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.ext.memory[0]>\", line 1, in <module>\n>         Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n>       File \"sage/rings/integer.pyx\", line 1921, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:13350)\n>         sig_on()\n>       File \"sage/ext/interrupt/interrupt.pyx\", line 98, in sage.ext.interrupt.interrupt.sig_raise_exception (build/cythonized/sage/ext/interrupt/interrupt.c:1113)\n>         raise RuntimeError(msg)\n>     RuntimeError: Aborted\n> **********************************************************************\n> ```\n\n\nI didn't mention that one because it is an acknowledged issue for a long time. The failure in `sage/libs/libecm.pyx` and `sage/interfaces/maxima.py` I was expecting. The other two are new I think, I'll have to check carefully.\nThe only way to get out of the one with `maxima` is upgrading `ecl`. For `ecm` we may have to change the doctest, I'll dig my emails to Paul about it.",
    "created_at": "2015-12-16T07:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354402",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>Replying to [comment:6 jdemeyer]:
> There is also this error, which is due to error handling in GMP which does not exist in MPIR:
> 
> ```
> **********************************************************************
> File "src/sage/ext/memory.pyx", line 9, in sage.ext.memory
> Failed example:
>     2^(2^63-2)
> Expected:
>     Traceback (most recent call last):
>     ...
>     MemoryError: failed to allocate 1152921504606847008 bytes  
> Got:
>     gmp: overflow in mpz type
>     Traceback (most recent call last):
>       File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.ext.memory[0]>", line 1, in <module>
>         Integer(2)**(Integer(2)**Integer(63)-Integer(2))
>       File "sage/rings/integer.pyx", line 1921, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:13350)
>         sig_on()
>       File "sage/ext/interrupt/interrupt.pyx", line 98, in sage.ext.interrupt.interrupt.sig_raise_exception (build/cythonized/sage/ext/interrupt/interrupt.c:1113)
>         raise RuntimeError(msg)
>     RuntimeError: Aborted
> **********************************************************************
> ```


I didn't mention that one because it is an acknowledged issue for a long time. The failure in `sage/libs/libecm.pyx` and `sage/interfaces/maxima.py` I was expecting. The other two are new I think, I'll have to check carefully.
The only way to get out of the one with `maxima` is upgrading `ecl`. For `ecm` we may have to change the doctest, I'll dig my emails to Paul about it.



---

archive/issue_comments_354403.json:
```json
{
    "body": "<a id='comment:9'></a>My discussion with Paul is in French, roughly translated it goes:\n\"It is linked to a change of behavior of the mpz_invert between `5.1.3` and `6.0.0` when the modulo (last argument) is 1\n\n```\nzimmerma@coing:/tmp$ cat e.c\n#include <stdio.h>\n#include \"gmp.h\"\n\nmain()\n{\n mpz_t a, b;\n int ret;\n printf (\"GMP %s\\n\", gmp_version);\n mpz_init_set_ui (a, 1);\n mpz_init_set_ui (b, 1);\n ret = mpz_invert (a, a, b);\n gmp_printf (\"ret=%d a=%Zd\\n\", ret, a);\n}\n\nzimmerma@coing:/tmp$ gcc e.c /usr/local/gmp-5.1.3/lib/libgmp.a\nzimmerma@coing:/tmp$ ./a.out \nGMP 5.1.3\nret=0 a=1\n\nzimmerma@coing:/tmp$ gcc e.c /usr/local/gmp-6.0.0/lib/libgmp.a\nzimmerma@coing:/tmp$ ./a.out \nGMP 6.0.0\nret=1 a=0\n```\n`GMP 6.0.0`'s behavior feels more logical to me\n\"",
    "created_at": "2015-12-16T08:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354403",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>My discussion with Paul is in French, roughly translated it goes:
"It is linked to a change of behavior of the mpz_invert between `5.1.3` and `6.0.0` when the modulo (last argument) is 1

```
zimmerma@coing:/tmp$ cat e.c
#include <stdio.h>
#include "gmp.h"

main()
{
 mpz_t a, b;
 int ret;
 printf ("GMP %s\n", gmp_version);
 mpz_init_set_ui (a, 1);
 mpz_init_set_ui (b, 1);
 ret = mpz_invert (a, a, b);
 gmp_printf ("ret=%d a=%Zd\n", ret, a);
}

zimmerma@coing:/tmp$ gcc e.c /usr/local/gmp-5.1.3/lib/libgmp.a
zimmerma@coing:/tmp$ ./a.out 
GMP 5.1.3
ret=0 a=1

zimmerma@coing:/tmp$ gcc e.c /usr/local/gmp-6.0.0/lib/libgmp.a
zimmerma@coing:/tmp$ ./a.out 
GMP 6.0.0
ret=1 a=0
```
`GMP 6.0.0`'s behavior feels more logical to me
"



---

archive/issue_comments_354404.json:
```json
{
    "body": "<a id='comment:10'></a>I cannot reproduce the last two failures (in `sage_object.pyx` and `algebraic_geometry.rst`) in sage-on-gentoo after moving to `gmp-6.1.0` on my main machine. Could you provide more details?",
    "created_at": "2015-12-16T23:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354404",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>I cannot reproduce the last two failures (in `sage_object.pyx` and `algebraic_geometry.rst`) in sage-on-gentoo after moving to `gmp-6.1.0` on my main machine. Could you provide more details?



---

archive/issue_comments_354405.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.0.tar.bz2\n+**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.2.tar.bz2\n``````\n",
    "created_at": "2017-09-19T11:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354405",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.0.tar.bz2
+**Tarball**: https://gmplib.org/download/gmp/gmp-6.1.2.tar.bz2
``````




---

archive/issue_events_054068.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-19T11:16:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19706#event-54068"
}
```



---

archive/issue_comments_354406.json:
```json
{
    "body": "Changing commit from \"94ac0168fcb2c77883bd37b121f047ccd94d9e1a\" to \"171e35673ca2e6bfd95a86180d60d8efe3513f00\"",
    "created_at": "2017-09-19T11:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "94ac0168fcb2c77883bd37b121f047ccd94d9e1a" to "171e35673ca2e6bfd95a86180d60d8efe3513f00"



---

archive/issue_comments_354407.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-09-19T11:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_354408.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:8 fbissey]:\n> I didn't mention that one because it is an acknowledged issue for a long time.\n\n\nI looked this up and this seems to be since GMP-4.2.3:\n\n```\nChanges between GMP version 4.2.2 and 4.2.3\n[...]\n  Features:\n  * The allocation functions now detect overflow of the mpz_t type.  This means\n    that overflow will now cause an abort, except when the allocation\n    computation itself overflows.  (Such overflow can probably only happen in\n    powering functions; we will detect powering overflow in the future.)\n```",
    "created_at": "2017-09-19T11:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354408",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Replying to [comment:8 fbissey]:
> I didn't mention that one because it is an acknowledged issue for a long time.


I looked this up and this seems to be since GMP-4.2.3:

```
Changes between GMP version 4.2.2 and 4.2.3
[...]
  Features:
  * The allocation functions now detect overflow of the mpz_t type.  This means
    that overflow will now cause an abort, except when the allocation
    computation itself overflows.  (Such overflow can probably only happen in
    powering functions; we will detect powering overflow in the future.)
```



---

archive/issue_comments_354409.json:
```json
{
    "body": "<a id='comment:15'></a>I asked about this error checking on the GMP mailing list: https://gmplib.org/list-archives/gmp-discuss/2017-September/006144.html",
    "created_at": "2017-09-19T12:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354409",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>I asked about this error checking on the GMP mailing list: https://gmplib.org/list-archives/gmp-discuss/2017-September/006144.html



---

archive/issue_comments_354410.json:
```json
{
    "body": "<a id='comment:16'></a>Builds fine. Running doctests now...",
    "created_at": "2017-09-20T07:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354410",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Builds fine. Running doctests now...



---

archive/issue_comments_354411.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-20T07:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354411",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354412.json:
```json
{
    "body": "<a id='comment:17'></a>All doctests pass apart from the known issues\n\n```\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\nFailed example:\n    1 << (2^60)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate ... bytes   \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.integer.Integer._shift_helper[8]>\", line 1, in <module>\n        Integer(1) << (Integer(2)**Integer(60))\n      File \"sage/rings/integer.pyx\", line 6177, in sage.rings.integer.Integer.__lshift__ (build/cythonized/sage/rings/integer.c:39270)\n        return (<Integer>x)._shift_helper(y, 1)\n      File \"sage/rings/integer.pyx\", line 6138, in sage.rings.integer.Integer._shift_helper (build/cythonized/sage/rings/integer.c:39014)\n        sig_on()\n    RuntimeError: Aborted\n**********************************************************************\n```\nand\n\n```\nsage -t --warn-long 61.3 src/sage/ext/memory.pyx\n**********************************************************************\nFile \"src/sage/ext/memory.pyx\", line 9, in sage.ext.memory\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes  \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.ext.memory[0]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"sage/rings/integer.pyx\", line 2067, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:14173)\n        sig_on()\n    RuntimeError: Aborted\n**********************************************************************\n```",
    "created_at": "2017-09-20T09:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354412",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>All doctests pass apart from the known issues

```
**********************************************************************
File "src/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
Failed example:
    1 << (2^60)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate ... bytes   
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer._shift_helper[8]>", line 1, in <module>
        Integer(1) << (Integer(2)**Integer(60))
      File "sage/rings/integer.pyx", line 6177, in sage.rings.integer.Integer.__lshift__ (build/cythonized/sage/rings/integer.c:39270)
        return (<Integer>x)._shift_helper(y, 1)
      File "sage/rings/integer.pyx", line 6138, in sage.rings.integer.Integer._shift_helper (build/cythonized/sage/rings/integer.c:39014)
        sig_on()
    RuntimeError: Aborted
**********************************************************************
```
and

```
sage -t --warn-long 61.3 src/sage/ext/memory.pyx
**********************************************************************
File "src/sage/ext/memory.pyx", line 9, in sage.ext.memory
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes  
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jdemeyer/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.ext.memory[0]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "sage/rings/integer.pyx", line 2067, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:14173)
        sig_on()
    RuntimeError: Aborted
**********************************************************************
```



---

archive/issue_comments_354413.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-20T09:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354413",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_354414.json:
```json
{
    "body": "<a id='comment:18'></a>Good enough for me.",
    "created_at": "2017-09-20T09:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354414",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>Good enough for me.



---

archive/issue_comments_354415.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2017-09-20T09:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354415",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_354416.json:
```json
{
    "body": "<a id='comment:19'></a>I created #23913 for the longstanding issue of the GMP errors.",
    "created_at": "2017-09-21T13:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354416",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>I created #23913 for the longstanding issue of the GMP errors.



---

archive/issue_comments_354417.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-22T20:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354417",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054069.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-22T20:26:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19706#event-54069"
}
```



---

archive/issue_comments_354418.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/upgrade_gmp\" to \"171e35673ca2e6bfd95a86180d60d8efe3513f00\"",
    "created_at": "2017-09-22T20:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354418",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/upgrade_gmp" to "171e35673ca2e6bfd95a86180d60d8efe3513f00"



---

archive/issue_comments_354419.json:
```json
{
    "body": "Changing commit from \"171e35673ca2e6bfd95a86180d60d8efe3513f00\" to \"\"",
    "created_at": "2017-09-26T22:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354419",
    "user": "https://github.com/koffie"
}
```

Changing commit from "171e35673ca2e6bfd95a86180d60d8efe3513f00" to ""



---

archive/issue_comments_354420.json:
```json
{
    "body": "<a id='comment:21'></a>How do I pull the branch 171e35673ca2e6bfd95a86180d60d8efe3513f00 ?",
    "created_at": "2017-09-26T22:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354420",
    "user": "https://github.com/koffie"
}
```

<a id='comment:21'></a>How do I pull the branch 171e35673ca2e6bfd95a86180d60d8efe3513f00 ?



---

archive/issue_comments_354421.json:
```json
{
    "body": "<a id='comment:22'></a>Sorry, apparently it's a commit not a branch, and for some reason `git pull` does not work but `git fetch` does.",
    "created_at": "2017-09-26T23:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19706",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19706#issuecomment-354421",
    "user": "https://github.com/koffie"
}
```

<a id='comment:22'></a>Sorry, apparently it's a commit not a branch, and for some reason `git pull` does not work but `git fetch` does.
