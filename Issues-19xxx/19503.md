# Issue 19503: strip TESTS blocks in introspection

archive/issues_019266.json:
```json
{
    "assignees": [],
    "body": "When a user types\n\n```\nsage: foo?\n```\nwe should hide the `TESTS` block: it should hold doctests which are too technical to be helpful. (They should still be visible from `foo??`: if a user wants to see the source code, we shouldn't hide anything.)\n\n`TESTS` blocks should be shown in the reference manual by default, for completeness, but running `sage --docbuild --no-tests DOCUMENT FORMAT` will cause them to be skipped, as will setting the environment variable `SAGE_SKIP_TESTS_BLOCKS`.\n\nCC:  @jm58660 @nathanncohen\n\nBranch/Commit: **[`2c56292`](https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b)**\n\nReviewer: **Volker Braun**\n\nAuthor: **John Palmieri**\n\nComponent: **documentation**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19503_\n\n",
    "closed_at": "2015-11-25T18:01:18Z",
    "created_at": "2015-10-30T04:54:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "strip TESTS blocks in introspection",
    "type": "issue",
    "updated_at": "2015-11-25T18:01:18Z",
    "url": "https://github.com/sagemath/sage/issues/19503",
    "user": "https://github.com/jhpalmieri"
}
```
When a user types

```
sage: foo?
```
we should hide the `TESTS` block: it should hold doctests which are too technical to be helpful. (They should still be visible from `foo??`: if a user wants to see the source code, we shouldn't hide anything.)

`TESTS` blocks should be shown in the reference manual by default, for completeness, but running `sage --docbuild --no-tests DOCUMENT FORMAT` will cause them to be skipped, as will setting the environment variable `SAGE_SKIP_TESTS_BLOCKS`.

CC:  @jm58660 @nathanncohen

Branch/Commit: **[`2c56292`](https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b)**

Reviewer: **Volker Braun**

Author: **John Palmieri**

Component: **documentation**

_Issue created by migration from https://trac.sagemath.org/ticket/19503_





---

archive/issue_events_276380.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-10-30T04:54:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276380"
}
```



---

archive/issue_events_276381.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-10-30T04:54:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276381"
}
```



---

archive/issue_events_276382.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-10-30T04:54:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276382"
}
```



---

archive/issue_events_276383.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-10-30T04:54:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276383"
}
```



---

archive/issue_events_276384.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-10-30T04:54:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276384"
}
```



---

archive/issue_comments_277444.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)**",
    "created_at": "2015-10-30T04:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277444",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)**



---

archive/issue_comments_277445.json:
```json
{
    "body": "Commit: **[`289b9b8`](https://github.com/sagemath/sagetrac-mirror/commit/289b9b89a5c175807fa0c7b315fd00653b53d367)**",
    "created_at": "2015-10-30T05:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277445",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`289b9b8`](https://github.com/sagemath/sagetrac-mirror/commit/289b9b89a5c175807fa0c7b315fd00653b53d367)**



---

archive/issue_comments_277446.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe branch currently has two commits. One is brief and contains the main code for skipping these blocks. The other is long and does clean up on various TESTS blocks scattered through the Sage library. Some of the clean up just fixes indentation errors. Some is needed to make the blocks work with the skipping code: \"TESTS::\" (singular or plural, one colon or two) must be on a line by itself, so I changed\n\n```\nTESTS: text here::\n```\nto\n\n```\nTESTS:\n\ntext here::\n```\nAlso, the end of a \"TESTS\" block is detected when we come across a word in all capitals followed by a colon (\"REFERENCES:\") or by a Sphinx directive (two dots, space, word, double colon, \".. TODO::\"). In some cases, we had\n\n```\nTESTS:\n\n.. note::\n```\nso I moved the \".. note::\" to before the test, if that seemed to make sense.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f05cc7ab24b33420511092dd58a58ae40144d3d4\">f05cc7a</a></td><td><code>Sage library: clean up \"TESTS\" blocks.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/289b9b89a5c175807fa0c7b315fd00653b53d367\">289b9b8</a></td><td><code>trac 19503: skip TESTS blocks when doing introspection,</code></td></tr></table>\n",
    "created_at": "2015-10-30T05:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277446",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

The branch currently has two commits. One is brief and contains the main code for skipping these blocks. The other is long and does clean up on various TESTS blocks scattered through the Sage library. Some of the clean up just fixes indentation errors. Some is needed to make the blocks work with the skipping code: "TESTS::" (singular or plural, one colon or two) must be on a line by itself, so I changed

```
TESTS: text here::
```
to

```
TESTS:

text here::
```
Also, the end of a "TESTS" block is detected when we come across a word in all capitals followed by a colon ("REFERENCES:") or by a Sphinx directive (two dots, space, word, double colon, ".. TODO::"). In some cases, we had

```
TESTS:

.. note::
```
so I moved the ".. note::" to before the test, if that seemed to make sense.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f05cc7ab24b33420511092dd58a58ae40144d3d4">f05cc7a</a></td><td><code>Sage library: clean up "TESTS" blocks.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/289b9b89a5c175807fa0c7b315fd00653b53d367">289b9b8</a></td><td><code>trac 19503: skip TESTS blocks when doing introspection,</code></td></tr></table>




---

archive/issue_comments_277447.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWhy did you *remove* `TESTS:` in some places?",
    "created_at": "2015-10-30T06:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277447",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Why did you *remove* `TESTS:` in some places?



---

archive/issue_comments_277448.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDo we really need a new environment variable for this? I don't think so.",
    "created_at": "2015-10-30T06:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277448",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Do we really need a new environment variable for this? I don't think so.



---

archive/issue_comments_277449.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis should be in the manual about `TESTS` blocks:\n\nReplying to [@jhpalmieri](#comment:3):\n> Also, the end of a \"TESTS\" block is detected when we come across a word in all capitals followed by a colon (\"REFERENCES:\") or by a Sphinx directive (two dots, space, word, double colon, \".. TODO::\").",
    "created_at": "2015-10-30T06:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277449",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

This should be in the manual about `TESTS` blocks:

Replying to [@jhpalmieri](#comment:3):
> Also, the end of a "TESTS" block is detected when we come across a word in all capitals followed by a colon ("REFERENCES:") or by a Sphinx directive (two dots, space, word, double colon, ".. TODO::").



---

archive/issue_comments_277450.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment:5):\n> Why did you *remove* `TESTS:` in some places?\n\nI only did this when there was a block like this:\n\n```\nTESTS:\n   some tests\nTESTS:\n   more tests\n```\nThen I removed the second instance.\n\nRegarding the manual, I added something. I can put it more detail if you want.\n\nRegarding the environment variable, is there another good way to control the docbuilding process? (Is it even worth providing the option for skipping these blocks in docbuilding?)",
    "created_at": "2015-10-30T15:13:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277450",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment:5):
> Why did you *remove* `TESTS:` in some places?

I only did this when there was a block like this:

```
TESTS:
   some tests
TESTS:
   more tests
```
Then I removed the second instance.

Regarding the manual, I added something. I can put it more detail if you want.

Regarding the environment variable, is there another good way to control the docbuilding process? (Is it even worth providing the option for skipping these blocks in docbuilding?)



---

archive/issue_comments_277451.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95f8c726ec2344d9a1e37da64a5528bc5f7acc84\">95f8c72</a></td><td><code>trac 19503: more documentation, minor fixes</code></td></tr></table>\n",
    "created_at": "2015-10-30T16:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277451",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95f8c726ec2344d9a1e37da64a5528bc5f7acc84">95f8c72</a></td><td><code>trac 19503: more documentation, minor fixes</code></td></tr></table>




---

archive/issue_comments_277452.json:
```json
{
    "body": "Changed commit from **[`289b9b8`](https://github.com/sagemath/sagetrac-mirror/commit/289b9b89a5c175807fa0c7b315fd00653b53d367)** to **[`95f8c72`](https://github.com/sagemath/sagetrac-mirror/commit/95f8c726ec2344d9a1e37da64a5528bc5f7acc84)**",
    "created_at": "2015-10-30T16:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277452",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`289b9b8`](https://github.com/sagemath/sagetrac-mirror/commit/289b9b89a5c175807fa0c7b315fd00653b53d367)** to **[`95f8c72`](https://github.com/sagemath/sagetrac-mirror/commit/95f8c726ec2344d9a1e37da64a5528bc5f7acc84)**



---

archive/issue_comments_277453.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment:9):\n\n>(Is it even worth providing the option for skipping these blocks in docbuilding?)\n\nYes. I would use that option.",
    "created_at": "2015-10-31T19:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277453",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment:9):

>(Is it even worth providing the option for skipping these blocks in docbuilding?)

Yes. I would use that option.



---

archive/issue_comments_277454.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jhpalmieri](#comment:9):\n> Regarding the environment variable, is there another good way to control the docbuilding process?\n\nOK, *use* an environment variable for the technical implementation, but don't document it.",
    "created_at": "2015-11-02T07:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277454",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jhpalmieri](#comment:9):
> Regarding the environment variable, is there another good way to control the docbuilding process?

OK, *use* an environment variable for the technical implementation, but don't document it.



---

archive/issue_comments_277455.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n> OK, *use* an environment variable for the technical implementation, but don't document it.\n\n`O_o`\n\nWhaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....\n\nNathann",
    "created_at": "2015-11-02T07:07:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277455",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:13" align="right">comment:13</div>

> OK, *use* an environment variable for the technical implementation, but don't document it.

`O_o`

Whaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....

Nathann



---

archive/issue_comments_277456.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@nathanncohen](#comment:13):\n> Whaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....\n\n+1 to this.",
    "created_at": "2015-11-02T07:12:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277456",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@nathanncohen](#comment:13):
> Whaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....

+1 to this.



---

archive/issue_comments_277457.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI mean: consider the environment variable as an implementation detail, not as part of the public interface.",
    "created_at": "2015-11-02T08:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277457",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

I mean: consider the environment variable as an implementation detail, not as part of the public interface.



---

archive/issue_comments_277458.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nCan you explain the change in `src/sage/finance/stock.py`?",
    "created_at": "2015-11-02T13:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277458",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Can you explain the change in `src/sage/finance/stock.py`?



---

archive/issue_comments_277459.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment:15):\n> I mean: consider the environment variable as an implementation detail, not as part of the public interface.\n\nSo you are suggesting deleting the addition to the installation guide, right? We could also add a target to the makefile that does this, by the way.\n\n> Can you explain the change in src/sage/finance/stock.py?\n\nThe lines after the original test,\n\n```\n Classes and methods\n -------------------\n```\nare not detected by the regular expression for the end of the test, so they would be hidden upon introspection, so I moved the test from the top-level to the class being tested. There is a similar change in src/sage/matroids/basis_exchange_matroid.pyx. Note that those lines provide a header that only really make sense when viewing the full reference manual, so this particular change helps with the reference manual and preserves the old stupid behavior if you type `sage.finance.stock?`. Another option would be to delete\n\n```\n Classes and methods\n -------------------\n```",
    "created_at": "2015-11-02T16:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277459",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment:15):
> I mean: consider the environment variable as an implementation detail, not as part of the public interface.

So you are suggesting deleting the addition to the installation guide, right? We could also add a target to the makefile that does this, by the way.

> Can you explain the change in src/sage/finance/stock.py?

The lines after the original test,

```
 Classes and methods
 -------------------
```
are not detected by the regular expression for the end of the test, so they would be hidden upon introspection, so I moved the test from the top-level to the class being tested. There is a similar change in src/sage/matroids/basis_exchange_matroid.pyx. Note that those lines provide a header that only really make sense when viewing the full reference manual, so this particular change helps with the reference manual and preserves the old stupid behavior if you type `sage.finance.stock?`. Another option would be to delete

```
 Classes and methods
 -------------------
```



---

archive/issue_comments_277460.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c659e025d483d55b4bf644fa2f367884c7a2ca20\">c659e02</a></td><td><code>trac 19503: don't publicly advertise SAGE_SKIP_TESTS_BLOCKS.</code></td></tr></table>\n",
    "created_at": "2015-11-02T19:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277460",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c659e025d483d55b4bf644fa2f367884c7a2ca20">c659e02</a></td><td><code>trac 19503: don't publicly advertise SAGE_SKIP_TESTS_BLOCKS.</code></td></tr></table>




---

archive/issue_comments_277461.json:
```json
{
    "body": "Changed commit from **[`95f8c72`](https://github.com/sagemath/sagetrac-mirror/commit/95f8c726ec2344d9a1e37da64a5528bc5f7acc84)** to **[`c659e02`](https://github.com/sagemath/sagetrac-mirror/commit/c659e025d483d55b4bf644fa2f367884c7a2ca20)**",
    "created_at": "2015-11-02T19:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277461",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`95f8c72`](https://github.com/sagemath/sagetrac-mirror/commit/95f8c726ec2344d9a1e37da64a5528bc5f7acc84)** to **[`c659e02`](https://github.com/sagemath/sagetrac-mirror/commit/c659e025d483d55b4bf644fa2f367884c7a2ca20)**



---

archive/issue_comments_277462.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHere is a change to the installation guide.",
    "created_at": "2015-11-02T19:29:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277462",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Here is a change to the installation guide.



---

archive/issue_comments_277463.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nBy the way, there are many instances in the Sage library of top-level documentation looking like\n\n```\n\"\"\"\nblah\nblah\n\nClasses and methods\n-------------------\n\"\"\"\n```\nso that the page in the reference manual has a nice header but it looks silly if you look at this via introspection. I would suggest that if we want to change this, it belongs on another ticket. My goal here was to preserve the current look of the reference manual and help strings while removing only the TESTS blocks. So I would prefer not deleting \"Classes and methods\" and similar strings here.\n\nTo find other instances of this, do\n\n```\nsage: search_src('(---|===)\\n\"\"\"', multiline=True)\n```\nI got 97 hits when I did this search.",
    "created_at": "2015-11-02T19:45:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277463",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

By the way, there are many instances in the Sage library of top-level documentation looking like

```
"""
blah
blah

Classes and methods
-------------------
"""
```
so that the page in the reference manual has a nice header but it looks silly if you look at this via introspection. I would suggest that if we want to change this, it belongs on another ticket. My goal here was to preserve the current look of the reference manual and help strings while removing only the TESTS blocks. So I would prefer not deleting "Classes and methods" and similar strings here.

To find other instances of this, do

```
sage: search_src('(---|===)\n"""', multiline=True)
```
I got 97 hits when I did this search.



---

archive/issue_comments_277464.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.",
    "created_at": "2015-11-03T15:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277464",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

I disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.



---

archive/issue_comments_277465.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@kcrisman](#comment:21):\n> I disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.\n\nIsn't the problem actually other way around? That is, `EXAMPLES` contains tests for zero-element graph, empty set and like.",
    "created_at": "2015-11-03T16:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277465",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@kcrisman](#comment:21):
> I disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.

Isn't the problem actually other way around? That is, `EXAMPLES` contains tests for zero-element graph, empty set and like.



---

archive/issue_comments_277466.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nFor some time, the developer's guide has said that docstrings may include\n\n```\nA TESTS block (optional)\n\nFormatted just like EXAMPLES, containing tests that are not relevant to users.\n```\nSo I think we should hide all TESTS blocks now, and if authors of those tests (or other interested developers) want them to be visible, it is their responsibility to move them to EXAMPLES blocks.",
    "created_at": "2015-11-03T16:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277466",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

For some time, the developer's guide has said that docstrings may include

```
A TESTS block (optional)

Formatted just like EXAMPLES, containing tests that are not relevant to users.
```
So I think we should hide all TESTS blocks now, and if authors of those tests (or other interested developers) want them to be visible, it is their responsibility to move them to EXAMPLES blocks.



---

archive/issue_comments_277467.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n> For some time, \n\nThe [very first example](https://github.com/sagemath/sage/blob/master/src/sage/calculus/calculus.py) I looked at has this problem.\n\n```\nTESTS:\nSubstitution::\n    sage: f = x\n    sage: f(x=5)\n    5\nSimplifying expressions involving scientific notation::\n    sage: k = var('k')\n    sage: a0 = 2e-06; a1 = 12\n    sage: c = a1 + a0*k; c\n    (2.00000000000000e-6)*k + 12\n    sage: sqrt(c)\n    sqrt((2.00000000000000e-6)*k + 12)\n    sage: sqrt(c^3)\n    sqrt(((2.00000000000000e-6)*k + 12)^3)\nThe symbolic calculus package uses its own copy of Maxima for\nsimplification, etc., which is separate from the default\nsystem-wide version::\n    sage: maxima.eval('[x,y]: [1,2]')\n    '[1,2]'\n    sage: maxima.eval('expand((x+y)^3)')\n    '27'\nIf the copy of maxima used by the symbolic calculus package were\nthe same as the default one, then the following would return 27,\nwhich would be very confusing indeed!\n::\n    sage: x, y = var('x,y')\n    sage: expand((x+y)^3)\n    x^3 + 3*x^2*y + 3*x*y^2 + y^3\nSet x to be 5 in maxima::\n    sage: maxima('x: 5')\n    5\n    sage: maxima('x + x + %pi')\n    %pi+10\nSimplifications like these are now done using Pynac::\n    sage: x + x + pi\n    pi + 2*x\nBut this still uses Maxima::\n    sage: (x + x + pi).simplify()\n    pi + 2*x\nNote that ``x`` is still ``x``, since the\nmaxima used by the calculus package is different than the one in\nthe interactive interpreter.\n```\nand so forth.  Obviously a lot of this is not particularly useful to end users, but a lot of this is.  (It also has `TESTS:` and not `TESTS::` though presumably that isn't relevant here.)\n\nMore examples:\n* [desolvers](https://github.com/sagemath/sage/blob/master/src/sage/calculus/desolvers.py) I assume this could be useful for some users\n\n```\n    TESTS:\n    :trac:`9961` fixed (allow assumptions on the dependent variable in desolve)::\n        sage: y=function('y',x); assume(x>0); assume(y>0)\n        sage: sage.calculus.calculus.maxima('domain:real')  # needed since Maxima 5.26.0 to get the answer as below\n        real\n        sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True)\n        [x - arcsinh(y(x)/x) == _C]\n```\n* Presumably the only documentation for this function [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/animate.py):\n\n```\n    def add_frame(self, pngfile, delay=None, delay_denominator=None):\n        r\"\"\"\n        Adds a single frame to the APNG file.\n        INPUT:\n        - ``pngfile`` -- file name of the PNG file with data for this frame\n        - ``delay`` -- numerator of the delay fraction in seconds\n        - ``delay_denominator`` -- denominator of the delay in seconds\n        If the delay is not specified, the default from the constructor\n        applies.\n        TESTS::\n            sage: from sage.plot.animate import APngAssembler\n            sage: from StringIO import StringIO\n            sage: buf = StringIO()\n            sage: apng = APngAssembler(buf, 2)\n            sage: fn = APngAssembler._testData(\"input1\", True)\n            sage: apng.add_frame(fn, delay=0x567, delay_denominator=0x1234)\n            sage: fn = APngAssembler._testData(\"input2\", True)\n            sage: apng.add_frame(fn)\n            sage: len(buf.getvalue())\n            217\n            sage: buf.getvalue() == APngAssembler._testData(\"anim12\", False)\n            True\n            sage: apng.add_frame(fn)\n            Traceback (most recent call last):\n            ...\n            RuntimeError: Already reached the declared number of frames\n```\n* End user discovers something *very* useful to know about this method [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/arc.py):\n\n```\n    def plot3d(self):\n        r\"\"\"\n        TESTS::\n            sage: from sage.plot.arc import Arc\n            sage: Arc(0,0,1,1,0,0,1,{}).plot3d()\n            Traceback (most recent call last):\n            ...\n            NotImplementedError\n        \"\"\"\n        raise NotImplementedError\n```\n  Yeah, I guess I'd want to know that it isn't implemented...\n\nMy point: there is an awful lot of stuff grandfathered in under this that will vanish which might end up giving ask.sagemath a lot more (unnecessary) activity.",
    "created_at": "2015-11-04T02:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277467",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:24" align="right">comment:24</div>

> For some time, 

The [very first example](https://github.com/sagemath/sage/blob/master/src/sage/calculus/calculus.py) I looked at has this problem.

```
TESTS:
Substitution::
    sage: f = x
    sage: f(x=5)
    5
Simplifying expressions involving scientific notation::
    sage: k = var('k')
    sage: a0 = 2e-06; a1 = 12
    sage: c = a1 + a0*k; c
    (2.00000000000000e-6)*k + 12
    sage: sqrt(c)
    sqrt((2.00000000000000e-6)*k + 12)
    sage: sqrt(c^3)
    sqrt(((2.00000000000000e-6)*k + 12)^3)
The symbolic calculus package uses its own copy of Maxima for
simplification, etc., which is separate from the default
system-wide version::
    sage: maxima.eval('[x,y]: [1,2]')
    '[1,2]'
    sage: maxima.eval('expand((x+y)^3)')
    '27'
If the copy of maxima used by the symbolic calculus package were
the same as the default one, then the following would return 27,
which would be very confusing indeed!
::
    sage: x, y = var('x,y')
    sage: expand((x+y)^3)
    x^3 + 3*x^2*y + 3*x*y^2 + y^3
Set x to be 5 in maxima::
    sage: maxima('x: 5')
    5
    sage: maxima('x + x + %pi')
    %pi+10
Simplifications like these are now done using Pynac::
    sage: x + x + pi
    pi + 2*x
But this still uses Maxima::
    sage: (x + x + pi).simplify()
    pi + 2*x
Note that ``x`` is still ``x``, since the
maxima used by the calculus package is different than the one in
the interactive interpreter.
```
and so forth.  Obviously a lot of this is not particularly useful to end users, but a lot of this is.  (It also has `TESTS:` and not `TESTS::` though presumably that isn't relevant here.)

More examples:
* [desolvers](https://github.com/sagemath/sage/blob/master/src/sage/calculus/desolvers.py) I assume this could be useful for some users

```
    TESTS:
    :trac:`9961` fixed (allow assumptions on the dependent variable in desolve)::
        sage: y=function('y',x); assume(x>0); assume(y>0)
        sage: sage.calculus.calculus.maxima('domain:real')  # needed since Maxima 5.26.0 to get the answer as below
        real
        sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True)
        [x - arcsinh(y(x)/x) == _C]
```
* Presumably the only documentation for this function [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/animate.py):

```
    def add_frame(self, pngfile, delay=None, delay_denominator=None):
        r"""
        Adds a single frame to the APNG file.
        INPUT:
        - ``pngfile`` -- file name of the PNG file with data for this frame
        - ``delay`` -- numerator of the delay fraction in seconds
        - ``delay_denominator`` -- denominator of the delay in seconds
        If the delay is not specified, the default from the constructor
        applies.
        TESTS::
            sage: from sage.plot.animate import APngAssembler
            sage: from StringIO import StringIO
            sage: buf = StringIO()
            sage: apng = APngAssembler(buf, 2)
            sage: fn = APngAssembler._testData("input1", True)
            sage: apng.add_frame(fn, delay=0x567, delay_denominator=0x1234)
            sage: fn = APngAssembler._testData("input2", True)
            sage: apng.add_frame(fn)
            sage: len(buf.getvalue())
            217
            sage: buf.getvalue() == APngAssembler._testData("anim12", False)
            True
            sage: apng.add_frame(fn)
            Traceback (most recent call last):
            ...
            RuntimeError: Already reached the declared number of frames
```
* End user discovers something *very* useful to know about this method [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/arc.py):

```
    def plot3d(self):
        r"""
        TESTS::
            sage: from sage.plot.arc import Arc
            sage: Arc(0,0,1,1,0,0,1,{}).plot3d()
            Traceback (most recent call last):
            ...
            NotImplementedError
        """
        raise NotImplementedError
```
  Yeah, I guess I'd want to know that it isn't implemented...

My point: there is an awful lot of stuff grandfathered in under this that will vanish which might end up giving ask.sagemath a lot more (unnecessary) activity.



---

archive/issue_comments_277468.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nSo I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)",
    "created_at": "2015-11-04T02:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277468",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

So I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)



---

archive/issue_comments_277469.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jhpalmieri](#comment:25):\n> So I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)\n\nThen can this be made at least optional? I.e. have an environment variable or something, defaults to `True`, that controls if `TESTS` are shown with `?`? Just what is suggested to html-docs.\n\nSage will always be unfinished product. That it true for documentation also.",
    "created_at": "2015-11-04T06:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277469",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jhpalmieri](#comment:25):
> So I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)

Then can this be made at least optional? I.e. have an environment variable or something, defaults to `True`, that controls if `TESTS` are shown with `?`? Just what is suggested to html-docs.

Sage will always be unfinished product. That it true for documentation also.



---

archive/issue_comments_277470.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jm58660](#comment:26):\n> I.e. have an environment variable or something\n\nPlease, not yet another useless environment variable.",
    "created_at": "2015-11-04T13:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277470",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jm58660](#comment:26):
> I.e. have an environment variable or something

Please, not yet another useless environment variable.



---

archive/issue_comments_277471.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n@kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.",
    "created_at": "2015-11-04T13:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277471",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

@kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.



---

archive/issue_comments_277472.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jhpalmieri](#comment:17):\n> The lines after the original test,\n> \n> ```\n>  Classes and methods\n>  -------------------\n> ```\n> are not detected by the regular expression for the end of the test\n\nThen please fix your regular expression or change the docstring. I don't like that you need to move those tests.",
    "created_at": "2015-11-04T13:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277472",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jhpalmieri](#comment:17):
> The lines after the original test,
> 
> ```
>  Classes and methods
>  -------------------
> ```
> are not detected by the regular expression for the end of the test

Then please fix your regular expression or change the docstring. I don't like that you need to move those tests.



---

archive/issue_comments_277473.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment:29):\n> Replying to [@jhpalmieri](#comment:17):\n> > The lines after the original test,\n> > \n> > ```\n> >  Classes and methods\n> >  -------------------\n> > ```\n> > are not detected by the regular expression for the end of the test\n\n> \n> Then please fix your regular expression or change the docstring. I don't like that you need to move those tests.\n\nWhy? What's wrong with moving those tests?",
    "created_at": "2015-11-04T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277473",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment:29):
> Replying to [@jhpalmieri](#comment:17):
> > The lines after the original test,
> > 
> > ```
> >  Classes and methods
> >  -------------------
> > ```
> > are not detected by the regular expression for the end of the test

> 
> Then please fix your regular expression or change the docstring. I don't like that you need to move those tests.

Why? What's wrong with moving those tests?



---

archive/issue_comments_277474.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n> @kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.\n\nThen we may agree to disagree.  I find that those examples have useful syntax examples that are not covered by the original ones.\n\nI just feel like this is covering up the real problem, which is methods/functions which don't have very detailed documentation.  Why do we need to not show these?  It's fixing a problem that isn't a problem.  Things people don't understand they skip anyway; if `TESTS` isn't helpful, it's because they made it to `TESTS` because `EXAMPLES` didn't do its job.",
    "created_at": "2015-11-04T18:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277474",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:31" align="right">comment:31</div>

> @kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.

Then we may agree to disagree.  I find that those examples have useful syntax examples that are not covered by the original ones.

I just feel like this is covering up the real problem, which is methods/functions which don't have very detailed documentation.  Why do we need to not show these?  It's fixing a problem that isn't a problem.  Things people don't understand they skip anyway; if `TESTS` isn't helpful, it's because they made it to `TESTS` because `EXAMPLES` didn't do its job.



---

archive/issue_comments_277475.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05c6521b2c6645e043714d849f38964824cb1443\">05c6521</a></td><td><code>trac 19503: try to deal with situations where ReST headers end TESTS blocks</code></td></tr></table>\n",
    "created_at": "2015-11-04T19:45:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277475",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05c6521b2c6645e043714d849f38964824cb1443">05c6521</a></td><td><code>trac 19503: try to deal with situations where ReST headers end TESTS blocks</code></td></tr></table>




---

archive/issue_comments_277476.json:
```json
{
    "body": "Changed commit from **[`c659e02`](https://github.com/sagemath/sagetrac-mirror/commit/c659e025d483d55b4bf644fa2f367884c7a2ca20)** to **[`05c6521`](https://github.com/sagemath/sagetrac-mirror/commit/05c6521b2c6645e043714d849f38964824cb1443)**",
    "created_at": "2015-11-04T19:45:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277476",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c659e02`](https://github.com/sagemath/sagetrac-mirror/commit/c659e025d483d55b4bf644fa2f367884c7a2ca20)** to **[`05c6521`](https://github.com/sagemath/sagetrac-mirror/commit/05c6521b2c6645e043714d849f38964824cb1443)**



---

archive/issue_comments_277477.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI don't want to incorporate an ReST parser into this, but I've attempted to detect when an ReST header ends a \"TESTS\" block.\n\nI probably won't work on this more unless it is clear that the ticket has enough support.",
    "created_at": "2015-11-04T19:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277477",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">comment:33</div>

I don't want to incorporate an ReST parser into this, but I've attempted to detect when an ReST header ends a "TESTS" block.

I probably won't work on this more unless it is clear that the ticket has enough support.



---

archive/issue_comments_277478.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@jhpalmieri](#comment:33):\n\n> I probably won't work on this more unless it is clear that the ticket has enough support.\n\nWilliam Stein has said that we should have foldable `TESTS`-parts in html documentation. So if you mean \"support\" as \"someone else also wants this\", then yes, you have it.",
    "created_at": "2015-11-05T06:12:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277478",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@jhpalmieri](#comment:33):

> I probably won't work on this more unless it is clear that the ticket has enough support.

William Stein has said that we should have foldable `TESTS`-parts in html documentation. So if you mean "support" as "someone else also wants this", then yes, you have it.



---

archive/issue_comments_277479.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nAt the very least, we should keep the doc reformatting which was done in this branch.\n\nOne the one hand, I think it's good to hide the `TESTS` blocks since I don't think they contain useful information for the user.\n\nOn the other hand, I also see some value in @kcrisman's comment: are those `TESTS` blocks really bothering people?",
    "created_at": "2015-11-05T11:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277479",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

At the very least, we should keep the doc reformatting which was done in this branch.

One the one hand, I think it's good to hide the `TESTS` blocks since I don't think they contain useful information for the user.

On the other hand, I also see some value in @kcrisman's comment: are those `TESTS` blocks really bothering people?



---

archive/issue_comments_277480.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@jdemeyer](#comment:35):\n\n> On the other hand, I also see some value in @kcrisman's comment: are those `TESTS` blocks really bothering people?\n\nThis can be argued, but I think that they give kind of unprofessional feeling. They are at least noise to normal user.",
    "created_at": "2015-11-05T11:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277480",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@jdemeyer](#comment:35):

> On the other hand, I also see some value in @kcrisman's comment: are those `TESTS` blocks really bothering people?

This can be argued, but I think that they give kind of unprofessional feeling. They are at least noise to normal user.



---

archive/issue_comments_277481.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nShould we ask on sage-devel?",
    "created_at": "2015-11-05T17:04:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277481",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

Should we ask on sage-devel?



---

archive/issue_comments_277482.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jhpalmieri](#comment:37):\n> Should we ask on sage-devel?\n\nIt will not make any harm. Please ask.",
    "created_at": "2015-11-06T07:33:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277482",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jhpalmieri](#comment:37):
> Should we ask on sage-devel?

It will not make any harm. Please ask.



---

archive/issue_comments_277483.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThe vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.",
    "created_at": "2015-11-12T19:51:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277483",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

The vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.



---

archive/issue_comments_277484.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@jhpalmieri](#comment:39):\n> The vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.\n\nSo please proceed.",
    "created_at": "2015-11-13T05:14:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277484",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@jhpalmieri](#comment:39):
> The vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.

So please proceed.



---

archive/issue_comments_277485.json:
```json
{
    "body": "Changed commit from **[`05c6521`](https://github.com/sagemath/sagetrac-mirror/commit/05c6521b2c6645e043714d849f38964824cb1443)** to **[`12533ac`](https://github.com/sagemath/sagetrac-mirror/commit/12533acdc84f1f2c1db67dcd5925fdaf8a7a348a)**",
    "created_at": "2015-11-13T22:11:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277485",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`05c6521`](https://github.com/sagemath/sagetrac-mirror/commit/05c6521b2c6645e043714d849f38964824cb1443)** to **[`12533ac`](https://github.com/sagemath/sagetrac-mirror/commit/12533acdc84f1f2c1db67dcd5925fdaf8a7a348a)**



---

archive/issue_comments_277486.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12533acdc84f1f2c1db67dcd5925fdaf8a7a348a\">12533ac</a></td><td><code>Merge branch 'develop' into t/19503/TESTS</code></td></tr></table>\n",
    "created_at": "2015-11-13T22:11:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277486",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12533acdc84f1f2c1db67dcd5925fdaf8a7a348a">12533ac</a></td><td><code>Merge branch 'develop' into t/19503/TESTS</code></td></tr></table>




---

archive/issue_comments_277487.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nI've fixed the merge conflicts with 6.10.beta4.",
    "created_at": "2015-11-13T22:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277487",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">comment:42</div>

I've fixed the merge conflicts with 6.10.beta4.



---

archive/issue_comments_277488.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI got\n\n```\n            reading sources... [ 94%] sage/repl/rich_output/output_video\n            reading sources... [ 97%] sage/repl/rich_output/preferences\n            reading sources... [100%] startup\n            loading cross citations... \n[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:66: SEVERE: Unexpected section title.\n[repl     ] sage: shell.run_cell('1/0')\n[repl     ] ---------------------------------------------------------------------------\n[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:76: WARNING: Definition list ends without a blank line; unexpected unindent.\nError building the documentation.\nTraceback (most recent call last):\n  File \"/home/jm58660/sage/src/doc/common/builder.py\", line 1641, in <module>\n    getattr(get_builder(name), type)()\n```\n\nfrom `./sage --docbuild --no-tests all html`.",
    "created_at": "2015-11-17T11:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277488",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:43" align="right">comment:43</div>

I got

```
            reading sources... [ 94%] sage/repl/rich_output/output_video
            reading sources... [ 97%] sage/repl/rich_output/preferences
            reading sources... [100%] startup
            loading cross citations... 
[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:66: SEVERE: Unexpected section title.
[repl     ] sage: shell.run_cell('1/0')
[repl     ] ---------------------------------------------------------------------------
[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:76: WARNING: Definition list ends without a blank line; unexpected unindent.
Error building the documentation.
Traceback (most recent call last):
  File "/home/jm58660/sage/src/doc/common/builder.py", line 1641, in <module>
    getattr(get_builder(name), type)()
```

from `./sage --docbuild --no-tests all html`.



---

archive/issue_events_276385.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-11-17T11:14:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276385"
}
```



---

archive/issue_events_276386.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-11-17T11:14:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276386"
}
```



---

archive/issue_comments_277489.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI see, in a few docstrings, in the middle of a TESTS block there is a line of all hyphens, so my function thought they were ReST headers, and ended the TESTS block prematurely. The new version tests the indentation level.",
    "created_at": "2015-11-17T17:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277489",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:44" align="right">comment:44</div>

I see, in a few docstrings, in the middle of a TESTS block there is a line of all hyphens, so my function thought they were ReST headers, and ended the TESTS block prematurely. The new version tests the indentation level.



---

archive/issue_comments_277490.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b\">2c56292</a></td><td><code>trac 19503: detect 'fake' headers: lines that look like ReST headers</code></td></tr></table>\n",
    "created_at": "2015-11-17T17:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277490",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b">2c56292</a></td><td><code>trac 19503: detect 'fake' headers: lines that look like ReST headers</code></td></tr></table>




---

archive/issue_comments_277491.json:
```json
{
    "body": "Changed commit from **[`12533ac`](https://github.com/sagemath/sagetrac-mirror/commit/12533acdc84f1f2c1db67dcd5925fdaf8a7a348a)** to **[`2c56292`](https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b)**",
    "created_at": "2015-11-17T17:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277491",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`12533ac`](https://github.com/sagemath/sagetrac-mirror/commit/12533acdc84f1f2c1db67dcd5925fdaf8a7a348a)** to **[`2c56292`](https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b)**



---

archive/issue_events_276387.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-11-17T17:54:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276387"
}
```



---

archive/issue_events_276388.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-11-17T17:54:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276388"
}
```



---

archive/issue_comments_277492.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nThis works for me. Patchbot gives two error from `src/sage/rings/real_double.pyx`, but I can not reproduce them on my machine.\n\nI see this as a good addition. However, I know about nothing about Sphinx. Hence I hope someone else to review this.",
    "created_at": "2015-11-18T07:20:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277492",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:47" align="right">comment:47</div>

This works for me. Patchbot gives two error from `src/sage/rings/real_double.pyx`, but I can not reproduce them on my machine.

I see this as a good addition. However, I know about nothing about Sphinx. Hence I hope someone else to review this.



---

archive/issue_events_276389.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-24T22:29:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276389"
}
```



---

archive/issue_events_276390.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-24T22:29:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276390"
}
```



---

archive/issue_comments_277493.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2015-11-24T22:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277493",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_276391.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-25T18:01:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276391"
}
```



---

archive/issue_events_276392.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f3f03bb0ba4412eb9cca16208bd6bb5a22a4e1be",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-11-25T18:01:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19503#event-276392"
}
```



---

archive/issue_comments_277494.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)** to **[`2c56292`](https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b)**",
    "created_at": "2015-11-25T18:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19503#issuecomment-277494",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)** to **[`2c56292`](https://github.com/sagemath/sagetrac-mirror/commit/2c56292b5dc44fb1b06dd0516d9f8fec61ce1e4b)**
