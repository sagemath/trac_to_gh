# Issue 19503: strip TESTS blocks in introspection

archive/issues_019266.json:
```json
{
    "body": "CC:  @jm58660 @nathanncohen\n\nWhen a user types\n\n```\nsage: foo?\n```\nwe should hide the `TESTS` block: it should hold doctests which are too technical to be helpful. (They should still be visible from `foo??`: if a user wants to see the source code, we shouldn't hide anything.)\n\n`TESTS` blocks should be shown in the reference manual by default, for completeness, but running `sage --docbuild --no-tests DOCUMENT FORMAT` will cause them to be skipped, as will setting the environment variable `SAGE_SKIP_TESTS_BLOCKS`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19503\n\n",
    "closed_at": "2015-11-25T18:01:18Z",
    "created_at": "2015-10-30T04:54:04Z",
    "labels": [
        "component: documentation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "strip TESTS blocks in introspection",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19503",
    "user": "https://github.com/jhpalmieri"
}
```
CC:  @jm58660 @nathanncohen

When a user types

```
sage: foo?
```
we should hide the `TESTS` block: it should hold doctests which are too technical to be helpful. (They should still be visible from `foo??`: if a user wants to see the source code, we shouldn't hide anything.)

`TESTS` blocks should be shown in the reference manual by default, for completeness, but running `sage --docbuild --no-tests DOCUMENT FORMAT` will cause them to be skipped, as will setting the environment variable `SAGE_SKIP_TESTS_BLOCKS`.

Issue created by migration from https://trac.sagemath.org/ticket/19503





---

archive/issue_comments_264060.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-30T04:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264060",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_264061.json:
```json
{
    "body": "The branch currently has two commits. One is brief and contains the main code for skipping these blocks. The other is long and does clean up on various TESTS blocks scattered through the Sage library. Some of the clean up just fixes indentation errors. Some is needed to make the blocks work with the skipping code: \"TESTS::\" (singular or plural, one colon or two) must be on a line by itself, so I changed\n\n```\nTESTS: text here::\n```\nto\n\n```\nTESTS:\n\ntext here::\n```\nAlso, the end of a \"TESTS\" block is detected when we come across a word in all capitals followed by a colon (\"REFERENCES:\") or by a Sphinx directive (two dots, space, word, double colon, \".. TODO::\"). In some cases, we had\n\n```\nTESTS:\n\n.. note::\n```\nso I moved the \".. note::\" to before the test, if that seemed to make sense.\n\n---\nNew commits:",
    "created_at": "2015-10-30T05:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264061",
    "user": "https://github.com/jhpalmieri"
}
```

The branch currently has two commits. One is brief and contains the main code for skipping these blocks. The other is long and does clean up on various TESTS blocks scattered through the Sage library. Some of the clean up just fixes indentation errors. Some is needed to make the blocks work with the skipping code: "TESTS::" (singular or plural, one colon or two) must be on a line by itself, so I changed

```
TESTS: text here::
```
to

```
TESTS:

text here::
```
Also, the end of a "TESTS" block is detected when we come across a word in all capitals followed by a colon ("REFERENCES:") or by a Sphinx directive (two dots, space, word, double colon, ".. TODO::"). In some cases, we had

```
TESTS:

.. note::
```
so I moved the ".. note::" to before the test, if that seemed to make sense.

---
New commits:



---

archive/issue_comments_264062.json:
```json
{
    "body": "Why did you *remove* `TESTS:` in some places?",
    "created_at": "2015-10-30T06:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264062",
    "user": "https://github.com/jdemeyer"
}
```

Why did you *remove* `TESTS:` in some places?



---

archive/issue_comments_264063.json:
```json
{
    "body": "Do we really need a new environment variable for this? I don't think so.",
    "created_at": "2015-10-30T06:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264063",
    "user": "https://github.com/jdemeyer"
}
```

Do we really need a new environment variable for this? I don't think so.



---

archive/issue_comments_264064.json:
```json
{
    "body": "This should be in the manual about `TESTS` blocks:\n\nReplying to [comment:3 jhpalmieri]:\n> Also, the end of a \"TESTS\" block is detected when we come across a word in all capitals followed by a colon (\"REFERENCES:\") or by a Sphinx directive (two dots, space, word, double colon, \".. TODO::\").",
    "created_at": "2015-10-30T06:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264064",
    "user": "https://github.com/jdemeyer"
}
```

This should be in the manual about `TESTS` blocks:

Replying to [comment:3 jhpalmieri]:
> Also, the end of a "TESTS" block is detected when we come across a word in all capitals followed by a colon ("REFERENCES:") or by a Sphinx directive (two dots, space, word, double colon, ".. TODO::").



---

archive/issue_comments_264065.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> Why did you *remove* `TESTS:` in some places?\n\n\nI only did this when there was a block like this:\n\n```\nTESTS:\n   some tests\nTESTS:\n   more tests\n```\nThen I removed the second instance.\n\nRegarding the manual, I added something. I can put it more detail if you want.\n\nRegarding the environment variable, is there another good way to control the docbuilding process? (Is it even worth providing the option for skipping these blocks in docbuilding?)",
    "created_at": "2015-10-30T15:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264065",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:5 jdemeyer]:
> Why did you *remove* `TESTS:` in some places?


I only did this when there was a block like this:

```
TESTS:
   some tests
TESTS:
   more tests
```
Then I removed the second instance.

Regarding the manual, I added something. I can put it more detail if you want.

Regarding the environment variable, is there another good way to control the docbuilding process? (Is it even worth providing the option for skipping these blocks in docbuilding?)



---

archive/issue_comments_264066.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-30T16:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264067.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n\n>(Is it even worth providing the option for skipping these blocks in docbuilding?)\n\n\nYes. I would use that option.",
    "created_at": "2015-10-31T19:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264067",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:9 jhpalmieri]:

>(Is it even worth providing the option for skipping these blocks in docbuilding?)


Yes. I would use that option.



---

archive/issue_comments_264068.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n> Regarding the environment variable, is there another good way to control the docbuilding process?\n\n\nOK, *use* an environment variable for the technical implementation, but don't document it.",
    "created_at": "2015-11-02T07:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264068",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 jhpalmieri]:
> Regarding the environment variable, is there another good way to control the docbuilding process?


OK, *use* an environment variable for the technical implementation, but don't document it.



---

archive/issue_comments_264069.json:
```json
{
    "body": "> OK, *use* an environment variable for the technical implementation, but don't document it.\n\n\n`O_o`\n\nWhaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....\n\nNathann",
    "created_at": "2015-11-02T07:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264069",
    "user": "https://github.com/nathanncohen"
}
```

> OK, *use* an environment variable for the technical implementation, but don't document it.


`O_o`

Whaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....

Nathann



---

archive/issue_comments_264070.json:
```json
{
    "body": "Replying to [comment:13 ncohen]:\n> Whaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....\n\n\n+1 to this.",
    "created_at": "2015-11-02T07:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264070",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:13 ncohen]:
> Whaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaat ?.....


+1 to this.



---

archive/issue_comments_264071.json:
```json
{
    "body": "I mean: consider the environment variable as an implementation detail, not as part of the public interface.",
    "created_at": "2015-11-02T08:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264071",
    "user": "https://github.com/jdemeyer"
}
```

I mean: consider the environment variable as an implementation detail, not as part of the public interface.



---

archive/issue_comments_264072.json:
```json
{
    "body": "Can you explain the change in `src/sage/finance/stock.py`?",
    "created_at": "2015-11-02T13:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264072",
    "user": "https://github.com/jdemeyer"
}
```

Can you explain the change in `src/sage/finance/stock.py`?



---

archive/issue_comments_264073.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> I mean: consider the environment variable as an implementation detail, not as part of the public interface.\n\n\nSo you are suggesting deleting the addition to the installation guide, right? We could also add a target to the makefile that does this, by the way.\n\n> Can you explain the change in src/sage/finance/stock.py?\n\n\nThe lines after the original test,\n\n```\n Classes and methods\n -------------------\n```\nare not detected by the regular expression for the end of the test, so they would be hidden upon introspection, so I moved the test from the top-level to the class being tested. There is a similar change in src/sage/matroids/basis_exchange_matroid.pyx. Note that those lines provide a header that only really make sense when viewing the full reference manual, so this particular change helps with the reference manual and preserves the old stupid behavior if you type `sage.finance.stock?`. Another option would be to delete\n\n```\n Classes and methods\n -------------------\n```",
    "created_at": "2015-11-02T16:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264073",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:15 jdemeyer]:
> I mean: consider the environment variable as an implementation detail, not as part of the public interface.


So you are suggesting deleting the addition to the installation guide, right? We could also add a target to the makefile that does this, by the way.

> Can you explain the change in src/sage/finance/stock.py?


The lines after the original test,

```
 Classes and methods
 -------------------
```
are not detected by the regular expression for the end of the test, so they would be hidden upon introspection, so I moved the test from the top-level to the class being tested. There is a similar change in src/sage/matroids/basis_exchange_matroid.pyx. Note that those lines provide a header that only really make sense when viewing the full reference manual, so this particular change helps with the reference manual and preserves the old stupid behavior if you type `sage.finance.stock?`. Another option would be to delete

```
 Classes and methods
 -------------------
```



---

archive/issue_comments_264074.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-02T19:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264075.json:
```json
{
    "body": "Here is a change to the installation guide.",
    "created_at": "2015-11-02T19:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264075",
    "user": "https://github.com/jhpalmieri"
}
```

Here is a change to the installation guide.



---

archive/issue_comments_264076.json:
```json
{
    "body": "By the way, there are many instances in the Sage library of top-level documentation looking like\n\n```\n\"\"\"\nblah\nblah\n\nClasses and methods\n-------------------\n\"\"\"\n```\nso that the page in the reference manual has a nice header but it looks silly if you look at this via introspection. I would suggest that if we want to change this, it belongs on another ticket. My goal here was to preserve the current look of the reference manual and help strings while removing only the TESTS blocks. So I would prefer not deleting \"Classes and methods\" and similar strings here.\n\nTo find other instances of this, do\n\n```\nsage: search_src('(---|===)\\n\"\"\"', multiline=True)\n```\nI got 97 hits when I did this search.",
    "created_at": "2015-11-02T19:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264076",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, there are many instances in the Sage library of top-level documentation looking like

```
"""
blah
blah

Classes and methods
-------------------
"""
```
so that the page in the reference manual has a nice header but it looks silly if you look at this via introspection. I would suggest that if we want to change this, it belongs on another ticket. My goal here was to preserve the current look of the reference manual and help strings while removing only the TESTS blocks. So I would prefer not deleting "Classes and methods" and similar strings here.

To find other instances of this, do

```
sage: search_src('(---|===)\n"""', multiline=True)
```
I got 97 hits when I did this search.



---

archive/issue_comments_264077.json:
```json
{
    "body": "I disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.",
    "created_at": "2015-11-03T15:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264077",
    "user": "https://github.com/kcrisman"
}
```

I disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.



---

archive/issue_comments_264078.json:
```json
{
    "body": "Replying to [comment:21 kcrisman]:\n> I disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.\n\n\nIsn't the problem actually other way around? That is, `EXAMPLES` contains tests for zero-element graph, empty set and like.",
    "created_at": "2015-11-03T16:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264078",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:21 kcrisman]:
> I disagree with the premise of this ticket.  I am pretty sure that many functions have `TESTS` blocks that have non-trivial functionality demonstrated.  Unless this was also moving all those types of tests to `EXAMPLES` blocks?  This would be a really hard job to identify, I think.


Isn't the problem actually other way around? That is, `EXAMPLES` contains tests for zero-element graph, empty set and like.



---

archive/issue_comments_264079.json:
```json
{
    "body": "For some time, the developer's guide has said that docstrings may include\n\n```\nA TESTS block (optional)\n\nFormatted just like EXAMPLES, containing tests that are not relevant to users.\n```\nSo I think we should hide all TESTS blocks now, and if authors of those tests (or other interested developers) want them to be visible, it is their responsibility to move them to EXAMPLES blocks.",
    "created_at": "2015-11-03T16:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264079",
    "user": "https://github.com/jhpalmieri"
}
```

For some time, the developer's guide has said that docstrings may include

```
A TESTS block (optional)

Formatted just like EXAMPLES, containing tests that are not relevant to users.
```
So I think we should hide all TESTS blocks now, and if authors of those tests (or other interested developers) want them to be visible, it is their responsibility to move them to EXAMPLES blocks.



---

archive/issue_comments_264080.json:
```json
{
    "body": "> For some time, \n\nThe [very first example](https://github.com/sagemath/sage/blob/master/src/sage/calculus/calculus.py) I looked at has this problem.\n\n```\nTESTS:\nSubstitution::\n    sage: f = x\n    sage: f(x=5)\n    5\nSimplifying expressions involving scientific notation::\n    sage: k = var('k')\n    sage: a0 = 2e-06; a1 = 12\n    sage: c = a1 + a0*k; c\n    (2.00000000000000e-6)*k + 12\n    sage: sqrt(c)\n    sqrt((2.00000000000000e-6)*k + 12)\n    sage: sqrt(c^3)\n    sqrt(((2.00000000000000e-6)*k + 12)^3)\nThe symbolic calculus package uses its own copy of Maxima for\nsimplification, etc., which is separate from the default\nsystem-wide version::\n    sage: maxima.eval('[x,y]: [1,2]')\n    '[1,2]'\n    sage: maxima.eval('expand((x+y)^3)')\n    '27'\nIf the copy of maxima used by the symbolic calculus package were\nthe same as the default one, then the following would return 27,\nwhich would be very confusing indeed!\n::\n    sage: x, y = var('x,y')\n    sage: expand((x+y)^3)\n    x^3 + 3*x^2*y + 3*x*y^2 + y^3\nSet x to be 5 in maxima::\n    sage: maxima('x: 5')\n    5\n    sage: maxima('x + x + %pi')\n    %pi+10\nSimplifications like these are now done using Pynac::\n    sage: x + x + pi\n    pi + 2*x\nBut this still uses Maxima::\n    sage: (x + x + pi).simplify()\n    pi + 2*x\nNote that ``x`` is still ``x``, since the\nmaxima used by the calculus package is different than the one in\nthe interactive interpreter.\n```\nand so forth.  Obviously a lot of this is not particularly useful to end users, but a lot of this is.  (It also has `TESTS:` and not `TESTS::` though presumably that isn't relevant here.)\n\nMore examples:\n* [desolvers](https://github.com/sagemath/sage/blob/master/src/sage/calculus/desolvers.py) I assume this could be useful for some users\n\n```\n    TESTS:\n    :trac:`9961` fixed (allow assumptions on the dependent variable in desolve)::\n        sage: y=function('y',x); assume(x>0); assume(y>0)\n        sage: sage.calculus.calculus.maxima('domain:real')  # needed since Maxima 5.26.0 to get the answer as below\n        real\n        sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True)\n        [x - arcsinh(y(x)/x) == _C]\n```\n* Presumably the only documentation for this function [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/animate.py):\n\n```\n    def add_frame(self, pngfile, delay=None, delay_denominator=None):\n        r\"\"\"\n        Adds a single frame to the APNG file.\n        INPUT:\n        - ``pngfile`` -- file name of the PNG file with data for this frame\n        - ``delay`` -- numerator of the delay fraction in seconds\n        - ``delay_denominator`` -- denominator of the delay in seconds\n        If the delay is not specified, the default from the constructor\n        applies.\n        TESTS::\n            sage: from sage.plot.animate import APngAssembler\n            sage: from StringIO import StringIO\n            sage: buf = StringIO()\n            sage: apng = APngAssembler(buf, 2)\n            sage: fn = APngAssembler._testData(\"input1\", True)\n            sage: apng.add_frame(fn, delay=0x567, delay_denominator=0x1234)\n            sage: fn = APngAssembler._testData(\"input2\", True)\n            sage: apng.add_frame(fn)\n            sage: len(buf.getvalue())\n            217\n            sage: buf.getvalue() == APngAssembler._testData(\"anim12\", False)\n            True\n            sage: apng.add_frame(fn)\n            Traceback (most recent call last):\n            ...\n            RuntimeError: Already reached the declared number of frames\n```\n* End user discovers something *very* useful to know about this method [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/arc.py):\n\n```\n    def plot3d(self):\n        r\"\"\"\n        TESTS::\n            sage: from sage.plot.arc import Arc\n            sage: Arc(0,0,1,1,0,0,1,{}).plot3d()\n            Traceback (most recent call last):\n            ...\n            NotImplementedError\n        \"\"\"\n        raise NotImplementedError\n```\n  Yeah, I guess I'd want to know that it isn't implemented...\n\nMy point: there is an awful lot of stuff grandfathered in under this that will vanish which might end up giving ask.sagemath a lot more (unnecessary) activity.",
    "created_at": "2015-11-04T02:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264080",
    "user": "https://github.com/kcrisman"
}
```

> For some time, 

The [very first example](https://github.com/sagemath/sage/blob/master/src/sage/calculus/calculus.py) I looked at has this problem.

```
TESTS:
Substitution::
    sage: f = x
    sage: f(x=5)
    5
Simplifying expressions involving scientific notation::
    sage: k = var('k')
    sage: a0 = 2e-06; a1 = 12
    sage: c = a1 + a0*k; c
    (2.00000000000000e-6)*k + 12
    sage: sqrt(c)
    sqrt((2.00000000000000e-6)*k + 12)
    sage: sqrt(c^3)
    sqrt(((2.00000000000000e-6)*k + 12)^3)
The symbolic calculus package uses its own copy of Maxima for
simplification, etc., which is separate from the default
system-wide version::
    sage: maxima.eval('[x,y]: [1,2]')
    '[1,2]'
    sage: maxima.eval('expand((x+y)^3)')
    '27'
If the copy of maxima used by the symbolic calculus package were
the same as the default one, then the following would return 27,
which would be very confusing indeed!
::
    sage: x, y = var('x,y')
    sage: expand((x+y)^3)
    x^3 + 3*x^2*y + 3*x*y^2 + y^3
Set x to be 5 in maxima::
    sage: maxima('x: 5')
    5
    sage: maxima('x + x + %pi')
    %pi+10
Simplifications like these are now done using Pynac::
    sage: x + x + pi
    pi + 2*x
But this still uses Maxima::
    sage: (x + x + pi).simplify()
    pi + 2*x
Note that ``x`` is still ``x``, since the
maxima used by the calculus package is different than the one in
the interactive interpreter.
```
and so forth.  Obviously a lot of this is not particularly useful to end users, but a lot of this is.  (It also has `TESTS:` and not `TESTS::` though presumably that isn't relevant here.)

More examples:
* [desolvers](https://github.com/sagemath/sage/blob/master/src/sage/calculus/desolvers.py) I assume this could be useful for some users

```
    TESTS:
    :trac:`9961` fixed (allow assumptions on the dependent variable in desolve)::
        sage: y=function('y',x); assume(x>0); assume(y>0)
        sage: sage.calculus.calculus.maxima('domain:real')  # needed since Maxima 5.26.0 to get the answer as below
        real
        sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True)
        [x - arcsinh(y(x)/x) == _C]
```
* Presumably the only documentation for this function [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/animate.py):

```
    def add_frame(self, pngfile, delay=None, delay_denominator=None):
        r"""
        Adds a single frame to the APNG file.
        INPUT:
        - ``pngfile`` -- file name of the PNG file with data for this frame
        - ``delay`` -- numerator of the delay fraction in seconds
        - ``delay_denominator`` -- denominator of the delay in seconds
        If the delay is not specified, the default from the constructor
        applies.
        TESTS::
            sage: from sage.plot.animate import APngAssembler
            sage: from StringIO import StringIO
            sage: buf = StringIO()
            sage: apng = APngAssembler(buf, 2)
            sage: fn = APngAssembler._testData("input1", True)
            sage: apng.add_frame(fn, delay=0x567, delay_denominator=0x1234)
            sage: fn = APngAssembler._testData("input2", True)
            sage: apng.add_frame(fn)
            sage: len(buf.getvalue())
            217
            sage: buf.getvalue() == APngAssembler._testData("anim12", False)
            True
            sage: apng.add_frame(fn)
            Traceback (most recent call last):
            ...
            RuntimeError: Already reached the declared number of frames
```
* End user discovers something *very* useful to know about this method [here](https://github.com/sagemath/sage/blob/master/src/sage/plot/arc.py):

```
    def plot3d(self):
        r"""
        TESTS::
            sage: from sage.plot.arc import Arc
            sage: Arc(0,0,1,1,0,0,1,{}).plot3d()
            Traceback (most recent call last):
            ...
            NotImplementedError
        """
        raise NotImplementedError
```
  Yeah, I guess I'd want to know that it isn't implemented...

My point: there is an awful lot of stuff grandfathered in under this that will vanish which might end up giving ask.sagemath a lot more (unnecessary) activity.



---

archive/issue_comments_264081.json:
```json
{
    "body": "So I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)",
    "created_at": "2015-11-04T02:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264081",
    "user": "https://github.com/jhpalmieri"
}
```

So I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)



---

archive/issue_comments_264082.json:
```json
{
    "body": "Replying to [comment:25 jhpalmieri]:\n> So I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)\n\n\nThen can this be made at least optional? I.e. have an environment variable or something, defaults to `True`, that controls if `TESTS` are shown with `?`? Just what is suggested to html-docs.\n\nSage will always be unfinished product. That it true for documentation also.",
    "created_at": "2015-11-04T06:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264082",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:25 jhpalmieri]:
> So I guess the question is whether to hide too much now, or to live with the situation where we don't hide anything. (I don't think we will find anyone willing to examine and evaluate each possibly omitted block, which would be the best choice.)


Then can this be made at least optional? I.e. have an environment variable or something, defaults to `True`, that controls if `TESTS` are shown with `?`? Just what is suggested to html-docs.

Sage will always be unfinished product. That it true for documentation also.



---

archive/issue_comments_264083.json:
```json
{
    "body": "Replying to [comment:26 jmantysalo]:\n> I.e. have an environment variable or something\n\n\nPlease, not yet another useless environment variable.",
    "created_at": "2015-11-04T13:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264083",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 jmantysalo]:
> I.e. have an environment variable or something


Please, not yet another useless environment variable.



---

archive/issue_comments_264084.json:
```json
{
    "body": "`@`kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.",
    "created_at": "2015-11-04T13:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264084",
    "user": "https://github.com/jdemeyer"
}
```

`@`kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.



---

archive/issue_comments_264085.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> The lines after the original test,\n> \n> ```\n>  Classes and methods\n>  -------------------\n> ```\n> are not detected by the regular expression for the end of the test\n\n\nThen please fix your regular expression or change the docstring. I don't like that you need to move those tests.",
    "created_at": "2015-11-04T13:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264085",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 jhpalmieri]:
> The lines after the original test,
> 
> ```
>  Classes and methods
>  -------------------
> ```
> are not detected by the regular expression for the end of the test


Then please fix your regular expression or change the docstring. I don't like that you need to move those tests.



---

archive/issue_comments_264086.json:
```json
{
    "body": "Replying to [comment:29 jdemeyer]:\n> Replying to [comment:17 jhpalmieri]:\n> > The lines after the original test,\n> > \n> > ```\n> >  Classes and methods\n> >  -------------------\n> > ```\n> > are not detected by the regular expression for the end of the test\n\n> \n> Then please fix your regular expression or change the docstring. I don't like that you need to move those tests.\n\n\nWhy? What's wrong with moving those tests?",
    "created_at": "2015-11-04T16:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264086",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:29 jdemeyer]:
> Replying to [comment:17 jhpalmieri]:
> > The lines after the original test,
> > 
> > ```
> >  Classes and methods
> >  -------------------
> > ```
> > are not detected by the regular expression for the end of the test

> 
> Then please fix your regular expression or change the docstring. I don't like that you need to move those tests.


Why? What's wrong with moving those tests?



---

archive/issue_comments_264087.json:
```json
{
    "body": "> `@`kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.\n\nThen we may agree to disagree.  I find that those examples have useful syntax examples that are not covered by the original ones.\n\nI just feel like this is covering up the real problem, which is methods/functions which don't have very detailed documentation.  Why do we need to not show these?  It's fixing a problem that isn't a problem.  Things people don't understand they skip anyway; if `TESTS` isn't helpful, it's because they made it to `TESTS` because `EXAMPLES` didn't do its job.",
    "created_at": "2015-11-04T18:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264087",
    "user": "https://github.com/kcrisman"
}
```

> `@`kcrisman: I'm not convinced by your examples of `TESTS` blocks. I really do think that the examples you showed contain tests which are not meant for end users.

Then we may agree to disagree.  I find that those examples have useful syntax examples that are not covered by the original ones.

I just feel like this is covering up the real problem, which is methods/functions which don't have very detailed documentation.  Why do we need to not show these?  It's fixing a problem that isn't a problem.  Things people don't understand they skip anyway; if `TESTS` isn't helpful, it's because they made it to `TESTS` because `EXAMPLES` didn't do its job.



---

archive/issue_comments_264088.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-04T19:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264089.json:
```json
{
    "body": "I don't want to incorporate an ReST parser into this, but I've attempted to detect when an ReST header ends a \"TESTS\" block.\n\nI probably won't work on this more unless it is clear that the ticket has enough support.",
    "created_at": "2015-11-04T19:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264089",
    "user": "https://github.com/jhpalmieri"
}
```

I don't want to incorporate an ReST parser into this, but I've attempted to detect when an ReST header ends a "TESTS" block.

I probably won't work on this more unless it is clear that the ticket has enough support.



---

archive/issue_comments_264090.json:
```json
{
    "body": "Replying to [comment:33 jhpalmieri]:\n\n> I probably won't work on this more unless it is clear that the ticket has enough support.\n\n\nWilliam Stein has said that we should have foldable `TESTS`-parts in html documentation. So if you mean \"support\" as \"someone else also wants this\", then yes, you have it.",
    "created_at": "2015-11-05T06:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264090",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:33 jhpalmieri]:

> I probably won't work on this more unless it is clear that the ticket has enough support.


William Stein has said that we should have foldable `TESTS`-parts in html documentation. So if you mean "support" as "someone else also wants this", then yes, you have it.



---

archive/issue_comments_264091.json:
```json
{
    "body": "At the very least, we should keep the doc reformatting which was done in this branch.\n\nOne the one hand, I think it's good to hide the `TESTS` blocks since I don't think they contain useful information for the user.\n\nOn the other hand, I also see some value in `@`kcrisman's comment: are those `TESTS` blocks really bothering people?",
    "created_at": "2015-11-05T11:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264091",
    "user": "https://github.com/jdemeyer"
}
```

At the very least, we should keep the doc reformatting which was done in this branch.

One the one hand, I think it's good to hide the `TESTS` blocks since I don't think they contain useful information for the user.

On the other hand, I also see some value in `@`kcrisman's comment: are those `TESTS` blocks really bothering people?



---

archive/issue_comments_264092.json:
```json
{
    "body": "Replying to [comment:35 jdemeyer]:\n\n> On the other hand, I also see some value in `@`kcrisman's comment: are those `TESTS` blocks really bothering people?\n\n\nThis can be argued, but I think that they give kind of unprofessional feeling. They are at least noise to normal user.",
    "created_at": "2015-11-05T11:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264092",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:35 jdemeyer]:

> On the other hand, I also see some value in `@`kcrisman's comment: are those `TESTS` blocks really bothering people?


This can be argued, but I think that they give kind of unprofessional feeling. They are at least noise to normal user.



---

archive/issue_comments_264093.json:
```json
{
    "body": "Should we ask on sage-devel?",
    "created_at": "2015-11-05T17:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264093",
    "user": "https://github.com/jhpalmieri"
}
```

Should we ask on sage-devel?



---

archive/issue_comments_264094.json:
```json
{
    "body": "Replying to [comment:37 jhpalmieri]:\n> Should we ask on sage-devel?\n\n\nIt will not make any harm. Please ask.",
    "created_at": "2015-11-06T07:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264094",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:37 jhpalmieri]:
> Should we ask on sage-devel?


It will not make any harm. Please ask.



---

archive/issue_comments_264095.json:
```json
{
    "body": "The vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.",
    "created_at": "2015-11-12T19:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264095",
    "user": "https://github.com/jhpalmieri"
}
```

The vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.



---

archive/issue_comments_264096.json:
```json
{
    "body": "Replying to [comment:39 jhpalmieri]:\n> The vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.\n\n\nSo please proceed.",
    "created_at": "2015-11-13T05:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264096",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:39 jhpalmieri]:
> The vote on sage-devel: 6 votes for omitting TESTS blocks, 2 votes for keeping them.


So please proceed.



---

archive/issue_comments_264097.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-13T22:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264098.json:
```json
{
    "body": "I've fixed the merge conflicts with 6.10.beta4.",
    "created_at": "2015-11-13T22:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264098",
    "user": "https://github.com/jhpalmieri"
}
```

I've fixed the merge conflicts with 6.10.beta4.



---

archive/issue_comments_264099.json:
```json
{
    "body": "I got\n\n```\n            reading sources... [ 94%] sage/repl/rich_output/output_video\n            reading sources... [ 97%] sage/repl/rich_output/preferences\n            reading sources... [100%] startup\n            loading cross citations... \n[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:66: SEVERE: Unexpected section title.\n[repl     ] sage: shell.run_cell('1/0')\n[repl     ] ---------------------------------------------------------------------------\n[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:76: WARNING: Definition list ends without a blank line; unexpected unindent.\nError building the documentation.\nTraceback (most recent call last):\n  File \"/home/jm58660/sage/src/doc/common/builder.py\", line 1641, in <module>\n    getattr(get_builder(name), type)()\n```\n\nfrom `./sage --docbuild --no-tests all html`.",
    "created_at": "2015-11-17T11:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264099",
    "user": "https://github.com/jm58660"
}
```

I got

```
            reading sources... [ 94%] sage/repl/rich_output/output_video
            reading sources... [ 97%] sage/repl/rich_output/preferences
            reading sources... [100%] startup
            loading cross citations... 
[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:66: SEVERE: Unexpected section title.
[repl     ] sage: shell.run_cell('1/0')
[repl     ] ---------------------------------------------------------------------------
[repl     ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/repl/interpreter.py:docstring of sage.repl.interpreter:76: WARNING: Definition list ends without a blank line; unexpected unindent.
Error building the documentation.
Traceback (most recent call last):
  File "/home/jm58660/sage/src/doc/common/builder.py", line 1641, in <module>
    getattr(get_builder(name), type)()
```

from `./sage --docbuild --no-tests all html`.



---

archive/issue_comments_264100.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-17T11:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264100",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_264101.json:
```json
{
    "body": "I see, in a few docstrings, in the middle of a TESTS block there is a line of all hyphens, so my function thought they were ReST headers, and ended the TESTS block prematurely. The new version tests the indentation level.",
    "created_at": "2015-11-17T17:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264101",
    "user": "https://github.com/jhpalmieri"
}
```

I see, in a few docstrings, in the middle of a TESTS block there is a line of all hyphens, so my function thought they were ReST headers, and ended the TESTS block prematurely. The new version tests the indentation level.



---

archive/issue_comments_264102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-17T17:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264103.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-17T17:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264103",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_264104.json:
```json
{
    "body": "This works for me. Patchbot gives two error from `src/sage/rings/real_double.pyx`, but I can not reproduce them on my machine.\n\nI see this as a good addition. However, I know about nothing about Sphinx. Hence I hope someone else to review this.",
    "created_at": "2015-11-18T07:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264104",
    "user": "https://github.com/jm58660"
}
```

This works for me. Patchbot gives two error from `src/sage/rings/real_double.pyx`, but I can not reproduce them on my machine.

I see this as a good addition. However, I know about nothing about Sphinx. Hence I hope someone else to review this.



---

archive/issue_comments_264105.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-24T22:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264105",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_053769.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-25T18:01:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19503#event-53769"
}
```



---

archive/issue_comments_264106.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-25T18:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19503#issuecomment-264106",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
