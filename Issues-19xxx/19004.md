# Issue 19004: Do not search old-style spkgs

archive/issues_018767.json:
```json
{
    "assignees": [],
    "body": "As discussed on https://groups.google.com/d/msg/sage-devel/n1Y5BoVLBLw/--ykz5QdCwAJ\n\nBranch/Commit: **[`0d0a335`](https://github.com/sagemath/sagetrac-mirror/commit/0d0a33513a045a5686b31ebef7effa7dff1135c7)**\n\nReviewer: **John Palmieri, Volker Braun**\n\nAuthor: **Volker Braun, John Palmieri**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19004_\n\n",
    "closed_at": "2015-08-21T01:56:10Z",
    "created_at": "2015-08-09T08:49:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Do not search old-style spkgs",
    "type": "issue",
    "updated_at": "2015-08-21T01:56:10Z",
    "url": "https://github.com/sagemath/sage/issues/19004",
    "user": "https://github.com/vbraun"
}
```
As discussed on https://groups.google.com/d/msg/sage-devel/n1Y5BoVLBLw/--ykz5QdCwAJ

Branch/Commit: **[`0d0a335`](https://github.com/sagemath/sagetrac-mirror/commit/0d0a33513a045a5686b31ebef7effa7dff1135c7)**

Reviewer: **John Palmieri, Volker Braun**

Author: **Volker Braun, John Palmieri**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/19004_





---

archive/issue_events_267327.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-09T08:49:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267327"
}
```



---

archive/issue_events_267328.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-09T08:49:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267328"
}
```



---

archive/issue_comments_267210.json:
```json
{
    "body": "Branch: **[u/vbraun/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_search_old_style_spkgs)**",
    "created_at": "2015-08-09T09:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267210",
    "user": "https://github.com/vbraun"
}
```

Branch: **[u/vbraun/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_search_old_style_spkgs)**



---

archive/issue_comments_267211.json:
```json
{
    "body": "Commit: **[`a8ccb41`](https://github.com/sagemath/sagetrac-mirror/commit/a8ccb41d3e45a9d79a60a9510f1faeb90111e86f)**",
    "created_at": "2015-08-09T09:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267211",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`a8ccb41`](https://github.com/sagemath/sagetrac-mirror/commit/a8ccb41d3e45a9d79a60a9510f1faeb90111e86f)**



---

archive/issue_comments_267212.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8ccb41d3e45a9d79a60a9510f1faeb90111e86f\"><code>a8ccb41</code></a></td><td><code>Add sage-package apropos to hint misspelled packages</code></td></tr></table>\n",
    "created_at": "2015-08-09T09:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267212",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8ccb41d3e45a9d79a60a9510f1faeb90111e86f"><code>a8ccb41</code></a></td><td><code>Add sage-package apropos to hint misspelled packages</code></td></tr></table>




---

archive/issue_events_267329.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-09T09:34:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267329"
}
```



---

archive/issue_events_267330.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-09T09:34:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267330"
}
```



---

archive/issue_events_267331.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-09T09:34:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267331"
}
```



---

archive/issue_comments_267213.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2015-08-09T09:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267213",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_comments_267214.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+As discussed on https://groups.google.com/d/msg/sage-devel/n1Y5BoVLBLw/--ykz5QdCwAJ\n``````\n",
    "created_at": "2015-08-09T09:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267214",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+As discussed on https://groups.google.com/d/msg/sage-devel/n1Y5BoVLBLw/--ykz5QdCwAJ
``````




---

archive/issue_comments_267215.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n\n```\n$ tox\n[...]\n  py26: commands succeeded\n  py27: commands succeeded\n  py33: commands succeeded\n  py34: commands succeeded\n  congratulations :)\n```",
    "created_at": "2015-08-09T09:39:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267215",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:4" align="right">comment:4</div>


```
$ tox
[...]
  py26: commands succeeded
  py27: commands succeeded
  py33: commands succeeded
  py34: commands succeeded
  congratulations :)
```



---

archive/issue_comments_267216.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWhat does `Levenshtein Distance` do here? It should be in `src/sage/coding/`...",
    "created_at": "2015-08-10T20:01:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267216",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

What does `Levenshtein Distance` do here? It should be in `src/sage/coding/`...



---

archive/issue_comments_267217.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIts here so we can suggest similarly-named packages\n\n```\n$ ./build/bin/sage-package apropos python\nDid you mean: cython, ipython, python2, python3, patch?\n```\n`sage_bootstrap` must work without Sage for the obvious chicken-and-egg reasons, so no, we can't put it anywhere else.",
    "created_at": "2015-08-10T20:15:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267217",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

Its here so we can suggest similarly-named packages

```
$ ./build/bin/sage-package apropos python
Did you mean: cython, ipython, python2, python3, patch?
```
`sage_bootstrap` must work without Sage for the obvious chicken-and-egg reasons, so no, we can't put it anywhere else.



---

archive/issue_comments_267218.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRe \"call the new package manager\", how long will it be \"new\"? Maybe this should just say \"Call Sage's package manager\".",
    "created_at": "2015-08-10T21:22:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267218",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Re "call the new package manager", how long will it be "new"? Maybe this should just say "Call Sage's package manager".



---

archive/issue_comments_267219.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nTo clarify: if you want to install an old-style spkg, do you need to download the spkg file manually and then do `sage -i FILE`?",
    "created_at": "2015-08-10T21:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267219",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

To clarify: if you want to install an old-style spkg, do you need to download the spkg file manually and then do `sage -i FILE`?



---

archive/issue_comments_267220.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\non the wishlist:\n\nHaving as answer `patch` when asking for `python` is funny ;-) And having `cython` first is bad as well. Could you weight the Levenshtein distance. Reasonable parameters for your purpose might be:\n- deletion: 1\n- addition: 1\n- exchange: 2  (so basically this would count for one deletion + one addition)\n\n`patch` would then be out if I count well (would be distance 6) and `cython` will appear after `python2` and `python3` (would be distance `2` against `1`).",
    "created_at": "2015-08-10T22:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267220",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

on the wishlist:

Having as answer `patch` when asking for `python` is funny ;-) And having `cython` first is bad as well. Could you weight the Levenshtein distance. Reasonable parameters for your purpose might be:
- deletion: 1
- addition: 1
- exchange: 2  (so basically this would count for one deletion + one addition)

`patch` would then be out if I count well (would be distance 6) and `cython` will appear after `python2` and `python3` (would be distance `2` against `1`).



---

archive/issue_comments_267221.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWe'll call it new until New Hall changes its name, easy.\n\nBoth `sage -i /path/to/old.spkg` and `sage -i http://url/to/old.spkg` still work.\n\nAd hoc weighting the distance is so passe, we should train a RNN on command line input! This is obviously a good investment of time and developer effort.",
    "created_at": "2015-08-10T23:00:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267221",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

We'll call it new until New Hall changes its name, easy.

Both `sage -i /path/to/old.spkg` and `sage -i http://url/to/old.spkg` still work.

Ad hoc weighting the distance is so passe, we should train a RNN on command line input! This is obviously a good investment of time and developer effort.



---

archive/issue_comments_267222.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAlso on the wishlist: the suggestions should also include relevant old-style packages, perhaps with a suitable warning (while we don't want someone to install the old \"python\" package, we should be happy to have them install the \"p_group_cohomology\" package).",
    "created_at": "2015-08-10T23:37:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267222",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

Also on the wishlist: the suggestions should also include relevant old-style packages, perhaps with a suitable warning (while we don't want someone to install the old "python" package, we should be happy to have them install the "p_group_cohomology" package).



---

archive/issue_comments_267223.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAny actionable suggestions or should I just go with the original plan and delete the spkgs from the server?",
    "created_at": "2015-08-13T20:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267223",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>

Any actionable suggestions or should I just go with the original plan and delete the spkgs from the server?



---

archive/issue_comments_267224.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSo what will happen to the `p_group_cohomology` package, for example? Will it completely disappear from the lists of available packages? If this is the plan, then I object. We would need some sort of official deprecation period for old-style packages, and at the end of that period (which could be strictly enforced, unlike some of our other deprecation time tables), then we delete all old-style packages.",
    "created_at": "2015-08-16T15:08:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267224",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

So what will happen to the `p_group_cohomology` package, for example? Will it completely disappear from the lists of available packages? If this is the plan, then I object. We would need some sort of official deprecation period for old-style packages, and at the end of that period (which could be strictly enforced, unlike some of our other deprecation time tables), then we delete all old-style packages.



---

archive/issue_comments_267225.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jhpalmieri](#comment%3A13):\n> some of our other deprecation time tables\n\n[off topic] A deprecation is not a time table: deprecated code MAY be removed after one year, it's not that it SHOULD be removed.",
    "created_at": "2015-08-16T21:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267225",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jhpalmieri](#comment%3A13):
> some of our other deprecation time tables

[off topic] A deprecation is not a time table: deprecated code MAY be removed after one year, it's not that it SHOULD be removed.



---

archive/issue_comments_267226.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nNothing will happen to the `p_group_cohomology` package. You can install it by specifying its path or url. The only change is that installing `python` will no longer automatically download the ancient python spkg.",
    "created_at": "2015-08-16T22:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267226",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

Nothing will happen to the `p_group_cohomology` package. You can install it by specifying its path or url. The only change is that installing `python` will no longer automatically download the ancient python spkg.



---

archive/issue_comments_267227.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI'm sorry, I'm confused again. Are you just proposing the changes in the branch, or also to remove files from the server? It's important that commands like `sage --optional` still list the old-style packages. If you actually remove them from the server, that won't happen, right?\n\n```\n$ sage -i p_group_cohomology\nAttempting to download package p_group_cohomology\nError: could not find a package matching p_group_cohomology\n       Try 'sage --package list' to see the available packages\n       There is no package similar to p_group_cohomology\n```\nThen since `sage --package list` doesn't actually list `p_group_cohomology`, it is not clear how someone is supposed to find out about it or find its URL. `sage --optional` does list it, but doesn't say how to obtain it. If I were a novice user, I would be confused about whether this was a valid package or not.\n\nIt might be better if, instead of deleting item 2b, it behaved differently: it should never install a package, but only print a warning, something like: \"Old-style Sage package available from <URL>. Run <CMD> to install it. Only do this if you know what you're doing.\" In addition, it should print the apropos message (probably first), so someone running `sage -i python` will be given appropriate advice.",
    "created_at": "2015-08-16T23:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267227",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

I'm sorry, I'm confused again. Are you just proposing the changes in the branch, or also to remove files from the server? It's important that commands like `sage --optional` still list the old-style packages. If you actually remove them from the server, that won't happen, right?

```
$ sage -i p_group_cohomology
Attempting to download package p_group_cohomology
Error: could not find a package matching p_group_cohomology
       Try 'sage --package list' to see the available packages
       There is no package similar to p_group_cohomology
```
Then since `sage --package list` doesn't actually list `p_group_cohomology`, it is not clear how someone is supposed to find out about it or find its URL. `sage --optional` does list it, but doesn't say how to obtain it. If I were a novice user, I would be confused about whether this was a valid package or not.

It might be better if, instead of deleting item 2b, it behaved differently: it should never install a package, but only print a warning, something like: "Old-style Sage package available from <URL>. Run <CMD> to install it. Only do this if you know what you're doing." In addition, it should print the apropos message (probably first), so someone running `sage -i python` will be given appropriate advice.



---

archive/issue_comments_267228.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nNobody in their right mind is going to want to install the old python spkg. Its akin to handing out razor blades to babies if you just tell people to type in this other command to install the python spkg. The entire mashing-up old (and almost always broken) and new packages is insane, and technically savvy users trip over it on a daily basis. As documented on sage-devel. \n\nThis ticket doesn't change `sage --optional`, but IMHO its just as insane that it mashes old and new spkgs together. In any case, this is not what this ticket is about. \n\nIf you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url. Weighted against the very real and documented risk that people get confused about standard packages, this is a no-brainer to me.",
    "created_at": "2015-08-17T07:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267228",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

Nobody in their right mind is going to want to install the old python spkg. Its akin to handing out razor blades to babies if you just tell people to type in this other command to install the python spkg. The entire mashing-up old (and almost always broken) and new packages is insane, and technically savvy users trip over it on a daily basis. As documented on sage-devel. 

This ticket doesn't change `sage --optional`, but IMHO its just as insane that it mashes old and new spkgs together. In any case, this is not what this ticket is about. 

If you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url. Weighted against the very real and documented risk that people get confused about standard packages, this is a no-brainer to me.



---

archive/issue_comments_267229.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@vbraun](#comment%3A17):\n> Nobody in their right mind is going to want to install the old python spkg.\n\nAbsolutely.\n\n> If you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url.\n\nOkay, but Simon's package is not being distributed outside of Sage: you are proposing with this ticket to move it outside of Sage. I think a deprecation period makes a lot of sense, giving the late-adopters time to update their old-style packages. It is not reasonable, on the other hand, to just say \"we are immediately deleting all old-style packages from the servers with no warning.\"",
    "created_at": "2015-08-17T14:56:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267229",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@vbraun](#comment%3A17):
> Nobody in their right mind is going to want to install the old python spkg.

Absolutely.

> If you want to distribute code outside of Sage (in a spkg) then imho its not too much to ask that you also tell your users the download url.

Okay, but Simon's package is not being distributed outside of Sage: you are proposing with this ticket to move it outside of Sage. I think a deprecation period makes a lot of sense, giving the late-adopters time to update their old-style packages. It is not reasonable, on the other hand, to just say "we are immediately deleting all old-style packages from the servers with no warning."



---

archive/issue_comments_267230.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWell fine then we shall be completely utterly broken for a year, to the extent that William can't even install anything. Cool.",
    "created_at": "2015-08-17T19:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267230",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

Well fine then we shall be completely utterly broken for a year, to the extent that William can't even install anything. Cool.



---

archive/issue_comments_267231.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHow about this, instead: for old-style packages, if the apropos function finds anything, just print that message and exit. If it doesn't find anything, search the servers and print the URL of the matching package, with instructions on how to install it. Not perfect, but it doesn't just dump all of the old packages.\n\nI also didn't say we had to wait a year. Three months might be enough warning.",
    "created_at": "2015-08-17T19:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267231",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

How about this, instead: for old-style packages, if the apropos function finds anything, just print that message and exit. If it doesn't find anything, search the servers and print the URL of the matching package, with instructions on how to install it. Not perfect, but it doesn't just dump all of the old packages.

I also didn't say we had to wait a year. Three months might be enough warning.



---

archive/issue_comments_267232.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHow about we move the spkgs to http://old.files.sagemath.org/spkg/archive/ and have apropos print that url if it can't find anything.",
    "created_at": "2015-08-17T20:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267232",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">comment:21</div>

How about we move the spkgs to http://old.files.sagemath.org/spkg/archive/ and have apropos print that url if it can't find anything.



---

archive/issue_comments_267233.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThat sounds okay to me.",
    "created_at": "2015-08-17T20:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267233",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

That sounds okay to me.



---

archive/issue_comments_267234.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807\"><code>072001b</code></a></td><td><code>print a link to the spkg archive</code></td></tr></table>\n",
    "created_at": "2015-08-17T21:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267234",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807"><code>072001b</code></a></td><td><code>print a link to the spkg archive</code></td></tr></table>




---

archive/issue_comments_267235.json:
```json
{
    "body": "Changed commit from **[`a8ccb41`](https://github.com/sagemath/sagetrac-mirror/commit/a8ccb41d3e45a9d79a60a9510f1faeb90111e86f)** to **[`072001b`](https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807)**",
    "created_at": "2015-08-17T21:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267235",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a8ccb41`](https://github.com/sagemath/sagetrac-mirror/commit/a8ccb41d3e45a9d79a60a9510f1faeb90111e86f)** to **[`072001b`](https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807)**



---

archive/issue_comments_267236.json:
```json
{
    "body": "Changed commit from **[`072001b`](https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807)** to **[`7a1ebfc`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035)**",
    "created_at": "2015-08-17T21:14:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267236",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`072001b`](https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807)** to **[`7a1ebfc`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035)**



---

archive/issue_comments_267237.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035\"><code>7a1ebfc</code></a></td><td><code>Better link</code></td></tr></table>\n",
    "created_at": "2015-08-17T21:14:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267237",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035"><code>7a1ebfc</code></a></td><td><code>Better link</code></td></tr></table>




---

archive/issue_comments_267238.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nActually, http://files.sagemath.org/spkg/ is a better link.\n\nThe spkgs can actualy stay where they are now if we don't search for them.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807\"><code>072001b</code></a></td><td><code>print a link to the spkg archive</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035\"><code>7a1ebfc</code></a></td><td><code>Better link</code></td></tr></table>\n",
    "created_at": "2015-08-17T21:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267238",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

Actually, http://files.sagemath.org/spkg/ is a better link.

The spkgs can actualy stay where they are now if we don't search for them.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/072001b073308bb3ccd6f772c338976e09795807"><code>072001b</code></a></td><td><code>print a link to the spkg archive</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035"><code>7a1ebfc</code></a></td><td><code>Better link</code></td></tr></table>




---

archive/issue_comments_267239.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nIt's not ideal (http://files.sagemath.org/spkg/ is not the friendliest web site), but it's basically good enough for me. I would suggest either of the following changes:\n\n```diff\ndiff --git a/build/bin/sage-spkg b/build/bin/sage-spkg\nindex a9f68a6..9c0c00c 100755\n--- a/build/bin/sage-spkg\n+++ b/build/bin/sage-spkg\n@@ -57,6 +57,25 @@\n # Avoid surprises with character ranges [a-z] in regular expressions\n export LC_ALL=C\n \n+usage()\n+{\n+cat <<EOF\n+Usage: sage -i <options> <package name>\n+\n+If <package name> is a URL, download and install it. If it is a file\n+name, install it. Otherwise, search Sage's list of packages (see 'sage\n+--package list') for a matching package, and if a match is found,\n+install it.\n+\n+Options:\n+   -f: force install a package even if the same version is already installed\n+   -s: do not delete temporary build directory\n+   -c: after installing, run the test suite for the spkg\n+   -d: only download the package\n+\n+EOF\n+}\n+\n # error_msg(header, command)\n # This is for printing an error message if something went wrong.\n # The first argument is the header to print, the second argument should\n@@ -152,8 +171,8 @@ fi\n # Handle special command-line options\n ##################################################################\n if [ $# -eq 0 ]; then\n-    echo \"Currently installed packages:\"\n-    exec ls -1 \"$SAGE_SPKG_INST\"\n+    usage\n+    exit 0\n fi\n \n # Options have to come in a specific order,\n```\nor\n\n```diff\ndiff --git a/build/bin/sage-spkg b/build/bin/sage-spkg\nindex a9f68a6..2ddd35b 100755\n--- a/build/bin/sage-spkg\n+++ b/build/bin/sage-spkg\n@@ -153,7 +153,7 @@ fi\n ##################################################################\n if [ $# -eq 0 ]; then\n     echo \"Currently installed packages:\"\n-    exec ls -1 \"$SAGE_SPKG_INST\"\n+    exec sage-list-packages installed\n fi\n \n # Options have to come in a specific order,\n```\nI have a slight preference for the first, since `sage -i <pkg>` is not very well documented. I also don't think that `sage -i` (with no arguments) is documented anywhere, so maybe it's not a terrible idea to change its behavior. Or we could use the second change and add a `-h` flag for the usage message.\n\n(My goal here is to not leave someone completely baffled if they want to install an old-style package.)\n\nMeanwhile, it would be good to reiterate on sage-devel that old-style packages are on the way out, so people who maintain them should update to new-style packages ASAP.",
    "created_at": "2015-08-17T22:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267239",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

It's not ideal (http://files.sagemath.org/spkg/ is not the friendliest web site), but it's basically good enough for me. I would suggest either of the following changes:

```diff
diff --git a/build/bin/sage-spkg b/build/bin/sage-spkg
index a9f68a6..9c0c00c 100755
--- a/build/bin/sage-spkg
+++ b/build/bin/sage-spkg
@@ -57,6 +57,25 @@
 # Avoid surprises with character ranges [a-z] in regular expressions
 export LC_ALL=C
 
+usage()
+{
+cat <<EOF
+Usage: sage -i <options> <package name>
+
+If <package name> is a URL, download and install it. If it is a file
+name, install it. Otherwise, search Sage's list of packages (see 'sage
+--package list') for a matching package, and if a match is found,
+install it.
+
+Options:
+   -f: force install a package even if the same version is already installed
+   -s: do not delete temporary build directory
+   -c: after installing, run the test suite for the spkg
+   -d: only download the package
+
+EOF
+}
+
 # error_msg(header, command)
 # This is for printing an error message if something went wrong.
 # The first argument is the header to print, the second argument should
@@ -152,8 +171,8 @@ fi
 # Handle special command-line options
 ##################################################################
 if [ $# -eq 0 ]; then
-    echo "Currently installed packages:"
-    exec ls -1 "$SAGE_SPKG_INST"
+    usage
+    exit 0
 fi
 
 # Options have to come in a specific order,
```
or

```diff
diff --git a/build/bin/sage-spkg b/build/bin/sage-spkg
index a9f68a6..2ddd35b 100755
--- a/build/bin/sage-spkg
+++ b/build/bin/sage-spkg
@@ -153,7 +153,7 @@ fi
 ##################################################################
 if [ $# -eq 0 ]; then
     echo "Currently installed packages:"
-    exec ls -1 "$SAGE_SPKG_INST"
+    exec sage-list-packages installed
 fi
 
 # Options have to come in a specific order,
```
I have a slight preference for the first, since `sage -i <pkg>` is not very well documented. I also don't think that `sage -i` (with no arguments) is documented anywhere, so maybe it's not a terrible idea to change its behavior. Or we could use the second change and add a `-h` flag for the usage message.

(My goal here is to not leave someone completely baffled if they want to install an old-style package.)

Meanwhile, it would be good to reiterate on sage-devel that old-style packages are on the way out, so people who maintain them should update to new-style packages ASAP.



---

archive/issue_comments_267240.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI'm fine with either, can you add a commit?",
    "created_at": "2015-08-18T17:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267240",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:27" align="right">comment:27</div>

I'm fine with either, can you add a commit?



---

archive/issue_comments_267241.json:
```json
{
    "body": "Changed branch from **[u/vbraun/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_search_old_style_spkgs)** to **[u/jhpalmieri/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/do_not_search_old_style_spkgs)**",
    "created_at": "2015-08-18T22:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267241",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/vbraun/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_search_old_style_spkgs)** to **[u/jhpalmieri/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/do_not_search_old_style_spkgs)**



---

archive/issue_comments_267242.json:
```json
{
    "body": "Changed commit from **[`7a1ebfc`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035)** to **[`0d0a335`](https://github.com/sagemath/sagetrac-mirror/commit/0d0a33513a045a5686b31ebef7effa7dff1135c7)**",
    "created_at": "2015-08-18T22:07:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267242",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`7a1ebfc`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ebfcf2a977d7c2ec49fab5384a2d7eb178035)** to **[`0d0a335`](https://github.com/sagemath/sagetrac-mirror/commit/0d0a33513a045a5686b31ebef7effa7dff1135c7)**



---

archive/issue_comments_267243.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nSure, here you go.",
    "created_at": "2015-08-18T22:07:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267243",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

Sure, here you go.



---

archive/issue_comments_267244.json:
```json
{
    "body": "Changed author from **Volker Braun** to **Volker Braun, John Palmieri**",
    "created_at": "2015-08-20T13:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267244",
    "user": "https://github.com/vbraun"
}
```

Changed author from **Volker Braun** to **Volker Braun, John Palmieri**



---

archive/issue_comments_267245.json:
```json
{
    "body": "Reviewer: **John Palmieri, Volker Braun**",
    "created_at": "2015-08-20T13:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267245",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **John Palmieri, Volker Braun**



---

archive/issue_events_267332.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-20T13:01:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267332"
}
```



---

archive/issue_events_267333.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-20T13:01:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267333"
}
```



---

archive/issue_comments_267246.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/do_not_search_old_style_spkgs)** to **[`0d0a335`](https://github.com/sagemath/sagetrac-mirror/commit/0d0a33513a045a5686b31ebef7effa7dff1135c7)**",
    "created_at": "2015-08-21T01:56:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19004#issuecomment-267246",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/do_not_search_old_style_spkgs](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/do_not_search_old_style_spkgs)** to **[`0d0a335`](https://github.com/sagemath/sagetrac-mirror/commit/0d0a33513a045a5686b31ebef7effa7dff1135c7)**



---

archive/issue_events_267334.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-21T01:56:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267334"
}
```



---

archive/issue_events_267335.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "89042cbbe6ed7288362481aa66186874eedb5567",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-08-21T01:56:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19004",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19004#event-267335"
}
```
