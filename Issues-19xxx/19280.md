# Issue 19280: MPIR gives incorrect result on 32-bit machines

archive/issues_019043.json:
```json
{
    "body": "In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting 32 bit machines was described.\n\n```\n #include \"mpir.h\"\n\nint main()\n{\n\n    mpz_t one, x, w;\n    mpz_init(one);\n    mpz_init(x);\n    mpz_init(w);\n    mpz_set_str(one, \"62165404551223330269422781018352605012557018849668464680057997111644937126566671941632\", 10);\n    mpz_set_str(x, \"39623752663112484341451587580\", 10);\n\n    mpz_tdiv_q(w, one, x);\n    gmp_printf(\"%Zd\\n\", w);\n\n}\n```\noutputs 1568892406419848332919986945754866320479099155002496784035 instead of the correct 1568892403497558507879962225846103176600476845510570267609.\n\nCC:  @fredrik-johansson wbhart @nexttime\n\nKeywords: mpir\n\nBranch/Commit: f780291ccb0363c69411dfe723de795f2c75093b\n\nReviewer: Jeroen Demeyer\n\nAuthor: Clemens Heuberger\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19280\n\n",
    "closed_at": "2015-10-16T08:22:23Z",
    "created_at": "2015-09-24T15:57:57Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "MPIR gives incorrect result on 32-bit machines",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19280",
    "user": "https://github.com/cheuberg"
}
```
In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting 32 bit machines was described.

```
 #include "mpir.h"

int main()
{

    mpz_t one, x, w;
    mpz_init(one);
    mpz_init(x);
    mpz_init(w);
    mpz_set_str(one, "62165404551223330269422781018352605012557018849668464680057997111644937126566671941632", 10);
    mpz_set_str(x, "39623752663112484341451587580", 10);

    mpz_tdiv_q(w, one, x);
    gmp_printf("%Zd\n", w);

}
```
outputs 1568892406419848332919986945754866320479099155002496784035 instead of the correct 1568892403497558507879962225846103176600476845510570267609.

CC:  @fredrik-johansson wbhart @nexttime

Keywords: mpir

Branch/Commit: f780291ccb0363c69411dfe723de795f2c75093b

Reviewer: Jeroen Demeyer

Author: Clemens Heuberger

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19280





---

archive/issue_comments_344752.json:
```json
{
    "body": "<a id='comment:1'></a>I'll try to implement the patch proposed in #18546, but compilation on my 32 bit platform is slow ...",
    "created_at": "2015-09-24T15:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344752",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:1'></a>I'll try to implement the patch proposed in #18546, but compilation on my 32 bit platform is slow ...



---

archive/issue_comments_344753.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cheuberg/mpir-bug\"",
    "created_at": "2015-09-24T17:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344753",
    "user": "https://github.com/cheuberg"
}
```

Changing branch from "" to "u/cheuberg/mpir-bug"



---

archive/issue_comments_344754.json:
```json
{
    "body": "Changing commit from \"\" to \"b5049f672d39e857cded703259322be0bb99817f\"",
    "created_at": "2015-09-24T17:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344754",
    "user": "https://github.com/cheuberg"
}
```

Changing commit from "" to "b5049f672d39e857cded703259322be0bb99817f"



---

archive/issue_comments_344755.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-24T17:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344755",
    "user": "https://github.com/cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_344756.json:
```json
{
    "body": "Changing author from \"\" to \"Clemens Heuberger\"",
    "created_at": "2015-09-24T17:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344756",
    "user": "https://github.com/cheuberg"
}
```

Changing author from "" to "Clemens Heuberger"



---

archive/issue_comments_344757.json:
```json
{
    "body": "<a id='comment:3'></a>Here is a patch that adds a test to mpir's test suite and then patches all `gmp-mparam.h` files for the `x86` architecture as proposed in [#18546](http://trac.sagemath.org/ticket/18546#comment:23).\n\nI hope that one day, the problem will be solved in mpir and we can remove these patches.\n\nFor testing, you might want to first check out commit f1b4dff and run `sage -i -f -c mpir` (or `sage -p -c mpir` in more recent versions) to see the test failing on x86. Then checking out this branch fully, the problem should disappear.\n\n---\nNew commits:",
    "created_at": "2015-09-24T17:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344757",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:3'></a>Here is a patch that adds a test to mpir's test suite and then patches all `gmp-mparam.h` files for the `x86` architecture as proposed in [#18546](http://trac.sagemath.org/ticket/18546#comment:23).

I hope that one day, the problem will be solved in mpir and we can remove these patches.

For testing, you might want to first check out commit f1b4dff and run `sage -i -f -c mpir` (or `sage -p -c mpir` in more recent versions) to see the test failing on x86. Then checking out this branch fully, the problem should disappear.

---
New commits:



---

archive/issue_comments_344758.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-25T07:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344759.json:
```json
{
    "body": "Changing commit from \"b5049f672d39e857cded703259322be0bb99817f\" to \"0d48fb57205cb16d58380c9b022c39eb354c3a58\"",
    "created_at": "2015-09-25T07:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b5049f672d39e857cded703259322be0bb99817f" to "0d48fb57205cb16d58380c9b022c39eb354c3a58"



---

archive/issue_comments_344760.json:
```json
{
    "body": "<a id='comment:5'></a>Instead of patching all those tuning files, why not just\n\n```diff\ndiff -ru mpir-2.7.0/gmp-impl.h mpir-2.7.0-fixed/gmp-impl.h\n--- mpir-2.7.0/gmp-impl.h       2015-06-10 23:02:35.000000000 +0200\n+++ mpir-2.7.0-fixed/gmp-impl.h 2015-09-29 17:04:17.746919331 +0200\n@@ -2040,11 +2040,11 @@\n #endif\n \n #ifndef SB_DIVAPPR_Q_SMALL_THRESHOLD\n-#define SB_DIVAPPR_Q_SMALL_THRESHOLD 11\n+#define SB_DIVAPPR_Q_SMALL_THRESHOLD 0\n #endif\n \n #ifndef SB_DIV_QR_SMALL_THRESHOLD\n-#define SB_DIV_QR_SMALL_THRESHOLD 11\n+#define SB_DIV_QR_SMALL_THRESHOLD 0\n #endif\n \n #ifndef DC_DIVAPPR_Q_THRESHOLD\n```",
    "created_at": "2015-09-29T15:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344760",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Instead of patching all those tuning files, why not just

```diff
diff -ru mpir-2.7.0/gmp-impl.h mpir-2.7.0-fixed/gmp-impl.h
--- mpir-2.7.0/gmp-impl.h       2015-06-10 23:02:35.000000000 +0200
+++ mpir-2.7.0-fixed/gmp-impl.h 2015-09-29 17:04:17.746919331 +0200
@@ -2040,11 +2040,11 @@
 #endif
 
 #ifndef SB_DIVAPPR_Q_SMALL_THRESHOLD
-#define SB_DIVAPPR_Q_SMALL_THRESHOLD 11
+#define SB_DIVAPPR_Q_SMALL_THRESHOLD 0
 #endif
 
 #ifndef SB_DIV_QR_SMALL_THRESHOLD
-#define SB_DIV_QR_SMALL_THRESHOLD 11
+#define SB_DIV_QR_SMALL_THRESHOLD 0
 #endif
 
 #ifndef DC_DIVAPPR_Q_THRESHOLD
```



---

archive/issue_comments_344761.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 jdemeyer]:\n> Instead of patching all those tuning files, why not just\n> \n> ```\n> #!diff\n> diff -ru mpir-2.7.0/gmp-impl.h mpir-2.7.0-fixed/gmp-impl.h\n> --- mpir-2.7.0/gmp-impl.h       2015-06-10 23:02:35.000000000 +0200\n> +++ mpir-2.7.0-fixed/gmp-impl.h 2015-09-29 17:04:17.746919331 +0200\n> @@ -2040,11 +2040,11 @@\n>  #endif\n>  \n>  #ifndef SB_DIVAPPR_Q_SMALL_THRESHOLD\n> -#define SB_DIVAPPR_Q_SMALL_THRESHOLD 11\n> +#define SB_DIVAPPR_Q_SMALL_THRESHOLD 0\n>  #endif\n>  \n>  #ifndef SB_DIV_QR_SMALL_THRESHOLD\n> -#define SB_DIV_QR_SMALL_THRESHOLD 11\n> +#define SB_DIV_QR_SMALL_THRESHOLD 0\n>  #endif\n>  \n>  #ifndef DC_DIVAPPR_Q_THRESHOLD\n> ```\n\nAre we sure that we want to change the parameter on *all* architectures?",
    "created_at": "2015-09-29T16:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344761",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:6'></a>Replying to [comment:5 jdemeyer]:
> Instead of patching all those tuning files, why not just
> 
> ```
> #!diff
> diff -ru mpir-2.7.0/gmp-impl.h mpir-2.7.0-fixed/gmp-impl.h
> --- mpir-2.7.0/gmp-impl.h       2015-06-10 23:02:35.000000000 +0200
> +++ mpir-2.7.0-fixed/gmp-impl.h 2015-09-29 17:04:17.746919331 +0200
> @@ -2040,11 +2040,11 @@
>  #endif
>  
>  #ifndef SB_DIVAPPR_Q_SMALL_THRESHOLD
> -#define SB_DIVAPPR_Q_SMALL_THRESHOLD 11
> +#define SB_DIVAPPR_Q_SMALL_THRESHOLD 0
>  #endif
>  
>  #ifndef SB_DIV_QR_SMALL_THRESHOLD
> -#define SB_DIV_QR_SMALL_THRESHOLD 11
> +#define SB_DIV_QR_SMALL_THRESHOLD 0
>  #endif
>  
>  #ifndef DC_DIVAPPR_Q_THRESHOLD
> ```

Are we sure that we want to change the parameter on *all* architectures?



---

archive/issue_comments_344762.json:
```json
{
    "body": "<a id='comment:7'></a>You could easily guard the default threshold to be chosen with in addition `__i386__` (or some GMP/MPIR equivalent).",
    "created_at": "2015-09-29T16:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344762",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>You could easily guard the default threshold to be chosen with in addition `__i386__` (or some GMP/MPIR equivalent).



---

archive/issue_comments_344763.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 leif]:\n> You could easily guard the default threshold to be chosen with in addition `__i386__` (or some GMP/MPIR equivalent).\n\n\nCould you help me finding the GMP/MPIR equivalent? Thanks.",
    "created_at": "2015-09-29T16:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344763",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:8'></a>Replying to [comment:7 leif]:
> You could easily guard the default threshold to be chosen with in addition `__i386__` (or some GMP/MPIR equivalent).


Could you help me finding the GMP/MPIR equivalent? Thanks.



---

archive/issue_comments_344764.json:
```json
{
    "body": "<a id='comment:9'></a>Not ad hoc, otherwise I would have been more precise... ;-)\n\nFWIW, `__i386__` is slightly *compiler*-dependent, so would suffice for our purpose (i.e., GCC).",
    "created_at": "2015-09-29T16:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344764",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>Not ad hoc, otherwise I would have been more precise... ;-)

FWIW, `__i386__` is slightly *compiler*-dependent, so would suffice for our purpose (i.e., GCC).



---

archive/issue_comments_344765.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 leif]:\n> Not ad hoc, otherwise I would have been more precise... ;-)\n> \n> FWIW, `__i386__` is slightly *compiler*-dependent, so would suffice for our purpose (i.e., GCC).\n\n\nSince most of the architecture-specific stuff is managed via different files and symlinks to them created by `configure`, there's no straight-forward \"MPIR equivalent\".\n\nWe could use `defined(__i386__) || defined(__i386)` (the latter is used by at least M$), and probably to be triple-safe also check whether `GMP_LIMB_BITS` is really 32 (I vaguely remember *some*<sup>TM</sup> ill compiler used to define *both* `__i386__` *and* `__x86_64__` on x86_64, but I'm not sure).\n\nI don't think it really matters as long as our fix works for the architectures supported by Sage, as we're not going to submit the patch upstream.",
    "created_at": "2015-09-29T17:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344765",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>Replying to [comment:9 leif]:
> Not ad hoc, otherwise I would have been more precise... ;-)
> 
> FWIW, `__i386__` is slightly *compiler*-dependent, so would suffice for our purpose (i.e., GCC).


Since most of the architecture-specific stuff is managed via different files and symlinks to them created by `configure`, there's no straight-forward "MPIR equivalent".

We could use `defined(__i386__) || defined(__i386)` (the latter is used by at least M$), and probably to be triple-safe also check whether `GMP_LIMB_BITS` is really 32 (I vaguely remember *some*<sup>TM</sup> ill compiler used to define *both* `__i386__` *and* `__x86_64__` on x86_64, but I'm not sure).

I don't think it really matters as long as our fix works for the architectures supported by Sage, as we're not going to submit the patch upstream.



---

archive/issue_comments_344766.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:6 cheuberg]:\n> Are we sure that we want to change the parameter on *all* architectures?\n\nAre you sure that you **don't** want to change the parameter on *all* architectures? Why do you think that this bug affects *only* i386?",
    "created_at": "2015-09-30T06:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344766",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:6 cheuberg]:
> Are we sure that we want to change the parameter on *all* architectures?

Are you sure that you **don't** want to change the parameter on *all* architectures? Why do you think that this bug affects *only* i386?



---

archive/issue_comments_344767.json:
```json
{
    "body": "<a id='comment:12'></a>I don't know anything about it, I just followed the recommendation for a \"temporary workaround\" by William Hart made in #18546.\n\nThe particular problem caught by chance in #18546 was present only on i386.",
    "created_at": "2015-09-30T06:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344767",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:12'></a>I don't know anything about it, I just followed the recommendation for a "temporary workaround" by William Hart made in #18546.

The particular problem caught by chance in #18546 was present only on i386.



---

archive/issue_comments_344768.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 cheuberg]:\n> I don't know anything about it, I just followed the recommendation for a \"temporary workaround\" by William Hart made in #18546.\n\nExactly, and I saw no indication at all in William Hart's comments that this bug happens only on i386. His post talks about \"32 bit machines\" in general.\n\nI like simple solutions, so I would just apply the workaround in all cases. If you want to, you could only apply it on 32 bit systems.",
    "created_at": "2015-09-30T06:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344768",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:12 cheuberg]:
> I don't know anything about it, I just followed the recommendation for a "temporary workaround" by William Hart made in #18546.

Exactly, and I saw no indication at all in William Hart's comments that this bug happens only on i386. His post talks about "32 bit machines" in general.

I like simple solutions, so I would just apply the workaround in all cases. If you want to, you could only apply it on 32 bit systems.



---

archive/issue_comments_344769.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 jdemeyer]:\n> Replying to [comment:12 cheuberg]:\n> > I don't know anything about it, I just followed the recommendation for a \"temporary workaround\" by William Hart made in #18546.\n\n> Exactly, and I saw no indication at all in William Hart's comments that this bug happens only on i386. His post talks about \"32 bit machines\" in general.\n\nCan you reproduce it on moufang, say?\n\n\n\n\n> I like simple solutions, so I would just apply the workaround in all cases.\n\n\nThen you might also want to change the ticket's title... B)",
    "created_at": "2015-09-30T08:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344769",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>Replying to [comment:13 jdemeyer]:
> Replying to [comment:12 cheuberg]:
> > I don't know anything about it, I just followed the recommendation for a "temporary workaround" by William Hart made in #18546.

> Exactly, and I saw no indication at all in William Hart's comments that this bug happens only on i386. His post talks about "32 bit machines" in general.

Can you reproduce it on moufang, say?




> I like simple solutions, so I would just apply the workaround in all cases.


Then you might also want to change the ticket's title... B)



---

archive/issue_comments_344770.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting i386 was described.\n+In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting 32 bit machines was described.\n \n ```\n  #include \"mpir.h\"\n``````\n",
    "created_at": "2015-09-30T08:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344770",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting i386 was described.
+In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting 32 bit machines was described.
 
 ```
  #include "mpir.h"
``````




---

archive/issue_comments_344771.json:
```json
{
    "body": "<a id='comment:16'></a>The example in the description itself has a bug. ;-)\n\nEither use\n\n```C\ngmp_printf(\"%Zd / %Zd = %Zd\\n\", one, x, w);\n```\nor remove `one` and `x`.",
    "created_at": "2015-09-30T13:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344771",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>The example in the description itself has a bug. ;-)

Either use

```C
gmp_printf("%Zd / %Zd = %Zd\n", one, x, w);
```
or remove `one` and `x`.



---

archive/issue_comments_344772.json:
```json
{
    "body": "<a id='comment:17'></a>Upstream answered about [comment:5]:\n> Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that.",
    "created_at": "2015-09-30T20:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344772",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Upstream answered about [comment:5]:
> Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that.



---

archive/issue_comments_344773.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-30T20:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344773",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_344774.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 jdemeyer]:\n> Upstream answered about [comment:5]:\n> > Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that. \n\n\nMeaning what?  `#undef` and re`#define` unconditionally instead?  (Only) if `GMP_LIMB_BITS==32`?",
    "created_at": "2015-09-30T21:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344774",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>Replying to [comment:17 jdemeyer]:
> Upstream answered about [comment:5]:
> > Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that. 


Meaning what?  `#undef` and re`#define` unconditionally instead?  (Only) if `GMP_LIMB_BITS==32`?



---

archive/issue_comments_344775.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 leif]:\n> Replying to [comment:17 jdemeyer]:\n> > Upstream answered about [comment:5]:\n> > > Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that. \n\n\nIt's about the *default* value, so no `#undef` needed. Just apply [comment:5].",
    "created_at": "2015-10-01T06:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344775",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Replying to [comment:18 leif]:
> Replying to [comment:17 jdemeyer]:
> > Upstream answered about [comment:5]:
> > > Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that. 


It's about the *default* value, so no `#undef` needed. Just apply [comment:5].



---

archive/issue_comments_344776.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-02T16:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344777.json:
```json
{
    "body": "Changing commit from \"0d48fb57205cb16d58380c9b022c39eb354c3a58\" to \"f780291ccb0363c69411dfe723de795f2c75093b\"",
    "created_at": "2015-10-02T16:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0d48fb57205cb16d58380c9b022c39eb354c3a58" to "f780291ccb0363c69411dfe723de795f2c75093b"



---

archive/issue_comments_344778.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:19 jdemeyer]:\n> Replying to [comment:18 leif]:\n> > Replying to [comment:17 jdemeyer]:\n> > > Upstream answered about [comment:5]:\n> > > > Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that. \n\n> \n> It's about the *default* value, so no `#undef` needed. Just apply [comment:5].\n\n\nDone. Thank you for your enquiries and comments.",
    "created_at": "2015-10-02T17:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344778",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:21'></a>Replying to [comment:19 jdemeyer]:
> Replying to [comment:18 leif]:
> > Replying to [comment:17 jdemeyer]:
> > > Upstream answered about [comment:5]:
> > > > Changing the default value to 0 for those two values is probably a reasonable thing to do. Please do that. 

> 
> It's about the *default* value, so no `#undef` needed. Just apply [comment:5].


Done. Thank you for your enquiries and comments.



---

archive/issue_comments_344779.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-02T17:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344779",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_344780.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n+In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting 32 bit machines was described.\n \n+```\n+ #include \"mpir.h\"\n+\n+int main()\n+{\n+\n+    mpz_t one, x, w;\n+    mpz_init(one);\n+    mpz_init(x);\n+    mpz_init(w);\n+    mpz_set_str(one, \"62165404551223330269422781018352605012557018849668464680057997111644937126566671941632\", 10);\n+    mpz_set_str(x, \"39623752663112484341451587580\", 10);\n+\n+    mpz_tdiv_q(w, one, x);\n+    gmp_printf(\"%Zd\\n\", w);\n+\n+}\n+```\n+outputs 1568892406419848332919986945754866320479099155002496784035 instead of the correct 1568892403497558507879962225846103176600476845510570267609.\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-10-02T17:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344780",
    "user": "https://github.com/cheuberg"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,24 @@
+In [#18546](http://trac.sagemath.org/ticket/18546#comment:21), a bug in mpir only affecting 32 bit machines was described.
 
+```
+ #include "mpir.h"
+
+int main()
+{
+
+    mpz_t one, x, w;
+    mpz_init(one);
+    mpz_init(x);
+    mpz_init(w);
+    mpz_set_str(one, "62165404551223330269422781018352605012557018849668464680057997111644937126566671941632", 10);
+    mpz_set_str(x, "39623752663112484341451587580", 10);
+
+    mpz_tdiv_q(w, one, x);
+    gmp_printf("%Zd\n", w);
+
+}
+```
+outputs 1568892406419848332919986945754866320479099155002496784035 instead of the correct 1568892403497558507879962225846103176600476845510570267609.
 
 Comment: 1
 
``````




---

archive/issue_comments_344781.json:
```json
{
    "body": "<a id='comment:23'></a>I am going to test this + arb on a 32-bit machine.",
    "created_at": "2015-10-15T08:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344781",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>I am going to test this + arb on a 32-bit machine.



---

archive/issue_comments_344782.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-10-15T08:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344782",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_events_053432.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-10-15T08:35:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19280#event-53432"
}
```



---

archive/issue_comments_344783.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-15T13:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344783",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_344784.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2015-10-15T13:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344784",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to critical.



---

archive/issue_events_053433.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-16T08:22:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19280#event-53433"
}
```



---

archive/issue_comments_344785.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-16T08:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344785",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_344786.json:
```json
{
    "body": "Changing branch from \"u/cheuberg/mpir-bug\" to \"f780291ccb0363c69411dfe723de795f2c75093b\"",
    "created_at": "2015-10-16T08:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19280#issuecomment-344786",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/cheuberg/mpir-bug" to "f780291ccb0363c69411dfe723de795f2c75093b"
