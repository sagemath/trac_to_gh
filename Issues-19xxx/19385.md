# Issue 19385: Refactor DiGraph.__init__

archive/issues_019148.json:
```json
{
    "body": "CC:  borassi @dcoudert @dimpase @videlec simonking\n\nAs was done earlier with #19381, this branch strips some code out of digraph.py and stores it in `graph_input.py`.\n\nFortunately, most of `graph_input.py` can be reused for digraphs, so that's a net decrease in code volume in general.\n\nNathann\n\nP.S.: I cannot believe all that this code does in order to guess what the user meants when he provides bad/incomplete/crazy input.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19385\n\n",
    "closed_at": "2015-10-14T21:03:51Z",
    "created_at": "2015-10-10T14:07:49Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Refactor DiGraph.__init__",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19385",
    "user": "https://github.com/nathanncohen"
}
```
CC:  borassi @dcoudert @dimpase @videlec simonking

As was done earlier with #19381, this branch strips some code out of digraph.py and stores it in `graph_input.py`.

Fortunately, most of `graph_input.py` can be reused for digraphs, so that's a net decrease in code volume in general.

Nathann

P.S.: I cannot believe all that this code does in order to guess what the user meants when he provides bad/incomplete/crazy input.

Issue created by migration from https://trac.sagemath.org/ticket/19385





---

archive/issue_comments_262466.json:
```json
{
    "body": "Simon: sorry to disturb, but I think I will need your help for this branch. All doctests pass in graph/ except for a test in `DiGraph.path_semigroup` that I absolutely do not understand `:-/`\n\nHere is a trace, though it will appear soon on the patchbot (and I expect other related doctests to fail in combinat/).\n\nNathann\n\n```\nFile \"digraph.py\", line 2671, in sage.graphs.digraph.DiGraph.path_semigroup\nFailed example:\n    F = Q.path_semigroup(); F\nException raised:\n...\n      File \"sage/misc/cachefunc.pyx\", line 563, in genexpr (build/cythonized/sage/misc/cachefunc.c:2439)\n        return tuple(_cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 561, in sage.misc.cachefunc._cache_key (build/cythonized/sage/misc/cachefunc.c:2644)\n        o = o._cache_key()\n      File \"sage/structure/sage_object.pyx\", line 410, in sage.structure.sage_object.SageObject._cache_key (build/cythonized/sage/structure/sage_object.c:2918)\n        raise TypeError(\"{} is not hashable and does not implement _cache_key()\".format(type(self)))\n    TypeError: <class 'sage.graphs.digraph.DiGraph'> is not hashable and does not implement _cache_key()\n**********************************************************************\n```\n\n---\nLast 10 new commits:",
    "created_at": "2015-10-10T14:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262466",
    "user": "https://github.com/nathanncohen"
}
```

Simon: sorry to disturb, but I think I will need your help for this branch. All doctests pass in graph/ except for a test in `DiGraph.path_semigroup` that I absolutely do not understand `:-/`

Here is a trace, though it will appear soon on the patchbot (and I expect other related doctests to fail in combinat/).

Nathann

```
File "digraph.py", line 2671, in sage.graphs.digraph.DiGraph.path_semigroup
Failed example:
    F = Q.path_semigroup(); F
Exception raised:
...
      File "sage/misc/cachefunc.pyx", line 563, in genexpr (build/cythonized/sage/misc/cachefunc.c:2439)
        return tuple(_cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 561, in sage.misc.cachefunc._cache_key (build/cythonized/sage/misc/cachefunc.c:2644)
        o = o._cache_key()
      File "sage/structure/sage_object.pyx", line 410, in sage.structure.sage_object.SageObject._cache_key (build/cythonized/sage/structure/sage_object.c:2918)
        raise TypeError("{} is not hashable and does not implement _cache_key()".format(type(self)))
    TypeError: <class 'sage.graphs.digraph.DiGraph'> is not hashable and does not implement _cache_key()
**********************************************************************
```

---
Last 10 new commits:



---

archive/issue_comments_262467.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-10T14:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262467",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_262468.json:
```json
{
    "body": "Replying to [comment:1 ncohen]:\n> {{{\n> File \"digraph.py\", line 2671, in sage.graphs.digraph.DiGraph.path_semigroup\n> Failed example:\n>     F = Q.path_semigroup(); F\n> Exception raised:\n> ...\n>       File \"sage/misc/cachefunc.pyx\", line 563, in genexpr (build/cythonized/sage/misc/cachefunc.c:2439)\n>         return tuple(_cache_key(item) for item in o)\n>       File \"sage/misc/cachefunc.pyx\", line 561, in sage.misc.cachefunc._cache_key (build/cythonized/sage/misc/cachefunc.c:2644)\n>         o = o._cache_key()\n>       File \"sage/structure/sage_object.pyx\", line 410, in sage.structure.sage_object.SageObject._cache_key (build/cythonized/sage/structure/sage_object.c:2918)\n>         raise TypeError(\"{} is not hashable and does not implement _cache_key()\".format(type(self)))\n>     TypeError: <class 'sage.graphs.digraph.DiGraph'> is not hashable and does not implement _cache_key()\n> **********************************************************************\n> }}}\n\n\nI'll have a look. Obviously, we should either use an immutable version of a digraph, or (something which seems to be new) implement _cache_key.",
    "created_at": "2015-10-10T14:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262468",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:1 ncohen]:
> {{{
> File "digraph.py", line 2671, in sage.graphs.digraph.DiGraph.path_semigroup
> Failed example:
>     F = Q.path_semigroup(); F
> Exception raised:
> ...
>       File "sage/misc/cachefunc.pyx", line 563, in genexpr (build/cythonized/sage/misc/cachefunc.c:2439)
>         return tuple(_cache_key(item) for item in o)
>       File "sage/misc/cachefunc.pyx", line 561, in sage.misc.cachefunc._cache_key (build/cythonized/sage/misc/cachefunc.c:2644)
>         o = o._cache_key()
>       File "sage/structure/sage_object.pyx", line 410, in sage.structure.sage_object.SageObject._cache_key (build/cythonized/sage/structure/sage_object.c:2918)
>         raise TypeError("{} is not hashable and does not implement _cache_key()".format(type(self)))
>     TypeError: <class 'sage.graphs.digraph.DiGraph'> is not hashable and does not implement _cache_key()
> **********************************************************************
> }}}


I'll have a look. Obviously, we should either use an immutable version of a digraph, or (something which seems to be new) implement _cache_key.



---

archive/issue_comments_262469.json:
```json
{
    "body": "> I'll have a look. Obviously, we should either use an immutable version of a digraph, or (something which seems to be new) implement _cache_key.\n\n\nI tried to make `Q` immutable but the result was the same. And anyway, this branch shouldn't have any effect on that `:-/`\n\nNathann",
    "created_at": "2015-10-10T14:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262469",
    "user": "https://github.com/nathanncohen"
}
```

> I'll have a look. Obviously, we should either use an immutable version of a digraph, or (something which seems to be new) implement _cache_key.


I tried to make `Q` immutable but the result was the same. And anyway, this branch shouldn't have any effect on that `:-/`

Nathann



---

archive/issue_comments_262470.json:
```json
{
    "body": "Somehow you're breaking this behavior:\n\n```\nQ = Q.copy(immutable=True, weighted=True)\n```\nand the result is a mutable digraph.",
    "created_at": "2015-10-10T15:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262470",
    "user": "https://github.com/tscrim"
}
```

Somehow you're breaking this behavior:

```
Q = Q.copy(immutable=True, weighted=True)
```
and the result is a mutable digraph.



---

archive/issue_comments_262471.json:
```json
{
    "body": "```\nsage: hash(Q.copy(immutable=True))\n8019503473919971649\nsage: hash(Q.copy(immutable=True, weighted=True))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-dab47b1641ed> in <module>()\n----> 1 hash(Q.copy(immutable=True, weighted=True))\n\n/home/travis/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/home/travis/sage/src/build/cythonized/sage/misc/cachefunc.c:14346)()\n   2213         if self.cache is None:\n   2214             f = self.f\n-> 2215             self.cache = f(self._instance)\n   2216         return self.cache\n   2217 \n\n/home/travis/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __hash__(self)\n    576             if self.allows_multiple_edges():\n    577                 from collections import Counter\n--> 578                 edge_items = Counter(edge_items).items()\n    579             return hash((frozenset(self.vertex_iterator()),\n    580                          self._weighted,\n\n/home/travis/sage/local/lib/python/collections.pyc in __init__(self, iterable, **kwds)\n    451         '''\n    452         super(Counter, self).__init__()\n--> 453         self.update(iterable, **kwds)\n    454 \n    455     def __missing__(self, key):\n\n/home/travis/sage/local/lib/python/collections.pyc in update(self, iterable, **kwds)\n    533                 self_get = self.get\n    534                 for elem in iterable:\n--> 535                     self[elem] = self_get(elem, 0) + 1\n    536         if kwds:\n    537             self.update(kwds)\n\nTypeError: unhashable type: 'list'\n```",
    "created_at": "2015-10-10T15:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262471",
    "user": "https://github.com/tscrim"
}
```

```
sage: hash(Q.copy(immutable=True))
8019503473919971649
sage: hash(Q.copy(immutable=True, weighted=True))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-dab47b1641ed> in <module>()
----> 1 hash(Q.copy(immutable=True, weighted=True))

/home/travis/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/home/travis/sage/src/build/cythonized/sage/misc/cachefunc.c:14346)()
   2213         if self.cache is None:
   2214             f = self.f
-> 2215             self.cache = f(self._instance)
   2216         return self.cache
   2217 

/home/travis/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __hash__(self)
    576             if self.allows_multiple_edges():
    577                 from collections import Counter
--> 578                 edge_items = Counter(edge_items).items()
    579             return hash((frozenset(self.vertex_iterator()),
    580                          self._weighted,

/home/travis/sage/local/lib/python/collections.pyc in __init__(self, iterable, **kwds)
    451         '''
    452         super(Counter, self).__init__()
--> 453         self.update(iterable, **kwds)
    454 
    455     def __missing__(self, key):

/home/travis/sage/local/lib/python/collections.pyc in update(self, iterable, **kwds)
    533                 self_get = self.get
    534                 for elem in iterable:
--> 535                     self[elem] = self_get(elem, 0) + 1
    536         if kwds:
    537             self.update(kwds)

TypeError: unhashable type: 'list'
```



---

archive/issue_comments_262472.json:
```json
{
    "body": "Oh. Great, thanks !!\n\nNathann",
    "created_at": "2015-10-10T15:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262472",
    "user": "https://github.com/nathanncohen"
}
```

Oh. Great, thanks !!

Nathann



---

archive/issue_comments_262473.json:
```json
{
    "body": "Working it down a little more. With this branch:\n\n```\nsage: Q = DiGraph({1:{2:['a','c']}, 2:{3:['b']}}, immutable=True, weighted=True)\nsage: Q.weighted()\nTrue\nsage: hash(Q)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-15-9389487dfecf> in <module>()\n----> 1 hash(Q)\n\n/home/travis/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/home/travis/sage/src/build/cythonized/sage/misc/cachefunc.c:14346)()\n   2213         if self.cache is None:\n   2214             f = self.f\n-> 2215             self.cache = f(self._instance)\n   2216         return self.cache\n   2217 \n\n/home/travis/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __hash__(self)\n    579             return hash((frozenset(self.vertex_iterator()),\n    580                          self._weighted,\n--> 581                          frozenset(edge_items)))\n    582         raise TypeError(\"This graph is mutable, and thus not hashable. \"\n    583                         \"Create an immutable copy by `g.copy(immutable=True)`\")\n\nTypeError: unhashable type: 'list'\n```",
    "created_at": "2015-10-10T15:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262473",
    "user": "https://github.com/tscrim"
}
```

Working it down a little more. With this branch:

```
sage: Q = DiGraph({1:{2:['a','c']}, 2:{3:['b']}}, immutable=True, weighted=True)
sage: Q.weighted()
True
sage: hash(Q)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-15-9389487dfecf> in <module>()
----> 1 hash(Q)

/home/travis/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/home/travis/sage/src/build/cythonized/sage/misc/cachefunc.c:14346)()
   2213         if self.cache is None:
   2214             f = self.f
-> 2215             self.cache = f(self._instance)
   2216         return self.cache
   2217 

/home/travis/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in __hash__(self)
    579             return hash((frozenset(self.vertex_iterator()),
    580                          self._weighted,
--> 581                          frozenset(edge_items)))
    582         raise TypeError("This graph is mutable, and thus not hashable. "
    583                         "Create an immutable copy by `g.copy(immutable=True)`")

TypeError: unhashable type: 'list'
```



---

archive/issue_comments_262474.json:
```json
{
    "body": "However this seems to work for normal graphs:\n\n```\nsage: Q = Graph({1:{2:['a','c']}, 2:{3:['b']}}, immutable=True, weighted=True)\nsage: hash(Q)\n2304336980638771825\n```",
    "created_at": "2015-10-10T15:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262474",
    "user": "https://github.com/tscrim"
}
```

However this seems to work for normal graphs:

```
sage: Q = Graph({1:{2:['a','c']}, 2:{3:['b']}}, immutable=True, weighted=True)
sage: hash(Q)
2304336980638771825
```



---

archive/issue_comments_262475.json:
```json
{
    "body": "Yeah yeah the problem is very simple: instead of creating several edges labelled 'a','b','c' it creates one edge with a list as a label. Which is not hashable.\n\nNathann",
    "created_at": "2015-10-10T15:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262475",
    "user": "https://github.com/nathanncohen"
}
```

Yeah yeah the problem is very simple: instead of creating several edges labelled 'a','b','c' it creates one edge with a list as a label. Which is not hashable.

Nathann



---

archive/issue_comments_262476.json:
```json
{
    "body": "I hate multiple edges, and I hate labels. Dozens of lines of copy/paste to handle stupid combinations of cases that nobody uses.",
    "created_at": "2015-10-10T15:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262476",
    "user": "https://github.com/nathanncohen"
}
```

I hate multiple edges, and I hate labels. Dozens of lines of copy/paste to handle stupid combinations of cases that nobody uses.



---

archive/issue_comments_262477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-10T15:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262478.json:
```json
{
    "body": "Fixed. Thanks for your help `T_T`\n\nNathann",
    "created_at": "2015-10-10T15:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262478",
    "user": "https://github.com/nathanncohen"
}
```

Fixed. Thanks for your help `T_T`

Nathann



---

archive/issue_comments_262479.json:
```json
{
    "body": "This LGTM except for this change:\n\n```diff\n-            sage: G = DiGraph(M,sparse=True); G\n+            sage: G = DiGraph(M,sparse=True,weighted=True); G\n```\nI'm worried that this change of behavior of how you handle weighted graphs could break other people's code. Unfortunately I can't comment on the correctness of either behavior, but it might have been a \"feature\" that others were using.",
    "created_at": "2015-10-10T16:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262479",
    "user": "https://github.com/tscrim"
}
```

This LGTM except for this change:

```diff
-            sage: G = DiGraph(M,sparse=True); G
+            sage: G = DiGraph(M,sparse=True,weighted=True); G
```
I'm worried that this change of behavior of how you handle weighted graphs could break other people's code. Unfortunately I can't comment on the correctness of either behavior, but it might have been a "feature" that others were using.



---

archive/issue_comments_262480.json:
```json
{
    "body": "> I'm worried that this change of behavior of how you handle weighted graphs could break other people's code. Unfortunately I can't comment on the correctness of either behavior, but it might have been a \"feature\" that others were using.\n\n\nIf you build a graph from a matrix in which all weights are 1 it is not considered as weighted. If any weight is different from 1 then it is considered to be weighted.\n\nTo me, this looks like a dangerous behaviour.\n\nNathann",
    "created_at": "2015-10-10T16:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262480",
    "user": "https://github.com/nathanncohen"
}
```

> I'm worried that this change of behavior of how you handle weighted graphs could break other people's code. Unfortunately I can't comment on the correctness of either behavior, but it might have been a "feature" that others were using.


If you build a graph from a matrix in which all weights are 1 it is not considered as weighted. If any weight is different from 1 then it is considered to be weighted.

To me, this looks like a dangerous behaviour.

Nathann



---

archive/issue_comments_262481.json:
```json
{
    "body": "Do you insist on my adding a heuristic which you admit you do not use, which will set this unreliable behaviour to what it was? This way everybody will be able to create weighted graphs without knowing exactly how, and have bugs once in a while when all weights happen to be one.\n\nIt just takes one line, and it will be dedicated.\n\nNathann",
    "created_at": "2015-10-10T16:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262481",
    "user": "https://github.com/nathanncohen"
}
```

Do you insist on my adding a heuristic which you admit you do not use, which will set this unreliable behaviour to what it was? This way everybody will be able to create weighted graphs without knowing exactly how, and have bugs once in a while when all weights happen to be one.

It just takes one line, and it will be dedicated.

Nathann



---

archive/issue_comments_262482.json:
```json
{
    "body": "Of course, if the matrix has weights different from +1-1 BUT the graph is considered to have multiple edges, then those weights will be considered as multiple edges.\n\nThis constructor is full of corner cases like that. Where we try to guess what exactly the user did not know he wanted.\n\nHalf of the code sets flags depending on the values of others. And I am sick of trying to analyse corner-cases where you are really not sure of what should happen.\n\nNathann",
    "created_at": "2015-10-10T16:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262482",
    "user": "https://github.com/nathanncohen"
}
```

Of course, if the matrix has weights different from +1-1 BUT the graph is considered to have multiple edges, then those weights will be considered as multiple edges.

This constructor is full of corner cases like that. Where we try to guess what exactly the user did not know he wanted.

Half of the code sets flags depending on the values of others. And I am sick of trying to analyse corner-cases where you are really not sure of what should happen.

Nathann



---

archive/issue_comments_262483.json:
```json
{
    "body": "I don't even know what the default behaviour is when neither weighted nor mutiple edges is specified, and if the matrix has weights different from +1/-1. Will it be multiple edges? Will it be weights? *suspense*\n\n```\nsage: Graph(2*graphs.PetersenGraph().adjacency_matrix())\nMulti-graph on 10 vertices\n```\n\nWouhou ! It's multiple edges.\n\nNathann",
    "created_at": "2015-10-10T16:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262483",
    "user": "https://github.com/nathanncohen"
}
```

I don't even know what the default behaviour is when neither weighted nor mutiple edges is specified, and if the matrix has weights different from +1/-1. Will it be multiple edges? Will it be weights? *suspense*

```
sage: Graph(2*graphs.PetersenGraph().adjacency_matrix())
Multi-graph on 10 vertices
```

Wouhou ! It's multiple edges.

Nathann



---

archive/issue_comments_262484.json:
```json
{
    "body": "Of course, if now some of the weights is not integer, then what will it be ?...\n\n```\nsage: Graph(0.5*graphs.PetersenGraph().adjacency_matrix())\nGraph on 10 vertices\nsage: Graph(0.5*graphs.PetersenGraph().adjacency_matrix()).weighted()\nTrue\n```\n\nWeighted !!!!\n\nNathann",
    "created_at": "2015-10-10T16:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262484",
    "user": "https://github.com/nathanncohen"
}
```

Of course, if now some of the weights is not integer, then what will it be ?...

```
sage: Graph(0.5*graphs.PetersenGraph().adjacency_matrix())
Graph on 10 vertices
sage: Graph(0.5*graphs.PetersenGraph().adjacency_matrix()).weighted()
True
```

Weighted !!!!

Nathann



---

archive/issue_comments_262485.json:
```json
{
    "body": "So please, help me and let us drop those unsufferable behaviour that makes this code 90% bullshit trying to figure out some sensible interpretation for the many kind of garbage that it accepts.",
    "created_at": "2015-10-10T16:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262485",
    "user": "https://github.com/nathanncohen"
}
```

So please, help me and let us drop those unsufferable behaviour that makes this code 90% bullshit trying to figure out some sensible interpretation for the many kind of garbage that it accepts.



---

archive/issue_comments_262486.json:
```json
{
    "body": "If you are willing to help whoever posts to sage-devel asking why their weighted graph code no longers works, than you can set a positive review to this.",
    "created_at": "2015-10-10T16:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262486",
    "user": "https://github.com/tscrim"
}
```

If you are willing to help whoever posts to sage-devel asking why their weighted graph code no longers works, than you can set a positive review to this.



---

archive/issue_comments_262487.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> I hate multiple edges, and I hate labels. Dozens of lines of copy/paste to handle stupid combinations of cases that nobody uses.\n\n\nI do use multiple edges, loops and labels.",
    "created_at": "2015-10-10T19:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262487",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:10 ncohen]:
> I hate multiple edges, and I hate labels. Dozens of lines of copy/paste to handle stupid combinations of cases that nobody uses.


I do use multiple edges, loops and labels.



---

archive/issue_comments_262488.json:
```json
{
    "body": "I believe explicit is better than implicit. And it induces a very bad gut feeling when `c*G` for a graph G returns a weighted graph or a multi-graph depending on whether c is integer or rational.",
    "created_at": "2015-10-10T19:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262488",
    "user": "https://github.com/simon-king-jena"
}
```

I believe explicit is better than implicit. And it induces a very bad gut feeling when `c*G` for a graph G returns a weighted graph or a multi-graph depending on whether c is integer or rational.



---

archive/issue_comments_262489.json:
```json
{
    "body": "> I believe explicit is better than implicit. And it induces a very bad gut feeling when `c*G` for a graph G returns a weighted graph or a multi-graph depending on whether c is integer or rational.\n\n\n+1 here. Not only it drives me mad, but the code has to deal with all that and decide it (and God it is ugly), and of course this comes at the cost of over-analysing the input, which takes time.\n\nNathann",
    "created_at": "2015-10-10T22:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262489",
    "user": "https://github.com/nathanncohen"
}
```

> I believe explicit is better than implicit. And it induces a very bad gut feeling when `c*G` for a graph G returns a weighted graph or a multi-graph depending on whether c is integer or rational.


+1 here. Not only it drives me mad, but the code has to deal with all that and decide it (and God it is ugly), and of course this comes at the cost of over-analysing the input, which takes time.

Nathann



---

archive/issue_comments_262490.json:
```json
{
    "body": "> If you are willing to help whoever posts to sage-devel asking why their weighted graph code no longers works, than you can set a positive review to this.\n\n\nGladly. Anyway, I prefer to explain why people have to be explicit in what they want rather than explain the 10 different combinations of parameters that [will/will not] yield what they expect.\n\nThank you.\n\nNathann",
    "created_at": "2015-10-10T22:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262490",
    "user": "https://github.com/nathanncohen"
}
```

> If you are willing to help whoever posts to sage-devel asking why their weighted graph code no longers works, than you can set a positive review to this.


Gladly. Anyway, I prefer to explain why people have to be explicit in what they want rather than explain the 10 different combinations of parameters that [will/will not] yield what they expect.

Thank you.

Nathann



---

archive/issue_comments_262491.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-10T22:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262491",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_262492.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-10-13T12:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262492",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_262493.json:
```json
{
    "body": "Documentation doesn't build as is evident from the patchbot log",
    "created_at": "2015-10-13T12:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262493",
    "user": "https://github.com/vbraun"
}
```

Documentation doesn't build as is evident from the patchbot log



---

archive/issue_comments_262494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-13T12:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262495.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-13T12:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262496.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-10-13T12:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262496",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_262497.json:
```json
{
    "body": "Sorry `:-/`",
    "created_at": "2015-10-13T12:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262497",
    "user": "https://github.com/nathanncohen"
}
```

Sorry `:-/`



---

archive/issue_comments_262498.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-14T21:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19385#issuecomment-262498",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053604.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-14T21:03:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19385",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19385#event-53604"
}
```
