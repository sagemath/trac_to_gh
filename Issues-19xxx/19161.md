# Issue 19161: LatticePoset: faster is_complemented()

archive/issues_018924.json:
```json
{
    "assignees": [],
    "body": "This patch makes `is_complemented()` much faster. Basically it does not compute every complement of every element, just what is needed. I.e. if `2` is a complement of `1`, it does not check if `3` and `1` are also complements; and if `4` has no complements, it returns `False` without searching complements for `5`, `6` and so on.\n\nLet `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time for both of them reduces below one second.\n\nMaybe this could be optimized further, as join and meet are commutative. However, now it is already quite fast.\n\nCC:  @sagetrac-mlapointe @nadialafreniere\n\nBranch/Commit: **[a9b0d3f](https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd)**\n\nReviewer: **Nadia Lafreni\u00e8re**\n\nAuthor: **Nathann Cohen, Jori M\u00e4ntysalo**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19161_\n\n",
    "closed_at": "2015-09-09T22:14:56Z",
    "created_at": "2015-09-08T07:56:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "LatticePoset: faster is_complemented()",
    "type": "issue",
    "updated_at": "2015-09-09T22:14:56Z",
    "url": "https://github.com/sagemath/sage/issues/19161",
    "user": "https://github.com/jm58660"
}
```
This patch makes `is_complemented()` much faster. Basically it does not compute every complement of every element, just what is needed. I.e. if `2` is a complement of `1`, it does not check if `3` and `1` are also complements; and if `4` has no complements, it returns `False` without searching complements for `5`, `6` and so on.

Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time for both of them reduces below one second.

Maybe this could be optimized further, as join and meet are commutative. However, now it is already quite fast.

CC:  @sagetrac-mlapointe @nadialafreniere

Branch/Commit: **[a9b0d3f](https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd)**

Reviewer: **Nadia Lafrenière**

Author: **Nathann Cohen, Jori Mäntysalo**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/19161_





---

archive/issue_events_272006.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-08T07:56:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272006"
}
```



---

archive/issue_events_272007.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-08T07:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272007"
}
```



---

archive/issue_events_272008.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-08T07:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272008"
}
```



---

archive/issue_events_272009.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-08T07:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272009"
}
```



---

archive/issue_comments_271153.json:
```json
{
    "body": "Branch: **[u/jmantysalo/faster_is_complemented](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster_is_complemented)**",
    "created_at": "2015-09-08T07:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271153",
    "user": "https://github.com/jm58660"
}
```

Branch: **[u/jmantysalo/faster_is_complemented](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster_is_complemented)**



---

archive/issue_events_272010.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-08T07:58:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272010"
}
```



---

archive/issue_comments_271154.json:
```json
{
    "body": "Commit: **[bf8fdd5](https://github.com/sagemath/sagetrac-mirror/commit/bf8fdd5dd0702a6158691183ac6a3351461a650e)**",
    "created_at": "2015-09-08T07:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271154",
    "user": "https://github.com/jm58660"
}
```

Commit: **[bf8fdd5](https://github.com/sagemath/sagetrac-mirror/commit/bf8fdd5dd0702a6158691183ac6a3351461a650e)**



---

archive/issue_comments_271155.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nNathann, want an easy review?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf8fdd5dd0702a6158691183ac6a3351461a650e\">bf8fdd5</a></td><td><code>Faster is_complemented() for lattices.</code></td></tr></table>\n",
    "created_at": "2015-09-08T07:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271155",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:2" align="right">comment:2</div>

Nathann, want an easy review?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf8fdd5dd0702a6158691183ac6a3351461a650e">bf8fdd5</a></td><td><code>Faster is_complemented() for lattices.</code></td></tr></table>




---

archive/issue_comments_271156.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n As playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.\n \n-Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `L.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.\n+Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.\n``````\n",
    "created_at": "2015-09-08T09:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271156",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 As playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.
 
-Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `L.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.
+Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.
``````




---

archive/issue_comments_271157.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHMmmm... The speedup is cool, but the algorithm is slightly less clear. Is it slower to do it like that:\n\n```\nfrom itertools import izip\nfor row1,row2 in izip(meet,join):\n    for c1,c2 in izip(row1,row2):\n        if c1==0 and c2==n-1:\n            break\n    else:\n        retun False\nreturn True\n```\n\nSorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`\n\nNathann",
    "created_at": "2015-09-08T09:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271157",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">comment:4</div>

HMmmm... The speedup is cool, but the algorithm is slightly less clear. Is it slower to do it like that:

```
from itertools import izip
for row1,row2 in izip(meet,join):
    for c1,c2 in izip(row1,row2):
        if c1==0 and c2==n-1:
            break
    else:
        retun False
return True
```

Sorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`

Nathann



---

archive/issue_comments_271158.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@nathanncohen](#comment:4):\n\n>Is it slower to do it like that:\n\nIt depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.\n \n> Sorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`\n\nUse professionals. Eat at MacDonalds.",
    "created_at": "2015-09-08T10:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271158",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@nathanncohen](#comment:4):

>Is it slower to do it like that:

It depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.
 
> Sorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`

Use professionals. Eat at MacDonalds.



---

archive/issue_comments_271159.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> It depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.\n\nHmmmm.. I do not know what to think of it. It \"may\" answer \"no\" slightly faster, but then iterators are not free. Sigh. That would be straightforward in C with real arrays, and not those unreliable matrices `-_-`\n\n> Use professionals. Eat at MacDonalds.\n\nAhah.\n\nNathann",
    "created_at": "2015-09-08T10:49:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271159",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:6" align="right">comment:6</div>

> It depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.

Hmmmm.. I do not know what to think of it. It "may" answer "no" slightly faster, but then iterators are not free. Sigh. That would be straightforward in C with real arrays, and not those unreliable matrices `-_-`

> Use professionals. Eat at MacDonalds.

Ahah.

Nathann



---

archive/issue_comments_271160.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThat was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.\n\n(About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))",
    "created_at": "2015-09-08T10:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271160",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:7" align="right">comment:7</div>

That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.

(About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))



---

archive/issue_comments_271161.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n> That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.\n\nBoth are matrix based, so I do not know what you have in mind. Keep the one that is the fastest, and if it is the current one then consider it in `positive_review`, provided that tests pass (the patchbot still silent).\n\n> (About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))\n\nShe has a different opinion about mining? Amazing.\n\nIn the case at hand (if I may say), I do not see the need to generalize to cooking in general. Let me just hope that I will not make the same mistake, with the same hand, tomorrow morning.\n\nNathann",
    "created_at": "2015-09-08T11:03:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271161",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:8" align="right">comment:8</div>

> That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.

Both are matrix based, so I do not know what you have in mind. Keep the one that is the fastest, and if it is the current one then consider it in `positive_review`, provided that tests pass (the patchbot still silent).

> (About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))

She has a different opinion about mining? Amazing.

In the case at hand (if I may say), I do not see the need to generalize to cooking in general. Let me just hope that I will not make the same mistake, with the same hand, tomorrow morning.

Nathann



---

archive/issue_comments_271162.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8853ed85f14cb8b3d2a9046d31505bf81223c7d\">b8853ed</a></td><td><code>Faster algorithm, thanks to Nathann Cohen.</code></td></tr></table>\n",
    "created_at": "2015-09-08T11:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271162",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8853ed85f14cb8b3d2a9046d31505bf81223c7d">b8853ed</a></td><td><code>Faster algorithm, thanks to Nathann Cohen.</code></td></tr></table>




---

archive/issue_comments_271163.json:
```json
{
    "body": "Changed commit from **[bf8fdd5](https://github.com/sagemath/sagetrac-mirror/commit/bf8fdd5dd0702a6158691183ac6a3351461a650e)** to **[b8853ed](https://github.com/sagemath/sagetrac-mirror/commit/b8853ed85f14cb8b3d2a9046d31505bf81223c7d)**",
    "created_at": "2015-09-08T11:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271163",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bf8fdd5](https://github.com/sagemath/sagetrac-mirror/commit/bf8fdd5dd0702a6158691183ac6a3351461a650e)** to **[b8853ed](https://github.com/sagemath/sagetrac-mirror/commit/b8853ed85f14cb8b3d2a9046d31505bf81223c7d)**



---

archive/issue_comments_271164.json:
```json
{
    "body": "Changed author from **Jori M\u00e4ntysalo** to **Nathann Cohen, Jori M\u00e4ntysalo**",
    "created_at": "2015-09-08T11:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271164",
    "user": "https://github.com/jm58660"
}
```

Changed author from **Jori Mäntysalo** to **Nathann Cohen, Jori Mäntysalo**



---

archive/issue_comments_271165.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n As playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.\n \n-Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.\n+Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time for both of them reduces below one second.\n``````\n",
    "created_at": "2015-09-08T11:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271165",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 As playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.
 
-Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.
+Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time for both of them reduces below one second.
``````




---

archive/issue_comments_271166.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@nathanncohen](#comment:8):\n\n> > That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.\n\n> \n> Both are matrix based, so I do not know what you have in mind.\n\nI meant that mine was \"matrix-based\", i.e. the speed come from speed of matrix operations.\n\n> Keep the one that is the fastest\n\nYour implementation is faster.\n\nM\u00e9lodie, can you review this? The code is now mostly from Nathann, but if it does not work, it might also be that I have made a mistake.\n\n> She has a different opinion about mining? Amazing.\n\n`;=)`",
    "created_at": "2015-09-08T11:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271166",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@nathanncohen](#comment:8):

> > That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.

> 
> Both are matrix based, so I do not know what you have in mind.

I meant that mine was "matrix-based", i.e. the speed come from speed of matrix operations.

> Keep the one that is the fastest

Your implementation is faster.

Mélodie, can you review this? The code is now mostly from Nathann, but if it does not work, it might also be that I have made a mistake.

> She has a different opinion about mining? Amazing.

`;=)`



---

archive/issue_comments_271167.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHMmmmm... Factor 6?... `O_o`\n\nWeird, weird... `:-/`",
    "created_at": "2015-09-08T11:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271167",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:11" align="right">comment:11</div>

HMmmmm... Factor 6?... `O_o`

Weird, weird... `:-/`



---

archive/issue_comments_271168.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nathanncohen](#comment:11):\n> HMmmmm... Factor 6?... `O_o`\n> \n> Weird, weird... `:-/`\n\nNot really. Original code checks ALL element pairs. My code takes one element, and kind of check it against all other elements, and stops when an element has no complement. Your code jumps to next element when it founds a complement and return `False` if it found an element without the complement.\n\nEven your code is not optimal, because meet and join are commutative operations. But it may be slower to optimize that, because the code would be more complicated.\n\nIn any case, this is now quite fast and IMO ready for review.",
    "created_at": "2015-09-08T12:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271168",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nathanncohen](#comment:11):
> HMmmmm... Factor 6?... `O_o`
> 
> Weird, weird... `:-/`

Not really. Original code checks ALL element pairs. My code takes one element, and kind of check it against all other elements, and stops when an element has no complement. Your code jumps to next element when it founds a complement and return `False` if it found an element without the complement.

Even your code is not optimal, because meet and join are commutative operations. But it may be slower to optimize that, because the code would be more complicated.

In any case, this is now quite fast and IMO ready for review.



---

archive/issue_comments_271169.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHi Jori,\nI'm M\u00e9lodie's colleague and I reviewed the graph documentation ticket with her.\n\nAbout your new ticket, now.\n\n```diff\n+        n = self.cardinality()-1\n+        for row1,row2 in izip(mt, jn):\n+            for c1,c2 in izip(row1,row2):\n+                if c1==0 and c2==n:\n```\n\nYou should respect the Python / Sage conventions and add spaces before and after binary operators of the lowest priority : `self.cardinality() - 1`, `c1  == 0`, etc. This includes equality and assignments.\n\nAs well, there should be spaces after every coma sign:  `row1, row2`, `c1, c2`, `izip(row1, row2)`. For more info on these conventions, see http://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style",
    "created_at": "2015-09-08T17:47:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271169",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:13" align="right">comment:13</div>

Hi Jori,
I'm Mélodie's colleague and I reviewed the graph documentation ticket with her.

About your new ticket, now.

```diff
+        n = self.cardinality()-1
+        for row1,row2 in izip(mt, jn):
+            for c1,c2 in izip(row1,row2):
+                if c1==0 and c2==n:
```

You should respect the Python / Sage conventions and add spaces before and after binary operators of the lowest priority : `self.cardinality() - 1`, `c1  == 0`, etc. This includes equality and assignments.

As well, there should be spaces after every coma sign:  `row1, row2`, `c1, c2`, `izip(row1, row2)`. For more info on these conventions, see http://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style



---

archive/issue_events_272011.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2015-09-08T17:47:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272011"
}
```



---

archive/issue_events_272012.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2015-09-08T17:47:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272012"
}
```



---

archive/issue_comments_271170.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec6f18a7290517028a45f216f4b6ae90a3157f7c\">ec6f18a</a></td><td><code>Reviewers comment about Python conventions.</code></td></tr></table>\n",
    "created_at": "2015-09-08T18:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271170",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec6f18a7290517028a45f216f4b6ae90a3157f7c">ec6f18a</a></td><td><code>Reviewers comment about Python conventions.</code></td></tr></table>




---

archive/issue_comments_271171.json:
```json
{
    "body": "Changed commit from **[b8853ed](https://github.com/sagemath/sagetrac-mirror/commit/b8853ed85f14cb8b3d2a9046d31505bf81223c7d)** to **[ec6f18a](https://github.com/sagemath/sagetrac-mirror/commit/ec6f18a7290517028a45f216f4b6ae90a3157f7c)**",
    "created_at": "2015-09-08T18:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271171",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b8853ed](https://github.com/sagemath/sagetrac-mirror/commit/b8853ed85f14cb8b3d2a9046d31505bf81223c7d)** to **[ec6f18a](https://github.com/sagemath/sagetrac-mirror/commit/ec6f18a7290517028a45f216f4b6ae90a3157f7c)**



---

archive/issue_comments_271172.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@nadialafreniere](#comment:13):\n\n> I'm M\u00e9lodie's colleague and I reviewed the graph documentation ticket with her.\n\nThanks! I did the changes.",
    "created_at": "2015-09-08T18:39:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271172",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@nadialafreniere](#comment:13):

> I'm Mélodie's colleague and I reviewed the graph documentation ticket with her.

Thanks! I did the changes.



---

archive/issue_events_272013.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-08T18:39:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272013"
}
```



---

archive/issue_events_272014.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-08T18:39:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272014"
}
```



---

archive/issue_comments_271173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-As playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.\n+This patch makes `is_complemented()` much faster. Basically it does not compute every complement of every element, just what is needed. I.e. if `2` is a complement of `1`, it does not check if `3` and `1` are also complements; and if `4` has no complements, it returns `False` without searching complements for `5`, `6` and so on.\n \n Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time for both of them reduces below one second.\n+\n+Maybe this could be optimized further, as join and meet are commutative. However, now it is already quite fast.\n``````\n",
    "created_at": "2015-09-08T18:39:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271173",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-As playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.
+This patch makes `is_complemented()` much faster. Basically it does not compute every complement of every element, just what is needed. I.e. if `2` is a complement of `1`, it does not check if `3` and `1` are also complements; and if `4` has no complements, it returns `False` without searching complements for `5`, `6` and so on.
 
 Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `B10.is_complemented()`. With the patch the time for both of them reduces below one second.
+
+Maybe this could be optimized further, as join and meet are commutative. However, now it is already quite fast.
``````




---

archive/issue_comments_271174.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nMost of the things look fine. One last thing: I know you didn't touch to this, but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.\n\n```\nsage: L = LatticePoset({0:[1,2,3],1:[4],2:[4],3:[4]})\n```\n\n```\nsage: L = LatticePoset({0:[1,2],1:[3],2:[3],3:[4]})\n```\n\nshould look like\n\n```\nsage: L = LatticePoset({0:[1, 2, 3], 1:[4], 2:[4], 3:[4]})\n```",
    "created_at": "2015-09-08T21:36:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271174",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:16" align="right">comment:16</div>

Most of the things look fine. One last thing: I know you didn't touch to this, but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.

```
sage: L = LatticePoset({0:[1,2,3],1:[4],2:[4],3:[4]})
```

```
sage: L = LatticePoset({0:[1,2],1:[3],2:[3],3:[4]})
```

should look like

```
sage: L = LatticePoset({0:[1, 2, 3], 1:[4], 2:[4], 3:[4]})
```



---

archive/issue_events_272015.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2015-09-08T21:37:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272015"
}
```



---

archive/issue_events_272016.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2015-09-08T21:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272016"
}
```



---

archive/issue_comments_271175.json:
```json
{
    "body": "Changed commit from **[ec6f18a](https://github.com/sagemath/sagetrac-mirror/commit/ec6f18a7290517028a45f216f4b6ae90a3157f7c)** to **[a9b0d3f](https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd)**",
    "created_at": "2015-09-09T04:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271175",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ec6f18a](https://github.com/sagemath/sagetrac-mirror/commit/ec6f18a7290517028a45f216f4b6ae90a3157f7c)** to **[a9b0d3f](https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd)**



---

archive/issue_comments_271176.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd\">a9b0d3f</a></td><td><code>Spaces to examples of is_complemented_lattice().</code></td></tr></table>\n",
    "created_at": "2015-09-09T04:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271176",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd">a9b0d3f</a></td><td><code>Spaces to examples of is_complemented_lattice().</code></td></tr></table>




---

archive/issue_events_272017.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-09T04:04:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272017"
}
```



---

archive/issue_events_272018.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2015-09-09T04:04:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272018"
}
```



---

archive/issue_comments_271177.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@nadialafreniere](#comment:16):\n\n> - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.\n\nDone this.",
    "created_at": "2015-09-09T04:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271177",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@nadialafreniere](#comment:16):

> - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.

Done this.



---

archive/issue_comments_271178.json:
```json
{
    "body": "Reviewer: **Nadia Lafreni\u00e8re**",
    "created_at": "2015-09-09T05:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271178",
    "user": "https://github.com/nadialafreniere"
}
```

Reviewer: **Nadia Lafrenière**



---

archive/issue_events_272019.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2015-09-09T05:24:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272019"
}
```



---

archive/issue_events_272020.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2015-09-09T05:24:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272020"
}
```



---

archive/issue_comments_271179.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jm58660](#comment:19):\n> Replying to [@nadialafreniere](#comment:16):\n> \n> > - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.\n\n> \n> Done this.\n\n\n\nEverything looks fine!",
    "created_at": "2015-09-09T05:25:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271179",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jm58660](#comment:19):
> Replying to [@nadialafreniere](#comment:16):
> 
> > - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.

> 
> Done this.



Everything looks fine!



---

archive/issue_events_272021.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-09T22:14:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272021"
}
```



---

archive/issue_events_272022.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "11fca5a3045ef39d2dd634ef2e5084e5dd6fd6d1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-09-09T22:14:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19161#event-272022"
}
```



---

archive/issue_comments_271180.json:
```json
{
    "body": "Changed branch from **[u/jmantysalo/faster_is_complemented](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster_is_complemented)** to **[a9b0d3f](https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd)**",
    "created_at": "2015-09-09T22:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19161#issuecomment-271180",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jmantysalo/faster_is_complemented](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster_is_complemented)** to **[a9b0d3f](https://github.com/sagemath/sagetrac-mirror/commit/a9b0d3fa8f14e195040efc7e5e2623e8e631bedd)**
