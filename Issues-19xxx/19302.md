# Issue 19302: Stopgap for Element.__hash__

archive/issues_019065.json:
```json
{
    "body": "See [comment:72:ticket:19016]. Let us warn the users until this bug gets fixed.\n\nNathann\n\n---\n\nA discussion about this ticket is currently going on at [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/onJoCfuX3Lo).\n\nSee also: #19321, #19331\n\n\nReviewer: Vincent Delecroix\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19302\n\n",
    "closed_at": "2015-10-29T08:53:00Z",
    "created_at": "2015-09-28T18:34:10Z",
    "labels": [
        "component: misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Stopgap for Element.__hash__",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19302",
    "user": "https://github.com/nathanncohen"
}
```
See [comment:72:ticket:19016]. Let us warn the users until this bug gets fixed.

Nathann

---

A discussion about this ticket is currently going on at [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/onJoCfuX3Lo).

See also: #19321, #19331


Reviewer: Vincent Delecroix

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19302





---

archive/issue_comments_278268.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-28T18:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278268",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_278269.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2015-09-28T18:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278269",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_278270.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-09-28T18:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278270",
    "user": "https://github.com/nathanncohen"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_278271.json:
```json
{
    "body": "<a id='comment:3'></a>I am ok with the stopgap. But I would like more consensus from developers. The most problem I have is that it is very intrusive\n\n```\nsage: G = FreeGroup(2)\nsage: x,y = G.gens()\nsage: H = G / [x**2, y**2]\n/opt/sage/src/bin/sage-ipython:1:\n********************************************************************************\nThe __hash__ method of Element is broken. Beware of any\nfunction that relies on it, as it may return wrong results.\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/19302.\n********************************************************************************\n```\nor\n\n```\nsage: p = Polyhedron([(1,1),(2,3),(4,5),(6,7)])\nsage: F = p.faces(2)\n/opt/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:19557:\n********************************************************************************\nThe __hash__ method of Element is broken. Beware of\nany function that relies on it, as it may return wrong results.\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/19302.\n********************************************************************************\n```\n... which means that many people will run into that trouble. But \"annoying\" is better than \"wrong\". This is why I tend to agree with the proposal.\n\nAnother option, would be to move some of the commits from #19016 here (e.g. it would at least avoid the error on polyhedron). At the same time it will decrease the complexity of #19016 which is good. What do you think?\n\nVincent",
    "created_at": "2015-09-28T22:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278271",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>I am ok with the stopgap. But I would like more consensus from developers. The most problem I have is that it is very intrusive

```
sage: G = FreeGroup(2)
sage: x,y = G.gens()
sage: H = G / [x**2, y**2]
/opt/sage/src/bin/sage-ipython:1:
********************************************************************************
The __hash__ method of Element is broken. Beware of any
function that relies on it, as it may return wrong results.
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/19302.
********************************************************************************
```
or

```
sage: p = Polyhedron([(1,1),(2,3),(4,5),(6,7)])
sage: F = p.faces(2)
/opt/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:19557:
********************************************************************************
The __hash__ method of Element is broken. Beware of
any function that relies on it, as it may return wrong results.
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/19302.
********************************************************************************
```
... which means that many people will run into that trouble. But "annoying" is better than "wrong". This is why I tend to agree with the proposal.

Another option, would be to move some of the commits from #19016 here (e.g. it would at least avoid the error on polyhedron). At the same time it will decrease the complexity of #19016 which is good. What do you think?

Vincent



---

archive/issue_comments_278272.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-09-29T00:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_278273.json:
```json
{
    "body": "<a id='comment:5'></a>All right. I backported what I could from #19016. It is just a proposition though.",
    "created_at": "2015-09-29T00:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278273",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>All right. I backported what I could from #19016. It is just a proposition though.



---

archive/issue_comments_278274.json:
```json
{
    "body": "<a id='comment:6'></a>Hello,\n\n> I am ok with the stopgap. But I would like more consensus from developers. The most problem I have is that it is very intrusive\n\n\nWell, it pops out absolutely everywhere because this bug is very very bad, and can generate wrong results absolutely everywhere.\n\n> Another option, would be to move some of the commits from #19016 here (e.g. it would at least avoid the error on polyhedron). At the same time it will decrease the complexity of #19016 which is good. What do you think?\n\n\nI think that it would make 1000x more sense to create a new ticket entitled \"some new hash functions\" (or something) and move your commits there rather than here. Splitting #19016 into subtickets does make sense, but I do not see a reason to merge it with this one.\n\nWhich you can also flag as 'blocker' if this is what you are after?...\n\nNathann",
    "created_at": "2015-09-29T03:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278274",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Hello,

> I am ok with the stopgap. But I would like more consensus from developers. The most problem I have is that it is very intrusive


Well, it pops out absolutely everywhere because this bug is very very bad, and can generate wrong results absolutely everywhere.

> Another option, would be to move some of the commits from #19016 here (e.g. it would at least avoid the error on polyhedron). At the same time it will decrease the complexity of #19016 which is good. What do you think?


I think that it would make 1000x more sense to create a new ticket entitled "some new hash functions" (or something) and move your commits there rather than here. Splitting #19016 into subtickets does make sense, but I do not see a reason to merge it with this one.

Which you can also flag as 'blocker' if this is what you are after?...

Nathann



---

archive/issue_comments_278275.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 ncohen]:\n> Well, it pops out absolutely everywhere because this bug is very very bad, and can generate wrong results absolutely everywhere.\n\n\nNo, it still needs a confluence of circumstances. It only leads to possibly wrong results for elements where elements that are considered equal can have different string representations. That can happen because generators get renamed (an operation that shouldn't be supported in sage) or because elements are not printed in a canonical form (either because such a form isn't attainable or because it's expensive to attain). There aren't that many parents in sage with that property (and we'll probably have to disallow hashing there). It's worth fixing, but you don't have to overstate the impact.",
    "created_at": "2015-09-29T07:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278275",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'></a>Replying to [comment:6 ncohen]:
> Well, it pops out absolutely everywhere because this bug is very very bad, and can generate wrong results absolutely everywhere.


No, it still needs a confluence of circumstances. It only leads to possibly wrong results for elements where elements that are considered equal can have different string representations. That can happen because generators get renamed (an operation that shouldn't be supported in sage) or because elements are not printed in a canonical form (either because such a form isn't attainable or because it's expensive to attain). There aren't that many parents in sage with that property (and we'll probably have to disallow hashing there). It's worth fixing, but you don't have to overstate the impact.



---

archive/issue_comments_278276.json:
```json
{
    "body": "<a id='comment:8'></a>> It's worth fixing, but you don't have to overstate the impact.\n\n\nThis is a very entertaining opinion. I am glad that I do not have to convince you to change it in order to add this stopgap.\n\nNathann",
    "created_at": "2015-09-29T07:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278276",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>> It's worth fixing, but you don't have to overstate the impact.


This is a very entertaining opinion. I am glad that I do not have to convince you to change it in order to add this stopgap.

Nathann



---

archive/issue_comments_278277.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-30T21:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_278278.json:
```json
{
    "body": "<a id='comment:10'></a>Back to where it was. I propose to put #19321 as a dependency. How about that?\n\nVincent",
    "created_at": "2015-09-30T21:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278278",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>Back to where it was. I propose to put #19321 as a dependency. How about that?

Vincent



---

archive/issue_comments_278279.json:
```json
{
    "body": "<a id='comment:11'></a>Vincent: set #19321 to be a blocker if you think that it should be one.\n\nThere is no reason, however, why this one-liner should have a dependency.\n\nNathann",
    "created_at": "2015-10-01T06:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278279",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>Vincent: set #19321 to be a blocker if you think that it should be one.

There is no reason, however, why this one-liner should have a dependency.

Nathann



---

archive/issue_comments_278280.json:
```json
{
    "body": "<a id='comment:12'></a>Shouldn't the stopgap refer to #19016 (i.e. where the real issue is being tracked)",
    "created_at": "2015-10-01T09:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278280",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Shouldn't the stopgap refer to #19016 (i.e. where the real issue is being tracked)



---

archive/issue_comments_278281.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-10-01T09:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_278282.json:
```json
{
    "body": "<a id='comment:14'></a>The exact same issue occurs with `Mod(3,5) == 8`.  Different hashes, compares equal. \n\nhttps://cloud.sagemath.com/projects/4a5f0542-5873-4eed-a85c-a18c706e8bcd/files/support/2015-10-01-081910-hash.sagews",
    "created_at": "2015-10-01T15:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278282",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:14'></a>The exact same issue occurs with `Mod(3,5) == 8`.  Different hashes, compares equal. 

https://cloud.sagemath.com/projects/4a5f0542-5873-4eed-a85c-a18c706e8bcd/files/support/2015-10-01-081910-hash.sagews



---

archive/issue_comments_278283.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 was]:\n> The exact same issue occurs with `Mod(3,5) == 8`.  Different hashes, compares equal. \n\n\nI think the consensus was that this is a different issue: equality isn't transitive *across different parents*, and hence \"equal => equal hash\" cannot hold. However, within a parent we do need to try and keep \"==\" transitive, and we should try to have \"equal => equal hash\". In cases where we cannot do this, we should make elements unhashable. Via the \"_cache_key\" method we can still allow such objects to appear as part of cache keys.\n\nI do think that sage 6.9 could still have this flaw unflagged, but we should really try to fix 6.10 significantly in this respect, and progress has shown this is quite attainable (there probably plenty of other bad hashes around but the \"hash(str(self))\" catchall is definitely a bad offender)\n\nSo I'd say: merge the stopgap right after the 6.9 release to ensure we fix this stuff.",
    "created_at": "2015-10-01T17:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278283",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:15'></a>Replying to [comment:14 was]:
> The exact same issue occurs with `Mod(3,5) == 8`.  Different hashes, compares equal. 


I think the consensus was that this is a different issue: equality isn't transitive *across different parents*, and hence "equal => equal hash" cannot hold. However, within a parent we do need to try and keep "==" transitive, and we should try to have "equal => equal hash". In cases where we cannot do this, we should make elements unhashable. Via the "_cache_key" method we can still allow such objects to appear as part of cache keys.

I do think that sage 6.9 could still have this flaw unflagged, but we should really try to fix 6.10 significantly in this respect, and progress has shown this is quite attainable (there probably plenty of other bad hashes around but the "hash(str(self))" catchall is definitely a bad offender)

So I'd say: merge the stopgap right after the 6.9 release to ensure we fix this stuff.



---

archive/issue_comments_278284.json:
```json
{
    "body": "<a id='comment:16'></a>Another ticket I opened a while ago regarding hashes of objects with the same parent:\n\nhttp://trac.sagemath.org/ticket/15297\n\nI think Nils hits it on the head with regard to not having a default hash (what good is it anyway if you can't reliably use sets containing such objects?), and making some effort to have appropriate hashes within a parent. And I agree that this stopgap is unnecessary, because it has not become a more urgent problem than before.",
    "created_at": "2015-10-01T17:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278284",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:16'></a>Another ticket I opened a while ago regarding hashes of objects with the same parent:

http://trac.sagemath.org/ticket/15297

I think Nils hits it on the head with regard to not having a default hash (what good is it anyway if you can't reliably use sets containing such objects?), and making some effort to have appropriate hashes within a parent. And I agree that this stopgap is unnecessary, because it has not become a more urgent problem than before.



---

archive/issue_comments_278285.json:
```json
{
    "body": "<a id='comment:17'></a>My position with the stopgap is pretty simple: if you know that there is a bug in the software that you develop, a bug that may make the user's code return bad answer, *do you tell the users*?\n\nOf course the bug did not appear yesterday, but today we know it exists.\n\nAnd you don't tell the users? That's irresponsible.\n\n(and, occasionally, contrary to our developer's manual)\n\nNathann",
    "created_at": "2015-10-01T17:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278285",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'></a>My position with the stopgap is pretty simple: if you know that there is a bug in the software that you develop, a bug that may make the user's code return bad answer, *do you tell the users*?

Of course the bug did not appear yesterday, but today we know it exists.

And you don't tell the users? That's irresponsible.

(and, occasionally, contrary to our developer's manual)

Nathann



---

archive/issue_comments_278286.json:
```json
{
    "body": "<a id='comment:18'></a>> And you don't tell the users? That's irresponsible.\n\n\nIt would be irresponsible if trac were secret.  Like the bug trackers that Matlab, Maple, mathematica, and Magma use. \n\nBut I know for a fact that Sage has hundreds (maybe thousands) of bugs.  That doesn't mean that every time you start Sage it should show a big message about that.   \n\nI was the one that came up with the stopgap idea for sage in the first place, so I really like it in most cases. \n\n -- William",
    "created_at": "2015-10-01T17:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278286",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:18'></a>> And you don't tell the users? That's irresponsible.


It would be irresponsible if trac were secret.  Like the bug trackers that Matlab, Maple, mathematica, and Magma use. 

But I know for a fact that Sage has hundreds (maybe thousands) of bugs.  That doesn't mean that every time you start Sage it should show a big message about that.   

I was the one that came up with the stopgap idea for sage in the first place, so I really like it in most cases. 

 -- William



---

archive/issue_comments_278287.json:
```json
{
    "body": "<a id='comment:19'></a>Besides, we *do* tell users:\n\nhttp://doc.sagemath.org/html/en/developer/coding_in_python.html#the-hash-special-method\n\nMaybe not in the most easily accessible place, but I feel like I've been aware of this ever since I started using Sage. I would *like* to have consistent hashes for elements with a common parent, but I know I can't count on it.\n\nAnyway: yes, something should be fixed, but no, I don't think it's urgent enough to print disconcerting warnings that make people think Sage is broken.",
    "created_at": "2015-10-01T18:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278287",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:19'></a>Besides, we *do* tell users:

http://doc.sagemath.org/html/en/developer/coding_in_python.html#the-hash-special-method

Maybe not in the most easily accessible place, but I feel like I've been aware of this ever since I started using Sage. I would *like* to have consistent hashes for elements with a common parent, but I know I can't count on it.

Anyway: yes, something should be fixed, but no, I don't think it's urgent enough to print disconcerting warnings that make people think Sage is broken.



---

archive/issue_comments_278288.json:
```json
{
    "body": "<a id='comment:20'></a>> It would be irresponsible if trac were secret.\n\n\nDo you seriously expect them to come here and figure it out?\n\nOr is the whole point of not having a stopgap to *not have them know* and, thus, not worry?\n\n> But I know for a fact that Sage has hundreds (maybe thousands) of bugs.  That doesn't mean that every time you start Sage it should show a big message about that.   \n\n\nYour code hygiene is a personal taste. All I can say is that this doesn't happen in graphs/, nor in combinat/designs/, nor in the LP code. Seems that we have different expectations.\n\n> I was the one that came up with the stopgap idea for sage in the first place, so I really like it in most cases. \n\n\nTo impress me you will have to enforce the idea when it takes guts to do so.\n\nNathann",
    "created_at": "2015-10-01T18:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278288",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:20'></a>> It would be irresponsible if trac were secret.


Do you seriously expect them to come here and figure it out?

Or is the whole point of not having a stopgap to *not have them know* and, thus, not worry?

> But I know for a fact that Sage has hundreds (maybe thousands) of bugs.  That doesn't mean that every time you start Sage it should show a big message about that.   


Your code hygiene is a personal taste. All I can say is that this doesn't happen in graphs/, nor in combinat/designs/, nor in the LP code. Seems that we have different expectations.

> I was the one that came up with the stopgap idea for sage in the first place, so I really like it in most cases. 


To impress me you will have to enforce the idea when it takes guts to do so.

Nathann



---

archive/issue_comments_278289.json:
```json
{
    "body": "<a id='comment:21'></a>> Besides, we *do* tell users:\n> \n> http://doc.sagemath.org/html/en/developer/coding_in_python.html#the-hash-special-method\n\n\nIt's funny how we have to explain everything in docstrings or users get it wrong, and on the other hand we expect to figure out hash issues by themselves while browsing the developer's manual. Bullshit.\n\n> Maybe not in the most easily accessible place, but I feel like I've been aware of this ever since I started using Sage.\n\n\nYou are a developer. As William for the developers/users ratio.\n\n> Anyway: yes, something should be fixed, but no, I don't think it's urgent enough to print disconcerting warnings that make people think Sage is broken.\n\n\nWTF. Sage *IS* broken. Don't you get it? Having to display a stopgap is a very bad thing, because it worries users, and what we have to do against it is not hide the stopgaps but FIX THE BUGS.\n\nNathann",
    "created_at": "2015-10-01T18:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278289",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:21'></a>> Besides, we *do* tell users:
> 
> http://doc.sagemath.org/html/en/developer/coding_in_python.html#the-hash-special-method


It's funny how we have to explain everything in docstrings or users get it wrong, and on the other hand we expect to figure out hash issues by themselves while browsing the developer's manual. Bullshit.

> Maybe not in the most easily accessible place, but I feel like I've been aware of this ever since I started using Sage.


You are a developer. As William for the developers/users ratio.

> Anyway: yes, something should be fixed, but no, I don't think it's urgent enough to print disconcerting warnings that make people think Sage is broken.


WTF. Sage *IS* broken. Don't you get it? Having to display a stopgap is a very bad thing, because it worries users, and what we have to do against it is not hide the stopgaps but FIX THE BUGS.

Nathann



---

archive/issue_comments_278290.json:
```json
{
    "body": "<a id='comment:22'></a>P.S.: I'm not sure I made my point clear: if you don't like to see a stopgap in Sage the fix is easy: review Vincent's tickets, and help him. That's the only way to deal with this honorably.",
    "created_at": "2015-10-01T18:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278290",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:22'></a>P.S.: I'm not sure I made my point clear: if you don't like to see a stopgap in Sage the fix is easy: review Vincent's tickets, and help him. That's the only way to deal with this honorably.



---

archive/issue_comments_278291.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:20 ncohen]:\n> > I was the one that came up with the stopgap idea for sage in the first place, so I really like it in most cases. \n\n> \n> To impress me you will have to enforce the idea when it takes guts to do so.\n\n\nI could care less about impressing you.\n\nI'm -1 to this stopgap in sage-6.9.  I'm +1 to this being merged at the beginning of sage-6.10 and fixed in sage-6.10.",
    "created_at": "2015-10-01T18:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278291",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:23'></a>Replying to [comment:20 ncohen]:
> > I was the one that came up with the stopgap idea for sage in the first place, so I really like it in most cases. 

> 
> To impress me you will have to enforce the idea when it takes guts to do so.


I could care less about impressing you.

I'm -1 to this stopgap in sage-6.9.  I'm +1 to this being merged at the beginning of sage-6.10 and fixed in sage-6.10.



---

archive/issue_comments_278292.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,13 @@\n See [comment:72:ticket:19016]. Let us warn the users until this bug gets fixed.\n \n Nathann\n+\n+---\n+\n+A discussion about this ticket is currently going on at [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/onJoCfuX3Lo).\n+\n+See also: #19321, #19331\n+\n \n Author: Nathann Cohen\n \n```\n",
    "created_at": "2015-10-02T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278292",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,13 @@
 See [comment:72:ticket:19016]. Let us warn the users until this bug gets fixed.
 
 Nathann
+
+---
+
+A discussion about this ticket is currently going on at [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/onJoCfuX3Lo).
+
+See also: #19321, #19331
+
 
 Author: Nathann Cohen
 
```




---

archive/issue_comments_278293.json:
```json
{
    "body": "<a id='comment:25'></a>Since you want a review from me: -1\n\nWarnings need to be specific. There are lots of elements that have canonical representations, there hashing it is definitely a bit hacky but perfectly valid. \n\nThere is definitely room for improvement, but it skirts a bit the line of design choice with hashes and coercion.\n\nAttach the stopgap to finitely presented group elements if you want, or fix it in sage-6.10.",
    "created_at": "2015-10-02T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278293",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>Since you want a review from me: -1

Warnings need to be specific. There are lots of elements that have canonical representations, there hashing it is definitely a bit hacky but perfectly valid. 

There is definitely room for improvement, but it skirts a bit the line of design choice with hashes and coercion.

Attach the stopgap to finitely presented group elements if you want, or fix it in sage-6.10.



---

archive/issue_events_053452.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-03T11:14:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19302#event-53452"
}
```



---

archive/issue_comments_278294.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:23 was]:\n> I'm +1 to this being merged at the beginning of sage-6.10 and fixed in sage-6.10.  \n\nYou cannot really demand the second part (\"fixed in sage-6.10\"). Basically, at the end of the 6.10 release cycle, you might easily end up in the same situation as now. So any argument to not add the stopgap now is also a valid argument to not add the stopgap in the next release.\n\nI think the logical conclusion (which Volker seems to agree with) is simply to not add this stopgap and close this ticket as wontfix.",
    "created_at": "2015-10-08T16:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278294",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [comment:23 was]:
> I'm +1 to this being merged at the beginning of sage-6.10 and fixed in sage-6.10.  

You cannot really demand the second part ("fixed in sage-6.10"). Basically, at the end of the 6.10 release cycle, you might easily end up in the same situation as now. So any argument to not add the stopgap now is also a valid argument to not add the stopgap in the next release.

I think the logical conclusion (which Volker seems to agree with) is simply to not add this stopgap and close this ticket as wontfix.



---

archive/issue_comments_278295.json:
```json
{
    "body": "<a id='comment:28'></a>> I think the logical conclusion (which Volker seems to agree with) is simply to not add this stopgap and close this ticket as wontfix.\n\n\nGrow a sense of responsibility. You know what lies ahead? We all get used to return wrong results and do not care anymore.\n\nAnd you can throw this piece of code to the junk, for nobody will trust it.\n\nNathann",
    "created_at": "2015-10-08T16:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278295",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:28'></a>> I think the logical conclusion (which Volker seems to agree with) is simply to not add this stopgap and close this ticket as wontfix.


Grow a sense of responsibility. You know what lies ahead? We all get used to return wrong results and do not care anymore.

And you can throw this piece of code to the junk, for nobody will trust it.

Nathann



---

archive/issue_comments_278296.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:27 jdemeyer]:\n> Replying to [comment:23 was]:\n> > I'm +1 to this being merged at the beginning of sage-6.10 and fixed in sage-6.10.  \n\n> You cannot really demand the second part (\"fixed in sage-6.10\"). Basically, at the end of the 6.10 release cycle, you might easily end up in the same situation as now. So any argument to not add the stopgap now is also a valid argument to not add the stopgap in the next release.\n> \n> I think the logical conclusion (which Volker seems to agree with) is simply to not add this stopgap and close this ticket as wontfix.\n\n\n+1\n\nNathann:\n>> Grow a sense of responsibility [...]\n\n\nJust fix the real problem ASAP instead of complaining.",
    "created_at": "2015-10-08T16:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278296",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:29'></a>Replying to [comment:27 jdemeyer]:
> Replying to [comment:23 was]:
> > I'm +1 to this being merged at the beginning of sage-6.10 and fixed in sage-6.10.  

> You cannot really demand the second part ("fixed in sage-6.10"). Basically, at the end of the 6.10 release cycle, you might easily end up in the same situation as now. So any argument to not add the stopgap now is also a valid argument to not add the stopgap in the next release.
> 
> I think the logical conclusion (which Volker seems to agree with) is simply to not add this stopgap and close this ticket as wontfix.


+1

Nathann:
>> Grow a sense of responsibility [...]


Just fix the real problem ASAP instead of complaining.



---

archive/issue_comments_278297.json:
```json
{
    "body": "<a id='comment:30'></a>> Just fix the real problem ASAP instead of complaining.\n\n\nTo quote Jeroen:\n\n> You cannot really demand the second part (\"fixed in sage-6.10\").\n\n\nThe only thing you are doing is setting us on the track to failure by weakening our quality procedures.\n\nNathann",
    "created_at": "2015-10-08T16:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278297",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:30'></a>> Just fix the real problem ASAP instead of complaining.


To quote Jeroen:

> You cannot really demand the second part ("fixed in sage-6.10").


The only thing you are doing is setting us on the track to failure by weakening our quality procedures.

Nathann



---

archive/issue_comments_278298.json:
```json
{
    "body": "<a id='comment:31'></a>+1 to keeping this ticket open (with 6.10 milestone).\n\n-1 to closing it as wontfix.",
    "created_at": "2015-10-08T18:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278298",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>+1 to keeping this ticket open (with 6.10 milestone).

-1 to closing it as wontfix.



---

archive/issue_comments_278299.json:
```json
{
    "body": "<a id='comment:32'></a>Can we just merge this now or merge #19016 now? Otherwise, we're going to be in the same mess coming 6.10, when merging #19016 is bad because of untested consequences.",
    "created_at": "2015-10-17T20:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278299",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:32'></a>Can we just merge this now or merge #19016 now? Otherwise, we're going to be in the same mess coming 6.10, when merging #19016 is bad because of untested consequences.



---

archive/issue_comments_278300.json:
```json
{
    "body": "<a id='comment:33'></a>+1 to merging this now.",
    "created_at": "2015-10-17T20:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278300",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:33'></a>+1 to merging this now.



---

archive/issue_comments_278301.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:32 nbruin]:\n> Otherwise, we're going to be in the same mess coming 6.10\n\n\nI predicted this in [comment:27]\n\nI think that it really makes no sense to merge this ticket *now*. Either you think that the broken hash is serious enough to merit a stopgap, or you think it's not serious enough. There is really no way that it can be a serious problem in Sage 6.10, but not a serious problem in Sage 6.9.",
    "created_at": "2015-10-17T20:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278301",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>Replying to [comment:32 nbruin]:
> Otherwise, we're going to be in the same mess coming 6.10


I predicted this in [comment:27]

I think that it really makes no sense to merge this ticket *now*. Either you think that the broken hash is serious enough to merit a stopgap, or you think it's not serious enough. There is really no way that it can be a serious problem in Sage 6.10, but not a serious problem in Sage 6.9.



---

archive/issue_comments_278302.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 jdemeyer]:\n> I predicted this in [comment:27]\n> \n> I think that it really makes no sense to merge this ticket *now*. Either you think that the broken hash is serious enough to merit a stopgap, or you think it's not serious enough. There is really no way that it can be a serious problem in Sage 6.10, but not a serious problem in Sage 6.9.\n\n\nIt makes procedural sense because then people working on development will have a signal and an incentive to do something about relying on the bad hash. We are currently in a situation where we won't ever catch up, because people are adding new classes depending on the default hash at the same rate as we're trying to fix it (see the recently merged `sage.combinat.colored_permutations`). Those people should get a signal that they shouldn't be depending on that to-be-deprecated hash. The difference is that now we have a good shot at resolving this whole thing before releasing 6.10, whereas this issue received attention too late in the 6.9 cycle for that to be realistic.",
    "created_at": "2015-10-18T01:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278302",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:35'></a>Replying to [comment:34 jdemeyer]:
> I predicted this in [comment:27]
> 
> I think that it really makes no sense to merge this ticket *now*. Either you think that the broken hash is serious enough to merit a stopgap, or you think it's not serious enough. There is really no way that it can be a serious problem in Sage 6.10, but not a serious problem in Sage 6.9.


It makes procedural sense because then people working on development will have a signal and an incentive to do something about relying on the bad hash. We are currently in a situation where we won't ever catch up, because people are adding new classes depending on the default hash at the same rate as we're trying to fix it (see the recently merged `sage.combinat.colored_permutations`). Those people should get a signal that they shouldn't be depending on that to-be-deprecated hash. The difference is that now we have a good shot at resolving this whole thing before releasing 6.10, whereas this issue received attention too late in the 6.9 cycle for that to be realistic.



---

archive/issue_comments_278303.json:
```json
{
    "body": "<a id='comment:36'></a>To celebrate the merger of #19016, which removes the source for this stopgap.",
    "created_at": "2015-10-28T15:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278303",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:36'></a>To celebrate the merger of #19016, which removes the source for this stopgap.



---

archive/issue_events_053453.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-10-28T15:19:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19302#event-53453"
}
```



---

archive/issue_events_053454.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2015-10-28T15:19:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19302#event-53454"
}
```



---

archive/issue_comments_278304.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-28T20:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278304",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_278305.json:
```json
{
    "body": "<a id='comment:37'></a>Yipee!",
    "created_at": "2015-10-28T20:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278305",
    "user": "https://github.com/videlec"
}
```

<a id='comment:37'></a>Yipee!



---

archive/issue_events_053455.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-29T08:53:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19302#event-53455"
}
```



---

archive/issue_comments_278306.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-29T08:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19302",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19302#issuecomment-278306",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
