# Issue 19984: Correctly fix checksums

archive/issues_019747.json:
```json
{
    "body": "Add functionality\n\n```\nsage --package download pari\nsage --package fix-checksum pari\nsage --package fix-checksum   # fix all checksums\n```\nand deprecate `sage-fix-pkg-checksums`.\n\nAlso switch to standard argparse instead of reinventing the argument parsing wheel. And improve test coverage.\n\nBranch/Commit: b1c8a74cab7f121e5f7b26776481d41fd4cb2076\n\nReviewer: Jeroen Demeyer, Dima Pasechnik\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19984\n\n",
    "closed_at": "2016-06-14T07:10:30Z",
    "created_at": "2016-01-30T10:46:34Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Correctly fix checksums",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19984",
    "user": "https://github.com/vbraun"
}
```
Add functionality

```
sage --package download pari
sage --package fix-checksum pari
sage --package fix-checksum   # fix all checksums
```
and deprecate `sage-fix-pkg-checksums`.

Also switch to standard argparse instead of reinventing the argument parsing wheel. And improve test coverage.

Branch/Commit: b1c8a74cab7f121e5f7b26776481d41fd4cb2076

Reviewer: Jeroen Demeyer, Dima Pasechnik

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19984





---

archive/issue_comments_288770.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,11 @@\n+Add functionality\n \n+```\n+sage --package download pari\n+sage --package fix-checksum pari\n+sage --package fix-checksum   # fix all checksums\n+```\n+Also switch to standard argparse instead of reinventing the argument parsing wheel. And improve test coverage.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-01-30T16:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288770",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,11 @@
+Add functionality
 
+```
+sage --package download pari
+sage --package fix-checksum pari
+sage --package fix-checksum   # fix all checksums
+```
+Also switch to standard argparse instead of reinventing the argument parsing wheel. And improve test coverage.
 
 Comment: 1
 
``````




---

archive/issue_comments_288771.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2016-01-30T16:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288771",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_288772.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-30T16:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288772",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_288773.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2016-01-30T16:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288773",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_288774.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2016-01-30T16:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288774",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_288775.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,13 @@\n+Add functionality\n \n+```\n+sage --package download pari\n+sage --package fix-checksum pari\n+sage --package fix-checksum   # fix all checksums\n+```\n+and deprecate `sage-fix-pkg-checksums`.\n+\n+Also switch to standard argparse instead of reinventing the argument parsing wheel. And improve test coverage.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-01-30T16:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288775",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,13 @@
+Add functionality
 
+```
+sage --package download pari
+sage --package fix-checksum pari
+sage --package fix-checksum   # fix all checksums
+```
+and deprecate `sage-fix-pkg-checksums`.
+
+Also switch to standard argparse instead of reinventing the argument parsing wheel. And improve test coverage.
 
 Comment: 1
 
``````




---

archive/issue_comments_288776.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-30T16:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288777.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-30T17:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288778.json:
```json
{
    "body": "<a id='comment:6'></a>wow, `argparse.py` isn't a small file...",
    "created_at": "2016-01-30T17:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288778",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>wow, `argparse.py` isn't a small file...



---

archive/issue_comments_288779.json:
```json
{
    "body": "<a id='comment:7'></a>Making Sage 0.1% bigger vs. writing and maintaining your own parser is an easy choice...",
    "created_at": "2016-01-30T18:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288779",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Making Sage 0.1% bigger vs. writing and maintaining your own parser is an easy choice...



---

archive/issue_comments_288780.json:
```json
{
    "body": "<a id='comment:8'></a>it would be good to know whether it is just a pip call away.",
    "created_at": "2016-01-30T19:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288780",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>it would be good to know whether it is just a pip call away.



---

archive/issue_comments_288781.json:
```json
{
    "body": "<a id='comment:9'></a>It is, but not before we install pip which we download using `sage_bootstrap`",
    "created_at": "2016-01-30T19:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288781",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>It is, but not before we install pip which we download using `sage_bootstrap`



---

archive/issue_comments_288782.json:
```json
{
    "body": "<a id='comment:10'></a>Is there a pressing need to have arg parsing before we have pip available?",
    "created_at": "2016-01-30T20:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288782",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Is there a pressing need to have arg parsing before we have pip available?



---

archive/issue_comments_288783.json:
```json
{
    "body": "<a id='comment:11'></a>I also don't get why we need to have in in sage, as it's standard Python:\n\n```\n$ python\nPython 2.7.6 (default, Jun 22 2015, 17:58:13) \n[GCC 4.8.2] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import argparse\n>>> \n```\n\n(and the same with `$ sage --python`)",
    "created_at": "2016-01-30T20:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288783",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>I also don't get why we need to have in in sage, as it's standard Python:

```
$ python
Python 2.7.6 (default, Jun 22 2015, 17:58:13) 
[GCC 4.8.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import argparse
>>> 
```

(and the same with `$ sage --python`)



---

archive/issue_comments_288784.json:
```json
{
    "body": "<a id='comment:12'></a>* Scripts need to use things like `sage-download-file --print-fastest-mirror`\n* Argparse is new in Python 2.7, but we want to support 2.6+. See also the tox.ini file.",
    "created_at": "2016-01-30T20:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288784",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>* Scripts need to use things like `sage-download-file --print-fastest-mirror`
* Argparse is new in Python 2.7, but we want to support 2.6+. See also the tox.ini file.



---

archive/issue_comments_288785.json:
```json
{
    "body": "<a id='comment:13'></a>Hmm, I presume one doesn't need to fix checksums before Sage's python is up and running.\nI'd rather just rely on built-in argparse of Sage's python.\n\nOr rather rely on system's python having argparse. I cannot imagine people on Python 2.6 who must build Sage from source, but cannot update Python, or at least install argparse.",
    "created_at": "2016-01-30T22:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288785",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>Hmm, I presume one doesn't need to fix checksums before Sage's python is up and running.
I'd rather just rely on built-in argparse of Sage's python.

Or rather rely on system's python having argparse. I cannot imagine people on Python 2.6 who must build Sage from source, but cannot update Python, or at least install argparse.



---

archive/issue_comments_288786.json:
```json
{
    "body": "<a id='comment:14'></a>`sage-download-file` is used for **downloading** packages, which we must do in order to install Python in the first place.\n\nThe fixing checksums is just an extra at this point, but of course its almost the same code as checking  the checksum.\n\nBtw pip itself bundles about 10 required packages because it can't be used to install its own dependencies either.",
    "created_at": "2016-01-31T00:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288786",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>`sage-download-file` is used for **downloading** packages, which we must do in order to install Python in the first place.

The fixing checksums is just an extra at this point, but of course its almost the same code as checking  the checksum.

Btw pip itself bundles about 10 required packages because it can't be used to install its own dependencies either.



---

archive/issue_comments_288787.json:
```json
{
    "body": "<a id='comment:15'></a>PS: OSX had Python 2.6 up until the last version, and good luck installing argparse globally without root.",
    "created_at": "2016-01-31T00:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288787",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>PS: OSX had Python 2.6 up until the last version, and good luck installing argparse globally without root.



---

archive/issue_comments_288788.json:
```json
{
    "body": "<a id='comment:16'></a>Assuming you deprecate that, I think you'll also have to change http://doc.sagemath.org/html/en/developer/packaging.html#checksums and any other related documentation.",
    "created_at": "2016-01-31T02:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288788",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>Assuming you deprecate that, I think you'll also have to change http://doc.sagemath.org/html/en/developer/packaging.html#checksums and any other related documentation.



---

archive/issue_comments_288789.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:15 vbraun]:\n> PS: OSX had Python 2.6 up until the last version, and good luck installing argparse globally without root.\n\n\nI am not worried about OSX users, who of them don't have root?",
    "created_at": "2016-01-31T06:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288789",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Replying to [comment:15 vbraun]:
> PS: OSX had Python 2.6 up until the last version, and good luck installing argparse globally without root.


I am not worried about OSX users, who of them don't have root?



---

archive/issue_comments_288790.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-31T09:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288790",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_288791.json:
```json
{
    "body": "<a id='comment:18'></a>This should work (it used to work with `sage-fix-pkg-checksums`):\n\n```\n$ rm build/pkgs/cliquer/checksums.ini\n$ sage --package fix-checksum cliquer\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-git/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/cmdline.py\", line 241, in run\n    app.fix_checksum(args.package_name)\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/app.py\", line 157, in fix_checksum\n    pkg = update.package\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/updater.py\", line 37, in package\n    self.__package = Package(self.package_name)\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/package.py\", line 46, in __init__\n    self._init_checksum()\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/package.py\", line 203, in _init_checksum\n    with open(checksums_ini, 'rt') as f:\nIOError: [Errno 2] No such file or directory: '/usr/local/src/sage-git/build/pkgs/cliquer/checksums.ini'\n```",
    "created_at": "2016-01-31T09:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288791",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>This should work (it used to work with `sage-fix-pkg-checksums`):

```
$ rm build/pkgs/cliquer/checksums.ini
$ sage --package fix-checksum cliquer
Traceback (most recent call last):
  File "/usr/local/src/sage-git/build/bin/sage-package", line 42, in <module>
    run()
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/cmdline.py", line 241, in run
    app.fix_checksum(args.package_name)
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/app.py", line 157, in fix_checksum
    pkg = update.package
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/updater.py", line 37, in package
    self.__package = Package(self.package_name)
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/package.py", line 46, in __init__
    self._init_checksum()
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/package.py", line 203, in _init_checksum
    with open(checksums_ini, 'rt') as f:
IOError: [Errno 2] No such file or directory: '/usr/local/src/sage-git/build/pkgs/cliquer/checksums.ini'
```



---

archive/issue_comments_288792.json:
```json
{
    "body": "<a id='comment:19'></a>Even this does not work:\n\n```\n$ ./sage --fix-pkg-checksums upstream/cliquer-1.21.tar.gz\nDeprecated #19984, use sage --package fix-checksum instead\nERROR [tarball|__init__:62]: tarball cliquer-1.21.tar.gz is not referenced by any Sage package\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-git/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/cmdline.py\", line 228, in run\n    app.name(args.tarball_filename)\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/app.py\", line 68, in name\n    tarball = Tarball(os.path.basename(tarball_filename))\n  File \"/usr/local/src/sage-git/build/bin/../sage_bootstrap/tarball.py\", line 63, in __init__\n    raise ValueError(error)\nValueError: tarball cliquer-1.21.tar.gz is not referenced by any Sage package\n```",
    "created_at": "2016-01-31T09:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288792",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Even this does not work:

```
$ ./sage --fix-pkg-checksums upstream/cliquer-1.21.tar.gz
Deprecated #19984, use sage --package fix-checksum instead
ERROR [tarball|__init__:62]: tarball cliquer-1.21.tar.gz is not referenced by any Sage package
Traceback (most recent call last):
  File "/usr/local/src/sage-git/build/bin/sage-package", line 42, in <module>
    run()
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/cmdline.py", line 228, in run
    app.name(args.tarball_filename)
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/app.py", line 68, in name
    tarball = Tarball(os.path.basename(tarball_filename))
  File "/usr/local/src/sage-git/build/bin/../sage_bootstrap/tarball.py", line 63, in __init__
    raise ValueError(error)
ValueError: tarball cliquer-1.21.tar.gz is not referenced by any Sage package
```



---

archive/issue_comments_288793.json:
```json
{
    "body": "<a id='comment:20'></a>You need a way to tie tarballs to packages even if `checksums.ini` is not present or contains bogus information.",
    "created_at": "2016-01-31T09:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288793",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>You need a way to tie tarballs to packages even if `checksums.ini` is not present or contains bogus information.



---

archive/issue_comments_288794.json:
```json
{
    "body": "<a id='comment:21'></a>It is a feature that you need `checksums.ini` where the tarball name pattern is specified (the checksums are not needed). This is the only place that unambiguously ties together tarball file names with package names. You can have other heuristics but they can and will break, and you can't build a reliable system on top of sand? Besides, extra filename-based heuristics violate the single source of truth principle.\n\nThat `$ ./sage --fix-pkg-checksums upstream/cliquer-1.21.tar.gz` demonstrates the advantage of this ticket, the new tarball name is `cliquer-1.21.tar.bz2` and if you accidentally enter the wrong extension you now get an error message instead of silently using the wrong tarball.",
    "created_at": "2016-01-31T10:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288794",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>It is a feature that you need `checksums.ini` where the tarball name pattern is specified (the checksums are not needed). This is the only place that unambiguously ties together tarball file names with package names. You can have other heuristics but they can and will break, and you can't build a reliable system on top of sand? Besides, extra filename-based heuristics violate the single source of truth principle.

That `$ ./sage --fix-pkg-checksums upstream/cliquer-1.21.tar.gz` demonstrates the advantage of this ticket, the new tarball name is `cliquer-1.21.tar.bz2` and if you accidentally enter the wrong extension you now get an error message instead of silently using the wrong tarball.



---

archive/issue_comments_288795.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:17 dimpase]:\n> I am not worried about OSX users, who of them don't have root?\n\n\nI know a ton of people in the Oxford Math building that use OSX and do not have root access, for example.",
    "created_at": "2016-01-31T11:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288795",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>Replying to [comment:17 dimpase]:
> I am not worried about OSX users, who of them don't have root?


I know a ton of people in the Oxford Math building that use OSX and do not have root access, for example.



---

archive/issue_comments_288796.json:
```json
{
    "body": "<a id='comment:23'></a>Test comment, ignore",
    "created_at": "2016-01-31T12:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288796",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>Test comment, ignore



---

archive/issue_comments_288797.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 vbraun]:\n> Replying to [comment:17 dimpase]:\n> > I am not worried about OSX users, who of them don't have root?\n\n> \n> I know a ton of people in the Oxford Math building that use OSX and do not have root access, for example.\n\n\nsuch people are already on OSX 10.11, I suppose, as no sysadmin would allow an un-updated host on their network...\n\n(posted using geom as socks_v5 proxy...)",
    "created_at": "2016-02-01T23:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288797",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>Replying to [comment:22 vbraun]:
> Replying to [comment:17 dimpase]:
> > I am not worried about OSX users, who of them don't have root?

> 
> I know a ton of people in the Oxford Math building that use OSX and do not have root access, for example.


such people are already on OSX 10.11, I suppose, as no sysadmin would allow an un-updated host on their network...

(posted using geom as socks_v5 proxy...)



---

archive/issue_comments_288798.json:
```json
{
    "body": "<a id='comment:25'></a>Considering that OSX tends to break stuff every version and that the Math network is heavily firewalled (not even ssh from the outside) I'm not so sure about that.\n\nIn any case, this ticket isn't about removing Python 2.6 support when building Sage. I don't really mind that, but it should be a separate ticket.",
    "created_at": "2016-02-02T00:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288798",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>Considering that OSX tends to break stuff every version and that the Math network is heavily firewalled (not even ssh from the outside) I'm not so sure about that.

In any case, this ticket isn't about removing Python 2.6 support when building Sage. I don't really mind that, but it should be a separate ticket.



---

archive/issue_comments_288799.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-02-07T16:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288799",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_288800.json:
```json
{
    "body": "<a id='comment:27'></a>how are we going to keep  track of the stuff that should be removed once the support for Python 2.6 is removed?",
    "created_at": "2016-02-07T17:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288800",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>how are we going to keep  track of the stuff that should be removed once the support for Python 2.6 is removed?



---

archive/issue_comments_288801.json:
```json
{
    "body": "<a id='comment:28'></a>I created #20023 for that.",
    "created_at": "2016-02-07T18:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288801",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>I created #20023 for that.



---

archive/issue_comments_288802.json:
```json
{
    "body": "<a id='comment:29'></a>I still think that [comment:18] would be an annoying regression. Adding a new package should be as simple as possible. Requiring to manually add `checksums.ini` is an extra burden which didn't exist before.",
    "created_at": "2016-03-01T10:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288802",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>I still think that [comment:18] would be an annoying regression. Adding a new package should be as simple as possible. Requiring to manually add `checksums.ini` is an extra burden which didn't exist before.



---

archive/issue_comments_288803.json:
```json
{
    "body": "<a id='comment:30'></a>Its even more annoying to change existing checksums.ini to different tarballs because of some unwritten nameing rule with .bz2 vs .gz. Not to mention being totally broken for some packages, e.g. python2.\n\nIt would be nice to have an easy way to create a new package, but it shouldn't be mashed into sage-fix-package-checksums. E.g. \n\n```\nsage --package create foo --url=http://path/to/foo.tar.gz\n```\ncould create the package and populate it with template `spkg-install` etc.",
    "created_at": "2016-03-01T11:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288803",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'></a>Its even more annoying to change existing checksums.ini to different tarballs because of some unwritten nameing rule with .bz2 vs .gz. Not to mention being totally broken for some packages, e.g. python2.

It would be nice to have an easy way to create a new package, but it shouldn't be mashed into sage-fix-package-checksums. E.g. 

```
sage --package create foo --url=http://path/to/foo.tar.gz
```
could create the package and populate it with template `spkg-install` etc.



---

archive/issue_comments_288804.json:
```json
{
    "body": "<a id='comment:31'></a>perhaps more pressing issue is that the current assumptions about package archives namings are too rigid. E.g. Normaliz 3.1.0 has archive named\nhttps://www.normaliz.uni-osnabrueck.de/wp-content/uploads/2016/02/Normaliz3.1.0.zip\nwhich unpacks into Normaliz3.1 directory.\n\nI do not know how to handled this without repackaging.\n\nAnother example is nauty 2.6, with archives named nauty26...",
    "created_at": "2016-03-06T08:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288804",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>perhaps more pressing issue is that the current assumptions about package archives namings are too rigid. E.g. Normaliz 3.1.0 has archive named
https://www.normaliz.uni-osnabrueck.de/wp-content/uploads/2016/02/Normaliz3.1.0.zip
which unpacks into Normaliz3.1 directory.

I do not know how to handled this without repackaging.

Another example is nauty 2.6, with archives named nauty26...



---

archive/issue_comments_288805.json:
```json
{
    "body": "<a id='comment:32'></a>Agreed, the totally unnecessary naming restrictions are a pain. But the name handling of old-style spkgs is mashed into the new-style name handling code. And there is no testsuite apart from building all packages. So its hard to improve.",
    "created_at": "2016-03-06T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288805",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:32'></a>Agreed, the totally unnecessary naming restrictions are a pain. But the name handling of old-style spkgs is mashed into the new-style name handling code. And there is no testsuite apart from building all packages. So its hard to improve.



---

archive/issue_comments_288806.json:
```json
{
    "body": "<a id='comment:33'></a>What is preventing this to go forward? I don't know - I don't understand the Jeroen's problem (or don't understand it any more).",
    "created_at": "2016-06-11T14:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288806",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>What is preventing this to go forward? I don't know - I don't understand the Jeroen's problem (or don't understand it any more).



---

archive/issue_comments_288807.json:
```json
{
    "body": "<a id='comment:34'></a>Jeroen's problem is that this ticket adds an extra step to add a new package. Currently, `checksums.ini` is completely auto-generated: one does not need to worry at all about `checksums.ini` when creating a new package. This is no longer true with this branch because it requires that the developer adds a minimal `checksums.ini`.",
    "created_at": "2016-06-11T15:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288807",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>Jeroen's problem is that this ticket adds an extra step to add a new package. Currently, `checksums.ini` is completely auto-generated: one does not need to worry at all about `checksums.ini` when creating a new package. This is no longer true with this branch because it requires that the developer adds a minimal `checksums.ini`.



---

archive/issue_comments_288808.json:
```json
{
    "body": "<a id='comment:35'></a>On the plus side it actually works whereas the current script does not (e.g. try updating the python2 package #19735)",
    "created_at": "2016-06-11T15:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288808",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>On the plus side it actually works whereas the current script does not (e.g. try updating the python2 package #19735)



---

archive/issue_comments_288809.json:
```json
{
    "body": "<a id='comment:36'></a>What exactly should go there in `checksums.ini` ? Some meta-information? Is it documented in this ticket?",
    "created_at": "2016-06-11T16:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288809",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>What exactly should go there in `checksums.ini` ? Some meta-information? Is it documented in this ticket?



---

archive/issue_comments_288810.json:
```json
{
    "body": "<a id='comment:37'></a>It just needs to contain\n\n```\ntarball=Python-VERSION.tgz\n```\nto define (together with package-version.txt) the tarball to use.",
    "created_at": "2016-06-11T16:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288810",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>It just needs to contain

```
tarball=Python-VERSION.tgz
```
to define (together with package-version.txt) the tarball to use.



---

archive/issue_comments_288811.json:
```json
{
    "body": "<a id='comment:38'></a>So you can use tarballs named not according to Sage \"standard\" with this ticket?\nThis would be great, and this'd beat the slightly unfortunate fact that you need one more file.",
    "created_at": "2016-06-11T16:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288811",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>So you can use tarballs named not according to Sage "standard" with this ticket?
This would be great, and this'd beat the slightly unfortunate fact that you need one more file.



---

archive/issue_comments_288812.json:
```json
{
    "body": "<a id='comment:39'></a>I'm pretty sure there is more string matching scattered in various scripts to map between package names and tarball filenames, this should be replaced by the single point of truth \n\n```\n$ ./build/bin/sage-package tarball python3\nPython-3.4.3.tar.gz\n```\nHowever this is future work and not what this package is about.",
    "created_at": "2016-06-11T16:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288812",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:39'></a>I'm pretty sure there is more string matching scattered in various scripts to map between package names and tarball filenames, this should be replaced by the single point of truth 

```
$ ./build/bin/sage-package tarball python3
Python-3.4.3.tar.gz
```
However this is future work and not what this package is about.



---

archive/issue_comments_288813.json:
```json
{
    "body": "<a id='comment:40'></a>As soon as there is something in the developer docs that reflects this change, I'd be happy to give it a positive review.",
    "created_at": "2016-06-11T17:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288813",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>As soon as there is something in the developer docs that reflects this change, I'd be happy to give it a positive review.



---

archive/issue_events_054505.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-06-11T17:06:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19984#event-54505"
}
```



---

archive/issue_comments_288814.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-11T18:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288815.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-11T23:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288816.json:
```json
{
    "body": "<a id='comment:43'></a>Also adds `sage --package create foo --version 1.3 --tarball FoO-VERSION.tar.gz --type experimental`",
    "created_at": "2016-06-12T00:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288816",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:43'></a>Also adds `sage --package create foo --version 1.3 --tarball FoO-VERSION.tar.gz --type experimental`



---

archive/issue_comments_288817.json:
```json
{
    "body": "<a id='comment:44'></a>\n```\n$ sage --package fix-checksum *\nusage: sage --package [-h] [--log LOG]\n                      \n                      {fix-checksum,name,create,list,update,tarball,apropos,download,config}\n                      ...\nsage --package: error: unrecognized arguments: aclocal.m4 autom4te.cache bootstrap build config config.log config.status configure configure.ac COPYING.txt local logs m4 Makefile README.md sage src upstream VERSION.txt\n```\nthe logic behind the latter error message looks as if it parses the current directory, for some reason... It is a feature or a bug?",
    "created_at": "2016-06-12T23:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288817",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
```
$ sage --package fix-checksum *
usage: sage --package [-h] [--log LOG]
                      
                      {fix-checksum,name,create,list,update,tarball,apropos,download,config}
                      ...
sage --package: error: unrecognized arguments: aclocal.m4 autom4te.cache bootstrap build config config.log config.status configure configure.ac COPYING.txt local logs m4 Makefile README.md sage src upstream VERSION.txt
```
the logic behind the latter error message looks as if it parses the current directory, for some reason... It is a feature or a bug?



---

archive/issue_comments_288818.json:
```json
{
    "body": "<a id='comment:45'></a>Bash expands * to all files in the current directory. Usage is:\n\n```\n$ ./sage --package fix-checksum -h\nusage: sage --package fix-checksum [-h] [package_name]\n\npositional arguments:\n  package_name  Package name. Default: fix all packages.\n\noptional arguments:\n  -h, --help    show this help message and exit\n\nFix the checksum of a package\n    \nEXAMPLE:\n\n    $ sage --package fix-checksum pari\n    Updating checksum of pari-2.8-2044-g89b0f1e.tar.gz\n```",
    "created_at": "2016-06-12T23:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288818",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:45'></a>Bash expands * to all files in the current directory. Usage is:

```
$ ./sage --package fix-checksum -h
usage: sage --package fix-checksum [-h] [package_name]

positional arguments:
  package_name  Package name. Default: fix all packages.

optional arguments:
  -h, --help    show this help message and exit

Fix the checksum of a package
    
EXAMPLE:

    $ sage --package fix-checksum pari
    Updating checksum of pari-2.8-2044-g89b0f1e.tar.gz
```



---

archive/issue_comments_288819.json:
```json
{
    "body": "<a id='comment:46'></a>My worry is not checking arguments for correctness might lead to screwups.\n\n```\n$ sage --package fix-checksum *\nChecksum of pari-2.8-2341-g61b65cc.tar.gz unchanged\n$ ls -l\ntotal 0\n-rw-rw-r-- 1 dima dima 0 Jun 13 07:27 pari\n```\nOK, this particular case is largely innocent, but still. I won't mind if this is addressed on another ticket.",
    "created_at": "2016-06-13T06:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288819",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>My worry is not checking arguments for correctness might lead to screwups.

```
$ sage --package fix-checksum *
Checksum of pari-2.8-2341-g61b65cc.tar.gz unchanged
$ ls -l
total 0
-rw-rw-r-- 1 dima dima 0 Jun 13 07:27 pari
```
OK, this particular case is largely innocent, but still. I won't mind if this is addressed on another ticket.



---

archive/issue_comments_288820.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-06-13T06:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288820",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_288821.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-06-14T07:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19984#issuecomment-288821",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054506.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-14T07:10:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19984",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19984#event-54506"
}
```
