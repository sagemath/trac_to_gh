# Issue 19973: More trouble with immutable graphs

archive/issues_019736.json:
```json
{
    "body": "Here is a fix to a few cases where things fail with immutable graphs due to `subgraph` preserving the mutability of the graph. The affected methods are `traveling_salesman_problem` (and then also `is_hamiltonian` and `hamiltonian_cycle`) and `is_clique` with the parameter `directed_clique=True`.\n\nThese problems have either been missed, or, more likely, introduced in #19526.\n\nCC:  @nathanncohen\n\nKeywords: graphs digraphs immutable\n\nReviewer: Nathann Cohen\n\nAuthor: Jano\u0161 Vidali\n\nBranch: 97ab2e1ef6de89e60b7088188fe81ae29f2a908b\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19973\n\n",
    "closed_at": "2016-01-28T20:09:01Z",
    "created_at": "2016-01-27T13:41:12Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "More trouble with immutable graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19973",
    "user": "https://github.com/jaanos"
}
```
Here is a fix to a few cases where things fail with immutable graphs due to `subgraph` preserving the mutability of the graph. The affected methods are `traveling_salesman_problem` (and then also `is_hamiltonian` and `hamiltonian_cycle`) and `is_clique` with the parameter `directed_clique=True`.

These problems have either been missed, or, more likely, introduced in #19526.

CC:  @nathanncohen

Keywords: graphs digraphs immutable

Reviewer: Nathann Cohen

Author: Janoš Vidali

Branch: 97ab2e1ef6de89e60b7088188fe81ae29f2a908b

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19973





---

archive/issue_comments_270965.json:
```json
{
    "body": "Changing keywords from \"\" to \"graphs digraphs immutable\".",
    "created_at": "2016-01-27T14:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270965",
    "user": "https://github.com/jaanos"
}
```

Changing keywords from "" to "graphs digraphs immutable".



---

archive/issue_comments_270966.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2016-01-27T14:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270966",
    "user": "https://github.com/jaanos"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_270967.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-27T14:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270967",
    "user": "https://github.com/jaanos"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_270968.json:
```json
{
    "body": "<a id='comment:3'></a>Wondering about the default: why shouldn't we use `immutable = self.is_immutable()`?",
    "created_at": "2016-01-27T18:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270968",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>Wondering about the default: why shouldn't we use `immutable = self.is_immutable()`?



---

archive/issue_comments_270969.json:
```json
{
    "body": "<a id='comment:4'></a>Hi!\n\nThis is the default for `subgraph` since #19526 (if that's what you meant). But in these cases the algorithms change these subgraphs (in fairly trivial ways, but still), so we need them to be mutable.\n\nJano\u0161",
    "created_at": "2016-01-27T18:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270969",
    "user": "https://github.com/jaanos"
}
```

<a id='comment:4'></a>Hi!

This is the default for `subgraph` since #19526 (if that's what you meant). But in these cases the algorithms change these subgraphs (in fairly trivial ways, but still), so we need them to be mutable.

Janoš



---

archive/issue_comments_270970.json:
```json
{
    "body": "<a id='comment:5'></a>Oh. My mistake: what I meant is that the functions will now return a mutable graph (e.g. the tsp) even when called on an immutable graph. Should we change the mutability status of those graphs we are about to return to match the status of `self`?",
    "created_at": "2016-01-27T18:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270970",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Oh. My mistake: what I meant is that the functions will now return a mutable graph (e.g. the tsp) even when called on an immutable graph. Should we change the mutability status of those graphs we are about to return to match the status of `self`?



---

archive/issue_comments_270971.json:
```json
{
    "body": "<a id='comment:6'></a>Yes, we could do that. Also, when calling `is_hamiltonian`, we don't really need to construct this subgraph at all (unless it's cached somewhere, but I don't see it in the current code).",
    "created_at": "2016-01-27T19:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270971",
    "user": "https://github.com/jaanos"
}
```

<a id='comment:6'></a>Yes, we could do that. Also, when calling `is_hamiltonian`, we don't really need to construct this subgraph at all (unless it's cached somewhere, but I don't see it in the current code).



---

archive/issue_comments_270972.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-27T19:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270972",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_270973.json:
```json
{
    "body": "<a id='comment:8'></a>OK, `traveling_salesman_problem` now preserves mutability. It still constructs the subgraph, even if called from `is_hamiltonian` - this is, after all, the easy part of the algorithm:)",
    "created_at": "2016-01-27T19:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270973",
    "user": "https://github.com/jaanos"
}
```

<a id='comment:8'></a>OK, `traveling_salesman_problem` now preserves mutability. It still constructs the subgraph, even if called from `is_hamiltonian` - this is, after all, the easy part of the algorithm:)



---

archive/issue_comments_270974.json:
```json
{
    "body": "<a id='comment:9'></a>OKayyy.. Thanks for this ticket, good to go!",
    "created_at": "2016-01-28T07:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270974",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>OKayyy.. Thanks for this ticket, good to go!



---

archive/issue_comments_270975.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-28T07:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270975",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_270976.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2016-01-28T07:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270976",
    "user": "https://github.com/nathanncohen"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_events_054487.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-28T20:09:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19973#event-54487"
}
```



---

archive/issue_comments_270977.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-28T20:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270977",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_270978.json:
```json
{
    "body": "<a id='comment:12'></a>Thanks again!",
    "created_at": "2016-01-28T20:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19973#issuecomment-270978",
    "user": "https://github.com/jaanos"
}
```

<a id='comment:12'></a>Thanks again!
