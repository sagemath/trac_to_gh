# Issue 19512: is_morphism for maps of products of projective spaces

archive/issues_019275.json:
```json
{
    "body": "Implement a function to determine whether a given map between products of projective spaces is a morphism.\n\nCC:  @bhutz\n\nBranch/Commit: ee5676f3f02327ba15d9b9c13d337b4543b696a5\n\nReviewer: Ben Hutz\n\nAuthor: Grayson Jorgenson\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19512\n\n",
    "closed_at": "2015-11-10T14:00:29Z",
    "created_at": "2015-11-03T03:45:49Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "is_morphism for maps of products of projective spaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19512",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```
Implement a function to determine whether a given map between products of projective spaces is a morphism.

CC:  @bhutz

Branch/Commit: ee5676f3f02327ba15d9b9c13d337b4543b696a5

Reviewer: Ben Hutz

Author: Grayson Jorgenson

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19512





---

archive/issue_comments_281410.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-03T04:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281411.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-03T04:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281411",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_281412.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-03T13:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281412",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_281413.json:
```json
{
    "body": "<a id='comment:4'></a>Mapping down to each coordinate ring will only work when there is no mixing of coordinates in the map. So this approach will not work in general.",
    "created_at": "2015-11-03T13:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281413",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:4'></a>Mapping down to each coordinate ring will only work when there is no mixing of coordinates in the map. So this approach will not work in general.



---

archive/issue_comments_281414.json:
```json
{
    "body": "<a id='comment:5'></a>In thinking about this, I think it may be as simple as just checking the dimension of the ideal in the coordinate ring defined by the coordinates of the map. If this is 0, then a morphism and if it is >0, then it is not a morphism. i.e., you can basically duplicate the code from projective_morphism.py.\n\nWhat do you think?",
    "created_at": "2015-11-03T17:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281414",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:5'></a>In thinking about this, I think it may be as simple as just checking the dimension of the ideal in the coordinate ring defined by the coordinates of the map. If this is 0, then a morphism and if it is >0, then it is not a morphism. i.e., you can basically duplicate the code from projective_morphism.py.

What do you think?



---

archive/issue_comments_281415.json:
```json
{
    "body": "<a id='comment:6'></a>Oops! I guess my approach wasn't truly componentwise to begin with since I ignored the possibility of mixed coordinates.\n\nWould checking the dimension of the ideal in the whole coordinate ring coincide with checking that the Segre embedding of the map is a projective morphism? It would be stricter than checking that the coordinates share no common zeros componentwise, right? Maps such as\n\n```\nT.<x,y,z,w,u,v> = ProductProjectiveSpaces([2,2],QQ)\nH = T.Hom(T)\nF = H([x^2*u,y^2*w,z^2*v,w^2,u^2,v^2])\n```\n\nwouldn't be considered morphisms with this check.",
    "created_at": "2015-11-04T04:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281415",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:6'></a>Oops! I guess my approach wasn't truly componentwise to begin with since I ignored the possibility of mixed coordinates.

Would checking the dimension of the ideal in the whole coordinate ring coincide with checking that the Segre embedding of the map is a projective morphism? It would be stricter than checking that the coordinates share no common zeros componentwise, right? Maps such as

```
T.<x,y,z,w,u,v> = ProductProjectiveSpaces([2,2],QQ)
H = T.Hom(T)
F = H([x^2*u,y^2*w,z^2*v,w^2,u^2,v^2])
```

wouldn't be considered morphisms with this check.



---

archive/issue_comments_281416.json:
```json
{
    "body": "<a id='comment:7'></a>another puzzling example:\n\n```\nP.<x,y,z,w,u,v>=ProductProjectiveSpaces(QQ,[1,1,1])\nH=End(P)\nf=H([u,v,z^2,w^2,u^2,v^2])\n```\n\nIs this a morphism? It would fail the Segre embedding version (check if the Segre embedding was a morphism) and the dimension of the ideal is 2, but the indeterminacy locus is empty.",
    "created_at": "2015-11-04T19:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281416",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:7'></a>another puzzling example:

```
P.<x,y,z,w,u,v>=ProductProjectiveSpaces(QQ,[1,1,1])
H=End(P)
f=H([u,v,z^2,w^2,u^2,v^2])
```

Is this a morphism? It would fail the Segre embedding version (check if the Segre embedding was a morphism) and the dimension of the ideal is 2, but the indeterminacy locus is empty.



---

archive/issue_comments_281417.json:
```json
{
    "body": "<a id='comment:8'></a>Actually, that example should be a morphism and does not fail the segre embedding check (it just isn't dominant). So the 0 dimensional check is (at least) not iff.\n\n\nOne solution that has come to mind is do something like define the subscheme of the productprojectivespaces for each set of coordinates of the map and check that there are no points on each such subscheme. Then we have a set of polynomials defined at every point in the product (the definition of a morphism)\n\nFor products of 2 projective spaces, the .dimension function works fine via segre embeddings, but calling dimension on the defining ideal for empty subschemes does not give the 'right' answer in products:\n\n```\nP.<x,y,z,u,v,w>=ProductProjectiveSpaces(QQ,[2,2])\nH=End(P)\nf=H([u,v,w,u^2,v^2,w^2])\nm=0\nfor i in range(P.num_components()):\n    t=P[i].dimension_relative()+1\n    X=P.subscheme(list(f)[m:m+t])\n    print X.defining_ideal().dimension(), X.defining_ideal().dimension() - P.num_components()\n    print \"dim:\",X.dimension()\n    m+=t    \n```\n\nat the moment segre embedding (and hence dimension) is only implemented for products of 2 projective spaces. It would be nice to get that to work in general, but maybe the solution for this particular function is to be dependent on the dimension function for subschemes and then improve the dimension function as part of a separate ticket.\n\nWhat do you think?",
    "created_at": "2015-11-05T01:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281417",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>Actually, that example should be a morphism and does not fail the segre embedding check (it just isn't dominant). So the 0 dimensional check is (at least) not iff.


One solution that has come to mind is do something like define the subscheme of the productprojectivespaces for each set of coordinates of the map and check that there are no points on each such subscheme. Then we have a set of polynomials defined at every point in the product (the definition of a morphism)

For products of 2 projective spaces, the .dimension function works fine via segre embeddings, but calling dimension on the defining ideal for empty subschemes does not give the 'right' answer in products:

```
P.<x,y,z,u,v,w>=ProductProjectiveSpaces(QQ,[2,2])
H=End(P)
f=H([u,v,w,u^2,v^2,w^2])
m=0
for i in range(P.num_components()):
    t=P[i].dimension_relative()+1
    X=P.subscheme(list(f)[m:m+t])
    print X.defining_ideal().dimension(), X.defining_ideal().dimension() - P.num_components()
    print "dim:",X.dimension()
    m+=t    
```

at the moment segre embedding (and hence dimension) is only implemented for products of 2 projective spaces. It would be nice to get that to work in general, but maybe the solution for this particular function is to be dependent on the dimension function for subschemes and then improve the dimension function as part of a separate ticket.

What do you think?



---

archive/issue_comments_281418.json:
```json
{
    "body": "<a id='comment:9'></a>I think that sounds good. It will restrict any function that needs is_morphism to working only with spaces with two components, but that's probably not too much of a problem for right now and just makes it higher priority to implement Segre embedding for general products. I've implemented it locally, so I will push it up here.",
    "created_at": "2015-11-06T03:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281418",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:9'></a>I think that sounds good. It will restrict any function that needs is_morphism to working only with spaces with two components, but that's probably not too much of a problem for right now and just makes it higher priority to implement Segre embedding for general products. I've implemented it locally, so I will push it up here.



---

archive/issue_comments_281419.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-06T03:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281420.json:
```json
{
    "body": "<a id='comment:11'></a>Does this seem to be okay? I assumed in this implementation that the check is iff; is that correct? That is, if for a map there is a point on one of the subschemes, then the map is not a morphism?",
    "created_at": "2015-11-06T03:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281420",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:11'></a>Does this seem to be okay? I assumed in this implementation that the check is iff; is that correct? That is, if for a map there is a point on one of the subschemes, then the map is not a morphism?



---

archive/issue_comments_281421.json:
```json
{
    "body": "<a id='comment:12'></a>Just one issue here.\n\nWhen you are creating the subschemes you need to be careful about the domain and codomain. They may not be the same. You are correctly creating subschemes of the domain, but the groups of coordinates needs to go by the component dimensions of the codomain.",
    "created_at": "2015-11-06T17:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281421",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:12'></a>Just one issue here.

When you are creating the subschemes you need to be careful about the domain and codomain. They may not be the same. You are correctly creating subschemes of the domain, but the groups of coordinates needs to go by the component dimensions of the codomain.



---

archive/issue_comments_281422.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-07T03:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281423.json:
```json
{
    "body": "<a id='comment:14'></a>Alright, here is a revision. While testing I found that the dimension function doesn't seem to work unless the base rings of the product spaces are fields:\n\n```\nP.<x,y,z,w,u> = ProductProjectiveSpaces([2,1],ZZ)\nH = End(P)\nf = H([x^2,y^2,z^2,w^2,u^2])\nX = P.subscheme(list(f)[0 : 3])\nX.dimension()\n```\n\nIs there any way around this?",
    "created_at": "2015-11-07T03:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281423",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:14'></a>Alright, here is a revision. While testing I found that the dimension function doesn't seem to work unless the base rings of the product spaces are fields:

```
P.<x,y,z,w,u> = ProductProjectiveSpaces([2,1],ZZ)
H = End(P)
f = H([x^2,y^2,z^2,w^2,u^2])
X = P.subscheme(list(f)[0 : 3])
X.dimension()
```

Is there any way around this?



---

archive/issue_comments_281424.json:
```json
{
    "body": "<a id='comment:15'></a>Well, just like is_morphism for polynomials, if given a ring, you can change to the fraction field. The real question is should that be implemented here or in dimension. Since improving dimension is more than a trivial project, I'd say to do the same thing here and when dimension is improved it can be updated.\n\nI don't think there are any adverse implications for changing to the fraction field (since dimension = dimension_relative), but I'll think some more about it when I review the updated version.",
    "created_at": "2015-11-07T12:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281424",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:15'></a>Well, just like is_morphism for polynomials, if given a ring, you can change to the fraction field. The real question is should that be implemented here or in dimension. Since improving dimension is more than a trivial project, I'd say to do the same thing here and when dimension is improved it can be updated.

I don't think there are any adverse implications for changing to the fraction field (since dimension = dimension_relative), but I'll think some more about it when I review the updated version.



---

archive/issue_comments_281425.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-07T20:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281426.json:
```json
{
    "body": "<a id='comment:17'></a>Okay, now if the base ring isn't a field, I change_ring both the ambient space of the domain and the coordinate polynomials before performing the dimension check.",
    "created_at": "2015-11-07T20:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281426",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:17'></a>Okay, now if the base ring isn't a field, I change_ring both the ambient space of the domain and the coordinate polynomials before performing the dimension check.



---

archive/issue_comments_281427.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-07T20:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281427",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_281428.json:
```json
{
    "body": "<a id='comment:18'></a>This looks fine, but I've uncovered a few other simple errors in projective product morphisms that I've put in Trac #19551.",
    "created_at": "2015-11-08T19:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281428",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:18'></a>This looks fine, but I've uncovered a few other simple errors in projective product morphisms that I've put in Trac #19551.



---

archive/issue_comments_281429.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-08T19:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281429",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_281430.json:
```json
{
    "body": "<a id='comment:19'></a>This ticket needs a milestone before it can be merged",
    "created_at": "2015-11-09T14:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281430",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>This ticket needs a milestone before it can be merged



---

archive/issue_events_053783.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gjorgenson",
    "created_at": "2015-11-09T14:54:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19512#event-53783"
}
```



---

archive/issue_events_053784.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-10T14:00:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19512#event-53784"
}
```



---

archive/issue_comments_281431.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-10T14:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19512#issuecomment-281431",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
