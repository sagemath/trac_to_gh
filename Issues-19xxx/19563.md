# Issue 19563: Upgrade arb and fix FLINT includes

archive/issues_019326.json:
```json
{
    "body": "**Upstream**: [http://sage.ugent.be/www/jdemeyer/sage/arb-2.7.0.tar.bz2](http://sage.ugent.be/www/jdemeyer/sage/arb-2.7.0.tar.bz2) (packaged from git repo since upstream doesn't seem to provide tarballs)\n\n**Pull request**: [https://github.com/fredrik-johansson/arb/pull/55](https://github.com/fredrik-johansson/arb/pull/55)\n\nCC:  @kiwifb\n\nBranch/Commit: d6c3c85dc75803c3e6676c8700e648db53343ed0\n\nUpstream: Reported upstream. Developers acknowledge bug.\n\nReviewer: Volker Braun\n\nAuthor: Jeroen Demeyer\n\nDependencies: #19152\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19563\n\n",
    "closed_at": "2015-11-29T12:12:05Z",
    "created_at": "2015-11-10T00:44:41Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Upgrade arb and fix FLINT includes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19563",
    "user": "https://github.com/jdemeyer"
}
```
**Upstream**: [http://sage.ugent.be/www/jdemeyer/sage/arb-2.7.0.tar.bz2](http://sage.ugent.be/www/jdemeyer/sage/arb-2.7.0.tar.bz2) (packaged from git repo since upstream doesn't seem to provide tarballs)

**Pull request**: [https://github.com/fredrik-johansson/arb/pull/55](https://github.com/fredrik-johansson/arb/pull/55)

CC:  @kiwifb

Branch/Commit: d6c3c85dc75803c3e6676c8700e648db53343ed0

Upstream: Reported upstream. Developers acknowledge bug.

Reviewer: Volker Braun

Author: Jeroen Demeyer

Dependencies: #19152

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19563





---

archive/issue_comments_265084.json:
```json
{
    "body": "<a id='comment:2'></a>One doctest failure after straight upgrading `arb` (linux 64bit).\n\n```\nsage -t --long usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx\n**********************************************************************\nFile \"usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx\", line 2620, in sage.rings.real_arb.RealBall.log_gamma\nFailed example:\n    RBF(1/2).log_gamma()\nExpected:\n    [0.572364942924700 +/- 4.87e-16]\nGot:\n    [0.572364942924700 +/- 2.67e-16]\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.rings.real_arb.RealBall.log_gamma\n    [494 tests, 1 failure, 0.30 s]\n----------------------------------------------------------------------\nsage -t --long usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.5 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\n```",
    "created_at": "2015-11-10T04:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265084",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>One doctest failure after straight upgrading `arb` (linux 64bit).

```
sage -t --long usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx
**********************************************************************
File "usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx", line 2620, in sage.rings.real_arb.RealBall.log_gamma
Failed example:
    RBF(1/2).log_gamma()
Expected:
    [0.572364942924700 +/- 4.87e-16]
Got:
    [0.572364942924700 +/- 2.67e-16]
**********************************************************************
1 item had failures:
   1 of   3 in sage.rings.real_arb.RealBall.log_gamma
    [494 tests, 1 failure, 0.30 s]
----------------------------------------------------------------------
sage -t --long usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.5 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
```



---

archive/issue_comments_265085.json:
```json
{
    "body": "<a id='comment:4'></a>Oh there is a tarball at `https://github.com/fredrik-johansson/arb/archive/2.7.0.tar.gz` but of course as a lot of those coming from github it has to be renamed.",
    "created_at": "2015-11-11T00:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265085",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>Oh there is a tarball at `https://github.com/fredrik-johansson/arb/archive/2.7.0.tar.gz` but of course as a lot of those coming from github it has to be renamed.



---

archive/issue_comments_265086.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 fbissey]:\n> Oh there is a tarball at `https://github.com/fredrik-johansson/arb/archive/2.7.0.tar.gz`\n\nRight, this is what I meant with \"packaged from git repo\".",
    "created_at": "2015-11-11T00:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265086",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:4 fbissey]:
> Oh there is a tarball at `https://github.com/fredrik-johansson/arb/archive/2.7.0.tar.gz`

Right, this is what I meant with "packaged from git repo".



---

archive/issue_comments_265087.json:
```json
{
    "body": "<a id='comment:7'></a>Last 10 new commits:",
    "created_at": "2015-11-11T02:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265087",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Last 10 new commits:



---

archive/issue_comments_265088.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-11T06:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265089.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-11T06:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265089",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_265090.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-26T19:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265090",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_265091.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-11-26T19:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265091",
    "user": "https://github.com/kiwifb"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_265092.json:
```json
{
    "body": "<a id='comment:13'></a>I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there. A small fix just like in `cliquer`'s spkg-install would do the trick\n\n```\nif [ \"$UNAME\" = \"Darwin\" ]; then\n    install_name_tool -id \"${SAGE_LOCAL}\"/lib/libarb.dylib \"${SAGE_LOCAL}\"/lib/libarb.dylib\nfi\n```",
    "created_at": "2015-11-26T19:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265092",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there. A small fix just like in `cliquer`'s spkg-install would do the trick

```
if [ "$UNAME" = "Darwin" ]; then
    install_name_tool -id "${SAGE_LOCAL}"/lib/libarb.dylib "${SAGE_LOCAL}"/lib/libarb.dylib
fi
```



---

archive/issue_comments_265093.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 fbissey]:\n> I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there.\n\n\nIs this problem related to the *upgrade* of `arb`?",
    "created_at": "2015-11-27T06:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265093",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Replying to [comment:13 fbissey]:
> I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there.


Is this problem related to the *upgrade* of `arb`?



---

archive/issue_comments_265094.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 jdemeyer]:\n> Replying to [comment:13 fbissey]:\n> > I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there.\n\n> \n> Is this problem related to the *upgrade* of `arb`?\n\nArguably it should have been dealt with in #18546 or earlier.",
    "created_at": "2015-11-27T06:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265094",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>Replying to [comment:14 jdemeyer]:
> Replying to [comment:13 fbissey]:
> > I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there.

> 
> Is this problem related to the *upgrade* of `arb`?

Arguably it should have been dealt with in #18546 or earlier.



---

archive/issue_comments_265095.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-11-27T06:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265095",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_265096.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:13 fbissey]:\n> I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there. A small fix just like in `cliquer`'s spkg-install would do the trick\n> \n> ```\n> if [ \"$UNAME\" = \"Darwin\" ]; then\n>     install_name_tool -id \"${SAGE_LOCAL}\"/lib/libarb.dylib \"${SAGE_LOCAL}\"/lib/libarb.dylib\n> fi\n> ```\n\nThis is now #19627.",
    "created_at": "2015-11-27T06:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265096",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:13 fbissey]:
> I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there. A small fix just like in `cliquer`'s spkg-install would do the trick
> 
> ```
> if [ "$UNAME" = "Darwin" ]; then
>     install_name_tool -id "${SAGE_LOCAL}"/lib/libarb.dylib "${SAGE_LOCAL}"/lib/libarb.dylib
> fi
> ```

This is now #19627.



---

archive/issue_comments_265097.json:
```json
{
    "body": "<a id='comment:17'></a>The arb testsuite dies with \n\n```\n$ SAGE_CHECK=yes ./sage -p arb\n...\nSuccessfully installed arb-2.7.0.p0\nRunning the test suite for arb-2.7.0.p0...\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nmake[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[1]: Nothing to be done for 'shared'.\nmake[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nmake[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[1]: Nothing to be done for 'static'.\nmake[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nmake[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[2]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\nmake[2]: Nothing to be done for 'shared'.\nmake[2]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[2]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\nmake[2]: Nothing to be done for 'static'.\nmake[2]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nmake[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src/fmpr'\n    CC   ../build/fmpr/test/t-add\n    CC   ../build/fmpr/test/t-set_fmpq\n    CC   ../build/fmpr/test/t-root\n    CC   ../build/fmpr/test/t-mul\n    CC   ../build/fmpr/test/t-sub\n    CC   ../build/fmpr/test/t-exp\n    CC   ../build/fmpr/test/t-abs_bound_lt_2exp_si\n    CC   ../build/fmpr/test/t-mul_si\n    CC   ../build/fmpr/test/t-set_round_ui_2exp_fmpz\n    CC   ../build/fmpr/test/t-get_d\ntest/t-mul_si.c:27:25: fatal error: long_extras.h: No such file or directory\ncompilation terminated.\n../Makefile.subdirs:78: recipe for target '../build/fmpr/test/t-mul_si' failed\nmake[1]: *** [../build/fmpr/test/t-mul_si] Error 1\nmake[1]: *** Waiting for unfinished jobs....\nmake[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src/fmpr'\nMakefile:169: recipe for target 'check' failed\nmake: *** [check] Error 2\n```\nThoughts?",
    "created_at": "2015-11-27T22:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265097",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>The arb testsuite dies with 

```
$ SAGE_CHECK=yes ./sage -p arb
...
Successfully installed arb-2.7.0.p0
Running the test suite for arb-2.7.0.p0...
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: Nothing to be done for 'shared'.
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: Nothing to be done for 'static'.
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: Nothing to be done for 'shared'.
make[2]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: Nothing to be done for 'static'.
make[2]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src/fmpr'
    CC   ../build/fmpr/test/t-add
    CC   ../build/fmpr/test/t-set_fmpq
    CC   ../build/fmpr/test/t-root
    CC   ../build/fmpr/test/t-mul
    CC   ../build/fmpr/test/t-sub
    CC   ../build/fmpr/test/t-exp
    CC   ../build/fmpr/test/t-abs_bound_lt_2exp_si
    CC   ../build/fmpr/test/t-mul_si
    CC   ../build/fmpr/test/t-set_round_ui_2exp_fmpz
    CC   ../build/fmpr/test/t-get_d
test/t-mul_si.c:27:25: fatal error: long_extras.h: No such file or directory
compilation terminated.
../Makefile.subdirs:78: recipe for target '../build/fmpr/test/t-mul_si' failed
make[1]: *** [../build/fmpr/test/t-mul_si] Error 1
make[1]: *** Waiting for unfinished jobs....
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src/fmpr'
Makefile:169: recipe for target 'check' failed
make: *** [check] Error 2
```
Thoughts?



---

archive/issue_comments_265098.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-11-28T18:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265098",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_265099.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-28T19:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265099",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265100.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-11-28T19:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265100",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_265101.json:
```json
{
    "body": "<a id='comment:20'></a>I forgot to change some includes. With this patch, the testsuite passes. Since I'm just adding a few changes in the spirit of the old branch, I assume the positive review still stands.",
    "created_at": "2015-11-28T19:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>I forgot to change some includes. With this patch, the testsuite passes. Since I'm just adding a few changes in the spirit of the old branch, I assume the positive review still stands.



---

archive/issue_comments_265102.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-29T12:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19563#issuecomment-265102",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053844.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-29T12:12:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19563",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19563#event-53844"
}
```
