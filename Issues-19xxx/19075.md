# Issue 19075: Speedup creation of Kleber tree

archive/issues_018838.json:
```json
{
    "body": "Currently, generating the first level of the Kleber tree grows poorly as the rank and the complexity of the root system increases. This is due to the fact that it uses all positive roots. Instead we use integral points (when expressed as simple roots) in the intersection of the negative root cone and a shifted positive weight cone.\n\nAlso due to the number of operations involved, this ticket changes all lower levels to use the polytope enumeration for small rank unless normaliz is available.\n\n**Assignee:** sage-combinat\n\n**CC:**  sage-combinat @anneschilling @bsalisbury1\n\n**Keywords:** rigged configurations, kleber tree\n\n**Branch/Commit:** [5aafe4e2daf41f9bfc464c69098d71f849ffd41a](https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a)\n\n**Reviewer:** Ben Salisbury\n\n**Author:** Travis Scrimshaw\n\n**Dependencies:** #22938\n\nIssue created by migration from https://trac.sagemath.org/ticket/19075\n\n",
    "closed_at": "2017-05-11T21:58:49Z",
    "created_at": "2015-08-23T21:57:10Z",
    "labels": [
        "component: combinatorics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Speedup creation of Kleber tree",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19075",
    "user": "https://github.com/tscrim"
}
```
Currently, generating the first level of the Kleber tree grows poorly as the rank and the complexity of the root system increases. This is due to the fact that it uses all positive roots. Instead we use integral points (when expressed as simple roots) in the intersection of the negative root cone and a shifted positive weight cone.

Also due to the number of operations involved, this ticket changes all lower levels to use the polytope enumeration for small rank unless normaliz is available.

**Assignee:** sage-combinat

**CC:**  sage-combinat @anneschilling @bsalisbury1

**Keywords:** rigged configurations, kleber tree

**Branch/Commit:** [5aafe4e2daf41f9bfc464c69098d71f849ffd41a](https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a)

**Reviewer:** Ben Salisbury

**Author:** Travis Scrimshaw

**Dependencies:** #22938

Issue created by migration from https://trac.sagemath.org/ticket/19075





---

archive/issue_comments_273175.json:
```json
{
    "body": "**Commit:** [f9da27b2e6e3a5ecf891001c184d4201532c3d01](https://github.com/sagemath/sagetrac-mirror/commit/f9da27b2e6e3a5ecf891001c184d4201532c3d01)",
    "created_at": "2015-08-23T22:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273175",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [f9da27b2e6e3a5ecf891001c184d4201532c3d01](https://github.com/sagemath/sagetrac-mirror/commit/f9da27b2e6e3a5ecf891001c184d4201532c3d01)



---

archive/issue_events_175048.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-08-23T22:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175048"
}
```



---

archive/issue_comments_273176.json:
```json
{
    "body": "**Branch:** [public/rigged_configurations/speedup_kleber_tree-19075](https://github.com/sagemath/sagetrac-mirror/tree/public/rigged_configurations/speedup_kleber_tree-19075)",
    "created_at": "2015-08-23T22:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273176",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/rigged_configurations/speedup_kleber_tree-19075](https://github.com/sagemath/sagetrac-mirror/tree/public/rigged_configurations/speedup_kleber_tree-19075)



---

archive/issue_comments_273177.json:
```json
{
    "body": "<a id='comment:1'></a>\nWith the branch, we have (on SMC):\n\n```\nsage: %time RiggedConfigurations(['E',8,1], [[8,1]]).module_generators\nCPU times: user 384 ms, sys: 80 ms, total: 464 ms\nWall time: 430 ms\n```\nwhereas previously this took\n\n```\nsage: %time RiggedConfigurations(['E',8,1], [[8,1]]).module_generators\nCPU times: user 23.9 s, sys: 72 ms, total: 24 s\nWall time: 24.5 s\n```\nAs an added benefit, this allows us to combine the children iterators into a single method.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9da27b2e6e3a5ecf891001c184d4201532c3d01\">f9da27b</a></td><td><code>Generate the Kleber tree by using integral points in a polytope.</code></td></tr></table>\n",
    "created_at": "2015-08-23T22:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273177",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
With the branch, we have (on SMC):

```
sage: %time RiggedConfigurations(['E',8,1], [[8,1]]).module_generators
CPU times: user 384 ms, sys: 80 ms, total: 464 ms
Wall time: 430 ms
```
whereas previously this took

```
sage: %time RiggedConfigurations(['E',8,1], [[8,1]]).module_generators
CPU times: user 23.9 s, sys: 72 ms, total: 24 s
Wall time: 24.5 s
```
As an added benefit, this allows us to combine the children iterators into a single method.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9da27b2e6e3a5ecf891001c184d4201532c3d01">f9da27b</a></td><td><code>Generate the Kleber tree by using integral points in a polytope.</code></td></tr></table>




---

archive/issue_comments_273178.json:
```json
{
    "body": "<a id='comment:2'></a>\nTo note, from looking over the profiling data, the majority of time is devoted to doing arithmetic using combinatorial free modules and just taking so long due to the sheer number of calculations.\n\nIt seems like on small rank, this is slower change is ~3-5x slower:\n\n```\nsage: RC = RiggedConfigurations(['D',4,1], [[4,2], [1,3], [2,4]])\nsage: %time len(RC.module_generators)\nCPU times: user 928 ms, sys: 84 ms, total: 1.01 s\nWall time: 1.47 s\n586\n```\nvs the current version:\n\n```\nsage: %time len(RC.module_generators)\nCPU times: user 340 ms, sys: 4 ms, total: 344 ms\nWall time: 348 ms\n586\n```\nBut for larger rank, it still is faster:\n\n```\nsage: RC = RiggedConfigurations(['D',8,1], [[4,2], [1,3], [2,4]])\nsage: %time len(RC.module_generators)\nCPU times: user 38.4 s, sys: 148 ms, total: 38.6 s\nWall time: 40.7 s\n19234\n```\nvs I didn't have the patience to wait.\n\nMore data:\n\n```\nsage: RC = RiggedConfigurations(['D',6,1], [[4,6]])\nsage: %time len(RC.module_generators)\nCPU times: user 392 ms, sys: 56 ms, total: 448 ms\nWall time: 648 ms\n28\n```\nprevious:\n\n```\nsage: %time len(RC.module_generators)\nCPU times: user 1.46 s, sys: 0 ns, total: 1.46 s\nWall time: 1.52 s\n28\n```\n\nFor F<sub>4</sub><sup>(1)</sup>, I get the new version is 2-20x faster for B<sup>i,1</sup>, where i = 1,2,3,4.\n\nThe question then becomes should we deal with the slowdown in small ranks, or keep both algorithms and have a heuristic which chooses between the two?",
    "created_at": "2015-08-23T22:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273178",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
To note, from looking over the profiling data, the majority of time is devoted to doing arithmetic using combinatorial free modules and just taking so long due to the sheer number of calculations.

It seems like on small rank, this is slower change is ~3-5x slower:

```
sage: RC = RiggedConfigurations(['D',4,1], [[4,2], [1,3], [2,4]])
sage: %time len(RC.module_generators)
CPU times: user 928 ms, sys: 84 ms, total: 1.01 s
Wall time: 1.47 s
586
```
vs the current version:

```
sage: %time len(RC.module_generators)
CPU times: user 340 ms, sys: 4 ms, total: 344 ms
Wall time: 348 ms
586
```
But for larger rank, it still is faster:

```
sage: RC = RiggedConfigurations(['D',8,1], [[4,2], [1,3], [2,4]])
sage: %time len(RC.module_generators)
CPU times: user 38.4 s, sys: 148 ms, total: 38.6 s
Wall time: 40.7 s
19234
```
vs I didn't have the patience to wait.

More data:

```
sage: RC = RiggedConfigurations(['D',6,1], [[4,6]])
sage: %time len(RC.module_generators)
CPU times: user 392 ms, sys: 56 ms, total: 448 ms
Wall time: 648 ms
28
```
previous:

```
sage: %time len(RC.module_generators)
CPU times: user 1.46 s, sys: 0 ns, total: 1.46 s
Wall time: 1.52 s
28
```

For F<sub>4</sub><sup>(1)</sup>, I get the new version is 2-20x faster for B<sup>i,1</sup>, where i = 1,2,3,4.

The question then becomes should we deal with the slowdown in small ranks, or keep both algorithms and have a heuristic which chooses between the two?



---

archive/issue_comments_273179.json:
```json
{
    "body": "**Changing commit** from \"[f9da27b2e6e3a5ecf891001c184d4201532c3d01](https://github.com/sagemath/sagetrac-mirror/commit/f9da27b2e6e3a5ecf891001c184d4201532c3d01)\" to \"[05c24f30ee469274039f95ca59d4f7232d339134](https://github.com/sagemath/sagetrac-mirror/commit/05c24f30ee469274039f95ca59d4f7232d339134)\".",
    "created_at": "2015-11-19T05:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273179",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f9da27b2e6e3a5ecf891001c184d4201532c3d01](https://github.com/sagemath/sagetrac-mirror/commit/f9da27b2e6e3a5ecf891001c184d4201532c3d01)" to "[05c24f30ee469274039f95ca59d4f7232d339134](https://github.com/sagemath/sagetrac-mirror/commit/05c24f30ee469274039f95ca59d4f7232d339134)".



---

archive/issue_comments_273180.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecdaf6cd52b5e6f0c67277fd696193d4fde29cb3\">ecdaf6c</a></td><td><code>Initial ground work and \\delta map.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b0ccdeff8b4a5de9df5142c7ca9c1c480275cfd\">0b0ccde</a></td><td><code>Added reverse bijection for B^{1,1} of E_6^{(1)}.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6298f7007d255fce470f8043b000063730cd75c3\">6298f70</a></td><td><code>Fixing type B bijection.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52140d4ee1215ade373560644e18e4197d0c8966\">52140d4</a></td><td><code>Fixing all of the problems from the refactoring of RC -> KRT bijection.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/135648ebd09106cc41c8505ea593088215212872\">135648e</a></td><td><code>Doing some more refactoring and doing some work for E_{6,7}.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3166a99df70725f783143f57fb6f5dd79a41543e\">3166a99</a></td><td><code>Finalizing E_{6,7}^{(1)} bijection and fixing a doctest from the refactoring.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05c24f30ee469274039f95ca59d4f7232d339134\">05c24f3</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of trac.sagemath.org:sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr></table>\n",
    "created_at": "2015-11-19T05:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecdaf6cd52b5e6f0c67277fd696193d4fde29cb3">ecdaf6c</a></td><td><code>Initial ground work and \delta map.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b0ccdeff8b4a5de9df5142c7ca9c1c480275cfd">0b0ccde</a></td><td><code>Added reverse bijection for B^{1,1} of E_6^{(1)}.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6298f7007d255fce470f8043b000063730cd75c3">6298f70</a></td><td><code>Fixing type B bijection.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52140d4ee1215ade373560644e18e4197d0c8966">52140d4</a></td><td><code>Fixing all of the problems from the refactoring of RC -> KRT bijection.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/135648ebd09106cc41c8505ea593088215212872">135648e</a></td><td><code>Doing some more refactoring and doing some work for E_{6,7}.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3166a99df70725f783143f57fb6f5dd79a41543e">3166a99</a></td><td><code>Finalizing E_{6,7}^{(1)} bijection and fixing a doctest from the refactoring.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05c24f30ee469274039f95ca59d4f7232d339134">05c24f3</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of trac.sagemath.org:sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr></table>




---

archive/issue_comments_273181.json:
```json
{
    "body": "**Changing commit** from \"[05c24f30ee469274039f95ca59d4f7232d339134](https://github.com/sagemath/sagetrac-mirror/commit/05c24f30ee469274039f95ca59d4f7232d339134)\" to \"[7de002b3f7026fefca92a48cfc32c963a8ec38f7](https://github.com/sagemath/sagetrac-mirror/commit/7de002b3f7026fefca92a48cfc32c963a8ec38f7)\".",
    "created_at": "2015-11-19T05:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[05c24f30ee469274039f95ca59d4f7232d339134](https://github.com/sagemath/sagetrac-mirror/commit/05c24f30ee469274039f95ca59d4f7232d339134)" to "[7de002b3f7026fefca92a48cfc32c963a8ec38f7](https://github.com/sagemath/sagetrac-mirror/commit/7de002b3f7026fefca92a48cfc32c963a8ec38f7)".



---

archive/issue_comments_273182.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7de002b3f7026fefca92a48cfc32c963a8ec38f7\">7de002b</a></td><td><code>Generate the Kleber tree by using integral points in a polytope.</code></td></tr></table>\n",
    "created_at": "2015-11-19T05:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7de002b3f7026fefca92a48cfc32c963a8ec38f7">7de002b</a></td><td><code>Generate the Kleber tree by using integral points in a polytope.</code></td></tr></table>




---

archive/issue_events_175049.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-11-19T05:52:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175049"
}
```



---

archive/issue_events_175050.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-11-19T05:52:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175050"
}
```



---

archive/issue_comments_273183.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f28d76c9f34fe024e14ea1384157f3c38a3c563\">0f28d76</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of trac.sagemath.org:sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98a04064d53d4bacf209b8d7380f7e9bb2e539f1\">98a0406</a></td><td><code>Converting to weight/root lattice and using the old method for types A and D.</code></td></tr></table>\n",
    "created_at": "2015-12-21T03:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f28d76c9f34fe024e14ea1384157f3c38a3c563">0f28d76</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of trac.sagemath.org:sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98a04064d53d4bacf209b8d7380f7e9bb2e539f1">98a0406</a></td><td><code>Converting to weight/root lattice and using the old method for types A and D.</code></td></tr></table>




---

archive/issue_comments_273184.json:
```json
{
    "body": "**Changing commit** from \"[7de002b3f7026fefca92a48cfc32c963a8ec38f7](https://github.com/sagemath/sagetrac-mirror/commit/7de002b3f7026fefca92a48cfc32c963a8ec38f7)\" to \"[98a04064d53d4bacf209b8d7380f7e9bb2e539f1](https://github.com/sagemath/sagetrac-mirror/commit/98a04064d53d4bacf209b8d7380f7e9bb2e539f1)\".",
    "created_at": "2015-12-21T03:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7de002b3f7026fefca92a48cfc32c963a8ec38f7](https://github.com/sagemath/sagetrac-mirror/commit/7de002b3f7026fefca92a48cfc32c963a8ec38f7)" to "[98a04064d53d4bacf209b8d7380f7e9bb2e539f1](https://github.com/sagemath/sagetrac-mirror/commit/98a04064d53d4bacf209b8d7380f7e9bb2e539f1)".



---

archive/issue_comments_273185.json:
```json
{
    "body": "**Changing commit** from \"[98a04064d53d4bacf209b8d7380f7e9bb2e539f1](https://github.com/sagemath/sagetrac-mirror/commit/98a04064d53d4bacf209b8d7380f7e9bb2e539f1)\" to \"[33af86e92c739daf4adfce96c3bb3752974bb1e6](https://github.com/sagemath/sagetrac-mirror/commit/33af86e92c739daf4adfce96c3bb3752974bb1e6)\".",
    "created_at": "2015-12-21T03:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[98a04064d53d4bacf209b8d7380f7e9bb2e539f1](https://github.com/sagemath/sagetrac-mirror/commit/98a04064d53d4bacf209b8d7380f7e9bb2e539f1)" to "[33af86e92c739daf4adfce96c3bb3752974bb1e6](https://github.com/sagemath/sagetrac-mirror/commit/33af86e92c739daf4adfce96c3bb3752974bb1e6)".



---

archive/issue_comments_273186.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33af86e92c739daf4adfce96c3bb3752974bb1e6\">33af86e</a></td><td><code>Tweak the conditions for switching between algorithms just in terms of the rank.</code></td></tr></table>\n",
    "created_at": "2015-12-21T03:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33af86e92c739daf4adfce96c3bb3752974bb1e6">33af86e</a></td><td><code>Tweak the conditions for switching between algorithms just in terms of the rank.</code></td></tr></table>




---

archive/issue_comments_273187.json:
```json
{
    "body": "<a id='comment:8'></a>\nFrom doing some more testing, as soon as the rank hits 7, the children iterator by using integer points of polytopes is faster than going over all possible up roots. I'm fairly certain this will hold true for all cases as this was true for even small examples in type A (the `use_uproot` was just an extra parameter I added for testing):\n\n```\nsage: from sage.combinat.rigged_configurations.kleber_tree import KleberTree\nsage: %time K = KleberTree(['A',7,1], [[1,6],[1,1]], use_uproot=True)\nCPU times: user 51.3 ms, sys: 8.19 ms, total: 59.5 ms\nWall time: 56.4 ms\nsage: %time K = KleberTree(['A',7,1], [[1,6],[1,1]], use_uproot=False)\nCPU times: user 14.6 ms, sys: 695 \u00b5s, total: 15.3 ms\nWall time: 13.4 ms\nsage: %time K = KleberTree(['A',7,1], [[1,3],[1,1]], use_uproot=True)\nCPU times: user 12.6 ms, sys: 139 \u00b5s, total: 12.8 ms\nWall time: 11.2 ms\nsage: %time K = KleberTree(['A',7,1], [[1,3],[1,1]], use_uproot=False)\nCPU times: user 8.66 ms, sys: 182 \u00b5s, total: 8.84 ms\nWall time: 8.12 ms\n```",
    "created_at": "2015-12-21T03:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273187",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
From doing some more testing, as soon as the rank hits 7, the children iterator by using integer points of polytopes is faster than going over all possible up roots. I'm fairly certain this will hold true for all cases as this was true for even small examples in type A (the `use_uproot` was just an extra parameter I added for testing):

```
sage: from sage.combinat.rigged_configurations.kleber_tree import KleberTree
sage: %time K = KleberTree(['A',7,1], [[1,6],[1,1]], use_uproot=True)
CPU times: user 51.3 ms, sys: 8.19 ms, total: 59.5 ms
Wall time: 56.4 ms
sage: %time K = KleberTree(['A',7,1], [[1,6],[1,1]], use_uproot=False)
CPU times: user 14.6 ms, sys: 695 µs, total: 15.3 ms
Wall time: 13.4 ms
sage: %time K = KleberTree(['A',7,1], [[1,3],[1,1]], use_uproot=True)
CPU times: user 12.6 ms, sys: 139 µs, total: 12.8 ms
Wall time: 11.2 ms
sage: %time K = KleberTree(['A',7,1], [[1,3],[1,1]], use_uproot=False)
CPU times: user 8.66 ms, sys: 182 µs, total: 8.84 ms
Wall time: 8.12 ms
```



---

archive/issue_comments_273188.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99c26b0851f9baffef7a1f096b09b4b30a4a5ade\">99c26b0</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of trac.sagemath.org:sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f333b872f56f34d7f126104bc1d95fc4142967b\">1f333b8</a></td><td><code>Use normaliz when available.</code></td></tr></table>\n",
    "created_at": "2017-02-05T04:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273188",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99c26b0851f9baffef7a1f096b09b4b30a4a5ade">99c26b0</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of trac.sagemath.org:sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f333b872f56f34d7f126104bc1d95fc4142967b">1f333b8</a></td><td><code>Use normaliz when available.</code></td></tr></table>




---

archive/issue_comments_273189.json:
```json
{
    "body": "**Changing commit** from \"[33af86e92c739daf4adfce96c3bb3752974bb1e6](https://github.com/sagemath/sagetrac-mirror/commit/33af86e92c739daf4adfce96c3bb3752974bb1e6)\" to \"[1f333b872f56f34d7f126104bc1d95fc4142967b](https://github.com/sagemath/sagetrac-mirror/commit/1f333b872f56f34d7f126104bc1d95fc4142967b)\".",
    "created_at": "2017-02-05T04:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[33af86e92c739daf4adfce96c3bb3752974bb1e6](https://github.com/sagemath/sagetrac-mirror/commit/33af86e92c739daf4adfce96c3bb3752974bb1e6)" to "[1f333b872f56f34d7f126104bc1d95fc4142967b](https://github.com/sagemath/sagetrac-mirror/commit/1f333b872f56f34d7f126104bc1d95fc4142967b)".



---

archive/issue_comments_273190.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis is blazingly fast with normaliz (i.e. with the optional spkg `pynormaliz`):\n\n```\nsage: %time [len(RiggedConfigurations(['E',8,1], [[r,1]]).module_generators) for r in [1,.\n....: .,8]]\nCPU times: user 16.4 s, sys: 32 ms, total: 16.4 s\nWall time: 3.37 s\n[3, 7, 24, 368, 75, 18, 5, 2]\n```\nWithout it, the B<sup>4,1</sup> takes longer than I want to wait for it (and nearly impossible without this branch).",
    "created_at": "2017-02-05T04:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273190",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
This is blazingly fast with normaliz (i.e. with the optional spkg `pynormaliz`):

```
sage: %time [len(RiggedConfigurations(['E',8,1], [[r,1]]).module_generators) for r in [1,.
....: .,8]]
CPU times: user 16.4 s, sys: 32 ms, total: 16.4 s
Wall time: 3.37 s
[3, 7, 24, 368, 75, 18, 5, 2]
```
Without it, the B<sup>4,1</sup> takes longer than I want to wait for it (and nearly impossible without this branch).



---

archive/issue_events_175051.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-02-05T04:09:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175051"
}
```



---

archive/issue_events_175052.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-02-05T04:09:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175052"
}
```



---

archive/issue_comments_273191.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Currently, generating the first level of the Kleber tree grows poorly as the rank and the complexity of the root system increases. This is due to the fact that it uses all positive roots. Instead we use integral points (when expressed as simple roots) in the intersection of the negative root cone and a shifted positive weight cone.\n \n-Also due to the number of operations involved, this ticket changes all lower levels to use the polytope enumeration as well.\n+Also due to the number of operations involved, this ticket changes all lower levels to use the polytope enumeration for small rank unless normaliz is available.\n``````\n",
    "created_at": "2017-02-05T04:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273191",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Currently, generating the first level of the Kleber tree grows poorly as the rank and the complexity of the root system increases. This is due to the fact that it uses all positive roots. Instead we use integral points (when expressed as simple roots) in the intersection of the negative root cone and a shifted positive weight cone.
 
-Also due to the number of operations involved, this ticket changes all lower levels to use the polytope enumeration as well.
+Also due to the number of operations involved, this ticket changes all lower levels to use the polytope enumeration for small rank unless normaliz is available.
``````




---

archive/issue_comments_273192.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm getting doctest errors in a few places:\n\n```\n----------------------------------------------------------------------\nsage -t --long src/sage/misc/sagedoc.py  # 3 doctests failed\nsage -t --long src/sage/combinat/rigged_configurations/rigged_configurations.py  # 1 doctest failed\nsage -t --long src/sage/combinat/posets/posets.py  # 1 doctest failed\nsage -t --long src/sage/combinat/rigged_configurations/kleber_tree.py  # 13 doctests failed\nsage -t --long src/sage/combinat/crystals/tensor_product.py  # 1 doctest failed\nsage -t --long src/sage/combinat/rigged_configurations/tensor_product_kr_tableaux_element.py  # 3 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 3348.8 seconds\n    cpu time: 20669.5 seconds\n    cumulative wall time: 26249.8 seconds\n```\n\nNote this is after the merge with the latest develop branch.",
    "created_at": "2017-05-03T13:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273192",
    "user": "https://github.com/bsalisbury1"
}
```

<a id='comment:11'></a>
I'm getting doctest errors in a few places:

```
----------------------------------------------------------------------
sage -t --long src/sage/misc/sagedoc.py  # 3 doctests failed
sage -t --long src/sage/combinat/rigged_configurations/rigged_configurations.py  # 1 doctest failed
sage -t --long src/sage/combinat/posets/posets.py  # 1 doctest failed
sage -t --long src/sage/combinat/rigged_configurations/kleber_tree.py  # 13 doctests failed
sage -t --long src/sage/combinat/crystals/tensor_product.py  # 1 doctest failed
sage -t --long src/sage/combinat/rigged_configurations/tensor_product_kr_tableaux_element.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 3348.8 seconds
    cpu time: 20669.5 seconds
    cumulative wall time: 26249.8 seconds
```

Note this is after the merge with the latest develop branch.



---

archive/issue_comments_273193.json:
```json
{
    "body": "**Reviewer:** Ben Salisbury",
    "created_at": "2017-05-03T13:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273193",
    "user": "https://github.com/bsalisbury1"
}
```

**Reviewer:** Ben Salisbury



---

archive/issue_events_175053.json:
```json
{
    "actor": "https://github.com/bsalisbury1",
    "created_at": "2017-05-03T13:43:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175053"
}
```



---

archive/issue_events_175054.json:
```json
{
    "actor": "https://github.com/bsalisbury1",
    "created_at": "2017-05-03T13:43:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175054"
}
```



---

archive/issue_comments_273194.json:
```json
{
    "body": "<a id='comment:12'></a>\nSo the problem is with the normaliz interface. This is now #22938.",
    "created_at": "2017-05-03T15:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273194",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
So the problem is with the normaliz interface. This is now #22938.



---

archive/issue_comments_273195.json:
```json
{
    "body": "**Dependencies:** #22938",
    "created_at": "2017-05-03T15:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273195",
    "user": "https://github.com/tscrim"
}
```

**Dependencies:** #22938



---

archive/issue_comments_273196.json:
```json
{
    "body": "**Changing commit** from \"[1f333b872f56f34d7f126104bc1d95fc4142967b](https://github.com/sagemath/sagetrac-mirror/commit/1f333b872f56f34d7f126104bc1d95fc4142967b)\" to \"[5aafe4e2daf41f9bfc464c69098d71f849ffd41a](https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a)\".",
    "created_at": "2017-05-03T15:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273196",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1f333b872f56f34d7f126104bc1d95fc4142967b](https://github.com/sagemath/sagetrac-mirror/commit/1f333b872f56f34d7f126104bc1d95fc4142967b)" to "[5aafe4e2daf41f9bfc464c69098d71f849ffd41a](https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a)".



---

archive/issue_comments_273197.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7d8f40f362a67ccb2cb394aa1b6ede6425889d2\">a7d8f40</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of git://trac.sagemath.org/sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa9f25855b6d72f7010c2f6241f0737d306b7237\">aa9f258</a></td><td><code>Fixing integral points for a non-empty polytope with trivial integral hull.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a\">5aafe4e</a></td><td><code>Merge branch 'public/geometry/integral_points_empty_hull_normaliz-22938' into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr></table>\n",
    "created_at": "2017-05-03T15:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7d8f40f362a67ccb2cb394aa1b6ede6425889d2">a7d8f40</a></td><td><code>Merge branch 'public/rigged_configurations/speedup_kleber_tree-19075' of git://trac.sagemath.org/sage into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa9f25855b6d72f7010c2f6241f0737d306b7237">aa9f258</a></td><td><code>Fixing integral points for a non-empty polytope with trivial integral hull.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a">5aafe4e</a></td><td><code>Merge branch 'public/geometry/integral_points_empty_hull_normaliz-22938' into public/rigged_configurations/speedup_kleber_tree-19075</code></td></tr></table>




---

archive/issue_comments_273198.json:
```json
{
    "body": "<a id='comment:14'></a>\nTry it with this.",
    "created_at": "2017-05-03T15:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273198",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Try it with this.



---

archive/issue_comments_273199.json:
```json
{
    "body": "<a id='comment:15'></a>\nHTML and PDF docs build and all tests passed on my machine.\n\nOne question/comment before giving a positive review:  Should the following tests have the `#long time` tag removed?\n\n```\nsage: from sage.combinat.rigged_configurations.kleber_tree import KleberTree\nsage: KT = KleberTree(['E', 6, 1], [[4, 2]])  # long time (9s on sage.math, 2012)\nsage: KT.cardinality()  # long time\n12\n```\n\nBoth of these calculations are now immediate with this update.",
    "created_at": "2017-05-05T00:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273199",
    "user": "https://github.com/bsalisbury1"
}
```

<a id='comment:15'></a>
HTML and PDF docs build and all tests passed on my machine.

One question/comment before giving a positive review:  Should the following tests have the `#long time` tag removed?

```
sage: from sage.combinat.rigged_configurations.kleber_tree import KleberTree
sage: KT = KleberTree(['E', 6, 1], [[4, 2]])  # long time (9s on sage.math, 2012)
sage: KT.cardinality()  # long time
12
```

Both of these calculations are now immediate with this update.



---

archive/issue_comments_273200.json:
```json
{
    "body": "<a id='comment:16'></a>\nI think they are only immediate when using `normaliz`, so I'm not yet ready to remove them.",
    "created_at": "2017-05-05T01:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273200",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
I think they are only immediate when using `normaliz`, so I'm not yet ready to remove them.



---

archive/issue_events_175055.json:
```json
{
    "actor": "https://github.com/bsalisbury1",
    "created_at": "2017-05-05T14:26:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175055"
}
```



---

archive/issue_events_175056.json:
```json
{
    "actor": "https://github.com/bsalisbury1",
    "created_at": "2017-05-05T14:26:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175056"
}
```



---

archive/issue_events_175057.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-11T21:58:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175057"
}
```



---

archive/issue_events_175058.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-11T21:58:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19075#event-175058"
}
```



---

archive/issue_comments_273201.json:
```json
{
    "body": "**Changing branch** from \"[public/rigged_configurations/speedup_kleber_tree-19075](https://github.com/sagemath/sagetrac-mirror/tree/public/rigged_configurations/speedup_kleber_tree-19075)\" to \"[5aafe4e2daf41f9bfc464c69098d71f849ffd41a](https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a)\".",
    "created_at": "2017-05-11T21:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19075#issuecomment-273201",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/rigged_configurations/speedup_kleber_tree-19075](https://github.com/sagemath/sagetrac-mirror/tree/public/rigged_configurations/speedup_kleber_tree-19075)" to "[5aafe4e2daf41f9bfc464c69098d71f849ffd41a](https://github.com/sagemath/sagetrac-mirror/commit/5aafe4e2daf41f9bfc464c69098d71f849ffd41a)".
