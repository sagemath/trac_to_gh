# Issue 19561: enforce Sage integers in Krawtchouk

archive/issues_019324.json:
```json
{
    "body": "see https://groups.google.com/d/msg/sage-support/I7BAQTnS_mY/8G9s-6N1AwAJ\n\nif input parameters are `int`, division in the loop will get ugly\n\nCC:  @nbruin @ppurka\n\nBranch/Commit: 2fe6d982557ea6a0aa9479a2d737905d3d90ffca\n\nReviewer: Punarbasu Purkayastha\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19561\n\n",
    "closed_at": "2015-11-12T22:44:27Z",
    "created_at": "2015-11-09T19:39:23Z",
    "labels": [
        "component: coding theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "enforce Sage integers in Krawtchouk",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19561",
    "user": "https://github.com/dimpase"
}
```
see https://groups.google.com/d/msg/sage-support/I7BAQTnS_mY/8G9s-6N1AwAJ

if input parameters are `int`, division in the loop will get ugly

CC:  @nbruin @ppurka

Branch/Commit: 2fe6d982557ea6a0aa9479a2d737905d3d90ffca

Reviewer: Punarbasu Purkayastha

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19561





---

archive/issue_comments_351041.json:
```json
{
    "body": "Changing commit from \"\" to \"55236c20137ebf47f83b16359195480d9dc91e54\"",
    "created_at": "2015-11-09T23:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351041",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "" to "55236c20137ebf47f83b16359195480d9dc91e54"



---

archive/issue_comments_351042.json:
```json
{
    "body": "<a id='comment:1'></a>should add a doctest...\n\n---\nNew commits:",
    "created_at": "2015-11-09T23:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351042",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>should add a doctest...

---
New commits:



---

archive/issue_comments_351043.json:
```json
{
    "body": "Changing author from \"\" to \"Dima Pasechnik\"",
    "created_at": "2015-11-09T23:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351043",
    "user": "https://github.com/dimpase"
}
```

Changing author from "" to "Dima Pasechnik"



---

archive/issue_comments_351044.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dimpase/krawfix\"",
    "created_at": "2015-11-09T23:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351044",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "" to "u/dimpase/krawfix"



---

archive/issue_comments_351045.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-09T23:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351045",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_351046.json:
```json
{
    "body": "Changing commit from \"55236c20137ebf47f83b16359195480d9dc91e54\" to \"2f84990f7fce7da69f705e60ad155fe68f3a0eac\"",
    "created_at": "2015-11-09T23:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "55236c20137ebf47f83b16359195480d9dc91e54" to "2f84990f7fce7da69f705e60ad155fe68f3a0eac"



---

archive/issue_comments_351047.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-09T23:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351047",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_351048.json:
```json
{
    "body": "Changing commit from \"2f84990f7fce7da69f705e60ad155fe68f3a0eac\" to \"6e0164088d20a33dab253f728bb144b80dfcf5f5\"",
    "created_at": "2015-11-09T23:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351048",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2f84990f7fce7da69f705e60ad155fe68f3a0eac" to "6e0164088d20a33dab253f728bb144b80dfcf5f5"



---

archive/issue_comments_351049.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-09T23:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_351050.json:
```json
{
    "body": "<a id='comment:5'></a>Hi Dima,\n\n  Can you let n,q,i alone and just keep the changes\n`l = ZZ(l)` and\n`for j in srange(1,l+1):`\n\n  These changes should be enough to ensure that the correct coercions take place and the division does not become an integer division. I will send you a document from Matti Aaltonen which shows that almost all properties of Krawtchouks hold even for noninteger n,q,i. Alternatively, you can refer to his paper \"A new upper bound on nonbinary block codes\", M. Aaltonen, Discrete Maths, 83 (1990), 139-160.\n\nbasu.",
    "created_at": "2015-11-10T13:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351050",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:5'></a>Hi Dima,

  Can you let n,q,i alone and just keep the changes
`l = ZZ(l)` and
`for j in srange(1,l+1):`

  These changes should be enough to ensure that the correct coercions take place and the division does not become an integer division. I will send you a document from Matti Aaltonen which shows that almost all properties of Krawtchouks hold even for noninteger n,q,i. Alternatively, you can refer to his paper "A new upper bound on nonbinary block codes", M. Aaltonen, Discrete Maths, 83 (1990), 139-160.

basu.



---

archive/issue_comments_351051.json:
```json
{
    "body": "Changing commit from \"6e0164088d20a33dab253f728bb144b80dfcf5f5\" to \"77da78e91b809e246e060d4c2352a5991a4e8fdd\"",
    "created_at": "2015-11-10T17:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6e0164088d20a33dab253f728bb144b80dfcf5f5" to "77da78e91b809e246e060d4c2352a5991a4e8fdd"



---

archive/issue_comments_351052.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-10T17:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_351053.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 ppurka]:\n> Hi Dima,\n> \n>   Can you let n,q,i alone and just keep the changes\n> `l = ZZ(l)` and\n> `for j in srange(1,l+1):`\n\n\nOK, done. I also renamed i to x, to make it look more like a polynomial...",
    "created_at": "2015-11-10T17:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351053",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>Replying to [comment:5 ppurka]:
> Hi Dima,
> 
>   Can you let n,q,i alone and just keep the changes
> `l = ZZ(l)` and
> `for j in srange(1,l+1):`


OK, done. I also renamed i to x, to make it look more like a polynomial...



---

archive/issue_comments_351054.json:
```json
{
    "body": "<a id='comment:8'></a>I am not sure that the implementation is correct for the case where all these parameters are non-integer. It seems that sometimes the sum must become infinite...",
    "created_at": "2015-11-11T08:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351054",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>I am not sure that the implementation is correct for the case where all these parameters are non-integer. It seems that sometimes the sum must become infinite...



---

archive/issue_comments_351055.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 dimpase]:\n> I am not sure that the implementation is correct for the case where all these parameters are non-integer. It seems that sometimes the sum must become infinite...\n\n\nOK, I see; we should add the generating function definition of `K` to the documentation...",
    "created_at": "2015-11-11T09:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351055",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:8 dimpase]:
> I am not sure that the implementation is correct for the case where all these parameters are non-integer. It seems that sometimes the sum must become infinite...


OK, I see; we should add the generating function definition of `K` to the documentation...



---

archive/issue_comments_351056.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-11T11:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351056",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_351057.json:
```json
{
    "body": "Changing commit from \"77da78e91b809e246e060d4c2352a5991a4e8fdd\" to \"c666743894f8b1412362fb3f0b425b6290801b42\"",
    "created_at": "2015-11-11T11:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351057",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "77da78e91b809e246e060d4c2352a5991a4e8fdd" to "c666743894f8b1412362fb3f0b425b6290801b42"



---

archive/issue_comments_351058.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-11T11:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351058",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_351059.json:
```json
{
    "body": "Changing commit from \"c666743894f8b1412362fb3f0b425b6290801b42\" to \"2dfdcfed2e78dda3e0b20d4e09f2e0494e98b562\"",
    "created_at": "2015-11-11T11:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c666743894f8b1412362fb3f0b425b6290801b42" to "2dfdcfed2e78dda3e0b20d4e09f2e0494e98b562"



---

archive/issue_comments_351060.json:
```json
{
    "body": "<a id='comment:12'></a>Can you apply this patch? Otherwise the rest looks good:\n\n```diff\ndiff --git a/src/sage/coding/delsarte_bounds.py b/src/sage/coding/delsarte_bounds.py\nindex b4f05b6..cd78e3c 100644\n--- a/src/sage/coding/delsarte_bounds.py\n+++ b/src/sage/coding/delsarte_bounds.py\n@@ -21,7 +21,7 @@ def Krawtchouk(n,q,l,x,check=True):\n     Compute ``K^{n,q}_l(x)``, the Krawtchouk polynomial.\n \n     See :wikipedia:`Kravchuk_polynomials`; It is defined by the generating function\n-    `(1-(q-1)z)^{n-x}(1-z)^k=\\sum_{l} K^{n,q}_k(x)z^l` and is equal to\n+    `(1+(q-1)z)^{n-x}(1-z)^x=\\sum_{l} K^{n,q}_l(x)z^l` and is equal to\n \n     .. math::\n \n@@ -45,7 +45,7 @@ def Krawtchouk(n,q,l,x,check=True):\n \n     TESTS:\n \n-    check that the bug reported on #19561 is fixed::\n+    check that the bug reported on :trac:`19561` is fixed::\n \n         sage: Krawtchouk(3,2,3,3)\n         -1\n```\n\nEDIT: Fixed another typo.",
    "created_at": "2015-11-12T11:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351060",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:12'></a>Can you apply this patch? Otherwise the rest looks good:

```diff
diff --git a/src/sage/coding/delsarte_bounds.py b/src/sage/coding/delsarte_bounds.py
index b4f05b6..cd78e3c 100644
--- a/src/sage/coding/delsarte_bounds.py
+++ b/src/sage/coding/delsarte_bounds.py
@@ -21,7 +21,7 @@ def Krawtchouk(n,q,l,x,check=True):
     Compute ``K^{n,q}_l(x)``, the Krawtchouk polynomial.
 
     See :wikipedia:`Kravchuk_polynomials`; It is defined by the generating function
-    `(1-(q-1)z)^{n-x}(1-z)^k=\sum_{l} K^{n,q}_k(x)z^l` and is equal to
+    `(1+(q-1)z)^{n-x}(1-z)^x=\sum_{l} K^{n,q}_l(x)z^l` and is equal to
 
     .. math::
 
@@ -45,7 +45,7 @@ def Krawtchouk(n,q,l,x,check=True):
 
     TESTS:
 
-    check that the bug reported on #19561 is fixed::
+    check that the bug reported on :trac:`19561` is fixed::
 
         sage: Krawtchouk(3,2,3,3)
         -1
```

EDIT: Fixed another typo.



---

archive/issue_comments_351061.json:
```json
{
    "body": "<a id='comment:13'></a>Fixed another typo.. `1+(q-1)z`",
    "created_at": "2015-11-12T11:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351061",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:13'></a>Fixed another typo.. `1+(q-1)z`



---

archive/issue_comments_351062.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-12T12:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351062",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_351063.json:
```json
{
    "body": "Changing commit from \"2dfdcfed2e78dda3e0b20d4e09f2e0494e98b562\" to \"333df741f014e41723c02bad68eb966feea26c4b\"",
    "created_at": "2015-11-12T12:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2dfdcfed2e78dda3e0b20d4e09f2e0494e98b562" to "333df741f014e41723c02bad68eb966feea26c4b"



---

archive/issue_comments_351064.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 ppurka]:\n> Fixed another typo.. `1+(q-1)z`\n\n\nOK, all done",
    "created_at": "2015-11-12T12:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351064",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>Replying to [comment:13 ppurka]:
> Fixed another typo.. `1+(q-1)z`


OK, all done



---

archive/issue_comments_351065.json:
```json
{
    "body": "<a id='comment:16'></a>Sorry, `:trac:19561` is missing the single backticks!",
    "created_at": "2015-11-12T13:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351065",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:16'></a>Sorry, `:trac:19561` is missing the single backticks!



---

archive/issue_comments_351066.json:
```json
{
    "body": "Changing commit from \"333df741f014e41723c02bad68eb966feea26c4b\" to \"2fe6d982557ea6a0aa9479a2d737905d3d90ffca\"",
    "created_at": "2015-11-12T13:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "333df741f014e41723c02bad68eb966feea26c4b" to "2fe6d982557ea6a0aa9479a2d737905d3d90ffca"



---

archive/issue_comments_351067.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T13:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_351068.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Punarbasu Purkayastha\"",
    "created_at": "2015-11-12T13:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351068",
    "user": "https://github.com/ppurka"
}
```

Changing reviewer from "" to "Punarbasu Purkayastha"



---

archive/issue_comments_351069.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-12T13:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351069",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_351070.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-12T22:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351070",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053843.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-12T22:44:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19561#event-53843"
}
```



---

archive/issue_comments_351071.json:
```json
{
    "body": "Changing branch from \"u/dimpase/krawfix\" to \"2fe6d982557ea6a0aa9479a2d737905d3d90ffca\"",
    "created_at": "2015-11-12T22:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19561#issuecomment-351071",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dimpase/krawfix" to "2fe6d982557ea6a0aa9479a2d737905d3d90ffca"
