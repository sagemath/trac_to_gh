# Issue 19172: More capable method `valuation` for polynomials

archive/issues_018935.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis ticket aims at improving the method `valuation` for polynomials in two ways:\n\n1. The method `valuation` for dense polynomials can be called in the following ways:\n   * Without argument, return the largest power of the variable that divides the input polynomial.\n   * With a polynomial (with the same parent) as argument, return the largest power of this polynomial which divides the input polynomial.\n\n   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the coefficients. This is consistent with PARI.\n\n2. The method `valuation` for sparse polynomials is much less capable than the method for dense polynomials. I propose to have the same behaviors in both cases.\n\nDepends on #19171\n\nComponent: **commutative algebra**\n\nKeywords: **polynomial**\n\nWork Issues: **Rebase**\n\nAuthor: **Bruno Grenet**\n\nBranch/Commit: **[u/roed/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/t19172_valuation) @ [`aa040dc`](https://github.com/sagemath/sagetrac-mirror/commit/aa040dca8974d3ae8c50d1694957fee0d2c6b0d4)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/19172_\n\n",
    "created_at": "2015-09-09T09:33:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "More capable method `valuation` for polynomials",
    "type": "issue",
    "updated_at": "2022-12-29T01:40:01Z",
    "url": "https://github.com/sagemath/sage/issues/19172",
    "user": "https://github.com/bgrenet"
}
```
<div id="comment:0"></div>

This ticket aims at improving the method `valuation` for polynomials in two ways:

1. The method `valuation` for dense polynomials can be called in the following ways:
   * Without argument, return the largest power of the variable that divides the input polynomial.
   * With a polynomial (with the same parent) as argument, return the largest power of this polynomial which divides the input polynomial.

   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the coefficients. This is consistent with PARI.

2. The method `valuation` for sparse polynomials is much less capable than the method for dense polynomials. I propose to have the same behaviors in both cases.

Depends on #19171

Component: **commutative algebra**

Keywords: **polynomial**

Work Issues: **Rebase**

Author: **Bruno Grenet**

Branch/Commit: **[u/roed/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/t19172_valuation) @ [`aa040dc`](https://github.com/sagemath/sagetrac-mirror/commit/aa040dca8974d3ae8c50d1694957fee0d2c6b0d4)**

_Issue created by migration from https://trac.sagemath.org/ticket/19172_





---

archive/issue_events_269788.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-09-09T09:33:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269788"
}
```



---

archive/issue_events_269789.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-09-09T09:33:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "c: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269789"
}
```



---

archive/issue_events_269790.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-09-09T09:33:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269790"
}
```



---

archive/issue_events_269791.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2015-09-09T09:33:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269791"
}
```



---

archive/issue_comments_271319.json:
```json
{
    "body": "Branch: **[u/bruno/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/t19172_valuation)**",
    "created_at": "2015-10-12T12:42:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271319",
    "user": "https://github.com/bgrenet"
}
```

Branch: **[u/bruno/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/t19172_valuation)**



---

archive/issue_comments_271320.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a189c7bdc29953d6ada184f7b0db503c6da4677\"><code>9a189c7</code></a></td><td><code>#19171: New method divides</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62df3272f47b0cea860ab090a2a730bf033afc06\"><code>62df327</code></a></td><td><code>#19172: Improve valuation for dense polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66709eb884fcd888b059aa5fa0a221d95c20cbc0\"><code>66709eb</code></a></td><td><code>#19172: Improve valuation for sparse polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/992ee7afc702ca261d25706efb103db27518483d\"><code>992ee7a</code></a></td><td><code>#19172: Add valuation for multipolynomials</code></td></tr></table>\n",
    "created_at": "2016-06-10T13:44:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271320",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a189c7bdc29953d6ada184f7b0db503c6da4677"><code>9a189c7</code></a></td><td><code>#19171: New method divides</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62df3272f47b0cea860ab090a2a730bf033afc06"><code>62df327</code></a></td><td><code>#19172: Improve valuation for dense polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66709eb884fcd888b059aa5fa0a221d95c20cbc0"><code>66709eb</code></a></td><td><code>#19172: Improve valuation for sparse polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/992ee7afc702ca261d25706efb103db27518483d"><code>992ee7a</code></a></td><td><code>#19172: Add valuation for multipolynomials</code></td></tr></table>




---

archive/issue_comments_271321.json:
```json
{
    "body": "Commit: **[`992ee7a`](https://github.com/sagemath/sagetrac-mirror/commit/992ee7afc702ca261d25706efb103db27518483d)**",
    "created_at": "2016-06-10T13:44:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271321",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`992ee7a`](https://github.com/sagemath/sagetrac-mirror/commit/992ee7afc702ca261d25706efb103db27518483d)**



---

archive/issue_comments_271322.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d03a75e648111aa38b0059e571f9536b6f5c2152\"><code>d03a75e</code></a></td><td><code>#19171: New method divides</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac43c02c86eb8884bc3d7fa4013f78aef1e34803\"><code>ac43c02</code></a></td><td><code>19171: Use coerce_binop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0906dfd9801e14acab59d28999fe1778d3cc018d\"><code>0906dfd</code></a></td><td><code>19171: Add more involved example + move a line</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04b0032caff9204e2c3f7529ae6e56b8a98a2b1e\"><code>04b0032</code></a></td><td><code>Merge branch 'develop' into 19171_divides_poly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f85a7e06a7591101005f5e61fff674033344e103\"><code>f85a7e0</code></a></td><td><code>19171: conflict resolution</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0a5badfad9472555eb9b66776ae99ba99416047\"><code>a0a5bad</code></a></td><td><code>Merge branch 'u/bruno/t19171_divides_poly' of git://trac.sagemath.org/sage into 19171_divides_poly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a548adcf9a998a78254ba98df730b1311e9d559\"><code>9a548ad</code></a></td><td><code>Merge branch '19171_divides_poly' into 19172_valuation</code></td></tr></table>\n",
    "created_at": "2017-07-25T14:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271322",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d03a75e648111aa38b0059e571f9536b6f5c2152"><code>d03a75e</code></a></td><td><code>#19171: New method divides</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac43c02c86eb8884bc3d7fa4013f78aef1e34803"><code>ac43c02</code></a></td><td><code>19171: Use coerce_binop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0906dfd9801e14acab59d28999fe1778d3cc018d"><code>0906dfd</code></a></td><td><code>19171: Add more involved example + move a line</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04b0032caff9204e2c3f7529ae6e56b8a98a2b1e"><code>04b0032</code></a></td><td><code>Merge branch 'develop' into 19171_divides_poly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f85a7e06a7591101005f5e61fff674033344e103"><code>f85a7e0</code></a></td><td><code>19171: conflict resolution</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0a5badfad9472555eb9b66776ae99ba99416047"><code>a0a5bad</code></a></td><td><code>Merge branch 'u/bruno/t19171_divides_poly' of git://trac.sagemath.org/sage into 19171_divides_poly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a548adcf9a998a78254ba98df730b1311e9d559"><code>9a548ad</code></a></td><td><code>Merge branch '19171_divides_poly' into 19172_valuation</code></td></tr></table>




---

archive/issue_comments_271323.json:
```json
{
    "body": "Changed commit from **[`992ee7a`](https://github.com/sagemath/sagetrac-mirror/commit/992ee7afc702ca261d25706efb103db27518483d)** to **[`9a548ad`](https://github.com/sagemath/sagetrac-mirror/commit/9a548adcf9a998a78254ba98df730b1311e9d559)**",
    "created_at": "2017-07-25T14:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271323",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`992ee7a`](https://github.com/sagemath/sagetrac-mirror/commit/992ee7afc702ca261d25706efb103db27518483d)** to **[`9a548ad`](https://github.com/sagemath/sagetrac-mirror/commit/9a548adcf9a998a78254ba98df730b1311e9d559)**



---

archive/issue_events_269792.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2017-07-25T14:18:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269792"
}
```



---

archive/issue_events_269793.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2017-07-25T14:19:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269793"
}
```



---

archive/issue_events_269794.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2017-07-25T14:19:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269794"
}
```



---

archive/issue_comments_271324.json:
```json
{
    "body": "Changed keywords from none to **polynomial**",
    "created_at": "2017-07-25T14:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271324",
    "user": "https://github.com/bgrenet"
}
```

Changed keywords from none to **polynomial**



---

archive/issue_comments_271325.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n\n```\nsage: R.<x,y,z> = ZZ[]\nsage: p = 4*x*y + z^2 - 9*x + 39*z\nsage: p.valuation(-2)\n...\nValueError: You can only compute the valuation with respect to a integer larger than 1.\n```\n\n```\nsage: R.<x,y,z> = QQ[]\nsage: p = 4*x*y + z^2 - 9*x + 39*z\nsage: p.valuation(1/2)\n...\nTypeError: no conversion of this rational to integer\n```",
    "created_at": "2017-07-27T10:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271325",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:6" align="right">comment:6</div>


```
sage: R.<x,y,z> = ZZ[]
sage: p = 4*x*y + z^2 - 9*x + 39*z
sage: p.valuation(-2)
...
ValueError: You can only compute the valuation with respect to a integer larger than 1.
```

```
sage: R.<x,y,z> = QQ[]
sage: p = 4*x*y + z^2 - 9*x + 39*z
sage: p.valuation(1/2)
...
TypeError: no conversion of this rational to integer
```



---

archive/issue_comments_271326.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI would be tempted to simplify the version in `multi_polynomial.pyx` roughly as follows (not tested!):\n\n```\n        if arg is None:\n            ex = self.exponents()\n            return tuple(min(e[i] for e in ex) for i in range(self.nvariables()))\n\n        arg = self.parent().coerce(arg)\n\n        if arg.is_constant():\n            arg = arg.constant_coefficient()\n            return min(c.valuation(arg) for c in self.coefficients())\n\n        try:\n            ind = self.parent().gens().index(arg)\n        except ValueError:\n            pass\n        else:\n            return min(e[ind] for e in self.exponents())\n\n        if arg.nvariables() == 1:\n            return self.polynomial(arg.variable(0)).valuation()\n\n        k = 0\n        tmp = arg\n        while tmp.divides(self):\n            k += 1\n            tmp *= arg\n        return k\n```\n\nAlso, I wonder if actually performing the exact division (and replacing self with the quotient) at each loop turn wouldn't be better, but this is generic code any case, I don't think that it matters much.",
    "created_at": "2017-07-27T14:04:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271326",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:7" align="right">comment:7</div>

I would be tempted to simplify the version in `multi_polynomial.pyx` roughly as follows (not tested!):

```
        if arg is None:
            ex = self.exponents()
            return tuple(min(e[i] for e in ex) for i in range(self.nvariables()))

        arg = self.parent().coerce(arg)

        if arg.is_constant():
            arg = arg.constant_coefficient()
            return min(c.valuation(arg) for c in self.coefficients())

        try:
            ind = self.parent().gens().index(arg)
        except ValueError:
            pass
        else:
            return min(e[ind] for e in self.exponents())

        if arg.nvariables() == 1:
            return self.polynomial(arg.variable(0)).valuation()

        k = 0
        tmp = arg
        while tmp.divides(self):
            k += 1
            tmp *= arg
        return k
```

Also, I wonder if actually performing the exact division (and replacing self with the quotient) at each loop turn wouldn't be better, but this is generic code any case, I don't think that it matters much.



---

archive/issue_comments_271327.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe pyflakes plugin rightfully complains about the fact that in this changeset\n\n```diff\n@@ -200,9 +200,17 @@ class Polynomial_generic_sparse(Polynomial):\n             sage: R(0).valuation()\n             +Infinity\n         \"\"\"\n-        if not self.__coeffs:\n+        if not self:\n             return infinity\n-        return ZZ(min(self.__coeffs))\n+\n+        if p is infinity:\n+            return -self.degree()\n+\n+        if p is None:\n+            c = self.__coeffs.keys()\n+            return ZZ(min(self.__coeffs.keys()))\n+\n+        return Polynomial.valuation(self, p)\n \n```\nthe variable `c` is defined but not used. In fact, the corresponding line can just be deleted. I can do it as a reviewer patch. Since the tests pass for the patchbots, I can then see if I give it a positive review (need to look more closely at the code first).",
    "created_at": "2019-07-26T08:04:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271327",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

The pyflakes plugin rightfully complains about the fact that in this changeset

```diff
@@ -200,9 +200,17 @@ class Polynomial_generic_sparse(Polynomial):
             sage: R(0).valuation()
             +Infinity
         """
-        if not self.__coeffs:
+        if not self:
             return infinity
-        return ZZ(min(self.__coeffs))
+
+        if p is infinity:
+            return -self.degree()
+
+        if p is None:
+            c = self.__coeffs.keys()
+            return ZZ(min(self.__coeffs.keys()))
+
+        return Polynomial.valuation(self, p)
 
```
the variable `c` is defined but not used. In fact, the corresponding line can just be deleted. I can do it as a reviewer patch. Since the tests pass for the patchbots, I can then see if I give it a positive review (need to look more closely at the code first).



---

archive/issue_comments_271328.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAlso I was told by Vincent Delecroix that it would be better (since this is a rather old ticket based on a very old branch) to rebase it on top of the latest develop (not merging develop, he said).",
    "created_at": "2019-07-26T08:14:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271328",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

Also I was told by Vincent Delecroix that it would be better (since this is a rather old ticket based on a very old branch) to rebase it on top of the latest develop (not merging develop, he said).



---

archive/issue_comments_271329.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe first commit that is shown for the branch of this ticket is named `#19171: New method divides`.\n\nDo I understand correctly that this commit was originally intended for #19171, but didn't get merged after all? So, my review will about this one as well.\n\nEDIT: It is rather strange that the topic of #19171 was \"Add a method 'divide' to Polynomial\", and the commit adding the \"New method divides\" was not merged.",
    "created_at": "2019-07-26T08:24:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271329",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

The first commit that is shown for the branch of this ticket is named `#19171: New method divides`.

Do I understand correctly that this commit was originally intended for #19171, but didn't get merged after all? So, my review will about this one as well.

EDIT: It is rather strange that the topic of #19171 was "Add a method 'divide' to Polynomial", and the commit adding the "New method divides" was not merged.



---

archive/issue_comments_271330.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nNot good. When trying to rebase on top of develop, there is a merge conflict with the commit from #19171",
    "created_at": "2019-07-26T08:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271330",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">comment:11</div>

Not good. When trying to rebase on top of develop, there is a merge conflict with the commit from #19171



---

archive/issue_comments_271331.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nWhat I am trying now is whether the suspicious commit is needed at all.",
    "created_at": "2019-07-26T09:23:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271331",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

What I am trying now is whether the suspicious commit is needed at all.



---

archive/issue_events_269795.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-07-26T09:35:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269795"
}
```



---

archive/issue_events_269796.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2019-07-26T09:35:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269796"
}
```



---

archive/issue_comments_271332.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSorry, it gets too complicated. Leaving out the [commit named \"#19171: New method divides\"](https://github.com/sagemath/sagetrac-mirror/commit/9a189c7bdc29953d6ada184f7b0db503c6da4677) didn't solve the problem, as the second commit didn't merge either.\n\nSo, I think I will not continue to try and rebase it, and I'd appreciate if the author did.",
    "created_at": "2019-07-26T09:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271332",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

Sorry, it gets too complicated. Leaving out the [commit named "#19171: New method divides"](https://github.com/sagemath/sagetrac-mirror/commit/9a189c7bdc29953d6ada184f7b0db503c6da4677) didn't solve the problem, as the second commit didn't merge either.

So, I think I will not continue to try and rebase it, and I'd appreciate if the author did.



---

archive/issue_comments_271333.json:
```json
{
    "body": "Work Issues: **Rebase**",
    "created_at": "2019-07-26T09:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271333",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **Rebase**



---

archive/issue_comments_271334.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71e424ba0331b826f7b44d09b3d444d8ecd6511f\"><code>71e424b</code></a></td><td><code>19172: Improve valuation for dense polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/693f229214381be08d177c18bb9ff21cd70858c7\"><code>693f229</code></a></td><td><code>19172: Improve valuation for sparse polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/331848976b65c64ca362aca5babcb18e24db9dd9\"><code>3318489</code></a></td><td><code>#19172: Add valuation for multipolynomials</code></td></tr></table>\n",
    "created_at": "2019-08-21T12:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271334",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71e424ba0331b826f7b44d09b3d444d8ecd6511f"><code>71e424b</code></a></td><td><code>19172: Improve valuation for dense polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/693f229214381be08d177c18bb9ff21cd70858c7"><code>693f229</code></a></td><td><code>19172: Improve valuation for sparse polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/331848976b65c64ca362aca5babcb18e24db9dd9"><code>3318489</code></a></td><td><code>#19172: Add valuation for multipolynomials</code></td></tr></table>




---

archive/issue_comments_271335.json:
```json
{
    "body": "Changed commit from **[`9a548ad`](https://github.com/sagemath/sagetrac-mirror/commit/9a548adcf9a998a78254ba98df730b1311e9d559)** to **[`3318489`](https://github.com/sagemath/sagetrac-mirror/commit/331848976b65c64ca362aca5babcb18e24db9dd9)**",
    "created_at": "2019-08-21T12:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271335",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9a548ad`](https://github.com/sagemath/sagetrac-mirror/commit/9a548adcf9a998a78254ba98df730b1311e9d559)** to **[`3318489`](https://github.com/sagemath/sagetrac-mirror/commit/331848976b65c64ca362aca5babcb18e24db9dd9)**



---

archive/issue_comments_271336.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nHi Simon, I've rebased on develop. It should be OK now.",
    "created_at": "2019-08-21T12:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271336",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:15" align="right">comment:15</div>

Hi Simon, I've rebased on develop. It should be OK now.



---

archive/issue_events_269797.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2019-08-21T12:28:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269797"
}
```



---

archive/issue_events_269798.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2019-08-21T12:28:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269798"
}
```



---

archive/issue_comments_271337.json:
```json
{
    "body": "Replying to [@bgrenet](https://github.com/sagemath/sage/issues/19172#comment:0):\n>   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the arguments. This is consistent with PARI.\n\nI don't understand what that specification means. Valuation has two arguments, namely `self` and `arg` resp. `p`. So, if the argument (`p`?) is an element of the base ring of \"the parent\" (the parent of `self`?) then it returns the minimum of the valuations of the arguments (i.e., of `self` and of `p` --- but with respect to what shall the valuation of `self` be taken? And what do you do if the base ring of the parent does not support a valuation, so that the valuation of `p` is not defined?).\nI am sure you mean something else, but this is what I understood from your specification.",
    "created_at": "2019-08-21T13:00:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271337",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [@bgrenet](https://github.com/sagemath/sage/issues/19172#comment:0):
>   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the arguments. This is consistent with PARI.

I don't understand what that specification means. Valuation has two arguments, namely `self` and `arg` resp. `p`. So, if the argument (`p`?) is an element of the base ring of "the parent" (the parent of `self`?) then it returns the minimum of the valuations of the arguments (i.e., of `self` and of `p` --- but with respect to what shall the valuation of `self` be taken? And what do you do if the base ring of the parent does not support a valuation, so that the valuation of `p` is not defined?).
I am sure you mean something else, but this is what I understood from your specification.



---

archive/issue_comments_271338.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,6 @@\n    * Without argument, return the largest power of the variable that divides the input polynomial.\n    * With a polynomial (with the same parent) as argument, return the largest power of this polynomial which divides the input polynomial.\n \n-   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the arguments. This is consistent with PARI.\n+   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the coefficients. This is consistent with PARI.\n \n 2. The method `valuation` for sparse polynomials is much less capable than the method for dense polynomials. I propose to have the same behaviors in both cases.\n``````\n",
    "created_at": "2019-08-21T13:47:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271338",
    "user": "https://github.com/bgrenet"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,6 @@
    * Without argument, return the largest power of the variable that divides the input polynomial.
    * With a polynomial (with the same parent) as argument, return the largest power of this polynomial which divides the input polynomial.
 
-   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the arguments. This is consistent with PARI.
+   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the coefficients. This is consistent with PARI.
 
 2. The method `valuation` for sparse polynomials is much less capable than the method for dense polynomials. I propose to have the same behaviors in both cases.
``````




---

archive/issue_comments_271339.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@simon-king-jena](#comment%3A16):\n> Replying to [@bgrenet](https://github.com/sagemath/sage/issues/19172#comment:0):\n> >   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the arguments. This is consistent with PARI.\n> \n> \n> I don't understand what that specification means. Valuation has two arguments, namely `self` and `arg` resp. `p`. So, if the argument (`p`?) is an element of the base ring of \"the parent\" (the parent of `self`?) then it returns the minimum of the valuations of the arguments (i.e., of `self` and of `p` --- but with respect to what shall the valuation of `self` be taken? And what do you do if the base ring of the parent does not support a valuation, so that the valuation of `p` is not defined?).\n> I am sure you mean something else, but this is what I understood from your specification.\n>  \n\nThere was a typo: I meant \"it returns the minimum of the valuations of the coefficients.\" So it means that if `self` is a polynomial over a ring `R` and `p` is an element of `R`, `self.valuation(p)` computes for each coefficient of `self` its valuation with respect to `p` and returns the minimum of these values. This is very convenient when working over `QQ['x']['y']` and asking the valuation with respect to `'x'`, or even over `ZZ['x']` and asking for the valuation with respect to any prime number.\n\nOf course, this implies that the base ring must have a method `valuation`. The ticket is rather old so I don't have everything fresh in my memory, but do we have examples of rings that do not have such a method?",
    "created_at": "2019-08-21T13:47:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271339",
    "user": "https://github.com/bgrenet"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@simon-king-jena](#comment%3A16):
> Replying to [@bgrenet](https://github.com/sagemath/sage/issues/19172#comment:0):
> >   I propose to allow another possible argument: If the argument is an element of the base ring of the parent, it returns the minimum of the valuations of the arguments. This is consistent with PARI.
> 
> 
> I don't understand what that specification means. Valuation has two arguments, namely `self` and `arg` resp. `p`. So, if the argument (`p`?) is an element of the base ring of "the parent" (the parent of `self`?) then it returns the minimum of the valuations of the arguments (i.e., of `self` and of `p` --- but with respect to what shall the valuation of `self` be taken? And what do you do if the base ring of the parent does not support a valuation, so that the valuation of `p` is not defined?).
> I am sure you mean something else, but this is what I understood from your specification.
>  

There was a typo: I meant "it returns the minimum of the valuations of the coefficients." So it means that if `self` is a polynomial over a ring `R` and `p` is an element of `R`, `self.valuation(p)` computes for each coefficient of `self` its valuation with respect to `p` and returns the minimum of these values. This is very convenient when working over `QQ['x']['y']` and asking the valuation with respect to `'x'`, or even over `ZZ['x']` and asking for the valuation with respect to any prime number.

Of course, this implies that the base ring must have a method `valuation`. The ticket is rather old so I don't have everything fresh in my memory, but do we have examples of rings that do not have such a method?



---

archive/issue_comments_271340.json:
```json
{
    "body": "Changed branch from **[u/bruno/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/t19172_valuation)** to **[u/roed/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/t19172_valuation)**",
    "created_at": "2021-05-12T20:56:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271340",
    "user": "https://github.com/roed314"
}
```

Changed branch from **[u/bruno/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/bruno/t19172_valuation)** to **[u/roed/t19172_valuation](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/t19172_valuation)**



---

archive/issue_comments_271341.json:
```json
{
    "body": "Changed commit from **[`3318489`](https://github.com/sagemath/sagetrac-mirror/commit/331848976b65c64ca362aca5babcb18e24db9dd9)** to **[`fddb76a`](https://github.com/sagemath/sagetrac-mirror/commit/fddb76a98ebac152e332dbf79774410ecd86e259)**",
    "created_at": "2021-05-13T02:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271341",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`3318489`](https://github.com/sagemath/sagetrac-mirror/commit/331848976b65c64ca362aca5babcb18e24db9dd9)** to **[`fddb76a`](https://github.com/sagemath/sagetrac-mirror/commit/fddb76a98ebac152e332dbf79774410ecd86e259)**



---

archive/issue_comments_271342.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIf you wanted to do some micro-optimizations, you can do:\n\n```diff\n               raise NotImplementedError\n \n+       P = parent(p) # the function from sage.structure.element is faster\n+\n-       if is_FractionField(p.parent()):\n+       if is_FractionField(P):\n             if p.denominator().is_unit():\n                 p = p.numerator()\n+                P = parent(p)\n             else:\n                 raise TypeError(\"The denominator should be a unit.\")\n \n-        if self.base_ring().has_coerce_map_from(p.parent()):\n-            return min(c.valuation(p) for c in self.coefficients())\n+        if self._parent._base.has_coerce_map_from(P):\n+            return min(self.get_unsafe(k).valuation(p)\n+                       for k in range(self.degree()+1)\n+                       if self.get_unsafe(k))\n \n-        elif self.parent().has_coerce_map_from(p.parent()):\n-            p = self.parent().coerce(p)\n+        elif self._parent.has_coerce_map_from(P):\n+            p = self._parent.coerce(p)\n             k = 0\n             while p.divides(self):\n                 k += 1\n-                self = self.__floordiv__(p)\n+                self = self._floordiv_(p)  # Same parent\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e7c501967751cd83e16c1476725734cb9a9c0b6\"><code>9e7c501</code></a></td><td><code>Merge branch 'u/bruno/t19172_valuation' of git://trac.sagemath.org/sage into t/19172/valuation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fddb76a98ebac152e332dbf79774410ecd86e259\"><code>fddb76a</code></a></td><td><code>Add a few more tests, fix plugin errors</code></td></tr></table>\n",
    "created_at": "2021-05-13T02:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271342",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

If you wanted to do some micro-optimizations, you can do:

```diff
               raise NotImplementedError
 
+       P = parent(p) # the function from sage.structure.element is faster
+
-       if is_FractionField(p.parent()):
+       if is_FractionField(P):
             if p.denominator().is_unit():
                 p = p.numerator()
+                P = parent(p)
             else:
                 raise TypeError("The denominator should be a unit.")
 
-        if self.base_ring().has_coerce_map_from(p.parent()):
-            return min(c.valuation(p) for c in self.coefficients())
+        if self._parent._base.has_coerce_map_from(P):
+            return min(self.get_unsafe(k).valuation(p)
+                       for k in range(self.degree()+1)
+                       if self.get_unsafe(k))
 
-        elif self.parent().has_coerce_map_from(p.parent()):
-            p = self.parent().coerce(p)
+        elif self._parent.has_coerce_map_from(P):
+            p = self._parent.coerce(p)
             k = 0
             while p.divides(self):
                 k += 1
-                self = self.__floordiv__(p)
+                self = self._floordiv_(p)  # Same parent
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e7c501967751cd83e16c1476725734cb9a9c0b6"><code>9e7c501</code></a></td><td><code>Merge branch 'u/bruno/t19172_valuation' of git://trac.sagemath.org/sage into t/19172/valuation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fddb76a98ebac152e332dbf79774410ecd86e259"><code>fddb76a</code></a></td><td><code>Add a few more tests, fix plugin errors</code></td></tr></table>




---

archive/issue_comments_271343.json:
```json
{
    "body": "Changed commit from **[`fddb76a`](https://github.com/sagemath/sagetrac-mirror/commit/fddb76a98ebac152e332dbf79774410ecd86e259)** to **[`aa040dc`](https://github.com/sagemath/sagetrac-mirror/commit/aa040dca8974d3ae8c50d1694957fee0d2c6b0d4)**",
    "created_at": "2021-05-13T04:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271343",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fddb76a`](https://github.com/sagemath/sagetrac-mirror/commit/fddb76a98ebac152e332dbf79774410ecd86e259)** to **[`aa040dc`](https://github.com/sagemath/sagetrac-mirror/commit/aa040dca8974d3ae8c50d1694957fee0d2c6b0d4)**



---

archive/issue_comments_271344.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa040dca8974d3ae8c50d1694957fee0d2c6b0d4\"><code>aa040dc</code></a></td><td><code>Incorporate Travis' suggestions</code></td></tr></table>\n",
    "created_at": "2021-05-13T04:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271344",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa040dca8974d3ae8c50d1694957fee0d2c6b0d4"><code>aa040dc</code></a></td><td><code>Incorporate Travis' suggestions</code></td></tr></table>




---

archive/issue_events_269799.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-05-16T21:18:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269799"
}
```



---

archive/issue_events_269800.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-05-16T21:18:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269800"
}
```



---

archive/issue_comments_271345.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWhat is intended for the corner cases\n\n```\nsage: ZZ['x'].gen().valuation(1)\nsage: ZZ['x'].zero().valuation(0)\nsage: ZZ['x'].zero().valuation(1)\n```\n(the code is not careful enough: min of empty sequence or infinite loop)\n\nThe above must appear in doctests.",
    "created_at": "2021-05-16T21:18:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271345",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

What is intended for the corner cases

```
sage: ZZ['x'].gen().valuation(1)
sage: ZZ['x'].zero().valuation(0)
sage: ZZ['x'].zero().valuation(1)
```
(the code is not careful enough: min of empty sequence or infinite loop)

The above must appear in doctests.



---

archive/issue_comments_271346.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe following `if arg not in self.parent()` is not a good idea as the method `__contains__` is not supposed to be useful in any meaningful way. You could replace the whole block\n\n```\n        if arg not in self.parent():\n            if self.parent().has_coerce_map_from(arg.parent()):\n                arg = self.parent()(arg)\n            else:\n                raise TypeError(\"The parent of the polynomial {} is not {}\".format(arg,self.parent()))\n```\nby the one line\n\n```\narg = self.parent().coerce(arg)\n```",
    "created_at": "2021-05-16T21:20:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271346",
    "user": "https://github.com/videlec"
}
```

<div id="comment:22" align="right">comment:22</div>

The following `if arg not in self.parent()` is not a good idea as the method `__contains__` is not supposed to be useful in any meaningful way. You could replace the whole block

```
        if arg not in self.parent():
            if self.parent().has_coerce_map_from(arg.parent()):
                arg = self.parent()(arg)
            else:
                raise TypeError("The parent of the polynomial {} is not {}".format(arg,self.parent()))
```
by the one line

```
arg = self.parent().coerce(arg)
```



---

archive/issue_comments_271347.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSimilarly, `if arg in self.base_ring():` is not good\n\n```\nsage: QQ.one() in ZZ\nTrue\n```",
    "created_at": "2021-05-16T21:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271347",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Similarly, `if arg in self.base_ring():` is not good

```
sage: QQ.one() in ZZ
True
```



---

archive/issue_comments_271348.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nFor multivariate polynomials why not use the simpler template\n\n```\nif arg is None:\n   ...\n\narg = parent.coerce(arg)\nif arg.is_zero():\n    ...\nelif self.is_zero():\n    ...\nelif arg.is_constant():\n    ...\nelif arg.is_generator():\n    ...\n# etc \n```",
    "created_at": "2021-05-16T21:27:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19172#issuecomment-271348",
    "user": "https://github.com/videlec"
}
```

<div id="comment:24" align="right">comment:24</div>

For multivariate polynomials why not use the simpler template

```
if arg is None:
   ...

arg = parent.coerce(arg)
if arg.is_zero():
    ...
elif self.is_zero():
    ...
elif arg.is_constant():
    ...
elif arg.is_generator():
    ...
# etc 
```



---

archive/issue_events_269801.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:40:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/19172",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19172#event-269801"
}
```
