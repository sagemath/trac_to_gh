# Issue 19422: A new structure for Punctured Codes

archive/issues_019185.json:
```json
{
    "body": "This ticket proposes a new implementation for punctured codes.\n\nIt contains:\n\n- a new code class, `PuncturedCode`\n\n- a dedicated encoder to compute the generator matrix of a Punctured Code.\n\n- a dedicate decoder which uses the original code to correct errors\n\nThis new structure presents the following advantages:\n\n- it keeps track of the code it comes from. If one punctures a code A, the punctured code one gets will remember it comes from A.\n\n- This allows to perform several operations, like encoding or picking a random element without constructing the generator matrix for the punctured code, thus saving time and memory.\n\n- because it keeps track of the original code, it's possible to get a structured representation of the punctured code, e.g. if one punctures a GRS code and asks for the structured representation of the punctured code one got, a GRS code will be returned.\n\n\nCC:  @wdjoyner @ppurka\n\nBranch/Commit: 45d4ee111d235690820ef35269fb8991aa6f4abb\n\nReviewer: Julien Lavauzelle\n\nAuthor: David Lucas\n\nDependencies: #19653\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19422\n\n",
    "closed_at": "2016-05-24T07:06:34Z",
    "created_at": "2015-10-16T13:43:28Z",
    "labels": [
        "component: coding theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "A new structure for Punctured Codes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19422",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```
This ticket proposes a new implementation for punctured codes.

It contains:

- a new code class, `PuncturedCode`

- a dedicated encoder to compute the generator matrix of a Punctured Code.

- a dedicate decoder which uses the original code to correct errors

This new structure presents the following advantages:

- it keeps track of the code it comes from. If one punctures a code A, the punctured code one gets will remember it comes from A.

- This allows to perform several operations, like encoding or picking a random element without constructing the generator matrix for the punctured code, thus saving time and memory.

- because it keeps track of the original code, it's possible to get a structured representation of the punctured code, e.g. if one punctures a GRS code and asks for the structured representation of the punctured code one got, a GRS code will be returned.


CC:  @wdjoyner @ppurka

Branch/Commit: 45d4ee111d235690820ef35269fb8991aa6f4abb

Reviewer: Julien Lavauzelle

Author: David Lucas

Dependencies: #19653

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19422





---

archive/issue_comments_347795.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dlucas/punctured_codes\"",
    "created_at": "2015-10-16T13:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347795",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing branch from "" to "u/dlucas/punctured_codes"



---

archive/issue_comments_347796.json:
```json
{
    "body": "<a id='comment:2'></a>Content available, it's now ready for review.\n\n---\nNew commits:",
    "created_at": "2015-10-16T13:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347796",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:2'></a>Content available, it's now ready for review.

---
New commits:



---

archive/issue_comments_347797.json:
```json
{
    "body": "Changing commit from \"\" to \"37683a13c904825582e9a4457a44ba0b70168a33\"",
    "created_at": "2015-10-16T13:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347797",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing commit from "" to "37683a13c904825582e9a4457a44ba0b70168a33"



---

archive/issue_comments_347798.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-16T13:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347798",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347799.json:
```json
{
    "body": "<a id='comment:3'></a>`AbstractLinearCode` has a method `punctured`. Shouldn't this return a `PuncturedCode` object after this patch?",
    "created_at": "2015-10-18T16:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347799",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:3'></a>`AbstractLinearCode` has a method `punctured`. Shouldn't this return a `PuncturedCode` object after this patch?



---

archive/issue_comments_347800.json:
```json
{
    "body": "<a id='comment:4'></a>I chose to keep this method as it directly returns a `LinearCode` object.\nSo if one wants to puncture and immediately get the `LinearCode` representation of his punctured code, he can thanks to this method. I plan to change it when the mechanism to get another representation of a punctured code (e.g. get a RS code from a punctured RS code) will be ready.",
    "created_at": "2015-10-19T07:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347800",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:4'></a>I chose to keep this method as it directly returns a `LinearCode` object.
So if one wants to puncture and immediately get the `LinearCode` representation of his punctured code, he can thanks to this method. I plan to change it when the mechanism to get another representation of a punctured code (e.g. get a RS code from a punctured RS code) will be ready.



---

archive/issue_comments_347801.json:
```json
{
    "body": "Changing author from \"\" to \"David Lucas\"",
    "created_at": "2015-10-19T08:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347801",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing author from "" to "David Lucas"



---

archive/issue_comments_347802.json:
```json
{
    "body": "<a id='comment:6'></a>I think the default should always be to retain as much structure as possible. The `C.punctured()` method is certainly the \"default\" a user would call.\n\nFurthermore, having a `PuncturedCode` should never get in the way for users who are simply interested in the unstructured linear code representation: it advertises exactly the same methods (plus some more). So I don't think there is any deprecation needed.",
    "created_at": "2015-10-19T10:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347802",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:6'></a>I think the default should always be to retain as much structure as possible. The `C.punctured()` method is certainly the "default" a user would call.

Furthermore, having a `PuncturedCode` should never get in the way for users who are simply interested in the unstructured linear code representation: it advertises exactly the same methods (plus some more). So I don't think there is any deprecation needed.



---

archive/issue_comments_347803.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-19T10:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347804.json:
```json
{
    "body": "Changing commit from \"37683a13c904825582e9a4457a44ba0b70168a33\" to \"7f9d27ed9483b51342702e115a74e37904cde921\"",
    "created_at": "2015-10-19T10:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "37683a13c904825582e9a4457a44ba0b70168a33" to "7f9d27ed9483b51342702e115a74e37904cde921"



---

archive/issue_comments_347805.json:
```json
{
    "body": "<a id='comment:8'></a>Ok, I agree with you.\n\nChanges have been made and pushed.",
    "created_at": "2015-10-19T10:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347805",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:8'></a>Ok, I agree with you.

Changes have been made and pushed.



---

archive/issue_comments_347806.json:
```json
{
    "body": "Changing commit from \"7f9d27ed9483b51342702e115a74e37904cde921\" to \"ca859cbf3e6b86ccc218d6e51813ae45b9babb34\"",
    "created_at": "2016-01-13T10:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7f9d27ed9483b51342702e115a74e37904cde921" to "ca859cbf3e6b86ccc218d6e51813ae45b9babb34"



---

archive/issue_comments_347807.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-13T10:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347808.json:
```json
{
    "body": "<a id='comment:10'></a>A few updates on this ticket:\n\n- it's now under the latest beta\n- as we now have the structure for decoders in Sage, I added a dedicated decoder for punctured codes\n- as we now have GRS codes in Sage, which still are GRS codes after puncturing, I introduced a mechanism which allows one to get the most specific representation possible for a punctured code, based on the original code.\n\nThis is still open for review.",
    "created_at": "2016-01-13T10:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347808",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:10'></a>A few updates on this ticket:

- it's now under the latest beta
- as we now have the structure for decoders in Sage, I added a dedicated decoder for punctured codes
- as we now have GRS codes in Sage, which still are GRS codes after puncturing, I introduced a mechanism which allows one to get the most specific representation possible for a punctured code, based on the original code.

This is still open for review.



---

archive/issue_comments_347809.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,10 +6,13 @@\n \n - a dedicated encoder to compute the generator matrix of a Punctured Code.\n \n+- a dedicate decoder which uses the original code to correct errors\n+\n This new structure presents the following advantages:\n \n-- it keeps track of the code it comes from. If one punctures a code A, the punctured code he gets will remember it comes from A.\n+- it keeps track of the code it comes from. If one punctures a code A, the punctured code one gets will remember it comes from A.\n \n - This allows to perform several operations, like encoding or picking a random element without constructing the generator matrix for the punctured code, thus saving time and memory.\n \n-- Later on, it will also allow to decode words using a decoder over the original code of the punctured code.\n+- because it keeps track of the original code, it's possible to get a structured representation of the punctured code, e.g. if one punctures a GRS code and asks for the structured representation of the punctured code one got, a GRS code will be returned.\n+\n``````\n",
    "created_at": "2016-01-13T10:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347809",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,10 +6,13 @@
 
 - a dedicated encoder to compute the generator matrix of a Punctured Code.
 
+- a dedicate decoder which uses the original code to correct errors
+
 This new structure presents the following advantages:
 
-- it keeps track of the code it comes from. If one punctures a code A, the punctured code he gets will remember it comes from A.
+- it keeps track of the code it comes from. If one punctures a code A, the punctured code one gets will remember it comes from A.
 
 - This allows to perform several operations, like encoding or picking a random element without constructing the generator matrix for the punctured code, thus saving time and memory.
 
-- Later on, it will also allow to decode words using a decoder over the original code of the punctured code.
+- because it keeps track of the original code, it's possible to get a structured representation of the punctured code, e.g. if one punctures a GRS code and asks for the structured representation of the punctured code one got, a GRS code will be returned.
+
``````




---

archive/issue_comments_347810.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-27T16:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347811.json:
```json
{
    "body": "Changing commit from \"ca859cbf3e6b86ccc218d6e51813ae45b9babb34\" to \"26aae1797b74fb3d27b11d73958884e013c1dc28\"",
    "created_at": "2016-01-27T16:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ca859cbf3e6b86ccc218d6e51813ae45b9babb34" to "26aae1797b74fb3d27b11d73958884e013c1dc28"



---

archive/issue_events_053646.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/dlucas",
    "created_at": "2016-01-27T16:21:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19422#event-53646"
}
```



---

archive/issue_comments_347812.json:
```json
{
    "body": "<a id='comment:12'></a>I updated this ticket to latest beta, and fixed merge conflict.\nIt's still open for review.",
    "created_at": "2016-01-27T16:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347812",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:12'></a>I updated this ticket to latest beta, and fixed merge conflict.
It's still open for review.



---

archive/issue_comments_347813.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-02-22T13:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_347814.json:
```json
{
    "body": "Changing commit from \"26aae1797b74fb3d27b11d73958884e013c1dc28\" to \"fa355cd4cbc783dc0435ab62c90f52492af6e64f\"",
    "created_at": "2016-02-22T13:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "26aae1797b74fb3d27b11d73958884e013c1dc28" to "fa355cd4cbc783dc0435ab62c90f52492af6e64f"



---

archive/issue_comments_347815.json:
```json
{
    "body": "<a id='comment:14'></a>I fixed a few typos, updated deprecated imports which were breaking doctests.\nI also completely rewrote doctests and documentation of the decoder, using GRS decoders introduced in #19653.\n\nThis is still open for review.",
    "created_at": "2016-02-22T13:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347815",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:14'></a>I fixed a few typos, updated deprecated imports which were breaking doctests.
I also completely rewrote doctests and documentation of the decoder, using GRS decoders introduced in #19653.

This is still open for review.



---

archive/issue_comments_347816.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#19653\"",
    "created_at": "2016-02-22T13:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347816",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing dependencies from "" to "#19653"



---

archive/issue_comments_347817.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-02-26T14:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_347818.json:
```json
{
    "body": "Changing commit from \"fa355cd4cbc783dc0435ab62c90f52492af6e64f\" to \"5c61b119d82215569131ea6741f5abbc0ef2da2f\"",
    "created_at": "2016-02-26T14:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fa355cd4cbc783dc0435ab62c90f52492af6e64f" to "5c61b119d82215569131ea6741f5abbc0ef2da2f"



---

archive/issue_comments_347819.json:
```json
{
    "body": "<a id='comment:17'></a>I updated this ticket to the latest beta and fixed conflicts. This is still open for review.",
    "created_at": "2016-02-26T14:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347819",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:17'></a>I updated this ticket to the latest beta and fixed conflicts. This is still open for review.



---

archive/issue_comments_347820.json:
```json
{
    "body": "Changing commit from \"5c61b119d82215569131ea6741f5abbc0ef2da2f\" to \"69da167f0a9d4a0fc68e0846416577a5ddb44eba\"",
    "created_at": "2016-03-31T13:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5c61b119d82215569131ea6741f5abbc0ef2da2f" to "69da167f0a9d4a0fc68e0846416577a5ddb44eba"



---

archive/issue_comments_347821.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-31T13:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_053647.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/dlucas",
    "created_at": "2016-03-31T13:41:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19422#event-53647"
}
```



---

archive/issue_events_053648.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/dlucas",
    "created_at": "2016-03-31T13:41:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19422#event-53648"
}
```



---

archive/issue_comments_347822.json:
```json
{
    "body": "<a id='comment:19'></a>I updated this ticket to 7.2beta1 and fixed a broken doctest.\nThis is still open for review.",
    "created_at": "2016-03-31T13:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347822",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:19'></a>I updated this ticket to 7.2beta1 and fixed a broken doctest.
This is still open for review.



---

archive/issue_comments_347823.json:
```json
{
    "body": "<a id='comment:20'></a>I start the review even though the ticket is not updated to the latest beta. Despite my comments, note that I realize that building this framework must have been a huge work, and that I found it really user-friendly =)\n\n*** General remarks ***\n\n* As I read the (quite long) name of the canonical decoder of your punctured code (`PuncturedCodeOriginalCodeDecoder`), I asked myself the following question: if I understand well your naming convention, decoders are named `Code`+`DecoderName`. Is it necessary to have the `Code` suffix ? My point is that it could be sufficient to only keep `DecoderName`, because if a user wants to know what kind of code the decoder is applied to, he just needs to call `Dec.code()`.\n* You consider puncturing points as a list. Would it be better (and more confortable to compute unions and intersections) to consider them a set ?\n\n*** index.rst ***\n\n* why do you remove `sage/coding/source_coding/huffman` ?\n\n*** src/sage/coding/grs.py ***\n\n* The method `_punctured_form(self, points)` doesn't work if `points` is not sorted (e.g. `C_grs._punctured_form([4,3])`). That's due to your strange way to select the evaluation points and multipliers. I think you should remove the block:\n\n```\nstart = 0\nfor i in points:\n    punctured_alphas += alphas[start:i]\n    punctured_col_mults += col_mults[start:i]\n    start = i + 1\n    punctured_alphas += alphas[start:n]\n    punctured_col_mults += col_mults[start:n]\n```\n\nand replace it by something like (that's only a suggestion):\n\n```\npunctured_alphas = [ alphas[i] for i in range(n) if i not in points ]\npunctured_col_mults = [ col_mults[i] for i in range(n) if i not in points ]\n```\n* In the same method, if I understand it well, this block:\n\n```\nif G.rank() != dimension:\n    G = G.echelon_form()\n    for i in range(dimension):\n        if G[i] == 0:\n        dimension -= 1\n```\n\naims at computing the code dimension (stored in `dimension`). In fact, you already computed it in `G.rank()`.\n\n*** src/sage/coding/linear_code.py ***\n\n* in `_punctured_form` method, `G.echelon_form()` puts all the zero lines at the bottom of the new matrix. Thus, if you want to get the non-zero part of the matrix, I think you could simply write\n\n```\n    k = G.rank()\n    return LinearCode(G[:k])\n```",
    "created_at": "2016-04-16T11:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347823",
    "user": "https://github.com/jlavauzelle"
}
```

<a id='comment:20'></a>I start the review even though the ticket is not updated to the latest beta. Despite my comments, note that I realize that building this framework must have been a huge work, and that I found it really user-friendly =)

*** General remarks ***

* As I read the (quite long) name of the canonical decoder of your punctured code (`PuncturedCodeOriginalCodeDecoder`), I asked myself the following question: if I understand well your naming convention, decoders are named `Code`+`DecoderName`. Is it necessary to have the `Code` suffix ? My point is that it could be sufficient to only keep `DecoderName`, because if a user wants to know what kind of code the decoder is applied to, he just needs to call `Dec.code()`.
* You consider puncturing points as a list. Would it be better (and more confortable to compute unions and intersections) to consider them a set ?

*** index.rst ***

* why do you remove `sage/coding/source_coding/huffman` ?

*** src/sage/coding/grs.py ***

* The method `_punctured_form(self, points)` doesn't work if `points` is not sorted (e.g. `C_grs._punctured_form([4,3])`). That's due to your strange way to select the evaluation points and multipliers. I think you should remove the block:

```
start = 0
for i in points:
    punctured_alphas += alphas[start:i]
    punctured_col_mults += col_mults[start:i]
    start = i + 1
    punctured_alphas += alphas[start:n]
    punctured_col_mults += col_mults[start:n]
```

and replace it by something like (that's only a suggestion):

```
punctured_alphas = [ alphas[i] for i in range(n) if i not in points ]
punctured_col_mults = [ col_mults[i] for i in range(n) if i not in points ]
```
* In the same method, if I understand it well, this block:

```
if G.rank() != dimension:
    G = G.echelon_form()
    for i in range(dimension):
        if G[i] == 0:
        dimension -= 1
```

aims at computing the code dimension (stored in `dimension`). In fact, you already computed it in `G.rank()`.

*** src/sage/coding/linear_code.py ***

* in `_punctured_form` method, `G.echelon_form()` puts all the zero lines at the bottom of the new matrix. Thus, if you want to get the non-zero part of the matrix, I think you could simply write

```
    k = G.rank()
    return LinearCode(G[:k])
```



---

archive/issue_comments_347824.json:
```json
{
    "body": "<a id='comment:21'></a>*** src/sage/coding/punctured_code.py ***\n--- function `puncture` ---\n- same strange way to compute the non-punctured positions than in grs.py. For example, it doesn't work with:\n\n```\nC = codes.RandomLinearCode(11, 5, GF(7))\nCp = codes.PuncturedCode(C, [4,3])\nv = vector(GF(7), (2,3,0,2,1,5,1,5,6,5,3))\nsage.coding.punctured_code.puncture(v, [4,3], Cp)\n```\n\n--- class `PuncturedCode` ---\n- constructor:\n`positions = list(set(positions))` is a short (maybe dirty) way to do:\n\n```\nunique_positions = set()\nfor i in positions:\n    unique_positions.add(i)\npositions = []\nfor i in unique_positions:\n   positions.append(i)\n```\nand it looks to sort the elements as well =) Also remark that you don't have this \"multiplicity\" issue when using Python sets (instead of lists) for storing puncturing points.\n- in encode() method, you missed parentheses after `self.punctured_positions` in `return puncture(c, self.punctured_positions, self)`\n- in structured_representation(self) method: in the doc, you wrote \"A punctured GRS code is still a punctured code\" but I think you meant \"still a GRS code\". Moreover, I don't understand what you mean by \"Which is not the case for generic linear codes\": punctured linear codes are still linear codes.\n- still in structured_representation(self) method, I tried this:\n\n```\nsage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)\nsage: P = codes.PuncturedCode(C, [1,3])\nsage: Q = codes.PuncturedCode(P, [1,3])\nsage: P.length()\n5\nsage: Q.length()\n3\nsage: P.structured_representation()\n[5, 4, 2] Generalized Reed-Solomon Code over Finite Field of size 7\nsage: Q.structured_representation()\n[5, 3, 3] Generalized Reed-Solomon Code over Finite Field of size 7\n```\nSo, double puncturing works well (`Q` seems to be the right code), but `structured_representation()` doesn't build the right Reed-Solomon code.\n\n--- class `PuncturedCodePuncturedMatrixEncoder` ---\n- in `GeneratorMatrix`: same comment as in linear_code.py, I think echelon_form()do the job and you just need to keep the `k` first rows.\n\n--- class `PuncturedCodeOriginalCodeDecoder` ---\n- sage is stuck (infinite loop ?) when I run this:\n\n```\nsage: R = codes.RandomLinearCode(11, 5, GF(7))\nsage: P = codes.PuncturedCode(R, [1,3])\nsage: P.decoder()\n```\n- l.444: you wrote ``'random_values'`` instead of ``'random-values'``\n- in the constructor: you have a test variable `error_erasure` to which you assign `0` and `1`. Maybe `True` and `False` are more explicit.\n- in `decode_to_code`: l.600, I think you forgot to increment `shift` (otherwise I misunderstood the use of `shift`)\n- maybe add an `elif self._strategy == 'try-all'` at line 643.\n- l.670: `ValueError(\"The number of erasures exceed decoding capability\")` --> exceeds\n- l.672: decoding capability must be:\n\n```\n    return (diff - punctured -1) // 2\n```\n- l.665; you could have negative radius with:\n\n```\nif self._strategy != 'try-all' and \"error-erasure\" not in D.decoder_type():\n    return D.decoding_radius() - punctured\n```\n- I don't understand the last `return D.decoding_radius()`, line 675. To which case does it apply ?",
    "created_at": "2016-04-16T12:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347824",
    "user": "https://github.com/jlavauzelle"
}
```

<a id='comment:21'></a>*** src/sage/coding/punctured_code.py ***
--- function `puncture` ---
- same strange way to compute the non-punctured positions than in grs.py. For example, it doesn't work with:

```
C = codes.RandomLinearCode(11, 5, GF(7))
Cp = codes.PuncturedCode(C, [4,3])
v = vector(GF(7), (2,3,0,2,1,5,1,5,6,5,3))
sage.coding.punctured_code.puncture(v, [4,3], Cp)
```

--- class `PuncturedCode` ---
- constructor:
`positions = list(set(positions))` is a short (maybe dirty) way to do:

```
unique_positions = set()
for i in positions:
    unique_positions.add(i)
positions = []
for i in unique_positions:
   positions.append(i)
```
and it looks to sort the elements as well =) Also remark that you don't have this "multiplicity" issue when using Python sets (instead of lists) for storing puncturing points.
- in encode() method, you missed parentheses after `self.punctured_positions` in `return puncture(c, self.punctured_positions, self)`
- in structured_representation(self) method: in the doc, you wrote "A punctured GRS code is still a punctured code" but I think you meant "still a GRS code". Moreover, I don't understand what you mean by "Which is not the case for generic linear codes": punctured linear codes are still linear codes.
- still in structured_representation(self) method, I tried this:

```
sage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)
sage: P = codes.PuncturedCode(C, [1,3])
sage: Q = codes.PuncturedCode(P, [1,3])
sage: P.length()
5
sage: Q.length()
3
sage: P.structured_representation()
[5, 4, 2] Generalized Reed-Solomon Code over Finite Field of size 7
sage: Q.structured_representation()
[5, 3, 3] Generalized Reed-Solomon Code over Finite Field of size 7
```
So, double puncturing works well (`Q` seems to be the right code), but `structured_representation()` doesn't build the right Reed-Solomon code.

--- class `PuncturedCodePuncturedMatrixEncoder` ---
- in `GeneratorMatrix`: same comment as in linear_code.py, I think echelon_form()do the job and you just need to keep the `k` first rows.

--- class `PuncturedCodeOriginalCodeDecoder` ---
- sage is stuck (infinite loop ?) when I run this:

```
sage: R = codes.RandomLinearCode(11, 5, GF(7))
sage: P = codes.PuncturedCode(R, [1,3])
sage: P.decoder()
```
- l.444: you wrote ``'random_values'`` instead of ``'random-values'``
- in the constructor: you have a test variable `error_erasure` to which you assign `0` and `1`. Maybe `True` and `False` are more explicit.
- in `decode_to_code`: l.600, I think you forgot to increment `shift` (otherwise I misunderstood the use of `shift`)
- maybe add an `elif self._strategy == 'try-all'` at line 643.
- l.670: `ValueError("The number of erasures exceed decoding capability")` --> exceeds
- l.672: decoding capability must be:

```
    return (diff - punctured -1) // 2
```
- l.665; you could have negative radius with:

```
if self._strategy != 'try-all' and "error-erasure" not in D.decoder_type():
    return D.decoding_radius() - punctured
```
- I don't understand the last `return D.decoding_radius()`, line 675. To which case does it apply ?



---

archive/issue_comments_347825.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-16T12:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347825",
    "user": "https://github.com/jlavauzelle"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_347826.json:
```json
{
    "body": "Changing commit from \"69da167f0a9d4a0fc68e0846416577a5ddb44eba\" to \"659105c517f3e6115e70a9f502f3681ca9075086\"",
    "created_at": "2016-04-16T15:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "69da167f0a9d4a0fc68e0846416577a5ddb44eba" to "659105c517f3e6115e70a9f502f3681ca9075086"



---

archive/issue_comments_347827.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-16T15:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347828.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-16T15:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347828",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_347829.json:
```json
{
    "body": "<a id='comment:23'></a>Hello Julien,\n\nThanks for your thorough review!\n\nI followed all your suggestions (good idea to change the set of points to a list!).\nSome remarks/answers follow:\n\n- As `positions` is now a set, the test of duplicate positions in the constructor is no longer needed.\n- Open question: now that I changed `positions` to a set, the `str` methods return the ugly str format of a set: `set([3,4])` for `{3, 4}`. Which means the string representation of a punctured code now states `PuncturedCode coming from ... punctured in position(s) set([pos])` which is quite ugly... So, do you think I should keep that, or, only for these `str` methods return a list while it might be a bit confusing for the user because he/she entered a set a got a list?\n\n> sage is stuck (infinite loop ?) when I run this: \n\n\nOh, yes, it's not an infinite loop! It's because it builds the original decoder of your code, namely a `SyndromeDecoder` for a linear code over GF(7), length 11, dimension 5... Which takes a while because of the table of syndromes which is heavy to build.\n\nBest,\n\nDavid",
    "created_at": "2016-04-16T15:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347829",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:23'></a>Hello Julien,

Thanks for your thorough review!

I followed all your suggestions (good idea to change the set of points to a list!).
Some remarks/answers follow:

- As `positions` is now a set, the test of duplicate positions in the constructor is no longer needed.
- Open question: now that I changed `positions` to a set, the `str` methods return the ugly str format of a set: `set([3,4])` for `{3, 4}`. Which means the string representation of a punctured code now states `PuncturedCode coming from ... punctured in position(s) set([pos])` which is quite ugly... So, do you think I should keep that, or, only for these `str` methods return a list while it might be a bit confusing for the user because he/she entered a set a got a list?

> sage is stuck (infinite loop ?) when I run this: 


Oh, yes, it's not an infinite loop! It's because it builds the original decoder of your code, namely a `SyndromeDecoder` for a linear code over GF(7), length 11, dimension 5... Which takes a while because of the table of syndromes which is heavy to build.

Best,

David



---

archive/issue_comments_347830.json:
```json
{
    "body": "<a id='comment:24'></a>I'd prefer it if the user could enter either a set or a list of punctured positions, or a single position. The internal representation as a set probably makes sense though. I consider str and repr as just pretty-printing, so formatting as a (sorted) list make sense.",
    "created_at": "2016-04-16T16:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347830",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:24'></a>I'd prefer it if the user could enter either a set or a list of punctured positions, or a single position. The internal representation as a set probably makes sense though. I consider str and repr as just pretty-printing, so formatting as a (sorted) list make sense.



---

archive/issue_comments_347831.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-18T09:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347832.json:
```json
{
    "body": "Changing commit from \"659105c517f3e6115e70a9f502f3681ca9075086\" to \"cef203fb5010d120386968f432648a60338c9fcc\"",
    "created_at": "2016-04-18T09:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "659105c517f3e6115e70a9f502f3681ca9075086" to "cef203fb5010d120386968f432648a60338c9fcc"



---

archive/issue_comments_347833.json:
```json
{
    "body": "<a id='comment:26'></a>Hello,\n\nThe user can now pass either an Integer, an int, a list or a set to `PuncturedCode`. The internal representation is a set. I added a few extra sanitization tests, so if one passes a list/set of anything but ints/Integers, an exception is raised.\n\nI also reinstated the list representation of the punctured positions for str methods.\n\nRemark:\n\nfor now, `punctured_positions` (the getter for `positions`) always return a set, even if one passed an int/Integer/list at construction time. I think it's fine like that, but if you think it can be confusing/annoying for the user, I can change its behaviour so it returns the exact data one passed at construction time.\n\nThis is still open for review.\n\nBest,\n\nDavid",
    "created_at": "2016-04-18T09:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347833",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:26'></a>Hello,

The user can now pass either an Integer, an int, a list or a set to `PuncturedCode`. The internal representation is a set. I added a few extra sanitization tests, so if one passes a list/set of anything but ints/Integers, an exception is raised.

I also reinstated the list representation of the punctured positions for str methods.

Remark:

for now, `punctured_positions` (the getter for `positions`) always return a set, even if one passed an int/Integer/list at construction time. I think it's fine like that, but if you think it can be confusing/annoying for the user, I can change its behaviour so it returns the exact data one passed at construction time.

This is still open for review.

Best,

David



---

archive/issue_comments_347834.json:
```json
{
    "body": "<a id='comment:27'></a>Awesome!\n\n> for now, `punctured_positions` (the getter for `positions`) always return a set, even if one passed an int/Integer/list at construction time. I think it's fine like that, but if you think it can be confusing/annoying for the user, I can change its behaviour so it returns the exact data one passed at construction time.\n\n\nI think this makes complete sense.",
    "created_at": "2016-04-18T11:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347834",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:27'></a>Awesome!

> for now, `punctured_positions` (the getter for `positions`) always return a set, even if one passed an int/Integer/list at construction time. I think it's fine like that, but if you think it can be confusing/annoying for the user, I can change its behaviour so it returns the exact data one passed at construction time.


I think this makes complete sense.



---

archive/issue_comments_347835.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-19T12:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347836.json:
```json
{
    "body": "Changing commit from \"cef203fb5010d120386968f432648a60338c9fcc\" to \"2d13b55e6603e014bc7c79d3852384f3a314677f\"",
    "created_at": "2016-04-19T12:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cef203fb5010d120386968f432648a60338c9fcc" to "2d13b55e6603e014bc7c79d3852384f3a314677f"



---

archive/issue_comments_347837.json:
```json
{
    "body": "<a id='comment:29'></a>Hello,\n\nI fixed a bug: Punctured Code's decoder was not working if its original decoder was a list decoder.\nI changed `puncture` method (which is BTW now called `_puncture` as it's a helper function): it can now puncture a list of vectors or a vector. This takes care of the list-decoding issue.\n\nBest,\n\nDavid",
    "created_at": "2016-04-19T12:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347837",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:29'></a>Hello,

I fixed a bug: Punctured Code's decoder was not working if its original decoder was a list decoder.
I changed `puncture` method (which is BTW now called `_puncture` as it's a helper function): it can now puncture a list of vectors or a vector. This takes care of the list-decoding issue.

Best,

David



---

archive/issue_comments_347838.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-19T14:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347839.json:
```json
{
    "body": "Changing commit from \"2d13b55e6603e014bc7c79d3852384f3a314677f\" to \"5bb39feb29a9c8da1ea503b4a01527b312520aaa\"",
    "created_at": "2016-04-19T14:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2d13b55e6603e014bc7c79d3852384f3a314677f" to "5bb39feb29a9c8da1ea503b4a01527b312520aaa"



---

archive/issue_comments_347840.json:
```json
{
    "body": "Changing branch from \"u/dlucas/punctured_codes\" to \"u/dlucas/punctured_code\"",
    "created_at": "2016-04-19T14:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347840",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing branch from "u/dlucas/punctured_codes" to "u/dlucas/punctured_code"



---

archive/issue_comments_347841.json:
```json
{
    "body": "Changing commit from \"5bb39feb29a9c8da1ea503b4a01527b312520aaa\" to \"\"",
    "created_at": "2016-04-19T14:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347841",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing commit from "5bb39feb29a9c8da1ea503b4a01527b312520aaa" to ""



---

archive/issue_comments_347842.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-04-19T14:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_347843.json:
```json
{
    "body": "Changing commit from \"\" to \"36e71c57401929089bc1938aa016b251b54f8916\"",
    "created_at": "2016-04-19T14:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "36e71c57401929089bc1938aa016b251b54f8916"



---

archive/issue_comments_347844.json:
```json
{
    "body": "<a id='comment:33'></a>Sorry, I messed up with my git branches in the push before that.\nAnyway, my last commit fixes a bug related to `decode_to_code`: the loops I was using to insert elements in lists were failing because they were expecting to receive the positions to insert as a sorted list of positions.\nI wrote a helper functions to deal with this, and it now works fine.\nThis is still open for review (and this time, I cannot find any more issues).\n\nBest,\n\nDavid",
    "created_at": "2016-04-19T15:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347844",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:33'></a>Sorry, I messed up with my git branches in the push before that.
Anyway, my last commit fixes a bug related to `decode_to_code`: the loops I was using to insert elements in lists were failing because they were expecting to receive the positions to insert as a sorted list of positions.
I wrote a helper functions to deal with this, and it now works fine.
This is still open for review (and this time, I cannot find any more issues).

Best,

David



---

archive/issue_comments_347845.json:
```json
{
    "body": "<a id='comment:34'></a>Hi David,\n\nA few remarks -- the last ones, I hope:\n\n\n- in `structured_representation` method: it doesn't work when one concatenates puncturings. For example, the following script\n\n```\n    C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)\n    P = codes.PuncturedCode(C, [0,6])\n    D = P.structured_representation()\n    P2 = codes.PuncturedCode(P, [0,4])\n    D2 = P2.structured_representation()\n```\nfails at fifth line (so double puncturing actually works, only `structured_representation` crashes). From the crash log, it seems that you don't build the right set of `pts`.\n\n- in `PuncturedCodePuncturedMatrixEncoder`, one can construct this encoder while passing as argument a code which is not a punctured one. As a direct consequence, this scripts fails:\n\n```\n    C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)\n    E = codes.encoders.PuncturedCodePuncturedMatrixEncoder(C)\n    G = E.generator_matrix()\n```\nThe question is: is it the user's mistake, or should the code handle it ? Maybe it's reasonable to throw an error.\n\n\n- same remark for your decoder: one can pass a non-punctured code as parameter.\n\n- in `__init__` function of `PuncturedCodeOriginalCodeDecoder`, maybe it is better to use `True/False` boolean values instead of `error_erasure = 0` and `error_erasure = 1`.\n\n- I also prefer the compact notation:\n\n```\n    e_list = [ one if i in pts else zero for i in range(Cor.length()) ]\n```\ninstead of:\n\n```\n    e_list = []\n    for i in range(Cor.length()):\n        if i in pts:\n            e_list.append(one)\n        else:\n            e_list.append(zero)\n```\n\n\n- finally, a typo, l.441 : default instead of dafault\n\nI did not perform exhaustive tests of all the combinations of codes/encoders/decoders/strategies, because it is too long. So given the complexity of the feature you're trying to implement, it's still possible there remains some minor errors -- especially with extreme settings -- but maybe a real deep use of this class (by actual users) could make them appear more easily.\n\nThus, when you're done fixing the previous errors, I give the green light.\n\nJulien",
    "created_at": "2016-05-22T13:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347845",
    "user": "https://github.com/jlavauzelle"
}
```

<a id='comment:34'></a>Hi David,

A few remarks -- the last ones, I hope:


- in `structured_representation` method: it doesn't work when one concatenates puncturings. For example, the following script

```
    C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)
    P = codes.PuncturedCode(C, [0,6])
    D = P.structured_representation()
    P2 = codes.PuncturedCode(P, [0,4])
    D2 = P2.structured_representation()
```
fails at fifth line (so double puncturing actually works, only `structured_representation` crashes). From the crash log, it seems that you don't build the right set of `pts`.

- in `PuncturedCodePuncturedMatrixEncoder`, one can construct this encoder while passing as argument a code which is not a punctured one. As a direct consequence, this scripts fails:

```
    C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)
    E = codes.encoders.PuncturedCodePuncturedMatrixEncoder(C)
    G = E.generator_matrix()
```
The question is: is it the user's mistake, or should the code handle it ? Maybe it's reasonable to throw an error.


- same remark for your decoder: one can pass a non-punctured code as parameter.

- in `__init__` function of `PuncturedCodeOriginalCodeDecoder`, maybe it is better to use `True/False` boolean values instead of `error_erasure = 0` and `error_erasure = 1`.

- I also prefer the compact notation:

```
    e_list = [ one if i in pts else zero for i in range(Cor.length()) ]
```
instead of:

```
    e_list = []
    for i in range(Cor.length()):
        if i in pts:
            e_list.append(one)
        else:
            e_list.append(zero)
```


- finally, a typo, l.441 : default instead of dafault

I did not perform exhaustive tests of all the combinations of codes/encoders/decoders/strategies, because it is too long. So given the complexity of the feature you're trying to implement, it's still possible there remains some minor errors -- especially with extreme settings -- but maybe a real deep use of this class (by actual users) could make them appear more easily.

Thus, when you're done fixing the previous errors, I give the green light.

Julien



---

archive/issue_comments_347846.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-22T13:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347846",
    "user": "https://github.com/jlavauzelle"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_347847.json:
```json
{
    "body": "Changing commit from \"36e71c57401929089bc1938aa016b251b54f8916\" to \"8a3a084f960197006447424522ea768c4a89bb62\"",
    "created_at": "2016-05-23T13:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "36e71c57401929089bc1938aa016b251b54f8916" to "8a3a084f960197006447424522ea768c4a89bb62"



---

archive/issue_comments_347848.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-23T13:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347849.json:
```json
{
    "body": "<a id='comment:36'></a>Hello Julien,\n\nThanks for your comments!\n\nI fixed the bug in `structured_representation`. I also fixed a bug I found while compiling the documentation, added input sanitization in the encoder and the decoder (speaking of which, these checks are missing almost everywhere... I'll open a new ticket to fix that in other classes).\n\nI also removed non-Pythonic syntax (fun fact: four lines below the ones you noticed, `error_erasure` was set to `True` or `False`... Consistency, I haz it).\n\nShould be ok now.\nFYI, I tested locally `error-erasure`, `list-decoder` and \"classical\" decoders, standard decoding tests passed.\n\nDavid",
    "created_at": "2016-05-23T13:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347849",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:36'></a>Hello Julien,

Thanks for your comments!

I fixed the bug in `structured_representation`. I also fixed a bug I found while compiling the documentation, added input sanitization in the encoder and the decoder (speaking of which, these checks are missing almost everywhere... I'll open a new ticket to fix that in other classes).

I also removed non-Pythonic syntax (fun fact: four lines below the ones you noticed, `error_erasure` was set to `True` or `False`... Consistency, I haz it).

Should be ok now.
FYI, I tested locally `error-erasure`, `list-decoder` and "classical" decoders, standard decoding tests passed.

David



---

archive/issue_comments_347850.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-23T13:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347850",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_053649.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/dlucas",
    "created_at": "2016-05-23T13:27:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19422#event-53649"
}
```



---

archive/issue_events_053650.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/dlucas",
    "created_at": "2016-05-23T13:27:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19422#event-53650"
}
```



---

archive/issue_comments_347851.json:
```json
{
    "body": "<a id='comment:38'></a>Hi David,\n\nYour fix of `structured_representation` doesn't work. Try this:\n\n```\n    C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)\n    Cp = codes.PuncturedCode(C, [5,6])\n    Cp2 = codes.PuncturedCode(Cp, [1,2])\n```\nIf you print `list_pts` at the end of the method, you'll see it is not `[1,2,5,6]` as expected.\n\nHere is a piece of code which should work:\n\n```\n        while(isinstance(C, PuncturedCode)):\n            cur_pts = list(C.punctured_positions())\n            list_len = len(list_pts)\n            for p in cur_pts:\n                for i in range(list_len):\n                    if (p <= list_pts[i]):\n                        list_pts[i] += 1\n            list_pts += cur_pts\n            C = C.original_code()\n        return C._punctured_form(set(list_pts))\n```\nI'm not satisfied about its algorithmic complexity, so you're free to improve it, even though I cannot believe that this piece of code will ever become a bottleneck of any algorithm.\n\nI agree with the other fixes :)\n\nJulien",
    "created_at": "2016-05-23T15:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347851",
    "user": "https://github.com/jlavauzelle"
}
```

<a id='comment:38'></a>Hi David,

Your fix of `structured_representation` doesn't work. Try this:

```
    C = codes.GeneralizedReedSolomonCode(GF(7).list(), 4)
    Cp = codes.PuncturedCode(C, [5,6])
    Cp2 = codes.PuncturedCode(Cp, [1,2])
```
If you print `list_pts` at the end of the method, you'll see it is not `[1,2,5,6]` as expected.

Here is a piece of code which should work:

```
        while(isinstance(C, PuncturedCode)):
            cur_pts = list(C.punctured_positions())
            list_len = len(list_pts)
            for p in cur_pts:
                for i in range(list_len):
                    if (p <= list_pts[i]):
                        list_pts[i] += 1
            list_pts += cur_pts
            C = C.original_code()
        return C._punctured_form(set(list_pts))
```
I'm not satisfied about its algorithmic complexity, so you're free to improve it, even though I cannot believe that this piece of code will ever become a bottleneck of any algorithm.

I agree with the other fixes :)

Julien



---

archive/issue_comments_347852.json:
```json
{
    "body": "<a id='comment:39'></a>> If you print `list_pts` at the end of the method, you'll see it is not `[1,2,5,6]` as expected.\n\n\nOh yes you're right, my solution only works if one erases the same coordinates repeatedly...",
    "created_at": "2016-05-23T15:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347852",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:39'></a>> If you print `list_pts` at the end of the method, you'll see it is not `[1,2,5,6]` as expected.


Oh yes you're right, my solution only works if one erases the same coordinates repeatedly...



---

archive/issue_comments_347853.json:
```json
{
    "body": "Changing commit from \"8a3a084f960197006447424522ea768c4a89bb62\" to \"45d4ee111d235690820ef35269fb8991aa6f4abb\"",
    "created_at": "2016-05-23T15:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8a3a084f960197006447424522ea768c4a89bb62" to "45d4ee111d235690820ef35269fb8991aa6f4abb"



---

archive/issue_comments_347854.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-23T15:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347855.json:
```json
{
    "body": "<a id='comment:41'></a>I took your solution and tested it on several instances.\nI'm fine with it, even if it's not perfect.\n\nDavid",
    "created_at": "2016-05-23T15:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347855",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:41'></a>I took your solution and tested it on several instances.
I'm fine with it, even if it's not perfect.

David



---

archive/issue_comments_347856.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-23T16:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347856",
    "user": "https://github.com/jlavauzelle"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347857.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Julien Lavauzelle\"",
    "created_at": "2016-05-23T16:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347857",
    "user": "https://github.com/jlavauzelle"
}
```

Changing reviewer from "" to "Julien Lavauzelle"



---

archive/issue_comments_347858.json:
```json
{
    "body": "<a id='comment:42'></a>Now that's ok for me. Great job again !\n\nJulien",
    "created_at": "2016-05-23T16:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347858",
    "user": "https://github.com/jlavauzelle"
}
```

<a id='comment:42'></a>Now that's ok for me. Great job again !

Julien



---

archive/issue_comments_347859.json:
```json
{
    "body": "<a id='comment:43'></a>Amazing, thanks!",
    "created_at": "2016-05-23T16:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347859",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:43'></a>Amazing, thanks!



---

archive/issue_comments_347860.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-24T07:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347860",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_347861.json:
```json
{
    "body": "Changing branch from \"u/dlucas/punctured_code\" to \"45d4ee111d235690820ef35269fb8991aa6f4abb\"",
    "created_at": "2016-05-24T07:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19422#issuecomment-347861",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dlucas/punctured_code" to "45d4ee111d235690820ef35269fb8991aa6f4abb"



---

archive/issue_events_053651.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-24T07:06:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19422",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19422#event-53651"
}
```
