# Issue 19814: Number Theory::random_prime(n) generating composite numbers for large values of n

archive/issues_019577.json:
```json
{
    "body": "Assignee: DayneSorvisto\n\nKeywords: prime numbers\n\nHi, \n\nFirst time posting a bug report on trac. The bug I'd like to report is \"random_prime\" returns composite numbers for large integers. For example  \n\n\n```\nrandom_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n```\n\nreturned 71944724797690175157403755256108218794891687825722145298657347991279721529\nwhich is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n\nLooking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.\n\n\n```\nprime_test = is_pseudoprime\n```\n\nThe is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.\n\nSuggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? \n\nIssue created by migration from https://trac.sagemath.org/ticket/19814\n\n",
    "closed_at": "2016-01-04T17:33:11Z",
    "created_at": "2015-12-31T07:56:02Z",
    "labels": [
        "component: number theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Number Theory::random_prime(n) generating composite numbers for large values of n",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19814",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```
Assignee: DayneSorvisto

Keywords: prime numbers

Hi, 

First time posting a bug report on trac. The bug I'd like to report is "random_prime" returns composite numbers for large integers. For example  


```
random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
```

returned 71944724797690175157403755256108218794891687825722145298657347991279721529
which is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.

Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.


```
prime_test = is_pseudoprime
```

The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.

Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? 

Issue created by migration from https://trac.sagemath.org/ticket/19814





---

archive/issue_comments_268651.json:
```json
{
    "body": "Set assignee to DayneSorvisto.",
    "created_at": "2015-12-31T08:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-268651",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Set assignee to DayneSorvisto.



---

archive/issue_comments_268652.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-12-31T08:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-268652",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_268653.json:
```json
{
    "body": "added to original post",
    "created_at": "2015-12-31T08:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-268653",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

added to original post



---

archive/issue_comments_268654.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-03T01:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-268654",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_268655.json:
```json
{
    "body": "As far as I can tell, that is a prime number:\n\n```\nsage: x = 71944724797690175157403755256108218794891687825722145298657347991279721529\nsage: sum(x.digits())\n368\nsage: 3+6+8 % 3\n11\nsage: (3+6+8) % 3\n2\nsage: x.is_prime()\nTrue\n```\nIf I'm mistaken, could you tell me its prime decomposition?",
    "created_at": "2016-01-03T01:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-268655",
    "user": "https://github.com/tscrim"
}
```

As far as I can tell, that is a prime number:

```
sage: x = 71944724797690175157403755256108218794891687825722145298657347991279721529
sage: sum(x.digits())
368
sage: 3+6+8 % 3
11
sage: (3+6+8) % 3
2
sage: x.is_prime()
True
```
If I'm mistaken, could you tell me its prime decomposition?



---

archive/issue_events_054218.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-01-03T01:25:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19814#event-54218"
}
```



---

archive/issue_comments_268656.json:
```json
{
    "body": "Also, according to the docs there are currently no known pseudoprimes that are not actually prime, so if you find a counterexample it would probably be publication worthy ;-)",
    "created_at": "2016-01-04T17:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-268656",
    "user": "https://github.com/vbraun"
}
```

Also, according to the docs there are currently no known pseudoprimes that are not actually prime, so if you find a counterexample it would probably be publication worthy ;-)



---

archive/issue_events_054219.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-04T17:33:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19814#event-54219"
}
```



---

archive/issue_comments_268657.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2016-01-04T17:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-268657",
    "user": "https://github.com/vbraun"
}
```

Resolution: invalid
