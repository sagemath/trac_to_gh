# Issue 19814: Number Theory::random_prime(n) generating composite numbers for large values of n

archive/issues_019577.json:
```json
{
    "body": "Hi, \n\nFirst time posting a bug report on trac. The bug I'd like to report is \"random_prime\" returns composite numbers for large integers. For example  \n\n\n```\nrandom_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n```\n\nreturned 71944724797690175157403755256108218794891687825722145298657347991279721529\nwhich is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n\nLooking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.\n\n\n```\nprime_test = is_pseudoprime\n```\n\nThe is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.\n\nSuggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? \n\nAssignee: DayneSorvisto\n\nKeywords: prime numbers\n\nReviewer: Travis Scrimshaw\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/19814\n\n",
    "closed_at": "2016-01-04T17:33:11Z",
    "created_at": "2015-12-31T07:56:02Z",
    "labels": [
        "component: number theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Number Theory::random_prime(n) generating composite numbers for large values of n",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19814",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```
Hi, 

First time posting a bug report on trac. The bug I'd like to report is "random_prime" returns composite numbers for large integers. For example  


```
random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
```

returned 71944724797690175157403755256108218794891687825722145298657347991279721529
which is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.

Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.


```
prime_test = is_pseudoprime
```

The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.

Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? 

Assignee: DayneSorvisto

Keywords: prime numbers

Reviewer: Travis Scrimshaw

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/19814





---

archive/issue_comments_286157.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,15 @@\n Hi, \n \n-First time posting a bug report on trac. The bug I'd like to report is \"random_value\" returns composite numbers for large integers. For example  m = random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n-returned \n-71944724797690175157403755256108218794891687825722145298657347991279721529\n-which is a composite number ending in 9.\n+First time posting a bug report on trac. The bug I'd like to report is \"random_value\" returns composite numbers for large integers. For example  \n+\n+\n+```\n+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n+```\n+\n+returned 71944724797690175157403755256108218794891687825722145298657347991279721529\n+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n+\n \n Upstream: Reported upstream. No feedback yet.\n \n``````\n",
    "created_at": "2015-12-31T08:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286157",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,15 @@
 Hi, 
 
-First time posting a bug report on trac. The bug I'd like to report is "random_value" returns composite numbers for large integers. For example  m = random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
-returned 
-71944724797690175157403755256108218794891687825722145298657347991279721529
-which is a composite number ending in 9.
+First time posting a bug report on trac. The bug I'd like to report is "random_value" returns composite numbers for large integers. For example  
+
+
+```
+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
+```
+
+returned 71944724797690175157403755256108218794891687825722145298657347991279721529
+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.
+
 
 Upstream: Reported upstream. No feedback yet.
 
``````




---

archive/issue_comments_286158.json:
```json
{
    "body": "Set assignee to DayneSorvisto.",
    "created_at": "2015-12-31T08:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286158",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Set assignee to DayneSorvisto.



---

archive/issue_comments_286159.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-12-31T08:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286159",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_286160.json:
```json
{
    "body": "<a id='comment:4'></a>added to original post",
    "created_at": "2015-12-31T08:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286160",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

<a id='comment:4'></a>added to original post



---

archive/issue_comments_286161.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n+Hi, \n+\n+First time posting a bug report on trac. The bug I'd like to report is \"random_prime\" returns composite numbers for large integers. For example  \n+\n+\n+```\n+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n+```\n+\n+returned 71944724797690175157403755256108218794891687825722145298657347991279721529\n+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n \n \n Upstream: Reported upstream. No feedback yet.\n``````\n",
    "created_at": "2015-12-31T09:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286161",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
+Hi, 
+
+First time posting a bug report on trac. The bug I'd like to report is "random_prime" returns composite numbers for large integers. For example  
+
+
+```
+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
+```
+
+returned 71944724797690175157403755256108218794891687825722145298657347991279721529
+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.
 
 
 Upstream: Reported upstream. No feedback yet.
``````




---

archive/issue_comments_286162.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,24 @@\n+Hi, \n+\n+First time posting a bug report on trac. The bug I'd like to report is \"random_prime\" returns composite numbers for large integers. For example  \n+\n+\n+```\n+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n+```\n+\n+returned 71944724797690175157403755256108218794891687825722145298657347991279721529\n+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n+\n+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.\n+\n+\n+```\n+smallest_prime = ZZ(lbound-1).next_probable_prime()\n+```\n+\n+\n+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? Or at the very least checking small prime factors? If this function were being used in Cryptography, the Handbook of Applied Cryptography recommends the Miller Rabin test for random large primes. \n \n \n Upstream: Reported upstream. No feedback yet.\n``````\n",
    "created_at": "2015-12-31T09:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286162",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,24 @@
+Hi, 
+
+First time posting a bug report on trac. The bug I'd like to report is "random_prime" returns composite numbers for large integers. For example  
+
+
+```
+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
+```
+
+returned 71944724797690175157403755256108218794891687825722145298657347991279721529
+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.
+
+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.
+
+
+```
+smallest_prime = ZZ(lbound-1).next_probable_prime()
+```
+
+
+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? Or at the very least checking small prime factors? If this function were being used in Cryptography, the Handbook of Applied Cryptography recommends the Miller Rabin test for random large primes. 
 
 
 Upstream: Reported upstream. No feedback yet.
``````




---

archive/issue_comments_286163.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,25 @@\n+Hi, \n \n+First time posting a bug report on trac. The bug I'd like to report is \"random_prime\" returns composite numbers for large integers. For example  \n+\n+\n+```\n+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n+```\n+\n+returned 71944724797690175157403755256108218794891687825722145298657347991279721529\n+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n+\n+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.\n+\n+\n+```\n+prime_test = is_pseudoprime\n+```\n+\n+The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.\n+\n+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? I suspect the is_pseudoprime function doesn't check very small prime factors such as 3.\n \n Upstream: Reported upstream. No feedback yet.\n \n``````\n",
    "created_at": "2015-12-31T10:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286163",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,25 @@
+Hi, 
 
+First time posting a bug report on trac. The bug I'd like to report is "random_prime" returns composite numbers for large integers. For example  
+
+
+```
+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
+```
+
+returned 71944724797690175157403755256108218794891687825722145298657347991279721529
+which is a composite number ending in 9. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.
+
+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.
+
+
+```
+prime_test = is_pseudoprime
+```
+
+The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.
+
+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? I suspect the is_pseudoprime function doesn't check very small prime factors such as 3.
 
 Upstream: Reported upstream. No feedback yet.
 
``````




---

archive/issue_comments_286164.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,25 @@\n+Hi, \n \n+First time posting a bug report on trac. The bug I'd like to report is \"random_prime\" returns composite numbers for large integers. For example  \n+\n+\n+```\n+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n+```\n+\n+returned 71944724797690175157403755256108218794891687825722145298657347991279721529\n+which is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n+\n+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.\n+\n+\n+```\n+prime_test = is_pseudoprime\n+```\n+\n+The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.\n+\n+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? I suspect the is_pseudoprime function doesn't check very small prime factors such as 3.\n \n Upstream: Reported upstream. No feedback yet.\n \n``````\n",
    "created_at": "2015-12-31T10:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286164",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,25 @@
+Hi, 
 
+First time posting a bug report on trac. The bug I'd like to report is "random_prime" returns composite numbers for large integers. For example  
+
+
+```
+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
+```
+
+returned 71944724797690175157403755256108218794891687825722145298657347991279721529
+which is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.
+
+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.
+
+
+```
+prime_test = is_pseudoprime
+```
+
+The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.
+
+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? I suspect the is_pseudoprime function doesn't check very small prime factors such as 3.
 
 Upstream: Reported upstream. No feedback yet.
 
``````




---

archive/issue_comments_286165.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,25 @@\n+Hi, \n \n+First time posting a bug report on trac. The bug I'd like to report is \"random_prime\" returns composite numbers for large integers. For example  \n+\n+\n+```\n+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)\n+```\n+\n+returned 71944724797690175157403755256108218794891687825722145298657347991279721529\n+which is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.\n+\n+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.\n+\n+\n+```\n+prime_test = is_pseudoprime\n+```\n+\n+The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.\n+\n+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? \n \n Upstream: Reported upstream. No feedback yet.\n \n``````\n",
    "created_at": "2015-12-31T10:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286165",
    "user": "https://trac.sagemath.org/admin/accounts/users/DayneSorvisto"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,25 @@
+Hi, 
 
+First time posting a bug report on trac. The bug I'd like to report is "random_prime" returns composite numbers for large integers. For example  
+
+
+```
+random_prime(100000000000000000000000000000000000000000000000000000000000000000000000000)
+```
+
+returned 71944724797690175157403755256108218794891687825722145298657347991279721529
+which is a composite number. I am using the [SageMath](SageMath) cloud notebook but believe it's reproducible on other implementations of Sage.
+
+Looking at the source in rings.arith.py it seems that the problem is this line which generates a probable prime for large numbers.
+
+
+```
+prime_test = is_pseudoprime
+```
+
+The is_prseudoprime function then generates the erroneous output. According to the documentation this is an implementation of the Miller Rabin Test and the Lucas Test.
+
+Suggestions: Perhaps there could be some more error checking for large numbers so Sage doesn't return obviously composite numbers? 
 
 Upstream: Reported upstream. No feedback yet.
 
``````




---

archive/issue_comments_286166.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-03T01:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286166",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286167.json:
```json
{
    "body": "<a id='comment:10'></a>As far as I can tell, that is a prime number:\n\n```\nsage: x = 71944724797690175157403755256108218794891687825722145298657347991279721529\nsage: sum(x.digits())\n368\nsage: 3+6+8 % 3\n11\nsage: (3+6+8) % 3\n2\nsage: x.is_prime()\nTrue\n```\nIf I'm mistaken, could you tell me its prime decomposition?",
    "created_at": "2016-01-03T01:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286167",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>As far as I can tell, that is a prime number:

```
sage: x = 71944724797690175157403755256108218794891687825722145298657347991279721529
sage: sum(x.digits())
368
sage: 3+6+8 % 3
11
sage: (3+6+8) % 3
2
sage: x.is_prime()
True
```
If I'm mistaken, could you tell me its prime decomposition?



---

archive/issue_events_054218.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-01-03T01:25:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19814#event-54218"
}
```



---

archive/issue_comments_286168.json:
```json
{
    "body": "<a id='comment:11'></a>Also, according to the docs there are currently no known pseudoprimes that are not actually prime, so if you find a counterexample it would probably be publication worthy ;-)",
    "created_at": "2016-01-04T17:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286168",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>Also, according to the docs there are currently no known pseudoprimes that are not actually prime, so if you find a counterexample it would probably be publication worthy ;-)



---

archive/issue_events_054219.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-04T17:33:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19814#event-54219"
}
```



---

archive/issue_comments_286169.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2016-01-04T17:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19814#issuecomment-286169",
    "user": "https://github.com/vbraun"
}
```

Resolution: invalid
