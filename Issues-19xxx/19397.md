# Issue 19397: Add support for homogeneous components of a filtered module

archive/issues_019160.json:
```json
{
    "body": "Separates out functionality of `subset(d)` for finite dimensional filtered modules with basis and implements a method to get the submodule spanned by a homogeneous piece.\n\nAssignee: sage-combinat\n\nCC:  sage-combinat @darijgr @nthiery simonking\n\nBranch/Commit: f9aaad57b8a72530f3950252c443f30c09a4f13b\n\nReviewer: John Palmieri\n\nAuthor: Travis Scrimshaw\n\nDependencies: #17096\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19397\n\n",
    "closed_at": "2016-04-25T08:38:17Z",
    "created_at": "2015-10-13T00:47:51Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Add support for homogeneous components of a filtered module",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19397",
    "user": "https://github.com/tscrim"
}
```
Separates out functionality of `subset(d)` for finite dimensional filtered modules with basis and implements a method to get the submodule spanned by a homogeneous piece.

Assignee: sage-combinat

CC:  sage-combinat @darijgr @nthiery simonking

Branch/Commit: f9aaad57b8a72530f3950252c443f30c09a4f13b

Reviewer: John Palmieri

Author: Travis Scrimshaw

Dependencies: #17096

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19397





---

archive/issue_comments_347329.json:
```json
{
    "body": "<a id='comment:1'></a>This will be useful along with the changes I'm making in #6102, which I think will be our first naturally graded finite-dimensional algebra in Sage.\n\n---\nLast 10 new commits:",
    "created_at": "2015-10-13T00:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347329",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>This will be useful along with the changes I'm making in #6102, which I think will be our first naturally graded finite-dimensional algebra in Sage.

---
Last 10 new commits:



---

archive/issue_comments_347330.json:
```json
{
    "body": "Changing commit from \"\" to \"9c51a4c0984fc70d4a4ca5464621408559640f66\"",
    "created_at": "2015-10-13T00:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347330",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "" to "9c51a4c0984fc70d4a4ca5464621408559640f66"



---

archive/issue_comments_347331.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-13T00:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347331",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347332.json:
```json
{
    "body": "Changing branch from \"\" to \"public/categories/homogeneous_components-19397\"",
    "created_at": "2015-10-13T00:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347332",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "" to "public/categories/homogeneous_components-19397"



---

archive/issue_comments_347333.json:
```json
{
    "body": "<a id='comment:2'></a>You have the comment starting with\n\n```\n# TODO: which syntax do we prefer?\n```\ntwice, along with two different `basis` methods in `filtered_modules_with_basis.py`.",
    "created_at": "2015-10-13T01:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347333",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>You have the comment starting with

```
# TODO: which syntax do we prefer?
```
twice, along with two different `basis` methods in `filtered_modules_with_basis.py`.



---

archive/issue_comments_347334.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-13T01:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347334",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347335.json:
```json
{
    "body": "Changing commit from \"9c51a4c0984fc70d4a4ca5464621408559640f66\" to \"ae81aa7c64064ba8de5598aa01210efac57088c9\"",
    "created_at": "2015-10-13T01:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9c51a4c0984fc70d4a4ca5464621408559640f66" to "ae81aa7c64064ba8de5598aa01210efac57088c9"



---

archive/issue_comments_347336.json:
```json
{
    "body": "<a id='comment:4'></a>Is this a problem?\n\n```\nsage: A = GradedModulesWithBasis(ZZ).example()\nsage: A.homogeneous_component(3).an_element()   # not printed like elements of A\n3*B[[1, 1, 1]] + 3*B[[2, 1]] + B[[3]]\nsage: a = A.homogeneous_component(3).an_element()\nsage: a in A\nFalse\n```\nAlso, `A(a)` leads to a `NotImplementedError`. So once you have an element in a homogeneous component, there isn't an obvious way to view it as an element of the whole module.",
    "created_at": "2015-10-21T17:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347336",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>Is this a problem?

```
sage: A = GradedModulesWithBasis(ZZ).example()
sage: A.homogeneous_component(3).an_element()   # not printed like elements of A
3*B[[1, 1, 1]] + 3*B[[2, 1]] + B[[3]]
sage: a = A.homogeneous_component(3).an_element()
sage: a in A
False
```
Also, `A(a)` leads to a `NotImplementedError`. So once you have an element in a homogeneous component, there isn't an obvious way to view it as an element of the whole module.



---

archive/issue_comments_347337.json:
```json
{
    "body": "<a id='comment:5'></a>I was originally taking care of this on #19359, but I've now moved this to #19448 (which you can set as a dependency if you feel it is warranted).",
    "created_at": "2015-10-21T19:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347337",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>I was originally taking care of this on #19359, but I've now moved this to #19448 (which you can set as a dependency if you feel it is warranted).



---

archive/issue_comments_347338.json:
```json
{
    "body": "<a id='comment:6'></a>Will #19448 also make\n\n```\nlist(A.homogeneous_component(4).basis())\n```\nand\n\n```\nlist(A.homogeneous_component_basis(4))\n```\nequal? (Can they be equal? The elements in the first are elements in a particular homogeneous component. The elements in the second are elements in the whole module. At least they should look the same when you print them, and I think #19448 should take care of that.)",
    "created_at": "2015-10-22T18:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347338",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>Will #19448 also make

```
list(A.homogeneous_component(4).basis())
```
and

```
list(A.homogeneous_component_basis(4))
```
equal? (Can they be equal? The elements in the first are elements in a particular homogeneous component. The elements in the second are elements in the whole module. At least they should look the same when you print them, and I think #19448 should take care of that.)



---

archive/issue_comments_347339.json:
```json
{
    "body": "<a id='comment:7'></a>One mathematical issue: in defining `homogeneous_component`, you have\n\n```\ncategory = ModulesWithBasis(self.category().base_ring())\n```\nA homogeneous component of an *R*-module need not be an *R*-module itself in a natural way: for example, if the base ring is the graded ring *R*=*k*[*x*, *x*<sup>-1</sup>] with *x* in some nonzero degree, then for any homogeneous component of any graded *R*-module, *x* would have to act trivially (because *x* has nonzero degree). On the other hand, *x* is supposed to be invertible.\n\nIt will always be a module over the degree 0 part of the base ring, though.",
    "created_at": "2015-10-22T18:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347339",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>One mathematical issue: in defining `homogeneous_component`, you have

```
category = ModulesWithBasis(self.category().base_ring())
```
A homogeneous component of an *R*-module need not be an *R*-module itself in a natural way: for example, if the base ring is the graded ring *R*=*k*[*x*, *x*<sup>-1</sup>] with *x* in some nonzero degree, then for any homogeneous component of any graded *R*-module, *x* would have to act trivially (because *x* has nonzero degree). On the other hand, *x* is supposed to be invertible.

It will always be a module over the degree 0 part of the base ring, though.



---

archive/issue_comments_347340.json:
```json
{
    "body": "<a id='comment:8'></a>John: I fear that this notion of grading is not currently implemented in Sage (again, hardly anyone's deliberate design choice, but an artifact of ungraded base rings being the de-facto standard in combinatorics). Almost all of the current code in `FilteredModulesWithBasis` currently assumes that the base ring is ungraded :(\n\nIncidentally, IMHO this issue shows that we are mistaken in the assumption that in order to equip an algebra with a grading, we should add `degree` and similar functions to the class. Many algebras have several natural gradings, and each of them comes with its own notion of a graded module. When you speak of a \"graded R[x]-module\", you have to specify whether x has degree 1 or 0 (or anything else); even in combinatorics, both of these cases happen. So if/when we make R[x] into a graded ring, what should its grading be? I think it shouldn't. There should be a two graded rings, called `PolynomialRing(QQ).trivial_grading()` and `PolynomialRing().degree_grading()` or something like this, while `PolynomialRing(QQ)` itself should just be a `QQ`-algebra. Actually the `trivial_grading()` function should be defined generically on any module and return the corresponding graded module with trivial grading. And there can be further gradings and filtrations likewise (I can see good uses for filtered the tensor algebra by word length, number of distinct letters, maximal multiplicity of a letter, etc. -- there is no way the code should decide between them for the user!).",
    "created_at": "2015-10-24T14:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347340",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>John: I fear that this notion of grading is not currently implemented in Sage (again, hardly anyone's deliberate design choice, but an artifact of ungraded base rings being the de-facto standard in combinatorics). Almost all of the current code in `FilteredModulesWithBasis` currently assumes that the base ring is ungraded :(

Incidentally, IMHO this issue shows that we are mistaken in the assumption that in order to equip an algebra with a grading, we should add `degree` and similar functions to the class. Many algebras have several natural gradings, and each of them comes with its own notion of a graded module. When you speak of a "graded R[x]-module", you have to specify whether x has degree 1 or 0 (or anything else); even in combinatorics, both of these cases happen. So if/when we make R[x] into a graded ring, what should its grading be? I think it shouldn't. There should be a two graded rings, called `PolynomialRing(QQ).trivial_grading()` and `PolynomialRing().degree_grading()` or something like this, while `PolynomialRing(QQ)` itself should just be a `QQ`-algebra. Actually the `trivial_grading()` function should be defined generically on any module and return the corresponding graded module with trivial grading. And there can be further gradings and filtrations likewise (I can see good uses for filtered the tensor algebra by word length, number of distinct letters, maximal multiplicity of a letter, etc. -- there is no way the code should decide between them for the user!).



---

archive/issue_comments_347341.json:
```json
{
    "body": "<a id='comment:9'></a>For this situation, what about code like\n\n```\ntry:\n    R = self.base_ring().homogeneous_component(0)\n    # or R = self.base_ring().base_ring()??\nexcept AttributeError:\n    R = self.base_ring()\ncategory = ModulesWithBasis(self.category().R)\n```\nThis may end up calling `homogeneous_component` recursively, but eventually that should end with an ungraded base ring.\n\nYes, I also agree that we need to allow for multiple possible gradings. I think this has been discussed before. To construct a graded ring you should specify a ring and a grading on it, and different gradings give different graded rings.",
    "created_at": "2015-10-24T14:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347341",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>For this situation, what about code like

```
try:
    R = self.base_ring().homogeneous_component(0)
    # or R = self.base_ring().base_ring()??
except AttributeError:
    R = self.base_ring()
category = ModulesWithBasis(self.category().R)
```
This may end up calling `homogeneous_component` recursively, but eventually that should end with an ungraded base ring.

Yes, I also agree that we need to allow for multiple possible gradings. I think this has been discussed before. To construct a graded ring you should specify a ring and a grading on it, and different gradings give different graded rings.



---

archive/issue_comments_347342.json:
```json
{
    "body": "<a id='comment:10'></a>However there is a technical problem with doing that in the short-term in that `submodule` currently does not differentiate between coordinate rings and base rings (think `ZZ`-submodule in a `QQ`-module). See also Jeroen's comments in #18310.\n\nSo if we were decided to do do the above, then we should add coordinate ring support in #19448 and make that a dependency of this one.\n\nAlternatively we could just raise a `NotImplementedError` for now if the module and base ring are both graded.",
    "created_at": "2015-10-26T14:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347342",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>However there is a technical problem with doing that in the short-term in that `submodule` currently does not differentiate between coordinate rings and base rings (think `ZZ`-submodule in a `QQ`-module). See also Jeroen's comments in #18310.

So if we were decided to do do the above, then we should add coordinate ring support in #19448 and make that a dependency of this one.

Alternatively we could just raise a `NotImplementedError` for now if the module and base ring are both graded.



---

archive/issue_comments_347343.json:
```json
{
    "body": "<a id='comment:11'></a>I think we should do something, just to acknowledge that it is an issue that we might address later. A `NotImplementedError` sounds fine to me. Whatever is simplest, I think.",
    "created_at": "2015-10-26T15:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347343",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>I think we should do something, just to acknowledge that it is an issue that we might address later. A `NotImplementedError` sounds fine to me. Whatever is simplest, I think.



---

archive/issue_comments_347344.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-26T16:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347345.json:
```json
{
    "body": "Changing commit from \"ae81aa7c64064ba8de5598aa01210efac57088c9\" to \"f89275b059b5dee1488feee46090596c157615c0\"",
    "created_at": "2015-10-26T16:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347345",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ae81aa7c64064ba8de5598aa01210efac57088c9" to "f89275b059b5dee1488feee46090596c157615c0"



---

archive/issue_comments_347346.json:
```json
{
    "body": "<a id='comment:13'></a>The simple way is to raise a `NotImplementedError` for now. Although now I find myself wishing for filtered magmas...",
    "created_at": "2015-10-26T16:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347346",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>The simple way is to raise a `NotImplementedError` for now. Although now I find myself wishing for filtered magmas...



---

archive/issue_comments_347347.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-26T18:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347347",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347348.json:
```json
{
    "body": "<a id='comment:14'></a>This looks okay to me.",
    "created_at": "2015-10-26T18:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347348",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>This looks okay to me.



---

archive/issue_comments_347349.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2015-10-26T18:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347349",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_347350.json:
```json
{
    "body": "<a id='comment:15'></a>Doctests fail:\n\nhttp://build.sagedev.org/release/builders/%20%20slow%20AIMS%20%20%28Debian%207%2064%20bit%29%20incremental/builds/152/steps/shell_4/logs/stdio",
    "created_at": "2015-10-27T00:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347350",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>Doctests fail:

http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20%20%28Debian%207%2064%20bit%29%20incremental/builds/152/steps/shell_4/logs/stdio



---

archive/issue_comments_347351.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-10-27T00:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347351",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_347352.json:
```json
{
    "body": "<a id='comment:16'></a>All tests passed for me on one machine (before I gave a positive review) and on another machine now. Any suggestions about how we can recreate these doctest failures to try to diagnose them?",
    "created_at": "2015-10-27T04:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347352",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>All tests passed for me on one machine (before I gave a positive review) and on another machine now. Any suggestions about how we can recreate these doctest failures to try to diagnose them?



---

archive/issue_comments_347353.json:
```json
{
    "body": "<a id='comment:17'></a>Can you merge in the next beta when its out?",
    "created_at": "2015-10-27T08:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347353",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>Can you merge in the next beta when its out?



---

archive/issue_comments_347354.json:
```json
{
    "body": "<a id='comment:18'></a>This looks like the same issues located on #15536.",
    "created_at": "2015-10-28T02:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347354",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>This looks like the same issues located on #15536.



---

archive/issue_comments_347355.json:
```json
{
    "body": "<a id='comment:19'></a>With the latest beta, I see these failures. I don't know what to make of them, though.",
    "created_at": "2015-10-29T05:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347355",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>With the latest beta, I see these failures. I don't know what to make of them, though.



---

archive/issue_comments_347356.json:
```json
{
    "body": "<a id='comment:20'></a>I can also reproduce this by just running the tests on `modules_with_basis.py`.\n\nI tried the same hack on #15536 and I got errors. To the extreme, I made the prime check on the input for `Zmod` and removed the category refinement, and I *still* got errors.\n\nI am strongly inclined to believe that it is not an issue with category refinement, but instead something is wrong with how the category MRO is being constructed. I would want to simultaneously fix for both #15536 and this, but I'm fairly convinced they are different issues.\n\nYet another data point. I created a separate class and file for the new category, and then set `FiniteDimensionalModulesWithBasis.Filtered` to this new class (also now inheriting from `FilteredModulesCategory` by following what `GradedHopfAlgebrasWithBasis` does). This now does not set the correct category as\n\n```\nsage: (ModulesWithBasis(ZZ).Filtered().FiniteDimensional()\n....:  == ModulesWithBasis(ZZ).FiniteDimensional().Filtered())\nFalse\n```\nThis is on `u/tscrim/test-19397`. <edit>Fix bad copying</edit>\n\nI have absolutely no idea what is going on. I would appreciate some comments from those that implemented how the category code handles these things.",
    "created_at": "2015-10-31T17:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347356",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>I can also reproduce this by just running the tests on `modules_with_basis.py`.

I tried the same hack on #15536 and I got errors. To the extreme, I made the prime check on the input for `Zmod` and removed the category refinement, and I *still* got errors.

I am strongly inclined to believe that it is not an issue with category refinement, but instead something is wrong with how the category MRO is being constructed. I would want to simultaneously fix for both #15536 and this, but I'm fairly convinced they are different issues.

Yet another data point. I created a separate class and file for the new category, and then set `FiniteDimensionalModulesWithBasis.Filtered` to this new class (also now inheriting from `FilteredModulesCategory` by following what `GradedHopfAlgebrasWithBasis` does). This now does not set the correct category as

```
sage: (ModulesWithBasis(ZZ).Filtered().FiniteDimensional()
....:  == ModulesWithBasis(ZZ).FiniteDimensional().Filtered())
False
```
This is on `u/tscrim/test-19397`. <edit>Fix bad copying</edit>

I have absolutely no idea what is going on. I would appreciate some comments from those that implemented how the category code handles these things.



---

archive/issue_comments_347357.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 tscrim]:\n> Yet another data point. I created a separate class and file for the new category, and then set `FiniteDimensionalModulesWithBasis.Filtered` to this new class (also now inheriting from `FilteredModulesCategory` by following what `GradedHopfAlgebrasWithBasis` does). This now does not set the correct category as\n> \n> ```\n> sage: (ModulesWithBasis(ZZ).Filtered().FiniteDimesnional()\n> ....:  != ModulesWithBasis(ZZ).FiniteDimesnional().Filtered())\n> False\n> ```\n\n\nWhy is that not correct? If I understand correctly, one meta-axiom (i.e., an axiom for our axiom framework) is that application of axioms commutes. Thus, if you have a category C and axioms A and B, then `C.A().B()` will always be identical with `C.B().A()`.",
    "created_at": "2015-10-31T21:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347357",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>Replying to [comment:20 tscrim]:
> Yet another data point. I created a separate class and file for the new category, and then set `FiniteDimensionalModulesWithBasis.Filtered` to this new class (also now inheriting from `FilteredModulesCategory` by following what `GradedHopfAlgebrasWithBasis` does). This now does not set the correct category as
> 
> ```
> sage: (ModulesWithBasis(ZZ).Filtered().FiniteDimesnional()
> ....:  != ModulesWithBasis(ZZ).FiniteDimesnional().Filtered())
> False
> ```


Why is that not correct? If I understand correctly, one meta-axiom (i.e., an axiom for our axiom framework) is that application of axioms commutes. Thus, if you have a category C and axioms A and B, then `C.A().B()` will always be identical with `C.B().A()`.



---

archive/issue_comments_347358.json:
```json
{
    "body": "<a id='comment:22'></a>Sorry, that was a copy error, it should have be checking `==`.",
    "created_at": "2015-10-31T21:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347358",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>Sorry, that was a copy error, it should have be checking `==`.



---

archive/issue_comments_347359.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 tscrim]:\n> Sorry, that was a copy error, it should have be checking `==`.\n\n\nOK, if it says that the two categories are not identical then it is a bug.",
    "created_at": "2015-10-31T21:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347359",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:23'></a>Replying to [comment:22 tscrim]:
> Sorry, that was a copy error, it should have be checking `==`.


OK, if it says that the two categories are not identical then it is a bug.



---

archive/issue_comments_347360.json:
```json
{
    "body": "<a id='comment:24'></a>It looks like this is caused by the combination of this ticket and #18066. (That is, if I take 6.10.beta1 and merge those two branches, I get doctest failures.)",
    "created_at": "2015-11-01T22:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347360",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>It looks like this is caused by the combination of this ticket and #18066. (That is, if I take 6.10.beta1 and merge those two branches, I get doctest failures.)



---

archive/issue_comments_347361.json:
```json
{
    "body": "<a id='comment:25'></a>Somehow it is caused by the addition of the new explicit (non-join) category and that standard free modules are now in `FreeModules(R).FiniteDimensional()`, whereas before they were just `FreeModules(R)` (which is an alias for `Modules(R).WithBasis()`). Reverting back this change from #18066\n\n```diff\n+category = FreeModules(base_ring.category()).FiniteDimensional()\n-category = FreeModules(base_ring.category())\n```\nthen all tests pass...but I don't want to do this...",
    "created_at": "2015-11-02T02:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347361",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:25'></a>Somehow it is caused by the addition of the new explicit (non-join) category and that standard free modules are now in `FreeModules(R).FiniteDimensional()`, whereas before they were just `FreeModules(R)` (which is an alias for `Modules(R).WithBasis()`). Reverting back this change from #18066

```diff
+category = FreeModules(base_ring.category()).FiniteDimensional()
-category = FreeModules(base_ring.category())
```
then all tests pass...but I don't want to do this...



---

archive/issue_comments_347362.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-02T16:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347363.json:
```json
{
    "body": "Changing commit from \"f89275b059b5dee1488feee46090596c157615c0\" to \"92380fef1033e35785ce9f5ea21cc2106b8f3e86\"",
    "created_at": "2015-11-02T16:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347363",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f89275b059b5dee1488feee46090596c157615c0" to "92380fef1033e35785ce9f5ea21cc2106b8f3e86"



---

archive/issue_comments_347364.json:
```json
{
    "body": "<a id='comment:27'></a>Sorry about the last push, I messed up using git.",
    "created_at": "2015-11-02T16:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347364",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>Sorry about the last push, I messed up using git.



---

archive/issue_comments_347365.json:
```json
{
    "body": "<a id='comment:28'></a>A more minimal example of the failure is:\n\n```\nsage: Algebras(GF(2)).WithBasis().Graded().FiniteDimensional()\n```",
    "created_at": "2016-04-10T18:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347365",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>A more minimal example of the failure is:

```
sage: Algebras(GF(2)).WithBasis().Graded().FiniteDimensional()
```



---

archive/issue_comments_347366.json:
```json
{
    "body": "Changing commit from \"92380fef1033e35785ce9f5ea21cc2106b8f3e86\" to \"46434a5a7ac5e0cf926e6b18d3e11323ce040e74\"",
    "created_at": "2016-04-11T21:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "92380fef1033e35785ce9f5ea21cc2106b8f3e86" to "46434a5a7ac5e0cf926e6b18d3e11323ce040e74"



---

archive/issue_comments_347367.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-11T21:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347367",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347368.json:
```json
{
    "body": "<a id='comment:30'></a>I don't know how to fix the underlying problem, but I have a few other small changes to suggest. First, correct an error message:\n\n```diff\ndiff --git a/src/sage/categories/category.py b/src/sage/categories/category.py\nindex 2d50eac..c022b00 100644\n--- a/src/sage/categories/category.py\n+++ b/src/sage/categories/category.py\n@@ -1852,7 +1852,7 @@ class Category(UniqueRepresentation, SageObject):\n         if join:\n             return Category.join([self, category])\n         else:\n-            assert category.is_subcategory(self), \"Subcategory of `{}` required; got `{}`\".format(category, self)\n+            assert category.is_subcategory(self), \"Subcategory of `{}` required; got `{}`\".format(self, category)\n             return category\n \n     def _is_subclass(self, c):\n```\nSecond, fix a category (if we fix the MRO problem, this misdefined category causes problems):\n\n```diff\ndiff --git a/src/sage/homology/homology_vector_space_with_basis.py b/src/sage/homology/homology_vector_space_with_basis.py\nindex 00f8759..8cbf4f6 100644\n--- a/src/sage/homology/homology_vector_space_with_basis.py\n+++ b/src/sage/homology/homology_vector_space_with_basis.py\n@@ -435,7 +435,7 @@ class CohomologyRing(HomologyVectorSpaceWithBasis):\n             sage: H = RP2.cohomology_ring(GF(5))\n             sage: TestSuite(H).run()\n         \"\"\"\n-        cat = Algebras(base_ring).WithBasis().Graded()\n+        cat = Algebras(base_ring).WithBasis().Graded().FiniteDimensional()\n         HomologyVectorSpaceWithBasis.__init__(self, base_ring, cell_complex, True, cat)\n \n     def _repr_(self):\n```\nFinally, this one is cosmetic, but makes the signature of the method agree with the docstring:\n\n```diff\ndiff --git a/src/sage/homology/homology_vector_space_with_basis.py b/src/sage/homology/homology_vector_space_with_basis.py\nindex 00f8759..8cbf4f6 100644\n--- a/src/sage/homology/homology_vector_space_with_basis.py\n+++ b/src/sage/homology/homology_vector_space_with_basis.py\n@@ -144,7 +144,7 @@ class HomologyVectorSpaceWithBasis(CombinatorialFreeModule):\n         sage: b.cup_product(b)\n         h^{2,0}\n     \"\"\"\n-    def __init__(self, base_ring, cell_complex, cohomology=False, cat=None):\n+    def __init__(self, base_ring, cell_complex, cohomology=False, category=None):\n         \"\"\"\n         Initialize ``self``.\n \n@@ -170,7 +170,7 @@ class HomologyVectorSpaceWithBasis(CombinatorialFreeModule):\n             # We only need the rank of M in each degree, and since\n             # we're working over a field, we don't need to dualize M\n             # if working with cohomology.\n-        cat = Modules(base_ring).WithBasis().Graded().or_subcategory(cat)\n+        category = Modules(base_ring).WithBasis().Graded().FiniteDimensional().or_subcategory(category)\n         self._contraction = phi\n         self._complex = cell_complex\n         self._cohomology = cohomology\n@@ -178,7 +178,7 @@ class HomologyVectorSpaceWithBasis(CombinatorialFreeModule):\n                                 for deg in range(cell_complex.dimension()+1)}\n         indices = [(deg, i) for deg in self._graded_indices\n                    for i in self._graded_indices[deg]]\n-        CombinatorialFreeModule.__init__(self, base_ring, indices, category=cat)\n+        CombinatorialFreeModule.__init__(self, base_ring, indices, category=category)\n \n     def basis(self, d=None):\n         \"\"\"\n```",
    "created_at": "2016-04-12T20:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347368",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>I don't know how to fix the underlying problem, but I have a few other small changes to suggest. First, correct an error message:

```diff
diff --git a/src/sage/categories/category.py b/src/sage/categories/category.py
index 2d50eac..c022b00 100644
--- a/src/sage/categories/category.py
+++ b/src/sage/categories/category.py
@@ -1852,7 +1852,7 @@ class Category(UniqueRepresentation, SageObject):
         if join:
             return Category.join([self, category])
         else:
-            assert category.is_subcategory(self), "Subcategory of `{}` required; got `{}`".format(category, self)
+            assert category.is_subcategory(self), "Subcategory of `{}` required; got `{}`".format(self, category)
             return category
 
     def _is_subclass(self, c):
```
Second, fix a category (if we fix the MRO problem, this misdefined category causes problems):

```diff
diff --git a/src/sage/homology/homology_vector_space_with_basis.py b/src/sage/homology/homology_vector_space_with_basis.py
index 00f8759..8cbf4f6 100644
--- a/src/sage/homology/homology_vector_space_with_basis.py
+++ b/src/sage/homology/homology_vector_space_with_basis.py
@@ -435,7 +435,7 @@ class CohomologyRing(HomologyVectorSpaceWithBasis):
             sage: H = RP2.cohomology_ring(GF(5))
             sage: TestSuite(H).run()
         """
-        cat = Algebras(base_ring).WithBasis().Graded()
+        cat = Algebras(base_ring).WithBasis().Graded().FiniteDimensional()
         HomologyVectorSpaceWithBasis.__init__(self, base_ring, cell_complex, True, cat)
 
     def _repr_(self):
```
Finally, this one is cosmetic, but makes the signature of the method agree with the docstring:

```diff
diff --git a/src/sage/homology/homology_vector_space_with_basis.py b/src/sage/homology/homology_vector_space_with_basis.py
index 00f8759..8cbf4f6 100644
--- a/src/sage/homology/homology_vector_space_with_basis.py
+++ b/src/sage/homology/homology_vector_space_with_basis.py
@@ -144,7 +144,7 @@ class HomologyVectorSpaceWithBasis(CombinatorialFreeModule):
         sage: b.cup_product(b)
         h^{2,0}
     """
-    def __init__(self, base_ring, cell_complex, cohomology=False, cat=None):
+    def __init__(self, base_ring, cell_complex, cohomology=False, category=None):
         """
         Initialize ``self``.
 
@@ -170,7 +170,7 @@ class HomologyVectorSpaceWithBasis(CombinatorialFreeModule):
             # We only need the rank of M in each degree, and since
             # we're working over a field, we don't need to dualize M
             # if working with cohomology.
-        cat = Modules(base_ring).WithBasis().Graded().or_subcategory(cat)
+        category = Modules(base_ring).WithBasis().Graded().FiniteDimensional().or_subcategory(category)
         self._contraction = phi
         self._complex = cell_complex
         self._cohomology = cohomology
@@ -178,7 +178,7 @@ class HomologyVectorSpaceWithBasis(CombinatorialFreeModule):
                                 for deg in range(cell_complex.dimension()+1)}
         indices = [(deg, i) for deg in self._graded_indices
                    for i in self._graded_indices[deg]]
-        CombinatorialFreeModule.__init__(self, base_ring, indices, category=cat)
+        CombinatorialFreeModule.__init__(self, base_ring, indices, category=category)
 
     def basis(self, d=None):
         """
```



---

archive/issue_comments_347369.json:
```json
{
    "body": "<a id='comment:31'></a>What do we lose if we delete the last part of the changes to `filtered_modules_with_basis.py`, that is,\n\n```\nclass FiniteDimensional(CategoryWithAxiom_over_base_ring):\n        class ParentMethods:\n            def homogeneous_component_basis(self, d):\n                ...\n```\n?",
    "created_at": "2016-04-12T21:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347369",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>What do we lose if we delete the last part of the changes to `filtered_modules_with_basis.py`, that is,

```
class FiniteDimensional(CategoryWithAxiom_over_base_ring):
        class ParentMethods:
            def homogeneous_component_basis(self, d):
                ...
```
?



---

archive/issue_comments_347370.json:
```json
{
    "body": "<a id='comment:32'></a>Indeed, if I delete that and change the earlier definition of `homogeneous_component_basis`, then all doctests pass. Here is a branch with these changes. Feel free to revert if these are bad ideas.",
    "created_at": "2016-04-12T22:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347370",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>Indeed, if I delete that and change the earlier definition of `homogeneous_component_basis`, then all doctests pass. Here is a branch with these changes. Feel free to revert if these are bad ideas.



---

archive/issue_comments_347371.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-12T22:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347371",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_347372.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-12T22:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347373.json:
```json
{
    "body": "Changing commit from \"46434a5a7ac5e0cf926e6b18d3e11323ce040e74\" to \"14f6a2843145309abe777e37ac2c96b8e5984d9a\"",
    "created_at": "2016-04-12T22:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "46434a5a7ac5e0cf926e6b18d3e11323ce040e74" to "14f6a2843145309abe777e37ac2c96b8e5984d9a"



---

archive/issue_comments_347374.json:
```json
{
    "body": "<a id='comment:34'></a>Oh, and in the doctest I moved from the now deleted part, I changed `cat` from `GradedModulesWithBasis(ZZ).FiniteDimensional()` to `GradedModulesWithBasis(ZZ)`. We can restore the `FiniteDimensional()` part if you want.",
    "created_at": "2016-04-12T22:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347374",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>Oh, and in the doctest I moved from the now deleted part, I changed `cat` from `GradedModulesWithBasis(ZZ).FiniteDimensional()` to `GradedModulesWithBasis(ZZ)`. We can restore the `FiniteDimensional()` part if you want.



---

archive/issue_comments_347375.json:
```json
{
    "body": "<a id='comment:35'></a>This will definitely do as a workaround. We should add an additional check to make sure `self._indices` is finite and raise an error if not, otherwise the fallback for `homogeneous_component_basis` will run forever.\n\nAlthough if we are changing error messages, I think we should also change that `assert` to raise a `ValueError` on input because it is checking user input (and I like the convention that an `assert` is something that is expected to always be true).\n\nMinor point, but I don't think this import is needed anymore\n\n```\nfrom sage.categories.category_with_axiom import CategoryWithAxiom_over_base_ring\n```\n\nWe will also need a follow-up ticket creating the proper (sub)category with an explanation that it causes an MRO failure.",
    "created_at": "2016-04-13T13:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347375",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>This will definitely do as a workaround. We should add an additional check to make sure `self._indices` is finite and raise an error if not, otherwise the fallback for `homogeneous_component_basis` will run forever.

Although if we are changing error messages, I think we should also change that `assert` to raise a `ValueError` on input because it is checking user input (and I like the convention that an `assert` is something that is expected to always be true).

Minor point, but I don't think this import is needed anymore

```
from sage.categories.category_with_axiom import CategoryWithAxiom_over_base_ring
```

We will also need a follow-up ticket creating the proper (sub)category with an explanation that it causes an MRO failure.



---

archive/issue_comments_347376.json:
```json
{
    "body": "Changing commit from \"14f6a2843145309abe777e37ac2c96b8e5984d9a\" to \"05196437ca8197300162043ae0949c47bb6083ef\"",
    "created_at": "2016-04-18T18:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "14f6a2843145309abe777e37ac2c96b8e5984d9a" to "05196437ca8197300162043ae0949c47bb6083ef"



---

archive/issue_comments_347377.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-18T18:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347378.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:35 tscrim]:\n> This will definitely do as a workaround. We should add an additional check to make sure `self._indices` is finite and raise an error if not, otherwise the fallback for `homogeneous_component_basis` will run forever.\n\n\nI guess I don't know the best way to go about this. If there is no `subset` method (for example), then check `self._indices.is_finite()`. If this fails, what error should we raise -- the lack of `subset` or the failure of finiteness? Or just a general error about the set of indices not being well enough implemented? We can break things down into lots of cases, but that seems like overkill for this piece of error-checking.\n\n> Although if we are changing error messages, I think we should also change that `assert` to raise a `ValueError` on input because it is checking user input (and I like the convention that an `assert` is something that is expected to always be true).\n\n\nI agree.\n\n> Minor point, but I don't think this import is needed anymore\n> \n> ```\n> from sage.categories.category_with_axiom import CategoryWithAxiom_over_base_ring\n> ```\n\n\nFixed.",
    "created_at": "2016-04-18T18:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347378",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'></a>Replying to [comment:35 tscrim]:
> This will definitely do as a workaround. We should add an additional check to make sure `self._indices` is finite and raise an error if not, otherwise the fallback for `homogeneous_component_basis` will run forever.


I guess I don't know the best way to go about this. If there is no `subset` method (for example), then check `self._indices.is_finite()`. If this fails, what error should we raise -- the lack of `subset` or the failure of finiteness? Or just a general error about the set of indices not being well enough implemented? We can break things down into lots of cases, but that seems like overkill for this piece of error-checking.

> Although if we are changing error messages, I think we should also change that `assert` to raise a `ValueError` on input because it is checking user input (and I like the convention that an `assert` is something that is expected to always be true).


I agree.

> Minor point, but I don't think this import is needed anymore
> 
> ```
> from sage.categories.category_with_axiom import CategoryWithAxiom_over_base_ring
> ```


Fixed.



---

archive/issue_comments_347379.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 jhpalmieri]:\n> Replying to [comment:35 tscrim]:\n> > This will definitely do as a workaround. We should add an additional check to make sure `self._indices` is finite and raise an error if not, otherwise the fallback for `homogeneous_component_basis` will run forever.\n\n> \n> I guess I don't know the best way to go about this. If there is no `subset` method (for example), then check `self._indices.is_finite()`. If this fails, what error should we raise -- the lack of `subset` or the failure of finiteness? Or just a general error about the set of indices not being well enough implemented? We can break things down into lots of cases, but that seems like overkill for this piece of error-checking.\n\n\nI have found that calling `list` can very often catch infinite sets. So I would do this change\n\n```diff\n-S = [i for i in self._indices if self.degree_on_basis(i) == d]\n+S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]\n```\nIf this sounds good to you, I can do it as I also want to add a comment saying this will be moved once MRO issues are fixed when creating a the finite-dimensional category.",
    "created_at": "2016-04-18T18:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347379",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>Replying to [comment:37 jhpalmieri]:
> Replying to [comment:35 tscrim]:
> > This will definitely do as a workaround. We should add an additional check to make sure `self._indices` is finite and raise an error if not, otherwise the fallback for `homogeneous_component_basis` will run forever.

> 
> I guess I don't know the best way to go about this. If there is no `subset` method (for example), then check `self._indices.is_finite()`. If this fails, what error should we raise -- the lack of `subset` or the failure of finiteness? Or just a general error about the set of indices not being well enough implemented? We can break things down into lots of cases, but that seems like overkill for this piece of error-checking.


I have found that calling `list` can very often catch infinite sets. So I would do this change

```diff
-S = [i for i in self._indices if self.degree_on_basis(i) == d]
+S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]
```
If this sounds good to you, I can do it as I also want to add a comment saying this will be moved once MRO issues are fixed when creating a the finite-dimensional category.



---

archive/issue_comments_347380.json:
```json
{
    "body": "<a id='comment:39'></a>That sounds good, please go ahead.",
    "created_at": "2016-04-18T19:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347380",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'></a>That sounds good, please go ahead.



---

archive/issue_comments_347381.json:
```json
{
    "body": "Changing commit from \"05196437ca8197300162043ae0949c47bb6083ef\" to \"6c0e7bd2744f734f467cdb3535048ffe9e86c754\"",
    "created_at": "2016-04-18T19:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "05196437ca8197300162043ae0949c47bb6083ef" to "6c0e7bd2744f734f467cdb3535048ffe9e86c754"



---

archive/issue_comments_347382.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-18T19:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347383.json:
```json
{
    "body": "<a id='comment:41'></a>I think there is a word (\"when\"?) missing in the \"TODO\" comment.",
    "created_at": "2016-04-18T19:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347383",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>I think there is a word ("when"?) missing in the "TODO" comment.



---

archive/issue_comments_347384.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-18T19:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347384",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347385.json:
```json
{
    "body": "Changing commit from \"6c0e7bd2744f734f467cdb3535048ffe9e86c754\" to \"068adf38ed5520faa0f31c34e6b3ef636d595bea\"",
    "created_at": "2016-04-18T19:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347385",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6c0e7bd2744f734f467cdb3535048ffe9e86c754" to "068adf38ed5520faa0f31c34e6b3ef636d595bea"



---

archive/issue_comments_347386.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:41 jhpalmieri]:\n> I think there is a word (\"when\"?) missing in the \"TODO\" comment.\n\n\nTrue. I also was able to make it so the text ended at the same position. :P FYI - I decided to amend my previous commit instead of a new one.",
    "created_at": "2016-04-18T19:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347386",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>Replying to [comment:41 jhpalmieri]:
> I think there is a word ("when"?) missing in the "TODO" comment.


True. I also was able to make it so the text ended at the same position. :P FYI - I decided to amend my previous commit instead of a new one.



---

archive/issue_comments_347387.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-18T21:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347387",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347388.json:
```json
{
    "body": "<a id='comment:44'></a>Okay, I'm happy with this now. If you think it's not ready, revert my positive review.",
    "created_at": "2016-04-18T21:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347388",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>Okay, I'm happy with this now. If you think it's not ready, revert my positive review.



---

archive/issue_comments_347389.json:
```json
{
    "body": "<a id='comment:45'></a>It is good. Thank you. MRO issue is now #20460.",
    "created_at": "2016-04-18T21:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347389",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:45'></a>It is good. Thank you. MRO issue is now #20460.



---

archive/issue_comments_347390.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-04-19T16:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347390",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_347391.json:
```json
{
    "body": "<a id='comment:46'></a>\n```\nsage -t --long src/sage/categories/filtered_modules_with_basis.py\n**********************************************************************\nFile \"src/sage/categories/filtered_modules_with_basis.py\", line 160, in sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis.ParentMethods.basis\nFailed example:\n    A.basis(4)\nExpected:\n    Traceback (most recent call last):\n    ...\n    AttributeError: 'IndexedFreeAbelianMonoid_with_category' object has no attribute 'list'\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis.ParentMethods.basis[5]>\", line 1, in <module>\n        A.basis(Integer(4))\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/categories/filtered_modules_with_basis.py\", line 186, in basis\n        return self.homogeneous_component_basis(d)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/categories/filtered_modules_with_basis.py\", line 215, in homogeneous_component_basis\n        S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]\n      File \"sage/structure/parent.pyx\", line 1548, in sage.structure.parent.Parent.__len__ (/mnt/disk/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/structure/parent.c:12470)\n        return len(self.list())\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/categories/infinite_enumerated_sets.py\", line 76, in list\n        raise NotImplementedError(\"infinite list\")\n    NotImplementedError: infinite list\n**********************************************************************\n1 item had failures:\n   1 of  10 in sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis.ParentMethods.basis\n    [214 tests, 1 failure, 0.75 s]\n```",
    "created_at": "2016-04-19T16:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347391",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:46'></a>
```
sage -t --long src/sage/categories/filtered_modules_with_basis.py
**********************************************************************
File "src/sage/categories/filtered_modules_with_basis.py", line 160, in sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis.ParentMethods.basis
Failed example:
    A.basis(4)
Expected:
    Traceback (most recent call last):
    ...
    AttributeError: 'IndexedFreeAbelianMonoid_with_category' object has no attribute 'list'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis.ParentMethods.basis[5]>", line 1, in <module>
        A.basis(Integer(4))
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/categories/filtered_modules_with_basis.py", line 186, in basis
        return self.homogeneous_component_basis(d)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/categories/filtered_modules_with_basis.py", line 215, in homogeneous_component_basis
        S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]
      File "sage/structure/parent.pyx", line 1548, in sage.structure.parent.Parent.__len__ (/mnt/disk/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/structure/parent.c:12470)
        return len(self.list())
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/categories/infinite_enumerated_sets.py", line 76, in list
        raise NotImplementedError("infinite list")
    NotImplementedError: infinite list
**********************************************************************
1 item had failures:
   1 of  10 in sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis.ParentMethods.basis
    [214 tests, 1 failure, 0.75 s]
```



---

archive/issue_comments_347392.json:
```json
{
    "body": "<a id='comment:47'></a>Volker, I don't see this failure when I run doctests or when I do it by hand, and I don't see it on the patchbots, either. Do you have any ideas why?",
    "created_at": "2016-04-19T16:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347392",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:47'></a>Volker, I don't see this failure when I run doctests or when I do it by hand, and I don't see it on the patchbots, either. Do you have any ideas why?



---

archive/issue_comments_347393.json:
```json
{
    "body": "<a id='comment:48'></a>I also don't get the failure. Maybe something changed with the example implementation in another (already closed) ticket? I certainly can see why this failure might occur...and it is an easy enough fix...",
    "created_at": "2016-04-19T17:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347393",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:48'></a>I also don't get the failure. Maybe something changed with the example implementation in another (already closed) ticket? I certainly can see why this failure might occur...and it is an easy enough fix...



---

archive/issue_comments_347394.json:
```json
{
    "body": "Changing commit from \"068adf38ed5520faa0f31c34e6b3ef636d595bea\" to \"aa85da2896800d78fff84000483c8847fd9c338a\"",
    "created_at": "2016-04-23T02:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "068adf38ed5520faa0f31c34e6b3ef636d595bea" to "aa85da2896800d78fff84000483c8847fd9c338a"



---

archive/issue_comments_347395.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-23T02:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347396.json:
```json
{
    "body": "<a id='comment:50'></a>The problem occurred in beta5 (in fact, I believe I know exactly which ticket caused it...). I fixed the error message and the documentation (I am pretty sure a `NotImplementedError` will be more common with this change anyways...).",
    "created_at": "2016-04-23T02:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347396",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:50'></a>The problem occurred in beta5 (in fact, I believe I know exactly which ticket caused it...). I fixed the error message and the documentation (I am pretty sure a `NotImplementedError` will be more common with this change anyways...).



---

archive/issue_comments_347397.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-23T02:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347397",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_053618.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-04-23T02:24:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19397#event-53618"
}
```



---

archive/issue_comments_347398.json:
```json
{
    "body": "Changing commit from \"aa85da2896800d78fff84000483c8847fd9c338a\" to \"f9aaad57b8a72530f3950252c443f30c09a4f13b\"",
    "created_at": "2016-04-23T11:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347398",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "aa85da2896800d78fff84000483c8847fd9c338a" to "f9aaad57b8a72530f3950252c443f30c09a4f13b"



---

archive/issue_comments_347399.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-23T11:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347399",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347400.json:
```json
{
    "body": "<a id='comment:52'></a>Looks good to me. Passes all tests.",
    "created_at": "2016-04-23T15:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347400",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'></a>Looks good to me. Passes all tests.



---

archive/issue_comments_347401.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-23T15:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347401",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347402.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:52 jhpalmieri]:\n> Looks good to me. Passes all tests.\n\n\nThank you.",
    "created_at": "2016-04-23T20:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347402",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:53'></a>Replying to [comment:52 jhpalmieri]:
> Looks good to me. Passes all tests.


Thank you.



---

archive/issue_events_053619.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-25T08:38:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19397#event-53619"
}
```



---

archive/issue_comments_347403.json:
```json
{
    "body": "Changing branch from \"public/categories/homogeneous_components-19397\" to \"f9aaad57b8a72530f3950252c443f30c09a4f13b\"",
    "created_at": "2016-04-25T08:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347403",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/categories/homogeneous_components-19397" to "f9aaad57b8a72530f3950252c443f30c09a4f13b"



---

archive/issue_comments_347404.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-25T08:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19397#issuecomment-347404",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
