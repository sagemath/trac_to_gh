# Issue 19137: LaTeX display broken in Jupyter output cells

archive/issues_019137.json:
```json
{
    "body": "Keywords: jupyter, latex\n\nThe LaTeX display of output cells in the Jupyter notebook, which was working in Sage 6.8, is broken in Sage 6.9rc3: the LaTeX code is shown instead of the formula:\n\n```\n./sage -n jupyter\n```\n\n\n```\nIn[1]: %display latex\nIn[2]: sin(x^2)\nOut[2]: \\newcommand{\\Bold}[1]{\\mathbf{#1}}\\sin\\left(x^{2}\\right)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19374\n\n",
    "closed_at": "2015-10-10T13:13:03Z",
    "created_at": "2015-10-08T11:34:10Z",
    "labels": [
        "component: interfaces",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "LaTeX display broken in Jupyter output cells",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19137",
    "user": "https://github.com/egourgoulhon"
}
```
Keywords: jupyter, latex

The LaTeX display of output cells in the Jupyter notebook, which was working in Sage 6.8, is broken in Sage 6.9rc3: the LaTeX code is shown instead of the formula:

```
./sage -n jupyter
```


```
In[1]: %display latex
In[2]: sin(x^2)
Out[2]: \newcommand{\Bold}[1]{\mathbf{#1}}\sin\left(x^{2}\right)
```


Issue created by migration from https://trac.sagemath.org/ticket/19374





---

archive/issue_comments_262326.json:
```json
{
    "body": "Since I'm in Jupyter mood anyway, I'm having a look.",
    "created_at": "2015-10-08T11:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262326",
    "user": "https://github.com/jdemeyer"
}
```

Since I'm in Jupyter mood anyway, I'm having a look.



---

archive/issue_comments_262327.json:
```json
{
    "body": "Very good. Tell me if I can help at some point.",
    "created_at": "2015-10-08T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262327",
    "user": "https://github.com/egourgoulhon"
}
```

Very good. Tell me if I can help at some point.



---

archive/issue_comments_262328.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-08T12:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262328",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_262329.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-10-08T12:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262329",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_262330.json:
```json
{
    "body": "Thanks for the fix !\nSeems good to me: LaTeX display is OK now and all doctests in src/sage/repl/ipython_kernel are passed.\nA remark though: `sage -coverage src/sage/repl/ipython_kernel` reports some missing documentation.",
    "created_at": "2015-10-08T13:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262330",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for the fix !
Seems good to me: LaTeX display is OK now and all doctests in src/sage/repl/ipython_kernel are passed.
A remark though: `sage -coverage src/sage/repl/ipython_kernel` reports some missing documentation.



---

archive/issue_comments_262331.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-08T13:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262331",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_262332.json:
```json
{
    "body": "Does this imply also a positive review for the dependency #19371?",
    "created_at": "2015-10-08T13:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262332",
    "user": "https://github.com/jdemeyer"
}
```

Does this imply also a positive review for the dependency #19371?



---

archive/issue_comments_262333.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Does this imply also a positive review for the dependency #19371?\n\nYes, but I said there, it would be nice if somebody else gives a second look at it.",
    "created_at": "2015-10-08T13:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262333",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:7 jdemeyer]:
> Does this imply also a positive review for the dependency #19371?

Yes, but I said there, it would be nice if somebody else gives a second look at it.



---

archive/issue_comments_262334.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-10-09T15:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262334",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_262335.json:
```json
{
    "body": "I am going to make this independent of #19371.",
    "created_at": "2015-10-09T17:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262335",
    "user": "https://github.com/jdemeyer"
}
```

I am going to make this independent of #19371.



---

archive/issue_events_053584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-09T21:40:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19137#event-53584"
}
```



---

archive/issue_comments_262336.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-09T21:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262336",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_262337.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2015-10-09T21:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262337",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_262338.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2015-10-09T21:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262338",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_053585.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-09T21:41:56Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19137#event-53585"
}
```



---

archive/issue_comments_262339.json:
```json
{
    "body": "Is this still a blocker? I would like to push the next release out some time soon...",
    "created_at": "2015-10-09T21:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262339",
    "user": "https://github.com/vbraun"
}
```

Is this still a blocker? I would like to push the next release out some time soon...



---

archive/issue_comments_262340.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-10-10T06:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_262341.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-10T06:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262341",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_262342.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n> Is this still a blocker? I would like to push the next release out some time soon...\n\nI personally don't care so much. The unrebased branch here seems to work but somebody needs to review it.",
    "created_at": "2015-10-10T07:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262342",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 vbraun]:
> Is this still a blocker? I would like to push the next release out some time soon...

I personally don't care so much. The unrebased branch here seems to work but somebody needs to review it.



---

archive/issue_comments_262343.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> Replying to [comment:13 vbraun]:\n> > Is this still a blocker? I would like to push the next release out some time soon...\n\n> I personally don't care so much. The unrebased branch here seems to work but somebody needs to review it.\n\nI am on it (the recompilation of the cython part triggered by make takes time) and shall report asap.",
    "created_at": "2015-10-10T09:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262343",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:16 jdemeyer]:
> Replying to [comment:13 vbraun]:
> > Is this still a blocker? I would like to push the next release out some time soon...

> I personally don't care so much. The unrebased branch here seems to work but somebody needs to review it.

I am on it (the recompilation of the cython part triggered by make takes time) and shall report asap.



---

archive/issue_comments_262344.json:
```json
{
    "body": "I think its better to use jupyter's builtin configuration mechanism instead of digging into the jupyter internals, here is an alternative fix.\n\n---\nNew commits:",
    "created_at": "2015-10-10T11:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262344",
    "user": "https://github.com/vbraun"
}
```

I think its better to use jupyter's builtin configuration mechanism instead of digging into the jupyter internals, here is an alternative fix.

---
New commits:



---

archive/issue_comments_262345.json:
```json
{
    "body": "It indeed looks like a better strategy.\n\nBy the way, a git question: is there a simple way to do `git trac pull <ticket>` and completely overwrite any existing branch on my side? I just want *your* branch, not a merge of my and your branch. I usually do something like\n\n```\n$ git checkout 6.9.rc3   # or any other commit/branch\n$ git branch -D t/19374/latex_display_broken_in_jupyter_output_cells\n$ git trac checkout 19374\n```\nbut it would be nice to be able to do this in a simpler way.",
    "created_at": "2015-10-10T11:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262345",
    "user": "https://github.com/jdemeyer"
}
```

It indeed looks like a better strategy.

By the way, a git question: is there a simple way to do `git trac pull <ticket>` and completely overwrite any existing branch on my side? I just want *your* branch, not a merge of my and your branch. I usually do something like

```
$ git checkout 6.9.rc3   # or any other commit/branch
$ git branch -D t/19374/latex_display_broken_in_jupyter_output_cells
$ git trac checkout 19374
```
but it would be nice to be able to do this in a simpler way.



---

archive/issue_comments_262346.json:
```json
{
    "body": "The normal `git pull` will never throw away your local branch, `git trac pull` just mirrors that.\n\nIf you want to reuse the existing local branch you can fetch+reset instead of delete+checkout:\n\n```\ngit trac fetch 19374\ngit reset --hard FETCH_HEAD\n```\njust like how you would use git directly.",
    "created_at": "2015-10-10T11:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262346",
    "user": "https://github.com/vbraun"
}
```

The normal `git pull` will never throw away your local branch, `git trac pull` just mirrors that.

If you want to reuse the existing local branch you can fetch+reset instead of delete+checkout:

```
git trac fetch 19374
git reset --hard FETCH_HEAD
```
just like how you would use git directly.



---

archive/issue_comments_262347.json:
```json
{
    "body": "Better use a relative path: absolute paths don't work with Jupyterhub (see also #19373)\n\nIf somebody can review my commit, you can set this ticket to positive_review.\n\n---\nNew commits:",
    "created_at": "2015-10-10T11:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262347",
    "user": "https://github.com/jdemeyer"
}
```

Better use a relative path: absolute paths don't work with Jupyterhub (see also #19373)

If somebody can review my commit, you can set this ticket to positive_review.

---
New commits:



---

archive/issue_comments_262348.json:
```json
{
    "body": "Thanks!",
    "created_at": "2015-10-10T12:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262348",
    "user": "https://github.com/vbraun"
}
```

Thanks!



---

archive/issue_comments_262349.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-10T12:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262349",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_262350.json:
```json
{
    "body": "I confirm that the latest commit works. Thanks to both of you for this fix!",
    "created_at": "2015-10-10T13:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262350",
    "user": "https://github.com/egourgoulhon"
}
```

I confirm that the latest commit works. Thanks to both of you for this fix!



---

archive/issue_comments_262351.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-10T13:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262351",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053586.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-10T13:13:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19137#event-53586"
}
```



---

archive/issue_comments_262352.json:
```json
{
    "body": "Replying to [comment:22 vbraun]:\n> If you want to reuse the existing local branch you can fetch+reset instead of delete+checkout:\n> \n> ```\n> git trac fetch 19374\n> git reset --hard FETCH_HEAD\n> ```\n> just like how you would use git directly.\n\n\nThanks! I didn't know the command `git reset --hard <something>` but it looks very useful indeed.",
    "created_at": "2015-10-11T10:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19137#issuecomment-262352",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:22 vbraun]:
> If you want to reuse the existing local branch you can fetch+reset instead of delete+checkout:
> 
> ```
> git trac fetch 19374
> git reset --hard FETCH_HEAD
> ```
> just like how you would use git directly.


Thanks! I didn't know the command `git reset --hard <something>` but it looks very useful indeed.
