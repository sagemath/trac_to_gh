# Issue 19640: Do not drop LDFLAGS

archive/issues_019403.json:
```json
{
    "body": "A couple of simple fixes to not drop LDFLAGS on the floor when building.\n\n\n\n**CC:**  @jdemeyer @kiwifb\n\n**Branch:** [618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)\n\n**Reviewer:** Fran\u00e7ois Bissey\n\n**Author:** Volker Braun\n\nIssue created by migration from https://trac.sagemath.org/ticket/19640\n\n",
    "closed_at": "2015-11-30T23:09:32Z",
    "created_at": "2015-11-29T12:46:10Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.10",
    "title": "Do not drop LDFLAGS",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/19640",
    "user": "https://github.com/vbraun"
}
```
A couple of simple fixes to not drop LDFLAGS on the floor when building.



**CC:**  @jdemeyer @kiwifb

**Branch:** [618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)

**Reviewer:** Fran√ßois Bissey

**Author:** Volker Braun

Issue created by migration from https://trac.sagemath.org/ticket/19640





---

archive/issue_comments_282810.json:
```json
{
    "body": "**Branch:** [u/vbraun/do_not_drop_ldflags](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_drop_ldflags)",
    "created_at": "2015-11-29T12:51:12Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282810",
    "user": "https://github.com/vbraun"
}
```

**Branch:** [u/vbraun/do_not_drop_ldflags](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_drop_ldflags)



---

archive/issue_comments_282811.json:
```json
{
    "body": "**Commit:** [4c53d2995cd4304cf6413f01f7938a31f97d6e11](https://github.com/sagemath/sagetrac-mirror/commit/4c53d2995cd4304cf6413f01f7938a31f97d6e11)",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282811",
    "user": "https://github.com/vbraun"
}
```

**Commit:** [4c53d2995cd4304cf6413f01f7938a31f97d6e11](https://github.com/sagemath/sagetrac-mirror/commit/4c53d2995cd4304cf6413f01f7938a31f97d6e11)



---

archive/issue_comments_282812.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+A couple of simple fixes to not drop LDFLAGS on the floor when building.\n \n+\n``````\n",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282812",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+A couple of simple fixes to not drop LDFLAGS on the floor when building.
 
+
``````




---

archive/issue_comments_282813.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282813",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_events_176609.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-29T12:55:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176609"
}
```



---

archive/issue_events_176610.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-29T12:55:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176610"
}
```



---

archive/issue_comments_282814.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b68082bd107576ffc538ad6e1d697c3db1afd3ab\">b68082b</a></td><td><code>Do not drop LDFLAGS in fflas_ffpack</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27f1f4bd3cd23e0cf29195f8677a2fc95767168f\">27f1f4b</a></td><td><code>Do not drop LDFLAGS in freetype</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb647deec228acef12a673ff5aaef8e22dee423b\">fb647de</a></td><td><code>Do not drop LDFLAGS in gfan</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49ae3fc9f45b1c7595b0f6a471181e28eff333f4\">49ae3fc</a></td><td><code>Do not drop LDFLAGS in m4rie</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93973ff194dcacf296785c9b3a50fc64736094de\">93973ff</a></td><td><code>Do not drop LDFLAGS in matplotlib</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77032e7583ff3d2cf3d43e540da5d4fb72f5e318\">77032e7</a></td><td><code>Do not drop LDFLAGS in ginac</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e40ca64f1cc349be72d6a0610c0c331d083056a\">8e40ca6</a></td><td><code>Do not drop LDFLAGS in ratpoints</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c53d2995cd4304cf6413f01f7938a31f97d6e11\">4c53d29</a></td><td><code>Do not drop LDFLAGS in arb</code></td></tr></table>\n",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282814",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b68082bd107576ffc538ad6e1d697c3db1afd3ab">b68082b</a></td><td><code>Do not drop LDFLAGS in fflas_ffpack</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27f1f4bd3cd23e0cf29195f8677a2fc95767168f">27f1f4b</a></td><td><code>Do not drop LDFLAGS in freetype</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb647deec228acef12a673ff5aaef8e22dee423b">fb647de</a></td><td><code>Do not drop LDFLAGS in gfan</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49ae3fc9f45b1c7595b0f6a471181e28eff333f4">49ae3fc</a></td><td><code>Do not drop LDFLAGS in m4rie</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93973ff194dcacf296785c9b3a50fc64736094de">93973ff</a></td><td><code>Do not drop LDFLAGS in matplotlib</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77032e7583ff3d2cf3d43e540da5d4fb72f5e318">77032e7</a></td><td><code>Do not drop LDFLAGS in ginac</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e40ca64f1cc349be72d6a0610c0c331d083056a">8e40ca6</a></td><td><code>Do not drop LDFLAGS in ratpoints</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c53d2995cd4304cf6413f01f7938a31f97d6e11">4c53d29</a></td><td><code>Do not drop LDFLAGS in arb</code></td></tr></table>




---

archive/issue_events_176611.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-29T12:55:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "component: packages: standard",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176611"
}
```



---

archive/issue_comments_282815.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis fixes everything except Singular, I think. The latter seems more complicated, so let's leave it for a different ticket.",
    "created_at": "2015-11-29T12:56:23Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282815",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
This fixes everything except Singular, I think. The latter seems more complicated, so let's leave it for a different ticket.



---

archive/issue_comments_282816.json:
```json
{
    "body": "<a id='comment:4'></a>\nLooks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why? Otherwise it looks good to me. But this is the only place for `singular` with `LDFLAGS`\n\n```\nif [ \"x$SAGE64\" = xyes ]; then\n    echo \"Building a 64-bit version of Singular\"\n    CFLAGS=\"$CFLAGS -m64 \"\n    CXXFLAGS=\"$CXXFLAGS -m64\"\n    CPPFLAGS=\"$CPPFLAGS -m64\"\n    LDFLAGS=\"$LDFLAGS -m64 \"; export LDFLAGS\n    if [ \"x`uname`\" = xSunOS ] ; then\n        export CC=\"$CC -m64\"\n        export CXX=\"$CXX -m64\"\n    fi\nfi\n```\nso it is not any harder that the others and it should already be OK. If it isn't, I'll be interested in a build log.",
    "created_at": "2015-11-29T20:45:04Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282816",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why? Otherwise it looks good to me. But this is the only place for `singular` with `LDFLAGS`

```
if [ "x$SAGE64" = xyes ]; then
    echo "Building a 64-bit version of Singular"
    CFLAGS="$CFLAGS -m64 "
    CXXFLAGS="$CXXFLAGS -m64"
    CPPFLAGS="$CPPFLAGS -m64"
    LDFLAGS="$LDFLAGS -m64 "; export LDFLAGS
    if [ "x`uname`" = xSunOS ] ; then
        export CC="$CC -m64"
        export CXX="$CXX -m64"
    fi
fi
```
so it is not any harder that the others and it should already be OK. If it isn't, I'll be interested in a build log.



---

archive/issue_comments_282817.json:
```json
{
    "body": "<a id='comment:5'></a>\nSingular doesn't respect those LDFLAGS, I tried ;-)\n\nI have no idea about the SAGE64 stuff. My guess is no and that it has always been a bad idea to copy-paste the same stuff in every spkg-install script, though thats material for another ticket.",
    "created_at": "2015-11-29T21:42:05Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282817",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
Singular doesn't respect those LDFLAGS, I tried ;-)

I have no idea about the SAGE64 stuff. My guess is no and that it has always been a bad idea to copy-paste the same stuff in every spkg-install script, though thats material for another ticket.



---

archive/issue_comments_282818.json:
```json
{
    "body": "**Changing commit** from \"[4c53d2995cd4304cf6413f01f7938a31f97d6e11](https://github.com/sagemath/sagetrac-mirror/commit/4c53d2995cd4304cf6413f01f7938a31f97d6e11)\" to \"[0214c00dc09c2912caa23181eecc8224a80dde49](https://github.com/sagemath/sagetrac-mirror/commit/0214c00dc09c2912caa23181eecc8224a80dde49)\".",
    "created_at": "2015-11-29T21:50:31Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4c53d2995cd4304cf6413f01f7938a31f97d6e11](https://github.com/sagemath/sagetrac-mirror/commit/4c53d2995cd4304cf6413f01f7938a31f97d6e11)" to "[0214c00dc09c2912caa23181eecc8224a80dde49](https://github.com/sagemath/sagetrac-mirror/commit/0214c00dc09c2912caa23181eecc8224a80dde49)".



---

archive/issue_comments_282819.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0214c00dc09c2912caa23181eecc8224a80dde49\">0214c00</a></td><td><code>Do not drop LDFLAGS in Singular</code></td></tr></table>\n",
    "created_at": "2015-11-29T21:50:31Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0214c00dc09c2912caa23181eecc8224a80dde49">0214c00</a></td><td><code>Do not drop LDFLAGS in Singular</code></td></tr></table>




---

archive/issue_comments_282820.json:
```json
{
    "body": "<a id='comment:7'></a>\nI looked through the Singular configure/makefile and the only environment variable that we can used is CXX/LD. I'm not proud of the resulting hack but it does work ;-)",
    "created_at": "2015-11-29T21:53:24Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282820",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
I looked through the Singular configure/makefile and the only environment variable that we can used is CXX/LD. I'm not proud of the resulting hack but it does work ;-)



---

archive/issue_comments_282821.json:
```json
{
    "body": "<a id='comment:8'></a>\nHopefully the situation is better in Singular-4, though thats yet another ticket...",
    "created_at": "2015-11-29T21:54:02Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282821",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
Hopefully the situation is better in Singular-4, though thats yet another ticket...



---

archive/issue_comments_282822.json:
```json
{
    "body": "<a id='comment:9'></a>\nI thought I had a patch for `singular` now that I come to think of it, but it must have been dropped at some point. Looking at the corresponding gentoo ebuild the problem is probably similar. Internally `singular` uses `SLDFLAGS` for its linking flags (you can see that kind of stuff in one of the singular patch I wrote for using `CXX` for linking) I'll have to dig how it is defined but that would be another patch. We can ship your solution now or I can write a patch.",
    "created_at": "2015-11-29T22:11:37Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282822",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I thought I had a patch for `singular` now that I come to think of it, but it must have been dropped at some point. Looking at the corresponding gentoo ebuild the problem is probably similar. Internally `singular` uses `SLDFLAGS` for its linking flags (you can see that kind of stuff in one of the singular patch I wrote for using `CXX` for linking) I'll have to dig how it is defined but that would be another patch. We can ship your solution now or I can write a patch.



---

archive/issue_comments_282823.json:
```json
{
    "body": "<a id='comment:10'></a>\nI saw the SLDFLAGS, but they aren't initialized with LDFLAGS :-(\n\nI don't think there is much point in spending time cleaning up singular-3 though...",
    "created_at": "2015-11-29T22:13:43Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282823",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
I saw the SLDFLAGS, but they aren't initialized with LDFLAGS :-(

I don't think there is much point in spending time cleaning up singular-3 though...



---

archive/issue_comments_282824.json:
```json
{
    "body": "<a id='comment:11'></a>\nIt's just a mess\n\n```\nSingular/Makefile.in:SLDFLAGS   = @SLDFLAGS@\nSingular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \\\nSingular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@\nSingular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\nSingular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\nkernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@\nkernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\nkernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\nkernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@\n```\nSome bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called. A quick `sed` from `$(LD) ${SLDFLAGS}` to `$(LD) ${SLDFLAGS} ${LDFLAGS}` should do.",
    "created_at": "2015-11-29T22:19:41Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282824",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
It's just a mess

```
Singular/Makefile.in:SLDFLAGS   = @SLDFLAGS@
Singular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \
Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}
Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}
Singular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@
Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
kernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@
kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
kernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@
```
Some bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called. A quick `sed` from `$(LD) ${SLDFLAGS}` to `$(LD) ${SLDFLAGS} ${LDFLAGS}` should do.



---

archive/issue_comments_282825.json:
```json
{
    "body": "<a id='comment:12'></a>\nAnd I was going to forget that little piece of underhanded linker definition in `Singular/Makefile.in`\n\n```\nLIBSINGULAR_LD = $(CXX)\n\n# correct suffix for dynamic linking\nifeq ($(SINGUNAME),ix86Mac-darwin)\nSO_SUFFIX        = dylib\nMODULE_SUFFIX    = bundle\nLIBSINGULAR_FLAGS = -single_module\nLIBSINGULAR_LD = $(LD)\nendif\n\nifeq ($(SINGUNAME),x86_64Mac-darwin)\nSO_SUFFIX        = dylib\nMODULE_SUFFIX    = bundle\nLIBSINGULAR_FLAGS = -single_module\nLIBSINGULAR_LD = $(LD)\nendif\n```\nand\n\n```\nlibsingular: mod2.h Makefile version.h $(WIN_LIBS) scanner.cc  ${OBJS} \\\n         iparith.o libparse.cc claptmpl.o mpsr_Tok.o $(DL_LIBS) \n\t$(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \\\n\tiparith.o mpsr_Tok.o claptmpl.o \\\n\t${OBJS} -lkernel -L../kernel -L../factory -L../libfac -L${libdir} ${LIBSINGULAR_LIBS}\n```",
    "created_at": "2015-11-29T22:37:57Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282825",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
And I was going to forget that little piece of underhanded linker definition in `Singular/Makefile.in`

```
LIBSINGULAR_LD = $(CXX)

# correct suffix for dynamic linking
ifeq ($(SINGUNAME),ix86Mac-darwin)
SO_SUFFIX        = dylib
MODULE_SUFFIX    = bundle
LIBSINGULAR_FLAGS = -single_module
LIBSINGULAR_LD = $(LD)
endif

ifeq ($(SINGUNAME),x86_64Mac-darwin)
SO_SUFFIX        = dylib
MODULE_SUFFIX    = bundle
LIBSINGULAR_FLAGS = -single_module
LIBSINGULAR_LD = $(LD)
endif
```
and

```
libsingular: mod2.h Makefile version.h $(WIN_LIBS) scanner.cc  ${OBJS} \
         iparith.o libparse.cc claptmpl.o mpsr_Tok.o $(DL_LIBS) 
	$(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \
	iparith.o mpsr_Tok.o claptmpl.o \
	${OBJS} -lkernel -L../kernel -L../factory -L../libfac -L${libdir} ${LIBSINGULAR_LIBS}
```



---

archive/issue_events_176612.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-11-29T22:45:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176612"
}
```



---

archive/issue_events_176613.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-11-29T22:45:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176613"
}
```



---

archive/issue_comments_282826.json:
```json
{
    "body": "<a id='comment:13'></a>\nI'll leave yours as the best of a bad lot. One of the problem with the fix is that if `LDFLAGS` contains naked linker commands (such as `-rpath`) it will fail on linux because `CXX` is used for linking, therefore linker commands should be preceded by `-Wl`. \nNo matter of patching will fix that particular problem. `libtool` should have been used all the way really, not just here and there.",
    "created_at": "2015-11-29T22:45:13Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282826",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
I'll leave yours as the best of a bad lot. One of the problem with the fix is that if `LDFLAGS` contains naked linker commands (such as `-rpath`) it will fail on linux because `CXX` is used for linking, therefore linker commands should be preceded by `-Wl`. 
No matter of patching will fix that particular problem. `libtool` should have been used all the way really, not just here and there.



---

archive/issue_comments_282827.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2015-11-29T22:45:13Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282827",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** Fran√ßois Bissey



---

archive/issue_events_176614.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-11-29T23:15:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176614"
}
```



---

archive/issue_events_176615.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-11-29T23:15:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176615"
}
```



---

archive/issue_comments_282828.json:
```json
{
    "body": "<a id='comment:14'></a>\nActually, after reviewing some logs, we use `CXX` on OS X as well. My patch to use `CXX` instead of `ld` covers that, in fact I had to change some more stuff so it would work on OS X. So #19641 will work on OS X without doing some kind of filtering, that would have been the case otherwise. But on the other hand that means\n\n```\nexport LD=\"$LD $LDFLAGS\"     # Used on Darwin\n```\nis useless, as is the comment about linux on the line before.",
    "created_at": "2015-11-29T23:15:44Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282828",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
Actually, after reviewing some logs, we use `CXX` on OS X as well. My patch to use `CXX` instead of `ld` covers that, in fact I had to change some more stuff so it would work on OS X. So #19641 will work on OS X without doing some kind of filtering, that would have been the case otherwise. But on the other hand that means

```
export LD="$LD $LDFLAGS"     # Used on Darwin
```
is useless, as is the comment about linux on the line before.



---

archive/issue_comments_282829.json:
```json
{
    "body": "**Changing commit** from \"[0214c00dc09c2912caa23181eecc8224a80dde49](https://github.com/sagemath/sagetrac-mirror/commit/0214c00dc09c2912caa23181eecc8224a80dde49)\" to \"[618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)\".",
    "created_at": "2015-11-30T09:10:28Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0214c00dc09c2912caa23181eecc8224a80dde49](https://github.com/sagemath/sagetrac-mirror/commit/0214c00dc09c2912caa23181eecc8224a80dde49)" to "[618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)".



---

archive/issue_comments_282830.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e\">618651e</a></td><td><code>Only change CXX for Singular</code></td></tr></table>\n",
    "created_at": "2015-11-30T09:10:28Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e">618651e</a></td><td><code>Only change CXX for Singular</code></td></tr></table>




---

archive/issue_comments_282831.json:
```json
{
    "body": "<a id='comment:16'></a>\nLooks good to me, if you have nothing to add, it is positive review from me.",
    "created_at": "2015-11-30T09:17:22Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282831",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Looks good to me, if you have nothing to add, it is positive review from me.



---

archive/issue_events_176616.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-30T09:19:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176616"
}
```



---

archive/issue_events_176617.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-30T09:19:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176617"
}
```



---

archive/issue_events_176618.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-30T23:09:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176618"
}
```



---

archive/issue_events_176619.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f9c5d7e952f51229656b06221e043191437a63a8",
    "created_at": "2015-11-30T23:09:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/19640#event-176619"
}
```



---

archive/issue_comments_282832.json:
```json
{
    "body": "**Changing branch** from \"[u/vbraun/do_not_drop_ldflags](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_drop_ldflags)\" to \"[618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)\".",
    "created_at": "2015-11-30T23:09:32Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282832",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vbraun/do_not_drop_ldflags](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/do_not_drop_ldflags)" to "[618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)".



---

archive/issue_comments_282833.json:
```json
{
    "body": "**Changing commit** from \"[618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)\" to \"\".",
    "created_at": "2015-12-13T14:07:11Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282833",
    "user": "https://github.com/nexttime"
}
```

**Changing commit** from "[618651e0db7fdd4eeb94a3aef3811de877e3df8e](https://github.com/sagemath/sagetrac-mirror/commit/618651e0db7fdd4eeb94a3aef3811de877e3df8e)" to "".



---

archive/issue_comments_282834.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [fbissey](#comment%3A11):\n> It's just a mess\n> \n> ```\n> Singular/Makefile.in:SLDFLAGS   = @SLDFLAGS@\n> Singular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \\\n> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@\n> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\n> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\n> kernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@\n> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\n> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\n> kernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@\n> ```\n> Some bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called.\n\n\nNope, `LDFLAGS` are meant to be passed to the *compiler*, not directly to the linker.  (You'd frequently get syntax errors otherwise, because the linker doesn't necessarily take the same or all of the options.  The compiler in contrast passes anything it doesn't understand verbatim to the linker if applicable, so the opposite is not a problem.)",
    "created_at": "2015-12-13T14:07:11Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282834",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>
Replying to [fbissey](#comment%3A11):
> It's just a mess
> 
> ```
> Singular/Makefile.in:SLDFLAGS   = @SLDFLAGS@
> Singular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \
> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@
> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
> kernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@
> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
> kernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@
> ```
> Some bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called.


Nope, `LDFLAGS` are meant to be passed to the *compiler*, not directly to the linker.  (You'd frequently get syntax errors otherwise, because the linker doesn't necessarily take the same or all of the options.  The compiler in contrast passes anything it doesn't understand verbatim to the linker if applicable, so the opposite is not a problem.)



---

archive/issue_comments_282835.json:
```json
{
    "body": "<a id='comment:20'></a>\nP.S.:  A while ago, a few occurrences of `LD` in Singular's Makefiles were actually hardcoded to `ld`.",
    "created_at": "2015-12-13T14:09:41Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282835",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
P.S.:  A while ago, a few occurrences of `LD` in Singular's Makefiles were actually hardcoded to `ld`.



---

archive/issue_comments_282836.json:
```json
{
    "body": "<a id='comment:21'></a>\nPresumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits",
    "created_at": "2015-12-13T14:24:54Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282836",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>
Presumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits



---

archive/issue_comments_282837.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [fbissey](#comment%3A4):\n> Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?\n\n\nMacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.\n\nSo in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).",
    "created_at": "2015-12-13T14:26:40Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282837",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [fbissey](#comment%3A4):
> Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?


MacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.

So in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).



---

archive/issue_comments_282838.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [vbraun](#comment%3A21):\n> Presumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits\n\n\nWell, my impression was that Singular 4.x in Sage is rather a looong-term thing...",
    "created_at": "2015-12-13T14:29:06Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282838",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Replying to [vbraun](#comment%3A21):
> Presumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits


Well, my impression was that Singular 4.x in Sage is rather a looong-term thing...



---

archive/issue_comments_282839.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [leif](#comment%3A22):\n> Replying to [fbissey](#comment%3A4):\n> > Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?\n\n> \n> MacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.\n> \n> So in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).\n> \n\n\nThere are very few `SAGE64` sections left, so I am expecting it to be broken (because it would need more packages to have a `SAGE64` section) but I don't have a system to prove it. Also such a setting should centralised in one place rather than ditched in all spkg all over the place.",
    "created_at": "2015-12-13T20:19:55Z",
    "issue": "https://github.com/sagemath/sage/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/19640#issuecomment-282839",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>
Replying to [leif](#comment%3A22):
> Replying to [fbissey](#comment%3A4):
> > Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?

> 
> MacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.
> 
> So in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).
> 


There are very few `SAGE64` sections left, so I am expecting it to be broken (because it would need more packages to have a `SAGE64` section) but I don't have a system to prove it. Also such a setting should centralised in one place rather than ditched in all spkg all over the place.
