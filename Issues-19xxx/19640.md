# Issue 19640: Do not drop LDFLAGS

archive/issues_019403.json:
```json
{
    "body": "A couple of simple fixes to not drop LDFLAGS on the floor when building.\n\n\n\nCC:  @jdemeyer @kiwifb\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Volker Braun\n\nBranch: 618651e0db7fdd4eeb94a3aef3811de877e3df8e\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/19640\n\n",
    "closed_at": "2015-11-30T23:09:32Z",
    "created_at": "2015-11-29T12:46:10Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Do not drop LDFLAGS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19640",
    "user": "https://github.com/vbraun"
}
```
A couple of simple fixes to not drop LDFLAGS on the floor when building.



CC:  @jdemeyer @kiwifb

Reviewer: Fran√ßois Bissey

Author: Volker Braun

Branch: 618651e0db7fdd4eeb94a3aef3811de877e3df8e

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/19640





---

archive/issue_comments_353050.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/do_not_drop_ldflags\"",
    "created_at": "2015-11-29T12:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353050",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/do_not_drop_ldflags"



---

archive/issue_comments_353051.json:
```json
{
    "body": "Changing commit from \"\" to \"4c53d2995cd4304cf6413f01f7938a31f97d6e11\"",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353051",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "4c53d2995cd4304cf6413f01f7938a31f97d6e11"



---

archive/issue_comments_353052.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+A couple of simple fixes to not drop LDFLAGS on the floor when building.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353052",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+A couple of simple fixes to not drop LDFLAGS on the floor when building.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_353053.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353053",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_353054.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353054",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_353055.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353055",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_353056.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353056",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_353057.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2015-11-29T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353057",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_353058.json:
```json
{
    "body": "<a id='comment:3'></a>This fixes everything except Singular, I think. The latter seems more complicated, so let's leave it for a different ticket.",
    "created_at": "2015-11-29T12:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353058",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>This fixes everything except Singular, I think. The latter seems more complicated, so let's leave it for a different ticket.



---

archive/issue_comments_353059.json:
```json
{
    "body": "<a id='comment:4'></a>Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why? Otherwise it looks good to me. But this is the only place for `singular` with `LDFLAGS`\n\n```\nif [ \"x$SAGE64\" = xyes ]; then\n    echo \"Building a 64-bit version of Singular\"\n    CFLAGS=\"$CFLAGS -m64 \"\n    CXXFLAGS=\"$CXXFLAGS -m64\"\n    CPPFLAGS=\"$CPPFLAGS -m64\"\n    LDFLAGS=\"$LDFLAGS -m64 \"; export LDFLAGS\n    if [ \"x`uname`\" = xSunOS ] ; then\n        export CC=\"$CC -m64\"\n        export CXX=\"$CXX -m64\"\n    fi\nfi\n```\nso it is not any harder that the others and it should already be OK. If it isn't, I'll be interested in a build log.",
    "created_at": "2015-11-29T20:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353059",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why? Otherwise it looks good to me. But this is the only place for `singular` with `LDFLAGS`

```
if [ "x$SAGE64" = xyes ]; then
    echo "Building a 64-bit version of Singular"
    CFLAGS="$CFLAGS -m64 "
    CXXFLAGS="$CXXFLAGS -m64"
    CPPFLAGS="$CPPFLAGS -m64"
    LDFLAGS="$LDFLAGS -m64 "; export LDFLAGS
    if [ "x`uname`" = xSunOS ] ; then
        export CC="$CC -m64"
        export CXX="$CXX -m64"
    fi
fi
```
so it is not any harder that the others and it should already be OK. If it isn't, I'll be interested in a build log.



---

archive/issue_comments_353060.json:
```json
{
    "body": "<a id='comment:5'></a>Singular doesn't respect those LDFLAGS, I tried ;-)\n\nI have no idea about the SAGE64 stuff. My guess is no and that it has always been a bad idea to copy-paste the same stuff in every spkg-install script, though thats material for another ticket.",
    "created_at": "2015-11-29T21:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353060",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>Singular doesn't respect those LDFLAGS, I tried ;-)

I have no idea about the SAGE64 stuff. My guess is no and that it has always been a bad idea to copy-paste the same stuff in every spkg-install script, though thats material for another ticket.



---

archive/issue_comments_353061.json:
```json
{
    "body": "Changing commit from \"4c53d2995cd4304cf6413f01f7938a31f97d6e11\" to \"0214c00dc09c2912caa23181eecc8224a80dde49\"",
    "created_at": "2015-11-29T21:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353061",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4c53d2995cd4304cf6413f01f7938a31f97d6e11" to "0214c00dc09c2912caa23181eecc8224a80dde49"



---

archive/issue_comments_353062.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-29T21:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353062",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_353063.json:
```json
{
    "body": "<a id='comment:7'></a>I looked through the Singular configure/makefile and the only environment variable that we can used is CXX/LD. I'm not proud of the resulting hack but it does work ;-)",
    "created_at": "2015-11-29T21:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353063",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>I looked through the Singular configure/makefile and the only environment variable that we can used is CXX/LD. I'm not proud of the resulting hack but it does work ;-)



---

archive/issue_comments_353064.json:
```json
{
    "body": "<a id='comment:8'></a>Hopefully the situation is better in Singular-4, though thats yet another ticket...",
    "created_at": "2015-11-29T21:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353064",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>Hopefully the situation is better in Singular-4, though thats yet another ticket...



---

archive/issue_comments_353065.json:
```json
{
    "body": "<a id='comment:9'></a>I thought I had a patch for `singular` now that I come to think of it, but it must have been dropped at some point. Looking at the corresponding gentoo ebuild the problem is probably similar. Internally `singular` uses `SLDFLAGS` for its linking flags (you can see that kind of stuff in one of the singular patch I wrote for using `CXX` for linking) I'll have to dig how it is defined but that would be another patch. We can ship your solution now or I can write a patch.",
    "created_at": "2015-11-29T22:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353065",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>I thought I had a patch for `singular` now that I come to think of it, but it must have been dropped at some point. Looking at the corresponding gentoo ebuild the problem is probably similar. Internally `singular` uses `SLDFLAGS` for its linking flags (you can see that kind of stuff in one of the singular patch I wrote for using `CXX` for linking) I'll have to dig how it is defined but that would be another patch. We can ship your solution now or I can write a patch.



---

archive/issue_comments_353066.json:
```json
{
    "body": "<a id='comment:10'></a>I saw the SLDFLAGS, but they aren't initialized with LDFLAGS :-(\n\nI don't think there is much point in spending time cleaning up singular-3 though...",
    "created_at": "2015-11-29T22:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353066",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>I saw the SLDFLAGS, but they aren't initialized with LDFLAGS :-(

I don't think there is much point in spending time cleaning up singular-3 though...



---

archive/issue_comments_353067.json:
```json
{
    "body": "<a id='comment:11'></a>It's just a mess\n\n```\nSingular/Makefile.in:SLDFLAGS   = @SLDFLAGS@\nSingular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \\\nSingular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@\nSingular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\nSingular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\nSingular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\nkernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@\nkernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\nkernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\nkernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@\n```\nSome bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called. A quick `sed` from `$(LD) ${SLDFLAGS}` to `$(LD) ${SLDFLAGS} ${LDFLAGS}` should do.",
    "created_at": "2015-11-29T22:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353067",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>It's just a mess

```
Singular/Makefile.in:SLDFLAGS   = @SLDFLAGS@
Singular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \
Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}
Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}
Singular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@
Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
kernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@
kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
kernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@
```
Some bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called. A quick `sed` from `$(LD) ${SLDFLAGS}` to `$(LD) ${SLDFLAGS} ${LDFLAGS}` should do.



---

archive/issue_comments_353068.json:
```json
{
    "body": "<a id='comment:12'></a>And I was going to forget that little piece of underhanded linker definition in `Singular/Makefile.in`\n\n```\nLIBSINGULAR_LD = $(CXX)\n\n# correct suffix for dynamic linking\nifeq ($(SINGUNAME),ix86Mac-darwin)\nSO_SUFFIX        = dylib\nMODULE_SUFFIX    = bundle\nLIBSINGULAR_FLAGS = -single_module\nLIBSINGULAR_LD = $(LD)\nendif\n\nifeq ($(SINGUNAME),x86_64Mac-darwin)\nSO_SUFFIX        = dylib\nMODULE_SUFFIX    = bundle\nLIBSINGULAR_FLAGS = -single_module\nLIBSINGULAR_LD = $(LD)\nendif\n```\nand\n\n```\nlibsingular: mod2.h Makefile version.h $(WIN_LIBS) scanner.cc  ${OBJS} \\\n         iparith.o libparse.cc claptmpl.o mpsr_Tok.o $(DL_LIBS) \n\t$(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \\\n\tiparith.o mpsr_Tok.o claptmpl.o \\\n\t${OBJS} -lkernel -L../kernel -L../factory -L../libfac -L${libdir} ${LIBSINGULAR_LIBS}\n```",
    "created_at": "2015-11-29T22:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353068",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>And I was going to forget that little piece of underhanded linker definition in `Singular/Makefile.in`

```
LIBSINGULAR_LD = $(CXX)

# correct suffix for dynamic linking
ifeq ($(SINGUNAME),ix86Mac-darwin)
SO_SUFFIX        = dylib
MODULE_SUFFIX    = bundle
LIBSINGULAR_FLAGS = -single_module
LIBSINGULAR_LD = $(LD)
endif

ifeq ($(SINGUNAME),x86_64Mac-darwin)
SO_SUFFIX        = dylib
MODULE_SUFFIX    = bundle
LIBSINGULAR_FLAGS = -single_module
LIBSINGULAR_LD = $(LD)
endif
```
and

```
libsingular: mod2.h Makefile version.h $(WIN_LIBS) scanner.cc  ${OBJS} \
         iparith.o libparse.cc claptmpl.o mpsr_Tok.o $(DL_LIBS) 
	$(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \
	iparith.o mpsr_Tok.o claptmpl.o \
	${OBJS} -lkernel -L../kernel -L../factory -L../libfac -L${libdir} ${LIBSINGULAR_LIBS}
```



---

archive/issue_comments_353069.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-29T22:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353069",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_353070.json:
```json
{
    "body": "<a id='comment:13'></a>I'll leave yours as the best of a bad lot. One of the problem with the fix is that if `LDFLAGS` contains naked linker commands (such as `-rpath`) it will fail on linux because `CXX` is used for linking, therefore linker commands should be preceded by `-Wl`. \nNo matter of patching will fix that particular problem. `libtool` should have been used all the way really, not just here and there.",
    "created_at": "2015-11-29T22:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353070",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>I'll leave yours as the best of a bad lot. One of the problem with the fix is that if `LDFLAGS` contains naked linker commands (such as `-rpath`) it will fail on linux because `CXX` is used for linking, therefore linker commands should be preceded by `-Wl`. 
No matter of patching will fix that particular problem. `libtool` should have been used all the way really, not just here and there.



---

archive/issue_comments_353071.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2015-11-29T22:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353071",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "Fran√ßois Bissey"



---

archive/issue_comments_353072.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-11-29T23:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353072",
    "user": "https://github.com/kiwifb"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_353073.json:
```json
{
    "body": "<a id='comment:14'></a>Actually, after reviewing some logs, we use `CXX` on OS X as well. My patch to use `CXX` instead of `ld` covers that, in fact I had to change some more stuff so it would work on OS X. So #19641 will work on OS X without doing some kind of filtering, that would have been the case otherwise. But on the other hand that means\n\n```\nexport LD=\"$LD $LDFLAGS\"     # Used on Darwin\n```\nis useless, as is the comment about linux on the line before.",
    "created_at": "2015-11-29T23:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353073",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>Actually, after reviewing some logs, we use `CXX` on OS X as well. My patch to use `CXX` instead of `ld` covers that, in fact I had to change some more stuff so it would work on OS X. So #19641 will work on OS X without doing some kind of filtering, that would have been the case otherwise. But on the other hand that means

```
export LD="$LD $LDFLAGS"     # Used on Darwin
```
is useless, as is the comment about linux on the line before.



---

archive/issue_comments_353074.json:
```json
{
    "body": "Changing commit from \"0214c00dc09c2912caa23181eecc8224a80dde49\" to \"618651e0db7fdd4eeb94a3aef3811de877e3df8e\"",
    "created_at": "2015-11-30T09:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0214c00dc09c2912caa23181eecc8224a80dde49" to "618651e0db7fdd4eeb94a3aef3811de877e3df8e"



---

archive/issue_comments_353075.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-30T09:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353075",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_353076.json:
```json
{
    "body": "<a id='comment:16'></a>Looks good to me, if you have nothing to add, it is positive review from me.",
    "created_at": "2015-11-30T09:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353076",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>Looks good to me, if you have nothing to add, it is positive review from me.



---

archive/issue_comments_353077.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-11-30T09:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353077",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_053969.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-30T23:09:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19640#event-53969"
}
```



---

archive/issue_comments_353078.json:
```json
{
    "body": "Changing branch from \"u/vbraun/do_not_drop_ldflags\" to \"618651e0db7fdd4eeb94a3aef3811de877e3df8e\"",
    "created_at": "2015-11-30T23:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353078",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/do_not_drop_ldflags" to "618651e0db7fdd4eeb94a3aef3811de877e3df8e"



---

archive/issue_comments_353079.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-30T23:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353079",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_353080.json:
```json
{
    "body": "Changing commit from \"618651e0db7fdd4eeb94a3aef3811de877e3df8e\" to \"\"",
    "created_at": "2015-12-13T14:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353080",
    "user": "https://github.com/nexttime"
}
```

Changing commit from "618651e0db7fdd4eeb94a3aef3811de877e3df8e" to ""



---

archive/issue_comments_353081.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:11 fbissey]:\n> It's just a mess\n> \n> ```\n> Singular/Makefile.in:SLDFLAGS   = @SLDFLAGS@\n> Singular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \\\n> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@\n> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\n> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}\n> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}\n> kernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@\n> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\n> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^\n> kernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@\n> ```\n> Some bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called.\n\n\nNope, `LDFLAGS` are meant to be passed to the *compiler*, not directly to the linker.  (You'd frequently get syntax errors otherwise, because the linker doesn't necessarily take the same or all of the options.  The compiler in contrast passes anything it doesn't understand verbatim to the linker if applicable, so the opposite is not a problem.)",
    "created_at": "2015-12-13T14:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353081",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>Replying to [comment:11 fbissey]:
> It's just a mess
> 
> ```
> Singular/Makefile.in:SLDFLAGS   = @SLDFLAGS@
> Singular/Makefile.in:   $(LIBSINGULAR_LD) ${SLDFLAGS} ${LIBSINGULAR_FLAGS} -o libsingular.${SO_SUFFIX} \
> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ -L${libdir} ${MP_LIBS} ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   $(LD) ${SLDFLAGS} -o $@ $^ ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   $(CXX) $^ ${PYTHON_MODULE_LDFLAGS} ${SLDFLAGS} ${PYTHON_MODULE_LIBS} ${LD_LIBC} -o $@
> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   ${CXXG} ${CXXFLAGSG} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS} ${GLIBC_DYN_FIX}
> Singular/Makefile.in:   ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} ${LDFLAGS} -o $@ $^ ${MP_LIBS}
> kernel/Makefile.in:SLDFLAGS     = @SLDFLAGS@
> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
> kernel/Makefile.in:     $(LD) ${SLDFLAGS} -o $@ $^
> kernel/Makefile.in:     ${CXXP} ${CXXFLAGSP} ${SFLAGS} ${SLDFLAGS} $< -o $@
> ```
> Some bits of `singular` are using `LDFLAGS` but we would need to add it wherever it is missing above, at least wherever `LD` is called.


Nope, `LDFLAGS` are meant to be passed to the *compiler*, not directly to the linker.  (You'd frequently get syntax errors otherwise, because the linker doesn't necessarily take the same or all of the options.  The compiler in contrast passes anything it doesn't understand verbatim to the linker if applicable, so the opposite is not a problem.)



---

archive/issue_comments_353082.json:
```json
{
    "body": "<a id='comment:20'></a>P.S.:  A while ago, a few occurrences of `LD` in Singular's Makefiles were actually hardcoded to `ld`.",
    "created_at": "2015-12-13T14:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353082",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>P.S.:  A while ago, a few occurrences of `LD` in Singular's Makefiles were actually hardcoded to `ld`.



---

archive/issue_comments_353083.json:
```json
{
    "body": "<a id='comment:21'></a>Presumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits",
    "created_at": "2015-12-13T14:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353083",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>Presumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits



---

archive/issue_comments_353084.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:4 fbissey]:\n> Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?\n\n\nMacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.\n\nSo in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).",
    "created_at": "2015-12-13T14:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353084",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>Replying to [comment:4 fbissey]:
> Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?


MacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.

So in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).



---

archive/issue_comments_353085.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 vbraun]:\n> Presumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits\n\n\nWell, my impression was that Singular 4.x in Sage is rather a looong-term thing...",
    "created_at": "2015-12-13T14:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353085",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>Replying to [comment:21 vbraun]:
> Presumably things are better in Sigular-4, there isn't much point in beautifying anything before #17254 hits


Well, my impression was that Singular 4.x in Sage is rather a looong-term thing...



---

archive/issue_comments_353086.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 leif]:\n> Replying to [comment:4 fbissey]:\n> > Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?\n\n> \n> MacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.\n> \n> So in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).\n> \n\n\nThere are very few `SAGE64` sections left, so I am expecting it to be broken (because it would need more packages to have a `SAGE64` section) but I don't have a system to prove it. Also such a setting should centralised in one place rather than ditched in all spkg all over the place.",
    "created_at": "2015-12-13T20:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19640#issuecomment-353086",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>Replying to [comment:22 leif]:
> Replying to [comment:4 fbissey]:
> > Looks ok but begs the question for a separate ticket: Do we still need those `SAGE64` sections? If so why?

> 
> MacOS X used to default to 32-bit builds on 64-bit systems (until 10.6.x?); SunOS/Oraclis still does.
> 
> So in principle we still need the ugly `SAGE64` stuff (or should keep it for porting / to not break SunOS support further...).
> 


There are very few `SAGE64` sections left, so I am expecting it to be broken (because it would need more packages to have a `SAGE64` section) but I don't have a system to prove it. Also such a setting should centralised in one place rather than ditched in all spkg all over the place.
