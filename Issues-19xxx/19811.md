# Issue 19811: Upgrade arb to version 2.8.1

archive/issues_019574.json:
```json
{
    "body": "CC:  @fredrik-johansson @cheuberg @mezzarobba\n\n**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/arb-2.8.1.tar.gz\n\nIssue created by migration from https://trac.sagemath.org/ticket/19811\n\n",
    "closed_at": "2016-02-24T19:35:22Z",
    "created_at": "2015-12-30T21:56:30Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Upgrade arb to version 2.8.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19811",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @fredrik-johansson @cheuberg @mezzarobba

**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/arb-2.8.1.tar.gz

Issue created by migration from https://trac.sagemath.org/ticket/19811





---

archive/issue_comments_268587.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-12-30T22:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268587",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_268588.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-13T09:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_268589.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-13T11:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_268590.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-13T14:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268590",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_268591.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-09T20:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268591",
    "user": "https://github.com/fredrik-johansson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_268592.json:
```json
{
    "body": "Well, there are four precision-related doctest failures when rebased on the latest develop branch.\n\nTwo tests got better.\n\nOne test - rising factorial - got slightly worse. This is expected as I changed the algorithm to use a gamma function quotient when n is large, which gives a speedup but slightly worse error bounds.\n\nOne test - a hypergeometric function - got a lot worse (all digits are lost). You need some 110 bits of precision now to get a similar result. The reason is that Arb uses some heuristics when choosing where to truncate asymptotic series, and these heuristics don't fully take the parameters into account. With large parameters (in this case a = 100) some precision is lost when z is not larger by orders of magnitude (in this case z = 1000+1000i). The old code in Arb had a bug that made it choose far too many terms in some cases, fixed in 2.8. This happened to result in a very precise answer for this test case, purely by accident. The current code in Arb is more correct, but errs on the side of stopping early, which is worse for this particular test case. I think I see a reasonable way to fix this in Arb, but that will be in the next version.",
    "created_at": "2016-02-10T03:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268592",
    "user": "https://github.com/fredrik-johansson"
}
```

Well, there are four precision-related doctest failures when rebased on the latest develop branch.

Two tests got better.

One test - rising factorial - got slightly worse. This is expected as I changed the algorithm to use a gamma function quotient when n is large, which gives a speedup but slightly worse error bounds.

One test - a hypergeometric function - got a lot worse (all digits are lost). You need some 110 bits of precision now to get a similar result. The reason is that Arb uses some heuristics when choosing where to truncate asymptotic series, and these heuristics don't fully take the parameters into account. With large parameters (in this case a = 100) some precision is lost when z is not larger by orders of magnitude (in this case z = 1000+1000i). The old code in Arb had a bug that made it choose far too many terms in some cases, fixed in 2.8. This happened to result in a very precise answer for this test case, purely by accident. The current code in Arb is more correct, but errs on the side of stopping early, which is worse for this particular test case. I think I see a reasonable way to fix this in Arb, but that will be in the next version.



---

archive/issue_comments_268593.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-02-10T03:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268593",
    "user": "https://github.com/fredrik-johansson"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_268594.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-10T12:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268594",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_268595.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-02-10T12:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268595",
    "user": "https://github.com/fredrik-johansson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_268596.json:
```json
{
    "body": "Should be fixed now.\n\nI also added a small patch for a bug in `_pow_` that I saw while fixing the doctests for that function.",
    "created_at": "2016-02-10T12:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268596",
    "user": "https://github.com/fredrik-johansson"
}
```

Should be fixed now.

I also added a small patch for a bug in `_pow_` that I saw while fixing the doctests for that function.



---

archive/issue_comments_268597.json:
```json
{
    "body": "I agree with the changes made by `@`fredrik.johansson",
    "created_at": "2016-02-15T08:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268597",
    "user": "https://github.com/jdemeyer"
}
```

I agree with the changes made by `@`fredrik.johansson



---

archive/issue_comments_268598.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-23T22:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268598",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_268599.json:
```json
{
    "body": "On OSX:\n\n```\nsage -t --long src/sage/rings/real_arb.pyx\n**********************************************************************\nFile \"src/sage/rings/real_arb.pyx\", line 462, in sage.rings.real_arb.RealBallField._element_constructor_\nFailed example:\n    RBF(4*zeta(3))\nExpected:\n    [4.808227612638377 +/- 9.50e-16]\nGot:\n    [4.808227612638377 +/- 9.42e-16]\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.rings.real_arb.RealBallField._element_constructor_\n    [459 tests, 1 failure, 0.38 s]\n\nsage -t --long src/sage/rings/real_mpfi.pyx\n**********************************************************************\nFile \"src/sage/rings/real_mpfi.pyx\", line 5110, in sage.rings.real_mpfi.RealIntervalFieldElement.zeta\nFailed example:\n    zeta(RIF(3))\nExpected:\n    1.202056903159595?\nGot:\n    1.202056903159594?\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.rings.real_mpfi.RealIntervalFieldElement.zeta\n    [904 tests, 1 failure, 10.16 s]\n```",
    "created_at": "2016-02-24T00:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268599",
    "user": "https://github.com/vbraun"
}
```

On OSX:

```
sage -t --long src/sage/rings/real_arb.pyx
**********************************************************************
File "src/sage/rings/real_arb.pyx", line 462, in sage.rings.real_arb.RealBallField._element_constructor_
Failed example:
    RBF(4*zeta(3))
Expected:
    [4.808227612638377 +/- 9.50e-16]
Got:
    [4.808227612638377 +/- 9.42e-16]
**********************************************************************
1 item had failures:
   1 of   7 in sage.rings.real_arb.RealBallField._element_constructor_
    [459 tests, 1 failure, 0.38 s]

sage -t --long src/sage/rings/real_mpfi.pyx
**********************************************************************
File "src/sage/rings/real_mpfi.pyx", line 5110, in sage.rings.real_mpfi.RealIntervalFieldElement.zeta
Failed example:
    zeta(RIF(3))
Expected:
    1.202056903159595?
Got:
    1.202056903159594?
**********************************************************************
1 item had failures:
   1 of   4 in sage.rings.real_mpfi.RealIntervalFieldElement.zeta
    [904 tests, 1 failure, 10.16 s]
```



---

archive/issue_comments_268600.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-02-24T00:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268600",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_268601.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-24T00:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268601",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_268602.json:
```json
{
    "body": "Fixed.",
    "created_at": "2016-02-24T00:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268602",
    "user": "https://github.com/fredrik-johansson"
}
```

Fixed.



---

archive/issue_comments_268603.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-02-24T00:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268603",
    "user": "https://github.com/fredrik-johansson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_268604.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-24T11:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268604",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_054209.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-24T19:35:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19811#event-54209"
}
```



---

archive/issue_comments_268605.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-24T19:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19811",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19811#issuecomment-268605",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
