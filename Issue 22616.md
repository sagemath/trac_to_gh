# Issue 22616: Update combinat/root_system/plot with examples - documentation

Issue created by migration from Trac.

Original creator: aram.dermenjian

Original creation time: 2017-04-21 17:48:18

CC:  nthiery tscrim jmantysalo chapoton

Keywords: sagedays86

Update the documentation in combinat/root_system/plot with visual examples of the examples found in the current documentation


---

Comment by aram.dermenjian created at 2017-04-21 18:28:09

Changing status from new to needs_review.


---

Comment by aram.dermenjian created at 2017-04-21 18:28:09

New commits:


---

Comment by tscrim created at 2017-04-22 02:27:51

Definitely something that should be done. However, perhaps we should change the width to `300 px` as this is the most common size for plots (there is 1 that is `400 px` and some that are `200 px`)?


---

Comment by aram.dermenjian created at 2017-04-22 13:14:10

I specifically chose 500 because the 300px images were difficult to see. I tried 400 as well before settling on 500.

An idea, which I couldn't find, I wanted to see if there's a way to limit the height by cropping instead of stretching. It looks like sphinx_plot always returns a square image, so when adding

`:height: 200 px`

or something we get a shrunk image which still has pointless whitespace. I couldn't find anything in the documentation about cropping, but if you do know of a way to crop, it'd be nice as some of the images definitely take up a lot of vertical room and would be nice to shrink them.

Alternatively, I can reduce the size to 300px as is more standard with the knowledge that some images may be difficult to see. (Note the main difficulty in seeing the images was the words/symbols on the images, so I can potentially reduce the size as well if we don't care about being able to read labels on the images)


---

Comment by tscrim created at 2017-04-22 13:47:43

What is the dpi (or resolution) on your laptop? It might be hard to read because that is very high. 

Unfortunately I don't know enough about the `.. PLOT::` to answer your questions. I do know we do not want the Sage doc size to grow too much, so I feel that we should make them `300 px`. However, the html has its own spacing rules, so the whitespace may come from that too.


---

Comment by nthiery created at 2017-04-22 14:57:15

Just two comments for now:
- Aram presented the updated documentation, and it made me jump up and down. So much better.
- I can't wait until sphinx would actually use vector graphics rather than bitmaps. This would resolve all those resolution tweaking issues.


---

Comment by git created at 2017-04-25 13:43:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2017-04-25 13:44:38

My dpi is fairly high, so I've gone ahead and reduced all the graphs to 300px. Can you look them over and see if they actually look good in the smaller size?

`@`nthiery - sphinx seems to be lacking quite a lot when it comes to images. Hopefully they'll get to updating it in the near future so we can make plot look even more awesome.
----
New commits:


---

Comment by tscrim created at 2017-04-26 03:20:28

This looks good. Thank you for your work on this.


---

Comment by tscrim created at 2017-04-26 03:20:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-28 23:54:30


```
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1640, in main
[dochtml]     builder()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 266, in build_many
[dochtml]     results.append(target(arg))
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 70, in build_ref_doc
[dochtml]     getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 720, in _wrapper
[dochtml]     getattr(DocBuilder, build_type)(self, *args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 104, in f
[dochtml]     runsphinx()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py", line 215, in runsphinx
[dochtml]     raise exception
[dochtml] OSError: [combinat ] /home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/root_system/plot.py:docstring of sage.combinat.root_system.plot.PlotOptions.color:10: WARNING: Exception occurred in plotting plot-15
[dochtml] 
Makefile:988: recipe for target 'doc-html-mathjax' failed
make[1]: *** [doc-html-mathjax] Error 1
make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'
```



---

Comment by vbraun created at 2017-04-28 23:54:30

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2017-05-01 18:55:19

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-05-01 18:55:19

I made some trivial reviewer changes that need a quick check.

However, I am (still) unable to reproduce the docbuild failure Volker is getting.
----
New commits:


---

Comment by aram.dermenjian created at 2017-05-04 22:13:06

I downloaded and tested on my machine as well. After doing both a distclean and a doc-clean and then makeing sage again I was not able to reproduce the error. 

Additionally, I looked at the error given by Volker, in particular:

    
` [dochtml] OSError: [combinat ] /home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/root_system/plot.py:docstring of sage.combinat.root_system.plot.PlotOptions.color:10: WARNING: Exception occurred in plotting plot-15 `


This line suggests to me that the problem exists in the class PlotOptions in the method color. This method was NOT altered. In fact, running a git blame shows that the code here has not changed since 2016 (and most of it not being changed since 2013)


```
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1067)     def color(self, i):
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1068)         r"""
9e58de36 (Nicolas M. Thiery 2013-06-25 16:00:56 +0200 1069)         Return the color to be used for objects indexed by `i`.
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1070) 
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1071)         INPUT:
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1072) 
9e58de36 (Nicolas M. Thiery 2013-06-25 16:00:56 +0200 1073)         - ``i`` -- an index
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1074) 
9e58de36 (Nicolas M. Thiery 2013-06-25 16:00:56 +0200 1075)         .. SEEALSO:: :meth:`index_of_object`
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1076) 
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1077)         EXAMPLES::
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1078) 
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1079)             sage: L = RootSystem(["A",2]).root_lattice()
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1080)             sage: options = L.plot_parse_options(labels=False)
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1081)             sage: alpha = L.simple_roots()
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1082)             sage: options.color(1)
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1083)             'blue'
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1084)             sage: options.color(2)
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1085)             'red'
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1086)             sage: for alpha in L.roots():
e0dd5a0e (Frédéric Chapoton 2016-05-09 13:46:38 +0200 1087)             ....:     print("{} {}".format(alpha, options.color(alpha)))
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1088)             alpha[1]             blue
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1089)             alpha[2]             red
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1090)             alpha[1] + alpha[2]  black
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1091)             -alpha[1]            black
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1092)             -alpha[2]            black
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1093)             -alpha[1] - alpha[2] black
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1094)         """
9e58de36 (Nicolas M. Thiery 2013-06-25 16:00:56 +0200 1095)         return self._color(self.index_of_object(i))
650ee7bf (Nicolas M. Thiery 2013-05-13 16:00:06 -0400 1096) 
```


So I really don't see where this error is coming from. Is there any way to get more information on the error? I also didn't understand what "plotting plot-15" meant exactly since there was no plotting in this particular section. I thought that potentially the above error meant the 15th sphinx plot that we added. I checked both the 15th (and 16th in case it starts at 0) and both codes seemed to work perfectly on tests and showed up correctly in the doc.


---

Comment by tscrim created at 2017-05-04 23:05:49

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-05-04 23:05:49

Volker, you're going to have to give us more information if this still fails. You might have to remove some of the plots that have the `PlotOptions.color` to see if that makes the documentation build.


---

Comment by vbraun created at 2017-05-06 09:10:22


```
[docpdf] ! Missing } inserted.
[docpdf] <inserted text> 
[docpdf]                 }
[docpdf] l.17258 ...commended to implement either \(_mul_\)
[docpdf]                                                    or both
```



---

Comment by vbraun created at 2017-05-06 09:10:22

Changing status from positive_review to needs_work.


---

Comment by aram.dermenjian created at 2017-05-06 11:18:51

It looks like the file in question is complex_reflection_or_generalized_coxeter_groups.py (line 72 to be exact). In this line I had corrected a misspelling from `_mul` to `_mul_`. I don't see how that could affect things. `@`tscrim is there any light you might be able to shed on this? Am I doing something wrong with that line that might be throwing off the compiler?


---

Comment by vbraun created at 2017-05-06 15:26:34

Underscore is subscript in LaTeX

* `_mul` is typeset as <sub>m</sub>ul which is legal but not what you want
* `_mul_` is not legal since there is an argument missing past the last subscript.


---

Comment by vbraun created at 2017-05-06 15:27:53

To summarize: you want two backticks (=typeset as string) instead of a single backtick (=typeset as LaTeX)


---

Comment by git created at 2017-05-06 15:28:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-05-06 15:30:23

I was just about to say that after I did my push with corrections. Thanks Volker. Did you happen to get the same failure building the plots?


---

Comment by aram.dermenjian created at 2017-05-06 16:15:28

Ah that works. Thank you for that information and sorry causing the problem.


---

Comment by tscrim created at 2017-05-06 16:48:26

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-05-10 22:49:17


```
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1642, in main
[dochtml]     builder()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 266, in build_many
[dochtml]     results.append(target(arg))
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 70, in build_ref_doc
[dochtml]     getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 720, in _wrapper
[dochtml]     getattr(DocBuilder, build_type)(self, *args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 104, in f
[dochtml]     runsphinx()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py", line 215, in runsphinx
[dochtml]     raise exception
[dochtml] OSError: [combinat ] /home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/root_system/plot.py:docstring of sage.combinat.root_system.plot.PlotOptions.color:10: WARNING: Exception occurred in plotting plot-15
[dochtml] 
make[1]: *** [doc-html-mathjax] Error 1
```



---

Comment by vbraun created at 2017-05-10 22:49:17

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2017-05-10 23:05:06

Volker, we need your help in debugging this as neither of us have this failure.

What machine is this being tested on? Could you go through and remove the added plots until you find which one is causing the problems? We would appreciate any more information that you could give us on this.


---

Comment by tscrim created at 2017-05-15 16:10:28

Jori, Frédéric, can you try this ticket out to see if you can reproduce the doc build failure? Both Aram and I cannot and Volker hasn't given us any more details.


---

Comment by jmantysalo created at 2017-05-15 17:59:59

Replying to [comment:28 tscrim]:
> Jori, Frédéric, can you try this ticket out to see if you can reproduce the doc build failure? Both Aram and I cannot and Volker hasn't given us any more details.

I got no errors, but several links are dead in complex_reflection_or_generalized_coxeter_groups.html.


---

Comment by tscrim created at 2017-05-15 19:23:43

Thanks. Well, at least [one of the patchbots](https://patchbot.sagemath.org/log/22853/LinuxMint/18.1/x86_64/4.4.0-59-generic/rk02-math/2017-05-10%2014:22:46) also gets the error, which is somewhat helpful

```
[dochtml] [combinat ] /local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/plot.py:docstring of sage.combinat.root_system.plot.PlotOptions.color:10: WARNING: Exception occurred in plotting plot-15
[dochtml] [combinat ] from /local/sage-patchbot/sage/src/doc/en/reference/combinat/sage/combinat/root_system/plot.rst:
[dochtml] [combinat ] Traceback (most recent call last):
[dochtml] [combinat ] File "/local/sage-patchbot/sage/local/lib/python2.7/site-packages/matplotlib/sphinxext/plot_directive.py", line 517, in run_code
[dochtml] [combinat ] six.exec_(code, ns)
[dochtml] [combinat ] File "/local/sage-patchbot/sage/local/lib/python2.7/site-packages/matplotlib/externals/six.py", line 672, in exec_
[dochtml] [combinat ] exec("""exec _code_ in _globs_, _locs_""")
[dochtml] [combinat ] File "<string>", line 1, in <module>
[dochtml] [combinat ] File "<string>", line 2, in <module>
[dochtml] [combinat ] File "<string>", line 8, in sphinx_plot
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 1614, in sage.plot.plot3d.base.Graphics3d.save (build/cythonized/sage/plot/plot3d/base.c:22654)
[dochtml] [combinat ] self.save_image(filename, **kwds)
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 1543, in sage.plot.plot3d.base.Graphics3d.save_image (build/cythonized/sage/plot/plot3d/base.c:22125)
[dochtml] [combinat ] self._save_image_png(filename, **kwds)
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 1507, in sage.plot.plot3d.base.Graphics3d._save_image_png (build/cythonized/sage/plot/plot3d/base.c:21637)
[dochtml] [combinat ] scene = self._rich_repr_jmol(**opts)
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 261, in sage.plot.plot3d.base.Graphics3d._rich_repr_jmol (build/cythonized/sage/plot/plot3d/base.c:7320)
[dochtml] [combinat ] tachyon = self._rich_repr_tachyon(OutputImagePng, **opts)
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 205, in sage.plot.plot3d.base.Graphics3d._rich_repr_tachyon (build/cythonized/sage/plot/plot3d/base.c:5948)
[dochtml] [combinat ] tachyon_rt(T.tachyon(), filename, opts['verbosity'],
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 903, in sage.plot.plot3d.base.Graphics3d.tachyon (build/cythonized/sage/plot/plot3d/base.c:14525)
[dochtml] [combinat ] "\n".join(sorted([t.tachyon_str() for t in self.texture_set()])),
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 2175, in sage.plot.plot3d.base.Graphics3dGroup.texture_set (build/cythonized/sage/plot/plot3d/base.c:32069)
[dochtml] [combinat ] return reduce(set.union, [g.texture_set() for g in self.all])
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 2175, in sage.plot.plot3d.base.Graphics3dGroup.texture_set (build/cythonized/sage/plot/plot3d/base.c:32069)
[dochtml] [combinat ] return reduce(set.union, [g.texture_set() for g in self.all])
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 2175, in sage.plot.plot3d.base.Graphics3dGroup.texture_set (build/cythonized/sage/plot/plot3d/base.c:32069)
[dochtml] [combinat ] return reduce(set.union, [g.texture_set() for g in self.all])
[dochtml] [combinat ] File "sage/plot/plot3d/base.pyx", line 2175, in sage.plot.plot3d.base.Graphics3dGroup.texture_set (build/cythonized/sage/plot/plot3d/base.c:32124)
[dochtml] [combinat ] return reduce(set.union, [g.texture_set() for g in self.all])
[dochtml] [combinat ] TypeError: reduce() of empty sequence with no initial value
```

Although it doesn't yet explain why this is failing, but it is at least a little more information.


---

Comment by tscrim created at 2017-05-15 19:25:06

By a little more information, it is occurring with one of the 3D plots.


---

Comment by tscrim created at 2017-05-15 19:27:55

So my guess is that it is due to this:

```
g.plot3d(pos3d=positions, color_by_label=plot_options.color)
```



---

Comment by aram.dermenjian created at 2017-05-24 18:17:51

I've gone ahead and just removed that plot. I tried cleaning my doc and making again, and as usual, everything worked well. I guess we'll need to run it through the patchbots to see if it works this time around.
----
New commits:


---

Comment by aram.dermenjian created at 2017-05-24 18:18:45

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-05-24 21:27:56

I didn't have too much time to investigate this, but this is probably the best way forward.

IMO, it is better to send it back to the buildbots and see if Volker comes back again saying it fails since we need a specific patchbot to look at it.


---

Comment by tscrim created at 2017-05-24 21:27:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-05-27 09:51:07

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-05-27 09:51:07


```
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1642, in main
[dochtml]     builder()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 266, in build_many
[dochtml]     results.append(target(arg))
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 70, in build_ref_doc
[dochtml]     getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 720, in _wrapper
[dochtml]     getattr(DocBuilder, build_type)(self, *args, **kwds)
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 104, in f
[dochtml]     runsphinx()
[dochtml]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py", line 215, in runsphinx
[dochtml]     raise exception
[dochtml] OSError: [combinat ] /home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/root_system/plot.py:docstring of sage.combinat.root_system.plot.PlotOptions.color:21: WARNING: Exception occurred in plotting plot-15
[dochtml] 
make[1]: *** [doc-html-mathjax] Error 1
```



---

Comment by vbraun created at 2017-05-27 09:52:16

I'd appreciate it if you don't send me half-assed tickets on the vague hope that they work, I do have a lot of tickets to juggle and can't spend that much time on individual issues.


---

Comment by tscrim created at 2017-05-27 13:51:18

We would love to send you something that works, but the problem _nobody_ other than you and one patchbot has been able to reproduce that failure. I tried asking for more information and your help (comment:17, comment:27) so we didn't have to do this back and forth. The error message that you keep posting does not contain any useful information. This seemed like the best lead from the patchbot report (comment:30), which actually had some more useful information and only seemed to apply to the now removed plot.

Really what is going on is we are trying to find our way in the dark. Is there some way you can give us access to the machine where it does fail so we can experiment? If you're unwilling to help and unless somebody else has this failure, then we have to set it to positive review and give it to you to test it.


---

Comment by vbraun created at 2017-05-28 23:03:13

The error is still the `TypeError: reduce() of empty sequence with no initial value`. 
* Add an initial value to the reduction
* Add a unit test that your 3d graphics object contains at least some of the objects you think it does

Jan Groenewald can get you access to the buildbots


---

Comment by tscrim created at 2017-06-01 05:08:51

Thank you. I will be e-mail Jan about the buildbot access and get to this in a few days (I will be traveling tomorrow from the US to South Korea). Which buildbot(s) does the failure occur on? Feel free to send me an e-mail directly about it.


---

Comment by tscrim created at 2017-06-09 16:05:30

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-06-09 16:05:30

The problem is this test/plot:

```
    sage: L = RootSystem(["A",3,1]).ambient_space()
    sage: L.plot(reflection_hyperplanes=False, bounding_box=85/100) # long time
    Graphics3d Object

.. PLOT::
    :width: 300 px

    L = RootSystem(["A",3,1]).ambient_space()
    sphinx_plot(L.plot(reflection_hyperplanes=False, bounding_box=85/100))
```

I also now know why it fails and can reproduce it in a Sage session:

```
sage: L = RootSystem(["A",3,1]).ambient_space()
sage: p = L.plot(reflection_hyperplanes=False, bounding_box=int(85)/int(100))
sage: p.tachyon()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: reduce() of empty sequence with no initial value
```

There is no Sage preprocessor run, so the bounding box gets evaluated to 0, which in turn, creates an empty `Graphics3dGroup`, which causes the `reduce` to fail:

```
sage: g = p.all[9]   # I think this will be the same for all, but not sure
sage: g.all
[]
```

This is now #23200. This is not a dependency as the correct picture should be plotted, which means the bounding box should be a rational number, meaning we never get the empty `Graphics3dGroup` (and generates the correct picture). I verified this last commit fixes the problem on the buildbot where it didn't work before.

That does not quite explain why we could not reproduce this failure locally, but it does explain everything else. I'm not going to bother with this last detail.
----
New commits:


---

Comment by aram.dermenjian created at 2017-06-13 02:26:38

Changing status from needs_review to positive_review.


---

Comment by aram.dermenjian created at 2017-06-13 02:26:38

Tested on my machine and everything seems to work correctly. Here's to hoping this time we have it.


---

Comment by vbraun created at 2017-06-14 18:18:26

Resolution: fixed


---

Comment by nthiery created at 2017-06-14 21:15:24

Yeah!
Thanks so much everyone :-)
