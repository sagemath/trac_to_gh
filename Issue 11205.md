# Issue 11205: Clean and harmonize module_list.py

Issue created by migration from https://trac.sagemath.org/ticket/11377

Original creator: fbissey

Original creation time: 2011-05-25 01:22:48

Assignee: GeorgSWeber

CC:  strogdon robertwb

module_list.py is quite messy in its current state. There are several things that can be done:
 1. remove the unused debian bits
 1. we have SAGE_LOCAL and SAGE_INC variables but there use iis not uniform
 1. we also have numpy_include_dirs, numpy_depends, flint_depends, singular_depends and ginac_depends and most of them are under-used.

In this ticket I remove old debian stuff, use SAGE_INC, SAGE_LOCAL and the other variables in a uniform fashion removing all instances of SAGE_ROOT +/local/... and so on to replace it by the appropriate variable.


---

Attachment

patch to module_list.py


---

Comment by fbissey created at 2011-05-25 01:25:28

Changing status from new to needs_review.


---

Comment by fbissey created at 2011-05-27 21:29:05

Now that 4.7.1.alpha0 is out this can be reviewed.


---

Comment by vbraun created at 2011-06-13 20:14:37

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2011-06-13 20:14:37

Looks good to me. But in Sage-4.7.1.alpha2 there were some more extension modules added (under sage.groups.perm_gps.partn_ref). Can you updated your patch for that? I'll review it then asap.


---

Comment by vbraun created at 2011-06-13 20:15:30

Changing keywords from "" to "sd31".


---

Comment by fbissey created at 2011-06-13 21:29:08

It is up to date for 4.7.1.alpha2 already. The only possible problems could be with #9989 depending on which one is merged first and whether my suggested changes for it are accepted.


---

Comment by vbraun created at 2011-06-13 22:27:30

The patch applies, but `sage.groups.perm_gps.partn_ref.*` don't use `SAGE_INC` and the `flint_depends`:


```

    Extension('sage.groups.perm_gps.partn_ref.automorphism_group_canonical_label',
              sources = ['sage/groups/perm_gps/partn_ref/automorphism_group_canonical_label.pyx'],
              libraries = ['gmp', 'flint'],
              include_dirs = [SAGE_ROOT + '/local/include/FLINT/'],
              extra_compile_args = ['-std=c99'],
              depends = [SAGE_ROOT + "/local/include/FLINT/flint.h"]),
```



---

Comment by fbissey created at 2011-06-13 23:08:41

I thought I had taken care of that. My apologies it will take a few hours until I can take care of them.


---

Attachment

I missed a number of flint dependencies in the original patch. Apply trac_11377-build_module_listpy.patchafter


---

Comment by fbissey created at 2011-06-14 00:04:37

It turns out I had missed another instance of flint in sage.set.disjoints.set. So the additional patch takes care of it. It was all done on top of alpha2, hopefully there is nothing wrecking it already in alpha3.


---

Comment by fbissey created at 2011-06-14 00:04:37

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2011-06-14 00:06:22

In the last patch description the word after shouldn't have come last. It is applied after trac_11377-build_module_listpy.patch.


---

Comment by vbraun created at 2011-06-14 00:37:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2011-06-14 00:37:30

Looks great!


---

Comment by jdemeyer created at 2011-06-14 20:07:43

Changing priority from major to critical.


---

Comment by jdemeyer created at 2011-06-15 15:24:57

Resolution: fixed


---

Comment by leif created at 2011-06-18 16:49:15

Would have been nice if you'd cc'ed me ;-) (as I have introduced `SAGE_INC` :-) and always been interested in cleaning the whole mess up, not to mention tickets like #8664, #9914, or the "final" trouble with #4000 ...).

Robert B. originally planned (about 14+ month ago, cf. e.g. #7987) to "automate" most of what's currently hand-coded in `module_list.py` (by Cython pragmas local to the modules' files), so I mostly made changes that affect only small parts.

Btw, I may have missed something, but neither alpha4 (nor alpha3) have yet been announced; the `README.FIRST`s still state
> _There is no point in testing it because the version can change any time._


---

Comment by fbissey created at 2011-06-18 19:58:05

Hi Robert,

sorry I didn't know you had introduced it. I was vaguely aware of the existence of an effort like #7987 but didn't know the ticket or that a ticket was actually open.

I must say my primary aim was the elimination of reference to SAGE_ROOT which is a pain for sage-on-gentoo. And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.


---

Comment by leif created at 2011-06-18 21:39:23

Replying to [comment:15 fbissey]:
> And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.

And above all _merged_! Making larger changes to `module_list.py` is some kind of Sisyphean task since many tickets (unrelated to the build system) frequently modify parts of it.

Reducing the need for the latter should IMHO be the next step, as it somewhat thwarts concurrent, modular development and maintainability.

I've more than once spent days to figure out and remove useless dependencies (e.g. on libraries) last year, in some cases just to - not much later - see the effort being more or less in vain...
