# Issue 24462: Coxeter3 is broken

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2018-02-09 16:58:07

CC:  â€‹tscrim

1. Due to the recent changes in the GCC configure logic, several patchbots have upgraded to GCC-7.2.0.  This reveals trouble with coxeter3:

```
[sagelib-8.2.beta5] [  4/174] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I./sage/cpython -I/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/cysignals -I./sage/libs/ntl -I/home/patchbot/sage-patchbot/local/include -I/home/patchbot/sage-patchbot/local/include/python2.7 -I/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/numpy/core/include -I/home/patchbot/sage-patchbot/src -I/home/patchbot/sage-patchbot/src/sage/ext -Ibuild/cythonized -I/home/patchbot/sage-patchbot/local/include/python2.7 -c build/cythonized/sage/modules/vector_rational_dense.c -o build/temp.linux-i686-2.7/build/cythonized/sage/modules/vector_rational_dense.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c99
[sagelib-8.2.beta5] In file included from ../local/include/coxeter/coxgroup.h:67:0,
[sagelib-8.2.beta5]                  from build/cythonized/sage/libs/coxeter3/coxeter.cpp:599:
[sagelib-8.2.beta5] ../local/include/coxeter/files.h:113:8: error: redeclaration of 'template<class H> void files::printHeckeElt(FILE*, const H&, const schubert::SchubertContext&, const interface::Interface&, files::OutputTraits&, const Length&)' may not have default arguments [-fpermissive]
[sagelib-8.2.beta5]    void printHeckeElt(FILE* file, const H& h, const SchubertContext& p,
[sagelib-8.2.beta5]         ^~~~~~~~~~~~~
```


2. It gives doctest failures on ppc64le

3. According to #24361, it doesn't pass its own testsuite.

Unless somebody wants to fix it, it should be downgraded to experimental.


---

Comment by tscrim created at 2018-02-09 21:31:10

I will try to fix this ASAP, but I may not know when that will be. It would be helpful to have access to a machine that can reproduce the failures.


---

Comment by jdemeyer created at 2018-02-10 12:49:55

Note that issues 1 and 4 are system-independent, so they should be easy to fix.


---

Comment by jdemeyer created at 2018-02-19 09:29:55

I diagnosed issue 2: it's because something is assuming that `char` == `signed char` and this is not the case on ppc64le (and on ARM neither): `char` is unsigned.

Compiling coxeter3 with `-fsigned-char` fixes the problem. Ideally, the source code should be fixed by replacing `char -> signed char` where needed but in the worst case, we can just compile with `-fsigned-char`.


---

Comment by jdemeyer created at 2018-02-19 09:37:15

Fixed issue 2

```diff
diff -ru src/minroots.h b/minroots.h
--- src/minroots.h      2013-02-14 18:26:28.000000000 +0100
+++ b/minroots.h        2018-02-19 10:33:53.388377951 +0100
`@``@` -19,7 +19,7 `@``@`
 
 namespace minroots {
   typedef unsigned MinNbr;
-  typedef char DotProduct;
+  typedef signed char DotProduct;
   class MinTable;
 };
 
```



---

Comment by jdemeyer created at 2018-02-19 09:45:02

Travis, did you start working on this? Should I make a branch or will you?


---

Comment by tscrim created at 2018-02-19 11:04:42

Thank you for figuring out the issue. I have not had any time to devote to this. If you could make a branch, that would be appreciated. Thank you and sorry that you're having to do all the work.


---

Comment by jdemeyer created at 2018-02-19 11:18:23

What is the upstream situation of coxeter3? There is a github repo, but are there releases? If not, how can I know with which "release" the Sage package corresponds to?


---

Comment by tscrim created at 2018-02-19 11:31:33

I currently do not have any releases because I have not put in the necessary time to clean up the code sufficiently and have a testing framework in place to make sure there are no speed regressions. Likely this will not change in the near future.


---

Comment by jdemeyer created at 2018-02-19 13:14:33

Do you plan to merge the upstream pull request?


---

Comment by tscrim created at 2018-02-20 00:32:52

Yes, I will merge it upstream.


---

Comment by jdemeyer created at 2018-02-26 09:04:41

I'll work on this today.


---

Comment by tscrim created at 2018-02-26 10:43:42

Thank you. Don't worry about making it a high priority since I will have time to do this on Wednesday too.


---

Comment by jdemeyer created at 2018-02-26 14:26:12

New commits:


---

Comment by git created at 2018-02-26 15:00:03

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-02-26 15:28:59

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-03-03 08:18:35

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-03-03 08:18:35

ok, tested and good to go


---

Comment by tscrim created at 2018-03-03 21:38:55

I was hoping to make a bugfix release of coxeter3 this upcoming week, but I guess that will just be a followup.


---

Comment by vbraun created at 2018-03-04 23:29:28

Resolution: fixed


---

Comment by jhpalmieri created at 2018-05-09 23:22:21

See #25321 for a followup.
