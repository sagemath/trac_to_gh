# Issue 24462: Coxeter3 is broken

archive/issues_024462.json:
```json
{
    "body": "CC:  tscrim\n\n1. Due to the recent changes in the GCC configure logic, several patchbots have upgraded to GCC-7.2.0.  This reveals trouble with coxeter3:\n\n```\n[sagelib-8.2.beta5] [  4/174] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I./sage/cpython -I/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/cysignals -I./sage/libs/ntl -I/home/patchbot/sage-patchbot/local/include -I/home/patchbot/sage-patchbot/local/include/python2.7 -I/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/numpy/core/include -I/home/patchbot/sage-patchbot/src -I/home/patchbot/sage-patchbot/src/sage/ext -Ibuild/cythonized -I/home/patchbot/sage-patchbot/local/include/python2.7 -c build/cythonized/sage/modules/vector_rational_dense.c -o build/temp.linux-i686-2.7/build/cythonized/sage/modules/vector_rational_dense.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c99\n[sagelib-8.2.beta5] In file included from ../local/include/coxeter/coxgroup.h:67:0,\n[sagelib-8.2.beta5]                  from build/cythonized/sage/libs/coxeter3/coxeter.cpp:599:\n[sagelib-8.2.beta5] ../local/include/coxeter/files.h:113:8: error: redeclaration of 'template<class H> void files::printHeckeElt(FILE*, const H&, const schubert::SchubertContext&, const interface::Interface&, files::OutputTraits&, const Length&)' may not have default arguments [-fpermissive]\n[sagelib-8.2.beta5]    void printHeckeElt(FILE* file, const H& h, const SchubertContext& p,\n[sagelib-8.2.beta5]         ^~~~~~~~~~~~~\n```\n\n\n2. It gives doctest failures on ppc64le\n\n3. According to #24361, it doesn't pass its own testsuite.\n\nUnless somebody wants to fix it, it should be downgraded to experimental.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24699\n\n",
    "created_at": "2018-02-09T16:58:07Z",
    "labels": [
        "packages: optional",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Coxeter3 is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24462",
    "user": "jdemeyer"
}
```
CC:  tscrim

1. Due to the recent changes in the GCC configure logic, several patchbots have upgraded to GCC-7.2.0.  This reveals trouble with coxeter3:

```
[sagelib-8.2.beta5] [  4/174] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I./sage/cpython -I/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/cysignals -I./sage/libs/ntl -I/home/patchbot/sage-patchbot/local/include -I/home/patchbot/sage-patchbot/local/include/python2.7 -I/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/numpy/core/include -I/home/patchbot/sage-patchbot/src -I/home/patchbot/sage-patchbot/src/sage/ext -Ibuild/cythonized -I/home/patchbot/sage-patchbot/local/include/python2.7 -c build/cythonized/sage/modules/vector_rational_dense.c -o build/temp.linux-i686-2.7/build/cythonized/sage/modules/vector_rational_dense.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c99
[sagelib-8.2.beta5] In file included from ../local/include/coxeter/coxgroup.h:67:0,
[sagelib-8.2.beta5]                  from build/cythonized/sage/libs/coxeter3/coxeter.cpp:599:
[sagelib-8.2.beta5] ../local/include/coxeter/files.h:113:8: error: redeclaration of 'template<class H> void files::printHeckeElt(FILE*, const H&, const schubert::SchubertContext&, const interface::Interface&, files::OutputTraits&, const Length&)' may not have default arguments [-fpermissive]
[sagelib-8.2.beta5]    void printHeckeElt(FILE* file, const H& h, const SchubertContext& p,
[sagelib-8.2.beta5]         ^~~~~~~~~~~~~
```


2. It gives doctest failures on ppc64le

3. According to #24361, it doesn't pass its own testsuite.

Unless somebody wants to fix it, it should be downgraded to experimental.

Issue created by migration from https://trac.sagemath.org/ticket/24699





---

archive/issue_comments_343167.json:
```json
{
    "body": "I will try to fix this ASAP, but I may not know when that will be. It would be helpful to have access to a machine that can reproduce the failures.",
    "created_at": "2018-02-09T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343167",
    "user": "tscrim"
}
```

I will try to fix this ASAP, but I may not know when that will be. It would be helpful to have access to a machine that can reproduce the failures.



---

archive/issue_comments_343168.json:
```json
{
    "body": "Note that issues 1 and 4 are system-independent, so they should be easy to fix.",
    "created_at": "2018-02-10T12:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343168",
    "user": "jdemeyer"
}
```

Note that issues 1 and 4 are system-independent, so they should be easy to fix.



---

archive/issue_comments_343169.json:
```json
{
    "body": "I diagnosed issue 2: it's because something is assuming that `char` == `signed char` and this is not the case on ppc64le (and on ARM neither): `char` is unsigned.\n\nCompiling coxeter3 with `-fsigned-char` fixes the problem. Ideally, the source code should be fixed by replacing `char -> signed char` where needed but in the worst case, we can just compile with `-fsigned-char`.",
    "created_at": "2018-02-19T09:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343169",
    "user": "jdemeyer"
}
```

I diagnosed issue 2: it's because something is assuming that `char` == `signed char` and this is not the case on ppc64le (and on ARM neither): `char` is unsigned.

Compiling coxeter3 with `-fsigned-char` fixes the problem. Ideally, the source code should be fixed by replacing `char -> signed char` where needed but in the worst case, we can just compile with `-fsigned-char`.



---

archive/issue_comments_343170.json:
```json
{
    "body": "Fixed issue 2\n\n```diff\ndiff -ru src/minroots.h b/minroots.h\n--- src/minroots.h      2013-02-14 18:26:28.000000000 +0100\n+++ b/minroots.h        2018-02-19 10:33:53.388377951 +0100\n@@ -19,7 +19,7 @@\n \n namespace minroots {\n   typedef unsigned MinNbr;\n-  typedef char DotProduct;\n+  typedef signed char DotProduct;\n   class MinTable;\n };\n \n```\n",
    "created_at": "2018-02-19T09:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343170",
    "user": "jdemeyer"
}
```

Fixed issue 2

```diff
diff -ru src/minroots.h b/minroots.h
--- src/minroots.h      2013-02-14 18:26:28.000000000 +0100
+++ b/minroots.h        2018-02-19 10:33:53.388377951 +0100
@@ -19,7 +19,7 @@
 
 namespace minroots {
   typedef unsigned MinNbr;
-  typedef char DotProduct;
+  typedef signed char DotProduct;
   class MinTable;
 };
 
```




---

archive/issue_comments_343171.json:
```json
{
    "body": "Travis, did you start working on this? Should I make a branch or will you?",
    "created_at": "2018-02-19T09:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343171",
    "user": "jdemeyer"
}
```

Travis, did you start working on this? Should I make a branch or will you?



---

archive/issue_comments_343172.json:
```json
{
    "body": "Thank you for figuring out the issue. I have not had any time to devote to this. If you could make a branch, that would be appreciated. Thank you and sorry that you're having to do all the work.",
    "created_at": "2018-02-19T11:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343172",
    "user": "tscrim"
}
```

Thank you for figuring out the issue. I have not had any time to devote to this. If you could make a branch, that would be appreciated. Thank you and sorry that you're having to do all the work.



---

archive/issue_comments_343173.json:
```json
{
    "body": "What is the upstream situation of coxeter3? There is a github repo, but are there releases? If not, how can I know with which \"release\" the Sage package corresponds to?",
    "created_at": "2018-02-19T11:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343173",
    "user": "jdemeyer"
}
```

What is the upstream situation of coxeter3? There is a github repo, but are there releases? If not, how can I know with which "release" the Sage package corresponds to?



---

archive/issue_comments_343174.json:
```json
{
    "body": "I currently do not have any releases because I have not put in the necessary time to clean up the code sufficiently and have a testing framework in place to make sure there are no speed regressions. Likely this will not change in the near future.",
    "created_at": "2018-02-19T11:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343174",
    "user": "tscrim"
}
```

I currently do not have any releases because I have not put in the necessary time to clean up the code sufficiently and have a testing framework in place to make sure there are no speed regressions. Likely this will not change in the near future.



---

archive/issue_comments_343175.json:
```json
{
    "body": "Do you plan to merge the upstream pull request?",
    "created_at": "2018-02-19T13:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343175",
    "user": "jdemeyer"
}
```

Do you plan to merge the upstream pull request?



---

archive/issue_comments_343176.json:
```json
{
    "body": "Yes, I will merge it upstream.",
    "created_at": "2018-02-20T00:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343176",
    "user": "tscrim"
}
```

Yes, I will merge it upstream.



---

archive/issue_comments_343177.json:
```json
{
    "body": "I'll work on this today.",
    "created_at": "2018-02-26T09:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343177",
    "user": "jdemeyer"
}
```

I'll work on this today.



---

archive/issue_comments_343178.json:
```json
{
    "body": "Thank you. Don't worry about making it a high priority since I will have time to do this on Wednesday too.",
    "created_at": "2018-02-26T10:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343178",
    "user": "tscrim"
}
```

Thank you. Don't worry about making it a high priority since I will have time to do this on Wednesday too.



---

archive/issue_comments_343179.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-26T14:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343179",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_343180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-26T15:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343180",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343181.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-26T15:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343181",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_343182.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-03T08:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343182",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343183.json:
```json
{
    "body": "ok, tested and good to go",
    "created_at": "2018-03-03T08:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343183",
    "user": "chapoton"
}
```

ok, tested and good to go



---

archive/issue_comments_343184.json:
```json
{
    "body": "I was hoping to make a bugfix release of coxeter3 this upcoming week, but I guess that will just be a followup.",
    "created_at": "2018-03-03T21:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343184",
    "user": "tscrim"
}
```

I was hoping to make a bugfix release of coxeter3 this upcoming week, but I guess that will just be a followup.



---

archive/issue_comments_343185.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-04T23:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343185",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_343186.json:
```json
{
    "body": "See #25321 for a followup.",
    "created_at": "2018-05-09T23:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24462#issuecomment-343186",
    "user": "jhpalmieri"
}
```

See #25321 for a followup.
