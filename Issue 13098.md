# Issue 13098: Restarted notebook server allows user registration

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2012-07-18 13:51:48

Assignee: jason, mpatel, was

CC:  kini jason

I observe this on two Linux Mint machines: one runs 11th version, another Debian Edition.

 1. Compile sage-5.2.rc0.
 2. Start it.
 3. Start notebook either without parameters or to start remotely accessible secure server.
 4. User registration is enabled (it was NOT before).
 5. Turn it off in the settings and save.
 6. It is indeed off.
 7. Stop the server and start it again.
 8. Use registration is enabled.


---

Comment by novoselt created at 2012-07-18 19:26:36

Same story on geom.


---

Comment by kcrisman created at 2012-07-20 15:31:16

You should probably report this as an [issue on Github as well](https://github.com/sagemath/sagenb/issues?state=open), and refer back here.


---

Comment by novoselt created at 2012-07-20 16:02:07

I think that the current Github version is working - when I installed #13121, I have noticed the issue but was not able to reproduce it. My guess is that the registration was enabled by Sage own version, then I have noticed it and turned it off with #13121 and everything was fine until I tried clean sage-5.2.rc0 without #13121. Anyway, it does not seem that anyone else is concerned that the next version of Sage will quietly open your machine to anyone, if you try to use the notebook remotely...


---

Comment by kcrisman created at 2012-07-20 16:12:13

> Anyway, it does not seem that anyone else is concerned that the next version of Sage will quietly open your machine to anyone, if you try to use the notebook remotely...
I wouldn't be so sure.  But maybe no one has an obvious fix.  You might want to email someone directly to ask where this might have changed in Github.  It does seems like a reasonable blocker, for the security issue.


---

Comment by jason created at 2012-07-20 17:04:55

This is the first I've heard of this.  So do you say that #13121 fixes this?


---

Comment by novoselt created at 2012-07-20 17:14:10

Replying to [comment:5 jason]:
> This is the first I've heard of this.  So do you say that #13121 fixes this?

I *think* so. I've [originally posted](http://trac.sagemath.org/sage_trac/ticket/13121#comment:57) about it there as a one time issue since I couldn't reproduce it. It came back for me in rc0 (reported in the first two replies on [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/1f694f90be6e5da3)). Switching between clean rc0 or beta1+13121 I can turn this bug on and off, so my guess is that it got fixed in the notebook along the way, but rc0 has too old of a version.


---

Comment by jdemeyer created at 2012-07-21 16:21:36

So what's the plan then?  Postpone the release of sage-5.2 and include #13121 or release sage-5.2 anyway and fix it in sage-5.3?

Considering this is a blocker, probably you should create a thread on sage-notebook asking for opinions.


---

Comment by jason created at 2012-07-21 16:29:14

With what appears to be a pretty bad security issue, I think delaying 5.2 and considering #13121 a blocker might be best.  Keshav: you're the current sagenb guru---what do you say?


---

Comment by jason created at 2012-07-21 16:29:43

(that said, I haven't had time to look at this; I've just been following the comments here).


---

Comment by jdemeyer created at 2012-07-23 06:55:24

Changing priority from blocker to major.


---

Comment by dimpase created at 2012-07-23 07:45:59

Replying to [comment:1 novoselt]:
> Same story on geom.

and on OSX 10.6.8


---

Comment by dimpase created at 2012-07-23 08:09:29

I think it is some semi-trivial logic bug related to using None and False.
If in `sagenb/notebook/run_notebook.py` I change the line 224 from

```
             accounts      = None,
```

to 

```
             accounts      = False,
```

then  the setting for `Enable user registration` stays off, instead of staying on.
That is, when I start the notebook server, it is always `off` rather than `on`, and saving this option has
no effect. As opposed to the scenario described on the ticket, when it always stays on.


---

Comment by dimpase created at 2012-07-23 08:28:33

Replying to [comment:12 dimpase]:
> I think it is some semi-trivial logic bug related to using None and False.

it looks as if the [patch](http://trac.sagemath.org/sage_trac/attachment/ticket/11080/trac_11080-user_registration.patch) just
proposed on #11080 fixes this!


---

Comment by dimpase created at 2012-07-23 10:16:10

Replying to [comment:13 dimpase]:
> Replying to [comment:12 dimpase]:
> > I think it is some semi-trivial logic bug related to using None and False.
> 
> it looks as if the [patch](http://trac.sagemath.org/sage_trac/attachment/ticket/11080/trac_11080-user_registration.patch) just
> proposed on #11080 fixes this!

unfortunately, not quite so. See #11080 for more.


---

Comment by dimpase created at 2012-07-23 10:34:31

Replying to [comment:14 dimpase]:
> Replying to [comment:13 dimpase]:
> > Replying to [comment:12 dimpase]:
> > > I think it is some semi-trivial logic bug related to using None and False.
> > 
> > it looks as if the [patch](http://trac.sagemath.org/sage_trac/attachment/ticket/11080/trac_11080-user_registration.patch) just
> > proposed on #11080 fixes this!
> 
> unfortunately, not quite so. See #11080 for more.

The patch works, I just was confused about the functionality under different scenarios! Let's beg Jeroen to re-merge these patches.


---

Comment by jdemeyer created at 2012-07-23 10:42:58

A new sagenb spkg needs to be created with the fix.


---

Comment by ppurka created at 2012-07-23 11:36:30

Sorry, I didn't see that the status of this ticket was changed. Please see [comment:344 of #11080](http://trac.sagemath.org/sage_trac/ticket/11080#comment:344).


---

Comment by dimpase created at 2012-07-23 11:57:35

Changing status from new to needs_review.


---

Comment by dimpase created at 2012-07-23 11:57:35

I applied the patch the old-fashioned way and uploaded the resulting spkg - cf. the link in the description.


---

Comment by jason created at 2012-07-23 11:59:24

Thanks for taking care of this, guys!


---

Comment by ppurka created at 2012-07-23 12:05:13

Replying to [comment:18 dimpase]:
> I applied the patch the old-fashioned way and uploaded the resulting spkg - cf. the link in the description.

The spkg works. But it needs the versioning changed everywhere from 0.9.0 to 0.9.1. The install log shows lots of 0.9.0.


---

Comment by dimpase created at 2012-07-23 12:22:31

Replying to [comment:20 ppurka]:
> Replying to [comment:18 dimpase]:
> > I applied the patch the old-fashioned way and uploaded the resulting spkg - cf. the link in the description.
> 
> The spkg works. But it needs the versioning changed everywhere from 0.9.0 to 0.9.1. The install log shows lots of 0.9.0.

how about just calling it `0.9.0.p0` ?


---

Comment by kcrisman created at 2012-07-23 12:26:40

> how about just calling it 0.9.0.p0 ?
That seems very logical.


---

Comment by ppurka created at 2012-07-23 12:40:37

Well, anything other than `0.9.0` is fine as long as it shows that it is different from `0.9.0` since the upstream has a tag of 0.9.0 that points to a particular state of the sagenb.

What is the rationale behind the `.p?` suffix? Is it used only for bugfixes?


---

Comment by jason created at 2012-07-23 12:45:47

.p* stands for "patch level" or "patch".  It's a way of noting patches to upstream releases, and seems entirely appropriate here.

That way we don't have to backport the patch to 0.9.0 in the git tree.  Just apply the patch here "downstream".  It is already merged in the next release upstream.


---

Comment by ppurka created at 2012-07-23 12:52:01

Replying to [comment:24 jason]:
> .p* stands for "patch level" or "patch".  It's a way of noting patches to upstream releases, and seems entirely appropriate here.
> 
> That way we don't have to backport the patch to 0.9.0 in the git tree.  Just apply the patch here "downstream".  It is already merged in the next release upstream.

Great! Then it is just fine to rename the spkg to `0.9.0.p0`.


---

Comment by dimpase created at 2012-07-23 12:54:02

Changing priority from major to blocker.


---

Comment by dimpase created at 2012-07-23 12:54:48

I have corrected the name to make it `sagenb-0.9.0.p0.spkg`.

Strictly speaking, one should have put the patch into the root subdirectory of spkg and fix spkg-install to apply it to the
pristine 0.9.0. Instead I just patched `src/sagenb` subdirectory of spkg.
As this is a one-time event, and in the future the releases of sagenb will be git-based, I hope it's OK.


---

Comment by kcrisman created at 2012-07-23 12:58:07

Sure hope so.  Having the infrastructure for the patch in here would be redundant, and also sagenb is not _really_ as upstream as one might think...  maybe it's more like halfway up one of those trout ladders one sees in the Pacific Northwest.


---

Comment by kini created at 2012-07-23 18:09:21

Hi everyone, sorry for the delay in responding.

I cherry picked the commit Jason identified onto 0.9.0 and released a sagenb 0.9.1. SPKG is here: http://wstein.org/home/keshav/files/sagenb-0.9.1.spkg .

Thanks for finding the problem :)


---

Comment by novoselt created at 2012-07-23 19:17:43

Thanks for solving it!!!


---

Comment by ppurka created at 2012-07-24 02:34:06

Changing status from needs_review to positive_review.


---

Comment by ppurka created at 2012-07-24 02:34:06

sagenb-0.9.1 works. Setting to positive review.


---

Comment by jdemeyer created at 2012-07-24 14:41:49

Resolution: fixed
