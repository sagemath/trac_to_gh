# Issue 24819: Fix the Sage banner

archive/issues_024819.json:
```json
{
    "body": "CC:  @embray\n\nSomething has broken the Sage banner.\n\nIn 8.2.beta8:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.2.beta8, Release Date: 2018-03-10               \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n```\n\n\nIn 8.2.rc0:\n\n```\nSageMath version 8.2.rc0, Release Date: 2018-03-28\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25056\n\n",
    "created_at": "2018-03-29T08:38:13Z",
    "labels": [
        "component: user interface",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Fix the Sage banner",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24819",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @embray

Something has broken the Sage banner.

In 8.2.beta8:

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.2.beta8, Release Date: 2018-03-10               │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```


In 8.2.rc0:

```
SageMath version 8.2.rc0, Release Date: 2018-03-28
```


Issue created by migration from https://trac.sagemath.org/ticket/25056





---

archive/issue_comments_348200.json:
```json
{
    "body": "It seems like the release manager is running `sage-update-version` in some context where unicode is just broken...",
    "created_at": "2018-03-29T08:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348200",
    "user": "https://github.com/embray"
}
```

It seems like the release manager is running `sage-update-version` in some context where unicode is just broken...



---

archive/issue_comments_348201.json:
```json
{
    "body": "Why is it stored in `src/bin` anyways?  It's not an executable at all...",
    "created_at": "2018-03-29T08:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348201",
    "user": "https://github.com/embray"
}
```

Why is it stored in `src/bin` anyways?  It's not an executable at all...



---

archive/issue_comments_348202.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-29T09:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348202",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_348203.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-29T09:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348203",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348204.json:
```json
{
    "body": "+1\n\nLet me just make sure that the banner still gets printed pretty quickly on slower platforms (i.e. Cygwin).\n\nOn that note I've also been really wanting to add like a spinner or something while it imports sage, but that's another matter...",
    "created_at": "2018-03-29T09:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348204",
    "user": "https://github.com/embray"
}
```

+1

Let me just make sure that the banner still gets printed pretty quickly on slower platforms (i.e. Cygwin).

On that note I've also been really wanting to add like a spinner or something while it imports sage, but that's another matter...



---

archive/issue_comments_348205.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-29T15:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348205",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348206.json:
```json
{
    "body": "It does come up noticeably a little more slowly, but it's still subtle.  I'm also currently running a debug build which probably accounts for it being slow to begin with, so I'm not too concerned about it right now.",
    "created_at": "2018-03-29T15:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348206",
    "user": "https://github.com/embray"
}
```

It does come up noticeably a little more slowly, but it's still subtle.  I'm also currently running a debug build which probably accounts for it being slow to begin with, so I'm not too concerned about it right now.



---

archive/issue_comments_348207.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-03-30T10:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348207",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_348208.json:
```json
{
    "body": "\n```\n**********************************************************************\nFile \"src/sage/misc/lazy_attribute.pyx\", line 88, in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_\nFailed example:\n    src[0]\nExpected:\n    'def banner(full=None):\\n'\nGot:\n    'def banner():\\n'\n**********************************************************************\nFile \"src/sage/misc/lazy_attribute.pyx\", line 90, in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_\nFailed example:\n    lines\nExpected:\n    87\nGot:\n    81\n**********************************************************************\n1 item had failures:\n   2 of   6 in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_\n    [130 tests, 2 failures, 2.79 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/misc/abstract_method.py  # 2 doctests failed\nsage -t --long src/sage/misc/lazy_attribute.pyx  # 2 doctests failed\n```\n",
    "created_at": "2018-03-30T10:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348208",
    "user": "https://github.com/vbraun"
}
```


```
**********************************************************************
File "src/sage/misc/lazy_attribute.pyx", line 88, in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_
Failed example:
    src[0]
Expected:
    'def banner(full=None):\n'
Got:
    'def banner():\n'
**********************************************************************
File "src/sage/misc/lazy_attribute.pyx", line 90, in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_
Failed example:
    lines
Expected:
    87
Got:
    81
**********************************************************************
1 item had failures:
   2 of   6 in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_
    [130 tests, 2 failures, 2.79 s]
----------------------------------------------------------------------
sage -t --long src/sage/misc/abstract_method.py  # 2 doctests failed
sage -t --long src/sage/misc/lazy_attribute.pyx  # 2 doctests failed
```




---

archive/issue_comments_348209.json:
```json
{
    "body": "I suggest those tests be rewritten around a dummy function that is not going to actually be changed...",
    "created_at": "2018-03-30T13:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348209",
    "user": "https://github.com/embray"
}
```

I suggest those tests be rewritten around a dummy function that is not going to actually be changed...



---

archive/issue_comments_348210.json:
```json
{
    "body": "The banner was broken in #24825, now the output of the full banner can't be redirected\n\n```\n$ sage --python -c \"import sage.misc.banner; sage.misc.banner.banner(full=True)\" | cat\nSageMath version 8.2.rc1, Release Date: 2018-03-31\n```\n\nPipes that don't lead to the terminal do need to be encoded, check with isatty or always encode.",
    "created_at": "2018-03-31T13:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348210",
    "user": "https://github.com/vbraun"
}
```

The banner was broken in #24825, now the output of the full banner can't be redirected

```
$ sage --python -c "import sage.misc.banner; sage.misc.banner.banner(full=True)" | cat
SageMath version 8.2.rc1, Release Date: 2018-03-31
```

Pipes that don't lead to the terminal do need to be encoded, check with isatty or always encode.



---

archive/issue_comments_348211.json:
```json
{
    "body": "Also cold starts can be slow (especially over nfs), which is why historically we want to print something before Python starts up.",
    "created_at": "2018-03-31T13:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348211",
    "user": "https://github.com/vbraun"
}
```

Also cold starts can be slow (especially over nfs), which is why historically we want to print something before Python starts up.



---

archive/issue_comments_348212.json:
```json
{
    "body": "Well, starting up Python should only a fraction of the time of starting up Sage.",
    "created_at": "2018-04-02T08:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348212",
    "user": "https://github.com/jdemeyer"
}
```

Well, starting up Python should only a fraction of the time of starting up Sage.



---

archive/issue_comments_348213.json:
```json
{
    "body": "maybe we should just undo #24825, in order to allow the release of 8.2 ?",
    "created_at": "2018-04-02T08:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348213",
    "user": "https://github.com/fchapoton"
}
```

maybe we should just undo #24825, in order to allow the release of 8.2 ?



---

archive/issue_comments_348214.json:
```json
{
    "body": "It's not just a question of whether or not it's a TTY.  On Python 3 `sys.stdout` is still a `TextIOWrapper` with an encoding regardless whether it's attached to a terminal or not.  That's only a problem on Python 2, apparently.\n\nWe could make this work more consistently by having the `banner()` function encode string (e.g. as UTF-8) before printing on Python 2 (but not on Python 3, where this is already fine).\n\nThat said, I still prefer Jeroen's solution in general; it just needs a trivial fix to that test (which I still believe should be rewritten...)",
    "created_at": "2018-04-03T13:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348214",
    "user": "https://github.com/embray"
}
```

It's not just a question of whether or not it's a TTY.  On Python 3 `sys.stdout` is still a `TextIOWrapper` with an encoding regardless whether it's attached to a terminal or not.  That's only a problem on Python 2, apparently.

We could make this work more consistently by having the `banner()` function encode string (e.g. as UTF-8) before printing on Python 2 (but not on Python 3, where this is already fine).

That said, I still prefer Jeroen's solution in general; it just needs a trivial fix to that test (which I still believe should be rewritten...)



---

archive/issue_comments_348215.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-03T14:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348215",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348216.json:
```json
{
    "body": "Here I fixed the underlying issue on Python 2, and I also fixed the failing test. However, I still kept Jeroen's solution of no longer pre-generating the banner text.\n----\nNew commits:",
    "created_at": "2018-04-03T14:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348216",
    "user": "https://github.com/embray"
}
```

Here I fixed the underlying issue on Python 2, and I also fixed the failing test. However, I still kept Jeroen's solution of no longer pre-generating the banner text.
----
New commits:



---

archive/issue_comments_348217.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-03T14:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_348218.json:
```json
{
    "body": "I don't agree with\n\n```\n            # sys.stdout does not have a clear encoding associated with it on\n            # Python 2 (it may have been redirected, for example); so just\n            # encode as UTF-8 and write the bytes directly to sys.stdout\n```\n\nIf we don't know the encoding, shouldn't we play it safe and assume ASCII instead? You are right that `encoding=None` seems to occur when output has been redirected. In that case, the banner is probably not important anyway, so I don't see the point for your special case.",
    "created_at": "2018-04-04T07:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348218",
    "user": "https://github.com/jdemeyer"
}
```

I don't agree with

```
            # sys.stdout does not have a clear encoding associated with it on
            # Python 2 (it may have been redirected, for example); so just
            # encode as UTF-8 and write the bytes directly to sys.stdout
```

If we don't know the encoding, shouldn't we play it safe and assume ASCII instead? You are right that `encoding=None` seems to occur when output has been redirected. In that case, the banner is probably not important anyway, so I don't see the point for your special case.



---

archive/issue_comments_348219.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-04T07:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348219",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_348220.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-04T09:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348220",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_348221.json:
```json
{
    "body": "The point is that on Python 2 you're writing `str`s which can contain arbitrary bytes, including UTF-8 encoded text.  It doesn't matter.  If you did, say, want to dump to a text file for example this is fine.  Python 3 already handles text better in this regard.  This is just a middle ground (albeit probably not needed in this particular function along with your additional changes).",
    "created_at": "2018-04-04T09:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348221",
    "user": "https://github.com/embray"
}
```

The point is that on Python 2 you're writing `str`s which can contain arbitrary bytes, including UTF-8 encoded text.  It doesn't matter.  If you did, say, want to dump to a text file for example this is fine.  Python 3 already handles text better in this regard.  This is just a middle ground (albeit probably not needed in this particular function along with your additional changes).



---

archive/issue_comments_348222.json:
```json
{
    "body": "In other words, whether on Python 2 or on Python 3 the end result of this is writing a stream of bytes--typically UTF-8 encoded text--to a file object.  The difference is just who's handling the encoding and when (in Python 3 the higher-level I/O object is handling the encoding).",
    "created_at": "2018-04-04T09:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348222",
    "user": "https://github.com/embray"
}
```

In other words, whether on Python 2 or on Python 3 the end result of this is writing a stream of bytes--typically UTF-8 encoded text--to a file object.  The difference is just who's handling the encoding and when (in Python 3 the higher-level I/O object is handling the encoding).



---

archive/issue_comments_348223.json:
```json
{
    "body": "Replying to [comment:23 embray]:\n> The point is that on Python 2 you're writing `str`s which can contain arbitrary bytes, including UTF-8 encoded text.\n\nBut why would you write UTF-8 encoded text when you have no idea whether `stdout` is actually expecting UTF-8? I would make a lot more sense to say \"I don't know the encoding, so let's be safe and assume ASCII\".\n\n> Python 3 already handles text better in this regard.\n\nOr worse in my opinion. When Python 2 doesn't know the encoding, it honestly says so. With Python 3, saying \"I don't know\" is not an option, so it just guesses some encoding.",
    "created_at": "2018-04-04T09:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348223",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 embray]:
> The point is that on Python 2 you're writing `str`s which can contain arbitrary bytes, including UTF-8 encoded text.

But why would you write UTF-8 encoded text when you have no idea whether `stdout` is actually expecting UTF-8? I would make a lot more sense to say "I don't know the encoding, so let's be safe and assume ASCII".

> Python 3 already handles text better in this regard.

Or worse in my opinion. When Python 2 doesn't know the encoding, it honestly says so. With Python 3, saying "I don't know" is not an option, so it just guesses some encoding.



---

archive/issue_comments_348224.json:
```json
{
    "body": "Let me put it another way--what this is doing currently is exactly the same on Python 2 as what it did before I started making changes to it for Python 3 support.  \n\n> But why would you write UTF-8 encoded text when you have no idea whether stdout is actually expecting UTF-8?\n\nBecause that's how Python 2 works--this is the kind of thing Python 3 is trying to fix :)",
    "created_at": "2018-04-04T09:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348224",
    "user": "https://github.com/embray"
}
```

Let me put it another way--what this is doing currently is exactly the same on Python 2 as what it did before I started making changes to it for Python 3 support.  

> But why would you write UTF-8 encoded text when you have no idea whether stdout is actually expecting UTF-8?

Because that's how Python 2 works--this is the kind of thing Python 3 is trying to fix :)



---

archive/issue_comments_348225.json:
```json
{
    "body": "> Or worse in my opinion. When Python 2 doesn't know the encoding, it honestly says so. With Python 3, saying \"I don't know\" is not an option, so it just guesses some encoding.\n\nI don't get it. Is Python 2 worse or better? Because what you're complaining about just above this is how Python 2 works.  Python 3 is not just \"guessing some encoding\".  It's using the encoding from the current locale which is how other applications work (this is, for example, how your editor chooses an encoding to write when you enter non-ASCII text into a document).",
    "created_at": "2018-04-04T09:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348225",
    "user": "https://github.com/embray"
}
```

> Or worse in my opinion. When Python 2 doesn't know the encoding, it honestly says so. With Python 3, saying "I don't know" is not an option, so it just guesses some encoding.

I don't get it. Is Python 2 worse or better? Because what you're complaining about just above this is how Python 2 works.  Python 3 is not just "guessing some encoding".  It's using the encoding from the current locale which is how other applications work (this is, for example, how your editor chooses an encoding to write when you enter non-ASCII text into a document).



---

archive/issue_comments_348226.json:
```json
{
    "body": "Replying to [comment:26 embray]:\n> what this is doing currently is exactly the same on Python 2 as what it did before I started making changes to it for Python 3 support.\n\nIndeed. And I was happy that this bug (writing UTF-8 regardless of actual encoding) finally got fixed in #24825. And now you suggest to revert that fix.",
    "created_at": "2018-04-04T09:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348226",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 embray]:
> what this is doing currently is exactly the same on Python 2 as what it did before I started making changes to it for Python 3 support.

Indeed. And I was happy that this bug (writing UTF-8 regardless of actual encoding) finally got fixed in #24825. And now you suggest to revert that fix.



---

archive/issue_comments_348227.json:
```json
{
    "body": "I don't know what you mean by \"actual encoding\".  There is no \"actual encoding\".  It's a file descriptor.  If you want to write some text to a file descriptor it always has to have some encoding and that has to come from somewhere.",
    "created_at": "2018-04-04T09:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348227",
    "user": "https://github.com/embray"
}
```

I don't know what you mean by "actual encoding".  There is no "actual encoding".  It's a file descriptor.  If you want to write some text to a file descriptor it always has to have some encoding and that has to come from somewhere.



---

archive/issue_comments_348228.json:
```json
{
    "body": "How about this: If you want to switch back to your branch (and just add the fix to the tests) I don't mind.  My only goal here was to fix a regression.  At the same time, as long as Volker agrees to the rest of your changes (getting rid of the pre-written banner files) then it's kind of a moot point.\n\nThe rest of the confusion over this mostly stems from the use of \"print()\" instead of, say, providing an interface explicitly for writing the banner to a text file in some specific encoding (which I agree kind of sucks anyways because it's not necessarily the right encoding for the user's terminal).",
    "created_at": "2018-04-04T09:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348228",
    "user": "https://github.com/embray"
}
```

How about this: If you want to switch back to your branch (and just add the fix to the tests) I don't mind.  My only goal here was to fix a regression.  At the same time, as long as Volker agrees to the rest of your changes (getting rid of the pre-written banner files) then it's kind of a moot point.

The rest of the confusion over this mostly stems from the use of "print()" instead of, say, providing an interface explicitly for writing the banner to a text file in some specific encoding (which I agree kind of sucks anyways because it's not necessarily the right encoding for the user's terminal).



---

archive/issue_comments_348229.json:
```json
{
    "body": "I'm not going to play referee, please figure something out that works amongst yourselves :-)",
    "created_at": "2018-04-05T06:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348229",
    "user": "https://github.com/vbraun"
}
```

I'm not going to play referee, please figure something out that works amongst yourselves :-)



---

archive/issue_comments_348230.json:
```json
{
    "body": "I just removed the commit changing back the banner on Python 2.\n----\nNew commits:",
    "created_at": "2018-04-05T08:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348230",
    "user": "https://github.com/jdemeyer"
}
```

I just removed the commit changing back the banner on Python 2.
----
New commits:



---

archive/issue_comments_348231.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-05T08:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348231",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348232.json:
```json
{
    "body": "That's fine--I was just trying to restore some \"backwards compatibility\", but I think we can both agree it was bad to begin with, and that it's a moot point now.",
    "created_at": "2018-04-05T09:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348232",
    "user": "https://github.com/embray"
}
```

That's fine--I was just trying to restore some "backwards compatibility", but I think we can both agree it was bad to begin with, and that it's a moot point now.



---

archive/issue_comments_348233.json:
```json
{
    "body": "Still get\n\n```\nsage -t --long src/sage/misc/abstract_method.py  # 2 doctests failed\n```\n",
    "created_at": "2018-04-06T07:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348233",
    "user": "https://github.com/vbraun"
}
```

Still get

```
sage -t --long src/sage/misc/abstract_method.py  # 2 doctests failed
```




---

archive/issue_comments_348234.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-04-06T07:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348234",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_348235.json:
```json
{
    "body": "That reminds me to change that silly test.",
    "created_at": "2018-04-06T12:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348235",
    "user": "https://github.com/embray"
}
```

That reminds me to change that silly test.



---

archive/issue_comments_348236.json:
```json
{
    "body": "I see; this is a different test that also depends on the source code of that particular function...",
    "created_at": "2018-04-06T13:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348236",
    "user": "https://github.com/embray"
}
```

I see; this is a different test that also depends on the source code of that particular function...



---

archive/issue_comments_348237.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-04-06T13:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348237",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_348238.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-06T13:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348238",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_348239.json:
```json
{
    "body": "Thank you for annoying sage-on-distros by using `SAGE_ROOT` in the main sage script. SAGE_ROOT outside of the build system is just a pain in the ass. If you have to use a text file to store the version, name it uniquely and ship to /etc, or put it in a folder exclusively belonging to sage.\n\nI guess it is too late at this stage, we'll deal with it later.",
    "created_at": "2018-04-06T22:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348239",
    "user": "https://github.com/kiwifb"
}
```

Thank you for annoying sage-on-distros by using `SAGE_ROOT` in the main sage script. SAGE_ROOT outside of the build system is just a pain in the ass. If you have to use a text file to store the version, name it uniquely and ship to /etc, or put it in a folder exclusively belonging to sage.

I guess it is too late at this stage, we'll deal with it later.



---

archive/issue_comments_348240.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-04-07T18:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348240",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_348241.json:
```json
{
    "body": "Replying to [comment:39 fbissey]:\n> Thank you for annoying sage-on-distros by using `SAGE_ROOT` in the main sage script. SAGE_ROOT outside of the build system is just a pain in the ass. If you have to use a text file to store the version, name it uniquely and ship to /etc, or put it in a folder exclusively belonging to sage.\n> \n> I guess it is too late at this stage, we'll deal with it later.\n\nI don't think the sarcasm is necessary--I see your point but it's not completely obvious, and you had the opportunity here to set it back to \"needs_work\" or something--I wouldn't mind.  Please open a new ticket for this and CC me and set it to \"blocker\".  An easy fix for this would be to ensure \"VERSION.txt\" is installed somewhere sensinble under `$SAGE_LOCAL` (like, *not* `bin/` :) and use it from there if possible.",
    "created_at": "2018-04-09T09:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348241",
    "user": "https://github.com/embray"
}
```

Replying to [comment:39 fbissey]:
> Thank you for annoying sage-on-distros by using `SAGE_ROOT` in the main sage script. SAGE_ROOT outside of the build system is just a pain in the ass. If you have to use a text file to store the version, name it uniquely and ship to /etc, or put it in a folder exclusively belonging to sage.
> 
> I guess it is too late at this stage, we'll deal with it later.

I don't think the sarcasm is necessary--I see your point but it's not completely obvious, and you had the opportunity here to set it back to "needs_work" or something--I wouldn't mind.  Please open a new ticket for this and CC me and set it to "blocker".  An easy fix for this would be to ensure "VERSION.txt" is installed somewhere sensinble under `$SAGE_LOCAL` (like, *not* `bin/` :) and use it from there if possible.



---

archive/issue_comments_348242.json:
```json
{
    "body": "Replying to [comment:41 embray]:\n> Replying to [comment:39 fbissey]:\n> > Thank you for annoying sage-on-distros by using `SAGE_ROOT` in the main sage script. SAGE_ROOT outside of the build system is just a pain in the ass. If you have to use a text file to store the version, name it uniquely and ship to /etc, or put it in a folder exclusively belonging to sage.\n> > \n> > I guess it is too late at this stage, we'll deal with it later.\n> \n> I don't think the sarcasm is necessary--I see your point but it's not completely obvious, and you had the opportunity here to set it back to \"needs_work\" or something--I wouldn't mind.  Please open a new ticket for this and CC me and set it to \"blocker\".  An easy fix for this would be to ensure \"VERSION.txt\" is installed somewhere sensinble under `$SAGE_LOCAL` (like, *not* `bin/` :) and use it from there if possible.\n\nI noticed this ticket because Volker included it on his branch. Rather than sarcasm, that's my exasperation at some stuff that bleeds out. I spent quite a bit of time over the years reducing the use of `SAGE_ROOT`. People just forget. For info I ship `VERSION.txt` as `/etc/sage-version.txt` which seems sensible but may not be the best place. I should ask what the other do.",
    "created_at": "2018-04-09T09:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348242",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:41 embray]:
> Replying to [comment:39 fbissey]:
> > Thank you for annoying sage-on-distros by using `SAGE_ROOT` in the main sage script. SAGE_ROOT outside of the build system is just a pain in the ass. If you have to use a text file to store the version, name it uniquely and ship to /etc, or put it in a folder exclusively belonging to sage.
> > 
> > I guess it is too late at this stage, we'll deal with it later.
> 
> I don't think the sarcasm is necessary--I see your point but it's not completely obvious, and you had the opportunity here to set it back to "needs_work" or something--I wouldn't mind.  Please open a new ticket for this and CC me and set it to "blocker".  An easy fix for this would be to ensure "VERSION.txt" is installed somewhere sensinble under `$SAGE_LOCAL` (like, *not* `bin/` :) and use it from there if possible.

I noticed this ticket because Volker included it on his branch. Rather than sarcasm, that's my exasperation at some stuff that bleeds out. I spent quite a bit of time over the years reducing the use of `SAGE_ROOT`. People just forget. For info I ship `VERSION.txt` as `/etc/sage-version.txt` which seems sensible but may not be the best place. I should ask what the other do.



---

archive/issue_comments_348243.json:
```json
{
    "body": "I know, that's fair. I also want to do with any and all runtime dependency on `$SAGE_ROOT`--it's really annoying.",
    "created_at": "2018-04-09T13:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348243",
    "user": "https://github.com/embray"
}
```

I know, that's fair. I also want to do with any and all runtime dependency on `$SAGE_ROOT`--it's really annoying.



---

archive/issue_comments_348244.json:
```json
{
    "body": "The problem with `VERSION.txt` looks very similar to `COPYING.txt`. So maybe we should deal with both in #21571?",
    "created_at": "2018-04-09T13:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24819#issuecomment-348244",
    "user": "https://github.com/jdemeyer"
}
```

The problem with `VERSION.txt` looks very similar to `COPYING.txt`. So maybe we should deal with both in #21571?
