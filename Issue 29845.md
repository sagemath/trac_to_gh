# Issue 29845: Make ./bootstrap less sensitive to stray files in build/pkgs (affects patchbot operation)

Issue created by migration from https://trac.sagemath.org/ticket/30082

Original creator: mkoeppe

Original creation time: 2020-07-06 20:00:38

CC:  chapoton tmonteil dimpase jhpalmieri vbraun

Some patchbots fail after testing some tickets that leave build/pkgs unclean:

```
./bootstrap -d
make[2]: Entering directory '/home/sagemath/sage-9.1'
rm -rf config configure build/make/Makefile-auto.in
rm -f src/doc/en/installation/*.txt
rm -rf src/doc/en/reference/spkg/*.rst
rm -f src/doc/en/reference/repl/*.txt
make[2]: Leaving directory '/home/sagemath/sage-9.1'
cat: build/pkgs/sage_setup/type: No such file or directory
make[1]: *** [Makefile:208: configure] Error 1
make[1]: Leaving directory '/home/sagemath/sage-9.1'
make: *** [Makefile:32: doc-clean] Error 2
```

(https://patchbot.sagemath.org/log/30074/Linux/1_SMP_Debian_4.19.118-2+deb10u1_(2020-06-07)/x86_64/4.19.0-9-amd64/tmonteil-lxc/2020-07-06%2007:27:05)



---

Comment by mkoeppe created at 2020-07-06 20:10:16

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-07-06 20:10:16

New commits:


---

Comment by jhpalmieri created at 2020-07-07 22:21:47

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2020-07-07 22:21:47

Looks okay to me. If I create an empty directory `build/pkgs/sage_setup`, `bootstrap` fails as in the description. With the branch here, it works.

It does print the warning message four times, which makes me wonder if the loops should be done in the other order: first `for PKG_SCRIPTS in build/pkgs/*`, then `for SYSTEM in arch debian fedora cygwin homebrew`. As it stands, some commands are executed multiple times (the glob in the for loop, and `PKG_BASE=$(basename $PKG_SCRIPTS)` and `PKG_TYPE=$(cat $PKG_SCRIPTS/type)`), but those won't meaningfully affect the running time. With the loops interchanged, then `SYSTEM_PACKAGES=$(echo $(${STRIP_COMMENTS} build/pkgs/$SYSTEM.txt))` would get executed more times instead.


---

Comment by mkoeppe created at 2020-07-08 00:20:23

Thanks! 

I don't think it's worth changing the code so that the warning is printed less often.


---

Comment by vbraun created at 2020-07-10 19:34:32

Resolution: fixed
