# Issue 12888: Valgrind complains about glibc 2.15

archive/issues_012888.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @gvol jpflori @haraldschilly\n\nKeywords: valgrind spkg\n\nValgrind configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).\n\nThe usual solution is to treat this version as the previous one:\nsee commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13060\n\n",
    "created_at": "2012-05-29T10:37:33Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Valgrind complains about glibc 2.15",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12888",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
Assignee: tbd

CC:  @gvol jpflori @haraldschilly

Keywords: valgrind spkg

Valgrind configure script complains about glibc version 2.15 (which is shipped e.g. with Ubuntu 12.04).

The usual solution is to treat this version as the previous one:
see commit r12323 in the valgrind svn, or tickets on different distribution bug tracker.

Issue created by migration from https://trac.sagemath.org/ticket/13060





---

archive/issue_comments_154852.json:
```json
{
    "body": "After applying the diff of the above commit, one has to rebuild the configure scripts with autogen.sh (which is available in the svn, not in the usual tarballs).\nThis basically calls auto* stuff, but the current input *.am files are incompatible with the current automake tool...\nSee r12396 in valgrind svn.",
    "created_at": "2012-05-29T12:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154852",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

After applying the diff of the above commit, one has to rebuild the configure scripts with autogen.sh (which is available in the svn, not in the usual tarballs).
This basically calls auto* stuff, but the current input *.am files are incompatible with the current automake tool...
See r12396 in valgrind svn.



---

archive/issue_comments_154853.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-29T12:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154853",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_154854.json:
```json
{
    "body": "Here comes a slightly updated spkg:\nhttp://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg\n\nI've applied the two mentioned patches and rerun autogen.sh to regenerate the build system files.\nThe package installs and seems functional with my Sage installation.\n\nAnother solution whould be to properly package a recent valgrind svn version, although I'd prefer to use this light solution and wait for a proper stable release to make a real update to valgrind.\nFeel free to disagree and rant here.",
    "created_at": "2012-05-29T12:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154854",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Here comes a slightly updated spkg:
http://perso.telecom-paristech.fr/~flori/sage/valgrind-3.7.0.p0.spkg

I've applied the two mentioned patches and rerun autogen.sh to regenerate the build system files.
The package installs and seems functional with my Sage installation.

Another solution whould be to properly package a recent valgrind svn version, although I'd prefer to use this light solution and wait for a proper stable release to make a real update to valgrind.
Feel free to disagree and rant here.



---

archive/issue_comments_154855.json:
```json
{
    "body": "Attachment [trac_13060-spkg.diff](tarball://root/attachments/some-uuid/ticket13060/trac_13060-spkg.diff) by jpflori created at 2012-05-29 12:38:51\n\nSpkg diff, for review only.",
    "created_at": "2012-05-29T12:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154855",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [trac_13060-spkg.diff](tarball://root/attachments/some-uuid/ticket13060/trac_13060-spkg.diff) by jpflori created at 2012-05-29 12:38:51

Spkg diff, for review only.



---

archive/issue_comments_154856.json:
```json
{
    "body": "There might be something wrong with valgrind testsuite.\nI'm looking into this right now.",
    "created_at": "2012-05-29T12:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154856",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

There might be something wrong with valgrind testsuite.
I'm looking into this right now.



---

archive/issue_comments_154857.json:
```json
{
    "body": "In fact, the current spkg is not functional at all.\n\nIt builds correctly, but fails to pass its test suite and Sage does not launch with the -valgrind flag.",
    "created_at": "2012-05-29T12:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154857",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

In fact, the current spkg is not functional at all.

It builds correctly, but fails to pass its test suite and Sage does not launch with the -valgrind flag.



---

archive/issue_comments_154858.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-29T12:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154858",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_154859.json:
```json
{
    "body": "The startup problem seem to be caused by strlen being inlined and its symbol not found by valgrind which fails to start.",
    "created_at": "2012-05-29T13:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154859",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The startup problem seem to be caused by strlen being inlined and its symbol not found by valgrind which fails to start.



---

archive/issue_comments_154860.json:
```json
{
    "body": "Installing the debug version of libc6 (libc6-dbg) on my Ubuntu installation solves both the startup problem.\nNonetheless, it might be useful to actually print something when valgrind fails for this reason.\nCurrently running \"sage -valgrind\" exits without complaining although tunning directly valgrind from the local/bin folder provides some hints.",
    "created_at": "2012-05-29T14:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154860",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Installing the debug version of libc6 (libc6-dbg) on my Ubuntu installation solves both the startup problem.
Nonetheless, it might be useful to actually print something when valgrind fails for this reason.
Currently running "sage -valgrind" exits without complaining although tunning directly valgrind from the local/bin folder provides some hints.



---

archive/issue_comments_154861.json:
```json
{
    "body": "On a debian installation on top of recent hardware (corei7-avx) I'm able to install the old spkg (debian currently ships eglibc 2.13), but get a SIGILL when launching sage, which comes as no surprise:\nhttps://bugs.kde.org/show_bug.cgi?id=273475\n\nThe latest svn version is enough to let sage starts.\n\n\nOn the same install, the test suite with the old spkg yields\n\n```\n## 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdoutB failure, 3 post failures\n```\nthe one proposed here yields\n\n```\n## 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdo\nutB failure, 3 post failures ==\n```\nwhich was expected.\nWith the latest svn version (you can test it by replace p0 by jp in the above url):\n\n```\n## 545 tests, 4 stderr failures, 0 stdout failures, 0 stderrB failures, 1 stdo\nutB failure, 0 post failures ==\n```\n\n\nOn the ubuntu install mentioned above, with the \n\n```\n## 591 tests, 79 stderr failures, 57 stdout failures, 0 stderrB failures, 0 stdo\nutB failure, 3 post failures ==\n```\nand with the latest svn version\n\n```\n## 534 tests, 4 stderr failures, 1 stdout failures, 0 stderrB failures, 1 stdo\nutB failure, 0 post failures ==\n```\n\nWhatsoever, I'm not sure that the problem of dealing with avx instructions should be dealt with here.\nWe surely should wait for a proper release by the valgrind team, the tested development version is completely arbitrary.\n\nAbout the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.\nI must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.\n\nIf we expect these failures to be fixed, I can definitely not take care of this with my little knowledge of valgrind.",
    "created_at": "2012-05-29T15:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154861",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

On a debian installation on top of recent hardware (corei7-avx) I'm able to install the old spkg (debian currently ships eglibc 2.13), but get a SIGILL when launching sage, which comes as no surprise:
https://bugs.kde.org/show_bug.cgi?id=273475

The latest svn version is enough to let sage starts.


On the same install, the test suite with the old spkg yields

```
## 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdoutB failure, 3 post failures
```
the one proposed here yields

```
## 599 tests, 77 stderr failures, 56 stdout failures, 0 stderrB failures, 1 stdo
utB failure, 3 post failures ==
```
which was expected.
With the latest svn version (you can test it by replace p0 by jp in the above url):

```
## 545 tests, 4 stderr failures, 0 stdout failures, 0 stderrB failures, 1 stdo
utB failure, 0 post failures ==
```


On the ubuntu install mentioned above, with the 

```
## 591 tests, 79 stderr failures, 57 stdout failures, 0 stderrB failures, 0 stdo
utB failure, 3 post failures ==
```
and with the latest svn version

```
## 534 tests, 4 stderr failures, 1 stdout failures, 0 stderrB failures, 1 stdo
utB failure, 0 post failures ==
```

Whatsoever, I'm not sure that the problem of dealing with avx instructions should be dealt with here.
We surely should wait for a proper release by the valgrind team, the tested development version is completely arbitrary.

About the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.
I must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.

If we expect these failures to be fixed, I can definitely not take care of this with my little knowledge of valgrind.



---

archive/issue_comments_154862.json:
```json
{
    "body": "Replying to [comment:7 jpflori]:\n> About the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.\n> I must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.\n\n\nI know I ran the test suite last time at least once, but I think I saw a few failures on my Mac.  Now trying to install it on Sage 5.0 neither will even build.  I should have thought to build it when I was testing the betas.  The old spkg gives \n\n```\n...\nmake  all-recursive\nMaking all in include\nmake[2]: Nothing to be done for `all'.\nMaking all in VEX\nmake  all-am\ngcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -Ipriv   -arch x86_64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wbad-function-cast -Wcast-qual -Wcast-align -fstrict-aliasing -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libvex_amd64_darwin_a-main_globals.o -MD -MP -MF .deps/libvex_amd64_darwin_a-main_globals.Tpo -c -o libvex_amd64_darwin_a-main_globals.o `test -f 'priv/main_globals.c' || echo './'`priv/main_globals.c\ngcc: error: x86_64: No such file or directory\ngcc: error: unrecognized option \u2018-arch\u2019\nmake[3]: *** [libvex_amd64_darwin_a-main_globals.o] Error 1\nmake[2]: *** [all] Error 2\nmake[1]: *** [all-recursive] Error 1\nmake: *** [all] Error 2\nError building Valgrind 3.7.0\n...\n```\n\nSo it looks like the former is a problem with the new gcc package:\n\n```\nsage -sh -c 'which gcc'\n/Users/gvol/SageStuff/sage-5.0.rc0/local/bin/gcc\n```\n\nAnd the spkg for review here gives.\n\n```\n...\nchecking for a sed that does not truncate output... /usr/bin/sed\nchecking for perl... /usr/bin/perl\nchecking for gdb... /usr/bin/gdb\nchecking dependency style of gcc... gcc3\nchecking for diff -u... yes\nchecking for a supported version of gcc... ok (4.6.3)\nconfigure: error: cannot run /bin/sh ./config.sub\nError configuring Valgrind 3.7.0\n...\n```\n\nHere `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  \nThis probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.",
    "created_at": "2012-05-30T06:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154862",
    "user": "https://github.com/gvol"
}
```

Replying to [comment:7 jpflori]:
> About the test suite failure, I'm not convinced it should prevent including the updated p0 spkg proposed here, if they were present before.
> I must admit I do not remember seeing errors when dealing with #7766, but we potentially forgot to run the testsuite all along.


I know I ran the test suite last time at least once, but I think I saw a few failures on my Mac.  Now trying to install it on Sage 5.0 neither will even build.  I should have thought to build it when I was testing the betas.  The old spkg gives 

```
...
make  all-recursive
Making all in include
make[2]: Nothing to be done for `all'.
Making all in VEX
make  all-am
gcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -Ipriv   -arch x86_64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wbad-function-cast -Wcast-qual -Wcast-align -fstrict-aliasing -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libvex_amd64_darwin_a-main_globals.o -MD -MP -MF .deps/libvex_amd64_darwin_a-main_globals.Tpo -c -o libvex_amd64_darwin_a-main_globals.o `test -f 'priv/main_globals.c' || echo './'`priv/main_globals.c
gcc: error: x86_64: No such file or directory
gcc: error: unrecognized option ‘-arch’
make[3]: *** [libvex_amd64_darwin_a-main_globals.o] Error 1
make[2]: *** [all] Error 2
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
Error building Valgrind 3.7.0
...
```

So it looks like the former is a problem with the new gcc package:

```
sage -sh -c 'which gcc'
/Users/gvol/SageStuff/sage-5.0.rc0/local/bin/gcc
```

And the spkg for review here gives.

```
...
checking for a sed that does not truncate output... /usr/bin/sed
checking for perl... /usr/bin/perl
checking for gdb... /usr/bin/gdb
checking dependency style of gcc... gcc3
checking for diff -u... yes
checking for a supported version of gcc... ok (4.6.3)
configure: error: cannot run /bin/sh ./config.sub
Error configuring Valgrind 3.7.0
...
```

Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  
This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.



---

archive/issue_comments_154863.json:
```json
{
    "body": "Replying to [comment:8 iandrus]:\n> Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  \n> This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  \n\n\nOh, I didn't realize that...\nI've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.\n\nI'll look into the arch stuff but have no apple stuff to test it.",
    "created_at": "2012-05-30T06:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154863",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:8 iandrus]:
> Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  
> This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  


Oh, I didn't realize that...
I've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.

I'll look into the arch stuff but have no apple stuff to test it.



---

archive/issue_comments_154864.json:
```json
{
    "body": "Just a reminder for myself: indeed the apple gcc supports -arch, but the fsf one does not.",
    "created_at": "2012-05-30T07:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154864",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Just a reminder for myself: indeed the apple gcc supports -arch, but the fsf one does not.



---

archive/issue_comments_154865.json:
```json
{
    "body": "Replying to [comment:9 jpflori]:\n> Replying to [comment:8 iandrus]:\n> > Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  \n> > This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  \n\n> \n> Oh, I didn't realize that...\n> I've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.\n\n\nCool, thanks.  I just tried it (in the same place) and got the same error though.  Perhaps, it's in a different place?\n\n> I'll look into the arch stuff but have no apple stuff to test it.\n\n\nI think if you can force sage to use the gcc spkg it would exhibit the same problem, unless you are already using it.  What does `sage -sh -c 'which gcc'` return?\n\nIt might be worth asking Jeroen (or on sage-devel) since he knows it a lot better.",
    "created_at": "2012-05-30T07:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154865",
    "user": "https://github.com/gvol"
}
```

Replying to [comment:9 jpflori]:
> Replying to [comment:8 iandrus]:
> > Here `config.sub` is a symlink to `/usr/share/automake-1.11/config.sub`.  
> > This probably has something to do with you running `./autogen.sh`, but I'm not an expert in how to fix that.  If I run `./autgen.sh` myself then it configures fine but runs into the `-arch` problem as before.  

> 
> Oh, I didn't realize that...
> I've uploaded a new spkg obtained with autoreconf -fi rather than autogen.sh which has no symlinks.


Cool, thanks.  I just tried it (in the same place) and got the same error though.  Perhaps, it's in a different place?

> I'll look into the arch stuff but have no apple stuff to test it.


I think if you can force sage to use the gcc spkg it would exhibit the same problem, unless you are already using it.  What does `sage -sh -c 'which gcc'` return?

It might be worth asking Jeroen (or on sage-devel) since he knows it a lot better.



---

archive/issue_comments_154866.json:
```json
{
    "body": "The spkg is up now, I was a little slow to upload it.\n\nAbout the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.\nThat's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.",
    "created_at": "2012-05-30T08:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154866",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The spkg is up now, I was a little slow to upload it.

About the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.
That's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.



---

archive/issue_comments_154867.json:
```json
{
    "body": "Oh and valgrind.org seems down, so I don't have access to their svn anymore to see if anythig was commited about this gcc thingy lately.\n\nWe should maybe look into what Fink does:\nhttp://osdir.com/ml/fink-users-osx-unix/2011-11/msg00168.html\nalthough once more I'm no Apple user so don't have access or am used to such things.",
    "created_at": "2012-05-30T08:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154867",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Oh and valgrind.org seems down, so I don't have access to their svn anymore to see if anythig was commited about this gcc thingy lately.

We should maybe look into what Fink does:
http://osdir.com/ml/fink-users-osx-unix/2011-11/msg00168.html
although once more I'm no Apple user so don't have access or am used to such things.



---

archive/issue_comments_154868.json:
```json
{
    "body": "Replying to [comment:12 jpflori]:\n> The spkg is up now, I was a little slow to upload it.\n\n\nNo problem.  It works now\u2014except for actually building.  :-)\n\n> About the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.\n> That's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.\n\n\nAh, now I see it.  I guess we'll have to patch that, or ask them to do it upstream.  \n\nFink simply disabled mpicc http://fink.cvs.sourceforge.net/fink/dists/10.7/stable/main/finkinfo/devel/valgrind.info?view=markup which was the FSF compiler rather than gcc.",
    "created_at": "2012-05-30T08:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154868",
    "user": "https://github.com/gvol"
}
```

Replying to [comment:12 jpflori]:
> The spkg is up now, I was a little slow to upload it.


No problem.  It works now—except for actually building.  :-)

> About the gcc -arch problem, I think the problem is with Valgrind configure script which adds this flag as soon as it detects that its run on OSX because it assumes that someone on OSX will be using an Apple gcc.
> That's the reason why I get no problem on Linux with the FSF gcc, the Ubuntu one or the Sage one.


Ah, now I see it.  I guess we'll have to patch that, or ask them to do it upstream.  

Fink simply disabled mpicc http://fink.cvs.sourceforge.net/fink/dists/10.7/stable/main/finkinfo/devel/valgrind.info?view=markup which was the FSF compiler rather than gcc.



---

archive/issue_comments_154869.json:
```json
{
    "body": "Valgrind website is back up.\nAfter a quick search trhough the svn log and the bug tracker, I found nothing related to the -arch flag.\nI guess we have to report upstream and/or provide a patch to the configure/build system.",
    "created_at": "2012-05-30T09:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154869",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Valgrind website is back up.
After a quick search trhough the svn log and the bug tracker, I found nothing related to the -arch flag.
I guess we have to report upstream and/or provide a patch to the configure/build system.



---

archive/issue_comments_154870.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-31T07:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154870",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_154871.json:
```json
{
    "body": "I've included some autotools magic to test if the -arch i386/x86_64 flag is supported and fall back to the -m32/64.\nCould you test the updated spkg at the same address as usual (at least the spkg still build on my linux)?\n\nI've put the diffs into the patches directory (although they are already applied because we have to run autoreconf) and will upload them here for review purpose.",
    "created_at": "2012-05-31T07:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154871",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I've included some autotools magic to test if the -arch i386/x86_64 flag is supported and fall back to the -m32/64.
Could you test the updated spkg at the same address as usual (at least the spkg still build on my linux)?

I've put the diffs into the patches directory (although they are already applied because we have to run autoreconf) and will upload them here for review purpose.



---

archive/issue_comments_154872.json:
```json
{
    "body": "Diff for upstream svn commit r12323; accept glibc 2.15.",
    "created_at": "2012-05-31T08:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154872",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Diff for upstream svn commit r12323; accept glibc 2.15.



---

archive/issue_comments_154873.json:
```json
{
    "body": "Attachment [automake-1.11.2.diff](tarball://root/attachments/some-uuid/ticket13060/automake-1.11.2.diff) by jpflori created at 2012-05-31 08:02:53\n\nDiff for upstream svn commit r12396; accept automake 1.11.2 and later.",
    "created_at": "2012-05-31T08:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154873",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [automake-1.11.2.diff](tarball://root/attachments/some-uuid/ticket13060/automake-1.11.2.diff) by jpflori created at 2012-05-31 08:02:53

Diff for upstream svn commit r12396; accept automake 1.11.2 and later.



---

archive/issue_comments_154874.json:
```json
{
    "body": "Attachment [arch_flag-configure.in.diff](tarball://root/attachments/some-uuid/ticket13060/arch_flag-configure.in.diff) by jpflori created at 2012-05-31 08:03:34\n\nDiff for configure.in; test -arch flag.",
    "created_at": "2012-05-31T08:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154874",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [arch_flag-configure.in.diff](tarball://root/attachments/some-uuid/ticket13060/arch_flag-configure.in.diff) by jpflori created at 2012-05-31 08:03:34

Diff for configure.in; test -arch flag.



---

archive/issue_comments_154875.json:
```json
{
    "body": "Attachment [arch_flag-Makefile.all.am.diff](tarball://root/attachments/some-uuid/ticket13060/arch_flag-Makefile.all.am.diff) by jpflori created at 2012-05-31 08:03:59\n\nDiff for Makefile.all.am; test for -arch flag.",
    "created_at": "2012-05-31T08:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154875",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [arch_flag-Makefile.all.am.diff](tarball://root/attachments/some-uuid/ticket13060/arch_flag-Makefile.all.am.diff) by jpflori created at 2012-05-31 08:03:59

Diff for Makefile.all.am; test for -arch flag.



---

archive/issue_comments_154876.json:
```json
{
    "body": "By the way, I'm aware that the changes to the spkg files are not commited yet.",
    "created_at": "2012-05-31T09:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154876",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

By the way, I'm aware that the changes to the spkg files are not commited yet.



---

archive/issue_comments_154877.json:
```json
{
    "body": "I hate to be the bearer of bad news, but now it fails because `__private_extern__` being used.\n\n```\n...\nMaking all in coregrind\nmake  all-am\ngcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -I../coregrind -DVG_LIBDIR=\"\\\"/Users/gvol/SageStuff/sage-5.0.rc0/local/lib/valgrind\"\\\" -DVG_PLATFORM=\"\\\"amd64-darwin\\\"\"   -m64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libcoregrind_amd64_darwin_a-m_syscall.o -MD -MP -MF .deps/libcoregrind_amd64_darwin_a-m_syscall.Tpo -c -o libcoregrind_amd64_darwin_a-m_syscall.o `test -f 'm_syscall.c' || echo './'`m_syscall.c\nm_syscall.c:504:1: error: unknown type name \u2018__private_extern__\u2019\nm_syscall.c:505:1: error: expected \u2018=\u2019, \u2018,\u2019, \u2018;\u2019, \u2018asm\u2019 or \u2018__attribute__\u2019 before \u2018do_syscall_unix_WRK\u2019\nm_syscall.c:528:1: error: unknown type name \u2018__private_extern__\u2019\nm_syscall.c:529:1: error: expected \u2018=\u2019, \u2018,\u2019, \u2018;\u2019, \u2018asm\u2019 or \u2018__attribute__\u2019 before \u2018do_syscall_mach_WRK\u2019\nm_syscall.c: In function \u2018vgPlain_do_syscall\u2019:\nm_syscall.c:648:10: warning: implicit declaration of function \u2018do_syscall_unix_WRK\u2019 [-Wimplicit-function-declaration]\nm_syscall.c:653:10: warning: implicit declaration of function \u2018do_syscall_mach_WRK\u2019 [-Wimplicit-function-declaration]\nmake[3]: *** [libcoregrind_amd64_darwin_a-m_syscall.o] Error 1\nmake[2]: *** [all] Error 2\nmake[1]: *** [all-recursive] Error 1\nmake: *** [all] Error 2\n```\n\nSome information about this can be found [on Apple's website](https://developer.apple.com/library/mac/#documentation/developertools/Conceptual/CppRuntimeEnv/Articles/SymbolVisibility.html).  I think it's a darwin specific feature, but I couldn't find confirmation of that.  A quick check shows they only appear within one of the `ifdef`'s below\n\n```\n#elif defined(VGP_x86_darwin)\n#elif defined(VGP_amd64_darwin)\n#elif defined(VGO_darwin)\n```\nother branches seem to just use `extern`, but I readily admit to not taking the time to figure out what difference it would make.",
    "created_at": "2012-05-31T14:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154877",
    "user": "https://github.com/gvol"
}
```

I hate to be the bearer of bad news, but now it fails because `__private_extern__` being used.

```
...
Making all in coregrind
make  all-am
gcc -DHAVE_CONFIG_H -I. -I..  -I.. -I../include -I../VEX/pub -DVGA_amd64=1 -DVGO_darwin=1 -DVGP_amd64_darwin=1 -DVGPV_amd64_darwin_vanilla=1 -I../coregrind -DVG_LIBDIR="\"/Users/gvol/SageStuff/sage-5.0.rc0/local/lib/valgrind"\" -DVG_PLATFORM="\"amd64-darwin\""   -m64 -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wno-format-zero-length -fno-strict-aliasing -fno-builtin -mmacosx-version-min=10.5 -fno-stack-protector -Wno-long-long  -Wno-pointer-sign -fno-stack-protector -MT libcoregrind_amd64_darwin_a-m_syscall.o -MD -MP -MF .deps/libcoregrind_amd64_darwin_a-m_syscall.Tpo -c -o libcoregrind_amd64_darwin_a-m_syscall.o `test -f 'm_syscall.c' || echo './'`m_syscall.c
m_syscall.c:504:1: error: unknown type name ‘__private_extern__’
m_syscall.c:505:1: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘do_syscall_unix_WRK’
m_syscall.c:528:1: error: unknown type name ‘__private_extern__’
m_syscall.c:529:1: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘do_syscall_mach_WRK’
m_syscall.c: In function ‘vgPlain_do_syscall’:
m_syscall.c:648:10: warning: implicit declaration of function ‘do_syscall_unix_WRK’ [-Wimplicit-function-declaration]
m_syscall.c:653:10: warning: implicit declaration of function ‘do_syscall_mach_WRK’ [-Wimplicit-function-declaration]
make[3]: *** [libcoregrind_amd64_darwin_a-m_syscall.o] Error 1
make[2]: *** [all] Error 2
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
```

Some information about this can be found [on Apple's website](https://developer.apple.com/library/mac/#documentation/developertools/Conceptual/CppRuntimeEnv/Articles/SymbolVisibility.html).  I think it's a darwin specific feature, but I couldn't find confirmation of that.  A quick check shows they only appear within one of the `ifdef`'s below

```
#elif defined(VGP_x86_darwin)
#elif defined(VGP_amd64_darwin)
#elif defined(VGO_darwin)
```
other branches seem to just use `extern`, but I readily admit to not taking the time to figure out what difference it would make.



---

archive/issue_comments_154878.json:
```json
{
    "body": "Valgrind 3.8.0 was released recently.  I haven't tried it to see if it fixes any build problems, but I can take the time to test a new spkg.",
    "created_at": "2012-08-22T16:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154878",
    "user": "https://github.com/gvol"
}
```

Valgrind 3.8.0 was released recently.  I haven't tried it to see if it fixes any build problems, but I can take the time to test a new spkg.



---

archive/issue_comments_154879.json:
```json
{
    "body": "New spkg including 3.8.1 at\nhttp://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg\n\nUpstream claim to support OSX from 10.6.X onward (10.8.x being currently limited).\nWe used to claim from 10.5.x onward.\nCould some Apple user check that?\n\nNot sure if you can now build it with FSF GCC (such as the one shipped by Sage's spkg.\nCould someone test that as well?\n\nAt least this spkg runs correctly on recent Linuxes with GLIBC 2.15 and supports AVX instructions.",
    "created_at": "2012-12-24T21:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154879",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

New spkg including 3.8.1 at
http://boxen.math.washington.edu/home/jpflori/valgrind-3.8.1.spkg

Upstream claim to support OSX from 10.6.X onward (10.8.x being currently limited).
We used to claim from 10.5.x onward.
Could some Apple user check that?

Not sure if you can now build it with FSF GCC (such as the one shipped by Sage's spkg.
Could someone test that as well?

At least this spkg runs correctly on recent Linuxes with GLIBC 2.15 and supports AVX instructions.



---

archive/issue_comments_154880.json:
```json
{
    "body": "Attachment [valgrind-3.8.1.diff](tarball://root/attachments/some-uuid/ticket13060/valgrind-3.8.1.diff) by jpflori created at 2012-12-24 21:11:04\n\nspkg diff, for review only",
    "created_at": "2012-12-24T21:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154880",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [valgrind-3.8.1.diff](tarball://root/attachments/some-uuid/ticket13060/valgrind-3.8.1.diff) by jpflori created at 2012-12-24 21:11:04

spkg diff, for review only



---

archive/issue_comments_154881.json:
```json
{
    "body": "It looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the \"impossible\" happens and it doesn't work:\n\n```\n==415== Memcheck, a memory error detector\n==415== Copyright (C) 2002-2012, and GNU GPL'd, by Julian Seward et al.\n==415== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info\n==415== Command: python -i\n==415== Parent PID: 414\n==415== \n--415-- /Users/gvol/SageStuff/sage-5.4.rc2/local/bin/python:\n--415-- dSYM directory is missing; consider using --dsymutil=yes\neq_SyscallStatus:\n  {78 0 43}\n  {78 0 40}\n\nvalgrind: m_syswrap/syswrap-main.c:380 (eq_SyscallStatus): the 'impossible' happened.\n==415==    at 0x138032720: ???\n==415==    by 0x138032A03: ???\n==415==    by 0x13809A395: ???\n==415==    by 0x13809B5FF: ???\n==415==    by 0x138098D8A: ???\n==415==    by 0x1380B9F21: ???\n\nsched status:\n  running_tid=1\n\nThread 1: status = VgTs_Runnable\n==415==    at 0x7FFF5FC242DA: _kernelrpc_mach_vm_allocate_trap (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC2497C: vm_allocate (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC13BF3: ImageLoaderMachO::reserveAnAddressRange(unsigned long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC13A54: ImageLoaderMachO::assignSegmentAddresses(ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC13C58: ImageLoaderMachO::mapSegments(int, unsigned long long, unsigned long long, unsigned long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC17104: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC10F5A: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC03557: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC08BAE: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0860D: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC084F9: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC07C30: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0319A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC02F07: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0598E: dyld::_main(macho_header const*, unsigned long, int, char const**, char const**, char const**, unsigned long*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC01396: dyldbootstrap::start(macho_header const*, int, char const**, long, macho_header const*, unsigned long*) (in /usr/lib/dyld)\n==415==    by 0x7FFF5FC0105D: _dyld_start (in /usr/lib/dyld)\n==415==    by 0x1: ???\n==415==    by 0x7FFF5FBFEBBA: ???\n==415==    by 0x7FFF5FBFEBC1: ???\n\n\nNote: see also the FAQ in the source distribution.\nIt contains workarounds to several common problems.\nIn particular, if Valgrind aborted or crashed after\nidentifying problems in your program, there's a good chance\nthat fixing those problems will prevent Valgrind aborting or\ncrashing, especially if it happened in m_mallocfree.c.\n\nIf that doesn't help, please report this bug to: www.valgrind.org\n\nIn the bug report, send all the above text, the valgrind\nversion, and what OS and version you are using.  Thanks.\n```\n\nFor the record, the exact way that I made the \"fixes\" was to add \n\n```\nperl -pi.bak -e 's/[-]arch x86_64/\\@FLAG_M64@/;' -e 's/[-]arch i386/\\@FLAG_M32@/' configure.in Makefile.all.am\n./autogen.sh\nexport CFLAGS=\"$CFLAGS -D__private_extern__=extern\"\n```\nto `spkg-install` just before calling configure.  I don't suggest this method of \"fixing\" it.\n\nPerhaps we should ask the maintainers of valgrind the best way to proceed.",
    "created_at": "2012-12-27T20:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154881",
    "user": "https://github.com/gvol"
}
```

It looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the "impossible" happens and it doesn't work:

```
==415== Memcheck, a memory error detector
==415== Copyright (C) 2002-2012, and GNU GPL'd, by Julian Seward et al.
==415== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info
==415== Command: python -i
==415== Parent PID: 414
==415== 
--415-- /Users/gvol/SageStuff/sage-5.4.rc2/local/bin/python:
--415-- dSYM directory is missing; consider using --dsymutil=yes
eq_SyscallStatus:
  {78 0 43}
  {78 0 40}

valgrind: m_syswrap/syswrap-main.c:380 (eq_SyscallStatus): the 'impossible' happened.
==415==    at 0x138032720: ???
==415==    by 0x138032A03: ???
==415==    by 0x13809A395: ???
==415==    by 0x13809B5FF: ???
==415==    by 0x138098D8A: ???
==415==    by 0x1380B9F21: ???

sched status:
  running_tid=1

Thread 1: status = VgTs_Runnable
==415==    at 0x7FFF5FC242DA: _kernelrpc_mach_vm_allocate_trap (in /usr/lib/dyld)
==415==    by 0x7FFF5FC2497C: vm_allocate (in /usr/lib/dyld)
==415==    by 0x7FFF5FC13BF3: ImageLoaderMachO::reserveAnAddressRange(unsigned long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC13A54: ImageLoaderMachO::assignSegmentAddresses(ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC13C58: ImageLoaderMachO::mapSegments(int, unsigned long long, unsigned long long, unsigned long long, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC17104: ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC10F5A: ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC03557: dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC08BAE: dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0860D: dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC084F9: dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC07C30: dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0319A: dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC02F07: dyld::load(char const*, dyld::LoadContext const&) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0598E: dyld::_main(macho_header const*, unsigned long, int, char const**, char const**, char const**, unsigned long*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC01396: dyldbootstrap::start(macho_header const*, int, char const**, long, macho_header const*, unsigned long*) (in /usr/lib/dyld)
==415==    by 0x7FFF5FC0105D: _dyld_start (in /usr/lib/dyld)
==415==    by 0x1: ???
==415==    by 0x7FFF5FBFEBBA: ???
==415==    by 0x7FFF5FBFEBC1: ???


Note: see also the FAQ in the source distribution.
It contains workarounds to several common problems.
In particular, if Valgrind aborted or crashed after
identifying problems in your program, there's a good chance
that fixing those problems will prevent Valgrind aborting or
crashing, especially if it happened in m_mallocfree.c.

If that doesn't help, please report this bug to: www.valgrind.org

In the bug report, send all the above text, the valgrind
version, and what OS and version you are using.  Thanks.
```

For the record, the exact way that I made the "fixes" was to add 

```
perl -pi.bak -e 's/[-]arch x86_64/\@FLAG_M64@/;' -e 's/[-]arch i386/\@FLAG_M32@/' configure.in Makefile.all.am
./autogen.sh
export CFLAGS="$CFLAGS -D__private_extern__=extern"
```
to `spkg-install` just before calling configure.  I don't suggest this method of "fixing" it.

Perhaps we should ask the maintainers of valgrind the best way to proceed.



---

archive/issue_comments_154882.json:
```json
{
    "body": "Replying to [comment:22 iandrus]:\n> It looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the \"impossible\" happens and it doesn't work:\n\nYup I did not include the patch we wrote before because it seemed too much of a hassle and did not lead to a successful build of Valgrind.\nSorry about that but I did not have much time to spend on this one.\n> For the record, the exact way that I made the \"fixes\" was to add \n> \n> ```\n> perl -pi.bak -e 's/[-]arch x86_64/\\@FLAG_M64@/;' -e 's/[-]arch i386/\\@FLAG_M32@/' configure.in Makefile.all.am\n> ./autogen.sh\n> export CFLAGS=\"$CFLAGS -D__private_extern__=extern\"\n> ```\n> to `spkg-install` just before calling configure.  I don't suggest this method of \"fixing\" it.\n> \n> Perhaps we should ask the maintainers of valgrind the best way to proceed.\n\nI think the best way to proceed is unfortunately to use Apple's GCC.\nValgrind build system seems completely thought for it...\nThat would mean an additional check in spkg-install and would be much easier than fixing upstream build system to work with an FSF GCC.",
    "created_at": "2012-12-31T14:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154882",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:22 iandrus]:
> It looks like the diffs checking for `-arch` support are not included in the new spkg.  I'm running OS X 10.8.2 and it doesn't build without them.  If I apply those changes manually, then it chokes on `__private_extern__`.  Changing those to `extern`, it builds.  However, the "impossible" happens and it doesn't work:

Yup I did not include the patch we wrote before because it seemed too much of a hassle and did not lead to a successful build of Valgrind.
Sorry about that but I did not have much time to spend on this one.
> For the record, the exact way that I made the "fixes" was to add 
> 
> ```
> perl -pi.bak -e 's/[-]arch x86_64/\@FLAG_M64@/;' -e 's/[-]arch i386/\@FLAG_M32@/' configure.in Makefile.all.am
> ./autogen.sh
> export CFLAGS="$CFLAGS -D__private_extern__=extern"
> ```
> to `spkg-install` just before calling configure.  I don't suggest this method of "fixing" it.
> 
> Perhaps we should ask the maintainers of valgrind the best way to proceed.

I think the best way to proceed is unfortunately to use Apple's GCC.
Valgrind build system seems completely thought for it...
That would mean an additional check in spkg-install and would be much easier than fixing upstream build system to work with an FSF GCC.



---

archive/issue_comments_154883.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-02-06T10:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154883",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_035835.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12888#event-35835"
}
```



---

archive/issue_comments_154884.json:
```json
{
    "body": "On Fedora 19, I get:\n\n```\nchecking the GLIBC_VERSION version... unsupported version 2.17\nconfigure: error: Valgrind requires glibc version 2.2 - 2.16\n```",
    "created_at": "2013-10-07T14:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154884",
    "user": "https://github.com/vbraun"
}
```

On Fedora 19, I get:

```
checking the GLIBC_VERSION version... unsupported version 2.17
configure: error: Valgrind requires glibc version 2.2 - 2.16
```



---

archive/issue_comments_154885.json:
```json
{
    "body": "I'd say extend the treatment of GLIBC 2.15 in [attachment:glibc-2.15.diff] (i.e. treat it as 2.14) to GLIBC 2.16 and 2.17.\nA quick google search seems to show it is enough and has been adopted by various distribs.\nBut We should surely have a look at valgrind svn first to see if GLIBC > 2.15 needs more specific treatment...",
    "created_at": "2013-10-07T14:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154885",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I'd say extend the treatment of GLIBC 2.15 in [attachment:glibc-2.15.diff] (i.e. treat it as 2.14) to GLIBC 2.16 and 2.17.
A quick google search seems to show it is enough and has been adopted by various distribs.
But We should surely have a look at valgrind svn first to see if GLIBC > 2.15 needs more specific treatment...



---

archive/issue_comments_154886.json:
```json
{
    "body": "There is even 2.18 now.",
    "created_at": "2013-10-07T14:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154886",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

There is even 2.18 now.



---

archive/issue_comments_154887.json:
```json
{
    "body": "Do you want to update it? I would be fine with the current spkg, too. Its better than what we have and users of cutting-edge distros probably don't need help to install the distro valgrind.",
    "created_at": "2013-10-07T14:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154887",
    "user": "https://github.com/vbraun"
}
```

Do you want to update it? I would be fine with the current spkg, too. Its better than what we have and users of cutting-edge distros probably don't need help to install the distro valgrind.



---

archive/issue_comments_154888.json:
```json
{
    "body": "Sure, I'll try to produce the trivial patch tonight.\n\nNote we should surely take care of #14097 as well if wa want this spkg to be useful.",
    "created_at": "2013-10-07T14:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154888",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Sure, I'll try to produce the trivial patch tonight.

Note we should surely take care of #14097 as well if wa want this spkg to be useful.



---

archive/issue_comments_154889.json:
```json
{
    "body": "I just checked Valgrind svn and the fix from [attachment:glibc-2.15.diff] is also used for 2.16-18 so providing a fixed spkg will be easy.\nIn fact, it seems glibc 2.>=12 get the exact same treatment, and the only difference with glibc 2.>=3/<=11 lies in coregrind/m_redir.c (and is indeed needed).",
    "created_at": "2013-10-07T15:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154889",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I just checked Valgrind svn and the fix from [attachment:glibc-2.15.diff] is also used for 2.16-18 so providing a fixed spkg will be easy.
In fact, it seems glibc 2.>=12 get the exact same treatment, and the only difference with glibc 2.>=3/<=11 lies in coregrind/m_redir.c (and is indeed needed).



---

archive/issue_comments_154890.json:
```json
{
    "body": "References of the valgrind commits: r12743, r13228, r13504.",
    "created_at": "2013-10-07T15:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154890",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

References of the valgrind commits: r12743, r13228, r13504.



---

archive/issue_comments_154891.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2013-10-07T21:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154891",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Spkg diff, for review only.



---

archive/issue_comments_154892.json:
```json
{
    "body": "Attachment [valgrind-3.8.1.p0.diff](tarball://root/attachments/some-uuid/ticket13060/valgrind-3.8.1.p0.diff) by jpflori created at 2013-10-07 21:10:24\n\nIf we really want to be able to use Valgrind on OS X when Sage built its own GCC, let's do that on another ticket.",
    "created_at": "2013-10-07T21:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154892",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [valgrind-3.8.1.p0.diff](tarball://root/attachments/some-uuid/ticket13060/valgrind-3.8.1.p0.diff) by jpflori created at 2013-10-07 21:10:24

If we really want to be able to use Valgrind on OS X when Sage built its own GCC, let's do that on another ticket.



---

archive/issue_comments_154893.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-07T21:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154893",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_154894.json:
```json
{
    "body": "Looks good to me, thanks!\n\nHarald: please update on the mirrors",
    "created_at": "2013-10-07T22:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154894",
    "user": "https://github.com/vbraun"
}
```

Looks good to me, thanks!

Harald: please update on the mirrors



---

archive/issue_comments_154895.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-07T22:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154895",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_154896.json:
```json
{
    "body": "done, file is on the server",
    "created_at": "2013-10-08T10:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154896",
    "user": "https://github.com/haraldschilly"
}
```

done, file is on the server



---

archive/issue_comments_154897.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-09T06:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12888#issuecomment-154897",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_035836.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-09T06:51:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12888",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12888#event-35836"
}
```
