# Issue 12441: Add option "-c" to sage-spkg to run the test-suite

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2012-02-29 21:39:51

Assignee: GeorgSWeber

CC:  jdemeyer

With the attached patches, running `sage -i -c <pkg>` or `sage -i --check <pkg>` will install the package and then run its test suite, regardless of the setting of `SAGE_CHECK` or `SAGE_CHECK_PACKAGES`.


---

Comment by jhpalmieri created at 2012-02-29 21:42:19

Changing status from new to needs_review.


---

Attachment

Sage library


---

Comment by kcrisman created at 2012-02-29 22:04:27

Will this also work with `sage -f -c <pkg>`?  I assume so, just "check"ing.


---

Comment by kcrisman created at 2012-02-29 22:05:24

Never mind, I should have read the patches first!


---

Comment by kcrisman created at 2012-02-29 22:09:18

The doc seems correct and appropriately formatted (I hadn't seen `:envvar:` before, but it's already in the file and I like it!).  The only thing I would say needs real review is that it applies and that "override the settings of SAGE_CHECK and SAGE_CHECK_PACKAGES" works as advertised.


---

Comment by jdemeyer created at 2012-03-01 11:24:40


```
unset SAGE_CHECK_PACKAGES
```

wouldn't work since it would make SAGE_CHECK_PACKAGES equal to !python.  So better set

```
SAGE_CHECK_PACKAGES=x
```

or something.

Also, it conflicts with #12602.


---

Comment by jdemeyer created at 2012-03-01 11:24:40

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2012-03-01 17:38:28

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2012-03-01 17:38:28

Replying to [comment:5 jdemeyer]:
> ` unset SAGE_CHECK_PACKAGES` wouldn't work since it would make SAGE_CHECK_PACKAGES equal to !python.

Good point. Fixed.

> Also, it conflicts with #12602.

Well, I didn't list #12602 as a prerequisite ;)   I'm attaching two versions of the patch, one which depends on #12602, and one which doesn't.  (I don't know if I'll be able to review #12602 any time soon, by the way.)


---

Attachment


---

Comment by jdemeyer created at 2012-04-02 09:14:15

John, I added two reviewer patches.  If you're happy with my patches, you can set positive review.


---

Comment by jhpalmieri created at 2012-04-02 22:28:18

Do you think it's clear enough that you can add the options `-s` or `-c` to `sage -f ...`? How about this change instead (modeled after the usage for `sage -t`):

```diff
diff --git a/spkg/bin/sage b/spkg/bin/sage
--- a/spkg/bin/sage
+++ b/spkg/bin/sage
`@``@` -113,12 +113,17 `@``@` usage_advanced() {
     ####  |.....................--.|...................................................|
     echo "Installing packages and upgrading:"
     echo "  -experimental       -- list all experimental packages that can be installed"
-    echo "  -f [packages]       -- force build of the given Sage package (even if it is"
-    echo "                         already installed)"
-    echo "  -f -s [packages]    -- like -f but do not delete the spkg/build directories"
-    echo "  -i [packages]       -- install the given Sage packages"
-    echo "                         if no packages given, print a list of all installed"
-    echo "  -i -s [packages]    -- like -i but do not delete the spkg/build directories"
+    echo "  -f [packages]       -- shortcut for -i -f: force build of the given Sage"
+    echo "                         packages."
+    echo "  -i [options] [packages]"
+    echo "                      -- install the given Sage packages (unless they are"
+    echo "                         already installed); if no packages are given, print"
+    echo "                         a list of all installed packages. Options:"
+    echo "                           -c -- run the packages' test suites"
+    echo "                           -f -- force build: install the packages even"
+    echo "                                 if they are already installed"
+    echo "                           -s -- do not delete the spkg/build directories"
+    echo "                                 after a successful build"
     echo "  -optional           -- list all optional packages that can be installed"
     echo "  -standard           -- list all standard packages that can be installed"
    #echo "  -update             -- download latest non-optional Sage packages (do not build them)"
```

I can provide a patch for this and a similar one for the reference manual if you want me to.


---

Attachment


---

Attachment


---

Comment by jdemeyer created at 2012-04-07 09:25:27

I did those changes, needs_review.


---

Comment by jhpalmieri created at 2012-04-07 15:55:50

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-04-07 15:55:50

Great, looks good.


---

Comment by jdemeyer created at 2012-04-08 09:28:42

Resolution: fixed
