# Issue 12441: Add option "-c" to sage-spkg to run the test-suite

archive/issues_012441.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  jdemeyer\n\nWith the attached patches, running `sage -i -c <pkg>` or `sage -i --check <pkg>` will install the package and then run its test suite, regardless of the setting of `SAGE_CHECK` or `SAGE_CHECK_PACKAGES`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12613\n\n",
    "created_at": "2012-02-29T21:39:51Z",
    "labels": [
        "build",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Add option \"-c\" to sage-spkg to run the test-suite",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12441",
    "user": "jhpalmieri"
}
```
Assignee: GeorgSWeber

CC:  jdemeyer

With the attached patches, running `sage -i -c <pkg>` or `sage -i --check <pkg>` will install the package and then run its test suite, regardless of the setting of `SAGE_CHECK` or `SAGE_CHECK_PACKAGES`.

Issue created by migration from https://trac.sagemath.org/ticket/12613





---

archive/issue_comments_147010.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-29T21:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147010",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_147011.json:
```json
{
    "body": "Attachment [trac_12613-doc.patch](tarball://root/attachments/some-uuid/ticket12613/trac_12613-doc.patch) by jhpalmieri created at 2012-02-29 21:46:15\n\nSage library",
    "created_at": "2012-02-29T21:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147011",
    "user": "jhpalmieri"
}
```

Attachment [trac_12613-doc.patch](tarball://root/attachments/some-uuid/ticket12613/trac_12613-doc.patch) by jhpalmieri created at 2012-02-29 21:46:15

Sage library



---

archive/issue_comments_147012.json:
```json
{
    "body": "Will this also work with `sage -f -c <pkg>`?  I assume so, just \"check\"ing.",
    "created_at": "2012-02-29T22:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147012",
    "user": "kcrisman"
}
```

Will this also work with `sage -f -c <pkg>`?  I assume so, just "check"ing.



---

archive/issue_comments_147013.json:
```json
{
    "body": "Never mind, I should have read the patches first!",
    "created_at": "2012-02-29T22:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147013",
    "user": "kcrisman"
}
```

Never mind, I should have read the patches first!



---

archive/issue_comments_147014.json:
```json
{
    "body": "The doc seems correct and appropriately formatted (I hadn't seen `:envvar:` before, but it's already in the file and I like it!).  The only thing I would say needs real review is that it applies and that \"override the settings of SAGE_CHECK and SAGE_CHECK_PACKAGES\" works as advertised.",
    "created_at": "2012-02-29T22:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147014",
    "user": "kcrisman"
}
```

The doc seems correct and appropriately formatted (I hadn't seen `:envvar:` before, but it's already in the file and I like it!).  The only thing I would say needs real review is that it applies and that "override the settings of SAGE_CHECK and SAGE_CHECK_PACKAGES" works as advertised.



---

archive/issue_comments_147015.json:
```json
{
    "body": "\n```\nunset SAGE_CHECK_PACKAGES\n```\n\nwouldn't work since it would make SAGE_CHECK_PACKAGES equal to !python.  So better set\n\n```\nSAGE_CHECK_PACKAGES=x\n```\n\nor something.\n\nAlso, it conflicts with #12602.",
    "created_at": "2012-03-01T11:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147015",
    "user": "jdemeyer"
}
```


```
unset SAGE_CHECK_PACKAGES
```

wouldn't work since it would make SAGE_CHECK_PACKAGES equal to !python.  So better set

```
SAGE_CHECK_PACKAGES=x
```

or something.

Also, it conflicts with #12602.



---

archive/issue_comments_147016.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-01T11:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147016",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_147017.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-01T17:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147017",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_147018.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> ` unset SAGE_CHECK_PACKAGES` wouldn't work since it would make SAGE_CHECK_PACKAGES equal to !python.\n\nGood point. Fixed.\n\n> Also, it conflicts with #12602.\n\nWell, I didn't list #12602 as a prerequisite ;)   I'm attaching two versions of the patch, one which depends on #12602, and one which doesn't.  (I don't know if I'll be able to review #12602 any time soon, by the way.)",
    "created_at": "2012-03-01T17:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147018",
    "user": "jhpalmieri"
}
```

Replying to [comment:5 jdemeyer]:
> ` unset SAGE_CHECK_PACKAGES` wouldn't work since it would make SAGE_CHECK_PACKAGES equal to !python.

Good point. Fixed.

> Also, it conflicts with #12602.

Well, I didn't list #12602 as a prerequisite ;)   I'm attaching two versions of the patch, one which depends on #12602, and one which doesn't.  (I don't know if I'll be able to review #12602 any time soon, by the way.)



---

archive/issue_comments_147019.json:
```json
{
    "body": "Attachment [trac_12613-root.post12602.patch](tarball://root/attachments/some-uuid/ticket12613/trac_12613-root.post12602.patch) by jhpalmieri created at 2012-03-01 17:39:12",
    "created_at": "2012-03-01T17:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147019",
    "user": "jhpalmieri"
}
```

Attachment [trac_12613-root.post12602.patch](tarball://root/attachments/some-uuid/ticket12613/trac_12613-root.post12602.patch) by jhpalmieri created at 2012-03-01 17:39:12



---

archive/issue_comments_147020.json:
```json
{
    "body": "John, I added two reviewer patches.  If you're happy with my patches, you can set positive review.",
    "created_at": "2012-04-02T09:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147020",
    "user": "jdemeyer"
}
```

John, I added two reviewer patches.  If you're happy with my patches, you can set positive review.



---

archive/issue_comments_147021.json:
```json
{
    "body": "Do you think it's clear enough that you can add the options `-s` or `-c` to `sage -f ...`? How about this change instead (modeled after the usage for `sage -t`):\n\n```diff\ndiff --git a/spkg/bin/sage b/spkg/bin/sage\n--- a/spkg/bin/sage\n+++ b/spkg/bin/sage\n@@ -113,12 +113,17 @@ usage_advanced() {\n     ####  |.....................--.|...................................................|\n     echo \"Installing packages and upgrading:\"\n     echo \"  -experimental       -- list all experimental packages that can be installed\"\n-    echo \"  -f [packages]       -- force build of the given Sage package (even if it is\"\n-    echo \"                         already installed)\"\n-    echo \"  -f -s [packages]    -- like -f but do not delete the spkg/build directories\"\n-    echo \"  -i [packages]       -- install the given Sage packages\"\n-    echo \"                         if no packages given, print a list of all installed\"\n-    echo \"  -i -s [packages]    -- like -i but do not delete the spkg/build directories\"\n+    echo \"  -f [packages]       -- shortcut for -i -f: force build of the given Sage\"\n+    echo \"                         packages.\"\n+    echo \"  -i [options] [packages]\"\n+    echo \"                      -- install the given Sage packages (unless they are\"\n+    echo \"                         already installed); if no packages are given, print\"\n+    echo \"                         a list of all installed packages. Options:\"\n+    echo \"                           -c -- run the packages' test suites\"\n+    echo \"                           -f -- force build: install the packages even\"\n+    echo \"                                 if they are already installed\"\n+    echo \"                           -s -- do not delete the spkg/build directories\"\n+    echo \"                                 after a successful build\"\n     echo \"  -optional           -- list all optional packages that can be installed\"\n     echo \"  -standard           -- list all standard packages that can be installed\"\n    #echo \"  -update             -- download latest non-optional Sage packages (do not build them)\"\n```\n\nI can provide a patch for this and a similar one for the reference manual if you want me to.",
    "created_at": "2012-04-02T22:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147021",
    "user": "jhpalmieri"
}
```

Do you think it's clear enough that you can add the options `-s` or `-c` to `sage -f ...`? How about this change instead (modeled after the usage for `sage -t`):

```diff
diff --git a/spkg/bin/sage b/spkg/bin/sage
--- a/spkg/bin/sage
+++ b/spkg/bin/sage
@@ -113,12 +113,17 @@ usage_advanced() {
     ####  |.....................--.|...................................................|
     echo "Installing packages and upgrading:"
     echo "  -experimental       -- list all experimental packages that can be installed"
-    echo "  -f [packages]       -- force build of the given Sage package (even if it is"
-    echo "                         already installed)"
-    echo "  -f -s [packages]    -- like -f but do not delete the spkg/build directories"
-    echo "  -i [packages]       -- install the given Sage packages"
-    echo "                         if no packages given, print a list of all installed"
-    echo "  -i -s [packages]    -- like -i but do not delete the spkg/build directories"
+    echo "  -f [packages]       -- shortcut for -i -f: force build of the given Sage"
+    echo "                         packages."
+    echo "  -i [options] [packages]"
+    echo "                      -- install the given Sage packages (unless they are"
+    echo "                         already installed); if no packages are given, print"
+    echo "                         a list of all installed packages. Options:"
+    echo "                           -c -- run the packages' test suites"
+    echo "                           -f -- force build: install the packages even"
+    echo "                                 if they are already installed"
+    echo "                           -s -- do not delete the spkg/build directories"
+    echo "                                 after a successful build"
     echo "  -optional           -- list all optional packages that can be installed"
     echo "  -standard           -- list all standard packages that can be installed"
    #echo "  -update             -- download latest non-optional Sage packages (do not build them)"
```

I can provide a patch for this and a similar one for the reference manual if you want me to.



---

archive/issue_comments_147022.json:
```json
{
    "body": "Attachment [12613_review.patch](tarball://root/attachments/some-uuid/ticket12613/12613_review.patch) by jdemeyer created at 2012-04-07 09:07:17",
    "created_at": "2012-04-07T09:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147022",
    "user": "jdemeyer"
}
```

Attachment [12613_review.patch](tarball://root/attachments/some-uuid/ticket12613/12613_review.patch) by jdemeyer created at 2012-04-07 09:07:17



---

archive/issue_comments_147023.json:
```json
{
    "body": "Attachment [12613_review_doc.patch](tarball://root/attachments/some-uuid/ticket12613/12613_review_doc.patch) by jdemeyer created at 2012-04-07 09:24:57",
    "created_at": "2012-04-07T09:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147023",
    "user": "jdemeyer"
}
```

Attachment [12613_review_doc.patch](tarball://root/attachments/some-uuid/ticket12613/12613_review_doc.patch) by jdemeyer created at 2012-04-07 09:24:57



---

archive/issue_comments_147024.json:
```json
{
    "body": "I did those changes, needs_review.",
    "created_at": "2012-04-07T09:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147024",
    "user": "jdemeyer"
}
```

I did those changes, needs_review.



---

archive/issue_comments_147025.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-07T15:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147025",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_147026.json:
```json
{
    "body": "Great, looks good.",
    "created_at": "2012-04-07T15:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147026",
    "user": "jhpalmieri"
}
```

Great, looks good.



---

archive/issue_comments_147027.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-08T09:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12441#issuecomment-147027",
    "user": "jdemeyer"
}
```

Resolution: fixed
