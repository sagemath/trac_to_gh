# Issue 15870: unified sequence/lazy list objects in category tree

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-04-09 07:07:25

CC:  matthieudien vdelecroix nthiery mantepse

Several (maybe specialized) implementations of lazy lists exist. This meta ticket can be considered closed when

* the `class Sequence` has a parent from the category `Sets` implemented, maybe with renaming to `FiniteSequence` (#15852)
* implementation of `class InfiniteSequence`
* let both use `sage.misc.lazy_list` (as default implementation? do benchmark)
* refactor code in `combinat.species.*stream` to use `Sequence`
* how does the hypothetical `combinat.species.series.LazyPowerSeries` (#6800) fit in?

Major improvements in `combinat.species.*stream` are planned in #15673.


---

Comment by MatthieuDien created at 2014-04-09 10:01:56

Fot the last point : I did a benchmark between it and the current implementation and [ticket:6800 #6800] was really slow (and have some bugs).

For now, I have to do a benchmark between [ticket:15673 #15673] and another implementation, so I willl look for look for other points


---

Comment by MatthieuDien created at 2014-04-09 10:02:21

Changing keywords from "" to "days57".


---

Comment by MatthieuDien created at 2014-04-09 22:18:30

After some tests, `sage.misc.lazy_list` seems to be faster than `sage.structure.sequence` and `sage.combinat.species.*stream` because it it cythonized.

We will try to do an implementation of `sage.combinat.species.series_stream` over `sage.misc.lazy_list`


---

Comment by mantepse created at 2014-06-10 11:59:58

I think you meant to add #16137, since #16107 is this ticket.


---

Comment by mantepse created at 2014-12-16 10:02:07

Changing keywords from "days57" to "days57, 	LazyPowerSeries".


---

Comment by dkrenn created at 2016-01-11 18:49:45

I've updated the description. Please add here what else should be done; maybe something in words? ...or for lazy power series?


---

Comment by dkrenn created at 2016-01-11 19:03:08

I am thinking about implementing InfiniteSequences and have the following design issue with the two possibilites (it is not restricted to the infinite sequences, but is similar for other classes like words, stream in the species, etc., as well):

1. make `lazy_list_generic` a base class of `InfiniteSequence`

2. make an attribute `values` (or similar) in the class `InfiniteSequence` which will be an instance of `lazy_list_generic`

Both have advantages and disadvantages:

- `Sequence` uses list as a base class, thus `InfiniteSequence` should use `lazy_list`
- With 1. you can only use `lazy_list_generic`, but no derived class like `lazy_list_iterator` directly; you have to create a `lazy_list_generic` which tracks the other (as its `master` attribute; is already implemented since used with slices)
- With 2. you need to write methods for all the things you like from the lazy lists (like building slices etc.). And even then, it is not a lazy list, but just behaves like one.

What do you think?


---

Comment by mantepse created at 2016-01-12 08:06:39

I just realized that `sage.combinat.species.series_stream` actually implements streams of coefficients of lazy power series.  I'll have to experiment there, too,...

Should `InfiniteSequence` be the same?  What is the algebraic structure?


---

Comment by mantepse created at 2016-01-12 08:09:51

Replying to [comment:16 dkrenn]:
> - With 1. you can only use `lazy_list_generic`, but no derived class like `lazy_list_iterator` directly; you have to create a `lazy_list_generic` which tracks the other (as its `master` attribute; is already implemented since used with slices)

Could you explain?  What does it mean that you cannot use a derived class directly?


---

Comment by dkrenn created at 2016-01-12 08:19:31

Replying to [comment:18 mantepse]:
> Replying to [comment:16 dkrenn]:
> > - With 1. you can only use `lazy_list_generic`, but no derived class like `lazy_list_iterator` directly; you have to create a `lazy_list_generic` which tracks the other (as its `master` attribute; is already implemented since used with slices)
> 
> Could you explain?  What does it mean that you cannot use a derived class directly?


```
class InfiniteSequence(SageObject, lazy_list_generic)
```

But when using the factory `lazy_list`, I may get a `lazy_list_iterator` or similar, so AFAIK I cannot use it in `InfiniteSequence` directly. I need to do either
- create `class InfiniteSequenceIterator(InfiniteSequence, lazy_list_iterator)` (and have to do this for all possible `lazy_list_*` or
- create a `lazy_list_generic` (`InfiniteSequence`), which uses the data of the `lazy_list_iterator`, i.e., tracks `lazy_list_iterator`. Thus having always two `lazy_list_*` instances instantiated.


---

Comment by dkrenn created at 2016-01-12 08:20:33

Replying to [comment:17 mantepse]:
> I just realized that `sage.combinat.species.series_stream` actually implements streams of coefficients of lazy power series.  I'll have to experiment there, too,...
> 
> Should `InfiniteSequence` be the same?  What is the algebraic structure?

No algebraic strcture (due to the discussion on #15852 about (finite) sequences).


---

Comment by mantepse created at 2016-01-12 08:26:02

Replying to [comment:20 dkrenn]:
> Replying to [comment:17 mantepse]:

> > Should `InfiniteSequence` be the same?  What is the algebraic structure?
> 
> No algebraic strcture (due to the discussion on #15852 about (finite) sequences).

Ah, but then what is the difference between `lazy_list` and `InfiniteSequence`?


---

Comment by dkrenn created at 2016-01-12 08:29:49

Replying to [comment:21 mantepse]:
> Replying to [comment:20 dkrenn]:
> > Replying to [comment:17 mantepse]:
> 
> > > Should `InfiniteSequence` be the same?  What is the algebraic structure?
> > 
> > No algebraic strcture (due to the discussion on #15852 about (finite) sequences).
> 
> Ah, but then what is the difference between `lazy_list` and `InfiniteSequence`?

Sequences have a common universe for all the elements of the lazy list and they are (in contrast to lazy list) a `SageObject` and not only Python's `object`.


---

Comment by mantepse created at 2016-01-12 08:33:02

Replying to [comment:22 dkrenn]:
> > Ah, but then what is the difference between `lazy_list` and `InfiniteSequence`?
> 
> Sequences have a common universe for all the elements of the lazy list and they are (in contrast to lazy list) a `SageObject` and not only Python's `object`.

OK, so in particular this answers my question: a stream of coefficients should not inherit from `lazy_list_generic` :-)  (and thanks for pointing out that `lazy_list` is not a class!)


---

Comment by dkrenn created at 2016-01-12 08:38:42

Replying to [comment:23 mantepse]:
> Replying to [comment:22 dkrenn]:
> > > Ah, but then what is the difference between `lazy_list` and `InfiniteSequence`?
> > 
> > Sequences have a common universe for all the elements of the lazy list and they are (in contrast to lazy list) a `SageObject` and not only Python's `object`.
> 
> OK, so in particular this answers my question: a stream of coefficients should not inherit from `lazy_list_generic` :-)  (and thanks for pointing out that `lazy_list` is not a class!)

So your question back to you: What characterizes a stream on your sense?
And why not using `lazy_list_generic` as base? (To point this out: It works; has advantages and disadvantages).


---

Comment by mantepse created at 2016-01-12 08:49:51

> > > Sequences have a common universe for all the elements of the lazy list and they are (in contrast to lazy list) a `SageObject` and not only Python's `object`.
> > 
> > OK, so in particular this answers my question: a stream of coefficients should not inherit from `lazy_list_generic` :-)  (and thanks for pointing out that `lazy_list` is not a class!)
> 
> So your question back to you: What characterizes a stream on your sense?
> And why not using `lazy_list_generic` as base? (To point this out: It works; has advantages and disadvantages).

(I assume you mean stream of coefficients?)

I want both a common universe and an algebraic structure: all coefficients are from a ring - in particular, I absolutely need a (recognisable!) zero.


---

Comment by dkrenn created at 2016-01-12 08:55:53

Replying to [comment:25 mantepse]:
> > > > Sequences have a common universe for all the elements of the lazy list and they are (in contrast to lazy list) a `SageObject` and not only Python's `object`.
> > > 
> > > OK, so in particular this answers my question: a stream of coefficients should not inherit from `lazy_list_generic` :-)  (and thanks for pointing out that `lazy_list` is not a class!)
> > 
> > So your question back to you: What characterizes a stream on your sense?
> > And why not using `lazy_list_generic` as base? (To point this out: It works; has advantages and disadvantages).
> 
> (I assume you mean stream of coefficients?)

Yes.

> I want both a common universe and an algebraic structure: all coefficients are from a ring - in particular, I absolutely need a (recognisable!) zero.

What operations are allowed on streams then? (I assume point-wise addition; what do you need multiplication for?)


---

Comment by dkrenn created at 2016-01-12 09:02:54

Replying to [comment:25 mantepse]:
> I want both a common universe and an algebraic structure: all coefficients are from a ring - in particular, I absolutely need a (recognisable!) zero.

So your streams seem to be a more specialized than my sequences. In this way, would it be an option for you that streams have sequences as a base class?
Is a stream of you a Sage `Element`? (I would guess so).


---

Comment by mantepse created at 2016-01-12 14:23:04

> What operations are allowed on streams then? (I assume point-wise addition; what do you need multiplication for?)

Well, I really want to keep them relatively general, mainly because I won't gain anything by requiring certain operation.  I do think that it makes sense to require that the coefficients are from a (possibly noncommutative) ring.  I can't think of any applications where we do not have this.  I need the recognisable zero to be able to do the trick with recursive definition.

> So your streams seem to be a more specialized than my sequences. In this way, would it be an option for you that streams have sequences as a base class?

Yes, certainly.

> Is a stream of you a Sage `Element`? (I would guess so).

Yes.
