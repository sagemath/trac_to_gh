# Issue 15983: Waste of time in iterator_edges 3

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2014-04-23 13:32:39

Assignee: vdelecroix

CC:  ncohen

Further optimizations for graph iterations following #16005


---

Comment by vdelecroix created at 2014-04-23 13:39:32

Changing keywords from "" to "graphs, datastructure".


---

Comment by vdelecroix created at 2014-04-23 13:39:32

New commits:


---

Comment by vdelecroix created at 2014-04-23 13:39:32

Changing type from PLEASE CHANGE to enhancement.


---

Comment by ncohen created at 2014-04-23 15:09:51

Isn't there a problem if you want to iterate over the edges but stop midway ? Isn't it the case that the array is never deallocated ?

Nathann


---

Comment by vdelecroix created at 2014-04-23 15:18:59

Replying to [comment:2 ncohen]:
> Isn't there a problem if you want to iterate over the edges but stop midway ? Isn't it the case that the array is never deallocated ?

You are right, with a code like

```
sage: it = build_me_an_edge_iterator()
sage: it.next()
sage: del it
```

we keep an array never deallocated. But what happens for alloc/dealloc inside cdef functions?

A solution would be to implement an iterator in Cython with direct access to the `SparseGraph` (doing all proper deallocation in `__dealloc__`). Is it worth it?


---

Comment by ncohen created at 2014-04-23 15:21:07

> we keep an array never deallocated. But what happens for alloc/dealloc inside cdef functions?

I would say that it never happens, and that the only way is to create a class with a constructor/destructor. Which is a lot of code.

> A solution would be to implement an iterator in Cython with direct access to the `SparseGraph` (doing all proper deallocation in `__dealloc__`). Is it worth it?

Well, the question is whether an iterator is cheaper than a malloc.

Nathann


---

Comment by @kliem created at 2020-09-29 03:49:54

#30665 does some improvements to the edge iterator. It is surely not optimized out. Not sure, if we want to close this ticket here. Or keep it for further improvements.


---

Comment by dcoudert created at 2020-10-02 15:47:01

We can certainly close it.


---

Comment by @kliem created at 2020-10-02 18:08:22

Changing status from new to needs_review.


---

Comment by @kliem created at 2020-10-02 18:08:22

With #30665, I think this can be closed. The branch certainly doesn't work anymore after redesign.


---

Comment by dcoudert created at 2020-10-03 17:35:45

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-10-03 17:35:45

Agreed.


---

Comment by slelievre created at 2020-10-11 17:16:57

Resolution: duplicate
