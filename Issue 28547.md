# Issue 28547: Adding multiple symmetries and multiple contractions to tensors

Issue created by migration from https://trac.sagemath.org/ticket/28784

Original creator: @LBrunswic

Original creation time: 2019-11-21 21:01:06

CC:  egourgoulhon




---

Comment by @LBrunswic created at 2019-11-21 21:05:46

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @LBrunswic created at 2019-11-21 21:05:46

Changing keywords from "" to "tensor, contraction, symmetries, manifolds".


---

Comment by @LBrunswic created at 2019-11-21 21:05:46

Changing component from PLEASE CHANGE to linear algebra.


---

Comment by @LBrunswic created at 2019-11-21 21:08:52

Set assignee to @LBrunswic.


---

Comment by git created at 2019-11-21 21:51:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @LBrunswic created at 2019-11-21 21:53:42

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2019-11-22 09:12:48

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2019-11-22 09:12:48

Thanks for this useful enhancement!

The patchbot reports some failures:

```
sage -t --long src/sage/manifolds/differentiable/tensorfield.py  # 2 doctests failed
sage -t --long src/sage/tensor/modules/free_module_tensor.py  # 19 doctests failed
sage -t --long src/sage/tensor/modules/tensor_with_indices.py  # 39 doctests failed
```

Besides, could you add a few doctests to illustrate the new functionalities?


---

Comment by git created at 2019-11-22 11:37:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @LBrunswic created at 2019-11-22 11:44:26

`@`egourgoulhon 
 I needed it :)
 
 I'm sorry I forgot to do a doctest :$...I corrected the features that are tested and added new doctest.


---

Comment by @LBrunswic created at 2019-11-22 11:46:30

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2019-11-23 21:03:11

New commits:


---

Comment by egourgoulhon created at 2019-11-23 21:16:41

Thanks for making all doctest passed.
I gave a more in-depth look at the code and it looks very good.
I've just performed some reviewer tweaks, which I pushed in the new branch. You can see the (minor) changes [here](https://git.sagemath.org/sage.git/commit?id=0823e29c5fa02815c71a23f770f8ee226eec7c76).
In particular
- a doctest block has been corrected by adding a missing `::`
- some PEP 8 enforcement has been performed
- doctests raising an exception have been rewritten via `Traceback...` instead of a `try` block
- the header  `# -*- coding: utf-8 -*-` has been added to the file `tensor_with_indices.py`, in order to get rid of the non-ascii error revealed by the patchbot.

Do you agree with the above changes?


---

Comment by git created at 2019-11-24 00:18:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @LBrunswic created at 2019-11-24 00:25:06

Thanks for the PEP8 enforcement and the correction of the doctest. 

Of course, I agree with the changes and merged. 
I quickly reviewed them and checked the doctest. 

Also, I corrected a typo and clarified two lines.


---

Comment by @LBrunswic created at 2019-11-24 19:11:00

I would give a positive review but since I modified the code (even marginally) I think I shouldn't do it.


---

Comment by egourgoulhon created at 2019-11-24 19:54:27

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2019-11-24 19:54:27

I've just checked your latest changes. Everything is OK. 
Thanks for this work.


---

Comment by @mwageringel created at 2019-11-27 18:16:59

It would be nice to add this functionality for multiple symmetrizations to the method `symmetrize()` as well because symmetrization is not necessarily done over neighboring indices which cannot be handled by the string syntax. I assume it is more efficient to do all symmetrizations and antisymmetrizations in a single function call, rather than computing several intermediate results.


---

Comment by @LBrunswic created at 2019-11-27 19:23:45

Replying to [comment:18 gh-mwageringel]:
> It would be nice to add this functionality for multiple symmetrizations to the method `symmetrize()` as well because symmetrization is not necessarily done over neighboring indices which cannot be handled by the string syntax. I assume it is more efficient to do all symmetrizations and antisymmetrizations in a single function call, rather than computing several intermediate results.

Hi! 

 I completely agree! We should open another ticket or a discussion of devel to discuss this (I would at the very least ask Eric Gourgoulhon for validation). 

 To begin the discussion, I see other issues with the current implementation and methods.
For instance, it's not possible to define the symmetries of the riemann tensor. This is related to the fact that (anti)symmetrize ony takes a set of indices as argument and then consider the action of the natural action of the symmetric group this set.
It would be appreciable to define the symmetrization via an action of some group on the set indices. Antisymmetrization would need also a 'signature' morphism G-->{1,-1}. More generally, one could consider linear group action symmetries.


---

Comment by egourgoulhon created at 2019-11-28 09:52:46

Replying to [comment:19 gh-LBrunswic]:
> Replying to [comment:18 gh-mwageringel]:
> > It would be nice to add this functionality for multiple symmetrizations to the method `symmetrize()` as well because symmetrization is not necessarily done over neighboring indices which cannot be handled by the string syntax. I assume it is more efficient to do all symmetrizations and antisymmetrizations in a single function call, rather than computing several intermediate results.
> 
> Hi! 
> 
>  I completely agree! We should open another ticket or a discussion of devel to discuss this (I would at the very least ask Eric Gourgoulhon for validation). 
> 

Yes please open a ticket for this! (and continue the discussion there).
 
>  To begin the discussion, I see other issues with the current implementation and methods.
> For instance, it's not possible to define the symmetries of the riemann tensor. This is related to the fact that (anti)symmetrize ony takes a set of indices as argument and then consider the action of the natural action of the symmetric group this set.
> It would be appreciable to define the symmetrization via an action of some group on the set indices. Antisymmetrization would need also a 'signature' morphism G-->{1,-1}. More generally, one could consider linear group action symmetries.  

Indeed, this would be nice.


---

Comment by @mwageringel created at 2019-11-28 20:43:13

The new ticket is #28813.


---

Comment by vbraun created at 2019-11-30 13:36:10

Resolution: fixed
