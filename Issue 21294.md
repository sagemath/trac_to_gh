# Issue 21294: py3 get rid of xrange in groups folder

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2016-09-18 17:06:48

CC:  tscrim jdemeyer

using six.moves.range instead

in .py files only


---

Comment by chapoton created at 2016-09-18 17:10:38

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-09-18 17:10:38

New commits:


---

Comment by jmantysalo created at 2016-09-18 19:22:18

I can take.


---

Comment by jmantysalo created at 2016-09-18 19:33:02

Seems to be fine when reading the code, but does not work. Several failures, and of those


```
TypeError: 'xrange' object does not support item assignment
```


seems to be directly related in `src/sage/groups/perm_gps/partn_ref/data_structures_pyx.pxi`, but I don't know where `TypeError: 'int' object is not iterable` came from in `src/sage/groups/perm_gps/cubegroup.py`.


---

Comment by chapoton created at 2016-09-18 19:49:18

Let us wait for a patchbot report.


---

Comment by chapoton created at 2016-09-19 07:03:30

Just  like #21478,  this triggers the use of "xrange" in all the doctests of sage.

I do not understand why, and how to avoid this unwanted behaviour


---

Comment by chapoton created at 2016-09-19 07:04:16

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-09-19 18:59:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-09-19 19:46:36

Why there is still one xrange left at `permy = list(xrange(1, n + 1))`?

Sidenote, this is quite interesting solution: `perms.append([c for c in p])`. Also `[(i+1)%n for i in range( n )]` is not the way I would code. But anyways, your patch does not make this any worst, and you even fixed `range(m)[n:]`.


---

Comment by chapoton created at 2016-09-19 19:55:27

not yet in "needs_review" state. I am fighting with the imports..


---

Comment by jdemeyer created at 2016-09-19 19:56:19

Replying to [ticket:21531 chapoton]:
> in .py files only

Not quite, you are changing also a `.pxi` file.


---

Comment by git created at 2016-09-19 20:10:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-09-19 20:14:34

let us wait for the patchbot report again


---

Comment by chapoton created at 2016-09-19 20:14:34

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-09-19 20:28:28

I have cured the symptoms and not the disease by moving a few imports of `six.moves.range` inside some functions (in 3 modules) instead of having them at the module level.

The culprits (triggering the import of six.moves.range in all sage) are some imports of these 3 modules in the following style

```
import blabla as bla
```

some of them occuring in elliptic curves.


---

Comment by chapoton created at 2016-09-20 07:50:34

The xrange will stay in pyx files, and I assume also in pxi files.


---

Comment by jdemeyer created at 2016-09-20 15:32:54

Replying to [comment:14 chapoton]:
> The xrange will stay in pyx files, and I assume also in pxi files.

Indeed, the same thing should be done to all Cython code.


---

Comment by chapoton created at 2016-09-21 11:59:36

bot is green now


---

Comment by jmantysalo created at 2016-09-22 05:45:21

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2016-09-22 05:45:21

This is OK.


---

Comment by vbraun created at 2016-10-03 17:41:53

Resolution: fixed
