# Issue 30828: bug in _fast_float_

archive/issues_030828.json:
```json
{
    "body": "CC:  mjo\n\nFrom https://ask.sagemath.org/question/54720/\n\nThis can be traced to\n\n```\nsage: var('x,y')                                                                                                                            \n(x, y)\nsage: f(x,y)=x                                                                                                                              \nsage: f._fast_float_(f.arguments())  \n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:11962)()\n   1667         try:\n-> 1668             ret = float(self._eval_self(float))\n   1669         except TypeError:\n\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._eval_self (build/cythonized/sage/symbolic/expression.cpp:10176)()\n   1417         else:\n-> 1418             raise TypeError(\"Cannot evaluate symbolic expression to a numeric value.\")\n   1419 \n\nTypeError: Cannot evaluate symbolic expression to a numeric value.\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:12024)()\n   1670             try:\n-> 1671                 c = (self._eval_self(complex))\n   1672                 if imag(c) == 0:\n\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._eval_self (build/cythonized/sage/symbolic/expression.cpp:10176)()\n   1417         else:\n-> 1418             raise TypeError(\"Cannot evaluate symbolic expression to a numeric value.\")\n   1419 \n\nTypeError: Cannot evaluate symbolic expression to a numeric value.\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in symbol(self, ex)\n   1682         try:\n-> 1683             return self.ff.fast_float_constant(float(ex))\n   1684         except TypeError:\n\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:12155)()\n   1676             except TypeError:\n-> 1677                 raise TypeError(\"unable to simplify to float approximation\")\n   1678         return ret\n\nTypeError: unable to simplify to float approximation\n\nDuring handling of the above exception, another exception occurred:\n\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-17-9cc701614d56> in <module>\n----> 1 f._fast_float_(f.arguments())\n\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._fast_float_ (build/cythonized/sage/symbolic/expression.cpp:64805)()\n  12041         \"\"\"\n  12042         from sage.symbolic.expression_conversions import fast_float\n> 12043         return fast_float(self, *vars)\n  12044 \n  12045     def _fast_callable_(self, etb):\n\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in fast_float(ex, *vars)\n   1769         1.4142135623730951\n   1770     \"\"\"\n-> 1771     return FastFloatConverter(ex, *vars)()\n   1772 \n   1773 #################\n\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in __call__(self, ex)\n    210         operator = ex.operator()\n    211         if operator is None:\n--> 212             return self.symbol(ex)\n    213 \n    214         if operator in arithmetic_operators:\n\n~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in symbol(self, ex)\n   1683             return self.ff.fast_float_constant(float(ex))\n   1684         except TypeError:\n-> 1685             raise NotImplementedError(\"free variable: %s\" % repr(ex))\n   1686 \n   1687     def arithmetic(self, ex, operator):\n\nNotImplementedError: free variable: (x, y) |--> x\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31065\n\n",
    "created_at": "2020-12-17T11:00:06Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "bug in _fast_float_",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30828",
    "user": "chapoton"
}
```
CC:  mjo

From https://ask.sagemath.org/question/54720/

This can be traced to

```
sage: var('x,y')                                                                                                                            
(x, y)
sage: f(x,y)=x                                                                                                                              
sage: f._fast_float_(f.arguments())  
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:11962)()
   1667         try:
-> 1668             ret = float(self._eval_self(float))
   1669         except TypeError:

~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._eval_self (build/cythonized/sage/symbolic/expression.cpp:10176)()
   1417         else:
-> 1418             raise TypeError("Cannot evaluate symbolic expression to a numeric value.")
   1419 

TypeError: Cannot evaluate symbolic expression to a numeric value.

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:12024)()
   1670             try:
-> 1671                 c = (self._eval_self(complex))
   1672                 if imag(c) == 0:

~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._eval_self (build/cythonized/sage/symbolic/expression.cpp:10176)()
   1417         else:
-> 1418             raise TypeError("Cannot evaluate symbolic expression to a numeric value.")
   1419 

TypeError: Cannot evaluate symbolic expression to a numeric value.

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in symbol(self, ex)
   1682         try:
-> 1683             return self.ff.fast_float_constant(float(ex))
   1684         except TypeError:

~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:12155)()
   1676             except TypeError:
-> 1677                 raise TypeError("unable to simplify to float approximation")
   1678         return ret

TypeError: unable to simplify to float approximation

During handling of the above exception, another exception occurred:

NotImplementedError                       Traceback (most recent call last)
<ipython-input-17-9cc701614d56> in <module>
----> 1 f._fast_float_(f.arguments())

~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._fast_float_ (build/cythonized/sage/symbolic/expression.cpp:64805)()
  12041         """
  12042         from sage.symbolic.expression_conversions import fast_float
> 12043         return fast_float(self, *vars)
  12044 
  12045     def _fast_callable_(self, etb):

~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in fast_float(ex, *vars)
   1769         1.4142135623730951
   1770     """
-> 1771     return FastFloatConverter(ex, *vars)()
   1772 
   1773 #################

~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in __call__(self, ex)
    210         operator = ex.operator()
    211         if operator is None:
--> 212             return self.symbol(ex)
    213 
    214         if operator in arithmetic_operators:

~/sage/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py in symbol(self, ex)
   1683             return self.ff.fast_float_constant(float(ex))
   1684         except TypeError:
-> 1685             raise NotImplementedError("free variable: %s" % repr(ex))
   1686 
   1687     def arithmetic(self, ex, operator):

NotImplementedError: free variable: (x, y) |--> x
```


Issue created by migration from https://trac.sagemath.org/ticket/31065





---

archive/issue_comments_440621.json:
```json
{
    "body": "This way might just not be the intended way of doing it, because this works:\n\n\n```\nsage: var('x,y')\n(x,y)\nsage: f(x,y)=x\nsage: f._fast_float_(f.arguments()[0], f.arguments()[1])\n<sage.ext.fast_eval.FastDoubleFunc object at 0x6ffe4139fb20>\n```\n\n\nI think that it interprets the tuple returned by `f.arguments` as the variable as opposed to the elements of the tuple, `x` and `y`. Thus, `x` is not specified as a variable, which results in the error.",
    "created_at": "2021-03-05T16:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30828#issuecomment-440621",
    "user": "@cEMRSS"
}
```

This way might just not be the intended way of doing it, because this works:


```
sage: var('x,y')
(x,y)
sage: f(x,y)=x
sage: f._fast_float_(f.arguments()[0], f.arguments()[1])
<sage.ext.fast_eval.FastDoubleFunc object at 0x6ffe4139fb20>
```


I think that it interprets the tuple returned by `f.arguments` as the variable as opposed to the elements of the tuple, `x` and `y`. Thus, `x` is not specified as a variable, which results in the error.



---

archive/issue_comments_440622.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30828#issuecomment-440622",
    "user": "mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.



---

archive/issue_comments_440623.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-22T00:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30828#issuecomment-440623",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_440624.json:
```json
{
    "body": "#32234 removes `_fast_float_`",
    "created_at": "2021-07-22T00:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30828#issuecomment-440624",
    "user": "mkoeppe"
}
```

#32234 removes `_fast_float_`



---

archive/issue_comments_440625.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-22T00:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30828#issuecomment-440625",
    "user": "mjo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440626.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-09-02T18:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30828#issuecomment-440626",
    "user": "mkoeppe"
}
```

Resolution: invalid
