# Issue 22234: Clean up and document "b" and "refers_to" attributes of Gen

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-02-28 13:51:19

CC:  defeo vdelecroix

I have always found it hard to understand what the attributes `b` and `refers_to` mean. I propose:

1. Rename `b` to `chunck`.

2. Split `refers_to` in two because it is used in two independent ways: instead add `parent` and `index_cache` attributes.

3. Document this a lot better.


---

Comment by jdemeyer created at 2017-02-28 18:46:22

New commits:


---

Comment by jdemeyer created at 2017-02-28 18:46:22

Changing status from new to needs_review.


---

Comment by git created at 2017-03-01 08:26:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by defeo created at 2017-03-03 15:50:09

Since this is moving `new_ref`, I'll take the occasion to ask whether `_new_ref` wouldn't be a better name. Isn't it the case that this is exclusively for internal purposes?


---

Comment by defeo created at 2017-03-03 15:51:12

The Python3 plugin is failing (one doctest uses `cmp`)


---

Comment by jdemeyer created at 2017-03-03 21:05:16

Replying to [comment:8 defeo]:
> Since this is moving `new_ref`, I'll take the occasion to ask whether `_new_ref` wouldn't be a better name. Isn't it the case that this is exclusively for internal purposes?

I would argue that it's part of the public Cython API (for example, it's used in the new `power_series_pari.pyx`), so it doesn't need to be private. Note that it's a `cdef` method, so it will not bother TAB-completion.


---

Comment by jdemeyer created at 2017-03-03 21:13:24

That being said, I want my choose my battles wisely and focus on method name bikeshedding in #22470 :-)

So if you insist on `_new_ref`, I will gladly make the change.


---

Comment by defeo created at 2017-03-03 21:17:40

Replying to [comment:11 jdemeyer]:
> That being said, I want my choose my battles wisely and focus on method name bikeshedding in #22470 :-)
> 
> So if you insist on `_new_ref`, I will gladly make the change.

No, no. The argument on `new_ref` being used by power series is a good one. I hadn't read the diff that far.

The Py3 failure must be dealt with, however.


---

Comment by jdemeyer created at 2017-03-04 10:29:11

About the py3 failure:

This is OK since Cython understands `xrange`:

```
            inds = xrange(*n.indices(l))
```


This comes from the dependency which is merged now (there is no `cmp` in the current diff):

```
            sage: cmp(pari('2/3'), pari('2/5'))
```


So there is nothing to be done here...


---

Comment by defeo created at 2017-03-04 14:04:33

Replying to [comment:13 jdemeyer]:
> About the py3 failure:
> 
> This is OK since Cython understands `xrange`:
> {{{
>             inds = xrange(*n.indices(l))
> }}}

Mmm... right. But is it going to support it in the long run? I cannot find much info on what Cython plans are. What's the most future proof way of using iterators in Cython?

> This comes from the dependency which is merged now (there is no `cmp` in the current diff):
> {{{
>             sage: cmp(pari('2/3'), pari('2/5'))
> }}}
> 
> So there is nothing to be done here...

Right. That'll be for another ticket.


---

Comment by jdemeyer created at 2017-03-04 21:32:16

Replying to [comment:15 defeo]:
> Replying to [comment:13 jdemeyer]:
> > About the py3 failure:
> > 
> > This is OK since Cython understands `xrange`:
> > {{{
> >             inds = xrange(*n.indices(l))
> > }}}
> 
> Mmm... right. But is it going to support it in the long run?

Why should they not? It's not deprecated or anything...


---

Comment by defeo created at 2017-03-14 19:18:28

Changing status from needs_review to positive_review.


---

Comment by defeo created at 2017-03-14 19:18:28

Nice cleanup. Good to go!


---

Comment by defeo created at 2017-03-14 19:55:30

Changing keywords from "" to "days85".


---

Comment by vbraun created at 2017-03-27 20:42:14

Resolution: fixed
