# Issue 25163: global name 'is_package_installed' is not defined

archive/issues_025163.json:
```json
{
    "body": "CC:  @jplab @mkoeppe @mo271\n\n\n```\nsage -t --long src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 4410, in sage.geometry.polyhedron.base.Polyhedron_base._volume_latte\nFailed example:\n    polytopes.hypercube(3)._volume_latte() #optional - latte_int\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base._volume_latte[0]>\", line 1, in <module>\n        polytopes.hypercube(Integer(3))._volume_latte() #optional - latte_int\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py\", line 4436, in _volume_latte\n        if is_package_installed('latte_int'):\n    NameError: global name 'is_package_installed' is not defined\n**********************************************************************\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25400\n\n",
    "created_at": "2018-05-19T07:36:14Z",
    "labels": [
        "component: packages: optional",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "global name 'is_package_installed' is not defined",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25163",
    "user": "https://github.com/videlec"
}
```
CC:  @jplab @mkoeppe @mo271


```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4410, in sage.geometry.polyhedron.base.Polyhedron_base._volume_latte
Failed example:
    polytopes.hypercube(3)._volume_latte() #optional - latte_int
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base._volume_latte[0]>", line 1, in <module>
        polytopes.hypercube(Integer(3))._volume_latte() #optional - latte_int
      File "/opt/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4436, in _volume_latte
        if is_package_installed('latte_int'):
    NameError: global name 'is_package_installed' is not defined
**********************************************************************
```


Issue created by migration from https://trac.sagemath.org/ticket/25400





---

archive/issue_comments_354026.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-19T08:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354026",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_354027.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-19T08:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354027",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354028.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-19T08:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354028",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_354029.json:
```json
{
    "body": "The function `_volume_latte` from `sage.geometry.polyhedron.base` calls `is_package_installed` which is not imported anymore... (#20382). As a consequence\n\n```\nsage -t --long src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 4410, in sage.geometry.polyhedron.base.Polyhedron_base._volume_latte\nFailed example:\n    polytopes.hypercube(3)._volume_latte() #optional - latte_int\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base._volume_latte[0]>\", line 1, in <module>\n        polytopes.hypercube(Integer(3))._volume_latte() #optional - latte_int\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py\", line 4436, in _volume_latte\n        if is_package_installed('latte_int'):\n    NameError: global name 'is_package_installed' is not defined\n**********************************************************************\n```\n\n\nInstead of reimporting it, we rather rely on the new feature framework introduced in #20382.",
    "created_at": "2018-05-19T08:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354029",
    "user": "https://github.com/videlec"
}
```

The function `_volume_latte` from `sage.geometry.polyhedron.base` calls `is_package_installed` which is not imported anymore... (#20382). As a consequence

```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4410, in sage.geometry.polyhedron.base.Polyhedron_base._volume_latte
Failed example:
    polytopes.hypercube(3)._volume_latte() #optional - latte_int
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base._volume_latte[0]>", line 1, in <module>
        polytopes.hypercube(Integer(3))._volume_latte() #optional - latte_int
      File "/opt/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4436, in _volume_latte
        if is_package_installed('latte_int'):
    NameError: global name 'is_package_installed' is not defined
**********************************************************************
```


Instead of reimporting it, we rather rely on the new feature framework introduced in #20382.



---

archive/issue_comments_354030.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-20T23:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354030",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354031.json:
```json
{
    "body": "Looks good. I think you want to drop an \"s\" and replace `\"Test whether count and integrate are functionals.\"` with\n`\"Test whether ``count`` and ``integrate`` are functional.\"` Also, I think that our new files should have copyright headers at least that's what the developer guide suggests.\n\nThe patchbot run looks weird. Do you understand what's going on?",
    "created_at": "2018-05-20T23:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354031",
    "user": "https://github.com/saraedum"
}
```

Looks good. I think you want to drop an "s" and replace `"Test whether count and integrate are functionals."` with
`"Test whether ``count`` and ``integrate`` are functional."` Also, I think that our new files should have copyright headers at least that's what the developer guide suggests.

The patchbot run looks weird. Do you understand what's going on?



---

archive/issue_comments_354032.json:
```json
{
    "body": "This is a reasonable failure that has to be fixed\n\n```\nsage -t --long --warn-long 80.1 src/sage/interfaces/latte.py\n**********************************************************************\nFile \"src/sage/interfaces/latte.py\", line 45, in sage.interfaces.latte.count\nFailed example:\n    from sage.interfaces.latte import count\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.latte.count[0]>\", line 1, in <module>\n        from sage.interfaces.latte import count\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/interfaces/latte.py\", line 18, in <module>\n        Latte().require()\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/features/__init__.py\", line 158, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    FeatureNotPresentError: LattE is not available.\n    Executable 'count' not found on PATH.\n    To install count you can try to run 'sage -i latte_int'.\n    Further installation instructions might be available at https://www.math.ucdavis.edu/~latte/software.php.\n```\n",
    "created_at": "2018-05-21T06:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354032",
    "user": "https://github.com/videlec"
}
```

This is a reasonable failure that has to be fixed

```
sage -t --long --warn-long 80.1 src/sage/interfaces/latte.py
**********************************************************************
File "src/sage/interfaces/latte.py", line 45, in sage.interfaces.latte.count
Failed example:
    from sage.interfaces.latte import count
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.latte.count[0]>", line 1, in <module>
        from sage.interfaces.latte import count
      File "/opt/sage/local/lib/python2.7/site-packages/sage/interfaces/latte.py", line 18, in <module>
        Latte().require()
      File "/opt/sage/local/lib/python2.7/site-packages/sage/features/__init__.py", line 158, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    FeatureNotPresentError: LattE is not available.
    Executable 'count' not found on PATH.
    To install count you can try to run 'sage -i latte_int'.
    Further installation instructions might be available at https://www.math.ucdavis.edu/~latte/software.php.
```




---

archive/issue_comments_354033.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-28T13:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354033",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_354034.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-28T14:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354034",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354035.json:
```json
{
    "body": "rebased on beta3... needs review",
    "created_at": "2018-05-28T14:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354035",
    "user": "https://github.com/videlec"
}
```

rebased on beta3... needs review



---

archive/issue_comments_354036.json:
```json
{
    "body": "There's something about this ticket which seems to make patchbots crash. Whenever my patchbot (fermat) gets around to testing this ticket, it gets as far as applying the patch + building docs, and then it hangs -- the python subprocesses that are spawned to build the various ref manual chapters somehow get stuck + don't terminate.\n\nAny idea what could be causing this? No other currently-open ticket causes this behaviour.",
    "created_at": "2018-05-29T12:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354036",
    "user": "https://github.com/loefflerd"
}
```

There's something about this ticket which seems to make patchbots crash. Whenever my patchbot (fermat) gets around to testing this ticket, it gets as far as applying the patch + building docs, and then it hangs -- the python subprocesses that are spawned to build the various ref manual chapters somehow get stuck + don't terminate.

Any idea what could be causing this? No other currently-open ticket causes this behaviour.



---

archive/issue_comments_354037.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-29T13:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354037",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354038.json:
```json
{
    "body": "I made a check at import time... if it fails it is possible that sphinx hang forever. I will test.",
    "created_at": "2018-05-29T13:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354038",
    "user": "https://github.com/videlec"
}
```

I made a check at import time... if it fails it is possible that sphinx hang forever. I will test.



---

archive/issue_comments_354039.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-30T14:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354039",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354040.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-30T14:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354040",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354041.json:
```json
{
    "body": "feel free to set this to positive review if the patchbot issue is fixed now.",
    "created_at": "2018-06-01T23:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354041",
    "user": "https://github.com/saraedum"
}
```

feel free to set this to positive review if the patchbot issue is fixed now.



---

archive/issue_comments_354042.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-03T08:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354042",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_354043.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-06T19:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25163#issuecomment-354043",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_023450.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2018-06-06T19:53:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25163",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25163#event-23450"
}
```
