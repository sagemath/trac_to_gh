# Issue 25163: global name 'is_package_installed' is not defined

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2018-05-19 07:36:14

CC:  jipilab mkoeppe moritz


```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4410, in sage.geometry.polyhedron.base.Polyhedron_base._volume_latte
Failed example:
    polytopes.hypercube(3)._volume_latte() #optional - latte_int
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base._volume_latte[0]>", line 1, in <module>
        polytopes.hypercube(Integer(3))._volume_latte() #optional - latte_int
      File "/opt/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4436, in _volume_latte
        if is_package_installed('latte_int'):
    NameError: global name 'is_package_installed' is not defined
**********************************************************************
```



---

Comment by vdelecroix created at 2018-05-19 08:07:04

New commits:


---

Comment by vdelecroix created at 2018-05-19 08:08:14

Changing status from new to needs_review.


---

Comment by git created at 2018-05-19 08:11:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2018-05-19 08:15:21

The function `_volume_latte` from `sage.geometry.polyhedron.base` calls `is_package_installed` which is not imported anymore... (#20382). As a consequence

```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4410, in sage.geometry.polyhedron.base.Polyhedron_base._volume_latte
Failed example:
    polytopes.hypercube(3)._volume_latte() #optional - latte_int
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base._volume_latte[0]>", line 1, in <module>
        polytopes.hypercube(Integer(3))._volume_latte() #optional - latte_int
      File "/opt/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4436, in _volume_latte
        if is_package_installed('latte_int'):
    NameError: global name 'is_package_installed' is not defined
**********************************************************************
```


Instead of reimporting it, we rather rely on the new feature framework introduced in #20382.


---

Comment by saraedum created at 2018-05-20 23:25:23

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2018-05-20 23:25:23

Looks good. I think you want to drop an "s" and replace `"Test whether count and integrate are functionals."` with
`"Test whether ``count`` and ``integrate`` are functional."` Also, I think that our new files should have copyright headers at least that's what the developer guide suggests.

The patchbot run looks weird. Do you understand what's going on?


---

Comment by vdelecroix created at 2018-05-21 06:05:56

This is a reasonable failure that has to be fixed

```
sage -t --long --warn-long 80.1 src/sage/interfaces/latte.py
**********************************************************************
File "src/sage/interfaces/latte.py", line 45, in sage.interfaces.latte.count
Failed example:
    from sage.interfaces.latte import count
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.latte.count[0]>", line 1, in <module>
        from sage.interfaces.latte import count
      File "/opt/sage/local/lib/python2.7/site-packages/sage/interfaces/latte.py", line 18, in <module>
        Latte().require()
      File "/opt/sage/local/lib/python2.7/site-packages/sage/features/__init__.py", line 158, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    FeatureNotPresentError: LattE is not available.
    Executable 'count' not found on PATH.
    To install count you can try to run 'sage -i latte_int'.
    Further installation instructions might be available at https://www.math.ucdavis.edu/~latte/software.php.
```



---

Comment by git created at 2018-05-28 13:49:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2018-05-28 14:00:19

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2018-05-28 14:01:03

rebased on beta3... needs review


---

Comment by davidloeffler created at 2018-05-29 12:56:16

There's something about this ticket which seems to make patchbots crash. Whenever my patchbot (fermat) gets around to testing this ticket, it gets as far as applying the patch + building docs, and then it hangs -- the python subprocesses that are spawned to build the various ref manual chapters somehow get stuck + don't terminate.

Any idea what could be causing this? No other currently-open ticket causes this behaviour.


---

Comment by vdelecroix created at 2018-05-29 13:49:00

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-05-29 13:49:00

I made a check at import time... if it fails it is possible that sphinx hang forever. I will test.


---

Comment by git created at 2018-05-30 14:06:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-05-30 14:06:12

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2018-06-01 23:28:56

feel free to set this to positive review if the patchbot issue is fixed now.


---

Comment by vdelecroix created at 2018-06-03 08:27:45

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-06 19:53:43

Resolution: fixed
