# Issue 30603: small improvement in Hasse diagram

Issue created by migration from https://trac.sagemath.org/ticket/30840

Original creator: chapoton

Original creation time: 2020-10-30 10:09:04

CC:  tscrim

faster "are_comparable" and "are_incomparable" methods


---

Comment by chapoton created at 2020-10-30 10:09:39

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-10-30 10:09:39

New commits:


---

Comment by git created at 2020-10-30 17:57:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-30 17:57:47

New commits:


---

Comment by git created at 2020-10-30 18:12:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-30 19:53:13

Changing keywords from "" to "poset".


---

Comment by git created at 2020-10-30 21:36:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-31 08:20:05

adding some before/after timings. Not so conclusive maybe ?


---

Comment by chapoton created at 2020-10-31 08:33:42

more timings


---

Comment by chapoton created at 2020-11-05 20:00:49

bot is morally green. Any opinion ?


---

Comment by tscrim created at 2020-11-05 23:00:38

I think this is good. It seems like the timings get no worse (or perhaps slightly), but sometimes significantly better.

Some technical comments:

`IncreasingChains` documentation is weird. I would move the `__init__` docstring to the class level.

Why this removal?

```diff
-        Eventually the following syntax will be accepted::
-
-            sage: C.subset(size = 2) # todo: not implemented
-
```


You probably could get a little more speed out of the `IncreasingChains` by type specifying variables. I am thinking for `_vertices` and `_greater_than` being lists (or even more specific for `_vertices`, an array of `Py_ssize_t`). I wonder slightly about the use of hash tables versus (ordered?) lists for the `_greater_than` as the number of covers of an element tends to be relatively small compared to the number of elements in a poset. However, this isn't anything worth holding up this ticket for.


---

Comment by git created at 2020-11-06 11:19:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2020-11-06 11:20:23

I have added some cdef in the methods.

Stupid me, but how to give types to attributes of the class when then class itself cannot be "cdef'ed" ?


---

Comment by tscrim created at 2020-11-06 22:00:49

Thank you for the changes.

Ah, I didn't notice that it was not an extension class. Actually, that is something we should change very soon by moving and making `SearchForest` into the `recursively_enumerated_set.pyx`... At least that aspect should be trivial: to move and `cdef` the class.

Unfortunately I don't think you can do that. Although you can type cast it everywhere it could be useful.

Also, the `IncreasingChains.__init__` now needs a doctest; a good old `TestSuite(foo).run()` perhaps.


---

Comment by git created at 2020-11-07 13:53:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-11-07 13:54:14

ok, then here is the missing doctest. Maybe good to go ?


---

Comment by tscrim created at 2020-11-08 00:42:15

Yes, this is good. We can make further improvements later on.


---

Comment by tscrim created at 2020-11-08 00:42:15

Changing status from needs_review to positive_review.


---

Comment by git created at 2020-11-08 08:54:11

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2020-11-08 08:54:11

Changing status from positive_review to needs_review.


---

Comment by chapoton created at 2020-11-08 08:54:48

Thanks, Travis. Setting back to positive after a simple rebase.


---

Comment by chapoton created at 2020-11-08 08:54:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-11-22 15:06:27

Resolution: fixed
