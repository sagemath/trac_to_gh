# Issue 24986: Cleaning of the usage of BFS

Issue created by migration from Trac.

Original creator: saiharsh

Original creation time: 2018-04-21 22:11:44

CC:  dcoudert

Keywords: BFS Cleaning

Shifting of `simple_BFS` function from `distances_all_pairs.pyx` to `static_sparse_backend`.


---

Comment by saiharsh created at 2018-04-22 14:37:42

With reference to #25123 ticket, this ticket is created.

I have changed the location of the simple_bfs function, make all command is successfully executed, please let me know if any modifications are needed.


---

Comment by dcoudert created at 2018-04-23 16:49:09

Instead of `uint32_t n, uint32_t ** p_vertices`, could you try to pass `short_digraph g, ` instead. 
Then, inside the method, you can add shortcuts to `n` and `p_vertices`.

It's not a trivial change, since you will certainly have to report it inside `distances_all_pairs.pyx`, but in the end it will be a better code, and consistent with other methods. Thanks.


---

Comment by saiharsh created at 2018-04-23 21:35:12

Thanks for giving feedback. \\
Replying to [comment:2 dcoudert]:
> Instead of `uint32_t n, uint32_t ** p_vertices`, could you try to pass `short_digraph g, ` instead. 
> Then, inside the method, you can add shortcuts to `n` and `p_vertices`.
Sure I will try to add it.
> 
> It's not a trivial change, since you will certainly have to report it inside `distances_all_pairs.pyx`, but in the end it will be a better code, and consistent with other methods. Thanks.
Sure I will write a comment in distances_all_pairs.pyx code that `Simple_BFS` is shifted.

I have my final exam on 26th April after that I will be more active. \\
Update you as soon as possible.


---

Comment by saiharsh created at 2018-04-28 16:27:14

Replying to [comment:2 dcoudert]:
> Instead of `uint32_t n, uint32_t ** p_vertices`, could you try to pass `short_digraph g, ` instead. 
> Then, inside the method, you can add shortcuts to `n` and `p_vertices`.

I have updated the `Simple_BFS`, now it will take `short_digraph g` instead of `n` and `p_vertices` but it's leading to change the definitions of \\ 
1. `c_eccentricity_bounding` \\ 
2. `diameter_lower_bound_2sweep` \\
3. `diameter_iFUB` \\ 

In which `c_eccentricity_bounding` create `short_digraph g` of `G` so no problem with it but `diameter_lower_bound_2sweep` and `diameter_iFUB` functions take input in terms of `n` and `p_vertices`.

So what do you suggest me to do? go ahead and do necessary changes(may `diameter_lower_bound_2sweep` and `diameter_iFUB` will have future dependencies)?


---

Comment by dcoudert created at 2018-04-28 17:07:49

Yes, go ahead and do necessary changes. You will have to change the calls in method `diameter` as well and it should be enough.


---

Comment by git created at 2018-04-28 19:52:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saiharsh created at 2018-04-28 19:54:34

Replying to [comment:6 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[1ad2c57](https://git.sagemath.org/sage.git/commit/?id=1ad2c57104a9ea2e1bec424b59ad82462f1ca422)||`Completed necessary changes and comments updated only for Simple_BFS function.`||

Completed necessary changes and able to generate executable file i.e `sage`.
Comments are updated only in `Simple_BFS` function. \\
`diameter_lower_bound_multi_sweep` defination is also changed.

Let me know anymore changes required and is comment `g (short_digraph) -- The input graph.` is enough? if yes than shall I update same for remaining functions?


---

Comment by dcoudert created at 2018-04-29 07:30:59

This formulation might be better: `- ``g`` -- a short_digraph, as documented in the module sage.graphs.base.static_sparse_graph.`

- `n=g.n` -> `n = g.n`. Adding spaces is good for the readability.


---

Comment by git created at 2018-04-29 09:23:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saiharsh created at 2018-04-29 09:24:44

Replying to [comment:9 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[7230d97](https://git.sagemath.org/sage.git/commit/?id=7230d974b7f81045daa90c80a404fe6f68e48008)||`Comments updated.`||

Comments and spaces are added. \\
Please have a look.


---

Comment by dcoudert created at 2018-04-30 07:45:49

If you think the code is ready for review, please change the status to `needs review`.


---

Comment by saiharsh created at 2018-04-30 11:57:14

Changing status from new to needs_review.


---

Comment by saiharsh created at 2018-04-30 16:35:14

Replying to [comment:11 dcoudert]:
> If you think the code is ready for review, please change the status to `needs review`.
Shall I add `@`dimpase for review? \\
Shall I resume the work of #25123 concentrating on the undirected graph version?


---

Comment by dcoudert created at 2018-04-30 17:13:47

Replying to [comment:13 saiharsh]:
> Replying to [comment:11 dcoudert]:
> > If you think the code is ready for review, please change the status to `needs review`.
> Shall I add `@`dimpase for review? \\
no need.

> Shall I resume the work of #25123 concentrating on the undirected graph version?

Yes, you must 1) rebase it on top of this ticket, 2) perform necessary changes, 3) don't forget to add the dependency in the ticket description.

I will review this ticket asap (it's a long week end in France).


---

Comment by saiharsh created at 2018-04-30 17:28:58

> Yes, you must 1) rebase it on top of this ticket, 2) perform necessary changes, 3) don't forget to add the dependency in the ticket description.
> 
I will work on it and let you know asap.

> I will review this ticket asap (it's a long weekend in France).
Sorry for disturbing you during the weekend time, please take your own time.


---

Comment by vdelecroix created at 2018-05-01 12:25:51

You should fill the `Authors` field of the ticket with your full name.


---

Comment by vdelecroix created at 2018-05-01 12:25:51

Changing status from needs_review to needs_work.


---

Comment by dcoudert created at 2018-05-01 13:28:01

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2018-05-04 22:16:49

Apparently we should not declare inline method inside a .pxd file.

```
[1/3] Cythonizing sage/graphs/base/static_sparse_backend.pyx
warning: sage/graphs/base/static_sparse_backend.pxd:21:31: Declarations should not be declared inline.
...
```

So could you remove `inline` in .pxd and may be .pyx file as well.


---

Comment by vdelecroix created at 2018-05-05 11:52:56

Replying to [comment:19 dcoudert]:
> Apparently we should not declare inline method inside a .pxd file.
> {{{
> [1/3] Cythonizing sage/graphs/base/static_sparse_backend.pyx
> warning: sage/graphs/base/static_sparse_backend.pxd:21:31: Declarations should not be declared inline.
> ...
> }}}
> So could you remove `inline` in .pxd and may be .pyx file as well.

More precisely, it makes no sense to _declare_ an inline function. You have two choices for using inline

- _define_ it in a pxd, so that they are available from other Cython modules with standard cimport
- _define_ it in a pyx, in which case it is only internal to the file

Both situations are in use in Sage.


---

Comment by dcoudert created at 2018-05-05 11:57:02

Thank you for the clarification.

So here we should just remove inline in .pxd and .pyx for this method.


---

Comment by saiharsh created at 2018-05-05 12:36:38

`@`vdelecroix thanks for the clarification.
I have removed `inline` from .pxd and .pyx


---

Comment by git created at 2018-05-05 12:39:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-05-05 12:52:16

Thanks. For me this patch is now good to go.


---

Comment by dcoudert created at 2018-05-05 12:52:16

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-14 17:35:29

Resolution: fixed
