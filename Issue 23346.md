# Issue 23346: py3: some more richcmp in schemes, rings, and combinat

archive/issues_023346.json:
```json
{
    "body": "CC:  @tscrim @jdemeyer @jhpalmieri\n\nanother step one our looong road to python3\n\nIssue created by migration from https://trac.sagemath.org/ticket/23583\n\n",
    "created_at": "2017-08-05T09:39:40Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "py3: some more richcmp in schemes, rings, and combinat",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23346",
    "user": "@fchapoton"
}
```
CC:  @tscrim @jdemeyer @jhpalmieri

another step one our looong road to python3

Issue created by migration from https://trac.sagemath.org/ticket/23583





---

archive/issue_comments_326752.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-05T09:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326752",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_326753.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-05T09:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326753",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_326754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-05T15:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326754",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_326755.json:
```json
{
    "body": "I do not understand why this change is needed:\n\n```diff\n@@ -1217,7 +1219,7 @@ class AlgebraicScheme_subscheme(AlgebraicScheme):\n \n         A = self.ambient_space()\n         C = Sequence([A.subscheme(X) for X in P], check=False, cr=True)\n-        C.sort()\n+        C.sort(key=lambda sch: sch.defining_polynomials())\n         C.set_immutable()\n         self.__irreducible_components = C\n         return C\n```\n\nOtherwise LGTM.",
    "created_at": "2017-08-06T05:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326755",
    "user": "@tscrim"
}
```

I do not understand why this change is needed:

```diff
@@ -1217,7 +1219,7 @@ class AlgebraicScheme_subscheme(AlgebraicScheme):
 
         A = self.ambient_space()
         C = Sequence([A.subscheme(X) for X in P], check=False, cr=True)
-        C.sort()
+        C.sort(key=lambda sch: sch.defining_polynomials())
         C.set_immutable()
         self.__irreducible_components = C
         return C
```

Otherwise LGTM.



---

archive/issue_comments_326756.json:
```json
{
    "body": "This is needed to preserve the order of irreducible components in doctests of the same file. It turns out to change the doctest order in the tutorials.\n\nI do not quite understand why this is so, but this works.",
    "created_at": "2017-08-06T06:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326756",
    "user": "@fchapoton"
}
```

This is needed to preserve the order of irreducible components in doctests of the same file. It turns out to change the doctest order in the tutorials.

I do not quite understand why this is so, but this works.



---

archive/issue_comments_326757.json:
```json
{
    "body": "I might be paranoid, but I feel like we are changing the behavior, and without understanding why it happens. Could it come from the fact that the defining ideals are using `__cmp__` but not rich comparisons? At least, this seems the most probable to me and might be something we need to do at the same time to be a proper fix.\n\nAlso, perhaps for the rich comparisons, maybe do a rich comparisons for the ambient space? Although this last idea feels more like overkill.",
    "created_at": "2017-08-06T15:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326757",
    "user": "@tscrim"
}
```

I might be paranoid, but I feel like we are changing the behavior, and without understanding why it happens. Could it come from the fact that the defining ideals are using `__cmp__` but not rich comparisons? At least, this seems the most probable to me and might be something we need to do at the same time to be a proper fix.

Also, perhaps for the rich comparisons, maybe do a rich comparisons for the ambient space? Although this last idea feels more like overkill.



---

archive/issue_comments_326758.json:
```json
{
    "body": "I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say). Back to needs review.\n\n----\nNew commits:",
    "created_at": "2017-08-18T06:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326758",
    "user": "@fchapoton"
}
```

I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say). Back to needs review.

----
New commits:



---

archive/issue_comments_326759.json:
```json
{
    "body": "Replying to [comment:6 chapoton]:\n> I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say).\n\nI am sorry about this. I want to try and make sure we do not break anything in subtle ways by these changes. As always, thank you for your progress on all of this.",
    "created_at": "2017-08-18T09:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326759",
    "user": "@tscrim"
}
```

Replying to [comment:6 chapoton]:
> I have undone the changes involving rings and ideals (making two step forwards and one step back does not lead to steady progress, I must say).

I am sorry about this. I want to try and make sure we do not break anything in subtle ways by these changes. As always, thank you for your progress on all of this.



---

archive/issue_comments_326760.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-18T09:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326760",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_326761.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-21T19:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23346#issuecomment-326761",
    "user": "@vbraun"
}
```

Resolution: fixed
