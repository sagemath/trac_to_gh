# Issue 21377: Make atan2(0,0) return NaN

archive/issues_021377.json:
```json
{
    "body": "Same with `tan` and `imag`:\n\n```\nsage: real(sqrt(sin(x)))\nsqrt(abs(sin(x)))*cos(1/2*arctan2(cos(real_part(x))*sinh(imag_part(x)), cosh(imag_part(x))*sin(real_part(x))))\nsage: _.subs(x==0)\n...\nRuntimeError: arctan2_eval(): arctan2(0,0) encountered\n```\n\nSymPy expands similarly but gives NaN on substitution instead of an exception.\n\nThis all might not be of concern if not 3d plotting would need real/imag parts of a function, their workaround `real(...,hold=True)` works perfectly but this is not the general solution that is needed.\n\nOne solution would be to return `NaN` instead of throwing up.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21614\n\n",
    "created_at": "2016-09-30T15:48:45Z",
    "labels": [
        "component: symbolics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Make atan2(0,0) return NaN",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21377",
    "user": "https://github.com/rwst"
}
```
Same with `tan` and `imag`:

```
sage: real(sqrt(sin(x)))
sqrt(abs(sin(x)))*cos(1/2*arctan2(cos(real_part(x))*sinh(imag_part(x)), cosh(imag_part(x))*sin(real_part(x))))
sage: _.subs(x==0)
...
RuntimeError: arctan2_eval(): arctan2(0,0) encountered
```

SymPy expands similarly but gives NaN on substitution instead of an exception.

This all might not be of concern if not 3d plotting would need real/imag parts of a function, their workaround `real(...,hold=True)` works perfectly but this is not the general solution that is needed.

One solution would be to return `NaN` instead of throwing up.

Issue created by migration from https://trac.sagemath.org/ticket/21614





---

archive/issue_comments_296492.json:
```json
{
    "body": "I'm a bit uncomfortable with the idea of returning NaN for exact (as opposed to floating-point) input... But more importantly, my feeling is that we need to decide and **document** once and for all how symbolic functions should behave depending on the type, parent and value of their argument(s), based on the many examples you collected, instead of coming up with ad hoc solutions every time.",
    "created_at": "2016-10-01T09:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296492",
    "user": "https://github.com/mezzarobba"
}
```

I'm a bit uncomfortable with the idea of returning NaN for exact (as opposed to floating-point) input... But more importantly, my feeling is that we need to decide and **document** once and for all how symbolic functions should behave depending on the type, parent and value of their argument(s), based on the many examples you collected, instead of coming up with ad hoc solutions every time.



---

archive/issue_comments_296493.json:
```json
{
    "body": "Then make it known in that **documentation** that I just decided that symbolic NaN is to be returned whenever the result is not defined, not even complex infinity. That pertains to expressions, not relations. It could also be returned with `0/0`.\n\nI think the SymPy folks have thought more about their ad hoc solution, and if I copy it it's not ad hoc, either.\n\n\n```\nNot a Number.\n\nThis serves as a place holder for numeric values that are indeterminate.\nMost operations on NaN, produce another NaN.  Most indeterminate forms,\nsuch as ``0/0`` or ``oo - oo` produce NaN.  Two exceptions are ``0**0``\nand ``oo**0``, which all produce ``1`` (this is consistent with Python's\nfloat).\n\nNaN is loosely related to floating point nan, which is defined in the\nIEEE 754 floating point standard, and corresponds to the Python\n``float('nan')``.  Differences are noted below.\n\nNaN is mathematically not equal to anything else, even NaN itself.  This\nexplains the initially counter-intuitive results with ``Eq`` and ``==`` in\nthe examples below.\n\nNaN is not comparable so inequalities raise a TypeError.  This is in\nconstrast with floating point nan where all inequalities are false.\n```\n",
    "created_at": "2016-10-01T12:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296493",
    "user": "https://github.com/rwst"
}
```

Then make it known in that **documentation** that I just decided that symbolic NaN is to be returned whenever the result is not defined, not even complex infinity. That pertains to expressions, not relations. It could also be returned with `0/0`.

I think the SymPy folks have thought more about their ad hoc solution, and if I copy it it's not ad hoc, either.


```
Not a Number.

This serves as a place holder for numeric values that are indeterminate.
Most operations on NaN, produce another NaN.  Most indeterminate forms,
such as ``0/0`` or ``oo - oo` produce NaN.  Two exceptions are ``0**0``
and ``oo**0``, which all produce ``1`` (this is consistent with Python's
float).

NaN is loosely related to floating point nan, which is defined in the
IEEE 754 floating point standard, and corresponds to the Python
``float('nan')``.  Differences are noted below.

NaN is mathematically not equal to anything else, even NaN itself.  This
explains the initially counter-intuitive results with ``Eq`` and ``==`` in
the examples below.

NaN is not comparable so inequalities raise a TypeError.  This is in
constrast with floating point nan where all inequalities are false.
```




---

archive/issue_comments_296494.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-02T14:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296494",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_296495.json:
```json
{
    "body": "Replying to [comment:3 rws]:\n> Then make it known in that **documentation** that I just decided that symbolic NaN is to be returned whenever the result is not defined, not even complex infinity. That pertains to expressions, not relations. It could also be returned with `0/0`.\n\nSorry if my comment came off as a criticism, that was not the intent. What I'm trying to say is that I find this kind of tickets hard to review, because I'm unable to tell if the change is actually an improvement (because it fixes a perceived issue) or a regression (typically because it introduces an inconsistency across different parts of Sage).",
    "created_at": "2016-10-03T12:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296495",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:3 rws]:
> Then make it known in that **documentation** that I just decided that symbolic NaN is to be returned whenever the result is not defined, not even complex infinity. That pertains to expressions, not relations. It could also be returned with `0/0`.

Sorry if my comment came off as a criticism, that was not the intent. What I'm trying to say is that I find this kind of tickets hard to review, because I'm unable to tell if the change is actually an improvement (because it fixes a perceived issue) or a regression (typically because it introduces an inconsistency across different parts of Sage).



---

archive/issue_comments_296496.json:
```json
{
    "body": "It is very hard to keep an overview of all details that can appear in \"symbolics\" (minus algebra). There are some bright people leading the SymPy effort. I think it's a good start to follow them.",
    "created_at": "2016-10-03T13:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296496",
    "user": "https://github.com/rwst"
}
```

It is very hard to keep an overview of all details that can appear in "symbolics" (minus algebra). There are some bright people leading the SymPy effort. I think it's a good start to follow them.



---

archive/issue_comments_296497.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-06T14:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296497",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_296498.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-11T16:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296498",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_296499.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-12T23:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21377#issuecomment-296499",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_020228.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-12T23:01:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21377",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21377#event-20228"
}
```
