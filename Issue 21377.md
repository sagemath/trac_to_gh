# Issue 21377: Make atan2(0,0) return NaN

Issue created by migration from https://trac.sagemath.org/ticket/21614

Original creator: rws

Original creation time: 2016-09-30 15:48:45

Same with `tan` and `imag`:

```
sage: real(sqrt(sin(x)))
sqrt(abs(sin(x)))*cos(1/2*arctan2(cos(real_part(x))*sinh(imag_part(x)), cosh(imag_part(x))*sin(real_part(x))))
sage: _.subs(x==0)
...
RuntimeError: arctan2_eval(): arctan2(0,0) encountered
```

SymPy expands similarly but gives NaN on substitution instead of an exception.

This all might not be of concern if not 3d plotting would need real/imag parts of a function, their workaround `real(...,hold=True)` works perfectly but this is not the general solution that is needed.

One solution would be to return `NaN` instead of throwing up.


---

Comment by mmezzarobba created at 2016-10-01 09:39:45

I'm a bit uncomfortable with the idea of returning NaN for exact (as opposed to floating-point) input... But more importantly, my feeling is that we need to decide and **document** once and for all how symbolic functions should behave depending on the type, parent and value of their argument(s), based on the many examples you collected, instead of coming up with ad hoc solutions every time.


---

Comment by rws created at 2016-10-01 12:54:38

Then make it known in that **documentation** that I just decided that symbolic NaN is to be returned whenever the result is not defined, not even complex infinity. That pertains to expressions, not relations. It could also be returned with `0/0`.

I think the SymPy folks have thought more about their ad hoc solution, and if I copy it it's not ad hoc, either.


```
Not a Number.

This serves as a place holder for numeric values that are indeterminate.
Most operations on NaN, produce another NaN.  Most indeterminate forms,
such as ``0/0`` or ``oo - oo` produce NaN.  Two exceptions are ``0**0``
and ``oo**0``, which all produce ``1`` (this is consistent with Python's
float).

NaN is loosely related to floating point nan, which is defined in the
IEEE 754 floating point standard, and corresponds to the Python
``float('nan')``.  Differences are noted below.

NaN is mathematically not equal to anything else, even NaN itself.  This
explains the initially counter-intuitive results with ``Eq`` and ``==`` in
the examples below.

NaN is not comparable so inequalities raise a TypeError.  This is in
constrast with floating point nan where all inequalities are false.
```



---

Comment by rws created at 2016-10-02 14:44:34

New commits:


---

Comment by mmezzarobba created at 2016-10-03 12:40:58

Replying to [comment:3 rws]:
> Then make it known in that **documentation** that I just decided that symbolic NaN is to be returned whenever the result is not defined, not even complex infinity. That pertains to expressions, not relations. It could also be returned with `0/0`.

Sorry if my comment came off as a criticism, that was not the intent. What I'm trying to say is that I find this kind of tickets hard to review, because I'm unable to tell if the change is actually an improvement (because it fixes a perceived issue) or a regression (typically because it introduces an inconsistency across different parts of Sage).


---

Comment by rws created at 2016-10-03 13:03:46

It is very hard to keep an overview of all details that can appear in "symbolics" (minus algebra). There are some bright people leading the SymPy effort. I think it's a good start to follow them.


---

Comment by rws created at 2016-11-06 14:26:39

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-11-11 16:43:11

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-12 23:01:20

Resolution: fixed
