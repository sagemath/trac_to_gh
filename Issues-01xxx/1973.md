# Issue 1973: [with positive review] native partition_associated function

archive/issues_001973.json:
```json
{
    "body": "This patch replaces the wrapper around Gap to give the conjugate partition.  It speeds up the computation quite a bit.\n\n\n**Assignee:** @mwhansen\n\n**CC:**  sage-combinat\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/1973\n\n",
    "closed_at": "2008-02-01T04:24:50Z",
    "created_at": "2008-01-29T16:13:05Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.10.1",
    "title": "[with positive review] native partition_associated function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/1973",
    "user": "https://github.com/jasongrout"
}
```
This patch replaces the wrapper around Gap to give the conjugate partition.  It speeds up the computation quite a bit.


**Assignee:** @mwhansen

**CC:**  sage-combinat

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/1973





---

archive/attachments_001628.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "conjugate-partition.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket1973/conjugate-partition.patch",
    "created_at": "2008-01-29T16:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```



---

archive/issue_comments_013906.json:
```json
{
    "body": "<a id='comment:1'></a>\n",
    "created_at": "2008-01-29T16:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13906",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>




---

archive/issue_comments_013907.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-01-29T16:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13907",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_013908.json:
```json
{
    "body": "<a id='comment:2'></a>\nI'd say it's an improvement, but it may be better to avoid code duplication with the following:\n\n```\nsage: Partition([3,1]).conjugate()\n[2, 1, 1]\n```",
    "created_at": "2008-01-29T17:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13908",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'></a>
I'd say it's an improvement, but it may be better to avoid code duplication with the following:

```
sage: Partition([3,1]).conjugate()
[2, 1, 1]
```



---

archive/issue_comments_013909.json:
```json
{
    "body": "<a id='comment:3'></a>\nWith the patch:\n\n```\nsage: %timeit partition_associated([6,5,5,4,2,2,1])\n100000 loops, best of 3: 9.21 \u00b5s per loop\nsage: %timeit Partition([6,5,5,4,2,2,1]).conjugate()\n10000 loops, best of 3: 154 \u00b5s per loop\nsage: a=Partition([6,5,5,4,2,2,1])\nsage: %timeit a.conjugate()\n1000 loops, best of 3: 268 \u00b5s per loop\n```\n\nSo I'll probably delete the partition_associated function and replace the Partition.conjugate() function, if that's all right, and post up another patch.",
    "created_at": "2008-01-29T18:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13909",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
With the patch:

```
sage: %timeit partition_associated([6,5,5,4,2,2,1])
100000 loops, best of 3: 9.21 µs per loop
sage: %timeit Partition([6,5,5,4,2,2,1]).conjugate()
10000 loops, best of 3: 154 µs per loop
sage: a=Partition([6,5,5,4,2,2,1])
sage: %timeit a.conjugate()
1000 loops, best of 3: 268 µs per loop
```

So I'll probably delete the partition_associated function and replace the Partition.conjugate() function, if that's all right, and post up another patch.



---

archive/issue_comments_013910.json:
```json
{
    "body": "<a id='comment:4'></a>\nWell, the resason partition_associated is still there is for backward compatibility reasons.  I would make it so that partition_associated returns list(Partition(p).conjugate()). \n\n\nYou can modify Partition_class.conjugate, but make sure you return Partition_class objects.  Within the function, you can eliminate some overhead by replacing \"return Partition...\" with \"return Partition_class...\" since Partition is a wrapper function which does type-checking, etc.",
    "created_at": "2008-01-29T19:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13910",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:4'></a>
Well, the resason partition_associated is still there is for backward compatibility reasons.  I would make it so that partition_associated returns list(Partition(p).conjugate()). 


You can modify Partition_class.conjugate, but make sure you return Partition_class objects.  Within the function, you can eliminate some overhead by replacing "return Partition..." with "return Partition_class..." since Partition is a wrapper function which does type-checking, etc.



---

archive/issue_comments_013911.json:
```json
{
    "body": "<a id='comment:6'></a>\nSome timings after I put my code into partition.py:\n\n```\n[15:42] <jason-> sage: a=Partition(sum([[i]*20 for i in range(50,1,-1)],[]))\n[15:42] <jason-> sage: print len(a), len(a.conjugate('mike'))\n[15:42] <jason-> 980 50\n[15:42] <jason-> sage: %timeit a.conjugate('jason')\n[15:42] <jason-> 100 loops, best of 3: 3.34 ms per loop\n[15:42] <jason-> sage: %timeit a.conjugate('mike')\n[15:42] <jason-> 100 loops, best of 3: 3.25 ms per loop\n[15:42] <jason-> sage: %timeit a.conjugate('mikeandjason')\n[15:42] <jason-> 100 loops, best of 3: 3.05 ms per loop\n[15:42] <jason-> sage: a=Partition(sum([[i]*2 for i in range(5000,1,-1)],[]))\n[15:42] <jason-> sage: print len(a), len(a.conjugate('mike'))\n[15:42] <jason-> 9998 5000\n[15:42] <jason-> sage: %timeit a.conjugate('jason')\n[15:42] <jason-> 10 loops, best of 3: 246 ms per loop\n[15:42] <jason-> sage: %timeit a.conjugate('mike')\n[15:42] <jason-> 10 loops, best of 3: 34.8 ms per loop\n[15:42] <jason-> sage: %timeit a.conjugate('mikeandjason')\n[15:42] <jason-> 10 loops, best of 3: 32.4 ms per loop\n[15:42] <jason-> we both win this time.\n[15:42] <jason-> 'mikeandjason' is making a few slight modifications to your algorithm (like using .extend instead of +=, etc.)\n```\n\nSo I'll post a minor patch to Mike's code.",
    "created_at": "2008-01-29T21:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13911",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
Some timings after I put my code into partition.py:

```
[15:42] <jason-> sage: a=Partition(sum([[i]*20 for i in range(50,1,-1)],[]))
[15:42] <jason-> sage: print len(a), len(a.conjugate('mike'))
[15:42] <jason-> 980 50
[15:42] <jason-> sage: %timeit a.conjugate('jason')
[15:42] <jason-> 100 loops, best of 3: 3.34 ms per loop
[15:42] <jason-> sage: %timeit a.conjugate('mike')
[15:42] <jason-> 100 loops, best of 3: 3.25 ms per loop
[15:42] <jason-> sage: %timeit a.conjugate('mikeandjason')
[15:42] <jason-> 100 loops, best of 3: 3.05 ms per loop
[15:42] <jason-> sage: a=Partition(sum([[i]*2 for i in range(5000,1,-1)],[]))
[15:42] <jason-> sage: print len(a), len(a.conjugate('mike'))
[15:42] <jason-> 9998 5000
[15:42] <jason-> sage: %timeit a.conjugate('jason')
[15:42] <jason-> 10 loops, best of 3: 246 ms per loop
[15:42] <jason-> sage: %timeit a.conjugate('mike')
[15:42] <jason-> 10 loops, best of 3: 34.8 ms per loop
[15:42] <jason-> sage: %timeit a.conjugate('mikeandjason')
[15:42] <jason-> 10 loops, best of 3: 32.4 ms per loop
[15:42] <jason-> we both win this time.
[15:42] <jason-> 'mikeandjason' is making a few slight modifications to your algorithm (like using .extend instead of +=, etc.)
```

So I'll post a minor patch to Mike's code.



---

archive/attachments_001629.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "conjugate-partition.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket1973/conjugate-partition.2.patch",
    "created_at": "2008-01-29T22:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_013912.json:
```json
{
    "body": "apply instead of first patch.",
    "created_at": "2008-01-29T22:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13912",
    "user": "https://github.com/jasongrout"
}
```

apply instead of first patch.



---

archive/issue_comments_013913.json:
```json
{
    "body": "apply instead of first two patches.",
    "created_at": "2008-01-29T22:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13913",
    "user": "https://github.com/jasongrout"
}
```

apply instead of first two patches.



---

archive/attachments_001630.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "conjugate-partition.3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket1973/conjugate-partition.3.patch",
    "created_at": "2008-01-29T22:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_013914.json:
```json
{
    "body": "Yet again, apply this instead of the previous patches.",
    "created_at": "2008-01-29T22:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13914",
    "user": "https://github.com/jasongrout"
}
```

Yet again, apply this instead of the previous patches.



---

archive/attachments_001631.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "conjugate-partition.4.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket1973/conjugate-partition.4.patch",
    "created_at": "2008-01-29T22:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_013915.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks good to me.",
    "created_at": "2008-01-29T22:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13915",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:7'></a>
Looks good to me.



---

archive/issue_comments_013916.json:
```json
{
    "body": "**Changing status** from new to positive_review.",
    "created_at": "2008-01-29T22:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13916",
    "user": "https://github.com/mwhansen"
}
```

**Changing status** from new to positive_review.



---

archive/issue_comments_013917.json:
```json
{
    "body": "<a id='comment:8'></a>\nMerged conjugate-partition.4.patch in Sage 2.10.1.rc3",
    "created_at": "2008-01-30T02:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13917",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:8'></a>
Merged conjugate-partition.4.patch in Sage 2.10.1.rc3



---

archive/issue_events_005818.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-01-30T02:51:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1973#event-5818"
}
```



---

archive/issue_comments_013918.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-01-30T02:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13918",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_comments_013919.json:
```json
{
    "body": "**Resolution changed** from fixed to .",
    "created_at": "2008-01-30T04:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13919",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution changed** from fixed to .



---

archive/issue_comments_013920.json:
```json
{
    "body": "**Changing status** from closed to reopened.",
    "created_at": "2008-01-30T04:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13920",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from closed to reopened.



---

archive/issue_comments_013921.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe following is probably trivial to fix:\n\n```\n\nException exceptions.ImportError: 'cannot import name is_FractionFieldElement' in 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense.__normalize' ignored\n---------------------------------------------------------------------------\n<type 'exceptions.AttributeError'>        Traceback (most recent call last)\n```\nbut it happens after a `sage -ba`\n\nCheers,\n\nMichael",
    "created_at": "2008-01-30T04:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13921",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
The following is probably trivial to fix:

```

Exception exceptions.ImportError: 'cannot import name is_FractionFieldElement' in 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense.__normalize' ignored
---------------------------------------------------------------------------
<type 'exceptions.AttributeError'>        Traceback (most recent call last)
```
but it happens after a `sage -ba`

Cheers,

Michael



---

archive/issue_comments_013922.json:
```json
{
    "body": "<a id='comment:10'></a>\nReverted for good. Somebody needs to revisit this with 2.10.1.rc3 or later.\n\nCheers,\n\nMichael",
    "created_at": "2008-01-30T08:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13922",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:10'></a>
Reverted for good. Somebody needs to revisit this with 2.10.1.rc3 or later.

Cheers,

Michael



---

archive/issue_comments_013923.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2008-01-30T08:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13923",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_013924.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe error apparently has to do with the top-level import in combinat.py:\n\n    from sage.combinat.partition import Partition\n\nWhen I move the top-level import into the associated_partition function, the failing doctest passes.\n\nMike, do you know what is going on?",
    "created_at": "2008-01-30T16:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13924",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:11'></a>
The error apparently has to do with the top-level import in combinat.py:

    from sage.combinat.partition import Partition

When I move the top-level import into the associated_partition function, the failing doctest passes.

Mike, do you know what is going on?



---

archive/attachments_001632.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "conjugate-partition.5.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket1973/conjugate-partition.5.patch",
    "created_at": "2008-01-31T06:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_013925.json:
```json
{
    "body": "<a id='comment:12'></a>\nI posted a new patch which should take care of this issue (although I never experienced the -ba issue on my machine).",
    "created_at": "2008-01-31T06:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13925",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:12'></a>
I posted a new patch which should take care of this issue (although I never experienced the -ba issue on my machine).



---

archive/attachments_001633.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "1973.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket1973/1973.patch",
    "created_at": "2008-02-01T04:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_013926.json:
```json
{
    "body": "",
    "created_at": "2008-02-01T04:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13926",
    "user": "https://github.com/mwhansen"
}
```





---

archive/issue_comments_013927.json:
```json
{
    "body": "<a id='comment:13'></a>\nMerged 1973.patch in Sage 2.10.1.rc4",
    "created_at": "2008-02-01T04:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13927",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:13'></a>
Merged 1973.patch in Sage 2.10.1.rc4



---

archive/issue_comments_013928.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-02-01T04:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13928",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_events_005819.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-02-01T04:24:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1973#event-5819"
}
```



---

archive/issue_events_005820.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "rename": {
        "from": "native partition_associated function",
        "to": "[with positive review] native partition_associated function"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1973#event-5820"
}
```



---

archive/issue_comments_013929.json:
```json
{
    "body": "<a id='comment:14'></a>\nPatch looks good to me.\n\nCheers,\n\nMichael",
    "created_at": "2008-02-01T04:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1973",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1973#issuecomment-13929",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:14'></a>
Patch looks good to me.

Cheers,

Michael
