# Issue 1958: fix problems with ANSI codes in sage0.py

archive/issues_001958.json:
```json
{
    "assignees": [],
    "body": "There were some annoying doctest failures in sage0.py in 2.10.1.rc1, which are due to weird issues with ANSI codes ending up in the result of eval(). This parses them to get the correct answer.\n\nI think there's possibly a deeper readline issue here, but that's mostly wild speculation.\n\nAssignee: **@craigcitro**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/1958_\n\n",
    "closed_at": "2008-01-29T12:43:52Z",
    "created_at": "2008-01-28T04:36:50Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-2.10.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fix problems with ANSI codes in sage0.py",
    "type": "issue",
    "updated_at": "2008-01-29T12:43:52Z",
    "url": "https://github.com/sagemath/sage/issues/1958",
    "user": "https://github.com/craigcitro"
}
```
There were some annoying doctest failures in sage0.py in 2.10.1.rc1, which are due to weird issues with ANSI codes ending up in the result of eval(). This parses them to get the correct answer.

I think there's possibly a deeper readline issue here, but that's mostly wild speculation.

Assignee: **@craigcitro**

_Issue created by migration from https://trac.sagemath.org/ticket/1958_





---

archive/issue_events_017246.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-01-28T04:36:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "milestone_number": null,
    "milestone_title": "sage-2.10.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17246"
}
```



---

archive/issue_events_017247.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-01-28T04:36:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17247"
}
```



---

archive/issue_events_017248.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-01-28T04:36:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17248"
}
```



---

archive/issue_events_017249.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-01-28T04:36:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17249"
}
```



---

archive/issue_events_017250.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-01-28T04:36:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17250"
}
```



---

archive/issue_comments_009813.json:
```json
{
    "body": "Attachment: **[1958-sage0-fix.patch.gz](https://github.com/sagemath/sage/files/ticket1958/1958-sage0-fix.patch.gz)**",
    "created_at": "2008-01-28T04:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1958#issuecomment-9813",
    "user": "https://github.com/craigcitro"
}
```

Attachment: **[1958-sage0-fix.patch.gz](https://github.com/sagemath/sage/files/ticket1958/1958-sage0-fix.patch.gz)**



---

archive/issue_comments_009814.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThere is some more info on #1942, which now has been closed as a dupe of this ticket.\n\nCheers,\n\nMichael",
    "created_at": "2008-01-28T06:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1958#issuecomment-9814",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:2'>Comment 2:</a>
There is some more info on #1942, which now has been closed as a dupe of this ticket.

Cheers,

Michael



---

archive/issue_comments_009815.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nAttachment: **[1958-bandaid-v2.patch.gz](https://github.com/sagemath/sage/files/ticket1958/1958-bandaid-v2.patch.gz)**\n\nAttached a better band-aid for this, at wstein's suggestion.",
    "created_at": "2008-01-28T06:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1958#issuecomment-9815",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:3'>Comment 3:</a>
Attachment: **[1958-bandaid-v2.patch.gz](https://github.com/sagemath/sage/files/ticket1958/1958-bandaid-v2.patch.gz)**

Attached a better band-aid for this, at wstein's suggestion.



---

archive/issue_comments_009816.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nNote: you only want the second patch; it's a *replacement* for the first, not in addition to.",
    "created_at": "2008-01-28T07:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1958#issuecomment-9816",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:4'>Comment 4:</a>
Note: you only want the second patch; it's a *replacement* for the first, not in addition to.



---

archive/issue_comments_009817.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nWorked for me on Fedoa 7:\n\n\n```\nsage -t  devel/sage-main/sage/interfaces/sage0.py           ^[[?1034h\n         [7.1 s]\n\n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 7.1 seconds\n\n```\n\nHow about the extra escape code on each test line?",
    "created_at": "2008-01-28T11:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1958#issuecomment-9817",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:5'>Comment 5:</a>
Worked for me on Fedoa 7:


```
sage -t  devel/sage-main/sage/interfaces/sage0.py           ^[[?1034h
         [7.1 s]

----------------------------------------------------------------------
All tests passed!
Total time for all tests: 7.1 seconds

```

How about the extra escape code on each test line?



---

archive/issue_events_017251.json:
```json
{
    "actor": "https://github.com/jaapspies",
    "created_at": "2008-01-28T11:40:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17251"
}
```



---

archive/issue_events_017252.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-01-29T12:43:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17252"
}
```



---

archive/issue_events_017253.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-01-29T12:43:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1958#event-17253"
}
```



---

archive/issue_comments_009818.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nMerged 1958-bandaid-v2.patch in Sage 2.10.1.rc3",
    "created_at": "2008-01-29T12:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1958#issuecomment-9818",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:7'>Comment 7:</a>
Merged 1958-bandaid-v2.patch in Sage 2.10.1.rc3
