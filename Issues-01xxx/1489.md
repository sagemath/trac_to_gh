# Issue 1489: serious bug in calculus maxima parsing

archive/issues_001489.json:
```json
{
    "body": "\n```\n\n\nOn Dec 13, 2007 9:53 AM, Matthias Hillenbrand <mailanhilli@googlemail.com> wrote:\n> \n> Hello,\n> \n> doing my first steps with SAGE I have a problem dealing with small\n> numbers like 2e-6. Here is a small example:\n> \n> k=var('k')\n> a0=2e-6\n> a1=12\n> b=sqrt(a1+a0*k)\n> show(b)\n> \n> With this parameters I don't get a result but have to interrupt the\n> computation. If I change a0 to a0=2e-2, the computation only needs one\n> second.\n> \n> Am I doing something wrong?\n> \n\nNo, this is a bug in this part of Sage itself in calculus.py.  Many many thanks\nfor finding this (it will be fixed in the next Sage release, which is planned\nfor Saturday). \n\nStarting at Line 6146:\n    #replace all instances of scientific notation\n    #with regular notation\n    search = sci_not.search(s)\n    while not search is None:\n        (start, end) = search.span()\n        s = s.replace(s[start:end], str(RR(s[start:end])))\n        search = sci_not.search(s)\n\nI think this bug was caused by some recent changes in how\nreal number printing works in Sage.  In any case,\nI'm glad you found the bug, which I'm sure we will easily be\nable to fix.   \n```\n\n**Assignee:** @williamstein\n\nIssue created by migration from https://trac.sagemath.org/ticket/1489\n\n",
    "closed_at": "2007-12-14T05:11:50Z",
    "created_at": "2007-12-13T18:27:09Z",
    "labels": [
        "component: calculus",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.9",
    "title": "serious bug in calculus maxima parsing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/1489",
    "user": "https://github.com/williamstein"
}
```

```


On Dec 13, 2007 9:53 AM, Matthias Hillenbrand <mailanhilli@googlemail.com> wrote:
> 
> Hello,
> 
> doing my first steps with SAGE I have a problem dealing with small
> numbers like 2e-6. Here is a small example:
> 
> k=var('k')
> a0=2e-6
> a1=12
> b=sqrt(a1+a0*k)
> show(b)
> 
> With this parameters I don't get a result but have to interrupt the
> computation. If I change a0 to a0=2e-2, the computation only needs one
> second.
> 
> Am I doing something wrong?
> 

No, this is a bug in this part of Sage itself in calculus.py.  Many many thanks
for finding this (it will be fixed in the next Sage release, which is planned
for Saturday). 

Starting at Line 6146:
    #replace all instances of scientific notation
    #with regular notation
    search = sci_not.search(s)
    while not search is None:
        (start, end) = search.span()
        s = s.replace(s[start:end], str(RR(s[start:end])))
        search = sci_not.search(s)

I think this bug was caused by some recent changes in how
real number printing works in Sage.  In any case,
I'm glad you found the bug, which I'm sure we will easily be
able to fix.   
```

**Assignee:** @williamstein

Issue created by migration from https://trac.sagemath.org/ticket/1489





---

archive/attachments_001165.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-1489.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket1489/trac-1489.patch",
    "created_at": "2007-12-13T18:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1489",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_008788.json:
```json
{
    "body": "",
    "created_at": "2007-12-13T18:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1489#issuecomment-8788",
    "user": "https://github.com/williamstein"
}
```





---

archive/issue_comments_008789.json:
```json
{
    "body": "<a id='comment:2'></a>\nHi,\n\n2.9.alph6 + this patch passes -testall on OSX 10.5.1. It also looks cleaner and reuses hopefully better tested existing code. So my vote is on merging.\n\nCheers,\n\nMichael",
    "created_at": "2007-12-13T21:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1489#issuecomment-8789",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>
Hi,

2.9.alph6 + this patch passes -testall on OSX 10.5.1. It also looks cleaner and reuses hopefully better tested existing code. So my vote is on merging.

Cheers,

Michael



---

archive/issue_comments_008790.json:
```json
{
    "body": "**Changing status** from new to positive_review.",
    "created_at": "2007-12-13T21:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1489#issuecomment-8790",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from new to positive_review.



---

archive/issue_events_004448.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2007-12-14T05:11:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/1489",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1489#event-4448"
}
```



---

archive/issue_comments_008791.json:
```json
{
    "body": "<a id='comment:3'></a>\nMerged in 2.9.alpha7.",
    "created_at": "2007-12-14T05:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1489#issuecomment-8791",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:3'></a>
Merged in 2.9.alpha7.
