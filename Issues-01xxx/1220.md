# Issue 1220: ModularSymbols(GammaH)

archive/issues_001220.json:
```json
{
    "body": "On Nov 20, 2007 9:52 AM, Iftikhar Burhanuddin wrote:\n>\n> Hi folks,\n>\n> Gamma_H(N) are SL_2(Z) matrices where the lower left entry is\n> congruent to 0 mod N, and the upper left and lower right entries are\n> elements of a specified subgroup H of (Z/N)*.\n>\n> Sage raises an exception when computing ModularSymbols for the congruence\n> subgroup Gamma_H(N) of weight 2. Is this a bug?\n\nYes.  Report it on trac.  This will actually probably be pretty hard\nto debug, but I will\ndo it as soon as I get a chance.  Modular symbols for Gamma_H are\npretty subtle...\nIn the meantime, keep in mind that you can compute most things by reducing\nto computing modular symbols with some character.  In fact over CC at least\nmodular symbols for Gamma_H(N) are the same as the direct sum over\ncharacters chi\nthat vanish on H of modular symbols for chi.   In particular, I think\nthe following\ncalculation shows that ModularSymbols(Gamma_H(N)) for your particular example\nis just isomorphic to ModularSymbols(Gamma_0(N)):\n\n```\nsage: G = GammaH(36, [13,19])\nsage: G\nCongruence Subgroup Gamma_H(36) with H generated by [13, 19]\nsage: ModularSymbols(G, 2)\nTraceback (most recent call last):\n...\nAssertionError\nsage: X = G._list_of_elements_in_H(); X\n[1, 7, 13, 19, 25, 31]\nsage: euler_phi(36)\n12\nsage: H.<a,b> = DirichletGroup(36)\nsage: for eps in H:\n...       print eps, len(set([eps(w) for w in X]))\n[1, 1] 1\n[-1, 1] 2\n[1, zeta6] 3\n[-1, zeta6] 6\n[1, zeta6 - 1] 3\n[-1, zeta6 - 1] 6\n[1, -1] 1\n[-1, -1] 2\n[1, -zeta6] 3\n[-1, -zeta6] 6\n[1, -zeta6 + 1] 3\n[-1, -zeta6 + 1] 6\nsage: eps = H([1,-1])  # vanishes on X\nsage: ModularSymbols(eps)\nModular Symbols space of dimension 0 and level 36, weight 2, character\n[1, -1], sign 0, over Rational Field\n```\n\nNotice that the dimension is 0....\n\nWilliam\n\n\n**Assignee:** @craigcitro\n\nIssue created by migration from https://trac.sagemath.org/ticket/1220\n\n",
    "closed_at": "2008-08-12T23:35:10Z",
    "created_at": "2007-11-20T21:22:31Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.1",
    "title": "ModularSymbols(GammaH)",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/1220",
    "user": "https://trac.sagemath.org/admin/accounts/users/ifti"
}
```
On Nov 20, 2007 9:52 AM, Iftikhar Burhanuddin wrote:
>
> Hi folks,
>
> Gamma_H(N) are SL_2(Z) matrices where the lower left entry is
> congruent to 0 mod N, and the upper left and lower right entries are
> elements of a specified subgroup H of (Z/N)*.
>
> Sage raises an exception when computing ModularSymbols for the congruence
> subgroup Gamma_H(N) of weight 2. Is this a bug?

Yes.  Report it on trac.  This will actually probably be pretty hard
to debug, but I will
do it as soon as I get a chance.  Modular symbols for Gamma_H are
pretty subtle...
In the meantime, keep in mind that you can compute most things by reducing
to computing modular symbols with some character.  In fact over CC at least
modular symbols for Gamma_H(N) are the same as the direct sum over
characters chi
that vanish on H of modular symbols for chi.   In particular, I think
the following
calculation shows that ModularSymbols(Gamma_H(N)) for your particular example
is just isomorphic to ModularSymbols(Gamma_0(N)):

```
sage: G = GammaH(36, [13,19])
sage: G
Congruence Subgroup Gamma_H(36) with H generated by [13, 19]
sage: ModularSymbols(G, 2)
Traceback (most recent call last):
...
AssertionError
sage: X = G._list_of_elements_in_H(); X
[1, 7, 13, 19, 25, 31]
sage: euler_phi(36)
12
sage: H.<a,b> = DirichletGroup(36)
sage: for eps in H:
...       print eps, len(set([eps(w) for w in X]))
[1, 1] 1
[-1, 1] 2
[1, zeta6] 3
[-1, zeta6] 6
[1, zeta6 - 1] 3
[-1, zeta6 - 1] 6
[1, -1] 1
[-1, -1] 2
[1, -zeta6] 3
[-1, -zeta6] 6
[1, -zeta6 + 1] 3
[-1, -zeta6 + 1] 6
sage: eps = H([1,-1])  # vanishes on X
sage: ModularSymbols(eps)
Modular Symbols space of dimension 0 and level 36, weight 2, character
[1, -1], sign 0, over Rational Field
```

Notice that the dimension is 0....

William


**Assignee:** @craigcitro

Issue created by migration from https://trac.sagemath.org/ticket/1220





---

archive/issue_events_005653.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2007-11-23T00:13:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "milestone": "sage-2.8.14",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5653"
}
```



---

archive/issue_comments_005798.json:
```json
{
    "body": "**Changing assignee** from @williamstein to @craigcitro.",
    "created_at": "2008-06-26T06:55:12Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5798",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing assignee** from @williamstein to @craigcitro.



---

archive/issue_comments_005799.json:
```json
{
    "body": "<a id='comment:2'></a>\nStill broken in Sage 3.0.3 and maybe a job for Craig Citro :)\n\nCheers,\n\nMichael",
    "created_at": "2008-06-26T06:55:12Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5799",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>
Still broken in Sage 3.0.3 and maybe a job for Craig Citro :)

Cheers,

Michael



---

archive/issue_comments_005800.json:
```json
{
    "body": "<a id='comment:3'></a>\nCraig Citro to the rescue! I have a fix for this. The problem is that the `_reduce_coset` method on `GammaH` is broken. I'll clean up the fix and post it within a few days. (I'm just noting this so no one else spends time tracking this down.)",
    "created_at": "2008-07-25T01:42:11Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5800",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:3'></a>
Craig Citro to the rescue! I have a fix for this. The problem is that the `_reduce_coset` method on `GammaH` is broken. I'll clean up the fix and post it within a few days. (I'm just noting this so no one else spends time tracking this down.)



---

archive/issue_comments_005801.json:
```json
{
    "body": "<a id='comment:4'></a>\nHi Craig,\n\nany movement here? It has been a week ;)\n\nCheers,\n\nMichael",
    "created_at": "2008-07-31T03:42:54Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5801",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Hi Craig,

any movement here? It has been a week ;)

Cheers,

Michael



---

archive/issue_comments_005802.json:
```json
{
    "body": "<a id='comment:5'></a>\nYep, and I'll get on it Sunday, when I'm back from my honeymoon.",
    "created_at": "2008-07-31T03:47:19Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5802",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:5'></a>
Yep, and I'll get on it Sunday, when I'm back from my honeymoon.



---

archive/issue_comments_005803.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@craigcitro](#comment%3A5):\n> Yep, and I'll get on it Sunday, when I'm back from my honeymoon.\n\nDon't worry about it then. Have fun :)\n\nCheers,\n\nMichael",
    "created_at": "2008-07-31T03:57:03Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5803",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
Replying to [@craigcitro](#comment%3A5):
> Yep, and I'll get on it Sunday, when I'm back from my honeymoon.

Don't worry about it then. Have fun :)

Cheers,

Michael



---

archive/issue_events_005654.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-08-11T10:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "milestone": "sage-3.1.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5654"
}
```



---

archive/issue_events_005655.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-08-11T10:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "milestone": "sage-3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5655"
}
```



---

archive/issue_comments_005804.json:
```json
{
    "body": "<a id='comment:7'></a>\nOk, the fix is attached, with a handful more. The patch fixes the bug, which is that the `_reduce_coset` method was broken for `GammaH`. I rewrote it instead of fixing it, and it's roughly the same speed for some cases, and much faster in others: \n\nOLD:\n\n```\nsage: G = GammaH(99,[67])\nsage: %timeit G._reduce_coset(77, -3)\n10000 loops, best of 3: 42.1 \u00c2\u00b5s per loop\nsage: %timeit G._reduce_coset(11, -3)\n10000 loops, best of 3: 36.9 \u00c2\u00b5s per loop\n```\n\nNEW:\n\n```\nsage: G = GammaH(99,[67])\nsage: %timeit G._reduce_coset(77, -3)\n100000 loops, best of 3: 17.3 \u00c2\u00b5s per loop\nsage: %timeit G._reduce_coset(11, -3)\n100000 loops, best of 3: 17.2 \u00c2\u00b5s per loop\n```\n\nAlso, because I was fixing up functions in `modular/congroup.py`, I got carried away and doctested all of `congroup.py` and `congroup_element.py` ... so this patch also fixes #2527. \n\nAll doctests in `modular/` pass -- I didn't run anything beyond that.",
    "created_at": "2008-08-11T10:48:17Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5804",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:7'></a>
Ok, the fix is attached, with a handful more. The patch fixes the bug, which is that the `_reduce_coset` method was broken for `GammaH`. I rewrote it instead of fixing it, and it's roughly the same speed for some cases, and much faster in others: 

OLD:

```
sage: G = GammaH(99,[67])
sage: %timeit G._reduce_coset(77, -3)
10000 loops, best of 3: 42.1 Âµs per loop
sage: %timeit G._reduce_coset(11, -3)
10000 loops, best of 3: 36.9 Âµs per loop
```

NEW:

```
sage: G = GammaH(99,[67])
sage: %timeit G._reduce_coset(77, -3)
100000 loops, best of 3: 17.3 Âµs per loop
sage: %timeit G._reduce_coset(11, -3)
100000 loops, best of 3: 17.2 Âµs per loop
```

Also, because I was fixing up functions in `modular/congroup.py`, I got carried away and doctested all of `congroup.py` and `congroup_element.py` ... so this patch also fixes #2527. 

All doctests in `modular/` pass -- I didn't run anything beyond that.



---

archive/issue_events_005656.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-08-11T10:48:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5656"
}
```



---

archive/attachments_000914.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-1220.patch",
    "asset_url": "tarball://root/attachments/ticket1220/trac-1220.patch",
    "created_at": "2008-08-11T10:55:06Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket1220/trac-1220.patch",
    "user": "https://github.com/craigcitro"
}
```



---

archive/issue_comments_005805.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Attachment:** [trac-1220.patch](https://github.com/sagemath/sage/files/ticket1220/trac-1220.patch)\n\nOne side note: the patch is against 3.1.alpha0 -- I don't yet have an alpha1 build to test it against. I suspect there should be no issues, but I did touch `modular/modsym/boundary.py`, which I modified a lot in #3800. I think it shouldn't cause any issue (based on the specific changes), but just let me know if someone runs into merge troubles.",
    "created_at": "2008-08-11T10:55:06Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5805",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:8'></a>
**Attachment:** [trac-1220.patch](https://github.com/sagemath/sage/files/ticket1220/trac-1220.patch)

One side note: the patch is against 3.1.alpha0 -- I don't yet have an alpha1 build to test it against. I suspect there should be no issues, but I did touch `modular/modsym/boundary.py`, which I modified a lot in #3800. I think it shouldn't cause any issue (based on the specific changes), but just let me know if someone runs into merge troubles.



---

archive/issue_comments_005806.json:
```json
{
    "body": "<a id='comment:9'></a>\nIt applies to 3.1.alpha1 with some slight fuzz:\n\n```\nmabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.1.alpha2/devel/sage$ patch -p1 < trac_1220.patch \npatching file sage/modular/congroup.py\npatching file sage/modular/congroup_element.py\npatching file sage/modular/dims.py\npatching file sage/modular/modform/ambient.py\npatching file sage/modular/modform/constructor.py\npatching file sage/modular/modform/space.py\npatching file sage/modular/modsym/ambient.py\npatching file sage/modular/modsym/boundary.py\nHunk #1 succeeded at 288 (offset 146 lines).\npatching file sage/modular/modsym/manin_symbols.py\npatching file sage/modular/modsym/modsym.py\npatching file sage/rings/arith.py\nHunk #2 succeeded at 1319 (offset 17 lines).\n```\n\nCheers,\n\nMichael",
    "created_at": "2008-08-11T16:12:19Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5806",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
It applies to 3.1.alpha1 with some slight fuzz:

```
mabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.1.alpha2/devel/sage$ patch -p1 < trac_1220.patch 
patching file sage/modular/congroup.py
patching file sage/modular/congroup_element.py
patching file sage/modular/dims.py
patching file sage/modular/modform/ambient.py
patching file sage/modular/modform/constructor.py
patching file sage/modular/modform/space.py
patching file sage/modular/modsym/ambient.py
patching file sage/modular/modsym/boundary.py
Hunk #1 succeeded at 288 (offset 146 lines).
patching file sage/modular/modsym/manin_symbols.py
patching file sage/modular/modsym/modsym.py
patching file sage/rings/arith.py
Hunk #2 succeeded at 1319 (offset 17 lines).
```

Cheers,

Michael



---

archive/issue_comments_005807.json:
```json
{
    "body": "<a id='comment:10'></a>\nI am seeing two doctest failures:\n\n```\nmabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.1.alpha2$ ./sage -t -long devel/sage/sage/modular/congroup.py\nsage -t -long devel/sage/sage/modular/congroup.py\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/congroup.py\", line 103:\n    sage: Gamma0(11).__hash__()\nExpected:\n    -545929996\nGot:\n    466678398374495476\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/congroup.py\", line 105:\n    sage: Gamma1(11).__hash__()\nExpected:\n    -830809815\nGot:\n    4909638266971150633\n**********************************************************************\n1 items had failures:\n   2 of   3 in __main__.example_5\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/.doctest_congroup.py\n         [3.4 s]\nexit code: 1024\n```\nI know the first one is #random since cmp depends on memory location, I think for the second one we need #32 and #64 bit.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-11T16:28:38Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5807",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:10'></a>
I am seeing two doctest failures:

```
mabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.1.alpha2$ ./sage -t -long devel/sage/sage/modular/congroup.py
sage -t -long devel/sage/sage/modular/congroup.py
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/congroup.py", line 103:
    sage: Gamma0(11).__hash__()
Expected:
    -545929996
Got:
    466678398374495476
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/congroup.py", line 105:
    sage: Gamma1(11).__hash__()
Expected:
    -830809815
Got:
    4909638266971150633
**********************************************************************
1 items had failures:
   2 of   3 in __main__.example_5
***Test Failed*** 2 failures.
For whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/.doctest_congroup.py
         [3.4 s]
exit code: 1024
```
I know the first one is #random since cmp depends on memory location, I think for the second one we need #32 and #64 bit.

Cheers,

Michael



---

archive/issue_comments_005808.json:
```json
{
    "body": "<a id='comment:11'></a>\nOops, the above is the \"second\" failure. The first one is\"\n\n```\nage -t -long devel/sage/sage/modular/congroup_element.py   \n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/congroup_element.py\", line 72:\n    sage: x.__cmp__(3)\nExpected:\n    1\nGot:\n    -1\n**********************************************************************\n```\n\nSorry for the extra post.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-11T16:30:41Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5808",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:11'></a>
Oops, the above is the "second" failure. The first one is"

```
age -t -long devel/sage/sage/modular/congroup_element.py   
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/congroup_element.py", line 72:
    sage: x.__cmp__(3)
Expected:
    1
Got:
    -1
**********************************************************************
```

Sorry for the extra post.

Cheers,

Michael



---

archive/attachments_000915.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-1220-pt2.patch",
    "asset_url": "tarball://root/attachments/ticket1220/trac-1220-pt2.patch",
    "created_at": "2008-08-12T08:09:39Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket1220/trac-1220-pt2.patch",
    "user": "https://github.com/craigcitro"
}
```



---

archive/issue_comments_005809.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Attachment:** [trac-1220-pt2.patch](https://github.com/sagemath/sage/files/ticket1220/trac-1220-pt2.patch)\n\nYep, those are definitely issues with 32 vs. 64 bit. New patch fixes both of these doctests.",
    "created_at": "2008-08-12T08:09:39Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5809",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:12'></a>
**Attachment:** [trac-1220-pt2.patch](https://github.com/sagemath/sage/files/ticket1220/trac-1220-pt2.patch)

Yep, those are definitely issues with 32 vs. 64 bit. New patch fixes both of these doctests.



---

archive/issue_comments_005810.json:
```json
{
    "body": "<a id='comment:13'></a>\nWow, you have done an amazing job on this -- very impressive documentation as well.\n\nThe two patches apply completely cleanly to my 3.1.alpha1.  (I think Michael's fuzz was with alpha2.)\n\nYou have included doctests showing that the original problem is solved.\n\nI tested all in sage.modular and had one failure, which appears to be the one I already reported and Craig has sorted elsewhere:\n\n```\nsage -t  devel/sage-1220/sage/modular/modsym/tests.py       **********************************************************************\nFile \"/home/john/sage-3.1.alpha1/tmp/tests.py\", line 207:\n    sage: sage.modular.modsym.tests.Test().random(1)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/john/sage-3.1.alpha1/local/lib/python2.5/doctest.py\", line 1228, in __run\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_10[1]>\", line 1, in <module>\n        sage.modular.modsym.tests.Test().random(Integer(1))###line 207:\n    sage: sage.modular.modsym.tests.Test().random(1)\n      File \"/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py\", line 211, in random\n        self.test(\"random\", seconds)\n      File \"/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py\", line 235, in test\n        self._do(name)\n      File \"/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py\", line 196, in _do\n        Test.__dict__[\"test_%s\"%name](self)\n      File \"/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py\", line 333, in test_random\n        Test.__dict__[name](self)\n      File \"/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py\", line 264, in test_csnew_dimension\n        V = M.cuspidal_submodule().new_submodule()\n      File \"/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/ambient.py\", line 896, in cuspidal_submodule\n        assert d == S.dimension(), \"According to dimension formulas the cuspidal subspace of \\\"%s\\\" has dimension %s; however, computing it using modular symbols we obtained %s, so there is a bug (please report!).\"%(self, d, S.dimension())\n    AssertionError: According to dimension formulas the cuspidal subspace of \"Modular Symbols space of dimension 6 and level 12, weight 4, character [-1, -1], sign 1, over Rational Field\" has dimension 4; however, computing it using modular symbols we obtained 2, so there is a bug (please report!).\n**********************************************************************\n1 items had failures:\n   1 of   2 in __main__.example_10\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/john/sage-3.1.alpha1/tmp/.doctest_tests.py\n\t [3.9 s]\n```\n\nOnce that has been fixed the rest is ready to go.",
    "created_at": "2008-08-12T19:31:05Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5810",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
Wow, you have done an amazing job on this -- very impressive documentation as well.

The two patches apply completely cleanly to my 3.1.alpha1.  (I think Michael's fuzz was with alpha2.)

You have included doctests showing that the original problem is solved.

I tested all in sage.modular and had one failure, which appears to be the one I already reported and Craig has sorted elsewhere:

```
sage -t  devel/sage-1220/sage/modular/modsym/tests.py       **********************************************************************
File "/home/john/sage-3.1.alpha1/tmp/tests.py", line 207:
    sage: sage.modular.modsym.tests.Test().random(1)
Exception raised:
    Traceback (most recent call last):
      File "/home/john/sage-3.1.alpha1/local/lib/python2.5/doctest.py", line 1228, in __run
        compileflags, 1) in test.globs
      File "<doctest __main__.example_10[1]>", line 1, in <module>
        sage.modular.modsym.tests.Test().random(Integer(1))###line 207:
    sage: sage.modular.modsym.tests.Test().random(1)
      File "/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py", line 211, in random
        self.test("random", seconds)
      File "/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py", line 235, in test
        self._do(name)
      File "/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py", line 196, in _do
        Test.__dict__["test_%s"%name](self)
      File "/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py", line 333, in test_random
        Test.__dict__[name](self)
      File "/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/tests.py", line 264, in test_csnew_dimension
        V = M.cuspidal_submodule().new_submodule()
      File "/home/john/sage-3.1.alpha1/local/lib/python2.5/site-packages/sage/modular/modsym/ambient.py", line 896, in cuspidal_submodule
        assert d == S.dimension(), "According to dimension formulas the cuspidal subspace of \"%s\" has dimension %s; however, computing it using modular symbols we obtained %s, so there is a bug (please report!)."%(self, d, S.dimension())
    AssertionError: According to dimension formulas the cuspidal subspace of "Modular Symbols space of dimension 6 and level 12, weight 4, character [-1, -1], sign 1, over Rational Field" has dimension 4; however, computing it using modular symbols we obtained 2, so there is a bug (please report!).
**********************************************************************
1 items had failures:
   1 of   2 in __main__.example_10
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/john/sage-3.1.alpha1/tmp/.doctest_tests.py
	 [3.9 s]
```

Once that has been fixed the rest is ready to go.



---

archive/issue_events_005657.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-08-12T19:31:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "rename": {
        "from": "ModularSymbols(GammaH)",
        "to": "[with positive review but one issue remains] ModularSymbols(GammaH)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5657"
}
```



---

archive/issue_comments_005811.json:
```json
{
    "body": "<a id='comment:14'></a>\nHi John,\n\nthat issue should be addressed with the patch at #3814. So if that fixes it I can merge the tickets from both patches.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-12T19:44:41Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5811",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:14'></a>
Hi John,

that issue should be addressed with the patch at #3814. So if that fixes it I can merge the tickets from both patches.

Cheers,

Michael



---

archive/issue_comments_005812.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [mabshoff](#comment%3A14):\n> Hi John,\n> \n> that issue should be addressed with the patch at #3814. So if that fixes it I can merge the tickets from both patches.\n\nI'll try that, but #3814 has no patch that I can see!\n\nJohn\n\n> \n> Cheers,\n> \n> Michael",
    "created_at": "2008-08-12T19:57:32Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5812",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:15'></a>
Replying to [mabshoff](#comment%3A14):
> Hi John,
> 
> that issue should be addressed with the patch at #3814. So if that fixes it I can merge the tickets from both patches.

I'll try that, but #3814 has no patch that I can see!

John

> 
> Cheers,
> 
> Michael



---

archive/issue_events_005658.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-12T22:57:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "rename": {
        "from": "[with positive review but one issue remains] ModularSymbols(GammaH)",
        "to": "ModularSymbols(GammaH)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5658"
}
```



---

archive/issue_events_005659.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-12T22:57:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5659"
}
```



---

archive/issue_events_005660.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-12T22:57:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5660"
}
```



---

archive/issue_comments_005813.json:
```json
{
    "body": "<a id='comment:16'></a>\nSince this issue at question is unrelated to this code I am changing this to a positive review.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-12T22:57:29Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5813",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:16'></a>
Since this issue at question is unrelated to this code I am changing this to a positive review.

Cheers,

Michael



---

archive/issue_comments_005814.json:
```json
{
    "body": "<a id='comment:17'></a>\nMerged both patches in Sage 3.1.alpha2",
    "created_at": "2008-08-12T23:35:10Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5814",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:17'></a>
Merged both patches in Sage 3.1.alpha2



---

archive/issue_events_005661.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-12T23:35:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5661"
}
```



---

archive/issue_events_005662.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-12T23:35:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1220#event-5662"
}
```



---

archive/issue_comments_005815.json:
```json
{
    "body": "<a id='comment:18'></a>\nI also skimmed this patch and it looks good..",
    "created_at": "2008-08-13T02:16:24Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5815",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:18'></a>
I also skimmed this patch and it looks good..



---

archive/issue_comments_005816.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [mabshoff](#comment%3A16):\n> Since this issue at question is unrelated to this code I am changing this to a positive review.\n> \n> Cheers,\n> \n> Michael\n\nThat's fine by me.",
    "created_at": "2008-08-13T08:31:07Z",
    "issue": "https://github.com/sagemath/sage/issues/1220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1220#issuecomment-5816",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>
Replying to [mabshoff](#comment%3A16):
> Since this issue at question is unrelated to this code I am changing this to a positive review.
> 
> Cheers,
> 
> Michael

That's fine by me.
