# Issue 1052: implement more functionality for class groups of number fields

archive/issues_001052.json:
```json
{
    "assignees": [
        "https://github.com/loefflerd"
    ],
    "body": "There are some feature requests in this email.\n\n```\nOn 11/1/07, Utpal Sarkar wrote:\n> I'm doing some simple things with class groups, and some things don't\n> work as expected.\n> Let G be a class group of a number field. \n\nsage: K.<a> = NumberField(x^2 + 23)\nsage: G = K.class_group(); G\nClass group of order 3 with structure C3 of Number Field in a with defining polynomial x^2 + 23\n\n> I am interested in obtaining\n> the actual ideal classes\n> (is there an easy direct way? list(G) returns abstract elements. Is it\n> possible to obtain a map from the class group to the ideal group,\n> mapping class group elements to representatives?)\n\nThis is not implemented yet (the function list is just\nsomething implemented in the base abstract abelian\ngroup class, which is inherited -- it doesn't do anything\nuseful in this case, really.)   Class groups were only\nadded to sage very recently, and aren't fully implemented.\nAdding code to enumerate all elements will show up in Sage\nsoon, but it will take some work. \n\n> Since generators of G can be obtained as ideal classes, to obtain all\n> of them you just have to multiply powers of the generators, and for\n> that it would be useful to know the orders of the generators.\n> When I call\n> (G.0).order()\n> it shows an error message saying that it is not implemented (which\n> seems strange).\n\nIt isn't implemented.  You could implement a dumb order\nfunction though:\n\nsage: K.<a> = NumberField(x^2 + 23)\nsage: G = K.class_group(); G\nClass group of order 3 with structure C3 of Number Field in a with defining polynomial x^2 + 23\nsage: G.gens()\n[Fractional ideal class (2, 1/2*a - 1/2)]\nsage: a = G.0\nsage: def myorder(I):\n...       n = 1\n...       J = I\n...       while J != 1:\n...           J = J * I\n...           n += 1\n...       return n\nsage: myorder(a)\n3\n\n--\n\nI don't recommend doing this -- it's much better to understand\nhow fractional ideals, etc. are represented using the PARI\nC library in Sage, then use a call to PARI to determine the\norder of the fractional ideal class.   This is what I'll do\nwhen I implement this in the Sage library. \n\n>  I tried to work around this by generating the\n> subgroups of G generated by these generators of G in turn to obtain\n> their orders, but when I say\n> G.subgroup([G.0])\n> or\n> G.subgroup(G.gens())\n> an error results, saying that the elements passed don't belong to G.\n\nThat's because creating subgroups of ideal class groups is not implemented.  Sage should produce a NotImplementedError in this case too. \n\n\n\n -- William}}}\n\nComponent: **number fields**\n\nReviewer: **John Cremona**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/1052_\n\n",
    "closed_at": "2010-11-01T10:21:15Z",
    "created_at": "2007-11-01T19:34:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/duplicate",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "implement more functionality for class groups of number fields",
    "type": "issue",
    "updated_at": "2010-11-01T22:02:31Z",
    "url": "https://github.com/sagemath/sage/issues/1052",
    "user": "https://github.com/williamstein"
}
```
There are some feature requests in this email.

```
On 11/1/07, Utpal Sarkar wrote:
> I'm doing some simple things with class groups, and some things don't
> work as expected.
> Let G be a class group of a number field. 

sage: K.<a> = NumberField(x^2 + 23)
sage: G = K.class_group(); G
Class group of order 3 with structure C3 of Number Field in a with defining polynomial x^2 + 23

> I am interested in obtaining
> the actual ideal classes
> (is there an easy direct way? list(G) returns abstract elements. Is it
> possible to obtain a map from the class group to the ideal group,
> mapping class group elements to representatives?)

This is not implemented yet (the function list is just
something implemented in the base abstract abelian
group class, which is inherited -- it doesn't do anything
useful in this case, really.)   Class groups were only
added to sage very recently, and aren't fully implemented.
Adding code to enumerate all elements will show up in Sage
soon, but it will take some work. 

> Since generators of G can be obtained as ideal classes, to obtain all
> of them you just have to multiply powers of the generators, and for
> that it would be useful to know the orders of the generators.
> When I call
> (G.0).order()
> it shows an error message saying that it is not implemented (which
> seems strange).

It isn't implemented.  You could implement a dumb order
function though:

sage: K.<a> = NumberField(x^2 + 23)
sage: G = K.class_group(); G
Class group of order 3 with structure C3 of Number Field in a with defining polynomial x^2 + 23
sage: G.gens()
[Fractional ideal class (2, 1/2*a - 1/2)]
sage: a = G.0
sage: def myorder(I):
...       n = 1
...       J = I
...       while J != 1:
...           J = J * I
...           n += 1
...       return n
sage: myorder(a)
3

--

I don't recommend doing this -- it's much better to understand
how fractional ideals, etc. are represented using the PARI
C library in Sage, then use a call to PARI to determine the
order of the fractional ideal class.   This is what I'll do
when I implement this in the Sage library. 

>  I tried to work around this by generating the
> subgroups of G generated by these generators of G in turn to obtain
> their orders, but when I say
> G.subgroup([G.0])
> or
> G.subgroup(G.gens())
> an error results, saying that the elements passed don't belong to G.

That's because creating subgroups of ideal class groups is not implemented.  Sage should produce a NotImplementedError in this case too. 



 -- William}}}

Component: **number fields**

Reviewer: **John Cremona**

_Issue created by migration from https://trac.sagemath.org/ticket/1052_





---

archive/issue_events_010070.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-11-01T19:34:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10070"
}
```



---

archive/issue_events_010071.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-11-01T19:34:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10071"
}
```



---

archive/issue_events_010072.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-11-01T19:34:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10072"
}
```



---

archive/issue_events_010073.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-11-01T19:34:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10073"
}
```



---

archive/issue_events_010074.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-11-01T19:34:23Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10074"
}
```



---

archive/issue_comments_004586.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNOTE: The AbelianGroup class needs to be refactored, so there is an abstract base class, with lots of NotImplementedErrors, then AbelianGroup_that_David_implemented derives from that as does ClassGroup.   Same with elements.  This will avoid a lot of the confusion in evidence in the above email.",
    "created_at": "2007-11-01T19:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1052#issuecomment-4586",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

NOTE: The AbelianGroup class needs to be refactored, so there is an abstract base class, with lots of NotImplementedErrors, then AbelianGroup_that_David_implemented derives from that as does ClassGroup.   Same with elements.  This will avoid a lot of the confusion in evidence in the above email.



---

archive/issue_comments_004587.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n\n```\nsage: K.<a> = NumberField(x^3 + 1838)\nsage: C = K.class_group(); C\nClass group of order 27 with structure C9 x C3 of Number Field in a with defining polynomial x^3 + 1838\nsage: C.gens()\n[Fractional ideal class (50, a - 8), Fractional ideal class (26, a - 2)]\nsage: I = C.gen(0)\nsage: I^-1\n---------------------------------------------------------------------------\n<type 'exceptions.AttributeError'>        Traceback (most recent call last)\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/<ipython console> in <module>()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MonoidElement.__pow__()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.generic_power_c()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement.__invert__()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement.__div__()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op_c()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement.__div__()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement._div_()\n\n/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement._div_c_impl()\n\n<type 'exceptions.AttributeError'>: 'ClassGroup' object has no attribute 'fraction_field'\n```",
    "created_at": "2007-11-05T05:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1052#issuecomment-4587",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:2" align="right">comment:2</div>


```
sage: K.<a> = NumberField(x^3 + 1838)
sage: C = K.class_group(); C
Class group of order 27 with structure C9 x C3 of Number Field in a with defining polynomial x^3 + 1838
sage: C.gens()
[Fractional ideal class (50, a - 8), Fractional ideal class (26, a - 2)]
sage: I = C.gen(0)
sage: I^-1
---------------------------------------------------------------------------
<type 'exceptions.AttributeError'>        Traceback (most recent call last)

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/<ipython console> in <module>()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MonoidElement.__pow__()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.generic_power_c()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement.__invert__()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement.__div__()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op_c()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement.__div__()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement._div_()

/Users/ncalexan/sage-2.7.2/devel/sage-bugday2/element.pyx in sage.structure.element.MultiplicativeGroupElement._div_c_impl()

<type 'exceptions.AttributeError'>: 'ClassGroup' object has no attribute 'fraction_field'
```



---

archive/issue_events_010075.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-07-20T19:54:26Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "subject": "https://github.com/loefflerd",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10075"
}
```



---

archive/issue_events_010076.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-20T19:54:26Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "subject": "https://github.com/loefflerd",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10076"
}
```



---

archive/issue_events_010077.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-20T19:54:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10077"
}
```



---

archive/issue_events_010078.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-20T19:54:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10078"
}
```



---

archive/issue_events_010079.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-10T21:04:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10079"
}
```



---

archive/issue_events_010080.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-10T21:04:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10080"
}
```



---

archive/issue_events_010081.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-10T21:04:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10081"
}
```



---

archive/issue_events_010082.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-10T21:04:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10082"
}
```



---

archive/issue_comments_004588.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe following works for me in sage-4.6.alpha3, so needs_review as \"already fixed\".\n\n```\nsage: K.<a> = NumberField(x^2 + 23)\nsage: G = K.class_group(); G\nClass group of order 3 with structure C3 of Number Field in a with defining polynomial x^2 + 23\nsage: (G.0).order()\n3\nsage: list(G)\n[Trivial principal fractional ideal class, Fractional ideal class (2, 1/2*a - 1/2), Fractional ideal class (2, 1/2*a + 1/2)]\n```",
    "created_at": "2010-10-10T21:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1052#issuecomment-4588",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

The following works for me in sage-4.6.alpha3, so needs_review as "already fixed".

```
sage: K.<a> = NumberField(x^2 + 23)
sage: G = K.class_group(); G
Class group of order 3 with structure C3 of Number Field in a with defining polynomial x^2 + 23
sage: (G.0).order()
3
sage: list(G)
[Trivial principal fractional ideal class, Fractional ideal class (2, 1/2*a - 1/2), Fractional ideal class (2, 1/2*a + 1/2)]
```



---

archive/issue_events_010083.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-10-31T20:57:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10083"
}
```



---

archive/issue_events_010084.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-10-31T20:57:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10084"
}
```



---

archive/issue_comments_004589.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI agree with Jeroen, and Nick A's example also now works, so I have made the \"positive review\" and the next release manager can mark it as fixed.",
    "created_at": "2010-10-31T20:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1052#issuecomment-4589",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:5" align="right">comment:5</div>

I agree with Jeroen, and Nick A's example also now works, so I have made the "positive review" and the next release manager can mark it as fixed.



---

archive/issue_events_010085.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-01T10:21:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10085"
}
```



---

archive/issue_events_010086.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-01T10:21:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10086"
}
```



---

archive/issue_events_010087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-01T10:21:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1052#event-10087"
}
```



---

archive/issue_comments_004590.json:
```json
{
    "body": "Merged: **sage-4.6.1.alpha0**",
    "created_at": "2010-11-01T10:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1052#issuecomment-4590",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.6.1.alpha0**



---

archive/issue_comments_004591.json:
```json
{
    "body": "Reviewer: **John Cremona**",
    "created_at": "2010-11-01T11:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1052#issuecomment-4591",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **John Cremona**



---

archive/issue_comments_004592.json:
```json
{
    "body": "Changed merged from **sage-4.6.1.alpha0** to none",
    "created_at": "2010-11-01T22:02:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1052#issuecomment-4592",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **sage-4.6.1.alpha0** to none
