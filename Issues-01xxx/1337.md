# Issue 1337: [with new patch, with positive review] tp_new leads to munmap_chunk(): invalid pointer segfault

archive/issues_001337.json:
```json
{
    "body": "When compiling python `--without-pymalloc` valgrind detects the following problem:\n\n```\n==465== Invalid free() / delete / delete[]\n==465==    at 0x4A1B74A: free (vg_replace_malloc.c:320)\n==465==    by 0x43FE9A: dict_dealloc (dictobject.c:847)\n==465==    by 0x43FE9A: dict_dealloc (dictobject.c:847)\n==465==    by 0x499E5B: _PyImport_Fini (import.c:229)\n==465==    by 0x4A5D66: Py_Finalize (pythonrun.c:419)\n==465==    by 0x4A58AA: handle_system_exit (pythonrun.c:1616)\n==465==    by 0x4A5AA8: PyErr_PrintEx (pythonrun.c:1062)\n==465==    by 0x4A62B6: PyRun_SimpleFileExFlags (pythonrun.c:976)\n==465==    by 0x4120FF: Py_Main (main.c:523)\n==465==    by 0x4FD94C9: (below main) (in /lib/libc-2.3.6.so)\n==465==  Address 0x530de28 is 32 bytes inside a block of size 80\nalloc'd\n==465==    at 0x4A1BB35: malloc (vg_replace_malloc.c:207)\n==465==    by 0x4B0079: _PyObject_GC_Malloc (gcmodule.c:1321)\n==465==    by 0x454C29: PyType_GenericAlloc (typeobject.c:454)\n==465==    by 0x97622E0:\n__pyx_tp_new_4sage_9structure_7element_Element (element.c:22299)\n==465==    by 0xAC9C9DA: __pyx_tp_new_4sage_5rings_7integer_Integer\n(integer.c:19673)\n==465==    by 0x458D92: type_call (typeobject.c:422)\n==465==    by 0x415542: PyObject_Call (abstract.c:1860)\n==465==    by 0x47C480: PyEval_CallObjectWithKeywords (ceval.c:3433)\n==465==    by 0xAC978B3: initinteger (integer.c:20610)\n==465==    by 0x49E17D: _PyImport_LoadDynamicModule (importdl.c:53)\n==465==    by 0x49C08D: import_submodule (import.c:2394)\n==465==    by 0x49C550: load_next (import.c:2214)\n```\nFor the Linux PPC port this leads to the following crash on exit:\n\n```\n[mabshoff@localhost sage-2.8.14]$ ./sage -gdb\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n/tmp/Work/sage-2.8.14/local/bin/sage-gdb-pythonstartup\nGNU gdb Red Hat Linux (6.6-15.fc7rh)\nCopyright (C) 2006 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"ppc-redhat-linux-gnu\"...\nUsing host libthread_db library \"/lib/libthread_db.so.1\".\n[Thread debugging using libthread_db enabled]\n[New Thread 805394272 (LWP 28969)]\nPython 2.5.1 (r251:54863, Nov 28 2007, 20:22:20)\n[GCC 4.1.2 20070502 (Red Hat 4.1.2-12)] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n[Detaching after fork from child process 28973. (Try `set detach-on-fork off'.)]\n| SAGE Version 2.8.14, Release Date: 2007-11-24                      |\n| Type notebook() for the GUI, and license() for information.        |\n\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage:\nExiting SAGE (CPU time 0m0.11s, Wall time 0m2.50s).\n*** glibc detected *** /tmp/Work/sage-2.8.14/local/bin/python: munmap_chunk(): invalid pointer: 0x1063a200 ***\n======= Backtrace: =========\n/lib/libc.so.6(cfree+0x254)[0xfea3534]\n/tmp/Work/sage-2.8.14/local/bin/python(PyObject_Free+0x10)[0x10053080]\n/tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/sage/rings/integer.so[0xe961a88]\n/tmp/Work/sage-2.8.14/local/bin/python[0x1004b79c]\n/tmp/Work/sage-2.8.14/local/bin/python[0x1004b79c]\n/tmp/Work/sage-2.8.14/local/bin/python(_PyImport_Fini+0x90)[0x100bafa0]\n/tmp/Work/sage-2.8.14/local/bin/python(Py_Finalize+0x108)[0x100c9338]\n/tmp/Work/sage-2.8.14/local/bin/python[0x100c8d54]\n/tmp/Work/sage-2.8.14/local/bin/python(PyErr_PrintEx+0x204)[0x100c8fd4]\n/tmp/Work/sage-2.8.14/local/bin/python(PyRun_SimpleFileExFlags+0x104)[0x100c9954]\n/tmp/Work/sage-2.8.14/local/bin/python(Py_Main+0xc3c)[0x1000fb5c]\n/tmp/Work/sage-2.8.14/local/bin/python(main+0x10)[0x1000ede0]\n/lib/libc.so.6[0xfe3de0c]\n/lib/libc.so.6[0xfe3e060]\n======= Memory map: ========\n00040000-00043000 r-xp 00000000 fd:00 2183945    /lib/libkeyutils-1.2.so\n00043000-00052000 ---p 00003000 fd:00 2183945    /lib/libkeyutils-1.2.so\n00052000-00053000 rw-p 00002000 fd:00 2183945    /lib/libkeyutils-1.2.so\n00100000-00103000 r-xp 00100000 00:00 0          [vdso]\n002e0000-002e2000 r-xp 00000000 fd:00 2184053    /lib/libutil-2.6.so\n002e2000-002ff000 ---p 00002000 fd:00 2184053    /lib/libutil-2.6.so\n002ff000-00300000 r--p 0000f000 fd:00 2184053    /lib/libutil-2.6.so\n00300000-00301000 rw-p 00010000 fd:00 2184053    /lib/libutil-2.6.so\n00310000-00324000 r-xp 00000000 fd:00 2184058    /lib/libgcc_s-4.1.2-20070503.so.1\n00324000-00333000 ---p 00014000 fd:00 2184058    /lib/libgcc_s-4.1.2-20070503.so.1\n00333000-00335000 rw-p 00013000 fd:00 2184058    /lib/libgcc_s-4.1.2-20070503.so.1\n00340000-003e0000 r-xp 00000000 fd:00 1771804    /usr/lib/libkrb5.so.3.3\n003e0000-003e3000 rw-p 000a0000 fd:00 1771804    /usr/lib/libkrb5.so.3.3\n003f0000-003f9000 r-xp 00000000 fd:00 1773833    /usr/lib/libkrb5support.so.0.1\n003f9000-00408000 ---p 00009000 fd:00 1773833    /usr/lib/libkrb5support.so.0.1\n00408000-00409000 rw-p 00008000 fd:00 1773833    /usr/lib/libkrb5support.so.0.1\n004a0000-005ed000 r-xp 00000000 fd:00 2186223    /lib/libcrypto.so.0.9.8b\n005ed000-005f0000 ---p 0014d000 fd:00 2186223    /lib/libcrypto.so.0.9.8b\n005f0000-00603000 rw-p 00150000 fd:00 2186223    /lib/libcrypto.so.0.9.8b\n00603000-00606000 rw-p 00603000 00:00 0\n006c0000-007d1000 r-xp 00000000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8\n007d1000-007ec000 ---p 00111000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8\n007ec000-007f0000 r--p 0011c000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8\n007f0000-007f2000 rw-p 00120000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8\n007f2000-007f7000 rw-p 007f2000 00:00 0\n00880000-0089b000 r-xp 00000000 fd:00 2184057    /lib/libtinfo.so.5.6\n0089b000-008aa000 ---p 0001b000 fd:00 2184057    /lib/libtinfo.so.5.6\n008aa000-008ad000 rw-p 0001a000 fd:00 2184057    /lib/libtinfo.so.5.6\n008ad000-008ae000 rw-p 008ad000 00:00 0\n01000000-0104a000 r-xp 00000000 fd:00 228151     /lib/libssl.so.0.9.8b\n0104a000-01059000 ---p 0004a000 fd:00 228151     /lib/libssl.so.0.9.8b\n01059000-0105e000 rw-p 00049000 fd:00 228151     /lib/libssl.so.0.9.8b\n01930000-01961000 r-xp 00000000 fd:00 1776164    /usr/lib/libgssapi_krb5.so.2.2\n01961000-01970000 ---p 00031000 fd:00 1776164    /usr/lib/libgssapi_krb5.so.2.2\n01970000-01972000 rw-p 00030000 fd:00 1776164    /usr/lib/libgssapi_krb5.so.2.2\n01980000-01986000 r-xp 00000000 fd:00 164464     /lib/libcrypt-2.6.so\n01986000-0199f000 ---p 00006000 fd:00 164464     /lib/libcrypt-2.6.so\n0199f000-019a0000 r--p 0000f000 fd:00 164464     /lib/libcrypt-2.6.so\n019a0000-019a1000 rw-p 00010000 fd:00 164464     /lib/libcrypt-2.6.so\n019a1000-019c8000 rw-p 019a1000 00:00 0\n0bbee000-0bbf9000 r-xp 00000000 fd:00 2054868    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/ext/interactive_constructors_c.so\n0bbf9000-0bc08000 ---p 0000b000 fd:00 2054868    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/ext/interactive_constructors_c.so\n0bc08000-0bc0b000 rw-p 0000a000 fd:00 2054868    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/ext/interactive_constructors_c.so\n0bc1b000-0bc33000 r-xp 00000000 fd:00 2054887    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/probability_distribution.so\n0bc33000-0bc42000 ---p 00018000 fd:00 2054887    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/probability_distribution.so\n0bc42000-0bc45000 rw-p 00017000 fd:00 2054887    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/probability_distribution.so\n0bc55000-0bc6a000 r-xp 00000000 fd:00 2054888    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/ode.so\n0bc6a000-0bc79000 ---p 00015000 fd:00 2054888    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/ode.so\n0bc79000-0bc7d000 rw-p 00014000 fd:00 2054888    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/ode.so\n0bc8d000-0bc92000 r-xp 00000000 fd:00 2054890    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/gsl_array.so\n0bc92000-0bca1000 ---p 00005000 fd:00 2054890    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/gsl_array.so\n0bca1000-0bca2000 rw-p 00004000 fd:00 2054890    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/gsl_array.so\n0bcb2000-0bcba000 r-xp 00000000 fd:00 2054879    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/dwt.so\n0bcba000-0bcc9000 ---p 00008000 fd:00 2054879    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/dwt.so\n0bcc9000-0bccb000 rw-p 00007000 fd:00 2054879    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/dwt.so\n0bcdb000-0bce9000 r-xp 00000000 fd:00 2054876    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/fft.so\n0bce9000-0bcf8000 ---p 0000e000 fd:00 2054876    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/fft.so\n0bcf8000-0bcfa000 rw-p 0000d000 fd:00 2054876    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/fft.so\n0bd0a000-0bd14000 r-xp 00000000 fd:00 2056191    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/combinat/expnums.so\n0bd14000-0bd23000 ---p 0000a000 fd:00 2056191    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/combinat/expnums.so\n0bd23000-0bd24000 rw-p 00009000 fd:00 2056191    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/combinat/expnums.so\n0bd34000-0bd37000 r-xp 00000000 fd:00 1665673    /tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/twisted/protocols/_c_urlarg.so\n0bd37000-0bd46000 ---p 00003000 fd:00 1665673    /tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/twisted/protocols/_c_urlarg.so\n0bd46000-0bd47000 rw-p 00002000 fd:00 1665673    /tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/twisted/protocols/_c_urlarg.so\n0bd57000-0bd5b000 r-xp 00000000 fd:00 1632710    /tmp/Work/sage-2.8.14/local/lib/python2.5/lib-dynload/_heapq.so\n0bd5b000-0bd6a000 ---p 00004000 fd:00 1632710    /tmp/Work/sage-2.8.14/local/lib/python2.5/lib-dynload/_heapq.so\n0bd6a000-0bd6c000 rw-p 00003000 fd:00 1632710    /tmp/Work/sage-2.8.14/local/lib/python2.5/lib-dynload/_heapq.so\n0bd7c000-0bd81000 r-xp 00000000 fd:00 1632726    /tmp/Work/sage-2.8.\nProgram received signal SIGABRT, Aborted.\n[Switching to Thread 805394272 (LWP 28969)]\n0x0fe55f10 in raise () from /lib/libc.so.6\n(gdb) bt\n#0  0x0fe55f10 in raise () from /lib/libc.so.6\n#1  0x0fe57c94 in abort () from /lib/libc.so.6\n#2  0x0fe957a4 in __libc_message () from /lib/libc.so.6\n#3  0x0fea3534 in free () from /lib/libc.so.6\n#4  0x10053080 in PyObject_Free (p=0x0) at Objects/obmalloc.c:1203\n#5  0x0e961a88 in __pyx_f_4sage_5rings_7integer_fast_tp_dealloc (__pyx_v_o=0x1063a200) at sage/rings/integer.c:18900\n#6  0x1004b79c in dict_dealloc (mp=0x10696cd0) at Objects/dictobject.c:847\n#7  0x1004b79c in dict_dealloc (mp=0x10166948) at Objects/dictobject.c:847\n#8  0x100bafa0 in _PyImport_Fini () at Python/import.c:229\n#9  0x100c9338 in Py_Finalize () at Python/pythonrun.c:419\n#10 0x100c8d54 in handle_system_exit () at Python/pythonrun.c:1616\n#11 0x100c8fd4 in PyErr_PrintEx (set_sys_last_vars=1) at Python/pythonrun.c:1062\n#12 0x100c9954 in PyRun_SimpleFileExFlags (fp=0x0,\n    filename=0x7f89ec47 \"/tmp/Work/sage-2.8.14/local/bin/sage-gdb-pythonstartup\", closeit=0, flags=0x7f89dbb8)\n    at Python/pythonrun.c:976\n#13 0x1000fb5c in Py_Main (argc=<value optimized out>, argv=0x7f89df04) at Modules/main.c:134\n#14 0x1000ede0 in main (argc=0, argv=0x7129) at ./Modules/python.c:23\n(gdb) quit\n```\n| SAGE Version 2.8.14, Release Date: 2007-11-24                      |\n| Type notebook() for the GUI, and license() for information.        |\n\nSee also http://groups.google.com/group/sage-devel/t/e254485d2e367b20\n\nThis bug did not show in 2.8.7 on the same PPC hardware under Linux.\n\n**Assignee:** @garyfurnish\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/1337\n\n",
    "closed_at": "2008-03-09T05:33:42Z",
    "created_at": "2007-11-29T09:47:19Z",
    "labels": [
        "component: memleak",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.10.3",
    "title": "[with new patch, with positive review] tp_new leads to munmap_chunk(): invalid pointer segfault",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/1337",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```
When compiling python `--without-pymalloc` valgrind detects the following problem:

```
==465== Invalid free() / delete / delete[]
==465==    at 0x4A1B74A: free (vg_replace_malloc.c:320)
==465==    by 0x43FE9A: dict_dealloc (dictobject.c:847)
==465==    by 0x43FE9A: dict_dealloc (dictobject.c:847)
==465==    by 0x499E5B: _PyImport_Fini (import.c:229)
==465==    by 0x4A5D66: Py_Finalize (pythonrun.c:419)
==465==    by 0x4A58AA: handle_system_exit (pythonrun.c:1616)
==465==    by 0x4A5AA8: PyErr_PrintEx (pythonrun.c:1062)
==465==    by 0x4A62B6: PyRun_SimpleFileExFlags (pythonrun.c:976)
==465==    by 0x4120FF: Py_Main (main.c:523)
==465==    by 0x4FD94C9: (below main) (in /lib/libc-2.3.6.so)
==465==  Address 0x530de28 is 32 bytes inside a block of size 80
alloc'd
==465==    at 0x4A1BB35: malloc (vg_replace_malloc.c:207)
==465==    by 0x4B0079: _PyObject_GC_Malloc (gcmodule.c:1321)
==465==    by 0x454C29: PyType_GenericAlloc (typeobject.c:454)
==465==    by 0x97622E0:
__pyx_tp_new_4sage_9structure_7element_Element (element.c:22299)
==465==    by 0xAC9C9DA: __pyx_tp_new_4sage_5rings_7integer_Integer
(integer.c:19673)
==465==    by 0x458D92: type_call (typeobject.c:422)
==465==    by 0x415542: PyObject_Call (abstract.c:1860)
==465==    by 0x47C480: PyEval_CallObjectWithKeywords (ceval.c:3433)
==465==    by 0xAC978B3: initinteger (integer.c:20610)
==465==    by 0x49E17D: _PyImport_LoadDynamicModule (importdl.c:53)
==465==    by 0x49C08D: import_submodule (import.c:2394)
==465==    by 0x49C550: load_next (import.c:2214)
```
For the Linux PPC port this leads to the following crash on exit:

```
[mabshoff@localhost sage-2.8.14]$ ./sage -gdb
----------------------------------------------------------------------
----------------------------------------------------------------------
/tmp/Work/sage-2.8.14/local/bin/sage-gdb-pythonstartup
GNU gdb Red Hat Linux (6.6-15.fc7rh)
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "ppc-redhat-linux-gnu"...
Using host libthread_db library "/lib/libthread_db.so.1".
[Thread debugging using libthread_db enabled]
[New Thread 805394272 (LWP 28969)]
Python 2.5.1 (r251:54863, Nov 28 2007, 20:22:20)
[GCC 4.1.2 20070502 (Red Hat 4.1.2-12)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
[Detaching after fork from child process 28973. (Try `set detach-on-fork off'.)]
| SAGE Version 2.8.14, Release Date: 2007-11-24                      |
| Type notebook() for the GUI, and license() for information.        |

----------------------------------------------------------------------
----------------------------------------------------------------------
sage:
Exiting SAGE (CPU time 0m0.11s, Wall time 0m2.50s).
*** glibc detected *** /tmp/Work/sage-2.8.14/local/bin/python: munmap_chunk(): invalid pointer: 0x1063a200 ***
======= Backtrace: =========
/lib/libc.so.6(cfree+0x254)[0xfea3534]
/tmp/Work/sage-2.8.14/local/bin/python(PyObject_Free+0x10)[0x10053080]
/tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/sage/rings/integer.so[0xe961a88]
/tmp/Work/sage-2.8.14/local/bin/python[0x1004b79c]
/tmp/Work/sage-2.8.14/local/bin/python[0x1004b79c]
/tmp/Work/sage-2.8.14/local/bin/python(_PyImport_Fini+0x90)[0x100bafa0]
/tmp/Work/sage-2.8.14/local/bin/python(Py_Finalize+0x108)[0x100c9338]
/tmp/Work/sage-2.8.14/local/bin/python[0x100c8d54]
/tmp/Work/sage-2.8.14/local/bin/python(PyErr_PrintEx+0x204)[0x100c8fd4]
/tmp/Work/sage-2.8.14/local/bin/python(PyRun_SimpleFileExFlags+0x104)[0x100c9954]
/tmp/Work/sage-2.8.14/local/bin/python(Py_Main+0xc3c)[0x1000fb5c]
/tmp/Work/sage-2.8.14/local/bin/python(main+0x10)[0x1000ede0]
/lib/libc.so.6[0xfe3de0c]
/lib/libc.so.6[0xfe3e060]
======= Memory map: ========
00040000-00043000 r-xp 00000000 fd:00 2183945    /lib/libkeyutils-1.2.so
00043000-00052000 ---p 00003000 fd:00 2183945    /lib/libkeyutils-1.2.so
00052000-00053000 rw-p 00002000 fd:00 2183945    /lib/libkeyutils-1.2.so
00100000-00103000 r-xp 00100000 00:00 0          [vdso]
002e0000-002e2000 r-xp 00000000 fd:00 2184053    /lib/libutil-2.6.so
002e2000-002ff000 ---p 00002000 fd:00 2184053    /lib/libutil-2.6.so
002ff000-00300000 r--p 0000f000 fd:00 2184053    /lib/libutil-2.6.so
00300000-00301000 rw-p 00010000 fd:00 2184053    /lib/libutil-2.6.so
00310000-00324000 r-xp 00000000 fd:00 2184058    /lib/libgcc_s-4.1.2-20070503.so.1
00324000-00333000 ---p 00014000 fd:00 2184058    /lib/libgcc_s-4.1.2-20070503.so.1
00333000-00335000 rw-p 00013000 fd:00 2184058    /lib/libgcc_s-4.1.2-20070503.so.1
00340000-003e0000 r-xp 00000000 fd:00 1771804    /usr/lib/libkrb5.so.3.3
003e0000-003e3000 rw-p 000a0000 fd:00 1771804    /usr/lib/libkrb5.so.3.3
003f0000-003f9000 r-xp 00000000 fd:00 1773833    /usr/lib/libkrb5support.so.0.1
003f9000-00408000 ---p 00009000 fd:00 1773833    /usr/lib/libkrb5support.so.0.1
00408000-00409000 rw-p 00008000 fd:00 1773833    /usr/lib/libkrb5support.so.0.1
004a0000-005ed000 r-xp 00000000 fd:00 2186223    /lib/libcrypto.so.0.9.8b
005ed000-005f0000 ---p 0014d000 fd:00 2186223    /lib/libcrypto.so.0.9.8b
005f0000-00603000 rw-p 00150000 fd:00 2186223    /lib/libcrypto.so.0.9.8b
00603000-00606000 rw-p 00603000 00:00 0
006c0000-007d1000 r-xp 00000000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8
007d1000-007ec000 ---p 00111000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8
007ec000-007f0000 r--p 0011c000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8
007f0000-007f2000 rw-p 00120000 fd:00 1770129    /usr/lib/libstdc++.so.6.0.8
007f2000-007f7000 rw-p 007f2000 00:00 0
00880000-0089b000 r-xp 00000000 fd:00 2184057    /lib/libtinfo.so.5.6
0089b000-008aa000 ---p 0001b000 fd:00 2184057    /lib/libtinfo.so.5.6
008aa000-008ad000 rw-p 0001a000 fd:00 2184057    /lib/libtinfo.so.5.6
008ad000-008ae000 rw-p 008ad000 00:00 0
01000000-0104a000 r-xp 00000000 fd:00 228151     /lib/libssl.so.0.9.8b
0104a000-01059000 ---p 0004a000 fd:00 228151     /lib/libssl.so.0.9.8b
01059000-0105e000 rw-p 00049000 fd:00 228151     /lib/libssl.so.0.9.8b
01930000-01961000 r-xp 00000000 fd:00 1776164    /usr/lib/libgssapi_krb5.so.2.2
01961000-01970000 ---p 00031000 fd:00 1776164    /usr/lib/libgssapi_krb5.so.2.2
01970000-01972000 rw-p 00030000 fd:00 1776164    /usr/lib/libgssapi_krb5.so.2.2
01980000-01986000 r-xp 00000000 fd:00 164464     /lib/libcrypt-2.6.so
01986000-0199f000 ---p 00006000 fd:00 164464     /lib/libcrypt-2.6.so
0199f000-019a0000 r--p 0000f000 fd:00 164464     /lib/libcrypt-2.6.so
019a0000-019a1000 rw-p 00010000 fd:00 164464     /lib/libcrypt-2.6.so
019a1000-019c8000 rw-p 019a1000 00:00 0
0bbee000-0bbf9000 r-xp 00000000 fd:00 2054868    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/ext/interactive_constructors_c.so
0bbf9000-0bc08000 ---p 0000b000 fd:00 2054868    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/ext/interactive_constructors_c.so
0bc08000-0bc0b000 rw-p 0000a000 fd:00 2054868    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/ext/interactive_constructors_c.so
0bc1b000-0bc33000 r-xp 00000000 fd:00 2054887    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/probability_distribution.so
0bc33000-0bc42000 ---p 00018000 fd:00 2054887    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/probability_distribution.so
0bc42000-0bc45000 rw-p 00017000 fd:00 2054887    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/probability_distribution.so
0bc55000-0bc6a000 r-xp 00000000 fd:00 2054888    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/ode.so
0bc6a000-0bc79000 ---p 00015000 fd:00 2054888    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/ode.so
0bc79000-0bc7d000 rw-p 00014000 fd:00 2054888    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/ode.so
0bc8d000-0bc92000 r-xp 00000000 fd:00 2054890    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/gsl_array.so
0bc92000-0bca1000 ---p 00005000 fd:00 2054890    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/gsl_array.so
0bca1000-0bca2000 rw-p 00004000 fd:00 2054890    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/gsl_array.so
0bcb2000-0bcba000 r-xp 00000000 fd:00 2054879    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/dwt.so
0bcba000-0bcc9000 ---p 00008000 fd:00 2054879    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/dwt.so
0bcc9000-0bccb000 rw-p 00007000 fd:00 2054879    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/dwt.so
0bcdb000-0bce9000 r-xp 00000000 fd:00 2054876    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/fft.so
0bce9000-0bcf8000 ---p 0000e000 fd:00 2054876    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/fft.so
0bcf8000-0bcfa000 rw-p 0000d000 fd:00 2054876    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/gsl/fft.so
0bd0a000-0bd14000 r-xp 00000000 fd:00 2056191    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/combinat/expnums.so
0bd14000-0bd23000 ---p 0000a000 fd:00 2056191    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/combinat/expnums.so
0bd23000-0bd24000 rw-p 00009000 fd:00 2056191    /tmp/Work/sage-2.8.14/devel/sage-main/build/sage/combinat/expnums.so
0bd34000-0bd37000 r-xp 00000000 fd:00 1665673    /tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/twisted/protocols/_c_urlarg.so
0bd37000-0bd46000 ---p 00003000 fd:00 1665673    /tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/twisted/protocols/_c_urlarg.so
0bd46000-0bd47000 rw-p 00002000 fd:00 1665673    /tmp/Work/sage-2.8.14/local/lib/python2.5/site-packages/twisted/protocols/_c_urlarg.so
0bd57000-0bd5b000 r-xp 00000000 fd:00 1632710    /tmp/Work/sage-2.8.14/local/lib/python2.5/lib-dynload/_heapq.so
0bd5b000-0bd6a000 ---p 00004000 fd:00 1632710    /tmp/Work/sage-2.8.14/local/lib/python2.5/lib-dynload/_heapq.so
0bd6a000-0bd6c000 rw-p 00003000 fd:00 1632710    /tmp/Work/sage-2.8.14/local/lib/python2.5/lib-dynload/_heapq.so
0bd7c000-0bd81000 r-xp 00000000 fd:00 1632726    /tmp/Work/sage-2.8.
Program received signal SIGABRT, Aborted.
[Switching to Thread 805394272 (LWP 28969)]
0x0fe55f10 in raise () from /lib/libc.so.6
(gdb) bt
#0  0x0fe55f10 in raise () from /lib/libc.so.6
#1  0x0fe57c94 in abort () from /lib/libc.so.6
#2  0x0fe957a4 in __libc_message () from /lib/libc.so.6
#3  0x0fea3534 in free () from /lib/libc.so.6
#4  0x10053080 in PyObject_Free (p=0x0) at Objects/obmalloc.c:1203
#5  0x0e961a88 in __pyx_f_4sage_5rings_7integer_fast_tp_dealloc (__pyx_v_o=0x1063a200) at sage/rings/integer.c:18900
#6  0x1004b79c in dict_dealloc (mp=0x10696cd0) at Objects/dictobject.c:847
#7  0x1004b79c in dict_dealloc (mp=0x10166948) at Objects/dictobject.c:847
#8  0x100bafa0 in _PyImport_Fini () at Python/import.c:229
#9  0x100c9338 in Py_Finalize () at Python/pythonrun.c:419
#10 0x100c8d54 in handle_system_exit () at Python/pythonrun.c:1616
#11 0x100c8fd4 in PyErr_PrintEx (set_sys_last_vars=1) at Python/pythonrun.c:1062
#12 0x100c9954 in PyRun_SimpleFileExFlags (fp=0x0,
    filename=0x7f89ec47 "/tmp/Work/sage-2.8.14/local/bin/sage-gdb-pythonstartup", closeit=0, flags=0x7f89dbb8)
    at Python/pythonrun.c:976
#13 0x1000fb5c in Py_Main (argc=<value optimized out>, argv=0x7f89df04) at Modules/main.c:134
#14 0x1000ede0 in main (argc=0, argv=0x7129) at ./Modules/python.c:23
(gdb) quit
```
| SAGE Version 2.8.14, Release Date: 2007-11-24                      |
| Type notebook() for the GUI, and license() for information.        |

See also http://groups.google.com/group/sage-devel/t/e254485d2e367b20

This bug did not show in 2.8.7 on the same PPC hardware under Linux.

**Assignee:** @garyfurnish

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/1337





---

archive/issue_comments_009186.json:
```json
{
    "body": "<a id='comment:1'></a>\nApplying Robert's patch no-collect-interger.patch from \n\nhttp://sage.math.washington.edu/home/mabshoff/no-collect-integer.patch\n\nprevents the issue from occurring by incrementing the refcount if the dummy int. That way it is never reaped by the garbage collector.\n\nCheers,\n\nMichael",
    "created_at": "2007-11-30T09:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9186",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>
Applying Robert's patch no-collect-interger.patch from 

http://sage.math.washington.edu/home/mabshoff/no-collect-integer.patch

prevents the issue from occurring by incrementing the refcount if the dummy int. That way it is never reaped by the garbage collector.

Cheers,

Michael



---

archive/issue_comments_009187.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [mabshoff](#comment%3A1):\n> Applying Robert's patch no-collect-interger.patch from \n> \n> http://sage.math.washington.edu/home/mabshoff/no-collect-integer.patch\n> \n> prevents the issue from occurring by incrementing the refcount if the dummy int. That way it is never reaped by the garbage collector.\n> \n> Cheers,\n> \n> Michael\n\n\nOops, I messed up somehow and the patch doesn't fix the problem. \n\nInvestigating what went wrong ...\n\nCheers,\n\nMichael",
    "created_at": "2007-11-30T09:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9187",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>
Replying to [mabshoff](#comment%3A1):
> Applying Robert's patch no-collect-interger.patch from 
> 
> http://sage.math.washington.edu/home/mabshoff/no-collect-integer.patch
> 
> prevents the issue from occurring by incrementing the refcount if the dummy int. That way it is never reaped by the garbage collector.
> 
> Cheers,
> 
> Michael


Oops, I messed up somehow and the patch doesn't fix the problem. 

Investigating what went wrong ...

Cheers,

Michael



---

archive/issue_comments_009188.json:
```json
{
    "body": "Attachment [1337.diff](tarball://root/attachments/some-uuid/ticket1337/1337.diff) by @robertwb created at 2008-01-18 02:41:38",
    "created_at": "2008-01-18T02:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9188",
    "user": "https://github.com/robertwb"
}
```

Attachment [1337.diff](tarball://root/attachments/some-uuid/ticket1337/1337.diff) by @robertwb created at 2008-01-18 02:41:38



---

archive/issue_comments_009189.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe new version of Cython handle tp_new in a more efficient manner, try applying the above patch. \n\n(In any case this should be applied to SAGE even if it doesn't fix the issue.)",
    "created_at": "2008-01-18T02:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9189",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:3'></a>
The new version of Cython handle tp_new in a more efficient manner, try applying the above patch. 

(In any case this should be applied to SAGE even if it doesn't fix the issue.)



---

archive/issue_comments_009190.json:
```json
{
    "body": "<a id='comment:4'></a>\nApplying the patch and rebuilding all of Sage with the latest Cython (see #1801) does *not* solve the issue.\n\nCheers,\n\nMichael",
    "created_at": "2008-01-18T06:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9190",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Applying the patch and rebuilding all of Sage with the latest Cython (see #1801) does *not* solve the issue.

Cheers,

Michael



---

archive/issue_comments_009191.json:
```json
{
    "body": "<a id='comment:5'></a>\nI merged 1337.diff into Sage 2.10.1.alpha1. Last time I checked it didn't fix the original problem, so stay tuned.\n\nCheers,\n\nMichael",
    "created_at": "2008-01-22T03:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9191",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
I merged 1337.diff into Sage 2.10.1.alpha1. Last time I checked it didn't fix the original problem, so stay tuned.

Cheers,

Michael



---

archive/issue_comments_009192.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhen I apply the patch I get double frees on sage.math:\n\n```\nmabshoff@sage:/scratch/mabshoff/release-cycle/sage-2.10.1.alpha1$ ./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n| SAGE Version 2.10.1.alpha0, Release Date: 2008-01-19               |\n| Type notebook() for the GUI, and license() for information.        |\n\nsage:\nExiting SAGE (CPU time 0m0.00s, Wall time 0m1.76s).\n*** glibc detected *** double free or corruption (out): 0x0000000000e37400 ***\n/scratch/mabshoff/release-cycle/sage-2.10.1.alpha1/local/bin/sage-sage: line 210: 31963 Aborted                 sage-ipython -c \"$SAGE_STARTUP_COMMAND;\" \"$@\"\n```\nSo I am reverting this for now.\n\nI also had to apply the no-collect-integer.patch to make the double frees go away again. This is very, very odd to say the least.\n\nCheers,\n\nMichael",
    "created_at": "2008-01-22T05:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9192",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
When I apply the patch I get double frees on sage.math:

```
mabshoff@sage:/scratch/mabshoff/release-cycle/sage-2.10.1.alpha1$ ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
| SAGE Version 2.10.1.alpha0, Release Date: 2008-01-19               |
| Type notebook() for the GUI, and license() for information.        |

sage:
Exiting SAGE (CPU time 0m0.00s, Wall time 0m1.76s).
*** glibc detected *** double free or corruption (out): 0x0000000000e37400 ***
/scratch/mabshoff/release-cycle/sage-2.10.1.alpha1/local/bin/sage-sage: line 210: 31963 Aborted                 sage-ipython -c "$SAGE_STARTUP_COMMAND;" "$@"
```
So I am reverting this for now.

I also had to apply the no-collect-integer.patch to make the double frees go away again. This is very, very odd to say the least.

Cheers,

Michael



---

archive/issue_comments_009193.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe presence, or absence, of this patch should not impact an error like this--are you sure it is due to this patch (and not some non-deterministic thing)?",
    "created_at": "2008-01-22T07:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9193",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:7'></a>
The presence, or absence, of this patch should not impact an error like this--are you sure it is due to this patch (and not some non-deterministic thing)?



---

archive/issue_comments_009194.json:
```json
{
    "body": "<a id='comment:8'></a>\nI am attaching a patch that should fix the issue, as the elements of the structure used by the integers were in the wrong order, but I don't have a easy way to reproduce this, so testing would be appreciated.",
    "created_at": "2008-02-27T08:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9194",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:8'></a>
I am attaching a patch that should fix the issue, as the elements of the structure used by the integers were in the wrong order, but I don't have a easy way to reproduce this, so testing would be appreciated.



---

archive/issue_comments_009195.json:
```json
{
    "body": "**Changing assignee** from mabshoff to @garyfurnish.",
    "created_at": "2008-02-27T08:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9195",
    "user": "https://github.com/garyfurnish"
}
```

**Changing assignee** from mabshoff to @garyfurnish.



---

archive/issue_comments_009196.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2008-02-27T08:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9196",
    "user": "https://github.com/garyfurnish"
}
```

**Changing status** from new to assigned.



---

archive/issue_comments_009197.json:
```json
{
    "body": "Fixed another tiny error.",
    "created_at": "2008-02-27T08:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9197",
    "user": "https://github.com/garyfurnish"
}
```

Fixed another tiny error.



---

archive/issue_comments_009198.json:
```json
{
    "body": "<a id='comment:9'></a>\nAttachment [integers.pyx.patch](tarball://root/attachments/some-uuid/ticket1337/integers.pyx.patch) by mabshoff created at 2008-02-27 08:22:51",
    "created_at": "2008-02-27T08:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9198",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
Attachment [integers.pyx.patch](tarball://root/attachments/some-uuid/ticket1337/integers.pyx.patch) by mabshoff created at 2008-02-27 08:22:51



---

archive/issue_comments_009199.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-02-27T08:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9199",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_009200.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe ZZ constructor breaks in the case of x=NULL because it was relying on broken code, patch coming up as soon as it make checks.",
    "created_at": "2008-02-27T08:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9200",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:10'></a>
The ZZ constructor breaks in the case of x=NULL because it was relying on broken code, patch coming up as soon as it make checks.



---

archive/issue_comments_009201.json:
```json
{
    "body": "Attachment [integer.pyx.patch](tarball://root/attachments/some-uuid/ticket1337/integer.pyx.patch) by @garyfurnish created at 2008-02-27 10:13:17\n\nFixed doctest issues",
    "created_at": "2008-02-27T10:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9201",
    "user": "https://github.com/garyfurnish"
}
```

Attachment [integer.pyx.patch](tarball://root/attachments/some-uuid/ticket1337/integer.pyx.patch) by @garyfurnish created at 2008-02-27 10:13:17

Fixed doctest issues



---

archive/issue_comments_009202.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe last patch correctly solves all issues, and needs testing.  (Ignore the first one).",
    "created_at": "2008-02-27T10:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9202",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:11'></a>
The last patch correctly solves all issues, and needs testing.  (Ignore the first one).



---

archive/issue_comments_009203.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt looks good to me, though I haven't ever been able to reproduce the error so someone else needs to test it. \n\n1337.diff should be applied (though it doesn't fix the bug, but it simplifies things)\n\nintegers.pyx.patch should NOT be applied (or returned integers might not have value 0)\n\ninteger.pyx.patch should be applied.",
    "created_at": "2008-02-29T09:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9203",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:12'></a>
It looks good to me, though I haven't ever been able to reproduce the error so someone else needs to test it. 

1337.diff should be applied (though it doesn't fix the bug, but it simplifies things)

integers.pyx.patch should NOT be applied (or returned integers might not have value 0)

integer.pyx.patch should be applied.



---

archive/issue_comments_009204.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [robertwb](#comment%3A12):\n> It looks good to me, though I haven't ever been able to reproduce the error so someone else needs to test it. \n> \n> 1337.diff should be applied (though it doesn't fix the bug, but it simplifies things)\n> \n> integers.pyx.patch should NOT be applied (or returned integers might not have value 0)\n> \n> integer.pyx.patch should be applied. \n\n\nCan somebody please open one or two new tickets (depending if the patches do something differen), so I can merge them. Last time I tried this bug here wasn't fixed, so this way we can cleanly closed two issues.\n\nCheers,\n\nMichael",
    "created_at": "2008-02-29T22:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9204",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:13'></a>
Replying to [robertwb](#comment%3A12):
> It looks good to me, though I haven't ever been able to reproduce the error so someone else needs to test it. 
> 
> 1337.diff should be applied (though it doesn't fix the bug, but it simplifies things)
> 
> integers.pyx.patch should NOT be applied (or returned integers might not have value 0)
> 
> integer.pyx.patch should be applied. 


Can somebody please open one or two new tickets (depending if the patches do something differen), so I can merge them. Last time I tried this bug here wasn't fixed, so this way we can cleanly closed two issues.

Cheers,

Michael



---

archive/issue_comments_009205.json:
```json
{
    "body": "<a id='comment:14'></a>\nMove integer.pyx.patch and structure fix to 2363.",
    "created_at": "2008-03-01T20:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9205",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:14'></a>
Move integer.pyx.patch and structure fix to 2363.



---

archive/issue_comments_009206.json:
```json
{
    "body": "<a id='comment:15'></a>\nRobert: Can you open another ticket for the 1337.diff patch, so that it can be reviewed. Or do you think it resolves this issue?\n\nSince Gary moved integer.pyx.patch to #2363 and you gave it a positive review I transferred the positive review there, merged it and then closed the ticket.\n\nCheers,\n\nMichael",
    "created_at": "2008-03-01T22:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9206",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:15'></a>
Robert: Can you open another ticket for the 1337.diff patch, so that it can be reviewed. Or do you think it resolves this issue?

Since Gary moved integer.pyx.patch to #2363 and you gave it a positive review I transferred the positive review there, merged it and then closed the ticket.

Cheers,

Michael



---

archive/issue_comments_009207.json:
```json
{
    "body": "Attachment [trac_1337.patch](tarball://root/attachments/some-uuid/ticket1337/trac_1337.patch) by @garyfurnish created at 2008-03-09 01:12:14\n\ndouble free fix (needs test all)",
    "created_at": "2008-03-09T01:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9207",
    "user": "https://github.com/garyfurnish"
}
```

Attachment [trac_1337.patch](tarball://root/attachments/some-uuid/ticket1337/trac_1337.patch) by @garyfurnish created at 2008-03-09 01:12:14

double free fix (needs test all)



---

archive/issue_comments_009208.json:
```json
{
    "body": "Attachment [trac_1337-workaround.patch](tarball://root/attachments/some-uuid/ticket1337/trac_1337-workaround.patch) by mabshoff created at 2008-03-09 05:04:30\n\nThis patch introduces a workaround - but that causes leaks if the integer pool is exhausted",
    "created_at": "2008-03-09T05:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9208",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Attachment [trac_1337-workaround.patch](tarball://root/attachments/some-uuid/ticket1337/trac_1337-workaround.patch) by mabshoff created at 2008-03-09 05:04:30

This patch introduces a workaround - but that causes leaks if the integer pool is exhausted



---

archive/issue_events_004021.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "rename": {
        "from": "tp_new leads to munmap_chunk(): invalid pointer segfault",
        "to": "[with new patch] tp_new leads to munmap_chunk(): invalid pointer segfault"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1337#event-4021"
}
```



---

archive/issue_comments_009209.json:
```json
{
    "body": "**Changing status** from needs_review to needs_review.",
    "created_at": "2008-03-09T05:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9209",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_review to needs_review.



---

archive/issue_comments_009210.json:
```json
{
    "body": "<a id='comment:17'></a>\nRubber stamp positive review",
    "created_at": "2008-03-09T05:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9210",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:17'></a>
Rubber stamp positive review



---

archive/issue_events_004022.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "rename": {
        "from": "[with new patch] tp_new leads to munmap_chunk(): invalid pointer segfault",
        "to": "[with new patch, with positive review] tp_new leads to munmap_chunk(): invalid pointer segfault"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1337#event-4022"
}
```



---

archive/issue_comments_009211.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-03-09T05:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9211",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_comments_009212.json:
```json
{
    "body": "<a id='comment:19'></a>\nMerged trac_1337-workaround.patch in Sage 2.10.3.rc3. The fix is a workaround, that trades a segfault for a small leak. This will be dealt with at #2435.",
    "created_at": "2008-03-09T05:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1337#issuecomment-9212",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:19'></a>
Merged trac_1337-workaround.patch in Sage 2.10.3.rc3. The fix is a workaround, that trades a segfault for a small leak. This will be dealt with at #2435.



---

archive/issue_events_004023.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-03-09T05:33:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/1337",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1337#event-4023"
}
```
