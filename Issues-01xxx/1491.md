# Issue 1491: [with patch, with positive review] improve conversion from interface to sage objects (i.e., the dot sage method)

archive/issues_001491.json:
```json
{
    "body": "```\n\n\nOn Dec 13, 2007 11:54 AM, Timothy Clemans <timothy.clemans@gmail.com> wrote:\n> \n> I'm getting\n> \n> {{{id=2|\n> def math_bessel_K(nu,x):\n>        return mathematica(nu).BesselK(x).N(20).sage()\n> math_bessel_K(2,I)\n> ///\n> Traceback (most recent call last):\n>   File \"<stdin>\", line 1, in <module>\n>   File \"/home/tclemans/.sage/sage_notebook/worksheets/admin/5/code/\n> 9.py\", line 6, in <module>\n>     exec compile(ur'math_bessel_K(Integer(2),I)' + '\\n', '', 'single')\n>   File \"/home/was/s/data/extcode/sage/\", line 1, in <module>\n> \n>   File \"/home/tclemans/.sage/sage_notebook/worksheets/admin/5/code/\n> 9.py\", line 5, in math_bessel_K\n>     return mathematica(nu).BesselK(x).N(Integer(20)).sage()\n>   File \"/home/was/s/local/lib/python2.5/site-packages/sage/interfaces/\n> expect.py\", line 1086, in sage\n>     return self._sage_()\n>   File \"/home/was/s/local/lib/python2.5/site-packages/sage/interfaces/\n> expect.py\", line 1079, in _sage_\n>     return sage.misc.sage_eval.sage_eval(repr(self))\n>   File \"/home/was/s/local/lib/python2.5/site-packages/sage/misc/\n> sage_eval.py\", line 112, in sage_eval\n>     raise SyntaxError, \"%s\\nError using SAGE to evaluate '%s'\"%(msg,\n> p)\n> SyntaxError: invalid syntax (<string>, line 1)\n> Error using SAGE to evaluate '-\n> RealNumber('2.592886175491196978167651322538251462935637034451900356688')\n> +\n> \n> RealNumber('0.180489972066962026629620880838378650496225604668529521981')*I'\n> }}}\n\nThat's coming from a newline, which appears in Mathematica 5 I guess, but not 6.  Anyway,\nthe patch I justed posted at \n\nfixes the problem.  Alternatively rewrite the function like this:\n\nsage: def math_bessel_K(nu,x):\n  return sage_eval(repr(mathematica(nu).BesselK(x).N(20)).replace('\\n',''))\n\nImportant note: The conversion from Mathematica to Sage, i.e., mathematica_object.sage()\nis very naive still -- all it is is basically sage_eval(repr(...))!   This could/would be improved\nif somebody cared a lot.\n\nWilliam\n```\n\nAssignee: @williamstein\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/1491\n\n",
    "closed_at": "2007-12-15T05:40:10Z",
    "created_at": "2007-12-13T20:22:35Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.9",
    "title": "[with patch, with positive review] improve conversion from interface to sage objects (i.e., the dot sage method)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/1491",
    "user": "https://github.com/williamstein"
}
```
```


On Dec 13, 2007 11:54 AM, Timothy Clemans <timothy.clemans@gmail.com> wrote:
> 
> I'm getting
> 
> {{{id=2|
> def math_bessel_K(nu,x):
>        return mathematica(nu).BesselK(x).N(20).sage()
> math_bessel_K(2,I)
> ///
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
>   File "/home/tclemans/.sage/sage_notebook/worksheets/admin/5/code/
> 9.py", line 6, in <module>
>     exec compile(ur'math_bessel_K(Integer(2),I)' + '\n', '', 'single')
>   File "/home/was/s/data/extcode/sage/", line 1, in <module>
> 
>   File "/home/tclemans/.sage/sage_notebook/worksheets/admin/5/code/
> 9.py", line 5, in math_bessel_K
>     return mathematica(nu).BesselK(x).N(Integer(20)).sage()
>   File "/home/was/s/local/lib/python2.5/site-packages/sage/interfaces/
> expect.py", line 1086, in sage
>     return self._sage_()
>   File "/home/was/s/local/lib/python2.5/site-packages/sage/interfaces/
> expect.py", line 1079, in _sage_
>     return sage.misc.sage_eval.sage_eval(repr(self))
>   File "/home/was/s/local/lib/python2.5/site-packages/sage/misc/
> sage_eval.py", line 112, in sage_eval
>     raise SyntaxError, "%s\nError using SAGE to evaluate '%s'"%(msg,
> p)
> SyntaxError: invalid syntax (<string>, line 1)
> Error using SAGE to evaluate '-
> RealNumber('2.592886175491196978167651322538251462935637034451900356688')
> +
> 
> RealNumber('0.180489972066962026629620880838378650496225604668529521981')*I'
> }}}

That's coming from a newline, which appears in Mathematica 5 I guess, but not 6.  Anyway,
the patch I justed posted at 

fixes the problem.  Alternatively rewrite the function like this:

sage: def math_bessel_K(nu,x):
  return sage_eval(repr(mathematica(nu).BesselK(x).N(20)).replace('\n',''))

Important note: The conversion from Mathematica to Sage, i.e., mathematica_object.sage()
is very naive still -- all it is is basically sage_eval(repr(...))!   This could/would be improved
if somebody cared a lot.

William
```

Assignee: @williamstein

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/1491





---

archive/issue_comments_009861.json:
```json
{
    "body": "Attachment [trac-1491.patch](tarball://root/attachments/some-uuid/ticket1491/trac-1491.patch) by @williamstein created at 2007-12-13 20:24:12",
    "created_at": "2007-12-13T20:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1491#issuecomment-9861",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac-1491.patch](tarball://root/attachments/some-uuid/ticket1491/trac-1491.patch) by @williamstein created at 2007-12-13 20:24:12



---

archive/issue_comments_009862.json:
```json
{
    "body": "<a id='comment:1'></a>Looks good.  (Looks reasonable, and sage/interfaces/mathematica.py doctests pass on sage.math.)",
    "created_at": "2007-12-15T05:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1491#issuecomment-9862",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:1'></a>Looks good.  (Looks reasonable, and sage/interfaces/mathematica.py doctests pass on sage.math.)



---

archive/issue_comments_009863.json:
```json
{
    "body": "<a id='comment:2'></a>Merged in 2.9.rc0.",
    "created_at": "2007-12-15T05:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1491#issuecomment-9863",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>Merged in 2.9.rc0.



---

archive/issue_events_003797.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2007-12-15T05:40:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/1491",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/1491#event-3797"
}
```



---

archive/issue_comments_009864.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2007-12-15T05:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/1491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/1491#issuecomment-9864",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed
