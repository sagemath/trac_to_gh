# Issue 1367: weird bug creating fractional ideal in relative number field

archive/issues_001367.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "I noticed this bug when thinking about implementing factorization of integers\nin a general relative number field (via the absolute field corresponding\nto it).  If this bug were fixed, then general factorization would be\ntrivial to implement, as suggested by the example below. \n\n```\nsage: K.<a,b> = NumberField([x^2 + 1, x^2 + 2])\nsage: A = K.absolute_field('z')\nsage: I = A.factor_integer(3)[0][0]\nsage: from_A, to_A = A.structure()\nsage: G = [from_A(z) for z in I.gens()]; G\n[3, (-2*b - 1)*a + b - 1]\nsage: K.fractional_ideal(G)\n---------------------------------------------------------------------------\n<type 'exceptions.TypeError'>             Traceback (most recent call last)\n\n/Users/was/s/devel/sage-main/sage/rings/number_field/<ipython console> in <module>()\n\n/Users/was/s/local/lib/python2.5/site-packages/IPython/Prompts.py in __call__(self, arg)\n    521 \n    522             # and now call a possibly user-defined print mechanism\n--> 523             manipulated_val = self.display(arg)\n    524             \n    525             # user display hooks can change the variable to be stored in\n\n/Users/was/s/local/lib/python2.5/site-packages/IPython/Prompts.py in _display(self, arg)\n    545         \"\"\"\n    546 \n--> 547         return self.shell.hooks.result_display(arg)\n    548 \n    549     # Assign the default display method:\n\n/Users/was/s/local/lib/python2.5/site-packages/IPython/hooks.py in __call__(self, *args, **kw)\n    132             #print \"prio\",prio,\"cmd\",cmd #dbg\n    133             try:\n--> 134                 ret = cmd(*args, **kw)\n    135                 return ret\n    136             except ipapi.TryNext, exc:\n\n/Users/was/s/local/lib/python2.5/site-packages/IPython/hooks.py in result_display(self, arg)\n    160     \n    161     if self.rc.pprint:\n--> 162         out = pformat(arg)\n    163         if '\\n' in out:\n    164             # So that multi-line strings line up with the left column of\n\n/Users/was/s/local/lib/python2.5/pprint.py in pformat(self, object)\n    109     def pformat(self, object):\n    110         sio = _StringIO()\n--> 111         self._format(object, sio, 0, 0, {}, 0)\n    112         return sio.getvalue()\n    113 \n\n/Users/was/s/local/lib/python2.5/pprint.py in _format(self, object, stream, indent, allowance, context, level)\n    127             self._readable = False\n    128             return\n--> 129         rep = self._repr(object, context, level - 1)\n    130         typ = _type(object)\n    131         sepLines = _len(rep) > (self._width - 1 - indent - allowance)\n\n/Users/was/s/local/lib/python2.5/pprint.py in _repr(self, object, context, level)\n    193     def _repr(self, object, context, level):\n    194         repr, readable, recursive = self.format(object, context.copy(),\n--> 195                                                 self._depth, level)\n    196         if not readable:\n    197             self._readable = False\n\n/Users/was/s/local/lib/python2.5/pprint.py in format(self, object, context, maxlevels, level)\n    205         and whether the object represents a recursive construct.\n    206         \"\"\"\n--> 207         return _safe_repr(object, context, maxlevels, level)\n    208 \n    209 \n\n/Users/was/s/local/lib/python2.5/pprint.py in _safe_repr(object, context, maxlevels, level)\n    290         return format % _commajoin(components), readable, recursive\n    291 \n--> 292     rep = repr(object)\n    293     return rep, (rep and not rep.startswith('<')), False\n    294 \n\n/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal.py in __repr__(self)\n    215 \n    216     def __repr__(self):\n--> 217         return \"Fractional ideal %s\"%self._repr_short()\n    218 \n    219     def _repr_short(self):\n\n/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal.py in _repr_short(self)\n    232         # makes things insanely slow in general.\n    233         # When I fix this, I *have* to also change the _latex_ method.\n--> 234         return '(%s)'%(', '.join([str(x) for x in self.gens_reduced()]))\n    235 \n    236     def __div__(self, other):\n\n\n\n\n\n\n\n\n\n/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)\n     84             S = L['x']\n     85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())\n---> 86             gens = [ L(R(x.lift().lift())) for x in gens ]\n     87             ## Make sure that gens[1] is in L, not K\n     88             Lcoeff = [ L(x) for x in list(gens[1].polynomial()) ]\n\n/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field.py in __call__(self, x)\n   3321             return self.base_field()(x)\n   3322         \n-> 3323         return self._element_class(self, x)\n   3324 \n   3325     def _coerce_impl(self, x):\n\n/Users/was/s/devel/sage-main/sage/rings/number_field/number_field_element.pyx in sage.rings.number_field.number_field_element.NumberFieldElement.__init__()\n    231         num = f * den\n    232         for i from 0 <= i <= num.degree():\n--> 233             (<Integer>ZZ(num[i]))._to_ZZ(&coeff)\n    234             ZZX_SetCoeff( self.__numerator, i, coeff )\n    235 \n\n/Users/was/s/devel/sage-main/sage/rings/number_field/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class.__call__()\n\n<type 'exceptions.TypeError'>: Unable to coerce -b - 2 to an integer\n\n```\n\nComponent: **number theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/1367_\n\n",
    "closed_at": "2009-01-29T05:42:49Z",
    "created_at": "2007-12-02T07:52:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "weird bug creating fractional ideal in relative number field",
    "type": "issue",
    "updated_at": "2009-01-29T05:43:57Z",
    "url": "https://github.com/sagemath/sage/issues/1367",
    "user": "https://github.com/williamstein"
}
```
I noticed this bug when thinking about implementing factorization of integers
in a general relative number field (via the absolute field corresponding
to it).  If this bug were fixed, then general factorization would be
trivial to implement, as suggested by the example below. 

```
sage: K.<a,b> = NumberField([x^2 + 1, x^2 + 2])
sage: A = K.absolute_field('z')
sage: I = A.factor_integer(3)[0][0]
sage: from_A, to_A = A.structure()
sage: G = [from_A(z) for z in I.gens()]; G
[3, (-2*b - 1)*a + b - 1]
sage: K.fractional_ideal(G)
---------------------------------------------------------------------------
<type 'exceptions.TypeError'>             Traceback (most recent call last)

/Users/was/s/devel/sage-main/sage/rings/number_field/<ipython console> in <module>()

/Users/was/s/local/lib/python2.5/site-packages/IPython/Prompts.py in __call__(self, arg)
    521 
    522             # and now call a possibly user-defined print mechanism
--> 523             manipulated_val = self.display(arg)
    524             
    525             # user display hooks can change the variable to be stored in

/Users/was/s/local/lib/python2.5/site-packages/IPython/Prompts.py in _display(self, arg)
    545         """
    546 
--> 547         return self.shell.hooks.result_display(arg)
    548 
    549     # Assign the default display method:

/Users/was/s/local/lib/python2.5/site-packages/IPython/hooks.py in __call__(self, *args, **kw)
    132             #print "prio",prio,"cmd",cmd #dbg
    133             try:
--> 134                 ret = cmd(*args, **kw)
    135                 return ret
    136             except ipapi.TryNext, exc:

/Users/was/s/local/lib/python2.5/site-packages/IPython/hooks.py in result_display(self, arg)
    160     
    161     if self.rc.pprint:
--> 162         out = pformat(arg)
    163         if '\n' in out:
    164             # So that multi-line strings line up with the left column of

/Users/was/s/local/lib/python2.5/pprint.py in pformat(self, object)
    109     def pformat(self, object):
    110         sio = _StringIO()
--> 111         self._format(object, sio, 0, 0, {}, 0)
    112         return sio.getvalue()
    113 

/Users/was/s/local/lib/python2.5/pprint.py in _format(self, object, stream, indent, allowance, context, level)
    127             self._readable = False
    128             return
--> 129         rep = self._repr(object, context, level - 1)
    130         typ = _type(object)
    131         sepLines = _len(rep) > (self._width - 1 - indent - allowance)

/Users/was/s/local/lib/python2.5/pprint.py in _repr(self, object, context, level)
    193     def _repr(self, object, context, level):
    194         repr, readable, recursive = self.format(object, context.copy(),
--> 195                                                 self._depth, level)
    196         if not readable:
    197             self._readable = False

/Users/was/s/local/lib/python2.5/pprint.py in format(self, object, context, maxlevels, level)
    205         and whether the object represents a recursive construct.
    206         """
--> 207         return _safe_repr(object, context, maxlevels, level)
    208 
    209 

/Users/was/s/local/lib/python2.5/pprint.py in _safe_repr(object, context, maxlevels, level)
    290         return format % _commajoin(components), readable, recursive
    291 
--> 292     rep = repr(object)
    293     return rep, (rep and not rep.startswith('<')), False
    294 

/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal.py in __repr__(self)
    215 
    216     def __repr__(self):
--> 217         return "Fractional ideal %s"%self._repr_short()
    218 
    219     def _repr_short(self):

/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal.py in _repr_short(self)
    232         # makes things insanely slow in general.
    233         # When I fix this, I *have* to also change the _latex_ method.
--> 234         return '(%s)'%(', '.join([str(x) for x in self.gens_reduced()]))
    235 
    236     def __div__(self, other):









/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)
     84             S = L['x']
     85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())
---> 86             gens = [ L(R(x.lift().lift())) for x in gens ]
     87             ## Make sure that gens[1] is in L, not K
     88             Lcoeff = [ L(x) for x in list(gens[1].polynomial()) ]

/Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field.py in __call__(self, x)
   3321             return self.base_field()(x)
   3322         
-> 3323         return self._element_class(self, x)
   3324 
   3325     def _coerce_impl(self, x):

/Users/was/s/devel/sage-main/sage/rings/number_field/number_field_element.pyx in sage.rings.number_field.number_field_element.NumberFieldElement.__init__()
    231         num = f * den
    232         for i from 0 <= i <= num.degree():
--> 233             (<Integer>ZZ(num[i]))._to_ZZ(&coeff)
    234             ZZX_SetCoeff( self.__numerator, i, coeff )
    235 

/Users/was/s/devel/sage-main/sage/rings/number_field/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class.__call__()

<type 'exceptions.TypeError'>: Unable to coerce -b - 2 to an integer

```

Component: **number theory**

_Issue created by migration from https://trac.sagemath.org/ticket/1367_





---

archive/issue_events_013484.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-12-02T07:52:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "milestone_number": null,
    "milestone_title": "sage-2.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13484"
}
```



---

archive/issue_events_013485.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-12-02T07:52:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13485"
}
```



---

archive/issue_events_013486.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-12-02T07:52:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13486"
}
```



---

archive/issue_events_013487.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-12-02T07:52:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13487"
}
```



---

archive/issue_events_013488.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-12-02T07:52:55Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13488"
}
```



---

archive/issue_events_013489.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-12-26T03:09:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "milestone_number": null,
    "milestone_title": "sage-2.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13489"
}
```



---

archive/issue_events_013490.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-12-26T03:09:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "milestone_number": null,
    "milestone_title": "sage-2.9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13490"
}
```



---

archive/issue_comments_006351.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis might well be fixed by the patches posted for #1946.  Unfortunately I do not seem to be able to test that, owing to my complete incompetence in applying patches, even my own.  It would be a good idea if #1946 was cross-referenced to this one.\n\n In case this seems crazy:  fixing #1946 by adding lots of doctests to the code for Tate's algorithm over number fields revealed some minor bugs in its implementation, and fixing those revealed some bugs in the code for ideals and fractional ideals in number fields.  I fixed that (in late January, partly jointly with William) and at the same time -- I seem to remember -- fixed this thing about ideals in relative extensions.\n\n Both the patches  attached to #1946 are waiting review....",
    "created_at": "2008-02-18T12:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6351",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

This might well be fixed by the patches posted for #1946.  Unfortunately I do not seem to be able to test that, owing to my complete incompetence in applying patches, even my own.  It would be a good idea if #1946 was cross-referenced to this one.

 In case this seems crazy:  fixing #1946 by adding lots of doctests to the code for Tate's algorithm over number fields revealed some minor bugs in its implementation, and fixing those revealed some bugs in the code for ideals and fractional ideals in number fields.  I fixed that (in late January, partly jointly with William) and at the same time -- I seem to remember -- fixed this thing about ideals in relative extensions.

 Both the patches  attached to #1946 are waiting review....



---

archive/issue_comments_006352.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis is still broken in sage-3.0.",
    "created_at": "2008-04-25T01:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6352",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:3" align="right">comment:3</div>

This is still broken in sage-3.0.



---

archive/issue_comments_006353.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe problem is triggered at line 89 of `number_field_ideal_rel.py` (in 3.0.5):\n\n```\n            gens = [ L(R(x.lift().lift())) for x in gens ]\n```\nIn the case above , `L` is the field `K` and (when `x` is `gens[1]`) `R(x.lift().lift())` is the polynomial `(-b + 1)*x - b - 2` over the base field of `K`.   But the real difficulty is that `NumberFieldElement.__init__` doesn't work properly for relative fields; it ought to coerce a polynomial over the base field into the field, but doesn't.\n\nRather than trying to resolve the general problem with this coercion, it's easy to rewrite the above line 89, as in \nthe attached patch.  Then the following works:\n\n```\nsage: K.<a, b> = NumberField([x^2 + 1, x^2 + 2])\nsage: A = K.absolute_field('z')\nsage: from_A, to_A = A.structure()\nsage: abs_ideals = [f[0] for f in A.factor(3)]\nsage: rel_ideals = [K.ideal([from_A(y) for y in I.gens()]) for I in abs_ideals]\nsage: rel_ideals\n[Fractional ideal (3, a - 1), Fractional ideal (3, (-1)*a - 1)]\nsage: prod(rel_ideals)\nFractional ideal (3)\nsage: [J.is_principal() for J in rel_ideals]\n[True, True]\n```",
    "created_at": "2008-07-18T17:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6353",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:4" align="right">comment:4</div>

The problem is triggered at line 89 of `number_field_ideal_rel.py` (in 3.0.5):

```
            gens = [ L(R(x.lift().lift())) for x in gens ]
```
In the case above , `L` is the field `K` and (when `x` is `gens[1]`) `R(x.lift().lift())` is the polynomial `(-b + 1)*x - b - 2` over the base field of `K`.   But the real difficulty is that `NumberFieldElement.__init__` doesn't work properly for relative fields; it ought to coerce a polynomial over the base field into the field, but doesn't.

Rather than trying to resolve the general problem with this coercion, it's easy to rewrite the above line 89, as in 
the attached patch.  Then the following works:

```
sage: K.<a, b> = NumberField([x^2 + 1, x^2 + 2])
sage: A = K.absolute_field('z')
sage: from_A, to_A = A.structure()
sage: abs_ideals = [f[0] for f in A.factor(3)]
sage: rel_ideals = [K.ideal([from_A(y) for y in I.gens()]) for I in abs_ideals]
sage: rel_ideals
[Fractional ideal (3, a - 1), Fractional ideal (3, (-1)*a - 1)]
sage: prod(rel_ideals)
Fractional ideal (3)
sage: [J.is_principal() for J in rel_ideals]
[True, True]
```



---

archive/issue_events_013491.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2008-07-18T17:57:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "title_is": "one line patch for weird bug creating fractional ideal in relative number field",
    "title_was": "weird bug creating fractional ideal in relative number field",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13491"
}
```



---

archive/issue_comments_006354.json:
```json
{
    "body": "Attachment: **[sage-1367.patch.gz](https://github.com/sagemath/sage/files/ticket1367/sage-1367.patch.gz)**",
    "created_at": "2008-07-18T17:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6354",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Attachment: **[sage-1367.patch.gz](https://github.com/sagemath/sage/files/ticket1367/sage-1367.patch.gz)**



---

archive/issue_comments_006355.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -93,6 +93,7 @@\n     235 \n     236     def __div__(self, other):\n \n+\n /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)\n      84             S = L['x']\n      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())\n``````\n",
    "created_at": "2008-07-18T18:19:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6355",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -93,6 +93,7 @@
     235 
     236     def __div__(self, other):
 
+
 /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)
      84             S = L['x']
      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())
``````




---

archive/issue_comments_006356.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHi Francis, \n\nI changed the title slightly so our various sql queries pick it up.\n\nCheers,\n\nMichael",
    "created_at": "2008-07-18T18:19:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6356",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:5" align="right">comment:5</div>

Hi Francis, 

I changed the title slightly so our various sql queries pick it up.

Cheers,

Michael



---

archive/issue_events_013492.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-07-18T18:19:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "title_is": "weird bug creating fractional ideal in relative number field",
    "title_was": "one line patch for weird bug creating fractional ideal in relative number field",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13492"
}
```



---

archive/issue_events_013493.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-07-18T18:19:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13493"
}
```



---

archive/issue_events_013494.json:
```json
{
    "actor": "https://github.com/sagetrac-dmharvey",
    "created_at": "2008-07-18T18:54:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13494"
}
```



---

archive/issue_events_013495.json:
```json
{
    "actor": "https://github.com/sagetrac-dmharvey",
    "created_at": "2008-07-18T18:54:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13495"
}
```



---

archive/issue_comments_006357.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHi,\n\nTwo things. First, the patch needs at least one doctest.\n\nSecond, something very fishy is going on. After applying this patch, I try out the example at the top of the definition of `NumberFieldFractionalIdeal_rel`, under the WARNING:\n\n```\nsage: K.<a> = NumberField([x^2 + 1, x^2 + 2]); K\nNumber Field in a0 with defining polynomial x^2 + 1 over its base field\nsage: i = K.ideal([a+1])\nsage: i\nFractional ideal (1)\n```\n\nIf `a+1` generates the unit ideal, it had better be a unit. But a+1 is really 1+i (the Gaussian integer), which is not a unit. Alternatively\n\n```\nsage: (a+1).norm()\n4\n```\nwhich is not +1 or -1.",
    "created_at": "2008-07-18T18:54:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6357",
    "user": "https://github.com/sagetrac-dmharvey"
}
```

<div id="comment:6" align="right">comment:6</div>

Hi,

Two things. First, the patch needs at least one doctest.

Second, something very fishy is going on. After applying this patch, I try out the example at the top of the definition of `NumberFieldFractionalIdeal_rel`, under the WARNING:

```
sage: K.<a> = NumberField([x^2 + 1, x^2 + 2]); K
Number Field in a0 with defining polynomial x^2 + 1 over its base field
sage: i = K.ideal([a+1])
sage: i
Fractional ideal (1)
```

If `a+1` generates the unit ideal, it had better be a unit. But a+1 is really 1+i (the Gaussian integer), which is not a unit. Alternatively

```
sage: (a+1).norm()
4
```
which is not +1 or -1.



---

archive/issue_comments_006358.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nContinuing the calculation, we have\n\n```\nsage: i.gens()\n(a + 1,)\nsage: i.gens_reduced()\n(1,)\n```\nand `i.__repr__()` via `i._repr_short(self)` uses `i.gens_reduced()`\n\nThe problem is with lines 90\u201392 of `number_field_ideal_rel.py`\n\n```\n            ## Make sure that gens[1] is in L, not K\n            Lcoeff = [ L(x) for x in list(gens[1].polynomial()) ]\n            gens[1] = S.hom([L.gen()])(S(Lcoeff))\n```\nwhich seem totally wrong-headed.  In the case in question `gens` is `[2, (-b)*a]` (which is ok).  Then `(-b)*a` gets \nconverted to `1/2*x^2 + 3/2`, which is the polynomial representing it in the *absolute* field, after which `x` is (in a most\nconvoluted way) replaced by `a`, giving (of course) `1` (which is not ok).\n\nThere must be a much simpler way to achieve the object of ensuring that the generator is an element of the relative field.",
    "created_at": "2008-07-18T23:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6358",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:7" align="right">comment:7</div>

Continuing the calculation, we have

```
sage: i.gens()
(a + 1,)
sage: i.gens_reduced()
(1,)
```
and `i.__repr__()` via `i._repr_short(self)` uses `i.gens_reduced()`

The problem is with lines 90–92 of `number_field_ideal_rel.py`

```
            ## Make sure that gens[1] is in L, not K
            Lcoeff = [ L(x) for x in list(gens[1].polynomial()) ]
            gens[1] = S.hom([L.gen()])(S(Lcoeff))
```
which seem totally wrong-headed.  In the case in question `gens` is `[2, (-b)*a]` (which is ok).  Then `(-b)*a` gets 
converted to `1/2*x^2 + 3/2`, which is the polynomial representing it in the *absolute* field, after which `x` is (in a most
convoluted way) replaced by `a`, giving (of course) `1` (which is not ok).

There must be a much simpler way to achieve the object of ensuring that the generator is an element of the relative field.



---

archive/issue_comments_006359.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOh look, the patch is probably fine, but I go completely nuts every time I delve into any of the algebraic number theory stuff in Sage. I mean, why on earth is `NumberFieldFractionalIdeal` a subclass of `Ideal_generic`?? That's completely nuts. ***A fractional ideal is not an ideal.*** That's about as sensible as making `Rational` a subclass of `Integer`. Trying to patch this one line at a time is like trying to stop global warming with a toothpick.\n\nI suggest that you (1) report the above as a separate ticket, (2) add a doctest to your patch to at least illustrate the corrected behaviour, (3) \"correct\" the doctest under the WARNING so at least it doesn't fail when doctests are run, (4) do a full run of doctests to see what else \"breaks\", (5) replace \"Willia Stein\" by \"William Stein\" in the authors at the top of the file, and (6) find someone else game enough to review this patch.",
    "created_at": "2008-07-19T04:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6359",
    "user": "https://github.com/sagetrac-dmharvey"
}
```

<div id="comment:8" align="right">comment:8</div>

Oh look, the patch is probably fine, but I go completely nuts every time I delve into any of the algebraic number theory stuff in Sage. I mean, why on earth is `NumberFieldFractionalIdeal` a subclass of `Ideal_generic`?? That's completely nuts. ***A fractional ideal is not an ideal.*** That's about as sensible as making `Rational` a subclass of `Integer`. Trying to patch this one line at a time is like trying to stop global warming with a toothpick.

I suggest that you (1) report the above as a separate ticket, (2) add a doctest to your patch to at least illustrate the corrected behaviour, (3) "correct" the doctest under the WARNING so at least it doesn't fail when doctests are run, (4) do a full run of doctests to see what else "breaks", (5) replace "Willia Stein" by "William Stein" in the authors at the top of the file, and (6) find someone else game enough to review this patch.



---

archive/issue_comments_006360.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI spent several evening 6 months ago on this chunk of code, trying to see how it was supposed to work and fixing what didn't.  It was not a very happy experience -- not helped by the fact that this was just about the first ever Sage development which I did.  On the other hand, I was helped a lot at the time by William.  Th eonly reason I got into that code at all was that I decided to add doctests to `ell_number_field.py` and found lots of things broken. \n\nAnyway, while I cannot guarantee to have time to review this properly soon, I'll do what I can.",
    "created_at": "2008-07-19T08:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6360",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:9" align="right">comment:9</div>

I spent several evening 6 months ago on this chunk of code, trying to see how it was supposed to work and fixing what didn't.  It was not a very happy experience -- not helped by the fact that this was just about the first ever Sage development which I did.  On the other hand, I was helped a lot at the time by William.  Th eonly reason I got into that code at all was that I decided to add doctests to `ell_number_field.py` and found lots of things broken. 

Anyway, while I cannot guarantee to have time to review this properly soon, I'll do what I can.



---

archive/issue_comments_006361.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe more I look at `number_field_ideal_rel.py`, the more I notice needs doing.  For example, in\n\n```\n    def absolute_ideal(self):\n        \"\"\"\n        If this is an ideal in the extension L/K, return the ideal with\n        the same generators in the absolute field L/Q.\n        \"\"\"\n        try:\n            return self.__absolute_ideal\n        except AttributeError:\n            rnf = self.number_field().pari_rnf()\n            L = self.number_field().absolute_field('a')\n            R = L['x']\n            nf = L.pari_nf()\n            genlist = [L(R(x.polynomial())) for x in list(self.gens())]\n            self.__absolute_ideal = L.ideal(genlist)\n            return self.__absolute_ideal\n```\n(1) The generator of the absolute field is always called 'a'; it would be much better if the user could choose the name, and, even better, was also able to get the absolute ideal via something like `A = K.absolute_field('z'); A(J)`. (2) Neither `rnf` nor `nf` get used. (3) Since `x.polynomial()` is a rational polynomial, `L(R(x.polynomial()))` is the same as `L(x.polynomial())`. (4) In this context, `list(self.gens())`is no different from `self.gens()`.\n\nI've come to the conclusion that a more serious rewrite (with some more testing doctests) is needed, for which I'm unlikely to have much time in the next few weeks.  My one-line patch was really only meant to point out where the defect lay.",
    "created_at": "2008-07-19T09:21:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6361",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:10" align="right">comment:10</div>

The more I look at `number_field_ideal_rel.py`, the more I notice needs doing.  For example, in

```
    def absolute_ideal(self):
        """
        If this is an ideal in the extension L/K, return the ideal with
        the same generators in the absolute field L/Q.
        """
        try:
            return self.__absolute_ideal
        except AttributeError:
            rnf = self.number_field().pari_rnf()
            L = self.number_field().absolute_field('a')
            R = L['x']
            nf = L.pari_nf()
            genlist = [L(R(x.polynomial())) for x in list(self.gens())]
            self.__absolute_ideal = L.ideal(genlist)
            return self.__absolute_ideal
```
(1) The generator of the absolute field is always called 'a'; it would be much better if the user could choose the name, and, even better, was also able to get the absolute ideal via something like `A = K.absolute_field('z'); A(J)`. (2) Neither `rnf` nor `nf` get used. (3) Since `x.polynomial()` is a rational polynomial, `L(R(x.polynomial()))` is the same as `L(x.polynomial())`. (4) In this context, `list(self.gens())`is no different from `self.gens()`.

I've come to the conclusion that a more serious rewrite (with some more testing doctests) is needed, for which I'm unlikely to have much time in the next few weeks.  My one-line patch was really only meant to point out where the defect lay.



---

archive/issue_events_013496.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2008-07-19T09:21:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "milestone_number": null,
    "milestone_title": "sage-3.0.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13496"
}
```



---

archive/issue_events_013497.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2008-07-19T09:21:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "milestone_number": null,
    "milestone_title": "sage-3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13497"
}
```



---

archive/issue_events_013498.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2008-07-19T09:21:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "title_is": "[needs a substantial amount of work] weird bug creating fractional ideal in relative number field",
    "title_was": "weird bug creating fractional ideal in relative number field",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13498"
}
```



---

archive/issue_comments_006362.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI have made a new ticket #3680 to cover my general gripes about the algebraic number theory framework. But I don't have time to work on it now.",
    "created_at": "2008-07-19T13:38:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6362",
    "user": "https://github.com/sagetrac-dmharvey"
}
```

<div id="comment:11" align="right">comment:11</div>

I have made a new ticket #3680 to cover my general gripes about the algebraic number theory framework. But I don't have time to work on it now.



---

archive/issue_events_013499.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-01-24T09:39:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "title_is": "weird bug creating fractional ideal in relative number field",
    "title_was": "[needs a substantial amount of work] weird bug creating fractional ideal in relative number field",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13499"
}
```



---

archive/issue_events_013500.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-01-24T09:39:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13500"
}
```



---

archive/issue_events_013501.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-01-24T09:39:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13501"
}
```



---

archive/issue_comments_006363.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThis relies on #5066.  Apply that first.\n\nThis DOES NOT address every issue with relative number fields, but it does help in the creation and coercion.  Significantly.\n\nPlenty of doctests, but tons of work left to be done.  The important part is that one can now create relative number field elements from relative polynomials self.base_ring()['x'] or from stacked polynomials QQ['base']['ext'].  Fixes all sorts of things.\n\nDon't forget to close #4869 and #4727 after this is merged.",
    "created_at": "2009-01-24T09:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6363",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:12" align="right">comment:12</div>

This relies on #5066.  Apply that first.

This DOES NOT address every issue with relative number fields, but it does help in the creation and coercion.  Significantly.

Plenty of doctests, but tons of work left to be done.  The important part is that one can now create relative number field elements from relative polynomials self.base_ring()['x'] or from stacked polynomials QQ['base']['ext'].  Fixes all sorts of things.

Don't forget to close #4869 and #4727 after this is merged.



---

archive/issue_comments_006364.json:
```json
{
    "body": "Attachment: **[trac_1367.patch.gz](https://github.com/sagemath/sage/files/ticket1367/trac_1367.patch.gz)**",
    "created_at": "2009-01-24T09:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6364",
    "user": "https://github.com/ncalexan"
}
```

Attachment: **[trac_1367.patch.gz](https://github.com/sagemath/sage/files/ticket1367/trac_1367.patch.gz)**



---

archive/issue_comments_006365.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nDo not apply `sage-1367.patch`.\n\nThere may be doctests missing on some functions, but I can't fix this, document a ton of stuff, and doctest every untested function in one go.  This is very much a work in progress patch.",
    "created_at": "2009-01-24T10:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6365",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:13" align="right">comment:13</div>

Do not apply `sage-1367.patch`.

There may be doctests missing on some functions, but I can't fix this, document a ton of stuff, and doctest every untested function in one go.  This is very much a work in progress patch.



---

archive/issue_comments_006366.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThere are a few things I want to discuss (probably at lunch).\n\nThe first is that I'm not completely convinced that the following example is the behavior we want:\n\nsage: K.<a> = NumberField(ZZ['x'].0^5 + 2, 'a') \nsage: L.<b> = K.extension(ZZ['x'].0^2 + 3*a, 'b') \nsage: u = QQ['u'].gen() \nsage: t = u.parent()['t'].gen()\n\nsage: L(u*5)\n5*b\n\nI guess if we're going to convert at all this makes the most sense, but I want to think about it a bit more.  I'm even less convinced of the following:\n\nsage: W.<w> = t.parent()[]\nsage: L(w*5)\n5*b\nsage: L(W(t))\n5*a\nsage: L(W(u))\nTypeError\n\nThe second issue is a naming one.  The function coerce_non_number_field_element_in should probably be a convert function rather than a coerce one.\n\nOverall, though, it looks quite good.",
    "created_at": "2009-01-24T17:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6366",
    "user": "https://github.com/roed314"
}
```

<div id="comment:14" align="right">comment:14</div>

There are a few things I want to discuss (probably at lunch).

The first is that I'm not completely convinced that the following example is the behavior we want:

sage: K.<a> = NumberField(ZZ['x'].0^5 + 2, 'a') 
sage: L.<b> = K.extension(ZZ['x'].0^2 + 3*a, 'b') 
sage: u = QQ['u'].gen() 
sage: t = u.parent()['t'].gen()

sage: L(u*5)
5*b

I guess if we're going to convert at all this makes the most sense, but I want to think about it a bit more.  I'm even less convinced of the following:

sage: W.<w> = t.parent()[]
sage: L(w*5)
5*b
sage: L(W(t))
5*a
sage: L(W(u))
TypeError

The second issue is a naming one.  The function coerce_non_number_field_element_in should probably be a convert function rather than a coerce one.

Overall, though, it looks quite good.



---

archive/issue_events_013502.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2009-01-24T17:31:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "title_is": "[needs discussion] weird bug creating fractional ideal in relative number field",
    "title_was": "weird bug creating fractional ideal in relative number field",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13502"
}
```



---

archive/issue_comments_006367.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe patch explains why the first behaviour is correct.  Do you want\n\n```\nsage: x = ZZ['x'].0\nsage: K.<a> = QuadraticField(5)\nsage: L.<b> = K.extension(x^2 - a)\nsage: L(x + 2) in L\nTrue\n```\nor\n\n```\nsage: L(x + 2) in K\nTrue\n```\n\nI think the first is *much* more desirable.\n\nYour second issue is a good point.  I should make sure you're either giving QQ['x'] (or something isomorphic) or QQ['base']['ext'] or base['ext'].  But that's hard at this time.\n\nAs for naming: make it a new ticket.  It's not worth shuffing a rename in with a reorganization in my opinion.",
    "created_at": "2009-01-24T20:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6367",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:15" align="right">comment:15</div>

The patch explains why the first behaviour is correct.  Do you want

```
sage: x = ZZ['x'].0
sage: K.<a> = QuadraticField(5)
sage: L.<b> = K.extension(x^2 - a)
sage: L(x + 2) in L
True
```
or

```
sage: L(x + 2) in K
True
```

I think the first is *much* more desirable.

Your second issue is a good point.  I should make sure you're either giving QQ['x'] (or something isomorphic) or QQ['base']['ext'] or base['ext'].  But that's hard at this time.

As for naming: make it a new ticket.  It's not worth shuffing a rename in with a reorganization in my opinion.



---

archive/issue_comments_006368.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nNick, David: any chance to see some movement on this? I would like to get this in before it rots and potential issues can be addressed via followup tickets.\n\nThoughts?\n\nCheers,\n\nMichael",
    "created_at": "2009-01-29T04:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6368",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:16" align="right">comment:16</div>

Nick, David: any chance to see some movement on this? I would like to get this in before it rots and potential issues can be addressed via followup tickets.

Thoughts?

Cheers,

Michael



---

archive/issue_comments_006369.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -94,6 +94,7 @@\n     236     def __div__(self, other):\n \n \n+\n /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)\n      84             S = L['x']\n      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())\n``````\n",
    "created_at": "2009-01-29T04:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6369",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -94,6 +94,7 @@
     236     def __div__(self, other):
 
 
+
 /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)
      84             S = L['x']
      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())
``````




---

archive/issue_comments_006370.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI think this should be applied and more tickets opened for any additional issues.\n\n* It's an improvement upon the old code and addresses 3 tickets.\n\n* It was never going to be the final say in this area.\n\n* I don't have time to work on it more, and neither does David Roe.",
    "created_at": "2009-01-29T05:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6370",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:17" align="right">comment:17</div>

I think this should be applied and more tickets opened for any additional issues.

* It's an improvement upon the old code and addresses 3 tickets.

* It was never going to be the final say in this area.

* I don't have time to work on it more, and neither does David Roe.



---

archive/issue_comments_006371.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@ncalexan](#comment:17):\n> I think this should be applied and more tickets opened for any additional issues.\n> \n> * It's an improvement upon the old code and addresses 3 tickets.\n> \n> * It was never going to be the final say in this area.\n> \n> * I don't have time to work on it more, and neither does David Roe.\n\nThanks Nick. Please open followup tickets and chance it to a positive review. I will then merge this ticket and its dependencies.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-29T05:03:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6371",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@ncalexan](#comment:17):
> I think this should be applied and more tickets opened for any additional issues.
> 
> * It's an improvement upon the old code and addresses 3 tickets.
> 
> * It was never going to be the final say in this area.
> 
> * I don't have time to work on it more, and neither does David Roe.

Thanks Nick. Please open followup tickets and chance it to a positive review. I will then merge this ticket and its dependencies.

Cheers,

Michael



---

archive/issue_comments_006372.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -95,6 +95,7 @@\n \n \n \n+\n /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)\n      84             S = L['x']\n      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())\n``````\n",
    "created_at": "2009-01-29T05:03:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6372",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -95,6 +95,7 @@
 
 
 
+
 /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)
      84             S = L['x']
      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())
``````




---

archive/issue_comments_006373.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOpened #5126 and #5127.",
    "created_at": "2009-01-29T05:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6373",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:19" align="right">comment:19</div>

Opened #5126 and #5127.



---

archive/issue_events_013503.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-01-29T05:09:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "title_is": "weird bug creating fractional ideal in relative number field",
    "title_was": "[needs discussion] weird bug creating fractional ideal in relative number field",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13503"
}
```



---

archive/issue_events_013504.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-01-29T05:09:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13504"
}
```



---

archive/issue_events_013505.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-01-29T05:09:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13505"
}
```



---

archive/issue_comments_006374.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOk, to make this patch apply I need to do two things:\n\n* change cannonical in this patch to canonical\n* apply the following patch\n\n```\ndiff -r ec9f29930e81 sage/rings/number_field/number_field_ideal_rel.py\n--- a/sage/rings/number_field/number_field_ideal_rel.py Sun Jan 25 08:47:06 2009 +0100\n+++ b/sage/rings/number_field/number_field_ideal_rel.py Wed Jan 28 21:27:03 2009 -0800\n@@ -69,8 +69,11 @@\n         try:\n             return self.__absolute_ideal\n         except AttributeError:\n+            rnf = self.number_field().pari_rnf()\n             L = self.number_field().absolute_field('a')\n-            genlist = [L(x.polynomial()) for x in list(self.gens())]\n+            R = L['x']\n+            nf = L.pari_nf()\n+            genlist = [L(R(x.polynomial())) for x in list(self.gens())]\n             self.__absolute_ideal = L.ideal(genlist)\n             return self.__absolute_ideal\n```\ndue to \n\n```\nchangeset:   11444:4196cd54c996\nuser:        Robert Bradshaw <robertwb@math.washington.edu>\ndate:        Fri Jan 23 03:38:03 2009 -0800\nsummary:     Convert univariate polynomials to new coercion model.\n```\nThis changes\n\n```\ngenlist = [L(R(x.polynomial())) for x in list(self.gens())]\n```\nto \n\n```\ngenlist = [L(R(x.polynomial())) for x in self.gens()]\n```\nbut doctests do pass. \n\nCheers,\n\nMichael",
    "created_at": "2009-01-29T05:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6374",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:20" align="right">comment:20</div>

Ok, to make this patch apply I need to do two things:

* change cannonical in this patch to canonical
* apply the following patch

```
diff -r ec9f29930e81 sage/rings/number_field/number_field_ideal_rel.py
--- a/sage/rings/number_field/number_field_ideal_rel.py Sun Jan 25 08:47:06 2009 +0100
+++ b/sage/rings/number_field/number_field_ideal_rel.py Wed Jan 28 21:27:03 2009 -0800
@@ -69,8 +69,11 @@
         try:
             return self.__absolute_ideal
         except AttributeError:
+            rnf = self.number_field().pari_rnf()
             L = self.number_field().absolute_field('a')
-            genlist = [L(x.polynomial()) for x in list(self.gens())]
+            R = L['x']
+            nf = L.pari_nf()
+            genlist = [L(R(x.polynomial())) for x in list(self.gens())]
             self.__absolute_ideal = L.ideal(genlist)
             return self.__absolute_ideal
```
due to 

```
changeset:   11444:4196cd54c996
user:        Robert Bradshaw <robertwb@math.washington.edu>
date:        Fri Jan 23 03:38:03 2009 -0800
summary:     Convert univariate polynomials to new coercion model.
```
This changes

```
genlist = [L(R(x.polynomial())) for x in list(self.gens())]
```
to 

```
genlist = [L(R(x.polynomial())) for x in self.gens()]
```
but doctests do pass. 

Cheers,

Michael



---

archive/issue_comments_006375.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -96,6 +96,8 @@\n \n \n \n+\n+\n /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)\n      84             S = L['x']\n      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())\n``````\n",
    "created_at": "2009-01-29T05:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6375",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -96,6 +96,8 @@
 
 
 
+
+
 /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)
      84             S = L['x']
      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())
``````




---

archive/issue_events_013506.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-29T05:34:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13506"
}
```



---

archive/issue_events_013507.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-29T05:34:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "milestone_number": null,
    "milestone_title": "sage-3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13507"
}
```



---

archive/issue_comments_006376.json:
```json
{
    "body": "This is Nick's patch with cannonical -> canonical fixed",
    "created_at": "2009-01-29T05:41:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6376",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

This is Nick's patch with cannonical -> canonical fixed



---

archive/issue_comments_006377.json:
```json
{
    "body": "Attachment: **[trac_1367.2.patch.gz](https://github.com/sagemath/sage/files/ticket1367/trac_1367.2.patch.gz)**\n\nThis patch is required due to #5069 to make Nick's patch apply",
    "created_at": "2009-01-29T05:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6377",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Attachment: **[trac_1367.2.patch.gz](https://github.com/sagemath/sage/files/ticket1367/trac_1367.2.patch.gz)**

This patch is required due to #5069 to make Nick's patch apply



---

archive/issue_comments_006378.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAttachment: **[trac_1367-prebase.patch.gz](https://github.com/sagemath/sage/files/ticket1367/trac_1367-prebase.patch.gz)**\n\nMerged trac_1367-prebase.patch and trac_1367.2.patch in Sage 3.3.alpha3.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-29T05:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6378",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:21" align="right">comment:21</div>

Attachment: **[trac_1367-prebase.patch.gz](https://github.com/sagemath/sage/files/ticket1367/trac_1367-prebase.patch.gz)**

Merged trac_1367-prebase.patch and trac_1367.2.patch in Sage 3.3.alpha3.

Cheers,

Michael



---

archive/issue_comments_006379.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -98,6 +98,7 @@\n \n \n \n+\n /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)\n      84             S = L['x']\n      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())\n``````\n",
    "created_at": "2009-01-29T05:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6379",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -98,6 +98,7 @@
 
 
 
+
 /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)
      84             S = L['x']
      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())
``````




---

archive/issue_events_013508.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-29T05:42:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13508"
}
```



---

archive/issue_events_013509.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-29T05:42:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/1367#event-13509"
}
```



---

archive/issue_comments_006380.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe issues David remarked about are now being handled via #5126 and #5127.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-29T05:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6380",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:22" align="right">comment:22</div>

The issues David remarked about are now being handled via #5126 and #5127.

Cheers,

Michael



---

archive/issue_comments_006381.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -99,6 +99,8 @@\n \n \n \n+\n+\n /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)\n      84             S = L['x']\n      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())\n``````\n",
    "created_at": "2009-01-29T05:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/1367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/1367#issuecomment-6381",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -99,6 +99,8 @@
 
 
 
+
+
 /Users/was/s/local/lib/python2.5/site-packages/sage/rings/number_field/number_field_ideal_rel.py in gens_reduced(self)
      84             S = L['x']
      85             gens = L.pari_rnf().rnfidealtwoelt(self.pari_rhnf())
``````

