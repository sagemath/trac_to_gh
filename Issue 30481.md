# Issue 30481: build/pkgs/pynac/dependencies: Remove giac

Issue created by migration from https://trac.sagemath.org/ticket/30718

Original creator: mkoeppe

Original creation time: 2020-10-04 16:57:52

CC:  dimpase jhpalmieri @thierry-freebsd mjo @tobiasdiez

As notes in #21700, our `pynac` spkg-install script explicitly disables use of giac. So that should not be a dependency.

Removing the dependency allows for greater parallelization of the build.

This is also a step toward allowing to build Sage with `./configure --without-giac` (see #30383 - `configure --disable-SPKG` for standard packages).

See also:
 - #29542 spkg-configure.m4 for pynac


---

Comment by mkoeppe created at 2020-10-04 17:01:02

New commits:


---

Comment by mkoeppe created at 2020-10-04 17:01:02

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2020-10-04 22:07:05

This looks okay, but something is wrong with other dependencies. With this branch, `make pynac` works. With the current `develop` branch, `make pynac` fails (on OS X + homebrew) because `giac` fails to build:

```
checking for lapack... no
configure: error: Package requirements (lapack) were not met:

No package 'lapack' found

Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.

Alternatively, you may set the environment variables LAPACK_CFLAGS
and LAPACK_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.
```

Running plain "make" works, I guess because something gets built before `giac` which provides whatever it needs.


---

Comment by jhpalmieri created at 2020-10-04 22:29:21

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-10-04 22:37:24

The giac dependencies look fine - it depends on gsl, which depends on BLAS


---

Comment by jhpalmieri created at 2020-10-04 22:55:43

I have homebrew packages for `openblas` and `gsl`, so Sage doesn't build those. I see this error on two different machines running OS X 10.15.7, Xcode 12, and a pretty complete homebrew installation (the only thing that Sage's configure complains about is `cmake`). If you have access to such a machine, try `make distclean; ./configure; make giac`. I'm curious about how it goes.


---

Comment by mkoeppe created at 2020-10-04 23:11:43

Yes, confirmed on my system (still with Xcode 11)


---

Comment by mkoeppe created at 2020-10-04 23:15:12

Doing `make toolchain` first fixes this problem.


---

Comment by jhpalmieri created at 2020-10-05 00:56:22

Replying to [comment:8 mkoeppe]:
> Doing `make toolchain` first fixes this problem.

Followup at #30721.


---

Comment by slelievre created at 2020-10-05 13:13:00

Changing keywords from "" to "dependencies, giac, pynac".


---

Comment by vbraun created at 2020-11-01 00:42:56

Resolution: fixed
