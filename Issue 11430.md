# Issue 11430: install_scripts should use "$@" instead of $*

archive/issues_011430.json:
```json
{
    "body": "Assignee: jason\n\nCC:  drkirkby leif\n\nKeywords: install_scripts, hg, command line\n\nWhen using a script created by Sage's install_scripts() function, parameters with spaces cause problems. Example:\n\n```\nFrom sage:\n\nsage: os.mkdir(\"temp\")\nsage: install_scripts(\"temp\")\nsage: quit\n\nFrom shell:\n\n$ cd temp\n$ mkdir hgtest\n$ cd hgtest\n$ ../hg init\n$ ../hg commit -m\"Two words\"\nabort: words: No such file or directory\n$ ../hg commit -m\"Oneword\"\nnothing changed\n```\n\n\nApparently this was discussed on the mailing list back in 2008:\nhttps://groups.google.com/forum/#!msg/sage-devel/oeFrvqWiP_s/o8mKO-4OAKkJ\n\nIt seems that the solution is to make install_scripts write \"$`@`\" instead of $* .\n\nIssue created by migration from https://trac.sagemath.org/ticket/11602\n\n",
    "created_at": "2011-07-15T15:38:51Z",
    "labels": [
        "misc",
        "minor",
        "bug"
    ],
    "title": "install_scripts should use \"$@\" instead of $*",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11430",
    "user": "Stefan"
}
```
Assignee: jason

CC:  drkirkby leif

Keywords: install_scripts, hg, command line

When using a script created by Sage's install_scripts() function, parameters with spaces cause problems. Example:

```
From sage:

sage: os.mkdir("temp")
sage: install_scripts("temp")
sage: quit

From shell:

$ cd temp
$ mkdir hgtest
$ cd hgtest
$ ../hg init
$ ../hg commit -m"Two words"
abort: words: No such file or directory
$ ../hg commit -m"Oneword"
nothing changed
```


Apparently this was discussed on the mailing list back in 2008:
https://groups.google.com/forum/#!msg/sage-devel/oeFrvqWiP_s/o8mKO-4OAKkJ

It seems that the solution is to make install_scripts write "$`@`" instead of $* .

Issue created by migration from https://trac.sagemath.org/ticket/11602





---

archive/issue_comments_127449.json:
```json
{
    "body": "Yep, from `sage/misc/dist.py`:\n\n```python\n\n            if os.path.exists(target):\n                print \"The file '%s' already exists; not adding shortcut\"%(target)\n            else:\n                o = open(target,'w')\n                o.write('#!/bin/sh\\n')\n                o.write('sage -%s $*\\n'%c)\n                print \"Created script '%s'\"%target\n                os.system('chmod a+rx %s'%target)\n```\n\n\nSo this should be `o.write('sage -%s \"$`@`\"\\n'%c)`.\n\nAt first glance, there are some other things that should be changed:\n\n* The generated file isn't explicitly closed after it was written (i.e., add `o.close()`).\n* `which` isn't portable; one should use the shell built-in `command -v ...`.\n\nMoreover:\n\n* As long as the generated scripts are trivial, using `#!/bin/sh` is ok; for more complex ones, this should be `#!/usr/bin/env bash` since on some systems `/bin/sh` is very limited or even broken. I wouldn't change it *here* though, since `/bin/sh` is usually a light-weight shell and therefore faster.\n* I wonder if it's really desirable to not install shortcuts for programs shipped with Sage of which **some** system-wide version is in the current `PATH`. We could at least add a boolean parameter (defaulting to `False`) to override this behaviour.\n\nBtw, you don't have to provide a doctest when fixing this; we'll just review the changes.",
    "created_at": "2011-07-15T17:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127449",
    "user": "leif"
}
```

Yep, from `sage/misc/dist.py`:

```python

            if os.path.exists(target):
                print "The file '%s' already exists; not adding shortcut"%(target)
            else:
                o = open(target,'w')
                o.write('#!/bin/sh\n')
                o.write('sage -%s $*\n'%c)
                print "Created script '%s'"%target
                os.system('chmod a+rx %s'%target)
```


So this should be `o.write('sage -%s "$`@`"\n'%c)`.

At first glance, there are some other things that should be changed:

* The generated file isn't explicitly closed after it was written (i.e., add `o.close()`).
* `which` isn't portable; one should use the shell built-in `command -v ...`.

Moreover:

* As long as the generated scripts are trivial, using `#!/bin/sh` is ok; for more complex ones, this should be `#!/usr/bin/env bash` since on some systems `/bin/sh` is very limited or even broken. I wouldn't change it *here* though, since `/bin/sh` is usually a light-weight shell and therefore faster.
* I wonder if it's really desirable to not install shortcuts for programs shipped with Sage of which **some** system-wide version is in the current `PATH`. We could at least add a boolean parameter (defaulting to `False`) to override this behaviour.

Btw, you don't have to provide a doctest when fixing this; we'll just review the changes.



---

archive/issue_comments_127450.json:
```json
{
    "body": "> which isn't portable; one should use the shell built-in command -v ....\n\nOr use the function `have_program` from `sage.misc.sage_ostools`, which in turn uses `command -v`.",
    "created_at": "2011-07-15T18:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127450",
    "user": "jhpalmieri"
}
```

> which isn't portable; one should use the shell built-in command -v ....

Or use the function `have_program` from `sage.misc.sage_ostools`, which in turn uses `command -v`.



---

archive/issue_comments_127451.json:
```json
{
    "body": "Meanwhile... ;-)\n\nReplying to [comment:1 leif]:\n>  * `which` isn't portable; one should use the shell built-in `command -v ...`.\n\nYou can replace\n\n```python\n        p = Popen(['which', c], stdout=PIPE, stderr=PIPE)\n```\n\nby\n\n```python\n        p = Popen(\"command -v %s\"%c, shell=True, stdout=PIPE, stderr=PIPE)\n```\n",
    "created_at": "2011-07-15T18:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127451",
    "user": "leif"
}
```

Meanwhile... ;-)

Replying to [comment:1 leif]:
>  * `which` isn't portable; one should use the shell built-in `command -v ...`.

You can replace

```python
        p = Popen(['which', c], stdout=PIPE, stderr=PIPE)
```

by

```python
        p = Popen("command -v %s"%c, shell=True, stdout=PIPE, stderr=PIPE)
```




---

archive/issue_comments_127452.json:
```json
{
    "body": "Replying to [comment:2 jhpalmieri]:\n> > which isn't portable; one should use the shell built-in command -v ....\n> \n> Or use the function `have_program` from `sage.misc.sage_ostools`, which in turn uses `command -v`.\n\nOk, in principle better, but we also want the result (the command or more precisely its path), to check whether it's located inside the Sage installation.\n\nExtending `sage.misc.sage_ostools` is IMHO the way to go...",
    "created_at": "2011-07-15T18:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127452",
    "user": "leif"
}
```

Replying to [comment:2 jhpalmieri]:
> > which isn't portable; one should use the shell built-in command -v ....
> 
> Or use the function `have_program` from `sage.misc.sage_ostools`, which in turn uses `command -v`.

Ok, in principle better, but we also want the result (the command or more precisely its path), to check whether it's located inside the Sage installation.

Extending `sage.misc.sage_ostools` is IMHO the way to go...



---

archive/issue_comments_127453.json:
```json
{
    "body": "I assume that, when this script gets executed, we're within an environment like the \"sage -sh\" shell? Then the $SAGE_ROOT/local/bin directory is in the path before any of the system directories, so it will ALWAYS come back with the Sage version of the tools, UNLESS Sage doesn't have them. In the latter case, there's no need to make a shortcut; in the former, a shortcut will ALWAYS be made. I see no way of finding a system install separately...\n\nHence the suggestion to force an install would not change things; I'll modify the docstring to reflect this.",
    "created_at": "2011-07-15T18:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127453",
    "user": "Stefan"
}
```

I assume that, when this script gets executed, we're within an environment like the "sage -sh" shell? Then the $SAGE_ROOT/local/bin directory is in the path before any of the system directories, so it will ALWAYS come back with the Sage version of the tools, UNLESS Sage doesn't have them. In the latter case, there's no need to make a shortcut; in the former, a shortcut will ALWAYS be made. I see no way of finding a system install separately...

Hence the suggestion to force an install would not change things; I'll modify the docstring to reflect this.



---

archive/issue_comments_127454.json:
```json
{
    "body": "Replying to [comment:5 Stefan]:\n> I assume that, when this script gets executed, we're within an environment like the \"sage -sh\" shell? \n\nNot necessarily, so I wouldn't change that, or rather fix the baviour such that it matches the description, not the other way around.\n\n\n\n\n> I see no way of finding a system install separately...\n\nParameter `env`...",
    "created_at": "2011-07-15T19:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127454",
    "user": "leif"
}
```

Replying to [comment:5 Stefan]:
> I assume that, when this script gets executed, we're within an environment like the "sage -sh" shell? 

Not necessarily, so I wouldn't change that, or rather fix the baviour such that it matches the description, not the other way around.




> I see no way of finding a system install separately...

Parameter `env`...



---

archive/issue_comments_127455.json:
```json
{
    "body": "John perhaps knows better from where this (rather plain Python) script is or can be called; it actually (currently) just requires `SAGE_ROOT` to be set (otherwise an exception is raised, which is a bit odd by itself).\n\nI haven't found something like `sage -install_scripts` though.\n\nAlso, not all `sage -<program>` instances need to have a corresponding `$SAGE_ROOT/local/bin/<program>`; at least the filename might differ.",
    "created_at": "2011-07-15T19:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127455",
    "user": "leif"
}
```

John perhaps knows better from where this (rather plain Python) script is or can be called; it actually (currently) just requires `SAGE_ROOT` to be set (otherwise an exception is raised, which is a bit odd by itself).

I haven't found something like `sage -install_scripts` though.

Also, not all `sage -<program>` instances need to have a corresponding `$SAGE_ROOT/local/bin/<program>`; at least the filename might differ.



---

archive/issue_comments_127456.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-07-15T19:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127456",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127457.json:
```json
{
    "body": "I noticed this issue, too, and wrote a patch for it.  I think that since this is in a file in the Sage library, we may assume that it is used while Sage is running, so all of the appropriate environment variables are set.\n\nAnyway, here's one attempt at a patch.",
    "created_at": "2011-07-15T19:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127457",
    "user": "jhpalmieri"
}
```

I noticed this issue, too, and wrote a patch for it.  I think that since this is in a file in the Sage library, we may assume that it is used while Sage is running, so all of the appropriate environment variables are set.

Anyway, here's one attempt at a patch.



---

archive/issue_comments_127458.json:
```json
{
    "body": "The following is from README.txt in the root directory:\n\n\n```\n6. OPTIONAL: Start Sage and run the command\n\n       install_scripts(\"/usr/local/bin/\")   # change /usr/local/bin/\n\n   Type \"install_scripts?\" in Sage for more details about what this\n   command does.\n```\n",
    "created_at": "2011-07-15T20:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127458",
    "user": "Stefan"
}
```

The following is from README.txt in the root directory:


```
6. OPTIONAL: Start Sage and run the command

       install_scripts("/usr/local/bin/")   # change /usr/local/bin/

   Type "install_scripts?" in Sage for more details about what this
   command does.
```




---

archive/issue_comments_127459.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-07-15T20:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127459",
    "user": "leif"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_127460.json:
```json
{
    "body": "Ahem,\n\n* you really have to add the quotes around `$`@`` since this has a different meaning, namely quoting *each element of* `$`@``.\n* `command` is a **shell built-in**, and hence not an executable to be found along  `PATH`, so we need `shell=True` and a single string containing `command -v ...` rather than a list of arguments.\n* Removing `$SAGE_ROOT/local/bin` from `PATH` should IMHO be more robust w.r.t. redundant slashs and `normpath()` or `realpath()`.",
    "created_at": "2011-07-15T20:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127460",
    "user": "leif"
}
```

Ahem,

* you really have to add the quotes around `$`@`` since this has a different meaning, namely quoting *each element of* `$`@``.
* `command` is a **shell built-in**, and hence not an executable to be found along  `PATH`, so we need `shell=True` and a single string containing `command -v ...` rather than a list of arguments.
* Removing `$SAGE_ROOT/local/bin` from `PATH` should IMHO be more robust w.r.t. redundant slashs and `normpath()` or `realpath()`.



---

archive/issue_comments_127461.json:
```json
{
    "body": "P.S.:\n\nAlso, if `ignore_existing==True` and some system-wide version of a program exists, a shortcut will be installed regardless of whether a / the Sage version to which the shortcut is made exists.",
    "created_at": "2011-07-15T20:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127461",
    "user": "leif"
}
```

P.S.:

Also, if `ignore_existing==True` and some system-wide version of a program exists, a shortcut will be installed regardless of whether a / the Sage version to which the shortcut is made exists.



---

archive/issue_comments_127462.json:
```json
{
    "body": "P.P.S.: I'd also move the `close()` right before `\"Created script ...\"`.",
    "created_at": "2011-07-15T21:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127462",
    "user": "leif"
}
```

P.P.S.: I'd also move the `close()` right before `"Created script ..."`.



---

archive/issue_comments_127463.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-15T21:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127463",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127464.json:
```json
{
    "body": "Replying to [comment:10 leif]:\n>  you really have to add the quotes around `$`@`` since this has a different meaning, namely quoting *each element of* `$`@``.\n\nSorry, I missed the quotes in your original comment\n\n>  * `command` is a **shell built-in**, and hence not an executable to be found along  `PATH`, so we need `shell=True` and a single string containing `command -v ...` rather than a list of arguments.\n\nOn OS X, it works with `shell=False`.  I see now that on linux, it doesn't.\n\n>  * Removing `$SAGE_ROOT/local/bin` from `PATH` should IMHO be more robust w.r.t. redundant slashs and `normpath()` or `realpath()`.\n\nI guess on POSIX systems, the directories are always separated by colons.  (If not, are there any functions in the Python library for parsing PATH and then reassembling it?  Is there a function or variable saying what the separator is?)  So the new patch fixes this.  (In this case, anyway, the relevant portion of the PATH variable is set by sage-env, which uses the value of SAGE_ROOT, so \"SAGE_ROOT/local/bin\" should be there as is.  This seems to be the case on several different machines in which my Sage install is buried under various symbolic links.)\n\n> Also, if ignore_existing==True and some system-wide version of a program exists, a shortcut will be installed regardless of whether a / the Sage version to which the shortcut is made exists.\n\nRight.  See the new version.\n\n> I'd also move the close() right before \"Created script ...\".\n\nOkay.",
    "created_at": "2011-07-15T21:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127464",
    "user": "jhpalmieri"
}
```

Replying to [comment:10 leif]:
>  you really have to add the quotes around `$`@`` since this has a different meaning, namely quoting *each element of* `$`@``.

Sorry, I missed the quotes in your original comment

>  * `command` is a **shell built-in**, and hence not an executable to be found along  `PATH`, so we need `shell=True` and a single string containing `command -v ...` rather than a list of arguments.

On OS X, it works with `shell=False`.  I see now that on linux, it doesn't.

>  * Removing `$SAGE_ROOT/local/bin` from `PATH` should IMHO be more robust w.r.t. redundant slashs and `normpath()` or `realpath()`.

I guess on POSIX systems, the directories are always separated by colons.  (If not, are there any functions in the Python library for parsing PATH and then reassembling it?  Is there a function or variable saying what the separator is?)  So the new patch fixes this.  (In this case, anyway, the relevant portion of the PATH variable is set by sage-env, which uses the value of SAGE_ROOT, so "SAGE_ROOT/local/bin" should be there as is.  This seems to be the case on several different machines in which my Sage install is buried under various symbolic links.)

> Also, if ignore_existing==True and some system-wide version of a program exists, a shortcut will be installed regardless of whether a / the Sage version to which the shortcut is made exists.

Right.  See the new version.

> I'd also move the close() right before "Created script ...".

Okay.



---

archive/issue_comments_127465.json:
```json
{
    "body": "Ah, found it.  Bad variable names, I think: it's too easy to confuse these.\n\n```python\n>>> import os\n>>> os.pathsep\n':'\n>>> os.path.sep\n'/'\n```\n",
    "created_at": "2011-07-15T21:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127465",
    "user": "jhpalmieri"
}
```

Ah, found it.  Bad variable names, I think: it's too easy to confuse these.

```python
>>> import os
>>> os.pathsep
':'
>>> os.path.sep
'/'
```




---

archive/issue_comments_127466.json:
```json
{
    "body": "Replying to [comment:13 jhpalmieri]:\n> >  * `command` is a **shell built-in**, and hence not an executable to be found along  `PATH`, so we need `shell=True` and a single string containing `command -v ...` rather than a list of arguments.\n> \n> On OS X, it works with `shell=False`.  I see now that on linux, it doesn't.\n\nThere can be a real command `command` of course, but POSIX only requires the shell built-in.\n\n\n\n\n> >  * Removing `$SAGE_ROOT/local/bin` from `PATH` should IMHO be more robust w.r.t. redundant slashs and `normpath()` or `realpath()`.\n> \n> [...] (In this case, anyway, the relevant portion of the PATH variable is set by sage-env, which uses the value of SAGE_ROOT, so \"SAGE_ROOT/local/bin\" should be there as is.  This seems to be the case on several different machines in which my Sage install is buried under various symbolic links.)\n\nI wouldn't rely on `sage-env`, not just because `SAGE_ROOT` might already be set.\n\nI'd rather search `PATH` for `*/local/bin*` entries and compare `realpath()` of them to `realpath(os.path.join(SAGE_ROOT, 'local', 'bin'))`.\n\n(Haven't yet looked at the new patch though.)\n\n\n\n\nReplying to [comment:14 jhpalmieri]:\n> Ah, found it.\n\n```python\n> >>> import os\n> >>> os.pathsep\n> ':'\n```\n\n\nYep. On M$ Windows, it is \"`;`\".",
    "created_at": "2011-07-15T23:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127466",
    "user": "leif"
}
```

Replying to [comment:13 jhpalmieri]:
> >  * `command` is a **shell built-in**, and hence not an executable to be found along  `PATH`, so we need `shell=True` and a single string containing `command -v ...` rather than a list of arguments.
> 
> On OS X, it works with `shell=False`.  I see now that on linux, it doesn't.

There can be a real command `command` of course, but POSIX only requires the shell built-in.




> >  * Removing `$SAGE_ROOT/local/bin` from `PATH` should IMHO be more robust w.r.t. redundant slashs and `normpath()` or `realpath()`.
> 
> [...] (In this case, anyway, the relevant portion of the PATH variable is set by sage-env, which uses the value of SAGE_ROOT, so "SAGE_ROOT/local/bin" should be there as is.  This seems to be the case on several different machines in which my Sage install is buried under various symbolic links.)

I wouldn't rely on `sage-env`, not just because `SAGE_ROOT` might already be set.

I'd rather search `PATH` for `*/local/bin*` entries and compare `realpath()` of them to `realpath(os.path.join(SAGE_ROOT, 'local', 'bin'))`.

(Haven't yet looked at the new patch though.)




Replying to [comment:14 jhpalmieri]:
> Ah, found it.

```python
> >>> import os
> >>> os.pathsep
> ':'
```


Yep. On M$ Windows, it is "`;`".



---

archive/issue_comments_127467.json:
```json
{
    "body": "Ok, `install_scripts()` now (IMHO unfortunately) requires more of Sage, which prevents usage from a simple shell script, but the problem with an already set `SAGE_ROOT` seems to be solved as far as I can see. (The \"useless\" `os.path.exists()` is a bit odd, but I see `os.path.samefile()` requires this.)\n\nThe `stderr=PIPE` and `stdout=PIPE` in `have_program()` are quite useless; there apparently is no such thing like `DEVNULL`, but we can redirect both to `/dev/null` in the string passed to the shell (instead of opening `/dev/null` and passing its `fileno()` to `subprocess.call()`). Redirecting `stdout` should suffice anyway.\n\nThe description of `ignore_existing` appears clumsy (and potentially misleading) to me; I'd just say *\"If True, install a shortcut to Sage's version of a program even if a system-wide version exists [or: is in the/your PATH].\"*.\n\nMaybe we should also mention that the destination directory has to be added to `PATH` unless it is already contained in it. (We could even check this in `install_scripts()`.)\n\nThere btw. is a typo in the docstring, `s/`verbosely tell`/`verbosely tell**s**`/` (and `ignore_existsing`[sic] in a comment). For better readability, I'd also substitute `c` by e.g. `cmd` in the code.\n\nAlso, the message *\"The command ... is not available ...\"* should read *\"... not available **in Sage**\"*. The `\u00ecf-elif-else` is IMHO a bit inappropriate, as the otherwise very verbose script doesn't tell if a system-wide version was found but we install a shortcut because `ignore_existing==True`. It could be:\n\n```python\n        if not cmd_inside_sage:\n            # We *may* also report if a system-wide version is available.\n            ...\n            continue\n        if cmd_outside_sage:\n            print \"The command '%s' is installed outside of Sage.\" % cmd\n            if not ignore_existing: # ambiguous unless one reads the docstring\n                print \"Not installing a shortcut to Sage's version.\"\n                continue\n        # normal operation, simply install the shortcut unless a file with\n        # the same name already exists in the target directory\n        ...\n```\n",
    "created_at": "2011-07-16T01:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127467",
    "user": "leif"
}
```

Ok, `install_scripts()` now (IMHO unfortunately) requires more of Sage, which prevents usage from a simple shell script, but the problem with an already set `SAGE_ROOT` seems to be solved as far as I can see. (The "useless" `os.path.exists()` is a bit odd, but I see `os.path.samefile()` requires this.)

The `stderr=PIPE` and `stdout=PIPE` in `have_program()` are quite useless; there apparently is no such thing like `DEVNULL`, but we can redirect both to `/dev/null` in the string passed to the shell (instead of opening `/dev/null` and passing its `fileno()` to `subprocess.call()`). Redirecting `stdout` should suffice anyway.

The description of `ignore_existing` appears clumsy (and potentially misleading) to me; I'd just say *"If True, install a shortcut to Sage's version of a program even if a system-wide version exists [or: is in the/your PATH]."*.

Maybe we should also mention that the destination directory has to be added to `PATH` unless it is already contained in it. (We could even check this in `install_scripts()`.)

There btw. is a typo in the docstring, `s/`verbosely tell`/`verbosely tell**s**`/` (and `ignore_existsing`[sic] in a comment). For better readability, I'd also substitute `c` by e.g. `cmd` in the code.

Also, the message *"The command ... is not available ..."* should read *"... not available **in Sage**"*. The `ìf-elif-else` is IMHO a bit inappropriate, as the otherwise very verbose script doesn't tell if a system-wide version was found but we install a shortcut because `ignore_existing==True`. It could be:

```python
        if not cmd_inside_sage:
            # We *may* also report if a system-wide version is available.
            ...
            continue
        if cmd_outside_sage:
            print "The command '%s' is installed outside of Sage." % cmd
            if not ignore_existing: # ambiguous unless one reads the docstring
                print "Not installing a shortcut to Sage's version."
                continue
        # normal operation, simply install the shortcut unless a file with
        # the same name already exists in the target directory
        ...
```




---

archive/issue_comments_127468.json:
```json
{
    "body": "Replying to [comment:16 leif]:\n> Ok, `install_scripts()` now (IMHO unfortunately) requires more of Sage, which prevents usage from a simple shell script, but the problem with an already set `SAGE_ROOT` seems to be solved as far as I can see. (The \"useless\" `os.path.exists()` is a bit odd, but I see `os.path.samefile()` requires this.)\n\nYes, and on OS X,  there is at least one nonexistent item in the PATH, because of these lines in sage-env:\n\n```\nif [ `uname` = \"Darwin\" ]; then\n    # For a framework Python build on OS X, Python's bin directory is not local/bin\n    PATH=\"$SAGE_LOCAL/Frameworks/Python.framework/Versions/2.5/bin:$PATH\" && export PATH\n```\n\nNote the \"2.5\".  (And of course, someone might have some non-existent directories in their path to start with.)\n\n> The `stderr=PIPE` and `stdout=PIPE` in `have_program()` are quite useless; there apparently is no such thing like `DEVNULL`, but we can redirect both to `/dev/null` in the string passed to the shell (instead of opening `/dev/null` and passing its `fileno()` to `subprocess.call()`). Redirecting `stdout` should suffice anyway.\n\nI don't see any problem with using PIPE to suppress output.  Having redirections as part of the shell command seems somehow less elegant to me.\n\n> The description of `ignore_existing` appears clumsy (and potentially misleading) to me; I'd just say *\"If True, install a shortcut to Sage's version of a program even if a system-wide version exists [or: is in the/your PATH].\"*.\n\nOkay.\n\n> Maybe we should also mention that the destination directory has to be added to `PATH` unless it is already contained in it. (We could even check this in `install_scripts()`.)\n\nI've added some messages about this, both in the docstring and the message printed as the function finishes.\n\n> There btw. is a typo in the docstring, `s/`verbosely tell`/`verbosely tell**s**`/` (and `ignore_existsing`[sic] in a comment). For better readability, I'd also substitute `c` by e.g. `cmd` in the code.\n\nOkay.\n\n> Also, the message *\"The command ... is not available ...\"* should read *\"... not available **in Sage**\"*. The `\u00ecf-elif-else` is IMHO a bit inappropriate, as the otherwise very verbose script doesn't tell if a system-wide version was found but we install a shortcut because `ignore_existing==True`. It could be:\n\n```python\n        if not cmd_inside_sage:\n            # We *may* also report if a system-wide version is available.\n            ...\n            continue\n        if cmd_outside_sage:\n            print \"The command '%s' is installed outside of Sage.\" % cmd\n            if not ignore_existing: # ambiguous unless one reads the docstring\n                print \"Not installing a shortcut to Sage's version.\"\n                continue\n        # normal operation, simply install the shortcut unless a file with\n        # the same name already exists in the target directory\n        ...\n```\n\n\nI changed it to be something like this.",
    "created_at": "2011-07-16T02:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127468",
    "user": "jhpalmieri"
}
```

Replying to [comment:16 leif]:
> Ok, `install_scripts()` now (IMHO unfortunately) requires more of Sage, which prevents usage from a simple shell script, but the problem with an already set `SAGE_ROOT` seems to be solved as far as I can see. (The "useless" `os.path.exists()` is a bit odd, but I see `os.path.samefile()` requires this.)

Yes, and on OS X,  there is at least one nonexistent item in the PATH, because of these lines in sage-env:

```
if [ `uname` = "Darwin" ]; then
    # For a framework Python build on OS X, Python's bin directory is not local/bin
    PATH="$SAGE_LOCAL/Frameworks/Python.framework/Versions/2.5/bin:$PATH" && export PATH
```

Note the "2.5".  (And of course, someone might have some non-existent directories in their path to start with.)

> The `stderr=PIPE` and `stdout=PIPE` in `have_program()` are quite useless; there apparently is no such thing like `DEVNULL`, but we can redirect both to `/dev/null` in the string passed to the shell (instead of opening `/dev/null` and passing its `fileno()` to `subprocess.call()`). Redirecting `stdout` should suffice anyway.

I don't see any problem with using PIPE to suppress output.  Having redirections as part of the shell command seems somehow less elegant to me.

> The description of `ignore_existing` appears clumsy (and potentially misleading) to me; I'd just say *"If True, install a shortcut to Sage's version of a program even if a system-wide version exists [or: is in the/your PATH]."*.

Okay.

> Maybe we should also mention that the destination directory has to be added to `PATH` unless it is already contained in it. (We could even check this in `install_scripts()`.)

I've added some messages about this, both in the docstring and the message printed as the function finishes.

> There btw. is a typo in the docstring, `s/`verbosely tell`/`verbosely tell**s**`/` (and `ignore_existsing`[sic] in a comment). For better readability, I'd also substitute `c` by e.g. `cmd` in the code.

Okay.

> Also, the message *"The command ... is not available ..."* should read *"... not available **in Sage**"*. The `ìf-elif-else` is IMHO a bit inappropriate, as the otherwise very verbose script doesn't tell if a system-wide version was found but we install a shortcut because `ignore_existing==True`. It could be:

```python
        if not cmd_inside_sage:
            # We *may* also report if a system-wide version is available.
            ...
            continue
        if cmd_outside_sage:
            print "The command '%s' is installed outside of Sage." % cmd
            if not ignore_existing: # ambiguous unless one reads the docstring
                print "Not installing a shortcut to Sage's version."
                continue
        # normal operation, simply install the shortcut unless a file with
        # the same name already exists in the target directory
        ...
```


I changed it to be something like this.



---

archive/issue_comments_127469.json:
```json
{
    "body": "Attachment [trac_11602-install-scripts.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.patch) by jhpalmieri created at 2011-07-16 02:26:47",
    "created_at": "2011-07-16T02:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127469",
    "user": "jhpalmieri"
}
```

Attachment [trac_11602-install-scripts.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.patch) by jhpalmieri created at 2011-07-16 02:26:47



---

archive/issue_comments_127470.json:
```json
{
    "body": "Sorry, completely forgot this ticket.\n\nIMHO works as advertised with Sage 4.7.1.rc0, so **positive review**.\n\nOnly a few minor things:\n* Somehow the empty line is removed from the docstring when I type `install_scripts?`:\n\n```\n         will need write permissions on ``directory``.  Note that one good\n         candidate for ``directory`` is \"/usr/local/bin\".Running\n         ``install_scripts(directory)`` will be most helpful if\n```\n\n   (Also, `\"/usr/local/bin\"` should perhaps be double-*back*quoted.)\n* You could add yourself to `AUTHORS`. :-)\n* I'd quote the `directory` name in the last message. (Also, rerunning the command may make sense if a newer version of Sage ships more components, or the user later installs some optional component. Similarly, a system-wide version might vanish later if it gets uninstalled or the `PATH` changes.)\n* I personally don't like raising `RuntimeError`s for rather \"expected\" error conditions; I thought there was a way to at least suppress the traceback, but I currently don't recall how. (I did get *\"`RuntimeError` doesn't take keyword arguments\"* when I tried... ;-) ) \n\n  If there's no way to suppress the tracebacks, I would catch \"expected\" exception(s) and use `sys.stderr.write()`, then proceed with whatever is appropriate in that situation (e.g. `return`). \n\n  (There also could be a *\"Creating script ...\"* message in advance, since an error in `o.open()` or `o.write()` could otherwise be associated with *\"Checking that Sage has the command ...\"*.)\n* An `else:` is superfluous whenever the `if`-branch ends with e.g. `continue`, but that's partially a matter of taste. (Omitting it here appears more readable to me, but I don't mind.)\n\nNot that important *here*, but in general you should pass the *whole* environment to `subprocess.call()` with just the variable(s) modified you have to change, as opposed to passing an \"empty\" environment with just these new settings added (like you do now in `have_program()`). Otherwise settings like e.g. `LD_LIBRARY_PATH` get lost, which might lead to errors or undesired behaviour.",
    "created_at": "2011-07-23T00:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127470",
    "user": "leif"
}
```

Sorry, completely forgot this ticket.

IMHO works as advertised with Sage 4.7.1.rc0, so **positive review**.

Only a few minor things:
* Somehow the empty line is removed from the docstring when I type `install_scripts?`:

```
         will need write permissions on ``directory``.  Note that one good
         candidate for ``directory`` is "/usr/local/bin".Running
         ``install_scripts(directory)`` will be most helpful if
```

   (Also, `"/usr/local/bin"` should perhaps be double-*back*quoted.)
* You could add yourself to `AUTHORS`. :-)
* I'd quote the `directory` name in the last message. (Also, rerunning the command may make sense if a newer version of Sage ships more components, or the user later installs some optional component. Similarly, a system-wide version might vanish later if it gets uninstalled or the `PATH` changes.)
* I personally don't like raising `RuntimeError`s for rather "expected" error conditions; I thought there was a way to at least suppress the traceback, but I currently don't recall how. (I did get *"`RuntimeError` doesn't take keyword arguments"* when I tried... ;-) ) 

  If there's no way to suppress the tracebacks, I would catch "expected" exception(s) and use `sys.stderr.write()`, then proceed with whatever is appropriate in that situation (e.g. `return`). 

  (There also could be a *"Creating script ..."* message in advance, since an error in `o.open()` or `o.write()` could otherwise be associated with *"Checking that Sage has the command ..."*.)
* An `else:` is superfluous whenever the `if`-branch ends with e.g. `continue`, but that's partially a matter of taste. (Omitting it here appears more readable to me, but I don't mind.)

Not that important *here*, but in general you should pass the *whole* environment to `subprocess.call()` with just the variable(s) modified you have to change, as opposed to passing an "empty" environment with just these new settings added (like you do now in `have_program()`). Otherwise settings like e.g. `LD_LIBRARY_PATH` get lost, which might lead to errors or undesired behaviour.



---

archive/issue_comments_127471.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-07-23T00:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127471",
    "user": "leif"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127472.json:
```json
{
    "body": "for reference only; do not apply",
    "created_at": "2011-07-23T16:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127472",
    "user": "jhpalmieri"
}
```

for reference only; do not apply



---

archive/issue_comments_127473.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-07-23T16:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127473",
    "user": "jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_127474.json:
```json
{
    "body": "Attachment [trac_11602-delta.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-delta.patch) by jhpalmieri created at 2011-07-23 16:36:14\n\nReplying to [comment:18 leif]:\n> Only a few minor things:\n\nI've attached [attachment:trac_11602-install-scripts.v2.patch] to deal with these; [attachment:trac_11602-delta.patch] shows the differences between the two versions.\n\n>  * Somehow the empty line is removed from the docstring when I type `install_scripts?`:\n\nMaybe the `.. note::` markup can't handle more than one paragraph, or our sphinxified text version of the docstring can't.  Anyway, I broke it into two notes.\n\n>    (Also, `\"/usr/local/bin\"` should perhaps be double-*back*quoted.)\n\nI quoted it both ways, so it's a backquoted string.\n\n>  * You could add yourself to `AUTHORS`. :-)\n\nOkay.\n\n>  * I'd quote the `directory` name in the last message. \n\nOkay\n\n> (Also, rerunning the command may make sense if a newer version of Sage ships more components, or the user later installs some optional component. Similarly, a system-wide version might vanish later if it gets uninstalled or the `PATH` changes.)\n\nI think it's best to leave this as is.  I can't think of a way to phrase it which clarifies things and which isn't too complicated.  We could add a phrase like \"All things being equal\" at the beginning, but I think it's best unchanged.\n\n>  * I personally don't like raising `RuntimeError`s for rather \"expected\" error conditions; I thought there was a way to at least suppress the traceback, but I currently don't recall how. (I did get *\"`RuntimeError` doesn't take keyword arguments\"* when I tried... ;-) ) \n\n\nI think `OSError` is better.  That's more consistent with the behavior of the `os.path` module, for example.\n\n>    (There also could be a *\"Creating script ...\"* message in advance, since an error in `o.open()` or `o.write()` could otherwise be associated with *\"Checking that Sage has the command ...\"*.)\n\nOkay.\n\n>  * An `else:` is superfluous whenever the `if`-branch ends with e.g. `continue`, but that's partially a matter of taste. (Omitting it here appears more readable to me, but I don't mind.)\n\nI omitted it.\n\nI made a few other changes: it now checks to see if any scripts were written at all.  If not, then the ending message doesn't say \"Finished creating scripts\", etc.  Also, the original docstring (and the function name itself) talked about \"scripts\", while all of the messages printed during execution talked about \"shortcuts\".  I changed it so now they all talk about \"scripts\" only.",
    "created_at": "2011-07-23T16:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127474",
    "user": "jhpalmieri"
}
```

Attachment [trac_11602-delta.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-delta.patch) by jhpalmieri created at 2011-07-23 16:36:14

Replying to [comment:18 leif]:
> Only a few minor things:

I've attached [attachment:trac_11602-install-scripts.v2.patch] to deal with these; [attachment:trac_11602-delta.patch] shows the differences between the two versions.

>  * Somehow the empty line is removed from the docstring when I type `install_scripts?`:

Maybe the `.. note::` markup can't handle more than one paragraph, or our sphinxified text version of the docstring can't.  Anyway, I broke it into two notes.

>    (Also, `"/usr/local/bin"` should perhaps be double-*back*quoted.)

I quoted it both ways, so it's a backquoted string.

>  * You could add yourself to `AUTHORS`. :-)

Okay.

>  * I'd quote the `directory` name in the last message. 

Okay

> (Also, rerunning the command may make sense if a newer version of Sage ships more components, or the user later installs some optional component. Similarly, a system-wide version might vanish later if it gets uninstalled or the `PATH` changes.)

I think it's best to leave this as is.  I can't think of a way to phrase it which clarifies things and which isn't too complicated.  We could add a phrase like "All things being equal" at the beginning, but I think it's best unchanged.

>  * I personally don't like raising `RuntimeError`s for rather "expected" error conditions; I thought there was a way to at least suppress the traceback, but I currently don't recall how. (I did get *"`RuntimeError` doesn't take keyword arguments"* when I tried... ;-) ) 


I think `OSError` is better.  That's more consistent with the behavior of the `os.path` module, for example.

>    (There also could be a *"Creating script ..."* message in advance, since an error in `o.open()` or `o.write()` could otherwise be associated with *"Checking that Sage has the command ..."*.)

Okay.

>  * An `else:` is superfluous whenever the `if`-branch ends with e.g. `continue`, but that's partially a matter of taste. (Omitting it here appears more readable to me, but I don't mind.)

I omitted it.

I made a few other changes: it now checks to see if any scripts were written at all.  If not, then the ending message doesn't say "Finished creating scripts", etc.  Also, the original docstring (and the function name itself) talked about "scripts", while all of the messages printed during execution talked about "shortcuts".  I changed it so now they all talk about "scripts" only.



---

archive/issue_comments_127475.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-23T16:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127475",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127476.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> I've attached [attachment:trac_11602-install-scripts.v2.patch] to deal with these; [attachment:trac_11602-delta.patch] shows the differences between the two versions.\n\nI'm almost happy with the delta patch, should test the new version though.\n\n\n\n\n> >    (Also, `\"/usr/local/bin\"` should perhaps be double-*back*quoted.)\n> I quoted it both ways, so it's a backquoted string.\n\nJust double-backquotes (monospaced font) would have sufficed.\n\n\n\n\n> I made a few other changes: [...]\n> Also, the original docstring (and the function name itself) talked about \"scripts\", while all of the messages printed during execution talked about \"shortcuts\".  I changed it so now they all talk about \"scripts\" only.\n\nWell, the notion of shortcuts (or better *shortcut scripts*) in the description / docstring isn't all bad, as it emphasizes their purpose and perhaps connotes their \"light-weightness\".\n\nThe docstring actually lacks a description of what a shortcut [script] is or really / technically does; an example saying that the scripts make e.g. `gp` an alias for `sage -gp`, which starts the stand-alone PARI/GP interpreter, would be helpful.\n\nWhen talking about *software components*, I'd use their *name* rather than the corresponding command, i.e. GAP, Maxima, Singular, PARI/GP, MWrank (?), Mercurial, GNU R etc., without quotes. In contrast, when referring to the commands / options to `sage`, I'd typeset them as such (with double-backticks), but also omit single-quotes visible in the HTML documentation.\n\n(I guess William just copied and pasted the contents of the Python list.)\n\nI'd also typeset `root` and `sage` (lower-case) monospaced in\n\n  *\"You may need to run Sage as root in order to ...\"*\n\nand perhaps mention `sudo` or `sudo sage -c \"install_scripts(<directory>)\"`, or combine it with the next sentence, giving the example\n\n```sh\nsudo sage -c \"install_scripts('/usr/local/bin')\"\n```\n\n(Do you want to add a \"shortcut script\" `install_scripts` to `$SAGE_ROOT/local/bin/` or `$SAGE_ROOT/`? :P )\n\n\n\n\nWe should check once in advance that the given directory is writable by the user, right after the presence test, in order to give a nice(r) error message [earlier].\n\nBtw., I still get an ugly traceback if the directory doesn't exist; can we suppress that or do we really have to `raise`? (I'd prefer just printing an error message and `return`.)\n\n\n\n\nI thought we would advise the user (at the end, if any scripts were created) to add `directory` to his/her `PATH` in case it isn't already there.\n\n----\n\n(As you may have noticed, I've meanwhile tested also the v2 a little while writing...)\n\nIf you don't want to make further changes, I won't mind and give it positive review as is (unless I missed some severe flaw, which I don't expect).",
    "created_at": "2011-07-25T02:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127476",
    "user": "leif"
}
```

Replying to [comment:19 jhpalmieri]:
> I've attached [attachment:trac_11602-install-scripts.v2.patch] to deal with these; [attachment:trac_11602-delta.patch] shows the differences between the two versions.

I'm almost happy with the delta patch, should test the new version though.




> >    (Also, `"/usr/local/bin"` should perhaps be double-*back*quoted.)
> I quoted it both ways, so it's a backquoted string.

Just double-backquotes (monospaced font) would have sufficed.




> I made a few other changes: [...]
> Also, the original docstring (and the function name itself) talked about "scripts", while all of the messages printed during execution talked about "shortcuts".  I changed it so now they all talk about "scripts" only.

Well, the notion of shortcuts (or better *shortcut scripts*) in the description / docstring isn't all bad, as it emphasizes their purpose and perhaps connotes their "light-weightness".

The docstring actually lacks a description of what a shortcut [script] is or really / technically does; an example saying that the scripts make e.g. `gp` an alias for `sage -gp`, which starts the stand-alone PARI/GP interpreter, would be helpful.

When talking about *software components*, I'd use their *name* rather than the corresponding command, i.e. GAP, Maxima, Singular, PARI/GP, MWrank (?), Mercurial, GNU R etc., without quotes. In contrast, when referring to the commands / options to `sage`, I'd typeset them as such (with double-backticks), but also omit single-quotes visible in the HTML documentation.

(I guess William just copied and pasted the contents of the Python list.)

I'd also typeset `root` and `sage` (lower-case) monospaced in

  *"You may need to run Sage as root in order to ..."*

and perhaps mention `sudo` or `sudo sage -c "install_scripts(<directory>)"`, or combine it with the next sentence, giving the example

```sh
sudo sage -c "install_scripts('/usr/local/bin')"
```

(Do you want to add a "shortcut script" `install_scripts` to `$SAGE_ROOT/local/bin/` or `$SAGE_ROOT/`? :P )




We should check once in advance that the given directory is writable by the user, right after the presence test, in order to give a nice(r) error message [earlier].

Btw., I still get an ugly traceback if the directory doesn't exist; can we suppress that or do we really have to `raise`? (I'd prefer just printing an error message and `return`.)




I thought we would advise the user (at the end, if any scripts were created) to add `directory` to his/her `PATH` in case it isn't already there.

----

(As you may have noticed, I've meanwhile tested also the v2 a little while writing...)

If you don't want to make further changes, I won't mind and give it positive review as is (unless I missed some severe flaw, which I don't expect).



---

archive/issue_comments_127477.json:
```json
{
    "body": "P.S.:\n\nAs an overkill, `install_scripts()` could write\n\n```\n...\nChecking that Sage has the command 'hg' installed\nCreating script for Mercurial ('hg')...\nCreated script '/given/bin/directory/hg'\n...\n```\n\netc. :-)",
    "created_at": "2011-07-25T02:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127477",
    "user": "leif"
}
```

P.S.:

As an overkill, `install_scripts()` could write

```
...
Checking that Sage has the command 'hg' installed
Creating script for Mercurial ('hg')...
Created script '/given/bin/directory/hg'
...
```

etc. :-)



---

archive/issue_comments_127478.json:
```json
{
    "body": "Attachment [trac_11602-install-scripts.v2.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.v2.patch) by jhpalmieri created at 2011-07-25 05:44:35",
    "created_at": "2011-07-25T05:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127478",
    "user": "jhpalmieri"
}
```

Attachment [trac_11602-install-scripts.v2.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.v2.patch) by jhpalmieri created at 2011-07-25 05:44:35



---

archive/issue_comments_127479.json:
```json
{
    "body": "Attachment [trac_11602-delta2to3.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-delta2to3.patch) by jhpalmieri created at 2011-07-25 05:44:48\n\nfor reference only; do not apply",
    "created_at": "2011-07-25T05:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127479",
    "user": "jhpalmieri"
}
```

Attachment [trac_11602-delta2to3.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-delta2to3.patch) by jhpalmieri created at 2011-07-25 05:44:48

for reference only; do not apply



---

archive/issue_comments_127480.json:
```json
{
    "body": "Attachment [trac_11602-install-scripts.v3.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.v3.patch) by jhpalmieri created at 2011-07-25 05:57:12\n\nReplying to [comment:22 leif]:\n\n> Just double-backquotes (monospaced font) would have sufficed.\n\nWell, it is a string, so it's nice to explicitly include the single quotes in the html version of the reference manual.\n\n> The docstring actually lacks a description of what a shortcut [script] is or really / technically does; an example saying that the scripts make e.g. `gp` an alias for `sage -gp`, which starts the stand-alone PARI/GP interpreter, would be helpful.\n\nI expanded this, perhaps too much.\n\n> When talking about *software components*, I'd use their *name* rather than the corresponding command, i.e. GAP, Maxima, Singular, PARI/GP, MWrank (?), Mercurial, GNU R etc., without quotes. In contrast, when referring to the commands / options to `sage`, I'd typeset them as such (with double-backticks), but also omit single-quotes visible in the HTML documentation.\n\nSee the new patch.\n\n> I'd also typeset `root` and `sage` (lower-case) monospaced in\n\nOkay.\n\n> and perhaps mention `sudo` or `sudo sage -c \"install_scripts(<directory>)\"`, or combine it with the next sentence, giving the example `sudo sage -c \"install_scripts('/usr/local/bin')\"`\n\nOkay\n\n> (Do you want to add a \"shortcut script\" `install_scripts` to `$SAGE_ROOT/local/bin/` or `$SAGE_ROOT/`? :P )\n\nNo.\n\n> We should check once in advance that the given directory is writable by the user, right after the presence test, in order to give a nice(r) error message [earlier].\n\nRight.\n \n> Btw., I still get an ugly traceback if the directory doesn't exist; can we suppress that or do we really have to `raise`? (I'd prefer just printing an error message and `return`.)\n\nI modified the error messages so they don't raise errors.\n\n> I thought we would advise the user (at the end, if any scripts were created) to add `directory` to his/her `PATH` in case it isn't already there.\n\nDone, although it will not print anything if `directory` is one of the directories added to PATH by sage-env.\n\n> As an overkill ...\n\nI didn't do this.\n\nOne other change: in the old patch, in every iteration of the loop, we computed PATH and imported `have_program`; now this is just done once at the top.  (The \"delta2to3\" patch doesn't contain the relocation of the import command, but it's in the final v3 patch.)",
    "created_at": "2011-07-25T05:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127480",
    "user": "jhpalmieri"
}
```

Attachment [trac_11602-install-scripts.v3.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.v3.patch) by jhpalmieri created at 2011-07-25 05:57:12

Replying to [comment:22 leif]:

> Just double-backquotes (monospaced font) would have sufficed.

Well, it is a string, so it's nice to explicitly include the single quotes in the html version of the reference manual.

> The docstring actually lacks a description of what a shortcut [script] is or really / technically does; an example saying that the scripts make e.g. `gp` an alias for `sage -gp`, which starts the stand-alone PARI/GP interpreter, would be helpful.

I expanded this, perhaps too much.

> When talking about *software components*, I'd use their *name* rather than the corresponding command, i.e. GAP, Maxima, Singular, PARI/GP, MWrank (?), Mercurial, GNU R etc., without quotes. In contrast, when referring to the commands / options to `sage`, I'd typeset them as such (with double-backticks), but also omit single-quotes visible in the HTML documentation.

See the new patch.

> I'd also typeset `root` and `sage` (lower-case) monospaced in

Okay.

> and perhaps mention `sudo` or `sudo sage -c "install_scripts(<directory>)"`, or combine it with the next sentence, giving the example `sudo sage -c "install_scripts('/usr/local/bin')"`

Okay

> (Do you want to add a "shortcut script" `install_scripts` to `$SAGE_ROOT/local/bin/` or `$SAGE_ROOT/`? :P )

No.

> We should check once in advance that the given directory is writable by the user, right after the presence test, in order to give a nice(r) error message [earlier].

Right.
 
> Btw., I still get an ugly traceback if the directory doesn't exist; can we suppress that or do we really have to `raise`? (I'd prefer just printing an error message and `return`.)

I modified the error messages so they don't raise errors.

> I thought we would advise the user (at the end, if any scripts were created) to add `directory` to his/her `PATH` in case it isn't already there.

Done, although it will not print anything if `directory` is one of the directories added to PATH by sage-env.

> As an overkill ...

I didn't do this.

One other change: in the old patch, in every iteration of the loop, we computed PATH and imported `have_program`; now this is just done once at the top.  (The "delta2to3" patch doesn't contain the relocation of the import command, but it's in the final v3 patch.)



---

archive/issue_comments_127481.json:
```json
{
    "body": "Ok, `have_program()` still runs `command -v ...` with an environment just containing `PATH` if the `path` parameter isn't `None`, but that's a minor issue.\n\nIt's better than the previous version and much better than the original (and of course fixes the issue of this ticket), so **positive review**.",
    "created_at": "2011-08-05T06:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127481",
    "user": "leif"
}
```

Ok, `have_program()` still runs `command -v ...` with an environment just containing `PATH` if the `path` parameter isn't `None`, but that's a minor issue.

It's better than the previous version and much better than the original (and of course fixes the issue of this ticket), so **positive review**.



---

archive/issue_comments_127482.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-05T06:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127482",
    "user": "leif"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127483.json:
```json
{
    "body": "Ah, forgot one thing:\n\nTo save one process (yet another shell), we should have written:\n\n```sh\n#!/bin/sh\nexec sage -CMD \"$@\"\n```\n\nOr even with two dashs... ;-)",
    "created_at": "2011-08-05T06:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127483",
    "user": "leif"
}
```

Ah, forgot one thing:

To save one process (yet another shell), we should have written:

```sh
#!/bin/sh
exec sage -CMD "$@"
```

Or even with two dashs... ;-)



---

archive/issue_comments_127484.json:
```json
{
    "body": "I could add these changes:\n\n```diff\ndiff --git a/sage/misc/dist.py b/sage/misc/dist.py\n--- a/sage/misc/dist.py\n+++ b/sage/misc/dist.py\n@@ -133,7 +133,7 @@ def install_scripts(directory=None, igno\n         else:\n             o = open(target,'w')\n             o.write('#!/bin/sh\\n')\n-            o.write('sage -%s \"$@\"\\n'%cmd)\n+            o.write('exec sage --%s \"$@\"\\n'%cmd)\n             o.close()\n             print \"Created script '%s'\"%target\n             os.system('chmod a+rx %s'%target)\ndiff --git a/sage/misc/sage_ostools.py b/sage/misc/sage_ostools.py\n--- a/sage/misc/sage_ostools.py\n+++ b/sage/misc/sage_ostools.py\n@@ -34,8 +34,12 @@ def have_program(program, path=None):\n     import os\n     try:\n         if path:\n+            # env is a copy of the current environment, so modifying\n+            # it won't affect os.environ.\n+            env = os.environ.copy()\n+            env['PATH'] = path\n             return not call('command -v %s' % program, shell=True,\n-                            stdout=PIPE, env = {'PATH': path})\n+                            stdout=PIPE, env=env)\n         else:\n             return not call('command -v %s' % program, shell=True,\n                             stdout=PIPE)\n```\n",
    "created_at": "2011-08-10T19:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127484",
    "user": "jhpalmieri"
}
```

I could add these changes:

```diff
diff --git a/sage/misc/dist.py b/sage/misc/dist.py
--- a/sage/misc/dist.py
+++ b/sage/misc/dist.py
@@ -133,7 +133,7 @@ def install_scripts(directory=None, igno
         else:
             o = open(target,'w')
             o.write('#!/bin/sh\n')
-            o.write('sage -%s "$@"\n'%cmd)
+            o.write('exec sage --%s "$@"\n'%cmd)
             o.close()
             print "Created script '%s'"%target
             os.system('chmod a+rx %s'%target)
diff --git a/sage/misc/sage_ostools.py b/sage/misc/sage_ostools.py
--- a/sage/misc/sage_ostools.py
+++ b/sage/misc/sage_ostools.py
@@ -34,8 +34,12 @@ def have_program(program, path=None):
     import os
     try:
         if path:
+            # env is a copy of the current environment, so modifying
+            # it won't affect os.environ.
+            env = os.environ.copy()
+            env['PATH'] = path
             return not call('command -v %s' % program, shell=True,
-                            stdout=PIPE, env = {'PATH': path})
+                            stdout=PIPE, env=env)
         else:
             return not call('command -v %s' % program, shell=True,
                             stdout=PIPE)
```




---

archive/issue_comments_127485.json:
```json
{
    "body": "Yeah, looks good.",
    "created_at": "2011-08-10T19:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127485",
    "user": "leif"
}
```

Yeah, looks good.



---

archive/issue_comments_127486.json:
```json
{
    "body": "Attachment [trac_11602-install-scripts.v4.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.v4.patch) by jhpalmieri created at 2011-08-10 19:31:08\n\nOkay, here's a new patch incorporating exactly those changes.  I'm leaving the ticket as \"positive review\", so if you're happy with the new patch, please change the description of the ticket (\"Apply ...\") to refer to \"v4\" instead of \"v3\".",
    "created_at": "2011-08-10T19:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127486",
    "user": "jhpalmieri"
}
```

Attachment [trac_11602-install-scripts.v4.patch](tarball://root/attachments/some-uuid/ticket11602/trac_11602-install-scripts.v4.patch) by jhpalmieri created at 2011-08-10 19:31:08

Okay, here's a new patch incorporating exactly those changes.  I'm leaving the ticket as "positive review", so if you're happy with the new patch, please change the description of the ticket ("Apply ...") to refer to "v4" instead of "v3".



---

archive/issue_comments_127487.json:
```json
{
    "body": "Positive review also for version 4.",
    "created_at": "2011-08-10T21:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127487",
    "user": "leif"
}
```

Positive review also for version 4.



---

archive/issue_comments_127488.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-08-18T22:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11430#issuecomment-127488",
    "user": "jdemeyer"
}
```

Resolution: fixed
