# Issue 19114: Optimize initialization of RealIntervalFieldElement

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-10-05 14:55:49

Profiling #19288 showed that this was a significant bottleneck.


---

Comment by jdemeyer created at 2015-10-05 15:29:41

New commits:


---

Comment by jdemeyer created at 2015-10-05 15:29:41

Changing status from new to needs_review.


---

Comment by git created at 2015-10-13 12:33:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-10-13 21:27:02

`field.zero()` should be faster than `field(0)` (not much though).


---

Comment by jdemeyer created at 2015-10-14 06:00:19

Replying to [comment:5 vdelecroix]:
> `field.zero()` should be faster than `field(0)` (not much though).
I intentionally use `field(0)` because I need to mutate the number. `field.zero()` is probably cached and that would break things.

Ideally, I would use `ComplexNumber.__new__()` but that's not properly supported. The way I'm writing `RealIntervalFieldElement.__cinit__()` should be done for more element classes. But I didn't feel like rewriting also the `ComplexNumber` constructor here.


---

Comment by mmezzarobba created at 2015-10-15 13:48:36

Not a bug introduced here, but since you are cleaning up this code: I think

```
       elif isinstance(x, str):
           s = str(x).replace('..', ',').replace(' ','').replace('+infinity', '`@`inf`@`').replace('-infinity','-`@`inf`@`')
           if mpfi_set_str(self.value, s, base):
               raise TypeError("unable to convert {!r} to real interval".format(x))
```

should be

```
       elif isinstance(x, basestring):
           ...
```

or at least

```
       elif isinstance(x, (str, unicode)):
           ...
```



---

Comment by mmezzarobba created at 2015-10-15 13:53:35

Also, do you know if this branch is really used anywhere?

```
           # try coercing to real
           try:
               ra = self._parent._lower_field()(x)
               rb = self._parent._upper_field()(x)
```

I'm far from convinced that conversions of sage objects to real fields with directed rounding really return upper/lower bounds...


---

Comment by mmezzarobba created at 2015-10-15 14:02:09

Positive review since the above comments are about peripheral issues, but feel free to make further changes if you agree with my comments.


---

Comment by mmezzarobba created at 2015-10-15 14:02:09

Changing status from needs_review to positive_review.


---

Comment by git created at 2015-10-15 14:02:14

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2015-10-15 14:02:14

Changing status from positive_review to needs_review.


---

Comment by mmezzarobba created at 2015-10-15 14:19:05

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-10-15 14:39:40

Replying to [comment:8 mmezzarobba]:
> Also, do you know if this branch is really used anywhere?
It's used at least for constants, and it even works correctly:

```
sage: RIF(pi).endpoints()
(3.14159265358979, 3.14159265358980)
sage: RIF.pi().endpoints()
(3.14159265358979, 3.14159265358980)
```



---

Comment by vbraun created at 2015-10-16 08:22:13

Resolution: fixed
