# Issue 13445: Implement sigma.domain() and sigma.codomain() for sigma a permutation

Issue created by migration from https://trac.sagemath.org/ticket/13649

Original creator: nthiery

Original creation time: 2012-10-24 08:50:50

Assignee: joyner

CC:  sage-combinat mjo

Keywords: beginner, agregation

Currently one needs to go through the parent of a permutation to get
its domain and codomain:

```
    sage: G = SymmetricGroup(8)
    sage: g = G.an_element()
    sage: g.parent().domain()
    {1, 2, 3, 4, 5, 6, 7, 8}
```


One would want to have shorthands:

```
    sage: g.domain()
    {1, 2, 3, 4, 5, 6, 7, 8}
    sage: g.codomain()
```


like there are for most other maps in Sage:

```
    sage: F = FiniteSetMaps(8)
    sage: f = F.an_element()
    sage: f.domain()
    {0, .., 7}
    sage: f.codomain()
    {0, .., 7}
```


Bonus points for:

```
    sage: g.image()
    {1, 2, 3, 4, 5, 6, 7, 8}
```




---

Attachment


---

Comment by lazza created at 2012-12-10 16:48:35

I have added a small patch which adds the domain shorthand, by copying a bit the one in `FiniteSetMaps`. I haven't found a codomain in the parent type, so I would like to ask you what you exactly mean by codomain shorthand.


---

Comment by vbraun created at 2012-12-10 18:04:02

codomain = range of a map. For a permutation, it is the same as the domain.


---

Comment by lazza created at 2012-12-10 20:48:00

Does that mean that I have to simply make an alias to the `domain` method? Should I do it at the element level or in the parent set?


---

Comment by vbraun created at 2012-12-10 21:55:38

Replying to [comment:3 lazza]:
> Should I do it at the element level or in the parent set?

I'd say both. Everything with a `domain()` would ideally have a `codomain()`.


---

Attachment

I think I've "implemented" the alias correctly. Being my first contribution of course means I'm not exactly sure.


---

Comment by lazza created at 2012-12-11 12:18:52

Changing status from new to needs_review.


---

Comment by leif created at 2012-12-27 04:23:28

Changing keywords from "beginner, agregation" to "beginner, aggregation".


---

Comment by kini created at 2013-01-07 21:01:55

Replying to [comment:2 vbraun]:
> codomain = range of a map.

Well, in the case of elements of a symmetric group, yes, because they're bijections, but surely this isn't true in general. In general, the range is only a subset of the codomain, and is not necessarily equal to it. Or am I missing something?


---

Comment by kini created at 2013-01-07 21:15:34

Does it really make sense to have a codomain for the permutation group itself? I can see why if you consider an individual permutation as a map, you might want to know its codomain, but the whole permutation group isn't a map. I can see why the group might have a "domain", since it's the underlying set of the standard group action, but that seems to be a bit different from the "domain of a function" usage.


---

Comment by vbraun created at 2013-01-07 22:35:43

For me, range = codomain. Whereas image = subset of codomain. Its probably the most popular definition but not universally accepted. This potential for confusion is why we avoid "range" in Sage altogether and only have domain and codomain. 

http://en.wikipedia.org/wiki/Image_(mathematics)#Other_terminology


---

Comment by nthiery created at 2013-01-09 21:06:04

Replying to [comment:8 kini]:
> Does it really make sense to have a codomain for the permutation group itself? I can see why if you consider an individual permutation as a map, you might want to know its codomain, but the whole permutation group isn't a map. I can see why the group might have a "domain", since it's the underlying set of the standard group action, but that seems to be a bit different from the "domain of a function" usage.

As far as I recall, Sage's Homsets have a domain and a codomain (which coincide for EndSets). The symmetric group is special case, and it would seem consistent to have this systematically for all sets of functions.

Cheers,
                             Nicolas


---

Comment by knsam created at 2013-03-05 06:38:05

Changing status from needs_review to needs_work.


---

Comment by knsam created at 2013-03-05 06:38:05

I am setting this to needs work for the following reasons: 

MAJOR:

1. There is a typo in the example indicated for the function codomain (second of the patches, in the file permgroup.py). You really want to show the function codomain(). 

2. It might be nice to demonstrate that the domain and codomain are the same by adding an example to this effect (using `==`)! 

-----------------

MINOR:

1. Fullstops please! 
2. It is advisable to write the docstrings imperatively: you might find [PEP8](http://www.python.org/dev/peps/pep-0008/) and [PEP257](http://www.python.org/dev/peps/pep-0257/) a good read. (I realise that the other docstrings are also like yours: "returns"ing instead of "return"ing. So, you may not change this in this patch.) 

Modulo these, your patch is good to go. ~KnS


---

Attachment

Domain, codomain, image of a permutation group element


---

Attachment

Domain, codomain, image of a permutation group element


---

Comment by mmarco created at 2013-05-09 19:42:13

aanand, make sure that you document and doctest the methods that you implement.

Take a look at the sage developper's guide for the conventions to follow:

http://www.sagemath.org/doc/developer/conventions.html#documentation-strings


---

Comment by aanand created at 2013-05-10 15:23:55

Followed the prescribed conventions.


---

Attachment

Looks good to me.
Just one minor question: for coherence, it would be nice if the output of .image would be of the same tye as the one of .domain and .codomain.


---

Comment by aanand created at 2013-05-10 17:34:59

Now the output of .image() is same as that of .domain() and .codomain()


---

Attachment

Doctest fail:


```
Running doctests with ID 2013-05-10-21-51-43-875205e8.
Doctesting 1 file.
sage -t devel/sage/sage/groups/perm_gps/permgroup_element.pyx
**********************************************************************
File "devel/sage/sage/groups/perm_gps/permgroup_element.pyx", line 881, in sage.groups.perm_gps.permgroup_element.PermutationGroupElement.domain
Failed example:
    g
Expected:
    (1,3,5)
Got:
    (1,3)(2,4,5)
**********************************************************************
File "devel/sage/sage/groups/perm_gps/permgroup_element.pyx", line 883, in sage.groups.perm_gps.permgroup_element.PermutationGroupElement.domain
Failed example:
    g.domain()
Expected:
    {1,2,3,4,5}
Got:
    {1, 2, 3, 4, 5}
**********************************************************************
File "devel/sage/sage/groups/perm_gps/permgroup_element.pyx", line 900, in sage.groups.perm_gps.permgroup_element.PermutationGroupElement.image
Failed example:
    g
Expected:
    (1,3,5)
Got:
    (1,3)(2,4,5)
**********************************************************************
File "devel/sage/sage/groups/perm_gps/permgroup_element.pyx", line 902, in sage.groups.perm_gps.permgroup_element.PermutationGroupElement.image
Failed example:
    g.image()
Expected:
    {1,3,5}
Got:
    {1, 2, 3, 4, 5}
**********************************************************************
File "devel/sage/sage/groups/perm_gps/permgroup_element.pyx", line 917, in sage.groups.perm_gps.permgroup_element.PermutationGroupElement.codomain
Failed example:
    g
Expected:
    (1,3,5)
Got:
    (1,3)(2,4,5)
**********************************************************************
File "devel/sage/sage/groups/perm_gps/permgroup_element.pyx", line 919, in sage.groups.perm_gps.permgroup_element.PermutationGroupElement.codomain
Failed example:
    g.codomain()
Expected:
    {1,2,3,4,5}
Got:
    {1, 2, 3, 4, 5}
**********************************************************************
```


That's because of two reasons: first, the output in doctests is not properly formated. And second, if you use a random element in a doctest, the result may vary each time the test is run.


---

Attachment

Doctest should run fine now.


---

Comment by mmarco created at 2013-05-12 01:17:25

Looks good to me.


---

Comment by mmarco created at 2013-05-12 01:17:58

Changing status from needs_work to positive_review.


---

Comment by mmarco created at 2013-05-12 01:58:52

Changing status from positive_review to needs_work.


---

Comment by mmarco created at 2013-05-12 01:58:52

Now that i think about it, your method to compute the image is clearly suboptimal. In the case of small groups you don't notice a difference. But if the group is very big, going through the image of all the elements might take a lot of time, which is unnecesary.

It would be much faster to just take it from the cycle structure.

Notice the difference in timings (with your patch applied):


```

sage: G=SymmetricGroup(10000)                                                                                                                              
sage: g=G('(1,2,3)(6,8,10)')                                                                                                                               
sage: % time g.cycle_tuples()                                                                                                                              
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.00 s
[(1, 2, 3), (6, 8, 10)]
sage: %time FiniteEnumeratedSet(flatten(g.cycle_tuples()))
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.00 s
{1, 2, 3, 6, 8, 10}
sage: %time g.image()                                                                                                                                      
CPU times: user 7.81 s, sys: 0.02 s, total: 7.83 s
Wall time: 7.82 s
{1, 2, 3, 6, 8, 10}
```


As the size of the group grows, this gets much worse.

Besides that, i think it is ok.


---

Attachment

Now the image elements are directly parsed from the string representation which should be optimal.


---

Comment by aanand created at 2013-05-12 10:05:54

Also, please note, the image function described here assumes only those elements to be in the image set which are changed by the permutation group element. If the image of the entire domain is required, use the .tuple() function instead.


---

Comment by mmarco created at 2013-05-12 10:50:30

I would suggest to use the .cycle_tuples() representation instead of the string representation. Note that the elements permuted are not necessarely integers: you can define a SymmetricGroup acting on any type of objects. Parsing the string is a very bad idea: you should have to deal with parenthesis, commas, representation of different types of objects (aven on integers, you have to deal with several digit numbers)...


---

Comment by aanand created at 2013-05-12 11:38:58

yes, I get the point. this would only work for single digit integers. Will upload a new patch soon.


---

Comment by aanand created at 2013-05-12 12:06:31

Used cycle_tuple().


---

Attachment

Looks good now.


---

Comment by mmarco created at 2013-05-13 12:19:26

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-05-13 13:39:49

Changing status from positive_review to needs_info.


---

Comment by jdemeyer created at 2013-05-13 13:39:49

Which patches should be applied?


---

Comment by aanand created at 2013-05-17 07:39:55

Sorry for the delayed reply, the best patch added by me is the latest one,  trac_13649_domain_codomain_image_n.patch


---

Comment by lazza created at 2013-07-19 16:31:51

I was finally going to enhance my patch (sorry, I had a busy semester) but it looks like now `perm_gps/permgroup_element.pyx` already has a `domain` method. Has there been some change which is not documented in this bug report?


---

Comment by mjo created at 2020-03-08 00:36:02

Yeah, it looks like the `domain` method already works. We're still missing `codomain` (whose implementation is fairly obvious) and `image`, though.

Is it standard terminology that the image of a permutation is the set of elements that it changes (as in the patch in comment:21)? This isn't my area of expertise, but I was expecting `image` to do the same thing as `domain` and `codomain`.


---

Comment by @SagnikDey92 created at 2020-03-08 12:33:07

Replying to [comment:30 mjo]:
> Yeah, it looks like the `domain` method already works. We're still missing `codomain` (whose implementation is fairly obvious) and `image`, though.
> 
> Is it standard terminology that the image of a permutation is the set of elements that it changes (as in the patch in comment:21)? This isn't my area of expertise, but I was expecting `image` to do the same thing as `domain` and `codomain`.

For the symmetric group, why not just make codomain an alias of domain() which already works? And if someone can confirm what image refers to, in case it's the same as domain, can also be made an alias od domain(). Also, on the devel group, it has been noted that the .support() method for symmetric groups is also not according to definitions. Should we just fix that too in this ticket after modifying the ticket description appropriately?


---

Comment by mjo created at 2020-03-08 13:30:21

If you put `codomain = domain`, then unfortunately when people type `g.codomain?`, they're going to get the documentation for the domain method and it can be pretty confusing. (This issue comes up frequently.) In that regard, adding a short codomain method that just returns `self.domain()` is preferable.

The same disclaimer applies, but it looks like you're right about `support()` doing the wrong thing:

* https://reference.wolfram.com/language/ref/PermutationSupport.html
* https://www.maplesoft.com/support/help/Maple/view.aspx?path=GroupTheory/tutorials/WorkingWithPermutations

That terminology is unfortunate, since permutations are also usually thought of as real-valued functions, whose support is the set of things that don't get mapped to zero. Since that issue will likely be more controversial and can break existing code, it is best handled on another ticket.


---

Comment by nthiery created at 2020-03-08 17:44:51

Brief opinions, mostly as confirmation of what was said before.

For permutations, domain, codomain, and image should all return the same value. And we would want them to return the same thing as their parent too, which is not the case with the current implementation of domain:

    sage: G.domain()
    {1, 2, 3, 4, 5}
    sage: G.random_element().domain()
    [5, 2, 3, 4, 1]
    sage: G.random_element().domain()
    [5, 3, 4, 2, 1]

Of course, it feels a bit silly to have so many methods to apparently achieve the same thing, but this makes permutations fit within the larger setting of morphisms.

Fixing the support method (which should return the set of non-fixed points) would be best another ticket.

Thanks for the work on that ticket!


---

Comment by @DaveWitteMorris created at 2020-05-27 03:01:04

Changing keywords from "beginner, aggregation" to "aggregation".


---

Comment by @DaveWitteMorris created at 2020-05-27 03:01:04

Removing the "beginner" tag from old tickets. Some could be returned to beginner-friendly status by adding a comment about what needs to be done. Some others might be easy for an experienced developer to finish.
