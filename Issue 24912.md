# Issue 24912: Implement FSym

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2018-04-11 22:34:52

CC:  sage-combinat tscrim darij zabrocki alauve saliola amypang

Keywords: IMA coding sprint, CHAs, tableaux




---

Comment by tscrim created at 2018-04-11 22:35:32

#25133 is not a strict dependency, but this is going into the new `combinat/chas` folder created in #25133.


---

Comment by tscrim created at 2018-04-16 22:52:11

Darij or someone else, could you add some documentation? Otherwise I think everything else should be good to go.
----
Last 10 new commits:


---

Comment by git created at 2018-04-16 22:52:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-26 17:32:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-04-26 17:34:21

Is there a specific reference whose notations you're following? Is it the paper that first introduced the algebra ([PoiReu95])?

And why do you speak of "self-dual" in `duality_pairing`, when you're defining FSym and FSym* as two distinct algebras? Are they isomorphic or not? (I regret I have never learnt much about this algebra.)


---

Comment by git created at 2018-04-26 17:39:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-04-26 21:22:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-04-26 21:23:58

I'm not very keen on having [the test file](https://git.sagemath.org/sage.git/diff/src/sage/tests/combinatorial_hopf_algebras.py?id=83d6a992a51f6a376be78474fcb9739abab0bef4&id2=f46abe6c0e167d03c89c6d2f347347c3d8f0f1a2) in this ticket. Or, at least, I don't want to be the one writing it...


---

Comment by tscrim created at 2018-04-26 23:56:03

Replying to [comment:6 gh-darijgr]:
> Is there a specific reference whose notations you're following? Is it the paper that first introduced the algebra ([PoiReu95])?

I was using Franco's code, so I cannot answer that. Franco?

> And why do you speak of "self-dual" in `duality_pairing`, when you're defining FSym and FSym* as two distinct algebras? Are they isomorphic or not? (I regret I have never learnt much about this algebra.)

That was likely a copy/paste error on my part. They are not isomorphic AFAIK.


---

Comment by tscrim created at 2018-04-27 00:00:11

Replying to [comment:9 gh-darijgr]:
> I'm not very keen on having [the test file](https://git.sagemath.org/sage.git/diff/src/sage/tests/combinatorial_hopf_algebras.py?id=83d6a992a51f6a376be78474fcb9739abab0bef4&id2=f46abe6c0e167d03c89c6d2f347347c3d8f0f1a2) in this ticket. Or, at least, I don't want to be the one writing it...

I think it is something that we should have as a common place to put code to show consistency between all of our CHAs (mainly in terms of coercions). I am okay with moving it to another ticket, but I didn't want to outright remove Franco's tests and have them be forgotten. To make it meaningful for this ticket and for debugging purposes, we should think about how to make the tests more granular.


---

Comment by @darijgr created at 2018-05-07 20:05:05

Is there a reason why FSym does not require a basis to have a `_basis_name` attribute, while FQSym does?


---

Comment by @darijgr created at 2018-05-07 20:12:15

Even if we only have one basis of FSym implemented so far, the methods `to_fqsym` and `to_symmetric_function` should be implemented on the ABC, not just on that basis.


---

Comment by git created at 2018-05-07 20:33:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-07 20:49:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-07 20:55:35

Still a long way to go.

I have removed all allusions to self-duality. While I can't exclude the possibility of a self-duality for FSym (though of course the Fundamental basis won't be orthogonal under that self-duality), there is no such thing implemented in the code.

This looks mis-documented; what should it actually say?

```
        def __getitem__(self, key):
            r"""
            Override the ``__getitem__`` method to allow passing of
            arguments to ``StandardTableau``.

            EXAMPLES:

            Construct the basis element indexed by a standard tableau by
            passing data that defines the standard tableau::
```


Some of the methods, particularly the coproduct of FQSym, look rather inefficient to me. I'm wondering if sometimes we can use FQSym instead, in a sufficiently smart way (reading words?).

Someone should take a look at the OOP here and see if it could use some backporting of the recent fixes from FQSym. Will it blow up if we define a second basis?


---

Comment by alauve created at 2018-05-07 21:09:14

FSym is not self-dual. At level three, the map from FSym (thru FQSym) to FSym* should have rank 4 and it has rank 3.


---

Comment by tscrim created at 2018-05-07 22:28:19

Replying to [comment:12 gh-darijgr]:
> Is there a reason why FSym does not require a basis to have a `_basis_name` attribute, while FQSym does?

`FQSym` does not need a `_basis_name`; it can use `_realization_name()` as well.


---

Comment by tscrim created at 2018-05-07 22:30:29

Replying to [comment:13 gh-darijgr]:
> Even if we only have one basis of FSym implemented so far, the methods `to_fqsym` and `to_symmetric_function` should be implemented on the ABC, not just on that basis.

We can add it when we need it. It is better to have more granular changes anyways. It means less maintenance and useless (or missing) tests.


---

Comment by tscrim created at 2018-05-07 22:39:51

Replying to [comment:16 gh-darijgr]:
> Some of the methods, particularly the coproduct of FQSym, look rather inefficient to me. I'm wondering if sometimes we can use FQSym instead, in a sufficiently smart way (reading words?).

Try both with timings and we can go from there.

> Someone should take a look at the OOP here and see if it could use some backporting of the recent fixes from FQSym. Will it blow up if we define a second basis?

I highly doubt it since we explicitly call/use the `F` basis (I fail to see why that has to do with OOP/class structure).


---

Comment by git created at 2018-05-07 23:28:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-08 02:12:28

One by one, things are getting clearer.

Poirier and Reutenauer show that their Hopf algebras `(\ZZ T, *, \delta)` and `(\ZZ T, *', \delta')` are dual to each other (with the bases `T` and `T` being dual bases). Thus, `FSym^*` can be identified with `(\ZZ T, *', \delta')`. Also, this shows that these Hopf algebras are not self-dual, since the former is free as an algebra whereas the latter is not (as Poirier and Reutenauer point out).


---

Comment by git created at 2018-05-08 04:01:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-08 04:02:18

Another piece of the review: I've checked all the product and coproduct methods. If the Poirier-Reutenauer paper is correct, then these methods are correct. I've also documented FSym* a bit. The notational differences are obnoxious here; there are two reasonable bilinear forms on FQSym, and the resulting confusion lurks at every corner. I hope I got it right.

I have given up on optimizing the methods -- I just don't have the time. The question is nontrivial, as it boils down to telling whether jdt or RSK is faster for example.

Still not a full review.


---

Comment by git created at 2018-05-08 05:19:30

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @darijgr created at 2018-05-08 05:35:56

Should the canonical map NSym -> FSym be a coercion?


---

Comment by git created at 2018-05-08 05:47:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-08 05:51:37

Still need to ...

* review fsym.py until FreeSymmetricFunctions;

* remove the test file from the ticket (unless someone volunteers to write the tests!);

* possibly implement Schützenberger involutions on FSym and FQSym since it's easy and sort-of natural.

And of course, someone should look at my commits.


---

Comment by @darijgr created at 2018-05-08 05:52:30

Changing status from new to needs_review.


---

Comment by git created at 2018-05-09 07:12:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-09 07:17:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-05-09 07:19:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-05-09 07:33:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-09 07:34:30

Updated todo:

- Make injection NSym -> FSym a coercion.

- (Travis) tests file.

- (me) Schützenberger anti-automorphisms for WQSym, FQSym, FSym.


---

Comment by git created at 2018-05-09 07:51:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-09 08:11:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-09 22:45:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-09 23:53:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-05-10 10:10:58

Just as a note, the test file will become more relevant once more CHA coercions are added as the `# non tested` tests are checking the commutative diagram property of the coercions.

Darij, actually looking at your comment:35 more closely, if we are going to implement the Schützenberger anti-automorphisms for all three of those, then that could be one (or three) separate tickets. It probably would be better as at least a separate ticket from this.


---

Comment by @darijgr created at 2018-05-10 10:42:00

FWIW, the tests in the tests file are mathematically correct -- whether or not the tests file works is a different story.


---

Comment by @darijgr created at 2018-05-10 10:44:11

New ticket #25326 is now open for the Schützenberger stuff. The tests file, while being less useful than it will eventually be, at least doesn't break anything. So, positive review.


---

Comment by @darijgr created at 2018-05-10 10:44:11

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-19 17:21:21

PDF docs don't build


---

Comment by vbraun created at 2018-05-19 17:21:21

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2018-05-19 19:43:11

My guess is `~_A` is causing the failure since `~` is the non-breaking space and instead you want `\sim_A`.

I think `\{1,2,3,\ldots}` in `to_packed_word` was taken care of in an earlier ticket.

The `{1, 2, ..., n}` in `from_finite_word` is fixed in #25141.

That is all I see on a manual look over.


---

Comment by darij created at 2018-05-19 22:40:50

Travis, can you fix this? Thanks!


---

Comment by git created at 2018-05-20 02:13:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-20 05:52:27

Thanks, Travis!


---

Comment by @darijgr created at 2018-05-20 05:52:39

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-05-21 23:10:14

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-05-21 23:10:14

PDF docs still don't build


---

Comment by tscrim created at 2018-05-22 06:06:12

I cannot seem to test it right now. Could someone else test it (Mike, Aaron?) and tell me what the error is (if you don't fix it yourself)?


---

Comment by git created at 2018-05-22 11:28:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-22 11:51:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-22 11:54:03

I have corrected a few things I caught in the doc (sorry for not doing so at review time) and defensively replaced some """s by r"""s. Also, while at that, I've updated a few references to newer versions (modifying them whenever necessary); in particularly, [GriRei2014] and [GriRei16] now point to the same global reference.

I still can't docbuild the PDF on my machine though :(


---

Comment by git created at 2018-05-22 12:22:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-22 14:00:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by zabrocki created at 2018-05-22 14:02:19

The problem was the missing line in the module_list.rst (at least I was able to build the documentation after I added this line and I was unable to build it before).


---

Comment by zabrocki created at 2018-05-22 14:02:19

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2018-05-22 15:05:39

Replying to [comment:56 zabrocki]:
> The problem was the missing line in the module_list.rst (at least I was able to build the documentation after I added this line and I was unable to build it before).

That seems very strange to me. If that was true, why didn't the doc break on an earlier ticket when we introduced the chas subfolder? Why is this never done elsewhere (AFAIK)? Even if that was the fix, I really would like to understand why it fixes it.


---

Comment by tscrim created at 2018-05-22 15:05:39

Changing status from positive_review to needs_info.


---

Comment by @darijgr created at 2018-05-22 15:10:14

Nothing surprising about this. I did a similar commit back when #25155 was broken: https://git.sagemath.org/sage.git/commit/?id=ef1f3b78ff16516ee9b25f8c767ca9bc34ca6c39 .

I think what happens when the line in module_list.rst is missing is that the file doesn't get compiled into the PDF doc, which per se doesn't break the docbuild, but if any other file references it, then that reference ends up undefined. But I can only guess without seeing the specific errors.

Thanks for spotting it, Mike!


---

Comment by @darijgr created at 2018-05-22 15:10:14

Changing status from needs_info to positive_review.


---

Comment by tscrim created at 2018-05-22 15:19:00

That doesn't answer the question because where (and why) is the `chas.all` file referenced? I don't see it.

Mike could you post the error in the docbuild you were getting before your last commit?


---

Comment by tscrim created at 2018-05-22 15:19:00

Changing status from positive_review to needs_info.


---

Comment by zabrocki created at 2018-05-22 16:36:47

You are right Travis.  The success on completing the pdf documentation was spurious.  I do not know how it succeeded to build the one time.  But it is stopping at something that I don't see how it is affected by this ticket.

```
[docpdf] LaTeX file written to /Applications/sage/local/share/doc/sage/latex/en/reference/repl
[docpdf] [repl     ] WARNING: LaTeX file written to /Applications/sage/local/share/doc/sage/latex/en/reference/repl
[docpdf] latexmk -pdf -dvi- -ps-  'repl.tex'
[docpdf] make[2]: latexmk: No such file or directory
[docpdf] make[2]: *** [repl.pdf] Error 1
[docpdf] Error building the documentation.
[docpdf] Traceback (most recent call last):
[docpdf]   File "/Applications/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[docpdf]     "__main__", fname, loader, pkg_name)
[docpdf]   File "/Applications/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
[docpdf]     exec code in run_globals
[docpdf]   File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[docpdf]     main()
[docpdf]   File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1713, in main
[docpdf]     builder()
[docpdf]   File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 344, in _wrapper
[docpdf]     getattr(get_builder(document), name)(*args, **kwds)
[docpdf]   File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 535, in _wrapper
[docpdf]     build_many(build_ref_doc, L)
[docpdf]   File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 276, in build_many
[docpdf]     ret = x.get(99999)
[docpdf]   File "/Applications/sage/local/lib/python2.7/multiprocessing/pool.py", line 572, in get
[docpdf]     raise self._value
[docpdf] RuntimeError: failed to run $MAKE all-pdf in /Applications/sage/local/share/doc/sage/latex/en/reference/repl
[docpdf] [reference] WARNING: Error building the documentation.
[docpdf] [reference] Traceback (most recent call last):
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[docpdf] [reference] "__main__", fname, loader, pkg_name)
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
[docpdf] [reference] exec code in run_globals
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[docpdf] [reference] main()
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1713, in main
[docpdf] [reference] builder()
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 344, in _wrapper
[docpdf] [reference] getattr(get_builder(document), name)(*args, **kwds)
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 535, in _wrapper
[docpdf] [reference] build_many(build_ref_doc, L)
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 276, in build_many
[docpdf] [reference] ret = x.get(99999)
[docpdf] [reference] File "/Applications/sage/local/lib/python2.7/multiprocessing/pool.py", line 572, in get
[docpdf] [reference] raise self._value
[docpdf] [reference] RuntimeError: failed to run $MAKE all-pdf in /Applications/sage/local/share/doc/sage/latex/en/reference/repl
make[1]: *** [doc-pdf] Error 1
```



---

Comment by git created at 2018-05-23 04:07:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-05-23 04:14:35

So Darij was correct about the symptoms, but not about the source of the problem. The issue is that we were trying to reference F_Q_Sym, which we had forgotten to add to the documentation.

I made a few other changes. Most are just resolving links and trivial changes. The other significant change I did was move the entire CHAs subsection of `algebraic_combinatorics` to the CHAs header.

I have confirmed the pdf documentation does now build (well, I skipped the repl directory; I get that too, but that has nothing to do with this ticket). So if my changes are good, then positive review.


---

Comment by tscrim created at 2018-05-23 04:45:58

Changing status from needs_info to needs_review.


---

Comment by @darijgr created at 2018-05-23 07:00:52

Your changes look good to me, but can you check if your PDF doc actually contains the sections for FSym, FQSym, Schubert etc.? Thank you!


---

Comment by tscrim created at 2018-05-23 07:09:05

It did.


---

Comment by tscrim created at 2018-05-23 07:09:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-24 22:30:59

Merge conflict


---

Comment by vbraun created at 2018-05-24 22:30:59

Changing status from positive_review to needs_work.


---

Comment by @darijgr created at 2018-05-25 06:45:48

What other related tickets have you merged in, Volker?


---

Comment by tscrim created at 2018-05-25 07:50:25

Could be a trivial conflict in the master ref file too. We will just have to wait for the next beta cycle.


---

Comment by git created at 2018-05-27 17:49:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-05-27 17:50:10

Merged.


---

Comment by @darijgr created at 2018-05-27 17:50:10

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-05-29 20:39:38

Resolution: fixed
