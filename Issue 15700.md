# Issue 15700: Singular won't compile with latest Xcode (5.1, build 5B130a)

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2014-03-13 18:02:23

CC:  kcrisman jdemeyer yomcat

Singular fails with the most recent version of Xcode (downloaded 12 March 2014), with the error

```
ld: symbol dyld_stub_binding_helper not found, normally in crt1.o/dylib1.o/bundle1.o for architecture x86_64
fatal error: libtool: internal link edit command failed
```

One fix is to remove the line

```
export MACOSX_DEPLOYMENT_TARGET=10.4
```

from `spkg-install`, and use the value of `MACOSX_DEPLOYMENT_TARGET` from `sage-env`. This needs testing on a variety of OS X machines.


---

Comment by jhpalmieri created at 2014-03-13 18:03:35

By the way, do I need to bump the package version number if I'm only changing `spkg-install`?


---

Comment by jhpalmieri created at 2014-03-13 18:04:03

Changing status from new to needs_review.


---

Comment by fbissey created at 2014-03-13 18:36:32

Rest in Peace Tiger.... I'll test it on my mac later today (if I remember). I don't think rev-bumping is necessary. If anyone is upgrading from 6.1.1 they'll have to rebuild singular anyway because of the ntl upgrade.


---

Comment by kcrisman created at 2014-03-13 18:45:04

I wonder if one could just fake the "wrong" deployment target on Tiger and that would take care of it there... If this does indeed mean the end for 10.4, we will probably want to continue hosting the latest available version on the mirrors, like many programs do.


---

Comment by jhpalmieri created at 2014-03-13 19:42:15

When I implemented this change, first I deleted the line, but also added a line

```
echo "$MACOSX_DEPLOYMENT_TARGET"
```

On my machine, it told me the right version; this comes from the `sage-env` script. So this might still work on Tiger. The point is to not compile for OS X 10.4 when you're running OS X 10.8 or 10.9, for example. (I only have 10.8 and 10.9 machines available to me, so I can't test this.)


---

Comment by fbissey created at 2014-03-13 20:15:04

I was jesting. Yes we should still be able to build on a Tiger machine - for now.


---

Comment by vbraun created at 2014-03-13 20:51:13

you need to bump the version to force a recompilation. No need to bump it if it fixes a problem building on a particular architecture as you wouldn't have been able to build that version on that computer previously.

Why do we set `MACOSX_DEPLOYMENT_TARGET` at all, isn't that only required for building portable binaries (i.e. if SAGE_FAT_BINARY=yes`)? 

We don't have a 10.4 buildbot at this point (Jeroen's box doesn't have git).


---

Comment by jhpalmieri created at 2014-03-13 21:10:52

Replying to [comment:8 vbraun]:
> Why do we set `MACOSX_DEPLOYMENT_TARGET` at all, isn't that only required for building portable binaries (i.e. if SAGE_FAT_BINARY=yes`)? 

Good question, and I don't know the answer. I seem to recall problems building Python without doing this. I don't know about Singular; I'm not even sure when this part of `spkg-install` first appeared.

By the way, the cliquer `spkg-install` file has a similar line (with 10.3 instead of 10.4), but until that starts causing problems, we should probably leave it alone.


---

Comment by kcrisman created at 2014-03-14 00:40:45

> Why do we set `MACOSX_DEPLOYMENT_TARGET` at all, isn't that only required for building portable binaries (i.e. if SAGE_FAT_BINARY=yes`)? 
I think that John is right about this, though I forget the details.
> 
> We don't have a 10.4 buildbot at this point (Jeroen's box doesn't have git).

Oh, I didn't know that.  I can try to rev up my machine again to do tests of at least the releases.  Is git a prereq or does Sage include git like it included Mercurial? (I guess not?)


---

Comment by fbissey created at 2014-03-14 00:42:45

Does include git but have to get to the sage shell first.

I guess an interesting question is: is there anymore Tiger install apart from your old machine?


---

Comment by kcrisman created at 2014-03-14 00:49:07

> I guess an interesting question is: is there anymore Tiger install apart from your old machine?

Sure, but probably few.  Mac users are way more upgrade-friendly than Windows, I would think.

Though: [here's someone](https://discussions.apple.com/message/21666155#21666155), and amazingly [TenFourFox](http://www.floodgap.com/software/tenfourfox/) is still going strong!


---

Comment by fbissey created at 2014-03-14 00:55:52

I am officially impressed.


---

Comment by fbissey created at 2014-03-14 03:50:27

OK I have reproduced the problem on my maverick machine. Trying the fix now.


---

Comment by fbissey created at 2014-03-14 04:06:14

Work for me with the fix here now we need to know if it will work with older xcode on older machine. I have a 10.5.8 that I can switch back on to experiment on Monday.


---

Comment by kcrisman created at 2014-03-14 14:10:21

Please do; I think that 10.5 definitely is still in some pipelines.  I am going to try this on my computer but it will take some time to get going with it because I haven't tried to use git, or even compile Sage on it since 5.10.


---

Comment by vbraun created at 2014-03-14 15:10:54

Replying to [comment:10 kcrisman]:
> > We don't have a 10.4 buildbot at this point (Jeroen's box doesn't have git). 
> Is git a prereq or does Sage include git like it included Mercurial? (I guess not?)

The tarball includes git but the buildbot uses git directly to get the sources and changesets. So it is a requirement for running the buildbot slave.


---

Comment by kcrisman created at 2014-03-14 15:37:37

> Please do; I think that 10.5 definitely is still in some pipelines.  I am going to try this on my computer but it will take some time to get going with it because I haven't tried to use git, or even compile Sage on it since 5.10.
Since all I had to do was remove those two lines in a file already accessible in the tarball (I have to say, that new directory layout makes it easier to do that) I just changed that.  I'm having some unrelated issues making (checksum issue for bzip2) but hopefully eventually that will be resolved.


---

Comment by kcrisman created at 2014-03-17 20:30:46

Ok, this fix works fine on my computer, though see #15942 for my other problem.


---

Comment by vbraun created at 2014-03-17 21:30:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-03-20 15:43:46

Resolution: fixed
