# Issue 19884: Jupyter dies on incorrect kernel specification

Issue created by migration from https://trac.sagemath.org/ticket/20121

Original creator: cheuberg

Original creation time: 2016-02-26 05:29:40

CC:  vbraun

Keywords: jupyter

If
1. you used Sage 6.9 on your machine
2. that Sage directory does no longer exist
3. you open a ipynb File last saved with Sage 6.9 in SageMath 7.0.beta4
then you get a kernel error. Changing the kernel via the menu in this window does *not* help. Changing the kernel, saving the notebook, reopening the notebook helps.

You can probably substitute 6.9 by older versions.

The reason: Until Sage 6.9 (#19371), a kernel specification file was written in the user's home directory. This kernel specification file now has an invalid path and some relevant part of ipython crashes with an OSError.

```
...
      File "/local/sage/sage-7.1.beta4/local/lib/python2.7/site-packages/jupyter_client/launcher.py", line 123, in launch_kernel
        proc = Popen(cmd, **kwargs)
      File "/local/sage/sage-7.1.beta4/local/lib/python/subprocess.py", line 710, in __init__
        errread, errwrite)
      File "/local/sage/sage-7.1.beta4/local/lib/python/subprocess.py", line 1335, in _execute_child
        raise child_exception
    OSError: [Errno 2] No such file or directory
```


This OSError should be caught and the standard dialog for a missing kernel should be invoked.


---

Comment by cheuberg created at 2016-02-26 06:15:39

I have little idea whether this should be considered to be a jupyter issue or a sage issue --- after all, sage put kernel specification files into the users homedirectories without informing them about that.

From jupyter's perspective, the user provided an incorrect specification file, so perhaps there is no reason to react gracefully. Sage should IMHO.

So I'd appreciate if somebody with more knowledge about the jupyter/sage integration could take over here.


---

Comment by vbraun created at 2016-02-26 11:19:34

Sounds like a Jupyter bug. Do you have a minimal testcase (empty notebook)?


---

Comment by cheuberg created at 2016-02-26 11:29:17

sage 6.9 notebook with one cell


---

Attachment

Replying to [comment:3 vbraun]:
> Sounds like a Jupyter bug. Do you have a minimal testcase (empty notebook)?

attached. It contains one cell (`sage.version.version`): load it in 7.0, observe the kernel error, switch to kernel 7.0, but kernel error still persists (try running the notebook).


---

Comment by mkoeppe created at 2020-08-17 04:10:18

This is likely outdated.


---

Comment by mkoeppe created at 2020-08-17 04:10:18

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-08-18 08:55:14

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-08-18 08:55:14

indeed, it cannot be reproduced in 9.2.beta - no crash any more


---

Comment by chapoton created at 2020-08-19 08:50:45

Resolution: invalid
