# Issue 34040: RealSet: Use self.__class__ in methods when constructing a new RealSet

Issue created by migration from https://trac.sagemath.org/ticket/34277

Original creator: mkoeppe

Original creation time: 2022-08-04 18:48:55

CC:  yzh tscrim

... instead of hardcoding `RealSet`.

(split out from #32170 - https://github.com/sagemath/sagetrac-mirror/compare/develop...public/32170)


---

Comment by mkoeppe created at 2022-08-05 04:55:56

Cherry-picked from #32170
----
New commits:


---

Comment by git created at 2022-08-05 05:00:57

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2022-08-05 05:02:27

Merged #32181 and resolved merge conflicts. 

Haven't checked whether everything that needs to be changed to `__class__` has been changed.


---

Comment by yzh created at 2022-08-05 14:09:08

Bug example:

```
sage: r = RealSet(2,10)
sage: RealSet(x > 2).intersection(RealSet(x < 10)) is RealSet(r[0], normalized=True)
```

Expect `True`. Got `False`.


---

Comment by yzh created at 2022-08-05 14:45:26

In the commit 5f60c49 from #32170, 
why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places?


---

Comment by yzh created at 2022-08-05 15:26:01

In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,
why is it

```
intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))
```

instead of `self.__class__._scan_to_intervals`? 

(It was `RealSet._scan_to_intervals`)


---

Comment by mkoeppe created at 2022-08-05 15:54:52

Replying to [comment:8 yzh]:
> In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,
> why is it
> {{{
> intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))
> }}}
> instead of `self.__class__._scan_to_intervals`? 
> 
> (It was `RealSet._scan_to_intervals`)

`_scan_to_intervals` is a `staticmethod`, so `self._scan_to_intervals(...)` is the same thing as `self.__class__._scan_to_intervals`.


---

Comment by mkoeppe created at 2022-08-05 15:56:02

Replying to [comment:7 yzh]:
> In the commit 5f60c49 from #32170, 
> why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places? 

As I said, I haven't checked whether all necessary changes have been made


---

Comment by yzh created at 2022-08-05 20:46:12

Unfortunately, the previous bug example remains.

```
sage: r = RealSet(2,10)
sage: r is r.__class__(r)
True
sage: r is r.__class__(r[0])
False
sage: r is r.__class__(r[0], normalized=True)
False
```

----
New commits:


---

Comment by git created at 2022-08-06 18:27:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2022-08-06 18:29:17

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-08-07 02:05:56

More changes in the same direction can be cherry-picked from #34278


---

Comment by git created at 2022-08-07 02:52:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2022-08-07 02:53:16

cherry-picked the relevant commits from #34278.
