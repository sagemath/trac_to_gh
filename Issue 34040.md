# Issue 34040: RealSet: Use self.__class__ in methods when constructing a new RealSet

archive/issues_034040.json:
```json
{
    "body": "CC:  yzh tscrim\n\n... instead of hardcoding `RealSet`.\n\n(split out from #32170 - https://github.com/sagemath/sagetrac-mirror/compare/develop...public/32170)\n\nIssue created by migration from https://trac.sagemath.org/ticket/34277\n\n",
    "created_at": "2022-08-04T18:48:55Z",
    "labels": [
        "basic arithmetic",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "RealSet: Use self.__class__ in methods when constructing a new RealSet",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34040",
    "user": "mkoeppe"
}
```
CC:  yzh tscrim

... instead of hardcoding `RealSet`.

(split out from #32170 - https://github.com/sagemath/sagetrac-mirror/compare/develop...public/32170)

Issue created by migration from https://trac.sagemath.org/ticket/34277





---

archive/issue_comments_483160.json:
```json
{
    "body": "Cherry-picked from #32170\n----\nNew commits:",
    "created_at": "2022-08-05T04:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483160",
    "user": "mkoeppe"
}
```

Cherry-picked from #32170
----
New commits:



---

archive/issue_comments_483161.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-08-05T05:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483161",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_483162.json:
```json
{
    "body": "Merged #32181 and resolved merge conflicts. \n\nHaven't checked whether everything that needs to be changed to `__class__` has been changed.",
    "created_at": "2022-08-05T05:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483162",
    "user": "mkoeppe"
}
```

Merged #32181 and resolved merge conflicts. 

Haven't checked whether everything that needs to be changed to `__class__` has been changed.



---

archive/issue_comments_483163.json:
```json
{
    "body": "Bug example:\n\n```\nsage: r = RealSet(2,10)\nsage: RealSet(x > 2).intersection(RealSet(x < 10)) is RealSet(r[0], normalized=True)\n```\n\nExpect `True`. Got `False`.",
    "created_at": "2022-08-05T14:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483163",
    "user": "yzh"
}
```

Bug example:

```
sage: r = RealSet(2,10)
sage: RealSet(x > 2).intersection(RealSet(x < 10)) is RealSet(r[0], normalized=True)
```

Expect `True`. Got `False`.



---

archive/issue_comments_483164.json:
```json
{
    "body": "In the commit 5f60c49 from #32170, \nwhy is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places?",
    "created_at": "2022-08-05T14:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483164",
    "user": "yzh"
}
```

In the commit 5f60c49 from #32170, 
why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places?



---

archive/issue_comments_483165.json:
```json
{
    "body": "In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,\nwhy is it\n\n```\nintervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))\n```\n\ninstead of `self.__class__._scan_to_intervals`? \n\n(It was `RealSet._scan_to_intervals`)",
    "created_at": "2022-08-05T15:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483165",
    "user": "yzh"
}
```

In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,
why is it

```
intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))
```

instead of `self.__class__._scan_to_intervals`? 

(It was `RealSet._scan_to_intervals`)



---

archive/issue_comments_483166.json:
```json
{
    "body": "Replying to [comment:8 yzh]:\n> In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,\n> why is it\n> {{{\n> intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))\n> }}}\n> instead of `self.__class__._scan_to_intervals`? \n> \n> (It was `RealSet._scan_to_intervals`)\n\n`_scan_to_intervals` is a `staticmethod`, so `self._scan_to_intervals(...)` is the same thing as `self.__class__._scan_to_intervals`.",
    "created_at": "2022-08-05T15:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483166",
    "user": "mkoeppe"
}
```

Replying to [comment:8 yzh]:
> In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,
> why is it
> {{{
> intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))
> }}}
> instead of `self.__class__._scan_to_intervals`? 
> 
> (It was `RealSet._scan_to_intervals`)

`_scan_to_intervals` is a `staticmethod`, so `self._scan_to_intervals(...)` is the same thing as `self.__class__._scan_to_intervals`.



---

archive/issue_comments_483167.json:
```json
{
    "body": "Replying to [comment:7 yzh]:\n> In the commit 5f60c49 from #32170, \n> why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places? \n\nAs I said, I haven't checked whether all necessary changes have been made",
    "created_at": "2022-08-05T15:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483167",
    "user": "mkoeppe"
}
```

Replying to [comment:7 yzh]:
> In the commit 5f60c49 from #32170, 
> why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places? 

As I said, I haven't checked whether all necessary changes have been made



---

archive/issue_comments_483168.json:
```json
{
    "body": "Unfortunately, the previous bug example remains.\n\n```\nsage: r = RealSet(2,10)\nsage: r is r.__class__(r)\nTrue\nsage: r is r.__class__(r[0])\nFalse\nsage: r is r.__class__(r[0], normalized=True)\nFalse\n```\n\n----\nNew commits:",
    "created_at": "2022-08-05T20:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483168",
    "user": "yzh"
}
```

Unfortunately, the previous bug example remains.

```
sage: r = RealSet(2,10)
sage: r is r.__class__(r)
True
sage: r is r.__class__(r[0])
False
sage: r is r.__class__(r[0], normalized=True)
False
```

----
New commits:



---

archive/issue_comments_483169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-06T18:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483169",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483170.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-06T18:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483170",
    "user": "yzh"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483171.json:
```json
{
    "body": "More changes in the same direction can be cherry-picked from #34278",
    "created_at": "2022-08-07T02:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483171",
    "user": "mkoeppe"
}
```

More changes in the same direction can be cherry-picked from #34278



---

archive/issue_comments_483172.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T02:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483172",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483173.json:
```json
{
    "body": "cherry-picked the relevant commits from #34278.",
    "created_at": "2022-08-07T02:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34040#issuecomment-483173",
    "user": "yzh"
}
```

cherry-picked the relevant commits from #34278.
