# Issue 33992: use PARI's qfbredsl2() for binary quadratic forms

archive/issues_033992.json:
```json
{
    "body": "Currently, Sage cannot compute the transformation matrix when reducing *definite* binary quadratic forms:\n\n\n```sage\nsage: BinaryQF([1,2,3]).reduced_form(transformation=True)\n# ...\nNotImplementedError: reduction of definite binary quadratic forms with transformation=True is not implemented\n```\n\n\nWe can use PARI's `qfbredsl2()` to make this work.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34229\n\n",
    "created_at": "2022-07-27T03:03:09Z",
    "labels": [
        "quadratic forms",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "use PARI's qfbredsl2() for binary quadratic forms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33992",
    "user": "@yyyyx4"
}
```
Currently, Sage cannot compute the transformation matrix when reducing *definite* binary quadratic forms:


```sage
sage: BinaryQF([1,2,3]).reduced_form(transformation=True)
# ...
NotImplementedError: reduction of definite binary quadratic forms with transformation=True is not implemented
```


We can use PARI's `qfbredsl2()` to make this work.

Issue created by migration from https://trac.sagemath.org/ticket/34229





---

archive/issue_comments_482575.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-27T03:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482575",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_482576.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-27T03:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482576",
    "user": "@yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_482577.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-27T08:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482577",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482578.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-27T08:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482578",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482579.json:
```json
{
    "body": "The patchbot failure seems unrelated.",
    "created_at": "2022-07-28T04:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482579",
    "user": "@yyyyx4"
}
```

The patchbot failure seems unrelated.



---

archive/issue_comments_482580.json:
```json
{
    "body": "I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?\n\nInstead of `self.content() == 1` I would rather use `self.content().is_one()`.\n\nTo my mind, all changes similar to\n\n```diff\n-        Return if ``self`` is identically zero.\n+        Determine if ``self`` is identically zero.\n```\n\nmakes the specification less precise. The word \"determines\" does not describe the output of the function.",
    "created_at": "2022-08-01T07:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482580",
    "user": "@videlec"
}
```

I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?

Instead of `self.content() == 1` I would rather use `self.content().is_one()`.

To my mind, all changes similar to

```diff
-        Return if ``self`` is identically zero.
+        Determine if ``self`` is identically zero.
```

makes the specification less precise. The word "determines" does not describe the output of the function.



---

archive/issue_comments_482581.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-01T07:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482581",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_482582.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T08:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482582",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482583.json:
```json
{
    "body": "Replying to [comment:6 vdelecroix]:\n> I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?\n\nI think the diff you're looking at is cut in an unfortunate place\u2009\u2014\u2009the content isn't the discriminant divided by four! The reasoning behind the changes to caching (commit `7a058f3026c`) is:\n\n- Replace `gcd([a,b,c])` by `.content()` in `.is_primitive()` because that's what it is.\n- Move the ``@`cached_method` up from `.is_primitive()` to `.content()` because it's more general and `.is_one()` is cheap.\n- Remove ``@`cached_method` from `.is_zero()` because `.content()` is now cached and `.is_zero()` is cheap.\n\n> To my mind, all changes similar to\n> {{{#!diff\n> -        Return if ``self`` is identically zero.\n> +        Determine if ``self`` is identically zero.\n> }}}\n> makes the specification less precise. The word \"determines\" does not describe the output of the function.\n\nMy problem with \"return if X\" was that it can be read as `if X then return [a thing?] else [catch fire?]`. But I don't really care; surely noone will be confused by either phrasing.",
    "created_at": "2022-08-01T08:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482583",
    "user": "@yyyyx4"
}
```

Replying to [comment:6 vdelecroix]:
> I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?

I think the diff you're looking at is cut in an unfortunate place — the content isn't the discriminant divided by four! The reasoning behind the changes to caching (commit `7a058f3026c`) is:

- Replace `gcd([a,b,c])` by `.content()` in `.is_primitive()` because that's what it is.
- Move the ``@`cached_method` up from `.is_primitive()` to `.content()` because it's more general and `.is_one()` is cheap.
- Remove ``@`cached_method` from `.is_zero()` because `.content()` is now cached and `.is_zero()` is cheap.

> To my mind, all changes similar to
> {{{#!diff
> -        Return if ``self`` is identically zero.
> +        Determine if ``self`` is identically zero.
> }}}
> makes the specification less precise. The word "determines" does not describe the output of the function.

My problem with "return if X" was that it can be read as `if X then return [a thing?] else [catch fire?]`. But I don't really care; surely noone will be confused by either phrasing.



---

archive/issue_comments_482584.json:
```json
{
    "body": "Replying to [comment:8 lorenz]:\n> Replying to [comment:6 vdelecroix]:\n> > I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?\n> \n> I think the diff you're looking at is cut in an unfortunate place\u2009\u2014\u2009the content isn't the discriminant divided by four! The reasoning behind the changes to caching (commit `7a058f3026c`) is:\n> \n> - Replace `gcd([a,b,c])` by `.content()` in `.is_primitive()` because that's what it is.\n> - Move the ``@`cached_method` up from `.is_primitive()` to `.content()` because it's more general and `.is_one()` is cheap.\n> - Remove ``@`cached_method` from `.is_zero()` because `.content()` is now cached and `.is_zero()` is cheap.\n> \n\nOh I see. Thanks for the explanation. I should have looked more carefully at the final code rather than the diff.\n\n> > To my mind, all changes similar to\n> > {{{#!diff\n> > -        Return if ``self`` is identically zero.\n> > +        Determine if ``self`` is identically zero.\n> > }}}\n> > makes the specification less precise. The word \"determines\" does not describe the output of the function.\n> \n> My problem with \"return if X\" was that it can be read as `if X then return [a thing?] else [catch fire?]`. But I don't really care; surely noone will be confused by either phrasing.\n\nI agree that the initial sentence was not perfect either. In most places we can read `Return whether ``self`` is identically zero.` which I like better.",
    "created_at": "2022-08-01T08:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482584",
    "user": "@videlec"
}
```

Replying to [comment:8 lorenz]:
> Replying to [comment:6 vdelecroix]:
> > I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?
> 
> I think the diff you're looking at is cut in an unfortunate place — the content isn't the discriminant divided by four! The reasoning behind the changes to caching (commit `7a058f3026c`) is:
> 
> - Replace `gcd([a,b,c])` by `.content()` in `.is_primitive()` because that's what it is.
> - Move the ``@`cached_method` up from `.is_primitive()` to `.content()` because it's more general and `.is_one()` is cheap.
> - Remove ``@`cached_method` from `.is_zero()` because `.content()` is now cached and `.is_zero()` is cheap.
> 

Oh I see. Thanks for the explanation. I should have looked more carefully at the final code rather than the diff.

> > To my mind, all changes similar to
> > {{{#!diff
> > -        Return if ``self`` is identically zero.
> > +        Determine if ``self`` is identically zero.
> > }}}
> > makes the specification less precise. The word "determines" does not describe the output of the function.
> 
> My problem with "return if X" was that it can be read as `if X then return [a thing?] else [catch fire?]`. But I don't really care; surely noone will be confused by either phrasing.

I agree that the initial sentence was not perfect either. In most places we can read `Return whether ``self`` is identically zero.` which I like better.



---

archive/issue_comments_482585.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T08:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482585",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482586.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-01T08:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482586",
    "user": "@yyyyx4"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_482587.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-01T11:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482587",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_482588.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-04T22:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33992#issuecomment-482588",
    "user": "@vbraun"
}
```

Resolution: fixed
