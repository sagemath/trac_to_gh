# Issue 33992: use PARI's qfbredsl2() for binary quadratic forms

Issue created by migration from https://trac.sagemath.org/ticket/34229

Original creator: lorenz

Original creation time: 2022-07-27 03:03:09

Currently, Sage cannot compute the transformation matrix when reducing _definite_ binary quadratic forms:


```sage
sage: BinaryQF([1,2,3]).reduced_form(transformation=True)
# ...
NotImplementedError: reduction of definite binary quadratic forms with transformation=True is not implemented
```


We can use PARI's `qfbredsl2()` to make this work.


---

Comment by git created at 2022-07-27 03:06:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by lorenz created at 2022-07-27 03:06:55

Changing status from new to needs_review.


---

Comment by git created at 2022-07-27 08:29:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-27 08:43:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-07-28 04:56:22

The patchbot failure seems unrelated.


---

Comment by vdelecroix created at 2022-08-01 07:56:42

I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?

Instead of `self.content() == 1` I would rather use `self.content().is_one()`.

To my mind, all changes similar to

```diff
-        Return if ``self`` is identically zero.
+        Determine if ``self`` is identically zero.
```

makes the specification less precise. The word "determines" does not describe the output of the function.


---

Comment by vdelecroix created at 2022-08-01 07:56:42

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-08-01 08:25:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-08-01 08:25:51

Replying to [comment:6 vdelecroix]:
> I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?

I think the diff you're looking at is cut in an unfortunate place — the content isn't the discriminant divided by four! The reasoning behind the changes to caching (commit `7a058f3026c`) is:

- Replace `gcd([a,b,c])` by `.content()` in `.is_primitive()` because that's what it is.
- Move the ``@`cached_method` up from `.is_primitive()` to `.content()` because it's more general and `.is_one()` is cheap.
- Remove ``@`cached_method` from `.is_zero()` because `.content()` is now cached and `.is_zero()` is cheap.

> To my mind, all changes similar to
> {{{#!diff
> -        Return if ``self`` is identically zero.
> +        Determine if ``self`` is identically zero.
> }}}
> makes the specification less precise. The word "determines" does not describe the output of the function.

My problem with "return if X" was that it can be read as `if X then return [a thing?] else [catch fire?]`. But I don't really care; surely noone will be confused by either phrasing.


---

Comment by vdelecroix created at 2022-08-01 08:41:47

Replying to [comment:8 lorenz]:
> Replying to [comment:6 vdelecroix]:
> > I don't understand why `content` becomes a cached method here. If `discriminant` is already one, dividing it by 4 should be costless. Could you provide timing to justify this change?
> 
> I think the diff you're looking at is cut in an unfortunate place — the content isn't the discriminant divided by four! The reasoning behind the changes to caching (commit `7a058f3026c`) is:
> 
> - Replace `gcd([a,b,c])` by `.content()` in `.is_primitive()` because that's what it is.
> - Move the ``@`cached_method` up from `.is_primitive()` to `.content()` because it's more general and `.is_one()` is cheap.
> - Remove ``@`cached_method` from `.is_zero()` because `.content()` is now cached and `.is_zero()` is cheap.
> 

Oh I see. Thanks for the explanation. I should have looked more carefully at the final code rather than the diff.

> > To my mind, all changes similar to
> > {{{#!diff
> > -        Return if ``self`` is identically zero.
> > +        Determine if ``self`` is identically zero.
> > }}}
> > makes the specification less precise. The word "determines" does not describe the output of the function.
> 
> My problem with "return if X" was that it can be read as `if X then return [a thing?] else [catch fire?]`. But I don't really care; surely noone will be confused by either phrasing.

I agree that the initial sentence was not perfect either. In most places we can read `Return whether ``self`` is identically zero.` which I like better.


---

Comment by git created at 2022-08-01 08:56:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-08-01 08:57:17

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2022-08-01 11:56:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-08-04 22:46:57

Resolution: fixed
