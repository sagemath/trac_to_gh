# Issue 11377: Arithmetic with symbolic vectors always creates a new FreeModuleElement_generic_dense

Issue created by migration from https://trac.sagemath.org/ticket/11549

Original creator: jvkersch

Original creation time: 2011-06-27 20:25:26

Assignee: burcin

CC:  roed robertwb jason

Keywords: vector, symbolic, arithmetic

Arithmetic with symbolic vectors (addition, scalar multiplication) produces an instance of `FreeModuleElement_generic_dense` instead of a new symbolic vector:


```
sage: v = vector(SR, [1])
sage: w = vector(SR, [x])
sage: type(v)
<class 'sage.modules.vector_symbolic_dense.Vector_symbolic_dense'> 
sage: type(w) 
<class 'sage.modules.vector_symbolic_dense.Vector_symbolic_dense'> 
sage: type(v + w)
<type 'sage.modules.free_module_element.FreeModuleElement_generic_dense'>
```


As David Roe pointed out, the problem is due to the constructor in `FreeModuleElement_generic_dense` hard-coding the class, so that arithmetic operations with symbolic vectors ends up being a `FreeModuleElement_generic_dense` rather than an instance of `Vector_symbolic_dense`.

See the discussion at https://groups.google.com/group/sage-devel/browse_thread/thread/b20559a111041c3b


---

Attachment


---

Comment by jvkersch created at 2011-06-27 21:14:32

The current patch implements the modification in `_new_c` proposed in sage-devel, and adds an extra doctest to `Vector_symbolic_dense`.  Interestingly, this change also affects the formatting of `Vector_callable_symbolic_dense`: instead of 


```
sage: f(r, theta, z) = (r*cos(theta), r*sin(theta), z), f
(r, theta, z) |--> (r*cos(theta), r*sin(theta), z)
sage: f+f
((r, theta, z) |--> 2*r*cos(theta), (r, theta, z) |--> 2*r*sin(theta), (r, theta, z) |--> 2*z)
sage: 3*f
((r, theta, z) |--> 3*r*cos(theta), (r, theta, z) |--> 3*r*sin(theta), (r, theta, z) |--> 3*z)
```

 
we now have 


```
sage: f(r, theta, z) = (r*cos(theta), r*sin(theta), z), f
(r, theta, z) |--> (r*cos(theta), r*sin(theta), z)
sage: f+f
(r, theta, z) |--> (2*r*cos(theta), 2*r*sin(theta), 2*z)
sage: 3*f
(r, theta, z) |--> (3*r*cos(theta), 3*r*sin(theta), 3*z)
```


As far as I can tell, this is a purely cosmetic change, so I've taken the liberty of going ahead and adapting the doctests in `Vector_callable_symbolic_dense`.


---

Comment by jvkersch created at 2011-06-27 21:14:32

Changing status from new to needs_review.


---

Comment by jason created at 2011-06-28 02:54:08

Yep, you've fixed a "bug" in callable symbolic vectors.  Thanks!


---

Comment by roed created at 2011-06-29 06:11:47

Changing status from needs_review to positive_review.


---

Comment by roed created at 2011-06-29 06:11:47

Looks good; I applied it manually to 4.7.1.alpha4 and all tests pass.


---

Comment by jdemeyer created at 2011-07-04 18:28:13

Small documentation fixes


---

Comment by jdemeyer created at 2011-07-04 18:29:11

Changing status from positive_review to needs_work.


---

Attachment


---

Comment by jdemeyer created at 2011-07-04 18:29:24

My patch needs review.


---

Comment by jdemeyer created at 2011-07-04 18:29:24

Changing status from needs_work to needs_review.


---

Comment by jvkersch created at 2011-07-05 05:16:39

David, thanks for the positive review of my patch!

Jeroen, I can review your patch but it will take a few days as I'm currently on the road.  If anyone else wants to give this the green light, that's fine too.  Thanks for noticing these issues.


---

Comment by jvkersch created at 2011-07-07 20:34:45

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-07-27 13:41:16

Resolution: fixed
