# Issue 14432: ECL spkg : dirty workarounds?

archive/issues_014432.json:
```json
{
    "body": "Assignee: jdemeyer\n\nCC:  jpflori\n\nMy debian/sage experiments have uncovered two problems with sage's ecl package:\n\n(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?\n\n(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?\n\nIssue created by migration from https://trac.sagemath.org/ticket/14636\n\n",
    "created_at": "2013-05-24T11:55:45Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "ECL spkg : dirty workarounds?",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14432",
    "user": "Snark"
}
```
Assignee: jdemeyer

CC:  jpflori

My debian/sage experiments have uncovered two problems with sage's ecl package:

(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?

(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?

Issue created by migration from https://trac.sagemath.org/ticket/14636





---

archive/issue_comments_182488.json:
```json
{
    "body": "Replying to [ticket:14636 Snark]:\n> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources\nI don't see any patch doing this, please clarify...",
    "created_at": "2013-05-24T12:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182488",
    "user": "jdemeyer"
}
```

Replying to [ticket:14636 Snark]:
> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources
I don't see any patch doing this, please clarify...



---

archive/issue_comments_182489.json:
```json
{
    "body": "Replying to [ticket:14636 Snark]:\n> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?\n\nWhich **library** does read start-up files? ;-)",
    "created_at": "2013-05-24T12:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182489",
    "user": "leif"
}
```

Replying to [ticket:14636 Snark]:
> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?

Which **library** does read start-up files? ;-)



---

archive/issue_comments_182490.json:
```json
{
    "body": "`@`jdemeyer: disable_sigchdl_handler.patch is what you're looking for.\n\n`@`leif: good catch! I had the impression that maxima was used as a library within ecl, but that ecl was used through its commandline. But indeed now that you ask, I see there is also a direct use of ecl-as-a-library. What saves the day though is that sage's ecl.pyx calls cl_boot itself, and hence it should be possible to modify the setting before that call. I should be able to do something about it.",
    "created_at": "2013-05-24T13:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182490",
    "user": "Snark"
}
```

`@`jdemeyer: disable_sigchdl_handler.patch is what you're looking for.

`@`leif: good catch! I had the impression that maxima was used as a library within ecl, but that ecl was used through its commandline. But indeed now that you ask, I see there is also a direct use of ecl-as-a-library. What saves the day though is that sage's ecl.pyx calls cl_boot itself, and hence it should be possible to modify the setting before that call. I should be able to do something about it.



---

archive/issue_comments_182491.json:
```json
{
    "body": "(1) unicode: I suppose there are no fundamental obstacles for that. However, you'll have to essentially rewrite the ecllib wrapper. With Py3 this might become worthwhile, since that has unicode strings internally anyway (although undoubtedly stored with an encoding different from ecl's). Also, our main use, Maxima, is solidly pre-unicode, so I don't think there will be any benefits for us and probably extra problems from Maxima possibly getting unexpected data.\n\n(2) signals: ECL has very complex and ingenious infrastructure to deal with signals, and it expects to handle signals itself (which is a bit odd for a library). With threads enabled there will be a separate thread for asynchronous signals, and Boehm repurposes some exotic signals to sync threads on GC events. We cannot afford to submit to ECL's way of handling signals, so we do some pretty horrible stuff with signals when starting ECL anyway (and every time we call into ECL for longer times!) Disabling SIGCHLD is probably the least of your worries. Also, I don't think ECL does anything with SIGCHLD events anyway (other than possibly installing its own handler to provide a hook for ecl programs and which by default ignores the signal)",
    "created_at": "2013-05-24T14:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182491",
    "user": "nbruin"
}
```

(1) unicode: I suppose there are no fundamental obstacles for that. However, you'll have to essentially rewrite the ecllib wrapper. With Py3 this might become worthwhile, since that has unicode strings internally anyway (although undoubtedly stored with an encoding different from ecl's). Also, our main use, Maxima, is solidly pre-unicode, so I don't think there will be any benefits for us and probably extra problems from Maxima possibly getting unexpected data.

(2) signals: ECL has very complex and ingenious infrastructure to deal with signals, and it expects to handle signals itself (which is a bit odd for a library). With threads enabled there will be a separate thread for asynchronous signals, and Boehm repurposes some exotic signals to sync threads on GC events. We cannot afford to submit to ECL's way of handling signals, so we do some pretty horrible stuff with signals when starting ECL anyway (and every time we call into ECL for longer times!) Disabling SIGCHLD is probably the least of your worries. Also, I don't think ECL does anything with SIGCHLD events anyway (other than possibly installing its own handler to provide a hook for ecl programs and which by default ignores the signal)



---

archive/issue_comments_182492.json:
```json
{
    "body": "Replying to [comment:3 Snark]:\n> `@`jdemeyer: disable_sigchdl_handler.patch is what you're looking for.\nSorry, I was looking at an older version of the ECL spkg (this patch is a very recent addition).",
    "created_at": "2013-05-24T15:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182492",
    "user": "jdemeyer"
}
```

Replying to [comment:3 Snark]:
> `@`jdemeyer: disable_sigchdl_handler.patch is what you're looking for.
Sorry, I was looking at an older version of the ECL spkg (this patch is a very recent addition).



---

archive/issue_comments_182493.json:
```json
{
    "body": "`@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n\n`@`nbruin(2) I'll manage to deal with it : there's just an option to set in sage/libs/",
    "created_at": "2013-05-24T16:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182493",
    "user": "Snark"
}
```

`@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.

`@`nbruin(2) I'll manage to deal with it : there's just an option to set in sage/libs/



---

archive/issue_comments_182494.json:
```json
{
    "body": "I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?",
    "created_at": "2013-05-24T16:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182494",
    "user": "Snark"
}
```

I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?



---

archive/issue_comments_182495.json:
```json
{
    "body": "Replying to [comment:7 Snark]:\n> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?\n\nI assume that's an \"extern\" definition. It just gets translated literally into the C-source which then uses the values that `external.h` provides. Just as `cdef typedef extern struct` can afford to only mention the fields that are of interest, or even only with approximate types.\n\nIt may well be that particular member wasn't in ecl when the wrapper was written. Add it if you need it.",
    "created_at": "2013-05-24T16:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182495",
    "user": "nbruin"
}
```

Replying to [comment:7 Snark]:
> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?

I assume that's an "extern" definition. It just gets translated literally into the C-source which then uses the values that `external.h` provides. Just as `cdef typedef extern struct` can afford to only mention the fields that are of interest, or even only with approximate types.

It may well be that particular member wasn't in ecl when the wrapper was written. Add it if you need it.



---

archive/issue_comments_182496.json:
```json
{
    "body": "Replying to [comment:6 Snark]:\n> `@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n\nI don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.",
    "created_at": "2013-05-24T20:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182496",
    "user": "jdemeyer"
}
```

Replying to [comment:6 Snark]:
> `@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.

I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.



---

archive/issue_comments_182497.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> Replying to [comment:6 Snark]:\n> > `@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n> \n> I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.\n\nA ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.",
    "created_at": "2013-05-24T20:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182497",
    "user": "Snark"
}
```

Replying to [comment:9 jdemeyer]:
> Replying to [comment:6 Snark]:
> > `@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.
> 
> I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.

A ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.



---

archive/issue_comments_182498.json:
```json
{
    "body": "Replying to [comment:7 Snark]:\n> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item!\n\nAh, indeed! You should just add that in `ecl.pxd` and do\n\n```\n    ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)\n```\n\nbefore the boot call. Looked like Volker went for the quick-and-dirty solution there on #14055.\n\nNote that even with that option, ECL still does install a SIGCHLD handler. However, we're not putting that back when we call ECL. Does SIGCHLD also need special treatment in `eclsig.c`? Jeroen is the expert on that file.",
    "created_at": "2013-05-24T21:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182498",
    "user": "nbruin"
}
```

Replying to [comment:7 Snark]:
> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item!

Ah, indeed! You should just add that in `ecl.pxd` and do

```
    ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)
```

before the boot call. Looked like Volker went for the quick-and-dirty solution there on #14055.

Note that even with that option, ECL still does install a SIGCHLD handler. However, we're not putting that back when we call ECL. Does SIGCHLD also need special treatment in `eclsig.c`? Jeroen is the expert on that file.



---

archive/issue_comments_182499.json:
```json
{
    "body": "Replying to [comment:11 nbruin]:\n> Note that even with that option, ECL still does install a SIGCHLD handler.\nPreferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).\n\nMaybe it can be made to work with `eclsig.c`, but at least it requires some work.",
    "created_at": "2013-05-24T21:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182499",
    "user": "jdemeyer"
}
```

Replying to [comment:11 nbruin]:
> Note that even with that option, ECL still does install a SIGCHLD handler.
Preferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).

Maybe it can be made to work with `eclsig.c`, but at least it requires some work.



---

archive/issue_comments_182500.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Preferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).\n\nI wondered about that. It's not clear to me why in our situation it even makes a difference what we do to `ECL_OPT_TRAP_SIGCHLD`(but given that Volker's fix had effect apparently it does).\n\nThe Sage `SIGCHLD` should be the `default` or `ignore` handler. Right after calling `cl_boot` we reset all handlers back to the sage handlers, so it shouldn't matter what ECL installs. We only change back some select handlers in `eclsig.c` and `SIGCHLD` is not one of them. Is there something that `ecl` changes that doesn't get reverted by `sigaction`?",
    "created_at": "2013-05-25T00:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182500",
    "user": "nbruin"
}
```

Replying to [comment:12 jdemeyer]:
> Preferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).

I wondered about that. It's not clear to me why in our situation it even makes a difference what we do to `ECL_OPT_TRAP_SIGCHLD`(but given that Volker's fix had effect apparently it does).

The Sage `SIGCHLD` should be the `default` or `ignore` handler. Right after calling `cl_boot` we reset all handlers back to the sage handlers, so it shouldn't matter what ECL installs. We only change back some select handlers in `eclsig.c` and `SIGCHLD` is not one of them. Is there something that `ecl` changes that doesn't get reverted by `sigaction`?



---

archive/issue_comments_182501.json:
```json
{
    "body": "Attachment\n\nECL spkg without the SIGCHLD patch to upstream",
    "created_at": "2013-05-25T06:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182501",
    "user": "Snark"
}
```

Attachment

ECL spkg without the SIGCHLD patch to upstream



---

archive/issue_comments_182502.json:
```json
{
    "body": "Patch programmatically disabling SIGCHLD in sagelib's ECL code",
    "created_at": "2013-05-25T07:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182502",
    "user": "Snark"
}
```

Patch programmatically disabling SIGCHLD in sagelib's ECL code



---

archive/issue_comments_182503.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-25T07:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182503",
    "user": "Snark"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_182504.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-05-25T07:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182504",
    "user": "Snark"
}
```

Attachment



---

archive/issue_comments_182505.json:
```json
{
    "body": "Please add the following doctest (`sage/tests/interrupt.pyx` is a good place for this test):\n\n```\n\"\"\"\nShow that `SIGCHLD` is completely ignored by default. If the process\n`p` finishes, there should be no `SIGCHLD` signal, so ``select()`` will\nsimply time out::\n\n    sage: from select import select\n    sage: import subprocess\n\n    sage: p = subprocess.Popen([\"sleep\", \"1\"])  # long time\n    sage: select([], [], [], 1.5)               # long time\n    ([], [], [])\n    sage: p.poll()                              # long time\n    0\n\nWe now do the same but after installing a dummy `SIGCHLD`\nhandler::\n\n    sage: import signal\n    sage: def dummy_handler(a,b):\n    ....:    pass\n    sage: signal.signal(signal.SIGCHLD, dummy_handler)  # random\n    sage: p = subprocess.Popen([\"sleep\", \"1\"])  # long time\n    sage: select([], [], [], 1.5)               # long time\n    Traceback (most recent call last):\n    ...\n    error: (4, 'Interrupted system call')\n    sage: p.poll()                              # long time\n    0\n\nReset the `SIGCHLD` handler::\n\n    sage: signal.signal(signal.SIGCHLD, signal.SIG_IGN)  # random\n\"\"\"\n```\n",
    "created_at": "2013-05-25T09:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182505",
    "user": "jdemeyer"
}
```

Please add the following doctest (`sage/tests/interrupt.pyx` is a good place for this test):

```
"""
Show that `SIGCHLD` is completely ignored by default. If the process
`p` finishes, there should be no `SIGCHLD` signal, so ``select()`` will
simply time out::

    sage: from select import select
    sage: import subprocess

    sage: p = subprocess.Popen(["sleep", "1"])  # long time
    sage: select([], [], [], 1.5)               # long time
    ([], [], [])
    sage: p.poll()                              # long time
    0

We now do the same but after installing a dummy `SIGCHLD`
handler::

    sage: import signal
    sage: def dummy_handler(a,b):
    ....:    pass
    sage: signal.signal(signal.SIGCHLD, dummy_handler)  # random
    sage: p = subprocess.Popen(["sleep", "1"])  # long time
    sage: select([], [], [], 1.5)               # long time
    Traceback (most recent call last):
    ...
    error: (4, 'Interrupted system call')
    sage: p.poll()                              # long time
    0

Reset the `SIGCHLD` handler::

    sage: signal.signal(signal.SIGCHLD, signal.SIG_IGN)  # random
"""
```




---

archive/issue_comments_182506.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-25T09:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182506",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_182507.json:
```json
{
    "body": "There is another complication with the test: the doctesting framework itself messes with `SIGCHLD`, so it needs slightly more work... let me think about it.",
    "created_at": "2013-05-25T09:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182507",
    "user": "jdemeyer"
}
```

There is another complication with the test: the doctesting framework itself messes with `SIGCHLD`, so it needs slightly more work... let me think about it.



---

archive/issue_comments_182508.json:
```json
{
    "body": "Unicode: See #12985. When I implemented `ecl.pyx` unicode support in ecl was not the default, so it was natural to skip it. I haven't kept up with its development, so I'm of little help for unicode-specific things. It looks like they got something close to working on #12985, though.\n\nGiven that all of calculus is designed to work with `str`, not with `unicode`, I think there is very little benefit in converting the ecl interface in being fully unicode aware (other than not having to turn off unicode support when building ecl), so the approach there (letting ecl work with unicode strings but convert them to ascii as soon as they leave ecl) is probably the quickest to get going.",
    "created_at": "2013-05-25T15:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182508",
    "user": "nbruin"
}
```

Unicode: See #12985. When I implemented `ecl.pyx` unicode support in ecl was not the default, so it was natural to skip it. I haven't kept up with its development, so I'm of little help for unicode-specific things. It looks like they got something close to working on #12985, though.

Given that all of calculus is designed to work with `str`, not with `unicode`, I think there is very little benefit in converting the ecl interface in being fully unicode aware (other than not having to turn off unicode support when building ecl), so the approach there (letting ecl work with unicode strings but convert them to ascii as soon as they leave ecl) is probably the quickest to get going.



---

archive/issue_comments_182509.json:
```json
{
    "body": "Replying to [comment:10 Snark]:\n> Replying to [comment:9 jdemeyer]:\n> > Replying to [comment:6 Snark]:\n> > > `@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n> > \n> > I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.\n> \n> A ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.\n\nYou have to dig deeper (on trac and sage-devel); there have been related tickets and threads years ago, as the Python devs keep claiming *\"There will be no further 2.x release after ...\"*, and they do so since at least 2.4 IIRC.\n\n(AFAIK the tickets mainly addressed removing [future] incompatibilities to Python 3.x from the Sage library, but also mention which upstream packages don't or won't [ever :-) ] work with Python 3.x, to that time of course.)\n\n----\n\nW.r.t. \"holding back\":  There's *no need* to switch to Python 3.x ... ;-)",
    "created_at": "2013-05-25T17:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182509",
    "user": "leif"
}
```

Replying to [comment:10 Snark]:
> Replying to [comment:9 jdemeyer]:
> > Replying to [comment:6 Snark]:
> > > `@`nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.
> > 
> > I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.
> 
> A ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.

You have to dig deeper (on trac and sage-devel); there have been related tickets and threads years ago, as the Python devs keep claiming *"There will be no further 2.x release after ..."*, and they do so since at least 2.4 IIRC.

(AFAIK the tickets mainly addressed removing [future] incompatibilities to Python 3.x from the Sage library, but also mention which upstream packages don't or won't [ever :-) ] work with Python 3.x, to that time of course.)

----

W.r.t. "holding back":  There's *no need* to switch to Python 3.x ... ;-)



---

archive/issue_comments_182510.json:
```json
{
    "body": "Let's put this ticket back to need review : the patch which needs work is a patch about the handling of SIGCHLD in sage which is the matter of #14639.\n\nWhat needs reviewing here is what is point (2) in the description : the move of the SIGCHLD code from a dirty patch within the ECL spkg to a correct ECL-library call in the sage library. The patch and the spkg I propose are a full solution to this issue ; I have already checked their correctness.",
    "created_at": "2013-05-26T09:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182510",
    "user": "Snark"
}
```

Let's put this ticket back to need review : the patch which needs work is a patch about the handling of SIGCHLD in sage which is the matter of #14639.

What needs reviewing here is what is point (2) in the description : the move of the SIGCHLD code from a dirty patch within the ECL spkg to a correct ECL-library call in the sage library. The patch and the spkg I propose are a full solution to this issue ; I have already checked their correctness.



---

archive/issue_comments_182511.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-26T09:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182511",
    "user": "Snark"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182512.json:
```json
{
    "body": "As to python 3.x Christopher started to track the status of the various package with regards to python 3:\nhttps://github.com/cschwan/sage-on-gentoo/issues/212\n\nAs to #12985 with Paulo's patch (Paulo used to package sage for Mandriva and now does sage for Fedora), if you build ecl with unicode you have to rebuild maxima and sage's ecl bits so it is all in sync. Had weird doctests issues but haven't checked lately. Look like Julien thinks it is all in order now.",
    "created_at": "2013-05-26T09:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182512",
    "user": "fbissey"
}
```

As to python 3.x Christopher started to track the status of the various package with regards to python 3:
https://github.com/cschwan/sage-on-gentoo/issues/212

As to #12985 with Paulo's patch (Paulo used to package sage for Mandriva and now does sage for Fedora), if you build ecl with unicode you have to rebuild maxima and sage's ecl bits so it is all in sync. Had weird doctests issues but haven't checked lately. Look like Julien thinks it is all in order now.



---

archive/issue_comments_182513.json:
```json
{
    "body": "`@`fbissey:\n1. I think Christopher forgot PIL ;\n2. At #12985, I only checked patched-sage against current-ecl -- I'm now trying patched-sage against unicode-ecl, but since I don't have any fast computer, it takes almost a full day for a complete build+doctest...\n3. let's stop discussing py3 in this ticket as it's unrelated ;-)",
    "created_at": "2013-05-26T10:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182513",
    "user": "Snark"
}
```

`@`fbissey:
1. I think Christopher forgot PIL ;
2. At #12985, I only checked patched-sage against current-ecl -- I'm now trying patched-sage against unicode-ecl, but since I don't have any fast computer, it takes almost a full day for a complete build+doctest...
3. let's stop discussing py3 in this ticket as it's unrelated ;-)



---

archive/issue_comments_182514.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-27T17:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182514",
    "user": "Snark"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_182515.json:
```json
{
    "body": "Patch against ecl's p3 for p4",
    "created_at": "2013-05-29T13:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182515",
    "user": "Snark"
}
```

Patch against ecl's p3 for p4



---

archive/issue_comments_182516.json:
```json
{
    "body": "Attachment\n\nPatch for sagelib -- about (1)",
    "created_at": "2013-05-29T13:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182516",
    "user": "Snark"
}
```

Attachment

Patch for sagelib -- about (1)



---

archive/issue_comments_182517.json:
```json
{
    "body": "Attachment\n\nPatch for sagelib -- about (2)",
    "created_at": "2013-05-29T13:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182517",
    "user": "Snark"
}
```

Attachment

Patch for sagelib -- about (2)



---

archive/issue_comments_182518.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-29T13:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182518",
    "user": "Snark"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182519.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-05-29T13:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182519",
    "user": "Snark"
}
```

Attachment



---

archive/issue_comments_182520.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-30T11:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182520",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_182521.json:
```json
{
    "body": "What do you mean by \"SIGCHLD doctest\"? My modification doesn't change the situation -- it changes how one obtains it: the current way is by patching upstream sources, the patched way is by calling an api function.",
    "created_at": "2013-05-30T13:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182521",
    "user": "Snark"
}
```

What do you mean by "SIGCHLD doctest"? My modification doesn't change the situation -- it changes how one obtains it: the current way is by patching upstream sources, the patched way is by calling an api function.



---

archive/issue_comments_182522.json:
```json
{
    "body": "Replying to [comment:28 Snark]:\n> My modification doesn't change the situation\nI am not convinced that this is true. I'm not at all saying that you're wrong, just saying that it's not obvious that you're right. A doctest can prove that you're right.",
    "created_at": "2013-05-30T13:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182522",
    "user": "jdemeyer"
}
```

Replying to [comment:28 Snark]:
> My modification doesn't change the situation
I am not convinced that this is true. I'm not at all saying that you're wrong, just saying that it's not obvious that you're right. A doctest can prove that you're right.



---

archive/issue_comments_182523.json:
```json
{
    "body": "Just look at the current situation: there is a patch to add a zero in a structure. What does my patch do? It calls a function to add a zero in a structure. No doctest will be able to say whether the zero was obtained by patching or by calling a function -- but for distribution packagers, that makes all the difference, since there's no way they'll just patch upstream just for sage.\n\nEven if I convince you, don't close or apply the changes: I'm working on a better set of modifications to also get rid of the disabled threading stuff.",
    "created_at": "2013-05-30T14:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182523",
    "user": "Snark"
}
```

Just look at the current situation: there is a patch to add a zero in a structure. What does my patch do? It calls a function to add a zero in a structure. No doctest will be able to say whether the zero was obtained by patching or by calling a function -- but for distribution packagers, that makes all the difference, since there's no way they'll just patch upstream just for sage.

Even if I convince you, don't close or apply the changes: I'm working on a better set of modifications to also get rid of the disabled threading stuff.



---

archive/issue_comments_182524.json:
```json
{
    "body": "Replying to [comment:30 Snark]:\n> I'm working on a better set of modifications to also get rid of the disabled threading stuff.\nIt's great if you can get that to work.\n\nI considered enabling threading in ECL as fundamentally incompatible with the way we use it in Sage. It will cause ECL to split off a dedicated thread to handle asynchronous events and it will cause Boehm to repurpose some exotic signals to synchronize thread on garbage collection, and those signals will confuse the sage signal handler if it happens to receive them.\n\nWe are switching signal handlers upon entry/exit of ECL. With multiple threads it is not clear anymore whether sage or ECL should be in control of asynch signals at any one time.\n\nWe won't get much benefit from the change either: our main use, Maxima, uses global data structures everywhere and wasn't built with multi-processing in mind at all. It will not be able to utilize multiple threads for a long time.",
    "created_at": "2013-06-03T12:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182524",
    "user": "nbruin"
}
```

Replying to [comment:30 Snark]:
> I'm working on a better set of modifications to also get rid of the disabled threading stuff.
It's great if you can get that to work.

I considered enabling threading in ECL as fundamentally incompatible with the way we use it in Sage. It will cause ECL to split off a dedicated thread to handle asynchronous events and it will cause Boehm to repurpose some exotic signals to synchronize thread on garbage collection, and those signals will confuse the sage signal handler if it happens to receive them.

We are switching signal handlers upon entry/exit of ECL. With multiple threads it is not clear anymore whether sage or ECL should be in control of asynch signals at any one time.

We won't get much benefit from the change either: our main use, Maxima, uses global data structures everywhere and wasn't built with multi-processing in mind at all. It will not be able to utilize multiple threads for a long time.



---

archive/issue_comments_182525.json:
```json
{
    "body": "Ah, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.\n\nThough there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!",
    "created_at": "2013-06-03T18:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182525",
    "user": "Snark"
}
```

Ah, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.

Though there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!



---

archive/issue_comments_182526.json:
```json
{
    "body": "Replying to [comment:32 Snark]:\n> Ah, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.\n\nYou might want to read a bit of source for this. It was enlightening to me at the time. If I remember correctly, Boehm decides at runtime whether to use those signals (IIRC it keeps track of a list of threads registered with it and if that list is longer than one, it issues those signals), so you may be able to avoid those quite easily as soon as you get ECL to not create threads.\n\nSee [ECL_OPT_SIGNAL_HANDLING_THREAD](http://ecls.sourceforge.net/new-manual/ch30s03.html) for ECL (and probably the source!) If this means we get no signal handling at all in ECL, we have a bit of a problem, of course. We still want `CTRL-C` and perhaps even `SIGALRM` to work. What we really need is that `ENABLE_THREADS` is a boot-time option.\n\nSee also #11752, although I think that with the latest ECL upgrade it was found that threading had become even more default than before and hence had to be explicitly disabled at boottime.\n\n> Though there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!\n\nI seriously think that's going to be a no-go. While ECL's and sage's way of handling signals are both sensible on their own, I think they are quite incompatible. Without any threads, we can sort of manage by switching the handlers. But I'm afraid that when ECL is compiled with thread support, it insists on handling async events on a separate thread under its own control. I was hoping you had a brilliant insight.",
    "created_at": "2013-06-03T19:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182526",
    "user": "nbruin"
}
```

Replying to [comment:32 Snark]:
> Ah, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.

You might want to read a bit of source for this. It was enlightening to me at the time. If I remember correctly, Boehm decides at runtime whether to use those signals (IIRC it keeps track of a list of threads registered with it and if that list is longer than one, it issues those signals), so you may be able to avoid those quite easily as soon as you get ECL to not create threads.

See [ECL_OPT_SIGNAL_HANDLING_THREAD](http://ecls.sourceforge.net/new-manual/ch30s03.html) for ECL (and probably the source!) If this means we get no signal handling at all in ECL, we have a bit of a problem, of course. We still want `CTRL-C` and perhaps even `SIGALRM` to work. What we really need is that `ENABLE_THREADS` is a boot-time option.

See also #11752, although I think that with the latest ECL upgrade it was found that threading had become even more default than before and hence had to be explicitly disabled at boottime.

> Though there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!

I seriously think that's going to be a no-go. While ECL's and sage's way of handling signals are both sensible on their own, I think they are quite incompatible. Without any threads, we can sort of manage by switching the handlers. But I'm afraid that when ECL is compiled with thread support, it insists on handling async events on a separate thread under its own control. I was hoping you had a brilliant insight.



---

archive/issue_comments_182527.json:
```json
{
    "body": "Well, I have seen the ECL_OPT_SIGNAL_HANDLING_THREAD option, because indeed choosing whether to enable threading at runtime vs compile-time is the way to go. I just need to find the time to do proper experiments.",
    "created_at": "2013-06-03T19:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182527",
    "user": "Snark"
}
```

Well, I have seen the ECL_OPT_SIGNAL_HANDLING_THREAD option, because indeed choosing whether to enable threading at runtime vs compile-time is the way to go. I just need to find the time to do proper experiments.



---

archive/issue_comments_182528.json:
```json
{
    "body": "The patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right? This seems to open up a new window for race conditions. ECL should default to no SIGCHLD handler, possibly enabling it by an option.",
    "created_at": "2013-06-04T13:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182528",
    "user": "vbraun"
}
```

The patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right? This seems to open up a new window for race conditions. ECL should default to no SIGCHLD handler, possibly enabling it by an option.



---

archive/issue_comments_182529.json:
```json
{
    "body": "Replying to [comment:35 vbraun]:\n> The patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right?\n\nNope. `ecl_set_option` is called *prior* to `cl_boot`, which does all ecl initialization. The fix on #14055 patched ECL to change the *default* value of the boot option. The inclusion of an explicit `ecl_set_option` prior to `cl_boot` is the appropriate way of overriding the default value and should be preferred over patching ecl.",
    "created_at": "2013-06-04T21:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182529",
    "user": "nbruin"
}
```

Replying to [comment:35 vbraun]:
> The patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right?

Nope. `ecl_set_option` is called *prior* to `cl_boot`, which does all ecl initialization. The fix on #14055 patched ECL to change the *default* value of the boot option. The inclusion of an explicit `ecl_set_option` prior to `cl_boot` is the appropriate way of overriding the default value and should be preferred over patching ecl.



---

archive/issue_comments_182530.json:
```json
{
    "body": "FYI ECL 13.5.1 has been released:\n* https://sourceforge.net/mailarchive/message.php?msg_id=30906130",
    "created_at": "2013-06-10T08:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182530",
    "user": "jpflori"
}
```

FYI ECL 13.5.1 has been released:
* https://sourceforge.net/mailarchive/message.php?msg_id=30906130



---

archive/issue_comments_182531.json:
```json
{
    "body": "I'll give it a try. I'm still going nowhere :-/",
    "created_at": "2013-06-10T09:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182531",
    "user": "Snark"
}
```

I'll give it a try. I'm still going nowhere :-/



---

archive/issue_comments_182532.json:
```json
{
    "body": "Replying to [comment:37 jpflori]:\n> FYI ECL 13.5.1 has been released:\n> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130\nand it's terrible it switched to asdf 3 and in Sage-on-gentoo we haven't been able to build a working maxima_lib with it for the last 10 days.",
    "created_at": "2013-06-10T11:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182532",
    "user": "fbissey"
}
```

Replying to [comment:37 jpflori]:
> FYI ECL 13.5.1 has been released:
> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130
and it's terrible it switched to asdf 3 and in Sage-on-gentoo we haven't been able to build a working maxima_lib with it for the last 10 days.



---

archive/issue_comments_182533.json:
```json
{
    "body": "It says ASDF 2.32 in the changelog, doesn't it?",
    "created_at": "2013-06-10T15:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182533",
    "user": "jpflori"
}
```

It says ASDF 2.32 in the changelog, doesn't it?



---

archive/issue_comments_182534.json:
```json
{
    "body": "I can confirm the new ECL doesn't fit in-place. :'-(",
    "created_at": "2013-06-10T15:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182534",
    "user": "Snark"
}
```

I can confirm the new ECL doesn't fit in-place. :'-(



---

archive/issue_comments_182535.json:
```json
{
    "body": "Replying to [comment:40 jpflori]:\n> It says ASDF 2.32 in the changelog, doesn't it?\nI am not sure that's correct. I'll have to check. From the git clone I have Juan hadn't committed asdf 3.0.1 yet. However I think it was not many commits away from 3.0.\n\nOne of the main point is that ecl use to have the asdf-bundle extension (n\u00e9 asdf-ecl as they say) and that extension has been merged in asdf (2.66?) and underwent some changes in the process.\n\nWe have a formula to build a maxima.fas with the new ecl but it leads to segfault when we load it (from sage or even from ecl itself).\n\nIn Gentoo the lisp team has decided to move things to asdf 3.0.1 as fast as they can, but the harm for maxima_lib has been somewhat before 3.0.1.\nSee [https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226) for our status.\n\nThis is our current formula to build maxima.fas\n\n```\n\t\tcd src\n\t\tecl \\\n\t\t\t-eval '(require `asdf)' \\\n\t\t\t-eval '(push \"./\" asdf:*central-registry*)' \\\n\t\t\t-eval \"(asdf:initialize-output-translations \\\n\t\t\t\t'(:output-translations :disable-cache :inherit-configuration))\" \\\n\t\t\t-eval '(load \"maxima-build.lisp\")' \\\n\t\t\t-eval '(asdf:make-build :maxima :type :fasl)' \\\n\t\t\t-eval '(quit)'\n\t\tECLLIB=`ecl -eval \"(princ (SI:GET-LIBRARY-PATHNAME))\" -eval \"(quit)\"`\n\t\tinsinto \"${ECLLIB#${EPREFIX}}\"\n\t\tnewins maxima.fasb maxima.fas\n```\n",
    "created_at": "2013-06-10T21:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182535",
    "user": "fbissey"
}
```

Replying to [comment:40 jpflori]:
> It says ASDF 2.32 in the changelog, doesn't it?
I am not sure that's correct. I'll have to check. From the git clone I have Juan hadn't committed asdf 3.0.1 yet. However I think it was not many commits away from 3.0.

One of the main point is that ecl use to have the asdf-bundle extension (né asdf-ecl as they say) and that extension has been merged in asdf (2.66?) and underwent some changes in the process.

We have a formula to build a maxima.fas with the new ecl but it leads to segfault when we load it (from sage or even from ecl itself).

In Gentoo the lisp team has decided to move things to asdf 3.0.1 as fast as they can, but the harm for maxima_lib has been somewhat before 3.0.1.
See [https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226) for our status.

This is our current formula to build maxima.fas

```
		cd src
		ecl \
			-eval '(require `asdf)' \
			-eval '(push "./" asdf:*central-registry*)' \
			-eval "(asdf:initialize-output-translations \
				'(:output-translations :disable-cache :inherit-configuration))" \
			-eval '(load "maxima-build.lisp")' \
			-eval '(asdf:make-build :maxima :type :fasl)' \
			-eval '(quit)'
		ECLLIB=`ecl -eval "(princ (SI:GET-LIBRARY-PATHNAME))" -eval "(quit)"`
		insinto "${ECLLIB#${EPREFIX}}"
		newins maxima.fasb maxima.fas
```




---

archive/issue_comments_182536.json:
```json
{
    "body": "Two comments that might be useful:\n- When I figured out the original formula, I used trial and error and a bit of reading documentation. I found something that worked and didn't look like it was using any illegal hacks, I was happy. The new formula looks fine in that respect too, so if it works use it!\n- The `.fasb` files were used by ADSF to avoid overwriting files produced by ECL's native build routines. As far as I could see the format is the same as the `.fas` files. I did the rename to ensure that `(require `maxima)` would work without first doing `(require `asdf)` (which was necessary for recognising what to do with `.fasb` files). Since ASDF is getting more closely integrated into ECL, you may be able to modify or avoid this renaming step.",
    "created_at": "2013-06-12T06:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182536",
    "user": "nbruin"
}
```

Two comments that might be useful:
- When I figured out the original formula, I used trial and error and a bit of reading documentation. I found something that worked and didn't look like it was using any illegal hacks, I was happy. The new formula looks fine in that respect too, so if it works use it!
- The `.fasb` files were used by ADSF to avoid overwriting files produced by ECL's native build routines. As far as I could see the format is the same as the `.fas` files. I did the rename to ensure that `(require `maxima)` would work without first doing `(require `asdf)` (which was necessary for recognising what to do with `.fasb` files). Since ASDF is getting more closely integrated into ECL, you may be able to modify or avoid this renaming step.



---

archive/issue_comments_182537.json:
```json
{
    "body": "Thanks for the encouragement Nils. It is not impossible that we have in fact uncovered some kind of bug.  If Martin is right we go through an initialisation twice and the second time we fall into an infinite loop.",
    "created_at": "2013-06-12T07:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182537",
    "user": "fbissey"
}
```

Thanks for the encouragement Nils. It is not impossible that we have in fact uncovered some kind of bug.  If Martin is right we go through an initialisation twice and the second time we fall into an infinite loop.



---

archive/issue_comments_182538.json:
```json
{
    "body": "Just a head up about ecl 13.1.5 and asdf upgrade issues. We have a working maxima_lib in sage-on-gentoo. So we can upgrade ecl as we now have a procedure and patch for maxima (both 5.29.1 and 5.30.0 but issues with 5.30.0 are documented in another ticket).",
    "created_at": "2013-06-15T11:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182538",
    "user": "fbissey"
}
```

Just a head up about ecl 13.1.5 and asdf upgrade issues. We have a working maxima_lib in sage-on-gentoo. So we can upgrade ecl as we now have a procedure and patch for maxima (both 5.29.1 and 5.30.0 but issues with 5.30.0 are documented in another ticket).



---

archive/issue_comments_182539.json:
```json
{
    "body": "I finally found the time to have look ; the spkg-src script fails with \"mv: cannot stat `gmp': No such file or directory\"... this is with upstream's 12.12.1 tarball.\n\nWhere is the ticket with the ecl 13.1.5 discussion?",
    "created_at": "2013-07-09T16:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182539",
    "user": "Snark"
}
```

I finally found the time to have look ; the spkg-src script fails with "mv: cannot stat `gmp': No such file or directory"... this is with upstream's 12.12.1 tarball.

Where is the ticket with the ecl 13.1.5 discussion?



---

archive/issue_comments_182540.json:
```json
{
    "body": "We had a long thread about it - or rather the new asdf - on github for sage-on-gentoo. No spkg at this stage. The short of it is that ecl should be fine without patches. maxima, any version, needs a patch to produce what we want. The current procedure just won't work.\n[https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226)",
    "created_at": "2013-07-09T21:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182540",
    "user": "fbissey"
}
```

We had a long thread about it - or rather the new asdf - on github for sage-on-gentoo. No spkg at this stage. The short of it is that ecl should be fine without patches. maxima, any version, needs a patch to produce what we want. The current procedure just won't work.
[https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226)



---

archive/issue_comments_182541.json:
```json
{
    "body": "Fran\u00e7ois, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?",
    "created_at": "2013-07-10T10:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182541",
    "user": "Snark"
}
```

François, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?



---

archive/issue_comments_182542.json:
```json
{
    "body": "Now that I am starting to remember stuff, removing the \"dirty workaround\" discussed in this ticket will break one doctest at least. But then I haven't tested your patches either.\n\nI have problems getting enough time to work on sage these days and it will probably become worse until September. I cannot give you expectation that I will make the two spkgs in question in a timely fashion.",
    "created_at": "2013-07-10T10:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182542",
    "user": "fbissey"
}
```

Now that I am starting to remember stuff, removing the "dirty workaround" discussed in this ticket will break one doctest at least. But then I haven't tested your patches either.

I have problems getting enough time to work on sage these days and it will probably become worse until September. I cannot give you expectation that I will make the two spkgs in question in a timely fashion.



---

archive/issue_comments_182543.json:
```json
{
    "body": "by the way, `patches/disable_sigchdl_handler.patch` apparently breaks OSX PPC support.",
    "created_at": "2013-08-14T06:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182543",
    "user": "dimpase"
}
```

by the way, `patches/disable_sigchdl_handler.patch` apparently breaks OSX PPC support.



---

archive/issue_comments_182544.json:
```json
{
    "body": "Dima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?",
    "created_at": "2013-08-14T06:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182544",
    "user": "Snark"
}
```

Dima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?



---

archive/issue_comments_182545.json:
```json
{
    "body": "Can you be a bit more vague about what does not work on OSX PPC without the sigchld handler?",
    "created_at": "2013-08-14T10:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182545",
    "user": "vbraun"
}
```

Can you be a bit more vague about what does not work on OSX PPC without the sigchld handler?



---

archive/issue_comments_182546.json:
```json
{
    "body": "Replying to [comment:53 vbraun]:\n> Can you be a bit more vague about what does not work on OSX PPC without the sigchld handler?\nLet me try using `less`,  as `more` is not installed :\u2013)\n\nNot very informative segfault with `ecl-12.12.1.p4`:\n\n```\n...\n;*** Lisp core booted ****\nECL (Embeddable Common Lisp)\n\n;;;\n;;; Welcome to bare.lsp. Let's bring this instance up!\n;;;\n;;;\n;;; About to load lsp/load.lsp\n;;; \n;;; Loading src:lsp;export.lsp/bin/sh: line 1: 97036 Segmentation fault      ECLDIR=`pwd`/ ./ecl_min compile\nmake[4]: *** [bin/ecl] Error 139\nmake[3]: *** [all] Error 2\nError - Failed to build ECL ... exiting\n...\n```\n",
    "created_at": "2013-08-14T12:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182546",
    "user": "dimpase"
}
```

Replying to [comment:53 vbraun]:
> Can you be a bit more vague about what does not work on OSX PPC without the sigchld handler?
Let me try using `less`,  as `more` is not installed :–)

Not very informative segfault with `ecl-12.12.1.p4`:

```
...
;*** Lisp core booted ****
ECL (Embeddable Common Lisp)

;;;
;;; Welcome to bare.lsp. Let's bring this instance up!
;;;
;;;
;;; About to load lsp/load.lsp
;;; 
;;; Loading src:lsp;export.lsp/bin/sh: line 1: 97036 Segmentation fault      ECLDIR=`pwd`/ ./ecl_min compile
make[4]: *** [bin/ecl] Error 139
make[3]: *** [all] Error 2
Error - Failed to build ECL ... exiting
...
```




---

archive/issue_comments_182547.json:
```json
{
    "body": "Replying to [comment:52 Snark]:\n> Dima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?\n\nit turns out that reenabling Altivec back in `p2` was the cause of trouble. If I reapply the patch from #11297\n\n```\n--- a/spkg-install\tWed Jun 05 19:56:22 2013 +0000\n+++ b/spkg-install\tWed Aug 14 23:25:31 2013 +0800\n@@ -48,6 +48,12 @@\n     CXXFLAGS=\"-g -O2 $CXXFLAGS\"\n fi\n \n+if [ \"`uname -sm`\" = \"Darwin Power Macintosh\" ] ; then \n+# Disabling altivec instructions (trac 11297) \n+    CFLAGS=\"$CFLAGS -mno-altivec -mabi=no-altivec\" \n+    export CFLAGS \n+fi \n+\n # These are all used by GNU to specify compilers.\n echo \"Using CC=$CC\"\n echo \"Using CXX=$CXX\"\n```\n\nthen `p4` works for me. Sorry for noise.",
    "created_at": "2013-08-14T15:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182547",
    "user": "dimpase"
}
```

Replying to [comment:52 Snark]:
> Dima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?

it turns out that reenabling Altivec back in `p2` was the cause of trouble. If I reapply the patch from #11297

```
--- a/spkg-install	Wed Jun 05 19:56:22 2013 +0000
+++ b/spkg-install	Wed Aug 14 23:25:31 2013 +0800
@@ -48,6 +48,12 @@
     CXXFLAGS="-g -O2 $CXXFLAGS"
 fi
 
+if [ "`uname -sm`" = "Darwin Power Macintosh" ] ; then 
+# Disabling altivec instructions (trac 11297) 
+    CFLAGS="$CFLAGS -mno-altivec -mabi=no-altivec" 
+    export CFLAGS 
+fi 
+
 # These are all used by GNU to specify compilers.
 echo "Using CC=$CC"
 echo "Using CXX=$CXX"
```

then `p4` works for me. Sorry for noise.



---

archive/issue_comments_182548.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-26T07:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182548",
    "user": "Snark"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182549.json:
```json
{
    "body": "1) I don't think the work issue \"SIGCHLD doctest\" has been addressed.\n\n2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.",
    "created_at": "2013-08-26T07:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182549",
    "user": "jdemeyer"
}
```

1) I don't think the work issue "SIGCHLD doctest" has been addressed.

2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.



---

archive/issue_comments_182550.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-08-26T07:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182550",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_182551.json:
```json
{
    "body": "Also in `SPKG.txt`, there is something wrong with the sentence \"don't path to disable SIGCHLD.\"",
    "created_at": "2013-08-26T07:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182551",
    "user": "jdemeyer"
}
```

Also in `SPKG.txt`, there is something wrong with the sentence "don't path to disable SIGCHLD."



---

archive/issue_comments_182552.json:
```json
{
    "body": "Replying to [comment:58 jdemeyer]:\n> 1) I don't think the work issue \"SIGCHLD doctest\" has been addressed.\n\nI don't have any failing doctest: what exactly do you want? Again, I'm just moving something from patching upstream to calling an api...\n\n> 2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.\n\nIf unicode isn't disabled, it's not unneeded anymore.",
    "created_at": "2013-08-26T09:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182552",
    "user": "Snark"
}
```

Replying to [comment:58 jdemeyer]:
> 1) I don't think the work issue "SIGCHLD doctest" has been addressed.

I don't have any failing doctest: what exactly do you want? Again, I'm just moving something from patching upstream to calling an api...

> 2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.

If unicode isn't disabled, it's not unneeded anymore.



---

archive/issue_comments_182553.json:
```json
{
    "body": "I made a new p5 spkg, available at the same place, and also updated the p4 to p5 patch here.",
    "created_at": "2013-08-26T19:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182553",
    "user": "Snark"
}
```

I made a new p5 spkg, available at the same place, and also updated the p4 to p5 patch here.



---

archive/issue_comments_182554.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-27T08:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182554",
    "user": "Snark"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182555.json:
```json
{
    "body": "Replying to [comment:60 Snark]:\n\n> If unicode isn't disabled, it's not unneeded anymore.\nThat may be true for the `contrib/encodings` and `contrib/unicode` subdirectories, but do you now need `msvc`, `src/gc-unstable`, `src/libffi` and all of `src/gmp`? Your attached patch suggests you're not removing those either anymore. The attached patch also doesn't reflect the edits to spkg-make that you probably made.",
    "created_at": "2013-08-27T18:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182555",
    "user": "nbruin"
}
```

Replying to [comment:60 Snark]:

> If unicode isn't disabled, it's not unneeded anymore.
That may be true for the `contrib/encodings` and `contrib/unicode` subdirectories, but do you now need `msvc`, `src/gc-unstable`, `src/libffi` and all of `src/gmp`? Your attached patch suggests you're not removing those either anymore. The attached patch also doesn't reflect the edits to spkg-make that you probably made.



---

archive/issue_comments_182556.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-08-27T18:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182556",
    "user": "Snark"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_182557.json:
```json
{
    "body": "My attached patch wasn't reflecting edits to spkg-src because I didn't touch it. The next version will modify it, and only not to remove the unicode-related directories.\n\nI'll push the new patch when I'll have checked it's ok. For now I just know it builds correctly.",
    "created_at": "2013-08-27T18:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182557",
    "user": "Snark"
}
```

My attached patch wasn't reflecting edits to spkg-src because I didn't touch it. The next version will modify it, and only not to remove the unicode-related directories.

I'll push the new patch when I'll have checked it's ok. For now I just know it builds correctly.



---

archive/issue_comments_182558.json:
```json
{
    "body": "Attachment\n\nPatch against ecl's p4 for p5",
    "created_at": "2013-08-28T17:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182558",
    "user": "Snark"
}
```

Attachment

Patch against ecl's p4 for p5



---

archive/issue_comments_182559.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-28T17:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182559",
    "user": "Snark"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182560.json:
```json
{
    "body": "No failing doctest ; now src/ is generated by a patched spkg-src.",
    "created_at": "2013-08-28T17:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182560",
    "user": "Snark"
}
```

No failing doctest ; now src/ is generated by a patched spkg-src.



---

archive/issue_comments_182561.json:
```json
{
    "body": "It's still ok with 5.12.beta4.",
    "created_at": "2013-09-01T19:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182561",
    "user": "Snark"
}
```

It's still ok with 5.12.beta4.



---

archive/issue_comments_182562.json:
```json
{
    "body": "Replying to [comment:60 Snark]:\n> Again, I'm just moving something from patching upstream to calling an api...\nAgain, that's only a **claim**. A doctest can **prove** you are right.",
    "created_at": "2013-09-04T08:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182562",
    "user": "jdemeyer"
}
```

Replying to [comment:60 Snark]:
> Again, I'm just moving something from patching upstream to calling an api...
Again, that's only a **claim**. A doctest can **prove** you are right.



---

archive/issue_comments_182563.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-09-04T10:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182563",
    "user": "Snark"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_182564.json:
```json
{
    "body": "Replying to [comment:67 jdemeyer]:\n> Replying to [comment:60 Snark]:\n> > Again, I'm just moving something from patching upstream to calling an api...\n> Again, that's only a **claim**. A doctest can **prove** you are right.\n\nOOOHHH!!!! You want me to ADD a doctest!\n\nI'm not sure it makes much sense to follow a line \"a=0\" by a doctest \"a==0\", but if you want I'll add one.",
    "created_at": "2013-09-04T10:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182564",
    "user": "Snark"
}
```

Replying to [comment:67 jdemeyer]:
> Replying to [comment:60 Snark]:
> > Again, I'm just moving something from patching upstream to calling an api...
> Again, that's only a **claim**. A doctest can **prove** you are right.

OOOHHH!!!! You want me to ADD a doctest!

I'm not sure it makes much sense to follow a line "a=0" by a doctest "a==0", but if you want I'll add one.



---

archive/issue_comments_182565.json:
```json
{
    "body": "I see that trac_14636_2.patch is the same (up to a slight edit in the commit) than the patch in #12985 so incorporating this ticket would make it a duplicate.\nI think you should go ahead and add the doctest.",
    "created_at": "2013-10-03T11:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182565",
    "user": "fbissey"
}
```

I see that trac_14636_2.patch is the same (up to a slight edit in the commit) than the patch in #12985 so incorporating this ticket would make it a duplicate.
I think you should go ahead and add the doctest.



---

archive/issue_comments_182566.json:
```json
{
    "body": "In the spirit of having one ticket per issue I've broken off the part about using and doctesting `ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)` into a new ticket at #15441",
    "created_at": "2013-11-21T02:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182566",
    "user": "vbraun"
}
```

In the spirit of having one ticket per issue I've broken off the part about using and doctesting `ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)` into a new ticket at #15441



---

archive/issue_comments_182567.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-04-09T00:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182567",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182568.json:
```json
{
    "body": "Duplicate of #12985, so close one of them. This one.",
    "created_at": "2014-04-09T00:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182568",
    "user": "vbraun"
}
```

Duplicate of #12985, so close one of them. This one.



---

archive/issue_comments_182569.json:
```json
{
    "body": "Replying to [comment:49 Snark]:\n> Fran\u00e7ois, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?\n\nI've just pushed the build formula used on sage-on-gentoo into a branch associated with ticket:16178.",
    "created_at": "2014-04-17T11:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182569",
    "user": "gagern"
}
```

Replying to [comment:49 Snark]:
> François, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?

I've just pushed the build formula used on sage-on-gentoo into a branch associated with ticket:16178.



---

archive/issue_comments_182570.json:
```json
{
    "body": "Replying to [comment:37 jpflori]:\n> FYI ECL 13.5.1 has been released:\n> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130\n\nWith [ticket:16178 the new maxima build system] included in sage 6.2, do you want to aim for an ECL update for 6.3?",
    "created_at": "2014-06-16T20:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182570",
    "user": "gagern"
}
```

Replying to [comment:37 jpflori]:
> FYI ECL 13.5.1 has been released:
> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130

With [ticket:16178 the new maxima build system] included in sage 6.2, do you want to aim for an ECL update for 6.3?



---

archive/issue_comments_182571.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-01T11:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182571",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_182572.json:
```json
{
    "body": "Since the relevant changes were made in #12985 and #15441, we should close this as a duplicate.",
    "created_at": "2014-12-01T11:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182572",
    "user": "pbruin"
}
```

Since the relevant changes were made in #12985 and #15441, we should close this as a duplicate.



---

archive/issue_comments_182573.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2014-12-01T11:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14432#issuecomment-182573",
    "user": "vbraun"
}
```

Resolution: duplicate
