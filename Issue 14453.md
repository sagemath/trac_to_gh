# Issue 14453: set_embedding fails for multigraphs

Issue created by migration from https://trac.sagemath.org/ticket/14657

Original creator: nvcleemp

Original creation time: 2013-05-29 05:38:39

Assignee: jason, ncohen, rlm

CC:  tscrim

If you try to set the embedding for a multigraph, you will get an error if you specify all edges. If you bundle each multi-edge into a single edge it works. The following code, e.g., gives an error:


```
h = Graph({1:[2], 2:[3,3], 3:[]})
h.set_embedding({1:[2], 2:[1,3,3], 3:[2,2]})
```


The cause of this is the following lines in the method `check_embedding_validity`:


```
if len(embedding[v]) != len(self.neighbors(v)):
    return False
```


A multigraph returns each neighbour only once, and not the number of times that there are edges between these two vertices.

Is this the desired behaviour? If so, then maybe some documentation needs to be added to warn the user that this will not work. If not, how do we change it? Should the method `neighbors` return the 'multiset' of neighbours and not just the 'set'?


---

Comment by nvcleemp created at 2013-05-30 07:50:59

Changing status from new to needs_info.


---

Comment by nvcleemp created at 2013-06-01 14:03:11

Hmm, probably this is not supported, because specifying an embedding like this is not unambiguous. For an edge with multiplicity more than one, you know the order around each vertex, but you don't know which edge around the first vertex corresponds to which edge around the second vertex.


---

Comment by nvcleemp created at 2013-06-02 08:42:56

There is of course a way to get unambiguous embeddings for multigraphs (with loops). Number all edges and instead of listing the neighbours around each vertex, you list all the edges around each vertex.

Is this something that should be added to Sage? Possibly in parallel with the current system of listing all neighbours around each vertex?


---

Comment by dcoudert created at 2021-10-01 15:27:15

With this branch, we clearly say that the method does not work for graphs with loops or multiple edges.
----
New commits:


---

Comment by dcoudert created at 2021-10-01 15:27:15

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2021-10-02 00:27:12

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2021-10-02 00:27:12

This will work for now, but probably in the long-term we will want to have a multigraph embedding.


---

Comment by vbraun created at 2021-10-19 20:31:22

Resolution: fixed
