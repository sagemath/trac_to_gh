# Issue 13602: Building complex_double.pyx fails on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/13806

Original creator: jpflori

Original creation time: 2012-12-06 16:25:27

Assignee: tbd

CC:  kcrisman dimpase

Keywords: cygwin

At some point a dependency on the mc library was added, but this is not available by default on Cygwin (this surely lives in a very common and useful package, but I've reinstalled Cygwin recently and it has not appeared yet) and is not needed anyway.
So the dependency should be removed thus avoiding overlinking and build failure where this lib is not available.


---

Comment by kcrisman created at 2012-12-06 16:41:18

???  I didn't have any troubles with this.

```
sage: CDF(1)
1.0
```



---

Comment by jpflori created at 2012-12-06 16:57:45

I already had this problem the first time I tried building on Cygwin (see [CygwinPort](CygwinPort) page) but it magically disappeared the second time so I did not really care.

As I wrote in the description I think the lib got installed by some Cygwin package between my two attempts.

But anyway, everything buids fine without linking to that lib, so its definitely useless and dangerous to leave 'mc' in these file dependencies (there is the same problem with the complex_... file generated by gen_interpreters.py).


---

Comment by jpflori created at 2012-12-10 23:19:20

Changing status from new to needs_review.


---

Comment by kcrisman created at 2012-12-11 02:56:33

JP, am I correct in seeing that this patch only affects Cygwin-only code in any case?  I find the different syntax for the two files irksome, but they both make sense.   I can't test this right now but will try to do so tomorrow.  How do I check whether I even have `mc`?  I guess I must since this didn't cause trouble on my machine...


---

Comment by kcrisman created at 2012-12-14 14:19:34

Okay, I checked this an it's so.  Positive review on the patch part - it should not affect any other systems.

As to whether it works... I have no way of checking this on Windows 7.  I don't even have this problem on XP, though I will try to check that it's not evil.  How do I see whether my Cygwin has "mc" somehow?


---

Comment by dimpase created at 2012-12-14 14:29:05

Replying to [comment:5 kcrisman]:
> Okay, I checked this an it's so.  Positive review on the patch part - it should not affect any other systems.
> 
> As to whether it works... I have no way of checking this on Windows 7.  I don't even have this problem on XP, though I will try to check that it's not evil.  How do I see whether my Cygwin has "mc" somehow?

huh, `mc` ? Midnight Commander? Something else? 
Medical Condition? ;-)


---

Comment by kcrisman created at 2012-12-14 14:31:57

> huh, `mc` ? Midnight Commander? Something else? 
> Medical Condition? ;-)

Well, I have no idea!  Though I suspect not these... maybe Multiplication, Complex.  Did you read the patch?  It's some library I've never heard of (which describes most libraries, but still...)


---

Comment by jpflori created at 2012-12-14 14:39:50

I don't think the problem is 7 specific.
As I mentioned before i think the problem that libmc is installed by a quite common package that I did not install myself, as I use a fresh and minimal Cygwin setup.

And I'm not sure what this is...
Maybe that's some Cygwin specific version of libm for complex? and md would be for double?


---

Comment by jpflori created at 2012-12-14 14:41:23

Maybe see #9543 as well.


---

Comment by kcrisman created at 2012-12-14 14:49:09

Replying to [comment:9 jpflori]:
> I don't think the problem is 7 specific.
> As I mentioned before i think the problem that libmc is installed by a quite common package that I did not install myself, as I use a fresh and minimal Cygwin setup.
> 
> And I'm not sure what this is...
> Maybe that's some Cygwin specific version of libm for complex? and md would be for double?
Maybe.  Do the files in question actually test ok on your Cygwin without this `libmc`?


---

Comment by kcrisman created at 2012-12-14 16:22:15

> As to whether it works... I have no way of checking this on Windows 7.  I don't even have this problem on XP, though I will try to check that it's not evil.  How do I see whether my Cygwin has "mc" somehow?

When I do this, I don't find it, or `md`, for that matter:

```
$ls /cygdrive/c/cygwin/lib/libm<tab>
libm.a
<irrelevant stuff>
```

and other directories with `lib` also have either nothing or at any rate nothing related, including not `libm`.

Anyway, this file passes some tests for me, though it gives a different answer for one of the algdep things and gives annoying errors about being unable to start pari because `gp --emacs --quiet --stacksize 1000000 failed`.   Is it possible that this is not possible to do in this (our Cygwin Sage) setup?  But it looks like the standard way for our pexpect interface, and doing this command by hand `./sage -gp ...` works fine.


---

Comment by jpflori created at 2012-12-14 17:24:48

I think the libm* problems are from the time the Cygwin's libm was not C99 compliant or something like that and we needed cephes at http://www.netlib.org/cephes/
See #9543 and #8780.

I think we should try to remove all the Cygwin specific mc and md things.


---

Comment by kcrisman created at 2012-12-14 18:15:16

> I think the libm* problems are from the time the Cygwin's libm was not C99 compliant or something like that and we needed cephes at http://www.netlib.org/cephes/
It's certainly possible.
> I think we should try to remove all the Cygwin specific mc and md things.
Let's please try to do this _after_ we get Sage to build on Cygwin reliably, though :)


---

Comment by jpflori created at 2012-12-17 09:53:49

Replying to [comment:14 kcrisman]:
> > I think the libm* problems are from the time the Cygwin's libm was not C99 compliant or something like that and we needed cephes at http://www.netlib.org/cephes/
> It's certainly possible.
> > I think we should try to remove all the Cygwin specific mc and md things.
> Let's please try to do this _after_ we get Sage to build on Cygwin reliably, though :)
So let's merge the ticket as is!
it needs review :)


---

Comment by kcrisman created at 2012-12-17 17:55:19

> So let's merge the ticket as is!
> it needs review :)
Fair enough, but it's hard for me to check whether I even _have_ these libraries.


---

Comment by kcrisman created at 2012-12-17 21:13:16

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2012-12-17 21:13:16

Just got past `complex_double.o` in compiling with this patch (it had been blocked at the algebras/letterplace stuff, so cleanly), so presumably the lack of the library isn't a problem.  I'll assume this is indeed necessary on Win 7, though if Dima could independently verify this it would be nice...


---

Comment by jpflori created at 2012-12-18 15:57:33

Wooo, I think we have to get back on this one and think a little more.
Indeed I spotted that the cephes spkg failed to install (although that was not detected properly...).
So we have to check two things:
- why the cephes spkg fails (if it succeeds, it will provide libmc and libmd),
- if the cephes spkg is really needed, indeed as I mentioned before, I think that the libm provided by Cygwin is now C99 compliant (enough) and cephes is not needed anymore (and I don't think keeping it in case one wants to build Sage on a very old Cygwin with a poor libm is any kind of justification).

So I think we should first:
- fix the cephes spkg.
Check it is not needed on Cygwin anymore, and if so:
- disable its installation on Cygwin,
- removed all Cygwin specific code involving libmc and libmd.


---

Comment by jpflori created at 2012-12-18 15:57:33

Changing status from positive_review to needs_work.


---

Comment by jpflori created at 2012-12-18 15:57:33

Changing keywords from "cygwin" to "cygwin cephes spkg".


---

Comment by jpflori created at 2012-12-18 15:58:57

In fact cephes is currently only used on Cygwin, so if it is not needed, it should be removed completely (and we could as well not waste time fixing it).


---

Comment by kcrisman created at 2012-12-18 16:01:37

> In fact cephes is currently only used on Cygwin, so if it is not needed, it should be removed completely (and we could as well not waste time fixing it).

That's not quite correct - see #9543.  So I would be happy to disable it on Cygwin, but not in general.

I agree that we should only support the newest Cygwin, given that this would primarily be used in binary form.


---

Comment by jpflori created at 2012-12-18 16:06:25

I remember of #9543, but I worte my previous post after reading the first lines of spkg-install which states that is only installed on Cygwin :)
I've not looked further or at #9543 again to gather more information.


---

Comment by jpflori created at 2012-12-18 16:11:43

Indeed there is no error checking at all in the spkg-install script and it is only installed on Cygwin.

#9543 is two years old, potentially the FreeBSD libm has gotten better since then just as the Cygwin one?


---

Comment by jpflori created at 2012-12-18 16:33:53

http://freebsd.1045724.n5.nabble.com/Use-of-C99-extra-long-double-math-functions-after-r236148-td5712748.html
might be of interest for FreeBSD.


---

Comment by kcrisman created at 2012-12-18 16:53:34

No, see [this FreeBSD port patch](http://www.freebsd.org/cgi/cvsweb.cgi/ports/math/sage/files/spkg-patch-cephes_-_big-patch?annotate=1.1) which is basically #9543's patch and which afaik is definitely still needed on FreeBSD.  I'll put that link on #9543, though, in case it turns out to be useful.


---

Comment by jpflori created at 2012-12-19 10:44:18

New version completly discarding Cephes use on Cygwin.


---

Attachment

Here comes a new patches discarding any Cephes reference on Cygwin.


---

Comment by kcrisman created at 2012-12-19 16:18:06

This seems to work fine with `./sage -ba` on Cygwin.  Interesting that we never actually installed Cephes - do I understand you correctly?


---

Comment by jpflori created at 2012-12-19 16:20:21

I think you did install it, or the installation would have failed as for me.
It is maybe 7 specific.
Can you check for "$SAGE_LOCAL/lib/libm[c|d].a" ?

But what you just pointed out and confirmed is that linking to these files (and so installing Cephes) is not needed anymore on Cygwin.


---

Comment by kcrisman created at 2012-12-19 16:29:58

> I think you did install it, or the installation would have failed as for me.
> It is maybe 7 specific.
> Can you check for "$SAGE_LOCAL/lib/libm[c|d].a" ?
Oh, that's where they lived!  Yes, they are there.
> But what you just pointed out and confirmed is that linking to these files (and so installing Cephes) is not needed anymore on Cygwin.
Agreed.

Patchbot, apply trac_13806.2.patch


---

Comment by jpflori created at 2012-12-20 14:24:58

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2012-12-20 18:19:06

Dumb question:  Even though this patch worked fine, there seems to be an extraneous comma.

```
'sage/ext/interpreters/interp_cdf.c'],), 
```

in the new code.  I assume that as usual Python tuples can end with commas, so it doesn't affect anything, but it looks a little silly, like

```
sage: integrate(x^2,x,)
1/3*x^3
```



---

Comment by kcrisman created at 2013-01-03 19:53:13

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2013-01-03 19:53:13

> Dumb question:  Even though this patch worked fine, there seems to be an extraneous comma.
Well, who cares?  It is valid syntax.  I don't want to hold this up.


---

Comment by jdemeyer created at 2013-01-07 20:56:28

Resolution: fixed
