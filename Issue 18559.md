# Issue 18559: Python 3 preparation: Cleaning up the bit rot that occurred  to a number of Python fixes

archive/issues_018559.json:
```json
{
    "body": "Keywords: python3\n\nA number of the Python 3 tickets that are tracked in #15980 and that had been closed have to be addressed again: instances of the migration problems that they fixed have surfaced again.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18796\n\n",
    "created_at": "2015-06-26T17:30:15Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Python 3 preparation: Cleaning up the bit rot that occurred  to a number of Python fixes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18559",
    "user": "wluebbe"
}
```
Keywords: python3

A number of the Python 3 tickets that are tracked in #15980 and that had been closed have to be addressed again: instances of the migration problems that they fixed have surfaced again.

Issue created by migration from https://trac.sagemath.org/ticket/18796





---

archive/issue_comments_252419.json:
```json
{
    "body": "These first 5 commits follow up the tickets (again using `2to3`:\n#15982 Change the syntax of the except clause   `2to3 -w -f except src/sage`\n#16067 Semantic of filter() function changed   `2to3 -w -f filter src/sage`\n#15983 Sames of some function attributes   `2to3 -w -f funcattrs src/sage`\n#15784 Use `in` instead of `has_key()`   `2to3 -w -f has_key src/sage`\n#15984 Use more modern Python idioms   `2to3 -w -f idioms src/sage`\n\nI had to backout the proposed change for `src/sage/game_theory/normal_form_game.py` (see also the 4 reverted modules mentioned in #15984).\n----\nNew commits:",
    "created_at": "2015-06-27T13:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252419",
    "user": "wluebbe"
}
```

These first 5 commits follow up the tickets (again using `2to3`:
#15982 Change the syntax of the except clause   `2to3 -w -f except src/sage`
#16067 Semantic of filter() function changed   `2to3 -w -f filter src/sage`
#15983 Sames of some function attributes   `2to3 -w -f funcattrs src/sage`
#15784 Use `in` instead of `has_key()`   `2to3 -w -f has_key src/sage`
#15984 Use more modern Python idioms   `2to3 -w -f idioms src/sage`

I had to backout the proposed change for `src/sage/game_theory/normal_form_game.py` (see also the 4 reverted modules mentioned in #15984).
----
New commits:



---

archive/issue_comments_252420.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-27T16:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252420",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252421.json:
```json
{
    "body": "The next 5 commits follow up these tickets\n#15986 - Change names of some method attributes   `2to3 -w -f methodattrs src/sage`\n#15743 - <> is not Python 3 compatible   `2to3 -w -f ne src/sage`\n#15990 - Change syntax of raise statement  `2to3 -w -f raise src/sage`\n#16078 - reduce() is no more a builtin function  `2to3 -w -f reduce src/sage`\n#15993 - Remove implicit tuple parameter unpacking  `2to3 -w -f tuple_params src/sage`\n\nThree proposed module changes by `raise` involve raise `with_traceback()`:\n`src/sage/interfaces/expect.py`\n`src/sage/interfaces/singular.py`\n`src/sage/sage/schemes/elliptic_curves/ell_number_field.py`\nThis requires the use of a compatibility library and therefor belongs to stage 2 (see meta-ticket #16052). This 3 modules will be handled in a separate ticket #18799.",
    "created_at": "2015-06-27T17:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252421",
    "user": "wluebbe"
}
```

The next 5 commits follow up these tickets
#15986 - Change names of some method attributes   `2to3 -w -f methodattrs src/sage`
#15743 - <> is not Python 3 compatible   `2to3 -w -f ne src/sage`
#15990 - Change syntax of raise statement  `2to3 -w -f raise src/sage`
#16078 - reduce() is no more a builtin function  `2to3 -w -f reduce src/sage`
#15993 - Remove implicit tuple parameter unpacking  `2to3 -w -f tuple_params src/sage`

Three proposed module changes by `raise` involve raise `with_traceback()`:
`src/sage/interfaces/expect.py`
`src/sage/interfaces/singular.py`
`src/sage/sage/schemes/elliptic_curves/ell_number_field.py`
This requires the use of a compatibility library and therefor belongs to stage 2 (see meta-ticket #16052). This 3 modules will be handled in a separate ticket #18799.



---

archive/issue_comments_252422.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-27T17:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252422",
    "user": "wluebbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_252423.json:
```json
{
    "body": "Please fix the formatting of\n\n```\nif    ( isinstance(self, type(other))\\\n            and self._ambient_space_functor == other._ambient_space_functor\\\n            and self._generators            == other._generators ):\n```\n\nand others in `src/sage/modular/modform_hecketriangle/functors.py`.\n`\\` is not necessary.",
    "created_at": "2015-06-28T01:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252423",
    "user": "aapitzsch"
}
```

Please fix the formatting of

```
if    ( isinstance(self, type(other))\
            and self._ambient_space_functor == other._ambient_space_functor\
            and self._generators            == other._generators ):
```

and others in `src/sage/modular/modform_hecketriangle/functors.py`.
`\` is not necessary.



---

archive/issue_comments_252424.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-28T01:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252424",
    "user": "aapitzsch"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_252425.json:
```json
{
    "body": "Why do you replace\n\n```\ntype(self) == type(other)\n```\n\nby\n\n```\nisinstance(self, type(other))\n```\n\nThat doesn't seem correct (the 2 are certainly not equivalent)",
    "created_at": "2015-06-28T08:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252425",
    "user": "jdemeyer"
}
```

Why do you replace

```
type(self) == type(other)
```

by

```
isinstance(self, type(other))
```

That doesn't seem correct (the 2 are certainly not equivalent)



---

archive/issue_comments_252426.json:
```json
{
    "body": "Replying to [comment:5 aapitzsch]:\n> Please fix the formatting of\n...\n> and others in `src/sage/modular/modform_hecketriangle/functors.py`.\n> `\\` is not necessary.\nThe change was generated by `2to3 -w -f idioms src/sage`. I did not change any formatting here as in some previous Python3 ticket I was asked by the reviewer to undo those improvements as they were not strictly required by the task at hand. I complied :-/\n\nI agree that the mentioned code is not pretty and not quite PEP8 compliant.\nBut before fixing it I'd like to discuss comment:6.",
    "created_at": "2015-06-28T09:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252426",
    "user": "wluebbe"
}
```

Replying to [comment:5 aapitzsch]:
> Please fix the formatting of
...
> and others in `src/sage/modular/modform_hecketriangle/functors.py`.
> `\` is not necessary.
The change was generated by `2to3 -w -f idioms src/sage`. I did not change any formatting here as in some previous Python3 ticket I was asked by the reviewer to undo those improvements as they were not strictly required by the task at hand. I complied :-/

I agree that the mentioned code is not pretty and not quite PEP8 compliant.
But before fixing it I'd like to discuss comment:6.



---

archive/issue_comments_252427.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Why do you replace\n> ...\nAll the changes were generated by `2to3 -w -f idioms src/sage`.\n\nWhile `type(self) == type(other)` means strict type identity the expression `isinstance(self, type(other))` allows subclasses. The Python documentation (https://docs.python.org/2.7/library/functions.html?highlight=type#type) says: //The isinstance() built-in function is recommended for testing the type of an object.//\n\nThere was one generated change (see comment:1) that I reverted because of failing doctests. Failing of doctests was the only method I used to determine that the change was not correct. I have no deep understanding of the code.\n\nTherefor one can reason that without more insight all changes from `type()` to `isinstance()` should be reverted.\nOr to keep them until proved guilty.\n\nRemark: In ticket #15984 we made a large number of such changes supported by the same reasoning. This was in Sage 6.2 15 month ago. So there is some evidence that the approach is reasonable.",
    "created_at": "2015-06-28T09:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252427",
    "user": "wluebbe"
}
```

Replying to [comment:6 jdemeyer]:
> Why do you replace
> ...
All the changes were generated by `2to3 -w -f idioms src/sage`.

While `type(self) == type(other)` means strict type identity the expression `isinstance(self, type(other))` allows subclasses. The Python documentation (https://docs.python.org/2.7/library/functions.html?highlight=type#type) says: //The isinstance() built-in function is recommended for testing the type of an object.//

There was one generated change (see comment:1) that I reverted because of failing doctests. Failing of doctests was the only method I used to determine that the change was not correct. I have no deep understanding of the code.

Therefor one can reason that without more insight all changes from `type()` to `isinstance()` should be reverted.
Or to keep them until proved guilty.

Remark: In ticket #15984 we made a large number of such changes supported by the same reasoning. This was in Sage 6.2 15 month ago. So there is some evidence that the approach is reasonable.



---

archive/issue_comments_252428.json:
```json
{
    "body": "Replying to [comment:8 wluebbe]:\n> I have no deep understanding of the code.\nYou should really never make changes that you don't understand.\n\n> Therefor one can reason that without more insight all changes from `type()` to `isinstance()` should be reverted.\nIndeed.",
    "created_at": "2015-06-28T10:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252428",
    "user": "jdemeyer"
}
```

Replying to [comment:8 wluebbe]:
> I have no deep understanding of the code.
You should really never make changes that you don't understand.

> Therefor one can reason that without more insight all changes from `type()` to `isinstance()` should be reverted.
Indeed.



---

archive/issue_comments_252429.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-29T06:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252429",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252430.json:
```json
{
    "body": "This commit undoes the changes from `type()` to `isinstance()` in the 6 affected modules. \n\nI recommend not to employ `2to3 -w -f idioms src/sage` anymore since those changes not essential to Py3 compatibility and not always correct. But they improve the code if used with sufficient care.",
    "created_at": "2015-06-29T06:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252430",
    "user": "wluebbe"
}
```

This commit undoes the changes from `type()` to `isinstance()` in the 6 affected modules. 

I recommend not to employ `2to3 -w -f idioms src/sage` anymore since those changes not essential to Py3 compatibility and not always correct. But they improve the code if used with sufficient care.



---

archive/issue_comments_252431.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-29T06:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252431",
    "user": "wluebbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_252432.json:
```json
{
    "body": "`(x_y[0],x_y[1])` is just `x_y`",
    "created_at": "2015-06-29T18:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252432",
    "user": "jdemeyer"
}
```

`(x_y[0],x_y[1])` is just `x_y`



---

archive/issue_comments_252433.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-29T18:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252433",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_252434.json:
```json
{
    "body": "Don't remove comments like `# make sure that the first two columns are \"11, 12, ..., 1n, 21, 22, ...\"`",
    "created_at": "2015-06-29T18:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252434",
    "user": "jdemeyer"
}
```

Don't remove comments like `# make sure that the first two columns are "11, 12, ..., 1n, 21, 22, ..."`



---

archive/issue_comments_252435.json:
```json
{
    "body": "If you're changing `func_code` to `__code__`, you also need to change\n\n```\nhasattr(obj, 'func_code')\n```\n\nto\n\n```\nhasattr(obj, '__code__')\n```\n",
    "created_at": "2015-06-29T18:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252435",
    "user": "jdemeyer"
}
```

If you're changing `func_code` to `__code__`, you also need to change

```
hasattr(obj, 'func_code')
```

to

```
hasattr(obj, '__code__')
```




---

archive/issue_comments_252436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-01T13:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252436",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252437.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-01T13:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252437",
    "user": "wluebbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_252438.json:
```json
{
    "body": "* Changed `(x_y[0],x_y[1])` in `bidb.py`\n* Added removed comment in `latin_squares.py`\n- Changed `func_code` in `sageinspect.py`\n- Changed `has_key` in `integrable_representations.py`\n- Changed type equality tests into type identity tests in `functors.py`, `graded_ring_element.py` and `display_manager.py`. This similar to #18809.\n- Stripped lots of trailing whitespace in `display_manager.py`",
    "created_at": "2015-07-01T13:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252438",
    "user": "wluebbe"
}
```

* Changed `(x_y[0],x_y[1])` in `bidb.py`
* Added removed comment in `latin_squares.py`
- Changed `func_code` in `sageinspect.py`
- Changed `has_key` in `integrable_representations.py`
- Changed type equality tests into type identity tests in `functors.py`, `graded_ring_element.py` and `display_manager.py`. This similar to #18809.
- Stripped lots of trailing whitespace in `display_manager.py`



---

archive/issue_comments_252439.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-14T12:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252439",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_252440.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-15T08:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18559#issuecomment-252440",
    "user": "vbraun"
}
```

Resolution: fixed
