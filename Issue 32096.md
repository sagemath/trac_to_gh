# Issue 32096: change_default_prec as a replacement for the deprecated set_default_prec

Issue created by migration from https://trac.sagemath.org/ticket/32333

Original creator: @ThibautVerron

Original creation time: 2021-08-04 15:48:28

CC:  slelievre

Keywords: series precision

In http://trac.sagemath.org/18416, the method `set_default_prec` of power series rings was marked deprecated, and the warning states that the default precision should be set at construction. This was done before in #16201 for Laurent series.

The point of those changes was to ensure that power series and Laurent series rings are immutable.

I suggest to replace `set_default_prec` with a method `change_default_prec`, which would return a copy of `self` with the wanted precision. It would be similar to how `change_ring` works, for example.

For an application, see the following example:


```
sage: Pow.<x> = PowerSeriesRing(QQ, default_prec=5)
sage: Laur = Pow.fraction_field()
sage: f = Pow(1).add_bigoh(100); f
1 + O(x^100)
sage: f.parent()(1/(1+x))*f # forgetting about the ring Laur
1 - x + x^2 - x^3 + x^4 + O(x^5)
```


To get the correct precision, one would need something like


```
sage: R = f.parent() 
sage: S = PowerSeriesRing(R.base_ring(),R.gen(),default_prec=100)
sage: S = S.fraction_field() 
sage: S(1/(1+x))*f  
1 - x + x^2 - x^3 + x^4 + ... + x^99 + O(x^100)
```


The idea would be to replace that with:


```
sage: S = f.parent().change_default_prec(100)
sage: S(1/(1+x))*f  
1 - x + x^2 - x^3 + x^4 + ... + x^99 + O(x^100)
```



---

Comment by @ThibautVerron created at 2021-08-18 13:56:06

Changing status from new to needs_review.


---

Comment by @ThibautVerron created at 2021-08-18 13:56:06

New commits:


---

Comment by tscrim created at 2021-08-23 00:14:02

I agree that we should have this feature, but I don't think we should call `__copy__`. Instead, we should pass the relevant information onto the constructor so that it properly creates an object normally (in particular, if it uses a cache such as `UniqueRepresentation`). This means that classes implementing this will likely need to implement it themselves (with a generic implementation perhaps raising a `NotImplementedError`).

Also, I don't think you should rely on the fraction field of a power series ring being the Laurent polynomial ring. It is not true that `ZZ((x))` is the fraction field of `ZZ[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)`.


---

Comment by tscrim created at 2021-08-23 00:14:02

Changing status from needs_review to needs_work.


---

Comment by @ThibautVerron created at 2021-08-23 11:52:01

Thanks for the comments!


> I agree that we should have this feature, but I don't think we should call __copy__

Oh, right, that didn't work. 


> This means that classes implementing this will likely need to implement it themselves

Okay, I made the changes and I added implementations for power series (univariate and multivariate) and Laurent series. I tried to pass all relevant parameters to the constructor, but some are just lost after the initialization (for instance `implementation`). `change_var` and `change_ring` do not seem to care, so I guess if it is a problem, it's a problem for another ticket?


> It is not true that `ZZ((x))` is the fraction field of `ZZ[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)`.

Oops.


---

Comment by git created at 2021-08-23 11:52:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-08-25 04:28:07

Replying to [comment:6 gh-ThibautVerron]:
> Thanks for the comments!

Thank you for the changes.

> Okay, I made the changes and I added implementations for power series (univariate and multivariate) and Laurent series. I tried to pass all relevant parameters to the constructor, but some are just lost after the initialization (for instance `implementation`). `change_var` and `change_ring` do not seem to care, so I guess if it is a problem, it's a problem for another ticket?

Yes, I agree that it should be left for another ticket. Likely some additional information is needed to be stored and passed along.
