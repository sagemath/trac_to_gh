# Issue 10982: Mercurial spkg should install an hgrc which turns on git-style diffs

archive/issues_010982.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @gvol\n\nKeywords: mercurial, git, diff, patches\n\nAs above. See some discussion at [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/f5a9c012f6299a9e).\n\nIssue created by migration from https://trac.sagemath.org/ticket/11121\n\n",
    "created_at": "2011-04-04T08:45:26Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Mercurial spkg should install an hgrc which turns on git-style diffs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10982",
    "user": "https://github.com/kini"
}
```
Assignee: tbd

CC:  @gvol

Keywords: mercurial, git, diff, patches

As above. See some discussion at [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/f5a9c012f6299a9e).

Issue created by migration from https://trac.sagemath.org/ticket/11121





---

archive/issue_comments_118884.json:
```json
{
    "body": "These patches set the default diff format to git's new diffs (as opposed to the default which is the old unified diff spec) and add some (IMHO) very useful extensions to the default hgrc. Any comments / suggestions?",
    "created_at": "2011-04-04T11:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118884",
    "user": "https://github.com/kini"
}
```

These patches set the default diff format to git's new diffs (as opposed to the default which is the old unified diff spec) and add some (IMHO) very useful extensions to the default hgrc. Any comments / suggestions?



---

archive/issue_comments_118885.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-04T11:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118885",
    "user": "https://github.com/kini"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_118886.json:
```json
{
    "body": "By the way, I also added a comment to the top of $SAGE_LOCAL/bin/sage-spkg-install explaining what it's for, and changed its file permissions to make it non-executable (it becomes executable when turning into spkg-install in the various SPKGs it's a template installer for, anyway).",
    "created_at": "2011-04-04T15:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118886",
    "user": "https://github.com/kini"
}
```

By the way, I also added a comment to the top of $SAGE_LOCAL/bin/sage-spkg-install explaining what it's for, and changed its file permissions to make it non-executable (it becomes executable when turning into spkg-install in the various SPKGs it's a template installer for, anyway).



---

archive/issue_comments_118887.json:
```json
{
    "body": "1. Dumb question: Isn't this patch going to make it so every time one installs the mercurial spkg, \n\n```\n[diff]\ngit = true\n```\n\ngets appended to $TARGET/.hg/hgrc?    If one upgrades, hence install mercurial multiple times, this seems very bad.\n\n2. Same remark about $SAGE_LOCAL/etc/mercurial/hgrc.",
    "created_at": "2011-04-04T17:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118887",
    "user": "https://github.com/williamstein"
}
```

1. Dumb question: Isn't this patch going to make it so every time one installs the mercurial spkg, 

```
[diff]
git = true
```

gets appended to $TARGET/.hg/hgrc?    If one upgrades, hence install mercurial multiple times, this seems very bad.

2. Same remark about $SAGE_LOCAL/etc/mercurial/hgrc.



---

archive/issue_comments_118888.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-04T17:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118888",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_118889.json:
```json
{
    "body": "Nope, it's `>` rather than `>>` so it overwrites the file rather than appending.",
    "created_at": "2011-04-04T17:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118889",
    "user": "https://github.com/kini"
}
```

Nope, it's `>` rather than `>>` so it overwrites the file rather than appending.



---

archive/issue_comments_118890.json:
```json
{
    "body": "Were there any other work issues? If not I'll set this back to \"needs review\" but of course feel free to revert it again...",
    "created_at": "2011-04-04T18:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118890",
    "user": "https://github.com/kini"
}
```

Were there any other work issues? If not I'll set this back to "needs review" but of course feel free to revert it again...



---

archive/issue_comments_118891.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-04T18:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118891",
    "user": "https://github.com/kini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_118892.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-04T19:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118892",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_118893.json:
```json
{
    "body": "I don't think the patch to the `$SAGE_ROOT/local/bin` is doing what you want.  The file being patched there is just the spkg-install file for the scripts repository; it's not a template for general spkg-install files.  (So if nothing else, your new comment at the top of the file should be changed or deleted.) If you want to patch other spkg-install files, you'll have to patch each repository -- the Sage library, extcode, and sagenb -- individually.",
    "created_at": "2011-04-04T19:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118893",
    "user": "https://github.com/jhpalmieri"
}
```

I don't think the patch to the `$SAGE_ROOT/local/bin` is doing what you want.  The file being patched there is just the spkg-install file for the scripts repository; it's not a template for general spkg-install files.  (So if nothing else, your new comment at the top of the file should be changed or deleted.) If you want to patch other spkg-install files, you'll have to patch each repository -- the Sage library, extcode, and sagenb -- individually.



---

archive/issue_comments_118894.json:
```json
{
    "body": "Wow, I'm not sure how I screwed that one up so badly... d'oh. You are absolutely right. I'll upload new patches tomorrow - thanks for the pointer!",
    "created_at": "2011-04-04T20:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118894",
    "user": "https://github.com/kini"
}
```

Wow, I'm not sure how I screwed that one up so badly... d'oh. You are absolutely right. I'll upload new patches tomorrow - thanks for the pointer!



---

archive/issue_comments_118895.json:
```json
{
    "body": "Attachment [trac_11121-hgrc.data-extcode.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.data-extcode.patch) by @kini created at 2011-04-05 08:09:27\n\napply to $SAGE_ROOT/data/extcode",
    "created_at": "2011-04-05T08:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118895",
    "user": "https://github.com/kini"
}
```

Attachment [trac_11121-hgrc.data-extcode.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.data-extcode.patch) by @kini created at 2011-04-05 08:09:27

apply to $SAGE_ROOT/data/extcode



---

archive/issue_comments_118896.json:
```json
{
    "body": "Attachment [trac_11121-hgrc.devel-sagenb.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.devel-sagenb.patch) by @kini created at 2011-04-05 08:13:08\n\napply to $SAGE_ROOT/devel/sagenb",
    "created_at": "2011-04-05T08:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118896",
    "user": "https://github.com/kini"
}
```

Attachment [trac_11121-hgrc.devel-sagenb.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.devel-sagenb.patch) by @kini created at 2011-04-05 08:13:08

apply to $SAGE_ROOT/devel/sagenb



---

archive/issue_comments_118897.json:
```json
{
    "body": "Attachment [trac_11121-hgrc.local-bin.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.local-bin.patch) by @kini created at 2011-04-05 08:13:34\n\napply to $SAGE_ROOT/local/bin",
    "created_at": "2011-04-05T08:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118897",
    "user": "https://github.com/kini"
}
```

Attachment [trac_11121-hgrc.local-bin.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.local-bin.patch) by @kini created at 2011-04-05 08:13:34

apply to $SAGE_ROOT/local/bin



---

archive/issue_comments_118898.json:
```json
{
    "body": "nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.",
    "created_at": "2011-04-05T10:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118898",
    "user": "https://github.com/dimpase"
}
```

nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.



---

archive/issue_comments_118899.json:
```json
{
    "body": "... OK, I very apparently don't know what I'm doing. I'll do some more poking around and learning before marking this needs_review again... sorry for the email spam.",
    "created_at": "2011-04-05T11:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118899",
    "user": "https://github.com/kini"
}
```

... OK, I very apparently don't know what I'm doing. I'll do some more poking around and learning before marking this needs_review again... sorry for the email spam.



---

archive/issue_comments_118900.json:
```json
{
    "body": "Replying to [comment:12 dimpase]:\n> nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.\n\n`$SAGE_ROOT/local/bin` is the Sage scripts repo, so it's fine to patch it.  Or maybe I don't understand your complaint.\n\nKini, do you also want to patch the Sage root repo?  Its spkg-install file is `SAGE_ROOT/spkg/root-spkg-install`.",
    "created_at": "2011-04-05T14:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118900",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:12 dimpase]:
> nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.

`$SAGE_ROOT/local/bin` is the Sage scripts repo, so it's fine to patch it.  Or maybe I don't understand your complaint.

Kini, do you also want to patch the Sage root repo?  Its spkg-install file is `SAGE_ROOT/spkg/root-spkg-install`.



---

archive/issue_comments_118901.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> Replying to [comment:12 dimpase]:\n> > nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.\n> \n> `$SAGE_ROOT/local/bin` is the Sage scripts repo, so it's fine to patch it.  Or maybe I don't understand your complaint.\n> \nmy bad, I didn't know that some parts of local/bin are actually in the scripts spkg...",
    "created_at": "2011-04-05T14:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118901",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:14 jhpalmieri]:
> Replying to [comment:12 dimpase]:
> > nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.
> 
> `$SAGE_ROOT/local/bin` is the Sage scripts repo, so it's fine to patch it.  Or maybe I don't understand your complaint.
> 
my bad, I didn't know that some parts of local/bin are actually in the scripts spkg...



---

archive/issue_comments_118902.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> Replying to [comment:12 dimpase]:\n> > nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.\n> \n> `$SAGE_ROOT/local/bin` is the Sage scripts repo, so it's fine to patch it.  Or maybe I don't understand your complaint.\n> \n> Kini, do you also want to patch the Sage root repo?  Its spkg-install file is `SAGE_ROOT/spkg/root-spkg-install`.\n\nGot it. Yes, I'll do that...",
    "created_at": "2011-04-06T17:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118902",
    "user": "https://github.com/kini"
}
```

Replying to [comment:14 jhpalmieri]:
> Replying to [comment:12 dimpase]:
> > nothing must be done to local/bin in your patches, which doesn't even exist in a source distribution. You need to patch the source instead.
> 
> `$SAGE_ROOT/local/bin` is the Sage scripts repo, so it's fine to patch it.  Or maybe I don't understand your complaint.
> 
> Kini, do you also want to patch the Sage root repo?  Its spkg-install file is `SAGE_ROOT/spkg/root-spkg-install`.

Got it. Yes, I'll do that...



---

archive/issue_comments_118903.json:
```json
{
    "body": "Attachment [trac_11121-hgrc.sage.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.sage.patch) by @kini created at 2011-04-06 17:25:21\n\napply to $SAGE_ROOT",
    "created_at": "2011-04-06T17:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118903",
    "user": "https://github.com/kini"
}
```

Attachment [trac_11121-hgrc.sage.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.sage.patch) by @kini created at 2011-04-06 17:25:21

apply to $SAGE_ROOT



---

archive/issue_comments_118904.json:
```json
{
    "body": "Trying out `sage-sdist` I find that making `hg diff` go to a pager by default might screw up some of the scripts (or at the very least cause them to become interactive when they shouldn't be). This is bad, but should I make `hg diff` not go to a pager by default, or just stick a `--pager=` on any usages of `hg diff` in scripts? Paging diffs is a really nice feature that I think should be standard, but on the other hand it seems a bit intrusive to have to explicitly specify `--pager=` in a script.\n\nThen again, why are we even running `hg diff` in scripts? All the examples of this I could find were either just standalone lines running `hg diff`, or, in one case, `local/bin/sage-pkg`, an attempt to figure out whether uncommitted changes existed in the directory (which could just as easily be done by searching `$(hg summary)` for \"(clean)\", if I'm not mistaken.\n\nAny comments?",
    "created_at": "2011-04-06T19:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118904",
    "user": "https://github.com/kini"
}
```

Trying out `sage-sdist` I find that making `hg diff` go to a pager by default might screw up some of the scripts (or at the very least cause them to become interactive when they shouldn't be). This is bad, but should I make `hg diff` not go to a pager by default, or just stick a `--pager=` on any usages of `hg diff` in scripts? Paging diffs is a really nice feature that I think should be standard, but on the other hand it seems a bit intrusive to have to explicitly specify `--pager=` in a script.

Then again, why are we even running `hg diff` in scripts? All the examples of this I could find were either just standalone lines running `hg diff`, or, in one case, `local/bin/sage-pkg`, an attempt to figure out whether uncommitted changes existed in the directory (which could just as easily be done by searching `$(hg summary)` for "(clean)", if I'm not mistaken.

Any comments?



---

archive/issue_comments_118905.json:
```json
{
    "body": "I'm a little wary of changing the default behavior in so many ways.  In general, wouldn't it be good enough to point to the [Mercurial extensions page](http://mercurial.selenic.com/wiki/UsingExtensions) and let people pick for themselves?  Or we could recommend some good choices.  We could do this in the developer's guide, when we discuss using Mercurial.  I guess it seems that enabling these extensions reflects the opinions of a few people, and it might be safer to just implement a few important changes (like git=true).  Anyway, here are some of my questions and opinions:\n\n```\n[trusted] \nusers = $USER     is this necessary?  what happens if we leave this out?\n\n[diff] \ngit = true        seems like a good idea\n\n[extensions] \ncolor =           innocuous\ngraphlog =        innocuous, but should it be \"hgext.graphlog=\"?  That's what the docs say.\nmq =              useful, keep it\npager =           see my comments below.\nprogress =        innocuous\npurge =           should this be \"hgext.purge=\"?  provides a potentially useful, but potentially dangerous, command\nrebase =          seems okay, but I've never used it\nrecord =          \"hgext.record=\"?\nrelink =          seems okay, but never used it\ntransplant =      seems okay, but never used it\n```\n\nRegarding \"pager\": first, should we follow the [Mercurial suggestions](http://mercurial.selenic.com/wiki/PagerExtension) and do\n\n```\n[pager]\npager = LESS='FSRX' less\n```\n\nSecond, if we use the pager extension, will it interfere with Sage functions like `hg_sage.diff()`?  These are defined in SAGE_ROOT/devel/sage/sage/misc/hg.py, and they call a pager already, a different one depending on whether working from the command-line or in the notebook.",
    "created_at": "2011-04-06T19:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118905",
    "user": "https://github.com/jhpalmieri"
}
```

I'm a little wary of changing the default behavior in so many ways.  In general, wouldn't it be good enough to point to the [Mercurial extensions page](http://mercurial.selenic.com/wiki/UsingExtensions) and let people pick for themselves?  Or we could recommend some good choices.  We could do this in the developer's guide, when we discuss using Mercurial.  I guess it seems that enabling these extensions reflects the opinions of a few people, and it might be safer to just implement a few important changes (like git=true).  Anyway, here are some of my questions and opinions:

```
[trusted] 
users = $USER     is this necessary?  what happens if we leave this out?

[diff] 
git = true        seems like a good idea

[extensions] 
color =           innocuous
graphlog =        innocuous, but should it be "hgext.graphlog="?  That's what the docs say.
mq =              useful, keep it
pager =           see my comments below.
progress =        innocuous
purge =           should this be "hgext.purge="?  provides a potentially useful, but potentially dangerous, command
rebase =          seems okay, but I've never used it
record =          "hgext.record="?
relink =          seems okay, but never used it
transplant =      seems okay, but never used it
```

Regarding "pager": first, should we follow the [Mercurial suggestions](http://mercurial.selenic.com/wiki/PagerExtension) and do

```
[pager]
pager = LESS='FSRX' less
```

Second, if we use the pager extension, will it interfere with Sage functions like `hg_sage.diff()`?  These are defined in SAGE_ROOT/devel/sage/sage/misc/hg.py, and they call a pager already, a different one depending on whether working from the command-line or in the notebook.



---

archive/issue_comments_118906.json:
```json
{
    "body": "Actually, let me revise one comment: the \"color\" extension is not innocuous: when it's enabled, the output from \"hg_sage.status()\" in the notebook has stray characters, presumably coming from the ASCII color-changing codes.  It looks like this:\n\n```\nGetting status of modified or unknown files:\ncd \"/Applications/sage/devel/sage\" && hg status\n[0;34;1mM sage/algebras/steenrod_algebra_bases.py[0m\n```\n\nThe last line should be\n\n```\nM sage/algebras/steenrod_algebra_bases.py\n```\n\nOn the other hand, with the color extension enabled, the output looks good from the command line.  So if we want to use color, we should have separate hgrc files, one for the notebook and one for the command-line. \n\nI'm a little suspicious of enabling some of the others of these in the notebook, for example \"progress\".  On the bright side, enabling \"pager\" doesn't seem to have any detrimental effect in the notebook.",
    "created_at": "2011-04-06T20:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118906",
    "user": "https://github.com/jhpalmieri"
}
```

Actually, let me revise one comment: the "color" extension is not innocuous: when it's enabled, the output from "hg_sage.status()" in the notebook has stray characters, presumably coming from the ASCII color-changing codes.  It looks like this:

```
Getting status of modified or unknown files:
cd "/Applications/sage/devel/sage" && hg status
[0;34;1mM sage/algebras/steenrod_algebra_bases.py[0m
```

The last line should be

```
M sage/algebras/steenrod_algebra_bases.py
```

On the other hand, with the color extension enabled, the output looks good from the command line.  So if we want to use color, we should have separate hgrc files, one for the notebook and one for the command-line. 

I'm a little suspicious of enabling some of the others of these in the notebook, for example "progress".  On the bright side, enabling "pager" doesn't seem to have any detrimental effect in the notebook.



---

archive/issue_comments_118907.json:
```json
{
    "body": "See #11142 for a way to deal with the \"pager\" and \"color\" issues.  With the patch there, we should definitely turn on the pager extension, and we can turn on the color extension without breaking anything in the notebook.",
    "created_at": "2011-04-06T22:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118907",
    "user": "https://github.com/jhpalmieri"
}
```

See #11142 for a way to deal with the "pager" and "color" issues.  With the patch there, we should definitely turn on the pager extension, and we can turn on the color extension without breaking anything in the notebook.



---

archive/issue_comments_118908.json:
```json
{
    "body": "John, thanks for your comments, and your fast work on #11142! I agree with you that most of the defaults set in my patch are just personal preference, but I did try to add all extensions that seemed relevant. Let me go down the list:\n\n* `users = $USER` is put there on the assumption that whoever is installing the mercurial SPKG will also be the owner of the files in the sage installation. All the other patches are applied towards creating .hgrc files in [repository root]`/.hg/hgrc`, which is not parsed when using mercurial unless the file is either owned by the same person as the person who is invoking `hg`, or the owner of [repository root]`/.hg/hgrc` is listed as a trusted user in some other hgrc file which HAS been read (such as this one, `$SAGE_ROOT/local/etc/mercurial/hgrc`.\n* `git = true` was the original point of this ticket :)\n* Prepending `hgext.` is apparently unnecessary in newer versions of Mercurial, says `#mercurial` on freenode. I was even invited to submit a patch to the man page for hgrc...\n  * `color` is nice on the commandline.\n  * `graphlog` is indispensable (imho) for seeing what exactly is going on with the history of a particular mercurial repository.\n  * `mq` is of course useful.\n  * `pager` is useful.\n  * `progress` is not really necessary - if it interferes with the notebook I guess it's better to get rid of it.\n  * `purge` is not all that important, but since it only adds a new command it shouldn't screw up anything else.\n  * `rebase` is great for rebasing mq patches on new versions of sage, something I'll need in order to fix #10988, I think.\n  * `record` is useful.\n  * `relink` seems nice for people who use `sage -clone`, though I don't use either myself.\n  * `transplant` seems to be useful in some way, but I've never used it either (maybe not that great of an idea to include, then.)\n* The suggestions for parameters to `less` given on the Mercurial wiki are also a matter of personal preference. By default, `less` doesn't leave anything in the terminal after it exits (it restores whatever was on the screen before you called it), but the `X` option disables this behavior. The `F` option also disables this behavior, in a sense, by acting like `cat` when the screen is large enough to take the entire output. The `S` option truncates long lines instead of wrapping them. The `R` option (which is in my patch) displays (ANSI) terminal color codes. My preference is still to just keep `R` of these four, but whoever wrote the Mercurial wiki article disagrees. It's not really possible to be that objective about this, I think...\n\nI'll go take a look at #11142.",
    "created_at": "2011-04-07T04:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118908",
    "user": "https://github.com/kini"
}
```

John, thanks for your comments, and your fast work on #11142! I agree with you that most of the defaults set in my patch are just personal preference, but I did try to add all extensions that seemed relevant. Let me go down the list:

* `users = $USER` is put there on the assumption that whoever is installing the mercurial SPKG will also be the owner of the files in the sage installation. All the other patches are applied towards creating .hgrc files in [repository root]`/.hg/hgrc`, which is not parsed when using mercurial unless the file is either owned by the same person as the person who is invoking `hg`, or the owner of [repository root]`/.hg/hgrc` is listed as a trusted user in some other hgrc file which HAS been read (such as this one, `$SAGE_ROOT/local/etc/mercurial/hgrc`.
* `git = true` was the original point of this ticket :)
* Prepending `hgext.` is apparently unnecessary in newer versions of Mercurial, says `#mercurial` on freenode. I was even invited to submit a patch to the man page for hgrc...
  * `color` is nice on the commandline.
  * `graphlog` is indispensable (imho) for seeing what exactly is going on with the history of a particular mercurial repository.
  * `mq` is of course useful.
  * `pager` is useful.
  * `progress` is not really necessary - if it interferes with the notebook I guess it's better to get rid of it.
  * `purge` is not all that important, but since it only adds a new command it shouldn't screw up anything else.
  * `rebase` is great for rebasing mq patches on new versions of sage, something I'll need in order to fix #10988, I think.
  * `record` is useful.
  * `relink` seems nice for people who use `sage -clone`, though I don't use either myself.
  * `transplant` seems to be useful in some way, but I've never used it either (maybe not that great of an idea to include, then.)
* The suggestions for parameters to `less` given on the Mercurial wiki are also a matter of personal preference. By default, `less` doesn't leave anything in the terminal after it exits (it restores whatever was on the screen before you called it), but the `X` option disables this behavior. The `F` option also disables this behavior, in a sense, by acting like `cat` when the screen is large enough to take the entire output. The `S` option truncates long lines instead of wrapping them. The `R` option (which is in my patch) displays (ANSI) terminal color codes. My preference is still to just keep `R` of these four, but whoever wrote the Mercurial wiki article disagrees. It's not really possible to be that objective about this, I think...

I'll go take a look at #11142.



---

archive/issue_comments_118909.json:
```json
{
    "body": "Attachment [trac_11121-hgrc.devel-sage.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.devel-sage.patch) by @kini created at 2011-06-14 00:27:07\n\napply to $SAGE_ROOT/devel/sage",
    "created_at": "2011-06-14T00:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118909",
    "user": "https://github.com/kini"
}
```

Attachment [trac_11121-hgrc.devel-sage.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.devel-sage.patch) by @kini created at 2011-06-14 00:27:07

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_118910.json:
```json
{
    "body": "I'm going to upgrade Mercurial to 1.8.4 and incorporate this and #11120 into the new spkg.",
    "created_at": "2011-06-14T00:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118910",
    "user": "https://github.com/kini"
}
```

I'm going to upgrade Mercurial to 1.8.4 and incorporate this and #11120 into the new spkg.



---

archive/issue_comments_118911.json:
```json
{
    "body": "Before you put too much effort into upgrading Mercurial, read [this comment](http://trac.sagemath.org/sage_trac/ticket/10594#comment:13).  Unless there is a strong argument for it, it looks like a new version of Mercurial isn't likely to get merged.",
    "created_at": "2011-06-14T00:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118911",
    "user": "https://github.com/jhpalmieri"
}
```

Before you put too much effort into upgrading Mercurial, read [this comment](http://trac.sagemath.org/sage_trac/ticket/10594#comment:13).  Unless there is a strong argument for it, it looks like a new version of Mercurial isn't likely to get merged.



---

archive/issue_comments_118912.json:
```json
{
    "body": "Replying to [comment:24 jhpalmieri]:\n> Before you put too much effort into upgrading Mercurial, read [this comment](http://trac.sagemath.org/sage_trac/ticket/10594#comment:13).  Unless there is a strong argument for it, it looks like a new version of Mercurial isn't likely to get merged.\n\nThanks for the heads up. I've packaged it already without any obvious trouble. I hope this doesn't mean we're going to be stuck with 1.6.4 forever? Surely we need to upgrade eventually. We're already two versions behind, soon to be three, a couple of weeks from now.",
    "created_at": "2011-06-14T01:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118912",
    "user": "https://github.com/kini"
}
```

Replying to [comment:24 jhpalmieri]:
> Before you put too much effort into upgrading Mercurial, read [this comment](http://trac.sagemath.org/sage_trac/ticket/10594#comment:13).  Unless there is a strong argument for it, it looks like a new version of Mercurial isn't likely to get merged.

Thanks for the heads up. I've packaged it already without any obvious trouble. I hope this doesn't mean we're going to be stuck with 1.6.4 forever? Surely we need to upgrade eventually. We're already two versions behind, soon to be three, a couple of weeks from now.



---

archive/issue_comments_118913.json:
```json
{
    "body": "Replying to [comment:21 kini]:\n> John, thanks for your comments, and your fast work on #11142! I agree with you that most of the defaults set in my patch are just personal preference, but I did try to add all extensions that seemed relevant. Let me go down the list:\n>\n\nI'm confused.  So does that mean that now anyone without a .hgrc file will automatically have all this?  \n\nIn that case, I agree that maybe just the things that are necessary should be fixed, and the rest left optional but well documented in the devel manual.",
    "created_at": "2011-06-14T03:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118913",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:21 kini]:
> John, thanks for your comments, and your fast work on #11142! I agree with you that most of the defaults set in my patch are just personal preference, but I did try to add all extensions that seemed relevant. Let me go down the list:
>

I'm confused.  So does that mean that now anyone without a .hgrc file will automatically have all this?  

In that case, I agree that maybe just the things that are necessary should be fixed, and the rest left optional but well documented in the devel manual.



---

archive/issue_comments_118914.json:
```json
{
    "body": "Yeah, I'll just leave git diffs, color and pager for #11142, and rebase and relink because they will be useful in automated scripts in the future.",
    "created_at": "2011-06-14T03:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118914",
    "user": "https://github.com/kini"
}
```

Yeah, I'll just leave git diffs, color and pager for #11142, and rebase and relink because they will be useful in automated scripts in the future.



---

archive/issue_comments_118915.json:
```json
{
    "body": "Er, sorry, and mq, of course.",
    "created_at": "2011-06-14T03:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118915",
    "user": "https://github.com/kini"
}
```

Er, sorry, and mq, of course.



---

archive/issue_comments_118916.json:
```json
{
    "body": "Attachment [trac_11121-hgrc.mercurial-spkg.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.mercurial-spkg.patch) by @kini created at 2011-06-14 03:55:34\n\ndon't use this, I'll upload a full spkg",
    "created_at": "2011-06-14T03:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118916",
    "user": "https://github.com/kini"
}
```

Attachment [trac_11121-hgrc.mercurial-spkg.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.mercurial-spkg.patch) by @kini created at 2011-06-14 03:55:34

don't use this, I'll upload a full spkg



---

archive/issue_comments_118917.json:
```json
{
    "body": "OK, assuming I didn't forget anything, [this spkg](http://sage.math.washington.edu/home/keshav/files/mercurial-1.8.4.spkg) should obviate trac_11121-hgrc.mercurial-spkg.patch and make this ticket ready for review.",
    "created_at": "2011-06-14T06:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118917",
    "user": "https://github.com/kini"
}
```

OK, assuming I didn't forget anything, [this spkg](http://sage.math.washington.edu/home/keshav/files/mercurial-1.8.4.spkg) should obviate trac_11121-hgrc.mercurial-spkg.patch and make this ticket ready for review.



---

archive/issue_comments_118918.json:
```json
{
    "body": "Changing keywords from \"mercurial, git, diff, patches\" to \"mercurial git diff patches sd31\".",
    "created_at": "2011-06-14T06:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118918",
    "user": "https://github.com/kini"
}
```

Changing keywords from "mercurial, git, diff, patches" to "mercurial git diff patches sd31".



---

archive/issue_comments_118919.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-14T06:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118919",
    "user": "https://github.com/kini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_118920.json:
```json
{
    "body": "I disagree with\n\n```\n[pager] \npager = less -R \nattend = annotate, cat, diff, log, glog, qdiff \n```\n\n\nThis looks too much like pushing your own personal preferences.",
    "created_at": "2011-06-14T21:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118920",
    "user": "https://github.com/jdemeyer"
}
```

I disagree with

```
[pager] 
pager = less -R 
attend = annotate, cat, diff, log, glog, qdiff 
```


This looks too much like pushing your own personal preferences.



---

archive/issue_comments_118921.json:
```json
{
    "body": "I would be happy with\n\n```\n[pager]\npager = LESS='FSRX' less\n```\n\nsince this is what is recommended on [the Mercurial web page](http://mercurial.selenic.com/wiki/PagerExtension).  (The \"attend\" setting above is almost the same, so I actually don't think that's a big deal, but it may be safest to just use what Mercurial advertises.  That's as close to an official standard as we can get.)",
    "created_at": "2011-06-14T21:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118921",
    "user": "https://github.com/jhpalmieri"
}
```

I would be happy with

```
[pager]
pager = LESS='FSRX' less
```

since this is what is recommended on [the Mercurial web page](http://mercurial.selenic.com/wiki/PagerExtension).  (The "attend" setting above is almost the same, so I actually don't think that's a big deal, but it may be safest to just use what Mercurial advertises.  That's as close to an official standard as we can get.)



---

archive/issue_comments_118922.json:
```json
{
    "body": "Note that that page is a wiki and anyone can change it (indeed I just fixed a typo on it). In fact there are even people arguing about these LESS options (and even suggesting that people install the plan 9 pager!) at the end of the page. The official standard would be to not set any variables in .hgrc at all, but this ticket is all about not doing that.\n\nNevertheless I'll change the options to reflect what is written there since you insist.",
    "created_at": "2011-06-14T21:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118922",
    "user": "https://github.com/kini"
}
```

Note that that page is a wiki and anyone can change it (indeed I just fixed a typo on it). In fact there are even people arguing about these LESS options (and even suggesting that people install the plan 9 pager!) at the end of the page. The official standard would be to not set any variables in .hgrc at all, but this ticket is all about not doing that.

Nevertheless I'll change the options to reflect what is written there since you insist.



---

archive/issue_comments_118923.json:
```json
{
    "body": "I would suggest not to put any `pager` variables at all.",
    "created_at": "2011-06-14T21:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118923",
    "user": "https://github.com/jdemeyer"
}
```

I would suggest not to put any `pager` variables at all.



---

archive/issue_comments_118924.json:
```json
{
    "body": ">       Setting pager.attend to an empty value will cause all commands to be paged.\nOr so says the hg man page. This seems more intrusive of a change than setting the `attend` variable. I guess choosing the pager itself is not necessary, so I'll skip it (#11142 sets it manually anyway).",
    "created_at": "2011-06-14T22:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118924",
    "user": "https://github.com/kini"
}
```

>       Setting pager.attend to an empty value will cause all commands to be paged.
Or so says the hg man page. This seems more intrusive of a change than setting the `attend` variable. I guess choosing the pager itself is not necessary, so I'll skip it (#11142 sets it manually anyway).



---

archive/issue_comments_118925.json:
```json
{
    "body": "OK, changed.",
    "created_at": "2011-06-14T22:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118925",
    "user": "https://github.com/kini"
}
```

OK, changed.



---

archive/issue_comments_118926.json:
```json
{
    "body": "In the patch for the mercurial spkg, the hgrc file doesn't quite do what I would like.  In particular, if there are no lines like\n\n```\n[pager]\npager = LESS='FSRX' less\n```\n\nthen the pager extension doesn't do anything, so for example running \"hg log\" just scrolls through the whole log without pausing.  Is that what you intended?",
    "created_at": "2011-06-22T00:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118926",
    "user": "https://github.com/jhpalmieri"
}
```

In the patch for the mercurial spkg, the hgrc file doesn't quite do what I would like.  In particular, if there are no lines like

```
[pager]
pager = LESS='FSRX' less
```

then the pager extension doesn't do anything, so for example running "hg log" just scrolls through the whole log without pausing.  Is that what you intended?



---

archive/issue_comments_118927.json:
```json
{
    "body": "It is what I intended, because it is what Jeroen suggested I do. If you suggest I do otherwise, then in the interest of expediency I will follow the suggestion of whoever promises to review this first :P I have my own `~/.hgrc` with `pager = less -R` in it anyway, so it doesn't much matter to me. As you said earlier, the most important thing here is to get \"git=true\" in there.\n\nOne benefit I can think of for not putting `pager = LESS='FSRX' less` in the `hgrc` is that the various scripts which (unwisely, in my opinion) call mercurial commands such as `diff`, `log`, `status`, etc. during build processes which are supposed to be unattended can be guaranteed not to halt waiting for someone to exit `less`, whereas at the moment, I, at least, have not vetted all such scripts to make sure this doesn't happen.",
    "created_at": "2011-06-22T00:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118927",
    "user": "https://github.com/kini"
}
```

It is what I intended, because it is what Jeroen suggested I do. If you suggest I do otherwise, then in the interest of expediency I will follow the suggestion of whoever promises to review this first :P I have my own `~/.hgrc` with `pager = less -R` in it anyway, so it doesn't much matter to me. As you said earlier, the most important thing here is to get "git=true" in there.

One benefit I can think of for not putting `pager = LESS='FSRX' less` in the `hgrc` is that the various scripts which (unwisely, in my opinion) call mercurial commands such as `diff`, `log`, `status`, etc. during build processes which are supposed to be unattended can be guaranteed not to halt waiting for someone to exit `less`, whereas at the moment, I, at least, have not vetted all such scripts to make sure this doesn't happen.



---

archive/issue_comments_118928.json:
```json
{
    "body": "Okay, that makes sense.  Let's leave it the way you have it.  (I have \"pager= LESS ...\" in my own .hgrc file, and I've never noticed any problems with Sage pausing during a build, but I think it's fine to leave it unset in the default hgrc file.)",
    "created_at": "2011-06-22T01:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118928",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, that makes sense.  Let's leave it the way you have it.  (I have "pager= LESS ..." in my own .hgrc file, and I've never noticed any problems with Sage pausing during a build, but I think it's fine to leave it unset in the default hgrc file.)



---

archive/issue_comments_118929.json:
```json
{
    "body": "Since the file SAGE_LOCAL/etc/mercurial/hgrc sets \"git=true\", do we also need to set it for each repository individually?  That is, do we need all of these patches, or just the one present in the new spkg in #10594?",
    "created_at": "2011-06-22T01:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118929",
    "user": "https://github.com/jhpalmieri"
}
```

Since the file SAGE_LOCAL/etc/mercurial/hgrc sets "git=true", do we also need to set it for each repository individually?  That is, do we need all of these patches, or just the one present in the new spkg in #10594?



---

archive/issue_comments_118930.json:
```json
{
    "body": "Replying to [comment:36 jhpalmieri]:\n> In the patch for the mercurial spkg, the hgrc file doesn't quite do what I would like.  In particular, if there are no lines like\n> {{{\n> [pager]\n> pager = LESS='FSRX' less\n> }}}\n> then the pager extension doesn't do anything, so for example running \"hg log\" just scrolls through the whole log without pausing.  Is that what you intended?\n\nSo if someone doesn't have this set, then what would \n\n```\nhg_sage.log()\n```\n\ndo?  I tremble to think of the brand-new developer, who is not sure how to set up hg as an alias, trying this and being deluged by thousands of changes... At any rate, hg_sage.[tab] things should continue behaving as they have in this respect, using either 'more' or 'less' as the default (I don't know which it is, though).  If the pager option breaks this, it should be a no-go in my opinion.",
    "created_at": "2011-06-22T02:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118930",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:36 jhpalmieri]:
> In the patch for the mercurial spkg, the hgrc file doesn't quite do what I would like.  In particular, if there are no lines like
> {{{
> [pager]
> pager = LESS='FSRX' less
> }}}
> then the pager extension doesn't do anything, so for example running "hg log" just scrolls through the whole log without pausing.  Is that what you intended?

So if someone doesn't have this set, then what would 

```
hg_sage.log()
```

do?  I tremble to think of the brand-new developer, who is not sure how to set up hg as an alias, trying this and being deluged by thousands of changes... At any rate, hg_sage.[tab] things should continue behaving as they have in this respect, using either 'more' or 'less' as the default (I don't know which it is, though).  If the pager option breaks this, it should be a no-go in my opinion.



---

archive/issue_comments_118931.json:
```json
{
    "body": "kcrisman: Review #11142 then! :)\n\njhpalmieri: The other patches ensure that the user will produce git patches from sage repositories even if they are simultaneously 1) using their system's Mercurial instead of `sage -hg` and 2) not using git diffs globally in their system's Mercurial.",
    "created_at": "2011-06-22T02:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118931",
    "user": "https://github.com/kini"
}
```

kcrisman: Review #11142 then! :)

jhpalmieri: The other patches ensure that the user will produce git patches from sage repositories even if they are simultaneously 1) using their system's Mercurial instead of `sage -hg` and 2) not using git diffs globally in their system's Mercurial.



---

archive/issue_comments_118932.json:
```json
{
    "body": "kcrisman: Oops, you already are reviewing it. Sorry! :) Then to answer what I guess your actual question is, it won't make any difference as jhpalmieri's patch for #11142 manually uses `less` rather than relying on the `hgrc` file.",
    "created_at": "2011-06-22T02:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118932",
    "user": "https://github.com/kini"
}
```

kcrisman: Oops, you already are reviewing it. Sorry! :) Then to answer what I guess your actual question is, it won't make any difference as jhpalmieri's patch for #11142 manually uses `less` rather than relying on the `hgrc` file.



---

archive/issue_comments_118933.json:
```json
{
    "body": "So you're saying that \n\n```\nreturn '--config pager.pager=\"LESS=\\'FSRX\\' less\"'\n```\n\nwould keep the current behavior?  I don't understand that part of it.  What is `FSRX`?\n\nSo in principle, if one *only* merged this ticket, behavior would change, but if one then also merges #11142, it's ok.  Is that right?",
    "created_at": "2011-06-22T14:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118933",
    "user": "https://github.com/kcrisman"
}
```

So you're saying that 

```
return '--config pager.pager="LESS=\'FSRX\' less"'
```

would keep the current behavior?  I don't understand that part of it.  What is `FSRX`?

So in principle, if one *only* merged this ticket, behavior would change, but if one then also merges #11142, it's ok.  Is that right?



---

archive/issue_comments_118934.json:
```json
{
    "body": "I think if you only merge this ticket, behavior would stay the same, because the paging in commands coming from \"hg_sage\" (etc.) are done by hand in hg.py.  For example, hg_sage.log() runs \"sage -hg log | less\", so it doesn't matter whether any hgrc file has a pager set.\n\n`FSRX` are flags for the \"less\" command:\n\n- F exits automatically if the output fits on one screen\n- S truncates long lines\n- R preserves any color specification (and mercurial can use color in logs, diffs, etc.)\n- X doesn't clear the screen when you're done",
    "created_at": "2011-06-22T15:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118934",
    "user": "https://github.com/jhpalmieri"
}
```

I think if you only merge this ticket, behavior would stay the same, because the paging in commands coming from "hg_sage" (etc.) are done by hand in hg.py.  For example, hg_sage.log() runs "sage -hg log | less", so it doesn't matter whether any hgrc file has a pager set.

`FSRX` are flags for the "less" command:

- F exits automatically if the output fits on one screen
- S truncates long lines
- R preserves any color specification (and mercurial can use color in logs, diffs, etc.)
- X doesn't clear the screen when you're done



---

archive/issue_comments_118935.json:
```json
{
    "body": "Thanks, John.  I think I see that all now.  And the flags are exactly the current behavior - convenient!\n\nI won't be reviewing much until my normal computer comes back from the doctor, but then #11142 sounds like it will likely be good - once you do the things I suggest there ;) - and maybe this one too.",
    "created_at": "2011-06-22T15:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118935",
    "user": "https://github.com/kcrisman"
}
```

Thanks, John.  I think I see that all now.  And the flags are exactly the current behavior - convenient!

I won't be reviewing much until my normal computer comes back from the doctor, but then #11142 sounds like it will likely be good - once you do the things I suggest there ;) - and maybe this one too.



---

archive/issue_comments_118936.json:
```json
{
    "body": "I'm not sure how they are \"exactly the current behavior\" - perhaps they are the defaults for `less` on your system? The `less` man page on my system at least explicitly says that `-S` is non-default behavior. And if we're going to stick to the manpage, it should technically be `LESS='-FSRX'`, not `LESS='FSRX'`. Also, none of those four flags are in the POSIX spec for `more`. But no matter, since this is not going into the spkg anyway :)",
    "created_at": "2011-06-22T15:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118936",
    "user": "https://github.com/kini"
}
```

I'm not sure how they are "exactly the current behavior" - perhaps they are the defaults for `less` on your system? The `less` man page on my system at least explicitly says that `-S` is non-default behavior. And if we're going to stick to the manpage, it should technically be `LESS='-FSRX'`, not `LESS='FSRX'`. Also, none of those four flags are in the POSIX spec for `more`. But no matter, since this is not going into the spkg anyway :)



---

archive/issue_comments_118937.json:
```json
{
    "body": "I have one new concern: the new notebook (the flask version) comes with a file `.hg/hgrc`, so I don't think we should overwrite it.  It contains just this:\n\n```\n[paths]\ndefault = https://rkirov-flask.googlecode.com/hg/\n```\n",
    "created_at": "2011-07-01T18:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118937",
    "user": "https://github.com/jhpalmieri"
}
```

I have one new concern: the new notebook (the flask version) comes with a file `.hg/hgrc`, so I don't think we should overwrite it.  It contains just this:

```
[paths]
default = https://rkirov-flask.googlecode.com/hg/
```




---

archive/issue_comments_118938.json:
```json
{
    "body": "No, `.hg/hgrc` is not transferred across clones or pulls. Rather the file you are seeing was created by your local Mercurial when you did `hg clone https://rkirov-flask.googlecode.com/hg/`, to make it so that `hg pull` would by default pull from `https://rkirov-flask.googlecode.com/hg/`. When the flask notebook is distributed with sage, this `hgrc` file will not exist (or should not exist, otherwise our distribution tools are misusing Mercurial).",
    "created_at": "2011-07-01T20:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118938",
    "user": "https://github.com/kini"
}
```

No, `.hg/hgrc` is not transferred across clones or pulls. Rather the file you are seeing was created by your local Mercurial when you did `hg clone https://rkirov-flask.googlecode.com/hg/`, to make it so that `hg pull` would by default pull from `https://rkirov-flask.googlecode.com/hg/`. When the flask notebook is distributed with sage, this `hgrc` file will not exist (or should not exist, otherwise our distribution tools are misusing Mercurial).



---

archive/issue_comments_118939.json:
```json
{
    "body": "Attachment [trac_11121-root-repo.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-root-repo.patch) by @jhpalmieri created at 2011-07-02 05:40:26\n\napply to $SAGE_ROOT",
    "created_at": "2011-07-02T05:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118939",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_11121-root-repo.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-root-repo.patch) by @jhpalmieri created at 2011-07-02 05:40:26

apply to $SAGE_ROOT



---

archive/issue_comments_118940.json:
```json
{
    "body": "I tried applying the patches, then running \"sage -sdist ...\", and then building from the resulting tar ball.  The patch for the root repo isn't working; I think the spkg-install script is exiting before the part which creates the hgrc file.  The code to create the hgrc file might have to appear several times in that file, since there are several places it can successfully exit.  Maybe try [attachment:trac_11121-root-repo.patch] instead.",
    "created_at": "2011-07-02T05:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118940",
    "user": "https://github.com/jhpalmieri"
}
```

I tried applying the patches, then running "sage -sdist ...", and then building from the resulting tar ball.  The patch for the root repo isn't working; I think the spkg-install script is exiting before the part which creates the hgrc file.  The code to create the hgrc file might have to appear several times in that file, since there are several places it can successfully exit.  Maybe try [attachment:trac_11121-root-repo.patch] instead.



---

archive/issue_comments_118941.json:
```json
{
    "body": "Whoops, yes, you're right. Thanks for the patch.",
    "created_at": "2011-07-02T06:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118941",
    "user": "https://github.com/kini"
}
```

Whoops, yes, you're right. Thanks for the patch.



---

archive/issue_comments_118942.json:
```json
{
    "body": "One small issue: as you said, .hg/hgrc is not transferred during clones, so if you \"sage -clone ...\", the \"git\" setting is lost for that repo.  If people don't work with clones, or if they use the version of Mercurial distributed with Sage, or if they have \"git=1\" in their own .hgrc file, this won't affect them.  I suppose we could rewrite the file in the sage-clone script, but I don't know if it's worth it.  Opinions?\n\nFor the root repo, my patch works for me.  Can someone else check it? Pending opinions on modifying sage-clone, everything else gets a positive review from me.",
    "created_at": "2011-07-02T20:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118942",
    "user": "https://github.com/jhpalmieri"
}
```

One small issue: as you said, .hg/hgrc is not transferred during clones, so if you "sage -clone ...", the "git" setting is lost for that repo.  If people don't work with clones, or if they use the version of Mercurial distributed with Sage, or if they have "git=1" in their own .hgrc file, this won't affect them.  I suppose we could rewrite the file in the sage-clone script, but I don't know if it's worth it.  Opinions?

For the root repo, my patch works for me.  Can someone else check it? Pending opinions on modifying sage-clone, everything else gets a positive review from me.



---

archive/issue_comments_118943.json:
```json
{
    "body": "Replying to [comment:51 jhpalmieri]:\n> One small issue: as you said, `.hg/hgrc` is not transferred during clones, so if you \"sage -clone ...\", the \"git\" setting is lost for that repo.  If people don't work with clones, or if they use the version of Mercurial distributed with Sage, or if they have \"git=1\" in their own `.hgrc` file, this won't affect them.  I suppose we could rewrite the file in the `sage-clone` script, but I don't know if it's worth it.  Opinions?\n\nAs this falls into the category of surprising (if not annoying) \"features\", I'd say `sage-clone` should then copy it over.\n\nDisclaimer: Doesn't affect me personally. ;-)",
    "created_at": "2011-07-03T20:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118943",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:51 jhpalmieri]:
> One small issue: as you said, `.hg/hgrc` is not transferred during clones, so if you "sage -clone ...", the "git" setting is lost for that repo.  If people don't work with clones, or if they use the version of Mercurial distributed with Sage, or if they have "git=1" in their own `.hgrc` file, this won't affect them.  I suppose we could rewrite the file in the `sage-clone` script, but I don't know if it's worth it.  Opinions?

As this falls into the category of surprising (if not annoying) "features", I'd say `sage-clone` should then copy it over.

Disclaimer: Doesn't affect me personally. ;-)



---

archive/issue_comments_118944.json:
```json
{
    "body": "Attachment [trac_11121-scripts-sage-clone.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-scripts-sage-clone.patch) by @jhpalmieri created at 2011-07-05 21:53:08\n\nscripts repo",
    "created_at": "2011-07-05T21:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118944",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_11121-scripts-sage-clone.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-scripts-sage-clone.patch) by @jhpalmieri created at 2011-07-05 21:53:08

scripts repo



---

archive/issue_comments_118945.json:
```json
{
    "body": "Okay, here's a patch to sage-clone which appends \"git=true\" to devel/sage/.hg/hgrc.",
    "created_at": "2011-07-05T21:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118945",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, here's a patch to sage-clone which appends "git=true" to devel/sage/.hg/hgrc.



---

archive/issue_comments_118946.json:
```json
{
    "body": "Replying to [comment:53 jhpalmieri]:\n> Okay, here's a patch to sage-clone which appends \"git=true\" to devel/sage/.hg/hgrc.\nDo I read correctly that the things remaining to review are \n* the patch to the root repo\n* the patch to the sage-clone script\nAnd that we only want to have these have `git=True`, and not enable queues or add a username or anything like that?  It doesn't look like it appends to anything - I thought, based on the above, that this file is created at that time.  (Is that, presumably, after `devel/sage` is changed to point to `sage-newbranch`?)\n\nSorry if these questions are dumb, just trying to help get this reviewed.",
    "created_at": "2011-08-18T02:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118946",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:53 jhpalmieri]:
> Okay, here's a patch to sage-clone which appends "git=true" to devel/sage/.hg/hgrc.
Do I read correctly that the things remaining to review are 
* the patch to the root repo
* the patch to the sage-clone script
And that we only want to have these have `git=True`, and not enable queues or add a username or anything like that?  It doesn't look like it appends to anything - I thought, based on the above, that this file is created at that time.  (Is that, presumably, after `devel/sage` is changed to point to `sage-newbranch`?)

Sorry if these questions are dumb, just trying to help get this reviewed.



---

archive/issue_comments_118947.json:
```json
{
    "body": "Replying to [comment:54 kcrisman]:\n> Do I read correctly that the things remaining to review are \n>  * the patch to the root repo\n\nI'll vouch for that (is that allowed?)\n\n>  * the patch to the sage-clone script\n\nLooks good to me too, but again, I am a co-author on this ticket.\n\n> And that we only want to have these have `git=True`, and not enable queues or add a username or anything like that?  It doesn't look like it appends to anything - I thought, based on the above, that this file is created at that time.  (Is that, presumably, after `devel/sage` is changed to point to `sage-newbranch`?)\n\nYes, see [comment:41 this comment]. All that extra stuff (besides `git=True`) is put in the file `$SAGE_ROOT/local/etc/mercurial/hgrc` by the installer of `mercurial-1.8.4.spkg` from #10594. Indeed, the file in John's patch to `sage-clone` could just as well open the `.hg/hgrc` file with mode `'w'` rather than `'a'`, I think.",
    "created_at": "2011-08-18T11:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118947",
    "user": "https://github.com/kini"
}
```

Replying to [comment:54 kcrisman]:
> Do I read correctly that the things remaining to review are 
>  * the patch to the root repo

I'll vouch for that (is that allowed?)

>  * the patch to the sage-clone script

Looks good to me too, but again, I am a co-author on this ticket.

> And that we only want to have these have `git=True`, and not enable queues or add a username or anything like that?  It doesn't look like it appends to anything - I thought, based on the above, that this file is created at that time.  (Is that, presumably, after `devel/sage` is changed to point to `sage-newbranch`?)

Yes, see [comment:41 this comment]. All that extra stuff (besides `git=True`) is put in the file `$SAGE_ROOT/local/etc/mercurial/hgrc` by the installer of `mercurial-1.8.4.spkg` from #10594. Indeed, the file in John's patch to `sage-clone` could just as well open the `.hg/hgrc` file with mode `'w'` rather than `'a'`, I think.



---

archive/issue_comments_118948.json:
```json
{
    "body": "Yeah, it's okay to review a coauthor's changes as long as you don't review your *own* changes.  There are *many* tickets where precisely this happens.  Otherwise we would never get things reviewed. \n\nWell, either way on the write mode, as long as you review it works.",
    "created_at": "2011-08-18T12:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118948",
    "user": "https://github.com/kcrisman"
}
```

Yeah, it's okay to review a coauthor's changes as long as you don't review your *own* changes.  There are *many* tickets where precisely this happens.  Otherwise we would never get things reviewed. 

Well, either way on the write mode, as long as you review it works.



---

archive/issue_comments_118949.json:
```json
{
    "body": "Replying to [comment:56 kini]:\n> Yes, see [comment:41 this comment]. All that extra stuff (besides `git=True`) is put in the file `$SAGE_ROOT/local/etc/mercurial/hgrc` by the installer of `mercurial-1.8.4.spkg` from #10594. Indeed, the file in John's patch to `sage-clone` could just as well open the `.hg/hgrc` file with mode `'w'` rather than `'a'`, I think.\n\nWell, when you make a clone, a new .hgrc file is written, saying something like\n\n```\n[paths]\ndefault = .../devel/sage\n```\n\nI'm not sure of the purpose of this, but I thought we should append to it, not overwrite it.",
    "created_at": "2011-08-18T15:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118949",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:56 kini]:
> Yes, see [comment:41 this comment]. All that extra stuff (besides `git=True`) is put in the file `$SAGE_ROOT/local/etc/mercurial/hgrc` by the installer of `mercurial-1.8.4.spkg` from #10594. Indeed, the file in John's patch to `sage-clone` could just as well open the `.hg/hgrc` file with mode `'w'` rather than `'a'`, I think.

Well, when you make a clone, a new .hgrc file is written, saying something like

```
[paths]
default = .../devel/sage
```

I'm not sure of the purpose of this, but I thought we should append to it, not overwrite it.



---

archive/issue_comments_118950.json:
```json
{
    "body": "Replying to [comment:54 kcrisman]:\n> Replying to [comment:53 jhpalmieri]:\n> > Okay, here's a patch to sage-clone which appends \"git=true\" to devel/sage/.hg/hgrc.\n> Do I read correctly that the things remaining to review are \n> * the patch to the root repo\n> * the patch to the sage-clone script\n\nThat's right, I gave a positive review to everything else.  Since I wrote those two, anyone else can review them.",
    "created_at": "2011-08-18T15:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118950",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:54 kcrisman]:
> Replying to [comment:53 jhpalmieri]:
> > Okay, here's a patch to sage-clone which appends "git=true" to devel/sage/.hg/hgrc.
> Do I read correctly that the things remaining to review are 
> * the patch to the root repo
> * the patch to the sage-clone script

That's right, I gave a positive review to everything else.  Since I wrote those two, anyone else can review them.



---

archive/issue_comments_118951.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-18T16:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118951",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_118952.json:
```json
{
    "body": "Well, Keshav just did!",
    "created_at": "2011-08-18T16:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118952",
    "user": "https://github.com/kcrisman"
}
```

Well, Keshav just did!



---

archive/issue_comments_118953.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-08-22T17:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118953",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_011095.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-08-22T17:34:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10982#event-11095"
}
```



---

archive/issue_comments_118954.json:
```json
{
    "body": "Same as [attachment:trac_11121-hgrc.local-bin.patch] but keeping the file mode 0755",
    "created_at": "2011-08-23T13:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118954",
    "user": "https://github.com/jdemeyer"
}
```

Same as [attachment:trac_11121-hgrc.local-bin.patch] but keeping the file mode 0755



---

archive/issue_comments_118955.json:
```json
{
    "body": "Attachment [trac_11121-hgrc.local-bin-mode0755.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.local-bin-mode0755.patch) by @jdemeyer created at 2011-08-23 13:47:50",
    "created_at": "2011-08-23T13:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10982#issuecomment-118955",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_11121-hgrc.local-bin-mode0755.patch](tarball://root/attachments/some-uuid/ticket11121/trac_11121-hgrc.local-bin-mode0755.patch) by @jdemeyer created at 2011-08-23 13:47:50
