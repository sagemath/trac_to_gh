# Issue 20114: sage.libs.ppl.MIP_Problem and PPLBackend: Add support for integer variables

archive/issues_020114.json:
```json
{
    "body": "CC:  @dimpase @videlec @jdemeyer\n\nKeywords: lp\n\nPPL is a rational MIP solver. \nIts support for integer variables should be exposed in Sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20351\n\n",
    "created_at": "2016-04-03T16:13:17Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "sage.libs.ppl.MIP_Problem and PPLBackend: Add support for integer variables",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20114",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @videlec @jdemeyer

Keywords: lp

PPL is a rational MIP solver. 
Its support for integer variables should be exposed in Sage.

Issue created by migration from https://trac.sagemath.org/ticket/20351





---

archive/issue_comments_276949.json:
```json
{
    "body": "Good catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)",
    "created_at": "2016-04-03T17:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276949",
    "user": "https://github.com/dimpase"
}
```

Good catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)



---

archive/issue_comments_276950.json:
```json
{
    "body": "Replying to [comment:2 dimpase]:\n> Good catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)\n\nI'll write it if you review my other tickets ;)",
    "created_at": "2016-04-03T17:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276950",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:2 dimpase]:
> Good catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)

I'll write it if you review my other tickets ;)



---

archive/issue_comments_276951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-04T07:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_276952.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-04T07:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276952",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_276953.json:
```json
{
    "body": "Are indices of variables 0-based, 1-based?\nCould this info be added to docs?",
    "created_at": "2016-04-04T09:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276953",
    "user": "https://github.com/dimpase"
}
```

Are indices of variables 0-based, 1-based?
Could this info be added to docs?



---

archive/issue_comments_276954.json:
```json
{
    "body": "Can one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?\nOr is this optimisation-only thing?",
    "created_at": "2016-04-04T10:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276954",
    "user": "https://github.com/dimpase"
}
```

Can one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?
Or is this optimisation-only thing?



---

archive/issue_comments_276955.json:
```json
{
    "body": "> Are indices of variables 0-based, 1-based?\n> Could this info be added to docs?\n\nThis is already documented in the class docstring of `Variable`. (It's 0-based.)\n\n> Can one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?\n> Or is this optimisation-only thing?\n\nNo, PPL does not have code for computing integer hulls. \nThe closest that there is in the polyhedron code is the following interesting function:\n\n\n```\nvoid Parma_Polyhedra_Library::Polyhedron::drop_some_non_integer_points(Complexity_Class complexity = ANY_COMPLEXITY)\t\nPossibly tightens *this by dropping some points with non-integer coordinates.\n```\n\n\nI would be quite interested in having code in Sage that computes a polyhedron given only by a linear optimization oracle [for example, implemented by a MIP solver], see for example http://arxiv.org/pdf/1412.3987.pdf. But this has nothing to do with this ticket.",
    "created_at": "2016-04-04T18:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276955",
    "user": "https://github.com/mkoeppe"
}
```

> Are indices of variables 0-based, 1-based?
> Could this info be added to docs?

This is already documented in the class docstring of `Variable`. (It's 0-based.)

> Can one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?
> Or is this optimisation-only thing?

No, PPL does not have code for computing integer hulls. 
The closest that there is in the polyhedron code is the following interesting function:


```
void Parma_Polyhedra_Library::Polyhedron::drop_some_non_integer_points(Complexity_Class complexity = ANY_COMPLEXITY)	
Possibly tightens *this by dropping some points with non-integer coordinates.
```


I would be quite interested in having code in Sage that computes a polyhedron given only by a linear optimization oracle [for example, implemented by a MIP solver], see for example http://arxiv.org/pdf/1412.3987.pdf. But this has nothing to do with this ticket.



---

archive/issue_comments_276956.json:
```json
{
    "body": "IMHO in `add_to_integer_space_dimensions` one should have `sig_on()` inside `try:` block, not outside. And `sig_off()` should be immediately after the call to the backend.\n\nsee [catch_interrupts()](http://www.sagemath.org/git-developer-guide/coding_in_cython.html)",
    "created_at": "2016-04-04T19:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276956",
    "user": "https://github.com/dimpase"
}
```

IMHO in `add_to_integer_space_dimensions` one should have `sig_on()` inside `try:` block, not outside. And `sig_off()` should be immediately after the call to the backend.

see [catch_interrupts()](http://www.sagemath.org/git-developer-guide/coding_in_cython.html)



---

archive/issue_comments_276957.json:
```json
{
    "body": "The code in `add_to_integer_space_dimensions` matches the last example in the documentation that you cited. I'm assuming it's correct. Besides, it was copy-paste from elsewhere in ppl.pyx. \n\n```\nAlternatively, you can use try/finally which will also catch exceptions raised by subroutines inside the try:\n\ndef try_finally_example():\n    sig_on()\n    try:\n        # (some long computation, potentially raising exceptions)\n    finally:\n        sig_off()\n    return something\n```\n",
    "created_at": "2016-04-05T05:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276957",
    "user": "https://github.com/mkoeppe"
}
```

The code in `add_to_integer_space_dimensions` matches the last example in the documentation that you cited. I'm assuming it's correct. Besides, it was copy-paste from elsewhere in ppl.pyx. 

```
Alternatively, you can use try/finally which will also catch exceptions raised by subroutines inside the try:

def try_finally_example():
    sig_on()
    try:
        # (some long computation, potentially raising exceptions)
    finally:
        sig_off()
    return something
```




---

archive/issue_comments_276958.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-05T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276958",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_276959.json:
```json
{
    "body": "OK, good. Although I am a bit concerned about few `def` statements that could be `cdef` or `cpdef`, for efficiency reasons.",
    "created_at": "2016-04-05T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276959",
    "user": "https://github.com/dimpase"
}
```

OK, good. Although I am a bit concerned about few `def` statements that could be `cdef` or `cpdef`, for efficiency reasons.



---

archive/issue_comments_276960.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-05T16:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20114#issuecomment-276960",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
