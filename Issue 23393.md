# Issue 23393: Improve the faces method for graphs

archive/issues_023393.json:
```json
{
    "body": "CC:  @mo271\n\nBefore\n\n```\nsage: G = graphs.Grid2dGraph(10,10)\nsage: %time a = G.faces()\nCPU times: user 48.1 ms, sys: 3.85 ms, total: 51.9 ms\nWall time: 49.2 ms\n```\nAfter\n\n```\nsage: %time b = G.faces()\nCPU times: user 1.92 ms, sys: 488 \u00b5s, total: 2.41 ms\nWall time: 2.07 ms\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/23630\n\n",
    "created_at": "2017-08-17T10:28:02Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Improve the faces method for graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23393",
    "user": "https://github.com/dcoudert"
}
```
CC:  @mo271

Before

```
sage: G = graphs.Grid2dGraph(10,10)
sage: %time a = G.faces()
CPU times: user 48.1 ms, sys: 3.85 ms, total: 51.9 ms
Wall time: 49.2 ms
```
After

```
sage: %time b = G.faces()
CPU times: user 1.92 ms, sys: 488 Âµs, total: 2.41 ms
Wall time: 2.07 ms
```

Issue created by migration from https://trac.sagemath.org/ticket/23630





---

archive/issue_comments_327035.json:
```json
{
    "body": "While working on the method I realized that some cases where not taken into account:\n- what should the method returns when the graph has a single vertex and no edge ? (i.e., `G = Graph(1)`)\n- What's the expected output for graphs with multiple connected components (e.g., `G = Graph(2)`) ? Should we raise an error for as long as we don't have a suitable solution ?\n \n---\nNew commits:",
    "created_at": "2017-08-17T10:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327035",
    "user": "https://github.com/dcoudert"
}
```

While working on the method I realized that some cases where not taken into account:
- what should the method returns when the graph has a single vertex and no edge ? (i.e., `G = Graph(1)`)
- What's the expected output for graphs with multiple connected components (e.g., `G = Graph(2)`) ? Should we raise an error for as long as we don't have a suitable solution ?
 
---
New commits:



---

archive/issue_comments_327036.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-17T10:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327036",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_327037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-18T07:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327038.json:
```json
{
    "body": "Replying to [comment:1 dcoudert]:\n> While working on the method I realized that some cases where not taken into account:\n> - what should the method returns when the graph has a single vertex and no edge ? (i.e., `G = Graph(1)`)\n \nShouldn't that be the graph with 1 vertex and no edges?\n\nI also see the code for the dual of the path. Shouldn't this one be a graph with one vertex one some parallel loops?\n> - What's the expected output for graphs with multiple connected components (e.g., `G = Graph(2)`) ? Should we raise an error for as long as we don't have a suitable solution ?\n>  \n> ---\n \nI guess one can still define the planar dual; the dual itself will always be connected. \n\n\nAt the moment the method gets an uninformative error when you try these cases:\n\n```\nsage: G=Graph(1)\nsage: G.faces()\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n...\n   4940         # Storage for face paths\n   4941         faces = []\n-> 4942         path = [edgeset.pop()]\n   4943 \n   4944         # Trace faces\n\nKeyError: 'pop from an empty set'\n```",
    "created_at": "2017-08-18T11:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327038",
    "user": "https://github.com/mo271"
}
```

Replying to [comment:1 dcoudert]:
> While working on the method I realized that some cases where not taken into account:
> - what should the method returns when the graph has a single vertex and no edge ? (i.e., `G = Graph(1)`)
 
Shouldn't that be the graph with 1 vertex and no edges?

I also see the code for the dual of the path. Shouldn't this one be a graph with one vertex one some parallel loops?
> - What's the expected output for graphs with multiple connected components (e.g., `G = Graph(2)`) ? Should we raise an error for as long as we don't have a suitable solution ?
>  
> ---
 
I guess one can still define the planar dual; the dual itself will always be connected. 


At the moment the method gets an uninformative error when you try these cases:

```
sage: G=Graph(1)
sage: G.faces()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
...
   4940         # Storage for face paths
   4941         faces = []
-> 4942         path = [edgeset.pop()]
   4943 
   4944         # Trace faces

KeyError: 'pop from an empty set'
```



---

archive/issue_comments_327039.json:
```json
{
    "body": "Recall that this code returns the **faces** and not the dual graph. So I don't know how to represent the faces when:\n- the graph has a single vertex and no edge (actually loops are not properly handled here). That's why `Graph(1).faces()` currently raises an uninformative error.  \n- disconnected graphs.\n\nFor the dual graph, I agree that the dual of the path graph should be a single vertex with one or parallel loops.",
    "created_at": "2017-08-18T11:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327039",
    "user": "https://github.com/dcoudert"
}
```

Recall that this code returns the **faces** and not the dual graph. So I don't know how to represent the faces when:
- the graph has a single vertex and no edge (actually loops are not properly handled here). That's why `Graph(1).faces()` currently raises an uninformative error.  
- disconnected graphs.

For the dual graph, I agree that the dual of the path graph should be a single vertex with one or parallel loops.



---

archive/issue_comments_327040.json:
```json
{
    "body": "Replying to [comment:4 dcoudert]:\n\nRight, I also don't know what is the best way to do this.",
    "created_at": "2017-08-18T13:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327040",
    "user": "https://github.com/mo271"
}
```

Replying to [comment:4 dcoudert]:

Right, I also don't know what is the best way to do this.



---

archive/issue_comments_327041.json:
```json
{
    "body": "A way to postpone the problem is to raise a not implemented error for these cases.\n\nWith the previous implementation, we can get:\n\n```\nsage: G = Graph([(0,0)], loops=True)\nsage: G.faces({0:[0]})\n[[(0, 0)]]\n```\nCould this be considered as a trivial face ?",
    "created_at": "2017-08-18T16:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327041",
    "user": "https://github.com/dcoudert"
}
```

A way to postpone the problem is to raise a not implemented error for these cases.

With the previous implementation, we can get:

```
sage: G = Graph([(0,0)], loops=True)
sage: G.faces({0:[0]})
[[(0, 0)]]
```
Could this be considered as a trivial face ?



---

archive/issue_comments_327042.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-19T09:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327042",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327043.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-19T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327044.json:
```json
{
    "body": "I have fixed the issue with graphs without edge, ensuring that the result is the same has previous behavior. \nActually, I did several tests with non-connected graphs, graphs without vertex/edge, etc. to compare former and new implementations. The behavior of the method remains the same. \n\nI have also fix some doctests in other modules. The change is only the order in which the elements of a set are displayed.\n\nSo I propose to let the open questions that may require special attention for another ticket. Here, we speedup the method without changing the behavior.",
    "created_at": "2017-08-19T09:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327044",
    "user": "https://github.com/dcoudert"
}
```

I have fixed the issue with graphs without edge, ensuring that the result is the same has previous behavior. 
Actually, I did several tests with non-connected graphs, graphs without vertex/edge, etc. to compare former and new implementations. The behavior of the method remains the same. 

I have also fix some doctests in other modules. The change is only the order in which the elements of a set are displayed.

So I propose to let the open questions that may require special attention for another ticket. Here, we speedup the method without changing the behavior.



---

archive/issue_comments_327045.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-21T08:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327045",
    "user": "https://github.com/mo271"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327046.json:
```json
{
    "body": "This looks good to me! Its faster then before and other than that gives the same results.",
    "created_at": "2017-08-21T08:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327046",
    "user": "https://github.com/mo271"
}
```

This looks good to me! Its faster then before and other than that gives the same results.



---

archive/issue_comments_327047.json:
```json
{
    "body": "Thanks.",
    "created_at": "2017-08-21T09:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327047",
    "user": "https://github.com/dcoudert"
}
```

Thanks.



---

archive/issue_events_060487.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-26T09:57:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23393#event-60487"
}
```



---

archive/issue_comments_327048.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-26T09:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23393#issuecomment-327048",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
