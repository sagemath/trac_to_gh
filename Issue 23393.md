# Issue 23393: Improve the faces method for graphs

Issue created by migration from https://trac.sagemath.org/ticket/23630

Original creator: dcoudert

Original creation time: 2017-08-17 10:28:02

CC:  moritz

Before

```
sage: G = graphs.Grid2dGraph(10,10)
sage: %time a = G.faces()
CPU times: user 48.1 ms, sys: 3.85 ms, total: 51.9 ms
Wall time: 49.2 ms
```

After

```
sage: %time b = G.faces()
CPU times: user 1.92 ms, sys: 488 Âµs, total: 2.41 ms
Wall time: 2.07 ms
```



---

Comment by dcoudert created at 2017-08-17 10:37:12

While working on the method I realized that some cases where not taken into account:
- what should the method returns when the graph has a single vertex and no edge ? (i.e., `G = Graph(1)`)
- What's the expected output for graphs with multiple connected components (e.g., `G = Graph(2)`) ? Should we raise an error for as long as we don't have a suitable solution ?
----
New commits:


---

Comment by dcoudert created at 2017-08-17 10:37:12

Changing status from new to needs_review.


---

Comment by git created at 2017-08-18 07:30:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by moritz created at 2017-08-18 11:50:15

Replying to [comment:1 dcoudert]:
> While working on the method I realized that some cases where not taken into account:
> - what should the method returns when the graph has a single vertex and no edge ? (i.e., `G = Graph(1)`)
Shouldn't that be the graph with 1 vertex and no edges?

I also see the code for the dual of the path. Shouldn't this one be a graph with one vertex one some parallel loops?
> - What's the expected output for graphs with multiple connected components (e.g., `G = Graph(2)`) ? Should we raise an error for as long as we don't have a suitable solution ?
> ----
I guess one can still define the planar dual; the dual itself will always be connected. 


At the moment the method gets an uninformative error when you try these cases:

```
sage: G=Graph(1)
sage: G.faces()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
...
   4940         # Storage for face paths
   4941         faces = []
-> 4942         path = [edgeset.pop()]
   4943 
   4944         # Trace faces

KeyError: 'pop from an empty set'
```



---

Comment by dcoudert created at 2017-08-18 11:59:50

Recall that this code returns the **faces** and not the dual graph. So I don't know how to represent the faces when:
- the graph has a single vertex and no edge (actually loops are not properly handled here). That's why `Graph(1).faces()` currently raises an uninformative error.  
- disconnected graphs.

For the dual graph, I agree that the dual of the path graph should be a single vertex with one or parallel loops.


---

Comment by moritz created at 2017-08-18 13:48:46

Replying to [comment:4 dcoudert]:

Right, I also don't know what is the best way to do this.


---

Comment by dcoudert created at 2017-08-18 16:34:06

A way to postpone the problem is to raise a not implemented error for these cases.

With the previous implementation, we can get:

```
sage: G = Graph([(0,0)], loops=True)
sage: G.faces({0:[0]})
[[(0, 0)]]
```

Could this be considered as a trivial face ?


---

Comment by git created at 2017-08-19 09:37:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-08-19 09:48:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-08-19 09:58:21

I have fixed the issue with graphs without edge, ensuring that the result is the same has previous behavior. 
Actually, I did several tests with non-connected graphs, graphs without vertex/edge, etc. to compare former and new implementations. The behavior of the method remains the same. 

I have also fix some doctests in other modules. The change is only the order in which the elements of a set are displayed.

So I propose to let the open questions that may require special attention for another ticket. Here, we speedup the method without changing the behavior.


---

Comment by moritz created at 2017-08-21 08:25:55

Changing status from needs_review to positive_review.


---

Comment by moritz created at 2017-08-21 08:25:55

This looks good to me! Its faster then before and other than that gives the same results.


---

Comment by dcoudert created at 2017-08-21 09:10:45

Thanks.


---

Comment by vbraun created at 2017-08-26 09:57:37

Resolution: fixed
