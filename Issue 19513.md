# Issue 19513: singular genus crash

Issue created by migration from https://trac.sagemath.org/ticket/19750

Original creator: vbraun

Original creation time: 2015-12-19 12:52:12

CC:  jpflori jakobkroeker burcin

Keywords: singular random_fail

This crashes on my desktop in about 90% of the buildbot runs, has been for a while now

```
sage: P.<x,y,z> = QQ[] ## line 938 ##
sage: C= Curve((x-y)*(y-z)*(z-x));  ## line 939 ##
sage: import sage.libs.singular.function_factory ## line 940 ##
sage: sing_genus = sage.libs.singular.function_factory.ff.normal__lib.genus ## line 941 ##
// ** s_internalDelete: cannot delete type $INVALID$(-606348325)
------------------------------------------------------------------------
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x38a7)[0x7f21fc9e18a7]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x3a62)[0x7f21fc9e1a62]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x33c9)[0x7f21fc9e13c9]
/lib64/libpthread.so.0(+0x109f0)[0x7f22090d19f0]
/lib64/libc.so.6(cfree+0x22)[0x7f220867aca2]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(+0x15070d)[0x7f21deb9f70d]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z8killhdl2P5idrecPS0_P9sip_sring+0x223)[0x7f21deba068a]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z14killlocals_recPP5idreciP9sip_sring+0x59)[0x7f21deba70c0]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z14killlocals_recPP5idreciP9sip_sring+0x10d)[0x7f21deba7174]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z10killlocalsi+0x8b)[0x7f21deba7328]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z8iiPStartP5idrecP6sleftv+0x408)[0x7f21deba21d6]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z11iiMake_procP5idrecP11sip_packageP6sleftv+0x23e)[0x7f21deba25c9]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(+0x154130)[0x7f21deba3130]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z9iiLoadLIBP8_IO_FILEPKcPcP5idrecii+0x27c)[0x7f21deba33d2]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z8iiLibCmdPciii+0x179)[0x7f21deba2fa8]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z9iiLoadLIBP8_IO_FILEPKcPcP5idrecii+0x2d2)[0x7f21deba3428]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z8iiLibCmdPciii+0x179)[0x7f21deba2fa8]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z9iiLoadLIBP8_IO_FILEPKcPcP5idrecii+0x2d2)[0x7f21deba3428]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z8iiLibCmdPciii+0x179)[0x7f21deba2fa8]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z9iiLoadLIBP8_IO_FILEPKcPcP5idrecii+0x2d2)[0x7f21deba3428]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z8iiLibCmdPciii+0x179)[0x7f21deba2fa8]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/singular/function.so(+0x3d013)[0x7f21dd4bb013]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/singular/function.so(+0x3c623)[0x7f21dd4ba623]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15a9bd)[0x7f22094389bd]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x9096f)[0x7f220936e96f]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x6cb36)[0x7f220934ab36]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_CallFunctionObjArgs+0xe2)[0x7f220932f753]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0xf1ee2)[0x7f22093cfee2]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0xf21ad)[0x7f22093d01ad]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_GetAttr+0xd3)[0x7f2209396750]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6301)[0x7f2209431cbe]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x41)[0x7f220942b998]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15d71b)[0x7f220943b71b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x432d)[0x7f220942fcea]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b233)[0x7f2209439233]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b233)[0x7f2209439233]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b233)[0x7f2209439233]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x9096f)[0x7f220936e96f]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x6cb36)[0x7f220934ab36]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0xf1da4)[0x7f22093cfda4]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15bada)[0x7f2209439ada]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae1c)[0x7f2209438e1c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b233)[0x7f2209439233]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b119)[0x7f2209439119]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x9096f)[0x7f220936e96f]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x6cb36)[0x7f220934ab36]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0xf2b96)[0x7f22093d0b96]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0xdf525)[0x7f22093bd525]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f220932ea7c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15bada)[0x7f2209439ada]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae1c)[0x7f2209438e1c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b119)[0x7f2209439119]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b233)[0x7f2209439233]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b233)[0x7f2209439233]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b233)[0x7f2209439233]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b119)[0x7f2209439119]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15b119)[0x7f2209439119]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x15ae00)[0x7f2209438e00]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7c85)[0x7f2209433642]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x113f)[0x7f220943610b]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x41)[0x7f220942b998]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x18c616)[0x7f220946a616]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0xb7)[0x7f220946a59c]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0x2e6)[0x7f2209468c47]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x88)[0x7f2209468285]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(Py_Main+0xd2f)[0x7f220948460b]
python(main+0x20)[0x400846]
/lib64/libc.so.6(__libc_start_main+0xf0)[0x7f2208617580]
python(_start+0x29)[0x400759]
------------------------------------------------------------------------
Attaching gdb to process id 19394.
gdb: Symbol `PyBool_Type' has different size in shared object, consider re-linking
gdb: Symbol `_Py_TrueStruct' has different size in shared object, consider re-linking
gdb: Symbol `_Py_NoneStruct' has different size in shared object, consider re-linking
gdb: Symbol `_Py_NotImplementedStruct' has different size in shared object, consider re-linking
gdb: Symbol `PyFloat_Type' has different size in shared object, consider re-linking

Saved trace to /mnt/disk/home/buildslave-sage/slave/sage_git/crashlogs/sage_crash_X1UsuX.log
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
```



---

Comment by vbraun created at 2015-12-19 12:53:13

PS: genus has been buggy forever, e.g. #12851


---

Comment by vbraun created at 2015-12-19 13:05:44

New commits:


---

Comment by vbraun created at 2015-12-19 13:05:44

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-12-19 13:08:03

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-12-19 13:08:03

Replace `# not tested` by `# known bug`.


---

Comment by git created at 2015-12-19 15:35:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-12-19 15:35:51

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-12-20 09:24:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-12-20 18:20:33

Got the same crash again, must be either in normallib initialization or the function factory:

```
sage: C= Curve((x-y)*(y-z)*(z-x));  ## line 939 ##
sage: import sage.libs.singular.function_factory ## line 940 ##
sage: locAtZero = sage.libs.singular.function_factory.ff.normal__lib.locAtZero ## line 941 ##
// ** s_internalDelete: cannot delete type $INVALID$(-1378097090)
------------------------------------------------------------------------
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x38a7)[0x7fb5587e18a7]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x3a62)[0x7fb5587e1a62]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext/interrupt/interrupt.so(+0x33c9)[0x7fb5587e13c9]
/lib64/libpthread.so.0(+0x109f0)[0x7fb564ed19f0]
/lib64/libc.so.6(cfree+0x22)[0x7fb56447aca2]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(+0x15070d)[0x7fb53a99e70d]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z8killhdl2P5idrecPS0_P9sip_sring+0x223)[0x7fb53a99f68a]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z14killlocals_recPP5idreciP9sip_sring+0x59)[0x7fb53a9a60c0]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z14killlocals_recPP5idreciP9sip_sring+0x10d)[0x7fb53a9a6174]
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libsingular.so(_Z10killlocalsi+0x8b)[0x7fb53a9a6328]
```



---

Comment by vbraun created at 2015-12-20 18:21:18

For the record: this buildbot builds with `SAGE_DEBUG=yes`


---

Comment by vbraun created at 2015-12-20 18:22:18

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-12-28 20:36:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-12-28 23:16:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vbraun created at 2015-12-29 11:11:00

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2015-12-29 11:11:00

This now seems to work; Presumably the issue is in the normal.lib initialization. I posted it to libsingular-devel at https://groups.google.com/d/msg/libsingular-devel/jDIW-0k3QAo/2G8_kknfBAAJ


---

Comment by vbraun created at 2015-12-29 11:11:00

Changing priority from major to blocker.


---

Comment by vbraun created at 2016-01-09 10:17:19

anybody care to review?


---

Comment by fbissey created at 2016-01-12 22:39:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-13 21:09:08

Resolution: fixed
