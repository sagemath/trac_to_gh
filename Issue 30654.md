# Issue 30654: Normaliz cone from precomputed data has lattice messed up

archive/issues_030654.json:
```json
{
    "body": "CC:  jipilab @laisrast mkoeppe\n\nKeywords: normaliz, polytope\n\n\n```\nsage: p = Polyhedron(vertices=[(-3,-3), (3,0), (3,3), (0,3)], backend='normaliz')\nsage: q = loads(p.dumps)\nsage: p\nsage: p.ehrhart_series()                                                                                                                                                            \n(13*t^2 + 22*t + 1)/(-t^3 + 3*t^2 - 3*t + 1)\nsage: p.volume()                                                                                                                                                                    \n18\nsage: q.ehrhart_series()                                                                                                                                                            \n(t^2 + 2*t + 1)/(-t^3 + 3*t^2 - 3*t + 1)\nsage: q.volume()                                                                                                                                                                    \n2\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30891\n\n",
    "created_at": "2020-11-11T11:21:34Z",
    "labels": [
        "geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Normaliz cone from precomputed data has lattice messed up",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30654",
    "user": "@kliem"
}
```
CC:  jipilab @laisrast mkoeppe

Keywords: normaliz, polytope


```
sage: p = Polyhedron(vertices=[(-3,-3), (3,0), (3,3), (0,3)], backend='normaliz')
sage: q = loads(p.dumps)
sage: p
sage: p.ehrhart_series()                                                                                                                                                            
(13*t^2 + 22*t + 1)/(-t^3 + 3*t^2 - 3*t + 1)
sage: p.volume()                                                                                                                                                                    
18
sage: q.ehrhart_series()                                                                                                                                                            
(t^2 + 2*t + 1)/(-t^3 + 3*t^2 - 3*t + 1)
sage: q.volume()                                                                                                                                                                    
2
```


Issue created by migration from https://trac.sagemath.org/ticket/30891





---

archive/issue_comments_438174.json:
```json
{
    "body": "Normaliz data for `p`:\n\n\n```                                                                                    \n# ----8<---- Equivalent Normaliz input file ----8<----\namb_space 2\ncone 0\nsubspace 0\nvertices 4\n -3 -3 1\n 3 0 1\n 3 3 1\n 0 3 1\n# ----8<-------------------8<-------------------8<----\n# Calling PyNormaliz.NmzCone(cone=[], subspace=[], vertices=[[-3, -3, 1], [3, 0, 1], [3, 3, 1], [0, 3, 1]])\n```\n\n\nNormaliz data for `q`:\n\n\n```\n# ----8<---- Equivalent Normaliz input file ----8<----\namb_space 2\ndehomogenization 1\n 0 0 1\nextreme_rays 4\n -3 -3 1\n 0 3 1\n 3 0 1\n 3 3 1\ngenerated_lattice 3\n 3 0 0\n 0 3 0\n 0 0 1\nmaximal_subspace 0\nsupport_hyperplanes 4\n -1 0 3\n -1 2 3\n 0 -1 3\n 2 -1 3\n# ----8<-------------------8<-------------------8<----\n# Calling PyNormaliz.NmzCone(dehomogenization=[[0, 0, 1]], extreme_rays=[[-3, -3, 1], [0, 3, 1], [3, 0, 1], [3, 3, 1]], generated_lattice=[[3, 0, 0], [0, 3, 0], [0, 0, 1]], maximal_subspace=[], support_hyperplanes=[[-1, 0, 3], [-1, 2, 3], [0, -1, 3], [2, -1, 3]])\n```\n\n\nThe volume is probably a usage error, I did not consider the case where a \"cube\" in the generated lattice has volume not equal to `1`.\n\nOk, the other issue probably as well.\n\nThis raises a simple question in sage: Given rational vectors. How do I calculate integer vectors that generate the induced lattice? Actually the given vectors or integer, but for the mathematical question, I consider them to be rational.",
    "created_at": "2020-11-11T11:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438174",
    "user": "@kliem"
}
```

Normaliz data for `p`:


```                                                                                    
# ----8<---- Equivalent Normaliz input file ----8<----
amb_space 2
cone 0
subspace 0
vertices 4
 -3 -3 1
 3 0 1
 3 3 1
 0 3 1
# ----8<-------------------8<-------------------8<----
# Calling PyNormaliz.NmzCone(cone=[], subspace=[], vertices=[[-3, -3, 1], [3, 0, 1], [3, 3, 1], [0, 3, 1]])
```


Normaliz data for `q`:


```
# ----8<---- Equivalent Normaliz input file ----8<----
amb_space 2
dehomogenization 1
 0 0 1
extreme_rays 4
 -3 -3 1
 0 3 1
 3 0 1
 3 3 1
generated_lattice 3
 3 0 0
 0 3 0
 0 0 1
maximal_subspace 0
support_hyperplanes 4
 -1 0 3
 -1 2 3
 0 -1 3
 2 -1 3
# ----8<-------------------8<-------------------8<----
# Calling PyNormaliz.NmzCone(dehomogenization=[[0, 0, 1]], extreme_rays=[[-3, -3, 1], [0, 3, 1], [3, 0, 1], [3, 3, 1]], generated_lattice=[[3, 0, 0], [0, 3, 0], [0, 0, 1]], maximal_subspace=[], support_hyperplanes=[[-1, 0, 3], [-1, 2, 3], [0, -1, 3], [2, -1, 3]])
```


The volume is probably a usage error, I did not consider the case where a "cube" in the generated lattice has volume not equal to `1`.

Ok, the other issue probably as well.

This raises a simple question in sage: Given rational vectors. How do I calculate integer vectors that generate the induced lattice? Actually the given vectors or integer, but for the mathematical question, I consider them to be rational.



---

archive/issue_comments_438175.json:
```json
{
    "body": "I guess the solution to the second part also solves the first part, because in case of the volume the generated lattice is always the entire lattice (otherwise the \"ambient\" volume is zero anyway).",
    "created_at": "2020-11-11T11:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438175",
    "user": "@kliem"
}
```

I guess the solution to the second part also solves the first part, because in case of the volume the generated lattice is always the entire lattice (otherwise the "ambient" volume is zero anyway).



---

archive/issue_comments_438176.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-12T07:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438176",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438177.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-11-12T07:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438177",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_438178.json:
```json
{
    "body": "Forgot the optional flags. I don't know, when I will ever remember (and get it right on the first try).\n----\nNew commits:",
    "created_at": "2020-12-01T18:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438178",
    "user": "@kliem"
}
```

Forgot the optional flags. I don't know, when I will ever remember (and get it right on the first try).
----
New commits:



---

archive/issue_comments_438179.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-01T18:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438179",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438180.json:
```json
{
    "body": "Thank you.",
    "created_at": "2020-12-01T18:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438180",
    "user": "@kliem"
}
```

Thank you.



---

archive/issue_comments_438181.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-06T12:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30654",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30654#issuecomment-438181",
    "user": "vbraun"
}
```

Resolution: fixed
