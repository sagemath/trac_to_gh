# Issue 30654: Normaliz cone from precomputed data has lattice messed up

Issue created by migration from https://trac.sagemath.org/ticket/30891

Original creator: @kliem

Original creation time: 2020-11-11 11:21:34

CC:  jipilab @laisrast mkoeppe

Keywords: normaliz, polytope


```
sage: p = Polyhedron(vertices=[(-3,-3), (3,0), (3,3), (0,3)], backend='normaliz')
sage: q = loads(p.dumps)
sage: p
sage: p.ehrhart_series()                                                                                                                                                            
(13*t^2 + 22*t + 1)/(-t^3 + 3*t^2 - 3*t + 1)
sage: p.volume()                                                                                                                                                                    
18
sage: q.ehrhart_series()                                                                                                                                                            
(t^2 + 2*t + 1)/(-t^3 + 3*t^2 - 3*t + 1)
sage: q.volume()                                                                                                                                                                    
2
```



---

Comment by @kliem created at 2020-11-11 11:32:26

Normaliz data for `p`:


```                                                                                    
# ----8<---- Equivalent Normaliz input file ----8<----
amb_space 2
cone 0
subspace 0
vertices 4
 -3 -3 1
 3 0 1
 3 3 1
 0 3 1
# ----8<-------------------8<-------------------8<----
# Calling PyNormaliz.NmzCone(cone=[], subspace=[], vertices=[[-3, -3, 1], [3, 0, 1], [3, 3, 1], [0, 3, 1]])
```


Normaliz data for `q`:


```
# ----8<---- Equivalent Normaliz input file ----8<----
amb_space 2
dehomogenization 1
 0 0 1
extreme_rays 4
 -3 -3 1
 0 3 1
 3 0 1
 3 3 1
generated_lattice 3
 3 0 0
 0 3 0
 0 0 1
maximal_subspace 0
support_hyperplanes 4
 -1 0 3
 -1 2 3
 0 -1 3
 2 -1 3
# ----8<-------------------8<-------------------8<----
# Calling PyNormaliz.NmzCone(dehomogenization=[[0, 0, 1]], extreme_rays=[[-3, -3, 1], [0, 3, 1], [3, 0, 1], [3, 3, 1]], generated_lattice=[[3, 0, 0], [0, 3, 0], [0, 0, 1]], maximal_subspace=[], support_hyperplanes=[[-1, 0, 3], [-1, 2, 3], [0, -1, 3], [2, -1, 3]])
```


The volume is probably a usage error, I did not consider the case where a "cube" in the generated lattice has volume not equal to `1`.

Ok, the other issue probably as well.

This raises a simple question in sage: Given rational vectors. How do I calculate integer vectors that generate the induced lattice? Actually the given vectors or integer, but for the mathematical question, I consider them to be rational.


---

Comment by @kliem created at 2020-11-11 11:35:48

I guess the solution to the second part also solves the first part, because in case of the volume the generated lattice is always the entire lattice (otherwise the "ambient" volume is zero anyway).


---

Comment by @kliem created at 2020-11-12 07:34:17

Changing status from new to needs_review.


---

Comment by @kliem created at 2020-11-12 07:34:17

New commits:


---

Comment by @kliem created at 2020-12-01 18:19:33

Forgot the optional flags. I don't know, when I will ever remember (and get it right on the first try).
----
New commits:


---

Comment by mkoeppe created at 2020-12-01 18:53:44

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-12-01 18:59:01

Thank you.


---

Comment by vbraun created at 2020-12-06 12:49:42

Resolution: fixed
