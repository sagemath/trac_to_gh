# Issue 28029: Improve speed of diagram algebra multiplication

Issue created by migration from https://trac.sagemath.org/ticket/28266

Original creator: tscrim

Original creation time: 2019-07-26 06:37:39

CC:  sage-combinat zabrocki aschilling

Keywords: diagram algebra

The current implementation works by constructing a graph and using the connected components of that. Not only does this create (complicated) transient objects, it is all done in Python. This provides a direct implementation in Cython.


---

Comment by tscrim created at 2019-07-26 06:44:37

I get a ~5x speedup with the current implementation. With branch:

```
sage: R.<x> = ZZ[]
sage: P = PartitionAlgebra(4, x)
sage: P1 = P[[1],[-1],[2,3],[4,-2],[-3,-4]]
sage: P2 = P[[1],[2,-2],[3,4],[-1,-3],[-4]]
sage: P3 = P.one()
sage: %timeit P1 * P2
10000 loops, best of 3: 32.9 µs per loop
sage: %timeit P2 * P1
10000 loops, best of 3: 33.6 µs per loop
sage: %timeit P1 * P3
10000 loops, best of 3: 32.6 µs per loop
sage: %timeit P3 * P1
10000 loops, best of 3: 31.5 µs per loop
sage: %timeit P2 * P3
10000 loops, best of 3: 32.5 µs per loop
sage: %timeit P3 * P2
10000 loops, best of 3: 32.8 µs per loop
```

vs before:

```
sage: %timeit P1 * P2
10000 loops, best of 3: 150 µs per loop
sage: %timeit P2 * P1
10000 loops, best of 3: 145 µs per loop
sage: %timeit P1 * P3
10000 loops, best of 3: 143 µs per loop
sage: %timeit P3 * P1
10000 loops, best of 3: 142 µs per loop
sage: %timeit P2 * P3
10000 loops, best of 3: 144 µs per loop
sage: %timeit P3 * P2
10000 loops, best of 3: 145 µs per loop
```

----
New commits:


---

Comment by tscrim created at 2019-07-26 06:44:37

Changing status from new to needs_review.


---

Comment by zabrocki created at 2019-07-27 02:02:40

Changing status from needs_review to positive_review.


---

Comment by zabrocki created at 2019-07-27 02:02:40

This is really nice.  I ran the doctests and all passes.
I tried multiplying a few elements in the wild (not single diagrams, but linear combinations) and I see ~2x speedup in total at n=3.


---

Comment by aschilling created at 2019-07-27 03:46:22

I also checked the patch and it works well. I get similar speedups to Travis!


---

Comment by tscrim created at 2019-07-27 05:49:27

Replying to [comment:2 zabrocki]:
> This is really nice.  I ran the doctests and all passes.

Thank you for doing the review.

> I tried multiplying a few elements in the wild (not single diagrams, but linear combinations) and I see ~2x speedup in total at n=3.

I think the linear combination code starts becoming the time sink. Unfortunately I don't see how to speed that part up. `:/` Yet, it is very good to see that it still is getting a ~2x speed improvement.


---

Comment by vbraun created at 2019-07-29 21:54:32

Resolution: fixed
