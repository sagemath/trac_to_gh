# Issue 21043: cached_method does not cache return value None

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2016-08-18 12:10:02


```
class N(object):
    
    `@`cached_method
    def blub(self):
        print('called P.blub')
        return 3

    `@`cached_method
    def noblub(self):
        print('called P.noblub')
        return None
    
n = N()
print n.blub()
print n.blub()
print '---'
print n.noblub()
print n.noblub()
```

results in

```
called P.blub
3
3
---
called P.noblub
None
called P.noblub
None
```

which demonstrates that a return value `None` is **not** cached.

This is also in contrast to

```
`@`cached_function
def c():
    print('called c')
    return None

print c()
print c()
```

which results in

```
called c
None
None
```

i.e., it works with `cached_function`


---

Comment by tscrim created at 2016-08-18 13:15:44

One thing to be mindful of is that all Python functions implicitly return `None` when no return value is given. Granted, I don't see a reason why one would write something as ``@`cached_method` when it doesn't have a return value and not want it cached. Although it might have to do when the function raises an exception. Anyways, something to just kind in mind.


---

Comment by nbruin created at 2016-08-18 14:20:15

It's a peculiarity of `CachedMethodCallerNoArgs`: it uses `None` as a sentinel value to indicate an uninitialized cache. If we create a private sentinel (i.e., declare a value `UnitializedCacheSentinel=object()` in the file and use that) the problem should be gone. Be careful, though: pickling will need attention to deal with legacy cases.
