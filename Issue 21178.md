# Issue 21178: Iterator over all orientations of a graph

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2016-09-04 23:05:45

CC:  jmantysalo

I was asked if Sage provides code to iterate over all orientations of a graph. We should add this to Sage.


---

Comment by tscrim created at 2016-09-04 23:06:21

Here is some code that does it:

```sage
def all_orientations(G):
    from itertools import product
    E = [[(u,v,label), (v,u,label)] for u,v,label in G.edges()]
    verts = G.vertices()
    for edges in product(*E):
        yield DiGraph([verts, edges], format='vertices_and_edges')
```



---

Comment by jmantysalo created at 2016-09-05 05:17:42

Seems reasonable. So this needs just definition, examples and so on. The graph may not have multiple edges nor loops, but it can have weight (or other labels) assigned to edges.

I can see no easy way to optimize this, `product` already does what is possible.


---

Comment by jmantysalo created at 2016-09-05 07:04:38

Something like this for docstring?


```
    """
    Return an iterator over orientations of the graph.
    
    An *orientation* of an undirected graph is a directed
    graph such that every edge is assigned a direction.
    Hence there are `2^s` oriented digraphs for a graph
    with `s` edges.
    
    EXAMPLES::
        
        sage: G = Graph([[1,2,3], [(1, 2, 'a'), (1, 3, 'b')]], format='vertices_and_edges')
        sage: it = G.all_orientations()
        sage: D = it.next()
        sage: D.edges()  # Random order for orientations
        [(1, 2, 'a'), (1, 3, 'b')]
        sage: D = it.next()
        sage: D.edges()  # Random order for orientations
        [(2, 1, 'a'), (1, 3, 'b')]
    
    TESTS::
        
        sage: G = Graph()
        sage: G_ = [g for g in G.all_orientations()]
        sage: len(G_)
        1
        sage: G_[0]
        Digraph on 0 vertices
        
        sage: G = Graph(5)
        sage: it = G.all_orientations()
        sage: G_ = next(it)
        sage: G_.size()
        0
    """
```


Should the name be `all_orientations()` or just `orientations()`?


---

Comment by tscrim created at 2016-09-05 14:44:28

`orientations` is probably better. I was thinking of actually making one function for the iterator and one for the list. What do you think?


---

Comment by tscrim created at 2016-09-05 14:46:01

Also, the docstring looks good. We will just have to add some tests for multiedges and/or loops. However, the order of the iterator and edges should be consistent when the vertices have a total ordering (like the integers).


---

Comment by jmantysalo created at 2016-09-05 14:59:51

I didn't know that `sort=True` is the default for `edges`. Actually I didn't even know about the option. But that is good, we can have easier examples.

Many graph functions already have both list and iterator versions, so I guess it makes sense to have both. But if unsure, add only iterator. Python seems to be changing more iterator-style, `range` vs. `xrange`, but I don't know if it should affect us.


---

Comment by tmonteil created at 2016-09-05 20:36:50

See also [this ask question](https://ask.sagemath.org/question/34711/how-to-get-an-arbitrary-orientation-of-a-graph/). The suggested solution is of course not optimal since we create list and then check membership (the idea was to show how to easily reuse existing code), but it deals with data structure, embedding, etc.


---

Comment by dcoudert created at 2016-09-06 11:27:21

The solution proposed in [this ask question](https://ask.sagemath.org/question/34711/how-to-get-an-arbitrary-orientation-of-a-graph/) is certainly more expensive than the solution proposed above. However, the decoration of the method (data structure, etc.) is interesting.

I suggest to avoid a method able to return all orientations at once: too huge list. An iterator seem much more appropriate.
Also, we may have an option to iterate over a random ordering of the orientations, for instance using this simple trick
`E = [[(u,v,l), (v,u,l)] if randint(0,1) else [(v,u,l), (u,v,l)]   for u,v,l in G.edges()]`

Another option is to use gray codes or revolving door principles to ensure that two consecutive orientations have very little modifications. It will not change the validity of the method, just the ordering. So we may save some time using the copy method of digraph and then applying the minor changes instead of creating a completely new graph.
See e.g. [the doc on gray code of simpy](http://docs.sympy.org/dev/modules/combinatorics/graycode.html) and [discussion on sage-combinat-devel](https://groups.google.com/forum/#!topic/sage-combinat-devel/EbPNFXTKmHU). Admittedly more tricky to code.


---

Comment by tscrim created at 2016-09-18 15:58:54

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-09-18 15:58:54

I would say Python is not switching to more iterator style per-se, but having default behavior that is more practical for the typical programming purpose.

I put the code into a branch, taking some from the ask answer, and kept only an iterator because of how big is does get.
----
New commits:


---

Comment by jmantysalo created at 2016-09-18 16:46:59

- `implementation` is missing from the `INPUT` block.

- "optional" at documentation of parameter `sparse` is strange, and `data_structure` does not have it; that is inconsistent.

- Spaces in the line after one-line description (and that makes index of functions quite bad).

- Is it meaningful to copy name of original graph? Sounds strange to have a directed Petersen graph.

Otherwise it seems to work, attributes for allowing loops and/or multiedges works and so on.


---

Comment by jmantysalo created at 2016-09-18 16:46:59

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2016-09-18 17:05:05

Replying to [comment:10 jmantysalo]:
> - `implementation` is missing from the `INPUT` block.

This is not included in _any_ documentation. I am following suit.

> - "optional" at documentation of parameter `sparse` is strange, and `data_structure` does not have it; that is inconsistent.

`sparse` is there as a shorthand for (the necessary) `data_structure`, so it is optional.

> - Spaces in the line after one-line description (and that makes index of functions quite bad).

Will fix.

> - Is it meaningful to copy name of original graph? Sounds strange to have a directed Petersen graph.

Should we add "directed" to the front of the name or just drop it altogether? I don't have a preference on this.

> Otherwise it seems to work, attributes for allowing loops and/or multiedges works and so on.

I will also add tests for non-simple graphs.


---

Comment by jmantysalo created at 2016-09-18 18:16:17

Replying to [comment:11 tscrim]:

> > - `implementation` is missing from the `INPUT` block.
> 
> This is not included in _any_ documentation. I am following suit.

OK.

> > - "optional" at documentation of parameter `sparse` is strange, and `data_structure` does not have it; that is inconsistent.
> 
> `sparse` is there as a shorthand for (the necessary) `data_structure`, so it is optional.

I do not understand. Both parameters are optional, as both have a default value. But whatever, won't block me from giving review.

> > - Is it meaningful to copy name of original graph? Sounds strange to have a directed Petersen graph.
> 
> Should we add "directed" to the front of the name or just drop it altogether? I don't have a preference on this.

No, not "directed". Maybe "An orientation of ..." or nothing. I can't say either.

> > Otherwise it seems to work, attributes for allowing loops and/or multiedges works and so on.

> I will also add tests for non-simple graphs.

OK. I can review this.


---

Comment by git created at 2016-09-19 16:59:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-19 17:03:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-09-19 17:03:57

Replying to [comment:12 jmantysalo]:
> Replying to [comment:11 tscrim]:
> > > - "optional" at documentation of parameter `sparse` is strange, and `data_structure` does not have it; that is inconsistent.
> > 
> > `sparse` is there as a shorthand for (the necessary) `data_structure`, so it is optional.
> 
> I do not understand. Both parameters are optional, as both have a default value. But whatever, won't block me from giving review.

How I see it, `data_structure` is necessary, even though it has a default value, but `sparse` is not.

> > > - Is it meaningful to copy name of original graph? Sounds strange to have a directed Petersen graph.
> > 
> > Should we add "directed" to the front of the name or just drop it altogether? I don't have a preference on this.
> 
> No, not "directed". Maybe "An orientation of ..." or nothing. I can't say either.

I added "An orientation of" when a name is specified.

I've addressed all of the mentioned issues.


---

Comment by jmantysalo created at 2016-09-19 17:27:07

Seems good and tests passed, documentation builds etc.

But only now, when you added a test for multigraphs, I really thinked about this; sorry about being late. What about orientations of `Graph({1: [2, 2]}, multiedges=True)`? The code gives 4, but only 3 different. Same applies to graphs with loops.

I don't know how we should address this. But at a minimun this should be documented.


---

Comment by tscrim created at 2016-09-19 17:53:35

Actually, the loop is wrong; for that, either orientation is equivalent. However, for the multiedges, you just can't distinguish them. I think it would be much harder to code that, so I will just document the behavior.


---

Comment by git created at 2016-09-19 17:57:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-09-19 18:37:31

OK, I am happy with these. Please mark as _positive_review_ if you are ready; as you did not put this to _needs_review_, I am not sure if you still want to make some changes.


---

Comment by jmantysalo created at 2016-09-19 18:37:31

Changing status from needs_work to positive_review.


---

Comment by jmantysalo created at 2016-09-19 18:38:04

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2016-09-19 21:03:19

I just forgot to set it back. Thanks!


---

Comment by tscrim created at 2016-09-19 21:03:19

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-09-21 20:15:39

Resolution: fixed
