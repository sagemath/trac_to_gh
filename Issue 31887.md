# Issue 31887: SL2Z.random_element unstable

Issue created by migration from https://trac.sagemath.org/ticket/32124

Original creator: @kliem

Original creation time: 2021-07-04 09:40:14


```
sage: for _ in range(1000): _ = SL2Z.random_element(5, distribution='1/n')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-18-454018fc8ca8> in <module>
----> 1 for _ in range(Integer(1000)): _ = SL2Z.random_element(Integer(5), distribution='1/n')

~/Applications/sage/local/lib/python3.8/site-packages/sage/modular/arithgroup/congroup_sl2z.py in random_element(self, bound, *args, **kwds)
    212         d = ZZ.random_element(1-bound, bound, *args, **kwds)
    213         if gcd(c,d) != 1: # try again
--> 214             return self.random_element(bound, *args, **kwds)
    215         else:
    216             a,b,c,d = lift_to_sl2z(c,d,0)

~/Applications/sage/local/lib/python3.8/site-packages/sage/modular/arithgroup/congroup_sl2z.py in random_element(self, bound, *args, **kwds)
    231                 wlo = min(wlo, ((bound - b)/ZZ(-d)).ceil())
    232 
--> 233             w = ZZ.random_element(1-wlo, whi, *args, **kwds)
    234             a += c*w
    235             b += d*w

~/Applications/sage/local/lib/python3.8/site-packages/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class.random_element (build/cythonized/sage/rings/integer_ring.c:6515)()
    715             raise TypeError("x must be > 0")
    716         if x is not None and y is not None and x >= y:
--> 717             raise TypeError("x must be < y")
    718         self._randomize_mpz(z.value, x, y, distribution)
    719         return z

TypeError: x must be < y
```



---

Comment by @kliem created at 2021-07-04 10:35:12

I would say the problem is in `ZZ.random_element`. It claims that `x` and `y` are ignored, if the distribution is `'1/n'`. However, it still raises an error if `y >= x`, which is not what I would call ignoring `x` and `y`.


---

Comment by @kliem created at 2021-07-04 12:36:43

New commits:


---

Comment by @kliem created at 2021-07-04 12:36:43

Changing status from new to needs_review.


---

Comment by dimpase created at 2021-07-04 16:23:04

good catch!


---

Comment by chapoton created at 2021-07-06 07:29:38

ok, let it be


---

Comment by chapoton created at 2021-07-06 07:29:38

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2021-07-06 07:32:09

Thank you.


---

Comment by vbraun created at 2021-07-23 20:10:30

Resolution: fixed
