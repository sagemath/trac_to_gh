# Issue 31887: SL2Z.random_element unstable

archive/issues_031887.json:
```json
{
    "body": "\n```\nsage: for _ in range(1000): _ = SL2Z.random_element(5, distribution='1/n')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-18-454018fc8ca8> in <module>\n----> 1 for _ in range(Integer(1000)): _ = SL2Z.random_element(Integer(5), distribution='1/n')\n\n~/Applications/sage/local/lib/python3.8/site-packages/sage/modular/arithgroup/congroup_sl2z.py in random_element(self, bound, *args, **kwds)\n    212         d = ZZ.random_element(1-bound, bound, *args, **kwds)\n    213         if gcd(c,d) != 1: # try again\n--> 214             return self.random_element(bound, *args, **kwds)\n    215         else:\n    216             a,b,c,d = lift_to_sl2z(c,d,0)\n\n~/Applications/sage/local/lib/python3.8/site-packages/sage/modular/arithgroup/congroup_sl2z.py in random_element(self, bound, *args, **kwds)\n    231                 wlo = min(wlo, ((bound - b)/ZZ(-d)).ceil())\n    232 \n--> 233             w = ZZ.random_element(1-wlo, whi, *args, **kwds)\n    234             a += c*w\n    235             b += d*w\n\n~/Applications/sage/local/lib/python3.8/site-packages/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class.random_element (build/cythonized/sage/rings/integer_ring.c:6515)()\n    715             raise TypeError(\"x must be > 0\")\n    716         if x is not None and y is not None and x >= y:\n--> 717             raise TypeError(\"x must be < y\")\n    718         self._randomize_mpz(z.value, x, y, distribution)\n    719         return z\n\nTypeError: x must be < y\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32124\n\n",
    "created_at": "2021-07-04T09:40:14Z",
    "labels": [
        "modular forms",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "SL2Z.random_element unstable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31887",
    "user": "@kliem"
}
```

```
sage: for _ in range(1000): _ = SL2Z.random_element(5, distribution='1/n')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-18-454018fc8ca8> in <module>
----> 1 for _ in range(Integer(1000)): _ = SL2Z.random_element(Integer(5), distribution='1/n')

~/Applications/sage/local/lib/python3.8/site-packages/sage/modular/arithgroup/congroup_sl2z.py in random_element(self, bound, *args, **kwds)
    212         d = ZZ.random_element(1-bound, bound, *args, **kwds)
    213         if gcd(c,d) != 1: # try again
--> 214             return self.random_element(bound, *args, **kwds)
    215         else:
    216             a,b,c,d = lift_to_sl2z(c,d,0)

~/Applications/sage/local/lib/python3.8/site-packages/sage/modular/arithgroup/congroup_sl2z.py in random_element(self, bound, *args, **kwds)
    231                 wlo = min(wlo, ((bound - b)/ZZ(-d)).ceil())
    232 
--> 233             w = ZZ.random_element(1-wlo, whi, *args, **kwds)
    234             a += c*w
    235             b += d*w

~/Applications/sage/local/lib/python3.8/site-packages/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class.random_element (build/cythonized/sage/rings/integer_ring.c:6515)()
    715             raise TypeError("x must be > 0")
    716         if x is not None and y is not None and x >= y:
--> 717             raise TypeError("x must be < y")
    718         self._randomize_mpz(z.value, x, y, distribution)
    719         return z

TypeError: x must be < y
```


Issue created by migration from https://trac.sagemath.org/ticket/32124





---

archive/issue_comments_455687.json:
```json
{
    "body": "I would say the problem is in `ZZ.random_element`. It claims that `x` and `y` are ignored, if the distribution is `'1/n'`. However, it still raises an error if `y >= x`, which is not what I would call ignoring `x` and `y`.",
    "created_at": "2021-07-04T10:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455687",
    "user": "@kliem"
}
```

I would say the problem is in `ZZ.random_element`. It claims that `x` and `y` are ignored, if the distribution is `'1/n'`. However, it still raises an error if `y >= x`, which is not what I would call ignoring `x` and `y`.



---

archive/issue_comments_455688.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-07-04T12:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455688",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_455689.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-04T12:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455689",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_455690.json:
```json
{
    "body": "good catch!",
    "created_at": "2021-07-04T16:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455690",
    "user": "dimpase"
}
```

good catch!



---

archive/issue_comments_455691.json:
```json
{
    "body": "ok, let it be",
    "created_at": "2021-07-06T07:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455691",
    "user": "chapoton"
}
```

ok, let it be



---

archive/issue_comments_455692.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-06T07:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455692",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_455693.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-07-06T07:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455693",
    "user": "@kliem"
}
```

Thank you.



---

archive/issue_comments_455694.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-23T20:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31887#issuecomment-455694",
    "user": "vbraun"
}
```

Resolution: fixed
