# Issue 12986: Local components bug finding minimal twist

Issue created by migration from https://trac.sagemath.org/ticket/13158

Original creator: davidloeffler

Original creation time: 2012-06-25 08:53:24

Assignee: craigcitro

Keywords: local components

The following is from an email of François Brunault:

I got the following error when trying to compute minimal twists in Sage. Here f is the newform attached to the elliptic curve 256a1, and the minimal twist of f has level 64.

Best,
François

```
sage: f=Newforms(256,names='a')[0]
sage: T=TypeSpace(f,2)
sage: T.is_minimal()
False
sage: T.minimal_twist()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/Users/francoisbrunault/<ipython console> in <module>()

/Users/francoisbrunault/Documents/SAGE/sage-5.0.beta13/local/lib/python2.7/site-packages/sage/modular/local_comp/type_space.pyc in minimal_twist(self)
   383             D._set_sign(D.star_eigenvalues()[0])
   384         M = ModularForms(D.group(), D.weight())
--> 385         ff = Newform(M, D, names='a')
   386         return ff
   387

/Users/francoisbrunault/Documents/SAGE/sage-5.0.beta13/local/lib/python2.7/site-packages/sage/modular/modform/element.pyc in __init__(self, parent, component, names, check)
   636                 raise ValueError, "component must be cuspidal"
   637             if not component.is_simple():
--> 638                 raise ValueError, "component must be simple"
   639         extension_field = component.eigenvalue(1,name=names).parent()
   640         if extension_field != parent.base_ring(): # .degree() != 1 and rings.is_NumberField(extension_field):

ValueError: component must be simple
```



---

Comment by davidloeffler created at 2015-06-10 13:36:40

Somehow, this sat idle for 3 years despite the fact that the fix is about 2 lines! It turns out that the code relies on the assumption that the trace of the type space down to the minimal level is simple, but if f is of CM type it can be the direct sum of two simple modules of opposite sign.
----
New commits:


---

Comment by davidloeffler created at 2015-06-10 13:36:40

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-06-29 13:48:46

This looks good to me. I have only made minor changes, and allow myself to set to positive review.
----
New commits:


---

Comment by chapoton created at 2015-06-29 13:48:46

Changing status from needs_review to positive_review.


---

Comment by davidloeffler created at 2015-06-29 14:49:30

Thanks for the review! The patchbot seems a bit confused, but I'm sure it'll catch up shortly :-)


---

Comment by vbraun created at 2015-06-30 12:57:51

Resolution: fixed
