# Issue 13476: unset BZIP2 in the build process

Issue created by migration from https://trac.sagemath.org/ticket/13680

Original creator: zieglerk

Original creation time: 2012-11-02 20:27:47

Assignee: GeorgSWeber

CC:  mjo

Keywords: bzip2, build, environment variable

Building Sage 5.3 (and also 4.8 and 5.2) on Ubuntu 12.04 (32-bit and 64-bit) will abort during the tests for building bzip2, if the user has set the environment variable BZIP2 -- although bzip2's man page permits that to specify default options.

The relevant part of the log (given 'export BZIP2="-9"') reads


```
bzip2-1.0.6
====================================================
Extracting package /home/zieglerk/local/share/sage/spkg/standard/bzip2-1.0.6.spkg
-rw-r--r-- 1 zieglerk zieglerk 796422 May 14 14:56 /home/zieglerk/local/share/sage/spkg/standard/bzip2-1.0.6.spkg
Finished extraction
****************************************************
Host system:
Linux ulysses 3.2.0-31-generic-pae #50-Ubuntu SMP Fri Sep 7 16:39:45 UTC 2012 i686 i686 i386 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/i686-linux-gnu/4.6/lto-wrapper
Target: i686-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.6.3-1ubuntu5' --with-bugurl=file:///usr/share/doc/gcc-4.6/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.6 --enable-shared --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.6 --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-gnu-unique-object --enable-plugin --enable-objc-gc --enable-targets=all --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=i686-linux-gnu --host=i686-linux-gnu --target=i686-linux-gnu
Thread model: posix
gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5)
****************************************************
make[2]: Entering directory `/home/zieglerk/local/share/sage/spkg/build/bzip2-1.0.6/src'
gcc -fPIC -O2 -g  -c huffman.c
gcc -fPIC -O2 -g  -c blocksort.c
gcc -fPIC -O2 -g  -c crctable.c
gcc -fPIC -O2 -g  -c randtable.c
gcc -fPIC -O2 -g  -c compress.c
gcc -fPIC -O2 -g  -c decompress.c
gcc -fPIC -O2 -g  -c bzlib.c
gcc -fPIC -O2 -g  -c bzip2.c
bzip2.c: In function ‘applySavedFileAttrToOutputFile’:
bzip2.c:1073:4: warning: ignoring return value of ‘fchown’, declared with attribute warn_unused_result [-Wunused-result]
gcc -fPIC -O2 -g  -c bzip2recover.c
gcc -fPIC -O2 -g   -o bzip2recover bzip2recover.o
rm -f libbz2.a
ar cq libbz2.a blocksort.o huffman.o crctable.o randtable.o compress.o decompress.o bzlib.o
ranlib libbz2.a
gcc -fPIC -O2 -g   -o bzip2 bzip2.o -L. -lbz2

Doing 6 tests (3 compress, 3 uncompress) ...
If there's a problem, things might stop at this point.

./bzip2 -1  < sample1.ref > sample1.rb2
bzip2: Can't open input file bzip2-1.0.6: No such file or directory.
make[2]: *** [test] Error 1
make[2]: Leaving directory `/home/zieglerk/local/share/sage/spkg/build/bzip2-1.0.6/src'
Error building bzip2
************************************************************************
Error installing package bzip2-1.0.6
```


After 'unset BZIP2' the installation runs straight through. 

This was discussed on
https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/GI3t5CQEz54
and Volker Braun suggested to "unset BZIP2 in the build process" (and also that I file this ticket).


---

Comment by mjo created at 2020-08-31 01:51:13

This is an upstream issue, not necessarily a sage problem:

https://gitlab.com/federicomenaquintero/bzip2/-/issues/31
