# Issue 25668: Missing translation of FriCAS result

archive/issues_025668.json:
```json
{
    "body": "CC:  @mantepse\n\nKeywords: fricas,integrate\n\nI am not sure what is missing translation from FriCAS result to [SageMath](SageMath) here, and do not know if this is known of not. Thought to report it just in case but feel free to close if this is known.\n\nLarge number of such integrals fail because of this. Here is an example\n\n\n\n```\nSageMath version 8.3.rc2, Release Date: 2018-07-22   \n\nsage: var('a d x c')\n(a, d, x, c)\nsage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x, algorithm=\"fricas\")\n\n```\n\n\nWhich gives\n\n\n\n```\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-2-f02be8032da4> in <module>()\n----> 1 integrate((I*a*tan(d*x + c) + a)**Integer(3)*tan(d*x + c),x, algorithm=\"fricas\")\n\n/usr/lib/python2.7/site-packages/sage/misc/functional.py in integral(x, *args, **kwds)\n    751     \"\"\"\n    752     if hasattr(x, 'integral'):\n--> 753         return x.integral(*args, **kwds)\n    754     else:\n    755         from sage.symbolic.ring import SR\n\n/usr/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.integral (build/cythonized/sage/symbolic/expression.cpp:69759)()\n  12364                     R = ring.SR\n  12365             return R(integral(f, v, a, b, **kwds))\n> 12366         return integral(self, *args, **kwds)\n  12367 \n  12368     integrate = integral\n\n/usr/lib/python2.7/site-packages/sage/symbolic/integration/integral.py in integrate(expression, v, a, b, algorithm, hold)\n    814         if not integrator:\n    815             raise ValueError(\"Unknown algorithm: %s\" % algorithm)\n--> 816         return integrator(expression, v, a, b)\n    817     if a is None:\n    818         return indefinite_integral(expression, v, hold=hold)\n\n/usr/lib/python2.7/site-packages/sage/symbolic/integration/external.py in fricas_integrator(expression, v, a, b, noPole)\n    189                          \" in the integration interval\")\n    190 \n--> 191     return result.sage()\n    192 \n    193 \n\n/usr/lib/python2.7/site-packages/sage/interfaces/interface.py in sage(self, *args, **kwds)\n   1049             [0 0]\n   1050         \"\"\"\n-> 1051         return self._sage_(*args, **kwds)\n   1052 \n   1053     def __repr__(self):\n\n/usr/lib/python2.7/site-packages/sage/interfaces/fricas.py in _sage_(self)\n   1443             return R(unparsed_InputForm)\n   1444 \n-> 1445         raise NotImplementedError(\"The translation of the FriCAS object %s to sage is not yet implemented.\" %(unparsed_InputForm))\n   1446 \n   1447 \n\nNotImplementedError: The translation of the FriCAS object sage2 to sage is not yet implemented.\nsage: \n\n\n```\n\n\nThe above works OK in friCAS itself:\n\n\n\n```\n>fricas\nAXIOM=\"/usr/lib/fricas/target/x86_64-linux-gnu\"\nspad-lib=\"/usr/lib/fricas/target/x86_64-linux-gnu/lib/libspad.so\"\n                       FriCAS Computer Algebra System \n                            Version: FriCAS 1.3.4\n                   Timestamp: Thu Jun 28 08:31:47 CDT 2018\n(3) -> r:=integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x);\n(4) -> unparse(r::InputForm) \n\n   (4)\n  \"((9*I^2+(-3))*a^3*log(1/(tan(d*x+c)^2+1))+(2*I^3*a^3*tan(d*x+c)^3+9*I^2*a^3*\n  tan(d*x+c)^2+((-6)*I^3+18*I)*a^3*tan(d*x+c)+(6*I^3+(-18)*I)*a^3*d*x))/(6*d)\"\n\n```\n\n\n\nIs it the complex number I which is causing the translation back to [SageMath](SageMath)?\n\nIssue created by migration from https://trac.sagemath.org/ticket/25905\n\n",
    "created_at": "2018-07-23T15:21:14Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Missing translation of FriCAS result",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25668",
    "user": "https://github.com/nasser1"
}
```
CC:  @mantepse

Keywords: fricas,integrate

I am not sure what is missing translation from FriCAS result to [SageMath](SageMath) here, and do not know if this is known of not. Thought to report it just in case but feel free to close if this is known.

Large number of such integrals fail because of this. Here is an example



```
SageMath version 8.3.rc2, Release Date: 2018-07-22   

sage: var('a d x c')
(a, d, x, c)
sage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x, algorithm="fricas")

```


Which gives



```
NotImplementedError                       Traceback (most recent call last)
<ipython-input-2-f02be8032da4> in <module>()
----> 1 integrate((I*a*tan(d*x + c) + a)**Integer(3)*tan(d*x + c),x, algorithm="fricas")

/usr/lib/python2.7/site-packages/sage/misc/functional.py in integral(x, *args, **kwds)
    751     """
    752     if hasattr(x, 'integral'):
--> 753         return x.integral(*args, **kwds)
    754     else:
    755         from sage.symbolic.ring import SR

/usr/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.integral (build/cythonized/sage/symbolic/expression.cpp:69759)()
  12364                     R = ring.SR
  12365             return R(integral(f, v, a, b, **kwds))
> 12366         return integral(self, *args, **kwds)
  12367 
  12368     integrate = integral

/usr/lib/python2.7/site-packages/sage/symbolic/integration/integral.py in integrate(expression, v, a, b, algorithm, hold)
    814         if not integrator:
    815             raise ValueError("Unknown algorithm: %s" % algorithm)
--> 816         return integrator(expression, v, a, b)
    817     if a is None:
    818         return indefinite_integral(expression, v, hold=hold)

/usr/lib/python2.7/site-packages/sage/symbolic/integration/external.py in fricas_integrator(expression, v, a, b, noPole)
    189                          " in the integration interval")
    190 
--> 191     return result.sage()
    192 
    193 

/usr/lib/python2.7/site-packages/sage/interfaces/interface.py in sage(self, *args, **kwds)
   1049             [0 0]
   1050         """
-> 1051         return self._sage_(*args, **kwds)
   1052 
   1053     def __repr__(self):

/usr/lib/python2.7/site-packages/sage/interfaces/fricas.py in _sage_(self)
   1443             return R(unparsed_InputForm)
   1444 
-> 1445         raise NotImplementedError("The translation of the FriCAS object %s to sage is not yet implemented." %(unparsed_InputForm))
   1446 
   1447 

NotImplementedError: The translation of the FriCAS object sage2 to sage is not yet implemented.
sage: 


```


The above works OK in friCAS itself:



```
>fricas
AXIOM="/usr/lib/fricas/target/x86_64-linux-gnu"
spad-lib="/usr/lib/fricas/target/x86_64-linux-gnu/lib/libspad.so"
                       FriCAS Computer Algebra System 
                            Version: FriCAS 1.3.4
                   Timestamp: Thu Jun 28 08:31:47 CDT 2018
(3) -> r:=integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x);
(4) -> unparse(r::InputForm) 

   (4)
  "((9*I^2+(-3))*a^3*log(1/(tan(d*x+c)^2+1))+(2*I^3*a^3*tan(d*x+c)^3+9*I^2*a^3*
  tan(d*x+c)^2+((-6)*I^3+18*I)*a^3*tan(d*x+c)+(6*I^3+(-18)*I)*a^3*d*x))/(6*d)"

```



Is it the complex number I which is causing the translation back to [SageMath](SageMath)?

Issue created by migration from https://trac.sagemath.org/ticket/25905





---

archive/issue_comments_361689.json:
```json
{
    "body": "It's a mix of two problems:\n\nThere is a strange problem in FriCAS:\n\n```\n(1) -> f := (%i*a*tan(d*x + c) + a)^3*tan(d*x + c)\n\n   (1)\n           3            4      3            3         3            2\n     - %i a tan(d x + c)  - 3 a tan(d x + c)  + 3 %i a tan(d x + c)\n   + \n      3\n     a tan(d x + c)\n                                           Type: Expression(Complex(Integer))\n(2) -> integrate(f, x)\n \n   >> System error:\n   arithmetic error DIVISION-BY-ZERO signalled\nOperation was (/ -2 0).\n```\n\n\nand, of course, the error handling of the sage-FriCAS interface is less than perfect.\n\nI'll report the bug on the FriCAS list.",
    "created_at": "2018-07-23T20:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361689",
    "user": "https://github.com/mantepse"
}
```

It's a mix of two problems:

There is a strange problem in FriCAS:

```
(1) -> f := (%i*a*tan(d*x + c) + a)^3*tan(d*x + c)

   (1)
           3            4      3            3         3            2
     - %i a tan(d x + c)  - 3 a tan(d x + c)  + 3 %i a tan(d x + c)
   + 
      3
     a tan(d x + c)
                                           Type: Expression(Complex(Integer))
(2) -> integrate(f, x)
 
   >> System error:
   arithmetic error DIVISION-BY-ZERO signalled
Operation was (/ -2 0).
```


and, of course, the error handling of the sage-FriCAS interface is less than perfect.

I'll report the bug on the FriCAS list.



---

archive/issue_comments_361690.json:
```json
{
    "body": "See https://groups.google.com/forum/#!topic/fricas-devel/TaduS9mswqE",
    "created_at": "2018-07-24T10:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361690",
    "user": "https://github.com/mantepse"
}
```

See https://groups.google.com/forum/#!topic/fricas-devel/TaduS9mswqE



---

archive/issue_comments_361691.json:
```json
{
    "body": "works now (9.2.b4)\n\n```\nsage: var('a d x c')                                                            \n(a, d, x, c)\nsage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x, algorithm=\"fricas\")    \n-2/3*(24*a^3*e^(4*I*d*x + 4*I*c) + 33*a^3*e^(2*I*d*x + 2*I*c) + 13*a^3 + 6*(a^3*e^(6*I*d*x + 6*I*c) + 3*a^3*e^(4*I*d*x + 4*I*c) + 3*a^3*e^(2*I*d*x + 2*I*c) + a^3)*log(e^(2*I*d*x + 2*I*c) + 1))/(d*e^(6*I*d*x + 6*I*c) + 3*d*e^(4*I*d*x + 4*I*c) + 3*d*e^(2*I*d*x + 2*I*c) + d)\n```\n",
    "created_at": "2020-12-26T18:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361691",
    "user": "https://github.com/fchapoton"
}
```

works now (9.2.b4)

```
sage: var('a d x c')                                                            
(a, d, x, c)
sage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x, algorithm="fricas")    
-2/3*(24*a^3*e^(4*I*d*x + 4*I*c) + 33*a^3*e^(2*I*d*x + 2*I*c) + 13*a^3 + 6*(a^3*e^(6*I*d*x + 6*I*c) + 3*a^3*e^(4*I*d*x + 4*I*c) + 3*a^3*e^(2*I*d*x + 2*I*c) + a^3)*log(e^(2*I*d*x + 2*I*c) + 1))/(d*e^(6*I*d*x + 6*I*c) + 3*d*e^(4*I*d*x + 4*I*c) + 3*d*e^(2*I*d*x + 2*I*c) + d)
```




---

archive/issue_comments_361692.json:
```json
{
    "body": "Replying to [comment:6 chapoton]:\n> works now (9.2.b4)\n> {{{\n> sage: var('a d x c')                                                            \n> (a, d, x, c)\n> sage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x, algorithm=\"fricas\")    \n> -2/3*(24*a<sup>3*e</sup>(4*I*d*x + 4*I*c) + 33*a<sup>3*e</sup>(2*I*d*x + 2*I*c) + 13*a^3 + 6*(a<sup>3*e</sup>(6*I*d*x + 6*I*c) + 3*a<sup>3*e</sup>(4*I*d*x + 4*I*c) + 3*a<sup>3*e</sup>(2*I*d*x + 2*I*c) + a<sup>3)*log(e</sup>(2*I*d*x + 2*I*c) + 1))/(d*e^(6*I*d*x + 6*I*c) + 3*d*e^(4*I*d*x + 4*I*c) + 3*d*e^(2*I*d*x + 2*I*c) + d)\n> }}}\n\nThanks. It is also working on V 9.2 on Linux:\n\n\n\n```\n>sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.2, Release Date: 2020-10-24                     \u2502\n\u2502 Using Python 3.8.6. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage:  var('a d x c')\n(a, d, x, c)\nsage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x,algorithm=\"fricas\")\n-2/3*(24*a^3*e^(4*I*d*x + 4*I*c) + 33*a^3*e^(2*I*d*x + 2*I*c) + 13*a^3 + 6*(a^3*e^(6*I*d*x + 6*I*c) + 3*a^3*e^(4*I*d*x + 4*I*c) + 3*a^3*e^(2*I*d*x + 2*I*c) + a^3)*log(e^(2*I*d*x + 2*I*c) + 1))/(d*e^(6*I*d*x + 6*I*c) + 3*d*e^(4*I*d*x + 4*I*c) + 3*d*e^(2*I*d*x + 2*I*c) + d)\nsage: \n\n\n```\n",
    "created_at": "2020-12-26T18:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361692",
    "user": "https://github.com/nasser1"
}
```

Replying to [comment:6 chapoton]:
> works now (9.2.b4)
> {{{
> sage: var('a d x c')                                                            
> (a, d, x, c)
> sage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x, algorithm="fricas")    
> -2/3*(24*a<sup>3*e</sup>(4*I*d*x + 4*I*c) + 33*a<sup>3*e</sup>(2*I*d*x + 2*I*c) + 13*a^3 + 6*(a<sup>3*e</sup>(6*I*d*x + 6*I*c) + 3*a<sup>3*e</sup>(4*I*d*x + 4*I*c) + 3*a<sup>3*e</sup>(2*I*d*x + 2*I*c) + a<sup>3)*log(e</sup>(2*I*d*x + 2*I*c) + 1))/(d*e^(6*I*d*x + 6*I*c) + 3*d*e^(4*I*d*x + 4*I*c) + 3*d*e^(2*I*d*x + 2*I*c) + d)
> }}}

Thanks. It is also working on V 9.2 on Linux:



```
>sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.2, Release Date: 2020-10-24                     │
│ Using Python 3.8.6. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage:  var('a d x c')
(a, d, x, c)
sage: integrate((I*a*tan(d*x + c) + a)^3*tan(d*x + c),x,algorithm="fricas")
-2/3*(24*a^3*e^(4*I*d*x + 4*I*c) + 33*a^3*e^(2*I*d*x + 2*I*c) + 13*a^3 + 6*(a^3*e^(6*I*d*x + 6*I*c) + 3*a^3*e^(4*I*d*x + 4*I*c) + 3*a^3*e^(2*I*d*x + 2*I*c) + a^3)*log(e^(2*I*d*x + 2*I*c) + 1))/(d*e^(6*I*d*x + 6*I*c) + 3*d*e^(4*I*d*x + 4*I*c) + 3*d*e^(2*I*d*x + 2*I*c) + d)
sage: 


```




---

archive/issue_comments_361693.json:
```json
{
    "body": "I don't know in which release of FriCAS this was fixed, though.",
    "created_at": "2020-12-26T21:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361693",
    "user": "https://github.com/mantepse"
}
```

I don't know in which release of FriCAS this was fixed, though.



---

archive/issue_comments_361694.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-26T21:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361694",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_361695.json:
```json
{
    "body": "this need a doctest",
    "created_at": "2020-12-26T21:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361695",
    "user": "https://github.com/fchapoton"
}
```

this need a doctest



---

archive/issue_comments_361696.json:
```json
{
    "body": "I was unable to find a simple way to verify the integral.  I did some random checks, though.\n----\nNew commits:",
    "created_at": "2021-01-02T15:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361696",
    "user": "https://github.com/mantepse"
}
```

I was unable to find a simple way to verify the integral.  I did some random checks, though.
----
New commits:



---

archive/issue_comments_361697.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-02T18:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361697",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_361698.json:
```json
{
    "body": "ok, thx",
    "created_at": "2021-01-02T18:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361698",
    "user": "https://github.com/fchapoton"
}
```

ok, thx



---

archive/issue_events_023891.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-01-04T22:37:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-23891"
}
```



---

archive/issue_comments_361699.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-04T22:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-361699",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
