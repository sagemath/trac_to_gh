# Issue 12778: update to Pynac 0.2.4

Issue created by migration from Trac.

Original creator: burcin

Original creation time: 2012-05-15 14:44:13

Assignee: burcin

CC:  titusn benjaminfjones kcrisman jpflori

Keywords: pynac

There is a new Pynac release which contains fixes to:

 * #11155: `abs(pi+I) -> pi + I` (upstream from Alexei Sheplyakov)
 * #11423: `atan2(0,0)` should be undefined (by Volker Braun)
 * #11919: pickling of user defined symbolic functions without custom methods
 * #12303: beta should remain symbolic for exact input
 * a fix to use Python for comparing Python objects wrapped in numerics (by Jean-Pierre Flori
 * complete rewrite of code handling various types of infinity (by Volker Braun)

Following the comments [in this thread on sage-devel](https://groups.google.com/d/topic/sage-devel/WCSK5rRn8h8/discussion), the release is available as a tarball:

http://sage.math.washington.edu/home/burcin/pynac/pynac-0.2.4.tar.bz2

Patches attached to this ticket need to be applied to the Sage library to update the Pynac interface.


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Comment by burcin created at 2012-05-15 22:49:37

This also fixes #9547 and includes a doctest. That ticket should be closed once this is merged.


---

Comment by jpflori created at 2012-05-23 16:32:27

I've made a tentative spkg available at http://perso.telecom-paristech.fr/~flori/sage/pynac-0.2.4.spkg  which adds an .hgignore file to exclude the src directory from tracking.

I've had a quick look at the patches which look good overall.
I'll post a patch fixing some (mainly very minor) typos asap.


---

Comment by jpflori created at 2012-05-23 16:37:35

I'm currently running "make ptest" (on sage-5.0 on an ubuntu 12.04 amd64) and there are at least some new problems in revolutio_plot3d (or something like that) because atan2(0,0) now raises an error.


---

Comment by jpflori created at 2012-05-23 16:42:11

I also got two failures in sage/stats/basic_stats due to the new ordering of numerics (I guess).


---

Comment by jpflori created at 2012-05-23 16:59:37

Oh, so now I'm a little lost.
Some patches are included here and other on the original tickets...
It's surely logical, but I just discovered that.

Anyway, the dependencies between the tickets should be clearly stated and written into the corresponding trac field.
For example, do we really want to merge #11919 now? cos I don't think reviewing this ticket will take ages...
Or, this ticket can not be merged without fixing the atan2 stuff causing failures in revolution_plot3d which is in fact also mentioned in the comments of #11423 .
Or, do we really want the three lines patch of #11155 there with #12950 as a dependency rather than here?


---

Comment by jpflori created at 2012-05-23 17:32:10

Fix for revolution_plot3d


---

Attachment

Thanks for looking into this!

Replying to [comment:9 jpflori]:
> Oh, so now I'm a little lost.
> Some patches are included here and other on the original tickets...
> It's surely logical, but I just discovered that.

I tried to put all the patches required to make the new version work with Sage on this ticket. If I didn't screw up, the rest should be nonessential, doctests, etc. It used to be a major hassle to create patches for each ticket separately, upload them, then make a ticket with an spkg etc. I think this way is easier for everyone.

> Anyway, the dependencies between the tickets should be clearly stated and written into the corresponding trac field.
> For example, do we really want to merge #11919 now? cos I don't think reviewing this ticket will take ages...

I don't think the patch attached to #11919 is necessary. But I'm reluctant to make changes to that ticket while this is being reviewed.

> Or, this ticket can not be merged without fixing the atan2 stuff causing failures in revolution_plot3d which is in fact also mentioned in the comments of #11423 .

This should depend on the yet to be opened ticket mentioned in comment:6:ticket:11423. But, changing the plot3d stuff to handle errors in the numerical evaluation phase is a big change (AFAIK, Titus actually had a go at it.), and it is very much independent of a Pynac release, apart from the minor issue that one of the doctests there happened to call `atan2()`.

> Or, do we really want the three lines patch of #11155 there with #12950 as a dependency rather than here?

The doctests on #11155 are minor, so we left that patch out of this ticket. Just now, I made that ticket depend on this one and gave it a positive review.


---

Comment by burcin created at 2012-05-23 17:35:12

Changing status from new to needs_review.


---

Comment by jpflori created at 2012-05-23 17:39:12

I've just uploaded a fix for the revolution_plot3d problem.

When the revolution axis goes through (0,0,0), the previous behaviour was correct although obtained through the general formula which in fact should not have made sense.
In fact the (0,0,0) case is the simplest one, no "complicated" formula for the to be drawn surface has to be deduced from the curve formula.
 
The proposed fix is to treat the special case (0,0,0) separately as far as the phase calculation is concerned.

(PS: We posted more or less at the same time, so this post might seem strange)


---

Comment by jpflori created at 2012-05-24 07:38:51

A little concern about the effect of the new numeric ordering, if I understand correctly what happens (not really sure about the initialization of the complex I).
Now the complex I is compared at the Python level.
There it is a root of x2+1, and Sage always returns 1 when you compare whatever*I and whatever_different*I, that is : 5*I > 3*I is true, but so is I > 3*I.

This explains the changes in some doctest output, but I'm concerned that this will surely lead to problems in the pynac internal ordering...


---

Comment by jpflori created at 2012-05-24 07:50:11

Further rants: in fact in (quadratic) number fields at least we always have whatever > whatever else true and whatever < whatever else false.
Indeed, the _cmp_ functions test for equality, that is completely understandable because there's no reason to decide that a root of a polynomial is "positive" or "negative" without chosing an embedding somewhere...

But I is defined with embedding=CC.gen(), i.e. the usual definition, and so we have CC(I) considered as "positive" (no surprise here...).


---

Comment by jpflori created at 2012-05-24 08:18:13

I think that the above could or even should be handled in a separate ticket (#9880 for example...).

In a few minutes, I'll upload a reviewer patch fixing one or two very minor typos and another patch fixing the two other doctests modified by the complex I ordering changes.

I'll also upload new versions of all the other patches so that the commit messages include the trac ticket number.


---

Attachment

Further doctests fixes.


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Attachment

Reviewer patch; minor typos


---

Attachment


---

Attachment


---

Comment by jpflori created at 2012-05-24 08:40:45

I think my work here is done.
I positively review Burcin and others' patches.

So if one is ok with the packaging I made and the few other patches I uploaded, this can get positive review.


---

Comment by burcin created at 2012-05-24 09:33:15

Replying to [comment:14 jpflori]:
> I think that the above could or even should be handled in a separate ticket (#9880 for example...).

This is actually #7160. It causes a lot of other problems in Pynac as well.


I give a positive review to Jean-Pierre's patches. The spkg still needs to be reviewed. Any volunteers?


---

Comment by benjaminfjones created at 2012-05-25 05:28:16

Started reviewing the spkg. The package itself looks good, installs successfully, and with the attached patches applied, sage passes a subset of tests:


```
   passes: ../../sage -t sage/symbolic/*.py
   passes: ../../sage -t sage/symbolic/*.pyx
   passes: ../../sage -t sage/functions/*.py
```


I'm running all tests now, will report when complete.


---

Comment by benjaminfjones created at 2012-05-25 05:56:41

Changing keywords from "pynac" to "pynac sd40.5".


---

Comment by benjaminfjones created at 2012-05-25 05:56:41

All tests pass, I checked the hg log and indeed, all relevant changes appear to come from upstream. The spkg unpacks fine, and I can successfully recreate it using the `sage-pkg` script. 

Everything looks good, so I'll give the spkg a positive review.


---

Comment by benjaminfjones created at 2012-05-25 05:56:41

Changing status from needs_review to positive_review.


---

Comment by benjaminfjones created at 2012-05-25 16:24:06

While updating #11143 I ran into the following issue which occurs when the patches here and the new pynac spkg are installed:


```
sage: integral(e^(-x)*log(x+1), x, 0, oo)
...
ValueError: Computation failed since Maxima requested additional constraints; using the 'assume' command before integral evaluation *may* help (example of legal syntax is 'as
sume(Infinity>0)', see `assume?` for more details)
Is  Infinity  positive, negative, or zero?
```


It looks like there is something going on with the conversion of `oo` to `inf` in maxima.

----

Another comment: why are the instances of `Infinity` in the doctest patches here changed to `infinity`. Isn't the upper case `Infinity` the "canonical" Sage infinity?


---

Comment by jdemeyer created at 2012-06-02 12:15:29

Resolution: fixed


---

Comment by kcrisman created at 2012-06-29 12:15:35

Replying to [comment:20 benjaminfjones]:
> While updating #11143 I ran into the following issue which occurs when the patches here and the new pynac spkg are installed:
> 
> {{{
> sage: integral(e^(-x)*log(x+1), x, 0, oo)
> ...
> ValueError: Computation failed since Maxima requested additional constraints; using the 'assume' command before integral evaluation *may* help (example of legal syntax is 'as
> sume(Infinity>0)', see `assume?` for more details)
> Is  Infinity  positive, negative, or zero?
> }}}
> 
> It looks like there is something going on with the conversion of `oo` to `inf` in maxima.
> 
> ----
> 
> Another comment: why are the instances of `Infinity` in the doctest patches here changed to `infinity`. Isn't the upper case `Infinity` the "canonical" Sage infinity? 

Did you want to open a ticket about these, or was this just a point of clarification?

----

On an unrelated note, I'm a little confused as to why all the patches ended up here.  I understand that this is convenient, but what happens then is that a whole bunch of tickets are closed as "sage-invalid/dup" and really they weren't dups at all, they just happened to be fixed by this spkg.  

At any rate, I recommend making sure that such tickets (like #11423, #9547, #12303) are given a normal milestone - even though the fix is here, that didn't make the ticket and its authors/reviewers less valid somehow.


---

Comment by burcin created at 2012-06-29 13:07:02

Replying to [comment:24 kcrisman]:
> On an unrelated note, I'm a little confused as to why all the patches ended up here.  I understand that this is convenient, but what happens then is that a whole bunch of tickets are closed as "sage-invalid/dup" and really they weren't dups at all, they just happened to be fixed by this spkg.  
> 
> At any rate, I recommend making sure that such tickets (like #11423, #9547, #12303) are given a normal milestone - even though the fix is here, that didn't make the ticket and its authors/reviewers less valid somehow.

Feel free to change them back to a different milestone. I also hesitated before changing to duplicate/invalid/wontfix. I just needed a way to indicate to Jeroen that these are tickets that can be closed without any work. I also tried to make the authors of those tickets were acknowledged here.


---

Comment by kcrisman created at 2012-06-29 13:12:10

> > On an unrelated note, I'm a little confused as to why all the patches ended up here.  I understand that this is convenient, but what happens then is that a whole bunch of tickets are closed as "sage-invalid/dup" and really they weren't dups at all, they just happened to be fixed by this spkg.  
> > 
> > At any rate, I recommend making sure that such tickets (like #11423, #9547, #12303) are given a normal milestone - even though the fix is here, that didn't make the ticket and its authors/reviewers less valid somehow.
> 
> Feel free to change them back to a different milestone. I also hesitated before changing to duplicate/invalid/wontfix. I just needed a way to indicate to Jeroen that these are tickets that can be closed without any work. I also tried to make the authors of those tickets were acknowledged here.

I sort of figured that was the situation - there is no perfect workflow for all needs, by Arrow's Theorem, and it's not like you don't have enough to do!  I'll check if any changes would be required.
