# Issue 17385: Fix Cygwin's "-no-undefined" patches for zeromq

Issue created by migration from Trac.

Original creator: jpflori

Original creation time: 2015-01-12 13:06:22

CC:  gouezel tscrim

The fix at #17333 was misplaced...


---

Comment by jpflori created at 2015-01-12 13:29:30

Changing status from new to needs_review.


---

Comment by jpflori created at 2015-01-12 13:29:30

`@`SÃ©bastien: can you test the fixed patches (just pull the branch and force zeromq install with `./sage -f`)?
I don't have my VMs at hand so it's not trivial for me to test.
I should have time to reboot under Windows at some point though.
----
New commits:


---

Comment by gouezel created at 2015-01-12 15:08:51

I will test it later today. One question though: what is the role of the directory patches/build_system? As far as I can tell, it contains modified copies of the patches, but these copies are never applied...


---

Comment by gouezel created at 2015-01-12 19:48:55

The new version is much more sensible than the previous one, and works fine. It also works fine if one removes the subdirectory patches/build_system, so is there a good reason to keep it?


---

Comment by gouezel created at 2015-01-12 19:49:20

Changing status from needs_review to needs_info.


---

Comment by jpflori created at 2015-01-12 20:30:33

Changing status from needs_info to needs_review.


---

Comment by jpflori created at 2015-01-12 20:30:33

zeromq uses autotools.
The patches in `build_system` directory are those you need to apply to the zeromq build system before autotools automatically generate the full build system.
Once these patches are applied, one can invoke autotools to update the build system (e.g. running `autoreconf -fiv && rm -rf autom4te.cache`) and deduce the full patches in the `patches` directory which don't need autotools invokation anymore and can be applied at build time.

To summarize it's good to ship two set of patches because:
* we can't rely on invoking autotools at build time because it is not a prerequisite and would not be manageable anyway, it's kind of impossible to make sure that the build system will be correctly regenarated with one of the random versions of autotools programs in the wild, therefore the build system has to be regenerated on a dev machine and full patches have to be distributed,
* the patches only touching the input to autotools are still of interest as these are the ones to be updated manually if we want to introduce further changes in the build system, and the ones to submit upstream for inclusion (and when upstream makes new releases it will regenerate the full build system)


---

Comment by gouezel created at 2015-01-12 20:36:48

OK, thanks a lot for the detailed and convincing explanation


---

Comment by gouezel created at 2015-01-12 20:37:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-01-13 01:12:21

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-01-13 01:12:21

Reviewer name is missing


---

Comment by tscrim created at 2015-01-13 05:08:26

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-01-15 08:41:47

Resolution: fixed
