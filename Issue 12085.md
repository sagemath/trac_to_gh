# Issue 12085: 1.0*pi should *not* be pi

Issue created by migration from Trac.

Original creator: was

Original creation time: 2012-01-03 21:57:40

Assignee: burcin

CC:  kcrisman

This is really bad

```
sage: 1.0 * pi
pi
sage: sin(1.0 * pi)
0
```

This is good:

```
sage: maxima('sin(%pi*1.0)')
sin(1.0*%pi)
sage: maxima('1.0*%pi')
1.0*%pi
```


This is likely the fault of ginac doing something stupid with 1.0 == 1. 

Ken Ribet pointed this out during the JMM 2012 meeting.


---

Comment by burcin created at 2012-01-03 23:46:47

There are two sides to this. Doing the multiplication and printing the coefficient.

GiNaC takes a shortcut when the coefficient is 1 and skips multiplication. There is a Python callback function (`sage.symbolics.pynac.py_get_parent_char`) to check the characteristic of the parent. Pynac forces the operation for positive characteristic. If we return a positive integer from that function when the parent is inexact, the multiplication will go through.

If a coefficient is 1, we don't print it. So the printing code in pynac needs to be changed to print inexact coefficients. This is now [pynac issue #4](https://bitbucket.org/burcin/pynac/issue/4/).

Even when all these are sorted out, `sin(1.0*pi)` might still return 0. Since `bool(1.0*pi == pi)` will probably be True.


---

Comment by burcin created at 2012-01-03 23:46:47

Changing keywords from "" to "pynac".


---

Comment by was created at 2012-01-04 05:30:16

It should be that sin(1.0*pi)  returns 0.0.  We can fix this somehow. I'm not worried about printing.


---

Comment by kcrisman created at 2014-11-21 14:47:43

Here is another idea.  In [the Ginac source](http://www.ginac.de/reference/mul_8cpp_source.html#l00442), we have

```
00464     } else if (seq_size==1 && overall_coeff.is_equal(_ex1)) {
00465         // *(x;1) -> x
00466         return recombine_pair_to_ex(*(seq.begin()));
```

and that could be somehow changed.  And the other issue is [here](http://www.ginac.de/reference/inifcns__trans_8cpp_source.html#l00303)

```
00319         if (z.is_equal(*_num0_p))  // sin(0)       -> 0
00320             return _ex0;
```

so again if there were a way to have Pynac return "the right" zero...  I think this is kind of philosophy difference is at the root of several little coercion buglets.


---

Comment by rws created at 2015-04-16 07:46:45

Replying to [comment:8 kcrisman]:
> Here is another idea.  In [the Ginac source](http://www.ginac.de/reference/mul_8cpp_source.html#l00442), we have
> {{{
> 00464     } else if (seq_size==1 && overall_coeff.is_equal(_ex1)) {
> 00465         // *(x;1) -> x
> 00466         return recombine_pair_to_ex(*(seq.begin()));
> }}}
This is currently in Pynac: https://github.com/pynac/pynac/blob/master/ginac/mul.cpp#L741 
> and that could be somehow changed.  And the other issue is [here](http://www.ginac.de/reference/inifcns__trans_8cpp_source.html#l00303)
> {{{
> 00319         if (z.is_equal(*_num0_p))  // sin(0)       -> 0
> 00320             return _ex0;
> }}}
And this is currently https://github.com/pynac/pynac/blob/master/ginac/inifcns_trans.cpp#L430

The Pynac ticket for this on github is https://github.com/pynac/pynac/issues/4


---

Comment by rws created at 2015-04-17 15:14:21

> > {{{
> > 00464     } else if (seq_size==1 && overall_coeff.is_equal(_ex1)) {
> > 00465         // *(x;1) -> x
> > 00466         return recombine_pair_to_ex(*(seq.begin()));
> > }}}
https://github.com/pynac/pynac/blob/master/ginac/mul.cpp#L713

There may be a general problem, not only for constants:

```
sage: 1.000000*(x+2)
x + 2
sage: 2.000000*(x+2)
2.00000000000000*x + 4.00000000000000
```

Is this intended?


---

Comment by rws created at 2015-04-19 13:53:10

I think this can be generalized to -1,0,1:

```
sage: 0.0+5
5.00000000000000
sage: 0.0+x
x
sage: 0.0*x
0
sage: -1.0*x
-x
sage: -2.0*x
-2.00000000000000*x

sage: x^0.0
1
sage: x^1.0
x
sage: x^2.0
x^2.00000000000000
sage: x^-1.0
1/x
sage: x^-2.0
x^(-2.00000000000000)
```



---

Comment by rws created at 2015-04-22 07:06:28

Conflicts with #18088, therefore a dependency.
----
New commits:


---

Comment by rws created at 2015-04-24 15:53:07

New commits:


---

Comment by rws created at 2015-04-24 15:53:07

Changing status from new to needs_review.


---

Comment by kcrisman created at 2015-05-21 17:20:49

> It should be that sin(1.0*pi)  returns 0.0.  We can fix this somehow. I'm not worried about printing. 
Even without this patch, we now get (thanks to Pynac upgrade

```
sage: sin(1.0*pi)
sin(1.00000000000000*pi)
```

which is perhaps also not ideal, if we wanted `0.00000000000` as in the original intent (I guess) of this ticket.  So while I agree that one bug is fixed, perhaps this could be repurposed for that - unless we want to say that `sin(1.0*pi)` is not exact so we don't actually know it's `0.0`, but I feel we don't do that with other things.  For instance, even after the Pynac upgrade in #18362, we have

```
sage: 0.0*pi
0
```

which is really what is at issue here, I guess.  Or?


---

Comment by rws created at 2015-05-24 15:10:41

Replying to [comment:19 kcrisman]:
> {{{
> sage: sin(1.0*pi)
> sin(1.00000000000000*pi)
> }}}
> which is perhaps also not ideal, if we wanted `0.00000000000` as in the original intent 

I don't think you can expect `0.00000000000` but rather `1.22464679914735e-16` which is what you get with `sin(1.0*pi).n()`. I think it's Sage convention (?) that any FP value in an expression should have the effect of automatically applying `N()` to it.

> So while I agree that one bug is fixed, perhaps this could be repurposed for that - unless we want to say that `sin(1.0*pi)` is not exact so we don't actually know it's `0.0`
>... even after the Pynac upgrade in #18362, we have
> {{{
> sage: 0.0*pi
> 0
> }}}
> which is really what is at issue here, I guess.  Or?
Yes.

The original ticket was about `1.0`. I added to this cases with `-1.0` and `0.0` but when fixing stopped short of fixing the `0.0` cases because they seemed quite different from `+/-1` and I first wanted to fix where I had a good overview without risk of introducing bugs. So, I think it better if we open a ticket for `0.0` because this case may need a separate discussion.


---

Comment by rws created at 2015-05-24 15:11:41

Changing status from needs_review to needs_work.


---

Comment by rws created at 2015-06-10 08:55:56

Changing status from needs_work to needs_review.


---

Comment by rws created at 2015-06-10 08:55:56

Replying to [comment:20 rws]:
> Replying to [comment:19 kcrisman]:
> > {{{
> > sage: sin(1.0*pi)
> > sin(1.00000000000000*pi)
> > }}}
> > which is perhaps also not ideal, if we wanted `0.00000000000` as in the original intent 
> 
> I don't think you can expect `0.00000000000` but rather `1.22464679914735e-16` which is what you get with `sin(1.0*pi).n()`. I think it's Sage convention (?) that any FP value in an expression should have the effect of automatically applying `N()` to it.
No, I thought wrong, because I cannot find any function that expands an argument containing a FP number and a constant automatically (contrary to FP only). And I really agree it's wrong because the constant's precision is immediately limited as soon as the FP comes into it. But this is clearly another ticket and the introduced behaviour of `sin(1.0*pi)` with this ticket is exactly in line with all other functions and arguments at the moment.


---

Comment by git created at 2015-06-11 07:43:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-06-20 15:48:49

The `sin(1.0*pi)` issue is now #18697.


---

Comment by jdemeyer created at 2015-07-12 09:41:57

I think you need to be slightly more clear what you mean

```
only integer +/- 1 gets special treatment
```


I think something like the following would be more clear:

```
floating point numbers +/- 1.0 are treated differently from integers +/- 1
```



---

Comment by git created at 2015-07-16 09:11:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-07-16 13:23:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-07-16 22:51:08

Resolution: fixed
