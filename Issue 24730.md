# Issue 24730: py3: fix comparison of pivots

Issue created by migration from https://trac.sagemath.org/ticket/24967

Original creator: chapoton

Original creation time: 2018-03-13 17:00:46

CC:  jdemeyer embray fbissey

using tuples, because lists and tuples are no longer comparable..


---

Comment by chapoton created at 2018-03-13 17:01:14

New commits:


---

Comment by chapoton created at 2018-03-13 17:01:14

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-03-13 19:54:30

green bot, please review


---

Comment by embray created at 2018-03-13 20:00:16

Fine by me.  The `tuple(...)` call is needless duplication if the arguments are already both tuples (or lists, for that matter). But I don't think it's a serious performance issue.


---

Comment by embray created at 2018-03-13 20:01:49

Although, looking at where this is used, there's a still a lot of blatant, unnecessary copying.  I'd suggest at the very least doing away with the `list()` in the calls to `cmp_pivots` in `sage.matrix.misc`.


---

Comment by jdemeyer created at 2018-03-13 20:09:52

Why are there two identical `cmp_pivots` functions? It seems that the one in `matrix2.pyx` is not used at all, so better remove it.


---

Comment by jdemeyer created at 2018-03-13 20:09:52

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-03-13 20:13:22

Replying to [comment:4 embray]:
> Although, looking at where this is used, there's a still a lot of blatant, unnecessary copying.

FYI, a `tuple` is not copied:

```
sage: X = tuple(range(10))
sage: tuple(X) is X
True
```



---

Comment by git created at 2018-03-13 20:13:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-03-13 20:14:06

done


---

Comment by chapoton created at 2018-03-13 20:14:06

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-03-13 20:15:20

Maybe Erik was thinking to the calls to list in 

```
src/sage/matrix/misc.pyx:            c = cmp_pivots(best_pivots, list(A.pivots()))
src/sage/matrix/misc.pyx:            if cmp_pivots(best_pivots, list(X[i].pivots())) <= 0:
```



---

Comment by embray created at 2018-03-13 20:19:26

Yes, exactly that.  Though I did write "if the arguments are already tuples"--Jeroen is right that there's no copying in that case (as there shouldn't be since any two tuples of the same elements are by definition the same).


---

Comment by chapoton created at 2018-03-13 20:25:04

should I take the opportunity to remove these 2 list() ?


---

Comment by embray created at 2018-03-13 20:51:33

Replying to [comment:11 chapoton]:
> should I take the opportunity to remove these 2 list() ?

Sure--positive review from me if so, and assuming at least one patchbot looks good.


---

Comment by git created at 2018-03-13 20:53:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-03-14 07:16:19

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-03-14 07:16:19

bot morally green, setting to positive


---

Comment by vbraun created at 2018-03-22 19:23:22

Resolution: fixed
