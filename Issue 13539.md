# Issue 13539: Bug in k-bounded symmetric functions

archive/issues_013539.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  aschilling zabrocki tscrim\n\nThe indices method of the KBoundedSubspace class is done wrong. The code is:\n\n```\nself.indices = ConstantFunction(Partitions(NonNegativeIntegers(), max_part=k))\n```\n\n\nPartitions is not meant to take a set. It will usually complain if you input something like NonNegativeIntegers but due to a bug in partitions, it allows it if you have optional arguments.\n\nThis creates the following bugs when playing around with k-Schur functions:\n\n\n```\nsage: ks = SymmetricFunctions(QQ).kBoundedSubspace(3,1).kschur()\nsage: f = ks[2,1]\nsage: f.coefficient(f.support()[0])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n\n/Users/chrisberg/<ipython console> in <module>()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.pyc in coefficient(self, m)\n    479         # that can be turned on or off\n    480         C = self.parent()._basis_keys\n--> 481         assert m in C, \"%s should be an element of %s\"%(m, C)\n    482         if hasattr(C, \"element_class\") and not isinstance(m, C.element_class):\n    483             m = C(m)\n\nAssertionError: [2, 1] should be an element of Partitions of the integer An example of an infinite enumerated set: the non negative integers satisfying constraints max_part=3\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13743\n\n",
    "created_at": "2012-11-22T14:58:14Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "Bug in k-bounded symmetric functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13539",
    "user": "chrisjamesberg"
}
```
Assignee: sage-combinat

CC:  aschilling zabrocki tscrim

The indices method of the KBoundedSubspace class is done wrong. The code is:

```
self.indices = ConstantFunction(Partitions(NonNegativeIntegers(), max_part=k))
```


Partitions is not meant to take a set. It will usually complain if you input something like NonNegativeIntegers but due to a bug in partitions, it allows it if you have optional arguments.

This creates the following bugs when playing around with k-Schur functions:


```
sage: ks = SymmetricFunctions(QQ).kBoundedSubspace(3,1).kschur()
sage: f = ks[2,1]
sage: f.coefficient(f.support()[0])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)

/Users/chrisberg/<ipython console> in <module>()

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.pyc in coefficient(self, m)
    479         # that can be turned on or off
    480         C = self.parent()._basis_keys
--> 481         assert m in C, "%s should be an element of %s"%(m, C)
    482         if hasattr(C, "element_class") and not isinstance(m, C.element_class):
    483             m = C(m)

AssertionError: [2, 1] should be an element of Partitions of the integer An example of an infinite enumerated set: the non negative integers satisfying constraints max_part=3
```


Issue created by migration from https://trac.sagemath.org/ticket/13743





---

archive/issue_comments_167390.json:
```json
{
    "body": "That Partitions accepts a set is in fact not a bug. Granted, it should be documented, and there certainly are many cases like this one where this is not supported (so I agree with the existence of this ticket). But this is definitely a feature we want (and that is, more or less, implemented in IntegerListsLex).\n\nCheers,\n                        Nicolas",
    "created_at": "2012-11-22T16:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167390",
    "user": "nthiery"
}
```

That Partitions accepts a set is in fact not a bug. Granted, it should be documented, and there certainly are many cases like this one where this is not supported (so I agree with the existence of this ticket). But this is definitely a feature we want (and that is, more or less, implemented in IntegerListsLex).

Cheers,
                        Nicolas



---

archive/issue_comments_167391.json:
```json
{
    "body": "You can just do \n\n\n```\nsage: ks = SymmetricFunctions(QQ).kschur(3,1)\nsage: f = ks[2,1]\nsage: f[Partition([2,1])]\n1\n```\n\n\nAnne",
    "created_at": "2012-11-22T16:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167391",
    "user": "aschilling"
}
```

You can just do 


```
sage: ks = SymmetricFunctions(QQ).kschur(3,1)
sage: f = ks[2,1]
sage: f[Partition([2,1])]
1
```


Anne



---

archive/issue_comments_167392.json:
```json
{
    "body": "As far as I can tell, Travis' changes to Partitions may fix this bug. \u00a0I am adding him as cc on this ticket. There are currently still conflicts between the symmetric functions and Partitions.  Perhaps they are resolved it is possible that they will fix this problem so he can take this into account as he writes his patch.  So for instance after I apply Travis' patch trac_13605-partition_options-ts.patch I have:\n\n\n```\n    sage: ks =\u00a0SymmetricFunctions(QQ).kBoundedSubspace(3,1).kschur()\n    sage: f = ks([2,1])\n    sage: f.coefficient(f.support()[0])\n    1\n```\n\n\nHowever the same patch currently causes a different problem with symmetric functions:\n\n```\n\nsage: ks[2,1]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Applications/sage-5.4.rc2/devel/sage-combinat/<ipython console> in <module>()\n\n/Applications/sage-5.4.rc2/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.pyc in __getitem__(self, c, *rest)\n    298                 ks3[]\n    299             \"\"\"\n--> 300             if isinstance(c, Partition_class):\n    301                 assert len(rest) == 0\n    302             else:\n\nTypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types\n```\n\n\nTravis, was it your intention to allow `Partitions( NonNegativeIntegers(), max_part=k )` to represent the set of all Partitions with max_part=k?",
    "created_at": "2012-11-24T16:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167392",
    "user": "zabrocki"
}
```

As far as I can tell, Travis' changes to Partitions may fix this bug.  I am adding him as cc on this ticket. There are currently still conflicts between the symmetric functions and Partitions.  Perhaps they are resolved it is possible that they will fix this problem so he can take this into account as he writes his patch.  So for instance after I apply Travis' patch trac_13605-partition_options-ts.patch I have:


```
    sage: ks = SymmetricFunctions(QQ).kBoundedSubspace(3,1).kschur()
    sage: f = ks([2,1])
    sage: f.coefficient(f.support()[0])
    1
```


However the same patch currently causes a different problem with symmetric functions:

```

sage: ks[2,1]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Applications/sage-5.4.rc2/devel/sage-combinat/<ipython console> in <module>()

/Applications/sage-5.4.rc2/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.pyc in __getitem__(self, c, *rest)
    298                 ks3[]
    299             """
--> 300             if isinstance(c, Partition_class):
    301                 assert len(rest) == 0
    302             else:

TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types
```


Travis, was it your intention to allow `Partitions( NonNegativeIntegers(), max_part=k )` to represent the set of all Partitions with max_part=k?



---

archive/issue_comments_167393.json:
```json
{
    "body": "Replying to [comment:3 zabrocki]:\n> However the [trac_13605-partition_options-ts.patch] currently causes a different problem with symmetric functions:\n> {{{\n> \n> sage: ks[2,1]\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> \n> /Applications/sage-5.4.rc2/devel/sage-combinat/<ipython console> in <module>()\n> \n> /Applications/sage-5.4.rc2/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.pyc in __getitem__(self, c, *rest)\n>     298                 ks3[]\n>     299             \"\"\"\n> --> 300             if isinstance(c, Partition_class):\n>     301                 assert len(rest) == 0\n>     302             else:\n> \n> TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types\n> }}}\n\nI'll go through now and scrub all instances of `Partition_class` from the sage code so you can adequately test to see if the patch (unintentionally) fixes this problem.\n\n> Travis, was it your intention to allow `Partition( NonNegativeInteger(), max_part=k )` to represent the set of all Partitions with max_part=k?\n\nDo you mean `Partitions(NonNegativeIntegers(), max_part=k)` with the `s`'s? If so, this has some quirks noted in the wierdness page. However, if you mean exactly what you wrote, then I believe that should raise an exception since `Partition()` should return a single partition, although maybe with that input, one should get a random partition with max part `k`...",
    "created_at": "2012-11-24T17:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167393",
    "user": "tscrim"
}
```

Replying to [comment:3 zabrocki]:
> However the [trac_13605-partition_options-ts.patch] currently causes a different problem with symmetric functions:
> {{{
> 
> sage: ks[2,1]
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> 
> /Applications/sage-5.4.rc2/devel/sage-combinat/<ipython console> in <module>()
> 
> /Applications/sage-5.4.rc2/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.pyc in __getitem__(self, c, *rest)
>     298                 ks3[]
>     299             """
> --> 300             if isinstance(c, Partition_class):
>     301                 assert len(rest) == 0
>     302             else:
> 
> TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types
> }}}

I'll go through now and scrub all instances of `Partition_class` from the sage code so you can adequately test to see if the patch (unintentionally) fixes this problem.

> Travis, was it your intention to allow `Partition( NonNegativeInteger(), max_part=k )` to represent the set of all Partitions with max_part=k?

Do you mean `Partitions(NonNegativeIntegers(), max_part=k)` with the `s`'s? If so, this has some quirks noted in the wierdness page. However, if you mean exactly what you wrote, then I believe that should raise an exception since `Partition()` should return a single partition, although maybe with that input, one should get a random partition with max part `k`...



---

archive/issue_comments_167394.json:
```json
{
    "body": "> Do you mean `Partitions(NonNegativeIntegers(), max_part=k)` with the `s`'s? If so, this has some quirks noted in the wierdness page. However, if you mean exactly what you wrote, then I believe that should raise an exception since `Partition()` should return a single partition, although maybe with that input, one should get a random partition with max part `k`...\n\nI meant `Partitions(NonNegativeIntegers(), max_part=k)`.  Sorry for the double typos (corrected in comment).",
    "created_at": "2012-11-24T18:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167394",
    "user": "zabrocki"
}
```

> Do you mean `Partitions(NonNegativeIntegers(), max_part=k)` with the `s`'s? If so, this has some quirks noted in the wierdness page. However, if you mean exactly what you wrote, then I believe that should raise an exception since `Partition()` should return a single partition, although maybe with that input, one should get a random partition with max part `k`...

I meant `Partitions(NonNegativeIntegers(), max_part=k)`.  Sorry for the double typos (corrected in comment).



---

archive/issue_comments_167395.json:
```json
{
    "body": "In an ideal world, yes, that should be all partitions with max part `k`.\n\nWhat I'm doing in #13605 won't really affect how input is handled, and if I understand this ticket correctly, it is to port the list input aspect of `IntegerListsLex` into `Partitions`. For this, my first thoughts give me one of three possibilities:\n1. Create new classes which act like `Partitions_all` which just iterates over all of the classes with specified `n` in the passed in set.\n2. Create `DisjointUnionEnumeratedSets` with an appropriate `Family`.\n3. Copy how `IntegerListsLex` does things\n\nOn a slight side note, `IntegerListsLex` has some finiteness issues that will might also need to be addressed; see #13749.",
    "created_at": "2012-11-24T20:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167395",
    "user": "tscrim"
}
```

In an ideal world, yes, that should be all partitions with max part `k`.

What I'm doing in #13605 won't really affect how input is handled, and if I understand this ticket correctly, it is to port the list input aspect of `IntegerListsLex` into `Partitions`. For this, my first thoughts give me one of three possibilities:
1. Create new classes which act like `Partitions_all` which just iterates over all of the classes with specified `n` in the passed in set.
2. Create `DisjointUnionEnumeratedSets` with an appropriate `Family`.
3. Copy how `IntegerListsLex` does things

On a slight side note, `IntegerListsLex` has some finiteness issues that will might also need to be addressed; see #13749.



---

archive/issue_comments_167396.json:
```json
{
    "body": "Two small comments:\n\nFirst, \n\n\n```\nPartitions(NonNegativeIntegers())\n```\n\n \nreturns a value error. \n\nSecond, your set \n\n```\nPartitions(NonNegativeIntegers(), max_part = 3)\n```\n\n has repr:\n\n```\nPartitions of the integer Non negative integers satisfying constraints max_part=3\n```\n\nwhich is confusing. I have implemented something similar to Travis' first suggested solution to deal with the k-quotient side of things.",
    "created_at": "2012-11-26T04:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167396",
    "user": "chrisjamesberg"
}
```

Two small comments:

First, 


```
Partitions(NonNegativeIntegers())
```

 
returns a value error. 

Second, your set 

```
Partitions(NonNegativeIntegers(), max_part = 3)
```

 has repr:

```
Partitions of the integer Non negative integers satisfying constraints max_part=3
```

which is confusing. I have implemented something similar to Travis' first suggested solution to deal with the k-quotient side of things.



---

archive/issue_comments_167397.json:
```json
{
    "body": "Found another bug which is really related to this one. If we give an input to a kSchur function which isn't k-bounded, then it should return an error:\n\n\n```\nks = SymmetricFunctions(QQ).kBoundedSubspace(3,1).kschur()\nks([4,1])\nTraceback (click to the left of this block for traceback)\n...\nTypeError: do not know how to make x (= [4, 1]) an element of self\n(=3-bounded Symmetric Functions over Rational Field with t=1 in the\n3-Schur basis also with t=1)\n```\n\n\nBut this should also return an error:\n\n```\nks(Partition([4,1]))\nks3[4, 1]\n```\n",
    "created_at": "2012-11-26T05:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167397",
    "user": "chrisjamesberg"
}
```

Found another bug which is really related to this one. If we give an input to a kSchur function which isn't k-bounded, then it should return an error:


```
ks = SymmetricFunctions(QQ).kBoundedSubspace(3,1).kschur()
ks([4,1])
Traceback (click to the left of this block for traceback)
...
TypeError: do not know how to make x (= [4, 1]) an element of self
(=3-bounded Symmetric Functions over Rational Field with t=1 in the
3-Schur basis also with t=1)
```


But this should also return an error:

```
ks(Partition([4,1]))
ks3[4, 1]
```




---

archive/issue_comments_167398.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-07T22:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167398",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167399.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n\nDoes this affect at all #14235 (dependency one way or another?)",
    "created_at": "2013-03-07T23:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167399",
    "user": "zabrocki"
}
```

Replying to [comment:10 tscrim]:

Does this affect at all #14235 (dependency one way or another?)



---

archive/issue_comments_167400.json:
```json
{
    "body": "We both end up deleting the `NonNegativeIntegers` import (which is essentially trivial cleanup for both our patches), but other than that, the patches should<sup>(tm)</sup> commute.",
    "created_at": "2013-03-07T23:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167400",
    "user": "tscrim"
}
```

We both end up deleting the `NonNegativeIntegers` import (which is essentially trivial cleanup for both our patches), but other than that, the patches should<sup>(tm)</sup> commute.



---

archive/issue_comments_167401.json:
```json
{
    "body": "Everything looks good.  This seems to catch all the issues with having the correct indices in k-Schur functions that I can find.  Thanks for coming back to this one.",
    "created_at": "2013-03-11T20:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167401",
    "user": "zabrocki"
}
```

Everything looks good.  This seems to catch all the issues with having the correct indices in k-Schur functions that I can find.  Thanks for coming back to this one.



---

archive/issue_comments_167402.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-11T20:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167402",
    "user": "zabrocki"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167403.json:
```json
{
    "body": "Thank you for doing the review.",
    "created_at": "2013-03-11T20:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167403",
    "user": "tscrim"
}
```

Thank you for doing the review.



---

archive/issue_comments_167404.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-03-14T08:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167404",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_167405.json:
```json
{
    "body": "This should be rebased to sage-5.8.rc0.",
    "created_at": "2013-03-14T08:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167405",
    "user": "jdemeyer"
}
```

This should be rebased to sage-5.8.rc0.



---

archive/issue_comments_167406.json:
```json
{
    "body": "I've rebased to 5.8.rc0.\n\nApply: trac_13743-fix_kschur-ts.2.patch",
    "created_at": "2013-03-14T16:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167406",
    "user": "zabrocki"
}
```

I've rebased to 5.8.rc0.

Apply: trac_13743-fix_kschur-ts.2.patch



---

archive/issue_comments_167407.json:
```json
{
    "body": "It still doesn't apply properly, are you sure you have a clean build of sage-5.8.rc0?\n\n```\napplying /release/merger/patches/trac_13743-fix_kschur-ts.2.patch\npatching file sage/combinat/partition.py\nHunk #3 succeeded at 304 with fuzz 2 (offset -1 lines).\n```\n",
    "created_at": "2013-03-14T23:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167407",
    "user": "jdemeyer"
}
```

It still doesn't apply properly, are you sure you have a clean build of sage-5.8.rc0?

```
applying /release/merger/patches/trac_13743-fix_kschur-ts.2.patch
patching file sage/combinat/partition.py
Hunk #3 succeeded at 304 with fuzz 2 (offset -1 lines).
```




---

archive/issue_comments_167408.json:
```json
{
    "body": "Attachment [trac_13743-fix_kschur-ts.2.patch](tarball://root/attachments/some-uuid/ticket13743/trac_13743-fix_kschur-ts.2.patch) by jdemeyer created at 2013-03-15 21:42:46",
    "created_at": "2013-03-15T21:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167408",
    "user": "jdemeyer"
}
```

Attachment [trac_13743-fix_kschur-ts.2.patch](tarball://root/attachments/some-uuid/ticket13743/trac_13743-fix_kschur-ts.2.patch) by jdemeyer created at 2013-03-15 21:42:46



---

archive/issue_comments_167409.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-03-16T16:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167409",
    "user": "zabrocki"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_167410.json:
```json
{
    "body": "I am restoring positive review.  I had to recompile sage-5.8.rc0 to ensure that I didn't have a problem.  This patch now applies cleanly.",
    "created_at": "2013-03-16T16:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167410",
    "user": "zabrocki"
}
```

I am restoring positive review.  I had to recompile sage-5.8.rc0 to ensure that I didn't have a problem.  This patch now applies cleanly.



---

archive/issue_comments_167411.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-17T15:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13539",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13539#issuecomment-167411",
    "user": "jdemeyer"
}
```

Resolution: fixed
