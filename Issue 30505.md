# Issue 30505: add giac algo for limits

Issue created by migration from https://trac.sagemath.org/ticket/30742

Original creator: chapoton

Original creation time: 2020-10-07 18:38:50

CC:  frederichan parisse

to propose yet another choice


---

Comment by chapoton created at 2020-10-07 18:39:24

New commits:


---

Comment by chapoton created at 2020-10-07 18:39:24

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-10-07 18:40:18

Changing keywords from "" to "giac".


---

Comment by chapoton created at 2020-10-08 07:29:51

How to get rid of giac verbosity ?


---

Comment by chapoton created at 2020-10-08 09:07:04

This is the failing doctest:

```
File "src/sage/calculus/calculus.py", line 1255, in sage.calculus.calculus.limit
Failed example:
    (exp(-x)/(2+sin(x))).limit(x=oo, algorithm='giac')
Expected:
    0
Got:
    Help file /Applications/usr/share/giac/doc/fr/aide_cas not found
    Added 0 synonyms
    0
```



---

Comment by git created at 2020-10-08 09:09:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-10-08 16:27:34

Regarding this message issued at startup, see also #29552#comment:42

Still hoping that upstream giac will provide a way to suppress these messages


---

Comment by frederichan created at 2020-10-11 14:13:25

Changing status from needs_review to needs_work.


---

Comment by frederichan created at 2020-10-11 14:13:25

Hi frederic, if I am right you are using libgiac to compute the limit so I don't think that it is natural that 

```
(exp(-x)/(2+sin(x))).limit(x=oo, algorithm='giac')
```

also starts the external giac program. The guilty are the 3 lines with ._giac_()

```
from sage.libs.giac.giac import libgiac
        f = ex._giac_()
        v = v._giac_()
        a = a._giac_()
```

I guess you wanted to use the keywords convertions defined for the giac interface?
libgiac uses this filter automatically when the following condition is satisfied (line902 of giac.pyx)

```
if isinstance(s,Expression):
```

so it is nearly useless except that the Pb here is that `oo` is not an Expression, so `a` will not be converted by libgiac. Is there a better way to test all the instances that need convertions?


On the other hand, for the moment we can do as you did but without starting the external giac.
I think that

```
        from sage.libs.giac.giac import libgiac
        f = ex._giac_init_()
        v = v._giac_init_()
        a = a._giac_init_()
        if dir is None:
            l = libgiac.limit(f, v, a).sage()
```

}}}
does the convertion without starting the external giac program.

about the string that appear the first time you load the giac library I can't remove it from giacpy its from the c++ library. So in doctests I usually add a line to load the library before the actual doctests with a random flag

```
    sage: from sage.libs.giac.giac import libgiac     # random
```



---

Comment by git created at 2020-10-11 14:32:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-10-11 14:33:45

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-10-11 14:33:45

ok, merci. Voil√† une nouvelle tentative, avec les doctests qui passent.


---

Comment by frederichan created at 2020-10-11 20:25:28

looks good to me. 
make test was OK on fedora (fc32) amd64.


---

Comment by frederichan created at 2020-10-11 20:26:23

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-10-12 06:51:21

Merci


---

Comment by vbraun created at 2020-11-01 00:42:49

Resolution: fixed
