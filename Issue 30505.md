# Issue 30505: add giac algo for limits

archive/issues_030505.json:
```json
{
    "body": "CC:  frederichan parisse\n\nto propose yet another choice\n\nIssue created by migration from https://trac.sagemath.org/ticket/30742\n\n",
    "created_at": "2020-10-07T18:38:50Z",
    "labels": [
        "calculus",
        "major",
        "enhancement"
    ],
    "title": "add giac algo for limits",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30505",
    "user": "chapoton"
}
```
CC:  frederichan parisse

to propose yet another choice

Issue created by migration from https://trac.sagemath.org/ticket/30742





---

archive/issue_comments_435456.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-10-07T18:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435456",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_435457.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-07T18:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435457",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_435458.json:
```json
{
    "body": "Changing keywords from \"\" to \"giac\".",
    "created_at": "2020-10-07T18:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435458",
    "user": "chapoton"
}
```

Changing keywords from "" to "giac".



---

archive/issue_comments_435459.json:
```json
{
    "body": "How to get rid of giac verbosity ?",
    "created_at": "2020-10-08T07:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435459",
    "user": "chapoton"
}
```

How to get rid of giac verbosity ?



---

archive/issue_comments_435460.json:
```json
{
    "body": "This is the failing doctest:\n\n```\nFile \"src/sage/calculus/calculus.py\", line 1255, in sage.calculus.calculus.limit\nFailed example:\n    (exp(-x)/(2+sin(x))).limit(x=oo, algorithm='giac')\nExpected:\n    0\nGot:\n    Help file /Applications/usr/share/giac/doc/fr/aide_cas not found\n    Added 0 synonyms\n    0\n```\n",
    "created_at": "2020-10-08T09:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435460",
    "user": "chapoton"
}
```

This is the failing doctest:

```
File "src/sage/calculus/calculus.py", line 1255, in sage.calculus.calculus.limit
Failed example:
    (exp(-x)/(2+sin(x))).limit(x=oo, algorithm='giac')
Expected:
    0
Got:
    Help file /Applications/usr/share/giac/doc/fr/aide_cas not found
    Added 0 synonyms
    0
```




---

archive/issue_comments_435461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-08T09:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435461",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_435462.json:
```json
{
    "body": "Regarding this message issued at startup, see also #29552#comment:42\n\nStill hoping that upstream giac will provide a way to suppress these messages",
    "created_at": "2020-10-08T16:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435462",
    "user": "mkoeppe"
}
```

Regarding this message issued at startup, see also #29552#comment:42

Still hoping that upstream giac will provide a way to suppress these messages



---

archive/issue_comments_435463.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-11T14:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435463",
    "user": "frederichan"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_435464.json:
```json
{
    "body": "Hi frederic, if I am right you are using libgiac to compute the limit so I don't think that it is natural that \n\n```\n(exp(-x)/(2+sin(x))).limit(x=oo, algorithm='giac')\n```\n\nalso starts the external giac program. The guilty are the 3 lines with ._giac_()\n\n```\nfrom sage.libs.giac.giac import libgiac\n        f = ex._giac_()\n        v = v._giac_()\n        a = a._giac_()\n```\n\nI guess you wanted to use the keywords convertions defined for the giac interface?\nlibgiac uses this filter automatically when the following condition is satisfied (line902 of giac.pyx)\n\n```\nif isinstance(s,Expression):\n```\n\nso it is nearly useless except that the Pb here is that `oo` is not an Expression, so `a` will not be converted by libgiac. Is there a better way to test all the instances that need convertions?\n\n\nOn the other hand, for the moment we can do as you did but without starting the external giac.\nI think that\n\n```\n        from sage.libs.giac.giac import libgiac\n        f = ex._giac_init_()\n        v = v._giac_init_()\n        a = a._giac_init_()\n        if dir is None:\n            l = libgiac.limit(f, v, a).sage()\n```\n\n}}}\ndoes the convertion without starting the external giac program.\n\nabout the string that appear the first time you load the giac library I can't remove it from giacpy its from the c++ library. So in doctests I usually add a line to load the library before the actual doctests with a random flag\n\n```\n    sage: from sage.libs.giac.giac import libgiac     # random\n```\n",
    "created_at": "2020-10-11T14:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435464",
    "user": "frederichan"
}
```

Hi frederic, if I am right you are using libgiac to compute the limit so I don't think that it is natural that 

```
(exp(-x)/(2+sin(x))).limit(x=oo, algorithm='giac')
```

also starts the external giac program. The guilty are the 3 lines with ._giac_()

```
from sage.libs.giac.giac import libgiac
        f = ex._giac_()
        v = v._giac_()
        a = a._giac_()
```

I guess you wanted to use the keywords convertions defined for the giac interface?
libgiac uses this filter automatically when the following condition is satisfied (line902 of giac.pyx)

```
if isinstance(s,Expression):
```

so it is nearly useless except that the Pb here is that `oo` is not an Expression, so `a` will not be converted by libgiac. Is there a better way to test all the instances that need convertions?


On the other hand, for the moment we can do as you did but without starting the external giac.
I think that

```
        from sage.libs.giac.giac import libgiac
        f = ex._giac_init_()
        v = v._giac_init_()
        a = a._giac_init_()
        if dir is None:
            l = libgiac.limit(f, v, a).sage()
```

}}}
does the convertion without starting the external giac program.

about the string that appear the first time you load the giac library I can't remove it from giacpy its from the c++ library. So in doctests I usually add a line to load the library before the actual doctests with a random flag

```
    sage: from sage.libs.giac.giac import libgiac     # random
```




---

archive/issue_comments_435465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-11T14:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435465",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_435466.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-11T14:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435466",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_435467.json:
```json
{
    "body": "ok, merci. Voil\u00e0 une nouvelle tentative, avec les doctests qui passent.",
    "created_at": "2020-10-11T14:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435467",
    "user": "chapoton"
}
```

ok, merci. Voil√† une nouvelle tentative, avec les doctests qui passent.



---

archive/issue_comments_435468.json:
```json
{
    "body": "looks good to me. \nmake test was OK on fedora (fc32) amd64.",
    "created_at": "2020-10-11T20:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435468",
    "user": "frederichan"
}
```

looks good to me. 
make test was OK on fedora (fc32) amd64.



---

archive/issue_comments_435469.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-11T20:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435469",
    "user": "frederichan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_435470.json:
```json
{
    "body": "Merci",
    "created_at": "2020-10-12T06:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435470",
    "user": "chapoton"
}
```

Merci



---

archive/issue_comments_435471.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-01T00:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30505#issuecomment-435471",
    "user": "vbraun"
}
```

Resolution: fixed
