# Issue 21277: sage -rst2ipynb command

Issue created by migration from Trac.

Original creator: tmonteil

Original creation time: 2016-09-16 23:22:04

CC:  slabbe kcrisman

The `sage -rst2ipynb` allows to easily transform `rst` source into `ipynb` worksheet. Code will be added once #21513 is reviewed.


---

Comment by nthiery created at 2016-11-23 10:02:15

Ah, I had not noticed that there was no code yet here.

Thierry, do you have preliminary code?


---

Comment by tmonteil created at 2016-11-23 10:04:37

Sure, but since there were many dependencies, i prefered to push changes once the previous dependency is positively reviewed, instead of having tons of branches to merge and rebase.


---

Comment by nthiery created at 2016-11-23 10:06:18

Sure thing :-)


---

Comment by tmonteil created at 2016-11-24 00:15:37

Changing status from new to needs_review.


---

Comment by tmonteil created at 2016-11-24 00:15:37

New commits:


---

Comment by slabbe created at 2016-11-24 10:15:59

Would it be possible to have some basic help message including examples:


```
$ sage -rst2ipynb -h
usage: rst2ipynb [-o OUTPUT] [-k KERNEL] [-v] [-d] [input]
rst2ipynb: error: unrecognized arguments: -h
```


like


```
$ sage -rst2sws -h
Usage: 

    sage -rst2sws [options] <source> <destination>

Generates Sage worksheet (.sws) from standalone reStructuredText source.

Example:

    sage -rst2sws file.rst file.sws

Remarks:

    About LaTeX:

        You can put LaTeX expression between backticks "`", dollar signs
        "$" or double dollar signs "$$". Math role is not supported yet
        (get involved!).

        Examples: `\\alpha`, $\\beta$ or $$\\gamma$$.

    About backslashes:

        In reStructuredText, backslashes must be escaped, otherwise they
        are ignored. This is not quite practical for Sage's purposes
        since backslashes are never escaped in the docstrings. If you
        write `\alpha`, $\beta$ or $$\gamma$$, add the line

            ..  escape-backslashes

        to the file and this script will consider all backslashes
        escaped. Alternatively, you may use the available options.

Options:
  -h, --help            show this help message and exit
  --escape-backslashes  Escape all backslashes in the input file before
                        execution. Default: disabled.
  --no-escape-backslashes
                        Disable escaping all backslashes in the input file
                        before execution. This overrides the presence of the
                        line '.. escape-backslashes' in the file, which can
                        also be used to escape all backslashes in the file.
```


using `argparse` or something?


---

Comment by nthiery created at 2016-11-24 10:41:17

I am doing some minor adjustments that I'll discuss now with the above with Sébastien


---

Comment by nthiery created at 2016-11-24 10:53:55

Thierry: do you have a strong preference for

```
    sage -rst2ipynb bla.rst bla.ipynb
```

rather than

```
    sage -rst2ipynb bla.rst -o bla.ipynb
```

?

If yes, I might as well update rst2ipynb to simplify the sage wrapper


---

Comment by nthiery created at 2016-11-24 10:54:18

Hmm, although that would take another round of updating the package ...


---

Comment by nthiery created at 2016-11-24 10:55:04

I was thinking about that because I believe Sébastien's suggestion would be best implemented in the rst2ipynb script.


---

Comment by nthiery created at 2016-11-24 11:04:44

I have checked Thierry's changes and made minor improvements. I am fine with the current state.
----
New commits:


---

Comment by nthiery created at 2016-11-24 11:07:04

I'll now try to grab Sébastien :-)


---

Comment by git created at 2016-11-24 13:49:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2016-11-24 13:54:37

We just discussed with Sébastien (cf. previous commit).

Plan for the next version of rst2ipynb itself (in a later ticket)
- add documentation upon `rst2ipynb -h`
- use the syntax `rst2ipynb input output` for consistency with other docutils tools
- support for Python prompts `>>>>`
- update the Sage package, simplifying `sage-rst2ipy` accordingly (just pass the arguments as is)


---

Comment by slabbe created at 2016-11-24 14:18:05

`IPython notebook worksheet` -> `Jupyter notebook`


---

Comment by git created at 2016-11-24 14:22:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2016-11-24 14:30:37

New commits:


---

Comment by slabbe created at 2016-11-24 14:30:37

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2016-11-24 14:33:54

Changing status from positive_review to needs_review.


---

Comment by slabbe created at 2016-11-24 14:33:54

There were simultaneous commits including one that is not reviewed. So I put it back to needs review.


---

Comment by tmonteil created at 2016-11-24 14:34:43

- `@`slabbe : i added a very similar help system than for the other commands.
- `@`nthiery : you should not push branches after some reviewers made an explicit request to the author, i was working on my branch without internet connection dudring the lunch break. Especially for such minor requests, it doesn't worth knitting with merges.
- `@`slabbe : i used IPython notebook because of the `.ipynb` extension, i am not sure what is the recommended name.


---

Comment by nthiery created at 2016-11-24 14:40:23

I merged the two branches.
----
New commits:


---

Comment by nthiery created at 2016-11-24 15:34:31

Sorry for the miscoordination; there was a unique occasion (Sage Days 79 are finishing just now) to sprint with Sébastien with fast face-to-face discussions to polish the details. But you are right, I should have asked for confirmation on your side.

For the record: I just pushed on the rst2ipynb github repo the following changes:
- rst2ipynb -h documentation
- experimental support for Python (continuation) prompts (Sébastien: please try and shake!)
- support for rst2ipynb input output

I let you decide whether you prefer to include that in #21513 and update #21513 accordingly or leave that for later. In the first case, I'll do a new release of rst2ipynb. I'll be on and off the network the next three days, but should be able to squeeze that within 24 hours after notice.

Yeah, almost done with that. Thank you Thierry for the wrapping and Sébastien for the review!


---

Comment by slabbe created at 2016-11-28 11:11:48

Dear Thierry, Nicolas,

After thinking about this, I suggest to merge into Sage the commit `017ecb7681c0159927cf8c5e6bf15391c651056e` which does not include Thierry's commit `​c0fe2a0`. Indeed, I asked for some nice help `sage -rst2ipynb -h` message, but after reconsideration I believe this is not the role of the bash code to do this. For the same reason as `sage -ipython -h` will give you the same thing as `ipython -h`. Therefore, I suggest to postpone the better help message to another ticket which will consist in updating `rst2ipynb` to a new version.

I wait for your approval before to do any change on this ticket.

(Git question: no branch are pointing to the commit `017ecb7681`, do I have to create a branch that links to this commit, or is the commit hash enough?)


---

Comment by nthiery created at 2016-11-29 09:29:11

I am fine with both options.


---

Comment by slabbe created at 2016-11-29 10:08:23

I am replacing the branch name by the earlier commit `017ecb7681c0159927cf8c5e6bf15391c651056e` as I am suggesting this commit to be merged into Sage for this ticket. Let see if it works.

I am still waiting for Thierry's approval before changing the status to positive review.


---

Comment by slabbe created at 2016-11-29 10:20:08

Changing keywords from "" to "days79".


---

Comment by slabbe created at 2016-11-30 14:35:46

I created a branch u/slabbe/21514 with commit `017ecb7681c015` merged into 7.5.beta4.

Sébastien
----
Last 10 new commits:


---

Comment by slabbe created at 2016-12-01 07:42:43

Replying to [comment:24 tmonteil]:
> - `@`slabbe : i used IPython notebook because of the `.ipynb` extension, i am not sure what is the recommended name.

http://nbviewer.jupyter.org/ says "Jupyter Notebooks". I would be okay with "IPython Notebooks" but not "IPython worksheets".


---

Comment by git created at 2016-12-01 08:06:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-01 08:08:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2016-12-01 08:13:07

I added some doctests in `tests/cmdline.py`. To me this ticket is a positive review. I let you review the doctests I added.

Sébastien


---

Comment by slabbe created at 2016-12-02 07:35:01

I forgot to add `# optional - rst2ipynb` to the new doctests...


---

Comment by git created at 2016-12-08 10:28:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2016-12-08 10:30:45

Modifications to `tests/cmdline.py` needs review.


---

Comment by slabbe created at 2016-12-19 10:59:20

ping :)


---

Comment by slabbe created at 2017-01-10 13:56:54

ok for the merge:)
----
New commits:


---

Comment by nthiery created at 2017-02-20 20:48:29

Any reason left not to set a positive review?


---

Comment by tmonteil created at 2017-02-21 06:49:53

Changing status from needs_review to positive_review.


---

Comment by tmonteil created at 2017-02-21 06:49:53

I had some general comments, but i guess it is better to have this merged soon.


---

Comment by vbraun created at 2017-02-23 12:00:41

Resolution: fixed
