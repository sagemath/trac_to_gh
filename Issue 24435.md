# Issue 24435: Add --enable-bits=64 configure option

Issue created by migration from https://trac.sagemath.org/ticket/24672

Original creator: jdemeyer

Original creation time: 2018-02-06 15:01:37

CC:  dimpase embray

As a "reboot" of the `SAGE64` mess, let us add `--enable-bits=32` and `--enable-bits=64` options for `configure`. To simplify the build system, this will force building GCC if the bitness does not equal the default produced by GCC.


---

Comment by git created at 2018-02-06 16:14:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2018-02-07 16:11:18

I don't see how the logic in the patch addresses the case of the compiler simply needing a switch `-mX` to produce `X`-bit executables (building gcc in such a case is an overkill)


---

Comment by embray created at 2018-02-07 18:22:18

Oh, so it's okay when _you_ make patch bombs ;)

I wonder if this could use [AX_GCC_ARCHFLAG](https://www.gnu.org/software/autoconf-archive/ax_gcc_archflag.html) instead, though admittedly I haven't studied it that closely.


---

Comment by jdemeyer created at 2018-02-07 19:29:25

Replying to [comment:3 dimpase]:
> I don't see how the logic in the patch addresses the case of the compiler simply needing a switch `-mX` to produce `X`-bit executables (building gcc in such a case is an overkill)

I'm intentionally not addressing that case. I'm simply building GCC, overkill or not.


---

Comment by jdemeyer created at 2018-02-07 19:54:34

Replying to [comment:4 embray]:
> Oh, so it's okay when _you_ make patch bombs ;)

I guess you are looking at the diff for #23733. The patch on this ticket is quite small.


---

Comment by jdemeyer created at 2018-02-07 19:55:51

Replying to [comment:4 embray]:
> I wonder if this could use [AX_GCC_ARCHFLAG](https://www.gnu.org/software/autoconf-archive/ax_gcc_archflag.html) instead, though admittedly I haven't studied it that closely.

That seems to be for setting `-march` and `-mtune`. It seems unrelated to building GCC or to choosing 32/64 bits.


---

Comment by embray created at 2018-02-08 08:46:55

Right, I thought maybe it would also set (while allowing overrides) `-m64` or `-m32` depending on your architecture, since those flags are basically high-level `-march` flags.  But apparently not.  So carry on.  I don't like the name `--enable-bits` but I also can't think of anything better.

If this is "needs review" then I give it a positive review...


---

Comment by embray created at 2018-02-08 08:49:52

Maybe one thing I would _suggest_, but not insist on at the moment, is that you make this into an `AC_DEFUN` macro and put it in a separate file in the `m4/` directory.  Name both the file and macro `sage_...` and `SAGE_...` respectively.  In my other configure-related work I'm trying to move more of our configure.ac into macros where appropriate and I think this would be a good candidate.  But I'm happy to do it later too.


---

Comment by embray created at 2018-02-08 08:54:44

Oh, and I think we're supposed to upload new `configure` packages when we update `configure.ac`...


---

Comment by jdemeyer created at 2018-02-08 09:04:35

Replying to [comment:8 embray]:
> If this is "needs review"

Certainly not. I still need to fix building the correct variant of GCC.


---

Comment by jdemeyer created at 2018-02-08 09:06:13

Replying to [comment:10 embray]:
> Oh, and I think we're supposed to upload new `configure` packages when we update `configure.ac`...

It depends. That is only _required_ when Sage won't build anymore with the old `configure` script. It can be _convenient_ to add it for testing purposes, if you want to test a ticket on systems without `autoconf`.


---

Comment by dimpase created at 2018-02-10 13:21:25

Replying to [comment:5 jdemeyer
> 
> I'm intentionally not addressing that case. I'm simply building GCC, overkill or not.

with clang support in, it sounds outdated...


---

Comment by jdemeyer created at 2018-02-10 13:42:49

Replying to [comment:13 dimpase]:
> with clang support in, it sounds outdated...

I don't see how this is related to clang support.

Anyway, I'm trying to add a feature. I'm doing that in the way that seems easiest to me, which involves installing GCC. Nobody is forcing you to use this feature. And if you want to improve the implementation of this feature, you are more than welcome to improve it on a follow-up ticket.


---

Comment by mkoeppe created at 2021-08-26 03:51:29

outdated, should close


---

Comment by mkoeppe created at 2021-08-26 03:51:29

Changing status from new to needs_review.


---

Comment by dimpase created at 2021-08-26 06:51:54

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-09-02 18:48:47

Resolution: invalid
