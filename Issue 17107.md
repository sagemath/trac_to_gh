# Issue 17107: Ask for dual when using plantri

archive/issues_017107.json:
```json
{
    "body": "CC:  @nathanncohen\n\nKeywords: plantri\n\nPlantri has an option `-d` to get the planar dual of a planar graph instead, for the various classes that it can generate.\n\nIt would be good to allow this option in the methods introduced in #16970.\n\nThis could be useful, as we have no class for planar graphs so far.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17344\n\n",
    "created_at": "2014-11-14T15:10:35Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Ask for dual when using plantri",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17107",
    "user": "https://github.com/fchapoton"
}
```
CC:  @nathanncohen

Keywords: plantri

Plantri has an option `-d` to get the planar dual of a planar graph instead, for the various classes that it can generate.

It would be good to allow this option in the methods introduced in #16970.

This could be useful, as we have no class for planar graphs so far.

Issue created by migration from https://trac.sagemath.org/ticket/17344





---

archive/issue_comments_227131.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-11-14T15:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227131",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_227132.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2014-11-14T15:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227132",
    "user": "https://github.com/fchapoton"
}
```

Changing priority from major to minor.



---

archive/issue_comments_227133.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-15T20:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227134.json:
```json
{
    "body": "Nathann, I have a problem here for the dual of general planar graphs. The test I wrote is failing. And it seems that this may be a problem of multiple edges.\n\nThe Error message is\n\n```\nsage:  gen = graphs.planar_graphs(4,dual=True)  # optional plantri\nsage: graphics_array([u.plot() for u in list(gen)])\n...\nValueError: embedding is not valid for Multi-graph on 3 vertices\n```\n\nDo you think I should rather remove this `dual=True` possibility for general planar graphs ?",
    "created_at": "2015-02-26T15:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227134",
    "user": "https://github.com/fchapoton"
}
```

Nathann, I have a problem here for the dual of general planar graphs. The test I wrote is failing. And it seems that this may be a problem of multiple edges.

The Error message is

```
sage:  gen = graphs.planar_graphs(4,dual=True)  # optional plantri
sage: graphics_array([u.plot() for u in list(gen)])
...
ValueError: embedding is not valid for Multi-graph on 3 vertices
```

Do you think I should rather remove this `dual=True` possibility for general planar graphs ?



---

archive/issue_comments_227135.json:
```json
{
    "body": "Hello,\n\n> Nathann, I have a problem here for the dual of general planar graphs. The test I wrote is failing. And it seems that this may be a problem of multiple edges.\n\nIt seems that the problems come from the embedding. You could first try to remove the embedding stored within the graph to check that it all works, and if it does try to find out what is wrong with the embedding contained in this graph ?\n\nNathann",
    "created_at": "2015-02-26T15:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227135",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> Nathann, I have a problem here for the dual of general planar graphs. The test I wrote is failing. And it seems that this may be a problem of multiple edges.

It seems that the problems come from the embedding. You could first try to remove the embedding stored within the graph to check that it all works, and if it does try to find out what is wrong with the embedding contained in this graph ?

Nathann



---

archive/issue_comments_227136.json:
```json
{
    "body": "Hello,\n\nwhen commenting the set_embeddings line, one obtains graphs, but they are not correct. It seems that every multiple edge is duplicated. For example, the \"4 star graph\" dual should have one vertex and three loops, it has 6 loops.\n\nSo, maybe a problem in read_planar_code ?",
    "created_at": "2015-02-26T15:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227136",
    "user": "https://github.com/fchapoton"
}
```

Hello,

when commenting the set_embeddings line, one obtains graphs, but they are not correct. It seems that every multiple edge is duplicated. For example, the "4 star graph" dual should have one vertex and three loops, it has 6 loops.

So, maybe a problem in read_planar_code ?



---

archive/issue_comments_227137.json:
```json
{
    "body": "Hmmmmmmm... I don't know, I am not too surprised by 6 loops in this situation. \"The face touches 6 half-edges\", or something like that. I agree that it is odd at first, but I would not call it a bug yet.",
    "created_at": "2015-02-26T15:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227137",
    "user": "https://github.com/nathanncohen"
}
```

Hmmmmmmm... I don't know, I am not too surprised by 6 loops in this situation. "The face touches 6 half-edges", or something like that. I agree that it is odd at first, but I would not call it a bug yet.



---

archive/issue_comments_227138.json:
```json
{
    "body": "For the dual of the 4-cycle, one gets two vertices linked by 8 edges..",
    "created_at": "2015-02-26T15:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227138",
    "user": "https://github.com/fchapoton"
}
```

For the dual of the 4-cycle, one gets two vertices linked by 8 edges..



---

archive/issue_comments_227139.json:
```json
{
    "body": "> For the dual of the 4-cycle, one gets two vertices linked by 8 edges..\n\nWell, now that is weird `:-P`\n\nCan you see if plantri (in command-line) has some different output, which could let you check that it is indeed returning 'correct' graphs ? If that's correct, then indeed the problem may come from `read_planar_code`.\n\nNathann",
    "created_at": "2015-02-26T16:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227139",
    "user": "https://github.com/nathanncohen"
}
```

> For the dual of the 4-cycle, one gets two vertices linked by 8 edges..

Well, now that is weird `:-P`

Can you see if plantri (in command-line) has some different output, which could let you check that it is indeed returning 'correct' graphs ? If that's correct, then indeed the problem may come from `read_planar_code`.

Nathann



---

archive/issue_comments_227140.json:
```json
{
    "body": "How should I do that ?\n\nI tried \n\n```\nplantri -pm1c1d 4\n```\n\nin a sage-shell, but I got\n\n```\nplantri -pm1c1d 4 \n6 polytopes written to stdout; cpu=0.00 sec\n```\n\nand then binary things..",
    "created_at": "2015-02-26T17:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227140",
    "user": "https://github.com/fchapoton"
}
```

How should I do that ?

I tried 

```
plantri -pm1c1d 4
```

in a sage-shell, but I got

```
plantri -pm1c1d 4 
6 polytopes written to stdout; cpu=0.00 sec
```

and then binary things..



---

archive/issue_comments_227141.json:
```json
{
    "body": "> How should I do that ?\n\nhttp://cs.anu.edu.au/~bdm/plantri/plantri-guide.txt\n\nIt seems that different output format are available.\n\nNathann",
    "created_at": "2015-02-26T17:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227141",
    "user": "https://github.com/nathanncohen"
}
```

> How should I do that ?

http://cs.anu.edu.au/~bdm/plantri/plantri-guide.txt

It seems that different output format are available.

Nathann



---

archive/issue_comments_227142.json:
```json
{
    "body": "Ok, here is the output of plantri in ascii\n\n```\nplantri -pm1c1da 4 \n4 bcd,adc,abd,acb\n3 bccb,aac,aba\n2 bbbb,aaaa\n2 abbba,aaa\n1 aaaaaa\n1 aaaaaa\n```\n\nWhen there is no loop, this looks fine. So if we assume that the binary code is the same, then there must be a problem in the reading procedure.\n\nFor loops, as in the last two (duals of trees with 4 vertices), it could be just a matter of conventions. But I would expect only 3 loops, as these trees have 3 edges.",
    "created_at": "2015-02-26T20:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227142",
    "user": "https://github.com/fchapoton"
}
```

Ok, here is the output of plantri in ascii

```
plantri -pm1c1da 4 
4 bcd,adc,abd,acb
3 bccb,aac,aba
2 bbbb,aaaa
2 abbba,aaa
1 aaaaaa
1 aaaaaa
```

When there is no loop, this looks fine. So if we assume that the binary code is the same, then there must be a problem in the reading procedure.

For loops, as in the last two (duals of trees with 4 vertices), it could be just a matter of conventions. But I would expect only 3 loops, as these trees have 3 edges.



---

archive/issue_comments_227143.json:
```json
{
    "body": "Ok, I think I see.\n\n1) The output of plantri is giving the list of half-edges around each vertex. This is correct.\n\n2) When the graph has no loops or multiple edges, the graph constructor of sage is able to eat twice the same edge (in both direction) and give just one edge. But when there are multiple edges, it will not identify the same edge given in two directions.\n\nThis does not seem easy to remedy. Maybe I should restrict my ticket to the cases where duals have no loops or multiples edges ?",
    "created_at": "2015-02-27T16:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227143",
    "user": "https://github.com/fchapoton"
}
```

Ok, I think I see.

1) The output of plantri is giving the list of half-edges around each vertex. This is correct.

2) When the graph has no loops or multiple edges, the graph constructor of sage is able to eat twice the same edge (in both direction) and give just one edge. But when there are multiple edges, it will not identify the same edge given in two directions.

This does not seem easy to remedy. Maybe I should restrict my ticket to the cases where duals have no loops or multiples edges ?



---

archive/issue_comments_227144.json:
```json
{
    "body": "Helloooooooooo !\n\n> 1) The output of plantri is giving the list of half-edges around each vertex. This is correct.\n> \n> 2) When the graph has no loops or multiple edges, the graph constructor of sage is able to eat twice the same edge (in both direction) and give just one edge. But when there are multiple edges, it will not identify the same edge given in two directions.\n\nOh. I see. It seems that I forgot something when writing #15706 (see also https://groups.google.com/forum/#!topic/sage-devel/78OBybXrfI8) for `Graph([(1,2),(1,2)])` should display a warning.\n\nI will write a small patch for this today or tomorrow.\n\n> This does not seem easy to remedy. Maybe I should restrict my ticket to the cases where duals have no loops or multiples edges ?\n\nWell, if a \"planar code\" always lists edges twice (once in each direction) isn't it better to just simplify this in this `read_planar_code` function ?\n\nNathann",
    "created_at": "2015-02-27T16:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227144",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooooooo !

> 1) The output of plantri is giving the list of half-edges around each vertex. This is correct.
> 
> 2) When the graph has no loops or multiple edges, the graph constructor of sage is able to eat twice the same edge (in both direction) and give just one edge. But when there are multiple edges, it will not identify the same edge given in two directions.

Oh. I see. It seems that I forgot something when writing #15706 (see also https://groups.google.com/forum/#!topic/sage-devel/78OBybXrfI8) for `Graph([(1,2),(1,2)])` should display a warning.

I will write a small patch for this today or tomorrow.

> This does not seem easy to remedy. Maybe I should restrict my ticket to the cases where duals have no loops or multiples edges ?

Well, if a "planar code" always lists edges twice (once in each direction) isn't it better to just simplify this in this `read_planar_code` function ?

Nathann



---

archive/issue_comments_227145.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-05T19:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227145",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227146.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-05T19:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227146",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_227147.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-06T16:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227147",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227148.json:
```json
{
    "body": "ok, here is something that works (at least a little bit) and pass the tests.\n\nI wonder that is the status of `set_embeddings` for graphs with loops and multiples edges.",
    "created_at": "2015-03-06T16:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227148",
    "user": "https://github.com/fchapoton"
}
```

ok, here is something that works (at least a little bit) and pass the tests.

I wonder that is the status of `set_embeddings` for graphs with loops and multiples edges.



---

archive/issue_comments_227149.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-06T16:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227149",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_227150.json:
```json
{
    "body": "It looks rather good. Could you add some doctests somewhere, however, to make sure that the new behaviour of `read_planar_code` does not work against us ? Something like counting the number of edges of a 3-connected triangulation (the way you already count the number of vertices), or the behaviour of your 'dual' option for non-3-connected graphs (i.e. there are multiple edges and/or loops)?\n\nThis is just to make sure that we will get a warning if someday they decide that they do not want to enumerate the multiple edges or loops twice `^^;`\n\nNathann",
    "created_at": "2015-03-09T16:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227150",
    "user": "https://github.com/nathanncohen"
}
```

It looks rather good. Could you add some doctests somewhere, however, to make sure that the new behaviour of `read_planar_code` does not work against us ? Something like counting the number of edges of a 3-connected triangulation (the way you already count the number of vertices), or the behaviour of your 'dual' option for non-3-connected graphs (i.e. there are multiple edges and/or loops)?

This is just to make sure that we will get a warning if someday they decide that they do not want to enumerate the multiple edges or loops twice `^^;`

Nathann



---

archive/issue_comments_227151.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-09T20:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227152.json:
```json
{
    "body": "Thanks Nathann.\n\nI have tried to add some tests, not sure if I did it right.\n\nI have also corrected a few trac and oeis roles.",
    "created_at": "2015-03-09T20:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227152",
    "user": "https://github.com/fchapoton"
}
```

Thanks Nathann.

I have tried to add some tests, not sure if I did it right.

I have also corrected a few trac and oeis roles.



---

archive/issue_comments_227153.json:
```json
{
    "body": "Helloooooooooooo,\n\n> I have tried to add some tests, not sure if I did it right.\n\nWhat you did is good. I had in mind some other test which I tried to add, but then I found a bug:\n\n\n```\nsage: [x.size() for x in graphs.planar_graphs(5,dual=True)]\n...\nValueError: embedding is not valid for Looped graph on 4 vertices\n```\n\n\nNathann\n\nP.S.: SOrryyyyy... I know that this review is becoming a bit unpleasant `^^;`",
    "created_at": "2015-03-09T20:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227153",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooooooooo,

> I have tried to add some tests, not sure if I did it right.

What you did is good. I had in mind some other test which I tried to add, but then I found a bug:


```
sage: [x.size() for x in graphs.planar_graphs(5,dual=True)]
...
ValueError: embedding is not valid for Looped graph on 4 vertices
```


Nathann

P.S.: SOrryyyyy... I know that this review is becoming a bit unpleasant `^^;`



---

archive/issue_comments_227154.json:
```json
{
    "body": "maybe we should just also avoid to set embeddings if there are loops ?",
    "created_at": "2015-03-09T21:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227154",
    "user": "https://github.com/fchapoton"
}
```

maybe we should just also avoid to set embeddings if there are loops ?



---

archive/issue_comments_227155.json:
```json
{
    "body": "HMmmmm... Yep, it is probably safer for the moment. I expect that embedding have not been defined in Sage to handle this kind of things `:-/`\n\nNathann",
    "created_at": "2015-03-09T21:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227155",
    "user": "https://github.com/nathanncohen"
}
```

HMmmmm... Yep, it is probably safer for the moment. I expect that embedding have not been defined in Sage to handle this kind of things `:-/`

Nathann



---

archive/issue_comments_227156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-10T08:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227157.json:
```json
{
    "body": "Hellooooooo Fr\u00e9d\u00e9ric!\n\nThe branch looks ready. I added a small commit on top of yours at public/17344: it modifies the latest doctest you added in order to make sure that we did not miss any edge while reading the planar code of the dual graphs.\n\nIf this is fine for you, please add this commit to your branch (or change the branch's name) and set this ticket to `positive_review`.\n\nThanks for your ticket,\n\nNathann",
    "created_at": "2015-03-10T15:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227157",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooo Frédéric!

The branch looks ready. I added a small commit on top of yours at public/17344: it modifies the latest doctest you added in order to make sure that we did not miss any edge while reading the planar code of the dual graphs.

If this is fine for you, please add this commit to your branch (or change the branch's name) and set this ticket to `positive_review`.

Thanks for your ticket,

Nathann



---

archive/issue_comments_227158.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-10T17:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227158",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227159.json:
```json
{
    "body": "Then positive review. Thank you !",
    "created_at": "2015-03-10T17:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227159",
    "user": "https://github.com/fchapoton"
}
```

Then positive review. Thank you !



---

archive/issue_comments_227160.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-10T23:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17107#issuecomment-227160",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
