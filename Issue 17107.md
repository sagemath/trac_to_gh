# Issue 17107: Ask for dual when using plantri

Issue created by migration from https://trac.sagemath.org/ticket/17344

Original creator: chapoton

Original creation time: 2014-11-14 15:10:35

CC:  ncohen

Keywords: plantri

Plantri has an option `-d` to get the planar dual of a planar graph instead, for the various classes that it can generate.

It would be good to allow this option in the methods introduced in #16970.

This could be useful, as we have no class for planar graphs so far.


---

Comment by chapoton created at 2014-11-14 15:25:57

New commits:


---

Comment by chapoton created at 2014-11-14 15:25:57

Changing priority from major to minor.


---

Comment by git created at 2014-11-15 20:11:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-02-26 15:39:57

Nathann, I have a problem here for the dual of general planar graphs. The test I wrote is failing. And it seems that this may be a problem of multiple edges.

The Error message is

```
sage:  gen = graphs.planar_graphs(4,dual=True)  # optional plantri
sage: graphics_array([u.plot() for u in list(gen)])
...
ValueError: embedding is not valid for Multi-graph on 3 vertices
```

Do you think I should rather remove this `dual=True` possibility for general planar graphs ?


---

Comment by ncohen created at 2015-02-26 15:43:59

Hello,

> Nathann, I have a problem here for the dual of general planar graphs. The test I wrote is failing. And it seems that this may be a problem of multiple edges.

It seems that the problems come from the embedding. You could first try to remove the embedding stored within the graph to check that it all works, and if it does try to find out what is wrong with the embedding contained in this graph ?

Nathann


---

Comment by chapoton created at 2015-02-26 15:49:46

Hello,

when commenting the set_embeddings line, one obtains graphs, but they are not correct. It seems that every multiple edge is duplicated. For example, the "4 star graph" dual should have one vertex and three loops, it has 6 loops.

So, maybe a problem in read_planar_code ?


---

Comment by ncohen created at 2015-02-26 15:52:40

Hmmmmmmm... I don't know, I am not too surprised by 6 loops in this situation. "The face touches 6 half-edges", or something like that. I agree that it is odd at first, but I would not call it a bug yet.


---

Comment by chapoton created at 2015-02-26 15:58:35

For the dual of the 4-cycle, one gets two vertices linked by 8 edges..


---

Comment by ncohen created at 2015-02-26 16:01:26

> For the dual of the 4-cycle, one gets two vertices linked by 8 edges..

Well, now that is weird `:-P`

Can you see if plantri (in command-line) has some different output, which could let you check that it is indeed returning 'correct' graphs ? If that's correct, then indeed the problem may come from `read_planar_code`.

Nathann


---

Comment by chapoton created at 2015-02-26 17:00:12

How should I do that ?

I tried 

```
plantri -pm1c1d 4
```

in a sage-shell, but I got

```
plantri -pm1c1d 4 
6 polytopes written to stdout; cpu=0.00 sec
```

and then binary things..


---

Comment by ncohen created at 2015-02-26 17:44:29

> How should I do that ?

http://cs.anu.edu.au/~bdm/plantri/plantri-guide.txt

It seems that different output format are available.

Nathann


---

Comment by chapoton created at 2015-02-26 20:06:45

Ok, here is the output of plantri in ascii

```
plantri -pm1c1da 4 
4 bcd,adc,abd,acb
3 bccb,aac,aba
2 bbbb,aaaa
2 abbba,aaa
1 aaaaaa
1 aaaaaa
```

When there is no loop, this looks fine. So if we assume that the binary code is the same, then there must be a problem in the reading procedure.

For loops, as in the last two (duals of trees with 4 vertices), it could be just a matter of conventions. But I would expect only 3 loops, as these trees have 3 edges.


---

Comment by chapoton created at 2015-02-27 16:11:21

Ok, I think I see.

1) The output of plantri is giving the list of half-edges around each vertex. This is correct.

2) When the graph has no loops or multiple edges, the graph constructor of sage is able to eat twice the same edge (in both direction) and give just one edge. But when there are multiple edges, it will not identify the same edge given in two directions.

This does not seem easy to remedy. Maybe I should restrict my ticket to the cases where duals have no loops or multiples edges ?


---

Comment by ncohen created at 2015-02-27 16:55:04

Helloooooooooo !

> 1) The output of plantri is giving the list of half-edges around each vertex. This is correct.
> 
> 2) When the graph has no loops or multiple edges, the graph constructor of sage is able to eat twice the same edge (in both direction) and give just one edge. But when there are multiple edges, it will not identify the same edge given in two directions.

Oh. I see. It seems that I forgot something when writing #15706 (see also https://groups.google.com/forum/#!topic/sage-devel/78OBybXrfI8) for `Graph([(1,2),(1,2)])` should display a warning.

I will write a small patch for this today or tomorrow.

> This does not seem easy to remedy. Maybe I should restrict my ticket to the cases where duals have no loops or multiples edges ?

Well, if a "planar code" always lists edges twice (once in each direction) isn't it better to just simplify this in this `read_planar_code` function ?

Nathann


---

Comment by chapoton created at 2015-03-05 19:52:21

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-03-05 19:52:28

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-03-06 16:34:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-03-06 16:38:03

ok, here is something that works (at least a little bit) and pass the tests.

I wonder that is the status of `set_embeddings` for graphs with loops and multiples edges.


---

Comment by chapoton created at 2015-03-06 16:38:03

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2015-03-09 16:12:14

It looks rather good. Could you add some doctests somewhere, however, to make sure that the new behaviour of `read_planar_code` does not work against us ? Something like counting the number of edges of a 3-connected triangulation (the way you already count the number of vertices), or the behaviour of your 'dual' option for non-3-connected graphs (i.e. there are multiple edges and/or loops)?

This is just to make sure that we will get a warning if someday they decide that they do not want to enumerate the multiple edges or loops twice `^^;`

Nathann


---

Comment by git created at 2015-03-09 20:02:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-03-09 20:04:41

Thanks Nathann.

I have tried to add some tests, not sure if I did it right.

I have also corrected a few trac and oeis roles.


---

Comment by ncohen created at 2015-03-09 20:38:27

Helloooooooooooo,

> I have tried to add some tests, not sure if I did it right.

What you did is good. I had in mind some other test which I tried to add, but then I found a bug:


```
sage: [x.size() for x in graphs.planar_graphs(5,dual=True)]
...
ValueError: embedding is not valid for Looped graph on 4 vertices
```


Nathann

P.S.: SOrryyyyy... I know that this review is becoming a bit unpleasant `^^;`


---

Comment by chapoton created at 2015-03-09 21:29:05

maybe we should just also avoid to set embeddings if there are loops ?


---

Comment by ncohen created at 2015-03-09 21:32:55

HMmmmm... Yep, it is probably safer for the moment. I expect that embedding have not been defined in Sage to handle this kind of things `:-/`

Nathann


---

Comment by git created at 2015-03-10 08:39:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-03-10 15:13:46

Hellooooooo Frédéric!

The branch looks ready. I added a small commit on top of yours at public/17344: it modifies the latest doctest you added in order to make sure that we did not miss any edge while reading the planar code of the dual graphs.

If this is fine for you, please add this commit to your branch (or change the branch's name) and set this ticket to `positive_review`.

Thanks for your ticket,

Nathann


---

Comment by chapoton created at 2015-03-10 17:13:55

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2015-03-10 17:13:55

Then positive review. Thank you !


---

Comment by vbraun created at 2015-03-10 23:26:10

Resolution: fixed
