# Issue 17461: introduce optional timeout argument for attach()

archive/issues_017461.json:
```json
{
    "body": "Keywords: attach detaching timeout\n\nWhen working with an attached file it seems that saving it (at least with 'gedit' on our file system) sometimes causes a temporarily disappearance on that file. I have no idea, if this is caused by the\nused file system (mounted NFS) , but sometimes I get from sage ( at least for 6.4.beta6)\n\n ### detaching file /home/......./stuff.sage because it does not exist (deleted?) ###\n\nthis can be emulated by \n\n```\nsage: attach (\"~/stuff.sage\")\n\nconsole>  mv ~/stuff.sage /tmp/; touch /tmp/stuff.sage;  sleep 1; mv /tmp/stuff.sage ~/stuff.sage\n```\n\n\nProposal \n1. add a little timeout to the detaching process (maybe already the case)\n2. control the timeout by an optional timeout argument for the attach() routine\n\n\n\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17698\n\n",
    "created_at": "2015-01-30T15:53:08Z",
    "labels": [
        "PLEASE CHANGE",
        "minor",
        "enhancement"
    ],
    "title": "introduce optional timeout argument for attach()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17461",
    "user": "jakobkroeker"
}
```
Keywords: attach detaching timeout

When working with an attached file it seems that saving it (at least with 'gedit' on our file system) sometimes causes a temporarily disappearance on that file. I have no idea, if this is caused by the
used file system (mounted NFS) , but sometimes I get from sage ( at least for 6.4.beta6)

 ### detaching file /home/......./stuff.sage because it does not exist (deleted?) ###

this can be emulated by 

```
sage: attach ("~/stuff.sage")

console>  mv ~/stuff.sage /tmp/; touch /tmp/stuff.sage;  sleep 1; mv /tmp/stuff.sage ~/stuff.sage
```


Proposal 
1. add a little timeout to the detaching process (maybe already the case)
2. control the timeout by an optional timeout argument for the attach() routine







Issue created by migration from https://trac.sagemath.org/ticket/17698





---

archive/issue_comments_233319.json:
```json
{
    "body": "I also have the same problem on my machine since one year. The problem seems to come from the function `sage.misc.attached_files.modified_file_iterator`. There is some sleep involved:\n\n\n```python\n    time.sleep(0.1)  # sleep 100ms to give the editor time to finish saving\n```\n\n\nbut it comes after checking the existence of the attached files which detach \"deleted\" files.\n\nWhen should the sleep be better done?",
    "created_at": "2015-02-16T18:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17461",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17461#issuecomment-233319",
    "user": "slabbe"
}
```

I also have the same problem on my machine since one year. The problem seems to come from the function `sage.misc.attached_files.modified_file_iterator`. There is some sleep involved:


```python
    time.sleep(0.1)  # sleep 100ms to give the editor time to finish saving
```


but it comes after checking the existence of the attached files which detach "deleted" files.

When should the sleep be better done?



---

archive/issue_comments_233320.json:
```json
{
    "body": "Using vim, the following tip fixed that problem for me:\n\nhttps://groups.google.com/d/msg/sage-devel/KZ-eiUNS2jg/PtwQMN-FLwAJ\n\nSo it was a problem of the text editor rather than a bug in sage. Should we close this ticket?",
    "created_at": "2016-08-25T16:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17461",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17461#issuecomment-233320",
    "user": "slabbe"
}
```

Using vim, the following tip fixed that problem for me:

https://groups.google.com/d/msg/sage-devel/KZ-eiUNS2jg/PtwQMN-FLwAJ

So it was a problem of the text editor rather than a bug in sage. Should we close this ticket?
