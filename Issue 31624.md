# Issue 31624: Persistent Homology

archive/issues_031624.json:
```json
{
    "body": "CC:  jhpalmieri slelievre tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31861\n\n",
    "created_at": "2021-05-26T19:48:01Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Persistent Homology",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31624",
    "user": "@Quenouillaume"
}
```
CC:  jhpalmieri slelievre tscrim



Issue created by migration from https://trac.sagemath.org/ticket/31861





---

archive/issue_comments_451664.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2021-05-26T20:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451664",
    "user": "@Quenouillaume"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_451665.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebraic topology.",
    "created_at": "2021-05-26T20:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451665",
    "user": "@Quenouillaume"
}
```

Changing component from PLEASE CHANGE to algebraic topology.



---

archive/issue_comments_451666.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-26T20:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451666",
    "user": "@Quenouillaume"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_451667.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-26T20:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451667",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_451668.json:
```json
{
    "body": "There's no code on this branch",
    "created_at": "2021-05-26T20:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451668",
    "user": "mkoeppe"
}
```

There's no code on this branch



---

archive/issue_comments_451669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-26T20:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451669",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-26T21:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451670",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451671.json:
```json
{
    "body": "Apologies for the first ticket that had no code on its branch, this is my first time using trac !",
    "created_at": "2021-05-26T21:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451671",
    "user": "@Quenouillaume"
}
```

Apologies for the first ticket that had no code on its branch, this is my first time using trac !



---

archive/issue_comments_451672.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-26T21:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451672",
    "user": "@Quenouillaume"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_451673.json:
```json
{
    "body": "Changing keywords from \"\" to \"homology, persistent-homology\".",
    "created_at": "2021-05-26T21:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451673",
    "user": "@Quenouillaume"
}
```

Changing keywords from "" to "homology, persistent-homology".



---

archive/issue_comments_451674.json:
```json
{
    "body": "I would suggest not to create a new top-level package `sage.persistent_homology` but rather to nest it",
    "created_at": "2021-05-26T22:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451674",
    "user": "mkoeppe"
}
```

I would suggest not to create a new top-level package `sage.persistent_homology` but rather to nest it



---

archive/issue_comments_451675.json:
```json
{
    "body": "I am not sure, but since this code seems already packaged at https://github.com/Quenouillaume/persil, why not let it be part of the task #31164 ? Also, some 10 years ago i saw some optimized code for persistent homology (by Edelsbrunner iirc), so i wonder whether there is room for interfacing such code within Sage ?",
    "created_at": "2021-05-26T23:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451675",
    "user": "tmonteil"
}
```

I am not sure, but since this code seems already packaged at https://github.com/Quenouillaume/persil, why not let it be part of the task #31164 ? Also, some 10 years ago i saw some optimized code for persistent homology (by Edelsbrunner iirc), so i wonder whether there is room for interfacing such code within Sage ?



---

archive/issue_comments_451676.json:
```json
{
    "body": "See https://en.wikipedia.org/wiki/Persistent_homology#Computation",
    "created_at": "2021-05-26T23:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451676",
    "user": "tmonteil"
}
```

See https://en.wikipedia.org/wiki/Persistent_homology#Computation



---

archive/issue_comments_451677.json:
```json
{
    "body": "The code at https://github.com/Quenouillaume/persil was a first draft, in particular I used my own homemade versions of the `Simplex` and `FreeModule` classes ! The code on this ticket's branch replaces those with built-in Sage functionalities.\n\n\nReplying to [comment:9 tmonteil]:\n> I am not sure, but since this code seems already packaged at https://github.com/Quenouillaume/persil, why not let it be part of the task #31164 ? Also, some 10 years ago i saw some optimized code for persistent homology (by Edelsbrunner iirc), so i wonder whether there is room for interfacing such code within Sage ?",
    "created_at": "2021-05-27T07:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451677",
    "user": "@Quenouillaume"
}
```

The code at https://github.com/Quenouillaume/persil was a first draft, in particular I used my own homemade versions of the `Simplex` and `FreeModule` classes ! The code on this ticket's branch replaces those with built-in Sage functionalities.


Replying to [comment:9 tmonteil]:
> I am not sure, but since this code seems already packaged at https://github.com/Quenouillaume/persil, why not let it be part of the task #31164 ? Also, some 10 years ago i saw some optimized code for persistent homology (by Edelsbrunner iirc), so i wonder whether there is room for interfacing such code within Sage ?



---

archive/issue_comments_451678.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-27T07:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451678",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_451679.json:
```json
{
    "body": "Thank you for adding this code. However, there are a few things that will need to be addressed before this can be included.\n\n- All methods and functions need to be doctested.\n- There isn't a need to define a sublevel of the documentation for this one additional file. Just adding it to the usual homology documentation is fine. In a related note, I would put your files under the `sage/homology` folder.\n- I wouldn't use `__foo` methods. There is no need to name-mangle. Just `_foo` is fine. (This will also make it easier to doctest; note that this does not apply to special methods like `__getitem__`.)\n- Avoid useless checks here with short-circuiting:\n  {{{#!diff\n-if j%1000 == 0 and self._verbose:\n+if self._verbose and j%1000 == 0:\n  }}}\n- Please follow PEP8 when reasonable. In particular, use Python's naming convention for variables. For example, change `_numSimplices` -> `_num_simplices`.",
    "created_at": "2021-05-27T07:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451679",
    "user": "tscrim"
}
```

Thank you for adding this code. However, there are a few things that will need to be addressed before this can be included.

- All methods and functions need to be doctested.
- There isn't a need to define a sublevel of the documentation for this one additional file. Just adding it to the usual homology documentation is fine. In a related note, I would put your files under the `sage/homology` folder.
- I wouldn't use `__foo` methods. There is no need to name-mangle. Just `_foo` is fine. (This will also make it easier to doctest; note that this does not apply to special methods like `__getitem__`.)
- Avoid useless checks here with short-circuiting:
  {{{#!diff
-if j%1000 == 0 and self._verbose:
+if self._verbose and j%1000 == 0:
  }}}
- Please follow PEP8 when reasonable. In particular, use Python's naming convention for variables. For example, change `_numSimplices` -> `_num_simplices`.



---

archive/issue_comments_451680.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-27T10:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451680",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-27T11:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451681",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451682.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-27T11:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451682",
    "user": "@Quenouillaume"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_451683.json:
```json
{
    "body": "Added doctests for all methods, and adapted to PEP8.\nA few lines are still more than 80 characters long,\nmost of them being in the doctests.\n\nAlso moved files and documentation to the homology folders.",
    "created_at": "2021-05-27T11:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451683",
    "user": "@Quenouillaume"
}
```

Added doctests for all methods, and adapted to PEP8.
A few lines are still more than 80 characters long,
most of them being in the doctests.

Also moved files and documentation to the homology folders.



---

archive/issue_comments_451684.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-27T15:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451684",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451685.json:
```json
{
    "body": "Some comments:\n\n- It might be a good idea to have ways of converting to and from simplicial complexes: for instance, if X is a filtered complex, then a method that takes a value n and returns the complex made up of all simplices with filtration at most n. Also a `_simplicial_` method so that `SimplicialComplex(X)` works. In addition, take a simplicial complex and make it a filtered complex with everything in filtration 0.\n\n- Related to that, I was wondering if it made sense for `FilteredComplex` to inherit from `SimplicialComplex`. I don't think so, but I thought I'd ask.\n\n- Also related to that, would it make sense to have a way of modifying the filtration value for a given simplex? I would suggest renaming `get_value` to `filtration`. Maybe it could take two arguments: a required argument `s`, a simplex, and if that is the only argument, then return its filtration. If an optional argument `v` is present, then instead set its filtration to `v`.\n\n- Throughout, I would change \"filtered complex\" to \"filtered simplicial complex\", and I would change the name of the file and the name of the class accordingly. When I see \"filtered complex,\" I tend to think of a filtered chain complex, and then I think that there should be spectral sequences lurking somewhere. (That would be a great task for someone to take on.) To make things unambiguous, we should have `FilteredChainComplex` (I hope eventually) and `FilteredSimplicialComplex` (from this ticket).\n\n- Regarding\n\n```\n    This implementation requires filtration values to be positive. Most\n    features will not work with negative values.\n```\n\n Should we have a warning or error if the user uses negative filtration values? I would also add this comment to the docstring for the `__init__` method, so that users will see if when they do `FilteredComplex?`.\n\n- In the `__init__` method, I like the comments about `_vertices`, `_simplices`, and `_degrees_dict`. Can you add a similar comment about `_warnings`? (Or document the `warnings` argument.) Is `degree` the same as filtration value? I might change that language, at least in the docstring and names of the user-viewable variables (for example `simplex_degree_list` could perhaps just be renamed to `simplices`).",
    "created_at": "2021-05-29T23:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451685",
    "user": "jhpalmieri"
}
```

Some comments:

- It might be a good idea to have ways of converting to and from simplicial complexes: for instance, if X is a filtered complex, then a method that takes a value n and returns the complex made up of all simplices with filtration at most n. Also a `_simplicial_` method so that `SimplicialComplex(X)` works. In addition, take a simplicial complex and make it a filtered complex with everything in filtration 0.

- Related to that, I was wondering if it made sense for `FilteredComplex` to inherit from `SimplicialComplex`. I don't think so, but I thought I'd ask.

- Also related to that, would it make sense to have a way of modifying the filtration value for a given simplex? I would suggest renaming `get_value` to `filtration`. Maybe it could take two arguments: a required argument `s`, a simplex, and if that is the only argument, then return its filtration. If an optional argument `v` is present, then instead set its filtration to `v`.

- Throughout, I would change "filtered complex" to "filtered simplicial complex", and I would change the name of the file and the name of the class accordingly. When I see "filtered complex," I tend to think of a filtered chain complex, and then I think that there should be spectral sequences lurking somewhere. (That would be a great task for someone to take on.) To make things unambiguous, we should have `FilteredChainComplex` (I hope eventually) and `FilteredSimplicialComplex` (from this ticket).

- Regarding

```
    This implementation requires filtration values to be positive. Most
    features will not work with negative values.
```

 Should we have a warning or error if the user uses negative filtration values? I would also add this comment to the docstring for the `__init__` method, so that users will see if when they do `FilteredComplex?`.

- In the `__init__` method, I like the comments about `_vertices`, `_simplices`, and `_degrees_dict`. Can you add a similar comment about `_warnings`? (Or document the `warnings` argument.) Is `degree` the same as filtration value? I might change that language, at least in the docstring and names of the user-viewable variables (for example `simplex_degree_list` could perhaps just be renamed to `simplices`).



---

archive/issue_comments_451686.json:
```json
{
    "body": "+1 on making this a subclass of `SimplicialComplex` and changing the name to `FilteredSimplicialComplex`.",
    "created_at": "2021-06-01T01:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451686",
    "user": "tscrim"
}
```

+1 on making this a subclass of `SimplicialComplex` and changing the name to `FilteredSimplicialComplex`.



---

archive/issue_comments_451687.json:
```json
{
    "body": "Replying to [comment:19 tscrim]:\n> +1 on making this a subclass of `SimplicialComplex` and changing the name to `FilteredSimplicialComplex`.\n\nThis might require a lot of work: various methods for `SimplicialComplex` would have to be modified to work with `FilteredSimplicialComplex`, like product, wedge, join, ..., unless we just forget the filtration. At least `FilteredSimplicialComplex` could inherit from `GenericCellComplex`, and maybe there could be a new intermediate class that both it and `SimplicialComplex` could inherit from.",
    "created_at": "2021-06-01T05:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451687",
    "user": "jhpalmieri"
}
```

Replying to [comment:19 tscrim]:
> +1 on making this a subclass of `SimplicialComplex` and changing the name to `FilteredSimplicialComplex`.

This might require a lot of work: various methods for `SimplicialComplex` would have to be modified to work with `FilteredSimplicialComplex`, like product, wedge, join, ..., unless we just forget the filtration. At least `FilteredSimplicialComplex` could inherit from `GenericCellComplex`, and maybe there could be a new intermediate class that both it and `SimplicialComplex` could inherit from.



---

archive/issue_comments_451688.json:
```json
{
    "body": "Hmm...yea, I guess so. Well, I am okay with including this class as-is for now since it will be essentially all implementation details changed by such a refactoring. The only thing I would want would be to change `compute_homology()` to `persistent_homology()` so it is unambiguous about what type of homology is being computed. (The Betti numbers are fine because of the extra parameters.)",
    "created_at": "2021-06-01T06:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451688",
    "user": "tscrim"
}
```

Hmm...yea, I guess so. Well, I am okay with including this class as-is for now since it will be essentially all implementation details changed by such a refactoring. The only thing I would want would be to change `compute_homology()` to `persistent_homology()` so it is unambiguous about what type of homology is being computed. (The Betti numbers are fine because of the extra parameters.)



---

archive/issue_comments_451689.json:
```json
{
    "body": "I'm working on implementing all those suggestions, thank you for the very insightful feedback !\n\nI also think that having `FilteredSimplicialComplex` inherit from `SimplicialComplex` is a bit odd, for all the reasons mentionned above, but I'm not sure it should inherit from `GenericCellComplex` either, since they don't really have the same homology type...\n\nMaybe a simple first solution would be, as jhpalmieri suggests, to have a `_simplicial_()` method for `FilteredSimplicialComplex`, which returns the maximal simplicial complex associated to the filtered complex, as well as a `prune(max_value)` method which returns a copy of the filtered complex, where simplices of value more than `max_value` have been removed.",
    "created_at": "2021-06-01T12:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451689",
    "user": "@Quenouillaume"
}
```

I'm working on implementing all those suggestions, thank you for the very insightful feedback !

I also think that having `FilteredSimplicialComplex` inherit from `SimplicialComplex` is a bit odd, for all the reasons mentionned above, but I'm not sure it should inherit from `GenericCellComplex` either, since they don't really have the same homology type...

Maybe a simple first solution would be, as jhpalmieri suggests, to have a `_simplicial_()` method for `FilteredSimplicialComplex`, which returns the maximal simplicial complex associated to the filtered complex, as well as a `prune(max_value)` method which returns a copy of the filtered complex, where simplices of value more than `max_value` have been removed.



---

archive/issue_comments_451690.json:
```json
{
    "body": "Replying to [comment:21 tscrim]:\n> The only thing I would want would be to change `compute_homology()` to `persistent_homology()` so it is unambiguous about what type of homology is being computed. (The Betti numbers are fine because of the extra parameters.)\n\n+1",
    "created_at": "2021-06-01T15:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451690",
    "user": "jhpalmieri"
}
```

Replying to [comment:21 tscrim]:
> The only thing I would want would be to change `compute_homology()` to `persistent_homology()` so it is unambiguous about what type of homology is being computed. (The Betti numbers are fine because of the extra parameters.)

+1



---

archive/issue_comments_451691.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-02T12:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451691",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451692.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-02T12:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451692",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451693.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-02T12:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451693",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451694.json:
```json
{
    "body": "I don't really like the fact that `compute_persistent_homology()` in some sense fixes the field you are computing the homology over and that it needs to be called before getting the intervals without a meaningful error message. Plus the result is only partially cached as when you run this again, you obtain new data that overwrites the old computed data. So my proposal is to change it as follows:\n\n- Make `compute_persistent_homology()` hidden by `_compute_persistent_homology()` and then have it return the resulting intervals.\n- Have a cached method `intervals()` (perhaps call that `persistence_intervals`) that has `field` and `strict` as part of its key. So it will be decorated by ``@`cached_method(key=lambda self,f,s,v: (f,s))`.\n- Remove the now unused attributes such as `intervals`.\n\nAlso, why can't you just pass `_filtration_dict` as a list of simplicies to `SimplicialComplex` in `_simplicial_`? Related, I also don't see the need for the `_simplicies` list as you can get it as the keys of `_filtration_dict`. The sorting is only needed during the computation of the persistent homology, which you could construct in there.",
    "created_at": "2021-06-05T08:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451694",
    "user": "tscrim"
}
```

I don't really like the fact that `compute_persistent_homology()` in some sense fixes the field you are computing the homology over and that it needs to be called before getting the intervals without a meaningful error message. Plus the result is only partially cached as when you run this again, you obtain new data that overwrites the old computed data. So my proposal is to change it as follows:

- Make `compute_persistent_homology()` hidden by `_compute_persistent_homology()` and then have it return the resulting intervals.
- Have a cached method `intervals()` (perhaps call that `persistence_intervals`) that has `field` and `strict` as part of its key. So it will be decorated by ``@`cached_method(key=lambda self,f,s,v: (f,s))`.
- Remove the now unused attributes such as `intervals`.

Also, why can't you just pass `_filtration_dict` as a list of simplicies to `SimplicialComplex` in `_simplicial_`? Related, I also don't see the need for the `_simplicies` list as you can get it as the keys of `_filtration_dict`. The sorting is only needed during the computation of the persistent homology, which you could construct in there.



---

archive/issue_comments_451695.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T08:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451695",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451696.json:
```json
{
    "body": "Replying to [comment:27 tscrim]:\n> I don't really like the fact that `compute_persistent_homology()`...\n\nI agree, I didn't know about the cached_method decorator and it can probably be very useful here. However there is a problem: since `FilteredSimplicialComplex` objects can have their simplices inserted or changed, the cache key needs to take into account whether the complex has changed since last time persistent homology was computed or not.\nI was thinking of just counting the number of times that the complex has been modified and have that also be part of the cache key, but maybe there is a simpler / less hacky solution...\nIn any case, I think that the `_compute_persistent_homology` method should be cached rather than the `persistence_intervals` method, since it can be called when computing intervals or betti numbers.\n\n> Also, why can't you just pass `_filtration_dict` as a list of simplicies to `SimplicialComplex` in `_simplicial_`? Related, ...\n\nYes this is much simpler, thank you ! \n----\nNew commits:",
    "created_at": "2021-06-07T08:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451696",
    "user": "@Quenouillaume"
}
```

Replying to [comment:27 tscrim]:
> I don't really like the fact that `compute_persistent_homology()`...

I agree, I didn't know about the cached_method decorator and it can probably be very useful here. However there is a problem: since `FilteredSimplicialComplex` objects can have their simplices inserted or changed, the cache key needs to take into account whether the complex has changed since last time persistent homology was computed or not.
I was thinking of just counting the number of times that the complex has been modified and have that also be part of the cache key, but maybe there is a simpler / less hacky solution...
In any case, I think that the `_compute_persistent_homology` method should be cached rather than the `persistence_intervals` method, since it can be called when computing intervals or betti numbers.

> Also, why can't you just pass `_filtration_dict` as a list of simplicies to `SimplicialComplex` in `_simplicial_`? Related, ...

Yes this is much simpler, thank you ! 
----
New commits:



---

archive/issue_comments_451697.json:
```json
{
    "body": "I would just call `foo.cached_func.clear_cache()` to clear the cache when the complex is mutated.\n\nAddendum: The way you have it implemented now is effectively a memory leak since you are always adding more stuff to the cache every time you run it.",
    "created_at": "2021-06-07T22:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451697",
    "user": "tscrim"
}
```

I would just call `foo.cached_func.clear_cache()` to clear the cache when the complex is mutated.

Addendum: The way you have it implemented now is effectively a memory leak since you are always adding more stuff to the cache every time you run it.



---

archive/issue_comments_451698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-08T10:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451698",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-08T10:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451699",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451700.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451700",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_451701.json:
```json
{
    "body": "Sorry for loosing track of this; I didn't get any notifications from trac that you pushed changes.\n\nI think all of my and John's current comments have been taken into account, correct?\n\nCan you provide a rebase onto the latest beta? I will continue my review at that point.",
    "created_at": "2021-08-27T01:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451701",
    "user": "tscrim"
}
```

Sorry for loosing track of this; I didn't get any notifications from trac that you pushed changes.

I think all of my and John's current comments have been taken into account, correct?

Can you provide a rebase onto the latest beta? I will continue my review at that point.



---

archive/issue_comments_451702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-08-27T16:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451702",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_451703.json:
```json
{
    "body": "I believe I've taken all your comments into account ! And I've just finished rebasing if you wish to keep reviewing.",
    "created_at": "2021-08-27T16:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451703",
    "user": "@Quenouillaume"
}
```

I believe I've taken all your comments into account ! And I've just finished rebasing if you wish to keep reviewing.



---

archive/issue_comments_451704.json:
```json
{
    "body": "le patchbot a l'air de dire que la branche ne compile pas..",
    "created_at": "2021-08-28T12:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451704",
    "user": "chapoton"
}
```

le patchbot a l'air de dire que la branche ne compile pas..



---

archive/issue_comments_451705.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-28T18:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451705",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451706.json:
```json
{
    "body": "I fixed the rebase error, it should work now. This was in part due to me not realizing that \n`sage.homology.simplicial_complex` was deprecated and moved to `sage.topology` ! \nShould the files of this ticket also be moved from `sage.homology` to `sage.topology` ?",
    "created_at": "2021-08-28T18:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451706",
    "user": "@Quenouillaume"
}
```

I fixed the rebase error, it should work now. This was in part due to me not realizing that 
`sage.homology.simplicial_complex` was deprecated and moved to `sage.topology` ! 
Should the files of this ticket also be moved from `sage.homology` to `sage.topology` ?



---

archive/issue_comments_451707.json:
```json
{
    "body": "Replying to [comment:39 gh-Quenouillaume]:\n> Should the files of this ticket also be moved from `sage.homology` to `sage.topology` ?\n\nI would say yes.",
    "created_at": "2021-08-28T19:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451707",
    "user": "jhpalmieri"
}
```

Replying to [comment:39 gh-Quenouillaume]:
> Should the files of this ticket also be moved from `sage.homology` to `sage.topology` ?

I would say yes.



---

archive/issue_comments_451708.json:
```json
{
    "body": "le patchbot dit maintenant que la doc ne compile pas:\n\n```\n[dochtml] [reference] /home/chapoton/sage/src/doc/en/reference/references/index.rst:5977: WARNING: Duplicate explicit target name: \"zc2005\".\n[dochtml] [reference] /home/chapoton/sage/src/doc/en/reference/references/index.rst:5977: WARNING: duplicate citation ZC2005, other instance in /home/chapoton/sage/src/doc/en/reference/references/index.rst\n```\n",
    "created_at": "2021-08-29T06:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451708",
    "user": "chapoton"
}
```

le patchbot dit maintenant que la doc ne compile pas:

```
[dochtml] [reference] /home/chapoton/sage/src/doc/en/reference/references/index.rst:5977: WARNING: Duplicate explicit target name: "zc2005".
[dochtml] [reference] /home/chapoton/sage/src/doc/en/reference/references/index.rst:5977: WARNING: duplicate citation ZC2005, other instance in /home/chapoton/sage/src/doc/en/reference/references/index.rst
```




---

archive/issue_comments_451709.json:
```json
{
    "body": "Indeed, you can see in the diff that [ZC2005] has accidentally been added twice. I have removed the duplicate reference.\n\nI made a few other reviewer changes. Most of them are doc formatting. However, there are two big ones:\n\n- I added an equality check.\n- I changed `warnings` to `verbose` as it wasn't being used to warn the user but simply expressing that it changed its state.\n\nI found two things that might be lacking: we cannot remove simplices nor raise the filtration value. The first is a feature that can be added later. The second, I am guessing it is for reasons of keeping things consistent? These aren't anything that would prevent me from giving a positive review, but it would be nice for some clarification for the latter (of course, the behaviour is documented, but why do we want this?).\n\nJohn, do you have any other comments?\n----\nNew commits:",
    "created_at": "2021-09-01T02:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451709",
    "user": "tscrim"
}
```

Indeed, you can see in the diff that [ZC2005] has accidentally been added twice. I have removed the duplicate reference.

I made a few other reviewer changes. Most of them are doc formatting. However, there are two big ones:

- I added an equality check.
- I changed `warnings` to `verbose` as it wasn't being used to warn the user but simply expressing that it changed its state.

I found two things that might be lacking: we cannot remove simplices nor raise the filtration value. The first is a feature that can be added later. The second, I am guessing it is for reasons of keeping things consistent? These aren't anything that would prevent me from giving a positive review, but it would be nice for some clarification for the latter (of course, the behaviour is documented, but why do we want this?).

John, do you have any other comments?
----
New commits:



---

archive/issue_comments_451710.json:
```json
{
    "body": "My only comment is that the file should be moved from `homology` to `topology`. After that,  I would be happy to see it merged.",
    "created_at": "2021-09-01T16:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451710",
    "user": "jhpalmieri"
}
```

My only comment is that the file should be moved from `homology` to `topology`. After that,  I would be happy to see it merged.



---

archive/issue_comments_451711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-08T01:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451711",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-08T01:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451712",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451713.json:
```json
{
    "body": "Replying to [comment:43 jhpalmieri]:\n> My only comment is that the file should be moved from `homology` to `topology`. After that,  I would be happy to see it merged.\n\nI have moved it over and fixed a pyflakes warning. Please check.",
    "created_at": "2021-09-08T01:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451713",
    "user": "tscrim"
}
```

Replying to [comment:43 jhpalmieri]:
> My only comment is that the file should be moved from `homology` to `topology`. After that,  I would be happy to see it merged.

I have moved it over and fixed a pyflakes warning. Please check.



---

archive/issue_comments_451714.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-08T22:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451714",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451715.json:
```json
{
    "body": "That should fix the docbuild issue.",
    "created_at": "2021-09-08T22:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451715",
    "user": "tscrim"
}
```

That should fix the docbuild issue.



---

archive/issue_comments_451716.json:
```json
{
    "body": "Green patchbot.",
    "created_at": "2021-09-13T01:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451716",
    "user": "tscrim"
}
```

Green patchbot.



---

archive/issue_comments_451717.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-13T04:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451717",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_451718.json:
```json
{
    "body": "Great, let's merge it!",
    "created_at": "2021-09-13T04:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451718",
    "user": "jhpalmieri"
}
```

Great, let's merge it!



---

archive/issue_comments_451719.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-09-14T22:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451719",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_451720.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-09-14T22:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451720",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_451721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-14T23:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451721",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451722.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-09-14T23:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451722",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_451723.json:
```json
{
    "body": "Trivial rebase.",
    "created_at": "2021-09-14T23:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451723",
    "user": "tscrim"
}
```

Trivial rebase.



---

archive/issue_comments_451724.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-19T09:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31624#issuecomment-451724",
    "user": "vbraun"
}
```

Resolution: fixed
