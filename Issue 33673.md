# Issue 33673: installing jupyterlab causes sagelib rebuild

Issue created by migration from https://trac.sagemath.org/ticket/33910

Original creator: dimpase

Original creation time: 2022-05-26 21:05:58

CC:  mkoeppe egourgoulhon

as reported on sage-devel: https://groups.google.com/g/sage-devel/c/dhfHU_kZb6o/m/5-8m1v9hAQAJ

To reproduce (on Linux); after the Sage build is done, run

```
make jupyterlab_widgets
make build
```

and observe that `make build` triggers recompilation of `sagelib`.


---

Comment by mkoeppe created at 2022-05-26 22:21:28

From the viewpoint of our Makefile, the package `sagelib` is always rebuilt (this is done by the entry `FORCE` in `build/pkgs/sagelib/dependencies`).

I am guessing what is being reported here is that all or many extension modules of sagelib are getting recompiled (but not re-Cythonized). Correct?


---

Comment by dimpase created at 2022-05-26 22:44:54

Replying to [comment:2 mkoeppe]:
> From the viewpoint of our Makefile, the package `sagelib` is always rebuilt (this is done by the entry `FORCE` in `build/pkgs/sagelib/dependencies`).
> 
> I am guessing what is being reported here is that all or many extension modules of sagelib are getting recompiled (but not re-Cythonized). Correct?
> 
perhaps. I'm struggling to reproduce this without `make distclean`, but clearly a lot is being rebuild, hundreds of files in `sagelib`. This seems to be unnecessary, in this case for sure.


---

Comment by mkoeppe created at 2022-05-26 22:59:16

Slightly milder than `make distclean` is `rm -Rf venv/`


---

Comment by mkoeppe created at 2022-05-26 23:20:42

`make jupyter_packaging` already triggers a rebuild in the next `make sagelib`.


---

Comment by mkoeppe created at 2022-05-26 23:32:39

In fact just `./sage -pip install -U setuptools` triggers it.


---

Comment by mkoeppe created at 2022-05-27 00:33:02

setuptools 62.1.0 is the first problematic version.


---

Comment by mkoeppe created at 2022-05-27 00:37:00

Possibly from the change to `plat_specifier` in 
https://github.com/pypa/setuptools/pull/3258/files


---

Comment by mkoeppe created at 2022-05-27 00:38:39

I think we should just update our `setuptools` spkg so that installing `jupyter_packaging` does not have to do the update via pip.


---

Comment by mkoeppe created at 2022-05-27 01:51:14

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-05-27 01:51:14

But here's a quick fix by just setting a version bound
----
New commits:


---

Comment by dimpase created at 2022-05-27 18:01:00

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2022-05-27 18:01:00

OK, it works!


---

Comment by mkoeppe created at 2022-05-27 18:15:22

Thanks


---

Comment by vbraun created at 2022-05-29 11:29:02

Resolution: fixed
