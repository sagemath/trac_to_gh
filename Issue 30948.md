# Issue 30948: NumberField element method local_height_arch returns wrong values on prec=53

archive/issues_030948.json:
```json
{
    "body": "When using prec=53 NumberFieldElement.places(prec=53) will map into RDF instead of RR, but local_height_arch only checks is_RealField from sage.rings.real_mpfr, which in turn only checks if the Field is an instance of RealField_class.\n\nExample:\n\n\n```\na = NumberField(x**2-2,\"a\")(\"a\")\na.local_height_arch(0, weighted=True) # 0.3465735902799726547086160607291\na.local_height_arch(0, weighted=True, prec=53) # 0.6931471805599454\n```\n\n\n\nSo one would at least need to change line 3837 in rings/number_field/number_field_element.pyx to check\n\n\n```\nif weighted and not is_RealField(Kv) and not Kv is RDF:\n```\n\n\nbut then this is rather specific. I think it should be avoided, as it is firstly a very specific internal function, which might induce errors at any point (such as a change of class of the places function for example), and as it secondly does not really express what we intend to do there: Even if this particular embedding is real, it can be done into a Complex Field as well (like the flag all_complex does).\n\nSo I suggest using the much more stable method of testing for\n\n\n```\nif emb.im_gens()[0].imag() == 0:\n```\n\n\nRegards,\nValentin\n\nIssue created by migration from https://trac.sagemath.org/ticket/31185\n\n",
    "created_at": "2021-01-04T21:45:26Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "NumberField element method local_height_arch returns wrong values on prec=53",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30948",
    "user": "https://github.com/vpetzel"
}
```
When using prec=53 NumberFieldElement.places(prec=53) will map into RDF instead of RR, but local_height_arch only checks is_RealField from sage.rings.real_mpfr, which in turn only checks if the Field is an instance of RealField_class.

Example:


```
a = NumberField(x**2-2,"a")("a")
a.local_height_arch(0, weighted=True) # 0.3465735902799726547086160607291
a.local_height_arch(0, weighted=True, prec=53) # 0.6931471805599454
```



So one would at least need to change line 3837 in rings/number_field/number_field_element.pyx to check


```
if weighted and not is_RealField(Kv) and not Kv is RDF:
```


but then this is rather specific. I think it should be avoided, as it is firstly a very specific internal function, which might induce errors at any point (such as a change of class of the places function for example), and as it secondly does not really express what we intend to do there: Even if this particular embedding is real, it can be done into a Complex Field as well (like the flag all_complex does).

So I suggest using the much more stable method of testing for


```
if emb.im_gens()[0].imag() == 0:
```


Regards,
Valentin

Issue created by migration from https://trac.sagemath.org/ticket/31185


