# Issue 21220: line_profiler is broken after IPython 5.0 upgrade

Issue created by migration from https://trac.sagemath.org/ticket/21457

Original creator: tmonteil

Original creation time: 2016-09-09 00:07:09

CC:  jhpalmieri ​tscrim

After `sage -pip install line_profiler`, we get:


```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 7.4.beta2, Release Date: 2016-08-26               │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
[SageTerminalApp] WARNING | Error in loading extension: line_profiler
Check your config files in /home/sagemath/.sage/ipython_genutils-0.1.0/profile_default
Traceback (most recent call last):
  File "/opt/sagemath/sage-7.3/local/lib/python2.7/site-packages/IPython/core/shellapp.py", line 246, in init_extensions
    self.shell.extension_manager.load_extension(ext)
  File "/opt/sagemath/sage-7.3/local/lib/python2.7/site-packages/IPython/core/extensions.py", line 85, in load_extension
    if self._call_load_ipython_extension(mod):
  File "/opt/sagemath/sage-7.3/local/lib/python2.7/site-packages/IPython/core/extensions.py", line 132, in _call_load_ipython_extension
    mod.load_ipython_extension(self.shell)
  File "/opt/sagemath/sage-7.3/local/lib/python2.7/site-packages/line_profiler.py", line 372, in load_ipython_extension
    ip.define_magic('lprun', magic_lprun)
AttributeError: 'SageTerminalInteractiveShell' object has no attribute 'define_magic'
```


See also [/ticket/21006#comment:24 #21006 comment 24] and https://groups.google.com/forum/#!msg/sage-devel/l_Il1le0_2Y/bAlmskCrBwAJ


---

Comment by tmonteil created at 2016-09-09 00:12:13

Changing component from PLEASE CHANGE to user interface.


---

Comment by jhpalmieri created at 2017-10-05 00:33:14

Is this still an issue? I just installed `line_profiler` and Sage starts up. However, I don't know how to run it:

```
sage: %lprun f(3)
ERROR:root:Line magic function `%lprun` not found.
```



---

Comment by tscrim created at 2017-10-05 07:39:26

This has been fixed:

```
sage: P = Permutations(5)
sage: %lprun -f p.inversions [p.inversions() for p in P]
```

(The failure was occurring previously on startup.)


---

Comment by tscrim created at 2017-10-05 07:39:26

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-03-10 13:10:58

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-03-10 13:10:58

ok, tested and works


---

Comment by vdelecroix created at 2018-05-18 17:16:26

Resolution: wontfix


---

Comment by vdelecroix created at 2018-05-18 17:16:26

closing positively reviewed duplicates


---

Comment by tmonteil created at 2019-08-27 19:45:19

Changing keywords from "" to "sdl".
