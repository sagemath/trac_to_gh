# Issue 11043: Various Pairings for Modular Forms

archive/issues_011043.json:
```json
{
    "body": "Assignee: @craigcitro\n\nCC:  @JohnCremona\n\nWe should have a functions/functions which allow for pairing of the following\n\n-cuspidal modular symbols for Gamma0(N) with cusp forms for Gamma0(N)\n\n-cusp forms for Gamma0(N) with cusp forms Gamma0(N) (petersson inner product)\n\n-group elements of Gamma0(N) with cusp forms for Gamma0(N)\n\nOnce this is done what works for cusp forms should be extended to Meromorphic Differentials of the second kind. \nThey should be implemented so that things like\n\n```\nsage: f = CuspForm(15,2).basis()[0]\nsage: g = Gamma0(15).random_element()\nsage: f.pair(g)\n--some number--\n```\n\nshould work. Observe that Gamma0(15).random_element() is not implemented. A reference for this is chapter 2 of Cremona. \n\nI'm going to attach some code which doesn't work very well and can be improved by looking at Fricke involutions but at least it's a start. Maybe some people already have some code for this???\n\nIssue created by migration from https://trac.sagemath.org/ticket/11215\n\n",
    "created_at": "2011-04-18T21:52:15Z",
    "labels": [
        "component: modular forms",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Various Pairings for Modular Forms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11043",
    "user": "https://github.com/tdupu"
}
```
Assignee: @craigcitro

CC:  @JohnCremona

We should have a functions/functions which allow for pairing of the following

-cuspidal modular symbols for Gamma0(N) with cusp forms for Gamma0(N)

-cusp forms for Gamma0(N) with cusp forms Gamma0(N) (petersson inner product)

-group elements of Gamma0(N) with cusp forms for Gamma0(N)

Once this is done what works for cusp forms should be extended to Meromorphic Differentials of the second kind. 
They should be implemented so that things like

```
sage: f = CuspForm(15,2).basis()[0]
sage: g = Gamma0(15).random_element()
sage: f.pair(g)
--some number--
```

should work. Observe that Gamma0(15).random_element() is not implemented. A reference for this is chapter 2 of Cremona. 

I'm going to attach some code which doesn't work very well and can be improved by looking at Fricke involutions but at least it's a start. Maybe some people already have some code for this???

Issue created by migration from https://trac.sagemath.org/ticket/11215





---

archive/issue_comments_120130.json:
```json
{
    "body": "Attachment [pairing.patch](tarball://root/attachments/some-uuid/ticket11215/pairing.patch) by @tdupu created at 2011-04-18 21:54:00\n\npairing for S2(Gamma0(N)) and Gamma0(N)",
    "created_at": "2011-04-18T21:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120130",
    "user": "https://github.com/tdupu"
}
```

Attachment [pairing.patch](tarball://root/attachments/some-uuid/ticket11215/pairing.patch) by @tdupu created at 2011-04-18 21:54:00

pairing for S2(Gamma0(N)) and Gamma0(N)



---

archive/issue_comments_120131.json:
```json
{
    "body": "Attachment [trac_11215_pairing_redone.patch](tarball://root/attachments/some-uuid/ticket11215/trac_11215_pairing_redone.patch) by @fchapoton created at 2013-08-08 10:09:56\n\nhere is a clean version of the previous patch\n\nfor the bot: apply only trac_11215_pairing_redone.patch\u200b",
    "created_at": "2013-08-08T10:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120131",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_11215_pairing_redone.patch](tarball://root/attachments/some-uuid/ticket11215/trac_11215_pairing_redone.patch) by @fchapoton created at 2013-08-08 10:09:56

here is a clean version of the previous patch

for the bot: apply only trac_11215_pairing_redone.patchâ€‹



---

archive/issue_comments_120132.json:
```json
{
    "body": "As you suggest, it would be alot better to use the fact that f will be an eigenform for the Fricke involution, since that replaces the N in the denominator of the negative exponential with sqrt(N).  The necessary formulas are in the same place....!\n\nAnother improvement would be ta take the precision as in put rather than the number of terms, and compute the necessary number of terms.\n\nAll this is implemented in eclib, for forms of weight 2, trivial character *and rational Fourier coefficients only* so (not for the first time) I am wishing for an interface to all that additional functionality.  Anyway, here we can be more general since there need be no requirement of rationality.",
    "created_at": "2013-08-08T11:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120132",
    "user": "https://github.com/JohnCremona"
}
```

As you suggest, it would be alot better to use the fact that f will be an eigenform for the Fricke involution, since that replaces the N in the denominator of the negative exponential with sqrt(N).  The necessary formulas are in the same place....!

Another improvement would be ta take the precision as in put rather than the number of terms, and compute the necessary number of terms.

All this is implemented in eclib, for forms of weight 2, trivial character *and rational Fourier coefficients only* so (not for the first time) I am wishing for an interface to all that additional functionality.  Anyway, here we can be more general since there need be no requirement of rationality.



---

archive/issue_comments_120133.json:
```json
{
    "body": "Attachment [trac_11215_pairing_with_atkin_lehner.patch](tarball://root/attachments/some-uuid/ticket11215/trac_11215_pairing_with_atkin_lehner.patch) by @fchapoton created at 2013-08-08 13:25:12",
    "created_at": "2013-08-08T13:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120133",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_11215_pairing_with_atkin_lehner.patch](tarball://root/attachments/some-uuid/ticket11215/trac_11215_pairing_with_atkin_lehner.patch) by @fchapoton created at 2013-08-08 13:25:12



---

archive/issue_comments_120134.json:
```json
{
    "body": "here is a version using the Atkin-Lehner eigenvalue and the faster converging series\n\nfor the bot: apply only trac_11215_pairing_with_atkin_lehner.patch",
    "created_at": "2013-08-08T13:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120134",
    "user": "https://github.com/fchapoton"
}
```

here is a version using the Atkin-Lehner eigenvalue and the faster converging series

for the bot: apply only trac_11215_pairing_with_atkin_lehner.patch



---

archive/issue_comments_120135.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-05T10:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120135",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_120136.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-05T10:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120136",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_120137.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-07T04:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120137",
    "user": "https://github.com/adeines"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120138.json:
```json
{
    "body": "It looks good, works, tests pass, but the last line could be broken into an extra line or two that would make this more readable.  If you do that I'll give you a positive review.  Also, could you add comments to explain what M.a(), M.b() and M.c() are?",
    "created_at": "2014-01-07T04:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120138",
    "user": "https://github.com/adeines"
}
```

It looks good, works, tests pass, but the last line could be broken into an extra line or two that would make this more readable.  If you do that I'll give you a positive review.  Also, could you add comments to explain what M.a(), M.b() and M.c() are?



---

archive/issue_comments_120139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-07T08:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_120140.json:
```json
{
    "body": "Here is a new commit, where I tried to make it more readable.\n\nI have also changed the ValueError test, that looked wrong\n\nI have added a comment about M.a() etc",
    "created_at": "2014-01-07T08:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120140",
    "user": "https://github.com/fchapoton"
}
```

Here is a new commit, where I tried to make it more readable.

I have also changed the ValueError test, that looked wrong

I have added a comment about M.a() etc



---

archive/issue_comments_120141.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-08T08:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120141",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120142.json:
```json
{
    "body": "I have made the suggested changes, hopefully. Is there something else to do ?",
    "created_at": "2014-01-08T08:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120142",
    "user": "https://github.com/fchapoton"
}
```

I have made the suggested changes, hopefully. Is there something else to do ?



---

archive/issue_comments_120143.json:
```json
{
    "body": "Ping ? Could somebody please have a look ?",
    "created_at": "2014-02-11T17:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120143",
    "user": "https://github.com/fchapoton"
}
```

Ping ? Could somebody please have a look ?



---

archive/issue_comments_120144.json:
```json
{
    "body": "Ping again. This needs review, anybody out there to have a look ?",
    "created_at": "2014-03-11T20:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120144",
    "user": "https://github.com/fchapoton"
}
```

Ping again. This needs review, anybody out there to have a look ?



---

archive/issue_comments_120145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-09T20:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_120146.json:
```json
{
    "body": "I think this needs to be improved a bit.  In particular the new code is only really useful if we can specify the desired precision (of the output), see comment:3.  I'm trying to do this now.",
    "created_at": "2014-05-09T20:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120146",
    "user": "https://github.com/pjbruin"
}
```

I think this needs to be improved a bit.  In particular the new code is only really useful if we can specify the desired precision (of the output), see comment:3.  I'm trying to do this now.



---

archive/issue_comments_120147.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-09T20:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120147",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120148.json:
```json
{
    "body": "Also, it seems to me that the name `pair` for this method is too generic.  Since this pairing is commonly known as the period pairing, would anyone object to renaming the method to `period`?",
    "created_at": "2014-05-09T21:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120148",
    "user": "https://github.com/pjbruin"
}
```

Also, it seems to me that the name `pair` for this method is too generic.  Since this pairing is commonly known as the period pairing, would anyone object to renaming the method to `period`?



---

archive/issue_comments_120149.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-09T23:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120149",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120150.json:
```json
{
    "body": "The new commit renames the method to `period`, and adds a `prec` argument and a line of code to deduce a bound on the number of terms of the series from that.  I don't have a reference for this bound; I just computed a slightly rough but hopefully correct one and put the basic idea in a comment.\n\nThere are various other changes.  All computations are now done in `RealField(prec)` and the associated `ComplexField`.  The method now also checks its input more carefully.\n\nI guess this does not really qualify as a reviewer patch anymore, but it is probably still OK if one of the existing authors reviews these changes instead of a \"disinterested third party\".",
    "created_at": "2014-05-09T23:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120150",
    "user": "https://github.com/pjbruin"
}
```

The new commit renames the method to `period`, and adds a `prec` argument and a line of code to deduce a bound on the number of terms of the series from that.  I don't have a reference for this bound; I just computed a slightly rough but hopefully correct one and put the basic idea in a comment.

There are various other changes.  All computations are now done in `RealField(prec)` and the associated `ComplexField`.  The method now also checks its input more carefully.

I guess this does not really qualify as a reviewer patch anymore, but it is probably still OK if one of the existing authors reviews these changes instead of a "disinterested third party".



---

archive/issue_comments_120151.json:
```json
{
    "body": "you should add doctests for the new raise statements",
    "created_at": "2014-05-10T06:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120151",
    "user": "https://github.com/fchapoton"
}
```

you should add doctests for the new raise statements



---

archive/issue_comments_120152.json:
```json
{
    "body": "I think period is a good name for this.  Can the docstring cross-reference the fact that for f associated to an elliptic curve E there is also the method E.modular_symbol() which gives exact rational output, namely the coordinates of the complex period with respect to the real and imaginary periods?",
    "created_at": "2014-05-10T08:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120152",
    "user": "https://github.com/JohnCremona"
}
```

I think period is a good name for this.  Can the docstring cross-reference the fact that for f associated to an elliptic curve E there is also the method E.modular_symbol() which gives exact rational output, namely the coordinates of the complex period with respect to the real and imaginary periods?



---

archive/issue_comments_120153.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-10T13:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120153",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_120154.json:
```json
{
    "body": "Thanks, Peter -- great example!",
    "created_at": "2014-05-10T13:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120154",
    "user": "https://github.com/JohnCremona"
}
```

Thanks, Peter -- great example!



---

archive/issue_comments_120155.json:
```json
{
    "body": "OK, I made some small corrections and added documentation and examples.",
    "created_at": "2014-05-10T13:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120155",
    "user": "https://github.com/pjbruin"
}
```

OK, I made some small corrections and added documentation and examples.



---

archive/issue_comments_120156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-10T17:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_120157.json:
```json
{
    "body": "ok, this looks good to me and the bot is happy. positive review",
    "created_at": "2014-06-04T19:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120157",
    "user": "https://github.com/fchapoton"
}
```

ok, this looks good to me and the bot is happy. positive review



---

archive/issue_comments_120158.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-04T19:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120158",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120159.json:
```json
{
    "body": "Changing keywords from \"\" to \"modular form\".",
    "created_at": "2014-06-04T19:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120159",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "modular form".



---

archive/issue_comments_120160.json:
```json
{
    "body": "Conflicts, please merge in the latest beta",
    "created_at": "2014-06-05T12:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120160",
    "user": "https://github.com/vbraun"
}
```

Conflicts, please merge in the latest beta



---

archive/issue_comments_120161.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-05T12:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120161",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_120162.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-05T15:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120162",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_120163.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-06-05T15:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120163",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_120164.json:
```json
{
    "body": "Merged development branch, all tests pass.",
    "created_at": "2014-06-05T15:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120164",
    "user": "https://github.com/pjbruin"
}
```

Merged development branch, all tests pass.



---

archive/issue_events_011146.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-06T18:07:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11043#event-11146"
}
```



---

archive/issue_comments_120165.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-06T18:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11043#issuecomment-120165",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
