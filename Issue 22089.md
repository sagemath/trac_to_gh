# Issue 22089: Symbolic Jacobi P polynomials

Issue created by migration from https://trac.sagemath.org/ticket/22326

Original creator: rws

Original creation time: 2017-02-08 08:51:39

At the moment, only a direct evaluation via pexpect-maxima exists, which should be replaced as to #17753.

https://en.wikipedia.org/wiki/Jacobi_polynomials


---

Comment by rws created at 2017-02-09 09:36:35

Changing status from new to needs_review.


---

Comment by rws created at 2017-02-09 09:36:35

New commits:


---

Comment by git created at 2017-02-09 14:21:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-02-09 15:05:45

Trivial PEP8 point:

```diff
                 conversions={'maxima':'jacobi_p', 'mathematica':'JacobiP',
-                    'maple':'JacobiP', 'sympy':'jacobi'})
+                             'maple':'JacobiP', 'sympy':'jacobi'})
```

Once changed, then you can set a positive review on my behalf.


---

Comment by git created at 2017-02-09 15:27:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-02-09 15:28:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-11 10:22:21

Resolution: fixed


---

Comment by embray created at 2017-04-18 13:18:47

FWIW a test that was added in this ticket is failing on Cygwin:


```
sage: var('n a b x')
(n, a, b, x)
sage: jacobi_P(2,n,n,n)
error: non-immediate integer expected
canonicalform.cc:53: In function `void CanonicalForm::mpzval(__mpz_struct*) const':
failed assertion `!is_imm (value) && value->levelcoeff() == IntegerDomain'

*** SIG 6 *** inside sig_on
do_raise_exception(sig=6)
PyErr_Occurred() = 0x0
Raising Python exception 0 ms after signals...
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-3-8e1c4485b87e> in <module>()
----> 1 jacobi_P(Integer(2),n,n,n)

/home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in __call__(self, *args, **kwds)
    423             return maxima(self._eval_(*args, **kwds))._sage_()
    424
--> 425         return super(OrthogonalFunction,self).__call__(*args, **kwds)
    426
    427

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11444)()
    994             res = self._evalf_try_(*args)
    995             if res is None:
--> 996                 res = super(BuiltinFunction, self).__call__(
    997                         *args, coerce=coerce, hold=hold)
    998

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6487)()
    484             for i from 0 <= i < len(args):
    485                 vec.push_back((<Expression>args[i])._gobj)
--> 486             res = g_function_evalv(self._serial, vec, hold)
    487         elif self._nargs == 1:
    488             res = g_function_eval1(self._serial,

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction._evalf_or_eval_ (build/cythonized/sage/symbolic/function.cpp:12804)()
   1083         res = self._evalf_try_(*args)
   1084         if res is None:
-> 1085             return self._eval0_(*args)
   1086         else:
   1087             return res

/home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in _eval_(self, n, a, b, x)
   1923         s = sum(binomial(n,m) * gamma(a+b+n+m+1) / gamma(a+m+1) * ((x-1)/2)**m for m in range(n+1))
   1924         r = gamma(a+n+1) / factorial(n) / gamma(n+a+b+1) * s
-> 1925         return r.to_gamma().gamma_normalize().normalize()
   1926
   1927     def _evalf_(self, n, a, b, x, **kwds):

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.gamma_normalize (build/cythonized/sage/symbolic/expression.cpp:52668)()
   9697         """
   9698         cdef GEx x
-> 9699         sig_on()
   9700         try:
   9701             x = gamma_normalize(self._gobj)

src/cysignals/signals.pyx in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1475)()

RuntimeError: Aborted
```


I'll open a separate ticket if/when I have a better idea what's going on.  But in the meantime, any guesses?

The assertion it's failing on is in libfactory in Singular, where `value->levelcoeff()` is returning `RationalDomain` instead of Integer.  I have no idea why.


---

Comment by embray created at 2017-04-18 14:51:58

Oh, turns out this is reproducible on Linux too.  It only happens when built with `SAGE_DEBUG=yes`


---

Comment by rws created at 2017-04-18 14:54:29

Replying to [comment:10 embray]:
> I'll open a separate ticket if/when I have a better idea what's going on.  But in the meantime, any guesses?
> 
> The assertion it's failing on is in libfactory in Singular, where `value->levelcoeff()` is returning `RationalDomain` instead of Integer.  I have no idea why.

Possible that Pynac is feeding no-no data to Singular. Please open a Pynac issue, it's more likely it's in Pynac than it's in Sage.


---

Comment by embray created at 2017-04-18 15:25:17

That's what it looks like to me too.  Specifically, somewhere in `frac_cancel` it's feeding Singular some polynomial coefficients that are rationals, not integers, I think...
