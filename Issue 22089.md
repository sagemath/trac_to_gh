# Issue 22089: Symbolic Jacobi P polynomials

archive/issues_022089.json:
```json
{
    "body": "At the moment, only a direct evaluation via pexpect-maxima exists, which should be replaced as to #17753.\n\nhttps://en.wikipedia.org/wiki/Jacobi_polynomials\n\nIssue created by migration from https://trac.sagemath.org/ticket/22326\n\n",
    "created_at": "2017-02-08T08:51:39Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Symbolic Jacobi P polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22089",
    "user": "https://github.com/rwst"
}
```
At the moment, only a direct evaluation via pexpect-maxima exists, which should be replaced as to #17753.

https://en.wikipedia.org/wiki/Jacobi_polynomials

Issue created by migration from https://trac.sagemath.org/ticket/22326





---

archive/issue_comments_306542.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-09T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306542",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_306543.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-02-09T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306543",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_306544.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-09T14:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_306545.json:
```json
{
    "body": "Trivial PEP8 point:\n\n```diff\n                 conversions={'maxima':'jacobi_p', 'mathematica':'JacobiP',\n-                    'maple':'JacobiP', 'sympy':'jacobi'})\n+                             'maple':'JacobiP', 'sympy':'jacobi'})\n```\n\nOnce changed, then you can set a positive review on my behalf.",
    "created_at": "2017-02-09T15:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306545",
    "user": "https://github.com/tscrim"
}
```

Trivial PEP8 point:

```diff
                 conversions={'maxima':'jacobi_p', 'mathematica':'JacobiP',
-                    'maple':'JacobiP', 'sympy':'jacobi'})
+                             'maple':'JacobiP', 'sympy':'jacobi'})
```

Once changed, then you can set a positive review on my behalf.



---

archive/issue_comments_306546.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-09T15:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306546",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_306547.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-09T15:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306547",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_306548.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-11T10:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306548",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_020817.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-02-11T10:22:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22089#event-20817"
}
```



---

archive/issue_comments_306549.json:
```json
{
    "body": "FWIW a test that was added in this ticket is failing on Cygwin:\n\n\n```\nsage: var('n a b x')\n(n, a, b, x)\nsage: jacobi_P(2,n,n,n)\nerror: non-immediate integer expected\ncanonicalform.cc:53: In function `void CanonicalForm::mpzval(__mpz_struct*) const':\nfailed assertion `!is_imm (value) && value->levelcoeff() == IntegerDomain'\n\n*** SIG 6 *** inside sig_on\ndo_raise_exception(sig=6)\nPyErr_Occurred() = 0x0\nRaising Python exception 0 ms after signals...\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-3-8e1c4485b87e> in <module>()\n----> 1 jacobi_P(Integer(2),n,n,n)\n\n/home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in __call__(self, *args, **kwds)\n    423             return maxima(self._eval_(*args, **kwds))._sage_()\n    424\n--> 425         return super(OrthogonalFunction,self).__call__(*args, **kwds)\n    426\n    427\n\n/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11444)()\n    994             res = self._evalf_try_(*args)\n    995             if res is None:\n--> 996                 res = super(BuiltinFunction, self).__call__(\n    997                         *args, coerce=coerce, hold=hold)\n    998\n\n/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6487)()\n    484             for i from 0 <= i < len(args):\n    485                 vec.push_back((<Expression>args[i])._gobj)\n--> 486             res = g_function_evalv(self._serial, vec, hold)\n    487         elif self._nargs == 1:\n    488             res = g_function_eval1(self._serial,\n\n/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction._evalf_or_eval_ (build/cythonized/sage/symbolic/function.cpp:12804)()\n   1083         res = self._evalf_try_(*args)\n   1084         if res is None:\n-> 1085             return self._eval0_(*args)\n   1086         else:\n   1087             return res\n\n/home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in _eval_(self, n, a, b, x)\n   1923         s = sum(binomial(n,m) * gamma(a+b+n+m+1) / gamma(a+m+1) * ((x-1)/2)**m for m in range(n+1))\n   1924         r = gamma(a+n+1) / factorial(n) / gamma(n+a+b+1) * s\n-> 1925         return r.to_gamma().gamma_normalize().normalize()\n   1926\n   1927     def _evalf_(self, n, a, b, x, **kwds):\n\n/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.gamma_normalize (build/cythonized/sage/symbolic/expression.cpp:52668)()\n   9697         \"\"\"\n   9698         cdef GEx x\n-> 9699         sig_on()\n   9700         try:\n   9701             x = gamma_normalize(self._gobj)\n\nsrc/cysignals/signals.pyx in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1475)()\n\nRuntimeError: Aborted\n```\n\n\nI'll open a separate ticket if/when I have a better idea what's going on.  But in the meantime, any guesses?\n\nThe assertion it's failing on is in libfactory in Singular, where `value->levelcoeff()` is returning `RationalDomain` instead of Integer.  I have no idea why.",
    "created_at": "2017-04-18T13:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306549",
    "user": "https://github.com/embray"
}
```

FWIW a test that was added in this ticket is failing on Cygwin:


```
sage: var('n a b x')
(n, a, b, x)
sage: jacobi_P(2,n,n,n)
error: non-immediate integer expected
canonicalform.cc:53: In function `void CanonicalForm::mpzval(__mpz_struct*) const':
failed assertion `!is_imm (value) && value->levelcoeff() == IntegerDomain'

*** SIG 6 *** inside sig_on
do_raise_exception(sig=6)
PyErr_Occurred() = 0x0
Raising Python exception 0 ms after signals...
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-3-8e1c4485b87e> in <module>()
----> 1 jacobi_P(Integer(2),n,n,n)

/home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in __call__(self, *args, **kwds)
    423             return maxima(self._eval_(*args, **kwds))._sage_()
    424
--> 425         return super(OrthogonalFunction,self).__call__(*args, **kwds)
    426
    427

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11444)()
    994             res = self._evalf_try_(*args)
    995             if res is None:
--> 996                 res = super(BuiltinFunction, self).__call__(
    997                         *args, coerce=coerce, hold=hold)
    998

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6487)()
    484             for i from 0 <= i < len(args):
    485                 vec.push_back((<Expression>args[i])._gobj)
--> 486             res = g_function_evalv(self._serial, vec, hold)
    487         elif self._nargs == 1:
    488             res = g_function_eval1(self._serial,

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction._evalf_or_eval_ (build/cythonized/sage/symbolic/function.cpp:12804)()
   1083         res = self._evalf_try_(*args)
   1084         if res is None:
-> 1085             return self._eval0_(*args)
   1086         else:
   1087             return res

/home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in _eval_(self, n, a, b, x)
   1923         s = sum(binomial(n,m) * gamma(a+b+n+m+1) / gamma(a+m+1) * ((x-1)/2)**m for m in range(n+1))
   1924         r = gamma(a+n+1) / factorial(n) / gamma(n+a+b+1) * s
-> 1925         return r.to_gamma().gamma_normalize().normalize()
   1926
   1927     def _evalf_(self, n, a, b, x, **kwds):

/home/embray/src/sagemath/sage-cygwin/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.gamma_normalize (build/cythonized/sage/symbolic/expression.cpp:52668)()
   9697         """
   9698         cdef GEx x
-> 9699         sig_on()
   9700         try:
   9701             x = gamma_normalize(self._gobj)

src/cysignals/signals.pyx in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1475)()

RuntimeError: Aborted
```


I'll open a separate ticket if/when I have a better idea what's going on.  But in the meantime, any guesses?

The assertion it's failing on is in libfactory in Singular, where `value->levelcoeff()` is returning `RationalDomain` instead of Integer.  I have no idea why.



---

archive/issue_comments_306550.json:
```json
{
    "body": "Oh, turns out this is reproducible on Linux too.  It only happens when built with `SAGE_DEBUG=yes`",
    "created_at": "2017-04-18T14:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306550",
    "user": "https://github.com/embray"
}
```

Oh, turns out this is reproducible on Linux too.  It only happens when built with `SAGE_DEBUG=yes`



---

archive/issue_comments_306551.json:
```json
{
    "body": "Replying to [comment:10 embray]:\n> I'll open a separate ticket if/when I have a better idea what's going on.  But in the meantime, any guesses?\n> \n> The assertion it's failing on is in libfactory in Singular, where `value->levelcoeff()` is returning `RationalDomain` instead of Integer.  I have no idea why.\n\nPossible that Pynac is feeding no-no data to Singular. Please open a Pynac issue, it's more likely it's in Pynac than it's in Sage.",
    "created_at": "2017-04-18T14:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306551",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:10 embray]:
> I'll open a separate ticket if/when I have a better idea what's going on.  But in the meantime, any guesses?
> 
> The assertion it's failing on is in libfactory in Singular, where `value->levelcoeff()` is returning `RationalDomain` instead of Integer.  I have no idea why.

Possible that Pynac is feeding no-no data to Singular. Please open a Pynac issue, it's more likely it's in Pynac than it's in Sage.



---

archive/issue_comments_306552.json:
```json
{
    "body": "That's what it looks like to me too.  Specifically, somewhere in `frac_cancel` it's feeding Singular some polynomial coefficients that are rationals, not integers, I think...",
    "created_at": "2017-04-18T15:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22089#issuecomment-306552",
    "user": "https://github.com/embray"
}
```

That's what it looks like to me too.  Specifically, somewhere in `frac_cancel` it's feeding Singular some polynomial coefficients that are rationals, not integers, I think...
