# Issue 27168: Ignore pip stderr when querying packages

Issue created by migration from https://trac.sagemath.org/ticket/27405

Original creator: @timokau

Original creation time: 2019-03-03 12:12:25

CC:  embray

When querying installed packages using `pip`, sage will currently parse stdout and not explicitly handle stderr. That means that stderr will be printed to the terminal.

Since pip 19 has started printing a deprecation warning for python 2.7, this warning will also be printed when querying installed packages with sage. That leads to doctest failures.

Since this warning does not belong to the `installed_packages` function (using pip is an implementation detail here) and to make sure the doctests work for old as well as new pip versions (and python2 as well as python3), we should explicitly send stderr to /dev/null.

The alternative would be to incorporate the deprecation warning into the doctest. That would make it harder to use the system pip (which I don't think we currently do but probably will want to do in the future).


---

Comment by @timokau created at 2019-03-03 12:12:37

Changing status from new to needs_review.


---

Comment by git created at 2019-03-03 12:14:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2019-03-03 18:59:40

I don't see any redirection in your commit... didn't you forgot `stderr=devnull`?


---

Comment by git created at 2019-03-03 20:00:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @timokau created at 2019-03-03 20:01:13

Yes, I had to rebase on top of #27001 and must have forgotten to re-add that. Thanks for catching that.
----
New commits:


---

Comment by vdelecroix created at 2019-03-03 20:05:51

Changing status from needs_review to positive_review.


---

Comment by @timokau created at 2019-03-03 20:10:02

Thanks!


---

Comment by vbraun created at 2019-03-04 23:16:23

Resolution: fixed
