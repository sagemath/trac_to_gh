# Issue 24661: wrong relabel handling in modular_decomposition of graphs

Issue created by migration from https://trac.sagemath.org/ticket/24898

Original creator: tmonteil

Original creation time: 2018-03-05 10:20:00

CC:  jlokesh dimpase dcoudert

As reported on [this ask question](https://ask.sagemath.org/question/41398/error-with-is_prime/):


```
sage: G=Graph({1:[2],2:[1]})
sage: G.modular_decomposition()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-5-05fa7ad0eb50> in <module>()
----> 1 G.modular_decomposition()

/opt/sagemath/sage-source/local/lib/python2.7/site-packages/sage/graphs/graph.pyc in modular_decomposition(self)
   7185         relabel = lambda x : (x.node_type, [relabel(_) for _ in x.children]) if x.node_type != NodeType.NORMAL else id_label[x.children[0]]
   7186 
-> 7187         return relabel(D)
   7188 
   7189     @doc_index("Graph properties")

/opt/sagemath/sage-source/local/lib/python2.7/site-packages/sage/graphs/graph.pyc in <lambda>(x)
   7183         id_label = dict(enumerate(self.vertices()))
   7184 
-> 7185         relabel = lambda x : (x.node_type, [relabel(_) for _ in x.children]) if x.node_type != NodeType.NORMAL else id_label[x.children[0]]
   7186 
   7187         return relabel(D)

/opt/sagemath/sage-source/local/lib/python2.7/site-packages/sage/graphs/graph.pyc in <lambda>(x)
   7183         id_label = dict(enumerate(self.vertices()))
   7184 
-> 7185         relabel = lambda x : (x.node_type, [relabel(_) for _ in x.children]) if x.node_type != NodeType.NORMAL else id_label[x.children[0]]
   7186 
   7187         return relabel(D)

KeyError: 2
```




---

Comment by dimpase created at 2018-03-06 03:03:18

removing the leftover from the old implementation fixes the problem. patch coming.


---

Comment by dimpase created at 2018-03-06 04:52:21

New commits:


---

Comment by dimpase created at 2018-03-06 04:52:21

Changing status from new to needs_review.


---

Comment by tmonteil created at 2018-03-06 12:48:12

Thanks for being reactive.


---

Comment by tmonteil created at 2018-03-06 12:48:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-03-08 00:02:36

Resolution: fixed
