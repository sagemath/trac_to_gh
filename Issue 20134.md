# Issue 20134: dispersion and dispersion sets of polynomials

Issue created by migration from https://trac.sagemath.org/ticket/20371

Original creator: mmezzarobba

Original creation time: 2016-04-06 12:29:52




---

Comment by mmezzarobba created at 2016-04-06 12:43:12

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2016-04-06 12:43:12

New commits:


---

Comment by bruno created at 2016-04-08 09:47:06

A few remarks/questions:

* In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:

```     
The dispersion set of `p` and `q` is the set of nonnegative integers
`n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.
```


* It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.

* You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?

* In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):

```python
other = self if other is None else other if other in self._parent else self._parent.coerce(other)
```



---

Comment by mmezzarobba created at 2016-04-12 15:47:10

Hi Bruno,

Replying to [comment:2 bruno]:
> A few remarks/questions:
> 
> * In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:
> {{{     
> The dispersion set of `p` and `q` is the set of nonnegative integers
> `n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.
> }}}

Thanks, I will fix that.

> * It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.

Since there is nothing really surprising about that return value, I'd prefer keeping just the example. But please feel free to insist if you disagree.

> * You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?

I don't know if there is such an example. Since this is a generic implementation, I'd rather be on the safe side. And if you are concerned with the performance penalty, you can always run python with assertions disabled...

> * In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):
> {{{#!python
> other = self if other is None else other if other in self._parent else self._parent.coerce(other)
> }}}

As far as I understand, your version is not equivalent to mine (`QQ(1) in ZZ` holds), and actually does more work: `in` alone will perform a conversion and a coercion, or something like that.


---

Comment by git created at 2016-04-12 15:54:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2016-04-12 16:08:14

Hi Marc,

Replying to [comment:3 mmezzarobba]:
> Hi Bruno,
> 
> Replying to [comment:2 bruno]:
> > A few remarks/questions:
> > 
> > * In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:
> > {{{     
> > The dispersion set of `p` and `q` is the set of nonnegative integers
> > `n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.
> > }}}
> 
> Thanks, I will fix that.
You only fixed the first typo...

> 
> > * It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.
> 
> Since there is nothing really surprising about that return value, I'd prefer keeping just the example. But please feel free to insist if you disagree.
I do not have strong opinion on this...
 
> > * You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?
> 
> I don't know if there is such an example. Since this is a generic implementation, I'd rather be on the safe side. And if you are concerned with the performance penalty, you can always run python with assertions disabled...
It was more a matter of clarity. Again, I do not have a strong opinion...

> 
> > * In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):
> > {{{#!python
> > other = self if other is None else other if other in self._parent else self._parent.coerce(other)
> > }}}
> 
> As far as I understand, your version is not equivalent to mine (`QQ(1) in ZZ` holds), and actually does more work: `in` alone will perform a conversion and a coercion, or something like that.
Right, I did not write it correctly. What I meant:

```python
other = self if other is None else other if other._parent is self._parent else self._parent.coerce(other)
```

That way, I guess that my version is completely equivalent to yours and (slightly) faster. I may be stuttering but I still don't have a strong opinion on whether you should change your code...


---

Comment by git created at 2016-04-13 08:56:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2016-04-13 08:58:01

Replying to [comment:5 bruno]:
> You only fixed the first typo...

Oooops.

> That way, I guess that my version is completely equivalent to yours and (slightly) faster. I may be stuttering but I still don't have a strong opinion on whether you should change your code...

Then let's keep it as it is for now.


---

Comment by bruno created at 2016-04-13 10:05:31

OK, looks good to me!


---

Comment by bruno created at 2016-04-13 10:05:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-04-14 21:56:59

Resolution: fixed
