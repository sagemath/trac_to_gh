# Issue 20134: dispersion and dispersion sets of polynomials

archive/issues_020134.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/20371\n\n",
    "created_at": "2016-04-06T12:29:52Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "title": "dispersion and dispersion sets of polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20134",
    "user": "mmezzarobba"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/20371





---

archive/issue_comments_277412.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-06T12:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277412",
    "user": "mmezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_277413.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-04-06T12:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277413",
    "user": "mmezzarobba"
}
```

New commits:



---

archive/issue_comments_277414.json:
```json
{
    "body": "A few remarks/questions:\n\n* In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:\n\n```     \nThe dispersion set of `p` and `q` is the set of nonnegative integers\n`n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.\n```\n\n\n* It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.\n\n* You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?\n\n* In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):\n\n```python\nother = self if other is None else other if other in self._parent else self._parent.coerce(other)\n```\n",
    "created_at": "2016-04-08T09:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277414",
    "user": "bruno"
}
```

A few remarks/questions:

* In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:

```     
The dispersion set of `p` and `q` is the set of nonnegative integers
`n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.
```


* It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.

* You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?

* In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):

```python
other = self if other is None else other if other in self._parent else self._parent.coerce(other)
```




---

archive/issue_comments_277415.json:
```json
{
    "body": "Hi Bruno,\n\nReplying to [comment:2 bruno]:\n> A few remarks/questions:\n> \n> * In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:\n> {{{     \n> The dispersion set of `p` and `q` is the set of nonnegative integers\n> `n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.\n> }}}\n\nThanks, I will fix that.\n\n> * It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.\n\nSince there is nothing really surprising about that return value, I'd prefer keeping just the example. But please feel free to insist if you disagree.\n\n> * You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?\n\nI don't know if there is such an example. Since this is a generic implementation, I'd rather be on the safe side. And if you are concerned with the performance penalty, you can always run python with assertions disabled...\n\n> * In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):\n> {{{#!python\n> other = self if other is None else other if other in self._parent else self._parent.coerce(other)\n> }}}\n\nAs far as I understand, your version is not equivalent to mine (`QQ(1) in ZZ` holds), and actually does more work: `in` alone will perform a conversion and a coercion, or something like that.",
    "created_at": "2016-04-12T15:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277415",
    "user": "mmezzarobba"
}
```

Hi Bruno,

Replying to [comment:2 bruno]:
> A few remarks/questions:
> 
> * In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:
> {{{     
> The dispersion set of `p` and `q` is the set of nonnegative integers
> `n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.
> }}}

Thanks, I will fix that.

> * It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.

Since there is nothing really surprising about that return value, I'd prefer keeping just the example. But please feel free to insist if you disagree.

> * You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?

I don't know if there is such an example. Since this is a generic implementation, I'd rather be on the safe side. And if you are concerned with the performance penalty, you can always run python with assertions disabled...

> * In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):
> {{{#!python
> other = self if other is None else other if other in self._parent else self._parent.coerce(other)
> }}}

As far as I understand, your version is not equivalent to mine (`QQ(1) in ZZ` holds), and actually does more work: `in` alone will perform a conversion and a coercion, or something like that.



---

archive/issue_comments_277416.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-12T15:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277416",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277417.json:
```json
{
    "body": "Hi Marc,\n\nReplying to [comment:3 mmezzarobba]:\n> Hi Bruno,\n> \n> Replying to [comment:2 bruno]:\n> > A few remarks/questions:\n> > \n> > * In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:\n> > {{{     \n> > The dispersion set of `p` and `q` is the set of nonnegative integers\n> > `n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.\n> > }}}\n> \n> Thanks, I will fix that.\nYou only fixed the first typo...\n\n> \n> > * It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.\n> \n> Since there is nothing really surprising about that return value, I'd prefer keeping just the example. But please feel free to insist if you disagree.\nI do not have strong opinion on this...\n \n> > * You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?\n> \n> I don't know if there is such an example. Since this is a generic implementation, I'd rather be on the safe side. And if you are concerned with the performance penalty, you can always run python with assertions disabled...\nIt was more a matter of clarity. Again, I do not have a strong opinion...\n\n> \n> > * In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):\n> > {{{#!python\n> > other = self if other is None else other if other in self._parent else self._parent.coerce(other)\n> > }}}\n> \n> As far as I understand, your version is not equivalent to mine (`QQ(1) in ZZ` holds), and actually does more work: `in` alone will perform a conversion and a coercion, or something like that.\nRight, I did not write it correctly. What I meant:\n\n```python\nother = self if other is None else other if other._parent is self._parent else self._parent.coerce(other)\n```\n\nThat way, I guess that my version is completely equivalent to yours and (slightly) faster. I may be stuttering but I still don't have a strong opinion on whether you should change your code...",
    "created_at": "2016-04-12T16:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277417",
    "user": "bruno"
}
```

Hi Marc,

Replying to [comment:3 mmezzarobba]:
> Hi Bruno,
> 
> Replying to [comment:2 bruno]:
> > A few remarks/questions:
> > 
> > * In the docstrings of `dispersion_set` and `dispersion` you have an inconsistency between  `p,q` and `f,g`:
> > {{{     
> > The dispersion set of `p` and `q` is the set of nonnegative integers
> > `n` such that `f(x + n)` and `g(x)` have a nonconstant common factor.
> > }}}
> 
> Thanks, I will fix that.
You only fixed the first typo...

> 
> > * It may be useful to mention that when the dispersion set is empty, the dispersion you return is `-Infinity`. There is an example of the behavior, but you may add it in the text.
> 
> Since there is nothing really surprising about that return value, I'd prefer keeping just the example. But please feel free to insist if you disagree.
I do not have strong opinion on this...
 
> > * You use `assert` twice: Is there an example where the assertion does not hold? If this is the case, it may be interesting to have a more meaningful error message. If this is just to prevent an hypothetic future case where some factorization algorithm does not respect this assertion, is it really needed?
> 
> I don't know if there is such an example. Since this is a generic implementation, I'd rather be on the safe side. And if you are concerned with the performance penalty, you can always run python with assertions disabled...
It was more a matter of clarity. Again, I do not have a strong opinion...

> 
> > * In the first line of dispersion_set, you use a possibly useless coercion. You may change this line to (I was not sure about the syntax but it seems to work):
> > {{{#!python
> > other = self if other is None else other if other in self._parent else self._parent.coerce(other)
> > }}}
> 
> As far as I understand, your version is not equivalent to mine (`QQ(1) in ZZ` holds), and actually does more work: `in` alone will perform a conversion and a coercion, or something like that.
Right, I did not write it correctly. What I meant:

```python
other = self if other is None else other if other._parent is self._parent else self._parent.coerce(other)
```

That way, I guess that my version is completely equivalent to yours and (slightly) faster. I may be stuttering but I still don't have a strong opinion on whether you should change your code...



---

archive/issue_comments_277418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-13T08:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277418",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277419.json:
```json
{
    "body": "Replying to [comment:5 bruno]:\n> You only fixed the first typo...\n\nOooops.\n\n> That way, I guess that my version is completely equivalent to yours and (slightly) faster. I may be stuttering but I still don't have a strong opinion on whether you should change your code...\n\nThen let's keep it as it is for now.",
    "created_at": "2016-04-13T08:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277419",
    "user": "mmezzarobba"
}
```

Replying to [comment:5 bruno]:
> You only fixed the first typo...

Oooops.

> That way, I guess that my version is completely equivalent to yours and (slightly) faster. I may be stuttering but I still don't have a strong opinion on whether you should change your code...

Then let's keep it as it is for now.



---

archive/issue_comments_277420.json:
```json
{
    "body": "OK, looks good to me!",
    "created_at": "2016-04-13T10:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277420",
    "user": "bruno"
}
```

OK, looks good to me!



---

archive/issue_comments_277421.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-13T10:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277421",
    "user": "bruno"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_277422.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-14T21:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20134#issuecomment-277422",
    "user": "vbraun"
}
```

Resolution: fixed
