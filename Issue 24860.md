# Issue 24860: Algebraic polyhedra with QNormaliz / e-antic

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2018-04-03 23:31:05

CC:  winfried vdelecroix jipilab @sebasguts tmonteil moritz




---

Comment by vdelecroix created at 2018-04-04 08:56:18

prerequisite: package [antic](https://github.com/wbhart/antic) (that has no release yet).


---

Comment by mkoeppe created at 2018-04-04 19:33:00

Last 10 new commits:


---

Comment by mkoeppe created at 2018-04-04 20:02:45

Could someone who has worked on / has opinions on the Polyhedron constructor code help here?

What should we do for polyhedra over AA such as the following:

```
sage: P = polytopes.regular_polygon(3)
sage: P.base_ring()
Algebraic Real Field
```

If `backend=normaliz` is requested, should we cast to the appropriate number field via #20181? Or should it be an error?


---

Comment by jipilab created at 2018-04-05 23:11:08

> What should we do for polyhedra over AA such as the following:
> {{{
> sage: P = polytopes.regular_polygon(3)
> sage: P.base_ring()
> Algebraic Real Field
> }}}
> If `backend=normaliz` is requested, should we cast to the appropriate number field via #20181? Or should it be an error?
> 

I would say the cleanest thing to do once #20181 is done will be to use it! This probably will also simplify the constructor for `field`.


---

Comment by git created at 2018-04-06 21:21:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-06 21:50:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-04-08 18:10:22

I put some preliminary code in to do the coercion to number fields inside the `Polyhedron_normaliz` implementation, using `number_field_elements_from_algebraics`.


---

Comment by git created at 2018-04-08 18:10:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-08 22:54:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-09 03:10:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-04-09 03:15:10

Changing keywords from "" to "IMA-PolyGeom".


---

Comment by git created at 2018-04-09 15:50:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2018-04-09 20:31:04

A note: I am trying out the method in the ticket description and I get a `ImportError: No module named PyQNormaliz_cpp` when I try with an example.

What should I do?


---

Comment by jipilab created at 2018-04-09 20:39:17

Replying to [comment:26 jipilab]:
> A note: I am trying out the method in the ticket description and I get a `ImportError: No module named PyQNormaliz_cpp` when I try with an example.
> 
> What should I do?

Coming from the installation of normaliz through sage:


```
[normaliz] Installing ARB...
[normaliz] curl: (1) Protocol "https" not supported or disabled in libcurl
Makefile:2080: recipe for target 'normaliz' failed
make[1]: *** [normaliz] Error 1
make[1]: Leaving directory '/home/jplabbe/sage/build/make'
```



---

Comment by jipilab created at 2018-04-09 21:51:49

Replying to [comment:27 jipilab]:
> Replying to [comment:26 jipilab]:
> > A note: I am trying out the method in the ticket description and I get a `ImportError: No module named PyQNormaliz_cpp` when I try with an example.
> > 
> > What should I do?
> 
> Coming from the installation of normaliz through sage:
> 
> {{{
> [normaliz] Installing ARB...
> [normaliz] curl: (1) Protocol "https" not supported or disabled in libcurl
> Makefile:2080: recipe for target 'normaliz' failed
> make[1]: *** [normaliz] Error 1
> make[1]: Leaving directory '/home/jplabbe/sage/build/make'
> }}}

To fix this, I had to force install `curl` inside a sage shell. On a debian-sid distribution, it seems that it was not necessary.


---

Comment by jipilab created at 2018-04-09 22:11:10

After installing `autotools` and `automake` I get the following error message:


```
[normaliz] Installing E-ANTIC...
[normaliz] From https://github.com/mkoeppe/e-antic
[normaliz]  * branch            winfried   -> FETCH_HEAD
[normaliz] HEAD is now at 9de1e6f... renf_elem_class.get_den: New
[normaliz] aclocal: warning: couldn't open directory 'm4': No such file or directory
[normaliz] configure.ac:9: error: possibly undefined macro: AC_PROG_LIBTOOL
[normaliz]       If this token and others are legitimate, please use m4_pattern_allow.
[normaliz]       See the Autoconf documentation.
[normaliz] autoreconf: /usr/bin/autoconf failed with exit status: 1
Makefile:2080: recipe for target 'normaliz' failed
make[1]: *** [normaliz] Error 1
make[1]: Leaving directory '/home/jplabbe/sage/build/make'
```


Then, after installing `libtool` (sage should complain about that not installed?!) then I get:


```
[normaliz] make[2]: Leaving directory '/home/jplabbe/sage/local/enfnormaliz/E-ANTIC_source/e-antic'
[normaliz] configure: error: cannot find install-sh, install.sh, or shtool in "." "./.." "./../.."
Makefile:2080: recipe for target 'normaliz' failed
make[1]: *** [normaliz] Error 1
make[1]: Leaving directory '/home/jplabbe/sage/build/make'
```



---

Comment by jipilab created at 2018-04-09 23:01:42

... Problem solved by gh-sebasguts: there was an old config file lying around. Deleting it solved the issue.


---

Comment by moritz created at 2018-04-09 23:20:10

works flawlessly for me!


---

Comment by @TimmyChan created at 2018-04-10 15:21:23

Replying to [comment:28 jipilab]:
> Replying to [comment:27 jipilab]:
> > Replying to [comment:26 jipilab]:
> > > A note: I am trying out the method in the ticket description and I get a `ImportError: No module named PyQNormaliz_cpp` when I try with an example.
> > > 
> > > What should I do?
> > 
> > Coming from the installation of normaliz through sage:
> > 
> > {{{
> > [normaliz] Installing ARB...
> > [normaliz] curl: (1) Protocol "https" not supported or disabled in libcurl
> > Makefile:2080: recipe for target 'normaliz' failed
> > make[1]: *** [normaliz] Error 1
> > make[1]: Leaving directory '/home/jplabbe/sage/build/make'
> > }}}
> 
> To fix this, I had to force install `curl` inside a sage shell. On a debian-sid distribution, it seems that it was not necessary.

Same issue in Ubuntu 16.04LTS, doing `sage -f curl` in a sage shell does not work. Purging curl and reinstalling also didn't work. In order to enable ssl for curl, used the command `sudo apt-get install libssl-dev`. After that I no longer have the error `curl: (1) Protocol "https" not supported...`


---

Comment by @TimmyChan created at 2018-04-10 15:45:48

Replying to [comment:31 jipilab]:
> After installing `autotools` and `automake` I get the following error message:
> 
> {{{
> [normaliz] Installing E-ANTIC...
> [normaliz] From https://github.com/mkoeppe/e-antic
> [normaliz]  * branch            winfried   -> FETCH_HEAD
> [normaliz] HEAD is now at 9de1e6f... renf_elem_class.get_den: New
> [normaliz] aclocal: warning: couldn't open directory 'm4': No such file or directory
> [normaliz] configure.ac:9: error: possibly undefined macro: AC_PROG_LIBTOOL
> [normaliz]       If this token and others are legitimate, please use m4_pattern_allow.
> [normaliz]       See the Autoconf documentation.
> [normaliz] autoreconf: /usr/bin/autoconf failed with exit status: 1
> Makefile:2080: recipe for target 'normaliz' failed
> make[1]: *** [normaliz] Error 1
> make[1]: Leaving directory '/home/jplabbe/sage/build/make'
> }}}
> 
> Then, after installing `libtool` (sage should complain about that not installed?!) then I get:
> 
> {{{
> [normaliz] make[2]: Leaving directory '/home/jplabbe/sage/local/enfnormaliz/E-ANTIC_source/e-antic'
> [normaliz] configure: error: cannot find install-sh, install.sh, or shtool in "." "./.." "./../.."
> Makefile:2080: recipe for target 'normaliz' failed
> make[1]: *** [normaliz] Error 1
> make[1]: Leaving directory '/home/jplabbe/sage/build/make'
> }}}


Installed `autotools-dev` and `automake` and `libtool` and installation completed on Ubuntu 16.04LTS.


---

Comment by jipilab created at 2018-04-10 15:54:58

There is a link error in my installation:


```
sage: import PyQNormaliz_cpp
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-10-4c34a88d49d7> in <module>()
----> 1 import PyQNormaliz_cpp

ImportError: /home/jplabbe/sage/local/enfnormaliz/lib/libantic.so.0: undefined symbol: _fmpq_poly_resultant_div
```


This can be solved by typing


```
export LD_LIBRARY_PATH=your_sage_path/local/enfnormaliz/lib/:$LD_LIBRARY_PATH
```


before starting sage in the terminal...


---

Comment by @sebasguts created at 2018-04-10 17:06:47

While this solution works for jipilab, it does not for gh-TimmyChan. Apparently his Ubuntu 16.04 honors the `-rpath` setting from the PyQNormaliz install script.

The problem is that the `-rpath` will be set by python itself, and it is not possible to insert anything before that path.


---

Comment by @TimmyChan created at 2018-04-10 17:20:47

Replying to [comment:37 gh-sebasguts]:
> While this solution works for jipilab, it does not for gh-TimmyChan. Apparently his Ubuntu 16.04 honors the `-rpath` setting from the PyQNormaliz install script.
> 
> The problem is that the `-rpath` will be set by python itself, and it is not possible to insert anything before that path.

Temporarily, `import PyQNormaliz_cpp` can work by removing 'libflint.so.13` from `~/sage/local/lib/` to some other directory.


---

Comment by Winfried created at 2018-07-05 09:07:17

Since version 3.6.0 QNormaliz and PyQNormaliz are included in the Normaliz distribution.


---

Comment by git created at 2018-09-18 17:45:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-18 21:27:39

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2018-09-18 21:31:51

Updated this branch to use the current released versions of Normaliz from #25090 and PyQNormaliz from pypi.


---

Comment by git created at 2018-09-19 03:49:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-09-19 03:51:13

Far from "needs review", but needs testing / debugging.
(I'm currently getting a segfault when running the testsuite for backend_normaliz.py.)


---

Comment by Winfried created at 2018-09-19 07:02:44

Could you give more specific information?


---

Comment by mkoeppe created at 2018-09-19 12:52:56


```
sage: x = polygen(ZZ); P = Polyhedron(vertices=[[sqrt(2)], [AA.polynomial_root(x^3-2, RIF(0,3))]], backend='normaliz', ver
....: bose=True)
# ----8<---- Equivalent QNormaliz input file ---8<----
amb_space 1
subspace 0
vertices 2
 (a^3) 1
 (a^2) 1
number_field min_poly (a^6 - 2) embedding [1.122462048309373 +/- 5.38e-16]
cone 0
# ----8<-------------------8<-------------------8<----
# Calling PyQNormaliz_cpp.NmzCone(**{'subspace': [], 'vertices': [[[[0L, 1L], [0L, 1L], [0L, 1L], [1L, 1L], [0L, 1L], [0L, 1L]], 1L], [[[0L, 1L], [0L, 1L], [1L, 1L], [0L, 1L], [0L, 1L], [0L, 1L]], 1L]], 'number_field': 'min_poly (a^6 - 2) embedding [1.122462048309373 +/- 5.38e-16]', 'cone': []})
------------------------------------------------------------------------
(no backtrace available)
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault: 11
```



---

Comment by Winfried created at 2018-09-19 13:35:19

Normaliz 3.6.3 (and presumably already 3.6.0) computes the polytope without any problems, provided the number_field follows immediately after amb_space. (One could think of relaxing this condition.) Output:



```
Real embedded number field:
min_poly (a^6 - 2) embedding [1.1225 +/- 4.57e-5]

2 vertices of polyhedron
0 extreme rays of recession cone
2 support hyperplanes of polyhedron (homogenized)

embedding dimension = 2
affine dimension of the polyhedron = 1 (maximal)
rank of recession cone = 0

dehomogenization:
0 1 

***********************************************************************

2 vertices of polyhedron:
 (a^2 ~ 1.2599) 1
 (a^3 ~ 1.4142) 1

0 extreme rays of recession cone:

2 support hyperplanes of polyhedron (homogenized):
 (-1/2*a^3 ~ -0.7071)  1
   (1/2*a^4 ~ 0.7937) -1
```



---

Comment by mkoeppe created at 2018-09-19 13:49:00

Replying to [comment:50 Winfried]:
> Normaliz 3.6.3 (and presumably already 3.6.0) computes the polytope without any problems,

Thanks for testing. Yes, I think the segfault is coming from somewhere in the interfacing.

> provided the number_field follows immediately after amb_space. 
> (One could think of relaxing this condition.) 
No, I don't think that's necessary -- I just need to fix the normaliz file writer in my sage code to know about this.


---

Comment by git created at 2018-09-21 00:57:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-09-21 01:23:47


```
x = polygen(ZZ); P = Polyhedron(vertices=[[sqrt(2)], [AA.polynomial_root(x^3-2, RIF(0,3))]], backend='normaliz', verbose=True); P._Hrepresentation
.... segfault ...
```

Some memory corruption involving the gc, it seems


---

Comment by git created at 2018-09-21 20:05:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-21 22:11:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-22 01:50:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-22 18:24:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-09-22 19:07:28

Replying to [comment:37 gh-sebasguts]:
> While this solution works for jipilab, it does not for gh-TimmyChan. Apparently his Ubuntu 16.04 honors the `-rpath` setting from the PyQNormaliz install script.
> 
> The problem is that the `-rpath` will be set by python itself, and it is not possible to insert anything before that path.

With the latest commits, I have removed the separate flint installation and this ticket should be easier to build. Please test


---

Comment by git created at 2018-09-22 20:12:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-23 03:03:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-23 13:28:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-09-23 13:34:20

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2018-09-27 23:56:50

PyQNormaliz 1.3 is out - https://files.pythonhosted.org/packages/f9/3a/4ffbb22390023f7f8331309c51a73063ccee465df307e898456fbcf05356/PyQNormaliz-1.3.tar.gz


---

Comment by git created at 2018-10-08 23:35:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-09 01:22:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2019-04-16 19:53:26

I think we should decouple: upgrading Normaliz and interfacing Normaliz.


---

Comment by vdelecroix created at 2019-04-16 19:56:16

I opened #27682


---

Comment by jipilab created at 2019-04-17 07:18:08

Replying to [comment:68 vdelecroix]:
> I think we should decouple: upgrading Normaliz and interfacing Normaliz.
+1


---

Comment by vdelecroix created at 2019-04-18 14:29:35

I think it would be good to split this ticket into two tickets:
1. Make `backend='normaliz'` accepts input being in a common embedded real number field. That is the following should work

```
sage: K.<a> = QuadraticField(2, embedding=AA(2)**(1/2))
sage: Polyhedron([[0,0],[1,a],[0,2*a],[-1,-a]], base_ring=K, backend='normaliz')
```

  And we should also make it so that `backend='normaliz'` is actually automatically chosen if available

```
sage: Polyhedron([[0,0],[1,a],[0,2*a],[-1,-a]], base_ring=K)   # should use normaliz
```

  This would be enough to generate any of the regular polytope examples exactly (including the 600 cells) that could go in the SageMath database `polytopes.`.
2. (follow-up ticket) When the input are elements in `AA`, or symbolic algebraic, etc, try to figure out how to convert stuff into an embedded number field


---

Comment by vdelecroix created at 2019-04-18 19:56:20

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-04-23 02:26:30

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2019-04-23 02:32:25

I have updated this ticket for 8.8.beta3. Still using the old Normaliz/QNormaliz/PyNormaliz/PyQNormaliz etc., 
but merged in #20181. 
3 doctest failures.


---

Comment by git created at 2019-04-23 02:55:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-04-23 08:32:52

Replying to [comment:76 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[7c3d64c](https://git.sagemath.org/sage.git/commit/?id=7c3d64c8a12275511f3d3875d37f48d3cb6857ec)||`Fix up for exact snub cube construction`||

Just a small heads-up about #26340 that will conflict with this line.


---

Comment by mkoeppe created at 2019-04-23 13:32:22

#27716 has all the backend work that does not depend on the algebraic stuff.


---

Comment by mkoeppe created at 2019-04-23 13:35:25

I will next redo this ticket on top of #27716, #26340, #27682, #20181.


---

Comment by git created at 2019-04-23 15:54:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2019-04-23 15:57:16

Replying to [comment:79 mkoeppe]:
> I will next redo this ticket on top of #27716, #26340, #27682, #20181.
Done. Replaced the branch.
Many doctests fail. Needs fixing: https://github.com/Normaliz/PyNormaliz/issues/37


---

Comment by git created at 2019-04-23 21:35:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-04-23 21:36:20

All tests work now except for one that needs a fix for this: https://github.com/Normaliz/PyNormaliz/issues/41


---

Comment by mkoeppe created at 2019-04-24 15:37:35

With Normaliz master (unreleased), all tests pass except for the broken snub cube example from #26340.


---

Comment by git created at 2019-04-24 18:05:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-25 07:49:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-25 14:15:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-25 14:37:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-25 14:40:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-04-25 15:36:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-04-25 15:39:50

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2019-04-25 15:39:50

Ready for review. Builds and tests OK on macOS Mojave.


---

Comment by jipilab created at 2019-04-25 15:49:06

Builds on debian stretch.


```
$ sage -t sage/src/sage/geometry/polyhedron/*.py --optional=bliss,dochtml,gfortran,lrslib,memlimit,mpir,ninja_build,normaliz,pynormaliz,python2,sage,topcom
too few successful tests, not using stored timings
Git branch: 25097
Using --optional=bliss,dochtml,gfortran,lrslib,memlimit,mpir,ninja_build,normaliz,pynormaliz,python2,sage,topcom
Doctesting 25 files.
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

Comment by git created at 2019-04-25 17:56:44

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2019-04-25 17:58:30

Merged #25091, works fine after minor changes.


---

Comment by git created at 2019-04-26 12:49:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-26 14:44:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-27 17:13:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-04-30 07:23:51

An error in convex hull?


---

Attachment

That error was caused by using an old PyNormaliz.


---

Comment by git created at 2019-05-01 11:28:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-01 17:53:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-02 20:01:42

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by jipilab created at 2019-05-03 10:01:55

Here is an error happening while coercing the values back into the given base ring (`UCF` in this case):


```
sage: W = CoxeterGroup(['I',8])
sage: n = W.one().canonical_matrix().rank()
sage: weights = W.fundamental_weights()
sage: point = [ZZ.one()] * n
sage: apex = sum(point[i-1] * weights[i] for i in weights.keys())
sage: non_zero_index = list(apex).index(filter(lambda x: x!=0, apex)[0])
sage: apex = (QQ(1)/apex[non_zero_index]) * apex
sage: apex.set_immutable()
sage: vertices = set()
sage: br = apex.base_ring()
sage: for w in W:
....:     new_point = w * apex
....:     new_point.set_immutable()
....:     vertices.add(new_point)
....:     
sage: Polyhedron(vertices=vertices, backend='normaliz', base_ring=br,verbose=True)
Traceback (most recent call last):
...
TypeError: -1 of type <type 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute'> not valid to initialize an element of the universal cyclotomic field
```



---

Comment by mkoeppe created at 2019-05-03 12:59:01

Unfortunately both of the following conversions fail:

```
UniversalCyclotomicField()(AA(-1))
TypeError: -1 of type <class 'sage.rings.qqbar.AlgebraicReal'> not valid to initialize an element of the universal cyclotomic field
```

and

```
sage: K.<sqrt2> = QuadraticField(2)
sage: UniversalCyclotomicField()(K(-1))
TypeError: -1 of type <type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'> not valid to initialize an element of the universal cyclotomic field
```



---

Comment by mkoeppe created at 2019-05-03 13:01:02

This should be a separate ticket


---

Comment by git created at 2019-05-08 19:55:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-05-17 13:05:35

There are python3 issues, pyflakes conventions issues, `:::` issues, and 2 missing doctests in `backend_normaliz.py`, see patchbot for more details.

From a recent bot, there are the following files that have failing doctests (seems like the optional hashtag is missing):


```
sage -t --long src/sage/geometry/polyhedron/backend_normaliz.py  # 11 doctests failed
sage -t --long src/doc/en/thematic_tutorials/geometry/polyhedra_tutorial.rst  # 2 doctests failed
```



---

Comment by jipilab created at 2019-05-17 13:05:35

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-05-17 18:59:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-05-17 19:05:12

Merged in latest version of #25091 and current beta.


---

Comment by git created at 2019-05-17 21:28:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-05-17 21:29:28

Setting it back to needs_review to get a fresh patchbot run.


---

Comment by mkoeppe created at 2019-05-17 21:29:28

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-05-17 21:31:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-05-18 03:06:17

Replying to [comment:104 jipilab]:
> Here is an error happening while coercing the values back into the given base ring (`UCF` in this case):

Should we actually allow a complex field such as UCF as the base ring of a polyhedron?


---

Comment by git created at 2019-05-18 13:41:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-18 13:47:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-18 13:49:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-18 14:25:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-18 21:45:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-05-19 09:44:40

Replying to [comment:115 mkoeppe]:
> Replying to [comment:104 jipilab]:
> > Here is an error happening while coercing the values back into the given base ring (`UCF` in this case):
> 
> Should we actually allow a complex field such as UCF as the base ring of a polyhedron? 

Not sure. I remember I was not so happy about allowing real algebraic numbers that have a complex parent into polyhedron: it makes things quite intricate in designing the constructor.

The situation before this ticket was not allowing anything inside of `SymbolicRing` for example, and this would also do the same for `UCF` is the backend field was not given (or perhaps there was an effort to check if one can coerce it in `AA`)... Now, since we accept things that are in the symbolic ring if it is possible to coerce it into an embedded number field... I feel like it would be nice to accept elements of `UCF` if they are real... I remember I had to tweak #20181  so that it would manage to coerce real algebraic numbers even though they are elements of a complex ring.

That said, I would say that the answer should be 'No' (as far as I understand, complex polyhedra are not really well-defined, or are they?). So, this would be an exception to the idea "give back a common parent to the elements given by the user and use it as base ring". I guess the rule should be bound to ultimately "stay real".

So there could be a check to see if the user provided elements from a complex ring (although they are indeed real) and do the appropriate steps to give a real base ring. I do not know how hard implementing this here.


---

Comment by jipilab created at 2019-05-22 16:18:19

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2019-05-22 16:18:19

There are two doctest failing in the tutorials (coming from changing an error message):


```
----------------------------------------------------------------------
sage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed
sage -t --long src/sage/graphs/generic_graph.py  # 1 doctest failed
sage -t --long src/doc/en/thematic_tutorials/geometry/polyhedra_tutorial.rst  # 2 doctests failed
----------------------------------------------------------------------
```


The first two might be spurious errors, but maybe they come from employing polyhedra...


---

Comment by jipilab created at 2019-05-22 16:20:45

Replying to [comment:123 jipilab]:
> There are two doctest failing in the tutorials (coming from changing an error message):
> 
> {{{
> ----------------------------------------------------------------------
> sage -t --long src/sage/sat/boolean_polynomials.py  # 1 doctest failed
> sage -t --long src/sage/graphs/generic_graph.py  # 1 doctest failed
> sage -t --long src/doc/en/thematic_tutorials/geometry/polyhedra_tutorial.rst  # 2 doctests failed
> ----------------------------------------------------------------------
> }}}
> 
> The first two might be spurious errors, but maybe they come from employing polyhedra...

Actually, there is some dirt in the traceback for the errors on the branch. Most probably this is the cause of the breaking doctests...


---

Comment by git created at 2019-05-23 01:35:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-05-23 01:36:39

Fixed the doctest and merged in the newest beta.


---

Comment by mkoeppe created at 2019-05-23 01:36:39

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2019-06-07 19:02:54

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2019-06-07 19:02:54

There is 1 doctest failing because of #21161. :-/


---

Comment by jipilab created at 2019-06-11 19:28:04

Now with #27965, we may get a conflict in snub dodecahedron. I was not quick enough to warn about it on the ticket #27965 about the current one...


---

Comment by jipilab created at 2019-06-12 07:55:12

#27965 should be merged into this ticket to avoid yet another conflict.

The other ticket allows to "whitelist" geometry for py3, probably asap for it to be in the next release.

... that said, I would also like to see this ticket in the next release so that we can move on to further enrich normaliz' interfacing...


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by git created at 2019-06-19 21:54:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-06-19 21:55:34

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2019-06-21 09:57:18

Looks good to me now. I would say this is ready and I would put it as positive review, with Vincent also as a reviewer too.

`@`Vincent: Let us know if you agree. It would be good to know if there are last things to be aware of.


---

Comment by jipilab created at 2019-07-05 07:21:09

ping!

Any last comments Vincent?


---

Comment by chapoton created at 2019-07-07 09:40:19

doctest failure in /library with py3


---

Comment by chapoton created at 2019-07-07 09:40:19

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-07-08 19:38:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-07-08 19:38:45

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-07-11 13:55:34

The last changes looks reasonable to me.


---

Comment by jipilab created at 2019-07-16 16:02:07

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2019-07-16 16:02:07

It looks good to me too. I set it to positive review.

Just a FYI: if there are any other comments, next week is the Sage days in Bonn and vdelecroix and me are going to be available to work on follow-ups if need be.


---

Comment by vbraun created at 2019-07-18 21:02:39

Resolution: fixed
