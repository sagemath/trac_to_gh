# Issue 28468: Fix conversion of Booleans in interfaces

Issue created by migration from https://trac.sagemath.org/ticket/28705

Original creator: @mwageringel

Original creation time: 2019-11-07 20:36:01

This ticket deals with several issues related to the conversion of Booleans from Sage to Pexpect interfaces and back.


## Conversion from Sage to interfaces

This fails for several interfaces, those in which Booleans are not represented by integers 0 and 1.

```
sage: giac._true_symbol()
'true'
sage: giac('true')
true
sage: giac(True)  # should be true
1
```

This happens because `bool` is a subtype of `int`, which is not accounted for in the conversion routine in the parent class `Interface`. This can be fixed in `interfaces/interface.py` for all the affected interfaces, which are at least: Gap, Giac, FriCAS, Lisp, Macaulay2, Mathematica, Maxima, R (and possibly Magma, Maple, Kash).

## Conversion from interfaces to Sage

This seems to be the responsibility of each individual interface. This ticket only deals with some of them.

- Giac, Mathematica and Maxima use Pynac for converting symbols to Sage, so this ticket registers `True` and `False` in the symbol table for them. I put the relevant code in `sage/symbolic/constants.py`, mainly due to lack of a better place. Booleans are not really symbolic mathematical constants – I hope this change still makes sense.

- The parent class `InterfaceElement` defines a method `bool()` for converting elements to type `bool`, as well as methods `__bool__()` and `__nonzero__()` which are effectively aliases for `bool()`. What exactly these return differs with each interface, but often it is not clearly specified. Some interfaces test whether an element is `True` and otherwise always return `False`, others test for non-zeroness, in part for historic reasons.

  It appears safe to assume that `bool()` should at least convert Booleans correctly from an interface to Sage, so I adjusted the implementation for some interfaces where this seemed to be a problem: Lisp, Maxima, Macaulay2 and Mathematica. I do not have much experience with Lisp and Maxima, so am not sure how useful this change is for them.

- I changed the default implementation of `InterfaceElement.bool()` so that it tests whether an element is not `False` rather than `True`, solely to make it less surprising and more pythonic when applied to elements that are not Booleans. For example:

```
giac('"a"')  # previously this returned false
true
```


- Some interfaces only overwrite `__bool__()`, causing it to return different results than `bool()`. This ticket renames all of them to `bool()` to make things consistent. A possibly more preferable solution could be to deprecate `bool()` in order to get rid of the duplication.

  I did not change this for Magma, as it would require non-trivial changes I cannot test, nor for FriCAS, as I do not know how to implement it. Note that the following still fails as it attempts a non-zeroness test on a boolean:
  {{{
  sage: bool(fricas(True))  # error
  sage: bool(fricas(False))  # error
  }}}




---

Comment by @mwageringel created at 2019-11-07 21:37:39

Changing keywords from "" to "macaulay2, mathematica, fricas, r".


---

Comment by @mwageringel created at 2019-11-07 21:37:39

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2019-11-07 21:37:39

With this branch, all tests including some optional interfaces pass on my end:


```
./sage -bt -l -p 8 --optional=sage,macaulay2,mathematica,fricas --logfile=logs/ptestlongopt.log src/sage
```


This test to check the conversions explicitly passes as well:


```
from sage.interfaces.all import *
assert all((repr(s(True)) == s._true_symbol() and
            repr(s(False)) == s._false_symbol() and
            s(True).bool() is True and
            s(False).bool() is False) for s in [gap, giac, gp, lisp, macaulay2, mathematica, maxima, r, fricas])
```


The changes related to optional interfaces are in separate commits, so they could be moved to separate tickets if preferred.
----
New commits:


---

Comment by vdelecroix created at 2019-11-11 15:13:56

`__bool__` is the Python converter to boolean, see [Python documentation](https://docs.python.org/3/reference/datamodel.html#object.__bool__) (and `__nonzero__` is the one in Python 2). I don't understand why you would remove it. Without it, the following would not work properly.

```
if my_object:   # implicit call to __bool__
   ...
```



---

Comment by vdelecroix created at 2019-11-11 15:13:56

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2019-11-11 15:15:25

It would make more sense to implement `__bool__` in each subclass (faster) and make `bool` an alias.


---

Comment by vdelecroix created at 2019-11-11 15:15:45

And not even an alias but

```
def bool(self):
    return bool(self)
```



---

Comment by @mwageringel created at 2019-11-11 22:02:54

That is a good point. I merely followed what was laid out in the superclass `InterfaceElement`: it defines the method `bool` and implements `__bool__` by redirecting to it, so overriding `bool` rather than `__bool__` in the subclasses seemed natural at first.

Though I agree that it would be better to do it the other way around, as you suggested. In the long run, this would also make it easier to deprecate the method `bool` which is redundant in my opinion. I will update the branch accordingly.


---

Comment by git created at 2019-11-15 22:13:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mwageringel created at 2019-11-15 22:28:12

Changing status from needs_info to needs_review.


---

Comment by @mwageringel created at 2019-11-15 22:28:12

I have updated the branch as suggested, that is:
• in `InterfaceElement`, `bool()` is now a wrapper for `__bool__()`,
• in the subclasses, `bool()` was renamed to `__bool__()` and `__nonzero__` was added where applicable.
Everything else has stayed the same.


---

Comment by vdelecroix created at 2019-11-25 15:56:51

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2019-11-25 18:30:37

Thanks.


---

Comment by vbraun created at 2019-11-28 21:53:04

Resolution: fixed
