# Issue 10598: Small fix in `_an_element_from_iterator` in EnumeratedSets

Issue created by migration from https://trac.sagemath.org/ticket/10651

Original creator: nborie

Original creation time: 2011-01-18 12:26:14

Assignee: nborie

CC:  sage-combinat

Keywords: empty set, EmptySetError

As Florent Hivert gave extremely useful features about empty things, we should use it. The Following should returns an EmptySetError

```
sage: S = Set([])
sage: S.an_element()
---------------------------------------------------------------------------
StopIteration                             Traceback (most recent call last)

/opt/sage/devel/sage-combinat/<ipython console> in <module>()

/opt/sage/local/lib/python2.6/site-packages/sage/misc/cachefunc.pyc in __call__(self, *args, **kwds)
    329             2
    330          """
--> 331         return self._cachedmethod._instance_call(self._instance, *args, **kwds)
    332 
    333     def get_cache(self, *args, **kwds):

/opt/sage/local/lib/python2.6/site-packages/sage/misc/cachefunc.pyc in _instance_call(self, inst, *args, **kwds)
    473             return cache[key]
    474         else:
--> 475             cache[key] = self._cachedfunc.f(inst, *args, **kwds)
    476             return cache[key]
    477 

/opt/sage/local/lib/python2.6/site-packages/sage/categories/enumerated_sets.pyc in _an_element_from_iterator(self)
    470             """
    471             it = self.__iter__()
--> 472             return it.next()
    473 
    474         # Should this be implemented from first instead?

StopIteration: 
sage: 
```



---

Comment by nborie created at 2011-01-18 13:00:13

Changing status from new to needs_review.


---

Comment by slelievre created at 2011-01-18 15:10:34

Changing keywords from "empty set, EmptySetError" to "days28, empty set, EmptySetError".


---

Comment by robertwb created at 2011-01-27 05:59:11

Technically, some_elements should return an iterable, not an iterator, so you can iterate over it more than once. The except clause should be changed to return [], not return iter([]), though with the empty case the behavior is the same.


---

Comment by nborie created at 2011-01-27 07:54:36

Good point. I will ask today Nicolas what does he think about that... I don't really know the specifications for the Test Suite and how deal exactly with such corner case.
Florent did this with FiniteEnumeratedSet (The user know a priori that the set is finite...)

```
sage: FiniteEnumeratedSet([])
{}
sage: FiniteEnumeratedSet([]).some_elements()
<generator object _some_elements_from_iterator at 0xb433464>
```

I will give an answer shortly for that.


---

Comment by nborie created at 2011-01-31 08:11:38

As this ticket fix a corner case and try to increase of the coherence for the code about sets, it have to verify all the specifications. Thanks you very much Robert for pointing this. It now return []. Even the behavior is the same, I don't want to fix a mathematical corner case by introducing a Spec corner case...

It should be ready for review now.


---

Comment by zimmerma created at 2011-02-08 09:09:28

I confirm the problem is fixed, and all doctests still pass.
Thus I give a positive review.

Paul


---

Comment by zimmerma created at 2011-02-08 09:09:28

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-02-08 09:21:20

I think you should add an example which shows the `EmptySetError`.


---

Comment by jdemeyer created at 2011-02-08 09:21:20

Changing status from positive_review to needs_work.


---

Comment by nborie created at 2011-02-08 10:53:58

Changing status from needs_work to needs_review.


---

Comment by nborie created at 2011-02-08 10:53:58

I just had two tests... Especially one which returns the EmptySetError... Thanks all for your comments and suggestions.


---

Comment by zimmerma created at 2011-02-08 13:22:13

after thought, the on-line documentation of `S.an_element` should mention that if `S` is
empty, an `EmptySetError` is returned.

Paul


---

Comment by zimmerma created at 2011-02-08 13:22:13

Changing status from needs_review to needs_work.


---

Comment by nborie created at 2011-02-16 11:16:52

Changing status from needs_work to needs_review.


---

Comment by robertwb created at 2011-02-18 00:01:52

Changing status from needs_review to positive_review.


---

Comment by robertwb created at 2011-02-18 00:01:52

Looking good now.


---

Comment by jdemeyer created at 2011-03-17 19:43:11

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-03-17 19:43:11

You should change the commit message of the patch (using `hg qrefresh -e`) to something sensible, making sure the ticket number appears on the first line of the commit message.


---

Attachment

In order to fix more things in the same time, I update the description of this ticket. I folded the NT'reviewer from the sage-combinat queue, then I uploaded the patch with a better commit message.

I am very OK with the changes in the Parent structure from Nicolas Thi√©ry. I give a positive review on all changes touching the corresponding file. The first part of the patch still comes from me, so no review from me.


---

Comment by nborie created at 2011-03-21 16:27:05

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2011-03-21 16:46:07

Changing status from needs_review to positive_review.


---

Comment by nthiery created at 2011-03-21 16:46:07

And positive review on your part. Good to go!


---

Comment by jdemeyer created at 2011-03-24 20:39:41

Resolution: fixed
