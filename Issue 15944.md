# Issue 15944: inject_shorthands broken since 6.2beta8

archive/issues_015944.json:
```json
{
    "body": "CC:  @nthiery @vbraun\n\nKeywords: globals, inject_shorthands, regression,\n\n\n```\nsage: NSym = NonCommutativeSymmetricFunctions(QQ)\nsage: NSym.inject_shorthands()\nInjecting S as shorthand for Non-Commutative Symmetric Functions over the Rational Field in the Complete basis\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-2-458277a04544> in <module>()\n----> 1 NSym.inject_shorthands()\n\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/categories/sets_cat.pyc in inject_shorthands(self, verbose)\n   1318                     if verbose:\n   1319                         print 'Injecting %s as shorthand for %s'%(shorthand, realization)\n-> 1320                     inject_variable(shorthand, realization)\n   1321 \n   1322             def realizations(self):\n\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/misc.pyc in inject_variable(name, value)\n   2356     # inject_variable is called not only from the interpreter, but\n   2357     # also from functions in various modules.\n-> 2358     G = get_main_globals()\n   2359     if name in G:\n   2360         warn(\"redefining global value `%s`\"%name, RuntimeWarning, stacklevel = 2)\n\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/misc.pyc in get_main_globals()\n   2312     while True:\n   2313         G = sys._getframe(depth).f_globals\n-> 2314         if G[\"__name__\"] == \"__main__\" and G[\"__package__\"] is None:\n   2315             break\n   2316         depth += 1\n\nKeyError: '__package__'\n```\n\n\nSame for Sym and QSym.\n\nThe `get_main_globals` method hasn't been changed since 2011, so I suspect something else is at fault. The attached branch gets rid of the bug, but I don't understand the code at hand and so it is not really merge-ready. Needs_review is to increase visibility.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16181\n\n",
    "created_at": "2014-04-17T22:30:26Z",
    "labels": [
        "component: misc",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "inject_shorthands broken since 6.2beta8",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15944",
    "user": "https://github.com/darijgr"
}
```
CC:  @nthiery @vbraun

Keywords: globals, inject_shorthands, regression,


```
sage: NSym = NonCommutativeSymmetricFunctions(QQ)
sage: NSym.inject_shorthands()
Injecting S as shorthand for Non-Commutative Symmetric Functions over the Rational Field in the Complete basis
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-2-458277a04544> in <module>()
----> 1 NSym.inject_shorthands()

/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/categories/sets_cat.pyc in inject_shorthands(self, verbose)
   1318                     if verbose:
   1319                         print 'Injecting %s as shorthand for %s'%(shorthand, realization)
-> 1320                     inject_variable(shorthand, realization)
   1321 
   1322             def realizations(self):

/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/misc.pyc in inject_variable(name, value)
   2356     # inject_variable is called not only from the interpreter, but
   2357     # also from functions in various modules.
-> 2358     G = get_main_globals()
   2359     if name in G:
   2360         warn("redefining global value `%s`"%name, RuntimeWarning, stacklevel = 2)

/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/misc.pyc in get_main_globals()
   2312     while True:
   2313         G = sys._getframe(depth).f_globals
-> 2314         if G["__name__"] == "__main__" and G["__package__"] is None:
   2315             break
   2316         depth += 1

KeyError: '__package__'
```


Same for Sym and QSym.

The `get_main_globals` method hasn't been changed since 2011, so I suspect something else is at fault. The attached branch gets rid of the bug, but I don't understand the code at hand and so it is not really merge-ready. Needs_review is to increase visibility.

Issue created by migration from https://trac.sagemath.org/ticket/16181





---

archive/issue_comments_206713.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-17T22:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206713",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_206714.json:
```json
{
    "body": "Oh, and apparently importing any(!) sage file beforehand keeps the bug from happening. Here is an example that does not throw errors:\n\n```\nsage: import sage.combinat.permutation\nsage: NSym = NonCommutativeSymmetricFunctions(QQ)\nsage: NSym.inject_shorthands()\n```\n",
    "created_at": "2014-04-17T22:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206714",
    "user": "https://github.com/darijgr"
}
```

Oh, and apparently importing any(!) sage file beforehand keeps the bug from happening. Here is an example that does not throw errors:

```
sage: import sage.combinat.permutation
sage: NSym = NonCommutativeSymmetricFunctions(QQ)
sage: NSym.inject_shorthands()
```




---

archive/issue_comments_206715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-18T01:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206716.json:
```json
{
    "body": "Just doing\n\n```\nsage: sage.misc.misc.inject_variable('a', 0)\n```\n\n(before an import) is enough to cause the error. If I had to make a WAG, I'd say it's the IPython upgrade. I've added this as a doctest, so if you're happy this (and I'm okay with fixing the symptoms), positive review.",
    "created_at": "2014-04-18T02:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206716",
    "user": "https://github.com/tscrim"
}
```

Just doing

```
sage: sage.misc.misc.inject_variable('a', 0)
```

(before an import) is enough to cause the error. If I had to make a WAG, I'd say it's the IPython upgrade. I've added this as a doctest, so if you're happy this (and I'm okay with fixing the symptoms), positive review.



---

archive/issue_comments_206717.json:
```json
{
    "body": "Unfortunately this doctest works even without the patch :(\n\nAnd moving it to the very front of the file doesn't help either...",
    "created_at": "2014-04-18T02:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206717",
    "user": "https://github.com/darijgr"
}
```

Unfortunately this doctest works even without the patch :(

And moving it to the very front of the file doesn't help either...



---

archive/issue_comments_206718.json:
```json
{
    "body": "Oops, sorry for removing you from cc, Volker (I really should report this as a trac bug -- I started writing my post before you made yours -- but I'm too lazy).",
    "created_at": "2014-04-18T02:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206718",
    "user": "https://github.com/darijgr"
}
```

Oops, sorry for removing you from cc, Volker (I really should report this as a trac bug -- I started writing my post before you made yours -- but I'm too lazy).



---

archive/issue_comments_206719.json:
```json
{
    "body": "Hmm...there must be something going on within the doctesting framework that prevents this from begin executed before any imports. We can leave it in there as a human warning, but honestly noone is really going to look at that test (much less run it manually)...",
    "created_at": "2014-04-18T02:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206719",
    "user": "https://github.com/tscrim"
}
```

Hmm...there must be something going on within the doctesting framework that prevents this from begin executed before any imports. We can leave it in there as a human warning, but honestly noone is really going to look at that test (much less run it manually)...



---

archive/issue_comments_206720.json:
```json
{
    "body": "BTW: when I do `sys._getframe(0).f_globals`, I get the following cruft:\n\n\n```\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.elementary.<tab> instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.AlcovePath instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.FastRankTwo instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.infinity.Tableaux instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.TensorProductOfKirillovReshetikhinTableaux instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.KyotoPathModel instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.Letters instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.DirectSum instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.KirillovReshetikhin with model='KR' instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.KirillovResetikhin instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.HighestWeight instead\nSee http://trac.sagemath.org/15882 for details.\n  exec code_obj in self.user_global_ns, self.user_ns\n/home/darij/gitsage6.2/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/core.py:14: ImportWarning: Not importing directory '/home/darij/gitsage6.2/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py\n  from babel import localedata\n```\n\n\nAnd this is just the error output. Here is the actual dictionary: https://www.dropbox.com/s/6hzuqm6jf9jo9jt/outtext.txt\n\nI can't believe this all needs to be in the globals?",
    "created_at": "2014-04-18T02:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206720",
    "user": "https://github.com/darijgr"
}
```

BTW: when I do `sys._getframe(0).f_globals`, I get the following cruft:


```
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.elementary.<tab> instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.AlcovePath instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.FastRankTwo instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.infinity.Tableaux instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.TensorProductOfKirillovReshetikhinTableaux instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.KyotoPathModel instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.Letters instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.DirectSum instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.KirillovReshetikhin with model='KR' instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.KirillovResetikhin instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2834: DeprecationWarning: this is being removed from the global namespace. Use crystals.HighestWeight instead
See http://trac.sagemath.org/15882 for details.
  exec code_obj in self.user_global_ns, self.user_ns
/home/darij/gitsage6.2/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/core.py:14: ImportWarning: Not importing directory '/home/darij/gitsage6.2/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py
  from babel import localedata
```


And this is just the error output. Here is the actual dictionary: https://www.dropbox.com/s/6hzuqm6jf9jo9jt/outtext.txt

I can't believe this all needs to be in the globals?



---

archive/issue_comments_206721.json:
```json
{
    "body": "Those deprecations are from #15882 (ex. `CrystalOfTableaux`) where I used #14275 to (lazily) import them with a deprecation message and there was no good alternative that I could find (because I didn't want to write some 20 functions where all they did was deprecate something with a [semi]specific message). Moreover, I'd be surprised if they had any bearing on this issue.",
    "created_at": "2014-04-18T02:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206721",
    "user": "https://github.com/tscrim"
}
```

Those deprecations are from #15882 (ex. `CrystalOfTableaux`) where I used #14275 to (lazily) import them with a deprecation message and there was no good alternative that I could find (because I didn't want to write some 20 functions where all they did was deprecate something with a [semi]specific message). Moreover, I'd be surprised if they had any bearing on this issue.



---

archive/issue_comments_206722.json:
```json
{
    "body": "Yeah, I now see it's pretty much orthogonal to what we're doing here. Good to know we've got a `delsarte_bound_additive_hamming_space` function in our global namespace, though :)",
    "created_at": "2014-04-18T02:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206722",
    "user": "https://github.com/darijgr"
}
```

Yeah, I now see it's pretty much orthogonal to what we're doing here. Good to know we've got a `delsarte_bound_additive_hamming_space` function in our global namespace, though :)



---

archive/issue_comments_206723.json:
```json
{
    "body": "From `sage/doctest/forker.py`:\n\n\n```\n                # Make the right set of globals available to doctests\n                if basename.startswith(\"sagenb.\"):\n                    import sage.all_notebook as sage_all\n                else:\n                    import sage.all_cmdline as sage_all\n                sage_namespace = RecordingDict(sage_all.__dict__)\n                sage_namespace['__name__'] = '__main__'\n                sage_namespace['__package__'] = None\n                doctests, extras = self.source.create_doctests(sage_namespace)\n                timer = Timer().start()\n```\n\n\nI'm wondering if we should just axe the line with the `__package__` here?",
    "created_at": "2014-04-18T02:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206723",
    "user": "https://github.com/darijgr"
}
```

From `sage/doctest/forker.py`:


```
                # Make the right set of globals available to doctests
                if basename.startswith("sagenb."):
                    import sage.all_notebook as sage_all
                else:
                    import sage.all_cmdline as sage_all
                sage_namespace = RecordingDict(sage_all.__dict__)
                sage_namespace['__name__'] = '__main__'
                sage_namespace['__package__'] = None
                doctests, extras = self.source.create_doctests(sage_namespace)
                timer = Timer().start()
```


I'm wondering if we should just axe the line with the `__package__` here?



---

archive/issue_comments_206724.json:
```json
{
    "body": "OK, axing doesn't work, since this line is there to undo the (apparently Sphinx-specific) setting of `__package__` to `sage`. Let me try `del`...",
    "created_at": "2014-04-18T02:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206724",
    "user": "https://github.com/darijgr"
}
```

OK, axing doesn't work, since this line is there to undo the (apparently Sphinx-specific) setting of `__package__` to `sage`. Let me try `del`...



---

archive/issue_comments_206725.json:
```json
{
    "body": "EDIT: ignore this post.",
    "created_at": "2014-04-18T02:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206725",
    "user": "https://github.com/darijgr"
}
```

EDIT: ignore this post.



---

archive/issue_comments_206726.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-04-18T02:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206726",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_206727.json:
```json
{
    "body": "OK, forget about the second branch; I've just hijacked the main branch with what I think is a full solution. Warning: forced push!",
    "created_at": "2014-04-18T02:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206727",
    "user": "https://github.com/darijgr"
}
```

OK, forget about the second branch; I've just hijacked the main branch with what I think is a full solution. Warning: forced push!



---

archive/issue_comments_206728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-18T04:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206729.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-19T06:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206729",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_206730.json:
```json
{
    "body": "LGTM.",
    "created_at": "2014-04-19T06:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206730",
    "user": "https://github.com/tscrim"
}
```

LGTM.



---

archive/issue_comments_206731.json:
```json
{
    "body": "Thank you, Travis!!\n\n*blush* I guess I really should start reviewing...",
    "created_at": "2014-04-19T06:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206731",
    "user": "https://github.com/darijgr"
}
```

Thank you, Travis!!

*blush* I guess I really should start reviewing...



---

archive/issue_comments_206732.json:
```json
{
    "body": "* Can we not leave commented-out lines lying around?\n\n* IMHO the check should just be \n  {{{\n  if G.get(\"__name__\", None) == \"__main__\":\n  }}}\n  and not look at `__package__`. The topmost `'__main__'` frame is our guy, duh. Also this won't trip over similar issues if some frame doesn't have `__name__`.\n\n* The new doctest is just like doctests that we already have, it doesn't add anything new.",
    "created_at": "2014-04-19T23:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206732",
    "user": "https://github.com/vbraun"
}
```

* Can we not leave commented-out lines lying around?

* IMHO the check should just be 
  {{{
  if G.get("__name__", None) == "__main__":
  }}}
  and not look at `__package__`. The topmost `'__main__'` frame is our guy, duh. Also this won't trip over similar issues if some frame doesn't have `__name__`.

* The new doctest is just like doctests that we already have, it doesn't add anything new.



---

archive/issue_comments_206733.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2014-04-19T23:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206733",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_206734.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-19T23:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206734",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-19T23:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206736.json:
```json
{
    "body": "ad 1: True; that was a habit from pre-git times. Removed.\n\nad 2: I have changed it now but I'm not 100% sure (what happens if we are doctesting a package?). I don't have time to run all the doctests now...\n\nad 3: I can't follow this. It is import-less and it stands at the beginning of the file. At least the first of these properties is crucial!",
    "created_at": "2014-04-19T23:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206736",
    "user": "https://github.com/darijgr"
}
```

ad 1: True; that was a habit from pre-git times. Removed.

ad 2: I have changed it now but I'm not 100% sure (what happens if we are doctesting a package?). I don't have time to run all the doctests now...

ad 3: I can't follow this. It is import-less and it stands at the beginning of the file. At least the first of these properties is crucial!



---

archive/issue_comments_206737.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-04-20T00:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206737",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_events_047669.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-20T23:37:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15944#event-47669"
}
```



---

archive/issue_comments_206738.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-20T23:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15944#issuecomment-206738",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
