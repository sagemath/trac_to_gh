# Issue 32795: pipe leak in doctest/forker.py

Issue created by migration from https://trac.sagemath.org/ticket/33032

Original creator: thansen

Original creation time: 2021-12-16 15:32:31

CC:  jhpalmieri

Hi,

earlier this year I had a lot of trouble because doctest/forker.py was leaking pipes to the point that it was reaching the file handle limit.

I reported this here:
https://groups.google.com/g/sage-packaging/c/1G_3JiIcbvY

It was eventually fixed with a patch here:
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=986527#111

I'm not sure why nobody else seems to have this issue, but could the patch be applied here?

Best,
Tobias


---

Comment by mkoeppe created at 2021-12-16 20:00:47

Could you put the patch on a branch please?

I do frequently see "Too many open files" errors when running parallel tests on macOS.


---

Comment by thansen created at 2021-12-17 08:10:42

Changing status from new to needs_review.


---

Comment by thansen created at 2021-12-17 08:10:42

New commits:


---

Comment by mkoeppe created at 2021-12-18 01:34:52

Changing priority from major to critical.


---

Comment by mkoeppe created at 2021-12-18 01:34:52

This seems to work well


---

Comment by mkoeppe created at 2021-12-18 01:34:52

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-12-23 20:26:16

Resolution: fixed
