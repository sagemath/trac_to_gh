# Issue 31655: Conic parametrization broken

archive/issues_031655.json:
```json
{
    "body": "CC:  @mstreng @JohnCremona\n\n`src/sage/schemes/plane_conics/con_field.py` documents mathematically incorrect behavior:\n\n\n```\n            sage: c = Conic(GF(2), [1,1,1,1,1,0])\n            sage: c.parametrization()\n            (Scheme morphism:\n              From: Projective Space of dimension 1 over Finite Field of size 2\n              To:   Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y\n            + y^2 + x*z + y*z\n              Defn: Defined on coordinates by sending (x : y) to\n                    (x*y + y^2 : x^2 + x*y : x^2 + x*y + y^2),\n             Scheme morphism:\n              From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y\n            + y^2 + x*z + y*z\n              To:   Projective Space of dimension 1 over Finite Field of size 2\n              Defn: Defined on coordinates by sending (x : y : z) to\n                    (y : x))\n```\n\n\nThe second map is supposed to be an inverse, however it is not even well-defined (`(0 : 0 : 1)`). The correct inverse should be:\n`Defined on coordinates by sending (x : y : z) to (x + z : y + z)`\n\nThis is a perfect example how a simple sanity check\n\n```\nsage: f, g = c.parametrization()\nsage: (g*f).is_one()\n...\n```\n\nor similar can prevent things like this.\n\nOn the other hand, printed out information is not always checked by hand.\n\nThe bug is not limited to finite fields:\n\n\n```\nsage: R.<x,y,z> = QQ[]                                                                                                                                                              \nsage: C = Curve(7*x^2 + 2*y*z + z^2)                                                                                                                                                \nsage: f, g = C.parametrization(); f,g                                                                                                                                               \n(Scheme morphism:\n   From: Projective Space of dimension 1 over Rational Field\n   To:   Projective Conic Curve over Rational Field defined by 7*x^2 + 2*y*z + z^2\n   Defn: Defined on coordinates by sending (x : y) to\n         (-2*x*y : x^2 + 7*y^2 : -2*x^2),\n Scheme morphism:\n   From: Projective Conic Curve over Rational Field defined by 7*x^2 + 2*y*z + z^2\n   To:   Projective Space of dimension 1 over Rational Field\n   Defn: Defined on coordinates by sending (x : y : z) to\n         (-1/2*x : 1/7*y + 1/14*z))\nsage: (g*f).is_one()                                                                                                                                                                \nFalse\nsage: g([0, -1, 2])                                                                                                                                                                 \n...\nValueError: [0, 0] does not define a valid point since all entries are 0\nsage: p = g.domain().defining_polynomial()                                                                                                                                          \nsage: p([0, -1, 2])                                                                                                                                                                 \n0\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31892\n\n",
    "created_at": "2021-06-01T13:03:09Z",
    "labels": [
        "algebraic geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Conic parametrization broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31655",
    "user": "@kliem"
}
```
CC:  @mstreng @JohnCremona

`src/sage/schemes/plane_conics/con_field.py` documents mathematically incorrect behavior:


```
            sage: c = Conic(GF(2), [1,1,1,1,1,0])
            sage: c.parametrization()
            (Scheme morphism:
              From: Projective Space of dimension 1 over Finite Field of size 2
              To:   Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y
            + y^2 + x*z + y*z
              Defn: Defined on coordinates by sending (x : y) to
                    (x*y + y^2 : x^2 + x*y : x^2 + x*y + y^2),
             Scheme morphism:
              From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y
            + y^2 + x*z + y*z
              To:   Projective Space of dimension 1 over Finite Field of size 2
              Defn: Defined on coordinates by sending (x : y : z) to
                    (y : x))
```


The second map is supposed to be an inverse, however it is not even well-defined (`(0 : 0 : 1)`). The correct inverse should be:
`Defined on coordinates by sending (x : y : z) to (x + z : y + z)`

This is a perfect example how a simple sanity check

```
sage: f, g = c.parametrization()
sage: (g*f).is_one()
...
```

or similar can prevent things like this.

On the other hand, printed out information is not always checked by hand.

The bug is not limited to finite fields:


```
sage: R.<x,y,z> = QQ[]                                                                                                                                                              
sage: C = Curve(7*x^2 + 2*y*z + z^2)                                                                                                                                                
sage: f, g = C.parametrization(); f,g                                                                                                                                               
(Scheme morphism:
   From: Projective Space of dimension 1 over Rational Field
   To:   Projective Conic Curve over Rational Field defined by 7*x^2 + 2*y*z + z^2
   Defn: Defined on coordinates by sending (x : y) to
         (-2*x*y : x^2 + 7*y^2 : -2*x^2),
 Scheme morphism:
   From: Projective Conic Curve over Rational Field defined by 7*x^2 + 2*y*z + z^2
   To:   Projective Space of dimension 1 over Rational Field
   Defn: Defined on coordinates by sending (x : y : z) to
         (-1/2*x : 1/7*y + 1/14*z))
sage: (g*f).is_one()                                                                                                                                                                
False
sage: g([0, -1, 2])                                                                                                                                                                 
...
ValueError: [0, 0] does not define a valid point since all entries are 0
sage: p = g.domain().defining_polynomial()                                                                                                                                          
sage: p([0, -1, 2])                                                                                                                                                                 
0
```


Issue created by migration from https://trac.sagemath.org/ticket/31892





---

archive/issue_comments_452028.json:
```json
{
    "body": "There is an actual mathematical issue here.  The map from `P^2` to the conic is defined everywhere by a single triple of polynomials, but the map from the conic to `P^1` cannot be defined by a single pair.\n\nFor example the familiar easiest example `X^2 + Y^2 = Z^2`\n\nis parametrized by mapping `(u : v)` to\n\n`(x : y : z) = (u^2 - v^2 : 2 u v : u^2 + v^2)`,\n\nbut the reverse map is given by mapping `(x : y : z)` to\n\n`(u : v) = (x + z : y) = (y : z - x)`\n\nwhere\n\n- the first formula `(x + z : y)` is defined away from `(-1 : 0 : 1)`\n- and the second `(y : z - x)` away from `(1 : 0 : 1)`,\n- and where they are both defined they agree.\n\nThat's the way maps between curves works.\n\nMaps betwee (Sage) Schemes should be capable of being defined on patches like this.\n\nThe docstring for the method `parametrization()` does have the\n\n```\nWarning \"The second map is currently broken\nand neither the inverse nor well-defined.\"\n```\n\nwhich while not being grammatical does give a warning.",
    "created_at": "2021-07-08T08:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452028",
    "user": "@JohnCremona"
}
```

There is an actual mathematical issue here.  The map from `P^2` to the conic is defined everywhere by a single triple of polynomials, but the map from the conic to `P^1` cannot be defined by a single pair.

For example the familiar easiest example `X^2 + Y^2 = Z^2`

is parametrized by mapping `(u : v)` to

`(x : y : z) = (u^2 - v^2 : 2 u v : u^2 + v^2)`,

but the reverse map is given by mapping `(x : y : z)` to

`(u : v) = (x + z : y) = (y : z - x)`

where

- the first formula `(x + z : y)` is defined away from `(-1 : 0 : 1)`
- and the second `(y : z - x)` away from `(1 : 0 : 1)`,
- and where they are both defined they agree.

That's the way maps between curves works.

Maps betwee (Sage) Schemes should be capable of being defined on patches like this.

The docstring for the method `parametrization()` does have the

```
Warning "The second map is currently broken
and neither the inverse nor well-defined."
```

which while not being grammatical does give a warning.



---

archive/issue_comments_452029.json:
```json
{
    "body": "The inverse is correct in both examples at this ticket description, but the way it works in [SageMath](SageMath) is a little bit broken.\n\nHere's what I get in version 9.5. I'm using `paramatrization(P)` in order to replicate the ticket description's example, because `parametrization` is randomized if you don't specify a point.\n\n```\nsage: C = Conic(GF(2), [1,1,1,1,1,0])                                           \nsage: P = C([0,0,1])                                                            \nsage: (f, g) = C.parametrization(P); (f, g)                                     \n(Scheme morphism:\n   From: Projective Space of dimension 1 over Finite Field of size 2\n   To:   Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z\n   Defn: Defined on coordinates by sending (x : y) to\n         (x*y + y^2 : x^2 + x*y : x^2 + x*y + y^2),\n Scheme morphism:\n   From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z\n   To:   Projective Space of dimension 1 over Finite Field of size 2\n   Defn: Defined on coordinates by sending (x : y : z) to\n         (y : x))\nsage: g.representatives()                                                                       \n[Scheme morphism:\n   From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z\n   To:   Projective Space of dimension 1 over Finite Field of size 2\n   Defn: Defined on coordinates by sending (x : y : z) to\n         (y : x),\n Scheme morphism:\n   From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z\n   To:   Projective Space of dimension 1 over Finite Field of size 2\n   Defn: Defined on coordinates by sending (x : y : z) to\n         (x + y + z : y + z)]\nsage: g*f                                                                       \nScheme endomorphism of Projective Space of dimension 1 over Finite Field of size 2\n  Defn: Defined on coordinates by sending (x : y) to\n        (x^2 + x*y : x*y + y^2)\nsage: f*g                                                                       \nScheme endomorphism of Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z\n  Defn: Defined on coordinates by sending (x : y : z) to\n        (x^2 + x*y : x*y + y^2 : x^2 + x*y + y^2)\nsage: P1 = f.domain()\nsage: P1.hom(P1.gens(), P1) == g*f                             \nTrue\n```\n\nYou can see from the output of `representatives` that `g` really knows that the first formula is not defined at all points and hence there is a second formula stored inside `g`, which does work in `(0:0:1)`. This agrees with what John [comment:2 explained]. Moreover, we have `(x^2+xy : xy + y^2) = (x(x+y) : y(x+y)) = (x : y)`, so the output of `g*f` really is the identity map, and the same holds for `f*g`. So this is correct so far. Then the following is all incorrect:\n\n```\ng(P)\nValueError: [0, 0] does not define a valid point since all entries are 0\n(g*f).is_one()\nFalse\n(f*g).is_one()\nFalse\nsage: C.Hom(C).one() == f*g\nFalse\nsage: (x,y,z) = C.gens(); C.hom([x,y,z],C) == f*g                                                   \nFalse\n```\n\nSomething indeed needs to be done about this. The following indicates that we are very close.\n\n```\nsage: g.representatives()[1](P)\n(1 : 1)\nsage: (f*g).representatives()[0]                                                                \nScheme endomorphism of Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z\n  Defn: Defined on coordinates by sending (x : y : z) to\n        (x : y : z)\n```\n\nHere are some other things that don't work:\n\n```\nsage: (f*g).representatives()[0].is_one()\nFalse\nsage: C.Hom(C).one().is_one()\nTypeError: ...\nsage: (g*f).representatives()                                                                   \nAttributeError: ...\n```\n\nBut I don't know enough about the inner workings of [SageMath](SageMath) schemes to fix it.\n\nps. The warning [comment:2 mentioned] by John refers to this ticket, so there seems to be no reason to doubt the output of parametrization.",
    "created_at": "2022-03-29T18:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452029",
    "user": "@mstreng"
}
```

The inverse is correct in both examples at this ticket description, but the way it works in [SageMath](SageMath) is a little bit broken.

Here's what I get in version 9.5. I'm using `paramatrization(P)` in order to replicate the ticket description's example, because `parametrization` is randomized if you don't specify a point.

```
sage: C = Conic(GF(2), [1,1,1,1,1,0])                                           
sage: P = C([0,0,1])                                                            
sage: (f, g) = C.parametrization(P); (f, g)                                     
(Scheme morphism:
   From: Projective Space of dimension 1 over Finite Field of size 2
   To:   Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z
   Defn: Defined on coordinates by sending (x : y) to
         (x*y + y^2 : x^2 + x*y : x^2 + x*y + y^2),
 Scheme morphism:
   From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z
   To:   Projective Space of dimension 1 over Finite Field of size 2
   Defn: Defined on coordinates by sending (x : y : z) to
         (y : x))
sage: g.representatives()                                                                       
[Scheme morphism:
   From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z
   To:   Projective Space of dimension 1 over Finite Field of size 2
   Defn: Defined on coordinates by sending (x : y : z) to
         (y : x),
 Scheme morphism:
   From: Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z
   To:   Projective Space of dimension 1 over Finite Field of size 2
   Defn: Defined on coordinates by sending (x : y : z) to
         (x + y + z : y + z)]
sage: g*f                                                                       
Scheme endomorphism of Projective Space of dimension 1 over Finite Field of size 2
  Defn: Defined on coordinates by sending (x : y) to
        (x^2 + x*y : x*y + y^2)
sage: f*g                                                                       
Scheme endomorphism of Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z
  Defn: Defined on coordinates by sending (x : y : z) to
        (x^2 + x*y : x*y + y^2 : x^2 + x*y + y^2)
sage: P1 = f.domain()
sage: P1.hom(P1.gens(), P1) == g*f                             
True
```

You can see from the output of `representatives` that `g` really knows that the first formula is not defined at all points and hence there is a second formula stored inside `g`, which does work in `(0:0:1)`. This agrees with what John [comment:2 explained]. Moreover, we have `(x^2+xy : xy + y^2) = (x(x+y) : y(x+y)) = (x : y)`, so the output of `g*f` really is the identity map, and the same holds for `f*g`. So this is correct so far. Then the following is all incorrect:

```
g(P)
ValueError: [0, 0] does not define a valid point since all entries are 0
(g*f).is_one()
False
(f*g).is_one()
False
sage: C.Hom(C).one() == f*g
False
sage: (x,y,z) = C.gens(); C.hom([x,y,z],C) == f*g                                                   
False
```

Something indeed needs to be done about this. The following indicates that we are very close.

```
sage: g.representatives()[1](P)
(1 : 1)
sage: (f*g).representatives()[0]                                                                
Scheme endomorphism of Projective Conic Curve over Finite Field of size 2 defined by x^2 + x*y + y^2 + x*z + y*z
  Defn: Defined on coordinates by sending (x : y : z) to
        (x : y : z)
```

Here are some other things that don't work:

```
sage: (f*g).representatives()[0].is_one()
False
sage: C.Hom(C).one().is_one()
TypeError: ...
sage: (g*f).representatives()                                                                   
AttributeError: ...
```

But I don't know enough about the inner workings of [SageMath](SageMath) schemes to fix it.

ps. The warning [comment:2 mentioned] by John refers to this ticket, so there seems to be no reason to doubt the output of parametrization.



---

archive/issue_comments_452030.json:
```json
{
    "body": "See #33603: Fix Conic doctests.",
    "created_at": "2022-03-30T15:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452030",
    "user": "@mstreng"
}
```

See #33603: Fix Conic doctests.



---

archive/issue_comments_452031.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-05T13:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452031",
    "user": "@kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_452032.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-05T13:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452032",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452033.json:
```json
{
    "body": "Part of the issue is fixed incidentally by #33953.\n\nThe branch fixes other issues related with the identity morphisms.",
    "created_at": "2022-06-05T13:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452033",
    "user": "@kwankyu"
}
```

Part of the issue is fixed incidentally by #33953.

The branch fixes other issues related with the identity morphisms.



---

archive/issue_comments_452034.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-05T13:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452034",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452035.json:
```json
{
    "body": "With #33953, this `g([0, -1, 2])` gives the correct answer.",
    "created_at": "2022-06-05T14:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452035",
    "user": "@kwankyu"
}
```

With #33953, this `g([0, -1, 2])` gives the correct answer.



---

archive/issue_comments_452036.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-05T14:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452036",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-06T02:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452037",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452038.json:
```json
{
    "body": "The last commit contains fixes so that `g([0, -1, 2])` gives the correct answer.",
    "created_at": "2022-06-06T02:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452038",
    "user": "@kwankyu"
}
```

The last commit contains fixes so that `g([0, -1, 2])` gives the correct answer.



---

archive/issue_comments_452039.json:
```json
{
    "body": "Sorry for my ignorance, but I am unable to merge this ticket on top of [SageMath](SageMath) 9.7.beta3 plus #28263 #32340 #33213 #33619 #33840 #33854 #33974 #33978 #33979 #33984 #33985 #33987 #33990 #33991 #33992 #33993 #33996 #34001 #34007 #34008 #34009 #34010 #34014 #34019 #34021 #34022 #34025 #34030 #34034 #34035 #34036 #34037 (all of them positively reviewed):\n\n```\n% git clone -c core.symlinks=true --branch develop --tags https://github.com/sagemath/sage.git\n[...]\n% cd sage\n% git-trac-merge 28263 32340 33213 33619 33840 33854 33974 33978 33979 33984 33985 33987 33990 33991 33992 33993 33996 34001 34007 34008 34009 34010 34014 34019 34021 34022 34025 34030 34034 34035 34036 34037\n[...]\n% git-trac-merge 31892\n\n#31892\nremote branch: u/klee/31892\n\nFrom git://trac.sagemath.org/sage\n * branch                  u/klee/31892 -> FETCH_HEAD\n\nAuto-merging src/sage/schemes/toric/homset.py\nAuto-merging src/sage/schemes/projective/projective_space.py\nAuto-merging src/sage/schemes/generic/scheme.py\nAuto-merging src/sage/schemes/generic/morphism.py\nCONFLICT (content): Merge conflict in src/sage/schemes/generic/morphism.py\nAutomatic merge failed; fix conflicts and then commit the result.\n% \n```\n",
    "created_at": "2022-06-21T14:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452039",
    "user": "@GMS103"
}
```

Sorry for my ignorance, but I am unable to merge this ticket on top of [SageMath](SageMath) 9.7.beta3 plus #28263 #32340 #33213 #33619 #33840 #33854 #33974 #33978 #33979 #33984 #33985 #33987 #33990 #33991 #33992 #33993 #33996 #34001 #34007 #34008 #34009 #34010 #34014 #34019 #34021 #34022 #34025 #34030 #34034 #34035 #34036 #34037 (all of them positively reviewed):

```
% git clone -c core.symlinks=true --branch develop --tags https://github.com/sagemath/sage.git
[...]
% cd sage
% git-trac-merge 28263 32340 33213 33619 33840 33854 33974 33978 33979 33984 33985 33987 33990 33991 33992 33993 33996 34001 34007 34008 34009 34010 34014 34019 34021 34022 34025 34030 34034 34035 34036 34037
[...]
% git-trac-merge 31892

#31892
remote branch: u/klee/31892

From git://trac.sagemath.org/sage
 * branch                  u/klee/31892 -> FETCH_HEAD

Auto-merging src/sage/schemes/toric/homset.py
Auto-merging src/sage/schemes/projective/projective_space.py
Auto-merging src/sage/schemes/generic/scheme.py
Auto-merging src/sage/schemes/generic/morphism.py
CONFLICT (content): Merge conflict in src/sage/schemes/generic/morphism.py
Automatic merge failed; fix conflicts and then commit the result.
% 
```




---

archive/issue_comments_452040.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-21T16:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452040",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452041.json:
```json
{
    "body": "Replying to [comment:18 gh-GMS103]:\n> Sorry for my ignorance, but I am unable to merge this ticket on top of [SageMath](SageMath) 9.7.beta3 plus #28263 #32340 #33213 #33619 #33840 #33854 #33974 #33978 #33979 #33984 #33985 #33987 #33990 #33991 #33992 #33993 #33996 #34001 #34007 #34008 #34009 #34010 #34014 #34019 #34021 #34022 #34025 #34030 #34034 #34035 #34036 #34037 (all of them positively reviewed)\n\nUploaded the merge with 9.7.beta3. The release manager will decide which of conflicting positively reviewed tickets are merged first to the next beta.",
    "created_at": "2022-06-21T16:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452041",
    "user": "@kwankyu"
}
```

Replying to [comment:18 gh-GMS103]:
> Sorry for my ignorance, but I am unable to merge this ticket on top of [SageMath](SageMath) 9.7.beta3 plus #28263 #32340 #33213 #33619 #33840 #33854 #33974 #33978 #33979 #33984 #33985 #33987 #33990 #33991 #33992 #33993 #33996 #34001 #34007 #34008 #34009 #34010 #34014 #34019 #34021 #34022 #34025 #34030 #34034 #34035 #34036 #34037 (all of them positively reviewed)

Uploaded the merge with 9.7.beta3. The release manager will decide which of conflicting positively reviewed tickets are merged first to the next beta.



---

archive/issue_comments_452042.json:
```json
{
    "body": "Thanks for explaining.",
    "created_at": "2022-06-21T18:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452042",
    "user": "@GMS103"
}
```

Thanks for explaining.



---

archive/issue_comments_452043.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-25T08:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452043",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452044.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-08-26T14:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452044",
    "user": "@mstreng"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_452045.json:
```json
{
    "body": "I see that #33953 was changed 4 days ago. Does that mean that this ticket needs work as well?\n\nBy the way, this ticket fixes `(g*f).is_one()`, but leaves `(f*g).is_one()` incorrect. Could something be done about that at the same time, or would that need a separate ticket? With either example from the ticket description, I get\n\n```\nsage: (f*g).is_one()\nFalse\nsage: (f*g).representatives()[0]\nScheme endomorphism of Projective Conic Curve over ... defined by ...\n  Defn: Defined on coordinates by sending (x : y : z) to\n        (x : y : z)\n```\n\nThe first output should be `True`. The parametrization is correct as shown by the second output.",
    "created_at": "2022-08-26T14:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452045",
    "user": "@mstreng"
}
```

I see that #33953 was changed 4 days ago. Does that mean that this ticket needs work as well?

By the way, this ticket fixes `(g*f).is_one()`, but leaves `(f*g).is_one()` incorrect. Could something be done about that at the same time, or would that need a separate ticket? With either example from the ticket description, I get

```
sage: (f*g).is_one()
False
sage: (f*g).representatives()[0]
Scheme endomorphism of Projective Conic Curve over ... defined by ...
  Defn: Defined on coordinates by sending (x : y : z) to
        (x : y : z)
```

The first output should be `True`. The parametrization is correct as shown by the second output.



---

archive/issue_comments_452046.json:
```json
{
    "body": "Replying to [comment:23 mstreng]:\n> I see that #33953 was changed 4 days ago. Does that mean that this ticket needs work as well?\n\nYes. There is a merge conflict. I will soon push the merge with #33953.\n\n> By the way, this ticket fixes `(g*f).is_one()`, but leaves `(f*g).is_one()` incorrect. Could something be done about that at the same time, or would that need a separate ticket? \n\nRight. `(g*f).is_one()` works correctly because g*f is a morphism of a projective line, where equality check works correctly. `f*g` gives wrong result because correct equality check is not done(not implemented) for morphisms of projective subschemes.\n\nI suggest to open a separate ticket to solve the problem of `f*g`.",
    "created_at": "2022-08-26T15:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452046",
    "user": "@kwankyu"
}
```

Replying to [comment:23 mstreng]:
> I see that #33953 was changed 4 days ago. Does that mean that this ticket needs work as well?

Yes. There is a merge conflict. I will soon push the merge with #33953.

> By the way, this ticket fixes `(g*f).is_one()`, but leaves `(f*g).is_one()` incorrect. Could something be done about that at the same time, or would that need a separate ticket? 

Right. `(g*f).is_one()` works correctly because g*f is a morphism of a projective line, where equality check works correctly. `f*g` gives wrong result because correct equality check is not done(not implemented) for morphisms of projective subschemes.

I suggest to open a separate ticket to solve the problem of `f*g`.



---

archive/issue_comments_452047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-08-26T15:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452047",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_452048.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-08-26T15:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452048",
    "user": "@kwankyu"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_452049.json:
```json
{
    "body": "Replying to [comment:24 klee]:\n> I suggest to open a separate ticket to solve the problem of `f*g`.\n\nSince this is not a problem of conic parametrization.",
    "created_at": "2022-08-26T15:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452049",
    "user": "@kwankyu"
}
```

Replying to [comment:24 klee]:
> I suggest to open a separate ticket to solve the problem of `f*g`.

Since this is not a problem of conic parametrization.



---

archive/issue_comments_452050.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-09-01T13:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452050",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_452051.json:
```json
{
    "body": "All fixed.",
    "created_at": "2022-09-01T13:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452051",
    "user": "@kwankyu"
}
```

All fixed.



---

archive/issue_comments_452052.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2022-09-01T13:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452052",
    "user": "@kwankyu"
}
```

Changing priority from critical to major.



---

archive/issue_comments_452053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T16:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452053",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T16:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452054",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452055.json:
```json
{
    "body": "Added Cremona's example :) Needs review.",
    "created_at": "2022-09-01T16:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452055",
    "user": "@kwankyu"
}
```

Added Cremona's example :) Needs review.



---

archive/issue_comments_452056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-11T02:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452056",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452057.json:
```json
{
    "body": "Rebased onto the latest develop branch, with the side purpose of checking trac after recent maintenance.",
    "created_at": "2022-09-11T02:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452057",
    "user": "@kwankyu"
}
```

Rebased onto the latest develop branch, with the side purpose of checking trac after recent maintenance.



---

archive/issue_comments_452058.json:
```json
{
    "body": "Tests pass. Code looks good. Just one thing before giving this a positive review:\n\nCould you change the following mathematically incorrect example?\n\n```\nsage: C = Curve(x^2 + y^2 - z^2)\nsage: A.<u> = AffineSpace(QQ, 1)\nsage: f = C.hom([(x + z)/y], A)\nsage: g = C.hom([y/(z - x)], A)\nsage: f == g\nTrue\n```\n\nThe reason: it relies on mathematically incorrect behaviour of [SageMath](SageMath). There are no non-constant morphisms from C to A. Indeed, all non-constant morphisms from C to P<sup>1</sup> are surjective, hence do not land inside A. For example, f((1:0:1)) is not defined as an element of A. [SageMath](SageMath) incorrectly claims that f is a morphism, as follows:\n\n```\nsage: R.<x,y,z> = QQ[]                                                                                                      \nsage: C = Curve(x^2 + y^2 - z^2)                                                                                            \nsage: A.<u> = AffineSpace(QQ, 1)                                                                                            \nsage: f = C.hom([(x + z)/y], A)                                                                                             \nsage: f                                                                                                                     \nScheme morphism:\n  From: Projective Conic Curve over Rational Field defined by x^2 + y^2 - z^2\n  To:   Affine Space of dimension 1 over Rational Field\n  Defn: Defined on coordinates by sending (x : y : z) to\n        ((x + z)/y)\nsage: f.parent()                                                                                                            \nSet of morphisms\n  From: Projective Conic Curve over Rational Field defined by x^2 + y^2 - z^2\n  To:   Affine Space of dimension 1 over Rational Field\n```\n\nThis behaviour is not introduced at this ticket, but was already there in e.g. [SageMath](SageMath) 9.5, so you do not need to fix it. But we should not add examples to the documentation that rely on this incorrect behaviour.\nPerhaps you could change the example as follows:\n\n```\nsage: C = Curve(x^2 + y^2 - z^2)\nsage: P.<u,v> = ProjectiveSpace(QQ, 1)\nsage: f = C.hom([x + z, y], P)\nsage: g = C.hom([y, z - x], P)\nsage: f == g\nTrue\n```\n\nAnd/or you could give constant examples with codomain A. And perhaps you could also add an h for which f == h is False.",
    "created_at": "2022-10-14T10:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452058",
    "user": "@mstreng"
}
```

Tests pass. Code looks good. Just one thing before giving this a positive review:

Could you change the following mathematically incorrect example?

```
sage: C = Curve(x^2 + y^2 - z^2)
sage: A.<u> = AffineSpace(QQ, 1)
sage: f = C.hom([(x + z)/y], A)
sage: g = C.hom([y/(z - x)], A)
sage: f == g
True
```

The reason: it relies on mathematically incorrect behaviour of [SageMath](SageMath). There are no non-constant morphisms from C to A. Indeed, all non-constant morphisms from C to P<sup>1</sup> are surjective, hence do not land inside A. For example, f((1:0:1)) is not defined as an element of A. [SageMath](SageMath) incorrectly claims that f is a morphism, as follows:

```
sage: R.<x,y,z> = QQ[]                                                                                                      
sage: C = Curve(x^2 + y^2 - z^2)                                                                                            
sage: A.<u> = AffineSpace(QQ, 1)                                                                                            
sage: f = C.hom([(x + z)/y], A)                                                                                             
sage: f                                                                                                                     
Scheme morphism:
  From: Projective Conic Curve over Rational Field defined by x^2 + y^2 - z^2
  To:   Affine Space of dimension 1 over Rational Field
  Defn: Defined on coordinates by sending (x : y : z) to
        ((x + z)/y)
sage: f.parent()                                                                                                            
Set of morphisms
  From: Projective Conic Curve over Rational Field defined by x^2 + y^2 - z^2
  To:   Affine Space of dimension 1 over Rational Field
```

This behaviour is not introduced at this ticket, but was already there in e.g. [SageMath](SageMath) 9.5, so you do not need to fix it. But we should not add examples to the documentation that rely on this incorrect behaviour.
Perhaps you could change the example as follows:

```
sage: C = Curve(x^2 + y^2 - z^2)
sage: P.<u,v> = ProjectiveSpace(QQ, 1)
sage: f = C.hom([x + z, y], P)
sage: g = C.hom([y, z - x], P)
sage: f == g
True
```

And/or you could give constant examples with codomain A. And perhaps you could also add an h for which f == h is False.



---

archive/issue_comments_452059.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-10-14T10:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452059",
    "user": "@mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-14T12:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452060",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452061.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-10-14T12:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452061",
    "user": "@kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_452062.json:
```json
{
    "body": "Replying to [comment:36 Marco Streng]:\n> Could you change the following mathematically incorrect example?\n> {{{\n> sage: C = Curve(x^2 + y^2 - z^2)\n> sage: A.<u> = AffineSpace(QQ, 1)\n> sage: f = C.hom([(x + z)/y], A)\n> sage: g = C.hom([y/(z - x)], A)\n> sage: f == g\n> True\n> }}}\n> The reason: it relies on mathematically incorrect behaviour of [SageMath](SageMath). There are no non-constant morphisms from C to A. Indeed, all non-constant morphisms from C to P<sup>1</sup> are surjective, hence do not land inside A. For example, f((1:0:1)) is not defined as an element of A. \n\nYou are right. I wonder how I transformed John's correct example to a wrong one!\n\n> Perhaps you could change the example as follows:\n> {{{\n> sage: C = Curve(x^2 + y^2 - z^2)\n> sage: P.<u,v> = ProjectiveSpace(QQ, 1)\n> sage: f = C.hom([x + z, y], P)\n> sage: g = C.hom([y, z - x], P)\n> sage: f == g\n> True\n> }}}\n> and perhaps you could also add an h for which f == h is False.\n\nI did this. Thank you.",
    "created_at": "2022-10-14T12:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452062",
    "user": "@kwankyu"
}
```

Replying to [comment:36 Marco Streng]:
> Could you change the following mathematically incorrect example?
> {{{
> sage: C = Curve(x^2 + y^2 - z^2)
> sage: A.<u> = AffineSpace(QQ, 1)
> sage: f = C.hom([(x + z)/y], A)
> sage: g = C.hom([y/(z - x)], A)
> sage: f == g
> True
> }}}
> The reason: it relies on mathematically incorrect behaviour of [SageMath](SageMath). There are no non-constant morphisms from C to A. Indeed, all non-constant morphisms from C to P<sup>1</sup> are surjective, hence do not land inside A. For example, f((1:0:1)) is not defined as an element of A. 

You are right. I wonder how I transformed John's correct example to a wrong one!

> Perhaps you could change the example as follows:
> {{{
> sage: C = Curve(x^2 + y^2 - z^2)
> sage: P.<u,v> = ProjectiveSpace(QQ, 1)
> sage: f = C.hom([x + z, y], P)
> sage: g = C.hom([y, z - x], P)
> sage: f == g
> True
> }}}
> and perhaps you could also add an h for which f == h is False.

I did this. Thank you.



---

archive/issue_comments_452063.json:
```json
{
    "body": "Thanks to all (both) of you for working on this.",
    "created_at": "2022-10-14T13:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452063",
    "user": "@JohnCremona"
}
```

Thanks to all (both) of you for working on this.



---

archive/issue_comments_452064.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-10-20T13:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452064",
    "user": "@mstreng"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_452065.json:
```json
{
    "body": "Replying to [comment:36 Marco Streng]:\n> Just one thing before giving this a positive review\n\nThanks for fixing this. Looks good to me.",
    "created_at": "2022-10-20T13:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452065",
    "user": "@mstreng"
}
```

Replying to [comment:36 Marco Streng]:
> Just one thing before giving this a positive review

Thanks for fixing this. Looks good to me.



---

archive/issue_comments_452066.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2022-10-21T00:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452066",
    "user": "@kwankyu"
}
```

Thanks for the review!



---

archive/issue_comments_452067.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-10-23T20:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31655#issuecomment-452067",
    "user": "@vbraun"
}
```

Resolution: fixed
