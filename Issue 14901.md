# Issue 14901: BuiltinFunction._is_registered is giving false negatives

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2013-09-02 02:01:07

This is easily encountered by the following:

```python
sage: loads(dumps(sin)) == sin # derives from GinacFunction
True
sage: loads(dumps(cot)) == cot # should also be True
False
```



---

Comment by ohanar created at 2013-09-02 02:04:55

The following seems to fix the issue:

```diff
`@``@` -853,18 +853,12 `@``@` cdef class BuiltinFunction(Function):
 
         # if match, get operator from function table
         global sfunction_serial_dict
-        if serial != -1 and sfunction_serial_dict.has_key(self._name) and \
-                sfunction_serial_dict[self._name].__class__ == self.__class__:
+        if serial != -1 and sfunction_serial_dict.has_key(serial) and \
+                sfunction_serial_dict[serial].__class__ == self.__class__:
                     # if the returned function is of the same type
                     self._serial = serial
                     return True
 
-        # search the function table to check if any of this type
-        for key, val in sfunction_serial_dict.iteritems():
-            if key == self._name and val.__class__ == self.__class__:
-                self._serial = key
-                return True
-
         return False
 
     def __reduce__(self):
```



I don't know the code, so I don't know what other implications this change might have (I didn't run the test suite).


---

Comment by rws created at 2014-02-22 14:58:39

Changing status from new to needs_review.


---

Comment by rws created at 2014-03-27 10:59:51

Changing status from needs_review to positive_review.


---

Comment by rws created at 2014-03-27 10:59:51

Cannot see any problems, long tests fine in symbolic. I adapted the patch to newer code, added a doctest for this.
----
New commits:


---

Comment by vbraun created at 2014-04-01 16:54:06

Resolution: fixed
