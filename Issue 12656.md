# Issue 12656: get_memory_usage and top under FreeBSD

archive/issues_012656.json:
```json
{
    "body": "Assignee: pjeremy\n\nCC:  jpflori\n\nSuggested changes to sage/misc/getusage.py:\n\n\n```\n--- sage-5.0.beta13/sage/misc/getusage.py-orig  2012-04-11 00:14:47.000000000 +0000\n+++ sage-5.0.beta13/sage/misc/getusage.py       2012-04-11 00:47:03.000000000 +0000\n@@ -20,6 +20,8 @@\n     \"\"\"\n     Return the 'top' or 'prstat' line that contains this running Sage\n     process.\n+    For FreeBSD, return the line containing this running Sage process from\n+    'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm'.\n\n     OUTPUT:\n\n@@ -53,6 +55,8 @@\n         cmd = 'top -l 1 |grep \"^ *%s \"' % pid\n     elif U == 'sunos':\n         cmd = '/usr/bin/prstat -n 100000 1 1  | grep \"^ *%s \"' % pid\n+    elif U == 'freebsd':\n+        cmd = 'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm | grep \"^ *%s \"' % pid\n     else:\n         raise NotImplementedError(\"top not implemented on platform %s\" % U)\n\n@@ -83,6 +87,9 @@\n       usage, ``prstat`` will output the data in KB, MB or GB. In each\n       case, the value returned by this function will always be in MB.\n\n+    - ``FreeBSD`` - Returns float number (in megabytes) that matches\n+      RSS column of ``ps -auxwww``\n+\n     - ``other`` - not implemented for any other operating systems\n\n     EXAMPLES::\n@@ -129,6 +136,9 @@\n             m = float(memory_in_KB_MB_or_GB.strip(\"M\"))\n         elif memory_in_KB_MB_or_GB.endswith(\"G\"):\n             m = float(memory_in_KB_MB_or_GB.strip(\"G\")) * 1024\n+    elif U == 'freebsd':\n+        memory_in_KB = top().split()[3]\n+        m = float(memory_in_KB) / 1024\n     else:\n         raise NotImplementedError(\"memory usage not implemented on platform %s\" % U)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12828\n\n",
    "created_at": "2012-04-11T03:44:35Z",
    "labels": [
        "porting: BSD",
        "major",
        "enhancement"
    ],
    "title": "get_memory_usage and top under FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12656",
    "user": "stephen"
}
```
Assignee: pjeremy

CC:  jpflori

Suggested changes to sage/misc/getusage.py:


```
--- sage-5.0.beta13/sage/misc/getusage.py-orig  2012-04-11 00:14:47.000000000 +0000
+++ sage-5.0.beta13/sage/misc/getusage.py       2012-04-11 00:47:03.000000000 +0000
@@ -20,6 +20,8 @@
     """
     Return the 'top' or 'prstat' line that contains this running Sage
     process.
+    For FreeBSD, return the line containing this running Sage process from
+    'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm'.

     OUTPUT:

@@ -53,6 +55,8 @@
         cmd = 'top -l 1 |grep "^ *%s "' % pid
     elif U == 'sunos':
         cmd = '/usr/bin/prstat -n 100000 1 1  | grep "^ *%s "' % pid
+    elif U == 'freebsd':
+        cmd = 'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm | grep "^ *%s "' % pid
     else:
         raise NotImplementedError("top not implemented on platform %s" % U)

@@ -83,6 +87,9 @@
       usage, ``prstat`` will output the data in KB, MB or GB. In each
       case, the value returned by this function will always be in MB.

+    - ``FreeBSD`` - Returns float number (in megabytes) that matches
+      RSS column of ``ps -auxwww``
+
     - ``other`` - not implemented for any other operating systems

     EXAMPLES::
@@ -129,6 +136,9 @@
             m = float(memory_in_KB_MB_or_GB.strip("M"))
         elif memory_in_KB_MB_or_GB.endswith("G"):
             m = float(memory_in_KB_MB_or_GB.strip("G")) * 1024
+    elif U == 'freebsd':
+        memory_in_KB = top().split()[3]
+        m = float(memory_in_KB) / 1024
     else:
         raise NotImplementedError("memory usage not implemented on platform %s" % U)
```


Issue created by migration from https://trac.sagemath.org/ticket/12828





---

archive/issue_comments_150917.json:
```json
{
    "body": "This just needs to be a patch for us to review it.  Thanks for all the work on this.",
    "created_at": "2012-06-20T19:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150917",
    "user": "kcrisman"
}
```

This just needs to be a patch for us to review it.  Thanks for all the work on this.



---

archive/issue_comments_150918.json:
```json
{
    "body": "This comment is mostly a reminder to myself to turn this into a patch file.  Nice find, though, and hopefully it will help us with #9170 as well.",
    "created_at": "2013-01-16T01:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150918",
    "user": "kcrisman"
}
```

This comment is mostly a reminder to myself to turn this into a patch file.  Nice find, though, and hopefully it will help us with #9170 as well.



---

archive/issue_comments_150919.json:
```json
{
    "body": "I guess it was a patch all along.",
    "created_at": "2013-03-12T14:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150919",
    "user": "kcrisman"
}
```

I guess it was a patch all along.



---

archive/issue_comments_150920.json:
```json
{
    "body": "Attachment [trac_12828.patch](tarball://root/attachments/some-uuid/ticket12828/trac_12828.patch) by kcrisman created at 2013-03-12 14:31:08",
    "created_at": "2013-03-12T14:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150920",
    "user": "kcrisman"
}
```

Attachment [trac_12828.patch](tarball://root/attachments/some-uuid/ticket12828/trac_12828.patch) by kcrisman created at 2013-03-12 14:31:08



---

archive/issue_comments_150921.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-12T14:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150921",
    "user": "kcrisman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_150922.json:
```json
{
    "body": "I don't there is anyone else currently doing much with FreeBSD that is active enough to review this (JP?), so let's say we trust Stephen :)\n\nUnfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.",
    "created_at": "2013-03-12T14:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150922",
    "user": "kcrisman"
}
```

I don't there is anyone else currently doing much with FreeBSD that is active enough to review this (JP?), so let's say we trust Stephen :)

Unfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.



---

archive/issue_comments_150923.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-12T14:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150923",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_150924.json:
```json
{
    "body": "> Unfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.\nI don't know why I said that.",
    "created_at": "2013-03-12T14:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150924",
    "user": "kcrisman"
}
```

> Unfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.
I don't know why I said that.



---

archive/issue_comments_150925.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-03-12T14:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150925",
    "user": "kcrisman"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_150926.json:
```json
{
    "body": "Also, to release manager... this shouldn't affect any other platform, and we have no such buildbot yet, so it could still make it into 5.8 if you are amenable to this.",
    "created_at": "2013-03-12T14:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150926",
    "user": "kcrisman"
}
```

Also, to release manager... this shouldn't affect any other platform, and we have no such buildbot yet, so it could still make it into 5.8 if you are amenable to this.



---

archive/issue_comments_150927.json:
```json
{
    "body": "Actually I am in no hurry.  I have hit a road block in sage-5.8.beta4 in that document building is not working correctly.  It is probably something wrong with semaphores.  It may take me a while to figure it out.",
    "created_at": "2013-03-13T01:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150927",
    "user": "stephen"
}
```

Actually I am in no hurry.  I have hit a road block in sage-5.8.beta4 in that document building is not working correctly.  It is probably something wrong with semaphores.  It may take me a while to figure it out.



---

archive/issue_comments_150928.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-14T08:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12656#issuecomment-150928",
    "user": "jdemeyer"
}
```

Resolution: fixed
