# Issue 17999: support xz compressed tarballs

Issue created by migration from https://trac.sagemath.org/ticket/18236

Original creator: rws

Original creation time: 2015-04-17 07:39:11

When trying to feed Sage a new `pynac...tar.xz` I get:

```
Setting up build directory for pynac-0.3.5
tar: Archive is compressed. Use -J option
tar: Error is not recoverable: exiting now
Error: failed to extract /home/ralf/sage/upstream/pynac-0.3.5.tar.xz
```

The difference in compression is significant:

```
-rw-r--r--  1 ralf users 512029 Apr 17 09:14 pynac-0.3.5.tar.bz2
-rw-r--r--  1 ralf users 652879 Apr 17 09:14 pynac-0.3.5.tar.gz
-rw-r--r--  1 ralf users 443976 Apr 17 09:15 pynac-0.3.5.tar.xz
```



---

Comment by fbissey created at 2015-04-17 09:02:24

`-J`  is the right option for `.xz` I am not sure what is happening internally but `-a` smartly identify the compression and applies the right filter if available. The big problem is that you need a GNU tar recent enough to support xz and that xz is present. I am not sure that BSD tar shipped with OS X supports it at all, or even if xz/lzma is present. I can check though.


---

Comment by fbissey created at 2015-04-17 09:09:19

Just to be different OS X (and my understanding is that it may be a 10.10+ only feature) own tar does support `.xz` but doesn't need any options for recognising compression. `-J` and `-a` don't work but `tar -xvf` will just unpack your `.tar.xz` file.


---

Comment by jhpalmieri created at 2017-10-06 19:12:29

Another approach would be to use the `xz` command to uncompress and then Sage's already existing tarball extractor in `build/sage_bootstrap/uncompress/tar_file.py`. Since Sage has an `xz` package, if we build that early on, then any subsequent package could be in the form of a `tar.xz` tarball.


---

Comment by rws created at 2017-10-07 12:58:38

Better example.


---

Comment by jdemeyer created at 2017-10-10 11:25:22

New commits:


---

Comment by jdemeyer created at 2017-10-10 11:25:22

Changing status from new to needs_review.


---

Comment by dimpase created at 2017-10-10 12:56:36

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2017-10-10 12:56:36

Looks good to me.


---

Comment by jhpalmieri created at 2017-10-10 15:57:37

I suppose in a perfect world, the `SageTarXZFile.can_read` method would check not only whether it was an xz file, but also whether it was a compressed tar file. I don't know how to check this except to actually decompress it and then see if you have a valid tar file, which is much slower than `xz -l ...`.


---

Comment by vbraun created at 2017-10-16 22:44:51

Resolution: fixed
