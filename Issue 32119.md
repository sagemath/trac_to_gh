# Issue 32119: enhance conversion of piecewise functions to giac

Issue created by migration from https://trac.sagemath.org/ticket/32356

Original creator: chapoton

Original creation time: 2021-08-10 09:58:36

alas, the backward conversion is more complicated, because we lack a symbolic AND function


---

Comment by chapoton created at 2021-08-10 09:59:22

Changing status from new to needs_review.


---

Comment by git created at 2021-08-10 09:59:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-08-10 17:41:22

Replying to [ticket:32356 chapoton]:
> alas, the backward conversion is more complicated, because we lack a symbolic AND function
... more precisely because our piecewise functions only accept `RealSet` as domains for the pieces, not arbitrary sets...


---

Comment by git created at 2021-08-12 19:42:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-08-12 20:24:03

Do you know what condition expressions can occur in giac piecewise?


---

Comment by chapoton created at 2021-08-13 07:06:52

We could start by converting back conditions coming from sage. They take the typical form "x > 0 and x < 4". The connector "**and**" is not recognized by our symbolic ring parser.

Here is an example:

```
sage: S = RealSet([0,4])                                                          
sage: S._giac_condition_(x)                                                     
'((0 <= sageVARx) and (sageVARx <= 4))'
sage: giac(S._giac_condition_(x))                                               
((sageVARx>=0) and (4>=sageVARx))
```

and a more general one, with **or**:

```
sage: S = RealSet([0,4],[6,9])                                                    
sage: S._giac_condition_(x)                                                     
'((0 <= sageVARx) and (sageVARx <= 4)) or ((6 <= sageVARx) and (sageVARx <= 9))'
sage: giac(_)                                                                   
((((sageVARx>=0) and (4>=sageVARx))) or (((sageVARx>=6) and (9>=sageVARx))))
```



---

Comment by mkoeppe created at 2021-08-14 03:11:41

With #31911:

```
sage: g = giac('((0 <= sageVARx) and (sageVARx <= 4))')                                                                                                                      
sage: g._sage_()                                                                                                                                                             
and_symbolic(x >= 0, 4 >= x)
```



---

Comment by mkoeppe created at 2021-08-14 03:38:29

And:

```
sage: g = giac('((0 <= sageVARx) and (sageVARx <= 4)) or ((6 <= sageVARx) and (sageVARx <= 9))')                                                                             
sage: g._sage_()                                                                                                                                                             
or_symbolic(and_symbolic(x >= 0, 4 >= x), and_symbolic(x >= 6, 9 >= x))
```



---

Comment by mkoeppe created at 2021-08-14 05:01:28

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-08-15 09:04:44

Nitpicking suggestions, feel free to ignore.

Apply pep8 spacing in examples to promote good habits:


```diff
-                sage: integral(ex,x,0,100,algorithm='giac')
+                sage: integral(ex, x, 0, 100, algorithm='giac')
                 199/100
-                sage: integral(ex,x,algorithm='giac')
+                sage: integral(ex, x, algorithm='giac')
+                piecewise(x|-->x on [0, 1], x|-->-1/x + 2 on (1, +oo); x)
```



```diff
-            sage: RealSet((0,1), [2,3])._giac_condition_(x)
+            sage: RealSet((0, 1), [2, 3])._giac_condition_(x)
```



```diff
-            sage: RealSet(6,6)._giac_condition_(x)
+            sage: RealSet(6, 6)._giac_condition_(x)
             'false'
-            sage: RealSet([6,6])._giac_condition_(x)
+            sage: RealSet([6, 6])._giac_condition_(x)
             'sageVARx == 6'
```


No need to wrap if we stay under the 80 character limit:


```diff
-            args = [(domain._giac_condition_(variable),
-                     func._giac_init_())
+            args = [(domain._giac_condition_(variable), func._giac_init_())
                     for domain, func in parameters]
```



```diff
+        return ' or '.join(it._giac_condition_(x)
+                           for it in self._intervals)
+        return ' or '.join(it._giac_condition_(x) for it in self._intervals)
```


Use f-strings:


```diff
+        return "((" + lower_condition + ") and (" + upper_condition + "))"
+        return f"(({lower_condition}) and ({upper_condition}))"
```



---

Comment by vbraun created at 2021-09-07 20:52:13

Resolution: fixed
