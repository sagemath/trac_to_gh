# Issue 29674: sage.rings.integer, integer_ring: Remove dependencies on sage.libs.ntl

archive/issues_029674.json:
```json
{
    "body": "CC:  @videlec @fchapoton @alexjbest @mezzarobba @kliem @mwageringel @tscrim\n\nThe two Cython modules depend on NTL in a very minor way that could be eliminated:\n\n- `sage.rings.integer.Integer` depends on `sage.libs.ntl` to provide method `_to_ZZ`. \n\n- `sage.rings.integer_ring._coerce_ZZ` depends on `sage.libs.ntl` to provide the method `_coerce_ZZ`.\n\nThese methods are only used in `sage.libs.ntl` and in `sage.rings.number_field.number_field_element` and `rings.polynomial.polynomial_zz_pex`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29911\n\n",
    "created_at": "2020-06-20T04:09:41Z",
    "labels": [
        "refactoring",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "sage.rings.integer, integer_ring: Remove dependencies on sage.libs.ntl",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29674",
    "user": "@mkoeppe"
}
```
CC:  @videlec @fchapoton @alexjbest @mezzarobba @kliem @mwageringel @tscrim

The two Cython modules depend on NTL in a very minor way that could be eliminated:

- `sage.rings.integer.Integer` depends on `sage.libs.ntl` to provide method `_to_ZZ`. 

- `sage.rings.integer_ring._coerce_ZZ` depends on `sage.libs.ntl` to provide the method `_coerce_ZZ`.

These methods are only used in `sage.libs.ntl` and in `sage.rings.number_field.number_field_element` and `rings.polynomial.polynomial_zz_pex`.

Issue created by migration from https://trac.sagemath.org/ticket/29911





---

archive/issue_comments_421404.json:
```json
{
    "body": "Hum, `sage.rings.integer.integer` and `sage.rings.integer_ring` don't link to `ntl` directly at least.\n\n```\nreadelf -d /usr/lib/python3.7/site-packages/sage/rings/integer_ring.cpython-37m-x86_64-linux-gnu.so \n\nDynamic section at offset 0x35ca0 contains 26 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0x7000\n```\n\nand \n\n```\nreadelf -d /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so \n\nDynamic section at offset 0x4db78 contains 30 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]\n 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0xd000\n```\n\non Gentoo compiled with `--as-needed`. Some headers may still be used though.",
    "created_at": "2020-06-20T05:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421404",
    "user": "@kiwifb"
}
```

Hum, `sage.rings.integer.integer` and `sage.rings.integer_ring` don't link to `ntl` directly at least.

```
readelf -d /usr/lib/python3.7/site-packages/sage/rings/integer_ring.cpython-37m-x86_64-linux-gnu.so 

Dynamic section at offset 0x35ca0 contains 26 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0x7000
```

and 

```
readelf -d /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so 

Dynamic section at offset 0x4db78 contains 30 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]
 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0xd000
```

on Gentoo compiled with `--as-needed`. Some headers may still be used though.



---

archive/issue_comments_421405.json:
```json
{
    "body": "It's a compile time dependency. It's possible that it is all macros or inlined functions.",
    "created_at": "2020-06-20T05:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421405",
    "user": "@mkoeppe"
}
```

It's a compile time dependency. It's possible that it is all macros or inlined functions.



---

archive/issue_comments_421406.json:
```json
{
    "body": "Would it make sense to make these two methods functions in `sage.libs.ntl.conversion`?",
    "created_at": "2020-06-23T00:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421406",
    "user": "@mkoeppe"
}
```

Would it make sense to make these two methods functions in `sage.libs.ntl.conversion`?



---

archive/issue_comments_421407.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-27T05:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421407",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_421408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-27T05:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421408",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421409.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-27T05:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421409",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_421410.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-27T05:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421410",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_421411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-27T05:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421411",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421412.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-27T05:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421412",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_421413.json:
```json
{
    "body": "The dependency has been merged in 9.2.beta3. Needs review",
    "created_at": "2020-07-08T15:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421413",
    "user": "@mkoeppe"
}
```

The dependency has been merged in 9.2.beta3. Needs review



---

archive/issue_comments_421414.json:
```json
{
    "body": "Replying to [comment:5 mkoeppe]:\n> Would it make sense to make these two methods functions in `sage.libs.ntl.conversion`?\n\nThis sounds like a good idea to me. Why do you remove the calls to `sig_on`/`sig_off`?",
    "created_at": "2020-07-10T19:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421414",
    "user": "@mwageringel"
}
```

Replying to [comment:5 mkoeppe]:
> Would it make sense to make these two methods functions in `sage.libs.ntl.conversion`?

This sounds like a good idea to me. Why do you remove the calls to `sig_on`/`sig_off`?



---

archive/issue_comments_421415.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-07-13T00:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421415",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_421416.json:
```json
{
    "body": "Rebased on 9.2.beta5",
    "created_at": "2020-07-13T00:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421416",
    "user": "@mkoeppe"
}
```

Rebased on 9.2.beta5



---

archive/issue_comments_421417.json:
```json
{
    "body": "Replying to [comment:16 gh-mwageringel]:\n> Why do you remove the calls to `sig_on`/`sig_off`?\n\nGood question. I am not sure against what kind of errors these calls were supposed to be guarding.",
    "created_at": "2020-07-13T00:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421417",
    "user": "@mkoeppe"
}
```

Replying to [comment:16 gh-mwageringel]:
> Why do you remove the calls to `sig_on`/`sig_off`?

Good question. I am not sure against what kind of errors these calls were supposed to be guarding.



---

archive/issue_comments_421418.json:
```json
{
    "body": "Hoping for a Cython expert to take a look...",
    "created_at": "2020-07-26T00:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421418",
    "user": "@mkoeppe"
}
```

Hoping for a Cython expert to take a look...



---

archive/issue_comments_421419.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-26T05:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421419",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421420.json:
```json
{
    "body": "While I would not count myself as a Cython expert, my guess would be if the denominator was somehow not something that could be handled? Perhaps some kind of overflow or unable to allocate memory? I am really unsure.",
    "created_at": "2020-07-27T06:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421420",
    "user": "@tscrim"
}
```

While I would not count myself as a Cython expert, my guess would be if the denominator was somehow not something that could be handled? Perhaps some kind of overflow or unable to allocate memory? I am really unsure.



---

archive/issue_comments_421421.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-10T22:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421421",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_421422.json:
```json
{
    "body": "Well, let's put this into practice as I cannot find a reason for it. Well, perhaps we should just put it into Sage to get some broader testing as it seems safe enough to me.",
    "created_at": "2020-08-10T22:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421422",
    "user": "@tscrim"
}
```

Well, let's put this into practice as I cannot find a reason for it. Well, perhaps we should just put it into Sage to get some broader testing as it seems safe enough to me.



---

archive/issue_comments_421423.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-08-10T23:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421423",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_421424.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-14T22:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-421424",
    "user": "@vbraun"
}
```

Resolution: fixed
