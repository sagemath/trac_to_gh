# Issue 31806: docbuild: Restore main website build - icons linking to pdf files

Issue created by migration from https://trac.sagemath.org/ticket/32043

Original creator: mkoeppe

Original creation time: 2021-06-23 15:59:53

CC:  klee jhpalmieri schilly

(from #31948#comment:83)

Apparently lost in #31948


---

Comment by git created at 2021-08-28 05:50:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-28 06:35:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2021-08-28 06:38:28

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2021-08-28 20:49:27

`make doc-html` fails for me with the error

```
OSError: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.4.rc2/src/doc/en/tutorial/tour_numtheory.rst:129: WARNING: undefined label: sage.rings.padics.tutorial
```

I think this was the point of having `doc-html-other` depend on `doc-html-reference`.

Can you explain the other changes you've made?


---

Comment by mkoeppe created at 2021-08-28 23:35:39

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-08-28 23:35:39

Pretty sure also `doc-pdf-other` needs a prerequisite.

Any changes really need to be tested with a parallel build, for example use `export MAKE="make -j20"`


---

Comment by jhpalmieri created at 2021-08-29 01:54:05

I hit the problem with `make doc-html` right away, but after making the change

```diff
diff --git a/src/doc/Makefile b/src/doc/Makefile
index ff2c6037c1..bef4b3a212 100644
--- a/src/doc/Makefile
+++ b/src/doc/Makefile
@@ -47,7 +47,7 @@ doc-html-reference: doc-inventory-reference
        $(MAKE) SAGE_DOCBUILD_OPTS="$(SAGE_DOCBUILD_OPTS) --no-prune-empty-dirs" doc-html--reference_top
 
 # other documentation, html
-doc-html-other:
+doc-html-other: doc-html-reference
        $(MAKE) SAGE_DOCBUILD_OPTS="$(SAGE_DOCBUILD_OPTS) --no-prune-empty-dirs" $(foreach doc, $(wordlist 2, 100, $(shell cd $(SAGE_ROOT) && ./sage --docbuild --all-documents all)), doc-html--$(subst /,-,$(doc)))
 
 doc-html: doc-html-reference doc-html-other
```

 `make doc-clean && make doc-pdf` has succeeded several times in a row. Same with `make doc-clean && make doc && make doc-pdf`. So I don't know if `doc-pdf-other` needs a prerequisite. (This is with `MAKE='make -j6'`.)


---

Comment by klee created at 2021-08-29 01:55:43

Replying to [comment:6 jhpalmieri]:
> Can you explain the other changes you've made?

The website was not built because `ReferenceTopBuilder` had no chance to do its work.

Changes related with documentation of external packages were made to fix a link error in the reference top page and to make it read better (I think) for pdf files.


---

Comment by git created at 2021-08-29 01:56:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2021-08-29 01:56:57

Restored harmful and possibly harmful changes.


---

Comment by klee created at 2021-08-29 02:01:29

I had removed `_output_dir` method because I thought that is not necessary. But as I worry it may introduce a backward-incompatible side effect, I restored it.


---

Comment by klee created at 2021-08-29 02:05:48

Replying to [comment:8 jhpalmieri]:
> So I don't know if `doc-pdf-other` needs a prerequisite. (This is with `MAKE='make -j6'`.)

Adding `doc-html-reference` does no harm.


---

Comment by git created at 2021-08-29 02:23:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2021-08-29 02:27:19

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2021-08-29 04:35:31

Looks good to me. Thanks for fixing this.


---

Comment by klee created at 2021-08-29 10:01:47

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-08-29 10:35:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2021-08-29 10:38:35

Though it seems this `.PHONY` thing is not absolutely necessary.


---

Comment by klee created at 2021-08-29 10:38:43

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-08-29 21:34:20

Replying to [comment:9 klee]:
> Changes related with documentation of external packages were made to fix a link error in the reference top page and to make it read better (I think) for pdf files.

Thanks, this is an improvement.


---

Comment by jhpalmieri created at 2021-08-31 01:32:16

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2021-08-31 01:32:16

Let's merge it!


---

Comment by vbraun created at 2021-09-01 20:55:16

Resolution: fixed
