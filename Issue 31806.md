# Issue 31806: docbuild: Restore main website build - icons linking to pdf files

archive/issues_031806.json:
```json
{
    "body": "CC:  klee jhpalmieri schilly\n\n(from #31948#comment:83)\n\nApparently lost in #31948\n\nIssue created by migration from https://trac.sagemath.org/ticket/32043\n\n",
    "created_at": "2021-06-23T15:59:53Z",
    "labels": [
        "documentation",
        "major",
        "bug"
    ],
    "title": "docbuild: Restore main website build - icons linking to pdf files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31806",
    "user": "mkoeppe"
}
```
CC:  klee jhpalmieri schilly

(from #31948#comment:83)

Apparently lost in #31948

Issue created by migration from https://trac.sagemath.org/ticket/32043





---

archive/issue_comments_454575.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-28T05:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454575",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454576.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-28T06:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454576",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454577.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-28T06:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454577",
    "user": "klee"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454578.json:
```json
{
    "body": "`make doc-html` fails for me with the error\n\n```\nOSError: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.4.rc2/src/doc/en/tutorial/tour_numtheory.rst:129: WARNING: undefined label: sage.rings.padics.tutorial\n```\n\nI think this was the point of having `doc-html-other` depend on `doc-html-reference`.\n\nCan you explain the other changes you've made?",
    "created_at": "2021-08-28T20:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454578",
    "user": "jhpalmieri"
}
```

`make doc-html` fails for me with the error

```
OSError: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.4.rc2/src/doc/en/tutorial/tour_numtheory.rst:129: WARNING: undefined label: sage.rings.padics.tutorial
```

I think this was the point of having `doc-html-other` depend on `doc-html-reference`.

Can you explain the other changes you've made?



---

archive/issue_comments_454579.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-28T23:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454579",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454580.json:
```json
{
    "body": "Pretty sure also `doc-pdf-other` needs a prerequisite.\n\nAny changes really need to be tested with a parallel build, for example use `export MAKE=\"make -j20\"`",
    "created_at": "2021-08-28T23:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454580",
    "user": "mkoeppe"
}
```

Pretty sure also `doc-pdf-other` needs a prerequisite.

Any changes really need to be tested with a parallel build, for example use `export MAKE="make -j20"`



---

archive/issue_comments_454581.json:
```json
{
    "body": "I hit the problem with `make doc-html` right away, but after making the change\n\n```diff\ndiff --git a/src/doc/Makefile b/src/doc/Makefile\nindex ff2c6037c1..bef4b3a212 100644\n--- a/src/doc/Makefile\n+++ b/src/doc/Makefile\n@@ -47,7 +47,7 @@ doc-html-reference: doc-inventory-reference\n        $(MAKE) SAGE_DOCBUILD_OPTS=\"$(SAGE_DOCBUILD_OPTS) --no-prune-empty-dirs\" doc-html--reference_top\n \n # other documentation, html\n-doc-html-other:\n+doc-html-other: doc-html-reference\n        $(MAKE) SAGE_DOCBUILD_OPTS=\"$(SAGE_DOCBUILD_OPTS) --no-prune-empty-dirs\" $(foreach doc, $(wordlist 2, 100, $(shell cd $(SAGE_ROOT) && ./sage --docbuild --all-documents all)), doc-html--$(subst /,-,$(doc)))\n \n doc-html: doc-html-reference doc-html-other\n```\n\n `make doc-clean && make doc-pdf` has succeeded several times in a row. Same with `make doc-clean && make doc && make doc-pdf`. So I don't know if `doc-pdf-other` needs a prerequisite. (This is with `MAKE='make -j6'`.)",
    "created_at": "2021-08-29T01:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454581",
    "user": "jhpalmieri"
}
```

I hit the problem with `make doc-html` right away, but after making the change

```diff
diff --git a/src/doc/Makefile b/src/doc/Makefile
index ff2c6037c1..bef4b3a212 100644
--- a/src/doc/Makefile
+++ b/src/doc/Makefile
@@ -47,7 +47,7 @@ doc-html-reference: doc-inventory-reference
        $(MAKE) SAGE_DOCBUILD_OPTS="$(SAGE_DOCBUILD_OPTS) --no-prune-empty-dirs" doc-html--reference_top
 
 # other documentation, html
-doc-html-other:
+doc-html-other: doc-html-reference
        $(MAKE) SAGE_DOCBUILD_OPTS="$(SAGE_DOCBUILD_OPTS) --no-prune-empty-dirs" $(foreach doc, $(wordlist 2, 100, $(shell cd $(SAGE_ROOT) && ./sage --docbuild --all-documents all)), doc-html--$(subst /,-,$(doc)))
 
 doc-html: doc-html-reference doc-html-other
```

 `make doc-clean && make doc-pdf` has succeeded several times in a row. Same with `make doc-clean && make doc && make doc-pdf`. So I don't know if `doc-pdf-other` needs a prerequisite. (This is with `MAKE='make -j6'`.)



---

archive/issue_comments_454582.json:
```json
{
    "body": "Replying to [comment:6 jhpalmieri]:\n> Can you explain the other changes you've made?\n\nThe website was not built because `ReferenceTopBuilder` had no chance to do its work.\n\nChanges related with documentation of external packages were made to fix a link error in the reference top page and to make it read better (I think) for pdf files.",
    "created_at": "2021-08-29T01:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454582",
    "user": "klee"
}
```

Replying to [comment:6 jhpalmieri]:
> Can you explain the other changes you've made?

The website was not built because `ReferenceTopBuilder` had no chance to do its work.

Changes related with documentation of external packages were made to fix a link error in the reference top page and to make it read better (I think) for pdf files.



---

archive/issue_comments_454583.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-29T01:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454583",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454584.json:
```json
{
    "body": "Restored harmful and possibly harmful changes.",
    "created_at": "2021-08-29T01:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454584",
    "user": "klee"
}
```

Restored harmful and possibly harmful changes.



---

archive/issue_comments_454585.json:
```json
{
    "body": "I had removed `_output_dir` method because I thought that is not necessary. But as I worry it may introduce a backward-incompatible side effect, I restored it.",
    "created_at": "2021-08-29T02:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454585",
    "user": "klee"
}
```

I had removed `_output_dir` method because I thought that is not necessary. But as I worry it may introduce a backward-incompatible side effect, I restored it.



---

archive/issue_comments_454586.json:
```json
{
    "body": "Replying to [comment:8 jhpalmieri]:\n> So I don't know if `doc-pdf-other` needs a prerequisite. (This is with `MAKE='make -j6'`.)\n\nAdding `doc-html-reference` does no harm.",
    "created_at": "2021-08-29T02:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454586",
    "user": "klee"
}
```

Replying to [comment:8 jhpalmieri]:
> So I don't know if `doc-pdf-other` needs a prerequisite. (This is with `MAKE='make -j6'`.)

Adding `doc-html-reference` does no harm.



---

archive/issue_comments_454587.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-29T02:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454587",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454588.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-08-29T02:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454588",
    "user": "klee"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454589.json:
```json
{
    "body": "Looks good to me. Thanks for fixing this.",
    "created_at": "2021-08-29T04:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454589",
    "user": "jhpalmieri"
}
```

Looks good to me. Thanks for fixing this.



---

archive/issue_comments_454590.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-29T10:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454590",
    "user": "klee"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454591.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-29T10:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454591",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454592.json:
```json
{
    "body": "Though it seems this `.PHONY` thing is not absolutely necessary.",
    "created_at": "2021-08-29T10:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454592",
    "user": "klee"
}
```

Though it seems this `.PHONY` thing is not absolutely necessary.



---

archive/issue_comments_454593.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-08-29T10:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454593",
    "user": "klee"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454594.json:
```json
{
    "body": "Replying to [comment:9 klee]:\n> Changes related with documentation of external packages were made to fix a link error in the reference top page and to make it read better (I think) for pdf files.\n\nThanks, this is an improvement.",
    "created_at": "2021-08-29T21:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454594",
    "user": "mkoeppe"
}
```

Replying to [comment:9 klee]:
> Changes related with documentation of external packages were made to fix a link error in the reference top page and to make it read better (I think) for pdf files.

Thanks, this is an improvement.



---

archive/issue_comments_454595.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-31T01:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454595",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454596.json:
```json
{
    "body": "Let's merge it!",
    "created_at": "2021-08-31T01:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454596",
    "user": "jhpalmieri"
}
```

Let's merge it!



---

archive/issue_comments_454597.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-01T20:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31806#issuecomment-454597",
    "user": "vbraun"
}
```

Resolution: fixed
