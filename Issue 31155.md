# Issue 31155: error building dochtml in void linux: (locale: command not found)

Issue created by migration from https://trac.sagemath.org/ticket/31392

Original creator: @dkwo

Original creation time: 2021-02-13 20:52:08

Building Sage 9.2 on Void Linux, it fails with

```
make[2]: *** [Makefile:1766: all-start] Error 2
make[2]: Leaving directory '/tmp/build/sage-9.2/build/make'

real    97m40.925s
user    341m59.892s
sys     15m35.366s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all-start'):

It is safe to delete any log files and build directories, but they
contain information that is helpful for debugging build problems.
WARNING: If you now run 'make' again, the build directory of the
same version of the package will, by default, be deleted. Set the
environment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.

make[1]: *** [Makefile:33: all-start] Error 1
make[1]: Leaving directory '/tmp/build/sage-9.2'
make: *** [Makefile:13: all] Error 2
```

In particular,

```
touch "/tmp/build/sage-9.2/local/var/lib/sage/installed/sagelib-9.2"
cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html ' logs/dochtml.log
make --no-print-directory sagetex-no-deps
sage-logger -p 'SAGE_CHECK=no sage-spkg   sagetex-3.5' '/tmp/build/sage-9.2/logs/pkgs/sagetex-3.5.log'
[dochtml] /tmp/build/sage-9.2/build/bin/sage-site: line 164: locale: command not found
[dochtml] Traceback (most recent call last):
[dochtml]   File "/usr/lib/python3.9/runpy.py", line 188, in _run_module_as_main
[dochtml]     mod_name, mod_spec, code = _get_module_details(mod_name, _Error)
[dochtml]   File "/usr/lib/python3.9/runpy.py", line 147, in _get_module_details
[dochtml]     return _get_module_details(pkg_main_name, error)
[dochtml]   File "/usr/lib/python3.9/runpy.py", line 111, in _get_module_details
[dochtml]     __import__(pkg_name)
[dochtml]   File "/tmp/build/sage-9.2/local/lib/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 58, in <module>
[dochtml]     import sage.all
[dochtml]   File "/tmp/build/sage-9.2/local/lib/python3.9/site-packages/sage/all.py", line 127, in <module>
[dochtml]     from sage.misc.all       import *         # takes a while
[dochtml]   File "/tmp/build/sage-9.2/local/lib/python3.9/site-packages/sage/misc/all.py", line 90, in <module>
[dochtml]     from .functional import (additive_order,
[dochtml]   File "/tmp/build/sage-9.2/local/lib/python3.9/site-packages/sage/misc/functional.py", line 26, in <module>
[dochtml]     from sage.rings.complex_double import CDF
[dochtml]   File "sage/rings/complex_double.pyx", line 1, in init sage.rings.complex_double (build/cythonized/sage/rings/complex_double.c:25154)
[dochtml]   File "sage/rings/integer.pyx", line 1, in init sage.rings.integer (build/cythonized/sage/rings/integer.c:54342)
[dochtml]   File "sage/rings/rational.pyx", line 1, in init sage.rings.rational (build/cythonized/sage/rings/rational.c:40291)
[dochtml]   File "sage/rings/fast_arith.pyx", line 1, in init sage.rings.fast_arith (build/cythonized/sage/rings/fast_arith.c:8645)
[dochtml]   File "/tmp/build/sage-9.2/local/lib/python3.9/site-packages/cypari2/__init__.py", line 1, in <module>
[dochtml]     from .pari_instance import Pari
[dochtml]   File "cypari2/pari_instance.pyx", line 1, in init cypari2.pari_instance
[dochtml] ImportError: Error relocating /tmp/build/sage-9.2/local/lib/python3.9/site-packages/cypari2/gen.cpython-39-x86_64-linux-gnu.so: isirreducible: symbol not found
make[3]: *** [Makefile:1876: doc-html] Error 1
make[3]: *** Waiting for unfinished jobs....
```

Do you know how to solve this issue?

Thanks.

For reference, it is building

```
arb brial cddlib cliquer coxeter3 eclib fflas_ffpack flint flintqs fplll gf2x gfan givaro gp2c iml isl lcalc libbraiding libnauty libsemig
roups lrcalc m4ri m4rie mpfi nauty ntl palp perl_cpan_polymake_prereq planarity rw suitesparse symmetrica sympow tachyon zn_poly
```

while the following are taken from Void repo

```
CoinMP-devel
R
automake
boost-devel
cblas
cmake
ecl
ecm-devel
freetype-devel
gcc-fortran
gd-devel
gettext-devel
giac-devel
glpk-devel
gmpxx-devel
harfbuzz
imlib2-devel
isl15-devel
libcurl-devel
libgda-devel
libgomp-devel
libmpc-devel
m4
mk-configure
mpc
mpir-devel
ninja
openblas-devel
pandoc
pari-devel
pari-elldata
pari-galdata
pari-galpol
pari-seadata
patch
pcre-devel
pcre2-devel
perl-Term-ReadLine-Gnu
pkgconf
ppl-devel
python3-Babel
python3-Pillowpython3-Sphinx
python3-devel
python3-matplotlib
python3-networkx
python3-pkgconfig
python3-scipy
python3-sympy
rw
sqlite-devel
tox
yasm
zeromq-devel
```

(some of which I still have to add to sage docker.)
I'm also using ticket 30906 for pari.


---

Comment by mkoeppe created at 2021-02-13 21:13:18

`locale: command not found` is not the problem here, this is just cosmetic.

`isirreducible: symbol not found` is what is causing the build error.


---

Comment by @dkwo created at 2021-02-13 21:32:33

Thanks, I've updated title.
Do you know what I could try?


---

Comment by mkoeppe created at 2021-02-13 21:42:49

#30801 needs help


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by mkoeppe created at 2021-09-25 19:59:59

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-09-25 19:59:59

Outdated, should close


---

Comment by @dkwo created at 2021-09-26 11:59:37

Now it builds on glibc (but not on musl).
The failures are with stuff that is already packaged in void, like python packages.
So it seems pointless to track those here, rather just wait for sage to complete the spkg ticket for python packages.


---

Comment by @dkwo created at 2021-09-26 12:02:23

So it can be closed.


---

Comment by klee created at 2021-09-29 01:50:18

Then let's close this.


---

Comment by klee created at 2021-09-29 01:50:18

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-10-04 23:44:13

Resolution: invalid
