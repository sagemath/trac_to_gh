# Issue 31644: RealSet: Extend constructors so that they can build manifold objects

Issue created by migration from https://trac.sagemath.org/ticket/31881

Original creator: mkoeppe

Original creation time: 2021-05-30 18:55:45

CC:  egourgoulhon tscrim @mjungmath

From #30832:

We extend the `RealSet` constructors (default constructor and `RealSet.open` etc.) so that they can build manifold objects; for example if `structure` or `name` is passed

Then perhaps the global bindings `RealLine` and `OpenInterval` can be deprecated (they are also available through the `manifolds` catalog).

This will help make the functionality more discoverable. There are just too many global constructors: `Reals`, `RealLine`, `RealSet`, `RealInterval`, `OpenInterval`.


---

Comment by egourgoulhon created at 2021-06-28 21:12:48

Replying to [ticket:31881 mkoeppe]:
> 
> Overall, the `UniqueRepresentation` behavior of `RealLine` is inconsistent with the behavior of `Manifold`:
> {{{
> sage: RealLine(name='A') is RealLine(name='A')
> True
> sage: Manifold(1, name='A') is Manifold(1, name='A')
> False
> }}}

This is intended because `RealLine` fully specifies the object (the set of real numbers endowed with the canonical manifold structure), while `Manifold(1, name='A')` does not (since there are two distinct manifolds of dimension 1: the real line and the circle). Hence `RealLine` has `UniqueRepresentation` behavior, while `Manifold` has not. 

> 
> We also deprecate the global binding `OpenInterval` (but it will remain available through the `manifolds` catalog).

Agreed. 

> 
> This will help make the functionality more discoverable. There are just too many global constructors: `Reals`, `RealLine`, `RealSet`, `RealInterval`, `OpenInterval`.

Indeed!


---

Comment by mkoeppe created at 2021-06-28 22:51:41

Replying to [comment:2 egourgoulhon]:
> Replying to [ticket:31881 mkoeppe]:
> > 
> > Overall, the `UniqueRepresentation` behavior of `RealLine` is inconsistent with the behavior of `Manifold`:
> > {{{
> > sage: RealLine(name='A') is RealLine(name='A')
> > True
> > sage: Manifold(1, name='A') is Manifold(1, name='A')
> > False
> > }}}
> 
> This is intended because `RealLine` fully specifies the object [...]. Hence `RealLine` has `UniqueRepresentation` behavior, while `Manifold` has not. 

I agree with this mathematical point, but on the implementation side you have additional mutable structure, namely the family of declared subsets, on every manifold. This makes the question of identity trickier.


---

Comment by git created at 2021-07-07 00:51:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-07 01:15:37

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-07-07 03:21:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-07 03:55:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-07 03:56:27

Changing status from new to needs_review.


---

Comment by @mjungmath created at 2021-07-07 21:30:16

This looks nice. Makes the access of these objects more natural. Good work!

Two things:

1. For some reason, there is no documentation of the class `RealSet`. That's a pity. It would be nice to add at least an `INPUT` block and explain the optional keyword(s). We should also shift the preexisting examples in `__init__` to the `RealSet` class documentation, where they can be seen from the official documentation.
2. Similarly it would be good to extend the `INPUT` block for each method with those new optional keywords accordingly (perhaps it is enough to refer to `RealSet`, once this is documented). A short example per method would be preferable, too.


---

Comment by git created at 2021-07-07 23:43:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-08 00:12:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-08 00:13:36

Thanks for taking a look, I'll work on the documentation.


---

Comment by mkoeppe created at 2021-07-08 00:13:36

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-07-08 02:12:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-08 02:46:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-08 04:23:27

Changing status from needs_work to needs_review.


---

Comment by git created at 2021-07-08 05:44:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-07-08 08:56:32

That is much better, thank you. Minor things:

- Perhaps it is good to clarify in the docstring that `RealSet` now acts as a constructor.
- I am not sure whether I like that `RealSet(0, 1, name='A')` returns a manifold object. This is too subtle imho. Perhaps an error message is more appropriate, explaining that e.g. `structure=differentiable` is necessary to pass in those cases?


---

Comment by mkoeppe created at 2021-07-08 14:31:53

Replying to [comment:23 gh-mjungmath]:
> I am not sure whether I like that `RealSet(0, 1, name='A')` returns a manifold object. This is too subtle imho. Perhaps an error message is more appropriate, explaining that e.g. `structure=differentiable` is necessary to pass in those cases?

I agree that triggering it with `name` and `latex_name` may be too subtle.

OTOH, I think if `ambient` is passed, `structure` should be implied.

How about the parameters `coordinate`, `names`, `start_index`?


---

Comment by egourgoulhon created at 2021-07-08 14:51:32

Replying to [comment:24 mkoeppe]:
> Replying to [comment:23 gh-mjungmath]:
> > I am not sure whether I like that `RealSet(0, 1, name='A')` returns a manifold object. This is too subtle imho. Perhaps an error message is more appropriate, explaining that e.g. `structure=differentiable` is necessary to pass in those cases?
> 
> I agree that triggering it with `name` and `latex_name` may be too subtle.
> 
> OTOH, I think if `ambient` is passed, `structure` should be implied.
> 
> How about the parameters `coordinate`, `names`, `start_index`?
> 

In connection to this, having something like `R.<t> = RealLine()` was very handy, especially when dealing with curves on manifolds. How do you plan to replace it with the `RealSet` syntax?


---

Comment by @mjungmath created at 2021-07-08 15:17:58

Replying to [comment:24 mkoeppe]:
> Replying to [comment:23 gh-mjungmath]:
> > I am not sure whether I like that `RealSet(0, 1, name='A')` returns a manifold object. This is too subtle imho. Perhaps an error message is more appropriate, explaining that e.g. `structure=differentiable` is necessary to pass in those cases?
> 
> I agree that triggering it with `name` and `latex_name` may be too subtle.
> 
> OTOH, I think if `ambient` is passed, `structure` should be implied.

I am torn on that one but I tend to agree.

> 
> How about the parameters `coordinate`, `names`, `start_index`?
> 

`coordinate` should be clear but the rest seems similarly ambiguous to me.


---

Comment by mkoeppe created at 2021-07-08 16:12:26

Replying to [comment:25 egourgoulhon]:
> having something like `R.<t> = RealLine()` was very handy, especially when dealing with curves on manifolds. How do you plan to replace it with the `RealSet` syntax?

Strangely, `RealSet` does not have a shortcut constructor for the whole real line - one has to write `RealSet(-oo, oo)`. 

We can add one here on this ticket. `RealSet.real_line()`, `RealSet.universe()`, ...? Any preference?


---

Comment by mkoeppe created at 2021-07-08 16:17:40

Replying to [comment:26 gh-mjungmath]:
> > How about the parameters `coordinate`, `names`, `start_index`?
> 
> `coordinate` should be clear but the rest seems similarly ambiguous to me.

Well, `names` is for the generator syntax, so it would be rather convenient for it to trigger manifold construction


---

Comment by git created at 2021-07-08 16:26:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-07-09 07:44:21

Replying to [comment:29 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[b9b7983](https://git.sagemath.org/sage.git/commit/?id=b9b798345c01edab8bc1c1d09b634068ab8da808)||`RealSet: Minor edits to docstring`||
> ||[4f57a29](https://git.sagemath.org/sage.git/commit/?id=4f57a29edd4ad4b77690ddd94f18cf9d8d7c6417)||`RealSet: Restrict keywords that trigger manifold construction`||

The explanation in the `INPUT` block should now be modified accordingly, mentioning that (only) `ambient`, `coordinate`, `names` trigger manifold constructions without imposing `structure=differentiable`.

Perhaps an example where the new error message is invoked might be a good idea, too.

Replying to [comment:27 mkoeppe]:
> We can add one here on this ticket. `RealSet.real_line()`, `RealSet.universe()`, ...? Any preference? 

I like both. But to keep some similarity with the previous constructor name `RealLine`, I'd say `RealSet.real_line()` should definitely be on the list.


---

Comment by egourgoulhon created at 2021-07-09 15:23:04

Replying to [comment:30 gh-mjungmath]:
> Replying to [comment:27 mkoeppe]:
> > We can add one here on this ticket. `RealSet.real_line()`, `RealSet.universe()`, ...? Any preference? 
> 
> I like both. But to keep some similarity with the previous constructor name `RealLine`, I'd say `RealSet.real_line()` should definitely be on the list.

+1


---

Comment by git created at 2021-07-09 16:20:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-07-09 16:59:24

Two comments:


```diff
     - ``structure`` -- (default: ``None``) if ``None``, construct the real set as an
       instance of :class:`RealSet`; if ``"differentiable"``, construct it as a subset of
-      the differentiable manifold.
+      the differentiable manifold `\RR`.
```


An example a la


```
sage: R.<ξ> = RealSet.real_line(); R
...
```


would be nice, too.


---

Comment by @mjungmath created at 2021-07-09 16:59:57

Other than that, LGTM. Eric? Any comments from your side?


---

Comment by git created at 2021-07-09 17:11:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-09 17:17:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-07-09 22:20:21

Ready for review?


---

Comment by mkoeppe created at 2021-07-09 22:27:35

Yes


---

Comment by @mjungmath created at 2021-07-09 22:32:18

It looks like we have to play patchbot ourselves now. I'll run the branch tomorrow (CET) on my computer.


---

Comment by @mjungmath created at 2021-07-10 12:54:45

Docbuild seems not to be satisfied:


```
[dochtml] [manifolds] /home/michael/GitProjects/sage-devel/local/lib/python3.8/site-packages/matplotlib/sphinxext/plot_directive.py:472: DeprecationWarning:
[dochtml] [manifolds] Importing RealLine from here is deprecated. If you need to use it, please import it directly from sage.manifolds.differentiable.examples.real_line
[dochtml] [manifolds] See https://trac.sagemath.org/31881 for details.
[dochtml] [manifolds]   exec(code, ns)
[dochtml] [manifolds] <unknown>:954: DeprecationWarning: invalid escape sequence \|
```



---

Comment by @mjungmath created at 2021-07-10 13:13:50

Among other things, the doctest returns


```
File "src/sage/interfaces/sympy_wrapper.py", line 71, in sage.interfaces.sympy_wrapper.SageSet._sage_
Failed example:
    sF = F._sympy_(); sF
Expected:
    SageSet({1, 2})
Got:
    Set(1, 2)
```


Is that related to #32089?


---

Comment by git created at 2021-07-10 17:18:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-10 17:19:46

Yes, just fixed this in #32015. Merged now via updated #32089. Thanks for testing!


---

Comment by @mjungmath created at 2021-07-11 19:26:17

Patchbot is back! Most of its issues seem unrelated to this ticket, tho.

What about the docbuild warning in comment:40?


---

Comment by git created at 2021-07-11 21:55:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-11 21:56:20

Replying to [comment:43 mkoeppe]:
> Yes, just fixed this in #32015. Merged now via updated #32089. Thanks for testing!
actually, now it's merged


---

Comment by git created at 2021-07-11 22:32:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-07-12 09:36:56

As soon as the warning in comment:40 is removed, I give a positive review.

It looks like `RealLine` is still imported via the global namespace in one of the examples?


---

Comment by git created at 2021-07-12 14:59:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-07-13 00:45:54

Changing status from needs_review to needs_work.


---

Comment by @mjungmath created at 2021-07-13 00:45:54


```diff
-        Returns the symmetric difference of ``self`` and ``other``.
+        Return the symmetric difference of ``self`` and ``other``.
```


See https://wiki.sagemath.org/plugins#blocks.


---

Comment by tscrim created at 2021-07-13 00:48:42

That is just coming along for the ride with moving things, and even if not, it is very minor that I would not hold up a positive review for it.


---

Comment by tscrim created at 2021-07-13 00:48:42

Changing status from needs_work to needs_review.


---

Comment by @mjungmath created at 2021-07-13 00:53:42

It's good to maintain some consistency. Besides, the patchbot doesn't like it. So it must be of some importance.

I am just afraid: if we don't fix it here, we probably will never...


---

Comment by tscrim created at 2021-07-13 00:58:23

You can push a review commit or do a general cleanup ticket later on. It is there in the patchbot as advice to the reviewer. You have some discretion about these things.


---

Comment by @mjungmath created at 2021-07-13 09:24:27

Changing status from needs_review to positive_review.


---

Comment by @mjungmath created at 2021-07-13 09:24:27

As proposed by Travis, here is a clean-up follow-up ticket: #32192.

LGTM.


---

Comment by mkoeppe created at 2021-07-13 16:28:18

Thanks!


---

Comment by vbraun created at 2021-07-23 23:27:10

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2021-07-23 23:27:10

PDF docs don't build


---

Comment by git created at 2021-07-23 23:32:06

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2021-07-23 23:33:50

Works for me after merging the lastest versions of the dependencies


---

Comment by mkoeppe created at 2021-07-23 23:33:50

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-07-24 21:18:58

Still borked. Make sure you merge in the next beta before changing the state again.


---

Comment by vbraun created at 2021-07-24 21:18:58

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-24 22:47:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-24 22:47:40

OK, found it, fixed it


---

Comment by mkoeppe created at 2021-07-24 22:47:40

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-07-25 13:26:29

Resolution: fixed
