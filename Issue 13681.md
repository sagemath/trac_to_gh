# Issue 13681: Fix optional magma tests.

Issue created by migration from Trac.

Original creator: robertwb

Original creation time: 2012-12-29 23:32:47

Assignee: was

CC:  vdelecroix slelievre

There are, once again, a huge number of failures.


---

Comment by robertwb created at 2012-12-30 00:57:40

So this doesn't happen again, re-enable these via #13540.


```
egrep -l -r 'optional.*magma' devel/sage/sage | egrep '\.pyx?' | xargs ./sage -tp 10 --only-optional=magma
[...]
	sage -t --only-optional=magma devel/sage/sage/rings/number_field/number_field_element.pyx # 2 doctests failed
	sage -t --only-optional=magma devel/sage/sage/rings/polynomial/multi_polynomial_sequence.py # 1 doctests failed
	sage -t --only-optional=magma devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py # 1 doctests failed
	sage -t --only-optional=magma devel/sage/sage/rings/number_field/number_field.py # 4 doctests failed
	sage -t --only-optional=magma devel/sage/sage/coding/linear_code.py # 1 doctests failed
	sage -t --only-optional=magma devel/sage/sage/rings/polynomial/pbori.pyx # 3 doctests failed
	sage -t --only-optional=magma devel/sage/sage/crypto/mq/mpolynomialsystem.py # 1 doctests failed
	sage -t --only-optional=magma devel/sage/sage/algebras/quatalg/quaternion_algebra.py # 2 doctests failed
	sage -t --only-optional=magma devel/sage/sage/rings/polynomial/term_order.py # 1 doctests failed
	sage -t --only-optional=magma devel/sage/sage/rings/polynomial/multi_polynomial_ring_generic.pyx # 5 doctests failed
	sage -t --only-optional=magma devel/sage/sage/schemes/plane_conics/con_field.py # 14 doctests failed
	sage -t --only-optional=magma devel/sage/sage/rings/integer_ring.pyx # 1 doctests failed
	sage -t --only-optional=magma devel/sage/sage/interfaces/magma.py # 20 doctests failed
	sage -t --only-optional=magma devel/sage/sage/schemes/plane_conics/con_number_field.py # 1 doctests failed
```



---

Comment by jdemeyer created at 2015-06-23 13:49:26

Changing component from interfaces to interfaces: optional.


---

Comment by mmasdeu created at 2016-04-15 08:32:03

I think this is more like a problem with the testing framework. Here is a sample block that fails the test:

```
sage: C = codes.HammingCode(3,GF(2))
sage: Cm = magma(C)                 # optional - magma, indirect doctest
sage: Cm.MinimumWeight()            # optional - magma
3
```


The problem with this (and I suspect most of the others) is that when the ``--only-optional=magma`` flag prevents the first line in the block above to get executed, and thus C remains undefined and causes a failure in the second line.

I think that having to write the ``# optional - magma`` thing in each line of a block is quite awful. It would be better that the ``--only-optional=magma`` flag ran (in full) those blocks containing at least one ``# optional - magma`` line.

I don't know how to do this myself, though...


---

Comment by vdelecroix created at 2016-04-15 12:56:16

The proper way to run magma doctest is with `sage -t -optional=magma,sage`. The optional `sage` applies to line without `# optional`.


---

Comment by leif created at 2016-08-29 16:21:19

Changing status from new to needs_info.


---

Comment by leif created at 2016-08-29 16:21:19

Replying to [comment:9 vdelecroix]:
> The proper way to run magma doctest is with `sage -t -optional=magma,sage`. The optional `sage` applies to line without `# optional`.

Is this documented well?

----

Is there still a problem, or can we close this ticket?  (I think I've seen some more recent one regarding the Magma interface, but I'm not sure.)


---

Comment by leif created at 2016-08-29 16:21:19

Changing keywords from "" to "interface pexpect doctesting".


---

Comment by slelievre created at 2016-08-30 07:47:52

Such more recent tickets might include

- #16322 Magma doctest failures
- #17235 magma failing tests
- #18558 Test all installed optional packages by default
- #20182 Automatic doctest for external softwares
- #20388 Fix the Magma interface to work with remote installations
- #20816 pep8 in magma interface

See also trac queries
- [keywords contains magma](https://trac.sagemath.org/query?order=id&desc=1&keywords=~magma)
- [summary contains magma](https://trac.sagemath.org/query?order=id&desc=1&summary=~magma)

I can't answer `@`leif's questions, but someone should.


---

Comment by slelievre created at 2016-08-30 07:47:52

Changing keywords from "interface pexpect doctesting" to "interface, pexpect, doctesting, magma".
