# Issue 30530: Test ticket: Python 3.10 development releases

Issue created by migration from https://trac.sagemath.org/ticket/30767

Original creator: slelievre

Original creation time: 2020-10-13 21:43:21

CC:  mkoeppe slelievre embray dimpase fbissey arojas isuruf




---

Comment by slelievre created at 2020-10-13 22:05:12

Python 3.10.0a1 was released on 2020-10-05.

- https://www.python.org/downloads/release/python-3100a1/


---

Comment by slelievre created at 2020-10-13 22:05:12

Changing type from PLEASE CHANGE to task.


---

Comment by slelievre created at 2020-10-13 22:05:12

Changing keywords from "" to "upgrade, python".


---

Comment by slelievre created at 2020-10-13 22:05:12

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by slelievre created at 2021-04-06 22:03:45

Python 3.10.0a7 was released on 2021-04-05.

- [Python 3.10.0a7](https://www.python.org/downloads/release/python-3100a7/)
- [announcement on python-announce](https://mail.python.org/archives/list/python-announce-list`@`python.org/thread/G2J3SBJ4EOW6MQZZJQNTXKHRWTAVBMKP/)

> The next pre-release of Python 3.10 will be 3.10.0b1
> (the first beta release and feature freeze),
> currently scheduled for Monday, 2021-05-03.


---

Comment by mkoeppe created at 2021-05-12 01:19:21

New commits:


---

Comment by mkoeppe created at 2021-05-12 01:21:09

`cygwin-readline.patch` no longer applies


---

Comment by git created at 2021-05-24 23:27:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-25 00:44:12

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-07-26 20:38:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-16 00:06:03

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2021-09-16 00:32:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-16 02:17:47

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-09-16 05:30:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-16 15:18:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-09-16 16:24:17

Numerous build problems of the `python3` packages on the CI run, for example `ubuntu-focal-minimal` (https://github.com/mkoeppe/sage/runs/3616910861?check_suite_focus=true)

```
  [python3-3.10.0rc1] error installing, exit status 1. End of log file:
  [python3-3.10.0rc1]       from _ctypes import Union, Structure, Array
  [python3-3.10.0rc1]   ModuleNotFoundError: No module named '_ctypes'
  [python3-3.10.0rc1]   ctypes module failed to import
  [python3-3.10.0rc1]   math module imported OK
  [python3-3.10.0rc1]   hashlib module imported OK
  [python3-3.10.0rc1]   crypt module imported OK
  [python3-3.10.0rc1]   socket module imported OK
  [python3-3.10.0rc1]   Traceback (most recent call last):
  [python3-3.10.0rc1]     File "<string>", line 1, in <module>
  [python3-3.10.0rc1]   ModuleNotFoundError: No module named 'zlib'
  [python3-3.10.0rc1]   zlib module failed to import
  [python3-3.10.0rc1]   Traceback (most recent call last):
  [python3-3.10.0rc1]     File "<string>", line 1, in <module>
  [python3-3.10.0rc1]     File "/sage/local/var/lib/sage/venv-python3.10.0rc1/var/tmp/sage/build/python3-3.10.0rc1/src/Lib/sqlite3/__init__.py", line 23, in <module>
  [python3-3.10.0rc1]       from sqlite3.dbapi2 import *
  [python3-3.10.0rc1]     File "/sage/local/var/lib/sage/venv-python3.10.0rc1/var/tmp/sage/build/python3-3.10.0rc1/src/Lib/sqlite3/dbapi2.py", line 27, in <module>
  [python3-3.10.0rc1]       from _sqlite3 import *
  [python3-3.10.0rc1]   ModuleNotFoundError: No module named '_sqlite3'
  [python3-3.10.0rc1]   sqlite3 module failed to import
  [python3-3.10.0rc1]   Error: One or more modules failed to import.
```



---

Comment by mkoeppe created at 2021-09-16 16:45:18

On `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/3616910778?check_suite_focus=true)

```
  [setuptools-58.0.2]   gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.12) 
  [setuptools-58.0.2]   ****************************************************
  [setuptools-58.0.2]   Package 'setuptools' is currently not installed
  [setuptools-58.0.2]   No legacy uninstaller found for 'setuptools'; nothing to do
  [setuptools-58.0.2]   python3: error while loading shared libraries: libpython3.10.so.1.0: cannot open shared object file: No such file or directory
  [setuptools-58.0.2]   ********************************************************************************
  [setuptools-58.0.2]   Error building / installing setuptools for Python
```



---

Comment by mkoeppe created at 2021-09-17 19:33:14

Run of optional packages in https://github.com/mkoeppe/sage/actions/runs/1239984514 shows a failure of python_igraph-0.8.3 on `debian-buster`; but this package is being upgraded anyway in #32510


---

Comment by git created at 2021-09-28 19:44:35

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-09-28 21:05:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-28 21:10:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-05 05:39:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by enriqueartal created at 2021-11-04 15:43:49

With fedora 35, using the branch of this ticket or develop (with a change in configure to use system python3.10) with updated packages for cysignals and gmpy2, I have an error in pyzmq, see #31855


---

Comment by enriqueartal created at 2021-11-07 00:20:46

The error in pyzmq is not gone, see #32828. With a workaround I could build a version with this branch (merged with last develop). Some folders that used to be in  `$SAGE_ROOT/local/share` are now in `$SAGE_ROOT/local/var/lib/sage/venv-python3.10/share`. The test yield these errors:

- Related with `cysignals`:

```
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 9 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/polynomial/polynomial_zmod_flint.pyx  # Timed out
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/function_field/function_field.py  # Timed out
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/doctest/test.py  # 25 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/tests/cmdline.py  # 4 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/misc/sageinspect.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/abvar/abvar.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/hecke/submodule.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/pari.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/structure/unique_representation.py  # 1 doctest failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/modular/modform/numerical.py  # 3 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/cpython/atexit.pyx  # 6 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/cpython/atexit.pyx  # 6 doctests failed
```

- Related with `giac`:

```
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/libs/giac/__init__.py  # 13 doctests failed
```

- Round problem:

```
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/plot/colors.py  # 5 doctests failed
```

- Misc:

```
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/schemes/elliptic_curves/lseries_ell.py  # 3 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage_docbuild/utils.py  # 2 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/lfunctions/lcalc.py  # 2 doctests failed
sage -t --long --random-seed=212072384500939741616547276375662149298 src/sage/symbolic/callable.py  # 5 doctests failed
```



---

Comment by enriqueartal created at 2021-11-07 20:25:54

A minor thing, executing `sage` (with python3.10) I get 

```
/usr/local/sage-310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/prompt_toolkit/application/application.py:882: DeprecationWarning: There is no current event loop
  loop = get_event_loop()
```

which continues after each execution. It can be stopped easily but it seems that in upstream prompt_toolkit the last version solves it.


---

Comment by enriqueartal created at 2021-11-28 20:57:49

I am not sure if it is the right place. Building sage with Python 3.10 (both system package and spkg) is quite usable. I built two such copies from the branch of this ticket merged with develop, #32037, #32797, #32828, #32885, #32930, and cysignals-1.11.0 in Fedora 35. It is quite usable, but sometimes when testing I get

```
./sage -t --warn-long 27.9 --random-seed=256577300716008523412470069515290642338 src/sage/interfaces/singular.py
Running doctests with ID 2021-11-28-21-54-01-676c34d4.
Git branch: python310
Using --optional=build,database_knotinfo,dochtml,fedora,gap_packages,libsemigroups,notedown,pandoc_attributes,pip,rst2ipynb,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg,sirocco
Doctesting 1 file.
------------------------------------------------------------------------
/usr/local/sage310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x8704)[0x7f0043bf8704]
/usr/local/sage310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x87b9)[0x7f0043bf87b9]
/usr/local/sage310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0xb4b2)[0x7f0043bfb4b2]
/lib64/libc.so.6(+0x42760)[0x7f004b741760]
/usr/local/sage310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x6b45)[0x7f00441cbb45]
/usr/local/sage310/local/var/lib/sage/venv-python3.10/lib64/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x55c6)[0x7f00441ca5c6]
/lib64/libpython3.10.so.1.0(+0x1152d1)[0x7f004ba1e2d1]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x2b3f)[0x7f004ba1470f]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyObject_FastCallDictTstate+0xa1)[0x7f004ba1a801]
/lib64/libpython3.10.so.1.0(_PyObject_Call_Prepend+0x6c)[0x7f004ba260dc]
/lib64/libpython3.10.so.1.0(+0x1bc8d2)[0x7f004bac58d2]
/lib64/libpython3.10.so.1.0(_PyObject_MakeTpCall+0x84)[0x7f004ba1afb4]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x571e)[0x7f004ba172ee]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x651)[0x7f004ba12221]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(+0x11e8a8)[0x7f004ba278a8]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x1637)[0x7f004ba13207]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x651)[0x7f004ba12221]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyObject_FastCallDictTstate+0xa1)[0x7f004ba1a801]
/lib64/libpython3.10.so.1.0(+0x11ced3)[0x7f004ba25ed3]
/lib64/libpython3.10.so.1.0(+0x112203)[0x7f004ba1b203]
/lib64/libpython3.10.so.1.0(_PyObject_MakeTpCall+0x84)[0x7f004ba1afb4]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x571e)[0x7f004ba172ee]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x54c9)[0x7f004ba17099]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x54c9)[0x7f004ba17099]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(+0x11e8a8)[0x7f004ba278a8]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x54c9)[0x7f004ba17099]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x651)[0x7f004ba12221]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x651)[0x7f004ba12221]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x651)[0x7f004ba12221]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x651)[0x7f004ba12221]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x651)[0x7f004ba12221]
/lib64/libpython3.10.so.1.0(+0x107e44)[0x7f004ba10e44]
/lib64/libpython3.10.so.1.0(PyEval_EvalCode+0x94)[0x7f004ba8be24]
/lib64/libpython3.10.so.1.0(+0x1b2bb4)[0x7f004babbbb4]
/lib64/libpython3.10.so.1.0(+0x1ae0d6)[0x7f004bab70d6]
/lib64/libpython3.10.so.1.0(+0x85a3c)[0x7f004b98ea3c]
/lib64/libpython3.10.so.1.0(_PyRun_SimpleFileObject+0x1b2)[0x7f004bab1792]
/lib64/libpython3.10.so.1.0(_PyRun_AnyFileObject+0x47)[0x7f004bab1527]
/lib64/libpython3.10.so.1.0(Py_RunMain+0x394)[0x7f004baae664]
/lib64/libpython3.10.so.1.0(Py_BytesMain+0x3d)[0x7f004ba7cfed]
/lib64/libc.so.6(+0x2d560)[0x7f004b72c560]
/lib64/libc.so.6(__libc_start_main+0x7c)[0x7f004b72c60c]
python3(_start+0x25)[0x562009404095]
------------------------------------------------------------------------
/usr/local/sage310/local/var/lib/sage/venv-python3.10/bin/cysignals-CSI:42: DeprecationWarning: The distutils package is deprecated and slated for removal in Python 3.12. Use setuptools or check PEP 632 for potential alternatives
  from distutils.spawn import find_executable
Attaching gdb to process id 3860228.
sage -t --warn-long 27.9 --random-seed=256577300716008523412470069515290642338 src/sage/interfaces/singular.py
```

These are the failed tests:

```
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/tests/cmdline.py  # Timed out
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/misc/sageinspect.py  # 1 doctest failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage_docbuild/utils.py  # 2 doctests failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/interfaces/singular.py  # 3 doctests failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/plot/colors.py  # 5 doctests failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/structure/unique_representation.py  # 1 doctest failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/libs/giac/__init__.py  # 7 doctests failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/symbolic/callable.py  # 5 doctests failed
sage -t --warn-long 40.4 --random-seed=144157399247145679142353539674578604879 src/sage/cpython/atexit.pyx  # 6 doctests failed
```

I uninstalled `fricas` since it produced plenty of errors.


---

Comment by mkoeppe created at 2021-11-28 21:16:38

Could you push your test branch to this ticket please? The branch that is on here is outdated


---

Comment by enriqueartal created at 2021-11-29 16:33:08

I just pushed it, merged with develop, #32037 (update lcal to solve some failed tests), #32576 (cysignals needed for Fedora 35), #32797 (update pari to solve some failed tests), #32828 (pymzq needed for Fedora 35), #32885 (use of, e.g., sage -installed), and #32930 (prompt_toolkit gave an annoying warning).
----
Last 10 new commits:


---

Comment by mkoeppe created at 2021-12-17 17:51:53

Let's reuse this ticket for an update to 3.10.x targeted for Sage 9.6


---

Comment by git created at 2021-12-18 00:33:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-01-30 23:27:27

Changing priority from major to critical.


---

Comment by git created at 2022-01-30 23:30:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-01-31 00:28:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-01-31 04:01:18

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-01-31 04:01:18

Works well on macOS Big Sur (x86_64), except for the following failures:

```
sage -t --long --random-seed=12626680743349969233570584009130839267 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 9875, in sage.symbolic.expression.Expression.log_gamma
Failed example:
    set_verbose(-1); plot(lambda x: SR(x).log_gamma(), -7,8, plot_points=1000).show()
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.expression.Expression.log_gamma[7]>", line 1, in <module>
        set_verbose(-Integer(1)); plot(lambda x: SR(x).log_gamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/misc/decorators.py", line 491, in wrapper
        return func(*args, **options)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/plot/plot.py", line 1982, in plot
        G = _plot(funcs, (xmin, xmax), *args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/plot/plot.py", line 2297, in _plot
        data, extra_excluded = generate_plot_points(
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/plot/plot.py", line 4011, in generate_plot_points
        for p in adaptive_refinement(f, data[i], data[i+1],
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/plot/plot.py", line 3807, in adaptive_refinement
        y = float(f(x))
      File "<doctest sage.symbolic.expression.Expression.log_gamma[7]>", line 1, in <lambda>
        set_verbose(-Integer(1)); plot(lambda x: SR(x).log_gamma(), -Integer(7),Integer(8), plot_points=Integer(1000)).show()
      File "sage/symbolic/expression.pyx", line 9893, in sage.symbolic.expression.Expression.log_gamma (build/cythonized/sage/symbolic/expression.cpp:77829)
        sig_on()
    SystemError: calling remove_from_pari_stack() inside sig_on()

sage -t --long --random-seed=12626680743349969233570584009130839267 src/sage/rings/polynomial/hilbert.pyx
**********************************************************************
File "src/sage/rings/polynomial/hilbert.pyx", line 581, in sage.rings.polynomial.hilbert.hilbert_poincare_series
Failed example:
    J.hilbert_numerator(algorithm='singular')
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.hilbert.hilbert_poincare_series[11]>", line 1, in <module>
        J.hilbert_numerator(algorithm='singular')
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 297, in __call__
        return self.f(self._instance, *args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/rings/qqbar_decorators.py", line 96, in wrapper
        return func(*args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 2900, in hilbert_numerator
        hs = hilb(gb, 1, attributes={gb: {'isSB': 1}})
      File "sage/libs/singular/function.pyx", line 1334, in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:15240)
        return call_function(self, args, ring, interruptible, attributes)
      File "sage/libs/singular/function.pyx", line 1532, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:17242)
        raise RuntimeError("error in Singular function call %r:\n%s" %
    RuntimeError: error in Singular function call 'hilb':
    int overflow in hilb 1

sage -t --long --random-seed=12626680743349969233570584009130839267 src/sage/modules/vector_real_double_dense.pyx
**********************************************************************
File "src/sage/modules/vector_real_double_dense.pyx", line 74, in sage.modules.vector_real_double_dense.Vector_real_double_dense.stats_skew
Failed example:
    v.stats_skew()
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modules.vector_real_double_dense.Vector_real_double_dense.stats_skew[1]>", line 1, in <module>
        v.stats_skew()
      File "sage/modules/vector_real_double_dense.pyx", line 77, in sage.modules.vector_real_double_dense.Vector_real_double_dense.stats_skew (build/cythonized/sage/modules/vector_real_double_dense.c:3138)
        import scipy.stats
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/scipy/stats/__init__.py", line 441, in <module>
        from .stats import *
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/scipy/stats/stats.py", line 43, in <module>
        from . import distributions
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/scipy/stats/distributions.py", line 10, in <module>
        from . import _continuous_distns
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/scipy/stats/_continuous_distns.py", line 29, in <module>
        from ._ksstats import kolmogn, kolmognp, kolmogni
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/lib/sage/venv-python3.9/lib/python3.10/site-packages/scipy/stats/_ksstats.py", line 74, in <module>
        _EP128 = np.ldexp(np.longdouble(1), _E128)
    RuntimeError: Could not parse python long as longdouble: 1 (Invalid argument)
```



---

Comment by mkoeppe created at 2022-02-05 16:28:17

(noise from merge scripts)


---

Comment by mkoeppe created at 2022-02-05 16:28:17

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-02-05 16:57:24

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-02-15 05:49:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-03-03 18:59:11

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-03-03 18:59:11


```
[python3-3.10.2]   Applying ../patches/0001-bpo-22699-Allow-compiling-on-debian-ubuntu-with-a-di.patch
  [python3-3.10.2]   patching file setup.py
  [python3-3.10.2]   Hunk #1 FAILED at 663.
  [python3-3.10.2]   1 out of 1 hunk FAILED -- saving rejects to file setup.py.rej
  [python3-3.10.2]   patching file setup.py
  [python3-3.10.2]   Hunk #1 succeeded at 798 (offset 60 lines).
  [python3-3.10.2]   Error applying '../patches/0001-bpo-22699-Allow-compiling-on-debian-ubuntu-with-a-di.patch'
```



---

Comment by mkoeppe created at 2022-03-03 19:41:52

That's from testing on top of #33055

`@`isuruf - do you have a version of this patch for Python 3.10?


---

Comment by isuruf created at 2022-03-03 19:53:25

First part of the patch for 3.10 is at https://github.com/conda-forge/python-feedstock/blob/master/recipe/patches/0008-bpo-22699-Allow-compiling-on-debian-ubuntu-with-a-di.patch


---

Comment by git created at 2022-03-03 20:23:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-03 20:23:10

Thanks!


---

Comment by mkoeppe created at 2022-03-03 23:47:43

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-03-06 06:41:56

tests look ok


---

Comment by mkoeppe created at 2022-03-07 17:25:11

Let's please get this in.


---

Comment by fbissey created at 2022-03-07 18:55:13

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2022-03-07 18:55:13

Been using and testing on 3.10 for a while - the only thing unknown to me is the debian/ubuntu patch. But I trust Isuru's work. So, let's move on.


---

Comment by mkoeppe created at 2022-03-07 19:19:41

Thanks!


---

Comment by vbraun created at 2022-03-09 23:38:37

Resolution: fixed
