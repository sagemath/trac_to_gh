# Issue 16061: Reenable Sphinx's lookup in the module in find_sage_dangling_links

Issue created by migration from https://trac.sagemath.org/ticket/16298

Original creator: nthiery

Original creation time: 2014-05-07 01:08:41

CC:  hivert jhpalmieri embray jdemeyer

IIRC, at some point Sphinx was configured (in find_sage_dangling_links) so that it was possible to reference a class/function/... as soon as it was imported in the module being documented, without having to specify a full path. Apparently this is broken (see e.g. [1]).

The steps to reproduce should be to put in a file something like:

```
"""
...

See :class:`Partition_class`
"""

from sage.combinat.partition import Partition_class
```

and relaunch the doc building with --warn-links, and typically
`dangling_debug = True` in `src.doc.common.conf.py`.

[1] http://trac.sagemath.org/ticket/10963#comment:775



---

Comment by jhpalmieri created at 2014-05-21 23:15:33

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2014-05-21 23:15:33

Here is an attempt at a fix.
----
New commits:


---

Comment by nthiery created at 2014-05-22 21:26:30

Thanks, I'll try this out!

By the way, a random though (most likely not for this specific ticket): to resolve dandling links we could possibly use the logic behind `import_statement` to lookup stuff anywhere in the Sage library (as long as there is no ambiguity of course).

Cheers,
                                     Nicolas


---

Comment by chapoton created at 2015-08-04 18:41:34

doc does not build


---

Comment by chapoton created at 2015-08-04 18:41:34

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-08-04 19:47:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-08-04 19:48:32

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2015-08-04 19:48:32

Does this help?


---

Comment by chapoton created at 2018-12-03 10:33:28

I just fixed the pyflakes warning
----
New commits:


---

Comment by embray created at 2019-01-07 16:17:10

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-01-07 16:17:10

Shame this has stalled for so long.


---

Comment by vbraun created at 2019-01-16 21:55:49

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-01-16 21:55:49

Documentation build errors out, see patchbot


---

Comment by git created at 2019-01-16 23:27:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2019-01-16 23:30:06

Turns out that we need to import `extlinks` from `sage.misc.sagedoc`. I believe this is used by the extension `sphinx.ext.extlinks`, although it is not used explicitly anywhere in the file `conf.py`. (I'm guessing that `pyflakes` may have said to remove that import, but then `pyflakes` would have been wrong.)


---

Comment by jhpalmieri created at 2019-01-16 23:30:06

Changing status from needs_work to positive_review.


---

Comment by embray created at 2019-01-18 10:32:52

`conf.py` contains lots of settings for Sphinx itself and many extensions.  It's not a normal Python module; rather it's imported by Sphinx.  It's just a programmable config file, so most stuff in there is not used "directly".  It definitely should be there.


---

Comment by git created at 2019-01-18 10:35:21

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-01-18 10:35:21

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by embray created at 2019-01-18 10:37:07

I rebased the branch and squashed out the offending mistake.  In general when fixing regressions that occur within the development of a branch it's best to remove those before setting positive review, so that there aren't broken commits within the commit history (to the extent practical).  Having bad commits in the final history is a pain when doing things like `git bisect` to find where otherwise uncaught regressions were introduced.


---

Comment by embray created at 2019-01-18 10:37:17

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2019-01-18 20:25:27

Good point. Thank you for taking care of that.


---

Comment by vbraun created at 2019-01-24 18:18:09

Resolution: fixed
