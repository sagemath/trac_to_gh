# Issue 22966: A polynomial ring contains its basering

Issue created by migration from Trac.

Original creator: saraedum

Original creation time: 2017-06-09 22:37:54

CC:  jpflori

Keywords: sd86.5

Currenty, this fails

```
sage: R.<x> = ZZ[]
sage: S.<y> = R[]
sage: R.is_subring(S)
NotImplementedError
```



---

Comment by saraedum created at 2017-06-09 23:26:40

Changing status from new to needs_review.


---

Comment by saraedum created at 2017-06-09 23:26:40

New commits:


---

Comment by saraedum created at 2017-06-09 23:27:01

(needs review: the `is_subring` does not work without #23204.)


---

Comment by tscrim created at 2017-06-23 00:06:42

While it is a degenerate case, a polynomial ring could be isomorphic to its base ring:

```
sage: PolynomialRing(ZZ, [])
Multivariate Polynomial Ring in no variables over Integer Ring
```



---

Comment by roed created at 2017-07-17 17:44:48

Changing keywords from "sd86.5" to "sd86.5, sd87".


---

Comment by git created at 2017-07-17 21:18:45

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-07-20 18:12:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2017-07-20 20:52:44

Full names in reviewer field please :)


---

Comment by cmt created at 2017-07-21 18:50:51

After fetching and merging #23204 into my local branch for this ticket, I built sage. I then ran `./sage -coverage <files>` for all the files listed in the diff for this ticket, and compared that to the results of running the same command for the latest build of develop (8.0 rc2). The same number of missing doctests occurred in each build for each file, and although the total number of doctests for `src/sage/rings/morphism.pyx` and `src/sage/rings/polynomial/polynomial_element.pyx` changed between the develop build and this build, this was to be expected given the number of methods deleted (`__nonzero__` and `is_zero`) and the number of trivial methods added (`is_injective` and (`is_surjective`), respectively. So, it appears that functionally the doctest coverage remained the same.

I am still within the (lengthly) process of running `./sage -tp 8 --long src/` now. It has produced some errors, which I will attempt to replicate before posting about them. Running all of the doctests may have been a mistake... I will also retry a more limited set of doctests shortly as well.


---

Comment by aly.deines created at 2017-07-21 18:58:26

I just updated #23204 to fix typos in two of the doctest.  If you are getting a two failures, you might try checking out the updated ticket.

Replying to [comment:16 cmt]:
> After fetching and merging #23204 into my local branch for this ticket, I built sage. I then ran `./sage -coverage <files>` for all the files listed in the diff for this ticket, and compared that to the results of running the same command for the latest build of develop (8.0 rc2). The same number of missing doctests occurred in each build for each file, and although the total number of doctests for `src/sage/rings/morphism.pyx` and `src/sage/rings/polynomial/polynomial_element.pyx` changed between the develop build and this build, this was to be expected given the number of methods deleted (`__nonzero__` and `is_zero`) and the number of trivial methods added (`is_injective` and (`is_surjective`), respectively. So, it appears that functionally the doctest coverage remained the same.
> 
> I am still within the (lengthly) process of running `./sage -tp 8 --long src/` now. It has produced some errors, which I will attempt to replicate before posting about them. Running all of the doctests may have been a mistake... I will also retry a more limited set of doctests shortly as well.


---

Comment by cmt created at 2017-07-21 21:56:57

Okay, something in my configuration had gotten messed up, so I started over entirely. I just pulled the latest version of this branch (`5f99cf980c`), which has the content of #23204 already merged in, merged in the latest develop branch (`74b03027bc`), and rebuilt. I then ran the following limited set of doctests and got these results:


```bash
bash-3.2$ ./sage -tp 8 --long src/sage/structure/ src/sage/categories/ src/sage/rings/ src/sage/modular/ src/sage/schemes/

too few successful tests, not using stored timings
Running doctests with ID 2017-07-21-16-33-34-b8fb451a.
Git branch: t/23203/a_polynomial_ring_contains_its_basering
Using --optional=ccache,mpir,python2,sage
Sorting sources by runtime so that slower doctests are run first....
Doctesting 883 files using 8 threads.

...

sage -t --long src/sage/schemes/curves/projective_curve.py
**********************************************************************
File "src/sage/schemes/curves/projective_curve.py", line 1304, in sage.schemes.curves.projective_curve.ProjectivePlaneCurve.ordinary_model
Failed example:
    D = C.ordinary_model(); D # long time (2 seconds)
Exception raised:
    Traceback (most recent call last):
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.curves.projective_curve.ProjectivePlaneCurve.ordinary_model[8]>", line 1, in <module>
        D = C.ordinary_model(); D # long time (2 seconds)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/schemes/curves/projective_curve.py", line 1393, in ordinary_model
        emb = extension(C.singular_subscheme())
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/schemes/curves/projective_curve.py", line 1373, in extension
        pts = self.change_ring(F.embeddings(QQbar)[0]).rational_points()
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/schemes/generic/algebraic_scheme.py", line 1846, in change_ring
        I = [f.change_ring(R) for f in self.defining_polynomials()]
      File "sage/rings/polynomial/multi_polynomial.pyx", line 873, in sage.rings.polynomial.multi_polynomial.MPolynomial.change_ring (build/cythonized/sage/rings/polynomial/multi_polynomial.c:13133)
        return self.parent().change_ring(R)(self)
      File "sage/rings/polynomial/multi_polynomial_ring_generic.pyx", line 985, in sage.rings.polynomial.multi_polynomial_ring_generic.MPolynomialRing_generic.change_ring (build/cythonized/sage/rings/polynomial/multi_polynomial_ring_generic.c:15237)
        return PolynomialRing(base_ring, self.ngens(), names, order=order)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 438, in PolynomialRing
        raise TypeError('base_ring must be a ring')
    TypeError: base_ring must be a ring
**********************************************************************
File "src/sage/schemes/curves/projective_curve.py", line 1321, in sage.schemes.curves.projective_curve.ProjectivePlaneCurve.ordinary_model
Failed example:
    all([D.codomain().is_ordinary_singularity(Q) for Q in D.codomain().singular_points()]) # long time
Exception raised:
    Traceback (most recent call last):
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.curves.projective_curve.ProjectivePlaneCurve.ordinary_model[9]>", line 1, in <module>
        all([D.codomain().is_ordinary_singularity(Q) for Q in D.codomain().singular_points()]) # long time
    NameError: name 'D' is not defined
**********************************************************************
File "src/sage/schemes/curves/projective_curve.py", line 1329, in sage.schemes.curves.projective_curve.ProjectivePlaneCurve.ordinary_model
Failed example:
    C.ordinary_model() # long time (5 seconds)
Exception raised:
    Traceback (most recent call last):
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.curves.projective_curve.ProjectivePlaneCurve.ordinary_model[13]>", line 1, in <module>
        C.ordinary_model() # long time (5 seconds)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/schemes/curves/projective_curve.py", line 1393, in ordinary_model
        emb = extension(C.singular_subscheme())
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/schemes/curves/projective_curve.py", line 1373, in extension
        pts = self.change_ring(F.embeddings(QQbar)[0]).rational_points()
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/schemes/generic/algebraic_scheme.py", line 1846, in change_ring
        I = [f.change_ring(R) for f in self.defining_polynomials()]
      File "sage/rings/polynomial/multi_polynomial.pyx", line 873, in sage.rings.polynomial.multi_polynomial.MPolynomial.change_ring (build/cythonized/sage/rings/polynomial/multi_polynomial.c:13133)
        return self.parent().change_ring(R)(self)
      File "sage/rings/polynomial/multi_polynomial_ring_generic.pyx", line 985, in sage.rings.polynomial.multi_polynomial_ring_generic.MPolynomialRing_generic.change_ring (build/cythonized/sage/rings/polynomial/multi_polynomial_ring_generic.c:15237)
        return PolynomialRing(base_ring, self.ngens(), names, order=order)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py", line 438, in PolynomialRing
        raise TypeError('base_ring must be a ring')
    TypeError: base_ring must be a ring
**********************************************************************
1 item had failures:
   3 of  15 in sage.schemes.curves.projective_curve.ProjectivePlaneCurve.ordinary_model
    [328 tests, 3 failures, 65.69 s]

...

----------------------------------------------------------------------
sage -t --long src/sage/schemes/curves/projective_curve.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1958.8 seconds
    cpu time: 6272.7 seconds
    cumulative wall time: 15257.4 seconds
```


I also ran the same tests on the latest develop build (`74b03027bc`) and they passed, so it seems like there is still something to fix here. 

Since I think someone with fresh eyes should take a look at this ticket the next time it comes up for review, I am taking my name out of the reviewer field.


---

Comment by cmt created at 2017-07-21 22:05:51

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2017-07-21 22:31:35

cmt: Thanks for pointing this out. This is a problem in #23204. I'll fix it there.


---

Comment by saraedum created at 2017-07-21 22:42:08

Fixed in #23204.


---

Comment by saraedum created at 2017-07-22 02:17:20

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2017-07-22 02:18:31

Claire: We usually do not remove people from the Reviewers field, i.e., it is just a list of everybody that had a look at the ticket.


---

Comment by cmt created at 2017-07-22 14:27:30

Julian: Thanks, and my apologies! I didn't realize that was the convention.


---

Comment by cmt created at 2017-07-22 16:20:38

I just merged the latest version of #23204 (`382e2d1807`) into the latest version of this ticket (`5f99cf980c`), rebuilt, and reran the same limited set of tests (`./sage -tp 8 --long src/sage/structure/ src/sage/categories/ src/sage/rings/ src/sage/modular/ src/sage/schemes/`) which all passed!

I am now running all doctests.


---

Comment by cmt created at 2017-07-22 18:17:28

I just ran all tests in `src/sage` and produced only the following weird failed tests:


```bash
$ ./sage -tp 8 --long src/sage/
too few successful tests, not using stored timings
Running doctests with ID 2017-07-22-12-22-47-8f9951fd.
Git branch: t/23203/a_polynomial_ring_contains_its_basering
Using --optional=ccache,mpir,python2,sage
Sorting sources by runtime so that slower doctests are run first....
Doctesting 2969 files using 8 threads.

...

sage -t --long src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 814, in sage.tests.cmdline.test_executable
Failed example:
    test_executable(["sage", "--rst2sws", input, output])
Expected:
    (_, _, 0)
Got:
    ('',
     'Traceback (most recent call last):\n  File "/Sage/sage/src/bin/sage-rst2sws", line 131, in <module>\n    from sagenb.notebook.notebook import Notebook\n  File "/Sage/sage/local/lib/python2.7/site-packages/sagenb/notebook/notebook.py", line 46, in <module>\n    from . import js           # javascript\n  File "/Sage/sage/local/lib/python2.7/site-packages/sagenb/notebook/js.py", line 34, in <module>\n    from .compress.JavaScriptCompressor import JavaScriptCompressor\nImportError: No module named JavaScriptCompressor\n',
     1)
**********************************************************************
File "src/sage/tests/cmdline.py", line 817, in sage.tests.cmdline.test_executable
Failed example:
    f = tarfile.open(output, 'r')
Exception raised:
    Traceback (most recent call last):
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.cmdline.test_executable[242]>", line 1, in <module>
        f = tarfile.open(output, 'r')
      File "/Sage/sage/local/lib/python2.7/tarfile.py", line 1680, in open
        raise ReadError("file could not be opened successfully")
    ReadError: file could not be opened successfully
**********************************************************************
File "src/sage/tests/cmdline.py", line 818, in sage.tests.cmdline.test_executable
Failed example:
    print(f.extractfile('sage_worksheet/worksheet.html').read())
Exception raised:
    Traceback (most recent call last):
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.cmdline.test_executable[243]>", line 1, in <module>
        print(f.extractfile('sage_worksheet/worksheet.html').read())
    AttributeError: 'file' object has no attribute 'extractfile'
**********************************************************************
File "src/sage/tests/cmdline.py", line 832, in sage.tests.cmdline.test_executable
Failed example:
    print(f.extractfile('sage_worksheet/worksheet.txt').read())
Exception raised:
    Traceback (most recent call last):
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.cmdline.test_executable[244]>", line 1, in <module>
        print(f.extractfile('sage_worksheet/worksheet.txt').read())
    AttributeError: 'file' object has no attribute 'extractfile'
**********************************************************************
1 item had failures:
   4 of 246 in sage.tests.cmdline.test_executable
    [245 tests, 4 failures, 155.43 s]
----------------------------------------------------------------------
sage -t --long src/sage/tests/cmdline.py  # 4 doctests failed
----------------------------------------------------------------------
```


However! When I run these same doctests on my latest build of the develop branch (`74b03027bc`), the exact same tests also fail. 

Therefore, I'm going to positively review this ticket -- if others think this is a problem they are welcome to revert the status as they see fit.


---

Comment by cmt created at 2017-07-22 18:17:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-08-03 22:11:29

Resolution: fixed
