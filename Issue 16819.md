# Issue 16819: Bugs in WordDatatype_char

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2014-09-27 18:05:12

CC:  slabbe sstarosta tmonteil

There are two bugs with WordDatatype_char (new datastructure for words introduced in #17013):
- in `__dealloc__` we access a Python attribute... it is very bad since Cython is such that they are deallocated before the call to `__dealloc__`. In different situations sage terminates because of a memory corruption
- in `__getitem__` we had
  {{{
  sage: W = Words([0,1,2])
  sage: w = W([0,1,0])
  sage: w[:0]
  word: ... <RANDOM STUFF> ...
  }}}


---

Comment by vdelecroix created at 2014-09-27 18:06:58

New commits:


---

Comment by vdelecroix created at 2014-09-27 18:07:13

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2014-09-27 18:37:16

rebased on 6.4.beta4


---

Comment by git created at 2014-09-27 18:37:23

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slabbe created at 2014-09-27 20:05:41

With #17013, I can not reproduce the second problem:


```
sage: W = Words([0,1,2])
sage: w = W([0,1,0])
sage: w[:0]
word:
```


Also, can you provide an example so that I can reproduce the first problem?

SÃ©bastien


---

Comment by vdelecroix created at 2014-09-28 09:18:24

Hello,

Sorry, I was wrong it is `w[1:0]` which is bad.

For the problem with `__dealloc__`, you must be lucky to see it (as it depends on the choice of Python for the deallocation of objects). Try

```
sage: W = Words([0,1,2])
sage: w = W([randint(0,2) for _ in range(100)])
sage: u = w[10:-10]
sage: c = [u.number_of_factors(n) for n in range(20)]
sage: quit
<BOOM>
```


Vincent


---

Comment by slabbe created at 2014-09-28 17:54:09

Changing status from needs_review to needs_work.


---

Comment by slabbe created at 2014-09-28 17:54:09

Can you change the new doctest so that it tests `w[1:0]` instead?


---

Comment by slabbe created at 2014-09-28 18:42:37

Changing status from needs_work to positive_review.


---

Comment by slabbe created at 2014-09-28 18:42:37

New commits:


---

Comment by vdelecroix created at 2014-09-28 21:27:27

Ha nice. Thanks for the fix (I was out).

Vincent


---

Comment by vbraun created at 2014-09-29 11:17:38

Resolution: fixed
