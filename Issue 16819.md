# Issue 16819: Bugs in WordDatatype_char

archive/issues_016819.json:
```json
{
    "body": "CC:  @seblabbe @staroste tmonteil\n\nThere are two bugs with WordDatatype_char (new datastructure for words introduced in #17013):\n- in `__dealloc__` we access a Python attribute... it is very bad since Cython is such that they are deallocated before the call to `__dealloc__`. In different situations sage terminates because of a memory corruption\n- in `__getitem__` we had\n  {{{\n  sage: W = Words([0,1,2])\n  sage: w = W([0,1,0])\n  sage: w[:0]\n  word: ... <RANDOM STUFF> ...\n  }}}\n\nIssue created by migration from https://trac.sagemath.org/ticket/17056\n\n",
    "created_at": "2014-09-27T18:05:12Z",
    "labels": [
        "component: combinatorics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Bugs in WordDatatype_char",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16819",
    "user": "https://github.com/videlec"
}
```
CC:  @seblabbe @staroste tmonteil

There are two bugs with WordDatatype_char (new datastructure for words introduced in #17013):
- in `__dealloc__` we access a Python attribute... it is very bad since Cython is such that they are deallocated before the call to `__dealloc__`. In different situations sage terminates because of a memory corruption
- in `__getitem__` we had
  {{{
  sage: W = Words([0,1,2])
  sage: w = W([0,1,0])
  sage: w[:0]
  word: ... <RANDOM STUFF> ...
  }}}

Issue created by migration from https://trac.sagemath.org/ticket/17056





---

archive/issue_comments_222428.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-27T18:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222428",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_222429.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-27T18:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222429",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_222430.json:
```json
{
    "body": "rebased on 6.4.beta4",
    "created_at": "2014-09-27T18:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222430",
    "user": "https://github.com/videlec"
}
```

rebased on 6.4.beta4



---

archive/issue_comments_222431.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-27T18:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_222432.json:
```json
{
    "body": "With #17013, I can not reproduce the second problem:\n\n\n```\nsage: W = Words([0,1,2])\nsage: w = W([0,1,0])\nsage: w[:0]\nword:\n```\n\n\nAlso, can you provide an example so that I can reproduce the first problem?\n\nS\u00e9bastien",
    "created_at": "2014-09-27T20:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222432",
    "user": "https://github.com/seblabbe"
}
```

With #17013, I can not reproduce the second problem:


```
sage: W = Words([0,1,2])
sage: w = W([0,1,0])
sage: w[:0]
word:
```


Also, can you provide an example so that I can reproduce the first problem?

SÃ©bastien



---

archive/issue_comments_222433.json:
```json
{
    "body": "Hello,\n\nSorry, I was wrong it is `w[1:0]` which is bad.\n\nFor the problem with `__dealloc__`, you must be lucky to see it (as it depends on the choice of Python for the deallocation of objects). Try\n\n```\nsage: W = Words([0,1,2])\nsage: w = W([randint(0,2) for _ in range(100)])\nsage: u = w[10:-10]\nsage: c = [u.number_of_factors(n) for n in range(20)]\nsage: quit\n<BOOM>\n```\n\n\nVincent",
    "created_at": "2014-09-28T09:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222433",
    "user": "https://github.com/videlec"
}
```

Hello,

Sorry, I was wrong it is `w[1:0]` which is bad.

For the problem with `__dealloc__`, you must be lucky to see it (as it depends on the choice of Python for the deallocation of objects). Try

```
sage: W = Words([0,1,2])
sage: w = W([randint(0,2) for _ in range(100)])
sage: u = w[10:-10]
sage: c = [u.number_of_factors(n) for n in range(20)]
sage: quit
<BOOM>
```


Vincent



---

archive/issue_comments_222434.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-28T17:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222434",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_222435.json:
```json
{
    "body": "Can you change the new doctest so that it tests `w[1:0]` instead?",
    "created_at": "2014-09-28T17:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222435",
    "user": "https://github.com/seblabbe"
}
```

Can you change the new doctest so that it tests `w[1:0]` instead?



---

archive/issue_comments_222436.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-09-28T18:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222436",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_222437.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-28T18:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222437",
    "user": "https://github.com/seblabbe"
}
```

New commits:



---

archive/issue_comments_222438.json:
```json
{
    "body": "Ha nice. Thanks for the fix (I was out).\n\nVincent",
    "created_at": "2014-09-28T21:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222438",
    "user": "https://github.com/videlec"
}
```

Ha nice. Thanks for the fix (I was out).

Vincent



---

archive/issue_events_049615.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-29T11:17:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16819#event-49615"
}
```



---

archive/issue_comments_222439.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-29T11:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16819#issuecomment-222439",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
