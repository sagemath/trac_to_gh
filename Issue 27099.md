# Issue 27099: Fragile doctest in singular/polynomial.pyx

Issue created by migration from https://trac.sagemath.org/ticket/27336

Original creator: jhpalmieri

Original creation time: 2019-02-21 18:03:41

I often get failures with one doctest in `singular/polynomial.pyx`:

```
sage -t --long --warn-long 72.1 src/sage/libs/singular/polynomial.pyx
**********************************************************************
File "src/sage/libs/singular/polynomial.pyx", line 188, in sage.libs.singular.polynomial.singular_polynomial_call
Failed example:
    for i in range(30):  # long time
        n = leak(10000)
        print("Leaked {} bytes".format(n))
        if n == 0:
            zeros += 1
            if zeros >= 6:
                break
        else:
            zeros = 0
Expected:
    Leaked...
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
Got:
    Leaked 117503426560 bytes
    Leaked 348127232 bytes
    Leaked 335544320 bytes
    Leaked 318767104 bytes
    Leaked 0 bytes
    Leaked 322961408 bytes
    Leaked 0 bytes
    Leaked 318767104 bytes
    Leaked 331350016 bytes
    Leaked 335544320 bytes
    Leaked 322961408 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 327155712 bytes
    Leaked 0 bytes
    Leaked 58720256 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 339738624 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 343932928 bytes
    Leaked 339738624 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
    Leaked 0 bytes
**********************************************************************
1 item had failures:
   1 of  12 in sage.libs.singular.polynomial.singular_polynomial_call
    [55 tests, 1 failure, 862.63 s]
```

(This in on OS X.) Others have reported the same on [sage-release](https://groups.google.com/d/msg/sage-release/0QvdNonpGEg/YmYBpRQICwAJ). Let's try to make it less fragile.


---

Comment by justin created at 2019-02-21 21:51:48

I have seen this at least since the 6.5 sequence (b0 and rc0).  Not sure it was intermittent at that point.
It popped up again in the 8.4-8.7 sequences.
FWIW, the problem recurs, intermittently) if I test polynomial.pyx by itself, but in a loop (for i in a b c d...).

My current system is a fairly shiny new iMac Pro (18-core Xeon W, 128GB Ram, and 4TB SSD), so I think it's fairly speedy.  I typically build with "-j20", but I have seen this with "-j6".


---

Comment by jhpalmieri created at 2019-02-21 21:53:37

My failures are also with an iMac Pro, for what that's worth.


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by embray created at 2019-06-14 14:55:02

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).
