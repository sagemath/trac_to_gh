# Issue 24734: Very subtle preparser error in functions only

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2018-03-14 03:06:18

CC:  slelievre

Consider the following function and call:

```
def f():
    v = 1
    0 = p
    return p

f()
```

Naturally, the second line of the function is totally invalid Python.  But Sage allows it in this context (removing `v=1` makes the preparser know this is a problem) by instead raising a different, ***very confusing*** error:

```
      1 def f():
----> 2     v = Integer(1)
      3     __tmp__=var("0"); Integer = symbolic_expression(p).function(0)
      4     return p
      5 

UnboundLocalError: local variable 'Integer' referenced before assignment
```

I suspect that the only way this can occur is where the preparser somehow interprets `0 = p` as a function definition ala `f(x) = 3*x`, which is also invalid Python.  

But there is no parenthesis in the first part, so I find it a bit baffling and am too lazy to read the preparser code tonight.  Maybe somehow the preparser first says "preparse 0 - yes, that is Integer(0)" and then looks again and says "hey, that was a function called Integer!  Better preparse again".

Anyway, that should definitely be fixed.  Even though it's the first time I've run across it, I consider it pretty nasty.  If someone can figure out a "component" for the preparser, please change it.  Observed in [this ask.sagemath question](https://ask.sagemath.org/question/41524/local-variable-integer-referenced-before-assignment/).


---

Comment by jdemeyer created at 2018-03-14 06:22:49

This must happen because of double preparsing:

```
0 = p
```

becomes

```
Integer(0) = p
```

which is interpreted as a function definition of the function `Integer` in the variable `0`.


---

Comment by jdemeyer created at 2018-03-14 10:34:41

Changing priority from critical to major.


---

Comment by jdemeyer created at 2018-03-14 10:34:41

Changing component from PLEASE CHANGE to user interface.


---

Comment by slelievre created at 2020-10-09 13:44:17

Changing keywords from "" to "preparser".
