# Issue 24734: Very subtle preparser error in functions only

archive/issues_024734.json:
```json
{
    "body": "CC:  @slel\n\nConsider the following function and call:\n\n```\ndef f():\n    v = 1\n    0 = p\n    return p\n\nf()\n```\n\nNaturally, the second line of the function is totally invalid Python.  But Sage allows it in this context (removing `v=1` makes the preparser know this is a problem) by instead raising a different, ***very confusing*** error:\n\n```\n      1 def f():\n----> 2     v = Integer(1)\n      3     __tmp__=var(\"0\"); Integer = symbolic_expression(p).function(0)\n      4     return p\n      5 \n\nUnboundLocalError: local variable 'Integer' referenced before assignment\n```\n\nI suspect that the only way this can occur is where the preparser somehow interprets `0 = p` as a function definition ala `f(x) = 3*x`, which is also invalid Python.  \n\nBut there is no parenthesis in the first part, so I find it a bit baffling and am too lazy to read the preparser code tonight.  Maybe somehow the preparser first says \"preparse 0 - yes, that is Integer(0)\" and then looks again and says \"hey, that was a function called Integer!  Better preparse again\".\n\nAnyway, that should definitely be fixed.  Even though it's the first time I've run across it, I consider it pretty nasty.  If someone can figure out a \"component\" for the preparser, please change it.  Observed in [this ask.sagemath question](https://ask.sagemath.org/question/41524/local-variable-integer-referenced-before-assignment/).\n\nIssue created by migration from https://trac.sagemath.org/ticket/24971\n\n",
    "created_at": "2018-03-14T03:06:18Z",
    "labels": [
        "component: please change",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Very subtle preparser error in functions only",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24734",
    "user": "https://github.com/kcrisman"
}
```
CC:  @slel

Consider the following function and call:

```
def f():
    v = 1
    0 = p
    return p

f()
```

Naturally, the second line of the function is totally invalid Python.  But Sage allows it in this context (removing `v=1` makes the preparser know this is a problem) by instead raising a different, ***very confusing*** error:

```
      1 def f():
----> 2     v = Integer(1)
      3     __tmp__=var("0"); Integer = symbolic_expression(p).function(0)
      4     return p
      5 

UnboundLocalError: local variable 'Integer' referenced before assignment
```

I suspect that the only way this can occur is where the preparser somehow interprets `0 = p` as a function definition ala `f(x) = 3*x`, which is also invalid Python.  

But there is no parenthesis in the first part, so I find it a bit baffling and am too lazy to read the preparser code tonight.  Maybe somehow the preparser first says "preparse 0 - yes, that is Integer(0)" and then looks again and says "hey, that was a function called Integer!  Better preparse again".

Anyway, that should definitely be fixed.  Even though it's the first time I've run across it, I consider it pretty nasty.  If someone can figure out a "component" for the preparser, please change it.  Observed in [this ask.sagemath question](https://ask.sagemath.org/question/41524/local-variable-integer-referenced-before-assignment/).

Issue created by migration from https://trac.sagemath.org/ticket/24971





---

archive/issue_comments_346849.json:
```json
{
    "body": "This must happen because of double preparsing:\n\n```\n0 = p\n```\n\nbecomes\n\n```\nInteger(0) = p\n```\n\nwhich is interpreted as a function definition of the function `Integer` in the variable `0`.",
    "created_at": "2018-03-14T06:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24734#issuecomment-346849",
    "user": "https://github.com/jdemeyer"
}
```

This must happen because of double preparsing:

```
0 = p
```

becomes

```
Integer(0) = p
```

which is interpreted as a function definition of the function `Integer` in the variable `0`.



---

archive/issue_comments_346850.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to user interface.",
    "created_at": "2018-03-14T10:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24734#issuecomment-346850",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from PLEASE CHANGE to user interface.



---

archive/issue_comments_346851.json:
```json
{
    "body": "Changing keywords from \"\" to \"preparser\".",
    "created_at": "2020-10-09T13:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24734#issuecomment-346851",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "preparser".
