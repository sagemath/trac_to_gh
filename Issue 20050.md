# Issue 20050: Implement the Mooreâ€“Penrose pseudoinverse

archive/issues_020050.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/20287\n\n",
    "created_at": "2016-03-25T11:02:18Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Implement the Moore\u2013Penrose pseudoinverse",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20050",
    "user": "@jdemeyer"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/20287





---

archive/issue_comments_276191.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-25T13:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276191",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_276192.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-25T13:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276192",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_276193.json:
```json
{
    "body": "failing doctests, see bot report",
    "created_at": "2016-03-27T17:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276193",
    "user": "@fchapoton"
}
```

failing doctests, see bot report



---

archive/issue_comments_276194.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-27T17:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276194",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_276195.json:
```json
{
    "body": "A line number in the doc changed from less than 1000 to more than 1000 causing a 1-character shift.",
    "created_at": "2016-03-28T09:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276195",
    "user": "@jdemeyer"
}
```

A line number in the doc changed from less than 1000 to more than 1000 causing a 1-character shift.



---

archive/issue_comments_276196.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-28T09:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276196",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_276197.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-28T09:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276197",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_276198.json:
```json
{
    "body": "ok, looks good to me",
    "created_at": "2016-03-28T18:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276198",
    "user": "@fchapoton"
}
```

ok, looks good to me



---

archive/issue_comments_276199.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-28T18:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276199",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_276200.json:
```json
{
    "body": "Late to the party: is there any case where the inferred algorithm would not do the right thing, and the user would have to specify one?",
    "created_at": "2016-03-28T21:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276200",
    "user": "@orlitzky"
}
```

Late to the party: is there any case where the inferred algorithm would not do the right thing, and the user would have to specify one?



---

archive/issue_comments_276201.json:
```json
{
    "body": "Replying to [comment:11 mjo]:\n> Late to the party: is there any case where the inferred algorithm would not do the right thing, and the user would have to specify one?\n\nI don't think that there are cases where the is a better choice than the default one. However, there might be cases where there is no suitable algorithm at all.",
    "created_at": "2016-03-29T06:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276201",
    "user": "@jdemeyer"
}
```

Replying to [comment:11 mjo]:
> Late to the party: is there any case where the inferred algorithm would not do the right thing, and the user would have to specify one?

I don't think that there are cases where the is a better choice than the default one. However, there might be cases where there is no suitable algorithm at all.



---

archive/issue_comments_276202.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-03-29T07:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276202",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_276203.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-03-29T07:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276203",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_276204.json:
```json
{
    "body": "I had to mark one test as `random` due to numerical noise.",
    "created_at": "2016-03-29T07:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276204",
    "user": "@jdemeyer"
}
```

I had to mark one test as `random` due to numerical noise.



---

archive/issue_comments_276205.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-29T07:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276205",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_276206.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> \n> I don't think that there are cases where the is a better choice than the default one. However, there might be cases where there is no suitable algorithm at all.\n\nThen why offer the choice? I ask because, if you remove the `algorithm` parameter, it looks like a matrix superclass method is trying to figure out what to do by a \"what subclass am I\" heuristic. In that case, if the matrix class hierarchy is good enough, it might make more sense to move the subclass-specific behavior into subclass methods.\n\nFor example, the default `Matrix` would implement the \"exact\" or \"exactconj\" algorithms. (Is there a situation where \"exactconj\" does the wrong thing on a real matrix?) In `Matrix_real_double_dense` and `Matrix_complex_double_dense`, you would call numpy. In `Matrix_generic_dense`, you would do the precision check and either call numpy or raise an error. Et cetera. On the other hand, if the matrix hierarchy would make you copy/paste the same implementation around, forget I said anything.\n\nLater on if we get an SVD that works for RR/CC, we can just add it to override the naive algorithm in those subclasses. With `algorithm` in the function signature, we have to worry about breaking the user interface with those changes.",
    "created_at": "2016-03-29T12:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276206",
    "user": "@orlitzky"
}
```

Replying to [comment:12 jdemeyer]:
> 
> I don't think that there are cases where the is a better choice than the default one. However, there might be cases where there is no suitable algorithm at all.

Then why offer the choice? I ask because, if you remove the `algorithm` parameter, it looks like a matrix superclass method is trying to figure out what to do by a "what subclass am I" heuristic. In that case, if the matrix class hierarchy is good enough, it might make more sense to move the subclass-specific behavior into subclass methods.

For example, the default `Matrix` would implement the "exact" or "exactconj" algorithms. (Is there a situation where "exactconj" does the wrong thing on a real matrix?) In `Matrix_real_double_dense` and `Matrix_complex_double_dense`, you would call numpy. In `Matrix_generic_dense`, you would do the precision check and either call numpy or raise an error. Et cetera. On the other hand, if the matrix hierarchy would make you copy/paste the same implementation around, forget I said anything.

Later on if we get an SVD that works for RR/CC, we can just add it to override the naive algorithm in those subclasses. With `algorithm` in the function signature, we have to worry about breaking the user interface with those changes.



---

archive/issue_comments_276207.json:
```json
{
    "body": "Replying to [comment:15 mjo]:\n> Then why offer the choice?\nGeneral principle: because I see no reason to *not* offer the choice. If a choice is available, why not allow the user to override that choice? Of course, offer a good default.\n\nMore specifically: it might be hard to guess between `exact` and `exactconj`.\n\n> I ask because, if you remove the `algorithm` parameter, it looks like a matrix superclass method is trying to figure out what to do by a \"what subclass am I\" heuristic.\nI disagree completely. This has nothing to do with the `type()` of the matrix, but with the mathematical properties of the parent.\n\nWith your proposal, `pseudoinverse()` would no longer work for matrices over `RR` or `CC` or for sparse matrices.",
    "created_at": "2016-03-29T13:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276207",
    "user": "@jdemeyer"
}
```

Replying to [comment:15 mjo]:
> Then why offer the choice?
General principle: because I see no reason to *not* offer the choice. If a choice is available, why not allow the user to override that choice? Of course, offer a good default.

More specifically: it might be hard to guess between `exact` and `exactconj`.

> I ask because, if you remove the `algorithm` parameter, it looks like a matrix superclass method is trying to figure out what to do by a "what subclass am I" heuristic.
I disagree completely. This has nothing to do with the `type()` of the matrix, but with the mathematical properties of the parent.

With your proposal, `pseudoinverse()` would no longer work for matrices over `RR` or `CC` or for sparse matrices.



---

archive/issue_comments_276208.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> General principle: because I see no reason to *not* offer the choice. If a choice is available, why not allow the user to override that choice? Of course, offer a good default.\n\nI generally agree, but I wanted to be sure that the choice we're giving the user isn't `do_it_wrong=True`. If the default always does the right thing, and one of the other algorithms might not, then it's just noise in the docstring. And we'd have to go through a deprecation cycle to change it in the future.\n\n> I disagree completely. This has nothing to do with the `type()` of the matrix, but with the mathematical properties of the parent.\n\nFair enough, but the resulting type of the matrix is determined by the ring that you pass in (and whether or not it's sparse).\n\n> With your proposal, `pseudoinverse()` would no longer work for matrices over `RR` or `CC` or for sparse matrices.\n\nYou would at least get the exact(conj) implementation in every case. But you would have to override that in every subclass where it makes sense, like the generic_dense ones for RR/CC. If that's difficult or results in code duplication, then it's fine as-is. I just brought it up in case you hadn't considered it.",
    "created_at": "2016-03-29T13:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276208",
    "user": "@orlitzky"
}
```

Replying to [comment:16 jdemeyer]:
> General principle: because I see no reason to *not* offer the choice. If a choice is available, why not allow the user to override that choice? Of course, offer a good default.

I generally agree, but I wanted to be sure that the choice we're giving the user isn't `do_it_wrong=True`. If the default always does the right thing, and one of the other algorithms might not, then it's just noise in the docstring. And we'd have to go through a deprecation cycle to change it in the future.

> I disagree completely. This has nothing to do with the `type()` of the matrix, but with the mathematical properties of the parent.

Fair enough, but the resulting type of the matrix is determined by the ring that you pass in (and whether or not it's sparse).

> With your proposal, `pseudoinverse()` would no longer work for matrices over `RR` or `CC` or for sparse matrices.

You would at least get the exact(conj) implementation in every case. But you would have to override that in every subclass where it makes sense, like the generic_dense ones for RR/CC. If that's difficult or results in code duplication, then it's fine as-is. I just brought it up in case you hadn't considered it.



---

archive/issue_comments_276209.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-30T14:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20050",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20050#issuecomment-276209",
    "user": "@vbraun"
}
```

Resolution: fixed
