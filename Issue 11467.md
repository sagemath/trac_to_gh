# Issue 11467: conductor of simple curve over Q(cube root 3) takes forever

Issue created by migration from Trac.

Original creator: was

Original creation time: 2011-08-01 23:44:45

Assignee: cremona

{{
sage: x=var('x'); K.<a> = NumberField(x^3 - 2); EllipticCurve([0,a]).conductor()
[This is the Trac macro *wait forever! * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#wait forever! -macro)
}}}

The correct answer has norm 322486272, and should be instant:

```
sage: magma(E).Conductor()
Ideal
Basis:
[864   0   0]
[  0 864   0]
[  0   0 432]
sage: magma(E).Conductor().Norm()
322486272
```


Trying with `proof.all(False)` doesn't help, by the way, so I don't think it is just some complexity issue... and yet, I just tried control-c after letting "E.conductor()" sit there for a while, then typed "%debug", then "u", then saw that two ideals of the integers of the cubic field were being multiplied.  I printed the gens of one ideal and got

```
ipdb> u
> /Users/wstein/sage/install/current/local/lib/python2.6/site-packages/sage/rings/ideal.py(857)__mul__()
    856             other = self.ring().ideal(other)
--> 857         return self.ring().ideal([x*y for x in self.gens() for y in other.gens()])
    858 

ipdb> print self.gens()
(16384, 8192*a, 8192*a, 4096*a^2, 8192*a, 4096*a^2,  ... goes on redundantly for many pages!)
```


So, maybe ideals aren't being properly reduced, which is causing huge trouble.


---

Comment by fwclarke created at 2011-08-03 07:24:24

This is the heart of the problem


```
sage: K.<a> = NumberField(x^3 - 2); E = EllipticCurve([0, a])
sage: P, Q = K.prime_factors(E.discriminant())
sage: P, P.gens()
(Fractional ideal (a), (2, a))
sage: P2 = P*P; P2, P2.gens()
(Fractional ideal (a^2), (4, 2*a, 2*a, a^2))
```

The conductor is computed as `P<sup>14*Q</sup>9`, which is defined by 2<sup>23</sup> (highly redundant) generators. Multiplication of ideals avoids reducing the generators, which can be time-consuming (though not in this case), but it could at least eliminate repeats.^^


---

Comment by cremona created at 2011-08-03 08:20:28

How hard would it be to eliminate repeated gens after any ideal multiplication?  And would that make this particular example run in reasonable time?

Note that in a Dedekind domain if I = (a,b) then I^n = (a<sup>n,b</sup>n) [exercise!] which is surely a special case worth catching!

Otherwise I suppose we could have an option to return the conductor  in factored form.  When I compute conductors over number fields I almost always factor it right away (which is a bit silly when that poor ideal has only just been multiplied together), and take its norm and factor that;  rarely would I want to see the conductor as an ideal unless it were principal.


---

Comment by cremona created at 2011-08-03 08:24:48

> 
> Note that in a Dedekind domain if I = (a,b) then I^n = (a<sup>n,b</sup>n) [exercise!] which is surely a special case worth catching!

That should read: if `I = (a,b)` then `I^n = (a<sup>n,b</sup>n)`


---

Comment by jdemeyer created at 2013-05-06 12:43:24

This works now:

```
sage: K.<a> = NumberField(x^3 - 2)
sage: %time EllipticCurve([0,a]).conductor().norm()
CPU times: user 0.14 s, sys: 0.01 s, total: 0.15 s
Wall time: 0.14 s
322486272
```



---

Comment by jdemeyer created at 2013-05-06 12:43:24

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-05-06 12:43:32

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2013-05-06 12:55:06

As there is no patch here, do we know what changed to make this work ok now?


---

Comment by jdemeyer created at 2013-05-06 12:58:55

Replying to [comment:7 cremona]:
> As there is no patch here, do we know what changed to make this work ok now?
I know the multiplication of number field ideals got improved, which was essentially the problem this ticket is about.


---

Comment by cremona created at 2013-05-06 13:11:00

Replying to [comment:8 jdemeyer]:
> Replying to [comment:7 cremona]:
> > As there is no patch here, do we know what changed to make this work ok now?
> I know the multiplication of number field ideals got improved, which was essentially the problem this ticket is about.

OK, fine.  We could add a doctest referencing this ticket.  Is that worth while?


---

Comment by jdemeyer created at 2013-05-06 13:26:38

Replying to [comment:9 cremona]:
> We could add a doctest referencing this ticket.  Is that worth while?
Not really, since the actual issue is fixed and doctested in #13958.


---

Comment by cremona created at 2013-05-06 14:27:38

Replying to [comment:10 jdemeyer]:
> Replying to [comment:9 cremona]:
> > We could add a doctest referencing this ticket.  Is that worth while?
> Not really, since the actual issue is fixed and doctested in #13958.

Then I am happy, especially since this cross-reference is now on this ticket!


---

Comment by jdemeyer created at 2013-05-08 09:46:28

Resolution: duplicate
