# Issue 27339: Problem with wedge of unnamed diff forms

Issue created by migration from https://trac.sagemath.org/ticket/27576

Original creator: @DeRhamSource

Original creation time: 2019-03-30 19:45:10

CC:  egourgoulhon tscrim nbruin

Keywords: wedge, diff_form.py, manifolds

This example code:

```
sage: S2 = Manifold(2, name='S2', latex_name=r'S^2', start_index=1)
sage: U = S2.open_subset(name='U', latex_name=r'S^2 \setminus \{\text{South pole}\}')
sage: V = S2.open_subset(name='V', latex_name=r'S^2 \setminus \{\text{North pole}\}')
sage: S2.declare_union(U,V)
sage: c_xy.<x,y> = U.chart()
sage: c_uv.<u,v> = V.chart()
sage: xy_to_uv = c_xy.transition_map(c_uv, (x/(x^2+y^2), y/(x^2+y^2)),
                               intersection_name='W', restrictions1= x^2+y^2!=0,
                               restrictions2= u^2+v^2!=0)
sage: uv_to_xy = xy_to_uv.inverse()
sage: e_xy = c_xy.frame()
sage: e_uv = c_uv.frame()

sage: omega = S2.diff_form(1, name='omega', latex_name=r'\omega')
sage: unnamed = S2.diff_form(1)

sage: omega[e_xy,:] = -x^2, y^2
sage: omega.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)

sage: unnamed[e_xy,:] = -x^2, y^2
sage: unnamed.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)

sage: unnamed.wedge(omega)
```

leads to the following error message:

```
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)
<ipython-input-4-9f0a1ab49c79> in <module>()
     21 unnamed.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)
     22 
---> 23 unnamed.wedge(omega)

/opt/sagemath-8.6/local/lib/python2.7/site-packages/sage/manifolds/differentiable/diff_form.pyc in wedge(self, other)
    520         vmodule = dom_resu.vector_field_module(dest_map=dest_map_resu)
    521         resu_degree = self._tensor_rank + other._tensor_rank
--> 522         resu = vmodule.alternating_form(resu_degree, name=resu_name,
    523                                         latex_name=resu_latex_name)
    524         for dom in self_r._restrictions:

UnboundLocalError: local variable 'resu_name' referenced before assignment
```

I suspect the issue is hidden in the wedge method in manifolds/differentiable/diff_form.py and guess it can be easily fixed by manipulating names directly via the attributes resu._name and resu._latex_name instead.


---

Comment by egourgoulhon created at 2019-03-30 23:35:49

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2019-03-30 23:35:49

Thanks for reporting this bug! It is fixed in the attached branch.
----
New commits:


---

Comment by git created at 2019-03-31 09:23:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-03-31 22:24:11

LGTM.


---

Comment by tscrim created at 2019-03-31 22:24:11

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2019-04-01 08:34:14

Thanks for the review!


---

Comment by vbraun created at 2019-04-02 21:30:07

Resolution: fixed
