# Issue 27339: Problem with wedge of unnamed diff forms

archive/issues_027339.json:
```json
{
    "body": "CC:  egourgoulhon tscrim nbruin\n\nKeywords: wedge, diff_form.py, manifolds\n\nThis example code:\n\n```\nsage: S2 = Manifold(2, name='S2', latex_name=r'S^2', start_index=1)\nsage: U = S2.open_subset(name='U', latex_name=r'S^2 \\setminus \\{\\text{South pole}\\}')\nsage: V = S2.open_subset(name='V', latex_name=r'S^2 \\setminus \\{\\text{North pole}\\}')\nsage: S2.declare_union(U,V)\nsage: c_xy.<x,y> = U.chart()\nsage: c_uv.<u,v> = V.chart()\nsage: xy_to_uv = c_xy.transition_map(c_uv, (x/(x^2+y^2), y/(x^2+y^2)),\n                               intersection_name='W', restrictions1= x^2+y^2!=0,\n                               restrictions2= u^2+v^2!=0)\nsage: uv_to_xy = xy_to_uv.inverse()\nsage: e_xy = c_xy.frame()\nsage: e_uv = c_uv.frame()\n\nsage: omega = S2.diff_form(1, name='omega', latex_name=r'\\omega')\nsage: unnamed = S2.diff_form(1)\n\nsage: omega[e_xy,:] = -x^2, y^2\nsage: omega.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)\n\nsage: unnamed[e_xy,:] = -x^2, y^2\nsage: unnamed.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)\n\nsage: unnamed.wedge(omega)\n```\n\nleads to the following error message:\n\n```\n---------------------------------------------------------------------------\nUnboundLocalError                         Traceback (most recent call last)\n<ipython-input-4-9f0a1ab49c79> in <module>()\n     21 unnamed.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)\n     22 \n---> 23 unnamed.wedge(omega)\n\n/opt/sagemath-8.6/local/lib/python2.7/site-packages/sage/manifolds/differentiable/diff_form.pyc in wedge(self, other)\n    520         vmodule = dom_resu.vector_field_module(dest_map=dest_map_resu)\n    521         resu_degree = self._tensor_rank + other._tensor_rank\n--> 522         resu = vmodule.alternating_form(resu_degree, name=resu_name,\n    523                                         latex_name=resu_latex_name)\n    524         for dom in self_r._restrictions:\n\nUnboundLocalError: local variable 'resu_name' referenced before assignment\n```\n\nI suspect the issue is hidden in the wedge method in manifolds/differentiable/diff_form.py and guess it can be easily fixed by manipulating names directly via the attributes resu._name and resu._latex_name instead.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27576\n\n",
    "created_at": "2019-03-30T19:45:10Z",
    "labels": [
        "geometry",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Problem with wedge of unnamed diff forms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27339",
    "user": "@DeRhamSource"
}
```
CC:  egourgoulhon tscrim nbruin

Keywords: wedge, diff_form.py, manifolds

This example code:

```
sage: S2 = Manifold(2, name='S2', latex_name=r'S^2', start_index=1)
sage: U = S2.open_subset(name='U', latex_name=r'S^2 \setminus \{\text{South pole}\}')
sage: V = S2.open_subset(name='V', latex_name=r'S^2 \setminus \{\text{North pole}\}')
sage: S2.declare_union(U,V)
sage: c_xy.<x,y> = U.chart()
sage: c_uv.<u,v> = V.chart()
sage: xy_to_uv = c_xy.transition_map(c_uv, (x/(x^2+y^2), y/(x^2+y^2)),
                               intersection_name='W', restrictions1= x^2+y^2!=0,
                               restrictions2= u^2+v^2!=0)
sage: uv_to_xy = xy_to_uv.inverse()
sage: e_xy = c_xy.frame()
sage: e_uv = c_uv.frame()

sage: omega = S2.diff_form(1, name='omega', latex_name=r'\omega')
sage: unnamed = S2.diff_form(1)

sage: omega[e_xy,:] = -x^2, y^2
sage: omega.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)

sage: unnamed[e_xy,:] = -x^2, y^2
sage: unnamed.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)

sage: unnamed.wedge(omega)
```

leads to the following error message:

```
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)
<ipython-input-4-9f0a1ab49c79> in <module>()
     21 unnamed.add_comp_by_continuation(e_uv, V.intersection(U), c_uv)
     22 
---> 23 unnamed.wedge(omega)

/opt/sagemath-8.6/local/lib/python2.7/site-packages/sage/manifolds/differentiable/diff_form.pyc in wedge(self, other)
    520         vmodule = dom_resu.vector_field_module(dest_map=dest_map_resu)
    521         resu_degree = self._tensor_rank + other._tensor_rank
--> 522         resu = vmodule.alternating_form(resu_degree, name=resu_name,
    523                                         latex_name=resu_latex_name)
    524         for dom in self_r._restrictions:

UnboundLocalError: local variable 'resu_name' referenced before assignment
```

I suspect the issue is hidden in the wedge method in manifolds/differentiable/diff_form.py and guess it can be easily fixed by manipulating names directly via the attributes resu._name and resu._latex_name instead.

Issue created by migration from https://trac.sagemath.org/ticket/27576





---

archive/issue_comments_385495.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-30T23:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27339#issuecomment-385495",
    "user": "egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_385496.json:
```json
{
    "body": "Thanks for reporting this bug! It is fixed in the attached branch.\n----\nNew commits:",
    "created_at": "2019-03-30T23:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27339#issuecomment-385496",
    "user": "egourgoulhon"
}
```

Thanks for reporting this bug! It is fixed in the attached branch.
----
New commits:



---

archive/issue_comments_385497.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-31T09:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27339#issuecomment-385497",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385498.json:
```json
{
    "body": "LGTM.",
    "created_at": "2019-03-31T22:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27339#issuecomment-385498",
    "user": "tscrim"
}
```

LGTM.



---

archive/issue_comments_385499.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-31T22:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27339#issuecomment-385499",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_385500.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2019-04-01T08:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27339#issuecomment-385500",
    "user": "egourgoulhon"
}
```

Thanks for the review!



---

archive/issue_comments_385501.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-02T21:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27339#issuecomment-385501",
    "user": "vbraun"
}
```

Resolution: fixed
