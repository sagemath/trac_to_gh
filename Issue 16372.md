# Issue 16372: doctest_limits

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-07-03 15:06:06




---

Comment by vbraun created at 2014-07-28 19:22:54

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-07-28 19:22:54

Changing type from PLEASE CHANGE to enhancement.


---

Comment by vbraun created at 2014-07-28 19:22:54

Changing component from PLEASE CHANGE to doctest framework.


---

Comment by vbraun created at 2014-07-28 19:22:54

New commits:


---

Comment by git created at 2014-07-28 20:11:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-07-29 02:29:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ppurka created at 2014-07-29 05:29:44

I never heard of this `--warn-long` before. And it is not present in `sage --advanced` either.


---

Comment by vbraun created at 2014-07-29 12:34:58

Well you learn something new every day ;-) It is documented in the developer guide, though. I don't think we gain anything by adding it to the command line help, its not something that you are going to be looking for. Especially after it is active by default.


---

Comment by nbruin created at 2014-07-29 18:01:41

Replying to [comment:8 vbraun]:
> I don't think we gain anything by adding it to the command line help, its not something that you are going to be looking for. Especially after it is active by default.

Especially when it is active by default one may want to turn it off and my first place to look would definitely be `sage --help` and `sage --advanced`. I think there's value in keeping those complete wrt. command line options. If there are options there that are too complicated to document fully, you can provide a pointer to other doc.


---

Comment by git created at 2014-07-29 18:14:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-07-29 18:15:01

I've added it to the command line help.


---

Comment by ppurka created at 2014-07-30 14:18:46

How come I didn't get any warnings from the plot code on my machine?

```
~/Installations/sageÂ» sage -tp --long src/sage/plot
too few successful tests, not using stored timings
Running doctests with ID 2014-07-30-21-55-39-c73cabe8.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 51 files using 4 threads.
sage -t --long src/sage/plot/plot3d/implicit_plot3d.py
    [57 tests, 38.81 s]
sage -t --long src/sage/plot/line.py
    [79 tests, 30.21 s]
sage -t --long src/sage/plot/contour_plot.py
    [124 tests, 74.20 s]
sage -t --long src/sage/plot/complex_plot.pyx
    [31 tests, 18.51 s]
sage -t --long src/sage/plot/plot3d/plot3d.py
    [227 tests, 29.81 s]
sage -t --long src/sage/plot/point.py
    [81 tests, 18.62 s]
sage -t --long src/sage/plot/matrix_plot.py
    [62 tests, 21.48 s]
sage -t --long src/sage/plot/plot3d/base.pyx
    [269 tests, 18.75 s]
sage -t --long src/sage/plot/animate.py
    [99 tests, 15.09 s]
sage -t --long src/sage/plot/polygon.py
    [71 tests, 12.92 s]
sage -t --long src/sage/plot/graphics.py
    [411 tests, 144.22 s]
sage -t --long src/sage/plot/circle.py
    [54 tests, 12.51 s]
sage -t --long src/sage/plot/arrow.py
    [66 tests, 11.34 s]
sage -t --long src/sage/plot/plot3d/parametric_plot3d.py
    [196 tests, 12.56 s]
sage -t --long src/sage/plot/plot_field.py
    [53 tests, 10.58 s]
sage -t --long src/sage/plot/plot3d/shapes2.py
    [109 tests, 7.47 s]
sage -t --long src/sage/plot/plot3d/plot_field3d.py
    [8 tests, 10.75 s]
sage -t --long src/sage/plot/density_plot.py
    [35 tests, 11.37 s]
sage -t --long src/sage/plot/plot.py
    [389 tests, 171.63 s]
sage -t --long src/sage/plot/plot3d/parametric_surface.pyx
    [85 tests, 8.70 s]
sage -t --long src/sage/plot/plot3d/tachyon.py
    [315 tests, 7.29 s]
sage -t --long src/sage/plot/text.py
    [42 tests, 6.63 s]
sage -t --long src/sage/plot/disk.py
    [55 tests, 6.23 s]
sage -t --long src/sage/plot/bezier_path.py
    [37 tests, 6.33 s]
sage -t --long src/sage/plot/misc.py
    [42 tests, 6.15 s]
sage -t --long src/sage/plot/plot3d/revolution_plot3d.py
    [20 tests, 5.41 s]
sage -t --long src/sage/plot/ellipse.py
    [35 tests, 5.74 s]
sage -t --long src/sage/plot/arc.py
    [39 tests, 5.54 s]
sage -t --long src/sage/plot/bar_chart.py
    [22 tests, 4.54 s]
sage -t --long src/sage/plot/colors.py
    [248 tests, 4.09 s]
sage -t --long src/sage/plot/plot3d/list_plot3d.py
    [37 tests, 3.53 s]
sage -t --long src/sage/plot/scatter_plot.py
    [19 tests, 3.50 s]
sage -t --long src/sage/plot/plot3d/shapes.pyx
    [159 tests, 6.00 s]
sage -t --long src/sage/plot/step.py
    [4 tests, 2.15 s]
sage -t --long src/sage/plot/plot3d/transform.pyx
    [25 tests, 3.23 s]
sage -t --long src/sage/plot/hyperbolic_arc.py
    [8 tests, 2.84 s]
sage -t --long src/sage/plot/plot3d/platonic.py
    [41 tests, 1.87 s]
sage -t --long src/sage/plot/plot3d/tri_plot.py
    [70 tests, 0.78 s]
sage -t --long src/sage/plot/primitive.py
    [43 tests, 1.78 s]
sage -t --long src/sage/plot/hyperbolic_triangle.py
    [8 tests, 1.57 s]
sage -t --long src/sage/plot/plot3d/examples.py
    [4 tests, 0.35 s]
sage -t --long src/sage/plot/plot3d/point_c.pxi
    [0 tests, 0.00 s]
sage -t --long src/sage/plot/plot3d/implicit_surface.pyx
    [93 tests, 2.44 s]
sage -t --long src/sage/plot/java3d.py
    [1 test, 0.01 s]
sage -t --long src/sage/plot/plot3d/help.pyx
    [0 tests, 0.00 s]
sage -t --long src/sage/plot/plot3d/all.py
    [0 tests, 0.00 s]
sage -t --long src/sage/plot/plot3d/__init__.py
    [0 tests, 0.00 s]
sage -t --long src/sage/plot/all.py
    [0 tests, 0.00 s]
sage -t --long src/sage/plot/__init__.py
    [0 tests, 0.00 s]
sage -t --long src/sage/plot/plot3d/texture.py
    [61 tests, 0.53 s]
sage -t --long src/sage/plot/plot3d/index_face_set.pyx
    [48 tests, 0.92 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 194.0 seconds
    cpu time: 673.5 seconds
    cumulative wall time: 769.0 seconds
```


*Edit* Ah! Sorry. Didn't notice the first line of the output.


---

Comment by ppurka created at 2014-07-30 14:40:31

I tried this on a different machine. I was expecting a summary at the end of the modules that are taking too
much time. Currently, the output has to be visually inspected.

```
~/Installations/sage [t/16609/doctest] $ sage -tp --long src/sage/plot
Running doctests with ID 2014-07-30-22-26-45-7bc2417c. 
Sorting sources by runtime so that slower doctests are run first....
Doctesting 51 files using 24 threads.
sage -t --long --warn-long 36.6 src/sage/plot/bezier_path.py
    [37 tests, 4.60 s]
sage -t --long --warn-long 36.6 src/sage/plot/arc.py   
    [39 tests, 5.52 s]
sage -t --long --warn-long 36.6 src/sage/plot/misc.py  
    [42 tests, 5.63 s]
sage -t --long --warn-long 36.6 src/sage/plot/text.py  
    [42 tests, 6.01 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/parametric_surface.pyx
    [85 tests, 6.65 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/base.pyx
    [269 tests, 7.20 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/plot_field3d.py
    [8 tests, 7.59 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/shapes2.py
    [109 tests, 7.70 s]
sage -t --long --warn-long 36.6 src/sage/plot/density_plot.py
    [35 tests, 8.78 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/revolution_plot3d.py
    [20 tests, 3.57 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot_field.py
    [53 tests, 9.59 s]
sage -t --long --warn-long 36.6 src/sage/plot/bar_chart.py
    [22 tests, 3.54 s]
sage -t --long --warn-long 36.6 src/sage/plot/circle.py
    [54 tests, 10.13 s]
sage -t --long --warn-long 36.6 src/sage/plot/arrow.py 
    [66 tests, 10.21 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/parametric_plot3d.py
    [196 tests, 10.38 s]
sage -t --long --warn-long 36.6 src/sage/plot/polygon.py
    [71 tests, 10.50 s]
sage -t --long --warn-long 36.6 src/sage/plot/scatter_plot.py
    [19 tests, 2.79 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/tachyon.py
    [315 tests, 2.98 s]
sage -t --long --warn-long 36.6 src/sage/plot/ellipse.py
    [35 tests, 5.79 s]
sage -t --long --warn-long 36.6 src/sage/plot/disk.py  
    [55 tests, 5.12 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/shapes.pyx
    [159 tests, 3.67 s]
sage -t --long --warn-long 36.6 src/sage/plot/java3d.py
    [1 test, 0.00 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/point_c.pxi
    [0 tests, 0.00 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/examples.py
    [4 tests, 0.38 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/help.pyx
    [0 tests, 0.00 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/index_face_set.pyx
    [48 tests, 0.44 s]
sage -t --long --warn-long 36.6 src/sage/plot/__init__.py
    [0 tests, 0.00 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/all.py
    [0 tests, 0.00 s]
sage -t --long --warn-long 36.6 src/sage/plot/all.py
    [0 tests, 0.00 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/__init__.py
    [0 tests, 0.00 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/tri_plot.py
    [70 tests, 0.54 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/texture.py
    [61 tests, 0.29 s]
sage -t --long --warn-long 36.6 src/sage/plot/colors.py
    [248 tests, 4.55 s]
sage -t --long --warn-long 36.6 src/sage/plot/step.py
    [4 tests, 1.82 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/platonic.py
    [41 tests, 1.37 s]
sage -t --long --warn-long 36.6 src/sage/plot/hyperbolic_triangle.py
    [8 tests, 1.20 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/list_plot3d.py
    [37 tests, 2.19 s]
sage -t --long --warn-long 36.6 src/sage/plot/hyperbolic_arc.py
    [8 tests, 2.32 s]
sage -t --long --warn-long 36.6 src/sage/plot/primitive.py
    [43 tests, 1.67 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/transform.pyx
    [25 tests, 3.27 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/implicit_surface.pyx
    [93 tests, 1.92 s]
sage -t --long --warn-long 36.6 src/sage/plot/animate.py
    [99 tests, 12.60 s]
sage -t --long --warn-long 36.6 src/sage/plot/point.py
    [81 tests, 14.69 s]
sage -t --long --warn-long 36.6 src/sage/plot/complex_plot.pyx
    [31 tests, 15.37 s]
sage -t --long --warn-long 36.6 src/sage/plot/matrix_plot.py
    [62 tests, 15.64 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/plot3d.py
    [227 tests, 17.53 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot3d/implicit_plot3d.py
    [57 tests, 19.67 s]
sage -t --long --warn-long 36.6 src/sage/plot/line.py
    [79 tests, 20.96 s]
sage -t --long --warn-long 36.6 src/sage/plot/contour_plot.py
    [124 tests, 43.19 s]
sage -t --long --warn-long 36.6 src/sage/plot/graphics.py
    [411 tests, 80.43 s]
sage -t --long --warn-long 36.6 src/sage/plot/plot.py
    [389 tests, 95.00 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 95.2 seconds
    cpu time: 471.7 seconds
    cumulative wall time: 495.0 seconds
```


For the summary, I have something like this in mind (the output may be
sorted or unsorted according to the highest time)

```
The following files took more than 36.6 s to doctest:
[43.19 s] src/sage/plot/contour_plot.py
[80.43 s] src/sage/plot/graphics.py
[95.00 s] src/sage/plot/plot.py
```

I haven't had a close look at the code, so I am not sure if it is possible
to provide a summary like this.


---

Comment by vbraun created at 2014-07-30 23:12:05

The time limit is per doctest, not per file.

I don't mind a summary at the end but I don't think its necessary for this ticket. If you want to implement it be my guest, but I don't plan on doing it.


---

Comment by ppurka created at 2014-08-08 06:48:50

Sorry, took me some time to look through all this since I am not familiar with the code in `sage/doctest`. This sequence of patches looks good to me. I don't see any problems.


---

Comment by ppurka created at 2014-08-08 06:48:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-08-11 12:07:31

Resolution: fixed
