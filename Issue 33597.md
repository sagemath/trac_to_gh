# Issue 33597: Fix map_reduce doctest

archive/issues_033597.json:
```json
{
    "body": "CC:  @dimpase @mkoeppe @fchapoton\n\nOne doctest continuously fails in the build workflow. I couldn't reproduce the error locally, but hopefully it goes away by slightly increasing the timeout from 1sec to 1.5sec.\n\nWe also extend the doctest to provide a bit more debug information, and to actually test parallel processing by using two roots and thus two threads.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33834\n\n",
    "created_at": "2022-05-10T19:16:15Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Fix map_reduce doctest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33597",
    "user": "https://github.com/tobiasdiez"
}
```
CC:  @dimpase @mkoeppe @fchapoton

One doctest continuously fails in the build workflow. I couldn't reproduce the error locally, but hopefully it goes away by slightly increasing the timeout from 1sec to 1.5sec.

We also extend the doctest to provide a bit more debug information, and to actually test parallel processing by using two roots and thus two threads.

Issue created by migration from https://trac.sagemath.org/ticket/33834





---

archive/issue_comments_477643.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-10T22:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477643",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477644.json:
```json
{
    "body": "dup of #33846",
    "created_at": "2022-05-12T22:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477644",
    "user": "https://github.com/mkoeppe"
}
```

dup of #33846



---

archive/issue_comments_477645.json:
```json
{
    "body": "note that sleep should take an integer or a float as input, not any sage type\n\nmaybe one can redo my changes from #33846 here ?",
    "created_at": "2022-05-13T06:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477645",
    "user": "https://github.com/fchapoton"
}
```

note that sleep should take an integer or a float as input, not any sage type

maybe one can redo my changes from #33846 here ?



---

archive/issue_comments_477646.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-13T07:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477646",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477647.json:
```json
{
    "body": "ok, I have incorporated my changes here. I will now close the other ticket.",
    "created_at": "2022-05-13T07:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477647",
    "user": "https://github.com/fchapoton"
}
```

ok, I have incorporated my changes here. I will now close the other ticket.



---

archive/issue_comments_477648.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-13T07:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477648",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_477649.json:
```json
{
    "body": "note that the build and test badge is still red, for another reasons related to not-working coverage..",
    "created_at": "2022-05-13T07:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477649",
    "user": "https://github.com/fchapoton"
}
```

note that the build and test badge is still red, for another reasons related to not-working coverage..



---

archive/issue_comments_477650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-13T07:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477651.json:
```json
{
    "body": "hmm, doctests do not pass...",
    "created_at": "2022-05-13T10:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477651",
    "user": "https://github.com/fchapoton"
}
```

hmm, doctests do not pass...



---

archive/issue_comments_477652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-13T20:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477653.json:
```json
{
    "body": "still failing",
    "created_at": "2022-05-14T08:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477653",
    "user": "https://github.com/fchapoton"
}
```

still failing



---

archive/issue_comments_477654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-14T09:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477655.json:
```json
{
    "body": "oh, boy, a green middle badge at last ! Positive review from me.\n\nPlease set to positive of you agree.",
    "created_at": "2022-05-14T16:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477655",
    "user": "https://github.com/fchapoton"
}
```

oh, boy, a green middle badge at last ! Positive review from me.

Please set to positive of you agree.



---

archive/issue_comments_477656.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-14T20:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477656",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477657.json:
```json
{
    "body": "Yeah, finally! Thank you for your work in this direction.\n\nI've set it now to positive review and set the priority to \"blocker\" so that it hopefully still makes it into 9.6 (since there are only changes to the doctests it shouldn't introduce any serious bugs). Please set it back if you don't agree.",
    "created_at": "2022-05-14T20:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477657",
    "user": "https://github.com/tobiasdiez"
}
```

Yeah, finally! Thank you for your work in this direction.

I've set it now to positive review and set the priority to "blocker" so that it hopefully still makes it into 9.6 (since there are only changes to the doctests it shouldn't introduce any serious bugs). Please set it back if you don't agree.



---

archive/issue_comments_477658.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2022-05-14T20:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477658",
    "user": "https://github.com/tobiasdiez"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_477659.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2022-05-14T21:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477659",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_477660.json:
```json
{
    "body": "I don't think that's worth delaying the release for",
    "created_at": "2022-05-14T21:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477660",
    "user": "https://github.com/mkoeppe"
}
```

I don't think that's worth delaying the release for



---

archive/issue_events_030317.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-17T21:00:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33597#event-30317"
}
```



---

archive/issue_comments_477661.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-17T21:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33597",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33597#issuecomment-477661",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
