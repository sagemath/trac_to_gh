# Issue 33597: Fix map_reduce doctest

Issue created by migration from https://trac.sagemath.org/ticket/33834

Original creator: @tobiasdiez

Original creation time: 2022-05-10 19:16:15

CC:  dimpase mkoeppe chapoton

One doctest continuously fails in the build workflow. I couldn't reproduce the error locally, but hopefully it goes away by slightly increasing the timeout from 1sec to 1.5sec.

We also extend the doctest to provide a bit more debug information, and to actually test parallel processing by using two roots and thus two threads.


---

Comment by git created at 2022-05-10 22:12:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-12 22:42:53

dup of #33846


---

Comment by chapoton created at 2022-05-13 06:31:44

note that sleep should take an integer or a float as input, not any sage type

maybe one can redo my changes from #33846 here ?


---

Comment by git created at 2022-05-13 07:34:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-05-13 07:35:00

ok, I have incorporated my changes here. I will now close the other ticket.


---

Comment by chapoton created at 2022-05-13 07:36:33

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-05-13 07:39:44

note that the build and test badge is still red, for another reasons related to not-working coverage..


---

Comment by git created at 2022-05-13 07:40:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-05-13 10:47:33

hmm, doctests do not pass...


---

Comment by git created at 2022-05-13 20:39:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-05-14 08:44:30

still failing


---

Comment by git created at 2022-05-14 09:25:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-05-14 16:52:45

oh, boy, a green middle badge at last ! Positive review from me.

Please set to positive of you agree.


---

Comment by @tobiasdiez created at 2022-05-14 20:01:28

Changing status from needs_review to positive_review.


---

Comment by @tobiasdiez created at 2022-05-14 20:01:28

Yeah, finally! Thank you for your work in this direction.

I've set it now to positive review and set the priority to "blocker" so that it hopefully still makes it into 9.6 (since there are only changes to the doctests it shouldn't introduce any serious bugs). Please set it back if you don't agree.


---

Comment by @tobiasdiez created at 2022-05-14 20:01:28

Changing priority from major to blocker.


---

Comment by mkoeppe created at 2022-05-14 21:50:11

Changing priority from blocker to critical.


---

Comment by mkoeppe created at 2022-05-14 21:50:11

I don't think that's worth delaying the release for


---

Comment by vbraun created at 2022-05-17 21:00:41

Resolution: fixed
