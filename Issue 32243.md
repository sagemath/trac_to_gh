# Issue 32243: trivial __copy__ and __deepcopy__ methods for symbolic expressions and functions

archive/issues_032243.json:
```json
{
    "body": "CC:  @egourgoulhon @tscrim\n\nBy definition, symbolic expressions are immutable (but see #32450).\n\nWe define trivial `__copy__` and `__deepcopy__` methods that just return `self`.\n\nBefore:\n\n```\nsage: ex = sin(x)                                                                                                                                              \nsage: %timeit copy(ex)                                                                                                                                         \n339 ns \u00b1 2.64 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit deepcopy(ex)                                                                                                                                     \n29.7 \u00b5s \u00b1 259 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/32480\n\n",
    "created_at": "2021-09-06T03:36:38Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "trivial __copy__ and __deepcopy__ methods for symbolic expressions and functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32243",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @egourgoulhon @tscrim

By definition, symbolic expressions are immutable (but see #32450).

We define trivial `__copy__` and `__deepcopy__` methods that just return `self`.

Before:

```
sage: ex = sin(x)                                                                                                                                              
sage: %timeit copy(ex)                                                                                                                                         
339 ns ± 2.64 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit deepcopy(ex)                                                                                                                                     
29.7 µs ± 259 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```

Issue created by migration from https://trac.sagemath.org/ticket/32480





---

archive/issue_comments_459887.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-06T03:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32243#issuecomment-459887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_459888.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-06T03:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32243#issuecomment-459888",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_459889.json:
```json
{
    "body": "Green bot => positive review.",
    "created_at": "2021-09-06T06:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32243#issuecomment-459889",
    "user": "https://github.com/tscrim"
}
```

Green bot => positive review.



---

archive/issue_comments_459890.json:
```json
{
    "body": "A related question here is whether we want to make `Expression` hashable even if the wrapped Python object is not, for example by falling back to taking the hash of the repr.  Example:\n\n```\nsage: s = SR(matrix(QQ, [[1, 2], [3, 4]]))                                                                                                                     \nsage: hash(s)                                                                                                                                                  \n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-2-9333020f3184> in <module>\n----> 1 hash(s)\n\n~/s/sage/sage-rebasing/worktree-gcc11/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__hash__()\n   1947         sig_on()\n   1948         try:\n-> 1949             return self._gobj.gethash()\n   1950         finally:\n   1951             sig_off()\n\nRuntimeError: Python object not hashable\n```",
    "created_at": "2021-09-06T06:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32243#issuecomment-459890",
    "user": "https://github.com/mkoeppe"
}
```

A related question here is whether we want to make `Expression` hashable even if the wrapped Python object is not, for example by falling back to taking the hash of the repr.  Example:

```
sage: s = SR(matrix(QQ, [[1, 2], [3, 4]]))                                                                                                                     
sage: hash(s)                                                                                                                                                  
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-2-9333020f3184> in <module>
----> 1 hash(s)

~/s/sage/sage-rebasing/worktree-gcc11/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__hash__()
   1947         sig_on()
   1948         try:
-> 1949             return self._gobj.gethash()
   1950         finally:
   1951             sig_off()

RuntimeError: Python object not hashable
```



---

archive/issue_comments_459891.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2021-09-06T21:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32243#issuecomment-459891",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_events_086156.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32243#event-86156"
}
```



---

archive/issue_events_086157.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32243#event-86157"
}
```



---

archive/issue_events_086158.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32243#event-86158"
}
```



---

archive/issue_events_086159.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32243#event-86159"
}
```



---

archive/issue_events_086160.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32243",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32243#event-86160"
}
```
