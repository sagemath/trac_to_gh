# Issue 32243: trivial __copy__ and __deepcopy__ methods for symbolic expressions and functions

Issue created by migration from https://trac.sagemath.org/ticket/32480

Original creator: mkoeppe

Original creation time: 2021-09-06 03:36:38

CC:  egourgoulhon tscrim

By definition, symbolic expressions are immutable (but see #32450).

We define trivial `__copy__` and `__deepcopy__` methods that just return `self`.

Before:

```
sage: ex = sin(x)                                                                                                                                              
sage: %timeit copy(ex)                                                                                                                                         
339 ns ± 2.64 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit deepcopy(ex)                                                                                                                                     
29.7 µs ± 259 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```



---

Comment by git created at 2021-09-06 03:51:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-09-06 03:51:49

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-09-06 06:12:43

Green bot => positive review.


---

Comment by mkoeppe created at 2021-09-06 06:22:45

A related question here is whether we want to make `Expression` hashable even if the wrapped Python object is not, for example by falling back to taking the hash of the repr.  Example:

```
sage: s = SR(matrix(QQ, [[1, 2], [3, 4]]))                                                                                                                     
sage: hash(s)                                                                                                                                                  
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-2-9333020f3184> in <module>
----> 1 hash(s)

~/s/sage/sage-rebasing/worktree-gcc11/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__hash__()
   1947         sig_on()
   1948         try:
-> 1949             return self._gobj.gethash()
   1950         finally:
   1951             sig_off()

RuntimeError: Python object not hashable
```



---

Comment by mkoeppe created at 2021-09-06 21:35:06

Changing status from needs_review to needs_info.
