# Issue 24381: fplll fails to build on SunOS

Issue created by migration from https://trac.sagemath.org/ticket/24618

Original creator: jdemeyer

Original creation time: 2018-01-31 06:28:03

CC:  dimpase


```
libtool: compile:  g++ -std=c++11 -DHAVE_CONFIG_H -I. -I.. -DFPLLL_DEFAULT_STRATEGY_PATH=\"/var/export/home/jeroen/sage/local/share/fplll/strategies\" -DFPLLL_DEFAULT_STRATEGY=\"/var/export/home/jeroen/sage/local/share/fplll/strategies/default.json\" -I./.. -I/var/export/home/jeroen/sage/local/include/ -I/include -m64 -O2 -g -D_XPG6 -fPIC -I/var/export/home/jeroen/sage/local/include/ -L/var/export/home/jeroen/sage/local/lib -O3 -MT fplll.lo -MD -MP -MF .deps/fplll.Tpo -c fplll.cpp  -fPIC -DPIC -o .libs/fplll.o
In file included from defs.h:56:0,
                 from bkz_param.h:23,
                 from bkz.h:21,
                 from fplll.h:25,
                 from fplll.cpp:18:
nr/dpe.h: In function 'void dpe_pow_si(dpe_struct*, const dpe_struct*, unsigned int)':
nr/dpe.h:718:35: error: call of overloaded 'pow(const double&, const unsigned int&)' is ambiguous
   DPE_MANT(x) = pow(DPE_MANT(y), k);
                                   ^
In file included from /usr/include/math.h:17:0,
                 from /usr/gcc/5/include/c++/5.4.0/cmath:44,
                 from defs.h:33,
                 from bkz_param.h:23,
                 from bkz.h:21,
                 from fplll.h:25,
                 from fplll.cpp:18:
/usr/include/iso/math_iso.h:199:21: note: candidate: long double std::pow(long double, int)
  inline long double pow(long double __X, int __Y) { return
                     ^
/usr/include/iso/math_iso.h:197:21: note: candidate: long double std::pow(long double, long double)
  inline long double pow(long double __X, long double __Y) { return
                     ^
/usr/include/iso/math_iso.h:163:16: note: candidate: double std::pow(float, int)
  inline double pow(float __X, int __Y) { return
                ^
/usr/include/iso/math_iso.h:161:15: note: candidate: float std::pow(float, float)
  inline float pow(float __X, float __Y) { return __powf(__X, __Y); }
               ^ 
/usr/include/iso/math_iso.h:141:16: note: candidate: double std::pow(double, int)
  inline double pow(double __X, int __Y) { return
                ^
/usr/include/iso/math_iso.h:64:15: note: candidate: double std::pow(double, double)
 extern double pow __P((double, double));
```



---

Comment by jdemeyer created at 2018-02-03 08:37:00

Dima: from reading your comments on other tickets, I assume that you have a fix for this. Can you put it on this ticket please?


---

Comment by dimpase created at 2018-02-03 10:40:24

The "fix" is to use gcc 7.2, which compiles fplll just fine.

(by the way, /datapool/dima/Sage/sagetrac-mirror - the SAGEROOT of my build - is world-readable, you may look there for logs and patches...)


---

Comment by jdemeyer created at 2018-02-03 12:50:22

Replying to [comment:4 dimpase]:
> The "fix" is to use gcc 7.2, which compiles fplll just fine.

Strange. And GCC 7.2.0 did _not_ fix the analogous problems with `pow()` for Singular?


---

Comment by dimpase created at 2018-02-03 14:18:19

No, it did not. 
But Singular's error with pow() is different (the only one that matters with gcc 7.2, anyway), there it's inability to use the templated pow() (failure to instantiate the template for `int pow(int,int)`)

And indeed Singular with gcc 7.2 does not need patches for floor() and sqrt(), only the pow() ones are needed.


---

Comment by jdemeyer created at 2018-02-03 15:22:54

I'll try to fix this anyway with GCC 5.4.0 (unless it's too much trouble).


---

Comment by dimpase created at 2018-02-05 10:31:25

Changing status from new to needs_review.


---

Comment by dimpase created at 2018-02-05 10:31:25

OK, so this is indeed gcc-5-specific, as I gather from your pull request (and from experimental evidence with gcc 7.2).

Needs review?


---

Comment by jdemeyer created at 2018-02-05 10:37:15

New commits:


---

Comment by jdemeyer created at 2018-02-05 10:40:46

Replying to [comment:9 dimpase]:
> Needs review?

I haven't tested a complete build of fplll myself (it takes a really long time to build by the way). So it might break for a stupid reason.


---

Comment by jdemeyer created at 2018-02-05 11:13:39

It worked!

```
real    30m36.844s
user    26m33.734s
sys     1m19.607s
Copying package files from temporary location /datapool/jeroen/sage/local/var/tmp/sage/build/fplll-5.2.0.p1/inst to /datapool/jeroen/sage/local
Successfully installed fplll-5.2.0.p1
Deleting temporary build directory
/datapool/jeroen/sage/local/var/tmp/sage/build/fplll-5.2.0.p1
Finished installing fplll-5.2.0.p1.spkg
```



---

Comment by dimpase created at 2018-02-05 11:17:30

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2018-02-05 11:17:30

This worked for me as well (with gcc 7.2). Apparently I used bigger X in `-jX`, so it's "just" 

```
real    18m51.454s
user    32m32.749s
sys     1m54.590s
```



---

Comment by jdemeyer created at 2018-02-05 11:19:07

I'm building with `-j1` just because `-jN` might introduce problems by itself (although maybe not specifically on Solaris).


---

Comment by vbraun created at 2018-02-09 08:03:51

Resolution: fixed
