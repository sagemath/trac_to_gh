# Issue 30547: sage.matrix: Resolve circular imports without using __init__.py

Issue created by migration from https://trac.sagemath.org/ticket/30784

Original creator: mkoeppe

Original creation time: 2020-10-17 16:39:43

CC:  simonking tscrim @tobiasdiez vdelecroix fbissey

This is preparation for making sage.matrix a namespace package in #28925.


---

Comment by mkoeppe created at 2020-10-17 17:01:40

New commits:


---

Comment by mkoeppe created at 2020-10-17 17:01:40

Changing status from new to needs_review.


---

Comment by @tobiasdiez created at 2020-10-17 18:58:19

What's the advantage of using global variables? I think python is also caching the imported module under the hood (https://docs.python.org/3/reference/import.html#the-module-cache).


---

Comment by mkoeppe created at 2020-10-17 19:01:14

I'm imitating existing code in Cython modules here, for example in `src/sage/matrix/matrix_double_dense.pyx` or `src/sage/rings/complex_mpc.pyx`. I have not timed it, but I would guess it has smaller overhead than the import mechanism.


---

Comment by mkoeppe created at 2020-11-01 19:54:08

Green patchbot, needs review. (One other patchbot fails with an unrelated error.)


---

Comment by fbissey created at 2020-11-01 20:09:39

LGTM


---

Comment by fbissey created at 2020-11-01 20:09:39

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-11-01 20:36:56

Thanks!


---

Comment by @tobiasdiez created at 2020-11-01 21:44:38

Without double-checking I would guess that the python import cache is heavily optimized. But even given the minimal performance penalty, I would suggest to using a simple import in favor of the global variable. The latter is a possible source of bugs (devs forgetting to use import before using it) and heavily complicates the work of static type checking tools. But maybe I'm also missing some other advantages of this approach (`@`Francois).


---

Comment by vbraun created at 2020-11-22 15:06:37

Resolution: fixed
