# Issue 18250: float and CombinatorialFreeModule

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2015-05-24 13:40:44

CC:  tscrim

Keywords: float free module

a bug in CombinatorialFreeModule ?

```
sage: C = CombinatorialFreeModule(QQ,['a','b','c'])
sage: B = C.basis()
sage: th = B['a']
sage: th*float(pi)
3.14159265359*B['a']
sage: _.parent()
Free module generated by {'a', 'b', 'c'} over Rational Field
```



---

Comment by chapoton created at 2015-10-07 18:50:53

Any idea of what happens there ?


---

Comment by tscrim created at 2015-10-07 19:10:20

My guess is that the coercion framework is not working correctly with this (from the `_acted_upon_` method of the CFM element):

```python
        # With the current design, the coercion model does not have
        # enough information to detect a priori that this method only
        # accepts scalars; so it tries on some elements(), and we need
        # to make sure to report an error.
        if isinstance(scalar, Element) and scalar.parent() is not self.base_ring():
            # Temporary needed by coercion (see Polynomial/FractionField tests).
            if self.base_ring().has_coerce_map_from(scalar.parent()):
                scalar = self.base_ring()( scalar )
            else:
                return None
```

and not doing the (correct) pushout construction. Thus it is not constructing the correct parent. I also get this:

```
sage: C = CombinatorialFreeModule(ZZ,['a','b','c'])
sage: C.basis()['a'] * (2/3)
...
TypeError: unsupported operand parent(s) for '*': 'Free module generated by {'a', 'b', 'c'} over Integer Ring' and 'Rational Field'
```

I don't think the cause is the above snippet, but I suspect it is further down with the construction functor for CFM's (or really lack thereof). Compare with:

```
sage: C.construction()
sage: M = ZZ^3
sage: 3.12 * M([1,0,0])
(3.12000000000000, 0.000000000000000, 0.000000000000000)
sage: _.parent()
Vector space of dimension 3 over Real Field with 53 bits of precision
sage: M.construction()
(VectorFunctor, Integer Ring)
```



---

Comment by darij created at 2016-02-05 19:36:13

Just a remark: CFMs will probably not work well with floats even when this is fixed. A lot of CFM code is based on the idea that the base ring is exact.
