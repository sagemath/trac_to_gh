# Issue 21306: Posets: with_bounds() and wrong category

Issue created by migration from Trac.

Original creator: jmantysalo

Original creation time: 2016-09-19 17:02:38

CC:  tscrim chapoton


```
sage: L = Posets.PentagonPoset()
sage: L_ = L.with_bounds()

sage: L.meet(1, 2)
0
sage: L_.meet(1, 2)
0

sage: L.meet_irreducibles()
[1, 2, 3]
sage: L_.meet_irreducibles()
AttributeError: 'FiniteLatticePoset_with_category' object has no attribute 'meet_irreducibles'
```




---

Comment by jmantysalo created at 2016-09-19 17:03:57

Travis, what I did wrong? `with_bounds` is my code.


---

Comment by jmantysalo created at 2016-09-20 04:36:30

Frédéric, this works with `intervals_poset` written by you; it uses `constructor = LatticePoset`. Also `relabel` works, it uses `constructor = FiniteLatticePoset . . . return constructor(. . ., category=self.category(), . . .)`.

What is the difference, and which one is better?

(Sidenote: As I work with this, maybe the parameter could be also `('bottom', None)` to add only another bound.)


---

Comment by tscrim created at 2016-09-20 04:50:38

The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.


---

Comment by jmantysalo created at 2016-09-20 05:24:31

Replying to [comment:3 tscrim]:
> The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.

OK. Now, let's suppose that we add classes for, say, atomic lattices and distributive lattices. A distributive lattice with bounds added is always distributive, whereas atomic lattice is not, except for the empty lattice. And so `category=self.category()` is safe only for something like `relabel` -- and even then only if there is no subclass expecting something about the elements. Is this correct?

Another question: Suppose that I don't like re-computing meets and joins. For something like `with_bounds` it is very easy to expand meet- and join-matrices directly. Would either of those ways allow this?


---

Comment by jmantysalo created at 2016-09-20 06:34:09

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2016-09-20 06:34:09

Anyways, now it at least works. The test set is long and boring, sorry for that. On the plus side it should cover every line of the code.
----
New commits:


---

Comment by jmantysalo created at 2016-09-22 05:52:10

Frédéric, can you check this one? Basic logic should be clear: a meet-semilattice with top element is a lattice, and a join-semilattice with bottom element is a lattice.


---

Comment by chapoton created at 2016-09-22 12:34:18

not coherent: 

* either allow (None, None) in the doc
* or forbid (None, None) in the code

I would prefer the second option, because (None,None) is useless.


---

Comment by git created at 2016-09-22 14:39:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-09-22 14:41:52

Replying to [comment:9 chapoton]:
> not coherent: 
> 
> * either allow (None, None) in the doc
> * or forbid (None, None) in the code
> 
> I would prefer the second option, because (None,None) is useless.

But `+`-operator also accepts the zero as argument. Some user might use code like "if that then newbot = 42 else newbot = None . . . P.with_bounds((newbot, newtop))".


---

Comment by chapoton created at 2016-09-23 10:02:15

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2016-09-23 10:02:15

ok, good enough


---

Comment by vbraun created at 2016-10-03 17:41:51

Resolution: fixed
