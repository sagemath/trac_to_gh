# Issue 21306: Posets: with_bounds() and wrong category

archive/issues_021306.json:
```json
{
    "body": "CC:  @tscrim @fchapoton\n\n```\nsage: L = Posets.PentagonPoset()\nsage: L_ = L.with_bounds()\n\nsage: L.meet(1, 2)\n0\nsage: L_.meet(1, 2)\n0\n\nsage: L.meet_irreducibles()\n[1, 2, 3]\nsage: L_.meet_irreducibles()\nAttributeError: 'FiniteLatticePoset_with_category' object has no attribute 'meet_irreducibles'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21543\n\n",
    "closed_at": "2016-10-03T17:41:51Z",
    "created_at": "2016-09-19T17:02:38Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Posets: with_bounds() and wrong category",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21306",
    "user": "https://github.com/jm58660"
}
```
CC:  @tscrim @fchapoton

```
sage: L = Posets.PentagonPoset()
sage: L_ = L.with_bounds()

sage: L.meet(1, 2)
0
sage: L_.meet(1, 2)
0

sage: L.meet_irreducibles()
[1, 2, 3]
sage: L_.meet_irreducibles()
AttributeError: 'FiniteLatticePoset_with_category' object has no attribute 'meet_irreducibles'
```


Issue created by migration from https://trac.sagemath.org/ticket/21543





---

archive/issue_comments_295367.json:
```json
{
    "body": "Travis, what I did wrong? `with_bounds` is my code.",
    "created_at": "2016-09-19T17:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295367",
    "user": "https://github.com/jm58660"
}
```

Travis, what I did wrong? `with_bounds` is my code.



---

archive/issue_comments_295368.json:
```json
{
    "body": "Fr\u00e9d\u00e9ric, this works with `intervals_poset` written by you; it uses `constructor = LatticePoset`. Also `relabel` works, it uses `constructor = FiniteLatticePoset . . . return constructor(. . ., category=self.category(), . . .)`.\n\nWhat is the difference, and which one is better?\n\n(Sidenote: As I work with this, maybe the parameter could be also `('bottom', None)` to add only another bound.)",
    "created_at": "2016-09-20T04:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295368",
    "user": "https://github.com/jm58660"
}
```

Frédéric, this works with `intervals_poset` written by you; it uses `constructor = LatticePoset`. Also `relabel` works, it uses `constructor = FiniteLatticePoset . . . return constructor(. . ., category=self.category(), . . .)`.

What is the difference, and which one is better?

(Sidenote: As I work with this, maybe the parameter could be also `('bottom', None)` to add only another bound.)



---

archive/issue_comments_295369.json:
```json
{
    "body": "The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.",
    "created_at": "2016-09-20T04:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295369",
    "user": "https://github.com/tscrim"
}
```

The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.



---

archive/issue_comments_295370.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n> The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.\n\n\nOK. Now, let's suppose that we add classes for, say, atomic lattices and distributive lattices. A distributive lattice with bounds added is always distributive, whereas atomic lattice is not, except for the empty lattice. And so `category=self.category()` is safe only for something like `relabel` -- and even then only if there is no subclass expecting something about the elements. Is this correct?\n\nAnother question: Suppose that I don't like re-computing meets and joins. For something like `with_bounds` it is very easy to expand meet- and join-matrices directly. Would either of those ways allow this?",
    "created_at": "2016-09-20T05:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295370",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:3 tscrim]:
> The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.


OK. Now, let's suppose that we add classes for, say, atomic lattices and distributive lattices. A distributive lattice with bounds added is always distributive, whereas atomic lattice is not, except for the empty lattice. And so `category=self.category()` is safe only for something like `relabel` -- and even then only if there is no subclass expecting something about the elements. Is this correct?

Another question: Suppose that I don't like re-computing meets and joins. For something like `with_bounds` it is very easy to expand meet- and join-matrices directly. Would either of those ways allow this?



---

archive/issue_comments_295371.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-20T06:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295371",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_295372.json:
```json
{
    "body": "Anyways, now it at least works. The test set is long and boring, sorry for that. On the plus side it should cover every line of the code.\n\n---\nNew commits:",
    "created_at": "2016-09-20T06:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295372",
    "user": "https://github.com/jm58660"
}
```

Anyways, now it at least works. The test set is long and boring, sorry for that. On the plus side it should cover every line of the code.

---
New commits:



---

archive/issue_comments_295373.json:
```json
{
    "body": "Fr\u00e9d\u00e9ric, can you check this one? Basic logic should be clear: a meet-semilattice with top element is a lattice, and a join-semilattice with bottom element is a lattice.",
    "created_at": "2016-09-22T05:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295373",
    "user": "https://github.com/jm58660"
}
```

Frédéric, can you check this one? Basic logic should be clear: a meet-semilattice with top element is a lattice, and a join-semilattice with bottom element is a lattice.



---

archive/issue_comments_295374.json:
```json
{
    "body": "not coherent: \n\n* either allow (None, None) in the doc\n* or forbid (None, None) in the code\n\nI would prefer the second option, because (None,None) is useless.",
    "created_at": "2016-09-22T12:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295374",
    "user": "https://github.com/fchapoton"
}
```

not coherent: 

* either allow (None, None) in the doc
* or forbid (None, None) in the code

I would prefer the second option, because (None,None) is useless.



---

archive/issue_comments_295375.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-22T14:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_295376.json:
```json
{
    "body": "Replying to [comment:9 chapoton]:\n> not coherent: \n> \n> * either allow (None, None) in the doc\n> * or forbid (None, None) in the code\n> \n> I would prefer the second option, because (None,None) is useless.\n\n\nBut `+`-operator also accepts the zero as argument. Some user might use code like \"if that then newbot = 42 else newbot = None . . . P.with_bounds((newbot, newtop))\".",
    "created_at": "2016-09-22T14:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295376",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:9 chapoton]:
> not coherent: 
> 
> * either allow (None, None) in the doc
> * or forbid (None, None) in the code
> 
> I would prefer the second option, because (None,None) is useless.


But `+`-operator also accepts the zero as argument. Some user might use code like "if that then newbot = 42 else newbot = None . . . P.with_bounds((newbot, newtop))".



---

archive/issue_comments_295377.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-23T10:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295377",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_295378.json:
```json
{
    "body": "ok, good enough",
    "created_at": "2016-09-23T10:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295378",
    "user": "https://github.com/fchapoton"
}
```

ok, good enough



---

archive/issue_comments_295379.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-03T17:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21306#issuecomment-295379",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057181.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T17:41:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21306",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21306#event-57181"
}
```
