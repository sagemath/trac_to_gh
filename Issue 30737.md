# Issue 30737: Improve sage --package create

archive/issues_030737.json:
```json
{
    "body": "CC:  @seblabbe @jhpalmieri @malb\n\n```\n./sage -package create jupyter_jsmol --tarball jupyter_jsmol-VERSION.tar.gz --url https://pypi.io/packages/source/j/jupyter-jsmol/jupyter_jsmol-VERSION.tar.gz --version 0.2.4\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/package.py\", line 291, in _init_type\n    with open(os.path.join(self.path, 'type')) as f:\nIOError: [Errno 2] No such file or directory: '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/jupyter_jsmol/type'\n```\n\nAdditionally, we should have a simple command that creates a package from PyPI, including creating a `README.rst` file.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30974\n\n",
    "created_at": "2020-11-29T06:40:12Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Improve sage --package create",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30737",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @seblabbe @jhpalmieri @malb

```
./sage -package create jupyter_jsmol --tarball jupyter_jsmol-VERSION.tar.gz --url https://pypi.io/packages/source/j/jupyter-jsmol/jupyter_jsmol-VERSION.tar.gz --version 0.2.4
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/package.py", line 291, in _init_type
    with open(os.path.join(self.path, 'type')) as f:
IOError: [Errno 2] No such file or directory: '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/jupyter_jsmol/type'
```

Additionally, we should have a simple command that creates a package from PyPI, including creating a `README.rst` file.

Issue created by migration from https://trac.sagemath.org/ticket/30974





---

archive/issue_comments_438892.json:
```json
{
    "body": "Help on this ticket is welcome\n\n---\nNew commits:",
    "created_at": "2020-12-05T20:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438892",
    "user": "https://github.com/mkoeppe"
}
```

Help on this ticket is welcome

---
New commits:



---

archive/issue_comments_438893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-06T03:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_438894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-06T03:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438895.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-06T04:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438896.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-06T04:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-06T04:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_438898.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-06T04:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438898",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438899.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-06T05:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438900.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-06T17:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438901.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438901",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_438902.json:
```json
{
    "body": "Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438902",
    "user": "https://github.com/mkoeppe"
}
```

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_438903.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-12-09T11:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438903",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_438904.json:
```json
{
    "body": "I tested it with my own optional package which I should include in the list of sage optional package at some point...\n\nIt looks good:\n\n```\n$ sage -package create slabbe --pypi --type optional\nDownloading tarball to /home/slabbe/GitBox/sage/upstream/slabbe-0.6.1.tar.gz\n[......................................................................]\n$ git status\nSur la branche 30974\nFichiers non suivis:\n  (utilisez \"git add <fichier>...\" pour inclure dans ce qui sera valid\u00e9)\n\n\tbuild/pkgs/slabbe/\n\naucune modification ajout\u00e9e \u00e0 la validation mais des fichiers non suivis sont pr\u00e9sents (utilisez \"git add\" pour les suivre)\nslabbe@miami sage $ cd build/pkgs/slabbe/\nslabbe@miami slabbe $ ls\nchecksums.ini  install-requires.txt  spkg-install.in  type\ndependencies   package-version.txt   SPKG.rst\n```\n\nThe content of the following is:\n\n```\n$ cat install-requires.txt \nslabbe\n```\n\nBut, my package does depend on two other packages:\n\n```\n$ grep requires ~/GitBox/slabbe/setup.py \n    install_requires=['pytimeparse', 'roman'],\n    #install_requires=['cython','cysignals'], # this causes update of cysignals\n```\nI guess we do not want the create command to be recursive, but should the content of `install-requires.txt` depend on the content of the `install_requires` variable of the `setup.py` of the package?",
    "created_at": "2020-12-09T11:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438904",
    "user": "https://github.com/seblabbe"
}
```

I tested it with my own optional package which I should include in the list of sage optional package at some point...

It looks good:

```
$ sage -package create slabbe --pypi --type optional
Downloading tarball to /home/slabbe/GitBox/sage/upstream/slabbe-0.6.1.tar.gz
[......................................................................]
$ git status
Sur la branche 30974
Fichiers non suivis:
  (utilisez "git add <fichier>..." pour inclure dans ce qui sera validé)

	build/pkgs/slabbe/

aucune modification ajoutée à la validation mais des fichiers non suivis sont présents (utilisez "git add" pour les suivre)
slabbe@miami sage $ cd build/pkgs/slabbe/
slabbe@miami slabbe $ ls
checksums.ini  install-requires.txt  spkg-install.in  type
dependencies   package-version.txt   SPKG.rst
```

The content of the following is:

```
$ cat install-requires.txt 
slabbe
```

But, my package does depend on two other packages:

```
$ grep requires ~/GitBox/slabbe/setup.py 
    install_requires=['pytimeparse', 'roman'],
    #install_requires=['cython','cysignals'], # this causes update of cysignals
```
I guess we do not want the create command to be recursive, but should the content of `install-requires.txt` depend on the content of the `install_requires` variable of the `setup.py` of the package?



---

archive/issue_comments_438905.json:
```json
{
    "body": "Now testing as a pip package rather than a normal package:\n\n```\n$ mv slabbe slabbe-1\n$ cd ../..\n$ sage -package create slabbe --pypi --source pip --type optional\n$ git status\nSur la branche 30974\nFichiers non suivis:\n  (utilisez \"git add <fichier>...\" pour inclure dans ce qui sera valid\u00e9)\n\n\tbuild/pkgs/slabbe-1/\n\tbuild/pkgs/slabbe/\n\n$ cd build/pkgs/slabbe\n$ ls\ndependencies  requirements.txt  SPKG.rst  type\n$ cat dependencies \n$(PYTHON) | $(PYTHON_TOOLCHAIN)\n\n----------\nAll lines of this file are ignored except the first.\n$ cat requirements.txt \nslabbe\n$ cat type \noptional\n```\n\nAgain, should `install_requires=['pytimeparse', 'roman'],` be considered in the content of the above?",
    "created_at": "2020-12-09T11:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438905",
    "user": "https://github.com/seblabbe"
}
```

Now testing as a pip package rather than a normal package:

```
$ mv slabbe slabbe-1
$ cd ../..
$ sage -package create slabbe --pypi --source pip --type optional
$ git status
Sur la branche 30974
Fichiers non suivis:
  (utilisez "git add <fichier>..." pour inclure dans ce qui sera validé)

	build/pkgs/slabbe-1/
	build/pkgs/slabbe/

$ cd build/pkgs/slabbe
$ ls
dependencies  requirements.txt  SPKG.rst  type
$ cat dependencies 
$(PYTHON) | $(PYTHON_TOOLCHAIN)

----------
All lines of this file are ignored except the first.
$ cat requirements.txt 
slabbe
$ cat type 
optional
```

Again, should `install_requires=['pytimeparse', 'roman'],` be considered in the content of the above?



---

archive/issue_comments_438906.json:
```json
{
    "body": "No, I think it's out of the scope of the ticket to determine dependencies by looking into the tarball",
    "created_at": "2020-12-09T20:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438906",
    "user": "https://github.com/mkoeppe"
}
```

No, I think it's out of the scope of the ticket to determine dependencies by looking into the tarball



---

archive/issue_comments_438907.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-12-09T20:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438907",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_438908.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-11T21:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438908",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438909.json:
```json
{
    "body": "Ok.\n\nI tested the creation (2 ways: spkg + pip). I chacked that installation (`sage -i`) works in both cases.",
    "created_at": "2020-12-11T21:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438909",
    "user": "https://github.com/seblabbe"
}
```

Ok.

I tested the creation (2 ways: spkg + pip). I chacked that installation (`sage -i`) works in both cases.



---

archive/issue_comments_438910.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-12-11T21:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438910",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_events_080876.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-14T23:53:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30737#event-80876"
}
```



---

archive/issue_comments_438911.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-14T23:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30737",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30737#issuecomment-438911",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
