# Issue 30737: Improve sage --package create

Issue created by migration from https://trac.sagemath.org/ticket/30974

Original creator: mkoeppe

Original creation time: 2020-11-29 06:40:12

CC:  slabbe jhpalmieri malb


```
./sage -package create jupyter_jsmol --tarball jupyter_jsmol-VERSION.tar.gz --url https://pypi.io/packages/source/j/jupyter-jsmol/jupyter_jsmol-VERSION.tar.gz --version 0.2.4
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/package.py", line 291, in _init_type
    with open(os.path.join(self.path, 'type')) as f:
IOError: [Errno 2] No such file or directory: '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/jupyter_jsmol/type'
```


Additionally, we should have a simple command that creates a package from PyPI, including creating a `README.rst` file.


---

Comment by mkoeppe created at 2020-12-05 20:41:23

Help on this ticket is welcome
----
New commits:


---

Comment by git created at 2020-12-06 03:40:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-12-06 03:52:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-06 04:05:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-06 04:21:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-06 04:22:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-12-06 04:27:47

Changing status from new to needs_review.


---

Comment by git created at 2020-12-06 05:20:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-06 17:32:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by slabbe created at 2020-12-09 11:02:26

Changing status from needs_review to needs_info.


---

Comment by slabbe created at 2020-12-09 11:02:26

I tested it with my own optional package which I should include in the list of sage optional package at some point...

It looks good:

```
$ sage -package create slabbe --pypi --type optional
Downloading tarball to /home/slabbe/GitBox/sage/upstream/slabbe-0.6.1.tar.gz
[......................................................................]
$ git status
Sur la branche 30974
Fichiers non suivis:
  (utilisez "git add <fichier>..." pour inclure dans ce qui sera validé)

	build/pkgs/slabbe/

aucune modification ajoutée à la validation mais des fichiers non suivis sont présents (utilisez "git add" pour les suivre)
slabbe@miami sage $ cd build/pkgs/slabbe/
slabbe@miami slabbe $ ls
checksums.ini  install-requires.txt  spkg-install.in  type
dependencies   package-version.txt   SPKG.rst
```


The content of the following is:

```
$ cat install-requires.txt 
slabbe
```


But, my package does depend on two other packages:

```
$ grep requires ~/GitBox/slabbe/setup.py 
    install_requires=['pytimeparse', 'roman'],
    #install_requires=['cython','cysignals'], # this causes update of cysignals
```

I guess we do not want the create command to be recursive, but should the content of `install-requires.txt` depend on the content of the `install_requires` variable of the `setup.py` of the package?


---

Comment by slabbe created at 2020-12-09 11:07:24

Now testing as a pip package rather than a normal package:


```
$ mv slabbe slabbe-1
$ cd ../..
$ sage -package create slabbe --pypi --source pip --type optional
$ git status
Sur la branche 30974
Fichiers non suivis:
  (utilisez "git add <fichier>..." pour inclure dans ce qui sera validé)

	build/pkgs/slabbe-1/
	build/pkgs/slabbe/

$ cd build/pkgs/slabbe
$ ls
dependencies  requirements.txt  SPKG.rst  type
$ cat dependencies 
$(PYTHON) | $(PYTHON_TOOLCHAIN)

----------
All lines of this file are ignored except the first.
$ cat requirements.txt 
slabbe
$ cat type 
optional
```


Again, should `install_requires=['pytimeparse', 'roman'],` be considered in the content of the above?


---

Comment by mkoeppe created at 2020-12-09 20:49:43

No, I think it's out of the scope of the ticket to determine dependencies by looking into the tarball


---

Comment by mkoeppe created at 2020-12-09 20:50:00

Changing status from needs_info to needs_review.


---

Comment by slabbe created at 2020-12-11 21:16:21

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2020-12-11 21:16:21

Ok.

I tested the creation (2 ways: spkg + pip). I chacked that installation (`sage -i`) works in both cases.


---

Comment by mkoeppe created at 2020-12-11 21:22:54

Thank you!


---

Comment by vbraun created at 2020-12-14 23:53:17

Resolution: fixed
