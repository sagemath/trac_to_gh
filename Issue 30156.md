# Issue 30156: eigenvalues and eigenvectors using arb

Issue created by migration from https://trac.sagemath.org/ticket/30393

Original creator: mmezzarobba

Original creation time: 2020-08-19 14:39:13




---

Comment by mmezzarobba created at 2020-08-19 15:07:54

New commits:


---

Comment by mmezzarobba created at 2020-08-19 15:07:54

Changing status from new to needs_review.


---

Comment by slabbe created at 2020-08-19 15:59:05

Note that the signature of that method is changing in #29243. Maybe better to follow that?


---

Comment by git created at 2020-08-19 16:11:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2020-08-19 16:12:33

Replying to [comment:2 slabbe]:
> Note that the signature of that method is changing in #29243. Maybe better to follow that?

Thank you. I'm not setting that ticket as a dependency though, since these methods are experimental anyway.


---

Comment by git created at 2020-08-20 07:04:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slabbe created at 2020-08-20 08:47:25

Few comments:

- `"unable to certify the eigenvalues of this interval matrix"`, I would avoid the usage of the word `interval` which reminds of the `CIF` since the matrix belongs rather to the `CBF`.
- the `other` input should be documented as related to the generalized eigenvalue problem in the input block and/or in the raise `NotImplementedError`.

What should happen when the parent is `RealBallField`?


```
sage: M = matrix(3, [1, 1, 1, 1, 0, 0, 0, 1, 0])                                                       
sage: MRBF = M.change_ring(RBF)                                                                        
sage: MRBF.eigenvalues() 
KeyError: '_PolynomialRing_singular_repr__singular'
...
During handling of the above exception, another exception occurred:
...
AttributeError: 'PolynomialRing_field_with_category' object has no attribute '_PolynomialRing_singular_repr__singular'
...
During handling of the above exception, another exception occurred:
...
TypeError: no conversion of this ring to a Singular ring defined
...
During handling of the above exception, another exception occurred:
...
NotImplementedError: 
```


Can this benefits from your current branch?


---

Comment by git created at 2020-08-20 11:16:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2020-08-20 11:29:24

Replying to [comment:6 slabbe]:
> Few comments:
> 
> - `"unable to certify the eigenvalues of this interval matrix"`, I would avoid the usage of the word `interval` which reminds of the `CIF` since the matrix belongs rather to the `CBF`.
> - the `other` input should be documented as related to the generalized eigenvalue problem in the input block and/or in the raise `NotImplementedError`.

Done. (Though the second point is bugware. What we need IMHO is for each method's documentation to include or link to that of the methods it overrides, and to change the way we write docstrings to take advantage of that. It doesn't make any sense to repeat the same information over and over with no automatic way of keeping the various places in sync.)

> What should happen when the parent is `RealBallField`?
[...]
> Can this benefits from your current branch?

In principle yes (and matrices over RR and CC can benefit too), but at the moment we don't even have a dedicated class for matrices over RBF. I think we should keep that for another ticket, and probably wait until the methods are no longer marked experimental.


---

Comment by git created at 2020-08-20 11:31:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slabbe created at 2020-08-20 12:36:36

Replying to [comment:8 mmezzarobba]:
> Replying to [comment:6 slabbe]:
> Done.

Thanks.

> (Though the second point is bugware. What we need IMHO is for each method's documentation to include or link to that of the methods it overrides, and to change the way we write docstrings to take advantage of that. It doesn't make any sense to repeat the same information over and over with no automatic way of keeping the various places in sync.)

I agree with your point (out of sync). But, I do hate the documentation of `G.plot(**kwds)` which does not say which options are available.

That being said, I think my point in comment 2 was mostly to avoid using the `extend` option as a positional argument like:

```
sage: M = M.change_ring(CBF)
sage: M.eigenvalues(True)
```

since it will not be the 1st argument anymore after #29243. If you can force the `extend` to be a keyword argument like `def eigenvalues(self, *, extend=False)`, then for me it is okay, even without the `other` argument. Do you mind to remove the `other` argument? Sorry for my slow convergence on clarifying my point of view.

> I think we should keep that for another ticket, and probably wait until the methods are no longer marked experimental.

I agree.


---

Comment by slabbe created at 2020-08-20 12:41:04

I get an error while building the documentation:

```
[dochtml] OSError: docstring of 
sage.matrix.matrix_complex_ball_dense.Matrix_complex_ball_dense.trace:11: 
WARNING: Duplicate explicit target name: "arb documentation".
```


In fact it seems to be triplicate:

```
+        See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_eig_multiple>`_
+        for more information.
...
+        See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_approx_eig_qr>`_
+        for more information.
...
+        See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_eig_simple>`_
+        for more information.
```



---

Comment by slabbe created at 2020-08-20 12:46:00

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-20 13:50:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2020-08-20 13:53:33

Replying to [comment:10 slabbe]:
> If you can force the `extend` to be a keyword argument like `def eigenvalues(self, *, extend=False)`, then for me it is okay, even without the `other` argument. Do you mind to remove the `other` argument?

It may still be slightly better to have it there, to be compatible with the generic method in case someone explicitly passes a second argument equal to `None`.


---

Comment by mmezzarobba created at 2020-08-20 13:55:08

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2020-08-20 13:55:08

Replying to [comment:11 slabbe]:
> I get an error while building the documentation:
> {{{
> [dochtml] OSError: docstring of 
> sage.matrix.matrix_complex_ball_dense.Matrix_complex_ball_dense.trace:11: 
> WARNING: Duplicate explicit target name: "arb documentation".
> }}}

I don't understand what is going on (why should two different inline links necessarily have distinct link texts?!), but let's see if the commit I just pushed solves the issue.


---

Comment by slabbe created at 2020-08-20 14:35:43

Can you do the following change (x3) ?


```diff
-  See the <http://arblib.org/acb_mat.html#c.acb_mat_eig_multiple for
+  See http://arblib.org/acb_mat.html#c.acb_mat_eig_multiple for
```



---

Comment by slabbe created at 2020-08-20 14:38:54

also:

```diff
- http://arblib.org/acb_mat.html#c.acb_mat_approx_eig_qr_
+ http://arblib.org/acb_mat.html#c.acb_mat_approx_eig_qr
```



---

Comment by slabbe created at 2020-08-20 14:55:53

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-20 19:45:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2020-08-20 19:46:46

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2020-08-20 19:46:46

Oops. I went too fast indeed, thanks!
----
New commits:


---

Comment by slabbe created at 2020-08-21 07:24:40

I found the correct fix. In ReStructuredText syntax, one underscore at the end creates a target `arb documentation` which needs to be unique in the page while two underscores doesn't create such a target. See: https://stackoverflow.com/questions/27420317/restructured-text-rst-http-links-underscore-vs-use


```diff
-See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_eig_multiple>`_
-See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_approx_eig_qr>`_
-See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_eig_simple>`_
+See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_eig_multiple>`__
+See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_approx_eig_qr>`__
+See the `Arb documentation <http://arblib.org/acb_mat.html#c.acb_mat_eig_simple>`__
```


Do you want to revert it back to using two underscores?


---

Comment by git created at 2020-08-26 09:25:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2020-08-26 09:26:36

Replying to [comment:22 slabbe]:
> I found the correct fix.

Oh, I didn't know about the difference, thank you!

> Do you want to revert it back to using two underscores? 

Done (but untested; I don't want to rebuild the doc right now).


---

Comment by slabbe created at 2020-08-26 11:20:46

and I checked that documentation builds ok.


---

Comment by slabbe created at 2020-08-26 11:20:46

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2020-08-26 12:12:53

Replying to [comment:24 mmezzarobba]:
> Replying to [comment:22 slabbe]:
> > I found the correct fix.
> 
> Oh, I didn't know about the difference, thank you!

I created #30444 to add it to the documentation.


---

Comment by vbraun created at 2020-08-30 08:38:52

Resolution: fixed


---

Comment by @mwageringel created at 2020-09-12 10:26:50

While following the examples in the documentation in order to prepare something for the release tours, I noticed that the computed right eigenvectors are wrong. They do not satisfy the eigenvector equation. In fact, it seems to be a problem of transposition. The computed vectors are the rows of the eigenmatrix, but the eigenvectors would be the columns.


```
sage: from sage.matrix.benchmark import hilbert_matrix
sage: mat = hilbert_matrix(3).change_ring(CBF)
sage: [v[1][0].column() for v in mat.eigenvectors_right()]
⎡ ⎛ [0.827044926972 +/- 1.17e-13] + [+/- 1.08e-13]*I⎞  ⎛[0.459863904366 +/- 5.79e-13] + [+/- 1.22e-13]*I⎞
⎢ ⎜[-0.547448430721 +/- 4.33e-13] + [+/- 1.08e-13]*I⎟  ⎜[0.528290235067 +/- 5.58e-13] + [+/- 1.22e-13]*I⎟
⎣ ⎝[-0.127659329747 +/- 5.74e-13] + [+/- 1.08e-13]*I⎠, ⎝[0.713746885803 +/- 5.34e-13] + [+/- 1.22e-13]*I⎠,

 ⎛ [0.323298435244 +/- 6.18e-13] + [+/- 1.19e-13]*I⎞ ⎤
 ⎜ [0.649006658852 +/- 4.06e-13] + [+/- 1.19e-13]*I⎟ ⎥
 ⎝[-0.688671531671 +/- 4.92e-13] + [+/- 1.19e-13]*I⎠ ⎦

sage: mat.change_ring(CDF).eigenmatrix_right()[1]
⎛  0.8270449269720096  -0.5474484307206746 -0.12765932974653435⎞
⎜ 0.45986390436554375   0.5282902350674367    0.713746885803413⎟
⎝ 0.32329843524449886   0.6490066588517125  -0.6886715316713734⎠
```



---

Comment by mmezzarobba created at 2020-09-12 11:08:25

Uh, thanks a lot for catching the issue! I thought I has checked...


---

Comment by mmezzarobba created at 2020-09-13 09:38:25

Fixed (I hope) at #30568.


---

Comment by slabbe created at 2020-09-13 19:57:33

Oups, I didn't notice that issue during the review. Thanks.


---

Comment by slabbe created at 2022-04-07 09:54:20

Another follow up: #33652
