# Issue 16959: Clarify assumptions on bitset operations

archive/issues_016959.json:
```json
{
    "body": "CC:  @nathanncohen\n\nMost bitset operations state something like\n\n```\n    We assume the two sets have the same size.  Otherwise, the\n    behavior of this function is undefined and the function may\n    segfault.\n```\n\n\nHowever, in fact many of these requirements can be relaxed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17196\n\n",
    "created_at": "2014-10-22T13:12:30Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Clarify assumptions on bitset operations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16959",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @nathanncohen

Most bitset operations state something like

```
    We assume the two sets have the same size.  Otherwise, the
    behavior of this function is undefined and the function may
    segfault.
```


However, in fact many of these requirements can be relaxed.

Issue created by migration from https://trac.sagemath.org/ticket/17196





---

archive/issue_comments_224544.json:
```json
{
    "body": "Is it ready for a review?\n----\nNew commits:",
    "created_at": "2014-10-22T18:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224544",
    "user": "https://github.com/simon-king-jena"
}
```

Is it ready for a review?
----
New commits:



---

archive/issue_comments_224545.json:
```json
{
    "body": "Something I'd like to see is the *empty* bitset. The fact that the size of a bitset must be positive caused me some headache at #15820, where I need bounded integer sequences of length zero. And I think it is not a good solution to fake-use bitsets of size 1 if the actual size is zero.",
    "created_at": "2014-10-22T18:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224545",
    "user": "https://github.com/simon-king-jena"
}
```

Something I'd like to see is the *empty* bitset. The fact that the size of a bitset must be positive caused me some headache at #15820, where I need bounded integer sequences of length zero. And I think it is not a good solution to fake-use bitsets of size 1 if the actual size is zero.



---

archive/issue_comments_224546.json:
```json
{
    "body": "Besides, while we are at it: Shouldn't it be moved to `sage.data_structures`?",
    "created_at": "2014-10-22T18:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224546",
    "user": "https://github.com/simon-king-jena"
}
```

Besides, while we are at it: Shouldn't it be moved to `sage.data_structures`?



---

archive/issue_comments_224547.json:
```json
{
    "body": "For the record: I am trying the move to sage.data_structures right now (hope we are not having a race condition in our commits...)",
    "created_at": "2014-10-22T19:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224547",
    "user": "https://github.com/simon-king-jena"
}
```

For the record: I am trying the move to sage.data_structures right now (hope we are not having a race condition in our commits...)



---

archive/issue_comments_224548.json:
```json
{
    "body": "The commit that I pushed moves bitsets to the new data_structures folder. I am running tests now. So far it works well...\n----\nNew commits:",
    "created_at": "2014-10-22T21:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224548",
    "user": "https://github.com/simon-king-jena"
}
```

The commit that I pushed moves bitsets to the new data_structures folder. I am running tests now. So far it works well...
----
New commits:



---

archive/issue_comments_224549.json:
```json
{
    "body": "What I try to do next: Empty bitsets.\n\nQuestion: Should one perhaps create different functions `bitset_init_copy(res,src)` vs. `bitset_realloc_copy(res,src)`, where in the first it is assumed that `res` is not initialised, whereas the second function will override previous contents of `res`? And similar for other functions such as shift?",
    "created_at": "2014-10-22T21:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224549",
    "user": "https://github.com/simon-king-jena"
}
```

What I try to do next: Empty bitsets.

Question: Should one perhaps create different functions `bitset_init_copy(res,src)` vs. `bitset_realloc_copy(res,src)`, where in the first it is assumed that `res` is not initialised, whereas the second function will override previous contents of `res`? And similar for other functions such as shift?



---

archive/issue_comments_224550.json:
```json
{
    "body": "How clever are compilers?\n\nThe question is related to idioms like `n % GMP_LIMB_BITS`.\n\n`GMP_LIMB_BITS` is a power of two, and it is known at compile time. Hence, `n % GMP_LIMB_BITS` does not involve a generally very expensive `%`-operation, but boils down to a simple `&`.\n\nWill compilers automatically use this optimization? If not, then I think we should introduce an integer constant `mod_mp_bits_per_limb` (see #15820), so that `n % GMP_LIMB_BITS == n & mp_bits_per_limb`. If yes, then I guess one can also avoid `n >> index_shift`, and use `n//GMP_LIMB_BITS` instead.",
    "created_at": "2014-10-22T23:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224550",
    "user": "https://github.com/simon-king-jena"
}
```

How clever are compilers?

The question is related to idioms like `n % GMP_LIMB_BITS`.

`GMP_LIMB_BITS` is a power of two, and it is known at compile time. Hence, `n % GMP_LIMB_BITS` does not involve a generally very expensive `%`-operation, but boils down to a simple `&`.

Will compilers automatically use this optimization? If not, then I think we should introduce an integer constant `mod_mp_bits_per_limb` (see #15820), so that `n % GMP_LIMB_BITS == n & mp_bits_per_limb`. If yes, then I guess one can also avoid `n >> index_shift`, and use `n//GMP_LIMB_BITS` instead.



---

archive/issue_comments_224551.json:
```json
{
    "body": "One place or another (i.e., here or #15820), we will have to deal with the corner case of size zero. The reason: \"A common requirement for all functions is that each source area needs at least one limb. No size argument may be zero.\" See [GMP low level functions](https://gmplib.org/manual/Low_002dlevel-Functions.html). I suggest we deal with it *here*.",
    "created_at": "2014-10-22T23:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224551",
    "user": "https://github.com/simon-king-jena"
}
```

One place or another (i.e., here or #15820), we will have to deal with the corner case of size zero. The reason: "A common requirement for all functions is that each source area needs at least one limb. No size argument may be zero." See [GMP low level functions](https://gmplib.org/manual/Low_002dlevel-Functions.html). I suggest we deal with it *here*.



---

archive/issue_comments_224552.json:
```json
{
    "body": "It seems that compilers are clever. On my 32-bit laptop:\n\n```\nsage: cython(\"\"\"\n....: cpdef unsigned int f1(unsigned int size):\n....:     return (size -1)/(8*sizeof(unsigned int)) +1\n....: cpdef unsigned int f2(unsigned int size):\n....:     return ((size -1)>>5)+1\n\"\"\")\nsage: f1(89)\n3L\nsage: f2(89)\n3L\nsage: %timeit f1(89)\n1000000 loops, best of 3: 376 ns per loop\nsage: %timeit f2(89)\n1000000 loops, best of 3: 371 ns per loop\nsage: %timeit f1(89)\n1000000 loops, best of 3: 377 ns per loop\nsage: %timeit f2(89)\n1000000 loops, best of 3: 375 ns per loop\nsage: %timeit f1(189)\n1000000 loops, best of 3: 377 ns per loop\nsage: %timeit f2(189)\n1000000 loops, best of 3: 382 ns per loop\n```\n\n\n```\nsage: cython(\"\"\"\n....: cdef unsigned int bpl = 32\n....: cdef unsigned int modbpl = 31\n....: cpdef unsigned int f1(unsigned int size):\n....:     return size%bpl\n....: cpdef unsigned int f2(unsigned int size):\n....:     return size&modbpl\n....: \"\"\")\nsage: f1(89)\n25L\nsage: f2(89)\n25L\nsage: %timeit f1(89)\n1000000 loops, best of 3: 380 ns per loop\nsage: %timeit f2(89)\n1000000 loops, best of 3: 375 ns per loop\nsage: %timeit f1(189)\n1000000 loops, best of 3: 382 ns per loop\nsage: %timeit f2(189)\n1000000 loops, best of 3: 375 ns per loop\n```\n\nSo, not really a difference...",
    "created_at": "2014-10-23T06:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224552",
    "user": "https://github.com/simon-king-jena"
}
```

It seems that compilers are clever. On my 32-bit laptop:

```
sage: cython("""
....: cpdef unsigned int f1(unsigned int size):
....:     return (size -1)/(8*sizeof(unsigned int)) +1
....: cpdef unsigned int f2(unsigned int size):
....:     return ((size -1)>>5)+1
""")
sage: f1(89)
3L
sage: f2(89)
3L
sage: %timeit f1(89)
1000000 loops, best of 3: 376 ns per loop
sage: %timeit f2(89)
1000000 loops, best of 3: 371 ns per loop
sage: %timeit f1(89)
1000000 loops, best of 3: 377 ns per loop
sage: %timeit f2(89)
1000000 loops, best of 3: 375 ns per loop
sage: %timeit f1(189)
1000000 loops, best of 3: 377 ns per loop
sage: %timeit f2(189)
1000000 loops, best of 3: 382 ns per loop
```


```
sage: cython("""
....: cdef unsigned int bpl = 32
....: cdef unsigned int modbpl = 31
....: cpdef unsigned int f1(unsigned int size):
....:     return size%bpl
....: cpdef unsigned int f2(unsigned int size):
....:     return size&modbpl
....: """)
sage: f1(89)
25L
sage: f2(89)
25L
sage: %timeit f1(89)
1000000 loops, best of 3: 380 ns per loop
sage: %timeit f2(89)
1000000 loops, best of 3: 375 ns per loop
sage: %timeit f1(189)
1000000 loops, best of 3: 382 ns per loop
sage: %timeit f2(189)
1000000 loops, best of 3: 375 ns per loop
```

So, not really a difference...



---

archive/issue_comments_224553.json:
```json
{
    "body": "Replying to [comment:12 SimonKing]:\n> I suggest we deal with it *here*.\nI would actually suggest the opposite. Keep assuming that bitsets have size > 0 and implement empty biseqs using bitsets of size 1. I think this will be the simplest.\n\nWhy do you think this is a bad idea?",
    "created_at": "2014-10-23T07:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224553",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 SimonKing]:
> I suggest we deal with it *here*.
I would actually suggest the opposite. Keep assuming that bitsets have size > 0 and implement empty biseqs using bitsets of size 1. I think this will be the simplest.

Why do you think this is a bad idea?



---

archive/issue_comments_224554.json:
```json
{
    "body": "Replying to [comment:14 jdemeyer]:\n> Replying to [comment:12 SimonKing]:\n> > I suggest we deal with it *here*.\n> I would actually suggest the opposite. Keep assuming that bitsets have size > 0 and implement empty biseqs using bitsets of size 1. I think this will be the simplest.\n> \n> Why do you think this is a bad idea?\n\nSince I suppose people would think that the empty set should be available as a bitset.",
    "created_at": "2014-10-23T07:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224554",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:14 jdemeyer]:
> Replying to [comment:12 SimonKing]:
> > I suggest we deal with it *here*.
> I would actually suggest the opposite. Keep assuming that bitsets have size > 0 and implement empty biseqs using bitsets of size 1. I think this will be the simplest.
> 
> Why do you think this is a bad idea?

Since I suppose people would think that the empty set should be available as a bitset.



---

archive/issue_comments_224555.json:
```json
{
    "body": "Anyway, if you think that there should be no empty bitset and if you agree that it should be moved to sage.data_structures.bitset, then it needs review, since all tests pass and the doc correctly appears in sage.data_structures.",
    "created_at": "2014-10-23T07:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224555",
    "user": "https://github.com/simon-king-jena"
}
```

Anyway, if you think that there should be no empty bitset and if you agree that it should be moved to sage.data_structures.bitset, then it needs review, since all tests pass and the doc correctly appears in sage.data_structures.



---

archive/issue_comments_224556.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-23T07:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224556",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224557.json:
```json
{
    "body": "About moving that to structure... If you want to move bitsets from misc to structure and so make this 'structure' folder mean \"data structure\", could you also move the other data structure files from misc there ? I looked at the list and it seems that only `binary_tree.*` and `binary_matrix.*` are there.\n\nNathann",
    "created_at": "2014-10-23T08:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224557",
    "user": "https://github.com/nathanncohen"
}
```

About moving that to structure... If you want to move bitsets from misc to structure and so make this 'structure' folder mean "data structure", could you also move the other data structure files from misc there ? I looked at the list and it seems that only `binary_tree.*` and `binary_matrix.*` are there.

Nathann



---

archive/issue_comments_224558.json:
```json
{
    "body": "Replying to [comment:19 ncohen]:\n> About moving that to structure... If you want to move bitsets from misc to structure and so make this 'structure' folder mean \"data structure\", could you also move the other data structure files from misc there ?\nIt's not `structure`, it's `data_structures`. And moving other things should be not on this ticket.",
    "created_at": "2014-10-23T08:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224558",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 ncohen]:
> About moving that to structure... If you want to move bitsets from misc to structure and so make this 'structure' folder mean "data structure", could you also move the other data structure files from misc there ?
It's not `structure`, it's `data_structures`. And moving other things should be not on this ticket.



---

archive/issue_comments_224559.json:
```json
{
    "body": "Oh.\n\nSo we will have two folders named `structure/`, `data_structure/`, and data structure code in both `data_structure/` and `misc/`.\n\nCool.\n\nNathan",
    "created_at": "2014-10-23T08:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224559",
    "user": "https://github.com/nathanncohen"
}
```

Oh.

So we will have two folders named `structure/`, `data_structure/`, and data structure code in both `data_structure/` and `misc/`.

Cool.

Nathan



---

archive/issue_comments_224560.json:
```json
{
    "body": "Replying to [comment:21 ncohen]:\n> data structure code in both `data_structure/` and `misc/`.\nand in `structure/` and in `matroids/` and in `combinat/` and probably other places...",
    "created_at": "2014-10-23T09:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224560",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:21 ncohen]:
> data structure code in both `data_structure/` and `misc/`.
and in `structure/` and in `matroids/` and in `combinat/` and probably other places...



---

archive/issue_comments_224561.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-23T09:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224561",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_224562.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> Replying to [comment:21 ncohen]:\n> > data structure code in both `data_structure/` and `misc/`.\n> and in `structure/` and in `matroids/` and in `combinat/` and probably other places...\n\nNathann, if I understand correctly, the plan is to eventually move\n- all sage-specific data structures (e.g.,, those that only make sense within Sage's coercion framework) to `structure`, \n- all data structures that make sense without Sage and are not tied to a specific mathematical topic (bitsets, bitmatrices, bounded integer sequences, the dictionaries that are currently defined in `sage.structure.coerce_dict`) to `data_structures`\n\nand then `misc` should be reserved to miscellaneous *mathematical* topics (I think this is the definition according to the docs).",
    "created_at": "2014-10-23T09:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224562",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:22 jdemeyer]:
> Replying to [comment:21 ncohen]:
> > data structure code in both `data_structure/` and `misc/`.
> and in `structure/` and in `matroids/` and in `combinat/` and probably other places...

Nathann, if I understand correctly, the plan is to eventually move
- all sage-specific data structures (e.g.,, those that only make sense within Sage's coercion framework) to `structure`, 
- all data structures that make sense without Sage and are not tied to a specific mathematical topic (bitsets, bitmatrices, bounded integer sequences, the dictionaries that are currently defined in `sage.structure.coerce_dict`) to `data_structures`

and then `misc` should be reserved to miscellaneous *mathematical* topics (I think this is the definition according to the docs).



---

archive/issue_comments_224563.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> Replying to [comment:21 ncohen]:\n> > data structure code in both `data_structure/` and `misc/`.\n> and in `structure/` and in `matroids/` and in `combinat/` and probably other places...\n\nPS: Of course there will be data structure code in many places, for example in `sage.matrices`. This is because such data structures are designed for a specific mathematical purpose (e.g., implementing matrix algebras).",
    "created_at": "2014-10-23T10:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224563",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:22 jdemeyer]:
> Replying to [comment:21 ncohen]:
> > data structure code in both `data_structure/` and `misc/`.
> and in `structure/` and in `matroids/` and in `combinat/` and probably other places...

PS: Of course there will be data structure code in many places, for example in `sage.matrices`. This is because such data structures are designed for a specific mathematical purpose (e.g., implementing matrix algebras).



---

archive/issue_comments_224564.json:
```json
{
    "body": "Yo !\n\n> Nathann, if I understand correctly, the plan is to eventually move\n> - all sage-specific data structures (e.g.,, those that only make sense within Sage's coercion framework) to `structure`, \n> - all data structures that make sense without Sage and are not tied to a specific mathematical topic (bitsets, bitmatrices, bounded integer sequences, the dictionaries that are currently defined in `sage.structure.coerce_dict`) to `data_structures`\n> \n> and then `misc` should be reserved to miscellaneous *mathematical* topics (I think this is the definition according to the docs).\n\nI understand. I merely mentionned that by only moving bitsets here the code would be in a weird state where only bitsets are in the new folder while others are still scattered.\n\nIt also feels weird to have a directory named \"structure\" and one named \"data structures\". Do you have any idea of how \"structure\" could be renamed ?\n\nNathann",
    "created_at": "2014-10-23T10:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224564",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> Nathann, if I understand correctly, the plan is to eventually move
> - all sage-specific data structures (e.g.,, those that only make sense within Sage's coercion framework) to `structure`, 
> - all data structures that make sense without Sage and are not tied to a specific mathematical topic (bitsets, bitmatrices, bounded integer sequences, the dictionaries that are currently defined in `sage.structure.coerce_dict`) to `data_structures`
> 
> and then `misc` should be reserved to miscellaneous *mathematical* topics (I think this is the definition according to the docs).

I understand. I merely mentionned that by only moving bitsets here the code would be in a weird state where only bitsets are in the new folder while others are still scattered.

It also feels weird to have a directory named "structure" and one named "data structures". Do you have any idea of how "structure" could be renamed ?

Nathann



---

archive/issue_comments_224565.json:
```json
{
    "body": "Replying to [comment:27 ncohen]:\n> It also feels weird to have a directory named \"structure\" and one named \"data structures\". Do you have any idea of how \"structure\" could be renamed ?\nI wouldn't rename `structure` because it will cause too much trouble. It contains very fundamental modules, with lots of code depending on it. Fixing the Sage library itself is not so hard, but the annoying part is all the tickets which currently sit on Trac and import stuff from `structure`.",
    "created_at": "2014-10-23T10:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224565",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 ncohen]:
> It also feels weird to have a directory named "structure" and one named "data structures". Do you have any idea of how "structure" could be renamed ?
I wouldn't rename `structure` because it will cause too much trouble. It contains very fundamental modules, with lots of code depending on it. Fixing the Sage library itself is not so hard, but the annoying part is all the tickets which currently sit on Trac and import stuff from `structure`.



---

archive/issue_comments_224566.json:
```json
{
    "body": "Replying to [comment:11 SimonKing]:\n> How clever are compilers?\n> \n> The question is related to idioms like `n % GMP_LIMB_BITS`.\n> \n> `GMP_LIMB_BITS` is a power of two, and it is known at compile time. Hence, `n % GMP_LIMB_BITS` does not involve a generally very expensive `%`-operation, but boils down to a simple `&`.\n> \n> Will compilers automatically use this optimization?\nYes, they should. It's an obvious easy optimization.",
    "created_at": "2014-10-23T10:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224566",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 SimonKing]:
> How clever are compilers?
> 
> The question is related to idioms like `n % GMP_LIMB_BITS`.
> 
> `GMP_LIMB_BITS` is a power of two, and it is known at compile time. Hence, `n % GMP_LIMB_BITS` does not involve a generally very expensive `%`-operation, but boils down to a simple `&`.
> 
> Will compilers automatically use this optimization?
Yes, they should. It's an obvious easy optimization.



---

archive/issue_comments_224567.json:
```json
{
    "body": "> > It also feels weird to have a directory named \"structure\" and one named \"data structures\". Do you have any idea of how \"structure\" could be renamed ?\n> I wouldn't rename `structure` because it will cause too much trouble. It contains very fundamental modules, with lots of code depending on it. Fixing the Sage library itself is not so hard, but the annoying part is all the tickets which currently sit on Trac and import stuff from `structure`.\n\nCome on, since when do we have to be compatible with the patches in `needs_review`/`needs_work` ?\n\nNathann",
    "created_at": "2014-10-23T11:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224567",
    "user": "https://github.com/nathanncohen"
}
```

> > It also feels weird to have a directory named "structure" and one named "data structures". Do you have any idea of how "structure" could be renamed ?
> I wouldn't rename `structure` because it will cause too much trouble. It contains very fundamental modules, with lots of code depending on it. Fixing the Sage library itself is not so hard, but the annoying part is all the tickets which currently sit on Trac and import stuff from `structure`.

Come on, since when do we have to be compatible with the patches in `needs_review`/`needs_work` ?

Nathann



---

archive/issue_comments_224568.json:
```json
{
    "body": "For the record: I like the changes introduced by Jeroen, and it seems to work well in #15820. Hence, I give a positive review to the part of the code that I didn't author.",
    "created_at": "2014-10-24T10:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224568",
    "user": "https://github.com/simon-king-jena"
}
```

For the record: I like the changes introduced by Jeroen, and it seems to work well in #15820. Hence, I give a positive review to the part of the code that I didn't author.



---

archive/issue_comments_224569.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-27T07:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224569",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_049823.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-27T16:02:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16959#event-49823"
}
```



---

archive/issue_comments_224570.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-27T16:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-224570",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
