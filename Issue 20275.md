# Issue 20275: Jacobian of the tautologous subscheme of a toric variety is broken

Issue created by migration from https://trac.sagemath.org/ticket/20512

Original creator: kedlaya

Original creation time: 2016-04-27 23:09:06

Keywords: schemes, Jacobian

This shouldn't return an error:

```
sage: P.<x,y,z> = ProjectiveSpace(2, QQ)
sage: X = P.subscheme([])
sage: X.Jacobian_matrix() # This works
[]
sage: X.Jacobian() #This doesn't
...
AttributeError: 'sage.rings.integer.Integer' object has no attribute 'reduce'
```

I think the mathematically correct answer is that X.Jacobian() should again equal X (i.e., P viewed as a closed subscheme of itself). However, this is not consistent with the definition in the docstring:

```
  * the `d\times d` minors of the Jacobian matrix, where `d` is
    the :meth:`codimension` of the algebraic scheme, and

  * the defining polynomials of the algebraic scheme. Note that
    some authors do not include these in the definition of the
    Jacobian ideal. An example of a reference that does include
    the defining equations is [LazarsfeldJacobian].
```

In this case d=0, and the unique 0 by 0 minor of any matrix (empty or not) is equal to 1.


---

Comment by kedlaya created at 2016-04-27 23:45:04

Changing keywords from "schemes, Jacobian" to "schemes, Jacobian, matrix, minors".


---

Comment by kedlaya created at 2016-04-27 23:45:04

In fact, the problem seems to be that the 0 by 0 minor of a matrix is returned as 1 in the ring of integers, not the base ring of the matrix. Retitled and reclassified accordingly.


---

Comment by kedlaya created at 2016-04-27 23:45:04

Changing component from algebraic geometry to linear algebra.


---

Comment by kedlaya created at 2016-04-28 00:12:28

Changing status from new to needs_review.


---

Comment by kedlaya created at 2016-04-28 00:12:28

I changed matrix/matrix2.pyx to fix the underlying issue with minors, and added a doctest to schemes/generic/algebraic_scheme.py to confirm that Jacobian is no longer broken.
----
New commits:


---

Comment by chapoton created at 2016-04-28 07:32:54

* doc is not formatted correctly, the line before the tests should end with `::` and be followed by a blank line

* please also use `:trac:`20512`` instead of the bare `#20512`

* you should rather use `.base_ring().one()` instead of `.base_ring()(1)`


---

Comment by chapoton created at 2016-04-28 15:29:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-04-28 18:15:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2016-04-28 18:20:11

Replying to [comment:5 chapoton]:
> * doc is not formatted correctly, the line before the tests should end with `::` and be followed by a blank line
> 
> * please also use `:trac:`20512`` instead of the bare `#20512`
> 
> * you should rather use `.base_ring().one()` instead of `.base_ring()(1)`
> 
All done. Also, I noticed that my fix wasn't actually sufficient: in `algebraic_scheme`, the `Jacobian_matrix()` method also needs to be forced to produce a matrix in the correct ring. The last commit does this.


---

Comment by kedlaya created at 2016-04-28 18:24:13

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-04-29 06:12:52

ok, thanks. Good to go.


---

Comment by chapoton created at 2016-04-29 06:12:52

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-05-01 16:30:29

Resolution: fixed
