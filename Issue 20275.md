# Issue 20275: Jacobian of the tautologous subscheme of a toric variety is broken

archive/issues_020275.json:
```json
{
    "body": "Keywords: schemes, Jacobian\n\nThis shouldn't return an error:\n\n```\nsage: P.<x,y,z> = ProjectiveSpace(2, QQ)\nsage: X = P.subscheme([])\nsage: X.Jacobian_matrix() # This works\n[]\nsage: X.Jacobian() #This doesn't\n...\nAttributeError: 'sage.rings.integer.Integer' object has no attribute 'reduce'\n```\n\nI think the mathematically correct answer is that X.Jacobian() should again equal X (i.e., P viewed as a closed subscheme of itself). However, this is not consistent with the definition in the docstring:\n\n```\n  * the `d\\times d` minors of the Jacobian matrix, where `d` is\n    the :meth:`codimension` of the algebraic scheme, and\n\n  * the defining polynomials of the algebraic scheme. Note that\n    some authors do not include these in the definition of the\n    Jacobian ideal. An example of a reference that does include\n    the defining equations is [LazarsfeldJacobian].\n```\n\nIn this case d=0, and the unique 0 by 0 minor of any matrix (empty or not) is equal to 1.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20512\n\n",
    "created_at": "2016-04-27T23:09:06Z",
    "labels": [
        "algebraic geometry",
        "major",
        "bug"
    ],
    "title": "Jacobian of the tautologous subscheme of a toric variety is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20275",
    "user": "kedlaya"
}
```
Keywords: schemes, Jacobian

This shouldn't return an error:

```
sage: P.<x,y,z> = ProjectiveSpace(2, QQ)
sage: X = P.subscheme([])
sage: X.Jacobian_matrix() # This works
[]
sage: X.Jacobian() #This doesn't
...
AttributeError: 'sage.rings.integer.Integer' object has no attribute 'reduce'
```

I think the mathematically correct answer is that X.Jacobian() should again equal X (i.e., P viewed as a closed subscheme of itself). However, this is not consistent with the definition in the docstring:

```
  * the `d\times d` minors of the Jacobian matrix, where `d` is
    the :meth:`codimension` of the algebraic scheme, and

  * the defining polynomials of the algebraic scheme. Note that
    some authors do not include these in the definition of the
    Jacobian ideal. An example of a reference that does include
    the defining equations is [LazarsfeldJacobian].
```

In this case d=0, and the unique 0 by 0 minor of any matrix (empty or not) is equal to 1.

Issue created by migration from https://trac.sagemath.org/ticket/20512





---

archive/issue_comments_279371.json:
```json
{
    "body": "Changing keywords from \"schemes, Jacobian\" to \"schemes, Jacobian, matrix, minors\".",
    "created_at": "2016-04-27T23:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279371",
    "user": "kedlaya"
}
```

Changing keywords from "schemes, Jacobian" to "schemes, Jacobian, matrix, minors".



---

archive/issue_comments_279372.json:
```json
{
    "body": "In fact, the problem seems to be that the 0 by 0 minor of a matrix is returned as 1 in the ring of integers, not the base ring of the matrix. Retitled and reclassified accordingly.",
    "created_at": "2016-04-27T23:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279372",
    "user": "kedlaya"
}
```

In fact, the problem seems to be that the 0 by 0 minor of a matrix is returned as 1 in the ring of integers, not the base ring of the matrix. Retitled and reclassified accordingly.



---

archive/issue_comments_279373.json:
```json
{
    "body": "Changing component from algebraic geometry to linear algebra.",
    "created_at": "2016-04-27T23:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279373",
    "user": "kedlaya"
}
```

Changing component from algebraic geometry to linear algebra.



---

archive/issue_comments_279374.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-28T00:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279374",
    "user": "kedlaya"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_279375.json:
```json
{
    "body": "I changed matrix/matrix2.pyx to fix the underlying issue with minors, and added a doctest to schemes/generic/algebraic_scheme.py to confirm that Jacobian is no longer broken.\n----\nNew commits:",
    "created_at": "2016-04-28T00:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279375",
    "user": "kedlaya"
}
```

I changed matrix/matrix2.pyx to fix the underlying issue with minors, and added a doctest to schemes/generic/algebraic_scheme.py to confirm that Jacobian is no longer broken.
----
New commits:



---

archive/issue_comments_279376.json:
```json
{
    "body": "* doc is not formatted correctly, the line before the tests should end with `::` and be followed by a blank line\n\n* please also use `:trac:`20512`` instead of the bare `#20512`\n\n* you should rather use `.base_ring().one()` instead of `.base_ring()(1)`",
    "created_at": "2016-04-28T07:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279376",
    "user": "chapoton"
}
```

* doc is not formatted correctly, the line before the tests should end with `::` and be followed by a blank line

* please also use `:trac:`20512`` instead of the bare `#20512`

* you should rather use `.base_ring().one()` instead of `.base_ring()(1)`



---

archive/issue_comments_279377.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-28T15:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279377",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_279378.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-28T18:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279378",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279379.json:
```json
{
    "body": "Replying to [comment:5 chapoton]:\n> * doc is not formatted correctly, the line before the tests should end with `::` and be followed by a blank line\n> \n> * please also use `:trac:`20512`` instead of the bare `#20512`\n> \n> * you should rather use `.base_ring().one()` instead of `.base_ring()(1)`\n> \nAll done. Also, I noticed that my fix wasn't actually sufficient: in `algebraic_scheme`, the `Jacobian_matrix()` method also needs to be forced to produce a matrix in the correct ring. The last commit does this.",
    "created_at": "2016-04-28T18:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279379",
    "user": "kedlaya"
}
```

Replying to [comment:5 chapoton]:
> * doc is not formatted correctly, the line before the tests should end with `::` and be followed by a blank line
> 
> * please also use `:trac:`20512`` instead of the bare `#20512`
> 
> * you should rather use `.base_ring().one()` instead of `.base_ring()(1)`
> 
All done. Also, I noticed that my fix wasn't actually sufficient: in `algebraic_scheme`, the `Jacobian_matrix()` method also needs to be forced to produce a matrix in the correct ring. The last commit does this.



---

archive/issue_comments_279380.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-28T18:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279380",
    "user": "kedlaya"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_279381.json:
```json
{
    "body": "ok, thanks. Good to go.",
    "created_at": "2016-04-29T06:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279381",
    "user": "chapoton"
}
```

ok, thanks. Good to go.



---

archive/issue_comments_279382.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-29T06:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279382",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_279383.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-01T16:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20275#issuecomment-279383",
    "user": "vbraun"
}
```

Resolution: fixed
