# Issue 24665: optional package deformation fails to build

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2018-03-05 16:47:42

CC:  jpflori

On archlinux

```
/usr/bin/ld: -r and -pie may not be used together
```


See the more complete log at XXX


---

Attachment


---

Comment by fbissey created at 2018-03-05 20:27:37

Flint had that issue some time ago. This is caused by the hardening of the toolchain. Look at what has been done for flint here
[https://github.com/sagemath/sage/blob/master/build/pkgs/flint/patches/flint-pie-hardening-conflict.patch](https://github.com/sagemath/sage/blob/master/build/pkgs/flint/patches/flint-pie-hardening-conflict.patch). Basically you give `-r` directly to the compiler but don't pass it directly to the linker as you would with `-Wl,-r`.


---

Comment by fbissey created at 2018-03-06 01:18:40

The culprit is this line

```
Makefile.subdirs:       $(QUIET_CC) $(CC) $(ABI_FLAG) -Wl,-r $^ -o $`@` -nostdlib
```

Change `-Wl,-r` to plain `-r` should get you in business. Can someone also please update `SPKG.txt` with upstream location? Where did you get that tarball from? Has it been processed before being put on the mirror?


---

Comment by vdelecroix created at 2018-03-08 10:41:41

A patch is provided in #24575, should I move it here?


---

Comment by vdelecroix created at 2018-03-08 10:41:47

Replying to [comment:5 vdelecroix]:
> A patch is provided in #24575, should I move it here?


---

Comment by fbissey created at 2018-03-08 10:45:48

No need we can just mark this ticket as a "duplicate" of #24575.


---

Comment by vdelecroix created at 2018-03-08 10:47:40

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-03-11 17:19:16

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-04-15 10:49:08

Changing priority from blocker to critical.


---

Comment by vdelecroix created at 2018-05-18 17:16:26

Resolution: wontfix


---

Comment by vdelecroix created at 2018-05-18 17:16:26

closing positively reviewed duplicates
