# Issue 21438: Deal better with renaming libfplll -> fplll

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2016-10-10 08:52:55

CC:  tmonteil jpflori cpernet malb

The renaming of `libfplll` -> `fplll` causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.


---

Comment by jpflori created at 2016-10-10 09:27:13

Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?


---

Comment by jpflori created at 2016-10-10 11:00:47

Here is something.
I have to go now so I did not have time to test it correctly, fplll is still compiling.
----
New commits:


---

Comment by jdemeyer created at 2016-10-10 12:06:16

Replying to [comment:4 jpflori]:
> Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?

That only solves the problem in one direction and will break a downgrade followed by an upgrade (`fplll` -> `libfplll` -> `fplll`).


---

Comment by jpflori created at 2016-10-10 13:08:32

You mean that `fplll` (and cython files depending on the lib) won't get rebuilt the second time?


---

Comment by jpflori created at 2016-10-10 13:11:35

Oops, I was doing two things at the same time and did not pay attention to the warning...
----
New commits:


---

Comment by jdemeyer created at 2016-10-10 13:13:37

Replying to [comment:8 jpflori]:
> You mean that `fplll` won't get rebuilt the second time?

Exactly, because the build system will think that `fplll` is still installed.

The only way to get this working is to delete the files from `SAGE_SPKG_INST` in *both* directions (the old package should delete the new installed files and the new package should delete the old installed files).

Luckily, we can use the MPFR upgrade as an extra way to force a rebuild of `libfplll` when downgrading to sage-7.4.beta6 or earlier.


---

Comment by jdemeyer created at 2016-10-10 14:49:16

Changing status from new to needs_review.


---

Comment by jpflori created at 2016-10-11 08:14:06

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2016-10-11 08:14:06

Ok, let's hack this in.


---

Comment by vbraun created at 2016-10-12 06:53:22

Resolution: fixed


---

Comment by jdemeyer created at 2016-10-12 09:45:50

Just mentioning that I have been hit by this issue several times since the release of Sage 7.4.rc0 while working on different tickets.


---

Comment by jdemeyer created at 2016-10-13 14:38:46

Volker: this was closed _before_ the release of Sage 7.4.rc1 but still isn't contained in Sage 7.4.rc1. And I don't see it appearing in https://github.com/vbraun/sage/commits/develop

Was this intentional or did something go wrong?


---

Comment by vbraun created at 2016-10-13 14:55:57

it'll be in rc2


---

Comment by jpflori created at 2016-11-15 09:08:31

Should we rerevert this now?


---

Comment by jdemeyer created at 2016-11-15 09:11:21

Replying to [comment:19 jpflori]:
> Should we rerevert this now?

We could.


---

Comment by jpflori created at 2016-11-15 09:30:52

I guess 5.1.0 is coming, that would be a good opportunity.
