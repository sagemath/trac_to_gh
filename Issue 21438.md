# Issue 21438: Deal better with renaming libfplll -> fplll

archive/issues_021438.json:
```json
{
    "body": "CC:  tmonteil jpflori @ClementPernet @malb\n\nThe renaming of `libfplll` -> `fplll` causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21675\n\n",
    "created_at": "2016-10-10T08:52:55Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Deal better with renaming libfplll -> fplll",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21438",
    "user": "https://github.com/jdemeyer"
}
```
CC:  tmonteil jpflori @ClementPernet @malb

The renaming of `libfplll` -> `fplll` causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.

Issue created by migration from https://trac.sagemath.org/ticket/21675





---

archive/issue_comments_297210.json:
```json
{
    "body": "Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?",
    "created_at": "2016-10-10T09:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297210",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?



---

archive/issue_comments_297211.json:
```json
{
    "body": "Here is something.\nI have to go now so I did not have time to test it correctly, fplll is still compiling.\n----\nNew commits:",
    "created_at": "2016-10-10T11:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297211",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Here is something.
I have to go now so I did not have time to test it correctly, fplll is still compiling.
----
New commits:



---

archive/issue_comments_297212.json:
```json
{
    "body": "Replying to [comment:4 jpflori]:\n> Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?\n\nThat only solves the problem in one direction and will break a downgrade followed by an upgrade (`fplll` -> `libfplll` -> `fplll`).",
    "created_at": "2016-10-10T12:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297212",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 jpflori]:
> Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?

That only solves the problem in one direction and will break a downgrade followed by an upgrade (`fplll` -> `libfplll` -> `fplll`).



---

archive/issue_comments_297213.json:
```json
{
    "body": "You mean that `fplll` (and cython files depending on the lib) won't get rebuilt the second time?",
    "created_at": "2016-10-10T13:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297213",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

You mean that `fplll` (and cython files depending on the lib) won't get rebuilt the second time?



---

archive/issue_comments_297214.json:
```json
{
    "body": "Oops, I was doing two things at the same time and did not pay attention to the warning...\n----\nNew commits:",
    "created_at": "2016-10-10T13:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297214",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Oops, I was doing two things at the same time and did not pay attention to the warning...
----
New commits:



---

archive/issue_comments_297215.json:
```json
{
    "body": "Replying to [comment:8 jpflori]:\n> You mean that `fplll` won't get rebuilt the second time?\n\nExactly, because the build system will think that `fplll` is still installed.\n\nThe only way to get this working is to delete the files from `SAGE_SPKG_INST` in **both** directions (the old package should delete the new installed files and the new package should delete the old installed files).\n\nLuckily, we can use the MPFR upgrade as an extra way to force a rebuild of `libfplll` when downgrading to sage-7.4.beta6 or earlier.",
    "created_at": "2016-10-10T13:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297215",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 jpflori]:
> You mean that `fplll` won't get rebuilt the second time?

Exactly, because the build system will think that `fplll` is still installed.

The only way to get this working is to delete the files from `SAGE_SPKG_INST` in **both** directions (the old package should delete the new installed files and the new package should delete the old installed files).

Luckily, we can use the MPFR upgrade as an extra way to force a rebuild of `libfplll` when downgrading to sage-7.4.beta6 or earlier.



---

archive/issue_comments_297216.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-10T14:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297216",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_297217.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-11T08:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297217",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_297218.json:
```json
{
    "body": "Ok, let's hack this in.",
    "created_at": "2016-10-11T08:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297218",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok, let's hack this in.



---

archive/issue_events_020273.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-10-12T06:53:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21438#event-20273"
}
```



---

archive/issue_comments_297219.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-12T06:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297219",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_297220.json:
```json
{
    "body": "Just mentioning that I have been hit by this issue several times since the release of Sage 7.4.rc0 while working on different tickets.",
    "created_at": "2016-10-12T09:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297220",
    "user": "https://github.com/jdemeyer"
}
```

Just mentioning that I have been hit by this issue several times since the release of Sage 7.4.rc0 while working on different tickets.



---

archive/issue_comments_297221.json:
```json
{
    "body": "Volker: this was closed *before* the release of Sage 7.4.rc1 but still isn't contained in Sage 7.4.rc1. And I don't see it appearing in https://github.com/vbraun/sage/commits/develop\n\nWas this intentional or did something go wrong?",
    "created_at": "2016-10-13T14:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297221",
    "user": "https://github.com/jdemeyer"
}
```

Volker: this was closed *before* the release of Sage 7.4.rc1 but still isn't contained in Sage 7.4.rc1. And I don't see it appearing in https://github.com/vbraun/sage/commits/develop

Was this intentional or did something go wrong?



---

archive/issue_comments_297222.json:
```json
{
    "body": "it'll be in rc2",
    "created_at": "2016-10-13T14:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297222",
    "user": "https://github.com/vbraun"
}
```

it'll be in rc2



---

archive/issue_comments_297223.json:
```json
{
    "body": "Should we rerevert this now?",
    "created_at": "2016-11-15T09:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297223",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Should we rerevert this now?



---

archive/issue_comments_297224.json:
```json
{
    "body": "Replying to [comment:19 jpflori]:\n> Should we rerevert this now?\n\nWe could.",
    "created_at": "2016-11-15T09:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297224",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 jpflori]:
> Should we rerevert this now?

We could.



---

archive/issue_comments_297225.json:
```json
{
    "body": "I guess 5.1.0 is coming, that would be a good opportunity.",
    "created_at": "2016-11-15T09:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21438#issuecomment-297225",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I guess 5.1.0 is coming, that would be a good opportunity.
