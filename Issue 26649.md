# Issue 26649: Replace Combinatorial Object to Clonable List in combinat.derangement.Derangement

archive/issues_026649.json:
```json
{
    "body": "CC:  @hivert boussica\n\nPart of #26883 meta-ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26886\n\n",
    "created_at": "2018-12-12T17:18:47Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Replace Combinatorial Object to Clonable List in combinat.derangement.Derangement",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26649",
    "user": "https://github.com/vinklein"
}
```
CC:  @hivert boussica

Part of #26883 meta-ticket.

Issue created by migration from https://trac.sagemath.org/ticket/26886





---

archive/issue_comments_373998.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2018-12-13T13:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-373998",
    "user": "https://github.com/vinklein"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_373999.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-12-13T13:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-373999",
    "user": "https://github.com/vinklein"
}
```

New commits:



---

archive/issue_comments_374000.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-13T16:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374000",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374001.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-17T10:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374001",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_374002.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-17T10:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374002",
    "user": "https://github.com/vinklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_374003.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-17T10:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374003",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_374004.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374004",
    "user": "https://github.com/embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_374005.json:
```json
{
    "body": "Review 1 remark 1\n\nIn `__classccall_private__()`, i think that you modify the functionalities of the Derangements class.\nIn their documentation, a derangement on a set S is a permutation sigma such that\nsigma(x) neq x for all x in S, i.e. sigma is a permutation of S with no fixed points.\n\nSo S can be an arbitrary set. For example, S can be equals to `[1,x,x**2]`. The following code shows that functionality:\n\n\n```\nsage: DDS = Derangements([1, x, x^2])\nsage: DDS\nDerangements of the set [x, x + 1, x^2]\nsage: list( DDS )\n[[x + 1, x^2, x], [x^2, x, x + 1]]\n```\n\n\nSo, in the code of `__class_call__private__()` you should'nt write \n\n```\n+        parent_set = [i + 1 for i in range(len(lst))]\n+        return Derangements(parent_set)(lst)\n```\n\n\nIndeed, you tranform any Derangment on any set to a derangement on some integers.\n\nSee the next comment for more details.",
    "created_at": "2019-01-31T10:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374005",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

Review 1 remark 1

In `__classccall_private__()`, i think that you modify the functionalities of the Derangements class.
In their documentation, a derangement on a set S is a permutation sigma such that
sigma(x) neq x for all x in S, i.e. sigma is a permutation of S with no fixed points.

So S can be an arbitrary set. For example, S can be equals to `[1,x,x**2]`. The following code shows that functionality:


```
sage: DDS = Derangements([1, x, x^2])
sage: DDS
Derangements of the set [x, x + 1, x^2]
sage: list( DDS )
[[x + 1, x^2, x], [x^2, x, x + 1]]
```


So, in the code of `__class_call__private__()` you should'nt write 

```
+        parent_set = [i + 1 for i in range(len(lst))]
+        return Derangements(parent_set)(lst)
```


Indeed, you tranform any Derangment on any set to a derangement on some integers.

See the next comment for more details.



---

archive/issue_comments_374006.json:
```json
{
    "body": "Review 1 remark 1 bis\n\nThe problem is the following : \"how do we define correctly, without the parent, a derangement ?\"\n\nFor example with your code we have :\n\n```\nsage: Derangement([2,3,1])\n[2, 3, 1]\n```\n\n\nand \n\n```\nsage: Derangement([x**3, 1+x, x**2])\n---------------------------------------------------------------------------\nAssertionError  \n ...\nAssertionError: All elements of a derangement must be present in their parent set\n```\n\n\nThe problem is : the constructor should deduce the parent with just a list of elements.\nIt is not possible since a bijection is : a support (often implemented with a list of elements) and the image of the support (implemented by another list of  the same elements).\n\nSo, we need those two informations.\n\nSo i propose the following solutions :\n 1) we remove the constructor __class_call_private__ and say that user have to use the parents to\n   construct their objects\n 2) we improve the message error : \n    \"Impossible to guess parents, please construct your derangement by using Derangements\"\n 3) we check if the elements of the list have a canonical total order, we order them and construct\n   the parent Derangements( sorted(lst) )\n 4) The constructor of derangement should always have a list of elements and an order function in parameter. During the construction a parent is obtained with the ordering function and then, the derangement is obtained with the help of the parent. If the ordering function is None, the constructor will use the default ordering on the element.\n\nIn my opinion, i prefer the solution 4).",
    "created_at": "2019-01-31T11:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374006",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

Review 1 remark 1 bis

The problem is the following : "how do we define correctly, without the parent, a derangement ?"

For example with your code we have :

```
sage: Derangement([2,3,1])
[2, 3, 1]
```


and 

```
sage: Derangement([x**3, 1+x, x**2])
---------------------------------------------------------------------------
AssertionError  
 ...
AssertionError: All elements of a derangement must be present in their parent set
```


The problem is : the constructor should deduce the parent with just a list of elements.
It is not possible since a bijection is : a support (often implemented with a list of elements) and the image of the support (implemented by another list of  the same elements).

So, we need those two informations.

So i propose the following solutions :
 1) we remove the constructor __class_call_private__ and say that user have to use the parents to
   construct their objects
 2) we improve the message error : 
    "Impossible to guess parents, please construct your derangement by using Derangements"
 3) we check if the elements of the list have a canonical total order, we order them and construct
   the parent Derangements( sorted(lst) )
 4) The constructor of derangement should always have a list of elements and an order function in parameter. During the construction a parent is obtained with the ordering function and then, the derangement is obtained with the help of the parent. If the ordering function is None, the constructor will use the default ordering on the element.

In my opinion, i prefer the solution 4).



---

archive/issue_comments_374007.json:
```json
{
    "body": "Review 1 Remark 2 :\n\nThe problem raised by Travis in ticket #26884 comment 12 [https://trac.sagemath.org/ticket/26884#comment:12](https://trac.sagemath.org/ticket/26884#comment:12) can be applyed to this ticket.\n\nTravis worte :\n\n> -1 on going through an essentially trivial _element_constructor_ in internal code that should give valid > output. At the very least, you should not run the checks when constructing objects from internal code. \n\nWe need to fix and discuss the functionality of `ClonableList` class , `Check()` function and thet `SetFactory` framework with Florent to answer correctly to that question.",
    "created_at": "2019-02-07T09:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374007",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

Review 1 Remark 2 :

The problem raised by Travis in ticket #26884 comment 12 [https://trac.sagemath.org/ticket/26884#comment:12](https://trac.sagemath.org/ticket/26884#comment:12) can be applyed to this ticket.

Travis worte :

> -1 on going through an essentially trivial _element_constructor_ in internal code that should give valid > output. At the very least, you should not run the checks when constructing objects from internal code. 

We need to fix and discuss the functionality of `ClonableList` class , `Check()` function and thet `SetFactory` framework with Florent to answer correctly to that question.



---

archive/issue_comments_374008.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-07T09:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374008",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_374009.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374009",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_374010.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374010",
    "user": "https://github.com/embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_374011.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374011",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_374012.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374012",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_374013.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374013",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_374014.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26649#issuecomment-374014",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
