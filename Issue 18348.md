# Issue 18348: Comparison of sparse polynomials

archive/issues_018348.json:
```json
{
    "body": "Keywords: polynomials\n\nCurrently, the default `_cmp_` is written with dense polynomials in mind since it creates an `xrange` of size the degree of the polynomial. For sparse polynomials which can have very high degree, this is a problem:\n\n\n```python\nsage: R.<x> = PolynomialRing(ZZ, sparse=True)\nsage: x^2^100 == x^2^100\nTraceback (most recent call last)\n...\nOverflowError: Python int too large to convert to C long\n```\n\n\nThe patch introduces a `_cmp_` method in the class `Polynomial_generic_sparse` to get rid of this problem:\n\n\n```python\nsage: R.<x> = PolynomialRing(ZZ, sparse=True)\nsage: x^2^100 == x^2^100\nTrue\n```\n\n\nNote, as a side comment, that the comparison is faster for polynomials that are indeed sparse with the new code, while the timings are equivalent for quite dense polynomials.\n\nWithout the patch:\n\n```python \nsage: %timeit x^100 == x^100\n1000 loops, best of 3: 224 \u00b5s per loop\n```\n\n\nWith the patch:\n\n```python\nsage: %timeit x^100 == x^100\nThe slowest run took 7.61 times longer than the fastest. This could mean that an intermediate result is being cached \n10000 loops, best of 3: 24.6 \u00b5s per loop\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18585\n\n",
    "created_at": "2015-06-02T13:36:13Z",
    "labels": [
        "commutative algebra",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Comparison of sparse polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18348",
    "user": "@bgrenet"
}
```
Keywords: polynomials

Currently, the default `_cmp_` is written with dense polynomials in mind since it creates an `xrange` of size the degree of the polynomial. For sparse polynomials which can have very high degree, this is a problem:


```python
sage: R.<x> = PolynomialRing(ZZ, sparse=True)
sage: x^2^100 == x^2^100
Traceback (most recent call last)
...
OverflowError: Python int too large to convert to C long
```


The patch introduces a `_cmp_` method in the class `Polynomial_generic_sparse` to get rid of this problem:


```python
sage: R.<x> = PolynomialRing(ZZ, sparse=True)
sage: x^2^100 == x^2^100
True
```


Note, as a side comment, that the comparison is faster for polynomials that are indeed sparse with the new code, while the timings are equivalent for quite dense polynomials.

Without the patch:

```python 
sage: %timeit x^100 == x^100
1000 loops, best of 3: 224 µs per loop
```


With the patch:

```python
sage: %timeit x^100 == x^100
The slowest run took 7.61 times longer than the fastest. This could mean that an intermediate result is being cached 
10000 loops, best of 3: 24.6 µs per loop
```



Issue created by migration from https://trac.sagemath.org/ticket/18585





---

archive/issue_comments_249002.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-02T13:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249002",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249003.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-02T13:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249003",
    "user": "@bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_249004.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-06-02T13:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249004",
    "user": "@bgrenet"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_249005.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-02T13:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249005",
    "user": "@bgrenet"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_249006.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-02T14:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249006",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249007.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-02T14:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249007",
    "user": "@bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_249008.json:
```json
{
    "body": "There was a bug in my first commit, for some case I didn't think to test. I hope there is no more bug, and I've tested all possibilities.",
    "created_at": "2015-06-02T14:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249008",
    "user": "@bgrenet"
}
```

There was a bug in my first commit, for some case I didn't think to test. I hope there is no more bug, and I've tested all possibilities.



---

archive/issue_comments_249009.json:
```json
{
    "body": "Hello,\n\n1. You can replace\n\n```\nkeys1 = list(reversed(sorted(d1.keys())))\n```\n\n  with\n\n```\nkeys1 = d1.keys()\nkeys1.reverse()\n```\n\n\n2. Instead of looking at the length, you can do\n\n```\nif not keys1 and not keys2: return 0\nif not keys1: return -1\nif not keys2: return 1\n```\n\n\n3. Why the first key is treated differently?\n\nVincent",
    "created_at": "2015-06-30T22:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249009",
    "user": "@videlec"
}
```

Hello,

1. You can replace

```
keys1 = list(reversed(sorted(d1.keys())))
```

  with

```
keys1 = d1.keys()
keys1.reverse()
```


2. Instead of looking at the length, you can do

```
if not keys1 and not keys2: return 0
if not keys1: return -1
if not keys2: return 1
```


3. Why the first key is treated differently?

Vincent



---

archive/issue_comments_249010.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-16T08:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249010",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249011.json:
```json
{
    "body": "Replying to [comment:7 vdelecroix]:\n> 1. You can replace\n> {{{\n> keys1 = list(reversed(sorted(d1.keys())))\n> }}}\n>   with\n> {{{\n> keys1 = d1.keys()\n> keys1.reverse()\n> }}}\n \nDone, with the added `keys1.sort()` before the `reverse()`.\n \n> 2. Instead of looking at the length, you can do\n> {{{\n> if not keys1 and not keys2: return 0\n> if not keys1: return -1\n> if not keys2: return 1\n> }}}\n \nAlso done.\n  \n> 3. Why the first key is treated differently?\n \nThis is to comply with the default `_cmp_` method for polynomials: for instance `-2x^2 > x` but `x^3 - 2x^2 < x^3 + x`. A larger degree polynomial is always greater than a lower degree polynomial, but then when the coefficients are compared, `0` is greater than a negative coefficient.\n\n\nI add a question: I noticed after your remark than the method `exponents()` could be improved. This is now implemented as \n\n```python\n        return [c[0] for c in sorted(self.__coeffs.iteritems())] \n```\n\nwhile it would be faster (from my testing) to replace it by\n\n```python\n        keys = self.__coeffs.keys()\n        keys.sort()\n        return keys\n```\n\nIs that right to make the change in this ticket (since it is a rather minor change) or is it more appropriate to open a new one?",
    "created_at": "2015-07-16T08:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249011",
    "user": "@bgrenet"
}
```

Replying to [comment:7 vdelecroix]:
> 1. You can replace
> {{{
> keys1 = list(reversed(sorted(d1.keys())))
> }}}
>   with
> {{{
> keys1 = d1.keys()
> keys1.reverse()
> }}}
 
Done, with the added `keys1.sort()` before the `reverse()`.
 
> 2. Instead of looking at the length, you can do
> {{{
> if not keys1 and not keys2: return 0
> if not keys1: return -1
> if not keys2: return 1
> }}}
 
Also done.
  
> 3. Why the first key is treated differently?
 
This is to comply with the default `_cmp_` method for polynomials: for instance `-2x^2 > x` but `x^3 - 2x^2 < x^3 + x`. A larger degree polynomial is always greater than a lower degree polynomial, but then when the coefficients are compared, `0` is greater than a negative coefficient.


I add a question: I noticed after your remark than the method `exponents()` could be improved. This is now implemented as 

```python
        return [c[0] for c in sorted(self.__coeffs.iteritems())] 
```

while it would be faster (from my testing) to replace it by

```python
        keys = self.__coeffs.keys()
        keys.sort()
        return keys
```

Is that right to make the change in this ticket (since it is a rather minor change) or is it more appropriate to open a new one?



---

archive/issue_comments_249012.json:
```json
{
    "body": "Replying to [comment:9 bruno]:\n> Replying to [comment:7 vdelecroix]:\n> I add a question: I noticed after your remark than the method `exponents()` could be improved. This is now implemented as \n> {{{#!python\n>         return [c[0] for c in sorted(self.__coeffs.iteritems())] \n> }}}\n> while it would be faster (from my testing) to replace it by\n> {{{#!python\n>         keys = self.__coeffs.keys()\n>         keys.sort()\n>         return keys\n> }}}\n> Is that right to make the change in this ticket (since it is a rather minor change) or is it more appropriate to open a new one?\n\nThat's fine with me.\n\nAnd could you add a doctest like\n\n```\nsage: Rd = PolynomialRing(ZZ, 'x', sparse=False)\nsage: Rs = PolynomialRing(ZZ, 'x', sparse=True)\nsage: for _ in range(100):\n....:     pd = Rd.random_element()\n....:     qd = Rd.random_element()\n....:     assert cmp(pd,qd) == cmp(Rs(pd), Rs(qd))\n```\n",
    "created_at": "2015-08-03T08:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249012",
    "user": "@videlec"
}
```

Replying to [comment:9 bruno]:
> Replying to [comment:7 vdelecroix]:
> I add a question: I noticed after your remark than the method `exponents()` could be improved. This is now implemented as 
> {{{#!python
>         return [c[0] for c in sorted(self.__coeffs.iteritems())] 
> }}}
> while it would be faster (from my testing) to replace it by
> {{{#!python
>         keys = self.__coeffs.keys()
>         keys.sort()
>         return keys
> }}}
> Is that right to make the change in this ticket (since it is a rather minor change) or is it more appropriate to open a new one?

That's fine with me.

And could you add a doctest like

```
sage: Rd = PolynomialRing(ZZ, 'x', sparse=False)
sage: Rs = PolynomialRing(ZZ, 'x', sparse=True)
sage: for _ in range(100):
....:     pd = Rd.random_element()
....:     qd = Rd.random_element()
....:     assert cmp(pd,qd) == cmp(Rs(pd), Rs(qd))
```




---

archive/issue_comments_249013.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-03T08:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249013",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_249014.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-03T16:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249014",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249015.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-03T16:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249015",
    "user": "@bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_249016.json:
```json
{
    "body": "`keys1.sort(); keys1.reverse()` -> `keys1.sort(reverse=True)`",
    "created_at": "2015-08-03T16:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249016",
    "user": "@videlec"
}
```

`keys1.sort(); keys1.reverse()` -> `keys1.sort(reverse=True)`



---

archive/issue_comments_249017.json:
```json
{
    "body": "In\n\n```\n            if c > 0:\n                c1 = cmp(d1[k1], 0)\n                if c1: return c1\n```\n\nIsn't `c1` automatically nonzero? Could there be some zero coefficients in the dictionary?",
    "created_at": "2015-08-03T16:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249017",
    "user": "@videlec"
}
```

In

```
            if c > 0:
                c1 = cmp(d1[k1], 0)
                if c1: return c1
```

Isn't `c1` automatically nonzero? Could there be some zero coefficients in the dictionary?



---

archive/issue_comments_249018.json:
```json
{
    "body": "Instead of comparing with `0` (the Python int zero) it would be better to compare with `self.base_ring().zero()`.",
    "created_at": "2015-08-03T16:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249018",
    "user": "@videlec"
}
```

Instead of comparing with `0` (the Python int zero) it would be better to compare with `self.base_ring().zero()`.



---

archive/issue_comments_249019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-03T16:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249019",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249020.json:
```json
{
    "body": "Replying to [comment:14 vdelecroix]:\n> In\n> {{{\n>             if c > 0:\n>                 c1 = cmp(d1[k1], 0)\n>                 if c1: return c1\n> }}}\n> Isn't `c1` automatically nonzero? Could there be some zero coefficients in the dictionary?\n\n\n```\nsage: R.<x> = PolynomialRing(ZZ, sparse=True)\nsage: p = R({0:1, 1:0, 2:1}, check=False)\nsage: p\nx^2 + 1\nsage: p.dict()\n{0: 1, 1: 0, 2: 1}\n```\n\nI doubt this happens often in practice, but since this is possible, I am quite reluctant to remove the test.",
    "created_at": "2015-08-03T16:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249020",
    "user": "@bgrenet"
}
```

Replying to [comment:14 vdelecroix]:
> In
> {{{
>             if c > 0:
>                 c1 = cmp(d1[k1], 0)
>                 if c1: return c1
> }}}
> Isn't `c1` automatically nonzero? Could there be some zero coefficients in the dictionary?


```
sage: R.<x> = PolynomialRing(ZZ, sparse=True)
sage: p = R({0:1, 1:0, 2:1}, check=False)
sage: p
x^2 + 1
sage: p.dict()
{0: 1, 1: 0, 2: 1}
```

I doubt this happens often in practice, but since this is possible, I am quite reluctant to remove the test.



---

archive/issue_comments_249021.json:
```json
{
    "body": "Replying to [comment:17 bruno]:\n> Replying to [comment:14 vdelecroix]:\n> > In\n> > {{{\n> >             if c > 0:\n> >                 c1 = cmp(d1[k1], 0)\n> >                 if c1: return c1\n> > }}}\n> > Isn't `c1` automatically nonzero? Could there be some zero coefficients in the dictionary?\n> \n> {{{\n> sage: R.<x> = PolynomialRing(ZZ, sparse=True)\n> sage: p = R({0:1, 1:0, 2:1}, check=False)\n> sage: p\n> x^2 + 1\n> sage: p.dict()\n> {0: 1, 1: 0, 2: 1}\n> }}}\n> I doubt this happens often in practice, but since this is possible, I am quite reluctant to remove the test.\n\nDough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!",
    "created_at": "2015-08-03T16:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249021",
    "user": "@videlec"
}
```

Replying to [comment:17 bruno]:
> Replying to [comment:14 vdelecroix]:
> > In
> > {{{
> >             if c > 0:
> >                 c1 = cmp(d1[k1], 0)
> >                 if c1: return c1
> > }}}
> > Isn't `c1` automatically nonzero? Could there be some zero coefficients in the dictionary?
> 
> {{{
> sage: R.<x> = PolynomialRing(ZZ, sparse=True)
> sage: p = R({0:1, 1:0, 2:1}, check=False)
> sage: p
> x^2 + 1
> sage: p.dict()
> {0: 1, 1: 0, 2: 1}
> }}}
> I doubt this happens often in practice, but since this is possible, I am quite reluctant to remove the test.

Dough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!



---

archive/issue_comments_249022.json:
```json
{
    "body": "Though, multiplication is nicer\n\n```\nsage: (p*p).dict()\n{0: 1, 2: 2, 4: 1}\n```\n\n\nWhat do you think about opening a ticket about enforcing non-zero values in the dictionary?\n\nVincent",
    "created_at": "2015-08-03T16:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249022",
    "user": "@videlec"
}
```

Though, multiplication is nicer

```
sage: (p*p).dict()
{0: 1, 2: 2, 4: 1}
```


What do you think about opening a ticket about enforcing non-zero values in the dictionary?

Vincent



---

archive/issue_comments_249023.json:
```json
{
    "body": "Replying to [comment:18 vdelecroix]:\n>Dough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!\n\nThere is no such specification as for matrices. There is a method `__normalize()` to remove the zero coefficients, used by default in `__init__`, and used for instance in the multiplication (since there may be some cancellations). \n\nReplying to [comment:19 vdelecroix]:\n> Though, multiplication is nicer\n> {{{\n> sage: (p*p).dict()\n> {0: 1, 2: 2, 4: 1}\n> }}}\n> \n> What do you think about opening a ticket about enforcing non-zero values in the dictionary?\n\nI am in favor of opening a ticket to add this specification, though I am not in favor of removing the `check=False` option that can be useful at some places to get (slightly) faster code.",
    "created_at": "2015-08-03T16:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249023",
    "user": "@bgrenet"
}
```

Replying to [comment:18 vdelecroix]:
>Dough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!

There is no such specification as for matrices. There is a method `__normalize()` to remove the zero coefficients, used by default in `__init__`, and used for instance in the multiplication (since there may be some cancellations). 

Replying to [comment:19 vdelecroix]:
> Though, multiplication is nicer
> {{{
> sage: (p*p).dict()
> {0: 1, 2: 2, 4: 1}
> }}}
> 
> What do you think about opening a ticket about enforcing non-zero values in the dictionary?

I am in favor of opening a ticket to add this specification, though I am not in favor of removing the `check=False` option that can be useful at some places to get (slightly) faster code.



---

archive/issue_comments_249024.json:
```json
{
    "body": "Replying to [comment:20 bruno]:\n> Replying to [comment:18 vdelecroix]:\n> >Dough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!\n> \n> There is no such specification as for matrices. There is a method `__normalize()` to remove the zero coefficients, used by default in `__init__`, and used for instance in the multiplication (since there may be some cancellations). \n\n`matrix_generic_sparse.pyx`, main docstring line 69-71\n\n```\n    A generic sparse matrix is\n    represented using a dictionary whose keys are pairs of integers `(i,j)` and\n    values in the base ring. The values of the dictionary must never be zero.\n```\n\n\n> Replying to [comment:19 vdelecroix]:\n> > Though, multiplication is nicer\n> > {{{\n> > sage: (p*p).dict()\n> > {0: 1, 2: 2, 4: 1}\n> > }}}\n> > \n> > What do you think about opening a ticket about enforcing non-zero values in the dictionary?\n> \n> I am in favor of opening a ticket to add this specification, though I am not in favor of removing the `check=False` option that can be useful at some places to get (slightly) faster code.\n\nI now understand that it only due to `check=False`. In the case `check=True` (which is the default) zeros are removed. So I would assume that there **never** are zero value in the dictionary. One only needs to specify it in the documentation.\n\nYou could have a look at the implementation of `degree`. It does not check if the values are zero or not. It just assumes that values are nonzero.\n\nVincent",
    "created_at": "2015-08-03T16:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249024",
    "user": "@videlec"
}
```

Replying to [comment:20 bruno]:
> Replying to [comment:18 vdelecroix]:
> >Dough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!
> 
> There is no such specification as for matrices. There is a method `__normalize()` to remove the zero coefficients, used by default in `__init__`, and used for instance in the multiplication (since there may be some cancellations). 

`matrix_generic_sparse.pyx`, main docstring line 69-71

```
    A generic sparse matrix is
    represented using a dictionary whose keys are pairs of integers `(i,j)` and
    values in the base ring. The values of the dictionary must never be zero.
```


> Replying to [comment:19 vdelecroix]:
> > Though, multiplication is nicer
> > {{{
> > sage: (p*p).dict()
> > {0: 1, 2: 2, 4: 1}
> > }}}
> > 
> > What do you think about opening a ticket about enforcing non-zero values in the dictionary?
> 
> I am in favor of opening a ticket to add this specification, though I am not in favor of removing the `check=False` option that can be useful at some places to get (slightly) faster code.

I now understand that it only due to `check=False`. In the case `check=True` (which is the default) zeros are removed. So I would assume that there **never** are zero value in the dictionary. One only needs to specify it in the documentation.

You could have a look at the implementation of `degree`. It does not check if the values are zero or not. It just assumes that values are nonzero.

Vincent



---

archive/issue_comments_249025.json:
```json
{
    "body": "Replying to [comment:21 vdelecroix]:\n> Replying to [comment:20 bruno]:\n> > Replying to [comment:18 vdelecroix]:\n> > >Dough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!\n> > \n> > There is no such specification as for matrices. There is a method `__normalize()` to remove the zero coefficients, used by default in `__init__`, and used for instance in the multiplication (since there may be some cancellations). \n> \n> `matrix_generic_sparse.pyx`, main docstring line 69-71\n> {{{\n>     A generic sparse matrix is\n>     represented using a dictionary whose keys are pairs of integers `(i,j)` and\n>     values in the base ring. The values of the dictionary must never be zero.\n> }}}\n> \n> > Replying to [comment:19 vdelecroix]:\n> > > Though, multiplication is nicer\n> > > {{{\n> > > sage: (p*p).dict()\n> > > {0: 1, 2: 2, 4: 1}\n> > > }}}\n> > > \n> > > What do you think about opening a ticket about enforcing non-zero values in the dictionary?\n> > \n> > I am in favor of opening a ticket to add this specification, though I am not in favor of removing the `check=False` option that can be useful at some places to get (slightly) faster code.\n> \n> I now understand that it only due to `check=False`. In the case `check=True` (which is the default) zeros are removed. So I would assume that there **never** are zero value in the dictionary. One only needs to specify it in the documentation.\n\nRight. I guess we actually agree (though my previous comment was maybe unclear). \n \n> You could have a look at the implementation of `degree`. It does not check if the values are zero or not. It just assumes that values are nonzero.\n\nTrue. And this is also the case of `_repr`:\n\n```\nsage: R.<x> = PolynomialRing(ZZ, sparse=True)\nsage: R({0:1,1:0}, check=False)\n + 1\n```\n\n\nSo we actually already assume that coefficients in the dictionary are nonzero. I'll add it in the specifications.",
    "created_at": "2015-08-03T17:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249025",
    "user": "@bgrenet"
}
```

Replying to [comment:21 vdelecroix]:
> Replying to [comment:20 bruno]:
> > Replying to [comment:18 vdelecroix]:
> > >Dough! I was asking because for sparse matrices it is explicitely mentioned in the specification that no value can be zero. And this is very useful!
> > 
> > There is no such specification as for matrices. There is a method `__normalize()` to remove the zero coefficients, used by default in `__init__`, and used for instance in the multiplication (since there may be some cancellations). 
> 
> `matrix_generic_sparse.pyx`, main docstring line 69-71
> {{{
>     A generic sparse matrix is
>     represented using a dictionary whose keys are pairs of integers `(i,j)` and
>     values in the base ring. The values of the dictionary must never be zero.
> }}}
> 
> > Replying to [comment:19 vdelecroix]:
> > > Though, multiplication is nicer
> > > {{{
> > > sage: (p*p).dict()
> > > {0: 1, 2: 2, 4: 1}
> > > }}}
> > > 
> > > What do you think about opening a ticket about enforcing non-zero values in the dictionary?
> > 
> > I am in favor of opening a ticket to add this specification, though I am not in favor of removing the `check=False` option that can be useful at some places to get (slightly) faster code.
> 
> I now understand that it only due to `check=False`. In the case `check=True` (which is the default) zeros are removed. So I would assume that there **never** are zero value in the dictionary. One only needs to specify it in the documentation.

Right. I guess we actually agree (though my previous comment was maybe unclear). 
 
> You could have a look at the implementation of `degree`. It does not check if the values are zero or not. It just assumes that values are nonzero.

True. And this is also the case of `_repr`:

```
sage: R.<x> = PolynomialRing(ZZ, sparse=True)
sage: R({0:1,1:0}, check=False)
 + 1
```


So we actually already assume that coefficients in the dictionary are nonzero. I'll add it in the specifications.



---

archive/issue_comments_249026.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-03T17:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249026",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249027.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-03T17:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249027",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_249028.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2015-08-03T17:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249028",
    "user": "@videlec"
}
```

Looks good to me.



---

archive/issue_comments_249029.json:
```json
{
    "body": "Thanks for your comments!",
    "created_at": "2015-08-04T08:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249029",
    "user": "@bgrenet"
}
```

Thanks for your comments!



---

archive/issue_comments_249030.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-04T22:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18348#issuecomment-249030",
    "user": "@vbraun"
}
```

Resolution: fixed
