# Issue 18503: Reduce overhead for relative number field elements

archive/issues_018503.json:
```json
{
    "body": "Keywords: relative number field pari\n\nWe should use the PARI functions wrapped in #18739 to avoid initialisation of PARI `rnf` structures when only doing simple arithmetic in relative number fields.\n\nSummary of changes:\n- new method `NumberFieldElement._pari_polynomial`;\n- replace the method `_pari_rnfequation` of `NumberField_relative` by `_pari_rnfeq`, which calls the PARI function `nf_rnfeq` (which returns slightly more information than `rnfequation`);\n- replace `K.pari_rnf().rnfeltreltoabs(x)` by `K._pari_rnfeq().eltreltoabs(x)` and similar;\n- remove the misleadingly named (and now obsolete) method `NumberField_relative._rnfeltreltoabs`, which only did something meaningful for elements in the base field;\n- merge `NumberField_relative.pari_polynomial` into `NumberField_generic.pari_polynomial`.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18740\n\n",
    "created_at": "2015-06-19T20:03:49Z",
    "labels": [
        "number fields",
        "minor",
        "enhancement"
    ],
    "title": "Reduce overhead for relative number field elements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18503",
    "user": "pbruin"
}
```
Keywords: relative number field pari

We should use the PARI functions wrapped in #18739 to avoid initialisation of PARI `rnf` structures when only doing simple arithmetic in relative number fields.

Summary of changes:
- new method `NumberFieldElement._pari_polynomial`;
- replace the method `_pari_rnfequation` of `NumberField_relative` by `_pari_rnfeq`, which calls the PARI function `nf_rnfeq` (which returns slightly more information than `rnfequation`);
- replace `K.pari_rnf().rnfeltreltoabs(x)` by `K._pari_rnfeq().eltreltoabs(x)` and similar;
- remove the misleadingly named (and now obsolete) method `NumberField_relative._rnfeltreltoabs`, which only did something meaningful for elements in the base field;
- merge `NumberField_relative.pari_polynomial` into `NumberField_generic.pari_polynomial`.


Issue created by migration from https://trac.sagemath.org/ticket/18740





---

archive/issue_comments_251529.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-19T20:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251529",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_251530.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-07-01T22:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251530",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_251531.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-03T08:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251531",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251532.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-03T09:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251532",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_251533.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-03T09:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251533",
    "user": "pbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_251534.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-15T16:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251534",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_251535.json:
```json
{
    "body": "Hello Peter,\n\nInstead of\n\n```\nf = pari(self._coefficients()).Polrev()\nreturn f.change_variable_name(name)\n```\n\nyou can do\n\n```\nreturn pari(self._coefficients()).Polrev(name)\n```\n\nthat would avoid a copy.\n\nWhy did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n\nVincent",
    "created_at": "2015-08-15T16:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251535",
    "user": "vdelecroix"
}
```

Hello Peter,

Instead of

```
f = pari(self._coefficients()).Polrev()
return f.change_variable_name(name)
```

you can do

```
return pari(self._coefficients()).Polrev(name)
```

that would avoid a copy.

Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

Vincent



---

archive/issue_comments_251536.json:
```json
{
    "body": "Salut Vincent,\n> Instead of\n> {{{\n> f = pari(self._coefficients()).Polrev()\n> return f.change_variable_name(name)\n> }}}\n> you can do\n> {{{\n> return pari(self._coefficients()).Polrev(name)\n> }}}\n> that would avoid a copy.\nOK, I will change this.\n\n> Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\nThe reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.",
    "created_at": "2015-08-17T10:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251536",
    "user": "pbruin"
}
```

Salut Vincent,
> Instead of
> {{{
> f = pari(self._coefficients()).Polrev()
> return f.change_variable_name(name)
> }}}
> you can do
> {{{
> return pari(self._coefficients()).Polrev(name)
> }}}
> that would avoid a copy.
OK, I will change this.

> Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?
The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.



---

archive/issue_comments_251537.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T10:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251537",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_251538.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-17T10:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251538",
    "user": "pbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_251539.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-17T11:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251539",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_251540.json:
```json
{
    "body": "Replying to [comment:7 pbruin]:\n> > Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?\n> The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.\n\nI agree that your way is better.",
    "created_at": "2015-08-17T11:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251540",
    "user": "vdelecroix"
}
```

Replying to [comment:7 pbruin]:
> > Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?
> The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.

I agree that your way is better.



---

archive/issue_comments_251541.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-19T01:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18503#issuecomment-251541",
    "user": "vbraun"
}
```

Resolution: fixed
