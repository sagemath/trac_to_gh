# Issue 18503: Reduce overhead for relative number field elements

Issue created by migration from Trac.

Original creator: pbruin

Original creation time: 2015-06-19 20:03:49

Keywords: relative number field pari

We should use the PARI functions wrapped in #18739 to avoid initialisation of PARI `rnf` structures when only doing simple arithmetic in relative number fields.

Summary of changes:
- new method `NumberFieldElement._pari_polynomial`;
- replace the method `_pari_rnfequation` of `NumberField_relative` by `_pari_rnfeq`, which calls the PARI function `nf_rnfeq` (which returns slightly more information than `rnfequation`);
- replace `K.pari_rnf().rnfeltreltoabs(x)` by `K._pari_rnfeq().eltreltoabs(x)` and similar;
- remove the misleadingly named (and now obsolete) method `NumberField_relative._rnfeltreltoabs`, which only did something meaningful for elements in the base field;
- merge `NumberField_relative.pari_polynomial` into `NumberField_generic.pari_polynomial`.



---

Comment by pbruin created at 2015-06-19 20:07:57

Changing status from new to needs_review.


---

Comment by pbruin created at 2015-07-01 22:02:23

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-07-03 08:34:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-03 09:47:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by pbruin created at 2015-07-03 09:48:50

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-08-15 16:43:58

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2015-08-15 16:43:58

Hello Peter,

Instead of

```
f = pari(self._coefficients()).Polrev()
return f.change_variable_name(name)
```

you can do

```
return pari(self._coefficients()).Polrev(name)
```

that would avoid a copy.

Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?

Vincent


---

Comment by pbruin created at 2015-08-17 10:04:00

Salut Vincent,
> Instead of
> {{{
> f = pari(self._coefficients()).Polrev()
> return f.change_variable_name(name)
> }}}
> you can do
> {{{
> return pari(self._coefficients()).Polrev(name)
> }}}
> that would avoid a copy.
OK, I will change this.

> Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?
The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.


---

Comment by git created at 2015-08-17 10:06:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2015-08-17 10:07:10

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-08-17 11:15:44

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2015-08-17 11:15:44

Replying to [comment:7 pbruin]:
> > Why did you rename `_rnf_equations` into `_rnfeq`. I understand that `relative_number_field_equations` is a bit long but the Sage standard is more toward no abbreviation at all. Is the name `rnfeq` standard in PARI/GP?
> The reason is that `_pari_rnfequation()` was a wrapper around the PARI/GP function `rnfequation()`, whereas `_pari_rnfeq()` wraps the internal PARI library function `nf_rnfeq()`.  It is not just a change of name, but a different method returning similar (but more) output.  I think it is best to keep the name of the Sage close to the PARI name.  I didn't want to keep a separate method `_pari_rnfequation()` because it was a private method which isn't used anymore.

I agree that your way is better.


---

Comment by vbraun created at 2015-08-19 01:19:20

Resolution: fixed
