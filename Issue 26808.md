# Issue 26808: Compute (degree bounded) minimal model of cdga's

archive/issues_026808.json:
```json
{
    "body": "CC:  @jhpalmieri @tscrim\n\nThis ticket compute the minimal model of a cdg-algebra.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27045\n\n",
    "created_at": "2019-01-11T12:45:06Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Compute (degree bounded) minimal model of cdga's",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26808",
    "user": "https://github.com/miguelmarco"
}
```
CC:  @jhpalmieri @tscrim

This ticket compute the minimal model of a cdg-algebra.

Issue created by migration from https://trac.sagemath.org/ticket/27045





---

archive/issue_comments_376670.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-01-11T12:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376670",
    "user": "https://github.com/miguelmarco"
}
```

New commits:



---

archive/issue_comments_376671.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-01-11T12:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376671",
    "user": "https://github.com/miguelmarco"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_376672.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376672",
    "user": "https://github.com/embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_376673.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-22T17:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376673",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376674.json:
```json
{
    "body": "I don't know how close this is to review, but this version of `cohomology_generators` is much slower than the old one.\n\nOld one:\n\n```\nsage: A3.<a,x,y> = GradedCommutativeAlgebra(GF(3), degrees=(1,2,2))\nsage: B3 = A3.cdg_algebra(differential={y: a*x})\nsage: %timeit B3.cohomology_generators(30)\n1 loop, best of 3: 187 ms per loop\nsage: A.<a,x,y> = GradedCommutativeAlgebra(QQ, degrees=(1,2,2))\nsage: B = A.cdg_algebra(differential={y: a*x})\nsage: %timeit B.cohomology_generators(40)\n1 loop, best of 3: 553 ms per loop\n```\n\nNew one:\n\n```\nsage: A3.<a,x,y> = GradedCommutativeAlgebra(GF(3), degrees=(1,2,2))\nsage: B3 = A3.cdg_algebra(differential={y: a*x})\nsage: %timeit B3.cohomology_generators(30)\n1 loop, best of 3: 2.3 s per loop\nsage: A.<a,x,y> = GradedCommutativeAlgebra(QQ, degrees=(1,2,2))\nsage: B = A.cdg_algebra(differential={y: a*x})\nsage: %timeit B.cohomology_generators(40)\n1 loop, best of 3: 6.32 s per loop\n```\n",
    "created_at": "2019-01-23T05:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376674",
    "user": "https://github.com/jhpalmieri"
}
```

I don't know how close this is to review, but this version of `cohomology_generators` is much slower than the old one.

Old one:

```
sage: A3.<a,x,y> = GradedCommutativeAlgebra(GF(3), degrees=(1,2,2))
sage: B3 = A3.cdg_algebra(differential={y: a*x})
sage: %timeit B3.cohomology_generators(30)
1 loop, best of 3: 187 ms per loop
sage: A.<a,x,y> = GradedCommutativeAlgebra(QQ, degrees=(1,2,2))
sage: B = A.cdg_algebra(differential={y: a*x})
sage: %timeit B.cohomology_generators(40)
1 loop, best of 3: 553 ms per loop
```

New one:

```
sage: A3.<a,x,y> = GradedCommutativeAlgebra(GF(3), degrees=(1,2,2))
sage: B3 = A3.cdg_algebra(differential={y: a*x})
sage: %timeit B3.cohomology_generators(30)
1 loop, best of 3: 2.3 s per loop
sage: A.<a,x,y> = GradedCommutativeAlgebra(QQ, degrees=(1,2,2))
sage: B = A.cdg_algebra(differential={y: a*x})
sage: %timeit B.cohomology_generators(40)
1 loop, best of 3: 6.32 s per loop
```




---

archive/issue_comments_376675.json:
```json
{
    "body": "I am still working on it (I plan to add too the computation of the cohomology algebra, and maybe a test for formality, although I have to consider if that should go on the same ticket or not). \n\nI didn't notice such a big difference in the timimgs, but maybe that is because I only tested up to relitvely low degrees. Anyways, I don't think it would make sense to keep the old implementation since it doesn't grant to give the right answer (in the sense of not giving a minimal set of generators). I will try to think of another aproach that still grants to give a minimal set of generators, but doesn't get so slow.\n\nBTW, if you would like to review this, I could try to get it to the \"needs review\" point today or tomorrow, and leave the rest of the work for other tickets.",
    "created_at": "2019-01-23T10:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376675",
    "user": "https://github.com/miguelmarco"
}
```

I am still working on it (I plan to add too the computation of the cohomology algebra, and maybe a test for formality, although I have to consider if that should go on the same ticket or not). 

I didn't notice such a big difference in the timimgs, but maybe that is because I only tested up to relitvely low degrees. Anyways, I don't think it would make sense to keep the old implementation since it doesn't grant to give the right answer (in the sense of not giving a minimal set of generators). I will try to think of another aproach that still grants to give a minimal set of generators, but doesn't get so slow.

BTW, if you would like to review this, I could try to get it to the "needs review" point today or tomorrow, and leave the rest of the work for other tickets.



---

archive/issue_comments_376676.json:
```json
{
    "body": "If the new version gives different answers from the old one, you should add some doctests to demonstrate this, and in particular the advantages of the new one.\n\nDon't hurry this on my account; it is not always predictable when I will have time to review a ticket.",
    "created_at": "2019-01-23T16:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376676",
    "user": "https://github.com/jhpalmieri"
}
```

If the new version gives different answers from the old one, you should add some doctests to demonstrate this, and in particular the advantages of the new one.

Don't hurry this on my account; it is not always predictable when I will have time to review a ticket.



---

archive/issue_comments_376677.json:
```json
{
    "body": "Another option (and my preference) would be to have an `algorithm` option since they give different results (with different speeds).\n\nI can try to review this when it is ready.",
    "created_at": "2019-01-23T17:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376677",
    "user": "https://github.com/tscrim"
}
```

Another option (and my preference) would be to have an `algorithm` option since they give different results (with different speeds).

I can try to review this when it is ready.



---

archive/issue_comments_376678.json:
```json
{
    "body": "My point is that the previous method gave an answer that is \"wrong\", in the sense of giving a generating system that has redundant elements. If one wants just a generating system, one can use all the cohomology classes up to the given degree. So it only makes sense to provide a specific method to compute a reduced system if it is indeed minimal. Hence the change.\n\nI will add a doctest with an example where the given answer is different from the previous method.",
    "created_at": "2019-01-23T17:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376678",
    "user": "https://github.com/miguelmarco"
}
```

My point is that the previous method gave an answer that is "wrong", in the sense of giving a generating system that has redundant elements. If one wants just a generating system, one can use all the cohomology classes up to the given degree. So it only makes sense to provide a specific method to compute a reduced system if it is indeed minimal. Hence the change.

I will add a doctest with an example where the given answer is different from the previous method.



---

archive/issue_comments_376679.json:
```json
{
    "body": "In particular, with the old method:\n\n\n\n```\nsage: A.<e1,e2,e3,e4> = GradedCommutativeAlgebra(QQ)\nsage: d = A.differential({e1:e4*e3,e2:e4*e3})\nsage: B = A.cdg_algebra(d)\nsage: B.cohomology_generators(10)\n{1: [e4, e3, -e1 + e2], 2: [e2*e4, e2*e3, e1*e4, e1*e3]}\n```\n\n\nwhereas with the new:\n\n\n```\nsage: A.<e1,e2,e3,e4> = GradedCommutativeAlgebra(QQ)\nsage: d = A.differential({e1:e4*e3,e2:e4*e3})\nsage: B = A.cdg_algebra(d)\nsage: B.cohomology_generators(10)\n{1: [e4, e3, -e1 + e2], 2: [e2*e4, e2*e3]}\n```\n\n\n\nNote that `e1*e4 = -e4*(-e1+e2) + e2*e4`",
    "created_at": "2019-01-23T17:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376679",
    "user": "https://github.com/miguelmarco"
}
```

In particular, with the old method:



```
sage: A.<e1,e2,e3,e4> = GradedCommutativeAlgebra(QQ)
sage: d = A.differential({e1:e4*e3,e2:e4*e3})
sage: B = A.cdg_algebra(d)
sage: B.cohomology_generators(10)
{1: [e4, e3, -e1 + e2], 2: [e2*e4, e2*e3, e1*e4, e1*e3]}
```


whereas with the new:


```
sage: A.<e1,e2,e3,e4> = GradedCommutativeAlgebra(QQ)
sage: d = A.differential({e1:e4*e3,e2:e4*e3})
sage: B = A.cdg_algebra(d)
sage: B.cohomology_generators(10)
{1: [e4, e3, -e1 + e2], 2: [e2*e4, e2*e3]}
```



Note that `e1*e4 = -e4*(-e1+e2) + e2*e4`



---

archive/issue_comments_376680.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-23T18:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376680",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-24T18:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376682.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-09T09:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376683.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2019-02-14T16:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_376684.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-17T20:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376685.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-22T09:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376686.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376686",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_376687.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-03T16:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376688.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-06T08:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376688",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376689.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-06T09:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376689",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_376690.json:
```json
{
    "body": "I think this part is ready for review. When this is ready, I will implement a check for i-formality in another ticket.",
    "created_at": "2019-04-06T09:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376690",
    "user": "https://github.com/miguelmarco"
}
```

I think this part is ready for review. When this is ready, I will implement a check for i-formality in another ticket.



---

archive/issue_comments_376691.json:
```json
{
    "body": "Some more trivial comments:\n\n- `if len(cohom1)==0:` -> `if not cohom1:`\n- doc formatting:\n  {{{\n        INPUT:\n\n        - ``i`` -- integer (default: `3`); degree to which the result is required\n          to induce an isomorphism in cohomology, and the domain is required to be\n          minimal\n\n        - ``max_iterations`` -- integer (default: `3`); the number of iterations\n          of the method at each degree; if the algorithm does not finish in this\n          many iterations at each degree, an error is raised\n  }}}\n  {{{\n        - ``max_degree`` -- integer (default: `3`); degree to which the result is required to\n          be isomorphic to self's cohomology\n  }}}\n  {{{\n        - ``codomain`` -- the parent where the images live\n\n        - ``im_gens`` -- a list or tuple with the images of the generators of this ring\n  }}}\n- typo: `the first cohomology o ``self``.`\n- small tweak: `n'th` -> ``n`'th`\n- `OUTPUT:` usually starts on a separate paragraph.\n- You have some `$` in `minimal_model`'s `ALGORITHM` block. I would also not use `self` in here but instead some other variable name.\n- No space after `:wikipedia:`.\n- Error messages should start with a lowercase letter (following a general python convention).\n- PEP8 says do not put spaces around equals signs when passing as input parameters (e.g., `foo(n=5)` not `foo(n = 5)`. There are also a few other PEP8 operator spacing issues scattered about.\n- This should be identically `0`: `sum(0*i for i in im_gens)`, so instead just return the appropriate 0 object (should be `self.codomain().zero()`).",
    "created_at": "2019-04-06T13:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376691",
    "user": "https://github.com/tscrim"
}
```

Some more trivial comments:

- `if len(cohom1)==0:` -> `if not cohom1:`
- doc formatting:
  {{{
        INPUT:

        - ``i`` -- integer (default: `3`); degree to which the result is required
          to induce an isomorphism in cohomology, and the domain is required to be
          minimal

        - ``max_iterations`` -- integer (default: `3`); the number of iterations
          of the method at each degree; if the algorithm does not finish in this
          many iterations at each degree, an error is raised
  }}}
  {{{
        - ``max_degree`` -- integer (default: `3`); degree to which the result is required to
          be isomorphic to self's cohomology
  }}}
  {{{
        - ``codomain`` -- the parent where the images live

        - ``im_gens`` -- a list or tuple with the images of the generators of this ring
  }}}
- typo: `the first cohomology o ``self``.`
- small tweak: `n'th` -> ``n`'th`
- `OUTPUT:` usually starts on a separate paragraph.
- You have some `$` in `minimal_model`'s `ALGORITHM` block. I would also not use `self` in here but instead some other variable name.
- No space after `:wikipedia:`.
- Error messages should start with a lowercase letter (following a general python convention).
- PEP8 says do not put spaces around equals signs when passing as input parameters (e.g., `foo(n=5)` not `foo(n = 5)`. There are also a few other PEP8 operator spacing issues scattered about.
- This should be identically `0`: `sum(0*i for i in im_gens)`, so instead just return the appropriate 0 object (should be `self.codomain().zero()`).



---

archive/issue_comments_376692.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-08T11:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376693.json:
```json
{
    "body": "I fixed those comments, and while I were at it, also fixed some other PEP8 complaints.",
    "created_at": "2019-04-08T11:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376693",
    "user": "https://github.com/miguelmarco"
}
```

I fixed those comments, and while I were at it, also fixed some other PEP8 complaints.



---

archive/issue_comments_376694.json:
```json
{
    "body": "A few other little things that I would like to see fixed before setting a positive review:\n\n`max(self._minimalmodels.keys())` -> `max(self._minimalmodels)`\nand `if max_degree in self._minimalmodels.keys():` -> `if max_degree in self._minimalmodels:`.\n\nYou still need to fix the docformatting for `minimal_model()` and `cohomology_algebra`.\n\nAnother docformatting thing, but less of an issue since it is hidden in `_im_gens_` (but I am picky about these things):\n\n```diff\n-        - ``codomain`` - The parent where the images live\n+        - ``codomain`` -- the parent where the images live\n \n-        - ``im_gens`` - A list or tuple with the images of the generators of this ring.\n+        - ``im_gens`` -- a list or tuple with the images of the generators of this ring\n```\n\n\n`im_gens[i]**t[i] for i in range(len(t))` -> im_gens[i]**val for i,val in enumerate(t)`\n\nYour `sum`'s also do not need to create the list, but this is a trivial comment.\n\n\n```\n        if len(cohomgens) == 0:\n            raise ValueError(\"Cohomology ring has no generators\")\n```\n\nCould this be `if not cohomgens:`? Also, the error message should start with a lowercase letter.",
    "created_at": "2019-04-10T12:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376694",
    "user": "https://github.com/tscrim"
}
```

A few other little things that I would like to see fixed before setting a positive review:

`max(self._minimalmodels.keys())` -> `max(self._minimalmodels)`
and `if max_degree in self._minimalmodels.keys():` -> `if max_degree in self._minimalmodels:`.

You still need to fix the docformatting for `minimal_model()` and `cohomology_algebra`.

Another docformatting thing, but less of an issue since it is hidden in `_im_gens_` (but I am picky about these things):

```diff
-        - ``codomain`` - The parent where the images live
+        - ``codomain`` -- the parent where the images live
 
-        - ``im_gens`` - A list or tuple with the images of the generators of this ring.
+        - ``im_gens`` -- a list or tuple with the images of the generators of this ring
```


`im_gens[i]**t[i] for i in range(len(t))` -> im_gens[i]**val for i,val in enumerate(t)`

Your `sum`'s also do not need to create the list, but this is a trivial comment.


```
        if len(cohomgens) == 0:
            raise ValueError("Cohomology ring has no generators")
```

Could this be `if not cohomgens:`? Also, the error message should start with a lowercase letter.



---

archive/issue_comments_376695.json:
```json
{
    "body": "What exactly do you mean by fixing the docformatting? The long lines in the results of doctests?",
    "created_at": "2019-04-10T13:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376695",
    "user": "https://github.com/miguelmarco"
}
```

What exactly do you mean by fixing the docformatting? The long lines in the results of doctests?



---

archive/issue_comments_376696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T13:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376697.json:
```json
{
    "body": "See comment:23. Specifically, the `INPUT:` bullet points are not correctly aligned and should result in an error message when compiling the documentation. Although it would be good to follow the standard conventions (as I understand them) for docstrings too, but I won't strictly enforce that.",
    "created_at": "2019-04-10T13:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376697",
    "user": "https://github.com/tscrim"
}
```

See comment:23. Specifically, the `INPUT:` bullet points are not correctly aligned and should result in an error message when compiling the documentation. Although it would be good to follow the standard conventions (as I understand them) for docstrings too, but I won't strictly enforce that.



---

archive/issue_comments_376698.json:
```json
{
    "body": "Wouldn't the testing framework complain if the expected output differs from the actual one by some line breaks?",
    "created_at": "2019-04-10T16:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376698",
    "user": "https://github.com/miguelmarco"
}
```

Wouldn't the testing framework complain if the expected output differs from the actual one by some line breaks?



---

archive/issue_comments_376699.json:
```json
{
    "body": "Can you please take a nother look? I think it is pretty much ready.",
    "created_at": "2019-05-03T13:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376699",
    "user": "https://github.com/miguelmarco"
}
```

Can you please take a nother look? I think it is pretty much ready.



---

archive/issue_comments_376700.json:
```json
{
    "body": "Docbuild errors noted on the patchbot as per comment:29:\n\n```diff\n         - ``i`` -- integer (default: `3`); degree to which the result is\n-        required to induce an isomorphism in cohomology, and the domain is\n-        required to be minimal.\n+          required to induce an isomorphism in cohomology, and the domain is\n+          required to be minimal\n```\n\nand similar.",
    "created_at": "2019-05-06T05:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376700",
    "user": "https://github.com/tscrim"
}
```

Docbuild errors noted on the patchbot as per comment:29:

```diff
         - ``i`` -- integer (default: `3`); degree to which the result is
-        required to induce an isomorphism in cohomology, and the domain is
-        required to be minimal.
+          required to induce an isomorphism in cohomology, and the domain is
+          required to be minimal
```

and similar.



---

archive/issue_comments_376701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-06T09:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376702.json:
```json
{
    "body": "I think I addressed the complains in the patchbot.\n----\nNew commits:",
    "created_at": "2019-05-06T09:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376702",
    "user": "https://github.com/miguelmarco"
}
```

I think I addressed the complains in the patchbot.
----
New commits:



---

archive/issue_comments_376703.json:
```json
{
    "body": "So the patchbots are reporting failures:\n\n```\nsage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 6 doctests failed\n```\n\nThe 3 main ones seem like they are trivial failures and just need to be updated. Two of the other failures I cannot reproduce, but could always just be marked by `# random` if they are an issue. The last one I cannot reproduce either, but is coming from the fact that `toy:buchberger` does not return a reduced Gr\u00f6bner basis (and so is construction order dependent). I suspect these were just brittle tests beforehand.",
    "created_at": "2019-05-07T00:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376703",
    "user": "https://github.com/tscrim"
}
```

So the patchbots are reporting failures:

```
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 6 doctests failed
```

The 3 main ones seem like they are trivial failures and just need to be updated. Two of the other failures I cannot reproduce, but could always just be marked by `# random` if they are an issue. The last one I cannot reproduce either, but is coming from the fact that `toy:buchberger` does not return a reduced Gröbner basis (and so is construction order dependent). I suspect these were just brittle tests beforehand.



---

archive/issue_comments_376704.json:
```json
{
    "body": "Hmmm, that's strange: I get an error message when testing myself:\n\n\n```\nsage -t  src/sage/rings/polynomial/multi_polynomial_ideal.py\n\n...\n\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_ideal.py\", line 2947, in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.elimination_ideal\nFailed example:\n    I.elimination_ideal([x, z])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/mmarco/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/mmarco/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.elimination_ideal[4]>\", line 1, in <module>\n        I.elimination_ideal([x, z])\n      File \"/home/mmarco/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 2024, in elimination_ideal\n        return self._elimination_ideal_libsingular(variables)\n      File \"/home/mmarco/sage/local/lib/python2.7/site-packages/sage/libs/singular/standard_options.py\", line 140, in wrapper\n        return func(*args, **kwds)\n      File \"/home/mmarco/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 2051, in _elimination_ideal_libsingular\n        Is = MPolynomialIdeal(R,self.groebner_basis())\n      File \"sage/structure/element.pyx\", line 489, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4611)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 502, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4720)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 394, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2607)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'NCPolynomialIdeal' object has no attribute 'groebner_basis'\n**********************************************************************\n\n```\n\n\nBut when I run that code inside an interactive session, it works as expected.\n\nI wonder if some of the errors come from the fact that i am developping on a python 3 environment. Seems plausible, since most are due to orderings of the answers in dictionaries.",
    "created_at": "2019-05-07T12:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376704",
    "user": "https://github.com/miguelmarco"
}
```

Hmmm, that's strange: I get an error message when testing myself:


```
sage -t  src/sage/rings/polynomial/multi_polynomial_ideal.py

...

**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_ideal.py", line 2947, in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.elimination_ideal
Failed example:
    I.elimination_ideal([x, z])
Exception raised:
    Traceback (most recent call last):
      File "/home/mmarco/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/mmarco/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.elimination_ideal[4]>", line 1, in <module>
        I.elimination_ideal([x, z])
      File "/home/mmarco/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 2024, in elimination_ideal
        return self._elimination_ideal_libsingular(variables)
      File "/home/mmarco/sage/local/lib/python2.7/site-packages/sage/libs/singular/standard_options.py", line 140, in wrapper
        return func(*args, **kwds)
      File "/home/mmarco/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 2051, in _elimination_ideal_libsingular
        Is = MPolynomialIdeal(R,self.groebner_basis())
      File "sage/structure/element.pyx", line 489, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4611)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 502, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4720)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 394, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2607)
        raise AttributeError(dummy_error_message)
    AttributeError: 'NCPolynomialIdeal' object has no attribute 'groebner_basis'
**********************************************************************

```


But when I run that code inside an interactive session, it works as expected.

I wonder if some of the errors come from the fact that i am developping on a python 3 environment. Seems plausible, since most are due to orderings of the answers in dictionaries.



---

archive/issue_comments_376705.json:
```json
{
    "body": "Hmm...I didn't think about testing it on Python3. Fr\u00e9d\u00e9ric (and likely John as well) will be happy that this works on both versions. I cannot say why it doesn't work by using the doctest runner but is fine in an interactive session. Maybe something is being cached or getting put in the \"wrong\" order in some set/dict. I can probably look into this more tomorrow.",
    "created_at": "2019-05-07T12:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376705",
    "user": "https://github.com/tscrim"
}
```

Hmm...I didn't think about testing it on Python3. Frédéric (and likely John as well) will be happy that this works on both versions. I cannot say why it doesn't work by using the doctest runner but is fine in an interactive session. Maybe something is being cached or getting put in the "wrong" order in some set/dict. I can probably look into this more tomorrow.



---

archive/issue_comments_376706.json:
```json
{
    "body": "Ok, if that is a big touble, we could remove the `elimination_ideal` method (it is not needed in the final implementation of `cohomology_algebra`, but it is probably good to have it anyways).",
    "created_at": "2019-05-07T12:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376706",
    "user": "https://github.com/miguelmarco"
}
```

Ok, if that is a big touble, we could remove the `elimination_ideal` method (it is not needed in the final implementation of `cohomology_algebra`, but it is probably good to have it anyways).



---

archive/issue_comments_376707.json:
```json
{
    "body": "With Python3, I am getting the other 3 failures reported by the patchbot. So we can ignore those (I am guessing that is a Python3-based patchbot).\n\nI still have no idea about the failure on your doctest run. Which version of Sage are you using to develop this?\n\nI think we should either update the output to match (for the failing tests in `elimination_ideal()`, and I get the same output on both Python versions) or we just put `nc-relations: {...}` for them.",
    "created_at": "2019-05-08T02:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376707",
    "user": "https://github.com/tscrim"
}
```

With Python3, I am getting the other 3 failures reported by the patchbot. So we can ignore those (I am guessing that is a Python3-based patchbot).

I still have no idea about the failure on your doctest run. Which version of Sage are you using to develop this?

I think we should either update the output to match (for the failing tests in `elimination_ideal()`, and I get the same output on both Python versions) or we just put `nc-relations: {...}` for them.



---

archive/issue_comments_376708.json:
```json
{
    "body": "Maybe I had something outdated on my sage install. After doing a full rebuild, I get no errors at all.\n\nAbout the ordering issues in python 3, that is a common problen for all doctests that involve dictionaries... \u00bfwhat is the general policy about that?",
    "created_at": "2019-05-08T13:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376708",
    "user": "https://github.com/miguelmarco"
}
```

Maybe I had something outdated on my sage install. After doing a full rebuild, I get no errors at all.

About the ordering issues in python 3, that is a common problen for all doctests that involve dictionaries... ¿what is the general policy about that?



---

archive/issue_comments_376709.json:
```json
{
    "body": "It depends on what the issue is. In this case, it seems the added tests do not differ from Python2 and Python3 (at least on my machine), and from looking at the code, it is fed off to the `SagePrettyPrinter`, so it should be consistent (if it is not, then there is a bug further down). So I think just updating the doctest output is all we need to do.",
    "created_at": "2019-05-08T23:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376709",
    "user": "https://github.com/tscrim"
}
```

It depends on what the issue is. In this case, it seems the added tests do not differ from Python2 and Python3 (at least on my machine), and from looking at the code, it is fed off to the `SagePrettyPrinter`, so it should be consistent (if it is not, then there is a bug further down). So I think just updating the doctest output is all we need to do.



---

archive/issue_comments_376710.json:
```json
{
    "body": "So, just to clarify: you also get errors in a python2 build? \n\nAfter fully compiling a sage-python2 environment, I get no errors at all.",
    "created_at": "2019-05-09T08:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376710",
    "user": "https://github.com/miguelmarco"
}
```

So, just to clarify: you also get errors in a python2 build? 

After fully compiling a sage-python2 environment, I get no errors at all.



---

archive/issue_comments_376711.json:
```json
{
    "body": "Yes, that is correct. I get the same 3 errors about output order in `multi_polynomial_ideal.py`.",
    "created_at": "2019-05-09T08:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376711",
    "user": "https://github.com/tscrim"
}
```

Yes, that is correct. I get the same 3 errors about output order in `multi_polynomial_ideal.py`.



---

archive/issue_comments_376712.json:
```json
{
    "body": "That is strange, I get the same result as the doctests. Have you rebased to the last development version? Or mayb there is something machine dependent there?",
    "created_at": "2019-05-09T08:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376712",
    "user": "https://github.com/miguelmarco"
}
```

That is strange, I get the same result as the doctests. Have you rebased to the last development version? Or mayb there is something machine dependent there?



---

archive/issue_comments_376713.json:
```json
{
    "body": "I am using `8.4.beta4`, so then there is a machine dependency, which is really bad.",
    "created_at": "2019-05-09T08:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376713",
    "user": "https://github.com/tscrim"
}
```

I am using `8.4.beta4`, so then there is a machine dependency, which is really bad.



---

archive/issue_comments_376714.json:
```json
{
    "body": "Well, we can sidestep this problem by what I suggested in commnet:39 (as the nc-relations are not important for the doctest).",
    "created_at": "2019-05-09T08:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376714",
    "user": "https://github.com/tscrim"
}
```

Well, we can sidestep this problem by what I suggested in commnet:39 (as the nc-relations are not important for the doctest).



---

archive/issue_comments_376715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-09T10:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376716.json:
```json
{
    "body": "If that is the only discrepancy, then I agree that is the best we can do right now. Maybe when we do the final switch to python 3 these glitches will stabilize, and get more predictable doctests.\n\n----\nNew commits:",
    "created_at": "2019-05-09T10:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376716",
    "user": "https://github.com/miguelmarco"
}
```

If that is the only discrepancy, then I agree that is the best we can do right now. Maybe when we do the final switch to python 3 these glitches will stabilize, and get more predictable doctests.

----
New commits:



---

archive/issue_comments_376717.json:
```json
{
    "body": "I wish I did have a better understanding why it is not stable even across our machines, but this will do for now. Lo mira bien a mi.",
    "created_at": "2019-05-09T11:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376717",
    "user": "https://github.com/tscrim"
}
```

I wish I did have a better understanding why it is not stable even across our machines, but this will do for now. Lo mira bien a mi.



---

archive/issue_comments_376718.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-09T11:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376718",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_376719.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-14T12:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26808#issuecomment-376719",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
