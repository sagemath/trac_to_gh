# Issue 22212: SAGE_BROWSER is being ignored while launching Jupyter notebook

archive/issues_022212.json:
```json
{
    "body": "Seen in 7.6beta4 :\n\n`SAGE_BROWSER=chromium sage -n jupyter` opens the Jupyter notebook in Firefox (my default browser) whereas `SAGE_BROWSER=chromium sage -n` opens in Chromium.\n\nI've checked that, when my default browser is Chromium, the problem is the same (i. e. `sage -n` honors SAGE_BROWSER, whereas `sage -n Jupyter` opens the default browser).\n\nNot serious, but annoying...\n\nIssue created by migration from https://trac.sagemath.org/ticket/22449\n\n",
    "closed_at": "2017-03-01T18:50:34Z",
    "created_at": "2017-02-25T23:49:32Z",
    "labels": [
        "component: user interface",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "SAGE_BROWSER is being ignored while launching Jupyter notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22212",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
Seen in 7.6beta4 :

`SAGE_BROWSER=chromium sage -n jupyter` opens the Jupyter notebook in Firefox (my default browser) whereas `SAGE_BROWSER=chromium sage -n` opens in Chromium.

I've checked that, when my default browser is Chromium, the problem is the same (i. e. `sage -n` honors SAGE_BROWSER, whereas `sage -n Jupyter` opens the default browser).

Not serious, but annoying...

Issue created by migration from https://trac.sagemath.org/ticket/22449





---

archive/issue_comments_308217.json:
```json
{
    "body": "I'm guessing that `sage -n jupyter` passes control straight to the Jupyter notebook, which is in charge of opening the browser. In that case it wouldn't be a surprise that `SAGE_BROWSER` is ignored. What happens if you do `BROWSER=chromium sage -n jupyter`? If that works, should we set `BROWSER` to be the same as `SAGE_BROWSER`?",
    "created_at": "2017-02-26T16:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308217",
    "user": "https://github.com/jhpalmieri"
}
```

I'm guessing that `sage -n jupyter` passes control straight to the Jupyter notebook, which is in charge of opening the browser. In that case it wouldn't be a surprise that `SAGE_BROWSER` is ignored. What happens if you do `BROWSER=chromium sage -n jupyter`? If that works, should we set `BROWSER` to be the same as `SAGE_BROWSER`?



---

archive/issue_comments_308218.json:
```json
{
    "body": "Replying to [comment:1 jhpalmieri]:\n> I'm guessing that `sage -n jupyter` passes control straight to the Jupyter notebook, which is in charge of opening the browser. In that case it wouldn't be a surprise that `SAGE_BROWSER` is ignored. What happens if you do `BROWSER=chromium sage -n jupyter`?\n\n\nIt works as intended. Nice diagnosis...\n\n> If that works, should we set `BROWSER` to be the same as `SAGE_BROWSER`?\n\n\nWhat do you mean ? Should we replace SAGE_BROWSER by BROWSER (i. e. following the system default) ? Or passing BROWSER=$SAGE_BROWSER to Jupyter ? The latter makes sens to me, the former a bit less...",
    "created_at": "2017-02-26T17:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308218",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:1 jhpalmieri]:
> I'm guessing that `sage -n jupyter` passes control straight to the Jupyter notebook, which is in charge of opening the browser. In that case it wouldn't be a surprise that `SAGE_BROWSER` is ignored. What happens if you do `BROWSER=chromium sage -n jupyter`?


It works as intended. Nice diagnosis...

> If that works, should we set `BROWSER` to be the same as `SAGE_BROWSER`?


What do you mean ? Should we replace SAGE_BROWSER by BROWSER (i. e. following the system default) ? Or passing BROWSER=$SAGE_BROWSER to Jupyter ? The latter makes sens to me, the former a bit less...



---

archive/issue_comments_308219.json:
```json
{
    "body": "Replying to [comment:2 charpent]:\n> What do you mean ? Should we replace SAGE_BROWSER by BROWSER (i. e. following the system default) ? Or passing BROWSER=$SAGE_BROWSER to Jupyter ? The latter makes sens to me, the former a bit less...\n\n\nI meant, if `SAGE_BROWSER` is set, then pass `BROWSER=$SAGE_BROWSER` to Jupyter, and maybe to everything in Sage.",
    "created_at": "2017-02-26T23:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308219",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:2 charpent]:
> What do you mean ? Should we replace SAGE_BROWSER by BROWSER (i. e. following the system default) ? Or passing BROWSER=$SAGE_BROWSER to Jupyter ? The latter makes sens to me, the former a bit less...


I meant, if `SAGE_BROWSER` is set, then pass `BROWSER=$SAGE_BROWSER` to Jupyter, and maybe to everything in Sage.



---

archive/issue_comments_308220.json:
```json
{
    "body": "Something like this:\n\n```diff\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex 54c0783..138db15 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n@@ -397,6 +397,10 @@ if [ \"$PYTHON_EGG_CACHE\" = \"\" ]; then\n     export PYTHON_EGG_CACHE\n fi\n \n+if [ -n \"$SAGE_BROWSER\" ]; then\n+    export BROWSER=\"$SAGE_BROWSER\"\n+fi\n+\n # Set PYTHONUSERBASE to avoid picking up non-Sage versions of\n # Matplotlib, numpy, etc. See http://trac.sagemath.org/ticket/19612.\n #\n```\nIt could also be more focused on just setting `BROWSER` when starting the notebook, though. In any case, I am having problems getting SAGE_BROWSER to work on OS X, so I can't really test this.",
    "created_at": "2017-02-26T23:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308220",
    "user": "https://github.com/jhpalmieri"
}
```

Something like this:

```diff
diff --git a/src/bin/sage-env b/src/bin/sage-env
index 54c0783..138db15 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -397,6 +397,10 @@ if [ "$PYTHON_EGG_CACHE" = "" ]; then
     export PYTHON_EGG_CACHE
 fi
 
+if [ -n "$SAGE_BROWSER" ]; then
+    export BROWSER="$SAGE_BROWSER"
+fi
+
 # Set PYTHONUSERBASE to avoid picking up non-Sage versions of
 # Matplotlib, numpy, etc. See http://trac.sagemath.org/ticket/19612.
 #
```
It could also be more focused on just setting `BROWSER` when starting the notebook, though. In any case, I am having problems getting SAGE_BROWSER to work on OS X, so I can't really test this.



---

archive/issue_comments_308221.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-27T15:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308221",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_308222.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-02-27T15:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308222",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_308223.json:
```json
{
    "body": "Should the file `src/bin/sage-README-osx.txt` also be patched?",
    "created_at": "2017-02-27T16:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308223",
    "user": "https://github.com/jhpalmieri"
}
```

Should the file `src/bin/sage-README-osx.txt` also be patched?



---

archive/issue_comments_308224.json:
```json
{
    "body": "Well, I don't know about the Mac App. It does things with `SAGE_BROWSER` that I don't fully understand.",
    "created_at": "2017-02-27T16:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308224",
    "user": "https://github.com/jdemeyer"
}
```

Well, I don't know about the Mac App. It does things with `SAGE_BROWSER` that I don't fully understand.



---

archive/issue_comments_308225.json:
```json
{
    "body": "Here is a slight complication on OS X. To run a browser, there does not seem to be a direct command from the terminal; instead, you need to run something like `open -a Firefox`. With the old-style notebook,\n\n```\nBROWSER=\"open -a Firefox\" sage -n\n```\nworks, but with the Jupyter notebook, you have to use\n\n```\nBROWSER=\"open -a Firefox %s\" sage -n jupyter\n```\nIf you omit the `%s`, nothing happens: the browser does not open a window or tab. Note also that if you include the `%s` with the old style notebook, it gives an error: \"The file /Users/jpalmier/.sage/%s does not exist.\"\n\nSo I have not yet found a single syntax that works for changing the browser with both old and new style notebooks.",
    "created_at": "2017-02-27T20:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308225",
    "user": "https://github.com/jhpalmieri"
}
```

Here is a slight complication on OS X. To run a browser, there does not seem to be a direct command from the terminal; instead, you need to run something like `open -a Firefox`. With the old-style notebook,

```
BROWSER="open -a Firefox" sage -n
```
works, but with the Jupyter notebook, you have to use

```
BROWSER="open -a Firefox %s" sage -n jupyter
```
If you omit the `%s`, nothing happens: the browser does not open a window or tab. Note also that if you include the `%s` with the old style notebook, it gives an error: "The file /Users/jpalmier/.sage/%s does not exist."

So I have not yet found a single syntax that works for changing the browser with both old and new style notebooks.



---

archive/issue_comments_308226.json:
```json
{
    "body": "One question, given these different syntaxes, is whether we still document how to use the old notebook, or do we just focus on Jupyter?\n\nA possible change (although if we mention Jupyter for the Mac, do we also need to mention it for linux?):\n\n```diff\ndiff --git a/src/doc/en/faq/faq-usage.rst b/src/doc/en/faq/faq-usage.rst\nindex 1395659..241921b 100644\n--- a/src/doc/en/faq/faq-usage.rst\n+++ b/src/doc/en/faq/faq-usage.rst\n@@ -727,7 +727,13 @@ You will need to do this from the command line.  Just run a command like this.\n \n     env BROWSER=opera /usr/bin/sage --notebook\n \n-* Mac (assuming you are in the directory of your downloaded Sage)::\n+* Mac (assuming you are in the directory of your downloaded Sage).\n+  With the Jupyter notebook::\n+\n+    BROWSER='open -a Firefox %s' ./sage --notebook jupyter\n+    BROWSER='open -a Google\\ Chrome %s' ./sage --notebook jupyter\n+\n+  With the old SageNB notebook::\n \n     BROWSER='open -a Firefox' ./sage --notebook\n     BROWSER='open -a Google\\ Chrome' ./sage --notebook\n```",
    "created_at": "2017-02-27T23:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308226",
    "user": "https://github.com/jhpalmieri"
}
```

One question, given these different syntaxes, is whether we still document how to use the old notebook, or do we just focus on Jupyter?

A possible change (although if we mention Jupyter for the Mac, do we also need to mention it for linux?):

```diff
diff --git a/src/doc/en/faq/faq-usage.rst b/src/doc/en/faq/faq-usage.rst
index 1395659..241921b 100644
--- a/src/doc/en/faq/faq-usage.rst
+++ b/src/doc/en/faq/faq-usage.rst
@@ -727,7 +727,13 @@ You will need to do this from the command line.  Just run a command like this.
 
     env BROWSER=opera /usr/bin/sage --notebook
 
-* Mac (assuming you are in the directory of your downloaded Sage)::
+* Mac (assuming you are in the directory of your downloaded Sage).
+  With the Jupyter notebook::
+
+    BROWSER='open -a Firefox %s' ./sage --notebook jupyter
+    BROWSER='open -a Google\ Chrome %s' ./sage --notebook jupyter
+
+  With the old SageNB notebook::
 
     BROWSER='open -a Firefox' ./sage --notebook
     BROWSER='open -a Google\ Chrome' ./sage --notebook
```



---

archive/issue_comments_308227.json:
```json
{
    "body": "Replying to [comment:10 jhpalmieri]:\n> with the Jupyter notebook, you have to use\n> \n> ```\n> BROWSER=\"open -a Firefox %s\" sage -n jupyter\n> ```\n\n\nIs this documented somewhere? Where did you get this from?",
    "created_at": "2017-02-28T06:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308227",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 jhpalmieri]:
> with the Jupyter notebook, you have to use
> 
> ```
> BROWSER="open -a Firefox %s" sage -n jupyter
> ```


Is this documented somewhere? Where did you get this from?



---

archive/issue_comments_308228.json:
```json
{
    "body": "I just read the source of the Python package [webbrowser](https://docs.python.org/2/library/webbrowser.html) (which is what Jupyter uses). IMHO it tries to be too clever to be good. I actually like the SageNB semantics better.",
    "created_at": "2017-02-28T09:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308228",
    "user": "https://github.com/jdemeyer"
}
```

I just read the source of the Python package [webbrowser](https://docs.python.org/2/library/webbrowser.html) (which is what Jupyter uses). IMHO it tries to be too clever to be good. I actually like the SageNB semantics better.



---

archive/issue_comments_308229.json:
```json
{
    "body": "It seems that `webbrowser` allows two syntaxes for `BROWSER`:\n\n1. If it contains `%s`, it is split into a command-line using `shlex.split()`.\n\n2. If it does not contains `%s`, it must be a single command (so indeed `open -a Firefox` wouldn't work).\n\nInstead, SageNB just runs `$SAGE_BROWSER $URL` without caring what `$SAGE_BROWSER` is.",
    "created_at": "2017-02-28T09:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308229",
    "user": "https://github.com/jdemeyer"
}
```

It seems that `webbrowser` allows two syntaxes for `BROWSER`:

1. If it contains `%s`, it is split into a command-line using `shlex.split()`.

2. If it does not contains `%s`, it must be a single command (so indeed `open -a Firefox` wouldn't work).

Instead, SageNB just runs `$SAGE_BROWSER $URL` without caring what `$SAGE_BROWSER` is.



---

archive/issue_comments_308230.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-28T09:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308231.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Replying to [comment:10 jhpalmieri]:\n> > with the Jupyter notebook, you have to use\n> > \n> > ```\n> > BROWSER=\"open -a Firefox %s\" sage -n jupyter\n> > ```\n\n> \n> Is this documented somewhere? Where did you get this from?\n\n\nI found it on stackexchange or some such place (searching for \"change browser jupyter os x\").",
    "created_at": "2017-02-28T16:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308231",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:12 jdemeyer]:
> Replying to [comment:10 jhpalmieri]:
> > with the Jupyter notebook, you have to use
> > 
> > ```
> > BROWSER="open -a Firefox %s" sage -n jupyter
> > ```

> 
> Is this documented somewhere? Where did you get this from?


I found it on stackexchange or some such place (searching for "change browser jupyter os x").



---

archive/issue_comments_308232.json:
```json
{
    "body": "This looks good to me. `@`charpent: does it fix your problem?",
    "created_at": "2017-02-28T16:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308232",
    "user": "https://github.com/jhpalmieri"
}
```

This looks good to me. `@`charpent: does it fix your problem?



---

archive/issue_comments_308233.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> This looks good to me. `@`charpent: does it fix your problem?\n\n\nDunno yet : just `make`ing. Seems to need to recompile a couple of packages. On my machine, `make` + `make ptestlong` is about 2-3 hours (depending on whether I need to `make distclean` or not. Often, but not always). Stay tuned...\n\nBTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?",
    "created_at": "2017-02-28T17:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308233",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:17 jhpalmieri]:
> This looks good to me. `@`charpent: does it fix your problem?


Dunno yet : just `make`ing. Seems to need to recompile a couple of packages. On my machine, `make` + `make ptestlong` is about 2-3 hours (depending on whether I need to `make distclean` or not. Often, but not always). Stay tuned...

BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?



---

archive/issue_comments_308234.json:
```json
{
    "body": "Replying to [comment:18 charpent]:\n> BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?\n\n\nThe new `7.6.beta5`?",
    "created_at": "2017-02-28T18:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308234",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 charpent]:
> BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?


The new `7.6.beta5`?



---

archive/issue_comments_308235.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> Replying to [comment:18 charpent]:\n> > BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?\n\n> \n> The new `7.6.beta5`?\n\n\nOkay. I was on 7.6.beta4. I understand.\n\nBut that means that your branch includes the beta4==>beta5 upgrade. I was surprised by this. And I'm surprised tha Jeroen didn't \"tutt, tutt\" at this.\n\n`make ptestlong` running. Probably needs 100-120 minutes (no guarantees...).",
    "created_at": "2017-02-28T18:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308235",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:19 jdemeyer]:
> Replying to [comment:18 charpent]:
> > BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?

> 
> The new `7.6.beta5`?


Okay. I was on 7.6.beta4. I understand.

But that means that your branch includes the beta4==>beta5 upgrade. I was surprised by this. And I'm surprised tha Jeroen didn't "tutt, tutt" at this.

`make ptestlong` running. Probably needs 100-120 minutes (no guarantees...).



---

archive/issue_comments_308236.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-28T19:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308236",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_308237.json:
```json
{
    "body": "On Debian testing :\n* Solves my initial complaint.\n* On top of 7.6.beta5, passes `ptestlong` with the usual :\n\n```\n ----------------------------------------------------------------------\nsage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\nwhich passes standalone.\n\n==> `positive_review`, subject to verification by someone able to test it on other platforms (OS/X is done, as far as I understand, but I'm thinking of Cygwin, for which the environment problem is //quite// different).\n\nI suggest paging Erik Bray, if you have its address...",
    "created_at": "2017-02-28T19:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308237",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

On Debian testing :
* Solves my initial complaint.
* On top of 7.6.beta5, passes `ptestlong` with the usual :

```
 ----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```
which passes standalone.

==> `positive_review`, subject to verification by someone able to test it on other platforms (OS/X is done, as far as I understand, but I'm thinking of Cygwin, for which the environment problem is //quite// different).

I suggest paging Erik Bray, if you have its address...



---

archive/issue_events_058713.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-01T18:50:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22212#event-58713"
}
```



---

archive/issue_comments_308238.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-01T18:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22212#issuecomment-308238",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
