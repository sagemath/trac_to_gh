# Issue 22212: SAGE_BROWSER is being ignored while launching Jupyter notebook

Issue created by migration from https://trac.sagemath.org/ticket/22449

Original creator: charpent

Original creation time: 2017-02-25 23:49:32

Seen in 7.6beta4 :

`SAGE_BROWSER=chromium sage -n jupyter` opens the Jupyter notebook in Firefox (my default browser) whereas `SAGE_BROWSER=chromium sage -n` opens in Chromium.

I've checked that, when my default browser is Chromium, the problem is the same (i. e. `sage -n` honors SAGE_BROWSER, whereas `sage -n Jupyter` opens the default browser).

Not serious, but annoying...


---

Comment by jhpalmieri created at 2017-02-26 16:34:42

I'm guessing that `sage -n jupyter` passes control straight to the Jupyter notebook, which is in charge of opening the browser. In that case it wouldn't be a surprise that `SAGE_BROWSER` is ignored. What happens if you do `BROWSER=chromium sage -n jupyter`? If that works, should we set `BROWSER` to be the same as `SAGE_BROWSER`?


---

Comment by charpent created at 2017-02-26 17:49:13

Replying to [comment:1 jhpalmieri]:
> I'm guessing that `sage -n jupyter` passes control straight to the Jupyter notebook, which is in charge of opening the browser. In that case it wouldn't be a surprise that `SAGE_BROWSER` is ignored. What happens if you do `BROWSER=chromium sage -n jupyter`?

It works as intended. Nice diagnosis...

> If that works, should we set `BROWSER` to be the same as `SAGE_BROWSER`?

What do you mean ? Should we replace SAGE_BROWSER by BROWSER (i. e. following the system default) ? Or passing BROWSER=$SAGE_BROWSER to Jupyter ? The latter makes sens to me, the former a bit less...


---

Comment by jhpalmieri created at 2017-02-26 23:24:00

Replying to [comment:2 charpent]:
> What do you mean ? Should we replace SAGE_BROWSER by BROWSER (i. e. following the system default) ? Or passing BROWSER=$SAGE_BROWSER to Jupyter ? The latter makes sens to me, the former a bit less...

I meant, if `SAGE_BROWSER` is set, then pass `BROWSER=$SAGE_BROWSER` to Jupyter, and maybe to everything in Sage.


---

Comment by jhpalmieri created at 2017-02-26 23:45:44

Something like this:

```diff
diff --git a/src/bin/sage-env b/src/bin/sage-env
index 54c0783..138db15 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -397,6 +397,10 @@ if [ "$PYTHON_EGG_CACHE" = "" ]; then
     export PYTHON_EGG_CACHE
 fi
 
+if [ -n "$SAGE_BROWSER" ]; then
+    export BROWSER="$SAGE_BROWSER"
+fi
+
 # Set PYTHONUSERBASE to avoid picking up non-Sage versions of
 # Matplotlib, numpy, etc. See http://trac.sagemath.org/ticket/19612.
 #
```

It could also be more focused on just setting `BROWSER` when starting the notebook, though. In any case, I am having problems getting SAGE_BROWSER to work on OS X, so I can't really test this.


---

Comment by jdemeyer created at 2017-02-27 15:56:38

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-02-27 15:56:38

New commits:


---

Comment by jhpalmieri created at 2017-02-27 16:06:44

Should the file `src/bin/sage-README-osx.txt` also be patched?


---

Comment by jdemeyer created at 2017-02-27 16:08:58

Well, I don't know about the Mac App. It does things with `SAGE_BROWSER` that I don't fully understand.


---

Comment by jhpalmieri created at 2017-02-27 20:21:30

Here is a slight complication on OS X. To run a browser, there does not seem to be a direct command from the terminal; instead, you need to run something like `open -a Firefox`. With the old-style notebook,

```
BROWSER="open -a Firefox" sage -n
```

works, but with the Jupyter notebook, you have to use

```
BROWSER="open -a Firefox %s" sage -n jupyter
```

If you omit the `%s`, nothing happens: the browser does not open a window or tab. Note also that if you include the `%s` with the old style notebook, it gives an error: "The file /Users/jpalmier/.sage/%s does not exist."

So I have not yet found a single syntax that works for changing the browser with both old and new style notebooks.


---

Comment by jhpalmieri created at 2017-02-27 23:42:38

One question, given these different syntaxes, is whether we still document how to use the old notebook, or do we just focus on Jupyter?

A possible change (although if we mention Jupyter for the Mac, do we also need to mention it for linux?):

```diff
diff --git a/src/doc/en/faq/faq-usage.rst b/src/doc/en/faq/faq-usage.rst
index 1395659..241921b 100644
--- a/src/doc/en/faq/faq-usage.rst
+++ b/src/doc/en/faq/faq-usage.rst
@@ -727,7 +727,13 @@ You will need to do this from the command line.  Just run a command like this.
 
     env BROWSER=opera /usr/bin/sage --notebook
 
-* Mac (assuming you are in the directory of your downloaded Sage)::
+* Mac (assuming you are in the directory of your downloaded Sage).
+  With the Jupyter notebook::
+
+    BROWSER='open -a Firefox %s' ./sage --notebook jupyter
+    BROWSER='open -a Google\ Chrome %s' ./sage --notebook jupyter
+
+  With the old SageNB notebook::
 
     BROWSER='open -a Firefox' ./sage --notebook
     BROWSER='open -a Google\ Chrome' ./sage --notebook
```



---

Comment by jdemeyer created at 2017-02-28 06:55:27

Replying to [comment:10 jhpalmieri]:
> with the Jupyter notebook, you have to use
> {{{
> BROWSER="open -a Firefox %s" sage -n jupyter
> }}}

Is this documented somewhere? Where did you get this from?


---

Comment by jdemeyer created at 2017-02-28 09:42:47

I just read the source of the Python package [webbrowser](https://docs.python.org/2/library/webbrowser.html) (which is what Jupyter uses). IMHO it tries to be too clever to be good. I actually like the SageNB semantics better.


---

Comment by jdemeyer created at 2017-02-28 09:46:17

It seems that `webbrowser` allows two syntaxes for `BROWSER`:

1. If it contains `%s`, it is split into a command-line using `shlex.split()`.

2. If it does not contains `%s`, it must be a single command (so indeed `open -a Firefox` wouldn't work).

Instead, SageNB just runs `$SAGE_BROWSER $URL` without caring what `$SAGE_BROWSER` is.


---

Comment by git created at 2017-02-28 09:56:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2017-02-28 16:42:20

Replying to [comment:12 jdemeyer]:
> Replying to [comment:10 jhpalmieri]:
> > with the Jupyter notebook, you have to use
> > {{{
> > BROWSER="open -a Firefox %s" sage -n jupyter
> > }}}
> 
> Is this documented somewhere? Where did you get this from?

I found it on stackexchange or some such place (searching for "change browser jupyter os x").


---

Comment by jhpalmieri created at 2017-02-28 16:46:44

This looks good to me. `@`charpent: does it fix your problem?


---

Comment by charpent created at 2017-02-28 17:25:18

Replying to [comment:17 jhpalmieri]:
> This looks good to me. `@`charpent: does it fix your problem?

Dunno yet : just `make`ing. Seems to need to recompile a couple of packages. On my machine, `make` + `make ptestlong` is about 2-3 hours (depending on whether I need to `make distclean` or not. Often, but not always). Stay tuned...

BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?


---

Comment by jdemeyer created at 2017-02-28 18:07:11

Replying to [comment:18 charpent]:
> BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?

The new `7.6.beta5`?


---

Comment by charpent created at 2017-02-28 18:30:51

Replying to [comment:19 jdemeyer]:
> Replying to [comment:18 charpent]:
> > BTW, merging your branch updated a *lot* of things in mine. What in hell were you on the top of ?
> 
> The new `7.6.beta5`?

Okay. I was on 7.6.beta4. I understand.

But that means that your branch includes the beta4==>beta5 upgrade. I was surprised by this. And I'm surprised tha Jeroen didn't "tutt, tutt" at this.

`make ptestlong` running. Probably needs 100-120 minutes (no guarantees...).


---

Comment by charpent created at 2017-02-28 19:39:58

Changing status from needs_review to positive_review.


---

Comment by charpent created at 2017-02-28 19:39:58

On Debian testing :
* Solves my initial complaint.
* On top of 7.6.beta5, passes `ptestlong` with the usual :

```
 ----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```

which passes standalone.

==> `positive_review`, subject to verification by someone able to test it on other platforms (OS/X is done, as far as I understand, but I'm thinking of Cygwin, for which the environment problem is //quite// different).

I suggest paging Erik Bray, if you have its address...


---

Comment by vbraun created at 2017-03-01 18:50:34

Resolution: fixed
