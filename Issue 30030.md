# Issue 30030: Coercion via restriction of chart functions

archive/issues_030030.json:
```json
{
    "body": "CC:  @egourgoulhon @tscrim\n\nAt this stage, scalar fields (and tensor fields) support coercions via restrictions:\n\n\n```\nsage: M = Manifold(2, 'M')\nsage: c.<x,y> = M.chart()\nsage: D = M.open_subset('D')\nsage: A = M.scalar_field_algebra(); A_D = D.scalar_field_algebra()\nsage: A_D.has_coerce_map_from(A)\nTrue\n```\n\n\nBut the chart function ring does not support that coercion, even for derived charts:\n\n\n```\nsage: c_D = c.restrict(D, x^2+y^2<1)\nsage: R = c.function_ring(); R_D = c_D.function_ring()\nsage: R_D.has_coerce_map_from(R)\nFalse\n```\n\n\nConsequently, this should be treated the same way as scalar fields since chart functions are the very foundation of scalar fields.\n\nI suggest we add that coercion in case one chart (here `c_D`) is the restriction of the other (here `c`).\n\nIssue created by migration from https://trac.sagemath.org/ticket/30267\n\n",
    "created_at": "2020-08-01T21:20:42Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Coercion via restriction of chart functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30030",
    "user": "https://github.com/mjungmath"
}
```
CC:  @egourgoulhon @tscrim

At this stage, scalar fields (and tensor fields) support coercions via restrictions:


```
sage: M = Manifold(2, 'M')
sage: c.<x,y> = M.chart()
sage: D = M.open_subset('D')
sage: A = M.scalar_field_algebra(); A_D = D.scalar_field_algebra()
sage: A_D.has_coerce_map_from(A)
True
```


But the chart function ring does not support that coercion, even for derived charts:


```
sage: c_D = c.restrict(D, x^2+y^2<1)
sage: R = c.function_ring(); R_D = c_D.function_ring()
sage: R_D.has_coerce_map_from(R)
False
```


Consequently, this should be treated the same way as scalar fields since chart functions are the very foundation of scalar fields.

I suggest we add that coercion in case one chart (here `c_D`) is the restriction of the other (here `c`).

Issue created by migration from https://trac.sagemath.org/ticket/30267





---

archive/issue_comments_426411.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-01T22:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426411",
    "user": "https://github.com/mjungmath"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_426412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-08-01T22:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_426413.json:
```json
{
    "body": "LGTM.",
    "created_at": "2020-08-02T05:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426413",
    "user": "https://github.com/tscrim"
}
```

LGTM.



---

archive/issue_comments_426414.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-02T05:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426414",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_426415.json:
```json
{
    "body": "Thanks.",
    "created_at": "2020-08-02T07:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426415",
    "user": "https://github.com/mjungmath"
}
```

Thanks.



---

archive/issue_comments_426416.json:
```json
{
    "body": "Thanks for this ticket.\nMay I suggest to correct a typo:\n\n```diff\n-    The ring of all chart function w.r.t. to a chart::\n+    The ring of all chart functions w.r.t. to a chart::\n```\n",
    "created_at": "2020-08-02T08:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426416",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for this ticket.
May I suggest to correct a typo:

```diff
-    The ring of all chart function w.r.t. to a chart::
+    The ring of all chart functions w.r.t. to a chart::
```




---

archive/issue_comments_426417.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-08-02T09:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_426418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-08-02T09:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_426419.json:
```json
{
    "body": "Replying to [comment:6 egourgoulhon]:\n> Thanks for this ticket.\n> May I suggest to correct a typo:\n> {{{#!diff\n> -    The ring of all chart function w.r.t. to a chart::\n> +    The ring of all chart functions w.r.t. to a chart::\n> }}}\n\nDone. Thank you.",
    "created_at": "2020-08-02T09:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426419",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:6 egourgoulhon]:
> Thanks for this ticket.
> May I suggest to correct a typo:
> {{{#!diff
> -    The ring of all chart function w.r.t. to a chart::
> +    The ring of all chart functions w.r.t. to a chart::
> }}}

Done. Thank you.



---

archive/issue_comments_426420.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-02T09:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426420",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_426421.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-07T19:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30030#issuecomment-426421",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_027632.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:05:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30030",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30030#event-27632"
}
```
