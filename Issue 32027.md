# Issue 32027: Convenience syntax for quaternion ideals

archive/issues_032027.json:
```json
{
    "body": "Keywords: quaternion ideals\n\nCurrently (sage 9.3), quaternion ideals do not support some of the operations one may expect them to:\n\n* Trying to scale an ideal `I` on the left by an element `a` by writing `a*I` throws a `TypeError`.\n* Trying to scale an ideal `I` on the right by an element `a` by writing `I*a` throws an `AttributeError` (this seems to be because the `_scale` method was renamed to `scale` at some point).\n* Trying to compute the sum of two ideals `I` and `J` by writing `I+J` \"works\", but it returns a generic *Twosided Ideal* (which, by the way, is usually incorrect) rather than a quaternion ideal.\n* Trying to construct a one-sided principal ideal of a quaternion order `O` by writing `a*O` or `O*a` throws a `NotImplementedError`.\n\nThis patch makes all of these things work. There's a good chance I messed up something with respect to sage's coercion system though, so I am hoping for someone to educate me on this matter.\n\nAs a side note, given the issue with the implementation of `+` inherited from generic ideals, I'm not sure we should be deriving quaternion ideals from the generic ideal class in the first place.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32264\n\n",
    "created_at": "2021-07-22T10:45:10Z",
    "labels": [
        "algebra",
        "minor",
        "enhancement"
    ],
    "title": "Convenience syntax for quaternion ideals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32027",
    "user": "lorenz"
}
```
Keywords: quaternion ideals

Currently (sage 9.3), quaternion ideals do not support some of the operations one may expect them to:

* Trying to scale an ideal `I` on the left by an element `a` by writing `a*I` throws a `TypeError`.
* Trying to scale an ideal `I` on the right by an element `a` by writing `I*a` throws an `AttributeError` (this seems to be because the `_scale` method was renamed to `scale` at some point).
* Trying to compute the sum of two ideals `I` and `J` by writing `I+J` "works", but it returns a generic *Twosided Ideal* (which, by the way, is usually incorrect) rather than a quaternion ideal.
* Trying to construct a one-sided principal ideal of a quaternion order `O` by writing `a*O` or `O*a` throws a `NotImplementedError`.

This patch makes all of these things work. There's a good chance I messed up something with respect to sage's coercion system though, so I am hoping for someone to educate me on this matter.

As a side note, given the issue with the implementation of `+` inherited from generic ideals, I'm not sure we should be deriving quaternion ideals from the generic ideal class in the first place.

Issue created by migration from https://trac.sagemath.org/ticket/32264





---

archive/issue_comments_457438.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-22T10:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457438",
    "user": "lorenz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_457439.json:
```json
{
    "body": "After #31582 is merged, the way to make addition work for ideals is probably to implement the single-underscore method `_add_` instead of `__add__` (not yet for orders, probably), because quaternion ideals will then have a proper parent.  Also, it is possible that the the fact that the `_richcmp_()` method implemented in #31582 will take care of the FIXME.",
    "created_at": "2021-07-23T11:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457439",
    "user": "pbruin"
}
```

After #31582 is merged, the way to make addition work for ideals is probably to implement the single-underscore method `_add_` instead of `__add__` (not yet for orders, probably), because quaternion ideals will then have a proper parent.  Also, it is possible that the the fact that the `_richcmp_()` method implemented in #31582 will take care of the FIXME.



---

archive/issue_comments_457440.json:
```json
{
    "body": "I now see that you also implemented a parent for quaternion ideals.  I hope that this can somehow  be combined with the changes made in #31582, but it seems to be a little bit less straightforward than I thought.",
    "created_at": "2021-07-23T18:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457440",
    "user": "pbruin"
}
```

I now see that you also implemented a parent for quaternion ideals.  I hope that this can somehow  be combined with the changes made in #31582, but it seems to be a little bit less straightforward than I thought.



---

archive/issue_comments_457441.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T09:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457441",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457442.json:
```json
{
    "body": "I *think* I successfully rebased this on top of your changes.\n\nBy the way, I couldn't get `_add_` to work because the implementation of `__add__` in `Ideal_generic` does not call the single-underscore method. Presumably this can be changed, but I didn't dare touching that code.",
    "created_at": "2021-07-28T08:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457442",
    "user": "lorenz"
}
```

I *think* I successfully rebased this on top of your changes.

By the way, I couldn't get `_add_` to work because the implementation of `__add__` in `Ideal_generic` does not call the single-underscore method. Presumably this can be changed, but I didn't dare touching that code.



---

archive/issue_comments_457443.json:
```json
{
    "body": "Looks good.  Multiplication doesn't seem to work yet when putting an order on the right, though:\n\n```\nsage: Q = QuaternionAlgebra(3, 5)\nsage: O = Q.maximal_order()\nsage: O * O.unit_ideal()\nFractional ideal (1/2 + 1/2*k, 1/2*i + 1/2*j, j, k)\nsage: O.unit_ideal() * O\nTraceback (most recent call last):\n...\nNotImplementedError: object does not support iteration\nsage: O * O\nTraceback (most recent call last):\n...\nNotImplementedError: object does not support iteration\n```\n\nAlso, do you know if the two lines `__radd__ = __add__` are necessary?  The `__radd__()` method seems to be used very little in Sage.",
    "created_at": "2021-07-28T09:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457443",
    "user": "pbruin"
}
```

Looks good.  Multiplication doesn't seem to work yet when putting an order on the right, though:

```
sage: Q = QuaternionAlgebra(3, 5)
sage: O = Q.maximal_order()
sage: O * O.unit_ideal()
Fractional ideal (1/2 + 1/2*k, 1/2*i + 1/2*j, j, k)
sage: O.unit_ideal() * O
Traceback (most recent call last):
...
NotImplementedError: object does not support iteration
sage: O * O
Traceback (most recent call last):
...
NotImplementedError: object does not support iteration
```

Also, do you know if the two lines `__radd__ = __add__` are necessary?  The `__radd__()` method seems to be used very little in Sage.



---

archive/issue_comments_457444.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-28T15:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457444",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457445.json:
```json
{
    "body": "Thanks, good catch. Both fixed.\n\n(I think I first defined one of the `__radd__`s when the `QuaternionOrder` didn't yet have its own `__add__` so it could be handled by the ideal on the left instead, but now that's indeed obsolete.)",
    "created_at": "2021-07-28T15:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457445",
    "user": "lorenz"
}
```

Thanks, good catch. Both fixed.

(I think I first defined one of the `__radd__`s when the `QuaternionOrder` didn't yet have its own `__add__` so it could be handled by the ideal on the left instead, but now that's indeed obsolete.)



---

archive/issue_comments_457446.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-29T09:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457446",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457447.json:
```json
{
    "body": "Thanks!  Positive review modulo #32245, which I guess someone else will have to review.",
    "created_at": "2021-07-29T09:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457447",
    "user": "pbruin"
}
```

Thanks!  Positive review modulo #32245, which I guess someone else will have to review.



---

archive/issue_comments_457448.json:
```json
{
    "body": "Setting milestone to 9.6 now that 9.5 is out.",
    "created_at": "2022-01-30T15:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457448",
    "user": "slelievre"
}
```

Setting milestone to 9.6 now that 9.5 is out.



---

archive/issue_comments_457449.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-16T23:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32027#issuecomment-457449",
    "user": "vbraun"
}
```

Resolution: fixed
