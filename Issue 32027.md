# Issue 32027: Convenience syntax for quaternion ideals

Issue created by migration from https://trac.sagemath.org/ticket/32264

Original creator: lorenz

Original creation time: 2021-07-22 10:45:10

Keywords: quaternion ideals

Currently (sage 9.3), quaternion ideals do not support some of the operations one may expect them to:

* Trying to scale an ideal `I` on the left by an element `a` by writing `a*I` throws a `TypeError`.
* Trying to scale an ideal `I` on the right by an element `a` by writing `I*a` throws an `AttributeError` (this seems to be because the `_scale` method was renamed to `scale` at some point).
* Trying to compute the sum of two ideals `I` and `J` by writing `I+J` "works", but it returns a generic _Twosided Ideal_ (which, by the way, is usually incorrect) rather than a quaternion ideal.
* Trying to construct a one-sided principal ideal of a quaternion order `O` by writing `a*O` or `O*a` throws a `NotImplementedError`.

This patch makes all of these things work. There's a good chance I messed up something with respect to sage's coercion system though, so I am hoping for someone to educate me on this matter.

As a side note, given the issue with the implementation of `+` inherited from generic ideals, I'm not sure we should be deriving quaternion ideals from the generic ideal class in the first place.


---

Comment by lorenz created at 2021-07-22 10:45:38

Changing status from new to needs_review.


---

Comment by pbruin created at 2021-07-23 11:08:51

After #31582 is merged, the way to make addition work for ideals is probably to implement the single-underscore method `_add_` instead of `__add__` (not yet for orders, probably), because quaternion ideals will then have a proper parent.  Also, it is possible that the the fact that the `_richcmp_()` method implemented in #31582 will take care of the FIXME.


---

Comment by pbruin created at 2021-07-23 18:45:52

I now see that you also implemented a parent for quaternion ideals.  I hope that this can somehow  be combined with the changes made in #31582, but it seems to be a little bit less straightforward than I thought.


---

Comment by git created at 2021-07-27 09:53:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2021-07-28 08:14:46

I _think_ I successfully rebased this on top of your changes.

By the way, I couldn't get `_add_` to work because the implementation of `__add__` in `Ideal_generic` does not call the single-underscore method. Presumably this can be changed, but I didn't dare touching that code.


---

Comment by pbruin created at 2021-07-28 09:25:30

Looks good.  Multiplication doesn't seem to work yet when putting an order on the right, though:

```
sage: Q = QuaternionAlgebra(3, 5)
sage: O = Q.maximal_order()
sage: O * O.unit_ideal()
Fractional ideal (1/2 + 1/2*k, 1/2*i + 1/2*j, j, k)
sage: O.unit_ideal() * O
Traceback (most recent call last):
...
NotImplementedError: object does not support iteration
sage: O * O
Traceback (most recent call last):
...
NotImplementedError: object does not support iteration
```

Also, do you know if the two lines `__radd__ = __add__` are necessary?  The `__radd__()` method seems to be used very little in Sage.


---

Comment by git created at 2021-07-28 15:07:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2021-07-28 15:09:04

Thanks, good catch. Both fixed.

(I think I first defined one of the `__radd__`s when the `QuaternionOrder` didn't yet have its own `__add__` so it could be handled by the ideal on the left instead, but now that's indeed obsolete.)


---

Comment by pbruin created at 2021-07-29 09:54:46

Changing status from needs_review to positive_review.


---

Comment by pbruin created at 2021-07-29 09:54:46

Thanks!  Positive review modulo #32245, which I guess someone else will have to review.


---

Comment by slelievre created at 2022-01-30 15:39:13

Setting milestone to 9.6 now that 9.5 is out.


---

Comment by vbraun created at 2022-02-16 23:56:44

Resolution: fixed
