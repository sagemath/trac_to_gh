# Issue 21906: failing doctests with optional package database_jones_numfield (2)

archive/issues_021906.json:
```json
{
    "body": "CC:  chapoton vbraun\n\nOn 32-bit:\n\n```\nsage -t --long src/sage/databases/jones.py\n**********************************************************************\nFile \"src/sage/databases/jones.py\", line 168, in sage.databases.jones.JonesDatabase.unramified_outside\nFailed example:\n    J.unramified_outside([101,109]) # optional - database_jones_numfield\nExpected:\n    [Number Field in a with defining polynomial x - 1,\n     Number Field in a with defining polynomial x^2 - 101,\n     Number Field in a with defining polynomial x^2 - 109,\n     Number Field in a with defining polynomial x^3 - x^2 - 36*x + 4,\n     Number Field in a with defining polynomial x^4 - x^3 + 13*x^2 - 19*x + 361,\n     Number Field in a with defining polynomial x^4 - x^3 + 14*x^2 + 34*x + 393,\n     Number Field in a with defining polynomial x^5 + x^4 - 6*x^3 - x^2 + 18*x + 4,\n     Number Field in a with defining polynomial x^5 + 2*x^4 + 7*x^3 + 4*x^2 + 11*x - 6,\n     Number Field in a with defining polynomial x^5 - x^4 - 40*x^3 - 93*x^2 - 21*x + 17]\nGot:\n    [Number Field in a with defining polynomial x - 1,\n     Number Field in a with defining polynomial x^2 - 101,\n     Number Field in a with defining polynomial x^2 - 109,\n     Number Field in a with defining polynomial x^3 - x^2 - 36*x + 4,\n     Number Field in a with defining polynomial x^4 - x^3 + 13*x^2 - 19*x + 361,\n     Number Field in a with defining polynomial x^4 - x^3 + 14*x^2 + 34*x + 393,\n     Number Field in a with defining polynomial x^5 + 2*x^4 + 7*x^3 + 4*x^2 + 11*x - 6,\n     Number Field in a with defining polynomial x^5 + x^4 - 6*x^3 - x^2 + 18*x + 4,\n     Number Field in a with defining polynomial x^5 - x^4 - 40*x^3 - 93*x^2 - 21*x + 17]\n**********************************************************************\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22143\n\n",
    "created_at": "2017-01-06T10:25:16Z",
    "labels": [
        "doctest coverage",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "failing doctests with optional package database_jones_numfield (2)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21906",
    "user": "jdemeyer"
}
```
CC:  chapoton vbraun

On 32-bit:

```
sage -t --long src/sage/databases/jones.py
**********************************************************************
File "src/sage/databases/jones.py", line 168, in sage.databases.jones.JonesDatabase.unramified_outside
Failed example:
    J.unramified_outside([101,109]) # optional - database_jones_numfield
Expected:
    [Number Field in a with defining polynomial x - 1,
     Number Field in a with defining polynomial x^2 - 101,
     Number Field in a with defining polynomial x^2 - 109,
     Number Field in a with defining polynomial x^3 - x^2 - 36*x + 4,
     Number Field in a with defining polynomial x^4 - x^3 + 13*x^2 - 19*x + 361,
     Number Field in a with defining polynomial x^4 - x^3 + 14*x^2 + 34*x + 393,
     Number Field in a with defining polynomial x^5 + x^4 - 6*x^3 - x^2 + 18*x + 4,
     Number Field in a with defining polynomial x^5 + 2*x^4 + 7*x^3 + 4*x^2 + 11*x - 6,
     Number Field in a with defining polynomial x^5 - x^4 - 40*x^3 - 93*x^2 - 21*x + 17]
Got:
    [Number Field in a with defining polynomial x - 1,
     Number Field in a with defining polynomial x^2 - 101,
     Number Field in a with defining polynomial x^2 - 109,
     Number Field in a with defining polynomial x^3 - x^2 - 36*x + 4,
     Number Field in a with defining polynomial x^4 - x^3 + 13*x^2 - 19*x + 361,
     Number Field in a with defining polynomial x^4 - x^3 + 14*x^2 + 34*x + 393,
     Number Field in a with defining polynomial x^5 + 2*x^4 + 7*x^3 + 4*x^2 + 11*x - 6,
     Number Field in a with defining polynomial x^5 + x^4 - 6*x^3 - x^2 + 18*x + 4,
     Number Field in a with defining polynomial x^5 - x^4 - 40*x^3 - 93*x^2 - 21*x + 17]
**********************************************************************
```


Issue created by migration from https://trac.sagemath.org/ticket/22143





---

archive/issue_comments_304001.json:
```json
{
    "body": "yes, indeed. I thought this was solved. But apparently sorting number fields is still not deterministic",
    "created_at": "2017-01-06T10:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304001",
    "user": "chapoton"
}
```

yes, indeed. I thought this was solved. But apparently sorting number fields is still not deterministic



---

archive/issue_comments_304002.json:
```json
{
    "body": "One can easily see that the sort is not deterministic if both the degree and the discriminant of two fields are equal. And that is what happens in this case. We can make the sort completely deterministic by also sorting by the polynomial (which are ordered first by degree and then lexicographically).",
    "created_at": "2017-01-06T10:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304002",
    "user": "jdemeyer"
}
```

One can easily see that the sort is not deterministic if both the degree and the discriminant of two fields are equal. And that is what happens in this case. We can make the sort completely deterministic by also sorting by the polynomial (which are ordered first by degree and then lexicographically).



---

archive/issue_comments_304003.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-01-06T10:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304003",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_304004.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-06T10:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304004",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_304005.json:
```json
{
    "body": "Would you please let arando run on that ticket, by calling it from an ipython session ?",
    "created_at": "2017-01-06T14:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304005",
    "user": "chapoton"
}
```

Would you please let arando run on that ticket, by calling it from an ipython session ?



---

archive/issue_comments_304006.json:
```json
{
    "body": "Replying to [comment:7 chapoton]:\n> Would you please let arando run on that ticket, by calling it from an ipython session ?\n\nI don't think there is much point. It should be clear from the code that the sorting is now completely deterministic.",
    "created_at": "2017-01-06T14:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304006",
    "user": "jdemeyer"
}
```

Replying to [comment:7 chapoton]:
> Would you please let arando run on that ticket, by calling it from an ipython session ?

I don't think there is much point. It should be clear from the code that the sorting is now completely deterministic.



---

archive/issue_comments_304007.json:
```json
{
    "body": "That would be to check that the doctests of jones will pass..",
    "created_at": "2017-01-06T14:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304007",
    "user": "chapoton"
}
```

That would be to check that the doctests of jones will pass..



---

archive/issue_comments_304008.json:
```json
{
    "body": "I ran tests on arando (without involving the patchbot):\n\n```\nRunning doctests with ID 2017-01-06-18-17-18-8e454854.\nGit branch: HEAD\nUsing --optional=atlas,cbc,database_jones_numfield,database_pari,gdb,mpir,python2,sage\nDoctesting 2 files using 4 threads.\nsage -t --long --warn-long 68.7 src/sage/databases/jones.py\n    [22 tests, 6.48 s]\nsage -t --long --warn-long 68.7 src/doc/en/constructions/number_fields.rst\n    [37 tests, 9.11 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 9.3 seconds\n    cpu time: 3.9 seconds\n    cumulative wall time: 15.6 seconds\n```\n",
    "created_at": "2017-01-06T18:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304008",
    "user": "jdemeyer"
}
```

I ran tests on arando (without involving the patchbot):

```
Running doctests with ID 2017-01-06-18-17-18-8e454854.
Git branch: HEAD
Using --optional=atlas,cbc,database_jones_numfield,database_pari,gdb,mpir,python2,sage
Doctesting 2 files using 4 threads.
sage -t --long --warn-long 68.7 src/sage/databases/jones.py
    [22 tests, 6.48 s]
sage -t --long --warn-long 68.7 src/doc/en/constructions/number_fields.rst
    [37 tests, 9.11 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 9.3 seconds
    cpu time: 3.9 seconds
    cumulative wall time: 15.6 seconds
```




---

archive/issue_comments_304009.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-06T19:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304009",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_304010.json:
```json
{
    "body": "ok, thanks. Good to go.",
    "created_at": "2017-01-06T19:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304010",
    "user": "chapoton"
}
```

ok, thanks. Good to go.



---

archive/issue_comments_304011.json:
```json
{
    "body": "Volker: given that you need to merge #22037 in 7.5 anyway, would you consider merging this one too? It would be nice to have no optional doctest failures in a released version.",
    "created_at": "2017-01-07T15:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304011",
    "user": "jdemeyer"
}
```

Volker: given that you need to merge #22037 in 7.5 anyway, would you consider merging this one too? It would be nice to have no optional doctest failures in a released version.



---

archive/issue_comments_304012.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2017-01-07T15:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304012",
    "user": "jdemeyer"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_304013.json:
```json
{
    "body": "Volker: given that you need to merge #22037 in 7.5 anyway, would you consider merging this one too? It would be nice to have no optional doctest failures in a released version.",
    "created_at": "2017-01-07T15:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304013",
    "user": "jdemeyer"
}
```

Volker: given that you need to merge #22037 in 7.5 anyway, would you consider merging this one too? It would be nice to have no optional doctest failures in a released version.



---

archive/issue_comments_304014.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-08T00:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21906#issuecomment-304014",
    "user": "vbraun"
}
```

Resolution: fixed
