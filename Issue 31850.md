# Issue 31850: pynac fails to build in conda

Issue created by migration from https://trac.sagemath.org/ticket/32087

Original creator: vdelecroix

Original creation time: 2021-06-29 21:29:58

CC:  isuruf

9.4.beta3


---

Attachment


---

Attachment


---

Attachment


---

Comment by fbissey created at 2021-06-29 21:37:26

Any idea where the `-nostdlib` could have originated in the final link line? I am fairly sure it is why the linker tries to link to static version of the `pthread` library. It probably also tries to use a static version of libstdc++.


---

Comment by mkoeppe created at 2021-06-29 21:39:25

From the build log:

```
libtool: link: /home/vincent/miniconda3/envs/sage-build/bin/x86_64-conda-linux-gnu-c++  -fPIC -DPIC -shared -nostdlib /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crti.o /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtbeginS.o  .libs/libpynac_la-add.o .libs/libpynac_la-archive.o .libs/libpynac_la-assume.o .libs/libpynac_la-basic.o .libs/libpynac_la-cmatcher.o .libs/libpynac_la-constant.o .libs/libpynac_la-context.o .libs/libpynac_la-ex.o .libs/libpynac_la-expair.o .libs/libpynac_la-expairseq.o .libs/libpynac_la-exprseq.o .libs/libpynac_la-fderivative.o .libs/libpynac_la-function.o .libs/libpynac_la-function_info.o .libs/libpynac_la-infinity.o .libs/libpynac_la-inifcns.o .libs/libpynac_la-inifcns_trig.o .libs/libpynac_la-inifcns_zeta.o .libs/libpynac_la-inifcns_hyperb.o .libs/libpynac_la-inifcns_trans.o .libs/libpynac_la-inifcns_gamma.o .libs/libpynac_la-inifcns_nstdsums.o .libs/libpynac_la-inifcns_orthopoly.o .libs/libpynac_la-inifcns_hyperg.o .libs/libpynac_la-inifcns_comb.o .libs/libpynac_la-lst.o .libs/libpynac_la-matrix.o .libs/libpynac_la-mpoly-giac.o .libs/libpynac_la-mpoly-ginac.o .libs/libpynac_la-mpoly-singular.o .libs/libpynac_la-mpoly.o .libs/libpynac_la-mul.o .libs/libpynac_la-normal.o .libs/libpynac_la-numeric.o .libs/libpynac_la-operators.o .libs/libpynac_la-power.o .libs/libpynac_la-py_funcs.o .libs/libpynac_la-registrar.o .libs/libpynac_la-relational.o .libs/libpynac_la-remember.o .libs/libpynac_la-pseries.o .libs/libpynac_la-print.o .libs/libpynac_la-symbol.o .libs/libpynac_la-upoly-ginac.o .libs/libpynac_la-utils.o .libs/libpynac_la-wildcard.o .libs/libpynac_la-templates.o .libs/libpynac_la-infoflagbase.o .libs/libpynac_la-sum.o .libs/libpynac_la-order.o .libs/libpynac_la-useries.o   -L/opt/sage/local/lib -L/home/vincent/miniconda3/envs/sage-build/lib -lpthread -lfactory -lmpfr -lntl -lomalloc -lsingular_resources -lflint -lgmp -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0 -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib -lstdc++ -lm -lc -lgcc_s /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtendS.o /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crtn.o  -O2 -g -march=nocona -mtune=haswell -fstack-protector-strong -O2 -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -pthread -Wl,--sysroot=/ -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -march=nocona -mtune=haswell -fstack-protector-strong -O2 -O2   -pthread -Wl,-soname -Wl,libpynac.so.18 -o .libs/libpynac.so.18.3.5
1163	/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/bin/ld: cannot find /usr/lib64/libpthread_nonshared.a
1164
```



---

Comment by mkoeppe created at 2021-06-29 21:40:28

pynac gets its flags from python, see https://github.com/pynac/pynac/blob/master/configure.ac#L56


---

Comment by vdelecroix created at 2021-06-29 21:45:09

Note that for this build I explicitely used conda's Python with

```
$ ./configure --with-python=/home/vincent/miniconda3/envs/sage-build/bin/python3
```



---

Comment by fbissey created at 2021-06-29 21:48:00

A good question for `@`isuruf then. `-nostdlib` is usually used to link C++ code completely statically. It should only be used in conjunction with `static`. If you try to link C++ statically without `-nostdlib` various standard library will still be dynamically linked. It is a nuclear option to get statically linked C++ code. 

Not recommended for use unless you really know what you are doing or you are compiling for a BlueGene [now completely dead, I personally shutdown two of those in 2016].


---

Comment by isuruf created at 2021-06-29 22:12:35

`-nostdlib` is added by libtool. This is a different problem. Can you send the output of `conda list -p /home/vincent/miniconda3/envs/sage-build/` and also what the value of `_CONDA_PYTHON_SYSCONFIGDATA_NAME` and `PYTHON_SYSCONFIGDATA_NAME` in your env is?


---

Comment by vdelecroix created at 2021-06-30 06:50:41

Got

```
$ echo $_CONDA_PYTHON_SYSCONFIGDATA_NAME
_sysconfigdata_x86_64_conda_cos6_linux_gnu
$ echo $PYTHON_SYSCONFIGDATA_NAME

```

And the output of `conda list -p /home/vincent/miniconda3/envs/sage-build/` is in [conda-list-p.txt](https://trac.sagemath.org/raw-attachment/ticket/32087/conda-list-p.txt).


---

Attachment

Thanks. Can you post the output of `python -m sysconfig | grep sysroot`?


---

Comment by vdelecroix created at 2021-06-30 14:55:51


```
	CONFIG_ARGS = "'--prefix=/home/vincent/miniconda3/envs/sage-build' '--build=x86_64-conda_cos6-linux-gnu' '--host=x86_64-conda_cos6-linux-gnu' '--enable-ipv6' '--with-ensurepip=no' '--with-tzpath=/home/vincent/miniconda3/envs/sage-build/share/zoneinfo:/home/vincent/miniconda3/envs/sage-build/share/tzinfo' '--with-computed-gotos' '--with-system-ffi' '--enable-loadable-sqlite-extensions' '--with-tcltk-includes=-I/home/vincent/miniconda3/envs/sage-build/include' '--with-tcltk-libs=-L/home/vincent/miniconda3/envs/sage-build/lib -ltcl8.6 -ltk8.6' '--with-platlibdir=lib' '--with-lto' '--enable-optimizations' '-oldincludedir=/home/conda/feedstock_root/build_artifacts/python-split_1624061905143/_build_env/x86_64-conda_cos6-linux-gnu/sysroot/usr/include' '--disable-shared' 'PROFILE_TASK=-m test --pgo' 'build_alias=x86_64-conda_cos6-linux-gnu' 'host_alias=x86_64-conda_cos6-linux-gnu' 'MACHDEP=linux' 'CC=x86_64-conda_cos6-linux-gnu-gcc' 'CFLAGS=-march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/vincent/miniconda3/envs/sage-build/include      ' 'LDFLAGS=-Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link,/home/vincent/miniconda3/envs/sage-build/lib -L/home/vincent/miniconda3/envs/sage-build/lib' 'CPPFLAGS=-DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/vincent/miniconda3/envs/sage-build/include -I/home/vincent/miniconda3/envs/sage-build/include' 'CPP=/home/conda/feedstock_root/build_artifacts/python-split_1624061905143/_build_env/bin/x86_64-conda_cos6-linux-gnu-cpp' 'PKG_CONFIG_PATH=/home/vincent/miniconda3/envs/sage-build/lib/pkgconfig'"
```



---

Comment by isuruf created at 2021-06-30 23:20:28

Sorry, I can't reproduce this. All I know is that the flag `-Wl,--sysroot=/` is the issue here. This is used in a sysconfig when used with compilers other than the ones shipped with conda. (It's there to use our newer linker with an older gcc installation). This shouldn't happen when conda compilers are used where `_CONDA_PYTHON_SYSCONFIGDATA_NAME` is set. The only situation I can think of is sage or pynac stripping the environment and deleting that env variable.

Can you try printing that env variable `_CONDA_PYTHON_SYSCONFIGDATA_NAME` at the beginning of pynac build to confirm that sage doesn't filter it out?


---

Comment by isuruf created at 2021-07-01 00:26:00

Nvm, I can reproduce this. I'll fix this soon.


---

Comment by isuruf created at 2021-07-01 04:06:05

Upstream issue https://github.com/conda-forge/python-feedstock/issues/474.

You can downgrade your setuptools version as a workaround.


---

Comment by vdelecroix created at 2021-07-01 15:53:48

Replying to [comment:14 isuruf]:
> Upstream issue https://github.com/conda-forge/python-feedstock/issues/474.
> 
> You can downgrade your setuptools version as a workaround.

Downgrading to setuptools 49.5.0 was only possible together with downgrading Python to 3.8. I am trying to build sage with that new setup now.


---

Comment by vdelecroix created at 2021-07-02 06:39:42

Same problem

```
libtool: link: /home/vincent/miniconda3/envs/sage-build/bin/x86_64-conda-linux-gnu-c++  -fPIC -DPIC -shared -nostdlib /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crti.o /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtbeginS.o  .libs/libpynac_la-add.o .libs/libpynac_la-archive.o .libs/libpynac_la-assume.o .libs/libpynac_la-basic.o .libs/libpynac_la-cmatcher.o .libs/libpynac_la-constant.o .libs/libpynac_la-context.o .libs/libpynac_la-ex.o .libs/libpynac_la-expair.o .libs/libpynac_la-expairseq.o .libs/libpynac_la-exprseq.o .libs/libpynac_la-fderivative.o .libs/libpynac_la-function.o .libs/libpynac_la-function_info.o .libs/libpynac_la-infinity.o .libs/libpynac_la-inifcns.o .libs/libpynac_la-inifcns_trig.o .libs/libpynac_la-inifcns_zeta.o .libs/libpynac_la-inifcns_hyperb.o .libs/libpynac_la-inifcns_trans.o .libs/libpynac_la-inifcns_gamma.o .libs/libpynac_la-inifcns_nstdsums.o .libs/libpynac_la-inifcns_orthopoly.o .libs/libpynac_la-inifcns_hyperg.o .libs/libpynac_la-inifcns_comb.o .libs/libpynac_la-lst.o .libs/libpynac_la-matrix.o .libs/libpynac_la-mpoly-giac.o .libs/libpynac_la-mpoly-ginac.o .libs/libpynac_la-mpoly-singular.o .libs/libpynac_la-mpoly.o .libs/libpynac_la-mul.o .libs/libpynac_la-normal.o .libs/libpynac_la-numeric.o .libs/libpynac_la-operators.o .libs/libpynac_la-power.o .libs/libpynac_la-py_funcs.o .libs/libpynac_la-registrar.o .libs/libpynac_la-relational.o .libs/libpynac_la-remember.o .libs/libpynac_la-pseries.o .libs/libpynac_la-print.o .libs/libpynac_la-symbol.o .libs/libpynac_la-upoly-ginac.o .libs/libpynac_la-utils.o .libs/libpynac_la-wildcard.o .libs/libpynac_la-templates.o .libs/libpynac_la-infoflagbase.o .libs/libpynac_la-sum.o .libs/libpynac_la-order.o .libs/libpynac_la-useries.o   -L/opt/sage/local/lib -L/home/vincent/miniconda3/envs/sage-build/lib -lpthread -lfactory -lmpfr -lntl -lomalloc -lsingular_resources -lflint -lgmp -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0 -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib -lstdc++ -lm -lc -lgcc_s /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtendS.o /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crtn.o  -O2 -g -march=nocona -mtune=haswell -fstack-protector-strong -O2 -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -pthread -Wl,-rpath=/home/vincent/miniconda3/envs/sage-build/lib -Wl,--no-as-needed -Wl,--sysroot=/ -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -march=nocona -mtune=haswell -fstack-protector-strong -O2 -O2   -pthread -Wl,-soname -Wl,libpynac.so.18 -o .libs/libpynac.so.18.3.5
/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/bin/ld: cannot find /usr/lib64/libpthread_nonshared.a
collect2: error: ld returned 1 exit status
```

Note that sage installs its own version of setuptools (version 56.2.0).


---

Comment by isuruf created at 2021-07-02 06:46:26

Right. Until upstream issue is solved, we have to downgrade setuptools to 49.* in sage itself.


---

Comment by mkoeppe created at 2021-07-02 06:58:28

Perhaps it's good enough to just change the value of `SETUPTOOLS_USE_DISTUTILS` (set in `build/bin/sage-build-env`) for conda as a workaround?


---

Comment by isuruf created at 2021-07-02 21:33:16

Yes, that seems reasonable until we get the upstream issue solved.


---

Comment by vdelecroix created at 2021-07-06 20:25:02

Replying to [comment:18 mkoeppe]:
> Perhaps it's good enough to just change the value of `SETUPTOOLS_USE_DISTUTILS` (set in `build/bin/sage-build-env`) for conda as a workaround?

How could I do that?


---

Comment by mkoeppe created at 2021-07-06 21:03:33

Try this
----
New commits:


---

Comment by vdelecroix created at 2021-07-06 21:37:08


```
Successfully installed pynac-0.7.27.p8
```

Thanks


---

Attachment

After that the build failed for cysignals, see [cysignals-1.10.3.log](https://trac.sagemath.org/raw-attachment/ticket/32087/cysignals-1.10.3.log).


---

Comment by isuruf created at 2021-07-06 22:24:55

Can you attach the pari log as well?


---

Attachment

available as [pari-2.13.1.log](https://trac.sagemath.org/raw-attachment/ticket/32087/pari-2.13.1.log).

Thanks for your help.


---

Comment by mkoeppe created at 2021-07-06 22:45:14

This may be a good moment to mention https://github.com/sagemath/cysignals/issues/125, which needs help


---

Comment by isuruf created at 2021-07-09 20:30:27

Changing status from new to needs_review.


---

Comment by isuruf created at 2021-07-09 20:30:27

New commits:


---

Comment by isuruf created at 2021-07-09 20:31:51

The issue was what `@`mkoeppe said about LDFLAGS in python overriding sage built version. For now, I've updated conda in pari to use pthread version for pari>=2.13.

Can you check that this works?


---

Comment by mkoeppe created at 2021-07-12 06:59:54

It looks like this may be breaking `cvxopt` on a number of platforms - see https://github.com/mkoeppe/sage/runs/3041608561?check_suite_focus=true


---

Comment by vdelecroix created at 2021-07-15 09:46:44

`@`isuruf: with your branch, sage did build in conda. Thanks. Though I got into trouble when compiling the documentation

```
[dochtml] Error in sys.excepthook:
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
[dochtml]     context = TracebackException(
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
[dochtml]     context = TracebackException(
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
[dochtml]     context = TracebackException(
[dochtml]   [Previous line repeated 997 more times]
[dochtml] RecursionError: maximum recursion depth exceeded
[dochtml] 
[dochtml] Original exception was:
[dochtml] Traceback (most recent call last):
[dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
[dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10510)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1323, in sage.libs.giac.giac.Pygen.cas_setup (build/cythonized/sage/libs/giac/giac.cpp:145936)
[dochtml]   File "sage/libs/giac/giac.pyx", line 902, in sage.libs.giac.giac.Pygen.__cinit__ (build/cythonized/sage/libs/giac/giac.cpp:140970)
[dochtml] RecursionError: maximum recursion depth exceeded while calling a Python object
[dochtml] 
[dochtml] During handling of the above exception, another exception occurred:
[dochtml] 
[dochtml] Traceback (most recent call last):
[dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
[dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
[dochtml] RuntimeError
...
[dochtml] During handling of the above exception, another exception occurred:
[dochtml] 
[dochtml] Traceback (most recent call last):
[dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
[dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
[dochtml] RuntimeError
[dochtml] 
[dochtml] During handling of the above exception, another exception occurred:
[dochtml] 
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/runpy.py", line 197, in _run_module_as_main
[dochtml]     return _run_code(code, main_globals, None,
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/runpy.py", line 87, in _run_code
[dochtml]     exec(code, run_globals)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 1813, in main
[dochtml]     builder()
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 809, in _wrapper
[dochtml]     self.write_auto_rest_file(module_name)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 1104, in write_auto_rest_file
[dochtml]     title = self.get_module_docstring_title(module_name)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 1065, in get_module_docstring_title
[dochtml]     __import__(module_name)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 35, in <module>
[dochtml]     from .giac import giacsettings, libgiac
[dochtml]   File "sage/libs/giac/giac.pyx", line 2261, in init sage.libs.giac.giac (build/cythonized/sage/libs/giac/giac.cpp:168106)
[dochtml]   File "sage/libs/giac/giac.pyx", line 802, in sage.libs.giac.giac.GiacSetting.threads.__set__ (build/cythonized/sage/libs/giac/giac.cpp:11533)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
[dochtml] RuntimeError
[dochtml] make[5]: *** [Makefile:20: doc-inventory--reference-libs] Error 1
[dochtml] make[5]: *** Waiting for unfinished jobs....
```



---

Comment by mkoeppe created at 2021-07-15 17:50:45

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-07-19 02:49:34

Changing priority from major to critical.


---

Comment by mkoeppe created at 2021-09-25 22:37:49

pynac issue will disappear with package removal in #32387


---

Comment by mkoeppe created at 2021-12-21 05:02:40

Outdated; in 9.5.beta8 (with #32113), the packages build OK.


---

Comment by mkoeppe created at 2021-12-21 05:02:40

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-12-21 05:06:51

Replying to [comment:33 vdelecroix]:
> `@`isuruf: with your branch, sage did build in conda. Thanks. Though I got into trouble when compiling the documentation
> {{{
> [dochtml] Error in sys.excepthook:
> [dochtml] Traceback (most recent call last):
> [dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
> [dochtml]     context = TracebackException(
> [dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
> [dochtml]     context = TracebackException(
> [dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
> [dochtml]     context = TracebackException(
> [dochtml]   [Previous line repeated 997 more times]
> [dochtml] RecursionError: maximum recursion depth exceeded
> [dochtml] 
> [dochtml] Original exception was:
> [dochtml] Traceback (most recent call last):
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10510)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1323, in sage.libs.giac.giac.Pygen.cas_setup (build/cythonized/sage/libs/giac/giac.cpp:145936)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 902, in sage.libs.giac.giac.Pygen.__cinit__ (build/cythonized/sage/libs/giac/giac.cpp:140970)
> [dochtml] RecursionError: maximum recursion depth exceeded while calling a Python object
> [dochtml] 
> [dochtml] During handling of the above exception, another exception occurred:
> [dochtml] 
> [dochtml] Traceback (most recent call last):
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
> [dochtml] RuntimeError
> ...
}}}

I've opened #33056 for this.


---

Comment by isuruf created at 2022-02-16 21:07:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-17 00:06:10

Resolution: invalid
