# Issue 31850: pynac fails to build in conda

archive/issues_031850.json:
```json
{
    "body": "CC:  @isuruf\n\n9.4.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/32087\n\n",
    "created_at": "2021-06-29T21:29:58Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "pynac fails to build in conda",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31850",
    "user": "@videlec"
}
```
CC:  @isuruf

9.4.beta3

Issue created by migration from https://trac.sagemath.org/ticket/32087





---

archive/issue_comments_455131.json:
```json
{
    "body": "Attachment [config.status](tarball://root/attachments/some-uuid/ticket32087/config.status) by @videlec created at 2021-06-29 21:30:55",
    "created_at": "2021-06-29T21:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455131",
    "user": "@videlec"
}
```

Attachment [config.status](tarball://root/attachments/some-uuid/ticket32087/config.status) by @videlec created at 2021-06-29 21:30:55



---

archive/issue_comments_455132.json:
```json
{
    "body": "Attachment [config.log](tarball://root/attachments/some-uuid/ticket32087/config.log) by @videlec created at 2021-06-29 21:31:10",
    "created_at": "2021-06-29T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455132",
    "user": "@videlec"
}
```

Attachment [config.log](tarball://root/attachments/some-uuid/ticket32087/config.log) by @videlec created at 2021-06-29 21:31:10



---

archive/issue_comments_455133.json:
```json
{
    "body": "Attachment [pynac-0.7.27.p8.log](tarball://root/attachments/some-uuid/ticket32087/pynac-0.7.27.p8.log) by @videlec created at 2021-06-29 21:33:56",
    "created_at": "2021-06-29T21:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455133",
    "user": "@videlec"
}
```

Attachment [pynac-0.7.27.p8.log](tarball://root/attachments/some-uuid/ticket32087/pynac-0.7.27.p8.log) by @videlec created at 2021-06-29 21:33:56



---

archive/issue_comments_455134.json:
```json
{
    "body": "Any idea where the `-nostdlib` could have originated in the final link line? I am fairly sure it is why the linker tries to link to static version of the `pthread` library. It probably also tries to use a static version of libstdc++.",
    "created_at": "2021-06-29T21:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455134",
    "user": "@kiwifb"
}
```

Any idea where the `-nostdlib` could have originated in the final link line? I am fairly sure it is why the linker tries to link to static version of the `pthread` library. It probably also tries to use a static version of libstdc++.



---

archive/issue_comments_455135.json:
```json
{
    "body": "From the build log:\n\n```\nlibtool: link: /home/vincent/miniconda3/envs/sage-build/bin/x86_64-conda-linux-gnu-c++  -fPIC -DPIC -shared -nostdlib /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crti.o /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtbeginS.o  .libs/libpynac_la-add.o .libs/libpynac_la-archive.o .libs/libpynac_la-assume.o .libs/libpynac_la-basic.o .libs/libpynac_la-cmatcher.o .libs/libpynac_la-constant.o .libs/libpynac_la-context.o .libs/libpynac_la-ex.o .libs/libpynac_la-expair.o .libs/libpynac_la-expairseq.o .libs/libpynac_la-exprseq.o .libs/libpynac_la-fderivative.o .libs/libpynac_la-function.o .libs/libpynac_la-function_info.o .libs/libpynac_la-infinity.o .libs/libpynac_la-inifcns.o .libs/libpynac_la-inifcns_trig.o .libs/libpynac_la-inifcns_zeta.o .libs/libpynac_la-inifcns_hyperb.o .libs/libpynac_la-inifcns_trans.o .libs/libpynac_la-inifcns_gamma.o .libs/libpynac_la-inifcns_nstdsums.o .libs/libpynac_la-inifcns_orthopoly.o .libs/libpynac_la-inifcns_hyperg.o .libs/libpynac_la-inifcns_comb.o .libs/libpynac_la-lst.o .libs/libpynac_la-matrix.o .libs/libpynac_la-mpoly-giac.o .libs/libpynac_la-mpoly-ginac.o .libs/libpynac_la-mpoly-singular.o .libs/libpynac_la-mpoly.o .libs/libpynac_la-mul.o .libs/libpynac_la-normal.o .libs/libpynac_la-numeric.o .libs/libpynac_la-operators.o .libs/libpynac_la-power.o .libs/libpynac_la-py_funcs.o .libs/libpynac_la-registrar.o .libs/libpynac_la-relational.o .libs/libpynac_la-remember.o .libs/libpynac_la-pseries.o .libs/libpynac_la-print.o .libs/libpynac_la-symbol.o .libs/libpynac_la-upoly-ginac.o .libs/libpynac_la-utils.o .libs/libpynac_la-wildcard.o .libs/libpynac_la-templates.o .libs/libpynac_la-infoflagbase.o .libs/libpynac_la-sum.o .libs/libpynac_la-order.o .libs/libpynac_la-useries.o   -L/opt/sage/local/lib -L/home/vincent/miniconda3/envs/sage-build/lib -lpthread -lfactory -lmpfr -lntl -lomalloc -lsingular_resources -lflint -lgmp -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0 -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib -lstdc++ -lm -lc -lgcc_s /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtendS.o /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crtn.o  -O2 -g -march=nocona -mtune=haswell -fstack-protector-strong -O2 -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -pthread -Wl,--sysroot=/ -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -march=nocona -mtune=haswell -fstack-protector-strong -O2 -O2   -pthread -Wl,-soname -Wl,libpynac.so.18 -o .libs/libpynac.so.18.3.5\n1163\t/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/bin/ld: cannot find /usr/lib64/libpthread_nonshared.a\n1164\n```\n",
    "created_at": "2021-06-29T21:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455135",
    "user": "@mkoeppe"
}
```

From the build log:

```
libtool: link: /home/vincent/miniconda3/envs/sage-build/bin/x86_64-conda-linux-gnu-c++  -fPIC -DPIC -shared -nostdlib /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crti.o /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtbeginS.o  .libs/libpynac_la-add.o .libs/libpynac_la-archive.o .libs/libpynac_la-assume.o .libs/libpynac_la-basic.o .libs/libpynac_la-cmatcher.o .libs/libpynac_la-constant.o .libs/libpynac_la-context.o .libs/libpynac_la-ex.o .libs/libpynac_la-expair.o .libs/libpynac_la-expairseq.o .libs/libpynac_la-exprseq.o .libs/libpynac_la-fderivative.o .libs/libpynac_la-function.o .libs/libpynac_la-function_info.o .libs/libpynac_la-infinity.o .libs/libpynac_la-inifcns.o .libs/libpynac_la-inifcns_trig.o .libs/libpynac_la-inifcns_zeta.o .libs/libpynac_la-inifcns_hyperb.o .libs/libpynac_la-inifcns_trans.o .libs/libpynac_la-inifcns_gamma.o .libs/libpynac_la-inifcns_nstdsums.o .libs/libpynac_la-inifcns_orthopoly.o .libs/libpynac_la-inifcns_hyperg.o .libs/libpynac_la-inifcns_comb.o .libs/libpynac_la-lst.o .libs/libpynac_la-matrix.o .libs/libpynac_la-mpoly-giac.o .libs/libpynac_la-mpoly-ginac.o .libs/libpynac_la-mpoly-singular.o .libs/libpynac_la-mpoly.o .libs/libpynac_la-mul.o .libs/libpynac_la-normal.o .libs/libpynac_la-numeric.o .libs/libpynac_la-operators.o .libs/libpynac_la-power.o .libs/libpynac_la-py_funcs.o .libs/libpynac_la-registrar.o .libs/libpynac_la-relational.o .libs/libpynac_la-remember.o .libs/libpynac_la-pseries.o .libs/libpynac_la-print.o .libs/libpynac_la-symbol.o .libs/libpynac_la-upoly-ginac.o .libs/libpynac_la-utils.o .libs/libpynac_la-wildcard.o .libs/libpynac_la-templates.o .libs/libpynac_la-infoflagbase.o .libs/libpynac_la-sum.o .libs/libpynac_la-order.o .libs/libpynac_la-useries.o   -L/opt/sage/local/lib -L/home/vincent/miniconda3/envs/sage-build/lib -lpthread -lfactory -lmpfr -lntl -lomalloc -lsingular_resources -lflint -lgmp -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0 -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib -lstdc++ -lm -lc -lgcc_s /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtendS.o /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crtn.o  -O2 -g -march=nocona -mtune=haswell -fstack-protector-strong -O2 -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -pthread -Wl,--sysroot=/ -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -march=nocona -mtune=haswell -fstack-protector-strong -O2 -O2   -pthread -Wl,-soname -Wl,libpynac.so.18 -o .libs/libpynac.so.18.3.5
1163	/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/bin/ld: cannot find /usr/lib64/libpthread_nonshared.a
1164
```




---

archive/issue_comments_455136.json:
```json
{
    "body": "pynac gets its flags from python, see https://github.com/pynac/pynac/blob/master/configure.ac#L56",
    "created_at": "2021-06-29T21:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455136",
    "user": "@mkoeppe"
}
```

pynac gets its flags from python, see https://github.com/pynac/pynac/blob/master/configure.ac#L56



---

archive/issue_comments_455137.json:
```json
{
    "body": "Note that for this build I explicitely used conda's Python with\n\n```\n$ ./configure --with-python=/home/vincent/miniconda3/envs/sage-build/bin/python3\n```\n",
    "created_at": "2021-06-29T21:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455137",
    "user": "@videlec"
}
```

Note that for this build I explicitely used conda's Python with

```
$ ./configure --with-python=/home/vincent/miniconda3/envs/sage-build/bin/python3
```




---

archive/issue_comments_455138.json:
```json
{
    "body": "A good question for `@`isuruf then. `-nostdlib` is usually used to link C++ code completely statically. It should only be used in conjunction with `static`. If you try to link C++ statically without `-nostdlib` various standard library will still be dynamically linked. It is a nuclear option to get statically linked C++ code. \n\nNot recommended for use unless you really know what you are doing or you are compiling for a BlueGene [now completely dead, I personally shutdown two of those in 2016].",
    "created_at": "2021-06-29T21:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455138",
    "user": "@kiwifb"
}
```

A good question for `@`isuruf then. `-nostdlib` is usually used to link C++ code completely statically. It should only be used in conjunction with `static`. If you try to link C++ statically without `-nostdlib` various standard library will still be dynamically linked. It is a nuclear option to get statically linked C++ code. 

Not recommended for use unless you really know what you are doing or you are compiling for a BlueGene [now completely dead, I personally shutdown two of those in 2016].



---

archive/issue_comments_455139.json:
```json
{
    "body": "`-nostdlib` is added by libtool. This is a different problem. Can you send the output of `conda list -p /home/vincent/miniconda3/envs/sage-build/` and also what the value of `_CONDA_PYTHON_SYSCONFIGDATA_NAME` and `PYTHON_SYSCONFIGDATA_NAME` in your env is?",
    "created_at": "2021-06-29T22:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455139",
    "user": "@isuruf"
}
```

`-nostdlib` is added by libtool. This is a different problem. Can you send the output of `conda list -p /home/vincent/miniconda3/envs/sage-build/` and also what the value of `_CONDA_PYTHON_SYSCONFIGDATA_NAME` and `PYTHON_SYSCONFIGDATA_NAME` in your env is?



---

archive/issue_comments_455140.json:
```json
{
    "body": "Got\n\n```\n$ echo $_CONDA_PYTHON_SYSCONFIGDATA_NAME\n_sysconfigdata_x86_64_conda_cos6_linux_gnu\n$ echo $PYTHON_SYSCONFIGDATA_NAME\n\n```\n\nAnd the output of `conda list -p /home/vincent/miniconda3/envs/sage-build/` is in [conda-list-p.txt](https://trac.sagemath.org/raw-attachment/ticket/32087/conda-list-p.txt).",
    "created_at": "2021-06-30T06:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455140",
    "user": "@videlec"
}
```

Got

```
$ echo $_CONDA_PYTHON_SYSCONFIGDATA_NAME
_sysconfigdata_x86_64_conda_cos6_linux_gnu
$ echo $PYTHON_SYSCONFIGDATA_NAME

```

And the output of `conda list -p /home/vincent/miniconda3/envs/sage-build/` is in [conda-list-p.txt](https://trac.sagemath.org/raw-attachment/ticket/32087/conda-list-p.txt).



---

archive/issue_comments_455141.json:
```json
{
    "body": "Attachment [conda-list-p.txt](tarball://root/attachments/some-uuid/ticket32087/conda-list-p.txt) by @isuruf created at 2021-06-30 14:17:53\n\nThanks. Can you post the output of `python -m sysconfig | grep sysroot`?",
    "created_at": "2021-06-30T14:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455141",
    "user": "@isuruf"
}
```

Attachment [conda-list-p.txt](tarball://root/attachments/some-uuid/ticket32087/conda-list-p.txt) by @isuruf created at 2021-06-30 14:17:53

Thanks. Can you post the output of `python -m sysconfig | grep sysroot`?



---

archive/issue_comments_455142.json:
```json
{
    "body": "\n```\n\tCONFIG_ARGS = \"'--prefix=/home/vincent/miniconda3/envs/sage-build' '--build=x86_64-conda_cos6-linux-gnu' '--host=x86_64-conda_cos6-linux-gnu' '--enable-ipv6' '--with-ensurepip=no' '--with-tzpath=/home/vincent/miniconda3/envs/sage-build/share/zoneinfo:/home/vincent/miniconda3/envs/sage-build/share/tzinfo' '--with-computed-gotos' '--with-system-ffi' '--enable-loadable-sqlite-extensions' '--with-tcltk-includes=-I/home/vincent/miniconda3/envs/sage-build/include' '--with-tcltk-libs=-L/home/vincent/miniconda3/envs/sage-build/lib -ltcl8.6 -ltk8.6' '--with-platlibdir=lib' '--with-lto' '--enable-optimizations' '-oldincludedir=/home/conda/feedstock_root/build_artifacts/python-split_1624061905143/_build_env/x86_64-conda_cos6-linux-gnu/sysroot/usr/include' '--disable-shared' 'PROFILE_TASK=-m test --pgo' 'build_alias=x86_64-conda_cos6-linux-gnu' 'host_alias=x86_64-conda_cos6-linux-gnu' 'MACHDEP=linux' 'CC=x86_64-conda_cos6-linux-gnu-gcc' 'CFLAGS=-march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/vincent/miniconda3/envs/sage-build/include      ' 'LDFLAGS=-Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link,/home/vincent/miniconda3/envs/sage-build/lib -L/home/vincent/miniconda3/envs/sage-build/lib' 'CPPFLAGS=-DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/vincent/miniconda3/envs/sage-build/include -I/home/vincent/miniconda3/envs/sage-build/include' 'CPP=/home/conda/feedstock_root/build_artifacts/python-split_1624061905143/_build_env/bin/x86_64-conda_cos6-linux-gnu-cpp' 'PKG_CONFIG_PATH=/home/vincent/miniconda3/envs/sage-build/lib/pkgconfig'\"\n```\n",
    "created_at": "2021-06-30T14:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455142",
    "user": "@videlec"
}
```


```
	CONFIG_ARGS = "'--prefix=/home/vincent/miniconda3/envs/sage-build' '--build=x86_64-conda_cos6-linux-gnu' '--host=x86_64-conda_cos6-linux-gnu' '--enable-ipv6' '--with-ensurepip=no' '--with-tzpath=/home/vincent/miniconda3/envs/sage-build/share/zoneinfo:/home/vincent/miniconda3/envs/sage-build/share/tzinfo' '--with-computed-gotos' '--with-system-ffi' '--enable-loadable-sqlite-extensions' '--with-tcltk-includes=-I/home/vincent/miniconda3/envs/sage-build/include' '--with-tcltk-libs=-L/home/vincent/miniconda3/envs/sage-build/lib -ltcl8.6 -ltk8.6' '--with-platlibdir=lib' '--with-lto' '--enable-optimizations' '-oldincludedir=/home/conda/feedstock_root/build_artifacts/python-split_1624061905143/_build_env/x86_64-conda_cos6-linux-gnu/sysroot/usr/include' '--disable-shared' 'PROFILE_TASK=-m test --pgo' 'build_alias=x86_64-conda_cos6-linux-gnu' 'host_alias=x86_64-conda_cos6-linux-gnu' 'MACHDEP=linux' 'CC=x86_64-conda_cos6-linux-gnu-gcc' 'CFLAGS=-march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/vincent/miniconda3/envs/sage-build/include      ' 'LDFLAGS=-Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link,/home/vincent/miniconda3/envs/sage-build/lib -L/home/vincent/miniconda3/envs/sage-build/lib' 'CPPFLAGS=-DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/vincent/miniconda3/envs/sage-build/include -I/home/vincent/miniconda3/envs/sage-build/include' 'CPP=/home/conda/feedstock_root/build_artifacts/python-split_1624061905143/_build_env/bin/x86_64-conda_cos6-linux-gnu-cpp' 'PKG_CONFIG_PATH=/home/vincent/miniconda3/envs/sage-build/lib/pkgconfig'"
```




---

archive/issue_comments_455143.json:
```json
{
    "body": "Sorry, I can't reproduce this. All I know is that the flag `-Wl,--sysroot=/` is the issue here. This is used in a sysconfig when used with compilers other than the ones shipped with conda. (It's there to use our newer linker with an older gcc installation). This shouldn't happen when conda compilers are used where `_CONDA_PYTHON_SYSCONFIGDATA_NAME` is set. The only situation I can think of is sage or pynac stripping the environment and deleting that env variable.\n\nCan you try printing that env variable `_CONDA_PYTHON_SYSCONFIGDATA_NAME` at the beginning of pynac build to confirm that sage doesn't filter it out?",
    "created_at": "2021-06-30T23:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455143",
    "user": "@isuruf"
}
```

Sorry, I can't reproduce this. All I know is that the flag `-Wl,--sysroot=/` is the issue here. This is used in a sysconfig when used with compilers other than the ones shipped with conda. (It's there to use our newer linker with an older gcc installation). This shouldn't happen when conda compilers are used where `_CONDA_PYTHON_SYSCONFIGDATA_NAME` is set. The only situation I can think of is sage or pynac stripping the environment and deleting that env variable.

Can you try printing that env variable `_CONDA_PYTHON_SYSCONFIGDATA_NAME` at the beginning of pynac build to confirm that sage doesn't filter it out?



---

archive/issue_comments_455144.json:
```json
{
    "body": "Nvm, I can reproduce this. I'll fix this soon.",
    "created_at": "2021-07-01T00:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455144",
    "user": "@isuruf"
}
```

Nvm, I can reproduce this. I'll fix this soon.



---

archive/issue_comments_455145.json:
```json
{
    "body": "Upstream issue https://github.com/conda-forge/python-feedstock/issues/474.\n\nYou can downgrade your setuptools version as a workaround.",
    "created_at": "2021-07-01T04:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455145",
    "user": "@isuruf"
}
```

Upstream issue https://github.com/conda-forge/python-feedstock/issues/474.

You can downgrade your setuptools version as a workaround.



---

archive/issue_comments_455146.json:
```json
{
    "body": "Replying to [comment:14 isuruf]:\n> Upstream issue https://github.com/conda-forge/python-feedstock/issues/474.\n> \n> You can downgrade your setuptools version as a workaround.\n\nDowngrading to setuptools 49.5.0 was only possible together with downgrading Python to 3.8. I am trying to build sage with that new setup now.",
    "created_at": "2021-07-01T15:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455146",
    "user": "@videlec"
}
```

Replying to [comment:14 isuruf]:
> Upstream issue https://github.com/conda-forge/python-feedstock/issues/474.
> 
> You can downgrade your setuptools version as a workaround.

Downgrading to setuptools 49.5.0 was only possible together with downgrading Python to 3.8. I am trying to build sage with that new setup now.



---

archive/issue_comments_455147.json:
```json
{
    "body": "Same problem\n\n```\nlibtool: link: /home/vincent/miniconda3/envs/sage-build/bin/x86_64-conda-linux-gnu-c++  -fPIC -DPIC -shared -nostdlib /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crti.o /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtbeginS.o  .libs/libpynac_la-add.o .libs/libpynac_la-archive.o .libs/libpynac_la-assume.o .libs/libpynac_la-basic.o .libs/libpynac_la-cmatcher.o .libs/libpynac_la-constant.o .libs/libpynac_la-context.o .libs/libpynac_la-ex.o .libs/libpynac_la-expair.o .libs/libpynac_la-expairseq.o .libs/libpynac_la-exprseq.o .libs/libpynac_la-fderivative.o .libs/libpynac_la-function.o .libs/libpynac_la-function_info.o .libs/libpynac_la-infinity.o .libs/libpynac_la-inifcns.o .libs/libpynac_la-inifcns_trig.o .libs/libpynac_la-inifcns_zeta.o .libs/libpynac_la-inifcns_hyperb.o .libs/libpynac_la-inifcns_trans.o .libs/libpynac_la-inifcns_gamma.o .libs/libpynac_la-inifcns_nstdsums.o .libs/libpynac_la-inifcns_orthopoly.o .libs/libpynac_la-inifcns_hyperg.o .libs/libpynac_la-inifcns_comb.o .libs/libpynac_la-lst.o .libs/libpynac_la-matrix.o .libs/libpynac_la-mpoly-giac.o .libs/libpynac_la-mpoly-ginac.o .libs/libpynac_la-mpoly-singular.o .libs/libpynac_la-mpoly.o .libs/libpynac_la-mul.o .libs/libpynac_la-normal.o .libs/libpynac_la-numeric.o .libs/libpynac_la-operators.o .libs/libpynac_la-power.o .libs/libpynac_la-py_funcs.o .libs/libpynac_la-registrar.o .libs/libpynac_la-relational.o .libs/libpynac_la-remember.o .libs/libpynac_la-pseries.o .libs/libpynac_la-print.o .libs/libpynac_la-symbol.o .libs/libpynac_la-upoly-ginac.o .libs/libpynac_la-utils.o .libs/libpynac_la-wildcard.o .libs/libpynac_la-templates.o .libs/libpynac_la-infoflagbase.o .libs/libpynac_la-sum.o .libs/libpynac_la-order.o .libs/libpynac_la-useries.o   -L/opt/sage/local/lib -L/home/vincent/miniconda3/envs/sage-build/lib -lpthread -lfactory -lmpfr -lntl -lomalloc -lsingular_resources -lflint -lgmp -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0 -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib -lstdc++ -lm -lc -lgcc_s /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtendS.o /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crtn.o  -O2 -g -march=nocona -mtune=haswell -fstack-protector-strong -O2 -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -pthread -Wl,-rpath=/home/vincent/miniconda3/envs/sage-build/lib -Wl,--no-as-needed -Wl,--sysroot=/ -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -march=nocona -mtune=haswell -fstack-protector-strong -O2 -O2   -pthread -Wl,-soname -Wl,libpynac.so.18 -o .libs/libpynac.so.18.3.5\n/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/bin/ld: cannot find /usr/lib64/libpthread_nonshared.a\ncollect2: error: ld returned 1 exit status\n```\n\nNote that sage installs its own version of setuptools (version 56.2.0).",
    "created_at": "2021-07-02T06:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455147",
    "user": "@videlec"
}
```

Same problem

```
libtool: link: /home/vincent/miniconda3/envs/sage-build/bin/x86_64-conda-linux-gnu-c++  -fPIC -DPIC -shared -nostdlib /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crti.o /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtbeginS.o  .libs/libpynac_la-add.o .libs/libpynac_la-archive.o .libs/libpynac_la-assume.o .libs/libpynac_la-basic.o .libs/libpynac_la-cmatcher.o .libs/libpynac_la-constant.o .libs/libpynac_la-context.o .libs/libpynac_la-ex.o .libs/libpynac_la-expair.o .libs/libpynac_la-expairseq.o .libs/libpynac_la-exprseq.o .libs/libpynac_la-fderivative.o .libs/libpynac_la-function.o .libs/libpynac_la-function_info.o .libs/libpynac_la-infinity.o .libs/libpynac_la-inifcns.o .libs/libpynac_la-inifcns_trig.o .libs/libpynac_la-inifcns_zeta.o .libs/libpynac_la-inifcns_hyperb.o .libs/libpynac_la-inifcns_trans.o .libs/libpynac_la-inifcns_gamma.o .libs/libpynac_la-inifcns_nstdsums.o .libs/libpynac_la-inifcns_orthopoly.o .libs/libpynac_la-inifcns_hyperg.o .libs/libpynac_la-inifcns_comb.o .libs/libpynac_la-lst.o .libs/libpynac_la-matrix.o .libs/libpynac_la-mpoly-giac.o .libs/libpynac_la-mpoly-ginac.o .libs/libpynac_la-mpoly-singular.o .libs/libpynac_la-mpoly.o .libs/libpynac_la-mul.o .libs/libpynac_la-normal.o .libs/libpynac_la-numeric.o .libs/libpynac_la-operators.o .libs/libpynac_la-power.o .libs/libpynac_la-py_funcs.o .libs/libpynac_la-registrar.o .libs/libpynac_la-relational.o .libs/libpynac_la-remember.o .libs/libpynac_la-pseries.o .libs/libpynac_la-print.o .libs/libpynac_la-symbol.o .libs/libpynac_la-upoly-ginac.o .libs/libpynac_la-utils.o .libs/libpynac_la-wildcard.o .libs/libpynac_la-templates.o .libs/libpynac_la-infoflagbase.o .libs/libpynac_la-sum.o .libs/libpynac_la-order.o .libs/libpynac_la-useries.o   -L/opt/sage/local/lib -L/home/vincent/miniconda3/envs/sage-build/lib -lpthread -lfactory -lmpfr -lntl -lomalloc -lsingular_resources -lflint -lgmp -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0 -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib -L/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/lib -L/home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib -lstdc++ -lm -lc -lgcc_s /home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/crtendS.o /home/vincent/miniconda3/envs/sage-build/bin/../x86_64-conda-linux-gnu/sysroot/usr/lib/../lib/crtn.o  -O2 -g -march=nocona -mtune=haswell -fstack-protector-strong -O2 -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -pthread -Wl,-rpath=/home/vincent/miniconda3/envs/sage-build/lib -Wl,--no-as-needed -Wl,--sysroot=/ -Wl,-rpath-link -Wl,/opt/sage/local/lib -Wl,-rpath -Wl,/opt/sage/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z -Wl,relro -Wl,-z -Wl,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath -Wl,/home/vincent/miniconda3/envs/sage-build/lib -Wl,-rpath-link -Wl,/home/vincent/miniconda3/envs/sage-build/lib -march=nocona -mtune=haswell -fstack-protector-strong -O2 -O2   -pthread -Wl,-soname -Wl,libpynac.so.18 -o .libs/libpynac.so.18.3.5
/home/vincent/miniconda3/envs/sage-build/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/bin/ld: cannot find /usr/lib64/libpthread_nonshared.a
collect2: error: ld returned 1 exit status
```

Note that sage installs its own version of setuptools (version 56.2.0).



---

archive/issue_comments_455148.json:
```json
{
    "body": "Right. Until upstream issue is solved, we have to downgrade setuptools to 49.* in sage itself.",
    "created_at": "2021-07-02T06:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455148",
    "user": "@isuruf"
}
```

Right. Until upstream issue is solved, we have to downgrade setuptools to 49.* in sage itself.



---

archive/issue_comments_455149.json:
```json
{
    "body": "Perhaps it's good enough to just change the value of `SETUPTOOLS_USE_DISTUTILS` (set in `build/bin/sage-build-env`) for conda as a workaround?",
    "created_at": "2021-07-02T06:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455149",
    "user": "@mkoeppe"
}
```

Perhaps it's good enough to just change the value of `SETUPTOOLS_USE_DISTUTILS` (set in `build/bin/sage-build-env`) for conda as a workaround?



---

archive/issue_comments_455150.json:
```json
{
    "body": "Yes, that seems reasonable until we get the upstream issue solved.",
    "created_at": "2021-07-02T21:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455150",
    "user": "@isuruf"
}
```

Yes, that seems reasonable until we get the upstream issue solved.



---

archive/issue_comments_455151.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> Perhaps it's good enough to just change the value of `SETUPTOOLS_USE_DISTUTILS` (set in `build/bin/sage-build-env`) for conda as a workaround?\n\nHow could I do that?",
    "created_at": "2021-07-06T20:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455151",
    "user": "@videlec"
}
```

Replying to [comment:18 mkoeppe]:
> Perhaps it's good enough to just change the value of `SETUPTOOLS_USE_DISTUTILS` (set in `build/bin/sage-build-env`) for conda as a workaround?

How could I do that?



---

archive/issue_comments_455152.json:
```json
{
    "body": "Try this\n----\nNew commits:",
    "created_at": "2021-07-06T21:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455152",
    "user": "@mkoeppe"
}
```

Try this
----
New commits:



---

archive/issue_comments_455153.json:
```json
{
    "body": "\n```\nSuccessfully installed pynac-0.7.27.p8\n```\n\nThanks",
    "created_at": "2021-07-06T21:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455153",
    "user": "@videlec"
}
```


```
Successfully installed pynac-0.7.27.p8
```

Thanks



---

archive/issue_comments_455154.json:
```json
{
    "body": "Attachment [cysignals-1.10.3.log](tarball://root/attachments/some-uuid/ticket32087/cysignals-1.10.3.log) by @videlec created at 2021-07-06 21:54:42\n\nAfter that the build failed for cysignals, see [cysignals-1.10.3.log](https://trac.sagemath.org/raw-attachment/ticket/32087/cysignals-1.10.3.log).",
    "created_at": "2021-07-06T21:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455154",
    "user": "@videlec"
}
```

Attachment [cysignals-1.10.3.log](tarball://root/attachments/some-uuid/ticket32087/cysignals-1.10.3.log) by @videlec created at 2021-07-06 21:54:42

After that the build failed for cysignals, see [cysignals-1.10.3.log](https://trac.sagemath.org/raw-attachment/ticket/32087/cysignals-1.10.3.log).



---

archive/issue_comments_455155.json:
```json
{
    "body": "Can you attach the pari log as well?",
    "created_at": "2021-07-06T22:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455155",
    "user": "@isuruf"
}
```

Can you attach the pari log as well?



---

archive/issue_comments_455156.json:
```json
{
    "body": "Attachment [pari-2.13.1.log](tarball://root/attachments/some-uuid/ticket32087/pari-2.13.1.log) by @videlec created at 2021-07-06 22:43:44\n\navailable as [pari-2.13.1.log](https://trac.sagemath.org/raw-attachment/ticket/32087/pari-2.13.1.log).\n\nThanks for your help.",
    "created_at": "2021-07-06T22:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455156",
    "user": "@videlec"
}
```

Attachment [pari-2.13.1.log](tarball://root/attachments/some-uuid/ticket32087/pari-2.13.1.log) by @videlec created at 2021-07-06 22:43:44

available as [pari-2.13.1.log](https://trac.sagemath.org/raw-attachment/ticket/32087/pari-2.13.1.log).

Thanks for your help.



---

archive/issue_comments_455157.json:
```json
{
    "body": "This may be a good moment to mention https://github.com/sagemath/cysignals/issues/125, which needs help",
    "created_at": "2021-07-06T22:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455157",
    "user": "@mkoeppe"
}
```

This may be a good moment to mention https://github.com/sagemath/cysignals/issues/125, which needs help



---

archive/issue_comments_455158.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-09T20:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455158",
    "user": "@isuruf"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_455159.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-07-09T20:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455159",
    "user": "@isuruf"
}
```

New commits:



---

archive/issue_comments_455160.json:
```json
{
    "body": "The issue was what `@`mkoeppe said about LDFLAGS in python overriding sage built version. For now, I've updated conda in pari to use pthread version for pari>=2.13.\n\nCan you check that this works?",
    "created_at": "2021-07-09T20:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455160",
    "user": "@isuruf"
}
```

The issue was what `@`mkoeppe said about LDFLAGS in python overriding sage built version. For now, I've updated conda in pari to use pthread version for pari>=2.13.

Can you check that this works?



---

archive/issue_comments_455161.json:
```json
{
    "body": "It looks like this may be breaking `cvxopt` on a number of platforms - see https://github.com/mkoeppe/sage/runs/3041608561?check_suite_focus=true",
    "created_at": "2021-07-12T06:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455161",
    "user": "@mkoeppe"
}
```

It looks like this may be breaking `cvxopt` on a number of platforms - see https://github.com/mkoeppe/sage/runs/3041608561?check_suite_focus=true



---

archive/issue_comments_455162.json:
```json
{
    "body": "`@`isuruf: with your branch, sage did build in conda. Thanks. Though I got into trouble when compiling the documentation\n\n```\n[dochtml] Error in sys.excepthook:\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py\", line 493, in __init__\n[dochtml]     context = TracebackException(\n[dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py\", line 493, in __init__\n[dochtml]     context = TracebackException(\n[dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py\", line 493, in __init__\n[dochtml]     context = TracebackException(\n[dochtml]   [Previous line repeated 997 more times]\n[dochtml] RecursionError: maximum recursion depth exceeded\n[dochtml] \n[dochtml] Original exception was:\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10510)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1323, in sage.libs.giac.giac.Pygen.cas_setup (build/cythonized/sage/libs/giac/giac.cpp:145936)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 902, in sage.libs.giac.giac.Pygen.__cinit__ (build/cythonized/sage/libs/giac/giac.cpp:140970)\n[dochtml] RecursionError: maximum recursion depth exceeded while calling a Python object\n[dochtml] \n[dochtml] During handling of the above exception, another exception occurred:\n[dochtml] \n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)\n[dochtml] RuntimeError\n...\n[dochtml] During handling of the above exception, another exception occurred:\n[dochtml] \n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)\n[dochtml] RuntimeError\n[dochtml] \n[dochtml] During handling of the above exception, another exception occurred:\n[dochtml] \n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/runpy.py\", line 197, in _run_module_as_main\n[dochtml]     return _run_code(code, main_globals, None,\n[dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/runpy.py\", line 87, in _run_code\n[dochtml]     exec(code, run_globals)\n[dochtml]   File \"/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()\n[dochtml]   File \"/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py\", line 1813, in main\n[dochtml]     builder()\n[dochtml]   File \"/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py\", line 809, in _wrapper\n[dochtml]     self.write_auto_rest_file(module_name)\n[dochtml]   File \"/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py\", line 1104, in write_auto_rest_file\n[dochtml]     title = self.get_module_docstring_title(module_name)\n[dochtml]   File \"/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py\", line 1065, in get_module_docstring_title\n[dochtml]     __import__(module_name)\n[dochtml]   File \"/opt/sage/local/lib/python3.9/site-packages/sage/libs/giac/__init__.py\", line 35, in <module>\n[dochtml]     from .giac import giacsettings, libgiac\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 2261, in init sage.libs.giac.giac (build/cythonized/sage/libs/giac/giac.cpp:168106)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 802, in sage.libs.giac.giac.GiacSetting.threads.__set__ (build/cythonized/sage/libs/giac/giac.cpp:11533)\n[dochtml]   File \"sage/libs/giac/giac.pyx\", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)\n[dochtml] RuntimeError\n[dochtml] make[5]: *** [Makefile:20: doc-inventory--reference-libs] Error 1\n[dochtml] make[5]: *** Waiting for unfinished jobs....\n```\n",
    "created_at": "2021-07-15T09:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455162",
    "user": "@videlec"
}
```

`@`isuruf: with your branch, sage did build in conda. Thanks. Though I got into trouble when compiling the documentation

```
[dochtml] Error in sys.excepthook:
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
[dochtml]     context = TracebackException(
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
[dochtml]     context = TracebackException(
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
[dochtml]     context = TracebackException(
[dochtml]   [Previous line repeated 997 more times]
[dochtml] RecursionError: maximum recursion depth exceeded
[dochtml] 
[dochtml] Original exception was:
[dochtml] Traceback (most recent call last):
[dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
[dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10510)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1323, in sage.libs.giac.giac.Pygen.cas_setup (build/cythonized/sage/libs/giac/giac.cpp:145936)
[dochtml]   File "sage/libs/giac/giac.pyx", line 902, in sage.libs.giac.giac.Pygen.__cinit__ (build/cythonized/sage/libs/giac/giac.cpp:140970)
[dochtml] RecursionError: maximum recursion depth exceeded while calling a Python object
[dochtml] 
[dochtml] During handling of the above exception, another exception occurred:
[dochtml] 
[dochtml] Traceback (most recent call last):
[dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
[dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
[dochtml] RuntimeError
...
[dochtml] During handling of the above exception, another exception occurred:
[dochtml] 
[dochtml] Traceback (most recent call last):
[dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
[dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
[dochtml] RuntimeError
[dochtml] 
[dochtml] During handling of the above exception, another exception occurred:
[dochtml] 
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/runpy.py", line 197, in _run_module_as_main
[dochtml]     return _run_code(code, main_globals, None,
[dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/runpy.py", line 87, in _run_code
[dochtml]     exec(code, run_globals)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 1813, in main
[dochtml]     builder()
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 809, in _wrapper
[dochtml]     self.write_auto_rest_file(module_name)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 1104, in write_auto_rest_file
[dochtml]     title = self.get_module_docstring_title(module_name)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage_docbuild/__init__.py", line 1065, in get_module_docstring_title
[dochtml]     __import__(module_name)
[dochtml]   File "/opt/sage/local/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 35, in <module>
[dochtml]     from .giac import giacsettings, libgiac
[dochtml]   File "sage/libs/giac/giac.pyx", line 2261, in init sage.libs.giac.giac (build/cythonized/sage/libs/giac/giac.cpp:168106)
[dochtml]   File "sage/libs/giac/giac.pyx", line 802, in sage.libs.giac.giac.GiacSetting.threads.__set__ (build/cythonized/sage/libs/giac/giac.cpp:11533)
[dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
[dochtml] RuntimeError
[dochtml] make[5]: *** [Makefile:20: doc-inventory--reference-libs] Error 1
[dochtml] make[5]: *** Waiting for unfinished jobs....
```




---

archive/issue_comments_455163.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-15T17:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455163",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_455164.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-07-19T02:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455164",
    "user": "@mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_455165.json:
```json
{
    "body": "pynac issue will disappear with package removal in #32387",
    "created_at": "2021-09-25T22:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455165",
    "user": "@mkoeppe"
}
```

pynac issue will disappear with package removal in #32387



---

archive/issue_comments_455166.json:
```json
{
    "body": "Outdated; in 9.5.beta8 (with #32113), the packages build OK.",
    "created_at": "2021-12-21T05:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455166",
    "user": "@mkoeppe"
}
```

Outdated; in 9.5.beta8 (with #32113), the packages build OK.



---

archive/issue_comments_455167.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-21T05:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455167",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_455168.json:
```json
{
    "body": "Replying to [comment:33 vdelecroix]:\n> `@`isuruf: with your branch, sage did build in conda. Thanks. Though I got into trouble when compiling the documentation\n> {{{\n> [dochtml] Error in sys.excepthook:\n> [dochtml] Traceback (most recent call last):\n> [dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py\", line 493, in __init__\n> [dochtml]     context = TracebackException(\n> [dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py\", line 493, in __init__\n> [dochtml]     context = TracebackException(\n> [dochtml]   File \"/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py\", line 493, in __init__\n> [dochtml]     context = TracebackException(\n> [dochtml]   [Previous line repeated 997 more times]\n> [dochtml] RecursionError: maximum recursion depth exceeded\n> [dochtml] \n> [dochtml] Original exception was:\n> [dochtml] Traceback (most recent call last):\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10510)\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 1323, in sage.libs.giac.giac.Pygen.cas_setup (build/cythonized/sage/libs/giac/giac.cpp:145936)\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 902, in sage.libs.giac.giac.Pygen.__cinit__ (build/cythonized/sage/libs/giac/giac.cpp:140970)\n> [dochtml] RecursionError: maximum recursion depth exceeded while calling a Python object\n> [dochtml] \n> [dochtml] During handling of the above exception, another exception occurred:\n> [dochtml] \n> [dochtml] Traceback (most recent call last):\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)\n> [dochtml]   File \"sage/libs/giac/giac.pyx\", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)\n> [dochtml] RuntimeError\n> ...\n}}}\n\nI've opened #33056 for this.",
    "created_at": "2021-12-21T05:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455168",
    "user": "@mkoeppe"
}
```

Replying to [comment:33 vdelecroix]:
> `@`isuruf: with your branch, sage did build in conda. Thanks. Though I got into trouble when compiling the documentation
> {{{
> [dochtml] Error in sys.excepthook:
> [dochtml] Traceback (most recent call last):
> [dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
> [dochtml]     context = TracebackException(
> [dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
> [dochtml]     context = TracebackException(
> [dochtml]   File "/home/vincent/miniconda3/envs/sage-build/lib/python3.9/traceback.py", line 493, in __init__
> [dochtml]     context = TracebackException(
> [dochtml]   [Previous line repeated 997 more times]
> [dochtml] RecursionError: maximum recursion depth exceeded
> [dochtml] 
> [dochtml] Original exception was:
> [dochtml] Traceback (most recent call last):
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10510)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1323, in sage.libs.giac.giac.Pygen.cas_setup (build/cythonized/sage/libs/giac/giac.cpp:145936)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 902, in sage.libs.giac.giac.Pygen.__cinit__ (build/cythonized/sage/libs/giac/giac.cpp:140970)
> [dochtml] RecursionError: maximum recursion depth exceeded while calling a Python object
> [dochtml] 
> [dochtml] During handling of the above exception, another exception occurred:
> [dochtml] 
> [dochtml] Traceback (most recent call last):
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143061)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10513)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142492)
> [dochtml]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143137)
> [dochtml] RuntimeError
> ...
}}}

I've opened #33056 for this.



---

archive/issue_comments_455169.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-16T21:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455169",
    "user": "@isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_455170.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-02-17T00:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31850",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31850#issuecomment-455170",
    "user": "@vbraun"
}
```

Resolution: invalid
