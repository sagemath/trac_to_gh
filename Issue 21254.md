# Issue 21254: IndexError in integral_points_count of Polyhedron

Issue created by migration from https://trac.sagemath.org/ticket/21491

Original creator: slabbe

Original creation time: 2016-09-14 16:18:44

CC:  mkoeppe

With `latte_int` installed:


```
$ sage -experimental
...
latte_int...............................1.7.3 (1.7.3)
...
```


I get:


```
sage: eqns = [[-10, 0, 1], [-10, 1, 0]]
sage: P = Polyhedron(ieqs=[], eqns=eqns)
sage: P.integral_points_count()
...
sage/geometry/polyhedron/base.pyc in integral_points_count(self, verbose)
   4259             raise RuntimeError("LattE integrale failed (exit code {}) to execute {}".format(ret_code, ' '.join(args)) + err.strip())
   4260
-> 4261         return Integer(ans.splitlines()[-1])
   4262
   4263     def integral_points(self, threshold=100000):

IndexError: list index out of range

```


Same error with:


```
sage: P = Polyhedron(ieqs=[], eqns=[[-11,0,2],[-10,1,0]])
sage: P.vertices()
(A vertex at (10, 11/2),)
```


The culprit might be the empty string:


```
sage: "".splitlines()[-1]
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-1-7faf349df14a> in <module>()
----> 1 "".splitlines()[-Integer(1)]

IndexError: list index out of range
```



---

Comment by slabbe created at 2016-09-15 13:41:22

Just to say that in both cases, `latte_int` gets the answer right.

1 in this case:


```
sage: P = Polyhedron(ieqs=[], eqns=[[-10, 0, 1], [-10, 1, 0]])
sage: P.integral_points_count(verbose=True)
This is LattE integrale 1.7.3
Available from http://www.math.ucdavis.edu/~latte/
...
Ax <= b, given as (b|-A):
=========================
[]

Ax = b, given as (b|-A):
========================
[-10 0 1]
[-10 1 0]

The number of lattice points is 1.
---------------------------------------------------------------------------
Traceback (most recent call last)
...
IndexError: list index out of range
```


0 in this case:


```
sage: P = Polyhedron(ieqs=[], eqns=[[-11,0,2],[-10,1,0]])
sage: P.integral_points_count(verbose=True)
This is LattE integrale 1.7.3
Available from http://www.math.ucdavis.edu/~latte/
...
Ax <= b, given as (b|-A):
=========================
[]

Ax = b, given as (b|-A):
========================
[-11 0 2]
[-10 1 0]

The number of lattice points is 0.
---------------------------------------------------------------------------
Traceback (most recent call last)
...
IndexError: list index out of range
```



---

Comment by slabbe created at 2016-11-02 12:31:29

New commits:


---

Comment by slabbe created at 2016-11-02 12:31:29

Changing status from new to needs_review.


---

Comment by moritz created at 2016-11-23 09:33:19

This seems to work!


---

Comment by moritz created at 2016-11-23 09:33:37

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2016-11-23 12:00:09

Thanks for the review!


---

Comment by slabbe created at 2016-11-23 12:00:09

Changing keywords from "" to "days79".


---

Comment by tscrim created at 2016-11-23 12:19:50

Since opening a file takes ~10x longer than a try/except block, I suggest the following:

```
        try:
            return Integer(ans.splitlines()[-1])
        except IndexError:
            with open(SAGE_TMP+'/numOfLatticePoints', 'r') as f:
                return Integer(f.read())
```



---

Comment by tscrim created at 2016-11-23 12:19:50

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2016-11-23 12:20:03

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-11-23 12:44:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-23 12:48:41

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2016-11-23 12:48:41

Thanks.


---

Comment by vbraun created at 2016-11-25 18:31:31

Documentation doesn't build, see patchbot.


---

Comment by vbraun created at 2016-11-25 18:31:31

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2016-11-26 20:02:05

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2016-11-26 20:02:05

Trivial fix `TESTS::` -> `TESTS:`, so I'm allowing myself to set this back to positive review.
----
New commits:


---

Comment by slabbe created at 2016-11-28 10:37:13

Thank you for fixing this Travis.

SÃ©bastien


---

Comment by vbraun created at 2016-11-28 23:02:27

Resolution: fixed
