# Issue 10453: efficient counting of cusps for the principal congruence subgroup Gamma(n)

archive/issues_010453.json:
```json
{
    "body": "Assignee: John Cremona\n\nKeywords: cusps, ncusps(), Gamma(n), principal congruence subgroup\n\nIn the sage-support group, John Cremona suggested writing a ticket aimed at replacing the current code for G.ncusps, where G is the principal congruence subgroup Gamma(n), with more efficient code.  Please make a patch using the following replacement code.  This new code will compute say Gamma(15).ncusps() in less than a second, instead of the hours it takes with the current code.\n\nn=self.level() \n\nif n<=2: \n\n        return[None,1,3][n] \n\nreturn ZZ((1/2)*sum([moebius(d)*(n/d)*(n/d)   for d in n.divisors()])) \n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10506\n\n",
    "created_at": "2010-12-21T07:32:25Z",
    "labels": [
        "modular forms",
        "minor",
        "enhancement"
    ],
    "title": "efficient counting of cusps for the principal congruence subgroup Gamma(n)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10453",
    "user": "rje"
}
```
Assignee: John Cremona

Keywords: cusps, ncusps(), Gamma(n), principal congruence subgroup

In the sage-support group, John Cremona suggested writing a ticket aimed at replacing the current code for G.ncusps, where G is the principal congruence subgroup Gamma(n), with more efficient code.  Please make a patch using the following replacement code.  This new code will compute say Gamma(15).ncusps() in less than a second, instead of the hours it takes with the current code.

n=self.level() 

if n<=2: 

        return[None,1,3][n] 

return ZZ((1/2)*sum([moebius(d)*(n/d)*(n/d)   for d in n.divisors()])) 


Issue created by migration from https://trac.sagemath.org/ticket/10506





---

archive/issue_comments_107879.json:
```json
{
    "body": "Attachment\n\napplies to 4.6.1.alpha3",
    "created_at": "2010-12-21T12:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10453#issuecomment-107879",
    "user": "cremona"
}
```

Attachment

applies to 4.6.1.alpha3



---

archive/issue_comments_107880.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-12-21T12:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10453#issuecomment-107880",
    "user": "cremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_107881.json:
```json
{
    "body": "The patch adds an implentation using the idea I posted on sage-support, namely using the formula (valid for n>2) that the number of cusps for Gamma(n) is half the index of Gamma1(n).\n\nSome times:\n\n```\nsage: timeit('Gamma(15).ncusps()')\n625 loops, best of 3: 174 \u00b5s per loop\nsage: timeit('Gamma(115).ncusps()')\n625 loops, best of 3: 176 \u00b5s per loop\nsage: timeit('Gamma(12115).ncusps()')\n625 loops, best of 3: 176 \u00b5s per loop\nsage: timeit('Gamma(1312115).ncusps()')\n625 loops, best of 3: 201 \u00b5s per loop\n```\n\n\nNote that the next job is to add a method to return a set of inequivalent cusps.  The default implementation is stupidly slow (as proved by the fact that the old default for ncusps() was to find all the cusps and count them).\n\nThat should be on another ticket.",
    "created_at": "2010-12-21T12:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10453#issuecomment-107881",
    "user": "cremona"
}
```

The patch adds an implentation using the idea I posted on sage-support, namely using the formula (valid for n>2) that the number of cusps for Gamma(n) is half the index of Gamma1(n).

Some times:

```
sage: timeit('Gamma(15).ncusps()')
625 loops, best of 3: 174 µs per loop
sage: timeit('Gamma(115).ncusps()')
625 loops, best of 3: 176 µs per loop
sage: timeit('Gamma(12115).ncusps()')
625 loops, best of 3: 176 µs per loop
sage: timeit('Gamma(1312115).ncusps()')
625 loops, best of 3: 201 µs per loop
```


Note that the next job is to add a method to return a set of inequivalent cusps.  The default implementation is stupidly slow (as proved by the fact that the old default for ncusps() was to find all the cusps and count them).

That should be on another ticket.



---

archive/issue_comments_107882.json:
```json
{
    "body": "The product formula in the patch is equivalent to the summation formula in my ticket, and is faster!  The examples given are all correct.",
    "created_at": "2010-12-21T13:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10453#issuecomment-107882",
    "user": "rje"
}
```

The product formula in the patch is equivalent to the summation formula in my ticket, and is faster!  The examples given are all correct.



---

archive/issue_comments_107883.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-12-21T13:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10453#issuecomment-107883",
    "user": "rje"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_107884.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-01-25T08:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10453#issuecomment-107884",
    "user": "jdemeyer"
}
```

Resolution: fixed
