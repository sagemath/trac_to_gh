# Issue 15034: pretty_print_default fails in a terminal session

Issue created by migration from Trac.

Original creator: iandrus

Original creation time: 2013-10-12 04:48:42

CC:  vbraun ppurka novoselt

Calling pretty_print_default in a terminal fails:

```
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 5.12, Release Date: 2013-10-07                        │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: pretty_print_default(True)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-b70acc55a8d2> in <module>()
----> 1 pretty_print_default(True)

/Users/ivanandres/SageStuff/sage-5.12/local/lib/python2.7/site-packages/sage/misc/latex.pyc in pretty_print_default(enable)
   2463     """
   2464     import sys
-> 2465     sys.displayhook.set_display('typeset' if enable else 'simple')
   2466
   2467

AttributeError: 'DisplayHook' object has no attribute 'set_display'
sage:
```


Perhaps calling pretty_print_default doesn't make much sense in the terminal, but it's used in the emacs interface to be able to display typeset output.

I think doctests pass because the doctesting framework sets sys.displayhook to something else, namely `sage.misc.displayhook.DisplayHook(sys.displayhook)`.  I think the regression was introduced in #15168, and so I have cc'ed the people involved there in case they want to weigh in on how this should be fixed.


---

Comment by ppurka created at 2013-10-12 06:53:20

As commented in the function, this should probably be removed from the global namespace. It is really not useful in the terminal.


---

Comment by vbraun created at 2013-10-12 11:19:56

Correct, the terminal uses IPython's machinery instead of `sys.displayhook`. The doctests and the notebook run commands in non-ipython sessions, so our displayhook is used. IMHO the best way to switch IPython's behavior is with the `%display` magic, that is,

```
sage: %display typeset
sage: 1+1
<html><script type="math/tex">\newcommand{\Bold}[1]{\mathbf{#1}}2</script></html>
```

I see that we don't actually doctest that, this ought to be added to `sage/misc/sage_extension.py`


---

Comment by ppurka created at 2013-10-12 11:37:00

If we want to fix this function, can this be made to call whatever the magic `%display typeset` runs?

Maybe run the current code inside a `try: except:` construct?


---

Comment by vbraun created at 2013-10-12 11:38:28

We can, but imho we should just remove `pretty_print_default`.


---

Comment by ppurka created at 2013-10-12 11:39:25

Let's use this ticket for removing the function from the global namespace.


---

Comment by ppurka created at 2013-10-12 11:42:16

`@`iandrus - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?


---

Comment by iandrus created at 2013-10-12 14:07:17

Replying to [comment:6 ppurka]:
> `@`iandrus - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?

Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?


---

Comment by ppurka created at 2013-10-12 14:16:49

Replying to [comment:7 iandrus]:
> Replying to [comment:6 ppurka]:
> > `@`iandrus - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?
> 
> Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?  
No. That exists from earlier, probably sage-5.11 (#12719).


---

Comment by iandrus created at 2013-10-13 15:59:55

Replying to [comment:7 iandrus]:
> Replying to [comment:6 ppurka]:
> > `@`iandrus - Would the emacs interface work if you set `sys.displayhook = sage.misc.displayhook.DisplayHook` from emacs?
> 
> Yes that works.  Just to be clear, `sage.misc.displayhook.DisplayHook` only exists in 5.12 (and later), right?  

I spoke too soon.  Using `sage.misc.displayhook.DisplayHook` makes plots not appear (in DOCTEST_MODE so they can be viewed inline as well).  I haven't had a change to debug into it yet.


---

Comment by vbraun created at 2013-10-13 16:19:23

No graphics is shown in `DOCTEST_MODE`, this is the expected behavior.

Whats wrong with `%display typeset`?


---

Comment by iandrus created at 2014-06-10 06:21:01

Sage mode now uses `%display typeset`, so I no longer care about this--we can just remove `pretty_print_default`.


---

Comment by kcrisman created at 2014-12-16 02:31:14

> Sage mode now uses `%display typeset`, so I no longer care about this--we can just remove `pretty_print_default`.
At least from the command line.  Possibly also `pretty_print`?  

However, this is needed in [all_notebook.py](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/all_notebook.py), so don't just remove it completely!


---

Comment by iandrus created at 2015-04-14 04:53:08

Changing status from new to needs_review.


---

Comment by iandrus created at 2015-04-14 04:53:08

pretty_print_default seems to no longer be in the global namespace in a terminal session, so I move we close this as won't fix.


---

Comment by vbraun created at 2015-04-14 08:56:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-14 08:56:58

Resolution: wontfix
