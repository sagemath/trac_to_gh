# Issue 30063: sage.tensor.modules.free_module_basis: Make Basis_abstract a subclass of Family

Issue created by migration from https://trac.sagemath.org/ticket/30300

Original creator: mkoeppe

Original creation time: 2020-08-06 04:49:58

CC:  @mjungmath egourgoulhon tscrim

... in particular provide an implementation of the `keys()` method.


---

Comment by mkoeppe created at 2021-01-22 20:42:48

Any help with implementing this would be very welcome


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2022-08-23 22:30:56

New commits:


---

Comment by git created at 2022-08-23 22:42:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-23 22:42:44

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-08-24 05:53:25


```
sage -t --random-seed=263111727722887782759446361100915924402 sage/manifolds/differentiable/chart.py  # 2 doctests failed
sage -t --random-seed=263111727722887782759446361100915924402 sage/manifolds/differentiable/vectorframe.py  # 2 doctests failed
sage -t --random-seed=263111727722887782759446361100915924402 sage/manifolds/local_frame.py  # 2 doctests failed
```



---

Comment by git created at 2022-08-24 05:56:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-08-24 09:22:40

Could you please remind me what is the purpose of this ticket? In particular, why should bases of a `FiniteRankFreeModule` have a `keys()` method?


---

Comment by mkoeppe created at 2022-08-24 16:13:11

Replying to [comment:16 egourgoulhon]:
> Could you please remind me what is the purpose of this ticket? In particular, why should bases of a `FiniteRankFreeModule` have a `keys()` method?

By itself, this change only improves "discoverability": If a user has an instance of `Basis_abstract`, currently they can get an element by calling `__getitem__` and either get an element or an error. (Or they would have to know the detail that the indices accepted by `__getitem__` are the underlying modules's irange.)

It is also preparation for #30229, which makes the standard bases of tensor modules (induced by the bases of their base module) explicit objects (instances of the subclass `TensorFreeSubmoduleBasis_comp`), instead of just being implicit in various algorithms.


---

Comment by git created at 2022-08-25 01:28:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-08-26 15:08:04

Replying to [comment:17 mkoeppe]:
> Replying to [comment:16 egourgoulhon]:
> > Could you please remind me what is the purpose of this ticket? In particular, why should bases of a `FiniteRankFreeModule` have a `keys()` method?
> 
> By itself, this change only improves "discoverability": If a user has an instance of `Basis_abstract`, currently they can get an element by calling `__getitem__` and either get an element or an error. (Or they would have to know the detail that the indices accepted by `__getitem__` are the underlying modules's irange.) 
> 
> It is also preparation for #30229, which makes the standard bases of tensor modules (induced by the bases of their base module) explicit objects (instances of the subclass `TensorFreeSubmoduleBasis_comp`), instead of just being implicit in various algorithms.

Thanks for your answer. It's still not clear to me what the advantage of making `Basis_abstract` a subclass of `AbstractFamily` is. It adds some code complexity, making `FreeModuleBasis` be a `Parent`, but I trust you it is worth it. Could you tell which functionality of `AbstractFamily` or `FiniteEnumeratedSets` (the declared category) do you plan to use in #30229?


---

Comment by mkoeppe created at 2022-08-27 02:09:24

Replying to [comment:21 egourgoulhon]:
> Could you tell which functionality of `AbstractFamily` or `FiniteEnumeratedSets` (the declared category) do you plan to use in #30229? 

The new version of method `isomorphism_with_fixed_basis` in #34427 illustrates what I have in mind


---

Comment by egourgoulhon created at 2022-08-27 12:38:36

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2022-08-27 12:38:36

Replying to [comment:23 mkoeppe]:
> Replying to [comment:21 egourgoulhon]:
> > Could you tell which functionality of `AbstractFamily` or `FiniteEnumeratedSets` (the declared category) do you plan to use in #30229? 
> 
> The new version of method `isomorphism_with_fixed_basis` in #34427 illustrates what I have in mind

It looks that this uses only the method `keys()`, which can be defined without any reference to `AbstractFamily`. However, I understand that the inheritance from `AbstractFamily`  makes the bases of `FiniteRankFreeModule`'s more similar to those of other free modules in Sage, which is certainly a good thing => positive review from my side.


---

Comment by mkoeppe created at 2022-08-27 14:04:37

Thank you!


---

Comment by mkoeppe created at 2022-08-28 23:46:27

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2022-08-28 23:46:27

(commented on the wrong ticket)


---

Comment by mkoeppe created at 2022-08-28 23:48:25

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-08-29 11:24:14

Resolution: fixed
