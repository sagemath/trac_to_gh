# Issue 30323: Build optional package openssl as part of TOOLCHAIN_DEPS

Issue created by migration from https://trac.sagemath.org/ticket/30560

Original creator: mkoeppe

Original creation time: 2020-09-11 21:46:35

CC:  @mwageringel slelievre dimpase mjo jhpalmieri

As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.


---

Comment by mkoeppe created at 2020-09-11 22:00:31

Best done with a change to the `SAGE_SPKG_ENABLE` macro


---

Comment by mkoeppe created at 2020-09-13 18:03:16

Changing priority from major to critical.


---

Comment by mkoeppe created at 2020-09-13 19:13:02

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-09-13 19:13:02

Found a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review
----
New commits:


---

Comment by jhpalmieri created at 2020-09-14 22:15:44

This looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.

To test, I did `make distclean`. Then

```
$ ./configure --enable-openssl --with-system-python3=no
$ make
```

built `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.

Do I need to find a system on which Python's `ssl` module fails to build?


---

Comment by mkoeppe created at 2020-09-14 22:35:55

Replying to [comment:9 jhpalmieri]:
> To test, I did `make distclean`. Then
> {{{
> $ ./configure --enable-openssl --with-system-python3=no
> $ make
> }}}
> built `openssl` first and then `python3`, which is the point, right?

Right.

> Without this branch, these commands just build `python3`, not `openssl`.

I think without this branch it should also have built `openssl`, just not necessarily before `python3`.


---

Comment by mkoeppe created at 2020-09-14 22:37:15

Replying to [comment:9 jhpalmieri]:
> Do I need to find a system on which Python's `ssl` module fails to build?

I don't think that's necessary


---

Comment by jhpalmieri created at 2020-09-14 23:06:23

Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 jhpalmieri]:
> > To test, I did `make distclean`. Then
> > {{{
> > $ ./configure --enable-openssl --with-system-python3=no
> > $ make
> > }}}
> > built `openssl` first and then `python3`, which is the point, right?
> 
> Right.
> 
> > Without this branch, these commands just build `python3`, not `openssl`.
> 
> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.

Sorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.


---

Comment by jhpalmieri created at 2020-09-14 23:06:40

Good find with `findstring`, by the way.


---

Comment by jhpalmieri created at 2020-09-14 23:06:40

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-09-14 23:14:00

Thanks!


---

Comment by vbraun created at 2020-09-18 20:23:08

Resolution: fixed
