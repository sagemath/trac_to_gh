# Issue 30323: Build optional package openssl as part of TOOLCHAIN_DEPS

archive/issues_030323.json:
```json
{
    "body": "CC:  @mwageringel slelievre dimpase mjo jhpalmieri\n\nAs discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30560\n\n",
    "created_at": "2020-09-11T21:46:35Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "title": "Build optional package openssl as part of TOOLCHAIN_DEPS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30323",
    "user": "mkoeppe"
}
```
CC:  @mwageringel slelievre dimpase mjo jhpalmieri

As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.

Issue created by migration from https://trac.sagemath.org/ticket/30560





---

archive/issue_comments_432541.json:
```json
{
    "body": "Best done with a change to the `SAGE_SPKG_ENABLE` macro",
    "created_at": "2020-09-11T22:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432541",
    "user": "mkoeppe"
}
```

Best done with a change to the `SAGE_SPKG_ENABLE` macro



---

archive/issue_comments_432542.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-09-13T18:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432542",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_432543.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432543",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_432544.json:
```json
{
    "body": "Found a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review\n----\nNew commits:",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432544",
    "user": "mkoeppe"
}
```

Found a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review
----
New commits:



---

archive/issue_comments_432545.json:
```json
{
    "body": "This looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.\n\nTo test, I did `make distclean`. Then\n\n```\n$ ./configure --enable-openssl --with-system-python3=no\n$ make\n```\n\nbuilt `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.\n\nDo I need to find a system on which Python's `ssl` module fails to build?",
    "created_at": "2020-09-14T22:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432545",
    "user": "jhpalmieri"
}
```

This looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.

To test, I did `make distclean`. Then

```
$ ./configure --enable-openssl --with-system-python3=no
$ make
```

built `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.

Do I need to find a system on which Python's `ssl` module fails to build?



---

archive/issue_comments_432546.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n> To test, I did `make distclean`. Then\n> {{{\n> $ ./configure --enable-openssl --with-system-python3=no\n> $ make\n> }}}\n> built `openssl` first and then `python3`, which is the point, right?\n\nRight.\n\n> Without this branch, these commands just build `python3`, not `openssl`.\n\nI think without this branch it should also have built `openssl`, just not necessarily before `python3`.",
    "created_at": "2020-09-14T22:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432546",
    "user": "mkoeppe"
}
```

Replying to [comment:9 jhpalmieri]:
> To test, I did `make distclean`. Then
> {{{
> $ ./configure --enable-openssl --with-system-python3=no
> $ make
> }}}
> built `openssl` first and then `python3`, which is the point, right?

Right.

> Without this branch, these commands just build `python3`, not `openssl`.

I think without this branch it should also have built `openssl`, just not necessarily before `python3`.



---

archive/issue_comments_432547.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n> Do I need to find a system on which Python's `ssl` module fails to build?\n\nI don't think that's necessary",
    "created_at": "2020-09-14T22:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432547",
    "user": "mkoeppe"
}
```

Replying to [comment:9 jhpalmieri]:
> Do I need to find a system on which Python's `ssl` module fails to build?

I don't think that's necessary



---

archive/issue_comments_432548.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> Replying to [comment:9 jhpalmieri]:\n> > To test, I did `make distclean`. Then\n> > {{{\n> > $ ./configure --enable-openssl --with-system-python3=no\n> > $ make\n> > }}}\n> > built `openssl` first and then `python3`, which is the point, right?\n> \n> Right.\n> \n> > Without this branch, these commands just build `python3`, not `openssl`.\n> \n> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.\n\nSorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.",
    "created_at": "2020-09-14T23:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432548",
    "user": "jhpalmieri"
}
```

Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 jhpalmieri]:
> > To test, I did `make distclean`. Then
> > {{{
> > $ ./configure --enable-openssl --with-system-python3=no
> > $ make
> > }}}
> > built `openssl` first and then `python3`, which is the point, right?
> 
> Right.
> 
> > Without this branch, these commands just build `python3`, not `openssl`.
> 
> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.

Sorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.



---

archive/issue_comments_432549.json:
```json
{
    "body": "Good find with `findstring`, by the way.",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432549",
    "user": "jhpalmieri"
}
```

Good find with `findstring`, by the way.



---

archive/issue_comments_432550.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432550",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_432551.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-09-14T23:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432551",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_432552.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-18T20:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30323#issuecomment-432552",
    "user": "vbraun"
}
```

Resolution: fixed
