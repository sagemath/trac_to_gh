# Issue 25076: Speed up exact division in ℤ[x,y,...]

archive/issues_025076.json:
```json
{
    "body": "...by directly calling Singular instead of first converting polynomials over\u00a0\u211a (similar to #25287).\n\n\n```\nsage: p = 3*(-x^8*y^2 - x*y^9 + 6*x^8*y + 17*x^2*y^6 - x^3*y^2)\nsage: q = 7*(x^2 + x*y + y^2 + 1)\nsage: %timeit p//q # before\n1000 loops, best of 3: 278 \u00b5s per loop\nsage: %timeit p//q # after\nThe slowest run took 4.27 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 14.2 \u00b5s per loop\n```\n\n\nNote that this changes the result of some inexact divisions:\n\n```\nsage: P.<x,y> = ZZ[]\nsage: (x+y)//(2*x) # before\n0\nsage: (x^3 + x^2 + 1)//(2*x)\n0\nsage: (x+y)//(2*x) # after\n1\nsage: (x^3 + x^2 + 1)//(2*x)\nx^2 + x\n```\n\nBut I frankly don't understand the definition that was used before; it seems that it was just an arbitrary choice of quotient that agreed with the exact result for exact divisions. In particular, neither the old definition nor the new one (nor `//` over\u00a0\u211a) satisfies `(p - (p//q)*q).lt() < p.lt()`.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25313\n\n",
    "created_at": "2018-05-09T09:07:06Z",
    "labels": [
        "commutative algebra",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Speed up exact division in \u2124[x,y,...]",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25076",
    "user": "mmezzarobba"
}
```
...by directly calling Singular instead of first converting polynomials over ℚ (similar to #25287).


```
sage: p = 3*(-x^8*y^2 - x*y^9 + 6*x^8*y + 17*x^2*y^6 - x^3*y^2)
sage: q = 7*(x^2 + x*y + y^2 + 1)
sage: %timeit p//q # before
1000 loops, best of 3: 278 µs per loop
sage: %timeit p//q # after
The slowest run took 4.27 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 14.2 µs per loop
```


Note that this changes the result of some inexact divisions:

```
sage: P.<x,y> = ZZ[]
sage: (x+y)//(2*x) # before
0
sage: (x^3 + x^2 + 1)//(2*x)
0
sage: (x+y)//(2*x) # after
1
sage: (x^3 + x^2 + 1)//(2*x)
x^2 + x
```

But I frankly don't understand the definition that was used before; it seems that it was just an arbitrary choice of quotient that agreed with the exact result for exact divisions. In particular, neither the old definition nor the new one (nor `//` over ℚ) satisfies `(p - (p//q)*q).lt() < p.lt()`.


Issue created by migration from https://trac.sagemath.org/ticket/25313





---

archive/issue_comments_352823.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-09T12:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25076#issuecomment-352823",
    "user": "mmezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_352824.json:
```json
{
    "body": "At least for `(x+y)//(2*x)`, I would (albeit naively) expect `0` since the monomial `x//x == 1` and `1 // 2 == 0` (with certainly `y//x == 0`). However, it does make sense with `quo_rem`:\n\n```\nsage: (x+y).quo_rem(2*x)\n(1, -x + y)\nsage: (x^3+x^2+1).quo_rem(2*x)\n(x^2 + x, -x^3 - x^2 + 1)\n```\n\nand it just returning the quotient.",
    "created_at": "2018-05-09T12:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25076#issuecomment-352824",
    "user": "tscrim"
}
```

At least for `(x+y)//(2*x)`, I would (albeit naively) expect `0` since the monomial `x//x == 1` and `1 // 2 == 0` (with certainly `y//x == 0`). However, it does make sense with `quo_rem`:

```
sage: (x+y).quo_rem(2*x)
(1, -x + y)
sage: (x^3+x^2+1).quo_rem(2*x)
(x^2 + x, -x^3 - x^2 + 1)
```

and it just returning the quotient.



---

archive/issue_comments_352825.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2018-05-10T10:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25076#issuecomment-352825",
    "user": "tscrim"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_352826.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-10T10:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25076#issuecomment-352826",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_352827.json:
```json
{
    "body": "Having thought more about it, I find the agreement with `quo_rem` to be more desirable. I also do not see the change in behavior as something people should be relying on and should be treated as a [spacebar](https://xkcd.com/1172/) (even after this ticket). So positive review.",
    "created_at": "2018-05-10T10:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25076#issuecomment-352827",
    "user": "tscrim"
}
```

Having thought more about it, I find the agreement with `quo_rem` to be more desirable. I also do not see the change in behavior as something people should be relying on and should be treated as a [spacebar](https://xkcd.com/1172/) (even after this ticket). So positive review.



---

archive/issue_comments_352828.json:
```json
{
    "body": "Thanks!",
    "created_at": "2018-05-10T18:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25076#issuecomment-352828",
    "user": "mmezzarobba"
}
```

Thanks!



---

archive/issue_comments_352829.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-15T22:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25076#issuecomment-352829",
    "user": "vbraun"
}
```

Resolution: fixed
