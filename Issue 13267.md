# Issue 13267: padic xgcd incorrect

archive/issues_013267.json:
```json
{
    "body": "Assignee: roed\n\nKeywords: gcd\n\n`xgcd` is broken for padics:\n\n\n```\nsage: R.<x> = Qp(3,3)[]\nsage: f = 3*x + 7\nsage: g = 5*x + 9\nsage: f.xgcd(f*g)[0].is_one()\nTrue\n\nsage: R.<x> = Qp(3)[]\nsage: f = 490473657*x + 257392844/729\nsage: g = 225227399/59049*x - 8669753175\nsage: f.xgcd(f*g)[0].is_one()\nTrue\n```\n\n\nThe algorithm used is the standard Euclidean algorithm which is afaik not correct for inexact fields.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13439\n\n",
    "created_at": "2012-09-07T18:55:38Z",
    "labels": [
        "padics",
        "minor",
        "bug"
    ],
    "title": "padic xgcd incorrect",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13267",
    "user": "saraedum"
}
```
Assignee: roed

Keywords: gcd

`xgcd` is broken for padics:


```
sage: R.<x> = Qp(3,3)[]
sage: f = 3*x + 7
sage: g = 5*x + 9
sage: f.xgcd(f*g)[0].is_one()
True

sage: R.<x> = Qp(3)[]
sage: f = 490473657*x + 257392844/729
sage: g = 225227399/59049*x - 8669753175
sage: f.xgcd(f*g)[0].is_one()
True
```


The algorithm used is the standard Euclidean algorithm which is afaik not correct for inexact fields.

Issue created by migration from https://trac.sagemath.org/ticket/13439





---

archive/issue_comments_162664.json:
```json
{
    "body": "The only place where the doctests called that xgcd was in the padic L-series. I disabled the calls there until we have a working xgcd for padics.",
    "created_at": "2012-09-07T19:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162664",
    "user": "saraedum"
}
```

The only place where the doctests called that xgcd was in the padic L-series. I disabled the calls there until we have a working xgcd for padics.



---

archive/issue_comments_162665.json:
```json
{
    "body": "Replying to [comment:1 saraedum]:\n> The only place where the doctests called that xgcd was in the padic L-series. I disabled the calls there until we have a working xgcd for padics.\n\nJust found out about stopgaps. A stopgap makes of course much more sense than just removing functionality.",
    "created_at": "2012-09-26T14:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162665",
    "user": "saraedum"
}
```

Replying to [comment:1 saraedum]:
> The only place where the doctests called that xgcd was in the padic L-series. I disabled the calls there until we have a working xgcd for padics.

Just found out about stopgaps. A stopgap makes of course much more sense than just removing functionality.



---

archive/issue_comments_162666.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-10-22T19:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162666",
    "user": "saraedum"
}
```

Attachment



---

archive/issue_comments_162667.json:
```json
{
    "body": "This is great.  I could never get up the motivation to fix this since I always wanted to fix so many other things about p-adic polynomials first.  I'll review it once the prerequisites are finished.",
    "created_at": "2012-10-24T09:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162667",
    "user": "roed"
}
```

This is great.  I could never get up the motivation to fix this since I always wanted to fix so many other things about p-adic polynomials first.  I'll review it once the prerequisites are finished.



---

archive/issue_comments_162668.json:
```json
{
    "body": "rebased and converted to git branch; no other changes\n----\nNew commits:",
    "created_at": "2014-01-27T21:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162668",
    "user": "niles"
}
```

rebased and converted to git branch; no other changes
----
New commits:



---

archive/issue_comments_162669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-01-28T16:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162669",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_162670.json:
```json
{
    "body": "I am working on this in an attempt to resolve #9457.  Bug-hunting there triggers the stopgap for this ticket (see comment 12 there).  I have now created git branches for all of this ticket's dependencies and merged them here.  Unfortunately the tests in this ticket description now trigger an error:\n\n\n```\nsage: R.<x> = Qp(3,3)[]\nsage: f = 3*x + 7\nsage: g = 5*x + 9\nsage: f.xgcd(f*g)[0].is_one()\n\nTraceback (most recent call last)\n...\nTypeError: _xgcd_univariate_polynomial() takes exactly 2 arguments (3 given)\n```\n\n\nSo there are some problems here, possibly caused by my rebasing . . .",
    "created_at": "2014-01-28T16:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162670",
    "user": "niles"
}
```

I am working on this in an attempt to resolve #9457.  Bug-hunting there triggers the stopgap for this ticket (see comment 12 there).  I have now created git branches for all of this ticket's dependencies and merged them here.  Unfortunately the tests in this ticket description now trigger an error:


```
sage: R.<x> = Qp(3,3)[]
sage: f = 3*x + 7
sage: g = 5*x + 9
sage: f.xgcd(f*g)[0].is_one()

Traceback (most recent call last)
...
TypeError: _xgcd_univariate_polynomial() takes exactly 2 arguments (3 given)
```


So there are some problems here, possibly caused by my rebasing . . .



---

archive/issue_comments_162671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-29T19:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162671",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_162672.json:
```json
{
    "body": "After a change in #13629, this seems to be working correctly and giving the output written in the examples/tests.  But the main examples on this ticket description are still broken.",
    "created_at": "2014-01-29T19:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162672",
    "user": "niles"
}
```

After a change in #13629, this seems to be working correctly and giving the output written in the examples/tests.  But the main examples on this ticket description are still broken.



---

archive/issue_comments_162673.json:
```json
{
    "body": "I work on #20254. The solution there will avoid the use of xgcd for p-adic L-functions.\n----\nNew commits:",
    "created_at": "2016-03-23T09:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162673",
    "user": "wuthrich"
}
```

I work on #20254. The solution there will avoid the use of xgcd for p-adic L-functions.
----
New commits:



---

archive/issue_comments_162674.json:
```json
{
    "body": "As of today, the main examples in this ticket all work. However, xgcd itself is still broken. Examples can be found by search:\n\n\n```\nsage: R = PolynomialRing(Qp(5), 'x')\nsage: while True:\nsage:    f,g = R.random_element(degree=3), R.random_element(degree=3)\nsage:    d,a,b = xgcd(f,g)\nsage:    if a*f + b*g != d:\nsage:        print(\"d =\", d)\nsage:        print(\"a =\", a)\nsage:        print('f = ', f)\nsage:        print('b = ', b)\nsage:        print('g = ', g)\nsage:        break\n\nd = 1 + O(5^2)\na = (3*5^41 + O(5^43))*x^2 + (3*5^14 + O(5^16))*x + 2*5^11 + 3*5^12 + O(5^13)\nf =  (4*5^-1 + 2 + 2*5 + 5^2 + 4*5^3 + 2*5^4 + 3*5^5 + 4*5^7 + 2*5^8 + 2*5^9 + 4*5^10 + 3*5^11 + 2*5^12 + 4*5^15 + 5^16 + 5^17 + 3*5^18 + O(5^19))*x^3 + (4*5^-12 + 2*5^-11 + 5^-9 + 2*5^-8 + 4*5^-5 + 3*5^-4 + 4*5^-3 + 2*5^-2 + 5^-1 + 1 + 5 + 3*5^2 + 3*5^3 + 2*5^4 + 2*5^5 + 3*5^6 + O(5^7))*x^2 + (5 + 5^2 + 2*5^3 + 5^4 + 2*5^5 + 5^6 + 4*5^7 + 2*5^8 + 4*5^9 + 5^10 + 2*5^11 + 5^12 + 3*5^13 + 5^14 + 3*5^15 + 2*5^17 + 2*5^18 + 5^19 + 4*5^20 + O(5^21))*x + 3*5^-5 + 5^-2 + 5^-1 + 4*5 + 4*5^2 + 4*5^4 + 2*5^5 + 5^6 + 5^8 + 2*5^9 + 2*5^10 + 3*5^11 + 2*5^12 + 5^13 + 3*5^14 + O(5^15)\nb =  (4*5^14 + O(5^16))*x^2 + O(5^-11)*x + O(5^-38)\ng =  (2*5^26 + 4*5^28 + 5^29 + 2*5^31 + 2*5^32 + 5^35 + 4*5^36 + 5^37 + 3*5^38 + 5^39 + 3*5^40 + 5^41 + 3*5^42 + 3*5^43 + 5^44 + O(5^45))*x^3 + (2*5^-1 + 5 + 5^4 + 4*5^6 + 2*5^7 + 4*5^8 + 2*5^9 + 5^10 + 5^11 + 5^13 + 4*5^14 + 5^17 + 2*5^18 + O(5^19))*x^2 + (5^3 + 2*5^4 + 2*5^5 + 3*5^6 + 4*5^7 + 4*5^8 + 4*5^9 + 3*5^10 + 2*5^11 + 2*5^15 + 2*5^16 + 4*5^17 + 3*5^18 + 4*5^19 + O(5^21))*x + 1 + 4*5 + 4*5^3 + 3*5^4 + 3*5^5 + 4*5^7 + 3*5^8 + 5^9 + 5^11 + 2*5^12 + 5^13 + 2*5^14 + 4*5^15 + 4*5^17 + 5^18 + 3*5^19 + O(5^20)\n```\n",
    "created_at": "2020-06-26T18:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13267#issuecomment-162674",
    "user": "@EnderWannabe"
}
```

As of today, the main examples in this ticket all work. However, xgcd itself is still broken. Examples can be found by search:


```
sage: R = PolynomialRing(Qp(5), 'x')
sage: while True:
sage:    f,g = R.random_element(degree=3), R.random_element(degree=3)
sage:    d,a,b = xgcd(f,g)
sage:    if a*f + b*g != d:
sage:        print("d =", d)
sage:        print("a =", a)
sage:        print('f = ', f)
sage:        print('b = ', b)
sage:        print('g = ', g)
sage:        break

d = 1 + O(5^2)
a = (3*5^41 + O(5^43))*x^2 + (3*5^14 + O(5^16))*x + 2*5^11 + 3*5^12 + O(5^13)
f =  (4*5^-1 + 2 + 2*5 + 5^2 + 4*5^3 + 2*5^4 + 3*5^5 + 4*5^7 + 2*5^8 + 2*5^9 + 4*5^10 + 3*5^11 + 2*5^12 + 4*5^15 + 5^16 + 5^17 + 3*5^18 + O(5^19))*x^3 + (4*5^-12 + 2*5^-11 + 5^-9 + 2*5^-8 + 4*5^-5 + 3*5^-4 + 4*5^-3 + 2*5^-2 + 5^-1 + 1 + 5 + 3*5^2 + 3*5^3 + 2*5^4 + 2*5^5 + 3*5^6 + O(5^7))*x^2 + (5 + 5^2 + 2*5^3 + 5^4 + 2*5^5 + 5^6 + 4*5^7 + 2*5^8 + 4*5^9 + 5^10 + 2*5^11 + 5^12 + 3*5^13 + 5^14 + 3*5^15 + 2*5^17 + 2*5^18 + 5^19 + 4*5^20 + O(5^21))*x + 3*5^-5 + 5^-2 + 5^-1 + 4*5 + 4*5^2 + 4*5^4 + 2*5^5 + 5^6 + 5^8 + 2*5^9 + 2*5^10 + 3*5^11 + 2*5^12 + 5^13 + 3*5^14 + O(5^15)
b =  (4*5^14 + O(5^16))*x^2 + O(5^-11)*x + O(5^-38)
g =  (2*5^26 + 4*5^28 + 5^29 + 2*5^31 + 2*5^32 + 5^35 + 4*5^36 + 5^37 + 3*5^38 + 5^39 + 3*5^40 + 5^41 + 3*5^42 + 3*5^43 + 5^44 + O(5^45))*x^3 + (2*5^-1 + 5 + 5^4 + 4*5^6 + 2*5^7 + 4*5^8 + 2*5^9 + 5^10 + 5^11 + 5^13 + 4*5^14 + 5^17 + 2*5^18 + O(5^19))*x^2 + (5^3 + 2*5^4 + 2*5^5 + 3*5^6 + 4*5^7 + 4*5^8 + 4*5^9 + 3*5^10 + 2*5^11 + 2*5^15 + 2*5^16 + 4*5^17 + 3*5^18 + 4*5^19 + O(5^21))*x + 1 + 4*5 + 4*5^3 + 3*5^4 + 3*5^5 + 4*5^7 + 3*5^8 + 5^9 + 5^11 + 2*5^12 + 5^13 + 2*5^14 + 4*5^15 + 4*5^17 + 5^18 + 3*5^19 + O(5^20)
```

