# Issue 34536: Dual algorithm for Face iterator of Unbounded Combinatorial Polyhedron

archive/issues_034536.json:
```json
{
    "body": "CC:  @mkoeppe\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34773\n\n",
    "created_at": "2022-11-22T18:07:44Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Dual algorithm for Face iterator of Unbounded Combinatorial Polyhedron",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34536",
    "user": "@xuluze"
}
```
CC:  @mkoeppe



Issue created by migration from https://trac.sagemath.org/ticket/34773





---

archive/issue_comments_488776.json:
```json
{
    "body": "`@`gh-kliem Would this be easy to implement?",
    "created_at": "2022-11-22T18:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488776",
    "user": "@mkoeppe"
}
```

`@`gh-kliem Would this be easy to implement?



---

archive/issue_comments_488777.json:
```json
{
    "body": "I don't think it is very hard. How urgent is it? Or is it just to have it.\n\nIt is just that I messed this up in the beginning, as I didn't know any better.\n\nThe real work might be to clean up along the way. Some stuff is just way too complicated and might be a huge pain to maintain (and is already very difficult to compensate for everyone not directly involved, maybe even everyone except me).",
    "created_at": "2022-11-27T10:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488777",
    "user": "@kliem"
}
```

I don't think it is very hard. How urgent is it? Or is it just to have it.

It is just that I messed this up in the beginning, as I didn't know any better.

The real work might be to clean up along the way. Some stuff is just way too complicated and might be a huge pain to maintain (and is already very difficult to compensate for everyone not directly involved, maybe even everyone except me).



---

archive/issue_comments_488778.json:
```json
{
    "body": "In our case, we can try to get around it by adding a hyperplane to make the cone bounded, and be careful to identify the original faces when handling with the face iterator. But it would be nice to have the dual algorithm apply to our unbounded case directly to make the code cleaner.",
    "created_at": "2022-11-28T04:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488778",
    "user": "@xuluze"
}
```

In our case, we can try to get around it by adding a hyperplane to make the cone bounded, and be careful to identify the original faces when handling with the face iterator. But it would be nice to have the dual algorithm apply to our unbounded case directly to make the code cleaner.



---

archive/issue_comments_488779.json:
```json
{
    "body": "Something like:\n\n\n```\nsage: P = Polyhedron(rays=[[1,0,0], [0,1,0], [0,1,1]])\nsage: C = P.combinatorial_polyhedron()\nsage: facets = C.facets()\nsage: far_face = P.rays()\nsage: new_facets = facets + (far_face,)\nsage: C1 = CombinatorialPolyhedron(new_facets)\nsage: it = C1.face_iter(algorithm='dual')\nsage: faces = [i for i in it if any(v.is_vertex() for v in i.ambient_Vrepresentation())]\n```\n\n\nshould work as a workaround.",
    "created_at": "2022-11-28T19:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488779",
    "user": "@kliem"
}
```

Something like:


```
sage: P = Polyhedron(rays=[[1,0,0], [0,1,0], [0,1,1]])
sage: C = P.combinatorial_polyhedron()
sage: facets = C.facets()
sage: far_face = P.rays()
sage: new_facets = facets + (far_face,)
sage: C1 = CombinatorialPolyhedron(new_facets)
sage: it = C1.face_iter(algorithm='dual')
sage: faces = [i for i in it if any(v.is_vertex() for v in i.ambient_Vrepresentation())]
```


should work as a workaround.



---

archive/issue_comments_488780.json:
```json
{
    "body": "Thank you very much! Yes, it works.",
    "created_at": "2022-12-01T18:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488780",
    "user": "@xuluze"
}
```

Thank you very much! Yes, it works.



---

archive/issue_comments_488781.json:
```json
{
    "body": "> Suddenly we also have an algorithm to visit the bounded faces of a polyhedron:\n\nGreat - that will also be useful for computing regular subdivisions",
    "created_at": "2022-12-09T19:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488781",
    "user": "@mkoeppe"
}
```

> Suddenly we also have an algorithm to visit the bounded faces of a polyhedron:

Great - that will also be useful for computing regular subdivisions



---

archive/issue_comments_488782.json:
```json
{
    "body": "Unfortunatly, I had to remove some nonsense. the bounded faces starting from the facets are a bit annoying and I don't know a shortcut to visiting all faces and filtering.\n\nStarting from the vertices there is a shortcut I think. At least the implementation is easy. If there are few vertices and many many rays, the assymtotics are a bit annoying: # bounded faces * # generators * # vertices * # facets.\n\nIf the generators are in general position that is much nicer: # bounded faces * # vertices * max(# vertices, # facets).\n\n(Subject to stupid mistakes I made because I'm tired.)\n\nEdit: The generators need to be in general position.",
    "created_at": "2022-12-09T20:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488782",
    "user": "@kliem"
}
```

Unfortunatly, I had to remove some nonsense. the bounded faces starting from the facets are a bit annoying and I don't know a shortcut to visiting all faces and filtering.

Starting from the vertices there is a shortcut I think. At least the implementation is easy. If there are few vertices and many many rays, the assymtotics are a bit annoying: # bounded faces * # generators * # vertices * # facets.

If the generators are in general position that is much nicer: # bounded faces * # vertices * max(# vertices, # facets).

(Subject to stupid mistakes I made because I'm tired.)

Edit: The generators need to be in general position.



---

archive/issue_comments_488783.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-12-10T15:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488783",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_488784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-12-10T20:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488784",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_488785.json:
```json
{
    "body": "There is actually one thing one needs to pay attention to:\n\nA far face is not always a far facet:\n\nE.g. `Polyhedron(vertices=[[1, 0], [0, 1]], rays=[This is the Trac macro *1, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 1-macro))` is unbounded, but does not have a far facet.\n\nBut `Polyhedron(vertices=[[1, 0], [0, 1]], rays=[[1, 0], [0, 1]])` has a far facet.",
    "created_at": "2022-12-11T15:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34536#issuecomment-488785",
    "user": "@kliem"
}
```

There is actually one thing one needs to pay attention to:

A far face is not always a far facet:

E.g. `Polyhedron(vertices=[[1, 0], [0, 1]], rays=[This is the Trac macro *1, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 1-macro))` is unbounded, but does not have a far facet.

But `Polyhedron(vertices=[[1, 0], [0, 1]], rays=[[1, 0], [0, 1]])` has a far facet.
