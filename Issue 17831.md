# Issue 17831: Fix ModularForm_abstract.__ne__()

archive/issues_017831.json:
```json
{
    "body": "Keywords: modular forms comparison\n\nIn Sage 6.6.rc1:\n\n```\nsage: f = Newforms(Gamma1(30), 2, names='a')[1]\nsage: g = loads(dumps(f))\nsage: f == g\nTrue\nsage: f != g\nTrue          # should be False\n```\n\nThis is fixed by implementing `ModularForm_abstract.__ne__()`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18068\n\n",
    "created_at": "2015-03-27T13:29:52Z",
    "labels": [
        "modular forms",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Fix ModularForm_abstract.__ne__()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17831",
    "user": "@pjbruin"
}
```
Keywords: modular forms comparison

In Sage 6.6.rc1:

```
sage: f = Newforms(Gamma1(30), 2, names='a')[1]
sage: g = loads(dumps(f))
sage: f == g
True
sage: f != g
True          # should be False
```

This is fixed by implementing `ModularForm_abstract.__ne__()`.

Issue created by migration from https://trac.sagemath.org/ticket/18068





---

archive/issue_comments_239092.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-27T14:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239092",
    "user": "@pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_239093.json:
```json
{
    "body": "While you're at it:\n\n`__cmp__` doesn't make any sense at all to me (see the except part):\n\n```\n        try:\n            self._ensure_is_compatible(other)\n        except Exception:\n            return self.parent().__cmp__(other.parent())\n        if self.element() == other.element():\n            return 0\n        else:\n            return -1\n```\n\n\nAlso `__cmp__` is getting deprecated and \"<,<=,>,>=\" aren't needed anyway for elements I assume.\nWhat about also removing `__cmp__`?",
    "created_at": "2015-03-28T15:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239093",
    "user": "@jjermann"
}
```

While you're at it:

`__cmp__` doesn't make any sense at all to me (see the except part):

```
        try:
            self._ensure_is_compatible(other)
        except Exception:
            return self.parent().__cmp__(other.parent())
        if self.element() == other.element():
            return 0
        else:
            return -1
```


Also `__cmp__` is getting deprecated and "<,<=,>,>=" aren't needed anyway for elements I assume.
What about also removing `__cmp__`?



---

archive/issue_comments_239094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-28T20:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239094",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239095.json:
```json
{
    "body": "Replying to [comment:2 jj]:\n> What about also removing `__cmp__`?\nGood point, the last commit simplifies the comparison methods a bit more.",
    "created_at": "2015-03-28T20:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239095",
    "user": "@pjbruin"
}
```

Replying to [comment:2 jj]:
> What about also removing `__cmp__`?
Good point, the last commit simplifies the comparison methods a bit more.



---

archive/issue_comments_239096.json:
```json
{
    "body": "Hello,\n\nIn #17890 Jeroen makes it so that it would be better to implement `_richcmp_(left, right, op)` that automatically takes care of coercions. Moreover, inside this function you can assume that `left` and `right` have the same parent. What do you think?\n\nVincent",
    "created_at": "2015-04-26T13:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239096",
    "user": "@videlec"
}
```

Hello,

In #17890 Jeroen makes it so that it would be better to implement `_richcmp_(left, right, op)` that automatically takes care of coercions. Moreover, inside this function you can assume that `left` and `right` have the same parent. What do you think?

Vincent



---

archive/issue_comments_239097.json:
```json
{
    "body": "Hello Vincent,\n> In #17890 Jeroen makes it so that it would be better to implement `_richcmp_(left, right, op)` that automatically takes care of coercions. Moreover, inside this function you can assume that `left` and `right` have the same parent. What do you think?\nThat would indeed be good, but wouldn't that need #18305, since we are concerned with Python, not Cython?  In that case I'm not sure if I want to wait for #18305 and its dependencies, both because this ticket fixes an actual bug and because it is a dependency of #18061, another bug that I would like to see fixed soon.",
    "created_at": "2015-04-27T22:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239097",
    "user": "@pjbruin"
}
```

Hello Vincent,
> In #17890 Jeroen makes it so that it would be better to implement `_richcmp_(left, right, op)` that automatically takes care of coercions. Moreover, inside this function you can assume that `left` and `right` have the same parent. What do you think?
That would indeed be good, but wouldn't that need #18305, since we are concerned with Python, not Cython?  In that case I'm not sure if I want to wait for #18305 and its dependencies, both because this ticket fixes an actual bug and because it is a dependency of #18061, another bug that I would like to see fixed soon.



---

archive/issue_comments_239098.json:
```json
{
    "body": "Sorry, let me make it clearer:\n- after #17890 you can implement directly `_richcmp_` or/and `_cmp_` to take benefit of coercions in Python classes. If you want to avoid coercions in rich comparisons, you should redefine `__eq__`/`__ne__`.\n- #18305 is about cleaning parents implemented as Python classes in the Sage library. For the one which mimic coercion, we just replace the comparisons (either `__cmp__` or `__eq__` and friends) with `_cmp_` or `_richcmp_`.\n\nI have no problem for this ticket to go before #17890. My remark was just informative.\n\nVincent",
    "created_at": "2015-04-28T06:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239098",
    "user": "@videlec"
}
```

Sorry, let me make it clearer:
- after #17890 you can implement directly `_richcmp_` or/and `_cmp_` to take benefit of coercions in Python classes. If you want to avoid coercions in rich comparisons, you should redefine `__eq__`/`__ne__`.
- #18305 is about cleaning parents implemented as Python classes in the Sage library. For the one which mimic coercion, we just replace the comparisons (either `__cmp__` or `__eq__` and friends) with `_cmp_` or `_richcmp_`.

I have no problem for this ticket to go before #17890. My remark was just informative.

Vincent



---

archive/issue_comments_239099.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n> Sorry, let me make it clearer:\n> - after #17890 you can implement directly `_richcmp_` or/and `_cmp_` to take benefit of coercions in Python classes. If you want to avoid coercions in rich comparisons, you should redefine `__eq__`/`__ne__`.\nOK, this is what is currently done for modular forms.\n> I have no problem for this ticket to go before #17890. My remark was just informative.\nI spent some time trying to implement `_cmp_()` instead of `__eq__()` & co., but this was not so easy.  It turns out that modular forms do not yet support the coercion model as they should.  For example, the forms `f` and `g` below are in different subspaces of the same ambient space, but this ambient space is not detected as a common parent:\n\n```\nsage: M = ModularForms(Gamma1(13), 2)\nsage: f = M.cuspidal_submodule().gen(0)\nsage: g = M.old_submodule()(0)\nsage: f.parent().ambient() is g.parent().ambient()\nTrue\nsage: f + g\nTraceback (most recent call last):\n...\nTypeError: unsupported operand parent(s) for '+': 'Cuspidal subspace of dimension 2 of Modular Forms space of dimension 13 for Congruence Subgroup Gamma1(13) of weight 2 over Rational Field' and 'Modular Forms subspace of dimension 0 of Modular Forms space of dimension 13 for Congruence Subgroup Gamma1(13) of weight 2 over Rational Field'\n```\n\nI think it is better to do that on a different ticket.",
    "created_at": "2015-04-28T16:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239099",
    "user": "@pjbruin"
}
```

Replying to [comment:8 vdelecroix]:
> Sorry, let me make it clearer:
> - after #17890 you can implement directly `_richcmp_` or/and `_cmp_` to take benefit of coercions in Python classes. If you want to avoid coercions in rich comparisons, you should redefine `__eq__`/`__ne__`.
OK, this is what is currently done for modular forms.
> I have no problem for this ticket to go before #17890. My remark was just informative.
I spent some time trying to implement `_cmp_()` instead of `__eq__()` & co., but this was not so easy.  It turns out that modular forms do not yet support the coercion model as they should.  For example, the forms `f` and `g` below are in different subspaces of the same ambient space, but this ambient space is not detected as a common parent:

```
sage: M = ModularForms(Gamma1(13), 2)
sage: f = M.cuspidal_submodule().gen(0)
sage: g = M.old_submodule()(0)
sage: f.parent().ambient() is g.parent().ambient()
True
sage: f + g
Traceback (most recent call last):
...
TypeError: unsupported operand parent(s) for '+': 'Cuspidal subspace of dimension 2 of Modular Forms space of dimension 13 for Congruence Subgroup Gamma1(13) of weight 2 over Rational Field' and 'Modular Forms subspace of dimension 0 of Modular Forms space of dimension 13 for Congruence Subgroup Gamma1(13) of weight 2 over Rational Field'
```

I think it is better to do that on a different ticket.



---

archive/issue_comments_239100.json:
```json
{
    "body": "Replying to [comment:9 pbruin]:\n> Replying to [comment:8 vdelecroix]:\n> ...\n> I think it is better to do that on a different ticket.\n\nAgreed",
    "created_at": "2015-04-28T16:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239100",
    "user": "@videlec"
}
```

Replying to [comment:9 pbruin]:
> Replying to [comment:8 vdelecroix]:
> ...
> I think it is better to do that on a different ticket.

Agreed



---

archive/issue_comments_239101.json:
```json
{
    "body": "Hi Peter,\n\nCould you mention this ticket number in the documentation, something like `this used to fail (see :trac:`18068`)`?\n\nThen it will be good to go.\n\nVincent",
    "created_at": "2015-05-03T15:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239101",
    "user": "@videlec"
}
```

Hi Peter,

Could you mention this ticket number in the documentation, something like `this used to fail (see :trac:`18068`)`?

Then it will be good to go.

Vincent



---

archive/issue_comments_239102.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-03T15:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239102",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_239103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-04T10:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239103",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239104.json:
```json
{
    "body": "Replying to [comment:11 vdelecroix]:\n> Could you mention this ticket number in the documentation, something like `this used to fail (see :trac:`18068`)`?\nDone in the last commit.\n> Then it will be good to go.\nOK, thanks for the review!",
    "created_at": "2015-05-04T10:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239104",
    "user": "@pjbruin"
}
```

Replying to [comment:11 vdelecroix]:
> Could you mention this ticket number in the documentation, something like `this used to fail (see :trac:`18068`)`?
Done in the last commit.
> Then it will be good to go.
OK, thanks for the review!



---

archive/issue_comments_239105.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-05-04T10:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239105",
    "user": "@pjbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_239106.json:
```json
{
    "body": "\n```diff\n- TESTS::\n+ TESTS:\n\n    The following used to fail (see :trac:`18068`)::\n```\n",
    "created_at": "2015-05-04T10:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239106",
    "user": "@videlec"
}
```


```diff
- TESTS::
+ TESTS:

    The following used to fail (see :trac:`18068`)::
```




---

archive/issue_comments_239107.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-05-04T10:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239107",
    "user": "@videlec"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_239108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-04T10:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239108",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239109.json:
```json
{
    "body": "Replying to [comment:15 vdelecroix]:\n> {{{#!diff\n> - TESTS::\n> + TESTS:\n> \n>     The following used to fail (see :trac:`18068`)::\n> }}}\nSorry about that, thanks for noticing!",
    "created_at": "2015-05-04T10:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239109",
    "user": "@pjbruin"
}
```

Replying to [comment:15 vdelecroix]:
> {{{#!diff
> - TESTS::
> + TESTS:
> 
>     The following used to fail (see :trac:`18068`)::
> }}}
Sorry about that, thanks for noticing!



---

archive/issue_comments_239110.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-05-04T10:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239110",
    "user": "@pjbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_239111.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-05T00:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17831#issuecomment-239111",
    "user": "@vbraun"
}
```

Resolution: fixed
