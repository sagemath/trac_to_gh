# Issue 34206: suitesparse: Update to 6.0.1, fix DESTDIR bug

archive/issues_033969.json:
```json
{
    "body": "(from ticket:34203#comment:34)\n\n```\n[suitesparse-5.10.1] gcc -std=c99 -L/Users/mkoeppe/s/sage/sage-rebasing/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/local/lib  -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib -dynamiclib -compatibility_version 1 -current_version 1.0.2 -Wl,-install_name -Wl,/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.dylib -shared -undefined dynamic_lookup slip_matrix_div.o slip_create_mpq_array.o SLIP_free.o SLIP_LU_factorize.o SLIP_realloc.o slip_matrix_mul.o slip_get_largest_pivot.o slip_ref_triangular_solve.o SLIP_backslash.o slip_create_mpz_array.o slip_get_nonzero_pivot.o SLIP_LU_solve.o slip_back_sub.o slip_cumsum.o slip_get_pivot.o SLIP_malloc.o slip_sparse_collapse.o SLIP_calloc.o slip_dfs.o slip_get_smallest_pivot.o SLIP_matrix_allocate.o slip_sparse_realloc.o slip_cast_array.o slip_expand_double_array.o SLIP_gmp.o SLIP_matrix_copy.o SLIP_matrix_check.o slip_cast_matrix.o slip_expand_mpfr_array.o SLIP_initialize.o SLIP_matrix_free.o slip_check_solution.o slip_expand_mpq_array.o SLIP_initialize_expert.o SLIP_matrix_nnz.o SLIP_create_default_options.o SLIP_finalize.o SLIP_LU_analysis_free.o slip_permute_x.o slip_permute_b.o slip_create_mpfr_array.o slip_forward_sub.o SLIP_LU_analyze.o slip_reach.o -o /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib -lm -rpath /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib -lsuitesparseconfig -lamd -lcolamd -lm -lgmp -lmpfr\n```\n\n`DESTDIR` is used twice in the `-o`.\n\n`DESTDIR` handling is coming from `build/pkgs/suitesparse/patches/03-buildflags.patch`\n\nWe upgrade to 5.12.0 and pick up a fresh set of patches from Debian or another distro\n\n\n**CC:**  @kiwifb\n\n**Branch:** [u/mkoeppe/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse6.0.1)\n\n**Commit:** [424cb49cf28f1809d78014ea315bb4a301e4505e](https://github.com/sagemath/sagetrac-mirror/commit/424cb49cf28f1809d78014ea315bb4a301e4505e)\n\n**Author:** Fran\u00e7ois Bissey\n\n**Status:** needs_work\n\n**Dependencies:** #34746, #34835\n\nIssue created by migration from https://trac.sagemath.org/ticket/34206\n\n",
    "created_at": "2022-07-21T17:06:10Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "suitesparse: Update to 6.0.1, fix DESTDIR bug",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34206",
    "user": "https://github.com/mkoeppe"
}
```
(from ticket:34203#comment:34)

```
[suitesparse-5.10.1] gcc -std=c99 -L/Users/mkoeppe/s/sage/sage-rebasing/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/local/lib  -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib -dynamiclib -compatibility_version 1 -current_version 1.0.2 -Wl,-install_name -Wl,/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.dylib -shared -undefined dynamic_lookup slip_matrix_div.o slip_create_mpq_array.o SLIP_free.o SLIP_LU_factorize.o SLIP_realloc.o slip_matrix_mul.o slip_get_largest_pivot.o slip_ref_triangular_solve.o SLIP_backslash.o slip_create_mpz_array.o slip_get_nonzero_pivot.o SLIP_LU_solve.o slip_back_sub.o slip_cumsum.o slip_get_pivot.o SLIP_malloc.o slip_sparse_collapse.o SLIP_calloc.o slip_dfs.o slip_get_smallest_pivot.o SLIP_matrix_allocate.o slip_sparse_realloc.o slip_cast_array.o slip_expand_double_array.o SLIP_gmp.o SLIP_matrix_copy.o SLIP_matrix_check.o slip_cast_matrix.o slip_expand_mpfr_array.o SLIP_initialize.o SLIP_matrix_free.o slip_check_solution.o slip_expand_mpq_array.o SLIP_initialize_expert.o SLIP_matrix_nnz.o SLIP_create_default_options.o SLIP_finalize.o SLIP_LU_analysis_free.o slip_permute_x.o slip_permute_b.o slip_create_mpfr_array.o slip_forward_sub.o SLIP_LU_analyze.o slip_reach.o -o /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib -lm -rpath /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/inst/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib -lsuitesparseconfig -lamd -lcolamd -lm -lgmp -lmpfr
```

`DESTDIR` is used twice in the `-o`.

`DESTDIR` handling is coming from `build/pkgs/suitesparse/patches/03-buildflags.patch`

We upgrade to 5.12.0 and pick up a fresh set of patches from Debian or another distro


**CC:**  @kiwifb

**Branch:** [u/mkoeppe/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse6.0.1)

**Commit:** [424cb49cf28f1809d78014ea315bb4a301e4505e](https://github.com/sagemath/sagetrac-mirror/commit/424cb49cf28f1809d78014ea315bb4a301e4505e)

**Author:** François Bissey

**Status:** needs_work

**Dependencies:** #34746, #34835

Issue created by migration from https://trac.sagemath.org/ticket/34206





---

archive/issue_comments_650978.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/suitesparse__fix_destdir_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse__fix_destdir_bug)",
    "created_at": "2022-07-21T17:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650978",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/suitesparse__fix_destdir_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse__fix_destdir_bug)



---

archive/issue_events_100173.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "rename": {
        "from": "suitesparse: Fix DESTDIR bug",
        "to": "suitesparse: Update to 5.12.0, fix DESTDIR bug"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34206#event-100173"
}
```



---

archive/issue_comments_650979.json:
```json
{
    "body": "**Commit:** [abb01749d520003074d770d834328d88a4ba1b01](https://github.com/sagemath/sagetrac-mirror/commit/abb01749d520003074d770d834328d88a4ba1b01)",
    "created_at": "2022-07-21T17:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650979",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [abb01749d520003074d770d834328d88a4ba1b01](https://github.com/sagemath/sagetrac-mirror/commit/abb01749d520003074d770d834328d88a4ba1b01)



---

archive/issue_comments_650980.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bad180a32676aa37071f87d596c58ab94130e4e5\">bad180a</a></td><td><code>build/pkgs/suitesparse: Update to 5.12.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abb01749d520003074d770d834328d88a4ba1b01\">abb0174</a></td><td><code>build/pkgs/suitesparse: Add cmake dependency, activate components that need cmake</code></td></tr></table>\n",
    "created_at": "2022-07-21T17:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650980",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bad180a32676aa37071f87d596c58ab94130e4e5">bad180a</a></td><td><code>build/pkgs/suitesparse: Update to 5.12.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abb01749d520003074d770d834328d88a4ba1b01">abb0174</a></td><td><code>build/pkgs/suitesparse: Add cmake dependency, activate components that need cmake</code></td></tr></table>




---

archive/issue_comments_650981.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,3 +5,8 @@\n ```\n \n `DESTDIR` is used twice in the `-o`.\n+\n+`DESTDIR` handling is coming from `build/pkgs/suitesparse/patches/03-buildflags.patch`\n+\n+We upgrade to 5.12.0 and pick up a fresh set of patches from Debian or another distro\n+\n``````\n",
    "created_at": "2022-07-21T17:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650981",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,3 +5,8 @@
 ```
 
 `DESTDIR` is used twice in the `-o`.
+
+`DESTDIR` handling is coming from `build/pkgs/suitesparse/patches/03-buildflags.patch`
+
+We upgrade to 5.12.0 and pick up a fresh set of patches from Debian or another distro
+
``````




---

archive/issue_comments_650982.json:
```json
{
    "body": "<a id='comment:3'></a>\nhttps://github.com/DrTimothyAldenDavis/SuiteSparse/issues/86 - \"build system: Support staged installs via DESTDIR\"",
    "created_at": "2022-07-21T17:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650982",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
https://github.com/DrTimothyAldenDavis/SuiteSparse/issues/86 - "build system: Support staged installs via DESTDIR"



---

archive/issue_comments_650983.json:
```json
{
    "body": "<a id='comment:4'></a>\nMy original spkg was always a quick and dirty job. It shouldn't be a surprise that some bugs appear.",
    "created_at": "2022-07-21T21:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650983",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
My original spkg was always a quick and dirty job. It shouldn't be a surprise that some bugs appear.



---

archive/issue_events_100174.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34206#event-100174"
}
```



---

archive/issue_events_100175.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "rename": {
        "from": "suitesparse: Update to 5.12.0, fix DESTDIR bug",
        "to": "suitesparse: Update to 6.0.1, fix DESTDIR bug"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34206#event-100175"
}
```



---

archive/issue_comments_650984.json:
```json
{
    "body": "<a id='comment:7'></a>\nI guess I should have a stab at this.",
    "created_at": "2022-12-07T20:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650984",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I guess I should have a stab at this.



---

archive/issue_comments_650985.json:
```json
{
    "body": "<a id='comment:8'></a>\nWay too many things are built by default. We can split the package or at least not building the big stuff that we do not need like graphblas and mongoose which are very specialised stuff.",
    "created_at": "2022-12-07T20:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650985",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Way too many things are built by default. We can split the package or at least not building the big stuff that we do not need like graphblas and mongoose which are very specialised stuff.



---

archive/issue_comments_650986.json:
```json
{
    "body": "<a id='comment:9'></a>\nI think our optional `igraph` package uses graphblas",
    "created_at": "2022-12-07T20:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650986",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
I think our optional `igraph` package uses graphblas



---

archive/issue_comments_650987.json:
```json
{
    "body": "<a id='comment:10'></a>\nThat's new and graphblas wasn't built before because I had removed all the subpackages using cmake at the time the initial suitesparse was included in sage. But if it can be used, why not.\n\nIn other news, `DESTDIR` works properly in 6.0.1 after some basic testing.",
    "created_at": "2022-12-07T20:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650987",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
That's new and graphblas wasn't built before because I had removed all the subpackages using cmake at the time the initial suitesparse was included in sage. But if it can be used, why not.

In other news, `DESTDIR` works properly in 6.0.1 after some basic testing.



---

archive/issue_comments_650988.json:
```json
{
    "body": "<a id='comment:11'></a>\nCannot see a dependency on GraphBLAS in igraph but if you can point to it, I'll certainly include it.",
    "created_at": "2022-12-07T21:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650988",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Cannot see a dependency on GraphBLAS in igraph but if you can point to it, I'll certainly include it.



---

archive/issue_comments_650989.json:
```json
{
    "body": "<a id='comment:12'></a>\nI am testing a first draft locally. The changes are big enough that none of the current patches actually apply or are meaningful. I will need your input for any tweaks you require for BLAS/LAPACK on OS X. It should be easy enough to figure out if something is needed.",
    "created_at": "2022-12-07T21:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650989",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
I am testing a first draft locally. The changes are big enough that none of the current patches actually apply or are meaningful. I will need your input for any tweaks you require for BLAS/LAPACK on OS X. It should be easy enough to figure out if something is needed.



---

archive/issue_comments_650990.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [Fran\u00e7ois Bissey](#comment%3A11):\n> Cannot see a dependency on GraphBLAS in igraph but if you can point to it, I'll certainly include it.\n\n\nSorry for the noise - looks like I misremembered",
    "created_at": "2022-12-07T22:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650990",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Replying to [François Bissey](#comment%3A11):
> Cannot see a dependency on GraphBLAS in igraph but if you can point to it, I'll certainly include it.


Sorry for the noise - looks like I misremembered



---

archive/issue_comments_650991.json:
```json
{
    "body": "<a id='comment:14'></a>\nDo we want to build and install static libraries?",
    "created_at": "2022-12-07T22:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650991",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
Do we want to build and install static libraries?



---

archive/issue_comments_650992.json:
```json
{
    "body": "<a id='comment:15'></a>\nNo, only shared",
    "created_at": "2022-12-07T22:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650992",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
No, only shared



---

archive/issue_comments_650993.json:
```json
{
    "body": "**Changing commit** from \"[abb01749d520003074d770d834328d88a4ba1b01](https://github.com/sagemath/sagetrac-mirror/commit/abb01749d520003074d770d834328d88a4ba1b01)\" to \"\".",
    "created_at": "2022-12-07T22:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650993",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[abb01749d520003074d770d834328d88a4ba1b01](https://github.com/sagemath/sagetrac-mirror/commit/abb01749d520003074d770d834328d88a4ba1b01)" to "".



---

archive/issue_comments_650994.json:
```json
{
    "body": "<a id='comment:16'></a>\nReady for inspection.",
    "created_at": "2022-12-07T22:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650994",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Ready for inspection.



---

archive/issue_comments_650995.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-12-07T22:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650995",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_650996.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/suitesparse__fix_destdir_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse__fix_destdir_bug)\" to \"[u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitsparse6.0.1)\".",
    "created_at": "2022-12-07T22:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650996",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/mkoeppe/suitesparse__fix_destdir_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse__fix_destdir_bug)" to "[u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitsparse6.0.1)".



---

archive/issue_comments_650997.json:
```json
{
    "body": "**Author:** Fran\u00e7ois Bissey",
    "created_at": "2022-12-07T22:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650997",
    "user": "https://github.com/kiwifb"
}
```

**Author:** François Bissey



---

archive/issue_comments_650998.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitsparse6.0.1)\" to \"[trac/u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/trac/u/fbissey/suitsparse6.0.1)\".",
    "created_at": "2022-12-07T22:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650998",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitsparse6.0.1)" to "[trac/u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/trac/u/fbissey/suitsparse6.0.1)".



---

archive/issue_comments_650999.json:
```json
{
    "body": "**Changing branch** from \"[trac/u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/trac/u/fbissey/suitsparse6.0.1)\" to \"[u/fbissey/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitesparse6.0.1)\".",
    "created_at": "2022-12-07T22:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-650999",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[trac/u/fbissey/suitsparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/trac/u/fbissey/suitsparse6.0.1)" to "[u/fbissey/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitesparse6.0.1)".



---

archive/issue_comments_651000.json:
```json
{
    "body": "<a id='comment:18'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57fc6072e842b41ddfe31a362866d6a29c0c3b00\">57fc607</a></td><td><code>First draft of upgrade to suitesparse 6.0.1</code></td></tr></table>\n",
    "created_at": "2022-12-07T22:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651000",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57fc6072e842b41ddfe31a362866d6a29c0c3b00">57fc607</a></td><td><code>First draft of upgrade to suitesparse 6.0.1</code></td></tr></table>




---

archive/issue_comments_651001.json:
```json
{
    "body": "**Commit:** [57fc6072e842b41ddfe31a362866d6a29c0c3b00](https://github.com/sagemath/sagetrac-mirror/commit/57fc6072e842b41ddfe31a362866d6a29c0c3b00)",
    "created_at": "2022-12-07T22:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651001",
    "user": "https://github.com/kiwifb"
}
```

**Commit:** [57fc6072e842b41ddfe31a362866d6a29c0c3b00](https://github.com/sagemath/sagetrac-mirror/commit/57fc6072e842b41ddfe31a362866d6a29c0c3b00)



---

archive/issue_comments_651002.json:
```json
{
    "body": "<a id='comment:19'></a>\nOK got the right branch name this time.",
    "created_at": "2022-12-07T22:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651002",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
OK got the right branch name this time.



---

archive/issue_comments_651003.json:
```json
{
    "body": "<a id='comment:20'></a>\nBuilds OK on macOS",
    "created_at": "2022-12-09T19:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651003",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Builds OK on macOS



---

archive/issue_comments_651004.json:
```json
{
    "body": "<a id='comment:21'></a>\nHowever it builds against the Accelerate framework, not our openblas:\n\n```\n otool -L local/lib/libumfpack.dylib                                                                                                         git:t/34206/suitesparse6.0.1\nlocal/lib/libumfpack.dylib:\n        @rpath/libumfpack.6.dylib (compatibility version 6.0.0, current version 6.0.1)\n        @rpath/libsuitesparseconfig.6.dylib (compatibility version 6.0.0, current version 6.0.1)\n        /usr/local/opt/libomp/lib/libomp.dylib (compatibility version 5.0.0, current version 5.0.0)\n        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1311.100.3)\n        @rpath/libamd.3.dylib (compatibility version 3.0.0, current version 3.0.0)\n        /System/Library/Frameworks/Accelerate.framework/Versions/A/Accelerate (compatibility version 1.0.0, current version 4.0.0)\n        @rpath/libcholmod.4.dylib (compatibility version 4.0.0, current version 4.0.1)\n```",
    "created_at": "2022-12-09T19:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651004",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
However it builds against the Accelerate framework, not our openblas:

```
 otool -L local/lib/libumfpack.dylib                                                                                                         git:t/34206/suitesparse6.0.1
local/lib/libumfpack.dylib:
        @rpath/libumfpack.6.dylib (compatibility version 6.0.0, current version 6.0.1)
        @rpath/libsuitesparseconfig.6.dylib (compatibility version 6.0.0, current version 6.0.1)
        /usr/local/opt/libomp/lib/libomp.dylib (compatibility version 5.0.0, current version 5.0.0)
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1311.100.3)
        @rpath/libamd.3.dylib (compatibility version 3.0.0, current version 3.0.0)
        /System/Library/Frameworks/Accelerate.framework/Versions/A/Accelerate (compatibility version 1.0.0, current version 4.0.0)
        @rpath/libcholmod.4.dylib (compatibility version 4.0.0, current version 4.0.1)
```



---

archive/issue_comments_651005.json:
```json
{
    "body": "<a id='comment:22'></a>\nThat's what I thought could happen. I think, I can make it go for openblas easily, I found the doc for it, the other day.\n\nThis is also a relatively stripped down build like boost_cropped. I probably should add a few more sub-packages if we want to really dignify it with the full \"suitesparse\" name. And I also should write a few comments.",
    "created_at": "2022-12-09T22:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651005",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
That's what I thought could happen. I think, I can make it go for openblas easily, I found the doc for it, the other day.

This is also a relatively stripped down build like boost_cropped. I probably should add a few more sub-packages if we want to really dignify it with the full "suitesparse" name. And I also should write a few comments.



---

archive/issue_comments_651006.json:
```json
{
    "body": "<a id='comment:23'></a>\nAnd upstream is preparing 6.0.2. But the bump would be trivial on this branch.",
    "created_at": "2022-12-09T22:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651006",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
And upstream is preparing 6.0.2. But the bump would be trivial on this branch.



---

archive/issue_comments_651007.json:
```json
{
    "body": "**Changing commit** from \"[57fc6072e842b41ddfe31a362866d6a29c0c3b00](https://github.com/sagemath/sagetrac-mirror/commit/57fc6072e842b41ddfe31a362866d6a29c0c3b00)\" to \"[8b32e705554a781168f75997c3274429603b17fc](https://github.com/sagemath/sagetrac-mirror/commit/8b32e705554a781168f75997c3274429603b17fc)\".",
    "created_at": "2022-12-09T22:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[57fc6072e842b41ddfe31a362866d6a29c0c3b00](https://github.com/sagemath/sagetrac-mirror/commit/57fc6072e842b41ddfe31a362866d6a29c0c3b00)" to "[8b32e705554a781168f75997c3274429603b17fc](https://github.com/sagemath/sagetrac-mirror/commit/8b32e705554a781168f75997c3274429603b17fc)".



---

archive/issue_comments_651008.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b32e705554a781168f75997c3274429603b17fc\">8b32e70</a></td><td><code>Enforce the use of openblas. Add comments.</code></td></tr></table>\n",
    "created_at": "2022-12-09T22:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b32e705554a781168f75997c3274429603b17fc">8b32e70</a></td><td><code>Enforce the use of openblas. Add comments.</code></td></tr></table>




---

archive/issue_comments_651009.json:
```json
{
    "body": "<a id='comment:25'></a>\nThis gets openblas but not the right one on my macOS system.\n\n```\n[suitesparse-6.0.1] -- BLAS libraries:      /opt/local/lib/libopenblas.dylib \n[suitesparse-6.0.1] -- BLAS linker flags:    \n[suitesparse-6.0.1] -- LAPACK libraries:    /opt/local/lib/libopenblas.dylib;/opt/local/lib/libopenblas.dylib \n[suitesparse-6.0.1] -- LAPACK linker flags:  \n```",
    "created_at": "2022-12-10T00:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651009",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
This gets openblas but not the right one on my macOS system.

```
[suitesparse-6.0.1] -- BLAS libraries:      /opt/local/lib/libopenblas.dylib 
[suitesparse-6.0.1] -- BLAS linker flags:    
[suitesparse-6.0.1] -- LAPACK libraries:    /opt/local/lib/libopenblas.dylib;/opt/local/lib/libopenblas.dylib 
[suitesparse-6.0.1] -- LAPACK linker flags:  
```



---

archive/issue_comments_651010.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe following change fixes it for me:\n\n```\ndiff --git a/build/pkgs/suitesparse/spkg-build.in b/build/pkgs/suitesparse/spkg-build.in\nindex b137a5ecb9..822519b078 100644\n--- a/build/pkgs/suitesparse/spkg-build.in\n+++ b/build/pkgs/suitesparse/spkg-build.in\n@@ -11,7 +11,10 @@ for pkg in ${pkg_list}; do\n \t# Enforce usage of OpenBlas\n \t# No static libraries\n \t# Verbose builds\n-\tsdh_cmake -DBLA_VENDOR=OpenBLAS -DNSTATIC=ON -DCMAKE_VERBOSE_MAKEFILE=1 ..\n+\tsdh_cmake -DBLA_VENDOR=OpenBLAS \\\n+                  -DBLAS_LIBRARIES=\"$(pkg-config --libs blas)\" \\\n+                  -DLAPACK_LIBRARIES=\"$(pkg-config --libs lapack)\" \\\n+                  -DNSTATIC=ON -DCMAKE_VERBOSE_MAKEFILE=1 ..\n \t# Build\n \tsdh_make\n \tpopd\n```",
    "created_at": "2022-12-10T00:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651010",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
The following change fixes it for me:

```
diff --git a/build/pkgs/suitesparse/spkg-build.in b/build/pkgs/suitesparse/spkg-build.in
index b137a5ecb9..822519b078 100644
--- a/build/pkgs/suitesparse/spkg-build.in
+++ b/build/pkgs/suitesparse/spkg-build.in
@@ -11,7 +11,10 @@ for pkg in ${pkg_list}; do
 	# Enforce usage of OpenBlas
 	# No static libraries
 	# Verbose builds
-	sdh_cmake -DBLA_VENDOR=OpenBLAS -DNSTATIC=ON -DCMAKE_VERBOSE_MAKEFILE=1 ..
+	sdh_cmake -DBLA_VENDOR=OpenBLAS \
+                  -DBLAS_LIBRARIES="$(pkg-config --libs blas)" \
+                  -DLAPACK_LIBRARIES="$(pkg-config --libs lapack)" \
+                  -DNSTATIC=ON -DCMAKE_VERBOSE_MAKEFILE=1 ..
 	# Build
 	sdh_make
 	popd
```



---

archive/issue_comments_651011.json:
```json
{
    "body": "<a id='comment:27'></a>\nYes, system wide would be picked up first without a hint. Pushing shortly.",
    "created_at": "2022-12-10T01:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651011",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
Yes, system wide would be picked up first without a hint. Pushing shortly.



---

archive/issue_comments_651012.json:
```json
{
    "body": "**Changing commit** from \"[8b32e705554a781168f75997c3274429603b17fc](https://github.com/sagemath/sagetrac-mirror/commit/8b32e705554a781168f75997c3274429603b17fc)\" to \"[b80a67228c56671c937d4963c50670bf1743c4e7](https://github.com/sagemath/sagetrac-mirror/commit/b80a67228c56671c937d4963c50670bf1743c4e7)\".",
    "created_at": "2022-12-10T01:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8b32e705554a781168f75997c3274429603b17fc](https://github.com/sagemath/sagetrac-mirror/commit/8b32e705554a781168f75997c3274429603b17fc)" to "[b80a67228c56671c937d4963c50670bf1743c4e7](https://github.com/sagemath/sagetrac-mirror/commit/b80a67228c56671c937d4963c50670bf1743c4e7)".



---

archive/issue_comments_651013.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b80a67228c56671c937d4963c50670bf1743c4e7\">b80a672</a></td><td><code>Add hint to locate openblas used by sage</code></td></tr></table>\n",
    "created_at": "2022-12-10T01:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b80a67228c56671c937d4963c50670bf1743c4e7">b80a672</a></td><td><code>Add hint to locate openblas used by sage</code></td></tr></table>




---

archive/issue_comments_651014.json:
```json
{
    "body": "<a id='comment:29'></a>\nFailing on `centos-stream-9-python3.9-standard` (https://github.com/mkoeppe/sage/actions/runs/3662737597/jobs/6192051075)\n\n```\nCMake Error at CMakeLists.txt:14 (cmake_minimum_required):\n  CMake 3.22 or higher is required.  You are running version 3.20.2\n```\nThis will need an increased lower bound for system cmake - increased from #34746, which set 3.11)",
    "created_at": "2022-12-11T00:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651014",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Failing on `centos-stream-9-python3.9-standard` (https://github.com/mkoeppe/sage/actions/runs/3662737597/jobs/6192051075)

```
CMake Error at CMakeLists.txt:14 (cmake_minimum_required):
  CMake 3.22 or higher is required.  You are running version 3.20.2
```
This will need an increased lower bound for system cmake - increased from #34746, which set 3.11)



---

archive/issue_comments_651015.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2022-12-11T00:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651015",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_651016.json:
```json
{
    "body": "**Dependencies:** #34746",
    "created_at": "2022-12-11T00:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651016",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #34746



---

archive/issue_comments_651017.json:
```json
{
    "body": "<a id='comment:30'></a>\nOn `debian-sid-minimal` (https://github.com/mkoeppe/sage/actions/runs/3662737597/jobs/6200588473):\n\n```\n[suitesparse-6.0.1]   /sage/local/var/tmp/sage/build/suitesparse-6.0.1/src/SuiteSparse_config/SuiteSparse_config.h:643:65: error: expected ')' before ',' token\n  [suitesparse-6.0.1]     643 |     #define SUITESPARSE_BLAS(name,NAME) SUITESPARSE_FORTRAN(name,NAME)\n  [suitesparse-6.0.1]         |                                                                 ^\n  [suitesparse-6.0.1]   /sage/local/var/tmp/sage/build/suitesparse-6.0.1/src/SuiteSparse_config/SuiteSparse_config.h:676:37: note: in expansion of macro 'SUITESPARSE_BLAS'\n  [suitesparse-6.0.1]     676 | #define SUITESPARSE_LAPACK_ZLARF    SUITESPARSE_BLAS ( zlarf  , ZLAR   )\n  [suitesparse-6.0.1]         |                                     ^~~~~~~~~~~~~~~~\n  [suitesparse-6.0.1]   /sage/local/var/tmp/sage/build/suitesparse-6.0.1/src/SuiteSparse_config/SuiteSparse_config.h:1434:6: note: in expansion of macro 'SUITESPARSE_LAPACK_ZLARF'\n  [suitesparse-6.0.1]    1434 | void SUITESPARSE_LAPACK_ZLARF       // apply Householder reflector\n  [suitesparse-6.0.1]         |      ^~~~~~~~~~~~~~~~~~~~~~~~\n  [suitesparse-6.0.1]   make[5]: *** [CMakeFiles/cholmod.dir/build.make:1465: CMakeFiles/cholmod.dir/Supernodal/cholmod_super_solve.c.o] Error 1\n  [suitesparse-6.0.1]   make[5]: *** [CMakeFiles/cholmod.dir/build.make:1479: CMakeFiles/cholmod.dir/Supernodal/cholmod_super_symbolic.c.o] Error 1\n  [suitesparse-6.0.1]   make[5]: Target 'CMakeFiles/cholmod.dir/build' not remade because of errors.\n```",
    "created_at": "2022-12-11T09:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651017",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
On `debian-sid-minimal` (https://github.com/mkoeppe/sage/actions/runs/3662737597/jobs/6200588473):

```
[suitesparse-6.0.1]   /sage/local/var/tmp/sage/build/suitesparse-6.0.1/src/SuiteSparse_config/SuiteSparse_config.h:643:65: error: expected ')' before ',' token
  [suitesparse-6.0.1]     643 |     #define SUITESPARSE_BLAS(name,NAME) SUITESPARSE_FORTRAN(name,NAME)
  [suitesparse-6.0.1]         |                                                                 ^
  [suitesparse-6.0.1]   /sage/local/var/tmp/sage/build/suitesparse-6.0.1/src/SuiteSparse_config/SuiteSparse_config.h:676:37: note: in expansion of macro 'SUITESPARSE_BLAS'
  [suitesparse-6.0.1]     676 | #define SUITESPARSE_LAPACK_ZLARF    SUITESPARSE_BLAS ( zlarf  , ZLAR   )
  [suitesparse-6.0.1]         |                                     ^~~~~~~~~~~~~~~~
  [suitesparse-6.0.1]   /sage/local/var/tmp/sage/build/suitesparse-6.0.1/src/SuiteSparse_config/SuiteSparse_config.h:1434:6: note: in expansion of macro 'SUITESPARSE_LAPACK_ZLARF'
  [suitesparse-6.0.1]    1434 | void SUITESPARSE_LAPACK_ZLARF       // apply Householder reflector
  [suitesparse-6.0.1]         |      ^~~~~~~~~~~~~~~~~~~~~~~~
  [suitesparse-6.0.1]   make[5]: *** [CMakeFiles/cholmod.dir/build.make:1465: CMakeFiles/cholmod.dir/Supernodal/cholmod_super_solve.c.o] Error 1
  [suitesparse-6.0.1]   make[5]: *** [CMakeFiles/cholmod.dir/build.make:1479: CMakeFiles/cholmod.dir/Supernodal/cholmod_super_symbolic.c.o] Error 1
  [suitesparse-6.0.1]   make[5]: Target 'CMakeFiles/cholmod.dir/build' not remade because of errors.
```



---

archive/issue_comments_651018.json:
```json
{
    "body": "<a id='comment:31'></a>\nCan't seem to see the log from that run. What compiler is sid currently using?",
    "created_at": "2022-12-11T10:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651018",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>
Can't seem to see the log from that run. What compiler is sid currently using?



---

archive/issue_comments_651019.json:
```json
{
    "body": "<a id='comment:32'></a>\nThat's gcc 12.2.0-9.1",
    "created_at": "2022-12-11T18:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651019",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
That's gcc 12.2.0-9.1



---

archive/issue_comments_651020.json:
```json
{
    "body": "<a id='comment:33'></a>\nSame on `debian-bookworm-minimal` (https://github.com/mkoeppe/sage/actions/runs/3662737597/jobs/6200588437, `docker run -it  ghcr.io/mkoeppe/sage/sage-docker-debian-bookworm-minimal-with-targets-pre:9.5-107209-g31c5448dc1-failed bash`)\nand on `ubuntu-kinetic-minimal` and `fedora-36-minimal`",
    "created_at": "2022-12-11T19:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651020",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Same on `debian-bookworm-minimal` (https://github.com/mkoeppe/sage/actions/runs/3662737597/jobs/6200588437, `docker run -it  ghcr.io/mkoeppe/sage/sage-docker-debian-bookworm-minimal-with-targets-pre:9.5-107209-g31c5448dc1-failed bash`)
and on `ubuntu-kinetic-minimal` and `fedora-36-minimal`



---

archive/issue_comments_651021.json:
```json
{
    "body": "<a id='comment:34'></a>\nI wonder if it has to do with \n\n```\n-- Detecting Fortran/C Interface\nFailed to compile\n```\nWhen cmake is run to configure cholmod. It looks like we are trying to mix C and Fortran and it is failing.",
    "created_at": "2022-12-11T21:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651021",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
I wonder if it has to do with 

```
-- Detecting Fortran/C Interface
Failed to compile
```
When cmake is run to configure cholmod. It looks like we are trying to mix C and Fortran and it is failing.



---

archive/issue_comments_651022.json:
```json
{
    "body": "<a id='comment:35'></a>\nWhile it is annoying, we could turn off the bits needing blas/lapack which seem to be the one involved here. But really I suspect there is something fishy in the compiler.",
    "created_at": "2022-12-11T21:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651022",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:35'></a>
While it is annoying, we could turn off the bits needing blas/lapack which seem to be the one involved here. But really I suspect there is something fishy in the compiler.



---

archive/issue_comments_651023.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a3f584fe023b69794704e064475784b55419662\">7a3f584</a></td><td><code>Merge branch 'develop' into suitesparse6.0.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/552fd83a941d86471952ee1f220c7b1b19c9595e\">552fd83</a></td><td><code>Turn off suprenodal for cholmod to see if c/fortran mixing is causing failures on some debian instances.</code></td></tr></table>\n",
    "created_at": "2022-12-11T22:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651023",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a3f584fe023b69794704e064475784b55419662">7a3f584</a></td><td><code>Merge branch 'develop' into suitesparse6.0.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/552fd83a941d86471952ee1f220c7b1b19c9595e">552fd83</a></td><td><code>Turn off suprenodal for cholmod to see if c/fortran mixing is causing failures on some debian instances.</code></td></tr></table>




---

archive/issue_comments_651024.json:
```json
{
    "body": "**Changing commit** from \"[b80a67228c56671c937d4963c50670bf1743c4e7](https://github.com/sagemath/sagetrac-mirror/commit/b80a67228c56671c937d4963c50670bf1743c4e7)\" to \"[552fd83a941d86471952ee1f220c7b1b19c9595e](https://github.com/sagemath/sagetrac-mirror/commit/552fd83a941d86471952ee1f220c7b1b19c9595e)\".",
    "created_at": "2022-12-11T22:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b80a67228c56671c937d4963c50670bf1743c4e7](https://github.com/sagemath/sagetrac-mirror/commit/b80a67228c56671c937d4963c50670bf1743c4e7)" to "[552fd83a941d86471952ee1f220c7b1b19c9595e](https://github.com/sagemath/sagetrac-mirror/commit/552fd83a941d86471952ee1f220c7b1b19c9595e)".



---

archive/issue_comments_651025.json:
```json
{
    "body": "<a id='comment:37'></a>\n`tox -e docker-debian-bookworm-minimal-incremental -- suitesparse` gives the same errors",
    "created_at": "2022-12-12T00:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651025",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
`tox -e docker-debian-bookworm-minimal-incremental -- suitesparse` gives the same errors



---

archive/issue_comments_651026.json:
```json
{
    "body": "<a id='comment:38'></a>\nI am running out of ideas on what can cause this. Some compiler setting is the most obvious culprit, but what would it be. Can you get access to the docker instance to fish stuff out of it?",
    "created_at": "2022-12-12T00:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651026",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'></a>
I am running out of ideas on what can cause this. Some compiler setting is the most obvious culprit, but what would it be. Can you get access to the docker instance to fish stuff out of it?



---

archive/issue_comments_651027.json:
```json
{
    "body": "<a id='comment:39'></a>\n6.0.2 is just out, so I will bump that and we will see if it helps.",
    "created_at": "2022-12-12T02:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651027",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
6.0.2 is just out, so I will bump that and we will see if it helps.



---

archive/issue_comments_651028.json:
```json
{
    "body": "<a id='comment:40'></a>\nI've set up a separate GH Actions test at https://github.com/mkoeppe/SuiteSparse/actions/runs/3672968344",
    "created_at": "2022-12-12T03:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651028",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
I've set up a separate GH Actions test at https://github.com/mkoeppe/SuiteSparse/actions/runs/3672968344



---

archive/issue_comments_651029.json:
```json
{
    "body": "<a id='comment:41'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e7881dce8ba55e2ff0065c506c31b94ea33fd3a\">2e7881d</a></td><td><code>move suitesparse to 6.0.2</code></td></tr></table>\n",
    "created_at": "2022-12-12T03:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e7881dce8ba55e2ff0065c506c31b94ea33fd3a">2e7881d</a></td><td><code>move suitesparse to 6.0.2</code></td></tr></table>




---

archive/issue_comments_651030.json:
```json
{
    "body": "**Changing commit** from \"[552fd83a941d86471952ee1f220c7b1b19c9595e](https://github.com/sagemath/sagetrac-mirror/commit/552fd83a941d86471952ee1f220c7b1b19c9595e)\" to \"[2e7881dce8ba55e2ff0065c506c31b94ea33fd3a](https://github.com/sagemath/sagetrac-mirror/commit/2e7881dce8ba55e2ff0065c506c31b94ea33fd3a)\".",
    "created_at": "2022-12-12T03:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[552fd83a941d86471952ee1f220c7b1b19c9595e](https://github.com/sagemath/sagetrac-mirror/commit/552fd83a941d86471952ee1f220c7b1b19c9595e)" to "[2e7881dce8ba55e2ff0065c506c31b94ea33fd3a](https://github.com/sagemath/sagetrac-mirror/commit/2e7881dce8ba55e2ff0065c506c31b94ea33fd3a)".



---

archive/issue_comments_651031.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitesparse6.0.1)\" to \"[u/mkoeppe/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse6.0.1)\".",
    "created_at": "2022-12-12T05:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651031",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/fbissey/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/suitesparse6.0.1)" to "[u/mkoeppe/suitesparse6.0.1](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/suitesparse6.0.1)".



---

archive/issue_comments_651032.json:
```json
{
    "body": "**Changing commit** from \"[2e7881dce8ba55e2ff0065c506c31b94ea33fd3a](https://github.com/sagemath/sagetrac-mirror/commit/2e7881dce8ba55e2ff0065c506c31b94ea33fd3a)\" to \"[6f4032e5d6392028e540fe67f9a91a75e5e93b4c](https://github.com/sagemath/sagetrac-mirror/commit/6f4032e5d6392028e540fe67f9a91a75e5e93b4c)\".",
    "created_at": "2022-12-12T05:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651032",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[2e7881dce8ba55e2ff0065c506c31b94ea33fd3a](https://github.com/sagemath/sagetrac-mirror/commit/2e7881dce8ba55e2ff0065c506c31b94ea33fd3a)" to "[6f4032e5d6392028e540fe67f9a91a75e5e93b4c](https://github.com/sagemath/sagetrac-mirror/commit/6f4032e5d6392028e540fe67f9a91a75e5e93b4c)".



---

archive/issue_comments_651033.json:
```json
{
    "body": "<a id='comment:43'></a>\npushed this commit to address [comment:29](#comment%3A29)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f4032e5d6392028e540fe67f9a91a75e5e93b4c\">6f4032e</a></td><td><code>build/pkgs/cmake/spkg-configure.m4: Require version >= 3.22</code></td></tr></table>\n",
    "created_at": "2022-12-12T05:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651033",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
pushed this commit to address [comment:29](#comment%3A29)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f4032e5d6392028e540fe67f9a91a75e5e93b4c">6f4032e</a></td><td><code>build/pkgs/cmake/spkg-configure.m4: Require version >= 3.22</code></td></tr></table>




---

archive/issue_comments_651034.json:
```json
{
    "body": "<a id='comment:44'></a>\nForgot about doing that thanks.",
    "created_at": "2022-12-12T06:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651034",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
Forgot about doing that thanks.



---

archive/issue_comments_651035.json:
```json
{
    "body": "<a id='comment:45'></a>\nAdding #34835 as it will make the test builds quicker",
    "created_at": "2022-12-12T07:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651035",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Adding #34835 as it will make the test builds quicker



---

archive/issue_comments_651036.json:
```json
{
    "body": "**Changing dependencies** from \"#34746\" to \"#34746, #34835\".",
    "created_at": "2022-12-12T07:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651036",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#34746" to "#34746, #34835".



---

archive/issue_comments_651037.json:
```json
{
    "body": "**Changing commit** from \"[6f4032e5d6392028e540fe67f9a91a75e5e93b4c](https://github.com/sagemath/sagetrac-mirror/commit/6f4032e5d6392028e540fe67f9a91a75e5e93b4c)\" to \"[41d66d58e704dec0b258ef66b0fe293b6e0eaed5](https://github.com/sagemath/sagetrac-mirror/commit/41d66d58e704dec0b258ef66b0fe293b6e0eaed5)\".",
    "created_at": "2022-12-12T07:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6f4032e5d6392028e540fe67f9a91a75e5e93b4c](https://github.com/sagemath/sagetrac-mirror/commit/6f4032e5d6392028e540fe67f9a91a75e5e93b4c)" to "[41d66d58e704dec0b258ef66b0fe293b6e0eaed5](https://github.com/sagemath/sagetrac-mirror/commit/41d66d58e704dec0b258ef66b0fe293b6e0eaed5)".



---

archive/issue_comments_651038.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6bb8e6bae03cb7760ccf5674a08cbc59d7e25fd\">e6bb8e6</a></td><td><code>build/pkgs/openblas/dependencies: Remove python</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41d66d58e704dec0b258ef66b0fe293b6e0eaed5\">41d66d5</a></td><td><code>Merge #34835</code></td></tr></table>\n",
    "created_at": "2022-12-12T07:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6bb8e6bae03cb7760ccf5674a08cbc59d7e25fd">e6bb8e6</a></td><td><code>build/pkgs/openblas/dependencies: Remove python</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41d66d58e704dec0b258ef66b0fe293b6e0eaed5">41d66d5</a></td><td><code>Merge #34835</code></td></tr></table>




---

archive/issue_comments_651039.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [Fran\u00e7ois Bissey](#comment%3A34):\n> I wonder if it has to do with \n> \n> ```\n> -- Detecting Fortran/C Interface\n> Failed to compile\n> ```\n> When cmake is run to configure cholmod. It looks like we are trying to mix C and Fortran and it is failing.\n\n\nYes, I think that's the problem",
    "created_at": "2022-12-12T08:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651039",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
Replying to [François Bissey](#comment%3A34):
> I wonder if it has to do with 
> 
> ```
> -- Detecting Fortran/C Interface
> Failed to compile
> ```
> When cmake is run to configure cholmod. It looks like we are trying to mix C and Fortran and it is failing.


Yes, I think that's the problem



---

archive/issue_comments_651040.json:
```json
{
    "body": "<a id='comment:48'></a>\nThe only thing I can think about is that openblas was compiled with a different gfortran but it feels far fetched.",
    "created_at": "2022-12-12T08:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651040",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:48'></a>
The only thing I can think about is that openblas was compiled with a different gfortran but it feels far fetched.



---

archive/issue_comments_651041.json:
```json
{
    "body": "<a id='comment:49'></a>\nIn one of the failing builds, I see the following in `SuiteSparse_config/build/CMakeFiles/CMakeError.log`:\n\n```\n[100%] Linking Fortran executable FortranCInterface\nlto1: internal compiler error: compiler does not support ZSTD LTO compression\n0x9c311c lto_end_uncompression(lto_compression_stream*, lto_compression)\n\t../../src/gcc/lto-compress.cc:411\n0x9c1910 lto_get_section_data(lto_file_decl_data*, lto_section_type, char const*, int, unsigned long*, bool)\n\t../../src/gcc/lto-section-in.cc:168\n0x6929c5 lto_file_finalize\n\t../../src/gcc/lto/lto-common.cc:2264\n0x6929c5 lto_create_files_from_ids\n\t../../src/gcc/lto/lto-common.cc:2282\n0x6929c5 lto_file_read\n\t../../src/gcc/lto/lto-common.cc:2337\n0x6929c5 read_cgraph_and_symbols(unsigned int, char const**)\n\t../../src/gcc/lto/lto-common.cc:2785\n0x680312 lto_main()\n\t../../src/gcc/lto/lto.cc:626\nPlease submit a full bug report, with preprocessed source (by using -freport-bug).\nPlease include the complete backtrace with any bug report.\nSee <https://gcc.gnu.org/bugs/> for instructions.\nlto-wrapper: fatal error: /sage/local/bin/gfortran returned 1 exit status\ncompilation terminated.\n```",
    "created_at": "2022-12-12T08:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651041",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
In one of the failing builds, I see the following in `SuiteSparse_config/build/CMakeFiles/CMakeError.log`:

```
[100%] Linking Fortran executable FortranCInterface
lto1: internal compiler error: compiler does not support ZSTD LTO compression
0x9c311c lto_end_uncompression(lto_compression_stream*, lto_compression)
	../../src/gcc/lto-compress.cc:411
0x9c1910 lto_get_section_data(lto_file_decl_data*, lto_section_type, char const*, int, unsigned long*, bool)
	../../src/gcc/lto-section-in.cc:168
0x6929c5 lto_file_finalize
	../../src/gcc/lto/lto-common.cc:2264
0x6929c5 lto_create_files_from_ids
	../../src/gcc/lto/lto-common.cc:2282
0x6929c5 lto_file_read
	../../src/gcc/lto/lto-common.cc:2337
0x6929c5 read_cgraph_and_symbols(unsigned int, char const**)
	../../src/gcc/lto/lto-common.cc:2785
0x680312 lto_main()
	../../src/gcc/lto/lto.cc:626
Please submit a full bug report, with preprocessed source (by using -freport-bug).
Please include the complete backtrace with any bug report.
See <https://gcc.gnu.org/bugs/> for instructions.
lto-wrapper: fatal error: /sage/local/bin/gfortran returned 1 exit status
compilation terminated.
```



---

archive/issue_comments_651042.json:
```json
{
    "body": "<a id='comment:50'></a>\nIn the failing configurations, we are using system `gcc` but our own `gfortran`. This may be a mismatch between them regarding `zstd` support.",
    "created_at": "2022-12-12T08:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651042",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
In the failing configurations, we are using system `gcc` but our own `gfortran`. This may be a mismatch between them regarding `zstd` support.



---

archive/issue_comments_651043.json:
```json
{
    "body": "<a id='comment:51'></a>\nYes, it starts making much more sense.",
    "created_at": "2022-12-12T08:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651043",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:51'></a>
Yes, it starts making much more sense.



---

archive/issue_comments_651044.json:
```json
{
    "body": "<a id='comment:52'></a>\nBut there should be other similar failures potentially - at least you would think, since this is also tested in autoconf packages as soon blas/lapack is mixed with C code.",
    "created_at": "2022-12-12T08:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651044",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:52'></a>
But there should be other similar failures potentially - at least you would think, since this is also tested in autoconf packages as soon blas/lapack is mixed with C code.



---

archive/issue_comments_651045.json:
```json
{
    "body": "<a id='comment:53'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3544fedb43808ee39b1be6dec98d8ab35c390ca\">d3544fe</a></td><td><code>build/pkgs/zstd: New (gcc/gfortran dependency)</code></td></tr></table>\n",
    "created_at": "2022-12-12T08:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651045",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3544fedb43808ee39b1be6dec98d8ab35c390ca">d3544fe</a></td><td><code>build/pkgs/zstd: New (gcc/gfortran dependency)</code></td></tr></table>




---

archive/issue_comments_651046.json:
```json
{
    "body": "**Changing commit** from \"[41d66d58e704dec0b258ef66b0fe293b6e0eaed5](https://github.com/sagemath/sagetrac-mirror/commit/41d66d58e704dec0b258ef66b0fe293b6e0eaed5)\" to \"[d3544fedb43808ee39b1be6dec98d8ab35c390ca](https://github.com/sagemath/sagetrac-mirror/commit/d3544fedb43808ee39b1be6dec98d8ab35c390ca)\".",
    "created_at": "2022-12-12T08:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[41d66d58e704dec0b258ef66b0fe293b6e0eaed5](https://github.com/sagemath/sagetrac-mirror/commit/41d66d58e704dec0b258ef66b0fe293b6e0eaed5)" to "[d3544fedb43808ee39b1be6dec98d8ab35c390ca](https://github.com/sagemath/sagetrac-mirror/commit/d3544fedb43808ee39b1be6dec98d8ab35c390ca)".



---

archive/issue_comments_651047.json:
```json
{
    "body": "<a id='comment:54'></a>\nLet's try this",
    "created_at": "2022-12-12T08:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651047",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>
Let's try this



---

archive/issue_comments_651048.json:
```json
{
    "body": "<a id='comment:55'></a>\nIf it works, I'll have to re-enable \"supernodal\" in cholmod.",
    "created_at": "2022-12-12T08:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651048",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:55'></a>
If it works, I'll have to re-enable "supernodal" in cholmod.



---

archive/issue_comments_651049.json:
```json
{
    "body": "<a id='comment:56'></a>\nrunning at https://github.com/mkoeppe/SuiteSparse/actions/runs/3674049225",
    "created_at": "2022-12-12T08:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651049",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>
running at https://github.com/mkoeppe/SuiteSparse/actions/runs/3674049225



---

archive/issue_comments_651050.json:
```json
{
    "body": "**Changing commit** from \"[d3544fedb43808ee39b1be6dec98d8ab35c390ca](https://github.com/sagemath/sagetrac-mirror/commit/d3544fedb43808ee39b1be6dec98d8ab35c390ca)\" to \"[63c0139dc552f443560e6f6ccb499ce1d69631e8](https://github.com/sagemath/sagetrac-mirror/commit/63c0139dc552f443560e6f6ccb499ce1d69631e8)\".",
    "created_at": "2022-12-12T09:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d3544fedb43808ee39b1be6dec98d8ab35c390ca](https://github.com/sagemath/sagetrac-mirror/commit/d3544fedb43808ee39b1be6dec98d8ab35c390ca)" to "[63c0139dc552f443560e6f6ccb499ce1d69631e8](https://github.com/sagemath/sagetrac-mirror/commit/63c0139dc552f443560e6f6ccb499ce1d69631e8)".



---

archive/issue_comments_651051.json:
```json
{
    "body": "<a id='comment:57'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63c0139dc552f443560e6f6ccb499ce1d69631e8\">63c0139</a></td><td><code>build/pkgs/zstd: Only require zstd when gcc/gfortran are to be built</code></td></tr></table>\n",
    "created_at": "2022-12-12T09:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63c0139dc552f443560e6f6ccb499ce1d69631e8">63c0139</a></td><td><code>build/pkgs/zstd: Only require zstd when gcc/gfortran are to be built</code></td></tr></table>




---

archive/issue_comments_651052.json:
```json
{
    "body": "<a id='comment:58'></a>\nstill failing - https://github.com/mkoeppe/SuiteSparse/actions/runs/3674049225/jobs/6211825144",
    "created_at": "2022-12-12T09:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651052",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
still failing - https://github.com/mkoeppe/SuiteSparse/actions/runs/3674049225/jobs/6211825144



---

archive/issue_comments_651053.json:
```json
{
    "body": "<a id='comment:59'></a>\nin the failing build, gfortran still does not list zstd as a supported compression algorithm:\n\n```\n/sage/local/bin/gfortran -v\nUsing built-in specs.\nCOLLECT_GCC=/sage/local/bin/gfortran\nCOLLECT_LTO_WRAPPER=/sage/local/libexec/gcc/x86_64-pc-linux-gnu/12.2.0/lto-wrapper\nTarget: x86_64-pc-linux-gnu\nConfigured with: ../src/configure --prefix=/sage/local --with-local-prefix=/sage/local --with-system-zlib --without-isl --disable-multilib --disable-nls --disable-libitm --disable-bootstrap --enable-languages=fortran --disable-darwin-at-rpath   CXX=g++\nThread model: posix\nSupported LTO compression algorithms: zlib\ngcc version 12.2.0 (GCC) \n```",
    "created_at": "2022-12-12T09:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651053",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
in the failing build, gfortran still does not list zstd as a supported compression algorithm:

```
/sage/local/bin/gfortran -v
Using built-in specs.
COLLECT_GCC=/sage/local/bin/gfortran
COLLECT_LTO_WRAPPER=/sage/local/libexec/gcc/x86_64-pc-linux-gnu/12.2.0/lto-wrapper
Target: x86_64-pc-linux-gnu
Configured with: ../src/configure --prefix=/sage/local --with-local-prefix=/sage/local --with-system-zlib --without-isl --disable-multilib --disable-nls --disable-libitm --disable-bootstrap --enable-languages=fortran --disable-darwin-at-rpath   CXX=g++
Thread model: posix
Supported LTO compression algorithms: zlib
gcc version 12.2.0 (GCC) 
```



---

archive/issue_comments_651054.json:
```json
{
    "body": "<a id='comment:60'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/424cb49cf28f1809d78014ea315bb4a301e4505e\">424cb49</a></td><td><code>build/pkgs/zstd/spkg-install.in: Also install header</code></td></tr></table>\n",
    "created_at": "2022-12-12T09:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/424cb49cf28f1809d78014ea315bb4a301e4505e">424cb49</a></td><td><code>build/pkgs/zstd/spkg-install.in: Also install header</code></td></tr></table>




---

archive/issue_comments_651055.json:
```json
{
    "body": "**Changing commit** from \"[63c0139dc552f443560e6f6ccb499ce1d69631e8](https://github.com/sagemath/sagetrac-mirror/commit/63c0139dc552f443560e6f6ccb499ce1d69631e8)\" to \"[424cb49cf28f1809d78014ea315bb4a301e4505e](https://github.com/sagemath/sagetrac-mirror/commit/424cb49cf28f1809d78014ea315bb4a301e4505e)\".",
    "created_at": "2022-12-12T09:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651055",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[63c0139dc552f443560e6f6ccb499ce1d69631e8](https://github.com/sagemath/sagetrac-mirror/commit/63c0139dc552f443560e6f6ccb499ce1d69631e8)" to "[424cb49cf28f1809d78014ea315bb4a301e4505e](https://github.com/sagemath/sagetrac-mirror/commit/424cb49cf28f1809d78014ea315bb4a301e4505e)".



---

archive/issue_comments_651056.json:
```json
{
    "body": "<a id='comment:61'></a>\nIn gentoo we just seem to do `make -C lib install`. Although there is also a `make -C lib libzstd.pc` during the build phase.",
    "created_at": "2022-12-12T09:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651056",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:61'></a>
In gentoo we just seem to do `make -C lib install`. Although there is also a `make -C lib libzstd.pc` during the build phase.



---

archive/issue_comments_651057.json:
```json
{
    "body": "<a id='comment:62'></a>\nInstalling `zstd` may not be enough, you may have to tell gcc's configure to use it `--with-zstd`. But really, we want to match the support from the host gcc. So, it may be more complicated to achieve.",
    "created_at": "2022-12-12T09:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651057",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:62'></a>
Installing `zstd` may not be enough, you may have to tell gcc's configure to use it `--with-zstd`. But really, we want to match the support from the host gcc. So, it may be more complicated to achieve.



---

archive/issue_comments_651058.json:
```json
{
    "body": "<a id='comment:63'></a>\ngfortran is now configured correctly\n\n```\n# local/bin/gfortran -v\nUsing built-in specs.\nCOLLECT_GCC=local/bin/gfortran\nCOLLECT_LTO_WRAPPER=/sage/local/libexec/gcc/x86_64-pc-linux-gnu/12.2.0/lto-wrapper\nTarget: x86_64-pc-linux-gnu\nConfigured with: ../src/configure --prefix=/sage/local --with-local-prefix=/sage/local --with-system-zlib --without-isl --disable-multilib --disable-nls --disable-libitm --disable-bootstrap --enable-languages=fortran --disable-darwin-at-rpath   CXX=g++\nThread model: posix\nSupported LTO compression algorithms: zlib zstd\ngcc version 12.2.0 (GCC) \n```",
    "created_at": "2022-12-12T10:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651058",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>
gfortran is now configured correctly

```
# local/bin/gfortran -v
Using built-in specs.
COLLECT_GCC=local/bin/gfortran
COLLECT_LTO_WRAPPER=/sage/local/libexec/gcc/x86_64-pc-linux-gnu/12.2.0/lto-wrapper
Target: x86_64-pc-linux-gnu
Configured with: ../src/configure --prefix=/sage/local --with-local-prefix=/sage/local --with-system-zlib --without-isl --disable-multilib --disable-nls --disable-libitm --disable-bootstrap --enable-languages=fortran --disable-darwin-at-rpath   CXX=g++
Thread model: posix
Supported LTO compression algorithms: zlib zstd
gcc version 12.2.0 (GCC) 
```



---

archive/issue_comments_651059.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [Fran\u00e7ois Bissey](#comment%3A62):\n> we want to match the support from the host gcc. So, it may be more complicated to achieve.\n\n\nQuite possible that this is needed, yes",
    "created_at": "2022-12-12T10:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651059",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>
Replying to [François Bissey](#comment%3A62):
> we want to match the support from the host gcc. So, it may be more complicated to achieve.


Quite possible that this is needed, yes



---

archive/issue_comments_651060.json:
```json
{
    "body": "<a id='comment:65'></a>\nsuitesparse still fails to build.\n\ncomment:49 has changed - getting a different error now\n\n```\n# cat SuiteSparse_config/build/CMakeFiles/CMakeError.log\nmake[6]: Entering directory '/sage/local/var/tmp/sage/build/suitesparse-git/src/SuiteSparse_config/build/CMakeFiles/FortranCInterface'\nmake[6]: Leaving directory '/sage/local/var/tmp/sage/build/suitesparse-git/src/SuiteSparse_config/build/CMakeFiles/FortranCInterface'\nmake[6]: Entering directory '/sage/local/var/tmp/sage/build/suitesparse-git/src/SuiteSparse_config/build/CMakeFiles/FortranCInterface'\n[ 92%] Building Fortran object CMakeFiles/FortranCInterface.dir/main.F.o\n[ 94%] Building Fortran object CMakeFiles/FortranCInterface.dir/call_sub.f.o\n[ 97%] Building Fortran object CMakeFiles/FortranCInterface.dir/call_mod.f90.o\n[100%] Linking Fortran executable FortranCInterface\nlto1: internal compiler error: bytecode stream: expected tag LTO_function instead of LTO_eh_table\n0x9b4cc1 lto_tag_check\n\t../../src/gcc/lto-streamer.h:1028\n0x9b4cc1 input_function\n\t../../src/gcc/lto-streamer-in.cc:1361\n0x9b4cc1 lto_read_body_or_constructor\n\t../../src/gcc/lto-streamer-in.cc:1621\n0x7020ce cgraph_node::get_untransformed_body()\n\t../../src/gcc/cgraph.cc:4011\n0x70c48d cgraph_node::expand()\n\t../../src/gcc/cgraphunit.cc:1806\n0x70c48d cgraph_node::expand()\n\t../../src/gcc/cgraphunit.cc:1788\n0x70da4e expand_all_functions\n\t../../src/gcc/cgraphunit.cc:1999\n0x70da4e symbol_table::compile()\n\t../../src/gcc/cgraphunit.cc:2349\n0x680901 lto_main()\n\t../../src/gcc/lto/lto.cc:657\nPlease submit a full bug report, with preprocessed source (by using -freport-bug).\nPlease include the complete backtrace with any bug report.\nSee <https://gcc.gnu.org/bugs/> for instructions.\nmake[7]: *** [/tmp/ccL3cCy7.mk:2: /tmp/cc63Hwwl.ltrans0.ltrans.o] Error 1\n```",
    "created_at": "2022-12-12T10:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651060",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>
suitesparse still fails to build.

comment:49 has changed - getting a different error now

```
# cat SuiteSparse_config/build/CMakeFiles/CMakeError.log
make[6]: Entering directory '/sage/local/var/tmp/sage/build/suitesparse-git/src/SuiteSparse_config/build/CMakeFiles/FortranCInterface'
make[6]: Leaving directory '/sage/local/var/tmp/sage/build/suitesparse-git/src/SuiteSparse_config/build/CMakeFiles/FortranCInterface'
make[6]: Entering directory '/sage/local/var/tmp/sage/build/suitesparse-git/src/SuiteSparse_config/build/CMakeFiles/FortranCInterface'
[ 92%] Building Fortran object CMakeFiles/FortranCInterface.dir/main.F.o
[ 94%] Building Fortran object CMakeFiles/FortranCInterface.dir/call_sub.f.o
[ 97%] Building Fortran object CMakeFiles/FortranCInterface.dir/call_mod.f90.o
[100%] Linking Fortran executable FortranCInterface
lto1: internal compiler error: bytecode stream: expected tag LTO_function instead of LTO_eh_table
0x9b4cc1 lto_tag_check
	../../src/gcc/lto-streamer.h:1028
0x9b4cc1 input_function
	../../src/gcc/lto-streamer-in.cc:1361
0x9b4cc1 lto_read_body_or_constructor
	../../src/gcc/lto-streamer-in.cc:1621
0x7020ce cgraph_node::get_untransformed_body()
	../../src/gcc/cgraph.cc:4011
0x70c48d cgraph_node::expand()
	../../src/gcc/cgraphunit.cc:1806
0x70c48d cgraph_node::expand()
	../../src/gcc/cgraphunit.cc:1788
0x70da4e expand_all_functions
	../../src/gcc/cgraphunit.cc:1999
0x70da4e symbol_table::compile()
	../../src/gcc/cgraphunit.cc:2349
0x680901 lto_main()
	../../src/gcc/lto/lto.cc:657
Please submit a full bug report, with preprocessed source (by using -freport-bug).
Please include the complete backtrace with any bug report.
See <https://gcc.gnu.org/bugs/> for instructions.
make[7]: *** [/tmp/ccL3cCy7.mk:2: /tmp/cc63Hwwl.ltrans0.ltrans.o] Error 1
```



---

archive/issue_comments_651061.json:
```json
{
    "body": "<a id='comment:66'></a>\nThis will need more work on another day",
    "created_at": "2022-12-12T10:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651061",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
This will need more work on another day



---

archive/issue_comments_651062.json:
```json
{
    "body": "<a id='comment:68'></a>\nI have given it some thoughts. bookworm and sid are the only you report failing at this stage. It looks to me that they are both using gcc-12.2.0+patches - gentoo currently similarly ship gcc-12.2.1_pre20221210, some kind of pre-release. It seems it has incompatibilities with earlier gcc/gfortran releases, at least in debian. And our gcc/gfortran is an earlier and official release. I don't see a way out of this that doesn't forbid this version of the compiler unless there are both gcc and gfortran installed.",
    "created_at": "2022-12-14T19:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651062",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:68'></a>
I have given it some thoughts. bookworm and sid are the only you report failing at this stage. It looks to me that they are both using gcc-12.2.0+patches - gentoo currently similarly ship gcc-12.2.1_pre20221210, some kind of pre-release. It seems it has incompatibilities with earlier gcc/gfortran releases, at least in debian. And our gcc/gfortran is an earlier and official release. I don't see a way out of this that doesn't forbid this version of the compiler unless there are both gcc and gfortran installed.



---

archive/issue_comments_651063.json:
```json
{
    "body": "<a id='comment:69'></a>\nI agree, the Debian patches are likely the cause for the incompatibility. I think the LTO data comes with a version annotation, and Debian should probably have bumped the version along with their patches.\n\n(We also carry a patch, for macOS M1/M2 support, but I don't think it is the problem here.)",
    "created_at": "2022-12-14T20:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34206#issuecomment-651063",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>
I agree, the Debian patches are likely the cause for the incompatibility. I think the LTO data comes with a version annotation, and Debian should probably have bumped the version along with their patches.

(We also carry a patch, for macOS M1/M2 support, but I don't think it is the problem here.)
