# Issue 34199: latex_name of a symbol does not unpickle

archive/issues_033962.json:
```json
{
    "body": "As pointed out in [this sage-devel thread](https://groups.google.com/g/sage-devel/c/LX1wJVSaFYQ/m/L8Goa0loAgAJ), if you pickle a symbol that has a custom latex name, this latex name will not be reinstated when the symbol is unpickled in a different sagemath session:\n\n```\nsage: logr = SR.symbol('logr', domain='complex', latex_name=r'L_{x/x_0}')\n....: latex(logr)\nL_{x/x_0}\n\nsage: import pickle\n....: path_name = '/home/mark/'\n....: pickle_file_name = path_name + 'node.p'\n....: pickle_write = open(pickle_file_name, 'wb')\n....: pickle.dump(logr, pickle_write)\n....: pickle_write.close()\n\n[exit and restart Sage]\n\nsage: import pickle\n....: path_name = '/home/mark/'\n....: pickle_file_name = path_name + 'node.p'\n....: pickle_read = open(pickle_file_name, 'rb')\n....: some_expr = pickle.load(pickle_read)\n....: pickle_read.close()\n....: latex(some_expr)\n\\mathit{logr}\n```\n\nKeywords: symbolics, pickling, latex_name\n\nBranch: public/34199\n\nStatus: needs_work\n\nCommit: c1ef96cb27d4d4e196496b65598c8ff82a78f154\n\nIssue created by migration from https://trac.sagemath.org/ticket/34199\n\n",
    "created_at": "2022-07-19T04:02:16Z",
    "labels": [
        "component: pickling",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "latex_name of a symbol does not unpickle",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34199",
    "user": "https://github.com/DaveWitteMorris"
}
```
As pointed out in [this sage-devel thread](https://groups.google.com/g/sage-devel/c/LX1wJVSaFYQ/m/L8Goa0loAgAJ), if you pickle a symbol that has a custom latex name, this latex name will not be reinstated when the symbol is unpickled in a different sagemath session:

```
sage: logr = SR.symbol('logr', domain='complex', latex_name=r'L_{x/x_0}')
....: latex(logr)
L_{x/x_0}

sage: import pickle
....: path_name = '/home/mark/'
....: pickle_file_name = path_name + 'node.p'
....: pickle_write = open(pickle_file_name, 'wb')
....: pickle.dump(logr, pickle_write)
....: pickle_write.close()

[exit and restart Sage]

sage: import pickle
....: path_name = '/home/mark/'
....: pickle_file_name = path_name + 'node.p'
....: pickle_read = open(pickle_file_name, 'rb')
....: some_expr = pickle.load(pickle_read)
....: pickle_read.close()
....: latex(some_expr)
\mathit{logr}
```

Keywords: symbolics, pickling, latex_name

Branch: public/34199

Status: needs_work

Commit: c1ef96cb27d4d4e196496b65598c8ff82a78f154

Issue created by migration from https://trac.sagemath.org/ticket/34199





---

archive/issue_comments_672802.json:
```json
{
    "body": "Changing branch from \"\" to \"public/34199\"",
    "created_at": "2022-07-19T04:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34199#issuecomment-672802",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing branch from "" to "public/34199"



---

archive/issue_comments_672803.json:
```json
{
    "body": "<a id='comment:2'></a>\nPynac does most of the unpickling. The bug has two ingredients. One is that if a symbol is unpickled, and there is already a symbol with that name, then pynac will simply return the existing symbol, instead of the new symbol that it created with the data from the pickle. The other is that, at the start of the unpickling process, sagemath always creates a new symbol with the specified name, before calling pynac into play. So pynac will always return a symbol that was created by sagemath, and throw away the symbol that it created from the pickle.\n\nI pushed a branch that seems to fix this bug, but I am not convinced that it is the right approach.\n\n---\nNew commits:\n|                                                                                                                                          |                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[c1ef96c](https://github.com/sagemath/sagetrac-mirror/commit/c1ef96cb27d4d4e196496b65598c8ff82a78f154)|`unpickle the latex_name`|",
    "created_at": "2022-07-19T04:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34199#issuecomment-672803",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:2'></a>
Pynac does most of the unpickling. The bug has two ingredients. One is that if a symbol is unpickled, and there is already a symbol with that name, then pynac will simply return the existing symbol, instead of the new symbol that it created with the data from the pickle. The other is that, at the start of the unpickling process, sagemath always creates a new symbol with the specified name, before calling pynac into play. So pynac will always return a symbol that was created by sagemath, and throw away the symbol that it created from the pickle.

I pushed a branch that seems to fix this bug, but I am not convinced that it is the right approach.

---
New commits:
|                                                                                                                                          |                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[c1ef96c](https://github.com/sagemath/sagetrac-mirror/commit/c1ef96cb27d4d4e196496b65598c8ff82a78f154)|`unpickle the latex_name`|



---

archive/issue_comments_672804.json:
```json
{
    "body": "Changing commit from \"\" to \"c1ef96cb27d4d4e196496b65598c8ff82a78f154\"",
    "created_at": "2022-07-19T04:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34199#issuecomment-672804",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing commit from "" to "c1ef96cb27d4d4e196496b65598c8ff82a78f154"



---

archive/issue_comments_672805.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-19T04:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34199#issuecomment-672805",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_672806.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-19T04:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34199#issuecomment-672806",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_108380.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34199",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34199#event-108380"
}
```
