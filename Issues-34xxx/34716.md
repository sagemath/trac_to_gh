# Issue 34716: fix assertion failure in _discrete_log_pgroup() when group is trivial

archive/issues_034479.json:
```json
{
    "assignees": [],
    "body": "As of Sage 9.7, this causes an assertion failure:\n\n```sage\nsage: E = EllipticCurve(GF(487^2), [311,205])\nsage: G = E.abelian_group().torsion_subgroup(42)\nsage: P, Q = G.torsion_subgroup(6).gens()\nsage: G.discrete_log(2*P + 3*Q, [P, Q])\n```\n\nThe reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.\n\nBranch/Commit: **[`93dc05c`](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)**\n\nReviewer: **Kwankyu Lee**\n\nAuthor: **Lorenz Panny**\n\nComponent: **group theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34716_\n\n",
    "closed_at": "2022-11-07T20:25:22Z",
    "created_at": "2022-11-02T17:01:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fix assertion failure in _discrete_log_pgroup() when group is trivial",
    "type": "issue",
    "updated_at": "2022-11-07T20:25:22Z",
    "url": "https://github.com/sagemath/sage/issues/34716",
    "user": "https://github.com/yyyyx4"
}
```
As of Sage 9.7, this causes an assertion failure:

```sage
sage: E = EllipticCurve(GF(487^2), [311,205])
sage: G = E.abelian_group().torsion_subgroup(42)
sage: P, Q = G.torsion_subgroup(6).gens()
sage: G.discrete_log(2*P + 3*Q, [P, Q])
```

The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.

Branch/Commit: **[`93dc05c`](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)**

Reviewer: **Kwankyu Lee**

Author: **Lorenz Panny**

Component: **group theory**

_Issue created by migration from https://trac.sagemath.org/ticket/34716_





---

archive/issue_events_473104.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:01:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473104"
}
```



---

archive/issue_events_473105.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:01:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "c: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473105"
}
```



---

archive/issue_events_473106.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:01:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473106"
}
```



---

archive/issue_events_473107.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:01:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473107"
}
```



---

archive/issue_events_473108.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:02:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473108"
}
```



---

archive/issue_comments_560352.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n sage: G.discrete_log(2*P + 3*Q, [P, Q])\n ```\n \n-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `._discrete_log_pgroup()`. Easy fix.\n+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.\n``````\n",
    "created_at": "2022-11-02T17:02:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560352",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 sage: G.discrete_log(2*P + 3*Q, [P, Q])
 ```
 
-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `._discrete_log_pgroup()`. Easy fix.
+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.
``````




---

archive/issue_events_473109.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2022-11-02T17:02:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "title_is": "fix assertion failure in _discrete_log_pgroup() when group is trivial",
    "title_was": "fix assertion failure in AdditiveAbelianGroupWrapper._discrete_log_pgroup when group is trivial",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473109"
}
```



---

archive/issue_comments_560353.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n sage: G.discrete_log(2*P + 3*Q, [P, Q])\n ```\n \n-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.\n+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.\n``````\n",
    "created_at": "2022-11-03T03:59:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560353",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 sage: G.discrete_log(2*P + 3*Q, [P, Q])
 ```
 
-The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `_discrete_log_pgroup()`. Easy fix.
+The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order of `G`, which throws off `_discrete_log_pgroup()`. Easy fix.
``````




---

archive/issue_comments_560354.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nWouldn't it be slightly more efficient to put the check in `discrete_log` so that trivial CRT data is discarded?",
    "created_at": "2022-11-03T04:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560354",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:3" align="right">comment:3</div>

Wouldn't it be slightly more efficient to put the check in `discrete_log` so that trivial CRT data is discarded?



---

archive/issue_comments_560355.json:
```json
{
    "body": "Changed commit from **[`ce4c48c`](https://github.com/sagemath/sagetrac-mirror/commit/ce4c48ca56e6fd502049e06191e79f09a17588e1)** to **[`bd5687c`](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)**",
    "created_at": "2022-11-03T05:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560355",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ce4c48c`](https://github.com/sagemath/sagetrac-mirror/commit/ce4c48ca56e6fd502049e06191e79f09a17588e1)** to **[`bd5687c`](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)**



---

archive/issue_comments_560356.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18\"><code>bd5687c</code></a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>\n",
    "created_at": "2022-11-03T05:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560356",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18"><code>bd5687c</code></a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>




---

archive/issue_comments_560357.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks, added the check to the loop in `.discrete_log()`. I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p\u2011group after all, so the function should behave correctly.",
    "created_at": "2022-11-03T05:39:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560357",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks, added the check to the loop in `.discrete_log()`. I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.



---

archive/issue_comments_560358.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [Lorenz Panny](#comment:5):\n> I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p\u2011group after all, so the function should behave correctly.\n\nAs it is a non-public function (whose name starts with an underline) only for internal use, you may restrict the use of the function only for non-trivial p-groups, perhaps just with a comment about the restriction on the input. Thus you may avoid the duplicate check.\n\nBut if you still want to keep it for the reason you mentioned, just let me know.",
    "created_at": "2022-11-03T06:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560358",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [Lorenz Panny](#comment:5):
> I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.

As it is a non-public function (whose name starts with an underline) only for internal use, you may restrict the use of the function only for non-trivial p-groups, perhaps just with a comment about the restriction on the input. Thus you may avoid the duplicate check.

But if you still want to keep it for the reason you mentioned, just let me know.



---

archive/issue_comments_560359.json:
```json
{
    "body": "Changed commit from **[`bd5687c`](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)** to **[`93dc05c`](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)**",
    "created_at": "2022-11-03T06:27:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560359",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bd5687c`](https://github.com/sagemath/sagetrac-mirror/commit/bd5687cc890ffa10f1de71f4cdd79568ad7afa18)** to **[`93dc05c`](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)**



---

archive/issue_comments_560360.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339\"><code>93dc05c</code></a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>\n",
    "created_at": "2022-11-03T06:27:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560360",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339"><code>93dc05c</code></a></td><td><code>prevent assertion failure in _discrete_log_pgroup when group is trivial</code></td></tr></table>




---

archive/issue_comments_560361.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI don't mind. Done.",
    "created_at": "2022-11-03T06:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560361",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:8" align="right">comment:8</div>

I don't mind. Done.



---

archive/issue_comments_560362.json:
```json
{
    "body": "Reviewer: **Kwankyu Lee**",
    "created_at": "2022-11-03T12:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560362",
    "user": "https://github.com/kwankyu"
}
```

Reviewer: **Kwankyu Lee**



---

archive/issue_comments_560363.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks. LGTM.",
    "created_at": "2022-11-03T12:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560363",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks. LGTM.



---

archive/issue_events_473110.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-11-03T12:03:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473110"
}
```



---

archive/issue_events_473111.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-11-03T12:03:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473111"
}
```



---

archive/issue_events_473112.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-11-07T20:25:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473112"
}
```



---

archive/issue_events_473113.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4edaafebeede460a24c52c2d647da7a4c7fc40a4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-11-07T20:25:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34716#event-473113"
}
```



---

archive/issue_comments_560364.json:
```json
{
    "body": "Changed branch from **[public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log)** to **[`93dc05c`](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)**",
    "created_at": "2022-11-07T20:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34716#issuecomment-560364",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log](https://github.com/sagemath/sagetrac-mirror/tree/public/prevent_assertion_failure_in_AdditiveAbelianGroupWrapper_discrete_log)** to **[`93dc05c`](https://github.com/sagemath/sagetrac-mirror/commit/93dc05ccd9a6bf3358e57902cf84da87b0d91339)**
