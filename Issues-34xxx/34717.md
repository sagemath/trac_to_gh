# Issue 34717: Check the presence of lrsnash for obtain_nash()

archive/issues_034480.json:
```json
{
    "body": "To fix failures like\n\n```\nFile \"src/sage/game_theory/catalog_normal_form_games.py\", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma\nFailed example:\n    g.obtain_nash()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>\", line 1, in <module>\n        g.obtain_nash()\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1688, in obtain_nash\n        return self._solve_lrs(maximization)\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1758, in _solve_lrs\n        LrsNash().require()\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py\", line 209, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    sage.features.FeatureNotPresentError: lrsnash is not available.\n    Executable 'lrsnash' not found on PATH.\n    No equivalent system packages for homebrew are known to Sage.\n    To install lrsnash using the Sage package manager, you can try to run:\n      !sage -i lrslib\n    No equivalent system packages for pip are known to Sage.\n    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.\n```\nI have been seeing these failures for a long time on my system (mac os).  \n\n**Branch:** [u/mkoeppe/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_some_doctests_optional_for_lrsnash)\n\n**Commit:** [4a118435b3a099874a1683100a1e7ee3b12d75b1](https://github.com/sagemath/sagetrac-mirror/commit/4a118435b3a099874a1683100a1e7ee3b12d75b1)\n\n**Reviewer:** Kwankyu Lee\n\n**Author:** Matthias Koeppe\n\n**Status:** positive_review\n\nIssue created by migration from https://trac.sagemath.org/ticket/34717\n\n",
    "created_at": "2022-11-03T04:25:52Z",
    "labels": [
        "component: game theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Check the presence of lrsnash for obtain_nash()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34717",
    "user": "https://github.com/kwankyu"
}
```
To fix failures like

```
File "src/sage/game_theory/catalog_normal_form_games.py", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma
Failed example:
    g.obtain_nash()
Exception raised:
    Traceback (most recent call last):
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>", line 1, in <module>
        g.obtain_nash()
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1688, in obtain_nash
        return self._solve_lrs(maximization)
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1758, in _solve_lrs
        LrsNash().require()
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py", line 209, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: lrsnash is not available.
    Executable 'lrsnash' not found on PATH.
    No equivalent system packages for homebrew are known to Sage.
    To install lrsnash using the Sage package manager, you can try to run:
      !sage -i lrslib
    No equivalent system packages for pip are known to Sage.
    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.
```
I have been seeing these failures for a long time on my system (mac os).  

**Branch:** [u/mkoeppe/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_some_doctests_optional_for_lrsnash)

**Commit:** [4a118435b3a099874a1683100a1e7ee3b12d75b1](https://github.com/sagemath/sagetrac-mirror/commit/4a118435b3a099874a1683100a1e7ee3b12d75b1)

**Reviewer:** Kwankyu Lee

**Author:** Matthias Koeppe

**Status:** positive_review

Issue created by migration from https://trac.sagemath.org/ticket/34717





---

archive/issue_comments_659653.json:
```json
{
    "body": "**Branch:** [u/klee/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/make_some_doctests_optional_for_lrsnash)",
    "created_at": "2022-11-03T04:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659653",
    "user": "https://github.com/kwankyu"
}
```

**Branch:** [u/klee/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/make_some_doctests_optional_for_lrsnash)



---

archive/issue_events_100845.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "label": "component: doctest coverage",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34717#event-100845"
}
```



---

archive/issue_comments_659654.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,19 @@\n+To fix failures like\n \n+```\n+File \"src/sage/game_theory/catalog_normal_form_games.py\", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma\n+Failed example:\n+    g.obtain_nash()\n+Exception raised:\n+    ...\n+      File \"/Users/kwankyu/GitHub/sage-temp/src/sage/features/__init__.py\", line 209, in require\n+        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n+    sage.features.FeatureNotPresentError: lrsnash is not available.\n+    Executable 'lrsnash' not found on PATH.\n+    No equivalent system packages for homebrew are known to Sage.\n+    To install lrsnash using the Sage package manager, you can try to run:\n+      !sage -i lrslib\n+    No equivalent system packages for pip are known to Sage.\n+    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.\n+```\n+I have been seeing these failures for a long time on my system (mac os).  \n``````\n",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659654",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,19 @@
+To fix failures like
 
+```
+File "src/sage/game_theory/catalog_normal_form_games.py", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma
+Failed example:
+    g.obtain_nash()
+Exception raised:
+    ...
+      File "/Users/kwankyu/GitHub/sage-temp/src/sage/features/__init__.py", line 209, in require
+        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
+    sage.features.FeatureNotPresentError: lrsnash is not available.
+    Executable 'lrsnash' not found on PATH.
+    No equivalent system packages for homebrew are known to Sage.
+    To install lrsnash using the Sage package manager, you can try to run:
+      !sage -i lrslib
+    No equivalent system packages for pip are known to Sage.
+    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.
+```
+I have been seeing these failures for a long time on my system (mac os).  
``````




---

archive/issue_comments_659655.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659655",
    "user": "https://github.com/kwankyu"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_659656.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4ed6037081e4e3fafb37dd9e842151dff1eeb17\">a4ed603</a></td><td><code>Add # optional - lrsnash to some doctests</code></td></tr></table>\n",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659656",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4ed6037081e4e3fafb37dd9e842151dff1eeb17">a4ed603</a></td><td><code>Add # optional - lrsnash to some doctests</code></td></tr></table>




---

archive/issue_comments_659657.json:
```json
{
    "body": "**Commit:** [a4ed6037081e4e3fafb37dd9e842151dff1eeb17](https://github.com/sagemath/sagetrac-mirror/commit/a4ed6037081e4e3fafb37dd9e842151dff1eeb17)",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659657",
    "user": "https://github.com/kwankyu"
}
```

**Commit:** [a4ed6037081e4e3fafb37dd9e842151dff1eeb17](https://github.com/sagemath/sagetrac-mirror/commit/a4ed6037081e4e3fafb37dd9e842151dff1eeb17)



---

archive/issue_comments_659658.json:
```json
{
    "body": "<a id='comment:3'></a>\nOthers don't have these failures? I saw no one report them.",
    "created_at": "2022-11-03T04:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659658",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:3'></a>
Others don't have these failures? I saw no one report them.



---

archive/issue_comments_659659.json:
```json
{
    "body": "**Author:** Kwankyu Lee",
    "created_at": "2022-11-03T04:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659659",
    "user": "https://github.com/kwankyu"
}
```

**Author:** Kwankyu Lee



---

archive/issue_comments_659660.json:
```json
{
    "body": "<a id='comment:4'></a>\nI don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. It seems that on your system, you have the `lrs` executable but not `lrsnash`.",
    "created_at": "2022-12-20T19:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659660",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
I don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. It seems that on your system, you have the `lrs` executable but not `lrsnash`.



---

archive/issue_comments_659661.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2022-12-20T19:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659661",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_659662.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,8 +5,18 @@\n Failed example:\n     g.obtain_nash()\n Exception raised:\n-    ...\n-      File \"/Users/kwankyu/GitHub/sage-temp/src/sage/features/__init__.py\", line 209, in require\n+    Traceback (most recent call last):\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 695, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>\", line 1, in <module>\n+        g.obtain_nash()\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1688, in obtain_nash\n+        return self._solve_lrs(maximization)\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1758, in _solve_lrs\n+        LrsNash().require()\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py\", line 209, in require\n         raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n     sage.features.FeatureNotPresentError: lrsnash is not available.\n     Executable 'lrsnash' not found on PATH.\n``````\n",
    "created_at": "2022-12-21T02:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659662",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,8 +5,18 @@
 Failed example:
     g.obtain_nash()
 Exception raised:
-    ...
-      File "/Users/kwankyu/GitHub/sage-temp/src/sage/features/__init__.py", line 209, in require
+    Traceback (most recent call last):
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 695, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 1093, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>", line 1, in <module>
+        g.obtain_nash()
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1688, in obtain_nash
+        return self._solve_lrs(maximization)
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1758, in _solve_lrs
+        LrsNash().require()
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py", line 209, in require
         raise FeatureNotPresentError(self, presence.reason, presence.resolution)
     sage.features.FeatureNotPresentError: lrsnash is not available.
     Executable 'lrsnash' not found on PATH.
``````




---

archive/issue_comments_659663.json:
```json
{
    "body": "<a id='comment:7'></a>\n> It seems that on your system, you have the `lrs` executable but not `lrsnash`. \n\n\nRight.\n\n> I don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. \n\n\nAccording to the exception message, it checks for `lrsnash` and says `lrsnash` is not available, which is correct, and suggests to me to install `lrslib`, which is an optional package. As `obtain_nash` is dependent on `lrsnash`, it should not be tested when the optional package was not installed. Right?\n\nWhat is the right fix?",
    "created_at": "2022-12-21T02:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659663",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>
> It seems that on your system, you have the `lrs` executable but not `lrsnash`. 


Right.

> I don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. 


According to the exception message, it checks for `lrsnash` and says `lrsnash` is not available, which is correct, and suggests to me to install `lrslib`, which is an optional package. As `obtain_nash` is dependent on `lrsnash`, it should not be tested when the optional package was not installed. Right?

What is the right fix?



---

archive/issue_comments_659664.json:
```json
{
    "body": "**Changing branch** from \"[u/klee/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/make_some_doctests_optional_for_lrsnash)\" to \"[u/mkoeppe/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_some_doctests_optional_for_lrsnash)\".",
    "created_at": "2022-12-21T02:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659664",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/klee/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/make_some_doctests_optional_for_lrsnash)" to "[u/mkoeppe/make_some_doctests_optional_for_lrsnash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/make_some_doctests_optional_for_lrsnash)".



---

archive/issue_comments_659665.json:
```json
{
    "body": "<a id='comment:9'></a>\nTry this\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a118435b3a099874a1683100a1e7ee3b12d75b1\">4a11843</a></td><td><code>src/sage/game_theory/normal_form_game.py: Use LrsNash feature test</code></td></tr></table>\n",
    "created_at": "2022-12-21T02:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659665",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Try this

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a118435b3a099874a1683100a1e7ee3b12d75b1">4a11843</a></td><td><code>src/sage/game_theory/normal_form_game.py: Use LrsNash feature test</code></td></tr></table>




---

archive/issue_comments_659666.json:
```json
{
    "body": "**Changing commit** from \"[a4ed6037081e4e3fafb37dd9e842151dff1eeb17](https://github.com/sagemath/sagetrac-mirror/commit/a4ed6037081e4e3fafb37dd9e842151dff1eeb17)\" to \"[4a118435b3a099874a1683100a1e7ee3b12d75b1](https://github.com/sagemath/sagetrac-mirror/commit/4a118435b3a099874a1683100a1e7ee3b12d75b1)\".",
    "created_at": "2022-12-21T02:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659666",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[a4ed6037081e4e3fafb37dd9e842151dff1eeb17](https://github.com/sagemath/sagetrac-mirror/commit/a4ed6037081e4e3fafb37dd9e842151dff1eeb17)" to "[4a118435b3a099874a1683100a1e7ee3b12d75b1](https://github.com/sagemath/sagetrac-mirror/commit/4a118435b3a099874a1683100a1e7ee3b12d75b1)".



---

archive/issue_events_100846.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "rename": {
        "from": "Make some doctests optional for lrsnash",
        "to": "Check the presence of lrsnash for obtain_nash()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34717#event-100846"
}
```



---

archive/issue_comments_659667.json:
```json
{
    "body": "<a id='comment:10'></a>\nit works great. Thanks!",
    "created_at": "2022-12-21T03:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659667",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:10'></a>
it works great. Thanks!



---

archive/issue_events_100847.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "label": "component: doctest coverage",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34717#event-100847"
}
```



---

archive/issue_comments_659668.json:
```json
{
    "body": "**Changing author** from \"Kwankyu Lee\" to \"Matthias Koeppe\".",
    "created_at": "2022-12-21T03:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659668",
    "user": "https://github.com/kwankyu"
}
```

**Changing author** from "Kwankyu Lee" to "Matthias Koeppe".



---

archive/issue_comments_659669.json:
```json
{
    "body": "**Reviewer:** Kwankyu Lee",
    "created_at": "2022-12-21T03:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659669",
    "user": "https://github.com/kwankyu"
}
```

**Reviewer:** Kwankyu Lee



---

archive/issue_comments_659670.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2022-12-21T03:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-659670",
    "user": "https://github.com/kwankyu"
}
```

**Changing status** from needs_work to positive_review.
