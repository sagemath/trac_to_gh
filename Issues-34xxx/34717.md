# Issue 34717: Check the presence of lrsnash for obtain_nash()

archive/issues_034480.json:
```json
{
    "body": "To fix failures like\n\n```\nFile \"src/sage/game_theory/catalog_normal_form_games.py\", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma\nFailed example:\n    g.obtain_nash()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>\", line 1, in <module>\n        g.obtain_nash()\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1688, in obtain_nash\n        return self._solve_lrs(maximization)\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1758, in _solve_lrs\n        LrsNash().require()\n      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py\", line 209, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    sage.features.FeatureNotPresentError: lrsnash is not available.\n    Executable 'lrsnash' not found on PATH.\n    No equivalent system packages for homebrew are known to Sage.\n    To install lrsnash using the Sage package manager, you can try to run:\n      !sage -i lrslib\n    No equivalent system packages for pip are known to Sage.\n    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.\n```\nI have been seeing these failures for a long time on my system (mac os).  \n\nReviewer: Kwankyu Lee\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/make_some_doctests_optional_for_lrsnash\n\nStatus: positive_review\n\nCommit: 4a118435b3a099874a1683100a1e7ee3b12d75b1\n\nIssue created by migration from https://trac.sagemath.org/ticket/34717\n\n",
    "created_at": "2022-11-03T04:25:52Z",
    "labels": [
        "component: game theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Check the presence of lrsnash for obtain_nash()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34717",
    "user": "https://github.com/kwankyu"
}
```
To fix failures like

```
File "src/sage/game_theory/catalog_normal_form_games.py", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma
Failed example:
    g.obtain_nash()
Exception raised:
    Traceback (most recent call last):
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>", line 1, in <module>
        g.obtain_nash()
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1688, in obtain_nash
        return self._solve_lrs(maximization)
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1758, in _solve_lrs
        LrsNash().require()
      File "/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py", line 209, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: lrsnash is not available.
    Executable 'lrsnash' not found on PATH.
    No equivalent system packages for homebrew are known to Sage.
    To install lrsnash using the Sage package manager, you can try to run:
      !sage -i lrslib
    No equivalent system packages for pip are known to Sage.
    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.
```
I have been seeing these failures for a long time on my system (mac os).  

Reviewer: Kwankyu Lee

Author: Matthias Koeppe

Branch: u/mkoeppe/make_some_doctests_optional_for_lrsnash

Status: positive_review

Commit: 4a118435b3a099874a1683100a1e7ee3b12d75b1

Issue created by migration from https://trac.sagemath.org/ticket/34717





---

archive/issue_comments_521585.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to doctest coverage.",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521585",
    "user": "https://github.com/kwankyu"
}
```

Changing component from PLEASE CHANGE to doctest coverage.



---

archive/issue_comments_521586.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,22 @@\n+To fix failures like\n \n+```\n+File \"src/sage/game_theory/catalog_normal_form_games.py\", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma\n+Failed example:\n+    g.obtain_nash()\n+Exception raised:\n+    ...\n+      File \"/Users/kwankyu/GitHub/sage-temp/src/sage/features/__init__.py\", line 209, in require\n+        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n+    sage.features.FeatureNotPresentError: lrsnash is not available.\n+    Executable 'lrsnash' not found on PATH.\n+    No equivalent system packages for homebrew are known to Sage.\n+    To install lrsnash using the Sage package manager, you can try to run:\n+      !sage -i lrslib\n+    No equivalent system packages for pip are known to Sage.\n+    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.\n+```\n+I have been seeing these failures for a long time on my system (mac os).  \n \n Comment: 1\n \n``````\n",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521586",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,22 @@
+To fix failures like
 
+```
+File "src/sage/game_theory/catalog_normal_form_games.py", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma
+Failed example:
+    g.obtain_nash()
+Exception raised:
+    ...
+      File "/Users/kwankyu/GitHub/sage-temp/src/sage/features/__init__.py", line 209, in require
+        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
+    sage.features.FeatureNotPresentError: lrsnash is not available.
+    Executable 'lrsnash' not found on PATH.
+    No equivalent system packages for homebrew are known to Sage.
+    To install lrsnash using the Sage package manager, you can try to run:
+      !sage -i lrslib
+    No equivalent system packages for pip are known to Sage.
+    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.
+```
+I have been seeing these failures for a long time on my system (mac os).  
 
 Comment: 1
 
``````




---

archive/issue_comments_521587.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521587",
    "user": "https://github.com/kwankyu"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_521588.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521588",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_521589.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521589",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_521590.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2022-11-03T04:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521590",
    "user": "https://github.com/kwankyu"
}
```

Changing priority from major to minor.



---

archive/issue_comments_521591.json:
```json
{
    "body": "<a id='comment:3'></a>Others don't have these failures? I saw no one report them.",
    "created_at": "2022-11-03T04:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521591",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:3'></a>Others don't have these failures? I saw no one report them.



---

archive/issue_comments_521592.json:
```json
{
    "body": "<a id='comment:4'></a>I don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. It seems that on your system, you have the `lrs` executable but not `lrsnash`.",
    "created_at": "2022-12-20T19:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521592",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>I don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. It seems that on your system, you have the `lrs` executable but not `lrsnash`.



---

archive/issue_comments_521593.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-12-20T19:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521593",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_521594.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,32 @@\n+To fix failures like\n \n+```\n+File \"src/sage/game_theory/catalog_normal_form_games.py\", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma\n+Failed example:\n+    g.obtain_nash()\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 695, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>\", line 1, in <module>\n+        g.obtain_nash()\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1688, in obtain_nash\n+        return self._solve_lrs(maximization)\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py\", line 1758, in _solve_lrs\n+        LrsNash().require()\n+      File \"/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py\", line 209, in require\n+        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n+    sage.features.FeatureNotPresentError: lrsnash is not available.\n+    Executable 'lrsnash' not found on PATH.\n+    No equivalent system packages for homebrew are known to Sage.\n+    To install lrsnash using the Sage package manager, you can try to run:\n+      !sage -i lrslib\n+    No equivalent system packages for pip are known to Sage.\n+    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.\n+```\n+I have been seeing these failures for a long time on my system (mac os).  \n \n Comment: 1\n \n``````\n",
    "created_at": "2022-12-21T02:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521594",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,32 @@
+To fix failures like
 
+```
+File "src/sage/game_theory/catalog_normal_form_games.py", line 916, in sage.game_theory.catalog_normal_form_games.TravellersDilemma
+Failed example:
+    g.obtain_nash()
+Exception raised:
+    Traceback (most recent call last):
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 695, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/doctest/forker.py", line 1093, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.game_theory.catalog_normal_form_games.TravellersDilemma[8]>", line 1, in <module>
+        g.obtain_nash()
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1688, in obtain_nash
+        return self._solve_lrs(maximization)
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/game_theory/normal_form_game.py", line 1758, in _solve_lrs
+        LrsNash().require()
+      File "/Users/kwankyu/GitHub/sage-dev/src/sage/features/__init__.py", line 209, in require
+        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
+    sage.features.FeatureNotPresentError: lrsnash is not available.
+    Executable 'lrsnash' not found on PATH.
+    No equivalent system packages for homebrew are known to Sage.
+    To install lrsnash using the Sage package manager, you can try to run:
+      !sage -i lrslib
+    No equivalent system packages for pip are known to Sage.
+    Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.
+```
+I have been seeing these failures for a long time on my system (mac os).  
 
 Comment: 1
 
``````




---

archive/issue_comments_521595.json:
```json
{
    "body": "<a id='comment:7'></a>> It seems that on your system, you have the `lrs` executable but not `lrsnash`. \n\n\nRight.\n\n> I don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. \n\n\nAccording to the exception message, it checks for `lrsnash` and says `lrsnash` is not available, which is correct, and suggests to me to install `lrslib`, which is an optional package. As `obtain_nash` is dependent on `lrsnash`, it should not be tested when the optional package was not installed. Right?\n\nWhat is the right fix?",
    "created_at": "2022-12-21T02:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521595",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>> It seems that on your system, you have the `lrs` executable but not `lrsnash`. 


Right.

> I don't think this is the right fix. `obtain_nash` decides on the default algorithm to use based on a feature test; but it checks for `Lrs` when it should check for `Lrslib` or `LrsNash`. 


According to the exception message, it checks for `lrsnash` and says `lrsnash` is not available, which is correct, and suggests to me to install `lrslib`, which is an optional package. As `obtain_nash` is dependent on `lrsnash`, it should not be tested when the optional package was not installed. Right?

What is the right fix?



---

archive/issue_comments_521596.json:
```json
{
    "body": "<a id='comment:9'></a>Try this\n\n---\nNew commits:",
    "created_at": "2022-12-21T02:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521596",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Try this

---
New commits:



---

archive/issue_comments_521597.json:
```json
{
    "body": "<a id='comment:10'></a>it works great. Thanks!",
    "created_at": "2022-12-21T03:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521597",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:10'></a>it works great. Thanks!



---

archive/issue_comments_521598.json:
```json
{
    "body": "Changing component from doctest coverage to game theory.",
    "created_at": "2022-12-21T03:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521598",
    "user": "https://github.com/kwankyu"
}
```

Changing component from doctest coverage to game theory.



---

archive/issue_comments_521599.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-12-21T03:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34717#issuecomment-521599",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to positive_review.
