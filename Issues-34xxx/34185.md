# Issue 34185: New doctest option to hide features

archive/issues_033948.json:
```json
{
    "body": "As suggested in #33823 (see [ticket:33823#comment:25 comment 25]) I make a first attempt for such an option here. The purpose of the option is to find test which need to be marked as `optional` but aren't right now.\n\nFor example see the test of the following file which contains two tests involving the optional package `database_knotinfo`. Note that on the system where I produced the output below this feature is available.\n\n```bash\ncat test_knotinfo.py\nr\"\"\"\nsage: KnotInfo.K9_10.homfly_polynomial()\n-v^10*z^2 + v^8*z^4 - 2*v^10 + 2*v^8*z^2 + 2*v^6*z^4 + v^8 + 5*v^6*z^2 + v^4*z^4 + 2*v^6 + 2*v^4*z^2\nsage: KnotInfo.K9_10.alexander_polynomial()  # optional database_knotinfo\n4*t^4 - 8*t^3 + 9*t^2 - 8*t + 4\n\"\"\"\n```\n\nThe first test is missing the `optional` tag. Thus, this would fail on a system without that feature. But, running `sage -t` without the new option does not show the problem:\n\n\n```bash\nsage -t test_knotinfo.py\ntoo many failed tests, not using stored timings\nRunning doctests with ID ...\n...\nGit ref: 9.7.beta5-...\n...\nUsing --optional=database_knotinfo,debian,debugpy,mathics,mathics_scanner,palettable,pint,pip,sage,sage_spkg\nFeatures to be detected: ...\nDoctesting 1 file.\nsage -t --random-seed=17350038375103993251556014960108337039 test_knotinfo.py\n    [2 tests, 4.66 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 4.7 seconds\n    cpu time: 4.7 seconds\n    cumulative wall time: 4.7 seconds\nFeatures detected for doctesting:\n```\n\nUsing the new option this will be the case:\n\n```bash\nsage -t --hide=database_knotinfo test_knotinfo.py\ntoo many failed tests, not using stored timings\nRunning doctests with ...\n...\nGit ref: 9.7.beta5-...\n...\nUsing --optional=debian,debugpy,mathics,mathics_scanner,palettable,pint,pip,sage,sage_spkg\nFeatures to be detected: ...\nHidden features: database_knotinfo\nDoctesting 1 file.\nsage -t --random-seed=109756173219998976577146490280531589198 test_knotinfo.py\n**********************************************************************\nFile \"test_knotinfo.py\", line 2, in test_knotinfo\nFailed example:\n    KnotInfo.K9_10.homfly_polynomial()\nException raised:\n    Traceback (most recent call last):\n    ...\n    NameError: name 'KnotInfo' is not defined\n**********************************************************************\n1 item had failures:\n   1 of   2 in test_knotinfo\n    [1 test, 1 failure, 0.00 s]\n----------------------------------------------------------------------\nsage -t --random-seed=109756173219998976577146490280531589198 test_knotinfo.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\nFeatures detected for doctesting:\n```\n\n\n\nDepends on #34282\n\nDepends on #34283\n\n**CC:**  @seblabbe\n\n**Branch:** [u/soehms/hide_features_34185](https://github.com/sagemath/sagetrac-mirror/tree/u/soehms/hide_features_34185)\n\n**Commit:** [2a582f47388352bbeea35c14168f21c2e01c4d3b](https://github.com/sagemath/sagetrac-mirror/commit/2a582f47388352bbeea35c14168f21c2e01c4d3b)\n\n**Author:** Sebastian Oehms\n\nIssue created by migration from https://trac.sagemath.org/ticket/34185\n\n",
    "created_at": "2022-07-15T07:02:30Z",
    "labels": [
        "component: doctest framework",
        "enhancement",
        "needs review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "New doctest option to hide features",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/34185",
    "user": "https://github.com/soehms"
}
```
As suggested in #33823 (see [ticket:33823#comment:25 comment 25]) I make a first attempt for such an option here. The purpose of the option is to find test which need to be marked as `optional` but aren't right now.

For example see the test of the following file which contains two tests involving the optional package `database_knotinfo`. Note that on the system where I produced the output below this feature is available.

```bash
cat test_knotinfo.py
r"""
sage: KnotInfo.K9_10.homfly_polynomial()
-v^10*z^2 + v^8*z^4 - 2*v^10 + 2*v^8*z^2 + 2*v^6*z^4 + v^8 + 5*v^6*z^2 + v^4*z^4 + 2*v^6 + 2*v^4*z^2
sage: KnotInfo.K9_10.alexander_polynomial()  # optional database_knotinfo
4*t^4 - 8*t^3 + 9*t^2 - 8*t + 4
"""
```

The first test is missing the `optional` tag. Thus, this would fail on a system without that feature. But, running `sage -t` without the new option does not show the problem:


```bash
sage -t test_knotinfo.py
too many failed tests, not using stored timings
Running doctests with ID ...
...
Git ref: 9.7.beta5-...
...
Using --optional=database_knotinfo,debian,debugpy,mathics,mathics_scanner,palettable,pint,pip,sage,sage_spkg
Features to be detected: ...
Doctesting 1 file.
sage -t --random-seed=17350038375103993251556014960108337039 test_knotinfo.py
    [2 tests, 4.66 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 4.7 seconds
    cpu time: 4.7 seconds
    cumulative wall time: 4.7 seconds
Features detected for doctesting:
```

Using the new option this will be the case:

```bash
sage -t --hide=database_knotinfo test_knotinfo.py
too many failed tests, not using stored timings
Running doctests with ...
...
Git ref: 9.7.beta5-...
...
Using --optional=debian,debugpy,mathics,mathics_scanner,palettable,pint,pip,sage,sage_spkg
Features to be detected: ...
Hidden features: database_knotinfo
Doctesting 1 file.
sage -t --random-seed=109756173219998976577146490280531589198 test_knotinfo.py
**********************************************************************
File "test_knotinfo.py", line 2, in test_knotinfo
Failed example:
    KnotInfo.K9_10.homfly_polynomial()
Exception raised:
    Traceback (most recent call last):
    ...
    NameError: name 'KnotInfo' is not defined
**********************************************************************
1 item had failures:
   1 of   2 in test_knotinfo
    [1 test, 1 failure, 0.00 s]
----------------------------------------------------------------------
sage -t --random-seed=109756173219998976577146490280531589198 test_knotinfo.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
Features detected for doctesting:
```



Depends on #34282

Depends on #34283

**CC:**  @seblabbe

**Branch:** [u/soehms/hide_features_34185](https://github.com/sagemath/sagetrac-mirror/tree/u/soehms/hide_features_34185)

**Commit:** [2a582f47388352bbeea35c14168f21c2e01c4d3b](https://github.com/sagemath/sagetrac-mirror/commit/2a582f47388352bbeea35c14168f21c2e01c4d3b)

**Author:** Sebastian Oehms

Issue created by migration from https://trac.sagemath.org/ticket/34185





---

archive/issue_comments_554677.json:
```json
{
    "body": "**Branch:** [u/soehms/hide_features_34185](https://github.com/sagemath/sagetrac-mirror/tree/u/soehms/hide_features_34185)",
    "created_at": "2022-07-15T07:05:01Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554677",
    "user": "https://github.com/soehms"
}
```

**Branch:** [u/soehms/hide_features_34185](https://github.com/sagemath/sagetrac-mirror/tree/u/soehms/hide_features_34185)



---

archive/issue_events_304444.json:
```json
{
    "actor": "https://github.com/soehms",
    "created_at": "2022-07-15T07:08:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34185#event-304444"
}
```



---

archive/issue_comments_554678.json:
```json
{
    "body": "**Commit:** [f51f29a09bce023836a01c1d866eeecf26a078fa](https://github.com/sagemath/sagetrac-mirror/commit/f51f29a09bce023836a01c1d866eeecf26a078fa)",
    "created_at": "2022-07-15T07:08:17Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554678",
    "user": "https://github.com/soehms"
}
```

**Commit:** [f51f29a09bce023836a01c1d866eeecf26a078fa](https://github.com/sagemath/sagetrac-mirror/commit/f51f29a09bce023836a01c1d866eeecf26a078fa)



---

archive/issue_comments_554679.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f51f29a09bce023836a01c1d866eeecf26a078fa\">f51f29a</a></td><td><code>34185: initial version</code></td></tr></table>\n",
    "created_at": "2022-07-15T07:08:17Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554679",
    "user": "https://github.com/soehms"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f51f29a09bce023836a01c1d866eeecf26a078fa">f51f29a</a></td><td><code>34185: initial version</code></td></tr></table>




---

archive/issue_comments_554680.json:
```json
{
    "body": "**Author:** Sebastian Oehms",
    "created_at": "2022-07-15T07:08:17Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554680",
    "user": "https://github.com/soehms"
}
```

**Author:** Sebastian Oehms



---

archive/issue_comments_554681.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think instead of reading from SAGE_PKGS directly, it would be better to refactor `sage.misc.package.list_packages`",
    "created_at": "2022-07-15T13:57:53Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554681",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
I think instead of reading from SAGE_PKGS directly, it would be better to refactor `sage.misc.package.list_packages`



---

archive/issue_comments_554682.json:
```json
{
    "body": "**Changing commit** from \"[f51f29a09bce023836a01c1d866eeecf26a078fa](https://github.com/sagemath/sagetrac-mirror/commit/f51f29a09bce023836a01c1d866eeecf26a078fa)\" to \"[3071dbc20e76459a23282001311b6fee3cd897c3](https://github.com/sagemath/sagetrac-mirror/commit/3071dbc20e76459a23282001311b6fee3cd897c3)\".",
    "created_at": "2022-07-18T16:02:01Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f51f29a09bce023836a01c1d866eeecf26a078fa](https://github.com/sagemath/sagetrac-mirror/commit/f51f29a09bce023836a01c1d866eeecf26a078fa)" to "[3071dbc20e76459a23282001311b6fee3cd897c3](https://github.com/sagemath/sagetrac-mirror/commit/3071dbc20e76459a23282001311b6fee3cd897c3)".



---

archive/issue_comments_554683.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3071dbc20e76459a23282001311b6fee3cd897c3\">3071dbc</a></td><td><code>34185: correction according to review</code></td></tr></table>\n",
    "created_at": "2022-07-18T16:02:01Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3071dbc20e76459a23282001311b6fee3cd897c3">3071dbc</a></td><td><code>34185: correction according to review</code></td></tr></table>




---

archive/issue_comments_554684.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mkoeppe](#comment%3A3):\n> I think instead of reading from SAGE_PKGS directly, it would be better to refactor `sage.misc.package.list_packages`\n\nActually, I didn't do that well. Many thanks for looking at the ticket!",
    "created_at": "2022-07-18T16:03:14Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554684",
    "user": "https://github.com/soehms"
}
```

<a id='comment:5'></a>
Replying to [mkoeppe](#comment%3A3):
> I think instead of reading from SAGE_PKGS directly, it would be better to refactor `sage.misc.package.list_packages`

Actually, I didn't do that well. Many thanks for looking at the ticket!



---

archive/issue_comments_554685.json:
```json
{
    "body": "<a id='comment:6'></a>\nA `JoinFeature` should probably hide/unhide its components",
    "created_at": "2022-07-19T21:01:09Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554685",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
A `JoinFeature` should probably hide/unhide its components



---

archive/issue_comments_554686.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A6):\n> A `JoinFeature` should probably hide/unhide its components\n\nWill be in the next commit.\n\nI'm wondering what's wrong with the patchbots? For example:\n\n```\n**********************************************************************\nFile \"/Users/jpalmier/Desktop/Sage/git/patchbot/sage-9.7.beta5/src/sage/features/__init__.py\", line 301, in sage.features.Feature.is_optional\nFailed example:\n    DatabaseCremona().is_optional()\nException raised:\n    Traceback (most recent call last):\n    ...\n    AttributeError: 'DatabaseCremona' object has no attribute 'is_optional'\n```\n\nAll tests failing on the patchbots succeed in the Gitpod environment. But here there is a failing test, as well, but obviously unrelated to the branch. It is caused by:\n\n```\nsage: from sage.features.latex import LaTeXPackage\nsage: LaTeXPackage(\"tkz-graph\").is_present()\nTraceback (most recent call last):\n...\nFileNotFoundError: [Errno 2] No such file or directory: 'kpsewhich'\n```\n\nThis happens since `kpsewhich` is not installed on the environment. Shouldn't `LaTeXPackage` be a *joined feature* with `pdflatex`?",
    "created_at": "2022-07-20T16:28:38Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554686",
    "user": "https://github.com/soehms"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A6):
> A `JoinFeature` should probably hide/unhide its components

Will be in the next commit.

I'm wondering what's wrong with the patchbots? For example:

```
**********************************************************************
File "/Users/jpalmier/Desktop/Sage/git/patchbot/sage-9.7.beta5/src/sage/features/__init__.py", line 301, in sage.features.Feature.is_optional
Failed example:
    DatabaseCremona().is_optional()
Exception raised:
    Traceback (most recent call last):
    ...
    AttributeError: 'DatabaseCremona' object has no attribute 'is_optional'
```

All tests failing on the patchbots succeed in the Gitpod environment. But here there is a failing test, as well, but obviously unrelated to the branch. It is caused by:

```
sage: from sage.features.latex import LaTeXPackage
sage: LaTeXPackage("tkz-graph").is_present()
Traceback (most recent call last):
...
FileNotFoundError: [Errno 2] No such file or directory: 'kpsewhich'
```

This happens since `kpsewhich` is not installed on the environment. Shouldn't `LaTeXPackage` be a *joined feature* with `pdflatex`?



---

archive/issue_comments_554687.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/faacd11d7c165e2b7aa128f4d8e055e6dc4bf9d4\">faacd11</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4b562c56206b83fb23f259e6cba4f75304b43b9\">b4b562c</a></td><td><code>34185: take care of joined features</code></td></tr></table>\n",
    "created_at": "2022-07-25T06:40:20Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/faacd11d7c165e2b7aa128f4d8e055e6dc4bf9d4">faacd11</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4b562c56206b83fb23f259e6cba4f75304b43b9">b4b562c</a></td><td><code>34185: take care of joined features</code></td></tr></table>




---

archive/issue_comments_554688.json:
```json
{
    "body": "**Changing commit** from \"[3071dbc20e76459a23282001311b6fee3cd897c3](https://github.com/sagemath/sagetrac-mirror/commit/3071dbc20e76459a23282001311b6fee3cd897c3)\" to \"[b4b562c56206b83fb23f259e6cba4f75304b43b9](https://github.com/sagemath/sagetrac-mirror/commit/b4b562c56206b83fb23f259e6cba4f75304b43b9)\".",
    "created_at": "2022-07-25T06:40:20Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554688",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3071dbc20e76459a23282001311b6fee3cd897c3](https://github.com/sagemath/sagetrac-mirror/commit/3071dbc20e76459a23282001311b6fee3cd897c3)" to "[b4b562c56206b83fb23f259e6cba4f75304b43b9](https://github.com/sagemath/sagetrac-mirror/commit/b4b562c56206b83fb23f259e6cba4f75304b43b9)".



---

archive/issue_comments_554689.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe recent commit takes care of joined features. In addition (in order to allow more interesting doctest examples) I make `lazy_import` be hide-able.",
    "created_at": "2022-07-25T06:41:21Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554689",
    "user": "https://github.com/soehms"
}
```

<a id='comment:10'></a>
The recent commit takes care of joined features. In addition (in order to allow more interesting doctest examples) I make `lazy_import` be hide-able.



---

archive/issue_comments_554690.json:
```json
{
    "body": "**Changing commit** from \"[b4b562c56206b83fb23f259e6cba4f75304b43b9](https://github.com/sagemath/sagetrac-mirror/commit/b4b562c56206b83fb23f259e6cba4f75304b43b9)\" to \"[f39836a2622c74db07fe6bc3585bd309e327e482](https://github.com/sagemath/sagetrac-mirror/commit/f39836a2622c74db07fe6bc3585bd309e327e482)\".",
    "created_at": "2022-08-05T07:22:59Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554690",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b4b562c56206b83fb23f259e6cba4f75304b43b9](https://github.com/sagemath/sagetrac-mirror/commit/b4b562c56206b83fb23f259e6cba4f75304b43b9)" to "[f39836a2622c74db07fe6bc3585bd309e327e482](https://github.com/sagemath/sagetrac-mirror/commit/f39836a2622c74db07fe6bc3585bd309e327e482)".



---

archive/issue_comments_554691.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70abb3f81454a87099134b11bd963f4f6032d38f\">70abb3f</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c599e491b1e994bd631371d12da74a9b9166e6ba\">c599e49</a></td><td><code>34282: initial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/442fca6778d1db021df657b54a11febe03e52c14\">442fca6</a></td><td><code>Merge branch 'join_feature_texfile_with_pdflatex_34282' into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4cf504d86bf87a136ee6d34293bdfd7e8ed62a2\">d4cf504</a></td><td><code>34283: initial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f39836a2622c74db07fe6bc3585bd309e327e482\">f39836a</a></td><td><code>Merge branch 'circular_import_matrix_space_34283' into hide_features_34185</code></td></tr></table>\n",
    "created_at": "2022-08-05T07:22:59Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554691",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70abb3f81454a87099134b11bd963f4f6032d38f">70abb3f</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c599e491b1e994bd631371d12da74a9b9166e6ba">c599e49</a></td><td><code>34282: initial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/442fca6778d1db021df657b54a11febe03e52c14">442fca6</a></td><td><code>Merge branch 'join_feature_texfile_with_pdflatex_34282' into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4cf504d86bf87a136ee6d34293bdfd7e8ed62a2">d4cf504</a></td><td><code>34283: initial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f39836a2622c74db07fe6bc3585bd309e327e482">f39836a</a></td><td><code>Merge branch 'circular_import_matrix_space_34283' into hide_features_34185</code></td></tr></table>




---

archive/issue_comments_554692.json:
```json
{
    "body": "**Dependencies:** #34282 #34283",
    "created_at": "2022-08-05T07:26:41Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554692",
    "user": "https://github.com/soehms"
}
```

**Dependencies:** #34282 #34283



---

archive/issue_comments_554693.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [soehms](#comment%3A7):\n> ... But here there is a failing test, as well, but obviously unrelated to the branch. It is caused by:\n> \n> ```\n> sage: from sage.features.latex import LaTeXPackage\n> sage: LaTeXPackage(\"tkz-graph\").is_present()\n> Traceback (most recent call last):\n> ...\n> FileNotFoundError: [Errno 2] No such file or directory: 'kpsewhich'\n> ```\n> \n> This happens since `kpsewhich` is not installed on the environment. Shouldn't `LaTeXPackage` be a *joined feature* with `pdflatex`?\n> \n\n\nSee #34282 for a suggestion to have this fixed.\n\nFurthermore, when testing on a system with meataxe you may randomly run into a circular import issue in `matrix_space`. This is fixed in ticket #34283.",
    "created_at": "2022-08-05T07:26:41Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554693",
    "user": "https://github.com/soehms"
}
```

<a id='comment:12'></a>
Replying to [soehms](#comment%3A7):
> ... But here there is a failing test, as well, but obviously unrelated to the branch. It is caused by:
> 
> ```
> sage: from sage.features.latex import LaTeXPackage
> sage: LaTeXPackage("tkz-graph").is_present()
> Traceback (most recent call last):
> ...
> FileNotFoundError: [Errno 2] No such file or directory: 'kpsewhich'
> ```
> 
> This happens since `kpsewhich` is not installed on the environment. Shouldn't `LaTeXPackage` be a *joined feature* with `pdflatex`?
> 


See #34282 for a suggestion to have this fixed.

Furthermore, when testing on a system with meataxe you may randomly run into a circular import issue in `matrix_space`. This is fixed in ticket #34283.



---

archive/issue_comments_554694.json:
```json
{
    "body": "**Changing commit** from \"[f39836a2622c74db07fe6bc3585bd309e327e482](https://github.com/sagemath/sagetrac-mirror/commit/f39836a2622c74db07fe6bc3585bd309e327e482)\" to \"[6912c1c90c32d40057c49c47a735730b5f461053](https://github.com/sagemath/sagetrac-mirror/commit/6912c1c90c32d40057c49c47a735730b5f461053)\".",
    "created_at": "2022-08-09T08:27:24Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f39836a2622c74db07fe6bc3585bd309e327e482](https://github.com/sagemath/sagetrac-mirror/commit/f39836a2622c74db07fe6bc3585bd309e327e482)" to "[6912c1c90c32d40057c49c47a735730b5f461053](https://github.com/sagemath/sagetrac-mirror/commit/6912c1c90c32d40057c49c47a735730b5f461053)".



---

archive/issue_comments_554695.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ddd7adabc0d919c960db069bb3ef76152ca593b0\">ddd7ada</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ec6d464b4e3ace565ddbd451d325a7b78689d84\">0ec6d46</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7358dc2e601061c28ad2d0a1cfbb16c6ce317f8c\">7358dc2</a></td><td><code>34282: dd spkg='texlive', refactoring, pycodestyle</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f463ac75886cb73d815cf2e4459171aff9928909\">f463ac7</a></td><td><code>Merge branch 'join_feature_texfile_with_pdflatex_34282' into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53d8d11c02dae01a3dc0748304ec5d61a7c9a155\">53d8d11</a></td><td><code>34283: fix according to review</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebbd4a477a43c5c3d5a6c15b0f7a7d7130eadc47\">ebbd4a4</a></td><td><code>Merge branch 'circular_import_matrix_space_34283' into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6912c1c90c32d40057c49c47a735730b5f461053\">6912c1c</a></td><td><code>34185: fix doctest failure + pep8 fixes</code></td></tr></table>\n",
    "created_at": "2022-08-09T08:27:24Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ddd7adabc0d919c960db069bb3ef76152ca593b0">ddd7ada</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ec6d464b4e3ace565ddbd451d325a7b78689d84">0ec6d46</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7358dc2e601061c28ad2d0a1cfbb16c6ce317f8c">7358dc2</a></td><td><code>34282: dd spkg='texlive', refactoring, pycodestyle</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f463ac75886cb73d815cf2e4459171aff9928909">f463ac7</a></td><td><code>Merge branch 'join_feature_texfile_with_pdflatex_34282' into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53d8d11c02dae01a3dc0748304ec5d61a7c9a155">53d8d11</a></td><td><code>34283: fix according to review</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebbd4a477a43c5c3d5a6c15b0f7a7d7130eadc47">ebbd4a4</a></td><td><code>Merge branch 'circular_import_matrix_space_34283' into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6912c1c90c32d40057c49c47a735730b5f461053">6912c1c</a></td><td><code>34185: fix doctest failure + pep8 fixes</code></td></tr></table>




---

archive/issue_comments_554696.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe previous commit should fix the only failure that happened on the previous patchbot run. This is the following long test:\n\n```sage\nDoctesting 1 file using 4 threads.\nsage -t --long --random-seed=32647687899858611983071143867735298580 src/sage/doctest/sources.py\n**********************************************************************\nFile \"src/sage/doctest/sources.py\", line 781, in sage.doctest.sources.FileDocTestSource._test_enough_doctests\nFailed example:\n    for path, dirs, files in itertools.chain(os.walk('sage'), os.walk('doc')): # long time\n        path = os.path.relpath(path)\n        dirs.sort(); files.sort()\n        for F in files:\n            _, ext = os.path.splitext(F)\n            if ext in ('.py', '.pyx', '.pxd', '.pxi', '.sage', '.spyx', '.rst'):\n                filename = os.path.join(path, F)\n                FDS = FileDocTestSource(filename, DocTestDefaults(long=True, optional=True, force_lib=True))\n                FDS._test_enough_doctests(verbose=False)\nExpected:\n    There are 3 unexpected tests being run in sage/doctest/parsing.py\n    There are 1 unexpected tests being run in sage/doctest/reporting.py\nGot:\n    There are 7 tests in sage/doctest/control.py that are not being run\n    There are 3 unexpected tests being run in sage/doctest/parsing.py\n    There are 1 unexpected tests being run in sage/doctest/reporting.py\n**********************************************************************\n1 item had failures:\n   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests\n    [371 tests, 1 failure, 105.47 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=32647687899858611983071143867735298580 src/sage/doctest/sources.py  # 1 doctest failed\n```",
    "created_at": "2022-08-09T08:30:46Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554696",
    "user": "https://github.com/soehms"
}
```

<a id='comment:14'></a>
The previous commit should fix the only failure that happened on the previous patchbot run. This is the following long test:

```sage
Doctesting 1 file using 4 threads.
sage -t --long --random-seed=32647687899858611983071143867735298580 src/sage/doctest/sources.py
**********************************************************************
File "src/sage/doctest/sources.py", line 781, in sage.doctest.sources.FileDocTestSource._test_enough_doctests
Failed example:
    for path, dirs, files in itertools.chain(os.walk('sage'), os.walk('doc')): # long time
        path = os.path.relpath(path)
        dirs.sort(); files.sort()
        for F in files:
            _, ext = os.path.splitext(F)
            if ext in ('.py', '.pyx', '.pxd', '.pxi', '.sage', '.spyx', '.rst'):
                filename = os.path.join(path, F)
                FDS = FileDocTestSource(filename, DocTestDefaults(long=True, optional=True, force_lib=True))
                FDS._test_enough_doctests(verbose=False)
Expected:
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
Got:
    There are 7 tests in sage/doctest/control.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
**********************************************************************
1 item had failures:
   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests
    [371 tests, 1 failure, 105.47 s]
----------------------------------------------------------------------
sage -t --long --random-seed=32647687899858611983071143867735298580 src/sage/doctest/sources.py  # 1 doctest failed
```



---

archive/issue_comments_554697.json:
```json
{
    "body": "<a id='comment:15'></a>\nI saw one typo when looking at the diff:\n\n```\n    def unhide(self):\n        r\"\"\"\n        Hide this feature and all its joined features.\n```",
    "created_at": "2022-08-24T16:37:11Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554697",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:15'></a>
I saw one typo when looking at the diff:

```
    def unhide(self):
        r"""
        Hide this feature and all its joined features.
```



---

archive/issue_comments_554698.json:
```json
{
    "body": "**Changing commit** from \"[6912c1c90c32d40057c49c47a735730b5f461053](https://github.com/sagemath/sagetrac-mirror/commit/6912c1c90c32d40057c49c47a735730b5f461053)\" to \"[187bdcfbd2941841d90fe057652b448ccb86c5fd](https://github.com/sagemath/sagetrac-mirror/commit/187bdcfbd2941841d90fe057652b448ccb86c5fd)\".",
    "created_at": "2022-09-06T07:32:07Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6912c1c90c32d40057c49c47a735730b5f461053](https://github.com/sagemath/sagetrac-mirror/commit/6912c1c90c32d40057c49c47a735730b5f461053)" to "[187bdcfbd2941841d90fe057652b448ccb86c5fd](https://github.com/sagemath/sagetrac-mirror/commit/187bdcfbd2941841d90fe057652b448ccb86c5fd)".



---

archive/issue_comments_554699.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e119709913cae190e4b9799d3b8b81d0c3deee4\">2e11970</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5900ac00f7ff36e174fa45b52f6ef78265c2826\">a5900ac</a></td><td><code>Merge branch 'develop' into t/34282/join_feature_texfile_with_pdflatex_34282</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e6ca2a67102d4c133173cedaa5ca505c2082ddf\">9e6ca2a</a></td><td><code>Replace pdflatex to latex</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/553f6ffc7473fabcff8e630b995bd7e3dc671207\">553f6ff</a></td><td><code>Do not use JoinFeature</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a31205abd7189dfb0f888fe78fd3bfcd4bd09eee\">a31205a</a></td><td><code>A tiny edit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd62d0b7d426cea78cf0dc1e1cd1da1721019688\">dd62d0b</a></td><td><code>Merge branch 'u/klee/join_feature_texfile_with_pdflatex_34282' of trac.sagemath.org:sage into join_feature_texfile_with_pdflatex_34282</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a77ff0c9c90b94bd83799351326f4dca6237c2f2\">a77ff0c</a></td><td><code>34282: pyflakes and missing import in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d676f794b2c11462d745a6880c6d0f65addf4425\">d676f79</a></td><td><code>Merge branch 'u/soehms/join_feature_texfile_with_pdflatex_34282' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/187bdcfbd2941841d90fe057652b448ccb86c5fd\">187bdcf</a></td><td><code>34185: fix typos</code></td></tr></table>\n",
    "created_at": "2022-09-06T07:32:07Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e119709913cae190e4b9799d3b8b81d0c3deee4">2e11970</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5900ac00f7ff36e174fa45b52f6ef78265c2826">a5900ac</a></td><td><code>Merge branch 'develop' into t/34282/join_feature_texfile_with_pdflatex_34282</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e6ca2a67102d4c133173cedaa5ca505c2082ddf">9e6ca2a</a></td><td><code>Replace pdflatex to latex</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/553f6ffc7473fabcff8e630b995bd7e3dc671207">553f6ff</a></td><td><code>Do not use JoinFeature</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a31205abd7189dfb0f888fe78fd3bfcd4bd09eee">a31205a</a></td><td><code>A tiny edit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd62d0b7d426cea78cf0dc1e1cd1da1721019688">dd62d0b</a></td><td><code>Merge branch 'u/klee/join_feature_texfile_with_pdflatex_34282' of trac.sagemath.org:sage into join_feature_texfile_with_pdflatex_34282</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a77ff0c9c90b94bd83799351326f4dca6237c2f2">a77ff0c</a></td><td><code>34282: pyflakes and missing import in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d676f794b2c11462d745a6880c6d0f65addf4425">d676f79</a></td><td><code>Merge branch 'u/soehms/join_feature_texfile_with_pdflatex_34282' of trac.sagemath.org:sage into hide_features_34185</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/187bdcfbd2941841d90fe057652b448ccb86c5fd">187bdcf</a></td><td><code>34185: fix typos</code></td></tr></table>




---

archive/issue_comments_554700.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [S\u00e9bastien Labb\u00e9](#comment%3A15):\n> I saw one typo when looking at the diff:\n> \n> ```\n>     def unhide(self):\n>         r\"\"\"\n>         Hide this feature and all its joined features.\n> ```\n\n\nDone!\n\nIn Addition I rebased over 9.7.rc0 and the current changes in #34282.",
    "created_at": "2022-09-06T07:34:33Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554700",
    "user": "https://github.com/soehms"
}
```

<a id='comment:17'></a>
Replying to [Sébastien Labbé](#comment%3A15):
> I saw one typo when looking at the diff:
> 
> ```
>     def unhide(self):
>         r"""
>         Hide this feature and all its joined features.
> ```


Done!

In Addition I rebased over 9.7.rc0 and the current changes in #34282.



---

archive/issue_events_304445.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34185#event-304445"
}
```



---

archive/issue_events_304446.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34185#event-304446"
}
```



---

archive/issue_comments_554701.json:
```json
{
    "body": "**Changing commit** from \"[187bdcfbd2941841d90fe057652b448ccb86c5fd](https://github.com/sagemath/sagetrac-mirror/commit/187bdcfbd2941841d90fe057652b448ccb86c5fd)\" to \"[2a582f47388352bbeea35c14168f21c2e01c4d3b](https://github.com/sagemath/sagetrac-mirror/commit/2a582f47388352bbeea35c14168f21c2e01c4d3b)\".",
    "created_at": "2022-09-30T21:26:17Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[187bdcfbd2941841d90fe057652b448ccb86c5fd](https://github.com/sagemath/sagetrac-mirror/commit/187bdcfbd2941841d90fe057652b448ccb86c5fd)" to "[2a582f47388352bbeea35c14168f21c2e01c4d3b](https://github.com/sagemath/sagetrac-mirror/commit/2a582f47388352bbeea35c14168f21c2e01c4d3b)".



---

archive/issue_comments_554702.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a582f47388352bbeea35c14168f21c2e01c4d3b\">2a582f4</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr></table>\n",
    "created_at": "2022-09-30T21:26:17Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a582f47388352bbeea35c14168f21c2e01c4d3b">2a582f4</a></td><td><code>Merge branch 'u/soehms/hide_features_34185' of trac.sagemath.org:sage into hide_features_34185</code></td></tr></table>




---

archive/issue_comments_554703.json:
```json
{
    "body": "<a id='comment:20'></a>\nJust rebasing to 9.8.beta1.",
    "created_at": "2022-09-30T21:28:59Z",
    "issue": "https://github.com/sagemath/sage/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34185#issuecomment-554703",
    "user": "https://github.com/soehms"
}
```

<a id='comment:20'></a>
Just rebasing to 9.8.beta1.
