# Issue 34029: bug in elliptic curve saturation: update to eclib bugfix release 20220621 required.

archive/issues_033792.json:
```json
{
    "assignees": [],
    "body": "In eclib version v20210310 the code for saturating points on elliptic curves over QQ was greatly improved, but a small logic error was introduced leading to the following:\n\n```\nsage: E = EllipticCurve([0, 0, 0, -17607, -889490])\nsage: Q = E([-82,54])\nsage: E.saturation([2*Q])\n([(-82 : 54 : 1)], 2, 2.36570863272098)\nsage: E.saturation([2*Q], max_prime=10)\n([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)\n```\nThe point list [2*Q] is certainly not saturated at 2, and when no saturation bound is given this is detected automaically OK, but when any bound is given it is not.  (The reason, for those interested, is that the code in eclib treats primes dividing Tamagawa numbers separately, and here 2 is such a prime.)\n\nI don't see a way to fix this in Sage, but I have fixed the relevant bugs in eclib and made a new release which is [https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2](https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2)\n\nCC:  @dimpase @mkoeppe\n\nKeywords: **eclib**\n\nBranch/Commit: **[9b65d73](https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e)**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **John Cremona**\n\nComponent: **elliptic curves**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34029_\n\n",
    "closed_at": "2022-07-09T22:33:17Z",
    "created_at": "2022-06-20T10:26:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "bug in elliptic curve saturation: update to eclib bugfix release 20220621 required.",
    "type": "issue",
    "updated_at": "2022-07-09T22:33:17Z",
    "url": "https://github.com/sagemath/sage/issues/34029",
    "user": "https://github.com/JohnCremona"
}
```
In eclib version v20210310 the code for saturating points on elliptic curves over QQ was greatly improved, but a small logic error was introduced leading to the following:

```
sage: E = EllipticCurve([0, 0, 0, -17607, -889490])
sage: Q = E([-82,54])
sage: E.saturation([2*Q])
([(-82 : 54 : 1)], 2, 2.36570863272098)
sage: E.saturation([2*Q], max_prime=10)
([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)
```
The point list [2*Q] is certainly not saturated at 2, and when no saturation bound is given this is detected automaically OK, but when any bound is given it is not.  (The reason, for those interested, is that the code in eclib treats primes dividing Tamagawa numbers separately, and here 2 is such a prime.)

I don't see a way to fix this in Sage, but I have fixed the relevant bugs in eclib and made a new release which is [https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2](https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2)

CC:  @dimpase @mkoeppe

Keywords: **eclib**

Branch/Commit: **[9b65d73](https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e)**

Upstream: **Fixed upstream, in a later stable release.**

Reviewer: **Dima Pasechnik**

Author: **John Cremona**

Component: **elliptic curves**

_Issue created by migration from https://trac.sagemath.org/ticket/34029_





---

archive/issue_events_466074.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-20T10:26:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466074"
}
```



---

archive/issue_events_466075.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-20T10:26:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466075"
}
```



---

archive/issue_events_466076.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-20T10:26:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466076"
}
```



---

archive/issue_events_466077.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-20T10:26:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466077"
}
```



---

archive/issue_events_466078.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-20T11:23:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "title_is": "bug in elliptic curve saturation: update to eclib bugfix release 20220620 required.",
    "title_was": "bug in elliptic curve saturation: bugfix in eclib required.",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466078"
}
```



---

archive/issue_comments_549863.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n ```\n The point list [2*Q] is certainly not saturated at 2, and when no saturation bound is given this is detected automaically OK, but when any bound is given it is not.  (The reason, for those interested, is that the code in eclib treats primes dividing Tamagawa numbers separately, and here 2 is such a prime.)\n \n-I don't see a way to fix this in Sage other than fixing the bug in eclib (which I will now do) and update eclib.\n+I don't see a way to fix this in Sage, but I have fixed the relevant bugs in eclib and made a new release which is [https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2](https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2)\n``````\n",
    "created_at": "2022-06-21T15:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549863",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 ```
 The point list [2*Q] is certainly not saturated at 2, and when no saturation bound is given this is detected automaically OK, but when any bound is given it is not.  (The reason, for those interested, is that the code in eclib treats primes dividing Tamagawa numbers separately, and here 2 is such a prime.)
 
-I don't see a way to fix this in Sage other than fixing the bug in eclib (which I will now do) and update eclib.
+I don't see a way to fix this in Sage, but I have fixed the relevant bugs in eclib and made a new release which is [https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2](https://github.com/JohnCremona/eclib/releases/download/20220621/eclib-20220621.tar.bz2)
``````




---

archive/issue_events_466079.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-21T15:23:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "title_is": "bug in elliptic curve saturation: update to eclib bugfix release 20220621 required.",
    "title_was": "bug in elliptic curve saturation: update to eclib bugfix release 20220620 required.",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466079"
}
```



---

archive/issue_events_466080.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-21T15:23:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466080"
}
```



---

archive/issue_comments_549864.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI hope I can get the new eclib version working more easily than last time (the last version was 20210625, so almost exactly a year ago).\n\nIn my new branch (based on current develop branch) I updated the package-version.txt and fixed the checksum.ini, after putting the new tar.bz2 file into upstream/.  I deleted the patch in the patches directory since those changes are in the upstream source now. Then \"sage -i -c eclib\" worked fine, all checks passed.  But when I run anything relevant I get errors:\n\n```\nsage: E = EllipticCurve([0,0,0,-17607,-889490])\nsage: E.rank()\n```\ngives a segfault.\n\nThe new version should be completely compatible, i.e. no changes are needed to the interface.\n\n```\n./sage -t src/sage/libs/eclib/constructor.py\n```\nis fine, but \n\n```\n./sage -t src/sage/libs/eclib/interface.py\n```\ncauses a lot of segfaults, e.g.\n\n```\nsage -t --warn-long 94.9 --random-seed=269743671597642066957592066085711042976 src/sage/libs/eclib/interface.py\n**********************************************************************\nFile \"src/sage/libs/eclib/interface.py\", line 155, in sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose\nFailed example:\n    E.saturate() # no output\nException raised:\n    Traceback (most recent call last):\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose[1]>\", line 1, in <module>\n        E.saturate() # no output\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py\", line 570, in saturate\n        self.__two_descent_data().saturate(bound, lower)\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py\", line 370, in __two_descent_data\n        self.two_descent(self.__verbose)\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py\", line 348, in two_descent\n        self.__descent.do_descent(self.__curve,\n      File \"sage/libs/eclib/mwrank.pyx\", line 1061, in sage.libs.eclib.mwrank._two_descent.do_descent (build/cythonized/sage/libs/eclib/mwrank.cpp:5622)\n        sig_on()\n    cysignals.signals.SignalError: Segmentation fault\n```\n\nI'll post the branch here and hope someone can help.  Dima usually can!",
    "created_at": "2022-06-21T15:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549864",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

I hope I can get the new eclib version working more easily than last time (the last version was 20210625, so almost exactly a year ago).

In my new branch (based on current develop branch) I updated the package-version.txt and fixed the checksum.ini, after putting the new tar.bz2 file into upstream/.  I deleted the patch in the patches directory since those changes are in the upstream source now. Then "sage -i -c eclib" worked fine, all checks passed.  But when I run anything relevant I get errors:

```
sage: E = EllipticCurve([0,0,0,-17607,-889490])
sage: E.rank()
```
gives a segfault.

The new version should be completely compatible, i.e. no changes are needed to the interface.

```
./sage -t src/sage/libs/eclib/constructor.py
```
is fine, but 

```
./sage -t src/sage/libs/eclib/interface.py
```
causes a lot of segfaults, e.g.

```
sage -t --warn-long 94.9 --random-seed=269743671597642066957592066085711042976 src/sage/libs/eclib/interface.py
**********************************************************************
File "src/sage/libs/eclib/interface.py", line 155, in sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose
Failed example:
    E.saturate() # no output
Exception raised:
    Traceback (most recent call last):
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose[1]>", line 1, in <module>
        E.saturate() # no output
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py", line 570, in saturate
        self.__two_descent_data().saturate(bound, lower)
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py", line 370, in __two_descent_data
        self.two_descent(self.__verbose)
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py", line 348, in two_descent
        self.__descent.do_descent(self.__curve,
      File "sage/libs/eclib/mwrank.pyx", line 1061, in sage.libs.eclib.mwrank._two_descent.do_descent (build/cythonized/sage/libs/eclib/mwrank.cpp:5622)
        sig_on()
    cysignals.signals.SignalError: Segmentation fault
```

I'll post the branch here and hope someone can help.  Dima usually can!



---

archive/issue_comments_549865.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI will go and read the latest edition of the developers' guide to see why this does not work:\n\n```\n$ git push trac eclib-20220621:trac/u/cremona/34029\nX11 forwarding request failed on channel 0\nEnumerating objects: 13, done.\nCounting objects: 100% (13/13), done.\nDelta compression using up to 8 threads\nCompressing objects: 100% (6/6), done.\nWriting objects: 100% (7/7), 686 bytes | 686.00 KiB/s, done.\nTotal 7 (delta 4), reused 0 (delta 0)\nremote: FATAL: W refs/heads/trac/u/cremona/34029 sage cremona DENIED by fallthru\nremote: error: hook declined to update refs/heads/trac/u/cremona/34029\nTo trac.sagemath.org:sage.git\n ! [remote rejected]       eclib-20220621 -> trac/u/cremona/34029 (hook declined)\nerror: failed to push some refs to 'git@trac.sagemath.org:sage.git'\n```",
    "created_at": "2022-06-21T15:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549865",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:3" align="right">comment:3</div>

I will go and read the latest edition of the developers' guide to see why this does not work:

```
$ git push trac eclib-20220621:trac/u/cremona/34029
X11 forwarding request failed on channel 0
Enumerating objects: 13, done.
Counting objects: 100% (13/13), done.
Delta compression using up to 8 threads
Compressing objects: 100% (6/6), done.
Writing objects: 100% (7/7), 686 bytes | 686.00 KiB/s, done.
Total 7 (delta 4), reused 0 (delta 0)
remote: FATAL: W refs/heads/trac/u/cremona/34029 sage cremona DENIED by fallthru
remote: error: hook declined to update refs/heads/trac/u/cremona/34029
To trac.sagemath.org:sage.git
 ! [remote rejected]       eclib-20220621 -> trac/u/cremona/34029 (hook declined)
error: failed to push some refs to 'git@trac.sagemath.org:sage.git'
```



---

archive/issue_comments_549866.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWell, in fact I found the problem in an email from Volker to me from 2013.... (delete \"trac/\" from the remote branch name).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2818d1c5f14fbbbecb4e2e9d4e13e797fc6827b5\">2818d1c</a></td><td><code>#34029: eclib update to 20220621</code></td></tr></table>\n",
    "created_at": "2022-06-21T15:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549866",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:4" align="right">comment:4</div>

Well, in fact I found the problem in an email from Volker to me from 2013.... (delete "trac/" from the remote branch name).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2818d1c5f14fbbbecb4e2e9d4e13e797fc6827b5">2818d1c</a></td><td><code>#34029: eclib update to 20220621</code></td></tr></table>




---

archive/issue_comments_549867.json:
```json
{
    "body": "Commit: **[2818d1c](https://github.com/sagemath/sagetrac-mirror/commit/2818d1c5f14fbbbecb4e2e9d4e13e797fc6827b5)**",
    "created_at": "2022-06-21T15:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549867",
    "user": "https://github.com/JohnCremona"
}
```

Commit: **[2818d1c](https://github.com/sagemath/sagetrac-mirror/commit/2818d1c5f14fbbbecb4e2e9d4e13e797fc6827b5)**



---

archive/issue_comments_549868.json:
```json
{
    "body": "Branch: **[u/cremona/34029](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/34029)**",
    "created_at": "2022-06-21T15:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549868",
    "user": "https://github.com/JohnCremona"
}
```

Branch: **[u/cremona/34029](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/34029)**



---

archive/issue_comments_549869.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nseems that output changed, thus doctests fail, e.g.\n\n```\nFile \"src/sage/libs/eclib/mwrank.pyx\", line 589, in sage.libs.eclib.mwrank._mw.__init__\nFailed example:\n    EQ.search(1)\nExpected:\n    P1 = [0:1:0]         is torsion point, order 1\n    P1 = [-3:0:1]         is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Checking saturation at [ 2 3 ]\n...\n\nGot:\n    P1 = [0:1:0]         is torsion point, order 1\n    P1 = [-3:0:1]         is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Tamagawa index primes are [ 2 ]\n    Checking saturation at [ 2 3 ]\n...\n```\n\nso the new output has the line `Tamagawa index primes are [ 2 ]`, and the old does not.",
    "created_at": "2022-06-22T08:37:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549869",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

seems that output changed, thus doctests fail, e.g.

```
File "src/sage/libs/eclib/mwrank.pyx", line 589, in sage.libs.eclib.mwrank._mw.__init__
Failed example:
    EQ.search(1)
Expected:
    P1 = [0:1:0]         is torsion point, order 1
    P1 = [-3:0:1]         is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Checking saturation at [ 2 3 ]
...

Got:
    P1 = [0:1:0]         is torsion point, order 1
    P1 = [-3:0:1]         is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Tamagawa index primes are [ 2 ]
    Checking saturation at [ 2 3 ]
...
```

so the new output has the line `Tamagawa index primes are [ 2 ]`, and the old does not.



---

archive/issue_comments_549870.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nor here:\n\n```\nFile \"src/sage/libs/eclib/interface.py\", line 1213, in sage.libs.eclib.interface.mwrank_MordellWeil.sat\nurate\nFailed example:\n    EQ.saturate()\nExpected:\n    saturating basis...Saturation index bound (for points of good reduction) = 3\n    Tamagawa index primes are [ ]\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation\n    Points were proved 2-saturated (max q used = 11)\n    Checking 3-saturation\n    Points were proved 3-saturated (max q used = 13)\n    done\n    (True, 1, '[ ]')\nGot:\n    saturating basis...Saturation index bound (for points of good reduction)  = 3\n    Tamagawa index primes are [ 2 ]\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation \n    Points were proved 2-saturated (max q used = 11)\n    Checking 3-saturation \n    Points were proved 3-saturated (max q used = 13)\n    done\n    (True, 1, '[ ]')\n```\nagain, `Tamagawa index primes are [ 2 ]` vs `Tamagawa index primes are [ ]`",
    "created_at": "2022-06-22T08:40:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549870",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

or here:

```
File "src/sage/libs/eclib/interface.py", line 1213, in sage.libs.eclib.interface.mwrank_MordellWeil.sat
urate
Failed example:
    EQ.saturate()
Expected:
    saturating basis...Saturation index bound (for points of good reduction) = 3
    Tamagawa index primes are [ ]
    Checking saturation at [ 2 3 ]
    Checking 2-saturation
    Points were proved 2-saturated (max q used = 11)
    Checking 3-saturation
    Points were proved 3-saturated (max q used = 13)
    done
    (True, 1, '[ ]')
Got:
    saturating basis...Saturation index bound (for points of good reduction)  = 3
    Tamagawa index primes are [ 2 ]
    Checking saturation at [ 2 3 ]
    Checking 2-saturation 
    Points were proved 2-saturated (max q used = 11)
    Checking 3-saturation 
    Points were proved 3-saturated (max q used = 13)
    done
    (True, 1, '[ ]')
```
again, `Tamagawa index primes are [ 2 ]` vs `Tamagawa index primes are [ ]`



---

archive/issue_events_466081.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-22T08:41:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466081"
}
```



---

archive/issue_events_466082.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-22T08:41:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466082"
}
```



---

archive/issue_comments_549871.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nYes of course, I did not mark the ticket as ready for review yet.  But yesterday I could not even test it for the reasons I mentioned. I'll reinstall today and try again.\n\nBut thanks for testing.   The explanation for the difference in \"Tamagawa index primes\" is that these should include primes dividing the number of real components (which is 2 here) as well as the p-adic components (which are all 1 here).\n\nI'll fix the doctests once I can get the new code to work.  I don't know why it is giving me segfaults.  \"sage -mwrank\" works OK.",
    "created_at": "2022-06-22T09:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549871",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:8" align="right">comment:8</div>

Yes of course, I did not mark the ticket as ready for review yet.  But yesterday I could not even test it for the reasons I mentioned. I'll reinstall today and try again.

But thanks for testing.   The explanation for the difference in "Tamagawa index primes" is that these should include primes dividing the number of real components (which is 2 here) as well as the p-adic components (which are all 1 here).

I'll fix the doctests once I can get the new code to work.  I don't know why it is giving me segfaults.  "sage -mwrank" works OK.



---

archive/issue_comments_549872.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe good news is that I rebuilt sage from scratch and now it works.  I'll fix the doctests and update the branch.",
    "created_at": "2022-06-22T11:11:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549872",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:9" align="right">comment:9</div>

The good news is that I rebuilt sage from scratch and now it works.  I'll fix the doctests and update the branch.



---

archive/issue_comments_549873.json:
```json
{
    "body": "Changed commit from **[2818d1c](https://github.com/sagemath/sagetrac-mirror/commit/2818d1c5f14fbbbecb4e2e9d4e13e797fc6827b5)** to **[7293ebf](https://github.com/sagemath/sagetrac-mirror/commit/7293ebf249ef1299f664e7202e258c07652a96d0)**",
    "created_at": "2022-06-22T13:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549873",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2818d1c](https://github.com/sagemath/sagetrac-mirror/commit/2818d1c5f14fbbbecb4e2e9d4e13e797fc6827b5)** to **[7293ebf](https://github.com/sagemath/sagetrac-mirror/commit/7293ebf249ef1299f664e7202e258c07652a96d0)**



---

archive/issue_comments_549874.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7293ebf249ef1299f664e7202e258c07652a96d0\">7293ebf</a></td><td><code>fixed some doctests for eclib-20220621</code></td></tr></table>\n",
    "created_at": "2022-06-22T13:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549874",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7293ebf249ef1299f664e7202e258c07652a96d0">7293ebf</a></td><td><code>fixed some doctests for eclib-20220621</code></td></tr></table>




---

archive/issue_comments_549875.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nCommit 7293ebf fixes the doctests, I will add a new doctest to show that the problem posted here has been solved before setting to \"needs review\".",
    "created_at": "2022-06-22T14:47:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549875",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

Commit 7293ebf fixes the doctests, I will add a new doctest to show that the problem posted here has been solved before setting to "needs review".



---

archive/issue_comments_549876.json:
```json
{
    "body": "Changed commit from **[7293ebf](https://github.com/sagemath/sagetrac-mirror/commit/7293ebf249ef1299f664e7202e258c07652a96d0)** to **[604ca73](https://github.com/sagemath/sagetrac-mirror/commit/604ca73b1d282db5476c8c2e73e60fe912d45ce2)**",
    "created_at": "2022-06-22T16:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549876",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7293ebf](https://github.com/sagemath/sagetrac-mirror/commit/7293ebf249ef1299f664e7202e258c07652a96d0)** to **[604ca73](https://github.com/sagemath/sagetrac-mirror/commit/604ca73b1d282db5476c8c2e73e60fe912d45ce2)**



---

archive/issue_comments_549877.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/604ca73b1d282db5476c8c2e73e60fe912d45ce2\">604ca73</a></td><td><code>#34029: add doctest</code></td></tr></table>\n",
    "created_at": "2022-06-22T16:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549877",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/604ca73b1d282db5476c8c2e73e60fe912d45ce2">604ca73</a></td><td><code>#34029: add doctest</code></td></tr></table>




---

archive/issue_events_466083.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-22T16:02:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466083"
}
```



---

archive/issue_events_466084.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2022-06-22T16:02:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466084"
}
```



---

archive/issue_comments_549878.json:
```json
{
    "body": "Changed keywords from none to **eclib**",
    "created_at": "2022-06-22T16:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549878",
    "user": "https://github.com/JohnCremona"
}
```

Changed keywords from none to **eclib**



---

archive/issue_comments_549879.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThe two failing doctests in the logs have nothing to do with the changes on this ticket.",
    "created_at": "2022-06-23T07:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549879",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:14" align="right">comment:14</div>

The two failing doctests in the logs have nothing to do with the changes on this ticket.



---

archive/issue_events_466085.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-23T10:11:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466085"
}
```



---

archive/issue_events_466086.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-23T10:11:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466086"
}
```



---

archive/issue_comments_549880.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOne also needs to deal with potentially outdated eclibs provided by the system.\nMeaning that you have to decide whether to allow the older versions at all\n\ncurrently 20210625 is allowed from the system, and no other versions (cf. #31443)\n\nAnyway, build/pkgs/eclib/spkg-configure.m4 has to be updated.\nE.g. if you only want to allow 20220621, you simply need to replace the corresponding value\nin this file.\n\nIf you want to allow more, it'd be more work.\nOne can also do testing for eclib bugs there, and rejecting buggy system eclib\n(that's what we do with Pari).\n\n\n\nIndeed, testing this on Fedora 34 (which has 20210625) and getting\n\n```\nFile \"src/sage/schemes/elliptic_curves/ell_rational_field.py\", line 2615, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.saturation\nFailed example:\n    E.saturation([2*Q], max_prime=10)\nExpected:\n    ([(-82 : 54 : 1)], 2, 2.36570863272098)\nGot:\n    ([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)\n...\nFile \"src/sage/libs/eclib/interface.py\", line 727, in sage.libs.eclib.interface.mwrank_MordellWeil\nFailed example:\n    EQ.search(1)\nExpected:\n    P1 = [0:1:0]     is torsion point, order 1\n    P1 = [-3:0:1]     is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Tamagawa index primes are [ 2 ]\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation \n...\nGot:\n    P1 = [0:1:0]         is torsion point, order 1\n    P1 = [-3:0:1]         is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation \n...\n```\n(no wonder, it's the old eclib tested against updated doctests)",
    "created_at": "2022-06-23T10:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549880",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

One also needs to deal with potentially outdated eclibs provided by the system.
Meaning that you have to decide whether to allow the older versions at all

currently 20210625 is allowed from the system, and no other versions (cf. #31443)

Anyway, build/pkgs/eclib/spkg-configure.m4 has to be updated.
E.g. if you only want to allow 20220621, you simply need to replace the corresponding value
in this file.

If you want to allow more, it'd be more work.
One can also do testing for eclib bugs there, and rejecting buggy system eclib
(that's what we do with Pari).



Indeed, testing this on Fedora 34 (which has 20210625) and getting

```
File "src/sage/schemes/elliptic_curves/ell_rational_field.py", line 2615, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.saturation
Failed example:
    E.saturation([2*Q], max_prime=10)
Expected:
    ([(-82 : 54 : 1)], 2, 2.36570863272098)
Got:
    ([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)
...
File "src/sage/libs/eclib/interface.py", line 727, in sage.libs.eclib.interface.mwrank_MordellWeil
Failed example:
    EQ.search(1)
Expected:
    P1 = [0:1:0]     is torsion point, order 1
    P1 = [-3:0:1]     is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Tamagawa index primes are [ 2 ]
    Checking saturation at [ 2 3 ]
    Checking 2-saturation 
...
Got:
    P1 = [0:1:0]         is torsion point, order 1
    P1 = [-3:0:1]         is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Checking saturation at [ 2 3 ]
    Checking 2-saturation 
...
```
(no wonder, it's the old eclib tested against updated doctests)



---

archive/issue_comments_549881.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks Dima, I wanted to ask you about that m4 file.  I think we should just allow only eclib 20220621.  And I expect to make a similar restriction for future releases.  The only downside for (most of) those building Sage is that Sage will build eclib, as it always has done.\n\nI'll update that m4 file.",
    "created_at": "2022-06-23T10:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549881",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks Dima, I wanted to ask you about that m4 file.  I think we should just allow only eclib 20220621.  And I expect to make a similar restriction for future releases.  The only downside for (most of) those building Sage is that Sage will build eclib, as it always has done.

I'll update that m4 file.



---

archive/issue_comments_549882.json:
```json
{
    "body": "Changed commit from **[604ca73](https://github.com/sagemath/sagetrac-mirror/commit/604ca73b1d282db5476c8c2e73e60fe912d45ce2)** to **[9b65d73](https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e)**",
    "created_at": "2022-06-23T10:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549882",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[604ca73](https://github.com/sagemath/sagetrac-mirror/commit/604ca73b1d282db5476c8c2e73e60fe912d45ce2)** to **[9b65d73](https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e)**



---

archive/issue_comments_549883.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e\">9b65d73</a></td><td><code>#34029: update spkg-configure.m4</code></td></tr></table>\n",
    "created_at": "2022-06-23T10:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549883",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e">9b65d73</a></td><td><code>#34029: update spkg-configure.m4</code></td></tr></table>




---

archive/issue_comments_549884.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nlgtm",
    "created_at": "2022-06-23T12:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549884",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

lgtm



---

archive/issue_comments_549885.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2022-06-23T12:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549885",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_466087.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-23T12:29:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466087"
}
```



---

archive/issue_events_466088.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-06-23T12:29:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466088"
}
```



---

archive/issue_comments_549886.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWe can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.\nBut that's a minor issue.",
    "created_at": "2022-06-23T12:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549886",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

We can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.
But that's a minor issue.



---

archive/issue_comments_549887.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@dimpase](#comment:19):\n> We can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.\n> But that's a minor issue.\n\nThanks.  If the hard-coding is easy we could do that now?",
    "created_at": "2022-06-23T12:55:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549887",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@dimpase](#comment:19):
> We can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.
> But that's a minor issue.

Thanks.  If the hard-coding is easy we could do that now?



---

archive/issue_comments_549888.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI tried\n\n```diff\n--- a/build/pkgs/eclib/spkg-configure.m4\n+++ b/build/pkgs/eclib/spkg-configure.m4\n@@ -1,7 +1,7 @@\n SAGE_SPKG_CONFIGURE([eclib], [\n   SAGE_SPKG_DEPCHECK([ntl pari flint], [\n     dnl Trac #31443, #34029: use existing eclib only if the version reported by pkg-config is correct\n-    m4_pushdef([SAGE_ECLIB_VER],[\"20220621\"])\n+    m4_pushdef([SAGE_ECLIB_VER],[\"m4_include([build/pkgs/eclib/package-version.txt])\"])\n     PKG_CHECK_MODULES([ECLIB], [eclib = SAGE_ECLIB_VER], [\n       AC_CACHE_CHECK([for mwrank version == SAGE_ECLIB_VER], [ac_cv_path_MWRANK], [\n         AC_PATH_PROGS_FEATURE_CHECK([MWRANK], [mwrank], [\n```\nbut my m4 foo is not strong enough to make it work without warnings (something about multiple inclusion of this file pops up). Maybe Matthias knows a fix.",
    "created_at": "2022-06-23T13:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549888",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

I tried

```diff
--- a/build/pkgs/eclib/spkg-configure.m4
+++ b/build/pkgs/eclib/spkg-configure.m4
@@ -1,7 +1,7 @@
 SAGE_SPKG_CONFIGURE([eclib], [
   SAGE_SPKG_DEPCHECK([ntl pari flint], [
     dnl Trac #31443, #34029: use existing eclib only if the version reported by pkg-config is correct
-    m4_pushdef([SAGE_ECLIB_VER],["20220621"])
+    m4_pushdef([SAGE_ECLIB_VER],["m4_include([build/pkgs/eclib/package-version.txt])"])
     PKG_CHECK_MODULES([ECLIB], [eclib = SAGE_ECLIB_VER], [
       AC_CACHE_CHECK([for mwrank version == SAGE_ECLIB_VER], [ac_cv_path_MWRANK], [
         AC_PATH_PROGS_FEATURE_CHECK([MWRANK], [mwrank], [
```
but my m4 foo is not strong enough to make it work without warnings (something about multiple inclusion of this file pops up). Maybe Matthias knows a fix.



---

archive/issue_comments_549889.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI've also started a round of tests on https://github.com/sagemath/sagetrac-mirror/actions/runs/2554535605 - just in case.",
    "created_at": "2022-06-24T08:34:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549889",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

I've also started a round of tests on https://github.com/sagemath/sagetrac-mirror/actions/runs/2554535605 - just in case.



---

archive/issue_comments_549890.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWe do use `m4_include` for a similar purpose in `build/pkgs/perl_mongodb/spkg-configure.m4`. I think you are overquoting",
    "created_at": "2022-06-25T19:16:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549890",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

We do use `m4_include` for a similar purpose in `build/pkgs/perl_mongodb/spkg-configure.m4`. I think you are overquoting



---

archive/issue_comments_549891.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2022-07-08T12:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549891",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**



---

archive/issue_comments_549892.json:
```json
{
    "body": "Changed branch from **[u/cremona/34029](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/34029)** to **[9b65d73](https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e)**",
    "created_at": "2022-07-09T22:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34029#issuecomment-549892",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/cremona/34029](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/34029)** to **[9b65d73](https://github.com/sagemath/sagetrac-mirror/commit/9b65d73399b33043777ba628a4d318638aec6e0e)**



---

archive/issue_events_466089.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-09T22:33:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466089"
}
```



---

archive/issue_events_466090.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "890daa517b1a03bf00d97fdc320e223ecf80f528",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-07-09T22:33:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/34029",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34029#event-466090"
}
```
