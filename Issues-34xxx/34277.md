# Issue 34277: RealSet: Use self.__class__.__base__ in methods when constructing a new RealSet

archive/issues_034040.json:
```json
{
    "body": "... instead of hardcoding `RealSet`. This is preparation for #34278.\n\n(split out from #32170 - https://github.com/sagemath/sagetrac-mirror/compare/develop...public/32170)\n\n\nCC:  @yuan-zhou @tscrim\n\nAuthor: Binshuai Wang, Matthias Koeppe, Yuan Zhou\n\nBranch: u/yzh/realset__use_self___class___in_methods_when_constructing_a_new_realset\n\nStatus: needs_review\n\nDependencies: #32181\n\nCommit: eef3886573786e4a16f54b857e9171c22b0fab86\n\nIssue created by migration from https://trac.sagemath.org/ticket/34277\n\n",
    "created_at": "2022-08-04T18:48:55Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "RealSet: Use self.__class__.__base__ in methods when constructing a new RealSet",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34277",
    "user": "https://github.com/mkoeppe"
}
```
... instead of hardcoding `RealSet`. This is preparation for #34278.

(split out from #32170 - https://github.com/sagemath/sagetrac-mirror/compare/develop...public/32170)


CC:  @yuan-zhou @tscrim

Author: Binshuai Wang, Matthias Koeppe, Yuan Zhou

Branch: u/yzh/realset__use_self___class___in_methods_when_constructing_a_new_realset

Status: needs_review

Dependencies: #32181

Commit: eef3886573786e4a16f54b857e9171c22b0fab86

Issue created by migration from https://trac.sagemath.org/ticket/34277





---

archive/issue_comments_682800.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/realset__use_self___class___in_methods_when_constructing_a_new_realset\"",
    "created_at": "2022-08-05T04:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682800",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/realset__use_self___class___in_methods_when_constructing_a_new_realset"



---

archive/issue_comments_682801.json:
```json
{
    "body": "Changing commit from \"\" to \"5f60c4972d00f7f55394c7cab7afaf363fb87067\"",
    "created_at": "2022-08-05T04:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682801",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "5f60c4972d00f7f55394c7cab7afaf363fb87067"



---

archive/issue_comments_682802.json:
```json
{
    "body": "<a id='comment:2'></a>Cherry-picked from #32170\n\n---\nNew commits:",
    "created_at": "2022-08-05T04:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682802",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Cherry-picked from #32170

---
New commits:



---

archive/issue_comments_682803.json:
```json
{
    "body": "Changing author from \"\" to \"Binshuai Wang, ...\"",
    "created_at": "2022-08-05T04:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682803",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Binshuai Wang, ..."



---

archive/issue_comments_682804.json:
```json
{
    "body": "Changing commit from \"5f60c4972d00f7f55394c7cab7afaf363fb87067\" to \"a856e5dfd7cd2f5e9b0ac583b43aefc6d56b314a\"",
    "created_at": "2022-08-05T05:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5f60c4972d00f7f55394c7cab7afaf363fb87067" to "a856e5dfd7cd2f5e9b0ac583b43aefc6d56b314a"



---

archive/issue_comments_682805.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-08-05T05:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_682806.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32181\"",
    "created_at": "2022-08-05T05:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682806",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#32181"



---

archive/issue_comments_682807.json:
```json
{
    "body": "Changing author from \"Binshuai Wang, ...\" to \"Binshuai Wang, Matthias Koeppe, ...\"",
    "created_at": "2022-08-05T05:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682807",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Binshuai Wang, ..." to "Binshuai Wang, Matthias Koeppe, ..."



---

archive/issue_comments_682808.json:
```json
{
    "body": "<a id='comment:4'></a>Merged #32181 and resolved merge conflicts. \n\nHaven't checked whether everything that needs to be changed to `__class__` has been changed.",
    "created_at": "2022-08-05T05:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682808",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Merged #32181 and resolved merge conflicts. 

Haven't checked whether everything that needs to be changed to `__class__` has been changed.



---

archive/issue_comments_682809.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n-... instead of hardcoding `RealSet`.\n+... instead of hardcoding `RealSet`. This is preparation for #34278.\n \n (split out from #32170 - https://github.com/sagemath/sagetrac-mirror/compare/develop...public/32170)\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-08-05T05:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682809",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
-... instead of hardcoding `RealSet`.
+... instead of hardcoding `RealSet`. This is preparation for #34278.
 
 (split out from #32170 - https://github.com/sagemath/sagetrac-mirror/compare/develop...public/32170)
+
 
 Comment: 1
 
``````




---

archive/issue_comments_682810.json:
```json
{
    "body": "<a id='comment:6'></a>Bug example:\n\n```\nsage: r = RealSet(2,10)\nsage: RealSet(x > 2).intersection(RealSet(x < 10)) is RealSet(r[0], normalized=True)\n```\nExpect `True`. Got `False`.",
    "created_at": "2022-08-05T14:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682810",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:6'></a>Bug example:

```
sage: r = RealSet(2,10)
sage: RealSet(x > 2).intersection(RealSet(x < 10)) is RealSet(r[0], normalized=True)
```
Expect `True`. Got `False`.



---

archive/issue_comments_682811.json:
```json
{
    "body": "<a id='comment:7'></a>In the commit 5f60c49 from #32170, \nwhy is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places?",
    "created_at": "2022-08-05T14:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682811",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:7'></a>In the commit 5f60c49 from #32170, 
why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places?



---

archive/issue_comments_682812.json:
```json
{
    "body": "<a id='comment:8'></a>In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,\nwhy is it\n\n```\nintervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))\n```\ninstead of `self.__class__._scan_to_intervals`? \n\n(It was `RealSet._scan_to_intervals`)",
    "created_at": "2022-08-05T15:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682812",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:8'></a>In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,
why is it

```
intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))
```
instead of `self.__class__._scan_to_intervals`? 

(It was `RealSet._scan_to_intervals`)



---

archive/issue_comments_682813.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 yzh]:\n> In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,\n> why is it\n> \n> ```\n> intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))\n> ```\n> instead of `self.__class__._scan_to_intervals`? \n> \n> (It was `RealSet._scan_to_intervals`)\n\n\n`_scan_to_intervals` is a `staticmethod`, so `self._scan_to_intervals(...)` is the same thing as `self.__class__._scan_to_intervals`.",
    "created_at": "2022-08-05T15:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682813",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Replying to [comment:8 yzh]:
> In `def union(self, *real_set_collection)` and `intersection(self, *real_set_collection)`,
> why is it
> 
> ```
> intervals = tuple(self._scan_to_intervals(scan, lambda i: i > 0))
> ```
> instead of `self.__class__._scan_to_intervals`? 
> 
> (It was `RealSet._scan_to_intervals`)


`_scan_to_intervals` is a `staticmethod`, so `self._scan_to_intervals(...)` is the same thing as `self.__class__._scan_to_intervals`.



---

archive/issue_comments_682814.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:7 yzh]:\n> In the commit 5f60c49 from #32170, \n> why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places? \n\n\nAs I said, I haven't checked whether all necessary changes have been made",
    "created_at": "2022-08-05T15:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682814",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Replying to [comment:7 yzh]:
> In the commit 5f60c49 from #32170, 
> why is it sometimes `isinstance(other, RealSet)` but `isinstance(right, self.__class__)` in other places? Why is it `RealSet.point(...)` and `RealSet._prep(...)` sometimes but `self.__class__.real_line()` in other places? 


As I said, I haven't checked whether all necessary changes have been made



---

archive/issue_comments_682815.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/realset__use_self___class___in_methods_when_constructing_a_new_realset\" to \"u/yzh/realset__use_self___class___in_methods_when_constructing_a_new_realset\"",
    "created_at": "2022-08-05T20:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682815",
    "user": "https://github.com/yuan-zhou"
}
```

Changing branch from "u/mkoeppe/realset__use_self___class___in_methods_when_constructing_a_new_realset" to "u/yzh/realset__use_self___class___in_methods_when_constructing_a_new_realset"



---

archive/issue_comments_682816.json:
```json
{
    "body": "Changing commit from \"a856e5dfd7cd2f5e9b0ac583b43aefc6d56b314a\" to \"c97b9f75114ab40206895eac142cf18a750d2973\"",
    "created_at": "2022-08-05T20:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682816",
    "user": "https://github.com/yuan-zhou"
}
```

Changing commit from "a856e5dfd7cd2f5e9b0ac583b43aefc6d56b314a" to "c97b9f75114ab40206895eac142cf18a750d2973"



---

archive/issue_comments_682817.json:
```json
{
    "body": "<a id='comment:12'></a>Unfortunately, the previous bug example remains.\n\n```\nsage: r = RealSet(2,10)\nsage: r is r.__class__(r)\nTrue\nsage: r is r.__class__(r[0])\nFalse\nsage: r is r.__class__(r[0], normalized=True)\nFalse\n```\n\n---\nNew commits:",
    "created_at": "2022-08-05T20:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682817",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:12'></a>Unfortunately, the previous bug example remains.

```
sage: r = RealSet(2,10)
sage: r is r.__class__(r)
True
sage: r is r.__class__(r[0])
False
sage: r is r.__class__(r[0], normalized=True)
False
```

---
New commits:



---

archive/issue_comments_682818.json:
```json
{
    "body": "Changing author from \"Binshuai Wang, Matthias Koeppe, ...\" to \"Binshuai Wang, Matthias Koeppe, Yuan Zhou\"",
    "created_at": "2022-08-05T21:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682818",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Binshuai Wang, Matthias Koeppe, ..." to "Binshuai Wang, Matthias Koeppe, Yuan Zhou"



---

archive/issue_comments_682819.json:
```json
{
    "body": "Changing commit from \"c97b9f75114ab40206895eac142cf18a750d2973\" to \"42f4dd68c67068b6ed1a0a2e2cf0518af3e56279\"",
    "created_at": "2022-08-06T18:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c97b9f75114ab40206895eac142cf18a750d2973" to "42f4dd68c67068b6ed1a0a2e2cf0518af3e56279"



---

archive/issue_comments_682820.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-06T18:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_682821.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-06T18:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682821",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_682822.json:
```json
{
    "body": "<a id='comment:17'></a>More changes in the same direction can be cherry-picked from #34278",
    "created_at": "2022-08-07T02:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682822",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>More changes in the same direction can be cherry-picked from #34278



---

archive/issue_comments_682823.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T02:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_682824.json:
```json
{
    "body": "Changing commit from \"42f4dd68c67068b6ed1a0a2e2cf0518af3e56279\" to \"eef3886573786e4a16f54b857e9171c22b0fab86\"",
    "created_at": "2022-08-07T02:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "42f4dd68c67068b6ed1a0a2e2cf0518af3e56279" to "eef3886573786e4a16f54b857e9171c22b0fab86"



---

archive/issue_comments_682825.json:
```json
{
    "body": "<a id='comment:19'></a>cherry-picked the relevant commits from #34278.",
    "created_at": "2022-08-07T02:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34277#issuecomment-682825",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:19'></a>cherry-picked the relevant commits from #34278.



---

archive/issue_events_089324.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34277",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34277#event-89324"
}
```
