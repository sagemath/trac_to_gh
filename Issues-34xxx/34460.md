# Issue 34460: Update ipywidgets to 8.0.x, widgetsnbextension to 4.0.x

archive/issues_034223.json:
```json
{
    "body": "Most breakage comes from the switch from `_ipython_display` to `_repr_mimebundle_` [1], which adds a mimetype to the text representation of widgets, breaking many tests. This also drops `on_displayed`, I replaced it with `on_widget_constructed` which seems to do the same for our purposes.\n\nAlso, dicts are no longer allowed as drop down list content [2], so we port them to lists of tuples.\n\n\n[1] https://github.com/jupyter-widgets/ipywidgets/commit/7ae97acc96ce9f78bd43dbd0778cd7db36804966\n\n[2] https://github.com/jupyter-widgets/ipywidgets/commit/9db179bd34ea14f396851e2e06e2641e26908b9d\n\n**CC:**  @mkoeppe @kiwifb @tornaria @collares @vbraun @egourgoulhon\n\n**Branch/Commit:** [c6881bbba4333243ef6badc14b959e516f4bc39a](https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a)\n\n**Reviewer:** Fran\u00e7ois Bissey, Mauricio Collares, Eric Gourgoulhon\n\n**Author:** Antonio Rojas, Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/34460\n\n",
    "closed_at": "2022-10-23T20:49:31Z",
    "created_at": "2022-08-30T18:44:44Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Update ipywidgets to 8.0.x, widgetsnbextension to 4.0.x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34460",
    "user": "https://github.com/antonio-rojas"
}
```
Most breakage comes from the switch from `_ipython_display` to `_repr_mimebundle_` [1], which adds a mimetype to the text representation of widgets, breaking many tests. This also drops `on_displayed`, I replaced it with `on_widget_constructed` which seems to do the same for our purposes.

Also, dicts are no longer allowed as drop down list content [2], so we port them to lists of tuples.


[1] https://github.com/jupyter-widgets/ipywidgets/commit/7ae97acc96ce9f78bd43dbd0778cd7db36804966

[2] https://github.com/jupyter-widgets/ipywidgets/commit/9db179bd34ea14f396851e2e06e2641e26908b9d

**CC:**  @mkoeppe @kiwifb @tornaria @collares @vbraun @egourgoulhon

**Branch/Commit:** [c6881bbba4333243ef6badc14b959e516f4bc39a](https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a)

**Reviewer:** Fran√ßois Bissey, Mauricio Collares, Eric Gourgoulhon

**Author:** Antonio Rojas, Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/34460





---

archive/issue_comments_559170.json:
```json
{
    "body": "**Branch:** [u/arojas/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/fix_tests_with_ipywidgets_8)",
    "created_at": "2022-08-30T18:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559170",
    "user": "https://github.com/antonio-rojas"
}
```

**Branch:** [u/arojas/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/fix_tests_with_ipywidgets_8)



---

archive/issue_comments_559171.json:
```json
{
    "body": "**Author:** Antonio Rojas",
    "created_at": "2022-08-30T18:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559171",
    "user": "https://github.com/antonio-rojas"
}
```

**Author:** Antonio Rojas



---

archive/issue_comments_559172.json:
```json
{
    "body": "**Commit:** [4bc16f29d999da9d0b33b3c868f82d8af407826b](https://github.com/sagemath/sagetrac-mirror/commit/4bc16f29d999da9d0b33b3c868f82d8af407826b)",
    "created_at": "2022-08-30T18:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559172",
    "user": "https://github.com/antonio-rojas"
}
```

**Commit:** [4bc16f29d999da9d0b33b3c868f82d8af407826b](https://github.com/sagemath/sagetrac-mirror/commit/4bc16f29d999da9d0b33b3c868f82d8af407826b)



---

archive/issue_comments_559173.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bc16f29d999da9d0b33b3c868f82d8af407826b\">4bc16f2</a></td><td><code>Fix tests with ipywidgets 8</code></td></tr></table>\n",
    "created_at": "2022-08-30T18:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559173",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bc16f29d999da9d0b33b3c868f82d8af407826b">4bc16f2</a></td><td><code>Fix tests with ipywidgets 8</code></td></tr></table>




---

archive/issue_events_306184.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-08-30T18:51:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306184"
}
```



---

archive/issue_events_306185.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-08-30T18:51:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306185"
}
```



---

archive/issue_events_306186.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-08-30T18:51:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "component: packages: standard",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306186"
}
```



---

archive/issue_comments_559174.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,9 @@\n+Most breakage comes from the switch from `_ipython_display` to `_repr_mimebundle_` [1], which adds a mimetype to the text representation of widgets, breaking many tests. This also drops `on_displayed`, I replaced it with `on_widget_constructed` which seems to do the same for our purposes.\n \n+Also, dicts are no longer allowed as drop down list content [2], so we port them to lists of tuples.\n+\n+I've kept the changes compatible with ipywidgets<8 so this can be merged quickly and leave the actual upgrade to another ticket.\n+\n+[1] https://github.com/jupyter-widgets/ipywidgets/commit/7ae97acc96ce9f78bd43dbd0778cd7db36804966\n+\n+[2] https://github.com/jupyter-widgets/ipywidgets/commit/9db179bd34ea14f396851e2e06e2641e26908b9d\n``````\n",
    "created_at": "2022-08-30T18:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559174",
    "user": "https://github.com/antonio-rojas"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,9 @@
+Most breakage comes from the switch from `_ipython_display` to `_repr_mimebundle_` [1], which adds a mimetype to the text representation of widgets, breaking many tests. This also drops `on_displayed`, I replaced it with `on_widget_constructed` which seems to do the same for our purposes.
 
+Also, dicts are no longer allowed as drop down list content [2], so we port them to lists of tuples.
+
+I've kept the changes compatible with ipywidgets<8 so this can be merged quickly and leave the actual upgrade to another ticket.
+
+[1] https://github.com/jupyter-widgets/ipywidgets/commit/7ae97acc96ce9f78bd43dbd0778cd7db36804966
+
+[2] https://github.com/jupyter-widgets/ipywidgets/commit/9db179bd34ea14f396851e2e06e2641e26908b9d
``````




---

archive/issue_events_306187.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306187"
}
```



---

archive/issue_events_306188.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306188"
}
```



---

archive/issue_comments_559175.json:
```json
{
    "body": "<a id='comment:4'></a>\nNot 100% sure this is related, but after upgrading jupyter-widgets and related packages I am seeing 21 failing tests in `src/sage/interacts/test_jupyter.rst`. They all have control sequences/escape characters such as:\n\n```\nsage -t --long --random-seed=250623221176838603645666806457165844244 /nix/store/39k0iiwx3wi7jikqnzbqh7hrrlpivm78-sage-src-9.7/src/sage/interacts/test_jupyter.rst\n**********************************************************************\nFile \"/nix/store/39k0iiwx3wi7jikqnzbqh7hrrlpivm78-sage-src-9.7/src/sage/interacts/test_jupyter.rst\", line 180, in sage.interacts.test_jupyter\nFailed example:\n    test(interacts.calculus.bisection_method)\nExpected:\n    Interactive function <function bisection_method at ...> with 5 widgets\n      title: HTMLText(value='<h2>Bisection method</h2>')\n      f: EvalText(value='x^2-2', description='f(x)', layout=Layout(max_width='81em'))\n      interval: IntRangeSlider(value=(0, 4), description='range', max=5, min=-5)\n      d: IntSlider(value=3, description='$10^{-d}$ precision', max=8, min=1)\n      maxn: IntSlider(value=10, description='max iterations', max=50)\n    \\(\\text{Precision }h = 10^{-d}=10^{-3}=0.00100\\)\n    \\({c = }1.4140625\\)\n    \\({f(c) = }-0.00042724609375\\)\n    \\(9 \\text{ iterations}\\)\nGot:\n    <CSI-2K>^M<CSI-2K>^M\\(\\text{Precision }h = 10^{-d}=10^{-3}=0.00100\\)\n    \\({c = }1.4140625\\)\n    \\({f(c) = }-0.00042724609375\\)\n    \\(9 \\text{ iterations}\\)\n    Interactive function <function bisection_method at 0x7fff88569630> with 5 widgets\n      title: HTMLText(value='<h2>Bisection method</h2>')\n      f: EvalText(value='x^2-2', description='f(x)', layout=Layout(max_width='81em'))\n      interval: IntRangeSlider(value=(0, 4), description='range', max=5, min=-5)\n      d: IntSlider(value=3, description='$10^{-d}$ precision', max=8, min=1)\n      maxn: IntSlider(value=10, description='max iterations', max=50)\n    \\(\\text{Precision }h = 10^{-d}=10^{-3}=0.00100\\)\n    \\({c = }1.4140625\\)\n    \\({f(c) = }-0.00042724609375\\)\n    \\(9 \\text{ iterations}\\)\n**********************************************************************\nFile \"/nix/store/39k0iiwx3wi7jikqnzbqh7hrrlpivm78-sage-src-9.7/src/sage/interacts/test_jupyter.rst\", line 192, in sage.interacts.test_jupyter\nFailed example:\n    test(interacts.calculus.riemann_sum)\nExpected:\n    Manual interactive function <function riemann_sum at ...> with 9 widgets\n      title: HTMLText(value='<h2>Riemann integral with random sampling</h2>')\n      f: EvalText(value='x^2+1', description='$f(x)=$', layout=Layout(max_width='41em'))\n      n: IntSlider(value=5, description='# divisions', max=30, min=1)\n      hr1: HTMLText(value='<hr>')\n      interval_input: ToggleButtons(description='Integration interval', options=('from slider', 'from keyboard'), value='from slider')\n      interval_s: IntRangeSlider(value=(0, 2), description='slider: ', max=10, min=-5)\n      interval_g: Grid(value=[[0, 2]], children=(Label(value='keyboard: '), VBox(children=(EvalText(value='0', layout=Layout(max_width='5em')),)), VBox(children=(EvalText(value='2', layout=Layout(max_width='5em')),))))\n      hr2: HTMLText(value='<hr>')\n      list_table: Checkbox(value=False, description='List table')\n    <small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=...\\)\n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} +\n    1\\,\\mathrm{d}x=4.666666666666668\\)\nGot:\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.127671780067391\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.684039567609587\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.477886877874835\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=5.613881858984628\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=6.228858742666399\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.598306339045656\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.45910993544406\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=5.285792626236389\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=5.348125253390601\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=5.376388761226274\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=3.823901934033623\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=5.424469987768077\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=6.089305916730408\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.340945220537433\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=3.98349497390619\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.803422027740802\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.42705500648823\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=6.256746951601706\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=6.051441325477226\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=3.8867582141357317\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=5.553517548071945\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.313714559213407\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n    Manual interactive function <function riemann_sum at 0x7fff8856b880> with 9 widgets\n      title: HTMLText(value='<h2>Riemann integral with random sampling</h2>')\n      f: EvalText(value='x^2+1', description='$f(x)=$', layout=Layout(max_width='41em'))\n      n: IntSlider(value=5, description='# divisions', max=30, min=1)\n      hr1: HTMLText(value='<hr>')\n      interval_input: ToggleButtons(description='Integration interval', options=('from slider', 'from keyboard'), value='from slider')\n      interval_s: IntRangeSlider(value=(0, 2), description='slider: ', max=10, min=-5)\n      interval_g: Grid(value=[[0, 2]], children=(Label(value='keyboard: '), VBox(children=(EvalText(value='0', layout=Layout(max_width='5em')),)), VBox(children=(EvalText(value='2', layout=Layout(max_width='5em')),))))\n      hr2: HTMLText(value='<hr>')\n      list_table: Checkbox(value=False, description='List table')\n    <small>Adjust your data and click Update button. Click repeatedly for another random values.</small>\n    Riemann sum: \\(\\displaystyle\\sum_{i=1}^{5} f(\\eta_i)(x_i-x_{i-1})=4.530774274990167\\) \n    Exact value of the integral \\(\\displaystyle\\int_{0}^{2}x^{2} + 1\\,\\mathrm{d}x=4.666666666666668\\)\n```\nLooks like some code is not testing if the terminal is capable of processing those escape sequences.",
    "created_at": "2022-09-22T19:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559175",
    "user": "https://github.com/collares"
}
```

<a id='comment:4'></a>
Not 100% sure this is related, but after upgrading jupyter-widgets and related packages I am seeing 21 failing tests in `src/sage/interacts/test_jupyter.rst`. They all have control sequences/escape characters such as:

```
sage -t --long --random-seed=250623221176838603645666806457165844244 /nix/store/39k0iiwx3wi7jikqnzbqh7hrrlpivm78-sage-src-9.7/src/sage/interacts/test_jupyter.rst
**********************************************************************
File "/nix/store/39k0iiwx3wi7jikqnzbqh7hrrlpivm78-sage-src-9.7/src/sage/interacts/test_jupyter.rst", line 180, in sage.interacts.test_jupyter
Failed example:
    test(interacts.calculus.bisection_method)
Expected:
    Interactive function <function bisection_method at ...> with 5 widgets
      title: HTMLText(value='<h2>Bisection method</h2>')
      f: EvalText(value='x^2-2', description='f(x)', layout=Layout(max_width='81em'))
      interval: IntRangeSlider(value=(0, 4), description='range', max=5, min=-5)
      d: IntSlider(value=3, description='$10^{-d}$ precision', max=8, min=1)
      maxn: IntSlider(value=10, description='max iterations', max=50)
    \(\text{Precision }h = 10^{-d}=10^{-3}=0.00100\)
    \({c = }1.4140625\)
    \({f(c) = }-0.00042724609375\)
    \(9 \text{ iterations}\)
Got:
    <CSI-2K>^M<CSI-2K>^M\(\text{Precision }h = 10^{-d}=10^{-3}=0.00100\)
    \({c = }1.4140625\)
    \({f(c) = }-0.00042724609375\)
    \(9 \text{ iterations}\)
    Interactive function <function bisection_method at 0x7fff88569630> with 5 widgets
      title: HTMLText(value='<h2>Bisection method</h2>')
      f: EvalText(value='x^2-2', description='f(x)', layout=Layout(max_width='81em'))
      interval: IntRangeSlider(value=(0, 4), description='range', max=5, min=-5)
      d: IntSlider(value=3, description='$10^{-d}$ precision', max=8, min=1)
      maxn: IntSlider(value=10, description='max iterations', max=50)
    \(\text{Precision }h = 10^{-d}=10^{-3}=0.00100\)
    \({c = }1.4140625\)
    \({f(c) = }-0.00042724609375\)
    \(9 \text{ iterations}\)
**********************************************************************
File "/nix/store/39k0iiwx3wi7jikqnzbqh7hrrlpivm78-sage-src-9.7/src/sage/interacts/test_jupyter.rst", line 192, in sage.interacts.test_jupyter
Failed example:
    test(interacts.calculus.riemann_sum)
Expected:
    Manual interactive function <function riemann_sum at ...> with 9 widgets
      title: HTMLText(value='<h2>Riemann integral with random sampling</h2>')
      f: EvalText(value='x^2+1', description='$f(x)=$', layout=Layout(max_width='41em'))
      n: IntSlider(value=5, description='# divisions', max=30, min=1)
      hr1: HTMLText(value='<hr>')
      interval_input: ToggleButtons(description='Integration interval', options=('from slider', 'from keyboard'), value='from slider')
      interval_s: IntRangeSlider(value=(0, 2), description='slider: ', max=10, min=-5)
      interval_g: Grid(value=[[0, 2]], children=(Label(value='keyboard: '), VBox(children=(EvalText(value='0', layout=Layout(max_width='5em')),)), VBox(children=(EvalText(value='2', layout=Layout(max_width='5em')),))))
      hr2: HTMLText(value='<hr>')
      list_table: Checkbox(value=False, description='List table')
    <small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=...\)
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} +
    1\,\mathrm{d}x=4.666666666666668\)
Got:
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.127671780067391\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.684039567609587\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.477886877874835\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=5.613881858984628\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=6.228858742666399\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.598306339045656\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.45910993544406\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=5.285792626236389\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=5.348125253390601\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=5.376388761226274\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=3.823901934033623\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=5.424469987768077\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=6.089305916730408\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.340945220537433\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=3.98349497390619\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.803422027740802\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.42705500648823\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=6.256746951601706\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=6.051441325477226\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=3.8867582141357317\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=5.553517548071945\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    <CSI-2K>^M<CSI-2K>^M<small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.313714559213407\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
    Manual interactive function <function riemann_sum at 0x7fff8856b880> with 9 widgets
      title: HTMLText(value='<h2>Riemann integral with random sampling</h2>')
      f: EvalText(value='x^2+1', description='$f(x)=$', layout=Layout(max_width='41em'))
      n: IntSlider(value=5, description='# divisions', max=30, min=1)
      hr1: HTMLText(value='<hr>')
      interval_input: ToggleButtons(description='Integration interval', options=('from slider', 'from keyboard'), value='from slider')
      interval_s: IntRangeSlider(value=(0, 2), description='slider: ', max=10, min=-5)
      interval_g: Grid(value=[[0, 2]], children=(Label(value='keyboard: '), VBox(children=(EvalText(value='0', layout=Layout(max_width='5em')),)), VBox(children=(EvalText(value='2', layout=Layout(max_width='5em')),))))
      hr2: HTMLText(value='<hr>')
      list_table: Checkbox(value=False, description='List table')
    <small>Adjust your data and click Update button. Click repeatedly for another random values.</small>
    Riemann sum: \(\displaystyle\sum_{i=1}^{5} f(\eta_i)(x_i-x_{i-1})=4.530774274990167\) 
    Exact value of the integral \(\displaystyle\int_{0}^{2}x^{2} + 1\,\mathrm{d}x=4.666666666666668\)
```
Looks like some code is not testing if the terminal is capable of processing those escape sequences.



---

archive/issue_comments_559176.json:
```json
{
    "body": "<a id='comment:5'></a>\nOn ipywidgets 7, replacing `on_displayed` by `on_widget_constructed` causes test failures. Removing the `on_displayed` lines altogether, however, passes tests (I haven't checked the actual interactive widgets, though):\n\n```diff\ndiff --git a/src/sage/combinat/cluster_algebra_quiver/interact.py b/src/sage/combinat/cluster_algebra_quiver/interact.py\nindex 1c88e613b4..f74039213c 100644\n--- a/src/sage/combinat/cluster_algebra_quiver/interact.py\n+++ b/src/sage/combinat/cluster_algebra_quiver/interact.py\n@@ -107,8 +107,6 @@ def cluster_interact(self, fig_size=1, circular=True, kind='seed'):\n     show_lastmutation.observe(refresh, 'value')\n     which_plot.observe(refresh, 'value')\n \n-    mut_buttons.on_widget_constructed(refresh)\n-\n     if kind == 'seed':\n         top = widgets.HBox([show_seq, show_vars])\n     else:\ndiff --git a/src/sage/repl/ipython_kernel/interact.py b/src/sage/repl/ipython_kernel/interact.py\nindex 4f96a212ab..23699601a3 100644\n--- a/src/sage/repl/ipython_kernel/interact.py\n+++ b/src/sage/repl/ipython_kernel/interact.py\n@@ -124,10 +124,7 @@ class sage_interactive(interactive):\n \n         self.__signature = sig.replace(parameters=params.values())\n         super().__init__(f, options, **kwds)\n-        if self.manual:\n-            # In Sage, manual interacts are always run once\n-            self.on_widget_constructed(self.update)\n-        else:\n+        if not self.manual:\n             # In automatic mode, clicking on a ToggleButtons button\n             # should also run the interact\n             for widget in self.kwargs_widgets:\n```\n\nCalling `self.update()` instead of deleting the second `on_widget_constructed` prints an extra line and causes test failures on ipywidgets 7 (calling `refresh(None)` manually does not cause test failures, but it would be a bit asymmetrical to do so).\n\nOn ipywidgets 8, the 20 occurrences of \"Interactive function\" in `src/sage/interacts/test_jupyter.rst` need to be replaced by \"...Interactive function\", similar to other changes made in this branch. With this replacement and the above patch, there is a single test failure caused by a doctest warning appearing in the wrong order:\n\n```\nFailed example:\n    test(interacts.statistics.coin)\nExpected:\n    ...Interactive function <function coin at ...> with 2 widgets\n      n: IntSlider(value=1000, description='Number of Tosses', max=10000, min=2, step=100)\n      interval: IntRangeSlider(value=(0, 0), description='Plotting range (y)', max=1)\n    doctest:...: UserWarning: Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.\nGot:\ndoctest:warning\n[...]\n    :\n    UserWarning: Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.\n    Interactive function <function coin at 0x7fff8872f250> with 2 widgets\n      n: IntSlider(value=1000, description='Number of Tosses', max=10000, min=2, step=100)\n      interval: IntRangeSlider(value=(0, 0), description='Plotting range (y)', max=1)\n```\n\n(`[...]` indicates lines I deleted for brevity).",
    "created_at": "2022-09-24T03:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559176",
    "user": "https://github.com/collares"
}
```

<a id='comment:5'></a>
On ipywidgets 7, replacing `on_displayed` by `on_widget_constructed` causes test failures. Removing the `on_displayed` lines altogether, however, passes tests (I haven't checked the actual interactive widgets, though):

```diff
diff --git a/src/sage/combinat/cluster_algebra_quiver/interact.py b/src/sage/combinat/cluster_algebra_quiver/interact.py
index 1c88e613b4..f74039213c 100644
--- a/src/sage/combinat/cluster_algebra_quiver/interact.py
+++ b/src/sage/combinat/cluster_algebra_quiver/interact.py
@@ -107,8 +107,6 @@ def cluster_interact(self, fig_size=1, circular=True, kind='seed'):
     show_lastmutation.observe(refresh, 'value')
     which_plot.observe(refresh, 'value')
 
-    mut_buttons.on_widget_constructed(refresh)
-
     if kind == 'seed':
         top = widgets.HBox([show_seq, show_vars])
     else:
diff --git a/src/sage/repl/ipython_kernel/interact.py b/src/sage/repl/ipython_kernel/interact.py
index 4f96a212ab..23699601a3 100644
--- a/src/sage/repl/ipython_kernel/interact.py
+++ b/src/sage/repl/ipython_kernel/interact.py
@@ -124,10 +124,7 @@ class sage_interactive(interactive):
 
         self.__signature = sig.replace(parameters=params.values())
         super().__init__(f, options, **kwds)
-        if self.manual:
-            # In Sage, manual interacts are always run once
-            self.on_widget_constructed(self.update)
-        else:
+        if not self.manual:
             # In automatic mode, clicking on a ToggleButtons button
             # should also run the interact
             for widget in self.kwargs_widgets:
```

Calling `self.update()` instead of deleting the second `on_widget_constructed` prints an extra line and causes test failures on ipywidgets 7 (calling `refresh(None)` manually does not cause test failures, but it would be a bit asymmetrical to do so).

On ipywidgets 8, the 20 occurrences of "Interactive function" in `src/sage/interacts/test_jupyter.rst` need to be replaced by "...Interactive function", similar to other changes made in this branch. With this replacement and the above patch, there is a single test failure caused by a doctest warning appearing in the wrong order:

```
Failed example:
    test(interacts.statistics.coin)
Expected:
    ...Interactive function <function coin at ...> with 2 widgets
      n: IntSlider(value=1000, description='Number of Tosses', max=10000, min=2, step=100)
      interval: IntRangeSlider(value=(0, 0), description='Plotting range (y)', max=1)
    doctest:...: UserWarning: Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.
Got:
doctest:warning
[...]
    :
    UserWarning: Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.
    Interactive function <function coin at 0x7fff8872f250> with 2 widgets
      n: IntSlider(value=1000, description='Number of Tosses', max=10000, min=2, step=100)
      interval: IntRangeSlider(value=(0, 0), description='Plotting range (y)', max=1)
```

(`[...]` indicates lines I deleted for brevity).



---

archive/issue_comments_559177.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [Mauricio Collares](#comment%3A5):\n> On ipywidgets 7, replacing `on_displayed` by `on_widget_constructed` causes test failures.\n\n\nSince this ticket missed 9.7 and is now aimed at 9.8, I think we can just turn it into an actual upgrate ticket and not worry about ipywidgets 7 compatibility.\n\n\n> Removing the `on_displayed` lines altogether, however, passes tests (I haven't checked the actual interactive widgets, though):\n\n\nI did test the widget, and removing `on_displayed` made the graph not be populated on load, until you click one of the buttons.\n\n> On ipywidgets 8, the 20 occurrences of \"Interactive function\" in `src/sage/interacts/test_jupyter.rst` need to be replaced by \"...Interactive function\", similar to other changes made in this branch.\n\n\nThanks, I only test the installed bits so that explains why I missed those.\n\n> With this replacement and the above patch, there is a single test failure caused by a doctest warning appearing in the wrong order:\n\n\nWhere is the `doctest:...` line in the expected output coming from? It's neither in the current code nor in this branch.",
    "created_at": "2022-09-24T08:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559177",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:6'></a>
Replying to [Mauricio Collares](#comment%3A5):
> On ipywidgets 7, replacing `on_displayed` by `on_widget_constructed` causes test failures.


Since this ticket missed 9.7 and is now aimed at 9.8, I think we can just turn it into an actual upgrate ticket and not worry about ipywidgets 7 compatibility.


> Removing the `on_displayed` lines altogether, however, passes tests (I haven't checked the actual interactive widgets, though):


I did test the widget, and removing `on_displayed` made the graph not be populated on load, until you click one of the buttons.

> On ipywidgets 8, the 20 occurrences of "Interactive function" in `src/sage/interacts/test_jupyter.rst` need to be replaced by "...Interactive function", similar to other changes made in this branch.


Thanks, I only test the installed bits so that explains why I missed those.

> With this replacement and the above patch, there is a single test failure caused by a doctest warning appearing in the wrong order:


Where is the `doctest:...` line in the expected output coming from? It's neither in the current code nor in this branch.



---

archive/issue_comments_559178.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [Antonio Rojas](#comment%3A6):\n> Where is the `doctest:...` line in the expected output coming from? It's neither in the current code nor in this branch.\n\n\nNevermind, I was looking at the wrong file",
    "created_at": "2022-09-24T08:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559178",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:7'></a>
Replying to [Antonio Rojas](#comment%3A6):
> Where is the `doctest:...` line in the expected output coming from? It's neither in the current code nor in this branch.


Nevermind, I was looking at the wrong file



---

archive/issue_comments_559179.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0eeef35513c0e5e26808ed62a33623ef904bab0c\">0eeef35</a></td><td><code>Fix tests with ipywidgets 8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bce7ac2956a4e9c5642855baf6eee7792b207217\">bce7ac2</a></td><td><code>Fix tests in sage.interacts.test_jupyter.rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2816dbacb342398a23bb3099e20c92c8020ab0fa\">2816dba</a></td><td><code>Update ipywidgets and widgetsnbextension</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53085e13f04b30d3605482b1639ca7b8e2d59b70\">53085e1</a></td><td><code>Merge branch 'u/arojas/fix_tests_with_ipywidgets_8' of git://trac.sagemath.org/sage into t/34460/fix_tests_with_ipywidgets_8</code></td></tr></table>\n",
    "created_at": "2022-09-24T20:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559179",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0eeef35513c0e5e26808ed62a33623ef904bab0c">0eeef35</a></td><td><code>Fix tests with ipywidgets 8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bce7ac2956a4e9c5642855baf6eee7792b207217">bce7ac2</a></td><td><code>Fix tests in sage.interacts.test_jupyter.rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2816dbacb342398a23bb3099e20c92c8020ab0fa">2816dba</a></td><td><code>Update ipywidgets and widgetsnbextension</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53085e13f04b30d3605482b1639ca7b8e2d59b70">53085e1</a></td><td><code>Merge branch 'u/arojas/fix_tests_with_ipywidgets_8' of git://trac.sagemath.org/sage into t/34460/fix_tests_with_ipywidgets_8</code></td></tr></table>




---

archive/issue_comments_559180.json:
```json
{
    "body": "**Changing commit** from \"[4bc16f29d999da9d0b33b3c868f82d8af407826b](https://github.com/sagemath/sagetrac-mirror/commit/4bc16f29d999da9d0b33b3c868f82d8af407826b)\" to \"[53085e13f04b30d3605482b1639ca7b8e2d59b70](https://github.com/sagemath/sagetrac-mirror/commit/53085e13f04b30d3605482b1639ca7b8e2d59b70)\".",
    "created_at": "2022-09-24T20:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4bc16f29d999da9d0b33b3c868f82d8af407826b](https://github.com/sagemath/sagetrac-mirror/commit/4bc16f29d999da9d0b33b3c868f82d8af407826b)" to "[53085e13f04b30d3605482b1639ca7b8e2d59b70](https://github.com/sagemath/sagetrac-mirror/commit/53085e13f04b30d3605482b1639ca7b8e2d59b70)".



---

archive/issue_events_306189.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-24T21:17:35Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "rename": {
        "from": "Fix tests with ipywidgets 8",
        "to": "Update ipywidgets to 8.0.x, widgetsnbextension to 4.0.x"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306189"
}
```



---

archive/issue_comments_559181.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,6 @@\n \n Also, dicts are no longer allowed as drop down list content [2], so we port them to lists of tuples.\n \n-I've kept the changes compatible with ipywidgets<8 so this can be merged quickly and leave the actual upgrade to another ticket.\n \n [1] https://github.com/jupyter-widgets/ipywidgets/commit/7ae97acc96ce9f78bd43dbd0778cd7db36804966\n \n``````\n",
    "created_at": "2022-09-24T21:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559181",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,6 @@
 
 Also, dicts are no longer allowed as drop down list content [2], so we port them to lists of tuples.
 
-I've kept the changes compatible with ipywidgets<8 so this can be merged quickly and leave the actual upgrade to another ticket.
 
 [1] https://github.com/jupyter-widgets/ipywidgets/commit/7ae97acc96ce9f78bd43dbd0778cd7db36804966
 
``````




---

archive/issue_comments_559182.json:
```json
{
    "body": "<a id='comment:10'></a>\nThank you for the update! I can confirm that tests now pass with ipywidgets 8.",
    "created_at": "2022-09-25T01:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559182",
    "user": "https://github.com/collares"
}
```

<a id='comment:10'></a>
Thank you for the update! I can confirm that tests now pass with ipywidgets 8.



---

archive/issue_events_306190.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-09-25T04:15:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306190"
}
```



---

archive/issue_events_306191.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-09-25T04:15:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306191"
}
```



---

archive/issue_comments_559183.json:
```json
{
    "body": "<a id='comment:11'></a>\nWorks for me too.",
    "created_at": "2022-09-25T04:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559183",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Works for me too.



---

archive/issue_comments_559184.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey, Mauricio Collares",
    "created_at": "2022-09-25T04:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559184",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** Fran√ßois Bissey, Mauricio Collares



---

archive/issue_comments_559185.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7270fe08fff237379ea6e63557d3341d1e9545d0\">7270fe0</a></td><td><code>Drop obsolete patch</code></td></tr></table>\n",
    "created_at": "2022-09-25T06:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7270fe08fff237379ea6e63557d3341d1e9545d0">7270fe0</a></td><td><code>Drop obsolete patch</code></td></tr></table>




---

archive/issue_events_306192.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2022-09-25T06:38:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306192"
}
```



---

archive/issue_events_306193.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2022-09-25T06:38:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306193"
}
```



---

archive/issue_comments_559186.json:
```json
{
    "body": "**Changing commit** from \"[53085e13f04b30d3605482b1639ca7b8e2d59b70](https://github.com/sagemath/sagetrac-mirror/commit/53085e13f04b30d3605482b1639ca7b8e2d59b70)\" to \"[7270fe08fff237379ea6e63557d3341d1e9545d0](https://github.com/sagemath/sagetrac-mirror/commit/7270fe08fff237379ea6e63557d3341d1e9545d0)\".",
    "created_at": "2022-09-25T06:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[53085e13f04b30d3605482b1639ca7b8e2d59b70](https://github.com/sagemath/sagetrac-mirror/commit/53085e13f04b30d3605482b1639ca7b8e2d59b70)" to "[7270fe08fff237379ea6e63557d3341d1e9545d0](https://github.com/sagemath/sagetrac-mirror/commit/7270fe08fff237379ea6e63557d3341d1e9545d0)".



---

archive/issue_comments_559187.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3345da55a8e93f21c4009d445cbea190c6811af2\">3345da5</a></td><td><code>Update dependencies</code></td></tr></table>\n",
    "created_at": "2022-09-25T07:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3345da55a8e93f21c4009d445cbea190c6811af2">3345da5</a></td><td><code>Update dependencies</code></td></tr></table>




---

archive/issue_comments_559188.json:
```json
{
    "body": "**Changing commit** from \"[7270fe08fff237379ea6e63557d3341d1e9545d0](https://github.com/sagemath/sagetrac-mirror/commit/7270fe08fff237379ea6e63557d3341d1e9545d0)\" to \"[3345da55a8e93f21c4009d445cbea190c6811af2](https://github.com/sagemath/sagetrac-mirror/commit/3345da55a8e93f21c4009d445cbea190c6811af2)\".",
    "created_at": "2022-09-25T07:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559188",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7270fe08fff237379ea6e63557d3341d1e9545d0](https://github.com/sagemath/sagetrac-mirror/commit/7270fe08fff237379ea6e63557d3341d1e9545d0)" to "[3345da55a8e93f21c4009d445cbea190c6811af2](https://github.com/sagemath/sagetrac-mirror/commit/3345da55a8e93f21c4009d445cbea190c6811af2)".



---

archive/issue_comments_559189.json:
```json
{
    "body": "<a id='comment:14'></a>\nWhat's the deal with `jupyterlab_widgets`? It should be updated too, but I don't see any version information in `build/pkgs/jupyterlab_widgets`",
    "created_at": "2022-09-25T07:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559189",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:14'></a>
What's the deal with `jupyterlab_widgets`? It should be updated too, but I don't see any version information in `build/pkgs/jupyterlab_widgets`



---

archive/issue_comments_559190.json:
```json
{
    "body": "<a id='comment:15'></a>\nCurrently `jupyterlab_widgets` is a pip package https://doc.sagemath.org/html/en/developer/packaging.html#package-source-types; version constraints would be in requirements.txt, but we have not set any. So it's just taking the most current version from PyPI.",
    "created_at": "2022-09-25T16:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559190",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Currently `jupyterlab_widgets` is a pip package https://doc.sagemath.org/html/en/developer/packaging.html#package-source-types; version constraints would be in requirements.txt, but we have not set any. So it's just taking the most current version from PyPI.



---

archive/issue_comments_559191.json:
```json
{
    "body": "<a id='comment:16'></a>\nLatest changes in `build/pkgs` need review",
    "created_at": "2022-09-29T19:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559191",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:16'></a>
Latest changes in `build/pkgs` need review



---

archive/issue_comments_559192.json:
```json
{
    "body": "<a id='comment:17'></a>\nYes, I hadn't looked at the building side of it. After inspection it looks alright to me.",
    "created_at": "2022-09-29T19:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559192",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
Yes, I hadn't looked at the building side of it. After inspection it looks alright to me.



---

archive/issue_events_306194.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-09-29T19:54:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306194"
}
```



---

archive/issue_events_306195.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-09-29T19:54:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306195"
}
```



---

archive/issue_events_306196.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-09T18:36:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306196"
}
```



---

archive/issue_events_306197.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-09T18:36:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306197"
}
```



---

archive/issue_comments_559193.json:
```json
{
    "body": "<a id='comment:18'></a>\nWith this ticket, I am getting docbuild failures:\n\n```\n  [sagemath_doc_html-none]   pkg_resources.DistributionNotFound: The 'jupyterlab-widgets~=3.0' distribution was not found and is required by ipywidgets\n  [sagemath_doc_html-none]   Traceback (most recent call last):\n  [sagemath_doc_html-none]     File \"/sage/local/var/lib/sage/venv-python3.10/bin/sage-venv-config\", line 4, in <module>\n  [sagemath_doc_html-none]       __import__('pkg_resources').require('sagemath-standard==9.8b1')\n```\nhttps://github.com/mkoeppe/sage/actions/runs/3209136265/jobs/5250533818",
    "created_at": "2022-10-09T18:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559193",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
With this ticket, I am getting docbuild failures:

```
  [sagemath_doc_html-none]   pkg_resources.DistributionNotFound: The 'jupyterlab-widgets~=3.0' distribution was not found and is required by ipywidgets
  [sagemath_doc_html-none]   Traceback (most recent call last):
  [sagemath_doc_html-none]     File "/sage/local/var/lib/sage/venv-python3.10/bin/sage-venv-config", line 4, in <module>
  [sagemath_doc_html-none]       __import__('pkg_resources').require('sagemath-standard==9.8b1')
```
https://github.com/mkoeppe/sage/actions/runs/3209136265/jobs/5250533818



---

archive/issue_comments_559194.json:
```json
{
    "body": "<a id='comment:19'></a>\nI think we need to make `jupyterlab_widgets` a standard package. This can now be a \"wheel\" package (#34450)",
    "created_at": "2022-10-09T19:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559194",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
I think we need to make `jupyterlab_widgets` a standard package. This can now be a "wheel" package (#34450)



---

archive/issue_comments_559195.json:
```json
{
    "body": "**Changing branch** from \"[u/arojas/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/fix_tests_with_ipywidgets_8)\" to \"[u/mkoeppe/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_tests_with_ipywidgets_8)\".",
    "created_at": "2022-10-09T19:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559195",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/arojas/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/fix_tests_with_ipywidgets_8)" to "[u/mkoeppe/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_tests_with_ipywidgets_8)".



---

archive/issue_comments_559196.json:
```json
{
    "body": "**Changing commit** from \"[3345da55a8e93f21c4009d445cbea190c6811af2](https://github.com/sagemath/sagetrac-mirror/commit/3345da55a8e93f21c4009d445cbea190c6811af2)\" to \"[3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6](https://github.com/sagemath/sagetrac-mirror/commit/3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6)\".",
    "created_at": "2022-10-09T19:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559196",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[3345da55a8e93f21c4009d445cbea190c6811af2](https://github.com/sagemath/sagetrac-mirror/commit/3345da55a8e93f21c4009d445cbea190c6811af2)" to "[3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6](https://github.com/sagemath/sagetrac-mirror/commit/3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6)".



---

archive/issue_comments_559197.json:
```json
{
    "body": "**Changing author** from \"Antonio Rojas\" to \"Antonio Rojas, Matthias Koeppe\".",
    "created_at": "2022-10-09T19:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559197",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Antonio Rojas" to "Antonio Rojas, Matthias Koeppe".



---

archive/issue_comments_559198.json:
```json
{
    "body": "<a id='comment:22'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aaefd0aa8ee09d4632e304b7a0453e2acc15a0df\">aaefd0a</a></td><td><code>Fix tests with ipywidgets 8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4e415bd2894950eee8c4c73a90af08a2ad9dc8b\">f4e415b</a></td><td><code>Fix tests in sage.interacts.test_jupyter.rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b8930b6d7dcde5cde7ade56472b84cecc450731\">8b8930b</a></td><td><code>Update ipywidgets and widgetsnbextension</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86949b3cadcd2df6df942948cd27d7948250b0ad\">86949b3</a></td><td><code>Drop obsolete patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6a2f56dd2d944a3b29b6d399cbf43516b6f6d1e\">d6a2f56</a></td><td><code>Update dependencies</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6\">3c7b7b4</a></td><td><code>build/pkgs/jupyterlab_widgets: Make it a standard wheel package - ipywidgets dependency</code></td></tr></table>\n",
    "created_at": "2022-10-09T19:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559198",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aaefd0aa8ee09d4632e304b7a0453e2acc15a0df">aaefd0a</a></td><td><code>Fix tests with ipywidgets 8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4e415bd2894950eee8c4c73a90af08a2ad9dc8b">f4e415b</a></td><td><code>Fix tests in sage.interacts.test_jupyter.rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b8930b6d7dcde5cde7ade56472b84cecc450731">8b8930b</a></td><td><code>Update ipywidgets and widgetsnbextension</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86949b3cadcd2df6df942948cd27d7948250b0ad">86949b3</a></td><td><code>Drop obsolete patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6a2f56dd2d944a3b29b6d399cbf43516b6f6d1e">d6a2f56</a></td><td><code>Update dependencies</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6">3c7b7b4</a></td><td><code>build/pkgs/jupyterlab_widgets: Make it a standard wheel package - ipywidgets dependency</code></td></tr></table>




---

archive/issue_comments_559199.json:
```json
{
    "body": "**Changing commit** from \"[3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6](https://github.com/sagemath/sagetrac-mirror/commit/3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6)\" to \"[c6881bbba4333243ef6badc14b959e516f4bc39a](https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a)\".",
    "created_at": "2022-10-09T19:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559199",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6](https://github.com/sagemath/sagetrac-mirror/commit/3c7b7b4a54874c85c4eeb28d21345cc764e6c0b6)" to "[c6881bbba4333243ef6badc14b959e516f4bc39a](https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a)".



---

archive/issue_comments_559200.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a\">c6881bb</a></td><td><code>src/bin/sage-notebook: No longer point to jupyterlab_widgets to install jupyterlab</code></td></tr></table>\n",
    "created_at": "2022-10-09T19:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a">c6881bb</a></td><td><code>src/bin/sage-notebook: No longer point to jupyterlab_widgets to install jupyterlab</code></td></tr></table>




---

archive/issue_events_306198.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-09T19:22:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306198"
}
```



---

archive/issue_events_306199.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-09T19:22:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306199"
}
```



---

archive/issue_comments_559201.json:
```json
{
    "body": "<a id='comment:25'></a>\nLet's get this in please",
    "created_at": "2022-10-18T02:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559201",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Let's get this in please



---

archive/issue_comments_559202.json:
```json
{
    "body": "<a id='comment:26'></a>\nLGTM. In particular, I've tested it atop of Sage 9.8.beta2 with this notebook:\n\nhttps://github.com/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display.ipynb\n\nboth with Jupyter notebook and with Jupyterlab. \nI've installed Jupyterlab after merging the ticket branch via simply\n\n```\nsage -i jupyterlab\n```\nI thus confirm that, thanks to this ticket, there is no need to run `sage -i jupyterlab_widgets`.\n\nNB: to run `%matplotlib widget` (cf. cell 20 of the above notebook), I had to install manually `ipympl` via `sage -pip install ipympl`.",
    "created_at": "2022-10-18T20:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559202",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:26'></a>
LGTM. In particular, I've tested it atop of Sage 9.8.beta2 with this notebook:

https://github.com/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display.ipynb

both with Jupyter notebook and with Jupyterlab. 
I've installed Jupyterlab after merging the ticket branch via simply

```
sage -i jupyterlab
```
I thus confirm that, thanks to this ticket, there is no need to run `sage -i jupyterlab_widgets`.

NB: to run `%matplotlib widget` (cf. cell 20 of the above notebook), I had to install manually `ipympl` via `sage -pip install ipympl`.



---

archive/issue_comments_559203.json:
```json
{
    "body": "**Changing reviewer** from \"Fran\u00e7ois Bissey, Mauricio Collares\" to \"Fran\u00e7ois Bissey, Mauricio Collares, Eric Gourgoulhon\".",
    "created_at": "2022-10-18T20:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559203",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing reviewer** from "Fran√ßois Bissey, Mauricio Collares" to "Fran√ßois Bissey, Mauricio Collares, Eric Gourgoulhon".



---

archive/issue_events_306200.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2022-10-18T20:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306200"
}
```



---

archive/issue_events_306201.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2022-10-18T20:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306201"
}
```



---

archive/issue_comments_559204.json:
```json
{
    "body": "<a id='comment:27'></a>\nThanks!",
    "created_at": "2022-10-18T22:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559204",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Thanks!



---

archive/issue_comments_559205.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_tests_with_ipywidgets_8)\" to \"[c6881bbba4333243ef6badc14b959e516f4bc39a](https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a)\".",
    "created_at": "2022-10-23T20:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34460#issuecomment-559205",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/fix_tests_with_ipywidgets_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_tests_with_ipywidgets_8)" to "[c6881bbba4333243ef6badc14b959e516f4bc39a](https://github.com/sagemath/sagetrac-mirror/commit/c6881bbba4333243ef6badc14b959e516f4bc39a)".



---

archive/issue_events_306202.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-23T20:49:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306202"
}
```



---

archive/issue_events_306203.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-23T20:49:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34460",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34460#event-306203"
}
```
