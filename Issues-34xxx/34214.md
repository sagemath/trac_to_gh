# Issue 34214: Faster version of longest_increasing_subsequence_length

archive/issues_033977.json:
```json
{
    "body": "Before\n\n```\nsage: set_random_seed(0)\nsage: P = Permutations(30)\nsage: L = [P.random_element() for _ in range(1000)]\nsage: %timeit [e.longest_increasing_subsequence_length() for e in L]\n24.9 ms \u00b1 953 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\nAfter\n\n```\nsage: %timeit [e.longest_increasing_subsequence_length(e) for e in L]\n5.94 ms \u00b1 133 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\n\nfollow up: #31451, #34218 \n\nCC:  @videlec @nadialafreniere\n\nKeywords: permutation, subsequences\n\nBranch/Commit: 15aa550c5ca1e6c8e03d518bde51e08ad6877227\n\nReviewer: Vincent Delecroix\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34214\n\n",
    "closed_at": "2022-08-01T20:22:52Z",
    "created_at": "2022-07-23T10:55:26Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Faster version of longest_increasing_subsequence_length",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34214",
    "user": "https://github.com/dcoudert"
}
```
Before

```
sage: set_random_seed(0)
sage: P = Permutations(30)
sage: L = [P.random_element() for _ in range(1000)]
sage: %timeit [e.longest_increasing_subsequence_length() for e in L]
24.9 ms ± 953 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```
After

```
sage: %timeit [e.longest_increasing_subsequence_length(e) for e in L]
5.94 ms ± 133 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```

follow up: #31451, #34218 

CC:  @videlec @nadialafreniere

Keywords: permutation, subsequences

Branch/Commit: 15aa550c5ca1e6c8e03d518bde51e08ad6877227

Reviewer: Vincent Delecroix

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34214





---

archive/issue_comments_681634.json:
```json
{
    "body": "Changing branch from \"\" to \"public/combinat/34214\"",
    "created_at": "2022-07-23T10:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681634",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "public/combinat/34214"



---

archive/issue_comments_681635.json:
```json
{
    "body": "Changing commit from \"\" to \"2e183cf011466c7b39f3304c84930dde70d5e092\"",
    "created_at": "2022-07-23T10:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681635",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "2e183cf011466c7b39f3304c84930dde70d5e092"



---

archive/issue_comments_681636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-23T10:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681636",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_681637.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2022-07-23T10:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681637",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_681638.json:
```json
{
    "body": "Changing commit from \"2e183cf011466c7b39f3304c84930dde70d5e092\" to \"15aa550c5ca1e6c8e03d518bde51e08ad6877227\"",
    "created_at": "2022-07-23T10:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681638",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2e183cf011466c7b39f3304c84930dde70d5e092" to "15aa550c5ca1e6c8e03d518bde51e08ad6877227"



---

archive/issue_comments_681639.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-23T10:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681639",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681640.json:
```json
{
    "body": "<a id='comment:3'></a>Roughly, we replace the calls to `max`, `min` and `index` by a single call to `bisect`. The time complexity of the method is now `O(n log(n))`.",
    "created_at": "2022-07-23T11:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681640",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>Roughly, we replace the calls to `max`, `min` and `index` by a single call to `bisect`. The time complexity of the method is now `O(n log(n))`.



---

archive/issue_comments_681641.json:
```json
{
    "body": "<a id='comment:4'></a>Green bot.",
    "created_at": "2022-07-23T14:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681641",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>Green bot.



---

archive/issue_comments_681642.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n After\n \n ```\n-sage: %timeit [longest_increasing_subsequence_length_v2(e) for e in L]\n+sage: %timeit [e.longest_increasing_subsequence_length(e) for e in L]\n 5.94 ms \u00b1 133 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n ```\n \n``````\n",
    "created_at": "2022-07-23T14:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681642",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,7 +10,7 @@
 After
 
 ```
-sage: %timeit [longest_increasing_subsequence_length_v2(e) for e in L]
+sage: %timeit [e.longest_increasing_subsequence_length(e) for e in L]
 5.94 ms ± 133 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
 ```
 
``````




---

archive/issue_comments_681643.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2022-07-24T13:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681643",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_681644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-24T13:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681644",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_681645.json:
```json
{
    "body": "<a id='comment:5'></a>This is indeed cleaner.\n\nThe algorithm is clever. Do you know if it possible to generate such subsequence in `O(n log n)` ? In the data generated by the algo, only `r[-1]` is guaranteed to be the last element of a longest increasing subsequence.",
    "created_at": "2022-07-24T13:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681645",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>This is indeed cleaner.

The algorithm is clever. Do you know if it possible to generate such subsequence in `O(n log n)` ? In the data generated by the algo, only `r[-1]` is guaranteed to be the last element of a longest increasing subsequence.



---

archive/issue_comments_681646.json:
```json
{
    "body": "<a id='comment:6'></a>Apparently yes : https://en.wikipedia.org/wiki/Longest_increasing_subsequence",
    "created_at": "2022-07-24T13:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681646",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Apparently yes : https://en.wikipedia.org/wiki/Longest_increasing_subsequence



---

archive/issue_comments_681647.json:
```json
{
    "body": "<a id='comment:7'></a>Indeed for a single sequence. Not sure how to extend to find all longest sequences.",
    "created_at": "2022-07-24T13:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681647",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>Indeed for a single sequence. Not sure how to extend to find all longest sequences.



---

archive/issue_comments_681648.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [dcoudert](#comment%3A7):\n> Indeed for a single sequence. Not sure how to extend to find all longest sequences.\n\n\nThere could be exponentially many longest sequences. Pick `p = [2,1,4,3,6,5,...,2n,2n-1]`. Then there are `2^n` longest increasing sequences (they are of length `n`). Note that building the automaton that stores them all is what Nadia proposed in #31451. Not sure about complexity, but it is for sure polynomial.\n\nIt would be interesting to implement something fast to count the number of such sequence. This could be obtained for example from #31451 as the coefficient `(0,n+1)` of the `n+1`-th power of the adjacency matrix of `D`.",
    "created_at": "2022-07-25T07:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681648",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>Replying to [dcoudert](#comment%3A7):
> Indeed for a single sequence. Not sure how to extend to find all longest sequences.


There could be exponentially many longest sequences. Pick `p = [2,1,4,3,6,5,...,2n,2n-1]`. Then there are `2^n` longest increasing sequences (they are of length `n`). Note that building the automaton that stores them all is what Nadia proposed in #31451. Not sure about complexity, but it is for sure polynomial.

It would be interesting to implement something fast to count the number of such sequence. This could be obtained for example from #31451 as the coefficient `(0,n+1)` of the `n+1`-th power of the adjacency matrix of `D`.



---

archive/issue_comments_681649.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,4 @@\n 5.94 ms \u00b1 133 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n ```\n \n+follow up: #31451, #34218 \n``````\n",
    "created_at": "2022-07-25T07:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681649",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,4 @@
 5.94 ms ± 133 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
 ```
 
+follow up: #31451, #34218 
``````




---

archive/issue_comments_681650.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-01T20:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681650",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_089249.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-01T20:22:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34214#event-89249"
}
```



---

archive/issue_comments_681651.json:
```json
{
    "body": "Changing branch from \"public/combinat/34214\" to \"15aa550c5ca1e6c8e03d518bde51e08ad6877227\"",
    "created_at": "2022-08-01T20:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34214#issuecomment-681651",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/combinat/34214" to "15aa550c5ca1e6c8e03d518bde51e08ad6877227"
