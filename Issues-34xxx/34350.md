# Issue 34350: speed up powers of lazy Taylor series

archive/issues_034113.json:
```json
{
    "body": "As remarked inticket: ticket:32324#comment:105#comment:32324, the computation of the square root of a lazy series is very slow.\n\nKeywords: LazyPowerSeries\n\nBranch/Commit: b23792105a2fbb3d8e7d529774f91eaa3831ac84\n\nReviewer: Martin Pepin\n\nAuthor: Travis Scrimshaw\n\nDependencies: #32324\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34350\n\n",
    "closed_at": "2022-09-25T16:34:17Z",
    "created_at": "2022-08-12T13:36:10Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "speed up powers of lazy Taylor series",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34350",
    "user": "https://github.com/mantepse"
}
```
As remarked inticket: ticket:32324#comment:105#comment:32324, the computation of the square root of a lazy series is very slow.

Keywords: LazyPowerSeries

Branch/Commit: b23792105a2fbb3d8e7d529774f91eaa3831ac84

Reviewer: Martin Pepin

Author: Travis Scrimshaw

Dependencies: #32324

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34350





---

archive/issue_comments_684079.json:
```json
{
    "body": "<a id='comment:1'></a>Using a the na\u00efve version using the Taylor series speeds things up considerably:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(QQ)\nsage: f = sqrt(1 + z)\nsage: %time f[200]\nCPU times: user 254 ms, sys: 4.21 ms, total: 258 ms\nWall time: 258 ms\n```\nversus before\n\n```\nsage: %time f[200]\nCPU times: user 2.39 s, sys: 1.83 ms, total: 2.4 s\nWall time: 2.4 s\n```\n\nAnother example:\n\n```\nsage: q = ZZ['q'].fraction_field().gen()\nsage: L.<z> = LazyLaurentSeriesRing(q.parent())\nsage: f = (1 - z)^q\nsage: f\n1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)\nsage: %time f[200]\nCPU times: user 439 ms, sys: 0 ns, total: 439 ms\nWall time: 439 ms\n```\nversus before\n\n```\nsage: %time c = f[200]\nCPU times: user 10.3 s, sys: 9.75 ms, total: 10.3 s\nWall time: 10.3 s\n```\n\n---\nLast 10 new commits:",
    "created_at": "2022-08-15T02:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684079",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>Using a the na√Øve version using the Taylor series speeds things up considerably:

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: f = sqrt(1 + z)
sage: %time f[200]
CPU times: user 254 ms, sys: 4.21 ms, total: 258 ms
Wall time: 258 ms
```
versus before

```
sage: %time f[200]
CPU times: user 2.39 s, sys: 1.83 ms, total: 2.4 s
Wall time: 2.4 s
```

Another example:

```
sage: q = ZZ['q'].fraction_field().gen()
sage: L.<z> = LazyLaurentSeriesRing(q.parent())
sage: f = (1 - z)^q
sage: f
1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)
sage: %time f[200]
CPU times: user 439 ms, sys: 0 ns, total: 439 ms
Wall time: 439 ms
```
versus before

```
sage: %time c = f[200]
CPU times: user 10.3 s, sys: 9.75 ms, total: 10.3 s
Wall time: 10.3 s
```

---
Last 10 new commits:



---

archive/issue_comments_684080.json:
```json
{
    "body": "Changing author from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2022-08-15T02:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684080",
    "user": "https://github.com/tscrim"
}
```

Changing author from "" to "Travis Scrimshaw"



---

archive/issue_comments_684081.json:
```json
{
    "body": "Changing commit from \"\" to \"465fe7c78fbfcfbf7431234514591ab95360a6f0\"",
    "created_at": "2022-08-15T02:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684081",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "" to "465fe7c78fbfcfbf7431234514591ab95360a6f0"



---

archive/issue_comments_684082.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-15T02:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684082",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_684083.json:
```json
{
    "body": "Changing branch from \"\" to \"public/rings/speedup_powers_lazy_series-34350\"",
    "created_at": "2022-08-15T02:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684083",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "" to "public/rings/speedup_powers_lazy_series-34350"



---

archive/issue_comments_684084.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32324\"",
    "created_at": "2022-08-15T02:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684084",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "" to "#32324"



---

archive/issue_comments_684085.json:
```json
{
    "body": "<a id='comment:2'></a>I based this off #32324 since that is positively reviewed, although I can remove this if necessary.",
    "created_at": "2022-08-15T02:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684085",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>I based this off #32324 since that is positively reviewed, although I can remove this if necessary.



---

archive/issue_events_089407.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34350#event-89407"
}
```



---

archive/issue_comments_684086.json:
```json
{
    "body": "Changing branch from \"public/rings/speedup_powers_lazy_series-34350\" to \"u/MartinPepin/34350\"",
    "created_at": "2022-09-21T14:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684086",
    "user": "https://github.com/Kerl13"
}
```

Changing branch from "public/rings/speedup_powers_lazy_series-34350" to "u/MartinPepin/34350"



---

archive/issue_comments_684087.json:
```json
{
    "body": "Changing reviewer from \"\" to \"MartinPepin\"",
    "created_at": "2022-09-21T14:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684087",
    "user": "https://github.com/Kerl13"
}
```

Changing reviewer from "" to "MartinPepin"



---

archive/issue_comments_684088.json:
```json
{
    "body": "Changing commit from \"465fe7c78fbfcfbf7431234514591ab95360a6f0\" to \"d4450fb31c4d7331cafbad27bf45c4c3697df679\"",
    "created_at": "2022-09-21T14:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684088",
    "user": "https://github.com/Kerl13"
}
```

Changing commit from "465fe7c78fbfcfbf7431234514591ab95360a6f0" to "d4450fb31c4d7331cafbad27bf45c4c3697df679"



---

archive/issue_comments_684089.json:
```json
{
    "body": "<a id='comment:4'></a>I reproduced the time difference, that's indeed huge!\n\nI also took the opportunity to update the docstring for `__pow__` with your examples. Before that it was only documenting integer powers. Once you have reviewed this change I think it's good to go.\n\n---\nNew commits:",
    "created_at": "2022-09-21T14:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684089",
    "user": "https://github.com/Kerl13"
}
```

<a id='comment:4'></a>I reproduced the time difference, that's indeed huge!

I also took the opportunity to update the docstring for `__pow__` with your examples. Before that it was only documenting integer powers. Once you have reviewed this change I think it's good to go.

---
New commits:



---

archive/issue_comments_684090.json:
```json
{
    "body": "Changing reviewer from \"MartinPepin\" to \"Martin Pepin\"",
    "created_at": "2022-09-22T03:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684090",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "MartinPepin" to "Martin Pepin"



---

archive/issue_comments_684091.json:
```json
{
    "body": "<a id='comment:5'></a>Hi Martin P. Thanks for the review. Can you quickly do two minor little tweaks to follow our docstring conventions:\n\n```diff\n-        - ``n`` -- the power to which to raise the series. This may be an\n-          integer, a rational number, an element of the base ring, or an other\n-          series.\n+        - ``n`` -- the power to which to raise the series; this may be a\n+          rational number, an element of the base ring, or another series\n```\n\n```diff\n             sage: f\n-            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)\n+            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3\n+             + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4\n+             + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5\n+             + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6\n+             + O(z^7)\n         \"\"\"\n```\nOnce you do those, you can set a positive review.",
    "created_at": "2022-09-22T03:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684091",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>Hi Martin P. Thanks for the review. Can you quickly do two minor little tweaks to follow our docstring conventions:

```diff
-        - ``n`` -- the power to which to raise the series. This may be an
-          integer, a rational number, an element of the base ring, or an other
-          series.
+        - ``n`` -- the power to which to raise the series; this may be a
+          rational number, an element of the base ring, or another series
```

```diff
             sage: f
-            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)
+            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3
+             + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4
+             + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5
+             + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6
+             + O(z^7)
         """
```
Once you do those, you can set a positive review.



---

archive/issue_comments_684092.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-22T07:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_684093.json:
```json
{
    "body": "Changing commit from \"d4450fb31c4d7331cafbad27bf45c4c3697df679\" to \"b23792105a2fbb3d8e7d529774f91eaa3831ac84\"",
    "created_at": "2022-09-22T07:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684093",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d4450fb31c4d7331cafbad27bf45c4c3697df679" to "b23792105a2fbb3d8e7d529774f91eaa3831ac84"



---

archive/issue_comments_684094.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-22T07:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684094",
    "user": "https://github.com/Kerl13"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_684095.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-25T16:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684095",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_684096.json:
```json
{
    "body": "Changing branch from \"u/MartinPepin/34350\" to \"b23792105a2fbb3d8e7d529774f91eaa3831ac84\"",
    "created_at": "2022-09-25T16:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34350#issuecomment-684096",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/MartinPepin/34350" to "b23792105a2fbb3d8e7d529774f91eaa3831ac84"



---

archive/issue_events_089408.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-25T16:34:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34350",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34350#event-89408"
}
```
