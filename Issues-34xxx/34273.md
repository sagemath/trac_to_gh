# Issue 34273: opensuse-tumbleweed: python3 build fails because of openssl

archive/issues_034036.json:
```json
{
    "body": "Our OpenSUSE system package info leads to the installation of LibreSSL, which is not compatible with the python3 build. \n\n```\n[python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes\n[python3-3.10.6] checking for --with-openssl-rpath... \n[python3-3.10.6] checking whether OpenSSL provides required APIs... no\n[python3-3.10.6] checking for --with-ssl-default-suites... python\n[python3-3.10.6] checking for --with-builtin-hashlib-hashes... md5,sha1,sha256,sha512,sha3,blake2\n[python3-3.10.6] checking for --with-experimental-isolated-subinterpreters... no\n[python3-3.10.6] checking for --with-static-libpython... yes\n[python3-3.10.6] checking for --disable-test-modules... no\n[python3-3.10.6] configure: creating ./config.status\n```\n\nOur configure script does not know that.\n\nWe update the distro file and add an additional check to openssl spkg-configure.m4\n\nTo test: `tox -e docker-opensuse-tumbleweed-standard -- V=1 python3`\n\n\n**CC:**  tmonteil @dimpase\n\n**Branch/Commit:** [d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)\n\n**Reviewer:** Kwankyu Lee\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/34273\n\n",
    "closed_at": "2022-08-29T11:24:36Z",
    "created_at": "2022-08-03T23:56:27Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.7",
    "title": "opensuse-tumbleweed: python3 build fails because of openssl",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/34273",
    "user": "https://github.com/mkoeppe"
}
```
Our OpenSUSE system package info leads to the installation of LibreSSL, which is not compatible with the python3 build. 

```
[python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes
[python3-3.10.6] checking for --with-openssl-rpath... 
[python3-3.10.6] checking whether OpenSSL provides required APIs... no
[python3-3.10.6] checking for --with-ssl-default-suites... python
[python3-3.10.6] checking for --with-builtin-hashlib-hashes... md5,sha1,sha256,sha512,sha3,blake2
[python3-3.10.6] checking for --with-experimental-isolated-subinterpreters... no
[python3-3.10.6] checking for --with-static-libpython... yes
[python3-3.10.6] checking for --disable-test-modules... no
[python3-3.10.6] configure: creating ./config.status
```

Our configure script does not know that.

We update the distro file and add an additional check to openssl spkg-configure.m4

To test: `tox -e docker-opensuse-tumbleweed-standard -- V=1 python3`


**CC:**  tmonteil @dimpase

**Branch/Commit:** [d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)

**Reviewer:** Kwankyu Lee

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/34273





---

archive/issue_comments_556149.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,13 @@\n \n+```\n+[python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes\n+[python3-3.10.6] checking for --with-openssl-rpath... \n+[python3-3.10.6] checking whether OpenSSL provides required APIs... no\n+[python3-3.10.6] checking for --with-ssl-default-suites... python\n+[python3-3.10.6] checking for --with-builtin-hashlib-hashes... md5,sha1,sha256,sha512,sha3,blake2\n+[python3-3.10.6] checking for --with-experimental-isolated-subinterpreters... no\n+[python3-3.10.6] checking for --with-static-libpython... yes\n+[python3-3.10.6] checking for --disable-test-modules... no\n+[python3-3.10.6] configure: creating ./config.status\n+```\n+\n``````\n",
    "created_at": "2022-08-04T00:02:16Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556149",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,13 @@
 
+```
+[python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes
+[python3-3.10.6] checking for --with-openssl-rpath... 
+[python3-3.10.6] checking whether OpenSSL provides required APIs... no
+[python3-3.10.6] checking for --with-ssl-default-suites... python
+[python3-3.10.6] checking for --with-builtin-hashlib-hashes... md5,sha1,sha256,sha512,sha3,blake2
+[python3-3.10.6] checking for --with-experimental-isolated-subinterpreters... no
+[python3-3.10.6] checking for --with-static-libpython... yes
+[python3-3.10.6] checking for --disable-test-modules... no
+[python3-3.10.6] configure: creating ./config.status
+```
+
``````




---

archive/issue_comments_556150.json:
```json
{
    "body": "<a id='comment:2'></a>\n\n```\nconfigure:17891: gcc -o conftest  -std=c99 -Wextra -Wno-unused-result -Wno-unused-parameter -Wno-missing-field-initializers -Werror=implicit-function-declaration -fvisibility=hidden   -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib   conftest.c -lcrypt -ldl  -lm -lssl -lcrypto  >&5\nconftest.c: In function 'main':\nconftest.c:442:12: error: 'NID_sha3_512' undeclared (first use in this function); did you mean 'NID_sha512'?\n  442 | OBJ_nid2sn(NID_sha3_512);\n      |            ^~~~~~~~~~~~\n      |            NID_sha512\nconftest.c:442:12: note: each undeclared identifier is reported only once for each function it appears in\nconftest.c:443:12: error: 'NID_blake2b512' undeclared (first use in this function)\n  443 | OBJ_nid2sn(NID_blake2b512);\n      |            ^~~~~~~~~~~~~~\nconftest.c:444:1: error: implicit declaration of function 'EVP_PBE_scrypt'; did you mean 'EVP_PKEY_decrypt'? [-Werror=implicit-function-declaration]\n  444 | EVP_PBE_scrypt(NULL, 0, NULL, 0, 2, 8, 1, 0, NULL, 0);\n      | ^~~~~~~~~~~~~~\n      | EVP_PKEY_decrypt\ncc1: some warnings being treated as errors\nconfigure:17891: $? = 1\n```",
    "created_at": "2022-08-04T00:05:11Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556150",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>

```
configure:17891: gcc -o conftest  -std=c99 -Wextra -Wno-unused-result -Wno-unused-parameter -Wno-missing-field-initializers -Werror=implicit-function-declaration -fvisibility=hidden   -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib   conftest.c -lcrypt -ldl  -lm -lssl -lcrypto  >&5
conftest.c: In function 'main':
conftest.c:442:12: error: 'NID_sha3_512' undeclared (first use in this function); did you mean 'NID_sha512'?
  442 | OBJ_nid2sn(NID_sha3_512);
      |            ^~~~~~~~~~~~
      |            NID_sha512
conftest.c:442:12: note: each undeclared identifier is reported only once for each function it appears in
conftest.c:443:12: error: 'NID_blake2b512' undeclared (first use in this function)
  443 | OBJ_nid2sn(NID_blake2b512);
      |            ^~~~~~~~~~~~~~
conftest.c:444:1: error: implicit declaration of function 'EVP_PBE_scrypt'; did you mean 'EVP_PKEY_decrypt'? [-Werror=implicit-function-declaration]
  444 | EVP_PBE_scrypt(NULL, 0, NULL, 0, 2, 8, 1, 0, NULL, 0);
      | ^~~~~~~~~~~~~~
      | EVP_PKEY_decrypt
cc1: some warnings being treated as errors
configure:17891: $? = 1
```



---

archive/issue_comments_556151.json:
```json
{
    "body": "<a id='comment:3'></a>\nWe should probably explicitly install `libopenssl-3-devel`",
    "created_at": "2022-08-04T00:12:11Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556151",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
We should probably explicitly install `libopenssl-3-devel`



---

archive/issue_comments_556152.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl)",
    "created_at": "2022-08-04T00:15:01Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556152",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl)



---

archive/issue_comments_556153.json:
```json
{
    "body": "<a id='comment:5'></a>\nWe should probably get the more detailed configure check from Python:\nhttps://github.com/python/cpython/blob/main/configure.ac#L6823\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7\">de3e0f3</a></td><td><code>build/pkgs/openssl/distros/opensuse.txt: Use libopenssl-3-devel</code></td></tr></table>\n",
    "created_at": "2022-08-04T00:22:48Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
We should probably get the more detailed configure check from Python:
https://github.com/python/cpython/blob/main/configure.ac#L6823

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7">de3e0f3</a></td><td><code>build/pkgs/openssl/distros/opensuse.txt: Use libopenssl-3-devel</code></td></tr></table>




---

archive/issue_comments_556154.json:
```json
{
    "body": "**Commit:** [de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7](https://github.com/sagemath/sagetrac-mirror/commit/de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7)",
    "created_at": "2022-08-04T00:22:48Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556154",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7](https://github.com/sagemath/sagetrac-mirror/commit/de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7)



---

archive/issue_comments_556155.json:
```json
{
    "body": "<a id='comment:6'></a>\nor rather https://github.com/python/cpython/blob/3.10/configure.ac#L5845",
    "created_at": "2022-08-04T00:25:23Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556155",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
or rather https://github.com/python/cpython/blob/3.10/configure.ac#L5845



---

archive/issue_comments_556156.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f\">d46f190</a></td><td><code>build/pkgs/openssl/spkg-configure.m4: Add API check from python3 configure.ac</code></td></tr></table>\n",
    "created_at": "2022-08-04T00:33:00Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f">d46f190</a></td><td><code>build/pkgs/openssl/spkg-configure.m4: Add API check from python3 configure.ac</code></td></tr></table>




---

archive/issue_comments_556157.json:
```json
{
    "body": "**Changing commit** from \"[de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7](https://github.com/sagemath/sagetrac-mirror/commit/de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7)\" to \"[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)\".",
    "created_at": "2022-08-04T00:33:00Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556157",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7](https://github.com/sagemath/sagetrac-mirror/commit/de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7)" to "[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)".



---

archive/issue_comments_556158.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2022-08-04T00:43:34Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556158",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_events_304985.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-04T00:43:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304985"
}
```



---

archive/issue_comments_556159.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+Our OpenSUSE system packages lead to the installation of LibreSSL, which is not compatible with the python3 build. \n \n ```\n [python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes\n@@ -11,3 +12,9 @@\n [python3-3.10.6] configure: creating ./config.status\n ```\n \n+Our configure script does not know that.\n+\n+We update the distro file and add an additional check to openssl spkg-configure.m4\n+\n+To test: `tox -e docker-opensuse-tumbleweed-standard -- V=1 python3`\n+\n``````\n",
    "created_at": "2022-08-04T00:43:34Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556159",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+Our OpenSUSE system packages lead to the installation of LibreSSL, which is not compatible with the python3 build. 
 
 ```
 [python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes
@@ -11,3 +12,9 @@
 [python3-3.10.6] configure: creating ./config.status
 ```
 
+Our configure script does not know that.
+
+We update the distro file and add an additional check to openssl spkg-configure.m4
+
+To test: `tox -e docker-opensuse-tumbleweed-standard -- V=1 python3`
+
``````




---

archive/issue_events_304986.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-04T00:48:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304986"
}
```



---

archive/issue_events_304987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-04T00:48:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304987"
}
```



---

archive/issue_comments_556160.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9eaae57c9cf70c8bc0ed2968beb584906134927\">a9eaae5</a></td><td><code>tox.ini, build/bin/write-dockerfile.sh: Add 'tox -e docker-...-incremental'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9bfbf9f0ae96f79d514cd665c46b182337dd711\">b9bfbf9</a></td><td><code>tox.ini: Add comment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c0d7f50b18f78ce561eccfc3a6c1196887dc226\">4c0d7f5</a></td><td><code>tox.ini: Use FROM_DOCKER_REPOSITORY</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a07874d2f2443785cc0a295d2d8989ab380d79d2\">a07874d</a></td><td><code>build/bin/write-dockerfile.sh: In incremental build, keep logs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae269d17726a4ac6383b9645995d8c1f4c9b3f6d\">ae269d1</a></td><td><code>tox.ini (docker-incremental): Do not include '-incremental' in the Docker image name</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b354a3873b4c6fac29dee7bbd5fbf3ef6a35d8f5\">b354a38</a></td><td><code>tox.ini, .github/workflows/docker.yml: Reimplement -incremental via SKIP_SYSTEM_PACKAGES</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5decadde7ae1985ab6a1b44fb52564972635f281\">5decadd</a></td><td><code>build/bin/write-dockerfile.sh: Do not use persistent env var PACKAGES (except on nix)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49ebf1bc5a6e362ee7fb582b47a413a0eb402999\">49ebf1b</a></td><td><code>Merge #34228</code></td></tr></table>\n",
    "created_at": "2022-08-04T01:35:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556160",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9eaae57c9cf70c8bc0ed2968beb584906134927">a9eaae5</a></td><td><code>tox.ini, build/bin/write-dockerfile.sh: Add 'tox -e docker-...-incremental'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9bfbf9f0ae96f79d514cd665c46b182337dd711">b9bfbf9</a></td><td><code>tox.ini: Add comment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c0d7f50b18f78ce561eccfc3a6c1196887dc226">4c0d7f5</a></td><td><code>tox.ini: Use FROM_DOCKER_REPOSITORY</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a07874d2f2443785cc0a295d2d8989ab380d79d2">a07874d</a></td><td><code>build/bin/write-dockerfile.sh: In incremental build, keep logs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae269d17726a4ac6383b9645995d8c1f4c9b3f6d">ae269d1</a></td><td><code>tox.ini (docker-incremental): Do not include '-incremental' in the Docker image name</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b354a3873b4c6fac29dee7bbd5fbf3ef6a35d8f5">b354a38</a></td><td><code>tox.ini, .github/workflows/docker.yml: Reimplement -incremental via SKIP_SYSTEM_PACKAGES</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5decadde7ae1985ab6a1b44fb52564972635f281">5decadd</a></td><td><code>build/bin/write-dockerfile.sh: Do not use persistent env var PACKAGES (except on nix)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49ebf1bc5a6e362ee7fb582b47a413a0eb402999">49ebf1b</a></td><td><code>Merge #34228</code></td></tr></table>




---

archive/issue_comments_556161.json:
```json
{
    "body": "**Changing commit** from \"[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)\" to \"[49ebf1bc5a6e362ee7fb582b47a413a0eb402999](https://github.com/sagemath/sagetrac-mirror/commit/49ebf1bc5a6e362ee7fb582b47a413a0eb402999)\".",
    "created_at": "2022-08-04T01:35:52Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)" to "[49ebf1bc5a6e362ee7fb582b47a413a0eb402999](https://github.com/sagemath/sagetrac-mirror/commit/49ebf1bc5a6e362ee7fb582b47a413a0eb402999)".



---

archive/issue_comments_556162.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** New commits:",
    "created_at": "2022-08-04T01:36:43Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556162",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** New commits:



---

archive/issue_comments_556163.json:
```json
{
    "body": "**Changing commit** from \"[49ebf1bc5a6e362ee7fb582b47a413a0eb402999](https://github.com/sagemath/sagetrac-mirror/commit/49ebf1bc5a6e362ee7fb582b47a413a0eb402999)\" to \"[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)\".",
    "created_at": "2022-08-04T01:36:43Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[49ebf1bc5a6e362ee7fb582b47a413a0eb402999](https://github.com/sagemath/sagetrac-mirror/commit/49ebf1bc5a6e362ee7fb582b47a413a0eb402999)" to "[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)".



---

archive/issue_events_304988.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-04T01:36:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304988"
}
```



---

archive/issue_events_304989.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-04T01:36:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304989"
}
```



---

archive/issue_comments_556164.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Our OpenSUSE system packages lead to the installation of LibreSSL, which is not compatible with the python3 build. \n+Our OpenSUSE system package info leads to the installation of LibreSSL, which is not compatible with the python3 build. \n \n ```\n [python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes\n``````\n",
    "created_at": "2022-08-04T01:37:35Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556164",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Our OpenSUSE system packages lead to the installation of LibreSSL, which is not compatible with the python3 build. 
+Our OpenSUSE system package info leads to the installation of LibreSSL, which is not compatible with the python3 build. 
 
 ```
 [python3-3.10.6] checking whether compiling and linking against OpenSSL works... yes
``````




---

archive/issue_events_304990.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-04T01:37:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304990"
}
```



---

archive/issue_comments_556165.json:
```json
{
    "body": "**Reviewer:** https://github.com/mkoeppe/sage/runs/7682738998",
    "created_at": "2022-08-05T01:25:34Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556165",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** https://github.com/mkoeppe/sage/runs/7682738998



---

archive/issue_comments_556166.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis fixes it. Let's get it in",
    "created_at": "2022-08-05T03:11:15Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556166",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
This fixes it. Let's get it in



---

archive/issue_events_304991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-07T23:54:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304991"
}
```



---

archive/issue_events_304992.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-07T23:54:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304992"
}
```



---

archive/issue_comments_556167.json:
```json
{
    "body": "<a id='comment:18'></a>\nI ran the test and got: `docker-opensuse-tumbleweed-standard: commands succeeded`.\n\nI am new to this business, and let me ask some naive questions. What was the sign of failure (of `LibreSSL`)? From the tox test, I still get \n\n```\n[python3-3.10.5] checking whether compiling and linking against OpenSSL works... yes\n[python3-3.10.5] checking for --with-openssl-rpath... \n[python3-3.10.5] checking whether OpenSSL provides required APIs... yes\n[python3-3.10.5] checking for --with-ssl-default-suites... python\n[python3-3.10.5] checking for --with-builtin-hashlib-hashes... md5,sha1,sha256,sha512,sha3,blake2\n[python3-3.10.5] checking for --with-experimental-isolated-subinterpreters... no\n[python3-3.10.5] checking for --with-static-libpython... yes\n[python3-3.10.5] checking for --disable-test-modules... no\n```\nwhich seems not much different from the excerpt in the ticket description... How do I check if `libopenssl-3-devel` works with python3 well? Is the message `Sage build/upgrade complete!` enough?",
    "created_at": "2022-08-08T11:10:19Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556167",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:18'></a>
I ran the test and got: `docker-opensuse-tumbleweed-standard: commands succeeded`.

I am new to this business, and let me ask some naive questions. What was the sign of failure (of `LibreSSL`)? From the tox test, I still get 

```
[python3-3.10.5] checking whether compiling and linking against OpenSSL works... yes
[python3-3.10.5] checking for --with-openssl-rpath... 
[python3-3.10.5] checking whether OpenSSL provides required APIs... yes
[python3-3.10.5] checking for --with-ssl-default-suites... python
[python3-3.10.5] checking for --with-builtin-hashlib-hashes... md5,sha1,sha256,sha512,sha3,blake2
[python3-3.10.5] checking for --with-experimental-isolated-subinterpreters... no
[python3-3.10.5] checking for --with-static-libpython... yes
[python3-3.10.5] checking for --disable-test-modules... no
```
which seems not much different from the excerpt in the ticket description... How do I check if `libopenssl-3-devel` works with python3 well? Is the message `Sage build/upgrade complete!` enough?



---

archive/issue_comments_556168.json:
```json
{
    "body": "<a id='comment:19'></a>\nThanks for testing!\n\nThe crucial line in python3's configure output is this:\n\n```\n[python3-3.10.5] checking whether OpenSSL provides required APIs... yes\n```\n... which has changed from \"no\".\n\nI should have added a link to a failing build for reference. In https://github.com/sagemath/sage/actions, selecting \"CI Linux\", there is a completed run for 9.7.beta7, https://github.com/sagemath/sage/actions/runs/2777704621\n\nSelecting \"docker / linux (opensuse-tumbleweed, standard)\" from the sidebar, one gets to https://github.com/sagemath/sage/runs/7619552751, which shows the end of the failing build of the `python3` SPKG:\n\n```\n  [python3-3.10.5]   \n  [python3-3.10.5]   Failed to build these modules:\n  [python3-3.10.5]   _hashlib              _ssl                                     \n  [python3-3.10.5]   \n  [python3-3.10.5]   \n  [python3-3.10.5]   Could not build the ssl module!\n  [python3-3.10.5]   Python requires a OpenSSL 1.1.1 or newer\n  [python3-3.10.5]   \n  ...\n  [python3-3.10.5]   Testing importing of various modules...\n  [python3-3.10.5]   ctypes module imported OK\n  [python3-3.10.5]   math module imported OK\n  [python3-3.10.5]   hashlib module imported OK\n  [python3-3.10.5]   crypt module imported OK\n  [python3-3.10.5]   socket module imported OK\n  [python3-3.10.5]   zlib module imported OK\n  [python3-3.10.5]   sqlite3 module imported OK\n  [python3-3.10.5]   Traceback (most recent call last):\n  [python3-3.10.5]     File \"<string>\", line 1, in <module>\n  [python3-3.10.5]     File \"/sage/local/var/lib/sage/venv-python3.10.5/var/tmp/sage/build/python3-3.10.5/src/Lib/ssl.py\", line 99, in <module>\n  [python3-3.10.5]       import _ssl             # if we can't import it, let the error propagate\n  [python3-3.10.5]   ModuleNotFoundError: No module named '_ssl'\n  [python3-3.10.5]   ssl module failed to import\n  [python3-3.10.5]   Error: One or more modules failed to import.\n  [python3-3.10.5]   \n  [python3-3.10.5]   real\t5m46.942s\n  [python3-3.10.5]   user\t2m41.648s\n  [python3-3.10.5]   sys\t0m17.654s\n  [python3-3.10.5]   ************************************************************************\n  [python3-3.10.5]   Error building package python3-3.10.5\n  [python3-3.10.5]   ************************************************************************\n  [python3-3.10.5] Full log file: /sage/logs/pkgs/python3-3.10.5.log\nmake[2]: *** [Makefile:2930: python3-SAGE_VENV-no-deps] Error 1\n```\nWhat happened there is that Python did not build the `_ssl` module because it did not find a suitable openssl. Python reports this with the message \"Could not build the ssl module!\" This is only an info message.\n\nOur script https://github.com/sagemath/sage/blob/develop/build/pkgs/python3/spkg-build.in#L120 then checks again for the required modules and exits with an error.\n\n> How do I check if libopenssl-3-devel works with python3 well? Is the message Sage build/upgrade complete! enough?\n\nI would say it is not necessary to do more testing than what our build script does.",
    "created_at": "2022-08-08T14:00:27Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556168",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Thanks for testing!

The crucial line in python3's configure output is this:

```
[python3-3.10.5] checking whether OpenSSL provides required APIs... yes
```
... which has changed from "no".

I should have added a link to a failing build for reference. In https://github.com/sagemath/sage/actions, selecting "CI Linux", there is a completed run for 9.7.beta7, https://github.com/sagemath/sage/actions/runs/2777704621

Selecting "docker / linux (opensuse-tumbleweed, standard)" from the sidebar, one gets to https://github.com/sagemath/sage/runs/7619552751, which shows the end of the failing build of the `python3` SPKG:

```
  [python3-3.10.5]   
  [python3-3.10.5]   Failed to build these modules:
  [python3-3.10.5]   _hashlib              _ssl                                     
  [python3-3.10.5]   
  [python3-3.10.5]   
  [python3-3.10.5]   Could not build the ssl module!
  [python3-3.10.5]   Python requires a OpenSSL 1.1.1 or newer
  [python3-3.10.5]   
  ...
  [python3-3.10.5]   Testing importing of various modules...
  [python3-3.10.5]   ctypes module imported OK
  [python3-3.10.5]   math module imported OK
  [python3-3.10.5]   hashlib module imported OK
  [python3-3.10.5]   crypt module imported OK
  [python3-3.10.5]   socket module imported OK
  [python3-3.10.5]   zlib module imported OK
  [python3-3.10.5]   sqlite3 module imported OK
  [python3-3.10.5]   Traceback (most recent call last):
  [python3-3.10.5]     File "<string>", line 1, in <module>
  [python3-3.10.5]     File "/sage/local/var/lib/sage/venv-python3.10.5/var/tmp/sage/build/python3-3.10.5/src/Lib/ssl.py", line 99, in <module>
  [python3-3.10.5]       import _ssl             # if we can't import it, let the error propagate
  [python3-3.10.5]   ModuleNotFoundError: No module named '_ssl'
  [python3-3.10.5]   ssl module failed to import
  [python3-3.10.5]   Error: One or more modules failed to import.
  [python3-3.10.5]   
  [python3-3.10.5]   real	5m46.942s
  [python3-3.10.5]   user	2m41.648s
  [python3-3.10.5]   sys	0m17.654s
  [python3-3.10.5]   ************************************************************************
  [python3-3.10.5]   Error building package python3-3.10.5
  [python3-3.10.5]   ************************************************************************
  [python3-3.10.5] Full log file: /sage/logs/pkgs/python3-3.10.5.log
make[2]: *** [Makefile:2930: python3-SAGE_VENV-no-deps] Error 1
```
What happened there is that Python did not build the `_ssl` module because it did not find a suitable openssl. Python reports this with the message "Could not build the ssl module!" This is only an info message.

Our script https://github.com/sagemath/sage/blob/develop/build/pkgs/python3/spkg-build.in#L120 then checks again for the required modules and exits with an error.

> How do I check if libopenssl-3-devel works with python3 well? Is the message Sage build/upgrade complete! enough?

I would say it is not necessary to do more testing than what our build script does.



---

archive/issue_comments_556169.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A19):\n> I would say it is not necessary to do more testing than what our build script does. \n\nOkay. Now I understand the situation better. So the success of the tox test has shown that your branch works well (otherwise python build script would have failed). \n\nThe relevant github workflow is still running. So let us wait for the result to double-check.\n\nThe branch itself seems good as far as I can judge.",
    "created_at": "2022-08-08T14:51:29Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556169",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A19):
> I would say it is not necessary to do more testing than what our build script does. 

Okay. Now I understand the situation better. So the success of the tox test has shown that your branch works well (otherwise python build script would have failed). 

The relevant github workflow is still running. So let us wait for the result to double-check.

The branch itself seems good as far as I can judge.



---

archive/issue_comments_556170.json:
```json
{
    "body": "<a id='comment:21'></a>\nAnother test would be to install `pkgconfig(libssl)` system package, and to check if the configure correctly decide to install openssl from source. Right?\n\nIt is quite out of my technical reach though. Have you tried it?",
    "created_at": "2022-08-08T15:03:30Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556170",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:21'></a>
Another test would be to install `pkgconfig(libssl)` system package, and to check if the configure correctly decide to install openssl from source. Right?

It is quite out of my technical reach though. Have you tried it?



---

archive/issue_comments_556171.json:
```json
{
    "body": "<a id='comment:22'></a>\nYes, I tested this. If you want to test it, you can just `git revert \tde3e0f3d5d405ef0f255aaf6d9934f86c72fcca7` and then run `tox -e docker-opensuse-tumbleweed-standard -- config.status`",
    "created_at": "2022-08-08T15:11:13Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556171",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Yes, I tested this. If you want to test it, you can just `git revert 	de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7` and then run `tox -e docker-opensuse-tumbleweed-standard -- config.status`



---

archive/issue_comments_556172.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mkoeppe](#comment%3A22):\n> Yes, I tested this. If you want to test it, you can just `git revert \tde3e0f3d5d405ef0f255aaf6d9934f86c72fcca7` and then run `tox -e docker-opensuse-tumbleweed-standard -- config.status`\n\nAh, easy. I did it, and the configure worked correctly.",
    "created_at": "2022-08-09T00:18:11Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556172",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:23'></a>
Replying to [mkoeppe](#comment%3A22):
> Yes, I tested this. If you want to test it, you can just `git revert 	de3e0f3d5d405ef0f255aaf6d9934f86c72fcca7` and then run `tox -e docker-opensuse-tumbleweed-standard -- config.status`

Ah, easy. I did it, and the configure worked correctly.



---

archive/issue_comments_556173.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [klee](#comment%3A20):\n> The relevant github workflow is still running. So let us wait for the result to double-check.\n\nIt would take too long to get the result. As this is simply double-checking the correct result I got locally, I will skip it.\n\nThen, positive review to this ticket.",
    "created_at": "2022-08-09T00:30:50Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556173",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:24'></a>
Replying to [klee](#comment%3A20):
> The relevant github workflow is still running. So let us wait for the result to double-check.

It would take too long to get the result. As this is simply double-checking the correct result I got locally, I will skip it.

Then, positive review to this ticket.



---

archive/issue_events_304993.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-08-09T00:30:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304993"
}
```



---

archive/issue_events_304994.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-08-09T00:30:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304994"
}
```



---

archive/issue_comments_556174.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/runs/7682738998\" to \"Kwankyu Lee\".",
    "created_at": "2022-08-09T00:30:50Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556174",
    "user": "https://github.com/kwankyu"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/runs/7682738998" to "Kwankyu Lee".



---

archive/issue_comments_556175.json:
```json
{
    "body": "<a id='comment:25'></a>\nThank you!",
    "created_at": "2022-08-09T00:37:02Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556175",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Thank you!



---

archive/issue_events_304995.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-29T11:24:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304995"
}
```



---

archive/issue_events_304996.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "20d7f182a25866fa55ee84999952d6f119f856fe",
    "created_at": "2022-08-29T11:24:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34273#event-304996"
}
```



---

archive/issue_comments_556176.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl)\" to \"[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)\".",
    "created_at": "2022-08-29T11:24:36Z",
    "issue": "https://github.com/sagemath/sage/issues/34273",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34273#issuecomment-556176",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/opensuse_tumbleweed__python3_build_fails_because_of_openssl)" to "[d46f190b83388be070d53a105c0b8bd5ba31695f](https://github.com/sagemath/sagetrac-mirror/commit/d46f190b83388be070d53a105c0b8bd5ba31695f)".
