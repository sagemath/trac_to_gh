# Issue 34278: RealSet: Add option cache=False

archive/issues_034041.json:
```json
{
    "body": "When receiving `cache=False`, this would use an implementation class that does not inherit from `UniqueRepresentation` to avoid persistence in memory.\n\n\nCC:  @yuan-zhou @tscrim\n\nBranch: u/mkoeppe/realset__add_option_cache_false\n\nStatus: new\n\nDependencies: #34277, #32181\n\nCommit: d25aaac8101c17c92ad22a749714787d86b48a4e\n\nIssue created by migration from https://trac.sagemath.org/ticket/34278\n\n",
    "created_at": "2022-08-04T18:56:00Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "RealSet: Add option cache=False",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34278",
    "user": "https://github.com/mkoeppe"
}
```
When receiving `cache=False`, this would use an implementation class that does not inherit from `UniqueRepresentation` to avoid persistence in memory.


CC:  @yuan-zhou @tscrim

Branch: u/mkoeppe/realset__add_option_cache_false

Status: new

Dependencies: #34277, #32181

Commit: d25aaac8101c17c92ad22a749714787d86b48a4e

Issue created by migration from https://trac.sagemath.org/ticket/34278





---

archive/issue_comments_682826.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/realset__add_option_cache_false\"",
    "created_at": "2022-08-05T19:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682826",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/realset__add_option_cache_false"



---

archive/issue_comments_682827.json:
```json
{
    "body": "<a id='comment:2'></a>here's a beginning (untested)\n\n---\nLast 10 new commits:",
    "created_at": "2022-08-05T19:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682827",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>here's a beginning (untested)

---
Last 10 new commits:



---

archive/issue_comments_682828.json:
```json
{
    "body": "Changing commit from \"\" to \"cf5d8f19dc03bbf7d56ca20cc492b63f8d55ea67\"",
    "created_at": "2022-08-05T19:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682828",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "cf5d8f19dc03bbf7d56ca20cc492b63f8d55ea67"



---

archive/issue_comments_682829.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-07T00:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_682830.json:
```json
{
    "body": "Changing commit from \"cf5d8f19dc03bbf7d56ca20cc492b63f8d55ea67\" to \"6ed8f48c9ce698a054a03ab58df8f108243f8748\"",
    "created_at": "2022-08-07T00:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cf5d8f19dc03bbf7d56ca20cc492b63f8d55ea67" to "6ed8f48c9ce698a054a03ab58df8f108243f8748"



---

archive/issue_comments_682831.json:
```json
{
    "body": "<a id='comment:4'></a>Rebased on new version of #34277",
    "created_at": "2022-08-07T00:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682831",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Rebased on new version of #34277



---

archive/issue_comments_682832.json:
```json
{
    "body": "Changing commit from \"6ed8f48c9ce698a054a03ab58df8f108243f8748\" to \"9085e2e98592fff72402bd767ed1f8f30a597d83\"",
    "created_at": "2022-08-07T00:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6ed8f48c9ce698a054a03ab58df8f108243f8748" to "9085e2e98592fff72402bd767ed1f8f30a597d83"



---

archive/issue_comments_682833.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_682834.json:
```json
{
    "body": "Changing commit from \"9085e2e98592fff72402bd767ed1f8f30a597d83\" to \"2c87c4482744c0365f5ece75312a2fa89f0eadf2\"",
    "created_at": "2022-08-07T00:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9085e2e98592fff72402bd767ed1f8f30a597d83" to "2c87c4482744c0365f5ece75312a2fa89f0eadf2"



---

archive/issue_comments_682835.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_682836.json:
```json
{
    "body": "Changing commit from \"2c87c4482744c0365f5ece75312a2fa89f0eadf2\" to \"d6dd26563c65abe84b1eebb89718cd3c02d52585\"",
    "created_at": "2022-08-07T00:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2c87c4482744c0365f5ece75312a2fa89f0eadf2" to "d6dd26563c65abe84b1eebb89718cd3c02d52585"



---

archive/issue_comments_682837.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_682838.json:
```json
{
    "body": "Changing commit from \"d6dd26563c65abe84b1eebb89718cd3c02d52585\" to \"9f3d0f668d86499679d235e19ba8b95aba83c7e8\"",
    "created_at": "2022-08-07T00:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d6dd26563c65abe84b1eebb89718cd3c02d52585" to "9f3d0f668d86499679d235e19ba8b95aba83c7e8"



---

archive/issue_comments_682839.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T00:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_682840.json:
```json
{
    "body": "Changing commit from \"9f3d0f668d86499679d235e19ba8b95aba83c7e8\" to \"d25aaac8101c17c92ad22a749714787d86b48a4e\"",
    "created_at": "2022-08-07T01:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9f3d0f668d86499679d235e19ba8b95aba83c7e8" to "d25aaac8101c17c92ad22a749714787d86b48a4e"



---

archive/issue_comments_682841.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-07T01:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_682842.json:
```json
{
    "body": "<a id='comment:10'></a>Can you give some more explanation why you want to do this? While this should not be an issue with coercion (equal-but-not-identical-parents are often a source of frustration there), it increases the overall code complexity.",
    "created_at": "2022-08-07T07:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682842",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Can you give some more explanation why you want to do this? While this should not be an issue with coercion (equal-but-not-identical-parents are often a source of frustration there), it increases the overall code complexity.



---

archive/issue_comments_682843.json:
```json
{
    "body": "<a id='comment:11'></a>When algorithms create lots of `RealSet`s as intermediate objects, we don't want them to persist in memory for the remainder of the session",
    "created_at": "2022-08-07T18:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682843",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>When algorithms create lots of `RealSet`s as intermediate objects, we don't want them to persist in memory for the remainder of the session



---

archive/issue_comments_682844.json:
```json
{
    "body": "<a id='comment:12'></a>But now I realize the premise is wrong - `CachedRepresentation`/`UniqueRepresentation` use `WeakCachedFunction`, so it does not actually pin the objects into memory",
    "created_at": "2022-08-07T18:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682844",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>But now I realize the premise is wrong - `CachedRepresentation`/`UniqueRepresentation` use `WeakCachedFunction`, so it does not actually pin the objects into memory



---

archive/issue_comments_682845.json:
```json
{
    "body": "<a id='comment:13'></a>Indeed, it is a weak cache. However, if this needs to be done in a tight loop, the extra overhead of checking and maintaining the cache might matter. To the profiler!",
    "created_at": "2022-08-07T23:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-682845",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Indeed, it is a weak cache. However, if this needs to be done in a tight loop, the extra overhead of checking and maintaining the cache might matter. To the profiler!



---

archive/issue_events_089325.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34278#event-89325"
}
```
