# Issue 34448: Put tensor modules of FiniteRankFreeModule in Modules().TensorProducts()

archive/issues_034211.json:
```json
{
    "body": "... and add the method `tensor_factors` (#34393)\n\nalso add construction functors for tensor modules, extending #30235.\n\n\nCC:  @tscrim @egourgoulhon @fchapoton\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Matthias Koeppe\n\nBranch: e10f9cf17bd06784805914b63b7ae0adc4423c96\n\nDependencies: #34424, #34393, #31276, #30235, #30229, #30241, #34501\n\nCommit: e10f9cf17bd06784805914b63b7ae0adc4423c96\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34448\n\n",
    "closed_at": "2022-09-29T21:02:29Z",
    "created_at": "2022-08-28T23:29:22Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Put tensor modules of FiniteRankFreeModule in Modules().TensorProducts()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34448",
    "user": "https://github.com/mkoeppe"
}
```
... and add the method `tensor_factors` (#34393)

also add construction functors for tensor modules, extending #30235.


CC:  @tscrim @egourgoulhon @fchapoton

Reviewer: Eric Gourgoulhon

Author: Matthias Koeppe

Branch: e10f9cf17bd06784805914b63b7ae0adc4423c96

Dependencies: #34424, #34393, #31276, #30235, #30229, #30241, #34501

Commit: e10f9cf17bd06784805914b63b7ae0adc4423c96

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34448





---

archive/issue_comments_484714.json:
```json
{
    "body": "<a id='comment:5'></a>Last 10 new commits:",
    "created_at": "2022-08-29T02:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484714",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Last 10 new commits:



---

archive/issue_comments_484715.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-29T02:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_089532.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34448#event-89532"
}
```



---

archive/issue_comments_484716.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-09-02T18:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_484717.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-02T18:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484718.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-04T19:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484719.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-06T21:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484719",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484720.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-07T00:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484721.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-07T01:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484722.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-07T01:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484722",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484723.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-07T18:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484723",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484724.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-24T21:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484725.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-25T23:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484725",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484726.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-25T23:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484726",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484727.json:
```json
{
    "body": "<a id='comment:22'></a>LGTM for the part in `sage.tensor.modules`. Regarding the part in `sage.manifolds.differentiable`, there are the following changes in the class `VectorFieldModule`:\n\n```diff\n-    def tensor(self, tensor_type, name=None, latex_name=None, sym=None,\n+    def _tensor(self, tensor_type, name=None, latex_name=None, sym=None,\n```\nand\n\n```diff\n+    tensor = FiniteRankFreeModule.tensor\n```\nNow, instances of `VectorFieldModule` are not free modules (those are implemented via `VectorFieldFreeModule` instead), so having `VectorFieldModule.tensor` being `FiniteRankFreeModule.tensor` looks problematic. For instance:\n\n```\nsage: M = manifolds.Sphere(2)\nsage: XM = M.vector_field_module()\nsage: XM.tensor?\n   Construct a tensor on the free module \"self\" or a tensor product\n   with other modules.\n   ...\n```\nbut `self` is not a free module. Maybe declaring `tensor = _tensor` would be preferable here. \n\nI understand that bringing tensor modules on `VectorFieldModule` in `Modules().TensorProducts()` is beyond the scope of this ticket. In particular we have still `category=Modules(self._ring)` in `TensorFieldModule.__init__`.",
    "created_at": "2022-09-26T13:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484727",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:22'></a>LGTM for the part in `sage.tensor.modules`. Regarding the part in `sage.manifolds.differentiable`, there are the following changes in the class `VectorFieldModule`:

```diff
-    def tensor(self, tensor_type, name=None, latex_name=None, sym=None,
+    def _tensor(self, tensor_type, name=None, latex_name=None, sym=None,
```
and

```diff
+    tensor = FiniteRankFreeModule.tensor
```
Now, instances of `VectorFieldModule` are not free modules (those are implemented via `VectorFieldFreeModule` instead), so having `VectorFieldModule.tensor` being `FiniteRankFreeModule.tensor` looks problematic. For instance:

```
sage: M = manifolds.Sphere(2)
sage: XM = M.vector_field_module()
sage: XM.tensor?
   Construct a tensor on the free module "self" or a tensor product
   with other modules.
   ...
```
but `self` is not a free module. Maybe declaring `tensor = _tensor` would be preferable here. 

I understand that bringing tensor modules on `VectorFieldModule` in `Modules().TensorProducts()` is beyond the scope of this ticket. In particular we have still `category=Modules(self._ring)` in `TensorFieldModule.__init__`.



---

archive/issue_comments_484728.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 Eric Gourgoulhon]:\n> I understand that bringing tensor modules on `VectorFieldModule` in `Modules().TensorProducts()` is beyond the scope of this ticket.\n\n\nThe next step in this direction is #34589",
    "created_at": "2022-09-26T17:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484728",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Replying to [comment:22 Eric Gourgoulhon]:
> I understand that bringing tensor modules on `VectorFieldModule` in `Modules().TensorProducts()` is beyond the scope of this ticket.


The next step in this direction is #34589



---

archive/issue_comments_484729.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-26T17:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484730.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:22 Eric Gourgoulhon]:\n> LGTM for the part in `sage.tensor.modules`. Regarding the part in `sage.manifolds.differentiable`, there are the following changes in the class `VectorFieldModule`:\n> \n> ```\n> #!diff\n> -    def tensor(self, tensor_type, name=None, latex_name=None, sym=None,\n> +    def _tensor(self, tensor_type, name=None, latex_name=None, sym=None,\n> ```\n> and\n> \n> ```\n> #!diff\n> +    tensor = FiniteRankFreeModule.tensor\n> ```\n\n\nThanks for catching this. I've reverted this change.",
    "created_at": "2022-09-26T17:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484730",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Replying to [comment:22 Eric Gourgoulhon]:
> LGTM for the part in `sage.tensor.modules`. Regarding the part in `sage.manifolds.differentiable`, there are the following changes in the class `VectorFieldModule`:
> 
> ```
> #!diff
> -    def tensor(self, tensor_type, name=None, latex_name=None, sym=None,
> +    def _tensor(self, tensor_type, name=None, latex_name=None, sym=None,
> ```
> and
> 
> ```
> #!diff
> +    tensor = FiniteRankFreeModule.tensor
> ```


Thanks for catching this. I've reverted this change.



---

archive/issue_comments_484731.json:
```json
{
    "body": "<a id='comment:26'></a>Thanks!",
    "created_at": "2022-09-27T09:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484731",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:26'></a>Thanks!



---

archive/issue_comments_484732.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-27T09:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484732",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484733.json:
```json
{
    "body": "<a id='comment:27'></a>Thank you!",
    "created_at": "2022-09-27T17:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Thank you!



---

archive/issue_events_089533.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-29T21:02:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34448#event-89533"
}
```



---

archive/issue_comments_484734.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-29T21:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34448#issuecomment-484734",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
