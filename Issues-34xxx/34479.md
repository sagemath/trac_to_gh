# Issue 34479: Polyhedron(backend='number_field')

archive/issues_034242.json:
```json
{
    "body": "(from #33752)\n\nWe lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from the backend `normaliz` and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.\n\nThis results in rather general (but slow) polyhedral code for algebraic data in pure Python.\n\n\nCC:  @yuan-zhou @kliem @jplab @videlec @tscrim\n\nBranch/Commit: c729884f9c1c4b6921fa2b6f0d6da92256f6811d\n\nReviewer: Matthias Koeppe, Travis Scrimshaw\n\nAuthor: Matthias Koeppe, Yuan Zhou\n\nDependencies: #34195\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34479\n\n",
    "closed_at": "2022-09-28T23:04:13Z",
    "created_at": "2022-09-02T02:29:55Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Polyhedron(backend='number_field')",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34479",
    "user": "https://github.com/mkoeppe"
}
```
(from #33752)

We lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from the backend `normaliz` and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.

This results in rather general (but slow) polyhedral code for algebraic data in pure Python.


CC:  @yuan-zhou @kliem @jplab @videlec @tscrim

Branch/Commit: c729884f9c1c4b6921fa2b6f0d6da92256f6811d

Reviewer: Matthias Koeppe, Travis Scrimshaw

Author: Matthias Koeppe, Yuan Zhou

Dependencies: #34195

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34479





---

archive/issue_comments_518891.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n (from #33752)\n \n We lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from Normaliz and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.\n+\n+This results in rather general (but slow) polyhedral code for algebraic data in pure Python.\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2022-09-02T02:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518891",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,9 @@
 (from #33752)
 
 We lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from Normaliz and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.
+
+This results in rather general (but slow) polyhedral code for algebraic data in pure Python.
+
 
 Comment: 1
 
```




---

archive/issue_comments_518892.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-02T02:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518892",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_518893.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+(from #33752)\n+\n+We lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from the backend `normaliz` and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.\n+\n+This results in rather general (but slow) polyhedral code for algebraic data in pure Python.\n \n \n Comment: 1\n```\n",
    "created_at": "2022-09-02T02:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518893",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,8 @@
+(from #33752)
+
+We lift the conversion code that sends symbolic and AA elements to a suitable embedded number field and back from the backend `normaliz` and create a new backend `number_field`, which just runs backend `field` on the converted number field elements.
+
+This results in rather general (but slow) polyhedral code for algebraic data in pure Python.
 
 
 Comment: 1
```




---

archive/issue_comments_518894.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-09-02T03:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_518895.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-02T03:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_518896.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-02T03:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_518897.json:
```json
{
    "body": "<a id='comment:10'></a>`assert polymake_base_field  # to muffle pyflakes` breaks polymake tests\n\nMy workaround is\n\n```diff\n     elif backend == 'polymake':\n         base_field = base_ring.fraction_field()\n         try:\n-            from sage.interfaces.polymake import polymake\n+            from sage.interfaces.polymake import polymake, PolymakeElement\n             polymake_base_field = polymake(base_field)\n+            assert isinstance(polymake_base_field, PolymakeElement)  # to muffle pyflakes\n         except TypeError:\n```",
    "created_at": "2022-09-02T12:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518897",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:10'></a>`assert polymake_base_field  # to muffle pyflakes` breaks polymake tests

My workaround is

```diff
     elif backend == 'polymake':
         base_field = base_ring.fraction_field()
         try:
-            from sage.interfaces.polymake import polymake
+            from sage.interfaces.polymake import polymake, PolymakeElement
             polymake_base_field = polymake(base_field)
+            assert isinstance(polymake_base_field, PolymakeElement)  # to muffle pyflakes
         except TypeError:
```



---

archive/issue_comments_518898.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks for catching this. This is actually from #34195",
    "created_at": "2022-09-02T15:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518898",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Thanks for catching this. This is actually from #34195



---

archive/issue_comments_518899.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-09T07:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_518900.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-09T07:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518900",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_518901.json:
```json
{
    "body": "<a id='comment:15'></a>Probably `_compute_nmz_data_lists_and_field` should be renamed",
    "created_at": "2022-09-09T14:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518901",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Probably `_compute_nmz_data_lists_and_field` should be renamed



---

archive/issue_comments_518902.json:
```json
{
    "body": "<a id='comment:16'></a>\n```\n     def _init_from_Vrepresentation(self, vertices, rays, lines,\n-                                   minimize=True, verbose=False):\n+                                   minimize=True, verbose=False, number_field=None):\n```\nAlso this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. \n\nThat we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)",
    "created_at": "2022-09-09T15:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518902",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
```
     def _init_from_Vrepresentation(self, vertices, rays, lines,
-                                   minimize=True, verbose=False):
+                                   minimize=True, verbose=False, number_field=None):
```
Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. 

That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)



---

archive/issue_comments_518903.json:
```json
{
    "body": "<a id='comment:18'></a>New commits:",
    "created_at": "2022-09-09T17:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>New commits:



---

archive/issue_comments_518904.json:
```json
{
    "body": "<a id='comment:19'></a>How about renaming it to `_compute_data_lists_and_internal_base_ring`?\nReplying to [comment:15 Matthias K\u00f6ppe]:\n> Probably `_compute_nmz_data_lists_and_field` should be renamed",
    "created_at": "2022-09-09T21:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518904",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:19'></a>How about renaming it to `_compute_data_lists_and_internal_base_ring`?
Replying to [comment:15 Matthias Köppe]:
> Probably `_compute_nmz_data_lists_and_field` should be renamed



---

archive/issue_comments_518905.json:
```json
{
    "body": "<a id='comment:20'></a>Sounds good. I notice that `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?\n\nReplying to [comment:16 Matthias K\u00f6ppe]:\n> {{{\n>      def _init_from_Vrepresentation(self, vertices, rays, lines,\n> -                                   minimize=True, verbose=False):\n> +                                   minimize=True, verbose=False, number_field=None):\n> }}}\n> Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. \n> \n> That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)",
    "created_at": "2022-09-09T21:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518905",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:20'></a>Sounds good. I notice that `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?

Replying to [comment:16 Matthias Köppe]:
> {{{
>      def _init_from_Vrepresentation(self, vertices, rays, lines,
> -                                   minimize=True, verbose=False):
> +                                   minimize=True, verbose=False, number_field=None):
> }}}
> Also this new parameter should probably not be called `number_field` but rather `internal_base_ring` or something like this. 
> 
> That we use a number field for the computation is specific to the new subclass `Polyhedron_number_field`. (Later, another subclass could be using `SymbolicValuesRing` from #30234.)



---

archive/issue_comments_518906.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:19 Yuan Zhou]:\n> How about renaming it to `_compute_data_lists_and_internal_base_ring`?\n\n\nSounds good",
    "created_at": "2022-09-09T21:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518906",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Replying to [comment:19 Yuan Zhou]:
> How about renaming it to `_compute_data_lists_and_internal_base_ring`?


Sounds good



---

archive/issue_comments_518907.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 Yuan Zhou]:\n>  `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?\n\n\nProbably a good idea to rename it too",
    "created_at": "2022-09-09T21:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518907",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Replying to [comment:20 Yuan Zhou]:
>  `backend_normaliz.py` has a similar attribute `self._normaliz_field = normaliz_field`, which is not always a field. Do we need to change that too?


Probably a good idea to rename it too



---

archive/issue_comments_518908.json:
```json
{
    "body": "<a id='comment:24'></a>Renamed.\n\n---\nNew commits:",
    "created_at": "2022-09-09T22:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518908",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:24'></a>Renamed.

---
New commits:



---

archive/issue_comments_518909.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-09T22:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_518910.json:
```json
{
    "body": "<a id='comment:27'></a>This works well\n\n---\nNew commits:",
    "created_at": "2022-09-09T23:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518910",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>This works well

---
New commits:



---

archive/issue_events_089583.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-09T23:51:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34479#event-89583"
}
```



---

archive/issue_comments_518911.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-09T23:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518911",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_518912.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-10T00:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_518913.json:
```json
{
    "body": "<a id='comment:31'></a>I would be happy to mark it as a positive review once the patchbot comes back green. If anyone has any objections before that, please do so.",
    "created_at": "2022-09-10T05:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518913",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>I would be happy to mark it as a positive review once the patchbot comes back green. If anyone has any objections before that, please do so.



---

archive/issue_comments_518914.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-26T00:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518914",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_518915.json:
```json
{
    "body": "<a id='comment:33'></a>All green, Lint failures unrelated.",
    "created_at": "2022-09-26T00:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518915",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>All green, Lint failures unrelated.



---

archive/issue_events_089584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-28T23:04:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34479#event-89584"
}
```



---

archive/issue_comments_518916.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-28T23:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-518916",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
