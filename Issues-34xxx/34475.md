# Issue 34475: Generalize SubspaceFunctor to CombinatorialFreeModule

archive/issues_034238.json:
```json
{
    "assignees": [],
    "body": "It currently uses:\n\n```\n    def _apply_functor(self, ambient):\n        return ambient.span_of_basis(self.basis)\n```\nThe method `span_of_basis` is only defined for the free modules of `sage.modules`. We generalize it to `CombinatorialFreeModule` (and all `ModulesWithBasis`).\n\nFollow up: Handle the case of tensor modules of a `FiniteRankFreeModule`: only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.\n\n\nCC:  @tscrim @egourgoulhon @simon-king-jena\n\nComponent: **linear algebra**\n\nAuthor: **Matthias Koeppe**\n\nBranch/Commit: **[u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule) @ [`1ed6b44`](https://github.com/sagemath/sagetrac-mirror/commit/1ed6b44d3f227c5e8dea7c05ee3dbed3e23ee0de)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34475_\n\n",
    "created_at": "2022-09-01T17:26:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Generalize SubspaceFunctor to CombinatorialFreeModule",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/34475",
    "user": "https://github.com/mkoeppe"
}
```
It currently uses:

```
    def _apply_functor(self, ambient):
        return ambient.span_of_basis(self.basis)
```
The method `span_of_basis` is only defined for the free modules of `sage.modules`. We generalize it to `CombinatorialFreeModule` (and all `ModulesWithBasis`).

Follow up: Handle the case of tensor modules of a `FiniteRankFreeModule`: only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.


CC:  @tscrim @egourgoulhon @simon-king-jena

Component: **linear algebra**

Author: **Matthias Koeppe**

Branch/Commit: **[u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule) @ [`1ed6b44`](https://github.com/sagemath/sagetrac-mirror/commit/1ed6b44d3f227c5e8dea7c05ee3dbed3e23ee0de)**

_Issue created by migration from https://trac.sagemath.org/ticket/34475_





---

archive/issue_events_467429.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T17:26:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467429"
}
```



---

archive/issue_events_467430.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T17:26:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467430"
}
```



---

archive/issue_events_467431.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T17:26:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467431"
}
```



---

archive/issue_events_467432.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T17:26:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467432"
}
```



---

archive/issue_comments_556826.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,7 @@\n     def _apply_functor(self, ambient):\n         return ambient.span_of_basis(self.basis)\n ```\n-The method `span_of_basis` is only defined for the free modules of `sage.modules`\n+The method `span_of_basis` is only defined for the free modules of `sage.modules`.\n+\n+For the case of tensor modules of a `FiniteRankFreeModule`, we only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.\n+\n``````\n",
    "created_at": "2022-09-01T17:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556826",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,7 @@
     def _apply_functor(self, ambient):
         return ambient.span_of_basis(self.basis)
 ```
-The method `span_of_basis` is only defined for the free modules of `sage.modules`
+The method `span_of_basis` is only defined for the free modules of `sage.modules`.
+
+For the case of tensor modules of a `FiniteRankFreeModule`, we only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.
+
``````




---

archive/issue_comments_556827.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis is complicated by the special treatment of dense integer free modules in `span_of_basis` (vaguely related: #29315)",
    "created_at": "2022-09-01T18:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556827",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

This is complicated by the special treatment of dense integer free modules in `span_of_basis` (vaguely related: #29315)



---

archive/issue_comments_556828.json:
```json
{
    "body": "Branch: **[u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule)**",
    "created_at": "2022-09-01T18:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556828",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/generalize_subspacefunctor_to_combinatorialfreemodule_and_finiterankfreemodule)**



---

archive/issue_comments_556829.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5b2c9162d97da361d3085db189e63cd72c4546\"><code>bf5b2c9</code></a></td><td><code>src/sage/categories/modules_with_basis.py (ModulesWithBasis.Subobjects): Add construction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9414bc42581839747d9a3821996ea89414a71b46\"><code>9414bc4</code></a></td><td><code>src/sage/categories/pushout.py (SubspaceFunctor): WIP add doctest</code></td></tr></table>\n",
    "created_at": "2022-09-01T19:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556829",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5b2c9162d97da361d3085db189e63cd72c4546"><code>bf5b2c9</code></a></td><td><code>src/sage/categories/modules_with_basis.py (ModulesWithBasis.Subobjects): Add construction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9414bc42581839747d9a3821996ea89414a71b46"><code>9414bc4</code></a></td><td><code>src/sage/categories/pushout.py (SubspaceFunctor): WIP add doctest</code></td></tr></table>




---

archive/issue_comments_556830.json:
```json
{
    "body": "Commit: **[`9414bc4`](https://github.com/sagemath/sagetrac-mirror/commit/9414bc42581839747d9a3821996ea89414a71b46)**",
    "created_at": "2022-09-01T19:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556830",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`9414bc4`](https://github.com/sagemath/sagetrac-mirror/commit/9414bc42581839747d9a3821996ea89414a71b46)**



---

archive/issue_comments_556831.json:
```json
{
    "body": "Changed commit from **[`9414bc4`](https://github.com/sagemath/sagetrac-mirror/commit/9414bc42581839747d9a3821996ea89414a71b46)** to **[`c1e771b`](https://github.com/sagemath/sagetrac-mirror/commit/c1e771b126dcb8084a8cdb24a2f14d8a7fedfe6a)**",
    "created_at": "2022-09-01T21:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556831",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9414bc4`](https://github.com/sagemath/sagetrac-mirror/commit/9414bc42581839747d9a3821996ea89414a71b46)** to **[`c1e771b`](https://github.com/sagemath/sagetrac-mirror/commit/c1e771b126dcb8084a8cdb24a2f14d8a7fedfe6a)**



---

archive/issue_comments_556832.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1e771b126dcb8084a8cdb24a2f14d8a7fedfe6a\"><code>c1e771b</code></a></td><td><code>src/sage/categories/pushout.py (SubspaceFunctor): Generalize to ModulesWithBasis</code></td></tr></table>\n",
    "created_at": "2022-09-01T21:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556832",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1e771b126dcb8084a8cdb24a2f14d8a7fedfe6a"><code>c1e771b</code></a></td><td><code>src/sage/categories/pushout.py (SubspaceFunctor): Generalize to ModulesWithBasis</code></td></tr></table>




---

archive/issue_comments_556833.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2022-09-01T21:58:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556833",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_556834.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n     def _apply_functor(self, ambient):\n         return ambient.span_of_basis(self.basis)\n ```\n-The method `span_of_basis` is only defined for the free modules of `sage.modules`.\n+The method `span_of_basis` is only defined for the free modules of `sage.modules`. We generalize it to `CombinatorialFreeModule` (and all `ModulesWithBasis`).\n \n-For the case of tensor modules of a `FiniteRankFreeModule`, we only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.\n+Follow up: Handle the case of tensor modules of a `FiniteRankFreeModule`: only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.\n \n``````\n",
    "created_at": "2022-09-01T22:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556834",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
     def _apply_functor(self, ambient):
         return ambient.span_of_basis(self.basis)
 ```
-The method `span_of_basis` is only defined for the free modules of `sage.modules`.
+The method `span_of_basis` is only defined for the free modules of `sage.modules`. We generalize it to `CombinatorialFreeModule` (and all `ModulesWithBasis`).
 
-For the case of tensor modules of a `FiniteRankFreeModule`, we only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.
+Follow up: Handle the case of tensor modules of a `FiniteRankFreeModule`: only detect whether the given basis is one of the submodules with prescribed symmetries from #30229; in all other cases, we raise `NotImplementedError`.
 
``````




---

archive/issue_events_467433.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T22:26:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467433"
}
```



---

archive/issue_events_467434.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-01T22:26:28Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "title_is": "Generalize SubspaceFunctor to CombinatorialFreeModule",
    "title_was": "Generalize SubspaceFunctor to CombinatorialFreeModule and FiniteRankFreeModule",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467434"
}
```



---

archive/issue_comments_556835.json:
```json
{
    "body": "Changed dependencies from **#30229** to none",
    "created_at": "2022-09-01T22:26:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556835",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30229** to none



---

archive/issue_comments_556836.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7b85dbf412d35e493d9d195f75f419b9d82059b\"><code>c7b85db</code></a></td><td><code>ModulesWithBasis.ParentMethods.construction: Add doctest</code></td></tr></table>\n",
    "created_at": "2022-09-02T02:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556836",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7b85dbf412d35e493d9d195f75f419b9d82059b"><code>c7b85db</code></a></td><td><code>ModulesWithBasis.ParentMethods.construction: Add doctest</code></td></tr></table>




---

archive/issue_comments_556837.json:
```json
{
    "body": "Changed commit from **[`c1e771b`](https://github.com/sagemath/sagetrac-mirror/commit/c1e771b126dcb8084a8cdb24a2f14d8a7fedfe6a)** to **[`c7b85db`](https://github.com/sagemath/sagetrac-mirror/commit/c7b85dbf412d35e493d9d195f75f419b9d82059b)**",
    "created_at": "2022-09-02T02:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556837",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c1e771b`](https://github.com/sagemath/sagetrac-mirror/commit/c1e771b126dcb8084a8cdb24a2f14d8a7fedfe6a)** to **[`c7b85db`](https://github.com/sagemath/sagetrac-mirror/commit/c7b85dbf412d35e493d9d195f75f419b9d82059b)**



---

archive/issue_comments_556838.json:
```json
{
    "body": "Changed commit from **[`c7b85db`](https://github.com/sagemath/sagetrac-mirror/commit/c7b85dbf412d35e493d9d195f75f419b9d82059b)** to **[`089188f`](https://github.com/sagemath/sagetrac-mirror/commit/089188fb168924f34f9d8d055ef6f3a0f7000212)**",
    "created_at": "2022-09-02T02:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556838",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c7b85db`](https://github.com/sagemath/sagetrac-mirror/commit/c7b85dbf412d35e493d9d195f75f419b9d82059b)** to **[`089188f`](https://github.com/sagemath/sagetrac-mirror/commit/089188fb168924f34f9d8d055ef6f3a0f7000212)**



---

archive/issue_comments_556839.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/089188fb168924f34f9d8d055ef6f3a0f7000212\"><code>089188f</code></a></td><td><code>src/sage/categories/modules_with_basis.py: Update doctest output</code></td></tr></table>\n",
    "created_at": "2022-09-02T02:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556839",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/089188fb168924f34f9d8d055ef6f3a0f7000212"><code>089188f</code></a></td><td><code>src/sage/categories/modules_with_basis.py: Update doctest output</code></td></tr></table>




---

archive/issue_comments_556840.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI am somewhat hesitant to have the construction be defined at the category level because it is such a universal method (mainly, construction as a what?; cf. gens()). For the tensor products, that carries functorial properties that subspaces do not do. Typically we add structure to submodules. In other words, it is common to have (mathematically) a specific algebra defined as a submodule of linear transformations (the classical Lie algebras are important examples). Of course, that is not how we have generally implemented them in Sage, but it wouldn\u2019t be wrong to, say, have the Lie algebra sl<sub>n</sub> of traceless `n x n` matrices be in the join category `LieAlgebras(R) & Modules(R).Subobjects()` (although this would lead to other conflicts with their relationship with their universal enveloping algebra and considering them as a Lie subalgebra of that (under the commutator bracket)). So the test suite would fail unless the user provides a `constructor` method.\n\nFor tensor/Cartesian products, they are almost always built from more fundamental objects as inputs that funnels into a few classes. In particular, one can easily identify what class should be used to make, e.g., tensor products. So I feel the trade off is in favor of doing it at the category level. This is in contrast to here, where we cannot have any such distinguished class.",
    "created_at": "2022-09-04T23:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556840",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

I am somewhat hesitant to have the construction be defined at the category level because it is such a universal method (mainly, construction as a what?; cf. gens()). For the tensor products, that carries functorial properties that subspaces do not do. Typically we add structure to submodules. In other words, it is common to have (mathematically) a specific algebra defined as a submodule of linear transformations (the classical Lie algebras are important examples). Of course, that is not how we have generally implemented them in Sage, but it wouldn’t be wrong to, say, have the Lie algebra sl<sub>n</sub> of traceless `n x n` matrices be in the join category `LieAlgebras(R) & Modules(R).Subobjects()` (although this would lead to other conflicts with their relationship with their universal enveloping algebra and considering them as a Lie subalgebra of that (under the commutator bracket)). So the test suite would fail unless the user provides a `constructor` method.

For tensor/Cartesian products, they are almost always built from more fundamental objects as inputs that funnels into a few classes. In particular, one can easily identify what class should be used to make, e.g., tensor products. So I feel the trade off is in favor of doing it at the category level. This is in contrast to here, where we cannot have any such distinguished class.



---

archive/issue_comments_556841.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nDoes this concern go away if I move this method to `sage.modules.with_basis.subquotient.SubmoduleWithBasis`?",
    "created_at": "2022-09-05T00:04:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556841",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

Does this concern go away if I move this method to `sage.modules.with_basis.subquotient.SubmoduleWithBasis`?



---

archive/issue_comments_556842.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nYes, it does. If it is done there, then it is a specific class with a specific implementation. Things at the category level should (generally) be implementation agnostic.",
    "created_at": "2022-09-05T00:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556842",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Yes, it does. If it is done there, then it is a specific class with a specific implementation. Things at the category level should (generally) be implementation agnostic.



---

archive/issue_comments_556843.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n... except that the category does invoke that class in its `submodule` method.",
    "created_at": "2022-09-05T00:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556843",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

... except that the category does invoke that class in its `submodule` method.



---

archive/issue_comments_556844.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIt is a generic implementation and it is the best attempt at doing something without making it an `@abstract_method(optional=True)`. The `SubmoduleWithBasis` should, in principle, work with anything in the category. Unfortunately I don\u2019t think we are quite at that reality yet.",
    "created_at": "2022-09-05T00:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556844",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

It is a generic implementation and it is the best attempt at doing something without making it an `@abstract_method(optional=True)`. The `SubmoduleWithBasis` should, in principle, work with anything in the category. Unfortunately I don’t think we are quite at that reality yet.



---

archive/issue_comments_556845.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f7d4fc004b6123faa355d40c7ef4631bc05d8b3\"><code>9f7d4fc</code></a></td><td><code>SubmoduleWithBasis.construction: Move here from ModulesWithBasis.Subobjects</code></td></tr></table>\n",
    "created_at": "2022-09-05T01:03:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556845",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f7d4fc004b6123faa355d40c7ef4631bc05d8b3"><code>9f7d4fc</code></a></td><td><code>SubmoduleWithBasis.construction: Move here from ModulesWithBasis.Subobjects</code></td></tr></table>




---

archive/issue_comments_556846.json:
```json
{
    "body": "Changed commit from **[`089188f`](https://github.com/sagemath/sagetrac-mirror/commit/089188fb168924f34f9d8d055ef6f3a0f7000212)** to **[`9f7d4fc`](https://github.com/sagemath/sagetrac-mirror/commit/9f7d4fc004b6123faa355d40c7ef4631bc05d8b3)**",
    "created_at": "2022-09-05T01:03:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556846",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`089188f`](https://github.com/sagemath/sagetrac-mirror/commit/089188fb168924f34f9d8d055ef6f3a0f7000212)** to **[`9f7d4fc`](https://github.com/sagemath/sagetrac-mirror/commit/9f7d4fc004b6123faa355d40c7ef4631bc05d8b3)**



---

archive/issue_comments_556847.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ad074d7ddb8d2b24fd0865bfc5040180e3f8629\"><code>2ad074d</code></a></td><td><code>SubmoduleWithBasis.construction: Move here from ModulesWithBasis.Subobjects</code></td></tr></table>\n",
    "created_at": "2022-09-05T01:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556847",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ad074d7ddb8d2b24fd0865bfc5040180e3f8629"><code>2ad074d</code></a></td><td><code>SubmoduleWithBasis.construction: Move here from ModulesWithBasis.Subobjects</code></td></tr></table>




---

archive/issue_comments_556848.json:
```json
{
    "body": "Changed commit from **[`9f7d4fc`](https://github.com/sagemath/sagetrac-mirror/commit/9f7d4fc004b6123faa355d40c7ef4631bc05d8b3)** to **[`2ad074d`](https://github.com/sagemath/sagetrac-mirror/commit/2ad074d7ddb8d2b24fd0865bfc5040180e3f8629)**",
    "created_at": "2022-09-05T01:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556848",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9f7d4fc`](https://github.com/sagemath/sagetrac-mirror/commit/9f7d4fc004b6123faa355d40c7ef4631bc05d8b3)** to **[`2ad074d`](https://github.com/sagemath/sagetrac-mirror/commit/2ad074d7ddb8d2b24fd0865bfc5040180e3f8629)**



---

archive/issue_comments_556849.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6536b72e4f85e40b127ead533e377cf66781bbc5\"><code>6536b72</code></a></td><td><code>FiniteDimensionalModulesWithBasis.Subobjects: New</code></td></tr></table>\n",
    "created_at": "2022-09-05T01:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556849",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6536b72e4f85e40b127ead533e377cf66781bbc5"><code>6536b72</code></a></td><td><code>FiniteDimensionalModulesWithBasis.Subobjects: New</code></td></tr></table>




---

archive/issue_comments_556850.json:
```json
{
    "body": "Changed commit from **[`2ad074d`](https://github.com/sagemath/sagetrac-mirror/commit/2ad074d7ddb8d2b24fd0865bfc5040180e3f8629)** to **[`6536b72`](https://github.com/sagemath/sagetrac-mirror/commit/6536b72e4f85e40b127ead533e377cf66781bbc5)**",
    "created_at": "2022-09-05T01:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556850",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2ad074d`](https://github.com/sagemath/sagetrac-mirror/commit/2ad074d7ddb8d2b24fd0865bfc5040180e3f8629)** to **[`6536b72`](https://github.com/sagemath/sagetrac-mirror/commit/6536b72e4f85e40b127ead533e377cf66781bbc5)**



---

archive/issue_comments_556851.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIs there a way to shorten \"Category of subobjects of modules with basis over Integer Ring\" to \"Category of submodules with basis over Integer Ring\"?",
    "created_at": "2022-09-05T01:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556851",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Is there a way to shorten "Category of subobjects of modules with basis over Integer Ring" to "Category of submodules with basis over Integer Ring"?



---

archive/issue_comments_556852.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThere a few failures of `_test_construction` tests.\nAt least one of them is a case where the equality of a `UniqueRepresentation` is too strict:\n\n```\nsage: from sage.modules.with_basis.subquotient import SubmoduleWithBasis\nsage: X = CombinatorialFreeModule(QQ, range(3), prefix=\"x\"); x = X.basis()\nsage: ybas = (x[0]-x[1], x[1]-x[2])\nsage: Y = SubmoduleWithBasis(ybas, [0, 1, 2], X)\nsage: Y.print_options(prefix='y')\nsage: F, B = Y.construction()\nsage: Y2 = F(B)\nsage: Y2\nFree module generated by {0, 1} over Rational Field\nsage: Y\nFree module generated by {0, 1} over Rational Field\nsage: Y2.basis()\nFinite family {0: B[0], 1: B[1]}\nsage: Y.basis()\nFinite family {0: y[0], 1: y[1]}\nsage: Y == Y2\nFalse\nsage: Y.is_submodule(Y2)\nTrue\nsage: Y2.is_submodule(Y)\nTrue\n```",
    "created_at": "2022-09-05T01:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556852",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

There a few failures of `_test_construction` tests.
At least one of them is a case where the equality of a `UniqueRepresentation` is too strict:

```
sage: from sage.modules.with_basis.subquotient import SubmoduleWithBasis
sage: X = CombinatorialFreeModule(QQ, range(3), prefix="x"); x = X.basis()
sage: ybas = (x[0]-x[1], x[1]-x[2])
sage: Y = SubmoduleWithBasis(ybas, [0, 1, 2], X)
sage: Y.print_options(prefix='y')
sage: F, B = Y.construction()
sage: Y2 = F(B)
sage: Y2
Free module generated by {0, 1} over Rational Field
sage: Y
Free module generated by {0, 1} over Rational Field
sage: Y2.basis()
Finite family {0: B[0], 1: B[1]}
sage: Y.basis()
Finite family {0: y[0], 1: y[1]}
sage: Y == Y2
False
sage: Y.is_submodule(Y2)
True
sage: Y2.is_submodule(Y)
True
```



---

archive/issue_events_467435.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-05T01:59:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467435"
}
```



---

archive/issue_events_467436.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-05T01:59:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467436"
}
```



---

archive/issue_comments_556853.json:
```json
{
    "body": "Changed commit from **[`6536b72`](https://github.com/sagemath/sagetrac-mirror/commit/6536b72e4f85e40b127ead533e377cf66781bbc5)** to **[`1ed6b44`](https://github.com/sagemath/sagetrac-mirror/commit/1ed6b44d3f227c5e8dea7c05ee3dbed3e23ee0de)**",
    "created_at": "2022-09-05T03:15:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556853",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6536b72`](https://github.com/sagemath/sagetrac-mirror/commit/6536b72e4f85e40b127ead533e377cf66781bbc5)** to **[`1ed6b44`](https://github.com/sagemath/sagetrac-mirror/commit/1ed6b44d3f227c5e8dea7c05ee3dbed3e23ee0de)**



---

archive/issue_comments_556854.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ed6b44d3f227c5e8dea7c05ee3dbed3e23ee0de\"><code>1ed6b44</code></a></td><td><code>SubspaceFunctor, SubmoduleWithBasis.construction: Handle support_order</code></td></tr></table>\n",
    "created_at": "2022-09-05T03:15:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556854",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ed6b44d3f227c5e8dea7c05ee3dbed3e23ee0de"><code>1ed6b44</code></a></td><td><code>SubspaceFunctor, SubmoduleWithBasis.construction: Handle support_order</code></td></tr></table>




---

archive/issue_comments_556855.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [Matthias K\u00f6ppe](#comment%3A20):\n> Is there a way to shorten \"Category of subobjects of modules with basis over Integer Ring\" to \"Category of submodules with basis over Integer Ring\"?\n\nNot generically, but you can override the name of the category. You could obviously write a `_repr_()`, but I forget offhand if there is some other way to just set the short name of the category (I believe there is though).",
    "created_at": "2022-09-05T13:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556855",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [Matthias Köppe](#comment%3A20):
> Is there a way to shorten "Category of subobjects of modules with basis over Integer Ring" to "Category of submodules with basis over Integer Ring"?

Not generically, but you can override the name of the category. You could obviously write a `_repr_()`, but I forget offhand if there is some other way to just set the short name of the category (I believe there is though).



---

archive/issue_comments_556856.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [Matthias K\u00f6ppe](#comment%3A21):\n> There a few failures of `_test_construction` tests.\n> At least one of them is a case where the equality of a `UniqueRepresentation` is too strict:\n\nThis suggests to me that the functor construction is not preserving enough properties.\n\nFurthermore `==` does not have to mean mathematical equality either (what if we chose different indexing sets for the submodules?). Dealing with equal-but-not-identical parents can offer up another set of painful and subtle issues with equality and coercion. Plus we aren\u2019t able to utilize things cached with the submodule if we compute it a second time.\n\nThere are trade offs with any way we decide to implement them, but it is not fair to call it too strict.",
    "created_at": "2022-09-05T14:01:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556856",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [Matthias Köppe](#comment%3A21):
> There a few failures of `_test_construction` tests.
> At least one of them is a case where the equality of a `UniqueRepresentation` is too strict:

This suggests to me that the functor construction is not preserving enough properties.

Furthermore `==` does not have to mean mathematical equality either (what if we chose different indexing sets for the submodules?). Dealing with equal-but-not-identical parents can offer up another set of painful and subtle issues with equality and coercion. Plus we aren’t able to utilize things cached with the submodule if we compute it a second time.

There are trade offs with any way we decide to implement them, but it is not fair to call it too strict.



---

archive/issue_comments_556857.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [Travis Scrimshaw](#comment%3A25):\n> it is not fair to call it too strict.\n\nTo be clear, I'm not criticizing `UniqueRepresentation` for its moral stance ;)",
    "created_at": "2022-09-05T14:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556857",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [Travis Scrimshaw](#comment%3A25):
> it is not fair to call it too strict.

To be clear, I'm not criticizing `UniqueRepresentation` for its moral stance ;)



---

archive/issue_comments_556858.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOf course, but I am still wondering what would be a reasonable way to define `==`. Right now it is doing it the most conservative way, so things like the prefix and indexing set distinguish subspaces. However, unlike for a general module, the fact that it is a submodule means there is a canonical way to represent elements (as elements of the ambient space with its distinguished basis). I am still vary wary of effects of coercion (including coercions between the equal subspaces) with equal-but-not-identical, but that might take actually changing things to see what happens. It does make sense to downgrade the subspaces to a `CachedRepresentation`.\n\nActually, perhaps we can get a best of both worlds. We just need to extend the submodule class to somehow handle multiple indexing sets and just inform the users that the prefix is unique. In general, I expect this to a infrequently used feature, but it would be good to support the different indexing sets.",
    "created_at": "2022-09-06T02:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556858",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

Of course, but I am still wondering what would be a reasonable way to define `==`. Right now it is doing it the most conservative way, so things like the prefix and indexing set distinguish subspaces. However, unlike for a general module, the fact that it is a submodule means there is a canonical way to represent elements (as elements of the ambient space with its distinguished basis). I am still vary wary of effects of coercion (including coercions between the equal subspaces) with equal-but-not-identical, but that might take actually changing things to see what happens. It does make sense to downgrade the subspaces to a `CachedRepresentation`.

Actually, perhaps we can get a best of both worlds. We just need to extend the submodule class to somehow handle multiple indexing sets and just inform the users that the prefix is unique. In general, I expect this to a infrequently used feature, but it would be good to support the different indexing sets.



---

archive/issue_comments_556859.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nEither way, I still think the construction functor needs to better reconstruct the object too.",
    "created_at": "2022-09-06T02:49:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34475#issuecomment-556859",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

Either way, I still think the construction functor needs to better reconstruct the object too.



---

archive/issue_events_467437.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467437"
}
```



---

archive/issue_events_467438.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467438"
}
```



---

archive/issue_events_467439.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467439"
}
```



---

archive/issue_events_467440.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34475",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34475#event-467440"
}
```
