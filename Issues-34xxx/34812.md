# Issue 34812: decompose identity into generators with coxeter3

archive/issues_034575.json:
```json
{
    "body": "This fixes trivial multiplications:\n\n```\nsage: R.<v> = LaurentPolynomialRing(ZZ, 'v')                    # optional - coxeter3\nsage: W = CoxeterGroup('A3', implementation='coxeter3')         # optional - coxeter3\nsage: H = IwahoriHeckeAlgebra(W, v**2); Cp=H.Cp()               # optional - coxeter3\nsage: Cp.product_on_basis(W([1,2,1]), W([]))                 # optional - coxeter3\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\nInput In [7], in <cell line: 1>()\n----> 1 Cp.product_on_basis(W([Integer(1),Integer(2),Integer(1)]), W([]))                 # optional - coxeter3\n\nFile ~/sage-develop/src/sage/algebras/iwahori_hecke_algebra.py:2155, in IwahoriHeckeAlgebra.Cp.product_on_basis(self, w1, w2)\n   2153 else:\n   2154     side = 'right'\n-> 2155     gen_expression = self._decompose_into_generators(w2)\n   2156     other_element = self.monomial(w1)\n   2158 # Multiplication: multiply the generators in each term of the above\n   2159 # polynomial onto other_element and add that summand onto result.\n\nFile ~/sage-develop/src/sage/algebras/iwahori_hecke_algebra.py:2293, in IwahoriHeckeAlgebra.Cp._decompose_into_generators(self, u)\n   2290     return {(u[0],): 1}\n   2292 # l(y) > 1, use the recursive method described in product_on_basis\n-> 2293 s = u[0]\n   2294 w = u[1:]  # so CpC_s * CpC_w = CpC_u + lower order terms\n   2296 # get the lower order terms (\"sum_term\")\n\nFile ~/sage-develop/src/sage/libs/coxeter3/coxeter_group.py:545, in CoxeterGroup.Element.__getitem__(self, i)\n    533 \"\"\"\n    534 EXAMPLES::\n    535 \n   (...)\n    542 \n    543 \"\"\"\n    544 # Allow the error message to be raised by the underlying element\n--> 545 return self.value[i]\n\nFile ~/sage-develop/src/sage/libs/coxeter3/coxeter.pyx:784, in sage.libs.coxeter3.coxeter.CoxGroupElement.__getitem__()\n    782     i += len(self)\n    783 if i >= len(self):\n--> 784     raise IndexError(\"The index (%d) is out of range.\" % i)\n    785 \n    786 return self._parent_group.out_ordering[self.word[i]]\n\nIndexError: The index (0) is out of range.\n```\n\nCC:  @tscrim\n\nReviewer: Travis Scrimshaw\n\nAuthor: Martin Rubey\n\nBranch: 9e5f25fc08ac6dbcc360d9af83a03ddba8cb313a\n\nCommit: 9e5f25fc08ac6dbcc360d9af83a03ddba8cb313a\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34812\n\n",
    "closed_at": "2022-12-14T22:12:12Z",
    "created_at": "2022-11-30T08:01:09Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "decompose identity into generators with coxeter3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34812",
    "user": "https://github.com/mantepse"
}
```
This fixes trivial multiplications:

```
sage: R.<v> = LaurentPolynomialRing(ZZ, 'v')                    # optional - coxeter3
sage: W = CoxeterGroup('A3', implementation='coxeter3')         # optional - coxeter3
sage: H = IwahoriHeckeAlgebra(W, v**2); Cp=H.Cp()               # optional - coxeter3
sage: Cp.product_on_basis(W([1,2,1]), W([]))                 # optional - coxeter3
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
Input In [7], in <cell line: 1>()
----> 1 Cp.product_on_basis(W([Integer(1),Integer(2),Integer(1)]), W([]))                 # optional - coxeter3

File ~/sage-develop/src/sage/algebras/iwahori_hecke_algebra.py:2155, in IwahoriHeckeAlgebra.Cp.product_on_basis(self, w1, w2)
   2153 else:
   2154     side = 'right'
-> 2155     gen_expression = self._decompose_into_generators(w2)
   2156     other_element = self.monomial(w1)
   2158 # Multiplication: multiply the generators in each term of the above
   2159 # polynomial onto other_element and add that summand onto result.

File ~/sage-develop/src/sage/algebras/iwahori_hecke_algebra.py:2293, in IwahoriHeckeAlgebra.Cp._decompose_into_generators(self, u)
   2290     return {(u[0],): 1}
   2292 # l(y) > 1, use the recursive method described in product_on_basis
-> 2293 s = u[0]
   2294 w = u[1:]  # so CpC_s * CpC_w = CpC_u + lower order terms
   2296 # get the lower order terms ("sum_term")

File ~/sage-develop/src/sage/libs/coxeter3/coxeter_group.py:545, in CoxeterGroup.Element.__getitem__(self, i)
    533 """
    534 EXAMPLES::
    535 
   (...)
    542 
    543 """
    544 # Allow the error message to be raised by the underlying element
--> 545 return self.value[i]

File ~/sage-develop/src/sage/libs/coxeter3/coxeter.pyx:784, in sage.libs.coxeter3.coxeter.CoxGroupElement.__getitem__()
    782     i += len(self)
    783 if i >= len(self):
--> 784     raise IndexError("The index (%d) is out of range." % i)
    785 
    786 return self._parent_group.out_ordering[self.word[i]]

IndexError: The index (0) is out of range.
```

CC:  @tscrim

Reviewer: Travis Scrimshaw

Author: Martin Rubey

Branch: 9e5f25fc08ac6dbcc360d9af83a03ddba8cb313a

Commit: 9e5f25fc08ac6dbcc360d9af83a03ddba8cb313a

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34812





---

archive/issue_comments_488452.json:
```json
{
    "body": "<a id='comment:2'></a>Not sure whether this is the best fix.  I don't know why exactly `not len(u)` and `not u` are different.\n\n---\nNew commits:",
    "created_at": "2022-11-30T08:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488452",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:2'></a>Not sure whether this is the best fix.  I don't know why exactly `not len(u)` and `not u` are different.

---
New commits:



---

archive/issue_comments_488453.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-11-30T08:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488453",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_488454.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebra.",
    "created_at": "2022-11-30T08:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488454",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to algebra.



---

archive/issue_comments_488455.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-11-30T08:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488455",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_488456.json:
```json
{
    "body": "<a id='comment:4'></a>We want `not u` to return `True` because it is a nonzero element (in the group). This holds for all of the Coxeter group implementations. The fix you propose is what should have been there initially.",
    "created_at": "2022-11-30T08:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488456",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>We want `not u` to return `True` because it is a nonzero element (in the group). This holds for all of the Coxeter group implementations. The fix you propose is what should have been there initially.



---

archive/issue_comments_488457.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-11-30T08:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488457",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_488458.json:
```json
{
    "body": "<a id='comment:5'></a>perfect! Thank you!",
    "created_at": "2022-11-30T10:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488458",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'></a>perfect! Thank you!



---

archive/issue_comments_488459.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-12-14T22:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34812#issuecomment-488459",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_089825.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-12-14T22:12:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34812",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34812#event-89825"
}
```
