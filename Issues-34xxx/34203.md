# Issue 34203: Find and uninstall broken installed SPKGs and wheels

archive/issues_033966.json:
```json
{
    "body": "When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ\n\nTo avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n\nThe new command `make -j list-broken-packages` assists the user with this:\n\n```\n$ make -j list-broken-packages\nmake --no-print-directory auditwheel_or_delocate-no-deps\nsage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\n# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n...\nChecking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\nChecking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\nError during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\nUninstall broken packages by typing:\n\n\n    make antic-SAGE_LOCAL-uninstall;\n    make e_antic-SAGE_LOCAL-uninstall;\n    make lcalc-SAGE_LOCAL-uninstall;\n    make ratpoints-SAGE_LOCAL-uninstall;\n    make normaliz-SAGE_LOCAL-uninstall;\n    make r-SAGE_LOCAL-uninstall;\n    make backports_zoneinfo-SAGE_VENV-uninstall;\n    make fastjsonschema-SAGE_VENV-uninstall;\n    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n    make stack_data-SAGE_VENV-uninstall;\n    make tinycss2-SAGE_VENV-uninstall;\n    make tzdata-SAGE_VENV-uninstall;\n    make suitesparse-SAGE_LOCAL-uninstall;\n\nreal\t2m25.787s\nuser\t4m54.270s\nsys\t4m0.796s\n```\n\nThe core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n\n```\n$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\nChecking shared library file 'lib/libgivaro.9.dylib'\nChecking shared library file 'lib/libgivaro.dylib'\n$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\nChecking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\nChecking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\nERROR [libsana|get_dependencies:137]: \n/usr/local/opt/flint/lib/libflint-16.dylib not found:\n  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\nError during installcheck of 'e_antic': Could not find all dependencies.\n```\n\nIt inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. \n\n\n\nOn macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n\nOn Linux, instead of using `ldd` directly, we use `auditwheel.lddtree.lddtree` (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/lddtree.py)\n\n(Both packages are also used by cibuildwheel)\n\nSee also: #34205 Optionally run auditwheel/delocate on wheels before installing them\n\nCC:  @dimpase @jhpalmieri @nbruin @EmmanuelCharpentier\n\nBranch/Commit: 3c70a38483a15327118ccfcaeabf154e5d9f2af1\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nDependencies: #29097\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34203\n\n",
    "closed_at": "2022-09-20T20:22:59Z",
    "created_at": "2022-07-20T22:20:39Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Find and uninstall broken installed SPKGs and wheels",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34203",
    "user": "https://github.com/mkoeppe"
}
```
When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ

To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.

The new command `make -j list-broken-packages` assists the user with this:

```
$ make -j list-broken-packages
make --no-print-directory auditwheel_or_delocate-no-deps
sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
make[2]: warning: -jN forced in submake: disabling jobserver mode.
# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
...
Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
Uninstall broken packages by typing:


    make antic-SAGE_LOCAL-uninstall;
    make e_antic-SAGE_LOCAL-uninstall;
    make lcalc-SAGE_LOCAL-uninstall;
    make ratpoints-SAGE_LOCAL-uninstall;
    make normaliz-SAGE_LOCAL-uninstall;
    make r-SAGE_LOCAL-uninstall;
    make backports_zoneinfo-SAGE_VENV-uninstall;
    make fastjsonschema-SAGE_VENV-uninstall;
    make pytz_deprecation_shim-SAGE_VENV-uninstall;
    make stack_data-SAGE_VENV-uninstall;
    make tinycss2-SAGE_VENV-uninstall;
    make tzdata-SAGE_VENV-uninstall;
    make suitesparse-SAGE_LOCAL-uninstall;

real	2m25.787s
user	4m54.270s
sys	4m0.796s
```

The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):

```
$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
Checking shared library file 'lib/libgivaro.9.dylib'
Checking shared library file 'lib/libgivaro.dylib'
$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
ERROR [libsana|get_dependencies:137]: 
/usr/local/opt/flint/lib/libflint-16.dylib not found:
  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
Error during installcheck of 'e_antic': Could not find all dependencies.
```

It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. 



On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/

On Linux, instead of using `ldd` directly, we use `auditwheel.lddtree.lddtree` (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/lddtree.py)

(Both packages are also used by cibuildwheel)

See also: #34205 Optionally run auditwheel/delocate on wheels before installing them

CC:  @dimpase @jhpalmieri @nbruin @EmmanuelCharpentier

Branch/Commit: 3c70a38483a15327118ccfcaeabf154e5d9f2af1

Reviewer: John Palmieri

Author: Matthias Koeppe

Dependencies: #29097

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34203





---

archive/issue_comments_681307.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `build/bin/sage-spkg-installcheck` (implemented in sage_bootstrap)\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-20T23:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681307",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
 We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `build/bin/sage-spkg-installcheck` (implemented in sage_bootstrap)
+
 
 Comment: 1
 
``````




---

archive/issue_comments_681308.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `build/bin/sage-spkg-installcheck` (implemented in sage_bootstrap)\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-20T23:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681308",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `build/bin/sage-spkg-installcheck` (implemented in sage_bootstrap)
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681309.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `sage -package installcheck` (implemented in sage_bootstrap)\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-20T23:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681309",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `sage -package installcheck` (implemented in sage_bootstrap)
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681310.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap)\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-20T23:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681310",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap)
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681311.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/find_and_uninstall_broken_installed_spkgs_and_wheels\"",
    "created_at": "2022-07-20T23:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681311",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/find_and_uninstall_broken_installed_spkgs_and_wheels"



---

archive/issue_comments_681312.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-21T00:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_681313.json:
```json
{
    "body": "Changing commit from \"\" to \"562fcabd8dd959a08f5578d1cab088bbbfe05d79\"",
    "created_at": "2022-07-21T00:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681313",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "562fcabd8dd959a08f5578d1cab088bbbfe05d79"



---

archive/issue_comments_681314.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T00:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681314",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,21 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681315.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T00:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681316.json:
```json
{
    "body": "Changing commit from \"562fcabd8dd959a08f5578d1cab088bbbfe05d79\" to \"5faa8cb70b1d864b97acea0c6333a7ab29a038de\"",
    "created_at": "2022-07-21T00:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "562fcabd8dd959a08f5578d1cab088bbbfe05d79" to "5faa8cb70b1d864b97acea0c6333a7ab29a038de"



---

archive/issue_comments_681317.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T00:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681317",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,21 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681318.json:
```json
{
    "body": "Changing commit from \"5faa8cb70b1d864b97acea0c6333a7ab29a038de\" to \"92654161d6d22b1f057c468a3939ea69b4322a76\"",
    "created_at": "2022-07-21T00:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5faa8cb70b1d864b97acea0c6333a7ab29a038de" to "92654161d6d22b1f057c468a3939ea69b4322a76"



---

archive/issue_comments_681319.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T00:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681320.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,27 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T00:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681320",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,27 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681321.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T01:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681322.json:
```json
{
    "body": "Changing commit from \"92654161d6d22b1f057c468a3939ea69b4322a76\" to \"c4e33715dc092f8fcd6323f7066e3db8dcf8e941\"",
    "created_at": "2022-07-21T01:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "92654161d6d22b1f057c468a3939ea69b4322a76" to "c4e33715dc092f8fcd6323f7066e3db8dcf8e941"



---

archive/issue_comments_681323.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-07-21T01:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681323",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_681324.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,27 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T01:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681324",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,27 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681325.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,29 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The new command `make list-broken-packages` does this.\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T01:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681325",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,29 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The new command `make list-broken-packages` does this.
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681326.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T02:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681327.json:
```json
{
    "body": "Changing commit from \"c4e33715dc092f8fcd6323f7066e3db8dcf8e941\" to \"08388f7e218fb2be22bc9f3c1ab8ab0313a3cde3\"",
    "created_at": "2022-07-21T02:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c4e33715dc092f8fcd6323f7066e3db8dcf8e941" to "08388f7e218fb2be22bc9f3c1ab8ab0313a3cde3"



---

archive/issue_comments_681328.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,51 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The new command `make -j list-broken-packages` does this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+    make -k antic-clean e_antic-clean lcalc-clean ratpoints-clean normaliz-clean r-clean thebe-clean asttokens-clean backports_zoneinfo-clean executing-clean fastjsonschema-clean pure_eval-clean pytz_deprecation_shim-clean stack_data-clean tinycss2-clean tzdata-clean suitesparse-clean\n+\n+real\t0m6.671s\n+user\t0m33.285s\n+sys\t0m10.636s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T02:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681328",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,51 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The new command `make -j list-broken-packages` does this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+    make -k antic-clean e_antic-clean lcalc-clean ratpoints-clean normaliz-clean r-clean thebe-clean asttokens-clean backports_zoneinfo-clean executing-clean fastjsonschema-clean pure_eval-clean pytz_deprecation_shim-clean stack_data-clean tinycss2-clean tzdata-clean suitesparse-clean
+
+real	0m6.671s
+user	0m33.285s
+sys	0m10.636s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681329.json:
```json
{
    "body": "<a id='comment:17'></a>Ready for testing on macOS.",
    "created_at": "2022-07-21T02:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681329",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Ready for testing on macOS.



---

archive/issue_comments_681330.json:
```json
{
    "body": "Changing commit from \"08388f7e218fb2be22bc9f3c1ab8ab0313a3cde3\" to \"f2dba639703f4e1bc27dc5d4c6c21813abd0a097\"",
    "created_at": "2022-07-21T02:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "08388f7e218fb2be22bc9f3c1ab8ab0313a3cde3" to "f2dba639703f4e1bc27dc5d4c6c21813abd0a097"



---

archive/issue_comments_681331.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T02:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681332.json:
```json
{
    "body": "Changing commit from \"f2dba639703f4e1bc27dc5d4c6c21813abd0a097\" to \"b4394290c965ff06d7f498fa9812591fcc80e795\"",
    "created_at": "2022-07-21T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f2dba639703f4e1bc27dc5d4c6c21813abd0a097" to "b4394290c965ff06d7f498fa9812591fcc80e795"



---

archive/issue_comments_681333.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T03:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681333",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681334.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,66 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The new command `make -j list-broken-packages` does this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+    ./sage --buildsh -c \"sage-spkg-uninstall antic \";\n+    ./sage --buildsh -c \"sage-spkg-uninstall e_antic \";\n+    ./sage --buildsh -c \"sage-spkg-uninstall lcalc \";\n+    ./sage --buildsh -c \"sage-spkg-uninstall ratpoints \";\n+    ./sage --buildsh -c \"sage-spkg-uninstall normaliz \";\n+    ./sage --buildsh -c \"sage-spkg-uninstall r \";\n+    ./sage --buildsh -c \"sage-spkg-uninstall asttokens \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall backports_zoneinfo \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall executing \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall fastjsonschema \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall pytz_deprecation_shim \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall stack_data \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall tinycss2 \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall tzdata \\$SAGE_VENV\";\n+    ./sage --buildsh -c \"sage-spkg-uninstall suitesparse \";\n+\n+real\t0m6.671s\n+user\t0m33.285s\n+sys\t0m10.636s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T03:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681334",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,66 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The new command `make -j list-broken-packages` does this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+    ./sage --buildsh -c "sage-spkg-uninstall antic ";
+    ./sage --buildsh -c "sage-spkg-uninstall e_antic ";
+    ./sage --buildsh -c "sage-spkg-uninstall lcalc ";
+    ./sage --buildsh -c "sage-spkg-uninstall ratpoints ";
+    ./sage --buildsh -c "sage-spkg-uninstall normaliz ";
+    ./sage --buildsh -c "sage-spkg-uninstall r ";
+    ./sage --buildsh -c "sage-spkg-uninstall asttokens \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall backports_zoneinfo \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall executing \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall fastjsonschema \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall pytz_deprecation_shim \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall stack_data \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall tinycss2 \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall tzdata \$SAGE_VENV";
+    ./sage --buildsh -c "sage-spkg-uninstall suitesparse ";
+
+real	0m6.671s
+user	0m33.285s
+sys	0m10.636s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681335.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T03:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681336.json:
```json
{
    "body": "Changing commit from \"b4394290c965ff06d7f498fa9812591fcc80e795\" to \"5c104aab7a4747c1f8b1b5a49eddecfc73fdbf32\"",
    "created_at": "2022-07-21T03:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b4394290c965ff06d7f498fa9812591fcc80e795" to "5c104aab7a4747c1f8b1b5a49eddecfc73fdbf32"



---

archive/issue_comments_681337.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,65 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The new command `make -j list-broken-packages` does this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t0m6.671s\n+user\t0m33.285s\n+sys\t0m10.636s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T03:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681337",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,65 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The new command `make -j list-broken-packages` does this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	0m6.671s
+user	0m33.285s
+sys	0m10.636s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681338.json:
```json
{
    "body": "Changing commit from \"5c104aab7a4747c1f8b1b5a49eddecfc73fdbf32\" to \"1d95bbb039683c3f2068006e59401147d0d3b9ad\"",
    "created_at": "2022-07-21T03:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681338",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5c104aab7a4747c1f8b1b5a49eddecfc73fdbf32" to "1d95bbb039683c3f2068006e59401147d0d3b9ad"



---

archive/issue_comments_681339.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T03:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681340.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,65 @@\n+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.\n+\n+The new command `make -j list-broken-packages` does this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T03:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681340",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,65 @@
+We can inspect the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` by running `ldd`/`otool` on any shared libraries and uninstall them if they refer to nonexisting libraries.
+
+The new command `make -j list-broken-packages` does this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681341.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,71 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken.\n+\n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T04:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681341",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,71 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken.
+
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel show` from https://pypi.org/project/auditwheel/
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681342.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-21T04:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681342",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_681343.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,71 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken.\n+\n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ -- follow-up ticket.\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T04:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681343",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,71 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken.
+
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ -- follow-up ticket.
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681344.json:
```json
{
    "body": "Changing commit from \"1d95bbb039683c3f2068006e59401147d0d3b9ad\" to \"37eaa92eb303529f8896333c5a0e1209afd777fe\"",
    "created_at": "2022-07-21T06:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1d95bbb039683c3f2068006e59401147d0d3b9ad" to "37eaa92eb303529f8896333c5a0e1209afd777fe"



---

archive/issue_comments_681345.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-21T06:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681345",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681346.json:
```json
{
    "body": "<a id='comment:29'></a>Cherry-picked / updated the commit from #29097.",
    "created_at": "2022-07-21T06:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681346",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Cherry-picked / updated the commit from #29097.



---

archive/issue_comments_681347.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe\" to \"Matthias Koeppe, John Palmieri\"",
    "created_at": "2022-07-21T06:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681347",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe" to "Matthias Koeppe, John Palmieri"



---

archive/issue_comments_681348.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29097\"",
    "created_at": "2022-07-21T06:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681348",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29097"



---

archive/issue_comments_681349.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe, John Palmieri\" to \"Matthias Koeppe\"",
    "created_at": "2022-07-21T06:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681349",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe, John Palmieri" to "Matthias Koeppe"



---

archive/issue_comments_681350.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-07-21T06:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_681351.json:
```json
{
    "body": "Changing commit from \"37eaa92eb303529f8896333c5a0e1209afd777fe\" to \"1c24771c2cfa1d80c1571b5cfbc901c698fcb877\"",
    "created_at": "2022-07-21T06:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "37eaa92eb303529f8896333c5a0e1209afd777fe" to "1c24771c2cfa1d80c1571b5cfbc901c698fcb877"



---

archive/issue_comments_681352.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,71 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken.\n+\n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T08:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681352",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,71 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken.
+
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681353.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,71 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ\n+\n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.\n+\n+(Both packages are also used by cibuildwheel)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T16:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681353",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,71 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ
+
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.
+
+(Both packages are also used by cibuildwheel)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_681354.json:
```json
{
    "body": "<a id='comment:34'></a>This also finds a strange bug in our `suitesparse` installation on macOS:\nThe installation record (`local/var/lib/sage/installed/suitesparse-5.10.1`) contains paths in the temporary build directory (`var/tmp/sage/build/suitesparse-5.10.1`).\nI've opened #34206 for this",
    "created_at": "2022-07-21T16:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681354",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>This also finds a strange bug in our `suitesparse` installation on macOS:
The installation record (`local/var/lib/sage/installed/suitesparse-5.10.1`) contains paths in the temporary build directory (`var/tmp/sage/build/suitesparse-5.10.1`).
I've opened #34206 for this



---

archive/issue_comments_681355.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,72 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ\n \n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.\n+\n+(Both packages are also used by cibuildwheel)\n+\n+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-21T18:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681355",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,72 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ
 
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.
+
+(Both packages are also used by cibuildwheel)
+
+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them
 
 Comment: 1
 
``````




---

archive/issue_comments_681356.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-07-21T23:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_681357.json:
```json
{
    "body": "Changing commit from \"1c24771c2cfa1d80c1571b5cfbc901c698fcb877\" to \"9d449bdf4237c0dfa4173515b0a164317fb0eb4c\"",
    "created_at": "2022-07-21T23:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1c24771c2cfa1d80c1571b5cfbc901c698fcb877" to "9d449bdf4237c0dfa4173515b0a164317fb0eb4c"



---

archive/issue_comments_681358.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-07-21T23:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_681359.json:
```json
{
    "body": "Changing commit from \"9d449bdf4237c0dfa4173515b0a164317fb0eb4c\" to \"400eaee762e33cdc28c46ef7587d6f889c5cda22\"",
    "created_at": "2022-07-21T23:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9d449bdf4237c0dfa4173515b0a164317fb0eb4c" to "400eaee762e33cdc28c46ef7587d6f889c5cda22"



---

archive/issue_comments_681360.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,72 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ\n \n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.\n+\n+(Both packages are also used by cibuildwheel)\n+\n+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-21T23:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681360",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,72 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ
 
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) -- follow-up ticket.
+
+(Both packages are also used by cibuildwheel)
+
+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them
 
 Comment: 1
 
``````




---

archive/issue_comments_681361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,72 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ\n \n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) or `auditwheel.lddtree.lddtree` (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/lddtree.py) -- follow-up ticket.\n+\n+(Both packages are also used by cibuildwheel)\n+\n+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-23T19:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681361",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,72 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ
 
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we can use `auditwheel show` from https://pypi.org/project/auditwheel/ (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/main_show.py) or `auditwheel.lddtree.lddtree` (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/lddtree.py) -- follow-up ticket.
+
+(Both packages are also used by cibuildwheel)
+
+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them
 
 Comment: 1
 
``````




---

archive/issue_comments_681362.json:
```json
{
    "body": "Changing commit from \"400eaee762e33cdc28c46ef7587d6f889c5cda22\" to \"ef9226bc1717bc579bdeddfb84f77c158a6ce516\"",
    "created_at": "2022-07-23T21:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "400eaee762e33cdc28c46ef7587d6f889c5cda22" to "ef9226bc1717bc579bdeddfb84f77c158a6ce516"



---

archive/issue_comments_681363.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-23T21:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681363",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681364.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,72 @@\n+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ\n \n+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.\n+\n+The new command `make -j list-broken-packages` assists the user with this:\n+\n+```\n+$ make -j list-broken-packages\n+make --no-print-directory auditwheel_or_delocate-no-deps\n+sage-logger -p 'sage --pip install -r \"/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt\"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'\n+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != \"darwin\"' don't match your environment\n+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)\n+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)\n+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)\n+make[2]: warning: -jN forced in submake: disabling jobserver mode.\n+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0\n+...\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'\n+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib\n+Uninstall broken packages by typing:\n+\n+\n+    make antic-SAGE_LOCAL-uninstall;\n+    make e_antic-SAGE_LOCAL-uninstall;\n+    make lcalc-SAGE_LOCAL-uninstall;\n+    make ratpoints-SAGE_LOCAL-uninstall;\n+    make normaliz-SAGE_LOCAL-uninstall;\n+    make r-SAGE_LOCAL-uninstall;\n+    make backports_zoneinfo-SAGE_VENV-uninstall;\n+    make fastjsonschema-SAGE_VENV-uninstall;\n+    make pytz_deprecation_shim-SAGE_VENV-uninstall;\n+    make stack_data-SAGE_VENV-uninstall;\n+    make tinycss2-SAGE_VENV-uninstall;\n+    make tzdata-SAGE_VENV-uninstall;\n+    make suitesparse-SAGE_LOCAL-uninstall;\n+\n+real\t2m25.787s\n+user\t4m54.270s\n+sys\t4m0.796s\n+```\n+\n+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):\n+\n+```\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'\n+Checking shared library file 'lib/libgivaro.9.dylib'\n+Checking shared library file 'lib/libgivaro.dylib'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'\n+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'\n+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'\n+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'\n+ERROR [libsana|get_dependencies:137]: \n+/usr/local/opt/flint/lib/libflint-16.dylib not found:\n+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib\n+Error during installcheck of 'e_antic': Could not find all dependencies.\n+```\n+\n+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. \n+\n+\n+\n+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/\n+\n+On Linux, instead of using `ldd` directly, we use `auditwheel.lddtree.lddtree` (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/lddtree.py)\n+\n+(Both packages are also used by cibuildwheel)\n+\n+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-23T21:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681364",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,72 @@
+When system packages are upgraded, shared libraries that a Sage installation links to can disappear, rendering the Sage installation broken. This is a common problem, reported for example in https://groups.google.com/g/sage-devel/c/Iz8ZsmQM3Pg/m/CPl9CbHmBgAJ
 
+To avoid a full rebuild (`make distclean && make build`), we can try to find the specific broken packages.
+
+The new command `make -j list-broken-packages` assists the user with this:
+
+```
+$ make -j list-broken-packages
+make --no-print-directory auditwheel_or_delocate-no-deps
+sage-logger -p 'sage --pip install -r "/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt"' '/Users/mkoeppe/s/sage/sage-rebasing/logs/pkgs/auditwheel_or_delocate.log'
+[auditwheel_or_delocate] Ignoring auditwheel: markers 'sys_platform != "darwin"' don't match your environment
+[auditwheel_or_delocate] Requirement already satisfied: delocate in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from -r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.10.2)
+[auditwheel_or_delocate] Requirement already satisfied: wheel>=0.32.0 in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (0.37.1)
+[auditwheel_or_delocate] Requirement already satisfied: typing-extensions in /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages (from delocate->-r /Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/auditwheel_or_delocate/requirements.txt (line 1)) (3.10.0.0)
+make[2]: warning: -jN forced in submake: disabling jobserver mode.
+# Checking /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/installed/bliss-0.73+debian-1+sage-2016-08-02.p0
+...
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libumfpack.dylib'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib'
+Error during installcheck of 'suitesparse': /Users/mkoeppe/s/sage/sage-rebasing/local/var/tmp/sage/build/suitesparse-5.10.1/src/lib/libsliplu.1.0.2.dylib
+Uninstall broken packages by typing:
+
+
+    make antic-SAGE_LOCAL-uninstall;
+    make e_antic-SAGE_LOCAL-uninstall;
+    make lcalc-SAGE_LOCAL-uninstall;
+    make ratpoints-SAGE_LOCAL-uninstall;
+    make normaliz-SAGE_LOCAL-uninstall;
+    make r-SAGE_LOCAL-uninstall;
+    make backports_zoneinfo-SAGE_VENV-uninstall;
+    make fastjsonschema-SAGE_VENV-uninstall;
+    make pytz_deprecation_shim-SAGE_VENV-uninstall;
+    make stack_data-SAGE_VENV-uninstall;
+    make tinycss2-SAGE_VENV-uninstall;
+    make tzdata-SAGE_VENV-uninstall;
+    make suitesparse-SAGE_LOCAL-uninstall;
+
+real	2m25.787s
+user	4m54.270s
+sys	4m0.796s
+```
+
+The core functionality is implemented by the new command `sage-spkg-installcheck` (implemented in sage_bootstrap):
+
+```
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose givaro'
+Checking shared library file 'lib/libgivaro.9.dylib'
+Checking shared library file 'lib/libgivaro.dylib'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose matplotlib $SAGE_VENV'
+Checking wheel file 'var/lib/sage/wheels/matplotlib-3.5.1-cp310-cp310-macosx_12_0_x86_64.whl'
+$ ./sage -sh -c 'python3 build/bin/sage-spkg-installcheck --verbose e_antic'
+Checking shared library file '/Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib'
+ERROR [libsana|get_dependencies:137]: 
+/usr/local/opt/flint/lib/libflint-16.dylib not found:
+  Needed by: /Users/mkoeppe/s/sage/sage-rebasing/local/lib/libeantic.0.dylib
+Error during installcheck of 'e_antic': Could not find all dependencies.
+```
+
+It inspects the installation records in `$SAGE_LOCAL/var/lib/sage/installed/` and all shared libraries and platform wheels listed there. 
+
+
+
+On macOS, instead of using `otool` directly, we use `delocate-listdeps` from https://pypi.org/project/delocate/
+
+On Linux, instead of using `ldd` directly, we use `auditwheel.lddtree.lddtree` (https://github.com/pypa/auditwheel/blob/main/src/auditwheel/lddtree.py)
+
+(Both packages are also used by cibuildwheel)
+
+See also: #34205 Optionally run auditwheel/delocate on wheels before installing them
 
 Comment: 1
 
``````




---

archive/issue_comments_681365.json:
```json
{
    "body": "<a id='comment:42'></a>Hi Nils, I developed this ticket as a solution for last time that you complained about people breaking your build. Care to review?",
    "created_at": "2022-08-22T23:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681365",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>Hi Nils, I developed this ticket as a solution for last time that you complained about people breaking your build. Care to review?



---

archive/issue_comments_681366.json:
```json
{
    "body": "<a id='comment:44'></a>Can you explain what \"package\" means in `list-broken-packages`? I ran the command and saw\n\n```\nusage: sage-spkg-installcheck [-h] [-v] spkg [sage_local]\nsage-spkg-installcheck: error: argument spkg: 'stack_data' is not a known spkg\n```\nfollowed by the suggestion to run `make stack_data-SAGE_VENV-uninstall`. Is `stack_data` actually broken, or is the \"usage\" message indication of something else going wrong? And what is `stack_data`, since it's not an spkg?",
    "created_at": "2022-09-12T22:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681366",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>Can you explain what "package" means in `list-broken-packages`? I ran the command and saw

```
usage: sage-spkg-installcheck [-h] [-v] spkg [sage_local]
sage-spkg-installcheck: error: argument spkg: 'stack_data' is not a known spkg
```
followed by the suggestion to run `make stack_data-SAGE_VENV-uninstall`. Is `stack_data` actually broken, or is the "usage" message indication of something else going wrong? And what is `stack_data`, since it's not an spkg?



---

archive/issue_comments_681367.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:44 John Palmieri]:\n> Can you explain what \"package\" means in `list-broken-packages`? \n\n\nAn SPKG",
    "created_at": "2022-09-12T22:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681367",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>Replying to [comment:44 John Palmieri]:
> Can you explain what "package" means in `list-broken-packages`? 


An SPKG



---

archive/issue_comments_681368.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:44 John Palmieri]:\n>  Is `stack_data` actually broken, or is the \"usage\" message indication of something else going wrong? And what is `stack_data`, since it's not an spkg?\n\n\nIt's broken as follows: You have an installation of it (from some other branch), but it's not (per what is currently in `build/pkgs`) an SPKG.",
    "created_at": "2022-09-12T23:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681368",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>Replying to [comment:44 John Palmieri]:
>  Is `stack_data` actually broken, or is the "usage" message indication of something else going wrong? And what is `stack_data`, since it's not an spkg?


It's broken as follows: You have an installation of it (from some other branch), but it's not (per what is currently in `build/pkgs`) an SPKG.



---

archive/issue_comments_681369.json:
```json
{
    "body": "<a id='comment:47'></a>In 9.7.rc1, `stack_data` of course is a package, so after merging 9.7.rc1, this will no longer be reported as \"broken\".",
    "created_at": "2022-09-12T23:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681369",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>In 9.7.rc1, `stack_data` of course is a package, so after merging 9.7.rc1, this will no longer be reported as "broken".



---

archive/issue_comments_681370.json:
```json
{
    "body": "Changing commit from \"ef9226bc1717bc579bdeddfb84f77c158a6ce516\" to \"0bbba440e3342d12e6b705011ea27874e7b0e9a3\"",
    "created_at": "2022-09-12T23:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681370",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ef9226bc1717bc579bdeddfb84f77c158a6ce516" to "0bbba440e3342d12e6b705011ea27874e7b0e9a3"



---

archive/issue_comments_681371.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-12T23:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681372.json:
```json
{
    "body": "<a id='comment:49'></a>And here's that merge commit.",
    "created_at": "2022-09-12T23:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681372",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>And here's that merge commit.



---

archive/issue_comments_681373.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-13T00:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681374.json:
```json
{
    "body": "Changing commit from \"0bbba440e3342d12e6b705011ea27874e7b0e9a3\" to \"9a03d7fe7beb1bae71415938f7cb3ef9417c9fb1\"",
    "created_at": "2022-09-13T00:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681374",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0bbba440e3342d12e6b705011ea27874e7b0e9a3" to "9a03d7fe7beb1bae71415938f7cb3ef9417c9fb1"



---

archive/issue_comments_681375.json:
```json
{
    "body": "<a id='comment:51'></a>Should this have a nonzero return code if some packages are broken?",
    "created_at": "2022-09-14T21:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681375",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:51'></a>Should this have a nonzero return code if some packages are broken?



---

archive/issue_comments_681376.json:
```json
{
    "body": "<a id='comment:52'></a>From its name `list-broken-packages`, I tend to say that it should not indicate a failure like that",
    "created_at": "2022-09-14T21:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681376",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:52'></a>From its name `list-broken-packages`, I tend to say that it should not indicate a failure like that



---

archive/issue_comments_681377.json:
```json
{
    "body": "<a id='comment:53'></a>I think I agree but I wanted to ask.",
    "created_at": "2022-09-14T21:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681377",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:53'></a>I think I agree but I wanted to ask.



---

archive/issue_comments_681378.json:
```json
{
    "body": "<a id='comment:54'></a>It is possible that some could want to do `make -j list-broken-packages && do something else`, but I don't see a concrete example.",
    "created_at": "2022-09-14T21:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681378",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:54'></a>It is possible that some could want to do `make -j list-broken-packages && do something else`, but I don't see a concrete example.



---

archive/issue_comments_681379.json:
```json
{
    "body": "<a id='comment:55'></a>Yes, I thought about this, but I'd say that this whole thing is a strictly manual operation, which doesn't lend itself to scripting.",
    "created_at": "2022-09-14T21:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681379",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>Yes, I thought about this, but I'd say that this whole thing is a strictly manual operation, which doesn't lend itself to scripting.



---

archive/issue_comments_681380.json:
```json
{
    "body": "<a id='comment:56'></a>For the new package `auditwheel_or_delocate`, it seems that potentially both are used on Linux, only `delocate` on OS X. If that's right, then the `SPKG.rst` should be modified. \n\nInstalling `auditwheel` via pip also installs `pyelftools`, and `patchelf` is listed as a dependency on the PyPI page. Do we need to create a new package `pyelftools`, too? Is `patchelf` really required, or is it only necessary if one is trying to fix files, not just detect whether they're broken?",
    "created_at": "2022-09-14T21:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681380",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:56'></a>For the new package `auditwheel_or_delocate`, it seems that potentially both are used on Linux, only `delocate` on OS X. If that's right, then the `SPKG.rst` should be modified. 

Installing `auditwheel` via pip also installs `pyelftools`, and `patchelf` is listed as a dependency on the PyPI page. Do we need to create a new package `pyelftools`, too? Is `patchelf` really required, or is it only necessary if one is trying to fix files, not just detect whether they're broken?



---

archive/issue_comments_681381.json:
```json
{
    "body": "<a id='comment:57'></a>The comment \"and delete the rest\" does not seem to be accurate (and I think it's fine not to delete the old stamp files here).",
    "created_at": "2022-09-14T22:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681381",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:57'></a>The comment "and delete the rest" does not seem to be accurate (and I think it's fine not to delete the old stamp files here).



---

archive/issue_comments_681382.json:
```json
{
    "body": "Changing commit from \"9a03d7fe7beb1bae71415938f7cb3ef9417c9fb1\" to \"6ceb44edbd932b7c772d3844c74103e2e3d6732c\"",
    "created_at": "2022-09-14T22:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9a03d7fe7beb1bae71415938f7cb3ef9417c9fb1" to "6ceb44edbd932b7c772d3844c74103e2e3d6732c"



---

archive/issue_comments_681383.json:
```json
{
    "body": "<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-14T22:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681383",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681384.json:
```json
{
    "body": "<a id='comment:59'></a>Replying to [comment:56 John Palmieri]:\n> Installing `auditwheel` via pip also installs `pyelftools`, and `patchelf` is listed as a dependency on the PyPI page. Do we need to create a new package `pyelftools`, too?\n\n\nNot needed - that's what makes optional \"pip\" packages so convenient.\n\n> Is `patchelf` really required, or is it only necessary if one is trying to fix files, not just detect whether they're broken?\n\n\nRight, it's only needed for repairing wheels. But it's best not try to circumvent the declared dependencies. \n\nThe scipy upgrade (#34081) will bring a patchelf, by the way.",
    "created_at": "2022-09-14T22:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681384",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>Replying to [comment:56 John Palmieri]:
> Installing `auditwheel` via pip also installs `pyelftools`, and `patchelf` is listed as a dependency on the PyPI page. Do we need to create a new package `pyelftools`, too?


Not needed - that's what makes optional "pip" packages so convenient.

> Is `patchelf` really required, or is it only necessary if one is trying to fix files, not just detect whether they're broken?


Right, it's only needed for repairing wheels. But it's best not try to circumvent the declared dependencies. 

The scipy upgrade (#34081) will bring a patchelf, by the way.



---

archive/issue_comments_681385.json:
```json
{
    "body": "Changing commit from \"6ceb44edbd932b7c772d3844c74103e2e3d6732c\" to \"3c70a38483a15327118ccfcaeabf154e5d9f2af1\"",
    "created_at": "2022-09-14T22:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681385",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6ceb44edbd932b7c772d3844c74103e2e3d6732c" to "3c70a38483a15327118ccfcaeabf154e5d9f2af1"



---

archive/issue_comments_681386.json:
```json
{
    "body": "<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-14T22:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681386",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_681387.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-14T22:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681387",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_681388.json:
```json
{
    "body": "<a id='comment:61'></a>Great, I think this is ready to go now.",
    "created_at": "2022-09-14T22:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681388",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:61'></a>Great, I think this is ready to go now.



---

archive/issue_comments_681389.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2022-09-14T22:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681389",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_681390.json:
```json
{
    "body": "<a id='comment:62'></a>Thank you!",
    "created_at": "2022-09-14T22:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681390",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>Thank you!



---

archive/issue_events_089236.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34203#event-89236"
}
```



---

archive/issue_comments_681391.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-20T20:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681391",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_089237.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-20T20:22:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34203#event-89237"
}
```



---

archive/issue_comments_681392.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/find_and_uninstall_broken_installed_spkgs_and_wheels\" to \"3c70a38483a15327118ccfcaeabf154e5d9f2af1\"",
    "created_at": "2022-09-20T20:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34203#issuecomment-681392",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/find_and_uninstall_broken_installed_spkgs_and_wheels" to "3c70a38483a15327118ccfcaeabf154e5d9f2af1"
