# Issue 34048: save_session() crashes when any variable is an ETuple

archive/issues_033811.json:
```json
{
    "body": "CC:  @williamstein @tscrim\n\nKeywords: save_session, ETuple\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.6, Release Date: 2022-05-15                     \u2502\n\u2502 Using Python 3.9.2. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: from sage.rings.polynomial.polydict import ETuple\nsage: key = ETuple((1,2,3,4))\nsage: save_session('example')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-d30e03fac8a0> in <module>\n----> 1 save_session('example')\n\n/opt/Sage/sage-9.6/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/session.pyx in sage.misc.session.save_session (build/cythonized/sage/misc/session.c:2698)()\n    304     # We iterate only over the new variables that were defined in this\n    305     # session, since those are the only ones we will save.\n--> 306     for k in show_identifiers(hidden = True):\n    307         try:\n    308             x = state[k]\n\n/opt/Sage/sage-9.6/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/session.pyx in sage.misc.session.show_identifiers (build/cythonized/sage/misc/session.c:2461)()\n    221 \n    222     return sorted([x for x, v in state.items() if _is_new_var(x, v, hidden)\n--> 223                    and not _in_extra_globals(x, v)])\n    224 \n    225 \n\n/opt/Sage/sage-9.6/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/session.pyx in sage.misc.session.show_identifiers._in_extra_globals (build/cythonized/sage/misc/session.c:2203)()\n    218     _none = object()\n    219     def _in_extra_globals(name, val):\n--> 220         return val == DocTestTask.extra_globals.get(name, _none)\n    221 \n    222     return sorted([x for x, v in state.items() if _is_new_var(x, v, hidden)\n\nTypeError: Argument 'other' has incorrect type (expected sage.rings.polynomial.polydict.ETuple, got object)\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/34048\n\n",
    "created_at": "2022-06-22T07:24:54Z",
    "labels": [
        "component: pickling",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "save_session() crashes when any variable is an ETuple",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34048",
    "user": "https://github.com/denissunko"
}
```
CC:  @williamstein @tscrim

Keywords: save_session, ETuple

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.6, Release Date: 2022-05-15                     │
│ Using Python 3.9.2. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage: from sage.rings.polynomial.polydict import ETuple
sage: key = ETuple((1,2,3,4))
sage: save_session('example')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-d30e03fac8a0> in <module>
----> 1 save_session('example')

/opt/Sage/sage-9.6/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/session.pyx in sage.misc.session.save_session (build/cythonized/sage/misc/session.c:2698)()
    304     # We iterate only over the new variables that were defined in this
    305     # session, since those are the only ones we will save.
--> 306     for k in show_identifiers(hidden = True):
    307         try:
    308             x = state[k]

/opt/Sage/sage-9.6/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/session.pyx in sage.misc.session.show_identifiers (build/cythonized/sage/misc/session.c:2461)()
    221 
    222     return sorted([x for x, v in state.items() if _is_new_var(x, v, hidden)
--> 223                    and not _in_extra_globals(x, v)])
    224 
    225 

/opt/Sage/sage-9.6/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/misc/session.pyx in sage.misc.session.show_identifiers._in_extra_globals (build/cythonized/sage/misc/session.c:2203)()
    218     _none = object()
    219     def _in_extra_globals(name, val):
--> 220         return val == DocTestTask.extra_globals.get(name, _none)
    221 
    222     return sorted([x for x, v in state.items() if _is_new_var(x, v, hidden)

TypeError: Argument 'other' has incorrect type (expected sage.rings.polynomial.polydict.ETuple, got object)
```

Issue created by migration from https://trac.sagemath.org/ticket/34048





---

archive/issue_events_089061.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34048",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34048#event-89061"
}
```
