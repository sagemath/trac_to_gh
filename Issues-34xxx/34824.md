# Issue 34824: do not include parent in hash of parking functions

archive/issues_034587.json:
```json
{
    "body": "We do not want the following:\n\n```\nsage: P = ParkingFunctions(3)\nsage: f = P([1,1,1])\nsage: g = ParkingFunction([1,1,1])\nsage: f in P\nTrue\nsage: g in P\nTrue\nsage: f in list(P)\nTrue\nsage: g in list(P)\nTrue\nsage: f in set(P)\nTrue\nsage: g in set(P)\nFalse\n```\n\nCC:  @nthiery\n\nReviewer: Travis Scrimshaw\n\nAuthor: Martin Rubey\n\nBranch: u/mantepse/do_not_include_parent_in_hash_of_parking_functions\n\nStatus: positive_review\n\nCommit: 49ff03dedd5650099f91a83e008fe3d1ead95c14\n\nIssue created by migration from https://trac.sagemath.org/ticket/34824\n\n",
    "created_at": "2022-12-05T06:54:16Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "do not include parent in hash of parking functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34824",
    "user": "https://github.com/mantepse"
}
```
We do not want the following:

```
sage: P = ParkingFunctions(3)
sage: f = P([1,1,1])
sage: g = ParkingFunction([1,1,1])
sage: f in P
True
sage: g in P
True
sage: f in list(P)
True
sage: g in list(P)
True
sage: f in set(P)
True
sage: g in set(P)
False
```

CC:  @nthiery

Reviewer: Travis Scrimshaw

Author: Martin Rubey

Branch: u/mantepse/do_not_include_parent_in_hash_of_parking_functions

Status: positive_review

Commit: 49ff03dedd5650099f91a83e008fe3d1ead95c14

Issue created by migration from https://trac.sagemath.org/ticket/34824





---

archive/issue_comments_692028.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mantepse/do_not_include_parent_in_hash_of_parking_functions\"",
    "created_at": "2022-12-05T07:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692028",
    "user": "https://github.com/mantepse"
}
```

Changing branch from "" to "u/mantepse/do_not_include_parent_in_hash_of_parking_functions"



---

archive/issue_comments_692029.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692029",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_692030.json:
```json
{
    "body": "Changing commit from \"\" to \"ec0577e58372f91d929929b2787824a934ffb908\"",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692030",
    "user": "https://github.com/mantepse"
}
```

Changing commit from "" to "ec0577e58372f91d929929b2787824a934ffb908"



---

archive/issue_comments_692031.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692031",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_692032.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,22 @@\n+We do not want the following:\n \n+```\n+sage: P = ParkingFunctions(3)\n+sage: f = P([1,1,1])\n+sage: g = ParkingFunction([1,1,1])\n+sage: f in P\n+True\n+sage: g in P\n+True\n+sage: f in list(P)\n+True\n+sage: g in list(P)\n+True\n+sage: f in set(P)\n+True\n+sage: g in set(P)\n+False\n+```\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692032",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,22 @@
+We do not want the following:
 
+```
+sage: P = ParkingFunctions(3)
+sage: f = P([1,1,1])
+sage: g = ParkingFunction([1,1,1])
+sage: f in P
+True
+sage: g in P
+True
+sage: f in list(P)
+True
+sage: g in list(P)
+True
+sage: f in set(P)
+True
+sage: g in set(P)
+False
+```
 
 Comment: 1
 
``````




---

archive/issue_comments_692033.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Rubey\"",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692033",
    "user": "https://github.com/mantepse"
}
```

Changing author from "" to "Martin Rubey"



---

archive/issue_comments_692034.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692034",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_692035.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692035",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_692036.json:
```json
{
    "body": "<a id='comment:3'></a>I expect that you'll have to redefine equality comparison as well: `__hash__` and `__eq__` go hand-in-hand. See\n\nhttps://docs.python.org/3/reference/datamodel.html#object.__hash__\n\nYou could try to override `_hash_` instead, which is the internal routine that is used by the default `__hash__` to populate the `_hash_` cache attribute.",
    "created_at": "2022-12-05T07:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692036",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'></a>I expect that you'll have to redefine equality comparison as well: `__hash__` and `__eq__` go hand-in-hand. See

https://docs.python.org/3/reference/datamodel.html#object.__hash__

You could try to override `_hash_` instead, which is the internal routine that is used by the default `__hash__` to populate the `_hash_` cache attribute.



---

archive/issue_comments_692037.json:
```json
{
    "body": "Changing commit from \"ec0577e58372f91d929929b2787824a934ffb908\" to \"6e8ed10ebf6811084acb1a2ca7c81b6455f629ba\"",
    "created_at": "2022-12-05T10:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ec0577e58372f91d929929b2787824a934ffb908" to "6e8ed10ebf6811084acb1a2ca7c81b6455f629ba"



---

archive/issue_comments_692038.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-05T10:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_692039.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-10T22:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692039",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_692040.json:
```json
{
    "body": "Changing commit from \"6e8ed10ebf6811084acb1a2ca7c81b6455f629ba\" to \"32a2bb421afc4c571a68d561b89138589ceb4e3e\"",
    "created_at": "2022-12-10T22:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692040",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6e8ed10ebf6811084acb1a2ca7c81b6455f629ba" to "32a2bb421afc4c571a68d561b89138589ceb4e3e"



---

archive/issue_comments_692041.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-12-10T22:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692041",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_692042.json:
```json
{
    "body": "<a id='comment:7'></a>I do not understand this - shouldn't the hash be inherited from `ClonableArray`?\n\nIs this because of `metaclass=InheritComparisonClasscallMetaclass`?\n\n```\nsage: A = SetPartition([[1],[2,3],[4]])\nsage: hash(A)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nCell In [3], line 1\n----> 1 hash(A)\n\nTypeError: unhashable type: 'SetPartitions_all_with_category.element_class'\n```",
    "created_at": "2022-12-11T10:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692042",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:7'></a>I do not understand this - shouldn't the hash be inherited from `ClonableArray`?

Is this because of `metaclass=InheritComparisonClasscallMetaclass`?

```
sage: A = SetPartition([[1],[2,3],[4]])
sage: hash(A)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Cell In [3], line 1
----> 1 hash(A)

TypeError: unhashable type: 'SetPartitions_all_with_category.element_class'
```



---

archive/issue_comments_692043.json:
```json
{
    "body": "<a id='comment:8'></a>No, for `ParkingFunction`, hashing works, even though \n\n```\nclass ParkingFunction(ClonableArray, metaclass=InheritComparisonClasscallMetaclass):\n```",
    "created_at": "2022-12-11T10:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692043",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:8'></a>No, for `ParkingFunction`, hashing works, even though 

```
class ParkingFunction(ClonableArray, metaclass=InheritComparisonClasscallMetaclass):
```



---

archive/issue_comments_692044.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-13T09:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692044",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_692045.json:
```json
{
    "body": "Changing commit from \"32a2bb421afc4c571a68d561b89138589ceb4e3e\" to \"49ff03dedd5650099f91a83e008fe3d1ead95c14\"",
    "created_at": "2022-12-13T09:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692045",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "32a2bb421afc4c571a68d561b89138589ceb4e3e" to "49ff03dedd5650099f91a83e008fe3d1ead95c14"



---

archive/issue_comments_692046.json:
```json
{
    "body": "<a id='comment:10'></a>See also https://groups.google.com/g/sage-devel/c/0J2jiBh5AvE",
    "created_at": "2022-12-13T14:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692046",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:10'></a>See also https://groups.google.com/g/sage-devel/c/0J2jiBh5AvE



---

archive/issue_comments_692047.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2022-12-14T04:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692047",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_692048.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-14T04:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692048",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_692049.json:
```json
{
    "body": "<a id='comment:11'></a>LGTM. This will make handling equality easier for subclasses.\n\nNote that this will cause a slight performance regression when there is hashing involving things that are represented by the same list but should not be compared. For example `[3, 2, 1]` as a permutation versus as a partition (if they both inherited from `ClonableArray`). However, I don't see this having a practical effect and it is still outweighed by the ease-of-use IMO.",
    "created_at": "2022-12-14T04:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34824#issuecomment-692049",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>LGTM. This will make handling equality easier for subclasses.

Note that this will cause a slight performance regression when there is hashing involving things that are represented by the same list but should not be compared. For example `[3, 2, 1]` as a permutation versus as a partition (if they both inherited from `ClonableArray`). However, I don't see this having a practical effect and it is still outweighed by the ease-of-use IMO.
