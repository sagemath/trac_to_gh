# Issue 34149: make documentation building compatible with sphinx 5

archive/issues_033912.json:
```json
{
    "body": "Sphinx 5 has been out for a bit and is now stable in Gentoo at least. \n\nIdentified issues\n\n```\nmake[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'\npython -m sage_docbuild --no-pdf-links reference/references inventory \n[reference] Extension error:\n[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))\n```\nAccording to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. As it happen, this is a useless import since the method is superseded by sage_autodoc's own.\n\n```\nError building the documentation.\nTraceback (most recent call last):\n  File \"/usr/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n  File \"/usr/lib/python3.10/runpy.py\", line 86, in _run_code\n    exec(code, run_globals)\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 500, in <module>\n    sys.exit(main())\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 497, in main\n    builder()\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 823, in _wrapper\n    getattr(DocBuilder, build_type)(self, *args, **kwds)\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 167, in f\n    runsphinx()\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 327, in runsphinx\n    sys.stderr.raise_errors()\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 263, in raise_errors\n    raise OSError(self._error)\nOSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.\n```\nThis can be fixed by a small syntax correction for extlinks in `sage.misc.sagedoc`\n\n\n```\n[structure] /usr/lib/python3.10/site-packages/sage_docbuild/ext/sage_autodoc.py:791: RemovedInSphinx60Warning: DocumenterBridge.filename_set is deprecated.\n[structure]   self.directive.filename_set.add(self.analyzer.srcname)\n```\nby the truckload everywhere (not just structure) and repeatedly. Suggested replacement is `sphinx.ext.autodoc.directive.DocumenterBridge.record_dependencies`. But it doesn't prevent the documentation to build unlike the previous two.\n\nAll changes in the branch should work with sphinx 4.4 and 4.5 as they concern things deprecated in sphinx 4.0 or earlier.\n\nCC:  @antonio-rojas @strogdon @collares\n\nBranch/Commit: 6f9ceb7883376a1cacda51d84ec7870121860482\n\nReviewer: Antonio Rojas\n\nAuthor: Fran\u00e7ois Bissey\n\nDependencies: #34109\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34149\n\n",
    "closed_at": "2022-07-28T19:10:11Z",
    "created_at": "2022-07-11T08:49:27Z",
    "labels": [
        "component: documentation",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "make documentation building compatible with sphinx 5",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34149",
    "user": "https://github.com/kiwifb"
}
```
Sphinx 5 has been out for a bit and is now stable in Gentoo at least. 

Identified issues

```
make[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'
python -m sage_docbuild --no-pdf-links reference/references inventory 
[reference] Extension error:
[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))
```
According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. As it happen, this is a useless import since the method is superseded by sage_autodoc's own.

```
Error building the documentation.
Traceback (most recent call last):
  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 500, in <module>
    sys.exit(main())
  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 497, in main
    builder()
  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 823, in _wrapper
    getattr(DocBuilder, build_type)(self, *args, **kwds)
  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 167, in f
    runsphinx()
  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 327, in runsphinx
    sys.stderr.raise_errors()
  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 263, in raise_errors
    raise OSError(self._error)
OSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.
```
This can be fixed by a small syntax correction for extlinks in `sage.misc.sagedoc`


```
[structure] /usr/lib/python3.10/site-packages/sage_docbuild/ext/sage_autodoc.py:791: RemovedInSphinx60Warning: DocumenterBridge.filename_set is deprecated.
[structure]   self.directive.filename_set.add(self.analyzer.srcname)
```
by the truckload everywhere (not just structure) and repeatedly. Suggested replacement is `sphinx.ext.autodoc.directive.DocumenterBridge.record_dependencies`. But it doesn't prevent the documentation to build unlike the previous two.

All changes in the branch should work with sphinx 4.4 and 4.5 as they concern things deprecated in sphinx 4.0 or earlier.

CC:  @antonio-rojas @strogdon @collares

Branch/Commit: 6f9ceb7883376a1cacda51d84ec7870121860482

Reviewer: Antonio Rojas

Author: Fran√ßois Bissey

Dependencies: #34109

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34149





---

archive/issue_comments_680037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,9 @@\n [reference] Extension error:\n [reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))\n ```\n-According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0.\n+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. Suggested replacement is `sphinx.ext.autodoc.ModuleDocumenter.get_module_members`.\n+\n+We should also move what we know to be deprecated to replacement as much as possible.\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-11T09:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680037",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,9 @@
 [reference] Extension error:
 [reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))
 ```
-According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0.
+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. Suggested replacement is `sphinx.ext.autodoc.ModuleDocumenter.get_module_members`.
+
+We should also move what we know to be deprecated to replacement as much as possible.
 
 Comment: 1
 
``````




---

archive/issue_comments_680038.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+Sphinx 5 has been out for a bit and is now stable in Gentoo at least. At this stage there is one identified issue\n \n+```\n+make[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'\n+python -m sage_docbuild --no-pdf-links reference/references inventory \n+[reference] Extension error:\n+[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))\n+```\n+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. Suggested replacement is `sphinx.ext.autodoc.ModuleDocumenter.get_module_members` - which is part of the class `ModuleDocumenter` inside `sphinx/ext/autodoc/__init__.py`.\n+\n+We should also move what we know to be deprecated to replacement as much as possible.\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-11T09:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680038",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,14 @@
+Sphinx 5 has been out for a bit and is now stable in Gentoo at least. At this stage there is one identified issue
 
+```
+make[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'
+python -m sage_docbuild --no-pdf-links reference/references inventory 
+[reference] Extension error:
+[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))
+```
+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. Suggested replacement is `sphinx.ext.autodoc.ModuleDocumenter.get_module_members` - which is part of the class `ModuleDocumenter` inside `sphinx/ext/autodoc/__init__.py`.
+
+We should also move what we know to be deprecated to replacement as much as possible.
 
 Comment: 1
 
``````




---

archive/issue_comments_680039.json:
```json
{
    "body": "<a id='comment:3'></a>As it turns out, the imported `get_module_members` is overridden by the method of the same name from sage_autodoc own `ModuleDocumenter` class. Simply removing the import is enough.\n\nNext error:\n\n```\nError building the documentation.\nTraceback (most recent call last):\n  File \"/usr/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\n    return _run_code(code, main_globals, None,\n  File \"/usr/lib/python3.10/runpy.py\", line 86, in _run_code\n    exec(code, run_globals)\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 500, in <module>\n    sys.exit(main())\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 497, in main\n    builder()\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 823, in _wrapper\n    getattr(DocBuilder, build_type)(self, *args, **kwds)\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 167, in f\n    runsphinx()\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 327, in runsphinx\n    sys.stderr.raise_errors()\n  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 263, in raise_errors\n    raise OSError(self._error)\nOSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.\n```\nWarning for upcoming sphinx 6.0 is treated as an error.",
    "created_at": "2022-07-11T09:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680039",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>As it turns out, the imported `get_module_members` is overridden by the method of the same name from sage_autodoc own `ModuleDocumenter` class. Simply removing the import is enough.

Next error:

```
Error building the documentation.
Traceback (most recent call last):
  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 500, in <module>
    sys.exit(main())
  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 497, in main
    builder()
  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 823, in _wrapper
    getattr(DocBuilder, build_type)(self, *args, **kwds)
  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 167, in f
    runsphinx()
  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 327, in runsphinx
    sys.stderr.raise_errors()
  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 263, in raise_errors
    raise OSError(self._error)
OSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.
```
Warning for upcoming sphinx 6.0 is treated as an error.



---

archive/issue_comments_680040.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,44 @@\n+Sphinx 5 has been out for a bit and is now stable in Gentoo at least. \n \n+Identified issues\n+\n+```\n+make[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'\n+python -m sage_docbuild --no-pdf-links reference/references inventory \n+[reference] Extension error:\n+[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))\n+```\n+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. As it happen, this is a useless import since the method is superseded by sage_autodoc's own.\n+\n+```\n+Error building the documentation.\n+Traceback (most recent call last):\n+  File \"/usr/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\n+    return _run_code(code, main_globals, None,\n+  File \"/usr/lib/python3.10/runpy.py\", line 86, in _run_code\n+    exec(code, run_globals)\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 500, in <module>\n+    sys.exit(main())\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 497, in main\n+    builder()\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 823, in _wrapper\n+    getattr(DocBuilder, build_type)(self, *args, **kwds)\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 167, in f\n+    runsphinx()\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 327, in runsphinx\n+    sys.stderr.raise_errors()\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 263, in raise_errors\n+    raise OSError(self._error)\n+OSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.\n+```\n+This can be fixed by a small syntax correction for extlinks in `sage.misc.sagedoc`\n+\n+\n+```\n+[structure] /usr/lib/python3.10/site-packages/sage_docbuild/ext/sage_autodoc.py:791: RemovedInSphinx60Warning: DocumenterBridge.filename_set is deprecated.\n+[structure]   self.directive.filename_set.add(self.analyzer.srcname)\n+```\n+by the truckload everywhere (not just structure) and repeatedly. Suggested replacement is `sphinx.ext.autodoc.directive.DocumenterBridge.record_dependencies`\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-11T10:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680040",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,44 @@
+Sphinx 5 has been out for a bit and is now stable in Gentoo at least. 
 
+Identified issues
+
+```
+make[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'
+python -m sage_docbuild --no-pdf-links reference/references inventory 
+[reference] Extension error:
+[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))
+```
+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. As it happen, this is a useless import since the method is superseded by sage_autodoc's own.
+
+```
+Error building the documentation.
+Traceback (most recent call last):
+  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
+    return _run_code(code, main_globals, None,
+  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
+    exec(code, run_globals)
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 500, in <module>
+    sys.exit(main())
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 497, in main
+    builder()
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 823, in _wrapper
+    getattr(DocBuilder, build_type)(self, *args, **kwds)
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 167, in f
+    runsphinx()
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 327, in runsphinx
+    sys.stderr.raise_errors()
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 263, in raise_errors
+    raise OSError(self._error)
+OSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.
+```
+This can be fixed by a small syntax correction for extlinks in `sage.misc.sagedoc`
+
+
+```
+[structure] /usr/lib/python3.10/site-packages/sage_docbuild/ext/sage_autodoc.py:791: RemovedInSphinx60Warning: DocumenterBridge.filename_set is deprecated.
+[structure]   self.directive.filename_set.add(self.analyzer.srcname)
+```
+by the truckload everywhere (not just structure) and repeatedly. Suggested replacement is `sphinx.ext.autodoc.directive.DocumenterBridge.record_dependencies`
 
 Comment: 1
 
``````




---

archive/issue_comments_680041.json:
```json
{
    "body": "Changing author from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2022-07-11T10:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680041",
    "user": "https://github.com/kiwifb"
}
```

Changing author from "" to "Fran√ßois Bissey"



---

archive/issue_comments_680042.json:
```json
{
    "body": "Changing commit from \"\" to \"18c92459b336b2b7b641fd544a12b04467822271\"",
    "created_at": "2022-07-11T10:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680042",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "" to "18c92459b336b2b7b641fd544a12b04467822271"



---

archive/issue_comments_680043.json:
```json
{
    "body": "Changing branch from \"\" to \"u/fbissey/sphinx5\"",
    "created_at": "2022-07-11T10:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680043",
    "user": "https://github.com/kiwifb"
}
```

Changing branch from "" to "u/fbissey/sphinx5"



---

archive/issue_comments_680044.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2022-07-11T10:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680044",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_680045.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,46 @@\n+Sphinx 5 has been out for a bit and is now stable in Gentoo at least. \n \n+Identified issues\n+\n+```\n+make[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'\n+python -m sage_docbuild --no-pdf-links reference/references inventory \n+[reference] Extension error:\n+[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))\n+```\n+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. As it happen, this is a useless import since the method is superseded by sage_autodoc's own.\n+\n+```\n+Error building the documentation.\n+Traceback (most recent call last):\n+  File \"/usr/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\n+    return _run_code(code, main_globals, None,\n+  File \"/usr/lib/python3.10/runpy.py\", line 86, in _run_code\n+    exec(code, run_globals)\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 500, in <module>\n+    sys.exit(main())\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 497, in main\n+    builder()\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 823, in _wrapper\n+    getattr(DocBuilder, build_type)(self, *args, **kwds)\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/builders.py\", line 167, in f\n+    runsphinx()\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 327, in runsphinx\n+    sys.stderr.raise_errors()\n+  File \"/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 263, in raise_errors\n+    raise OSError(self._error)\n+OSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.\n+```\n+This can be fixed by a small syntax correction for extlinks in `sage.misc.sagedoc`\n+\n+\n+```\n+[structure] /usr/lib/python3.10/site-packages/sage_docbuild/ext/sage_autodoc.py:791: RemovedInSphinx60Warning: DocumenterBridge.filename_set is deprecated.\n+[structure]   self.directive.filename_set.add(self.analyzer.srcname)\n+```\n+by the truckload everywhere (not just structure) and repeatedly. Suggested replacement is `sphinx.ext.autodoc.directive.DocumenterBridge.record_dependencies`. But it doesn't prevent the documentation to build unlike the previous two.\n+\n+All changes in the branch should work with sphinx 4.4 and 4.5 as they concern things deprecated in sphinx 4.0 or earlier.\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-07-11T10:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680045",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,46 @@
+Sphinx 5 has been out for a bit and is now stable in Gentoo at least. 
 
+Identified issues
+
+```
+make[1]: Entering directory '/home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc'
+python -m sage_docbuild --no-pdf-links reference/references inventory 
+[reference] Extension error:
+[reference] Could not import extension sage_docbuild.ext.sage_autodoc (exception: cannot import name 'get_module_members' from 'sphinx.ext.autodoc.importer' (/usr/lib/python3.10/site-packages/sphinx/ext/autodoc/importer.py))
+```
+According to https://www.sphinx-doc.org/en/master/extdev/deprecated.html `sphinx.ext.autodoc.importer.get_module_members` was deprecated in sphinx 3.5 and removed in sphinx 5.0. As it happen, this is a useless import since the method is superseded by sage_autodoc's own.
+
+```
+Error building the documentation.
+Traceback (most recent call last):
+  File "/usr/lib/python3.10/runpy.py", line 196, in _run_module_as_main
+    return _run_code(code, main_globals, None,
+  File "/usr/lib/python3.10/runpy.py", line 86, in _run_code
+    exec(code, run_globals)
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 500, in <module>
+    sys.exit(main())
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 497, in main
+    builder()
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 823, in _wrapper
+    getattr(DocBuilder, build_type)(self, *args, **kwds)
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/builders.py", line 167, in f
+    runsphinx()
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 327, in runsphinx
+    sys.stderr.raise_errors()
+  File "/usr/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 263, in raise_errors
+    raise OSError(self._error)
+OSError: WARNING: extlinks: Sphinx-6.0 will require a caption string to contain exactly one '%s' and all other '%' need to be escaped as '%%'.
+```
+This can be fixed by a small syntax correction for extlinks in `sage.misc.sagedoc`
+
+
+```
+[structure] /usr/lib/python3.10/site-packages/sage_docbuild/ext/sage_autodoc.py:791: RemovedInSphinx60Warning: DocumenterBridge.filename_set is deprecated.
+[structure]   self.directive.filename_set.add(self.analyzer.srcname)
+```
+by the truckload everywhere (not just structure) and repeatedly. Suggested replacement is `sphinx.ext.autodoc.directive.DocumenterBridge.record_dependencies`. But it doesn't prevent the documentation to build unlike the previous two.
+
+All changes in the branch should work with sphinx 4.4 and 4.5 as they concern things deprecated in sphinx 4.0 or earlier.
 
 Comment: 1
 
``````




---

archive/issue_comments_680046.json:
```json
{
    "body": "Changing commit from \"18c92459b336b2b7b641fd544a12b04467822271\" to \"c27e4e4c979776c7bab8c35a2f8965df07a8c75b\"",
    "created_at": "2022-07-11T11:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "18c92459b336b2b7b641fd544a12b04467822271" to "c27e4e4c979776c7bab8c35a2f8965df07a8c75b"



---

archive/issue_comments_680047.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-11T11:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680047",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_680048.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-11T11:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680048",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_680049.json:
```json
{
    "body": "<a id='comment:8'></a>`@`arojas FYI if this doesn't make it in 9.7.",
    "created_at": "2022-07-11T20:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680049",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>`@`arojas FYI if this doesn't make it in 9.7.



---

archive/issue_comments_680050.json:
```json
{
    "body": "<a id='comment:9'></a>`@`Steve I pushed the change in Gentoo last night (NZ time) would be OK to review this?",
    "created_at": "2022-07-11T21:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680050",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>`@`Steve I pushed the change in Gentoo last night (NZ time) would be OK to review this?



---

archive/issue_comments_680051.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-11T22:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680051",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_680052.json:
```json
{
    "body": "<a id='comment:10'></a>WFM, thanks (and I just found out that doc building on distros got yet more complicated in 9.7, sigh)",
    "created_at": "2022-07-11T22:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680052",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:10'></a>WFM, thanks (and I just found out that doc building on distros got yet more complicated in 9.7, sigh)



---

archive/issue_comments_680053.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 arojas]:\n> WFM, thanks (and I just found out that doc building on distros got yet more complicated in 9.7, sigh)\n\n\nI haven't experienced trouble so far apart from sphinx just going up under my nose on Gentoo. What do you have problem with? For the record, I ended up splitting sage-doc as its own thing at about sage 9.5 because my work arounds for monolithic build where just looking they could break any time. Splitting has its issue but for documentation building it was positive overall.",
    "created_at": "2022-07-11T22:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680053",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>Replying to [comment:10 arojas]:
> WFM, thanks (and I just found out that doc building on distros got yet more complicated in 9.7, sigh)


I haven't experienced trouble so far apart from sphinx just going up under my nose on Gentoo. What do you have problem with? For the record, I ended up splitting sage-doc as its own thing at about sage 9.5 because my work arounds for monolithic build where just looking they could break any time. Splitting has its issue but for documentation building it was positive overall.



---

archive/issue_comments_680054.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 fbissey]:\n> I haven't experienced trouble so far apart from sphinx just going up under my nose on Gentoo. What do you have problem with? For the record, I ended up splitting sage-doc as its own thing at about sage 9.5 because my work arounds for monolithic build where just looking they could break any time. Splitting has its issue but for documentation building it was positive overall. \n\n\nGoing through the makefile is now mandatory\nhttps://git.sagemath.org/sage.git/commit/?h=develop&id=7759f3c23b07b56897a691baf57e6f00b98d78b6",
    "created_at": "2022-07-11T22:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680054",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:12'></a>Replying to [comment:11 fbissey]:
> I haven't experienced trouble so far apart from sphinx just going up under my nose on Gentoo. What do you have problem with? For the record, I ended up splitting sage-doc as its own thing at about sage 9.5 because my work arounds for monolithic build where just looking they could break any time. Splitting has its issue but for documentation building it was positive overall. 


Going through the makefile is now mandatory
https://git.sagemath.org/sage.git/commit/?h=develop&id=7759f3c23b07b56897a691baf57e6f00b98d78b6



---

archive/issue_comments_680055.json:
```json
{
    "body": "<a id='comment:13'></a>Yes, I split before my work around for not using the Makefile would break. It looks like that was a good early move. Using the Makefile is good but I could not leave it as is, especially the bits about `SAGE_ROOT`.\nhttps://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/files/sage-doc-9.7-makefile_and_parallel.patch",
    "created_at": "2022-07-11T22:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680055",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>Yes, I split before my work around for not using the Makefile would break. It looks like that was a good early move. Using the Makefile is good but I could not leave it as is, especially the bits about `SAGE_ROOT`.
https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/files/sage-doc-9.7-makefile_and_parallel.patch



---

archive/issue_comments_680056.json:
```json
{
    "body": "<a id='comment:14'></a>Merge failure on top of:\n\n73d7bb0aae Trac #34122: Bug in is_planar() method for directed graphs\n\nb9b73ce665 Trac #33160: update Singular to 4.3.1\n\n1dd3b4819f Trac #33134: doctest failure in hilbert_poincare_series with singular 4.2.1\n\nc9cfb5395f Trac #34087: inverse reciprocal trig functions not (back)translated to/from Mathematica\n\n1d6d055563 Trac #34076: pycodestyle cleanup in src/sage/graphs/genus.pyx\n\n043d862b5d Trac #34071: pycodestyle cleanup in asteroidal_triples.pyx, chrompoly.pyx, cliquer.pyx, convexity_properties.pyx\n\nb9b25dc735 Trac #34070: pycodestyle cleanup in src/sage/graphs/centrality.pyx\n\n4ef2c6597d Trac #34069: pycodestyle cleanup in src/sage/graphs/comparability.pyx\n\n5b1146766b Trac #34066: Tachyon help message\n\n798adaa5a3 Trac #34065: pycodestyle cleanup in src/sage/graphs/bliss.pyx\n\nce62be23a2 Trac #34063: pycodestyle cleanup in src/sage/graphs/base/\n\na0eadb3e40 Trac #34059: Fix trivial case in conversion of list to number field element\n\nfea0ac50a6 Trac #34057: changes about avoiding double dieses\n\n9eefd5c27e Trac #34145: modernize super in geometry/\n\n01e117dfd8 Trac #34137: modernize super in categories/\n\n6c79334402 Trac #33819: build.yml: In workflow_dispatch, make container and base tag selectable; add doc\n\n6a64ab8d00 Trac #33760: do not update _pos, _pos3d, _embedding on vertex/edge deletions\n\ndbf091dbbb Trac #34139: fix the linter\n\n625ac58151 Updated [SageMath](SageMath) version to 9.7.beta5\n\n\n\nreviewer '' does not look right",
    "created_at": "2022-07-11T22:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680056",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>Merge failure on top of:

73d7bb0aae Trac #34122: Bug in is_planar() method for directed graphs

b9b73ce665 Trac #33160: update Singular to 4.3.1

1dd3b4819f Trac #33134: doctest failure in hilbert_poincare_series with singular 4.2.1

c9cfb5395f Trac #34087: inverse reciprocal trig functions not (back)translated to/from Mathematica

1d6d055563 Trac #34076: pycodestyle cleanup in src/sage/graphs/genus.pyx

043d862b5d Trac #34071: pycodestyle cleanup in asteroidal_triples.pyx, chrompoly.pyx, cliquer.pyx, convexity_properties.pyx

b9b25dc735 Trac #34070: pycodestyle cleanup in src/sage/graphs/centrality.pyx

4ef2c6597d Trac #34069: pycodestyle cleanup in src/sage/graphs/comparability.pyx

5b1146766b Trac #34066: Tachyon help message

798adaa5a3 Trac #34065: pycodestyle cleanup in src/sage/graphs/bliss.pyx

ce62be23a2 Trac #34063: pycodestyle cleanup in src/sage/graphs/base/

a0eadb3e40 Trac #34059: Fix trivial case in conversion of list to number field element

fea0ac50a6 Trac #34057: changes about avoiding double dieses

9eefd5c27e Trac #34145: modernize super in geometry/

01e117dfd8 Trac #34137: modernize super in categories/

6c79334402 Trac #33819: build.yml: In workflow_dispatch, make container and base tag selectable; add doc

6a64ab8d00 Trac #33760: do not update _pos, _pos3d, _embedding on vertex/edge deletions

dbf091dbbb Trac #34139: fix the linter

625ac58151 Updated [SageMath](SageMath) version to 9.7.beta5



reviewer '' does not look right



---

archive/issue_comments_680057.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-07-11T22:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680057",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_680058.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Antonio Rojas\"",
    "created_at": "2022-07-12T00:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680058",
    "user": "https://github.com/strogdon"
}
```

Changing reviewer from "" to "Antonio Rojas"



---

archive/issue_comments_680059.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-07-12T00:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680059",
    "user": "https://github.com/strogdon"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_680060.json:
```json
{
    "body": "<a id='comment:15'></a>I think this is all that was needed.",
    "created_at": "2022-07-12T00:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680060",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:15'></a>I think this is all that was needed.



---

archive/issue_comments_680061.json:
```json
{
    "body": "<a id='comment:16'></a>Thanks Steve, I did not receive an email for the change triggered by Volker.",
    "created_at": "2022-07-12T00:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680061",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>Thanks Steve, I did not receive an email for the change triggered by Volker.



---

archive/issue_comments_680062.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#34109\"",
    "created_at": "2022-07-12T01:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680062",
    "user": "https://github.com/kiwifb"
}
```

Changing dependencies from "" to "#34109"



---

archive/issue_comments_680063.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-07-12T01:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680063",
    "user": "https://github.com/kiwifb"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_680064.json:
```json
{
    "body": "<a id='comment:17'></a>Conflict with #34109 which touches exactly the same line in `sagedoc.py`.",
    "created_at": "2022-07-12T01:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680064",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>Conflict with #34109 which touches exactly the same line in `sagedoc.py`.



---

archive/issue_comments_680065.json:
```json
{
    "body": "Changing commit from \"c27e4e4c979776c7bab8c35a2f8965df07a8c75b\" to \"6f9ceb7883376a1cacda51d84ec7870121860482\"",
    "created_at": "2022-07-12T01:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680065",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c27e4e4c979776c7bab8c35a2f8965df07a8c75b" to "6f9ceb7883376a1cacda51d84ec7870121860482"



---

archive/issue_comments_680066.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-12T01:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_680067.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-07-12T01:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680067",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_680068.json:
```json
{
    "body": "<a id='comment:19'></a>Merged with #34109 which is positively reviewed and in the process of being merged - back to positive review.",
    "created_at": "2022-07-12T01:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680068",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>Merged with #34109 which is positively reviewed and in the process of being merged - back to positive review.



---

archive/issue_events_089174.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-28T19:10:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34149#event-89174"
}
```



---

archive/issue_comments_680069.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-28T19:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680069",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_680070.json:
```json
{
    "body": "Changing branch from \"u/fbissey/sphinx5\" to \"6f9ceb7883376a1cacda51d84ec7870121860482\"",
    "created_at": "2022-07-28T19:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34149#issuecomment-680070",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/fbissey/sphinx5" to "6f9ceb7883376a1cacda51d84ec7870121860482"
