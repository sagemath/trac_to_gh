# Issue 34051: Update FriCAS to 1.3.8

archive/issues_033814.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis ticket is to upgrade to FriCAS 1.3.8 and track dependencies.\n\nTarball: see checksums.ini\n\nNote that FriCAS has switched to using Git and the primary repository is now the one at GitHub, but the homepage remains at Sourceforge:\n\n- http://fricas.sf.net/download.html \n- https://github.com/fricas/fricas/releases\n\nOur last update was to Fricas 1.3.7 in #32049.\n\nTo try this ticket from your Sage root directory, with `git-trac-command` installed:\n\n1. `git trac try `\n2. `SAGE_SPKG=\"sage-spkg -o\" ./sage -i fricas` (or use `./configure --enable-download-from-upstream-url` first)\n3. `./sage -t --optional=fricas,sage src/sage/interfaces/fricas.py`\n\nDepends on #34017\n\nCC:  @fchapoton\n\nComponent: **packages: optional**\n\nKeywords: **FriCAS**\n\nAuthor: **Martin Rubey**\n\nBranch/Commit: **[`d7df5ec`](https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1)**\n\nReviewer: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34051_\n\n",
    "closed_at": "2022-07-09T22:33:03Z",
    "created_at": "2022-06-22T12:22:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update FriCAS to 1.3.8",
    "type": "issue",
    "updated_at": "2022-07-09T22:33:03Z",
    "url": "https://github.com/sagemath/sage/issues/34051",
    "user": "https://github.com/mantepse"
}
```
<div id="comment:0"></div>

This ticket is to upgrade to FriCAS 1.3.8 and track dependencies.

Tarball: see checksums.ini

Note that FriCAS has switched to using Git and the primary repository is now the one at GitHub, but the homepage remains at Sourceforge:

- http://fricas.sf.net/download.html 
- https://github.com/fricas/fricas/releases

Our last update was to Fricas 1.3.7 in #32049.

To try this ticket from your Sage root directory, with `git-trac-command` installed:

1. `git trac try `
2. `SAGE_SPKG="sage-spkg -o" ./sage -i fricas` (or use `./configure --enable-download-from-upstream-url` first)
3. `./sage -t --optional=fricas,sage src/sage/interfaces/fricas.py`

Depends on #34017

CC:  @fchapoton

Component: **packages: optional**

Keywords: **FriCAS**

Author: **Martin Rubey**

Branch/Commit: **[`d7df5ec`](https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1)**

Reviewer: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/34051_





---

archive/issue_events_462892.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-06-22T12:22:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462892"
}
```



---

archive/issue_events_462893.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-06-22T12:22:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "0000b0",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462893"
}
```



---

archive/issue_events_462894.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-06-22T12:22:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462894"
}
```



---

archive/issue_events_462895.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-06-22T12:22:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462895"
}
```



---

archive/issue_comments_549868.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n Note that FriCAS has switched to using Git and the primary repository is now the one at GitHub, but the homepage remains at Sourceforge:\n \n-- https://fricas.sourceforge.net\n+- http://fricas.sf.net/download.html \n - https://github.com/fricas/fricas/releases\n \n Our last update was to Fricas 1.3.7 in #32049.\n``````\n",
    "created_at": "2022-06-22T12:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549868",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 Note that FriCAS has switched to using Git and the primary repository is now the one at GitHub, but the homepage remains at Sourceforge:
 
-- https://fricas.sourceforge.net
+- http://fricas.sf.net/download.html 
 - https://github.com/fricas/fricas/releases
 
 Our last update was to Fricas 1.3.7 in #32049.
``````




---

archive/issue_comments_549869.json:
```json
{
    "body": "Branch: **[u/mantepse/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/update_fricas_to_1_3_8)**",
    "created_at": "2022-06-24T18:53:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549869",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/update_fricas_to_1_3_8)**



---

archive/issue_comments_549870.json:
```json
{
    "body": "Commit: **[`4a579cf`](https://github.com/sagemath/sagetrac-mirror/commit/4a579cf2514b82d06bfd2f01c9c8e1912feade8c)**",
    "created_at": "2022-06-24T19:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549870",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`4a579cf`](https://github.com/sagemath/sagetrac-mirror/commit/4a579cf2514b82d06bfd2f01c9c8e1912feade8c)**



---

archive/issue_comments_549871.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a579cf2514b82d06bfd2f01c9c8e1912feade8c\"><code>4a579cf</code></a></td><td><code>adapt doctests</code></td></tr></table>\n",
    "created_at": "2022-06-24T19:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549871",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a579cf2514b82d06bfd2f01c9c8e1912feade8c"><code>4a579cf</code></a></td><td><code>adapt doctests</code></td></tr></table>




---

archive/issue_comments_549872.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nnot completely sure whether package-version.txt shouldn't contain 1.3.8p1, but if I do, it tries to download fricas-1.3.8p1 from upstream, which obviously fails.",
    "created_at": "2022-06-24T19:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549872",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:4" align="right">comment:4</div>

not completely sure whether package-version.txt shouldn't contain 1.3.8p1, but if I do, it tries to download fricas-1.3.8p1 from upstream, which obviously fails.



---

archive/issue_events_462896.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2022-06-24T19:07:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462896"
}
```



---

archive/issue_comments_549873.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nTo indicate a patchlevel from patches added in Sage, you would use `1.3.8.p1` (note the extra dot)",
    "created_at": "2022-06-25T19:30:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549873",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

To indicate a patchlevel from patches added in Sage, you would use `1.3.8.p1` (note the extra dot)



---

archive/issue_comments_549874.json:
```json
{
    "body": "Changed commit from **[`4a579cf`](https://github.com/sagemath/sagetrac-mirror/commit/4a579cf2514b82d06bfd2f01c9c8e1912feade8c)** to **[`b48a4ac`](https://github.com/sagemath/sagetrac-mirror/commit/b48a4ac58b463d32f9c037448800d8e9f583b73f)**",
    "created_at": "2022-06-26T07:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549874",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4a579cf`](https://github.com/sagemath/sagetrac-mirror/commit/4a579cf2514b82d06bfd2f01c9c8e1912feade8c)** to **[`b48a4ac`](https://github.com/sagemath/sagetrac-mirror/commit/b48a4ac58b463d32f9c037448800d8e9f583b73f)**



---

archive/issue_comments_549875.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b48a4ac58b463d32f9c037448800d8e9f583b73f\"><code>b48a4ac</code></a></td><td><code>correct patch level</code></td></tr></table>\n",
    "created_at": "2022-06-26T07:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549875",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b48a4ac58b463d32f9c037448800d8e9f583b73f"><code>b48a4ac</code></a></td><td><code>correct patch level</code></td></tr></table>




---

archive/issue_comments_549876.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nPlease test!  I removed two patches, because it is unclear to me what they do and it works without them on my system (ubuntu 21.04), but I can imagine that they are needed on other systems.\n\nI did not touch `macos_list.patch`.\n\nI am slightly unsure whether it would be better to use a tolerance instead of an ellipsis here:\n\n```diff\n@@ -1563,7 +1563,7 @@ class FriCASElement(ExpectElement):\n             sage: psi(1.0)\n             -0.577215664901533\n             sage: fricas.polygamma(1, 1.0)                                      # optional - fricas\n-            1.6449340668482269\n+            1.644934066848226...\n             sage: psi(1, 1).n()\n             1.64493406684823\n```",
    "created_at": "2022-06-26T07:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549876",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:7" align="right">comment:7</div>

Please test!  I removed two patches, because it is unclear to me what they do and it works without them on my system (ubuntu 21.04), but I can imagine that they are needed on other systems.

I did not touch `macos_list.patch`.

I am slightly unsure whether it would be better to use a tolerance instead of an ellipsis here:

```diff
@@ -1563,7 +1563,7 @@ class FriCASElement(ExpectElement):
             sage: psi(1.0)
             -0.577215664901533
             sage: fricas.polygamma(1, 1.0)                                      # optional - fricas
-            1.6449340668482269
+            1.644934066848226...
             sage: psi(1, 1).n()
             1.64493406684823
```



---

archive/issue_comments_549877.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nFails on macOS:\nhttps://github.com/mkoeppe/sage/runs/7056483127?check_suite_focus=true\n\n```\nchecking host system type... x86_64-apple-darwin19.6.0\nchecking target system type... x86_64-apple-darwin19.6.0\nchecking for in-tree build on case insensitive file system... configure: error: in tree build on case insensitive file system is not supported. Use out-of-source-tree build instead.\n********************************************************************************\n```",
    "created_at": "2022-06-27T22:46:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549877",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Fails on macOS:
https://github.com/mkoeppe/sage/runs/7056483127?check_suite_focus=true

```
checking host system type... x86_64-apple-darwin19.6.0
checking target system type... x86_64-apple-darwin19.6.0
checking for in-tree build on case insensitive file system... configure: error: in tree build on case insensitive file system is not supported. Use out-of-source-tree build instead.
********************************************************************************
```



---

archive/issue_events_462897.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-27T22:46:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462897"
}
```



---

archive/issue_events_462898.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-27T22:46:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462898"
}
```



---

archive/issue_comments_549878.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI don't know how to do that: I think we want to pass `enable_case_insensitive_file_system_check=no` to `configure`.",
    "created_at": "2022-06-28T07:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549878",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:10" align="right">comment:10</div>

I don't know how to do that: I think we want to pass `enable_case_insensitive_file_system_check=no` to `configure`.



---

archive/issue_comments_549879.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nCould you try the following?\n\n```diff\ndiff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in\nindex df98bfdb00f..5bd4f903148 100644\n--- a/build/pkgs/fricas/spkg-install.in\n+++ b/build/pkgs/fricas/spkg-install.in\n@@ -3,6 +3,6 @@ cd src\n # Use newer version of config.guess and config.sub (see Trac #23847)\n cp \"$SAGE_ROOT\"/config/config.* config\n \n-sdh_configure --with-lisp=ecl\n+sdh_configure --with-lisp=ecl --enable_case_insensitive_file_system_check=no\n sdh_make\n sdh_make_install -j1\n```",
    "created_at": "2022-06-28T07:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549879",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:11" align="right">comment:11</div>

Could you try the following?

```diff
diff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in
index df98bfdb00f..5bd4f903148 100644
--- a/build/pkgs/fricas/spkg-install.in
+++ b/build/pkgs/fricas/spkg-install.in
@@ -3,6 +3,6 @@ cd src
 # Use newer version of config.guess and config.sub (see Trac #23847)
 cp "$SAGE_ROOT"/config/config.* config
 
-sdh_configure --with-lisp=ecl
+sdh_configure --with-lisp=ecl --enable_case_insensitive_file_system_check=no
 sdh_make
 sdh_make_install -j1
```



---

archive/issue_comments_549880.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI first tried the out-of-source-tree build that was suggested by that error message:\n\n```\ndiff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in\nindex df98bfdb00..bf9f559cc7 100644\n--- a/build/pkgs/fricas/spkg-install.in\n+++ b/build/pkgs/fricas/spkg-install.in\n@@ -3,6 +3,9 @@ cd src\n # Use newer version of config.guess and config.sub (see Trac #23847)\n cp \"$SAGE_ROOT\"/config/config.* config\n \n-sdh_configure --with-lisp=ecl\n+mkdir build\n+cd build\n+ln -s ../configure .\n+sdh_configure --srcdir=.. --with-lisp=ecl\n sdh_make\n sdh_make_install -j1\n```\n\nBut it appears to be broken:\n\n```\n[fricas-1.3.8.p1] FRICAS-LISP> \n[fricas-1.3.8.p1] ;;;\n[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.\n[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0\n[fricas-1.3.8.p1] ;;;\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341\n[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)\n[fricas-1.3.8.p1] ;;;   ! The variable S is not used.\n[fricas-1.3.8.p1] ;;; End of Pass 1.\n[fricas-1.3.8.p1] ;;; Internal error:\n[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing\n[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM \"clang\" (\"-I.\" \"-I/usr/local/Cellar/ecl/21.2.1_2/include/\" \"-I/usr/local/opt/gmp/include\" \"-I/usr/local/opt/libffi/include\" \"-I/usr/local/opt/bdw-gc/include\" \"-g\" \"-O2\" \"-fPIC\" \"-fno-common\" \"-D_THREAD_SAFE\" \"-Ddarwin\" \"-O2\" \"-c\" \"fricas-lisp.c\" \"-o\" \"fricas-lisp.o\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/\")):\n[fricas-1.3.8.p1] ;;; In file included from fricas-lisp.c:6:\n[fricas-1.3.8.p1] ;;; In file included from ./fricas-lisp.eclh:7:\n[fricas-1.3.8.p1] ;;; //Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/com.h:45:10: fatal error: 'fricas_c_macros.h' file not found\n[fricas-1.3.8.p1] ;;; #include \"fricas_c_macros.h\"\n[fricas-1.3.8.p1] ;;;          ^~~~~~~~~~~~~~~~~~~\n[fricas-1.3.8.p1] ;;; 1 error generated.\n[fricas-1.3.8.p1] NIL\n[fricas-1.3.8.p1] T\n[fricas-1.3.8.p1] T\n```",
    "created_at": "2022-06-28T18:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549880",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

I first tried the out-of-source-tree build that was suggested by that error message:

```
diff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in
index df98bfdb00..bf9f559cc7 100644
--- a/build/pkgs/fricas/spkg-install.in
+++ b/build/pkgs/fricas/spkg-install.in
@@ -3,6 +3,9 @@ cd src
 # Use newer version of config.guess and config.sub (see Trac #23847)
 cp "$SAGE_ROOT"/config/config.* config
 
-sdh_configure --with-lisp=ecl
+mkdir build
+cd build
+ln -s ../configure .
+sdh_configure --srcdir=.. --with-lisp=ecl
 sdh_make
 sdh_make_install -j1
```

But it appears to be broken:

```
[fricas-1.3.8.p1] FRICAS-LISP> 
[fricas-1.3.8.p1] ;;;
[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.
[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0
[fricas-1.3.8.p1] ;;;
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341
[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)
[fricas-1.3.8.p1] ;;;   ! The variable S is not used.
[fricas-1.3.8.p1] ;;; End of Pass 1.
[fricas-1.3.8.p1] ;;; Internal error:
[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing
[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM "clang" ("-I." "-I/usr/local/Cellar/ecl/21.2.1_2/include/" "-I/usr/local/opt/gmp/include" "-I/usr/local/opt/libffi/include" "-I/usr/local/opt/bdw-gc/include" "-g" "-O2" "-fPIC" "-fno-common" "-D_THREAD_SAFE" "-Ddarwin" "-O2" "-c" "fricas-lisp.c" "-o" "fricas-lisp.o" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/")):
[fricas-1.3.8.p1] ;;; In file included from fricas-lisp.c:6:
[fricas-1.3.8.p1] ;;; In file included from ./fricas-lisp.eclh:7:
[fricas-1.3.8.p1] ;;; //Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/com.h:45:10: fatal error: 'fricas_c_macros.h' file not found
[fricas-1.3.8.p1] ;;; #include "fricas_c_macros.h"
[fricas-1.3.8.p1] ;;;          ^~~~~~~~~~~~~~~~~~~
[fricas-1.3.8.p1] ;;; 1 error generated.
[fricas-1.3.8.p1] NIL
[fricas-1.3.8.p1] T
[fricas-1.3.8.p1] T
```



---

archive/issue_comments_549881.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nBut your fix (after a spelling fix) also does not work:\n\n```\ndiff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in\nindex df98bfdb00..62a15704f1 100644\n--- a/build/pkgs/fricas/spkg-install.in\n+++ b/build/pkgs/fricas/spkg-install.in\n@@ -3,6 +3,6 @@ cd src\n # Use newer version of config.guess and config.sub (see Trac #23847)\n cp \"$SAGE_ROOT\"/config/config.* config\n \n-sdh_configure --with-lisp=ecl\n+sdh_configure --with-lisp=ecl --enable-case-insensitive-file-system-check=no\n sdh_make\n sdh_make_install -j1\n```\n\n```\n[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.\n[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0\n[fricas-1.3.8.p1] ;;;\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874\n[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)\n[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.\n[fricas-1.3.8.p1] ;;; Style warning:\n[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341\n[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)\n[fricas-1.3.8.p1] ;;;   ! The variable S is not used.\n[fricas-1.3.8.p1] ;;; End of Pass 1.\n[fricas-1.3.8.p1] ;;; Internal error:\n[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing\n[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM \"clang\" (\"-I.\" \"-I/usr/local/Cellar/ecl/21.2.1_2/include/\" \"-I/usr/local/opt/gmp/include\" \"-I/usr/local/opt/libffi/include\" \"-I/usr/local/opt/bdw-gc/include\" \"-g\" \"-O2\" \"-fPIC\" \"-fno-common\" \"-D_THREAD_SAFE\" \"-Ddarwin\" \"-O2\" \"-c\" \"fricas-lisp.c\" \"-o\" \"fricas-lisp.o\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/\" \"-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/\")):\n[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: error: implicit declaration of function 'remove_directory' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\n[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(remove_directory(ecl_base_string_pointer_safe(v2)));\n[fricas-1.3.8.p1] ;;;                         ^\n[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'\n[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t\n[fricas-1.3.8.p1] ;;;                       ^\n[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: note: did you mean 'L25_remove_directory_'?\n[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'\n[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t\n[fricas-1.3.8.p1] ;;;                       ^\n[fricas-1.3.8.p1] ;;; ./fricas-lisp.eclh:38:18: note: 'L25_remove_directory_' declared here\n[fricas-1.3.8.p1] ;;; static cl_object L25_remove_directory_(cl_object );\n[fricas-1.3.8.p1] ;;;                  ^\n[fricas-1.3.8.p1] ;;; fricas-lisp.c:921:25: error: implicit declaration of function 'makedir' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\n[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(makedir(ecl_base_string_pointer_safe(v2)));\n[fricas-1.3.8.p1] ;;;                         ^\n[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'\n[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t\n[fricas-1.3.8.p1] ;;;                       ^\n[fricas-1.3.8.p1] ;;; 2 errors generated.\n[fricas-1.3.8.p1] NIL\n[fricas-1.3.8.p1] T\n[fricas-1.3.8.p1] T\n```",
    "created_at": "2022-06-28T18:52:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549881",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

But your fix (after a spelling fix) also does not work:

```
diff --git a/build/pkgs/fricas/spkg-install.in b/build/pkgs/fricas/spkg-install.in
index df98bfdb00..62a15704f1 100644
--- a/build/pkgs/fricas/spkg-install.in
+++ b/build/pkgs/fricas/spkg-install.in
@@ -3,6 +3,6 @@ cd src
 # Use newer version of config.guess and config.sub (see Trac #23847)
 cp "$SAGE_ROOT"/config/config.* config
 
-sdh_configure --with-lisp=ecl
+sdh_configure --with-lisp=ecl --enable-case-insensitive-file-system-check=no
 sdh_make
 sdh_make_install -j1
```

```
[fricas-1.3.8.p1] ;;; Compiling fricas-lisp.lisp.
[fricas-1.3.8.p1] ;;; OPTIMIZE levels: Safety=0, Space=0, Speed=3, Debug=0
[fricas-1.3.8.p1] ;;;
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable RESTART is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 2874
[fricas-1.3.8.p1] ;;;   at (DEFUN SAVE-CORE-RESTART ...)
[fricas-1.3.8.p1] ;;;   ! The variable CORE-IMAGE is not used.
[fricas-1.3.8.p1] ;;; Style warning:
[fricas-1.3.8.p1] ;;;   in file fricas-lisp.lisp, position 11341
[fricas-1.3.8.p1] ;;;   at (DEFUN quiet_load_alien ...)
[fricas-1.3.8.p1] ;;;   ! The variable S is not used.
[fricas-1.3.8.p1] ;;; End of Pass 1.
[fricas-1.3.8.p1] ;;; Internal error:
[fricas-1.3.8.p1] ;;;   ** Error code 1 when executing
[fricas-1.3.8.p1] ;;; (EXT:RUN-PROGRAM "clang" ("-I." "-I/usr/local/Cellar/ecl/21.2.1_2/include/" "-I/usr/local/opt/gmp/include" "-I/usr/local/opt/libffi/include" "-I/usr/local/opt/bdw-gc/include" "-g" "-O2" "-fPIC" "-fno-common" "-D_THREAD_SAFE" "-Ddarwin" "-O2" "-c" "fricas-lisp.c" "-o" "fricas-lisp.o" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/include/" "-I//Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/local/var/tmp/sage/build/fricas-1.3.8.p1/src/src/../config/")):
[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: error: implicit declaration of function 'remove_directory' is invalid in C99 [-Werror,-Wimplicit-function-declaration]
[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(remove_directory(ecl_base_string_pointer_safe(v2)));
[fricas-1.3.8.p1] ;;;                         ^
[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'
[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t
[fricas-1.3.8.p1] ;;;                       ^
[fricas-1.3.8.p1] ;;; fricas-lisp.c:639:25: note: did you mean 'L25_remove_directory_'?
[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'
[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t
[fricas-1.3.8.p1] ;;;                       ^
[fricas-1.3.8.p1] ;;; ./fricas-lisp.eclh:38:18: note: 'L25_remove_directory_' declared here
[fricas-1.3.8.p1] ;;; static cl_object L25_remove_directory_(cl_object );
[fricas-1.3.8.p1] ;;;                  ^
[fricas-1.3.8.p1] ;;; fricas-lisp.c:921:25: error: implicit declaration of function 'makedir' is invalid in C99 [-Werror,-Wimplicit-function-declaration]
[fricas-1.3.8.p1] ;;;   value0 = ecl_make_int(makedir(ecl_base_string_pointer_safe(v2)));
[fricas-1.3.8.p1] ;;;                         ^
[fricas-1.3.8.p1] ;;; /usr/local/Cellar/ecl/21.2.1_2/include/ecl/external.h:1107:23: note: expanded from macro 'ecl_make_int'
[fricas-1.3.8.p1] ;;; # define ecl_make_int ecl_make_int32_t
[fricas-1.3.8.p1] ;;;                       ^
[fricas-1.3.8.p1] ;;; 2 errors generated.
[fricas-1.3.8.p1] NIL
[fricas-1.3.8.p1] T
[fricas-1.3.8.p1] T
```



---

archive/issue_comments_549882.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.\n\n```\ndiff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1\nindex af23933a..8e458c6c 100644\n--- a/src/include/cfuns-c.H1\n+++ b/src/include/cfuns-c.H1\n@@ -1,2 +1,4 @@\n extern int directoryp(char *);\n extern int writeablep(char *);\n+extern int remove_directory(char *);\n+extern int makedir(char *);\n```",
    "created_at": "2022-06-28T19:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549882",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:14" align="right">comment:14</div>

OK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.

```
diff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1
index af23933a..8e458c6c 100644
--- a/src/include/cfuns-c.H1
+++ b/src/include/cfuns-c.H1
@@ -1,2 +1,4 @@
 extern int directoryp(char *);
 extern int writeablep(char *);
+extern int remove_directory(char *);
+extern int makedir(char *);
```



---

archive/issue_comments_549883.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThat out-of-source check in the makefile seems broken too:\nhttps://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true",
    "created_at": "2022-06-28T19:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549883",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

That out-of-source check in the makefile seems broken too:
https://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true



---

archive/issue_comments_549884.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nsorry, that's way over my head :-(",
    "created_at": "2022-06-28T19:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549884",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:16" align="right">comment:16</div>

sorry, that's way over my head :-(



---

archive/issue_comments_549885.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment%3A15):\n> That out-of-source check in the makefile seems broken too:\n> https://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true\n\nI'm taking this back.",
    "created_at": "2022-06-28T19:17:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549885",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment%3A15):
> That out-of-source check in the makefile seems broken too:
> https://github.com/mkoeppe/fricas/runs/7099432851?check_suite_focus=true

I'm taking this back.



---

archive/issue_comments_549886.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nLooks like FriCAS does not have sufficient CI coverage. I have prepared one at https://github.com/fricas/fricas/pull/102, please take a look",
    "created_at": "2022-06-28T19:51:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549886",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Looks like FriCAS does not have sufficient CI coverage. I have prepared one at https://github.com/fricas/fricas/pull/102, please take a look



---

archive/issue_comments_549887.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI am not really a fricas developer, and I know nothing about CI :-(",
    "created_at": "2022-06-28T20:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549887",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:19" align="right">comment:19</div>

I am not really a fricas developer, and I know nothing about CI :-(



---

archive/issue_comments_549888.json:
```json
{
    "body": "Dependencies: **#34017**",
    "created_at": "2022-06-29T00:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549888",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#34017**



---

archive/issue_comments_549889.json:
```json
{
    "body": "Changed branch from **[u/mantepse/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/update_fricas_to_1_3_8)** to **[u/mkoeppe/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/update_fricas_to_1_3_8)**",
    "created_at": "2022-06-29T00:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549889",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mantepse/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/update_fricas_to_1_3_8)** to **[u/mkoeppe/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/update_fricas_to_1_3_8)**



---

archive/issue_comments_549890.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mantepse](#comment%3A14):\n> OK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.\n> \n> ```\n> diff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1\n> index af23933a..8e458c6c 100644\n> --- a/src/include/cfuns-c.H1\n> +++ b/src/include/cfuns-c.H1\n> @@ -1,2 +1,4 @@\n>  extern int directoryp(char *);\n>  extern int writeablep(char *);\n> +extern int remove_directory(char *);\n> +extern int makedir(char *);\n> ```\n\nHow about sending this as a PR to FriCAS\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f8939f5f6d38ec22eadfb4bc562b73ba9813ea1\"><code>4f8939f</code></a></td><td><code>build/pkgs/fricas/spkg-install.in: Use --enable-case-insensitive-file-system-check=no</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58d62f4e22ee7d7f8f38665ab5f40961f811e2ac\"><code>58d62f4</code></a></td><td><code>build/bin/write-dockerfile.sh: ADD src/VERSION.txt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e12f4003a057fccfc97eaf6d3f328529cf4bd84\"><code>4e12f40</code></a></td><td><code>Merge #34017</code></td></tr></table>\n",
    "created_at": "2022-06-29T06:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549890",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mantepse](#comment%3A14):
> OK, so we cannot quite remove the patch in `extdecls.patch`.  Could you please try to put the following into a file `extdecls.patch` in the `patches` directory.
> 
> ```
> diff --git a/src/include/cfuns-c.H1 b/src/include/cfuns-c.H1
> index af23933a..8e458c6c 100644
> --- a/src/include/cfuns-c.H1
> +++ b/src/include/cfuns-c.H1
> @@ -1,2 +1,4 @@
>  extern int directoryp(char *);
>  extern int writeablep(char *);
> +extern int remove_directory(char *);
> +extern int makedir(char *);
> ```

How about sending this as a PR to FriCAS

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f8939f5f6d38ec22eadfb4bc562b73ba9813ea1"><code>4f8939f</code></a></td><td><code>build/pkgs/fricas/spkg-install.in: Use --enable-case-insensitive-file-system-check=no</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58d62f4e22ee7d7f8f38665ab5f40961f811e2ac"><code>58d62f4</code></a></td><td><code>build/bin/write-dockerfile.sh: ADD src/VERSION.txt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e12f4003a057fccfc97eaf6d3f328529cf4bd84"><code>4e12f40</code></a></td><td><code>Merge #34017</code></td></tr></table>




---

archive/issue_comments_549891.json:
```json
{
    "body": "Changed commit from **[`b48a4ac`](https://github.com/sagemath/sagetrac-mirror/commit/b48a4ac58b463d32f9c037448800d8e9f583b73f)** to **[`4e12f40`](https://github.com/sagemath/sagetrac-mirror/commit/4e12f4003a057fccfc97eaf6d3f328529cf4bd84)**",
    "created_at": "2022-06-29T06:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549891",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`b48a4ac`](https://github.com/sagemath/sagetrac-mirror/commit/b48a4ac58b463d32f9c037448800d8e9f583b73f)** to **[`4e12f40`](https://github.com/sagemath/sagetrac-mirror/commit/4e12f4003a057fccfc97eaf6d3f328529cf4bd84)**



---

archive/issue_comments_549892.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nre [comment:14](#comment%3A14): does it work?  I don't have access to a mac, so I cannot say.\n\nProvided it does: FriCAS 1.3.8 is released, and the content of `cfuns-c.H1` changed so much that the original patch did not even apply.  So, yes, we should mention it to the FriCAS people, but it doesn't make sense to wait for the next release.",
    "created_at": "2022-06-29T06:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549892",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:23" align="right">comment:23</div>

re [comment:14](#comment%3A14): does it work?  I don't have access to a mac, so I cannot say.

Provided it does: FriCAS 1.3.8 is released, and the content of `cfuns-c.H1` changed so much that the original patch did not even apply.  So, yes, we should mention it to the FriCAS people, but it doesn't make sense to wait for the next release.



---

archive/issue_comments_549893.json:
```json
{
    "body": "Changed commit from **[`4e12f40`](https://github.com/sagemath/sagetrac-mirror/commit/4e12f4003a057fccfc97eaf6d3f328529cf4bd84)** to **[`d7df5ec`](https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1)**",
    "created_at": "2022-06-29T15:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549893",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e12f40`](https://github.com/sagemath/sagetrac-mirror/commit/4e12f4003a057fccfc97eaf6d3f328529cf4bd84)** to **[`d7df5ec`](https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1)**



---

archive/issue_comments_549894.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1\"><code>d7df5ec</code></a></td><td><code>build/pkgs/fricas/patches/extdecls.patch: Re-add (updated)</code></td></tr></table>\n",
    "created_at": "2022-06-29T15:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549894",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1"><code>d7df5ec</code></a></td><td><code>build/pkgs/fricas/patches/extdecls.patch: Re-add (updated)</code></td></tr></table>




---

archive/issue_comments_549895.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYes, it works",
    "created_at": "2022-06-29T15:13:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549895",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Yes, it works



---

archive/issue_events_462899.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-29T15:15:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462899"
}
```



---

archive/issue_events_462900.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-29T15:15:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462900"
}
```



---

archive/issue_events_462901.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-29T15:32:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462901"
}
```



---

archive/issue_events_462902.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-06-29T15:32:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462902"
}
```



---

archive/issue_comments_549896.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2022-06-29T15:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549896",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_549897.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAlso `./sage -tp src/sage/interfaces/fricas.py src/sage/calculus src/sage/functions src/sage/symbolic`:\n\n```\nAll tests passed!\n```",
    "created_at": "2022-06-29T15:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549897",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Also `./sage -tp src/sage/interfaces/fricas.py src/sage/calculus src/sage/functions src/sage/symbolic`:

```
All tests passed!
```



---

archive/issue_comments_549898.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nGreat! Thank you so much!\n\nIs there any other platform which should absolutely be tested?  If not so, please go ahead!",
    "created_at": "2022-06-29T15:34:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549898",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:28" align="right">comment:28</div>

Great! Thank you so much!

Is there any other platform which should absolutely be tested?  If not so, please go ahead!



---

archive/issue_comments_549899.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nTake a look at the discussion in https://github.com/fricas/fricas/pull/102 - using the CI, it was discovered that fricas is broken on recent-ish Fedora when the Fedora-provided ECL is in use.\n\nThat's a regression in platform support. See https://github.com/sagemath/sage/runs/6443849430?check_suite_focus=true - where fricas built successfully in Sage 9.6 for one of the affected platforms.",
    "created_at": "2022-06-29T15:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549899",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

Take a look at the discussion in https://github.com/fricas/fricas/pull/102 - using the CI, it was discovered that fricas is broken on recent-ish Fedora when the Fedora-provided ECL is in use.

That's a regression in platform support. See https://github.com/sagemath/sage/runs/6443849430?check_suite_focus=true - where fricas built successfully in Sage 9.6 for one of the affected platforms.



---

archive/issue_events_462903.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-09T22:33:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462903"
}
```



---

archive/issue_events_462904.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "99fba2a5de1cca749533ffc9e37afb1467dcaa1b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-07-09T22:33:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34051#event-462904"
}
```



---

archive/issue_comments_549900.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/update_fricas_to_1_3_8)** to **[`d7df5ec`](https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1)**",
    "created_at": "2022-07-09T22:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34051#issuecomment-549900",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/update_fricas_to_1_3_8](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/update_fricas_to_1_3_8)** to **[`d7df5ec`](https://github.com/sagemath/sagetrac-mirror/commit/d7df5ec9d2c2cb88548c183aeac98d30139a1cd1)**
