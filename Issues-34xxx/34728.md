# Issue 34728: change sorting for WeierstrassIsomorphism

archive/issues_034491.json:
```json
{
    "body": "Currently, `EllipticCurve_generic.automorphisms()` returns the automorphisms in a more or less arbitrary (albeit deterministic) order.\n\nIt is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)\n\nIn this patch, we change `._comparison_impl()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.\n\nDiff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=c9e964632bdfd95c1f89557a5c7e1ef1c78a794a\n\nCC:  @JohnCremona\n\nBranch/Commit: [c9e964632bdfd95c1f89557a5c7e1ef1c78a794a](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)\n\nReviewer: John Cremona\n\nAuthor: Lorenz Panny\n\nDependencies: #34727, #34722\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34728\n\n",
    "closed_at": "2022-12-03T00:44:49Z",
    "created_at": "2022-11-07T06:37:10Z",
    "labels": [
        "component: elliptic curves",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "change sorting for WeierstrassIsomorphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34728",
    "user": "https://github.com/yyyyx4"
}
```
Currently, `EllipticCurve_generic.automorphisms()` returns the automorphisms in a more or less arbitrary (albeit deterministic) order.

It is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)

In this patch, we change `._comparison_impl()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.

Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=c9e964632bdfd95c1f89557a5c7e1ef1c78a794a

CC:  @JohnCremona

Branch/Commit: [c9e964632bdfd95c1f89557a5c7e1ef1c78a794a](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)

Reviewer: John Cremona

Author: Lorenz Panny

Dependencies: #34727, #34722

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34728





---

archive/issue_comments_690259.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n It is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)\n \n-In this patch, we change `._richcmp_()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.\n+In this patch, we change `.__richcmp__()` for `baseWI` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.\n \n Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c\n``````\n",
    "created_at": "2022-11-07T07:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690259",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 It is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)
 
-In this patch, we change `._richcmp_()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.
+In this patch, we change `.__richcmp__()` for `baseWI` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.
 
 Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c
``````




---

archive/issue_comments_690260.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-11-07T07:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690260",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_690261.json:
```json
{
    "body": "Reviewer: John Cremona",
    "created_at": "2022-11-07T11:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690261",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: John Cremona



---

archive/issue_comments_690262.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-11-07T11:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690262",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_690263.json:
```json
{
    "body": "<a id='comment:2'></a>\nAll looks good, and I agree with the sorting strategy.  Two questions: (1) when p=2 in the random test is it still the case that the second auto in the list is multiplcation by -1? (2) In the test for the length of the autos, for the last two cases you don't really need to put both 0 and 1728 in the list since they are equal :) But I will not insist.\n\nAs long as the answer to (1) is yes, you can take a positive review from me.",
    "created_at": "2022-11-07T11:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690263",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
All looks good, and I agree with the sorting strategy.  Two questions: (1) when p=2 in the random test is it still the case that the second auto in the list is multiplcation by -1? (2) In the test for the length of the autos, for the last two cases you don't really need to put both 0 and 1728 in the list since they are equal :) But I will not insist.

As long as the answer to (1) is yes, you can take a positive review from me.



---

archive/issue_comments_690264.json:
```json
{
    "body": "Changing commit from \"[6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c](https://github.com/sagemath/sagetrac-mirror/commit/6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c)\" to \"[c9e964632bdfd95c1f89557a5c7e1ef1c78a794a](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)\"",
    "created_at": "2022-11-08T05:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c](https://github.com/sagemath/sagetrac-mirror/commit/6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c)" to "[c9e964632bdfd95c1f89557a5c7e1ef1c78a794a](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)"



---

archive/issue_comments_690265.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[4c4ce93](https://github.com/sagemath/sagetrac-mirror/commit/4c4ce932ca309af16087c265ae7ccce052ee110b)|`0 == 1728 in characteristics 2 and 3`|\n|[c9e9646](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)|`compare entire (u,r,s,t) tuple`|",
    "created_at": "2022-11-08T05:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[4c4ce93](https://github.com/sagemath/sagetrac-mirror/commit/4c4ce932ca309af16087c265ae7ccce052ee110b)|`0 == 1728 in characteristics 2 and 3`|
|[c9e9646](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)|`compare entire (u,r,s,t) tuple`|



---

archive/issue_comments_690266.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n It is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)\n \n-In this patch, we change `.__richcmp__()` for `baseWI` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.\n+In this patch, we change `._comparison_impl()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.\n \n-Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c\n+Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=c9e964632bdfd95c1f89557a5c7e1ef1c78a794a\n``````\n",
    "created_at": "2022-11-08T05:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690266",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 It is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)
 
-In this patch, we change `.__richcmp__()` for `baseWI` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.
+In this patch, we change `._comparison_impl()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.
 
-Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c
+Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=c9e964632bdfd95c1f89557a5c7e1ef1c78a794a
``````




---

archive/issue_comments_690267.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-11-08T05:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690267",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_690268.json:
```json
{
    "body": "<a id='comment:4'></a>\nThank you for the feedback!\n\n(2) Done.\n\n(1) The answer used to be no (I had incorrectly assumed that `u` uniquely identifies the isomorphism, which is manifestly untrue in characteristics 2 and 3), but it should be handled correctly now. This did require moving the comparison up from `baseWI` to `WeierstrassIsomorphism`, as the former knows nothing about the domain curve.\n\nSince the new changes are not totally trivial, I'll let you have another look rather than setting it to positive review right away.\n\nAnother question: Did you check all modifications in this branch or just the ones in \"diff without the dependencies\"?",
    "created_at": "2022-11-08T05:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690268",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:4'></a>
Thank you for the feedback!

(2) Done.

(1) The answer used to be no (I had incorrectly assumed that `u` uniquely identifies the isomorphism, which is manifestly untrue in characteristics 2 and 3), but it should be handled correctly now. This did require moving the comparison up from `baseWI` to `WeierstrassIsomorphism`, as the former knows nothing about the domain curve.

Since the new changes are not totally trivial, I'll let you have another look rather than setting it to positive review right away.

Another question: Did you check all modifications in this branch or just the ones in "diff without the dependencies"?



---

archive/issue_comments_690269.json:
```json
{
    "body": "<a id='comment:5'></a>\nI checked all. Can't check again right now as travelling.",
    "created_at": "2022-11-08T16:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690269",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
I checked all. Can't check again right now as travelling.



---

archive/issue_comments_690270.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-11-10T08:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690270",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_690271.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks for the two extra changes. I like that the new sorting key code ends up several lines shorter!",
    "created_at": "2022-11-10T08:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690271",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
Thanks for the two extra changes. I like that the new sorting key code ends up several lines shorter!



---

archive/issue_comments_690272.json:
```json
{
    "body": "<a id='comment:7'></a>\nThank you!\u2002I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch\u2009\u2014\u2009which you've reviewed.",
    "created_at": "2022-11-10T08:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690272",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:7'></a>
Thank you! I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch — which you've reviewed.



---

archive/issue_comments_690273.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [Lorenz Panny](#comment%3A7):\n> Thank you!\u2002I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch\u2009\u2014\u2009which you've reviewed.\n\n\nOK fine",
    "created_at": "2022-11-10T10:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690273",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'></a>
Replying to [Lorenz Panny](#comment%3A7):
> Thank you! I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch — which you've reviewed.


OK fine



---

archive/issue_events_101161.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-12-03T00:44:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34728#event-101161"
}
```



---

archive/issue_comments_690274.json:
```json
{
    "body": "Changing branch from \"[public/sort_elliptic_curve_isomorphisms](https://github.com/sagemath/sagetrac-mirror/tree/public/sort_elliptic_curve_isomorphisms)\" to \"[c9e964632bdfd95c1f89557a5c7e1ef1c78a794a](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)\"",
    "created_at": "2022-12-03T00:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690274",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[public/sort_elliptic_curve_isomorphisms](https://github.com/sagemath/sagetrac-mirror/tree/public/sort_elliptic_curve_isomorphisms)" to "[c9e964632bdfd95c1f89557a5c7e1ef1c78a794a](https://github.com/sagemath/sagetrac-mirror/commit/c9e964632bdfd95c1f89557a5c7e1ef1c78a794a)"



---

archive/issue_comments_690275.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-12-03T00:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34728#issuecomment-690275",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
