# Issue 34421: Fix timeout in jupyter_jsmol installation

archive/issues_034184.json:
```json
{
    "body": "after #33866 update, I get an error on Gentoo.\n\nAs it turns out, jupyter_jsmol installation process fetches more js stuff than there is in the tarball:\n\n```\njjupyter_jsmol-2022.1.0] Building wheels for collected packages: jupyter-jsmol\n[jupyter_jsmol-2022.1.0]   WARNING: Ignoring --build-option when building jupyter-jsmol using PEP 517\n[jupyter_jsmol-2022.1.0]   Building wheel for jupyter-jsmol (pyproject.toml): started\n[jupyter_jsmol-2022.1.0]   Running command Building wheel for jupyter-jsmol (pyproject.toml)\n[jupyter_jsmol-2022.1.0]   setup.py entered\n[jupyter_jsmol-2022.1.0]   $PATH=/mnt/opt/Sage/sage-dev/build/bin:/mnt/opt/Sage/sage-dev/local/var/lib/sage/venv-python3.10/bin:/mnt/opt/Sage/sage-dev/local/bin:/mnt/opt/Sage/sage-dev/build/bin:/mnt/opt/Sage/sage-dev/local/bin:/mnt/opt/Sage/sage-dev/local/var/lib/sage/venv-python3.10/bin:/mnt/opt/Sage/sage-dev/build/bin:/mnt/opt/Sage/sage-dev/src/bin:/mnt/opt/Sage/sage-dev/local/bin:/home/dima/.elan/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin:/usr/lib/llvm/14/bin:/home/dima/.local/bin:/home/dima/.local/bin\n[jupyter_jsmol-2022.1.0]   <string>:47: DeprecatedWarning: create_cmdclass is deprecated as of 0.8 and will be removed in 1.0. \"\n[jupyter_jsmol-2022.1.0]   Use `wrap_installers` to handle prebuild steps in cmdclass.\n[jupyter_jsmol-2022.1.0]   Use `get_data_files` to handle data files.\n[jupyter_jsmol-2022.1.0]   Use `include_package_data=True` and `MANIFEST.in` for package data.\n[jupyter_jsmol-2022.1.0] \n[jupyter_jsmol-2022.1.0]   <string>:49: DeprecatedWarning: install_npm is deprecated as of 0.8 and will be removed in 1.0. Use `npm_builder` and `wrap_installers`\n[jupyter_jsmol-2022.1.0]   running bdist_wheel\n[jupyter_jsmol-2022.1.0]   running jsdeps\n[jupyter_jsmol-2022.1.0]   Installing build dependencies with npm.  This may take a while...\n[jupyter_jsmol-2022.1.0]   > yarn install\n[jupyter_jsmol-2022.1.0]   yarn install v1.22.19\n[jupyter_jsmol-2022.1.0]   warning package.json: No license field\n[jupyter_jsmol-2022.1.0]   warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.\n[jupyter_jsmol-2022.1.0]   warning jupyter-jsmol@2022.1.0: No license field\n[jupyter_jsmol-2022.1.0]   [1/4] Resolving packages...\n[jupyter_jsmol-2022.1.0]   [2/4] Fetching packages...\n[jupyter_jsmol-2022.1.0]   info There appears to be trouble with your network connection. Retrying...\n...\n```\n\nand it hangs - even tough the network is OK.\nAlso reported [on sage-devel](https://groups.google.com/g/sage-devel/c/emnDzvu5vR4) with Arch Linux.\n\nA straight `./sage --pip install jupyter_jsmol` is almost instant success.\n\n\nCC:  @mkoeppe @videlec @kiwifb @slel @strogdon\n\nKeywords: jupyter_jsmol\n\nBranch/Commit: 6fb910f7e50e4c5f1ff1142cbff30043d10db239\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34421\n\n",
    "closed_at": "2022-08-29T11:24:29Z",
    "created_at": "2022-08-24T10:59:58Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Fix timeout in jupyter_jsmol installation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34421",
    "user": "https://github.com/dimpase"
}
```
after #33866 update, I get an error on Gentoo.

As it turns out, jupyter_jsmol installation process fetches more js stuff than there is in the tarball:

```
jjupyter_jsmol-2022.1.0] Building wheels for collected packages: jupyter-jsmol
[jupyter_jsmol-2022.1.0]   WARNING: Ignoring --build-option when building jupyter-jsmol using PEP 517
[jupyter_jsmol-2022.1.0]   Building wheel for jupyter-jsmol (pyproject.toml): started
[jupyter_jsmol-2022.1.0]   Running command Building wheel for jupyter-jsmol (pyproject.toml)
[jupyter_jsmol-2022.1.0]   setup.py entered
[jupyter_jsmol-2022.1.0]   $PATH=/mnt/opt/Sage/sage-dev/build/bin:/mnt/opt/Sage/sage-dev/local/var/lib/sage/venv-python3.10/bin:/mnt/opt/Sage/sage-dev/local/bin:/mnt/opt/Sage/sage-dev/build/bin:/mnt/opt/Sage/sage-dev/local/bin:/mnt/opt/Sage/sage-dev/local/var/lib/sage/venv-python3.10/bin:/mnt/opt/Sage/sage-dev/build/bin:/mnt/opt/Sage/sage-dev/src/bin:/mnt/opt/Sage/sage-dev/local/bin:/home/dima/.elan/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin:/usr/lib/llvm/14/bin:/home/dima/.local/bin:/home/dima/.local/bin
[jupyter_jsmol-2022.1.0]   <string>:47: DeprecatedWarning: create_cmdclass is deprecated as of 0.8 and will be removed in 1.0. "
[jupyter_jsmol-2022.1.0]   Use `wrap_installers` to handle prebuild steps in cmdclass.
[jupyter_jsmol-2022.1.0]   Use `get_data_files` to handle data files.
[jupyter_jsmol-2022.1.0]   Use `include_package_data=True` and `MANIFEST.in` for package data.
[jupyter_jsmol-2022.1.0] 
[jupyter_jsmol-2022.1.0]   <string>:49: DeprecatedWarning: install_npm is deprecated as of 0.8 and will be removed in 1.0. Use `npm_builder` and `wrap_installers`
[jupyter_jsmol-2022.1.0]   running bdist_wheel
[jupyter_jsmol-2022.1.0]   running jsdeps
[jupyter_jsmol-2022.1.0]   Installing build dependencies with npm.  This may take a while...
[jupyter_jsmol-2022.1.0]   > yarn install
[jupyter_jsmol-2022.1.0]   yarn install v1.22.19
[jupyter_jsmol-2022.1.0]   warning package.json: No license field
[jupyter_jsmol-2022.1.0]   warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.
[jupyter_jsmol-2022.1.0]   warning jupyter-jsmol@2022.1.0: No license field
[jupyter_jsmol-2022.1.0]   [1/4] Resolving packages...
[jupyter_jsmol-2022.1.0]   [2/4] Fetching packages...
[jupyter_jsmol-2022.1.0]   info There appears to be trouble with your network connection. Retrying...
...
```

and it hangs - even tough the network is OK.
Also reported [on sage-devel](https://groups.google.com/g/sage-devel/c/emnDzvu5vR4) with Arch Linux.

A straight `./sage --pip install jupyter_jsmol` is almost instant success.


CC:  @mkoeppe @videlec @kiwifb @slel @strogdon

Keywords: jupyter_jsmol

Branch/Commit: 6fb910f7e50e4c5f1ff1142cbff30043d10db239

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34421





---

archive/issue_comments_677077.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,4 +31,8 @@\n \n aand it hangs - even tough the network is OK. Also reported on sage-devel with archlinux.\n \n+A straight `./sage --pip install jupyter_jsmol` is almost instant success.\n+\n+\n+\n  \n``````\n",
    "created_at": "2022-08-24T11:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677077",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,4 +31,8 @@
 
 aand it hangs - even tough the network is OK. Also reported on sage-devel with archlinux.
 
+A straight `./sage --pip install jupyter_jsmol` is almost instant success.
+
+
+
  
``````




---

archive/issue_events_108722.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "rename": {
        "from": "jupyter_jsmol installation times out",
        "to": "Fix timeout in jupyter_jsmol installation"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34421#event-108722"
}
```



---

archive/issue_comments_677078.json:
```json
{
    "body": "Changing keywords from \"\" to \"jupyter_jsmol\".",
    "created_at": "2022-08-24T16:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677078",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "jupyter_jsmol".



---

archive/issue_comments_677079.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,10 +29,8 @@\n ...\n ```\n \n-aand it hangs - even tough the network is OK. Also reported on sage-devel with archlinux.\n+aand it hangs - even tough the network is OK.\n+Also reported [on sage-devel](https://groups.google.com/g/sage-devel/c/emnDzvu5vR4) with Arch Linux.\n \n A straight `./sage --pip install jupyter_jsmol` is almost instant success.\n \n-\n-\n- \n``````\n",
    "created_at": "2022-08-24T16:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677079",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,10 +29,8 @@
 ...
 ```
 
-aand it hangs - even tough the network is OK. Also reported on sage-devel with archlinux.
+aand it hangs - even tough the network is OK.
+Also reported [on sage-devel](https://groups.google.com/g/sage-devel/c/emnDzvu5vR4) with Arch Linux.
 
 A straight `./sage --pip install jupyter_jsmol` is almost instant success.
 
-
-
- 
``````




---

archive/issue_comments_677080.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhile fixing this, is it worth also addressing this message in the log file?\n\n```\n  Looking in links: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.7.beta8/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels\n  ERROR: Could not find a version that satisfies the requirement jupyter_packaging~=0.7.9 (from versions: none)\n  ERROR: No matching distribution found for jupyter_packaging~=0.7.9\n```\nI don't know where this version number for `jupyter_packaging` is coming from.",
    "created_at": "2022-08-24T18:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677080",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
While fixing this, is it worth also addressing this message in the log file?

```
  Looking in links: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.7.beta8/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels
  ERROR: Could not find a version that satisfies the requirement jupyter_packaging~=0.7.9 (from versions: none)
  ERROR: No matching distribution found for jupyter_packaging~=0.7.9
```
I don't know where this version number for `jupyter_packaging` is coming from.



---

archive/issue_comments_677081.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't see the problem in the ticket description on my OS X machine. Is it because of this from the log file?\n\n```\n  yarn not found, ignoring yarn.lock file\n  `yarn` unavailable.  If you're running this command using sudo, make sure `yarn` is available to sudo\n```",
    "created_at": "2022-08-24T18:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677081",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
I don't see the problem in the ticket description on my OS X machine. Is it because of this from the log file?

```
  yarn not found, ignoring yarn.lock file
  `yarn` unavailable.  If you're running this command using sudo, make sure `yarn` is available to sudo
```



---

archive/issue_comments_677082.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jhpalmieri](#comment%3A5):\n> I don't see the problem in the ticket description on my OS X machine. Is it because of this from the log file?\n> \n> ```\n>   yarn not found, ignoring yarn.lock file\n>   `yarn` unavailable.  If you're running this command using sudo, make sure `yarn` is available to sudo\n> ```\n\n\non another Linux box, without yarn installed, I can't reproduce this either.",
    "created_at": "2022-08-24T18:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677082",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
Replying to [jhpalmieri](#comment%3A5):
> I don't see the problem in the ticket description on my OS X machine. Is it because of this from the log file?
> 
> ```
>   yarn not found, ignoring yarn.lock file
>   `yarn` unavailable.  If you're running this command using sudo, make sure `yarn` is available to sudo
> ```


on another Linux box, without yarn installed, I can't reproduce this either.



---

archive/issue_comments_677083.json:
```json
{
    "body": "<a id='comment:7'></a>\nMy guess would be that on the affected system, there's an installation of some Javascript tools such as `yarn`, and that this interacts poorly with the fact we poison the https proxy when installing normal packages.",
    "created_at": "2022-08-24T18:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677083",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
My guess would be that on the affected system, there's an installation of some Javascript tools such as `yarn`, and that this interacts poorly with the fact we poison the https proxy when installing normal packages.



---

archive/issue_comments_677084.json:
```json
{
    "body": "<a id='comment:9'></a>\nIt would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.\n\nSee https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74",
    "created_at": "2022-08-25T04:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677084",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
It would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.

See https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74



---

archive/issue_comments_677085.json:
```json
{
    "body": "<a id='comment:10'></a>\nThat'd be nice if it works. The previous version (0.2.4) had a switch to avoid the npm stuff (`--skip-npm`) but it has been removed.",
    "created_at": "2022-08-25T04:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677085",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
That'd be nice if it works. The previous version (0.2.4) had a switch to avoid the npm stuff (`--skip-npm`) but it has been removed.



---

archive/issue_comments_677086.json:
```json
{
    "body": "<a id='comment:11'></a>\nit's weird that absence of yarn does not  lead to  build failure, and still produces something that works (?).",
    "created_at": "2022-08-25T06:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677086",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
it's weird that absence of yarn does not  lead to  build failure, and still produces something that works (?).



---

archive/issue_comments_677087.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe sdist of this package contains the prebuilt Javascript assets.",
    "created_at": "2022-08-25T06:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677087",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
The sdist of this package contains the prebuilt Javascript assets.



---

archive/issue_comments_677088.json:
```json
{
    "body": "<a id='comment:13'></a>\nwhy can't we just install the binary wheel? How is it different?",
    "created_at": "2022-08-25T06:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677088",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
why can't we just install the binary wheel? How is it different?



---

archive/issue_comments_677089.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mkoeppe](#comment%3A9):\n> It would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.\n> \n> See https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74\n\n\nIt fails for two reasons. First the handling of this environment variable is buggy\n\n```\n  Skipping npm install as requested.\n  Traceback (most recent call last):\n    File \"/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 363, in <module>\n      main()\n    File \"/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 345, in main\n      json_out['return_val'] = hook(**hook_input['kwargs'])\n    File \"/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 164, in prepare_metadata_for_build_wheel\n      return hook(metadata_directory, config_settings)\n    File \"/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/setuptools/build_meta.py\", line 188, in prepare_metadata_for_build_wheel\n      self.run_setup()\n    File \"/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/setuptools/build_meta.py\", line 174, in run_setup\n      exec(code, locals())\n    File \"<string>\", line 8, in <module>\n    File \"/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/jupyter_packaging/__init__.py\", line 6, in <module>\n      from .setupbase import *  # noqa\n    File \"/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/jupyter_packaging/setupbase.py\", line 77, in <module>\n      sys.argv.remove(\"--skip-npm\")\n  ValueError: list.remove(x): x not in list\n  error: subprocess-exited-with-error\n```\nSecondly, there seems to be a missing build dependency\n\n```\n  ERROR: Could not find a version that satisfies the requirement jupyter_packaging~=0.7.9 (from versions: none)\n  ERROR: No matching distribution found for jupyter_packaging~=0.7.9\n  error: subprocess-exited-with-error\n  \n  \u00d7 pip subprocess to install build dependencies did not run successfully.\n  \u2502 exit code: 1\n  \u2570\u2500> See above for output.\n  \n  note: This error originates from a subprocess, and is likely not a problem with pip.\n  full command: /opt/sage/local/var/lib/sage/venv-python3.10/bin/python3 /tmp/pip-standalone-pip-a17tx8xr/__env_pip__.zip/pip install --ignore-installed --no-user --prefix /tmp/pip-build-env-\nmyzlxjyq/overlay --no-warn-script-location --no-binary :all: --only-binary :none: --no-index --find-links /opt/sage/local/var/lib/sage/venv-python3.10/var/lib/sage/wheels -- 'jupyter_packagin\ng~=0.7.9' 'jupyterlab>=3.0.0,==3.*' 'setuptools>=40.8.0' wheel\n```",
    "created_at": "2022-08-25T07:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677089",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
Replying to [mkoeppe](#comment%3A9):
> It would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.
> 
> See https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74


It fails for two reasons. First the handling of this environment variable is buggy

```
  Skipping npm install as requested.
  Traceback (most recent call last):
    File "/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 363, in <module>
      main()
    File "/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 345, in main
      json_out['return_val'] = hook(**hook_input['kwargs'])
    File "/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 164, in prepare_metadata_for_build_wheel
      return hook(metadata_directory, config_settings)
    File "/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/setuptools/build_meta.py", line 188, in prepare_metadata_for_build_wheel
      self.run_setup()
    File "/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/setuptools/build_meta.py", line 174, in run_setup
      exec(code, locals())
    File "<string>", line 8, in <module>
    File "/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/jupyter_packaging/__init__.py", line 6, in <module>
      from .setupbase import *  # noqa
    File "/opt/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/jupyter_packaging/setupbase.py", line 77, in <module>
      sys.argv.remove("--skip-npm")
  ValueError: list.remove(x): x not in list
  error: subprocess-exited-with-error
```
Secondly, there seems to be a missing build dependency

```
  ERROR: Could not find a version that satisfies the requirement jupyter_packaging~=0.7.9 (from versions: none)
  ERROR: No matching distribution found for jupyter_packaging~=0.7.9
  error: subprocess-exited-with-error
  
  × pip subprocess to install build dependencies did not run successfully.
  │ exit code: 1
  ╰─> See above for output.
  
  note: This error originates from a subprocess, and is likely not a problem with pip.
  full command: /opt/sage/local/var/lib/sage/venv-python3.10/bin/python3 /tmp/pip-standalone-pip-a17tx8xr/__env_pip__.zip/pip install --ignore-installed --no-user --prefix /tmp/pip-build-env-
myzlxjyq/overlay --no-warn-script-location --no-binary :all: --only-binary :none: --no-index --find-links /opt/sage/local/var/lib/sage/venv-python3.10/var/lib/sage/wheels -- 'jupyter_packagin
g~=0.7.9' 'jupyterlab>=3.0.0,==3.*' 'setuptools>=40.8.0' wheel
```



---

archive/issue_comments_677090.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [vdelecroix](#comment%3A14):\n> Replying to [mkoeppe](#comment%3A9):\n> > It would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.\n> > \n> > See https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74\n\n> \n> It fails for two reasons. First the handling of this environment variable is buggy\n\n\nCan you report this upstream please?",
    "created_at": "2022-08-25T10:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677090",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Replying to [vdelecroix](#comment%3A14):
> Replying to [mkoeppe](#comment%3A9):
> > It would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.
> > 
> > See https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74

> 
> It fails for two reasons. First the handling of this environment variable is buggy


Can you report this upstream please?



---

archive/issue_comments_677091.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/fix_timeout_in_jupyter_jsmol_installation\"",
    "created_at": "2022-08-25T10:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677091",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/fix_timeout_in_jupyter_jsmol_installation"



---

archive/issue_comments_677092.json:
```json
{
    "body": "<a id='comment:17'></a>\nTry with this please\n\n---\nNew commits:\n|                                                                                                                                          |                                                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|\n|[987a32e](https://github.com/sagemath/sagetrac-mirror/commit/987a32ee6d7e2cd1c7529651532a8d07a185ef49)|`build/pkgs/jupyter_jsmol/spkg-install.in: Use --no-build-isolation`|",
    "created_at": "2022-08-25T10:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677092",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Try with this please

---
New commits:
|                                                                                                                                          |                                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
|[987a32e](https://github.com/sagemath/sagetrac-mirror/commit/987a32ee6d7e2cd1c7529651532a8d07a185ef49)|`build/pkgs/jupyter_jsmol/spkg-install.in: Use --no-build-isolation`|



---

archive/issue_comments_677093.json:
```json
{
    "body": "Changing commit from \"\" to \"987a32ee6d7e2cd1c7529651532a8d07a185ef49\"",
    "created_at": "2022-08-25T10:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677093",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "987a32ee6d7e2cd1c7529651532a8d07a185ef49"



---

archive/issue_comments_677094.json:
```json
{
    "body": "<a id='comment:18'></a>\nthis does not seem to change anything (same `x not in list` error with `JUPYTER_PACKAGING_SKIP_NPM=1`, hang with `yarn` without the latter).\n\nI tried overriding the system `yarn` with `src/bin/yarn` pointing to `/bin/true`. Then build finishes, and \ntests with `jsmol` pass. \n\nI'm however suspicious of it being non-working, still.\nIs there a visual test I can do?",
    "created_at": "2022-08-25T10:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677094",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
this does not seem to change anything (same `x not in list` error with `JUPYTER_PACKAGING_SKIP_NPM=1`, hang with `yarn` without the latter).

I tried overriding the system `yarn` with `src/bin/yarn` pointing to `/bin/true`. Then build finishes, and 
tests with `jsmol` pass. 

I'm however suspicious of it being non-working, still.
Is there a visual test I can do?



---

archive/issue_comments_677095.json:
```json
{
    "body": "Changing commit from \"987a32ee6d7e2cd1c7529651532a8d07a185ef49\" to \"6fb910f7e50e4c5f1ff1142cbff30043d10db239\"",
    "created_at": "2022-08-25T11:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "987a32ee6d7e2cd1c7529651532a8d07a185ef49" to "6fb910f7e50e4c5f1ff1142cbff30043d10db239"



---

archive/issue_comments_677096.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[6fb910f](https://github.com/sagemath/sagetrac-mirror/commit/6fb910f7e50e4c5f1ff1142cbff30043d10db239)|`build/pkgs/jupyter_jsmol/spkg-install.in: Use --config-settings`|",
    "created_at": "2022-08-25T11:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[6fb910f](https://github.com/sagemath/sagetrac-mirror/commit/6fb910f7e50e4c5f1ff1142cbff30043d10db239)|`build/pkgs/jupyter_jsmol/spkg-install.in: Use --config-settings`|



---

archive/issue_comments_677097.json:
```json
{
    "body": "<a id='comment:20'></a>\nTry with this please",
    "created_at": "2022-08-25T11:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677097",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Try with this please



---

archive/issue_comments_677098.json:
```json
{
    "body": "<a id='comment:21'></a>\nhttps://doc.sagemath.org/html/en/installation/launching.html#setting-up-sagemath-as-a-jupyter-kernel-in-an-existing-jupyter-notebook-or-jupyterlab-installation shows a test that you can do with jsmol",
    "created_at": "2022-08-25T11:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677098",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
https://doc.sagemath.org/html/en/installation/launching.html#setting-up-sagemath-as-a-jupyter-kernel-in-an-existing-jupyter-notebook-or-jupyterlab-installation shows a test that you can do with jsmol



---

archive/issue_comments_677099.json:
```json
{
    "body": "<a id='comment:22'></a>\nOK, it's actually in the docs, how to test jsmol - in notebook one has to run\n\n```\nplot3d(lambda u,v:(u^2+v^2)/4-2,(-2,2),(-2,2)).show(viewer=\"jmol\")\n```\nand see it producing stuff.\nIt works for my crude yarn->true workaround. \n\n---\nNew commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[6fb910f](https://github.com/sagemath/sagetrac-mirror/commit/6fb910f7e50e4c5f1ff1142cbff30043d10db239)|`build/pkgs/jupyter_jsmol/spkg-install.in: Use --config-settings`|",
    "created_at": "2022-08-25T11:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677099",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
OK, it's actually in the docs, how to test jsmol - in notebook one has to run

```
plot3d(lambda u,v:(u^2+v^2)/4-2,(-2,2),(-2,2)).show(viewer="jmol")
```
and see it producing stuff.
It works for my crude yarn->true workaround. 

---
New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[6fb910f](https://github.com/sagemath/sagetrac-mirror/commit/6fb910f7e50e4c5f1ff1142cbff30043d10db239)|`build/pkgs/jupyter_jsmol/spkg-install.in: Use --config-settings`|



---

archive/issue_comments_677100.json:
```json
{
    "body": "<a id='comment:23'></a>\nOK, this works!",
    "created_at": "2022-08-25T11:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677100",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>
OK, this works!



---

archive/issue_comments_677101.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-08-25T11:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677101",
    "user": "https://github.com/dimpase"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_677102.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-25T11:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677102",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_677103.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2022-08-25T11:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677103",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_677104.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-25T11:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677104",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_677105.json:
```json
{
    "body": "<a id='comment:25'></a>\nFollow up in #34430 for a similar change that should be applied to other packages.",
    "created_at": "2022-08-25T11:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677105",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Follow up in #34430 for a similar change that should be applied to other packages.



---

archive/issue_comments_677106.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [mkoeppe](#comment%3A15):\n> Replying to [vdelecroix](#comment%3A14):\n> > Replying to [mkoeppe](#comment%3A9):\n> > > It would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.\n> > > \n> > > See https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74\n\n> > \n> > It fails for two reasons. First the handling of this environment variable is buggy\n\n> \n> Can you report this upstream please?\n\n\nDone at https://github.com/jupyter/jupyter-packaging/issues/160",
    "created_at": "2022-08-25T11:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677106",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>
Replying to [mkoeppe](#comment%3A15):
> Replying to [vdelecroix](#comment%3A14):
> > Replying to [mkoeppe](#comment%3A9):
> > > It would be worth trying if `export JUPYTER_PACKAGING_SKIP_NPM=1` resolves this problem.
> > > 
> > > See https://github.com/jupyter/jupyter-packaging/blob/main/jupyter_packaging/setupbase.py#L74

> > 
> > It fails for two reasons. First the handling of this environment variable is buggy

> 
> Can you report this upstream please?


Done at https://github.com/jupyter/jupyter-packaging/issues/160



---

archive/issue_comments_677107.json:
```json
{
    "body": "<a id='comment:27'></a>\nThanks for reporting upstream at\n\n- \u200bhttps://github.com/jupyter/jupyter-packaging/issues/160\n\nand providing a fix at\n\n- \u200bhttps://github.com/jupyter/jupyter-packaging/pulls/161\n\nA new release is out that thas the fix:\n\n- \u200bhttps://github.com/jupyter/jupyter-packaging/releases/tag/v0.12.3 \n\nUpgrade ticket for Sage: #34432.",
    "created_at": "2022-08-25T16:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677107",
    "user": "https://github.com/slel"
}
```

<a id='comment:27'></a>
Thanks for reporting upstream at

- ​https://github.com/jupyter/jupyter-packaging/issues/160

and providing a fix at

- ​https://github.com/jupyter/jupyter-packaging/pulls/161

A new release is out that thas the fix:

- ​https://github.com/jupyter/jupyter-packaging/releases/tag/v0.12.3 

Upgrade ticket for Sage: #34432.



---

archive/issue_comments_677108.json:
```json
{
    "body": "<a id='comment:28'></a>\nWhat happened here is that the comment regarding `jupyter_jsmol` in #33138 (ticket description) was no longer true after the `jupyter_jsmol` upgrade in #33530.",
    "created_at": "2022-08-25T17:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677108",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
What happened here is that the comment regarding `jupyter_jsmol` in #33138 (ticket description) was no longer true after the `jupyter_jsmol` upgrade in #33530.



---

archive/issue_comments_677109.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,7 +29,7 @@\n ...\n ```\n \n-aand it hangs - even tough the network is OK.\n+and it hangs - even tough the network is OK.\n Also reported [on sage-devel](https://groups.google.com/g/sage-devel/c/emnDzvu5vR4) with Arch Linux.\n \n A straight `./sage --pip install jupyter_jsmol` is almost instant success.\n``````\n",
    "created_at": "2022-08-25T17:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677109",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,7 +29,7 @@
 ...
 ```
 
-aand it hangs - even tough the network is OK.
+and it hangs - even tough the network is OK.
 Also reported [on sage-devel](https://groups.google.com/g/sage-devel/c/emnDzvu5vR4) with Arch Linux.
 
 A straight `./sage --pip install jupyter_jsmol` is almost instant success.
``````




---

archive/issue_events_108723.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-29T11:24:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34421#event-108723"
}
```



---

archive/issue_comments_677110.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-29T11:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677110",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_677111.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/fix_timeout_in_jupyter_jsmol_installation\" to \"6fb910f7e50e4c5f1ff1142cbff30043d10db239\"",
    "created_at": "2022-08-29T11:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34421#issuecomment-677111",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/fix_timeout_in_jupyter_jsmol_installation" to "6fb910f7e50e4c5f1ff1142cbff30043d10db239"
