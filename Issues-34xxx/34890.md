# Issue 34890: SCIPBackend: Faster copy, remove_constraint methods

archive/issues_034653.json:
```json
{
    "assignees": [],
    "body": "(from [#21003 comment:142](https://github.com/sagemath/sage/issues/21003#comment:142))\n\nDepends on #21003\n\nCC:  @mantepse\n\nBranch/Commit: **[u/mkoeppe/scipbackend__faster_copy_method](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/scipbackend__faster_copy_method) @ [5e6ad56](https://github.com/sagemath/sagetrac-mirror/commit/5e6ad5605b292b5977c50cf33fd664e905511931)**\n\nReviewer: **Martin Rubey, ...**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34890_\n\n",
    "created_at": "2023-01-03T21:27:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20programming",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "SCIPBackend: Faster copy, remove_constraint methods",
    "type": "issue",
    "updated_at": "2023-01-05T19:52:09Z",
    "url": "https://github.com/sagemath/sage/issues/34890",
    "user": "https://github.com/mkoeppe"
}
```
(from [#21003 comment:142](https://github.com/sagemath/sage/issues/21003#comment:142))

Depends on #21003

CC:  @mantepse

Branch/Commit: **[u/mkoeppe/scipbackend__faster_copy_method](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/scipbackend__faster_copy_method) @ [5e6ad56](https://github.com/sagemath/sagetrac-mirror/commit/5e6ad5605b292b5977c50cf33fd664e905511931)**

Reviewer: **Martin Rubey, ...**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/34890_





---

archive/issue_events_456227.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-03T21:27:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456227"
}
```



---

archive/issue_events_456228.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-03T21:27:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20programming",
    "label_color": "0000ff",
    "label_name": "component: linear programming",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456228"
}
```



---

archive/issue_events_456229.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-03T21:27:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456229"
}
```



---

archive/issue_events_456230.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-03T21:27:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456230"
}
```



---

archive/issue_comments_565131.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+(from [#21003 comment:142](https://github.com/sagemath/sage/issues/21003#comment:142))\n``````\n",
    "created_at": "2023-01-03T23:18:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565131",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+(from [#21003 comment:142](https://github.com/sagemath/sage/issues/21003#comment:142))
``````




---

archive/issue_comments_565132.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2023-01-03T23:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565132",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_565133.json:
```json
{
    "body": "Branch: **[u/mkoeppe/scipbackend__faster_copy_method](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/scipbackend__faster_copy_method)**",
    "created_at": "2023-01-04T00:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565133",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/scipbackend__faster_copy_method](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/scipbackend__faster_copy_method)**



---

archive/issue_comments_565134.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b33be2612efe5ea5118cefa3e04c3d74766a6ca0\">b33be26</a></td><td><code>src/sage/graphs/graph_decompositions/vertex_separation.pyx: Factor out _vertex_separation_MILP_formulation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4104322c5a99e4180444e71c705d1c99b379586d\">4104322</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Store pyscipopt variables by index</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe72aa5b094e22ba699f3492f8367bd9a93cbf1a\">fe72aa5</a></td><td><code>src/sage/graphs/graph_decompositions/vertex_separation.pyx: Add pyscipopt test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6242d23733b285b74030400e8f210d67a4c1644\">b6242d2</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Mark sage.doctest: optional - pyscipopt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b19413f24c152afb52469871df0abca6d7c9a8f\">7b19413</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Fix docstring blocks, break some long lines</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01d4cdc3cb057a9f06ab869945b0a14c6b149572\">01d4cdc</a></td><td><code>Merge tag '9.8.beta6' into t/21003/pyscipopt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2040546c48830f892056475f32ec6a1aa5afe90c\">2040546</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Fix copying variable types</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/099c15ba7adede06fa50d7c09baa87c31b25725a\">099c15b</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Cache constraints to avoid expensive calls to getConss</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48cf10490a3b45021d37a3b4aeedb9a9080d4eb7\">48cf104</a></td><td><code>Merge #21003</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/953198edc1e256698068cbc8e63c9d6f973abe31\">953198e</a></td><td><code>SCIPBackend.__copy__: Use Model(sourceModel=...) for copying</code></td></tr></table>\n",
    "created_at": "2023-01-04T00:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565134",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'>Comment 4:</a>
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b33be2612efe5ea5118cefa3e04c3d74766a6ca0">b33be26</a></td><td><code>src/sage/graphs/graph_decompositions/vertex_separation.pyx: Factor out _vertex_separation_MILP_formulation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4104322c5a99e4180444e71c705d1c99b379586d">4104322</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Store pyscipopt variables by index</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe72aa5b094e22ba699f3492f8367bd9a93cbf1a">fe72aa5</a></td><td><code>src/sage/graphs/graph_decompositions/vertex_separation.pyx: Add pyscipopt test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6242d23733b285b74030400e8f210d67a4c1644">b6242d2</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Mark sage.doctest: optional - pyscipopt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b19413f24c152afb52469871df0abca6d7c9a8f">7b19413</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Fix docstring blocks, break some long lines</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01d4cdc3cb057a9f06ab869945b0a14c6b149572">01d4cdc</a></td><td><code>Merge tag '9.8.beta6' into t/21003/pyscipopt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2040546c48830f892056475f32ec6a1aa5afe90c">2040546</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Fix copying variable types</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/099c15ba7adede06fa50d7c09baa87c31b25725a">099c15b</a></td><td><code>src/sage/numerical/backends/scip_backend.pyx: Cache constraints to avoid expensive calls to getConss</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48cf10490a3b45021d37a3b4aeedb9a9080d4eb7">48cf104</a></td><td><code>Merge #21003</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/953198edc1e256698068cbc8e63c9d6f973abe31">953198e</a></td><td><code>SCIPBackend.__copy__: Use Model(sourceModel=...) for copying</code></td></tr></table>




---

archive/issue_events_456231.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-04T00:08:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456231"
}
```



---

archive/issue_comments_565135.json:
```json
{
    "body": "Commit: **[953198e](https://github.com/sagemath/sagetrac-mirror/commit/953198edc1e256698068cbc8e63c9d6f973abe31)**",
    "created_at": "2023-01-04T00:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565135",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[953198e](https://github.com/sagemath/sagetrac-mirror/commit/953198edc1e256698068cbc8e63c9d6f973abe31)**



---

archive/issue_comments_565136.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nJust 1 commit on top of #21003",
    "created_at": "2023-01-04T00:08:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565136",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>Comment 5:</a>
Just 1 commit on top of #21003



---

archive/issue_events_456232.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-04T00:51:22Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "title_is": "SCIPBackend: Faster copy, remove_constraint methods",
    "title_was": "SCIPBackend: Faster copy method",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456232"
}
```



---

archive/issue_events_456233.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-04T00:51:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456233"
}
```



---

archive/issue_events_456234.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-04T00:51:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456234"
}
```



---

archive/issue_comments_565137.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89e5778d3925db21fd7176d5aa6c334f5aa70b04\">89e5778</a></td><td><code>GenericBackend.remove_constraints: Fix handling of int</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38a33e0c91374b121567da228e7cde424148f992\">38a33e0</a></td><td><code>SCIPBackend.nrows: Use model.getNConss if constraints are not cached</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81ea51ce8ca5724631801133549d02b77aa99dc4\">81ea51c</a></td><td><code>SCIPBackend.remove_constraints: New, override generic implementation</code></td></tr></table>\n",
    "created_at": "2023-01-04T00:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565137",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89e5778d3925db21fd7176d5aa6c334f5aa70b04">89e5778</a></td><td><code>GenericBackend.remove_constraints: Fix handling of int</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38a33e0c91374b121567da228e7cde424148f992">38a33e0</a></td><td><code>SCIPBackend.nrows: Use model.getNConss if constraints are not cached</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81ea51ce8ca5724631801133549d02b77aa99dc4">81ea51c</a></td><td><code>SCIPBackend.remove_constraints: New, override generic implementation</code></td></tr></table>




---

archive/issue_comments_565138.json:
```json
{
    "body": "Changed commit from **[953198e](https://github.com/sagemath/sagetrac-mirror/commit/953198edc1e256698068cbc8e63c9d6f973abe31)** to **[81ea51c](https://github.com/sagemath/sagetrac-mirror/commit/81ea51ce8ca5724631801133549d02b77aa99dc4)**",
    "created_at": "2023-01-04T00:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565138",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[953198e](https://github.com/sagemath/sagetrac-mirror/commit/953198edc1e256698068cbc8e63c9d6f973abe31)** to **[81ea51c](https://github.com/sagemath/sagetrac-mirror/commit/81ea51ce8ca5724631801133549d02b77aa99dc4)**



---

archive/issue_events_456235.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-04T01:01:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456235"
}
```



---

archive/issue_events_456236.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-04T01:01:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34890#event-456236"
}
```



---

archive/issue_comments_565139.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nWhen creating a constraint, then copying the MILP, and then adding the constraint to the copied MILP, I sometimes get errors as follows:\n\n```\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 1956, in _find_counter_example\n        solution = next(bmilp.solutions_iterator(on_blocks, tmp_constraints))\n      File \"/home/martin/sage-develop/src/sage/combinat/bijectionist.py\", line 2676, in solutions_iterator\n        bmilp.add_constraint(constraint, return_indices=True)\n      File \"sage/numerical/mip.pyx\", line 2199, in sage.numerical.mip.MixedIntegerLinearProgram.add_constraint\n        new_indices = self.add_constraint(lhs-rhs, max=0,\n      File \"sage/numerical/mip.pyx\", line 2175, in sage.numerical.mip.MixedIntegerLinearProgram.add_constraint\n        self._backend.add_linear_constraint(constraint.items(), min, max, name)\n      File \"sage/numerical/backends/scip_backend.pyx\", line 410, in sage.numerical.backends.scip_backend.SCIPBackend.add_linear_constraint\n        linfun = quicksum([v * mvars[c] for c, v in coefficients])\n    IndexError: list index out of range\n```\n\nMaybe something like `copy_for_mip` is needed also for constraints?",
    "created_at": "2023-01-04T01:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565139",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:9'>Comment 9:</a>
When creating a constraint, then copying the MILP, and then adding the constraint to the copied MILP, I sometimes get errors as follows:

```
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 1956, in _find_counter_example
        solution = next(bmilp.solutions_iterator(on_blocks, tmp_constraints))
      File "/home/martin/sage-develop/src/sage/combinat/bijectionist.py", line 2676, in solutions_iterator
        bmilp.add_constraint(constraint, return_indices=True)
      File "sage/numerical/mip.pyx", line 2199, in sage.numerical.mip.MixedIntegerLinearProgram.add_constraint
        new_indices = self.add_constraint(lhs-rhs, max=0,
      File "sage/numerical/mip.pyx", line 2175, in sage.numerical.mip.MixedIntegerLinearProgram.add_constraint
        self._backend.add_linear_constraint(constraint.items(), min, max, name)
      File "sage/numerical/backends/scip_backend.pyx", line 410, in sage.numerical.backends.scip_backend.SCIPBackend.add_linear_constraint
        linfun = quicksum([v * mvars[c] for c, v in coefficients])
    IndexError: list index out of range
```

Maybe something like `copy_for_mip` is needed also for constraints?



---

archive/issue_comments_565140.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nare you passing `tmp_constraints` coming from one MIP to another?",
    "created_at": "2023-01-04T01:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565140",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>Comment 10:</a>
are you passing `tmp_constraints` coming from one MIP to another?



---

archive/issue_comments_565141.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nyes, as I wrote.",
    "created_at": "2023-01-04T01:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565141",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:11'>Comment 11:</a>
yes, as I wrote.



---

archive/issue_comments_565142.json:
```json
{
    "body": "Changed commit from **[81ea51c](https://github.com/sagemath/sagetrac-mirror/commit/81ea51ce8ca5724631801133549d02b77aa99dc4)** to **[5e6ad56](https://github.com/sagemath/sagetrac-mirror/commit/5e6ad5605b292b5977c50cf33fd664e905511931)**",
    "created_at": "2023-01-04T01:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565142",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[81ea51c](https://github.com/sagemath/sagetrac-mirror/commit/81ea51ce8ca5724631801133549d02b77aa99dc4)** to **[5e6ad56](https://github.com/sagemath/sagetrac-mirror/commit/5e6ad5605b292b5977c50cf33fd664e905511931)**



---

archive/issue_comments_565143.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e6ad5605b292b5977c50cf33fd664e905511931\">5e6ad56</a></td><td><code>SCIPBackend.__copy__: Use origcopy=True</code></td></tr></table>\n",
    "created_at": "2023-01-04T01:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565143",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e6ad5605b292b5977c50cf33fd664e905511931">5e6ad56</a></td><td><code>SCIPBackend.__copy__: Use origcopy=True</code></td></tr></table>




---

archive/issue_comments_565144.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nPlease check if this fixes it",
    "created_at": "2023-01-04T01:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565144",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'>Comment 13:</a>
Please check if this fixes it



---

archive/issue_comments_565145.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nYes, this makes it look good.",
    "created_at": "2023-01-04T01:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565145",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:14'>Comment 14:</a>
Yes, this makes it look good.



---

archive/issue_comments_565146.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThanks for testing!",
    "created_at": "2023-01-04T01:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565146",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>Comment 15:</a>
Thanks for testing!



---

archive/issue_comments_565147.json:
```json
{
    "body": "Reviewer: **Martin Rubey, ...**",
    "created_at": "2023-01-04T16:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565147",
    "user": "https://github.com/mantepse"
}
```

Reviewer: **Martin Rubey, ...**



---

archive/issue_comments_565148.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nI think I should mention that copying is still a bit slower than adding and removing constraints, apparently, no matter whether I use SCIP or GLPK.  \n\nHowever, it seems that this is only relevant for extremely small problems, usually almost all time is spent in the solver itself.  \n\nRunning all tests with SCIP without copying takes about 4.2 seconds, with copying it is about 4.9 seconds.  Including the long tests, I get about 56 seconds either way.\n\n(GLPK: with and without copying 2.4 seconds, including long tests 73 seconds)\n\nBesides, it might make sense to have a method `add_constraints`, analogous to `remove_constraints`, this would save another 2 lines of code :-)",
    "created_at": "2023-01-05T12:03:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565148",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:17'>Comment 17:</a>
I think I should mention that copying is still a bit slower than adding and removing constraints, apparently, no matter whether I use SCIP or GLPK.  

However, it seems that this is only relevant for extremely small problems, usually almost all time is spent in the solver itself.  

Running all tests with SCIP without copying takes about 4.2 seconds, with copying it is about 4.9 seconds.  Including the long tests, I get about 56 seconds either way.

(GLPK: with and without copying 2.4 seconds, including long tests 73 seconds)

Besides, it might make sense to have a method `add_constraints`, analogous to `remove_constraints`, this would save another 2 lines of code :-)



---

archive/issue_comments_565149.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nThanks for these benchmarks with #33238. These timings suggest that we have been successful in removing the artificial slowdowns in `remove_constraints`.\n\nNot sure about `add_constraints`. As `add_constraint` already accepts vector-valued constraints (via `LinearTensor`, `LinearTensorConstraint`), perhaps it could just be generalized to also accept lists in such places.",
    "created_at": "2023-01-05T18:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565149",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'>Comment 18:</a>
Thanks for these benchmarks with #33238. These timings suggest that we have been successful in removing the artificial slowdowns in `remove_constraints`.

Not sure about `add_constraints`. As `add_constraint` already accepts vector-valued constraints (via `LinearTensor`, `LinearTensorConstraint`), perhaps it could just be generalized to also accept lists in such places.



---

archive/issue_comments_565150.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nIs there any real difference between vector valued constraints and lists of constraints?",
    "created_at": "2023-01-05T19:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565150",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:19'>Comment 19:</a>
Is there any real difference between vector valued constraints and lists of constraints?



---

archive/issue_comments_565151.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nNo. In the end, everything is a matrix",
    "created_at": "2023-01-05T19:25:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565151",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>Comment 20:</a>
No. In the end, everything is a matrix



---

archive/issue_comments_565152.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nOK.  In any case, it is confusing that we have two methods for removing constraints but only one to add constraints.",
    "created_at": "2023-01-05T19:33:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565152",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:21'>Comment 21:</a>
OK.  In any case, it is confusing that we have two methods for removing constraints but only one to add constraints.



---

archive/issue_comments_565153.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nWe could introduce `add_constraints` as an alias of `add_constraint` after extending the accepted inputs as per [comment:18](#comment%3A18)",
    "created_at": "2023-01-05T19:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
We could introduce `add_constraints` as an alias of `add_constraint` after extending the accepted inputs as per [comment:18](#comment%3A18)



---

archive/issue_comments_565154.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI guess, for `remove_constraints` you have done this already?",
    "created_at": "2023-01-05T19:48:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565154",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:23'>Comment 23:</a>
I guess, for `remove_constraints` you have done this already?



---

archive/issue_comments_565155.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nNo, here on the ticket this is a fix for the backend method `remove_constraints`.",
    "created_at": "2023-01-05T19:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565155",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
No, here on the ticket this is a fix for the backend method `remove_constraints`.



---

archive/issue_comments_565156.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nI've opened #34896 for these changes to the frontend",
    "created_at": "2023-01-05T19:52:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34890#issuecomment-565156",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'>Comment 25:</a>
I've opened #34896 for these changes to the frontend
