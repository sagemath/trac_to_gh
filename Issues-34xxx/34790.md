# Issue 34790: padic height calculations assume minimal equations

archive/issues_034553.json:
```json
{
    "body": "[This mathoverflow question](https://mathoverflow.net/questions/433762/does-the-p-adic-regulator-depend-on-weierstrass-model) and [this asksage question](https://ask.sagemath.org/question/64632/p-adic-regulator-on-different-weierstrass-models/) raise an issue with p-adic heights. The algorithm currently assumes silently that the equation is minimal.\n\nHere is the incorrect results pointed out in the questions. The regulator must be independent of the model used:\n\n```\nsage: E = EllipticCurve([-1728,-100656])\nsage: E.padic_regulator(7)\n3*7 + 3*7^2 + 4*7^3 + 3*7^4 + 5*7^6 + 7^8 + 3*7^9 + 5*7^11 + 7^12 + 2*7^13 + 3*7^15 + 3*7^16 + 4*7^17 + 6*7^18 + 5*7^19 + O(7^20)\nsage: Emin = E.global_minimal_model()\nsage: Emin.padic_regulator(7)\n2*7^2 + 5*7^3 + 7^4 + 5*7^5 + 3*7^6 + 5*7^7 + 7^8 + 5*7^9 + 5*7^10 + 6*7^11 + 3*7^12 + 5*7^13 + 7^14 + 6*7^15 + 4*7^16 + 3*7^17 + 5*7^18 + 6*7^19 + O(7^20)\n```\n\nThe problem is that the algorithm needs the points on which it evaluates the p-adic height to have good reduction in the model it works with.\n\nOne solution would be to raise a `NotImplementedError`. \n\nBut better, especially if one wants to generalise this to number fields where elliptic curve do not have minimal models, one should find the correct multiple to use.\n\n**Branch:** [u/wuthrich/trac34790](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/trac34790)\n\n**Commit:** [a12a6d0657db7969e5b8fc744da69282aa8851c5](https://github.com/sagemath/sagetrac-mirror/commit/a12a6d0657db7969e5b8fc744da69282aa8851c5)\n\n**Author:** Chris Wuthrich\n\nIssue created by migration from https://trac.sagemath.org/ticket/34790\n\n",
    "created_at": "2022-11-25T12:41:55Z",
    "labels": [
        "component: elliptic curves",
        "bug",
        "needs review"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "padic height calculations assume minimal equations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34790",
    "user": "https://github.com/categorie"
}
```
[This mathoverflow question](https://mathoverflow.net/questions/433762/does-the-p-adic-regulator-depend-on-weierstrass-model) and [this asksage question](https://ask.sagemath.org/question/64632/p-adic-regulator-on-different-weierstrass-models/) raise an issue with p-adic heights. The algorithm currently assumes silently that the equation is minimal.

Here is the incorrect results pointed out in the questions. The regulator must be independent of the model used:

```
sage: E = EllipticCurve([-1728,-100656])
sage: E.padic_regulator(7)
3*7 + 3*7^2 + 4*7^3 + 3*7^4 + 5*7^6 + 7^8 + 3*7^9 + 5*7^11 + 7^12 + 2*7^13 + 3*7^15 + 3*7^16 + 4*7^17 + 6*7^18 + 5*7^19 + O(7^20)
sage: Emin = E.global_minimal_model()
sage: Emin.padic_regulator(7)
2*7^2 + 5*7^3 + 7^4 + 5*7^5 + 3*7^6 + 5*7^7 + 7^8 + 5*7^9 + 5*7^10 + 6*7^11 + 3*7^12 + 5*7^13 + 7^14 + 6*7^15 + 4*7^16 + 3*7^17 + 5*7^18 + 6*7^19 + O(7^20)
```

The problem is that the algorithm needs the points on which it evaluates the p-adic height to have good reduction in the model it works with.

One solution would be to raise a `NotImplementedError`. 

But better, especially if one wants to generalise this to number fields where elliptic curve do not have minimal models, one should find the correct multiple to use.

**Branch:** [u/wuthrich/trac34790](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/trac34790)

**Commit:** [a12a6d0657db7969e5b8fc744da69282aa8851c5](https://github.com/sagemath/sagetrac-mirror/commit/a12a6d0657db7969e5b8fc744da69282aa8851c5)

**Author:** Chris Wuthrich

Issue created by migration from https://trac.sagemath.org/ticket/34790





---

archive/issue_comments_565070.json:
```json
{
    "body": "<a id='comment:1'></a>\nI have tried it on a number of random curves; it looks like it works now.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0503d68fee4f5c1f57c676760acb2982d108504e\">0503d68</a></td><td><code>trac 34790: added function for finding correct multiple</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4669e8fcb1235e030fbe49acd53a5b733b07ed23\">4669e8f</a></td><td><code>trac 34790: integrate it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a12a6d0657db7969e5b8fc744da69282aa8851c5\">a12a6d0</a></td><td><code>trac 34790: docstrings</code></td></tr></table>\n",
    "created_at": "2022-11-25T19:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34790#issuecomment-565070",
    "user": "https://github.com/categorie"
}
```

<a id='comment:1'></a>
I have tried it on a number of random curves; it looks like it works now.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0503d68fee4f5c1f57c676760acb2982d108504e">0503d68</a></td><td><code>trac 34790: added function for finding correct multiple</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4669e8fcb1235e030fbe49acd53a5b733b07ed23">4669e8f</a></td><td><code>trac 34790: integrate it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a12a6d0657db7969e5b8fc744da69282aa8851c5">a12a6d0</a></td><td><code>trac 34790: docstrings</code></td></tr></table>




---

archive/issue_comments_565071.json:
```json
{
    "body": "**Branch:** [u/wuthrich/trac34790](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/trac34790)",
    "created_at": "2022-11-25T19:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34790#issuecomment-565071",
    "user": "https://github.com/categorie"
}
```

**Branch:** [u/wuthrich/trac34790](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/trac34790)



---

archive/issue_comments_565072.json:
```json
{
    "body": "**Commit:** [a12a6d0657db7969e5b8fc744da69282aa8851c5](https://github.com/sagemath/sagetrac-mirror/commit/a12a6d0657db7969e5b8fc744da69282aa8851c5)",
    "created_at": "2022-11-25T19:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34790#issuecomment-565072",
    "user": "https://github.com/categorie"
}
```

**Commit:** [a12a6d0657db7969e5b8fc744da69282aa8851c5](https://github.com/sagemath/sagetrac-mirror/commit/a12a6d0657db7969e5b8fc744da69282aa8851c5)



---

archive/issue_events_312855.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2022-11-25T19:08:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34790",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34790#event-312855"
}
```



---

archive/issue_comments_565073.json:
```json
{
    "body": "**Author:** Chris Wuthrich",
    "created_at": "2022-11-25T19:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34790#issuecomment-565073",
    "user": "https://github.com/categorie"
}
```

**Author:** Chris Wuthrich
