# Issue 34391: Upgrade: GAP 4.12

archive/issues_034154.json:
```json
{
    "assignees": [],
    "body": "GAP 4.12.1 fixes critical bugs in 4.12.0\n\n[GAP 4.12.1 release page](https://www.gap-system.org/Releases/4.12.1.html)\n\n\nGAP 4.12.0 was released in August 2022.\n\n- [GAP 4.12.0 release announcement](https://lists.uni-kl.de/gap/arc/forum/2022-08/msg00031.html)\n- [GAP 4.12.0 release page](https://www.gap-system.org/Releases/4.12.0.html)\n- [GAP 4.12.0: changes since GAP 4.11.1](https://github.com/gap-system/gap/blob/master/CHANGES.md#gap-4120-august-2022)\n\nWe should upgrade our corresponding spkgs:\n\n- gap\n- gap_packages\n- libsemigroups\n\nPrevious upgrades:\n\n- #31498: GAP 4.11.1\n- #29314: GAP 4.11, libsemigroup 1.0.9\n\nCC:  @antonio-rojas @dimpase @slel @tornaria @kiwifb @collares @tscrim\n\nKeywords: **spkg, upgrade, gap, libsemigroups**\n\nBranch/Commit: **[u/dimpase/packages/gap/4_12_2](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_2) @ [058c1f3](https://github.com/sagemath/sagetrac-mirror/commit/058c1f33908afadefa79a926db41b1a0ca4a2f0d)**\n\nUpstream: **Completely fixed; Fix reported upstream**\n\nReviewer: **Dima Pasechnik, Antonio Rojas, Mauricio Collares**\n\nAuthor: **Antonio Rojas, Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34391_\n\n",
    "created_at": "2022-08-20T05:46:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade: GAP 4.12",
    "type": "issue",
    "updated_at": "2023-01-09T21:12:39Z",
    "url": "https://github.com/sagemath/sage/issues/34391",
    "user": "https://github.com/slel"
}
```
GAP 4.12.1 fixes critical bugs in 4.12.0

[GAP 4.12.1 release page](https://www.gap-system.org/Releases/4.12.1.html)


GAP 4.12.0 was released in August 2022.

- [GAP 4.12.0 release announcement](https://lists.uni-kl.de/gap/arc/forum/2022-08/msg00031.html)
- [GAP 4.12.0 release page](https://www.gap-system.org/Releases/4.12.0.html)
- [GAP 4.12.0: changes since GAP 4.11.1](https://github.com/gap-system/gap/blob/master/CHANGES.md#gap-4120-august-2022)

We should upgrade our corresponding spkgs:

- gap
- gap_packages
- libsemigroups

Previous upgrades:

- #31498: GAP 4.11.1
- #29314: GAP 4.11, libsemigroup 1.0.9

CC:  @antonio-rojas @dimpase @slel @tornaria @kiwifb @collares @tscrim

Keywords: **spkg, upgrade, gap, libsemigroups**

Branch/Commit: **[u/dimpase/packages/gap/4_12_2](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_2) @ [058c1f3](https://github.com/sagemath/sagetrac-mirror/commit/058c1f33908afadefa79a926db41b1a0ca4a2f0d)**

Upstream: **Completely fixed; Fix reported upstream**

Reviewer: **Dima Pasechnik, Antonio Rojas, Mauricio Collares**

Author: **Antonio Rojas, Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/34391_





---

archive/issue_events_451569.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-08-20T05:46:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451569"
}
```



---

archive/issue_events_451570.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-08-20T05:46:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451570"
}
```



---

archive/issue_events_451571.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-08-20T05:46:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451571"
}
```



---

archive/issue_events_451572.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-08-20T05:46:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451572"
}
```



---

archive/issue_comments_558555.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nHaving upgraded downstream, here is a list of issues:\n\n1) Build fails because a garbage collector needs to be specified via a preprocessor macro when using gap's headers. This is included in the CPPFLAGS in gap's own `sysinfo.gap`, but Sage doesn't read it when building.\n\n2) Build fails due to API changes in `OpenOutputStream` and `CloseOutput`\n\n3) Colored prompt is on by default, which breaks the pexpect interface.\n\n4) The `NaturalHomomorphism` function, used in `groups.abelian_gps.abelian_group_gap`, has been removed.\n\n5) The functions `IsPrimitive` and `IsTransitive` changed behavior and now return false if the group does not act on the given set, breaking some tests:\n\n```\nFile \"/usr/lib/python3.10/site-packages/sage/groups/perm_gps/permgroup.py\", line 4363, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.is_transitive\nFailed example:\n    G.is_transitive([1,4,5])\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/groups/perm_gps/permgroup.py\", line 4428, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.is_primitive\nFailed example:\n    G.is_primitive([1,2,3])\nExpected:\n    True\nGot:\n    False\n```\n\n6) Computation of permutation group generators has changed, breaking some tests. In particular, using `algorithm=smaller` now does not make any difference in many examples.\n\n7) Several trivial test failures due to different choice of generators or minor syntax changes.",
    "created_at": "2022-08-29T21:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558555",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:2" align="right">Comment 2</div>

Having upgraded downstream, here is a list of issues:

1) Build fails because a garbage collector needs to be specified via a preprocessor macro when using gap's headers. This is included in the CPPFLAGS in gap's own `sysinfo.gap`, but Sage doesn't read it when building.

2) Build fails due to API changes in `OpenOutputStream` and `CloseOutput`

3) Colored prompt is on by default, which breaks the pexpect interface.

4) The `NaturalHomomorphism` function, used in `groups.abelian_gps.abelian_group_gap`, has been removed.

5) The functions `IsPrimitive` and `IsTransitive` changed behavior and now return false if the group does not act on the given set, breaking some tests:

```
File "/usr/lib/python3.10/site-packages/sage/groups/perm_gps/permgroup.py", line 4363, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.is_transitive
Failed example:
    G.is_transitive([1,4,5])
Expected:
    True
Got:
    False
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/groups/perm_gps/permgroup.py", line 4428, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.is_primitive
Failed example:
    G.is_primitive([1,2,3])
Expected:
    True
Got:
    False
```

6) Computation of permutation group generators has changed, breaking some tests. In particular, using `algorithm=smaller` now does not make any difference in many examples.

7) Several trivial test failures due to different choice of generators or minor syntax changes.



---

archive/issue_comments_558556.json:
```json
{
    "body": "Branch: **[u/arojas/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/upgrade__gap_4_12)**",
    "created_at": "2022-08-29T21:19:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558556",
    "user": "https://github.com/antonio-rojas"
}
```

Branch: **[u/arojas/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/upgrade__gap_4_12)**



---

archive/issue_comments_558557.json:
```json
{
    "body": "Commit: **[bc40764](https://github.com/sagemath/sagetrac-mirror/commit/bc40764be044653e06f2da3497e1e05da08251f7)**",
    "created_at": "2022-08-29T21:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558557",
    "user": "https://github.com/antonio-rojas"
}
```

Commit: **[bc40764](https://github.com/sagemath/sagetrac-mirror/commit/bc40764be044653e06f2da3497e1e05da08251f7)**



---

archive/issue_comments_558558.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThe branch fixes (2), (3), (4) and (7). For (5), we need to decide whether we want to follow the new behavior in GAP, or reimplement the old behavior in some other way. For (6), some tests need to be updated or removed.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aeff992d53a65a705dca5cd5216bcb97c218dce7\">aeff992</a></td><td><code>Adapt to API changes in OpenOutputStream and CloseOutput</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3367b4290981e5e93b7a30c48b02f1ae3770dc8\">c3367b4</a></td><td><code>Disable colored prompt as it breaks the pexpect interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b63e998e4d6118fc86b13b940c8f3d3b8307a50\">3b63e99</a></td><td><code>Port NaturalHomomorphism uses</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc40764be044653e06f2da3497e1e05da08251f7\">bc40764</a></td><td><code>Fix tests with GAP 4.12</code></td></tr></table>\n",
    "created_at": "2022-08-29T21:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558558",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:4" align="right">Comment 4</div>

The branch fixes (2), (3), (4) and (7). For (5), we need to decide whether we want to follow the new behavior in GAP, or reimplement the old behavior in some other way. For (6), some tests need to be updated or removed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aeff992d53a65a705dca5cd5216bcb97c218dce7">aeff992</a></td><td><code>Adapt to API changes in OpenOutputStream and CloseOutput</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3367b4290981e5e93b7a30c48b02f1ae3770dc8">c3367b4</a></td><td><code>Disable colored prompt as it breaks the pexpect interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b63e998e4d6118fc86b13b940c8f3d3b8307a50">3b63e99</a></td><td><code>Port NaturalHomomorphism uses</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc40764be044653e06f2da3497e1e05da08251f7">bc40764</a></td><td><code>Fix tests with GAP 4.12</code></td></tr></table>




---

archive/issue_comments_558559.json:
```json
{
    "body": "Author: **Antonio Rojas, ...**",
    "created_at": "2022-08-29T21:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558559",
    "user": "https://github.com/antonio-rojas"
}
```

Author: **Antonio Rojas, ...**



---

archive/issue_comments_558560.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nregarding (5), I don't think we need to reimplement, as `transitive` and `primitive` are dealing with group *action* on a domain, and are not defined, mathematically, for arbitrary subsets of the domain.\n(perhaps we should have a deprecation, in case False is returned, printing a warning about the change in behavior) \n\nHow about (1) - should `spkg-install` source `sysinfo.gap` ?",
    "created_at": "2022-08-30T08:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558560",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">Comment 6</div>

regarding (5), I don't think we need to reimplement, as `transitive` and `primitive` are dealing with group *action* on a domain, and are not defined, mathematically, for arbitrary subsets of the domain.
(perhaps we should have a deprecation, in case False is returned, printing a warning about the change in behavior) 

How about (1) - should `spkg-install` source `sysinfo.gap` ?



---

archive/issue_comments_558561.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@dimpase](#comment%3A6):\n> regarding (5), I don't think we need to reimplement, as `transitive` and `primitive` are dealing with group *action* on a domain, and are not defined, mathematically, for arbitrary subsets of the domain.\n> \n> How about (1) - should `spkg-install` source `sysinfo.gap` ?\n\nI think that is fine for gap packages but not for downstream packages. I guess it is a stop gap, but a standard way of setting the flags should be provided. A .pc file or at least a config utility. You shouldn't have to search for settings in an obscure internal file. This is a genuine upstream defect in my opinion.",
    "created_at": "2022-08-30T08:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558561",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@dimpase](#comment%3A6):
> regarding (5), I don't think we need to reimplement, as `transitive` and `primitive` are dealing with group *action* on a domain, and are not defined, mathematically, for arbitrary subsets of the domain.
> 
> How about (1) - should `spkg-install` source `sysinfo.gap` ?

I think that is fine for gap packages but not for downstream packages. I guess it is a stop gap, but a standard way of setting the flags should be provided. A .pc file or at least a config utility. You shouldn't have to search for settings in an obscure internal file. This is a genuine upstream defect in my opinion.



---

archive/issue_comments_558562.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBy the way, `sysinfo.gap` is not in the tarball, it is generated by doing `make sysinfo.gap`, so this should be easy to incorporate. But it has `GAP_CPPFLAGS` rather than `CPPFLAGS`, at least on an install I'm trying this.\n\nSo this looks that our build somehow manages to avoid running `make sysinfo.gap`.",
    "created_at": "2022-08-30T09:04:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558562",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">Comment 8</div>

By the way, `sysinfo.gap` is not in the tarball, it is generated by doing `make sysinfo.gap`, so this should be easy to incorporate. But it has `GAP_CPPFLAGS` rather than `CPPFLAGS`, at least on an install I'm trying this.

So this looks that our build somehow manages to avoid running `make sysinfo.gap`.



---

archive/issue_events_451573.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451573"
}
```



---

archive/issue_events_451574.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451574"
}
```



---

archive/issue_comments_558563.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nI am seeing a bunch of segfaults on aarch64 with GAP 4.12.0 and this branch. The following patch, which copies the output string before calling `GAP_Leave`, seems to fix almost all of the segfaults, but not 100% of them (see https://github.com/NixOS/nixpkgs/pull/192548#issuecomment-1256686607 for more details):\n\n```diff\ndiff --git a/src/sage/libs/gap/element.pxd b/src/sage/libs/gap/element.pxd\nindex a1bf8118d4..9a28de87ca 100644\n--- a/src/sage/libs/gap/element.pxd\n+++ b/src/sage/libs/gap/element.pxd\n@@ -29,9 +29,9 @@ cdef GapElement_Boolean make_GapElement_Boolean(parent, Obj obj)\n cdef GapElement_Function make_GapElement_Function(parent, Obj obj)\n cdef GapElement_Permutation make_GapElement_Permutation(parent, Obj obj)\n \n-cdef char *capture_stdout(Obj, Obj)\n-cdef char *gap_element_str(Obj)\n-cdef char *gap_element_repr(Obj)\n+cdef str capture_stdout(Obj, Obj)\n+cdef str gap_element_str(Obj)\n+cdef str gap_element_repr(Obj)\n \n \n cdef class GapElement(RingElement):\ndiff --git a/src/sage/libs/gap/element.pyx b/src/sage/libs/gap/element.pyx\nindex e2681165a2..482f74bbcf 100644\n--- a/src/sage/libs/gap/element.pyx\n+++ b/src/sage/libs/gap/element.pyx\n@@ -120,7 +120,7 @@ cdef Obj make_gap_matrix(sage_list, gap_ring) except NULL:\n     return l.value\n \n \n-cdef char *capture_stdout(Obj func, Obj obj):\n+cdef str capture_stdout(Obj func, Obj obj):\n     \"\"\"\n     Call a single-argument GAP function ``func`` with the argument ``obj``\n     and return the stdout from that function call.\n@@ -152,12 +152,12 @@ cdef char *capture_stdout(Obj func, Obj obj):\n \n         CALL_1ARGS(func, obj)\n         CloseOutput(&output)\n-        return CSTR_STRING(s)\n+        return char_to_str(CSTR_STRING(s))\n     finally:\n         GAP_Leave()\n \n \n-cdef char *gap_element_repr(Obj obj):\n+cdef str gap_element_repr(Obj obj):\n     \"\"\"\n     Implement ``repr()`` of ``GapElement``s using the ``ViewObj()`` function,\n     which is by default closest to what you get when displaying an object in\n@@ -169,7 +169,7 @@ cdef char *gap_element_repr(Obj obj):\n     return capture_stdout(func, obj)\n \n \n-cdef char *gap_element_str(Obj obj):\n+cdef str gap_element_str(Obj obj):\n     \"\"\"\n     Implement ``str()`` of ``GapElement``s using the ``Print()`` function.\n \n@@ -761,7 +761,7 @@ cdef class GapElement(RingElement):\n         if  self.value == NULL:\n             return 'NULL'\n \n-        s = char_to_str(gap_element_str(self.value))\n+        s = gap_element_str(self.value)\n         return s.strip()\n \n     def _repr_(self):\n@@ -783,7 +783,7 @@ cdef class GapElement(RingElement):\n         if  self.value == NULL:\n             return 'NULL'\n \n-        s = char_to_str(gap_element_repr(self.value))\n+        s = gap_element_repr(self.value)\n         return s.strip()\n \n     cpdef _set_compare_by_id(self):\n```",
    "created_at": "2022-09-23T21:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558563",
    "user": "https://github.com/collares"
}
```

<div id="comment:11" align="right">Comment 11</div>

I am seeing a bunch of segfaults on aarch64 with GAP 4.12.0 and this branch. The following patch, which copies the output string before calling `GAP_Leave`, seems to fix almost all of the segfaults, but not 100% of them (see https://github.com/NixOS/nixpkgs/pull/192548#issuecomment-1256686607 for more details):

```diff
diff --git a/src/sage/libs/gap/element.pxd b/src/sage/libs/gap/element.pxd
index a1bf8118d4..9a28de87ca 100644
--- a/src/sage/libs/gap/element.pxd
+++ b/src/sage/libs/gap/element.pxd
@@ -29,9 +29,9 @@ cdef GapElement_Boolean make_GapElement_Boolean(parent, Obj obj)
 cdef GapElement_Function make_GapElement_Function(parent, Obj obj)
 cdef GapElement_Permutation make_GapElement_Permutation(parent, Obj obj)
 
-cdef char *capture_stdout(Obj, Obj)
-cdef char *gap_element_str(Obj)
-cdef char *gap_element_repr(Obj)
+cdef str capture_stdout(Obj, Obj)
+cdef str gap_element_str(Obj)
+cdef str gap_element_repr(Obj)
 
 
 cdef class GapElement(RingElement):
diff --git a/src/sage/libs/gap/element.pyx b/src/sage/libs/gap/element.pyx
index e2681165a2..482f74bbcf 100644
--- a/src/sage/libs/gap/element.pyx
+++ b/src/sage/libs/gap/element.pyx
@@ -120,7 +120,7 @@ cdef Obj make_gap_matrix(sage_list, gap_ring) except NULL:
     return l.value
 
 
-cdef char *capture_stdout(Obj func, Obj obj):
+cdef str capture_stdout(Obj func, Obj obj):
     """
     Call a single-argument GAP function ``func`` with the argument ``obj``
     and return the stdout from that function call.
@@ -152,12 +152,12 @@ cdef char *capture_stdout(Obj func, Obj obj):
 
         CALL_1ARGS(func, obj)
         CloseOutput(&output)
-        return CSTR_STRING(s)
+        return char_to_str(CSTR_STRING(s))
     finally:
         GAP_Leave()
 
 
-cdef char *gap_element_repr(Obj obj):
+cdef str gap_element_repr(Obj obj):
     """
     Implement ``repr()`` of ``GapElement``s using the ``ViewObj()`` function,
     which is by default closest to what you get when displaying an object in
@@ -169,7 +169,7 @@ cdef char *gap_element_repr(Obj obj):
     return capture_stdout(func, obj)
 
 
-cdef char *gap_element_str(Obj obj):
+cdef str gap_element_str(Obj obj):
     """
     Implement ``str()`` of ``GapElement``s using the ``Print()`` function.
 
@@ -761,7 +761,7 @@ cdef class GapElement(RingElement):
         if  self.value == NULL:
             return 'NULL'
 
-        s = char_to_str(gap_element_str(self.value))
+        s = gap_element_str(self.value)
         return s.strip()
 
     def _repr_(self):
@@ -783,7 +783,7 @@ cdef class GapElement(RingElement):
         if  self.value == NULL:
             return 'NULL'
 
-        s = char_to_str(gap_element_repr(self.value))
+        s = gap_element_repr(self.value)
         return s.strip()
 
     cpdef _set_compare_by_id(self):
```



---

archive/issue_comments_558564.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI think the other segfaults happen because `gap_element_repr` and `gap_element_str` (the two `capture_stdout` callers) call `GAP_ValueGlobalVariable` but don't use `GAP_Enter`/`GAP_Leave`. \n\nAs a proof of concept, I applied the above patch but also moved the try/GAP_Enter/finally/GAP_Leave block from `capture_stdout` to `gap_element_repr`/`gap_element_str` ([patch](https://github.com/NixOS/nixpkgs/blob/66f857c7c10e24e95fc429fd3c6ebd5676e29b61/pkgs/applications/science/math/sage/patches/copy-string-before-gap-leave.patch)), and I didn't see a single crash in two test runs (it used to happen every time).",
    "created_at": "2022-09-23T23:13:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558564",
    "user": "https://github.com/collares"
}
```

<div id="comment:12" align="right">Comment 12</div>

I think the other segfaults happen because `gap_element_repr` and `gap_element_str` (the two `capture_stdout` callers) call `GAP_ValueGlobalVariable` but don't use `GAP_Enter`/`GAP_Leave`. 

As a proof of concept, I applied the above patch but also moved the try/GAP_Enter/finally/GAP_Leave block from `capture_stdout` to `gap_element_repr`/`gap_element_str` ([patch](https://github.com/NixOS/nixpkgs/blob/66f857c7c10e24e95fc429fd3c6ebd5676e29b61/pkgs/applications/science/math/sage/patches/copy-string-before-gap-leave.patch)), and I didn't see a single crash in two test runs (it used to happen every time).



---

archive/issue_comments_558565.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [Mauricio Collares](#comment%3A12):\n> I think the other segfaults happen because `gap_element_repr` and `gap_element_str` (the two `capture_stdout` callers) call `GAP_ValueGlobalVariable` but don't use `GAP_Enter`/`GAP_Leave`. \n> \n> As a proof of concept, I applied the above patch but also moved the try/GAP_Enter/finally/GAP_Leave block from `capture_stdout` to `gap_element_repr`/`gap_element_str` ([patch](https://github.com/NixOS/nixpkgs/blob/66f857c7c10e24e95fc429fd3c6ebd5676e29b61/pkgs/applications/science/math/sage/patches/copy-string-before-gap-leave.patch)), and I didn't see a single crash in two test runs (it used to happen every time).\n\nFeel free to push your changes, I can only test on x86_64 where I haven't seen any such issue so far.",
    "created_at": "2022-09-30T16:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558565",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [Mauricio Collares](#comment%3A12):
> I think the other segfaults happen because `gap_element_repr` and `gap_element_str` (the two `capture_stdout` callers) call `GAP_ValueGlobalVariable` but don't use `GAP_Enter`/`GAP_Leave`. 
> 
> As a proof of concept, I applied the above patch but also moved the try/GAP_Enter/finally/GAP_Leave block from `capture_stdout` to `gap_element_repr`/`gap_element_str` ([patch](https://github.com/NixOS/nixpkgs/blob/66f857c7c10e24e95fc429fd3c6ebd5676e29b61/pkgs/applications/science/math/sage/patches/copy-string-before-gap-leave.patch)), and I didn't see a single crash in two test runs (it used to happen every time).

Feel free to push your changes, I can only test on x86_64 where I haven't seen any such issue so far.



---

archive/issue_comments_558566.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbc902a79ff9ec01d4d4eb9a767a1c661fb5dda7\">cbc902a</a></td><td><code>Adapt test to new is_transitive and is_primitive behavior</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80dd6b338236f170efca1fc3545df18ce8d8795c\">80dd6b3</a></td><td><code>Mark test as random. With gap 4.12 on x86_64 it is no longer 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6c293d67cfcdf8fba7bc6aa7899e2086d42cc7e\">a6c293d</a></td><td><code>Remove test that is now redundant, all seeds give the same answer</code></td></tr></table>\n",
    "created_at": "2022-09-30T17:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558566",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14" align="right">Comment 14</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbc902a79ff9ec01d4d4eb9a767a1c661fb5dda7">cbc902a</a></td><td><code>Adapt test to new is_transitive and is_primitive behavior</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80dd6b338236f170efca1fc3545df18ce8d8795c">80dd6b3</a></td><td><code>Mark test as random. With gap 4.12 on x86_64 it is no longer 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6c293d67cfcdf8fba7bc6aa7899e2086d42cc7e">a6c293d</a></td><td><code>Remove test that is now redundant, all seeds give the same answer</code></td></tr></table>




---

archive/issue_comments_558567.json:
```json
{
    "body": "Changed commit from **[bc40764](https://github.com/sagemath/sagetrac-mirror/commit/bc40764be044653e06f2da3497e1e05da08251f7)** to **[a6c293d](https://github.com/sagemath/sagetrac-mirror/commit/a6c293d67cfcdf8fba7bc6aa7899e2086d42cc7e)**",
    "created_at": "2022-09-30T17:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558567",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bc40764](https://github.com/sagemath/sagetrac-mirror/commit/bc40764be044653e06f2da3497e1e05da08251f7)** to **[a6c293d](https://github.com/sagemath/sagetrac-mirror/commit/a6c293d67cfcdf8fba7bc6aa7899e2086d42cc7e)**



---

archive/issue_comments_558568.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nI have tested the last commmit (a6c293d) using system gap 4.12.0, on x86_64, x86_64-musl and i686 (void linux) with all long tests passing.\n\nI don't have aarch64 to test.",
    "created_at": "2022-10-17T04:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558568",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:15" align="right">Comment 15</div>

I have tested the last commmit (a6c293d) using system gap 4.12.0, on x86_64, x86_64-musl and i686 (void linux) with all long tests passing.

I don't have aarch64 to test.



---

archive/issue_comments_558569.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nthis branch should bump up the version of GAP, etc",
    "created_at": "2022-10-17T12:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558569",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">Comment 16</div>

this branch should bump up the version of GAP, etc



---

archive/issue_comments_558570.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\n\n```diff\ndiff --git a/build/pkgs/gap/checksums.ini b/build/pkgs/gap/checksums.ini\nindex 066e943308..7f083710ca 100644\n--- a/build/pkgs/gap/checksums.ini\n+++ b/build/pkgs/gap/checksums.ini\n@@ -1,5 +1,5 @@\n tarball=gap-VERSION.tar.gz\n-sha1=4ecdd281b8f430282fb9b12690b06e0a26abde10\n-md5=85dc9e459d5b6c66fcad9f468afd3e3e\n-cksum=1351843158\n+sha1=b8b2d803c43dc6ea4413b5a378689a2087c3658a\n+md5=6772845916c31de880792c7bb1672f81\n+cksum=3760719912\n upstream_url=https://github.com/gap-system/gap/releases/download/vVERSION/gap-VERSION.tar.gz\ndiff --git a/build/pkgs/gap/package-version.txt b/build/pkgs/gap/package-version.txt\nindex d782fca8f6..815588ef14 100644\n--- a/build/pkgs/gap/package-version.txt\n+++ b/build/pkgs/gap/package-version.txt\n@@ -1 +1 @@\n-4.11.1\n+4.12.0\n```",
    "created_at": "2022-10-17T12:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558570",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">Comment 17</div>


```diff
diff --git a/build/pkgs/gap/checksums.ini b/build/pkgs/gap/checksums.ini
index 066e943308..7f083710ca 100644
--- a/build/pkgs/gap/checksums.ini
+++ b/build/pkgs/gap/checksums.ini
@@ -1,5 +1,5 @@
 tarball=gap-VERSION.tar.gz
-sha1=4ecdd281b8f430282fb9b12690b06e0a26abde10
-md5=85dc9e459d5b6c66fcad9f468afd3e3e
-cksum=1351843158
+sha1=b8b2d803c43dc6ea4413b5a378689a2087c3658a
+md5=6772845916c31de880792c7bb1672f81
+cksum=3760719912
 upstream_url=https://github.com/gap-system/gap/releases/download/vVERSION/gap-VERSION.tar.gz
diff --git a/build/pkgs/gap/package-version.txt b/build/pkgs/gap/package-version.txt
index d782fca8f6..815588ef14 100644
--- a/build/pkgs/gap/package-version.txt
+++ b/build/pkgs/gap/package-version.txt
@@ -1 +1 @@
-4.11.1
+4.12.0
```



---

archive/issue_comments_558571.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nWe should wait for 4.12.1 which will include a fix for issue (1) and additional fixes for `make install` so we can switch `spkg-install` to use it.",
    "created_at": "2022-10-17T12:59:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558571",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:18" align="right">Comment 18</div>

We should wait for 4.12.1 which will include a fix for issue (1) and additional fixes for `make install` so we can switch `spkg-install` to use it.



---

archive/issue_comments_558572.json:
```json
{
    "body": "Changed commit from **[a6c293d](https://github.com/sagemath/sagetrac-mirror/commit/a6c293d67cfcdf8fba7bc6aa7899e2086d42cc7e)** to **[09f4df2](https://github.com/sagemath/sagetrac-mirror/commit/09f4df238c9bd74f47e12775a712ba26c4f386bb)**",
    "created_at": "2022-10-17T14:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558572",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[a6c293d](https://github.com/sagemath/sagetrac-mirror/commit/a6c293d67cfcdf8fba7bc6aa7899e2086d42cc7e)** to **[09f4df2](https://github.com/sagemath/sagetrac-mirror/commit/09f4df238c9bd74f47e12775a712ba26c4f386bb)**



---

archive/issue_comments_558573.json:
```json
{
    "body": "Changed branch from **[u/arojas/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/upgrade__gap_4_12)** to **[u/dimpase/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/upgrade__gap_4_12)**",
    "created_at": "2022-10-17T14:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558573",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/arojas/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/upgrade__gap_4_12)** to **[u/dimpase/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/upgrade__gap_4_12)**



---

archive/issue_comments_558574.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nmeanwhile, rebased over the latest beta, and all the fixes for spkg-install needed so far.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f3b4556db746e6354d55d42eba5925be19a6cad\">6f3b455</a></td><td><code>Adapt to API changes in OpenOutputStream and CloseOutput</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31aaa12fe42e1bcf7d2f69ae431be8bff70c52a7\">31aaa12</a></td><td><code>Disable colored prompt as it breaks the pexpect interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9da7900e6714d3f6ec66fd69de9532f95045750\">d9da790</a></td><td><code>Port NaturalHomomorphism uses</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86a34a0314022ab1f22d7215c2def9c4d4daed5d\">86a34a0</a></td><td><code>Fix tests with GAP 4.12</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b8283fef303e41e54fe02009b2c648e0bf606fb\">3b8283f</a></td><td><code>Adapt test to new is_transitive and is_primitive behavior</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/754b7b15df2eb8a9a68fb4a1fd0b8160af2a7e0a\">754b7b1</a></td><td><code>Mark test as random. With gap 4.12 on x86_64 it is no longer 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e3e8da1c4dfa6980cd36e6bf2260e5df02d8d78\">6e3e8da</a></td><td><code>Remove test that is now redundant, all seeds give the same answer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09f4df238c9bd74f47e12775a712ba26c4f386bb\">09f4df2</a></td><td><code>install gap 4.12.0</code></td></tr></table>\n",
    "created_at": "2022-10-17T14:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558574",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">Comment 19</div>

meanwhile, rebased over the latest beta, and all the fixes for spkg-install needed so far.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f3b4556db746e6354d55d42eba5925be19a6cad">6f3b455</a></td><td><code>Adapt to API changes in OpenOutputStream and CloseOutput</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31aaa12fe42e1bcf7d2f69ae431be8bff70c52a7">31aaa12</a></td><td><code>Disable colored prompt as it breaks the pexpect interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9da7900e6714d3f6ec66fd69de9532f95045750">d9da790</a></td><td><code>Port NaturalHomomorphism uses</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86a34a0314022ab1f22d7215c2def9c4d4daed5d">86a34a0</a></td><td><code>Fix tests with GAP 4.12</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b8283fef303e41e54fe02009b2c648e0bf606fb">3b8283f</a></td><td><code>Adapt test to new is_transitive and is_primitive behavior</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/754b7b15df2eb8a9a68fb4a1fd0b8160af2a7e0a">754b7b1</a></td><td><code>Mark test as random. With gap 4.12 on x86_64 it is no longer 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e3e8da1c4dfa6980cd36e6bf2260e5df02d8d78">6e3e8da</a></td><td><code>Remove test that is now redundant, all seeds give the same answer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09f4df238c9bd74f47e12775a712ba26c4f386bb">09f4df2</a></td><td><code>install gap 4.12.0</code></td></tr></table>




---

archive/issue_comments_558575.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nrunning tests on Apple M1 (aka aarch64).",
    "created_at": "2022-10-17T14:38:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558575",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">Comment 20</div>

running tests on Apple M1 (aka aarch64).



---

archive/issue_comments_558576.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI'm getting\n\n```\n    In file included from sage/coding/codecan/codecan.c:5227:\n    /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/include/gap/gasman_intern.h:17:2: error: #error This file must only be included if GASMAN is used\n       17 | #error This file must only be included if GASMAN is used\n```\nwhat's the fix here?",
    "created_at": "2022-10-17T15:21:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558576",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">Comment 21</div>

I'm getting

```
    In file included from sage/coding/codecan/codecan.c:5227:
    /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/include/gap/gasman_intern.h:17:2: error: #error This file must only be included if GASMAN is used
       17 | #error This file must only be included if GASMAN is used
```
what's the fix here?



---

archive/issue_comments_558577.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nThat's precisely issue (1). Fixed upstream in https://github.com/gap-system/gap/commit/276eb56919400aab91f9e00abb94ddc41a0ffabc",
    "created_at": "2022-10-17T15:26:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558577",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:22" align="right">Comment 22</div>

That's precisely issue (1). Fixed upstream in https://github.com/gap-system/gap/commit/276eb56919400aab91f9e00abb94ddc41a0ffabc



---

archive/issue_comments_558578.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nOK, one needs to patch GAP, as in https://patch-diff.githubusercontent.com/raw/gap-system/gap/pull/5077.diff",
    "created_at": "2022-10-17T15:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558578",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">Comment 23</div>

OK, one needs to patch GAP, as in https://patch-diff.githubusercontent.com/raw/gap-system/gap/pull/5077.diff



---

archive/issue_comments_558579.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a0f6e97874f328964c7a3679b8d66704e3d01b8\">5a0f6e9</a></td><td><code>add GAP upstream PR 5077</code></td></tr></table>\n",
    "created_at": "2022-10-17T16:10:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558579",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24" align="right">Comment 24</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a0f6e97874f328964c7a3679b8d66704e3d01b8">5a0f6e9</a></td><td><code>add GAP upstream PR 5077</code></td></tr></table>




---

archive/issue_comments_558580.json:
```json
{
    "body": "Changed commit from **[09f4df2](https://github.com/sagemath/sagetrac-mirror/commit/09f4df238c9bd74f47e12775a712ba26c4f386bb)** to **[5a0f6e9](https://github.com/sagemath/sagetrac-mirror/commit/5a0f6e97874f328964c7a3679b8d66704e3d01b8)**",
    "created_at": "2022-10-17T16:10:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558580",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[09f4df2](https://github.com/sagemath/sagetrac-mirror/commit/09f4df238c9bd74f47e12775a712ba26c4f386bb)** to **[5a0f6e9](https://github.com/sagemath/sagetrac-mirror/commit/5a0f6e97874f328964c7a3679b8d66704e3d01b8)**



---

archive/issue_comments_558581.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nwe also need to upgrade libsemigroups, and gap_packages. I'm doing this now.",
    "created_at": "2022-10-17T16:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558581",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">Comment 25</div>

we also need to upgrade libsemigroups, and gap_packages. I'm doing this now.



---

archive/issue_comments_558582.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5cfe77230b019d4d51236e977f1c89ab3d34cd00\">5cfe772</a></td><td><code>upgrade libsemigroup and gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61025c0a05e84b33b4f0151ba4895430a63f4f7b\">61025c0</a></td><td><code>Merge branch 'u/dimpase/upgrade__gap_4_12' of trac.sagemath.org:sage into u/dimpase/upgrade__gap_4_12</code></td></tr></table>\n",
    "created_at": "2022-10-17T20:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558582",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26" align="right">Comment 26</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5cfe77230b019d4d51236e977f1c89ab3d34cd00">5cfe772</a></td><td><code>upgrade libsemigroup and gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61025c0a05e84b33b4f0151ba4895430a63f4f7b">61025c0</a></td><td><code>Merge branch 'u/dimpase/upgrade__gap_4_12' of trac.sagemath.org:sage into u/dimpase/upgrade__gap_4_12</code></td></tr></table>




---

archive/issue_comments_558583.json:
```json
{
    "body": "Changed commit from **[5a0f6e9](https://github.com/sagemath/sagetrac-mirror/commit/5a0f6e97874f328964c7a3679b8d66704e3d01b8)** to **[61025c0](https://github.com/sagemath/sagetrac-mirror/commit/61025c0a05e84b33b4f0151ba4895430a63f4f7b)**",
    "created_at": "2022-10-17T20:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558583",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5a0f6e9](https://github.com/sagemath/sagetrac-mirror/commit/5a0f6e97874f328964c7a3679b8d66704e3d01b8)** to **[61025c0](https://github.com/sagemath/sagetrac-mirror/commit/61025c0a05e84b33b4f0151ba4895430a63f4f7b)**



---

archive/issue_comments_558584.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nnot yet done, as local/share/gap/sysinfo.gap needed a manual addition of \n`-I$SAGE_LOCAL/include/gap` to `GAC_CFLAGS`.",
    "created_at": "2022-10-17T20:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558584",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">Comment 27</div>

not yet done, as local/share/gap/sysinfo.gap needed a manual addition of 
`-I$SAGE_LOCAL/include/gap` to `GAC_CFLAGS`.



---

archive/issue_comments_558585.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e3f54b25d15223fb94e2b38c46cb5e790dfff0c\">2e3f54b</a></td><td><code>also, fix the package names etc</code></td></tr></table>\n",
    "created_at": "2022-10-17T20:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558585",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28" align="right">Comment 28</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e3f54b25d15223fb94e2b38c46cb5e790dfff0c">2e3f54b</a></td><td><code>also, fix the package names etc</code></td></tr></table>




---

archive/issue_comments_558586.json:
```json
{
    "body": "Changed commit from **[61025c0](https://github.com/sagemath/sagetrac-mirror/commit/61025c0a05e84b33b4f0151ba4895430a63f4f7b)** to **[2e3f54b](https://github.com/sagemath/sagetrac-mirror/commit/2e3f54b25d15223fb94e2b38c46cb5e790dfff0c)**",
    "created_at": "2022-10-17T20:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558586",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[61025c0](https://github.com/sagemath/sagetrac-mirror/commit/61025c0a05e84b33b4f0151ba4895430a63f4f7b)** to **[2e3f54b](https://github.com/sagemath/sagetrac-mirror/commit/2e3f54b25d15223fb94e2b38c46cb5e790dfff0c)**



---

archive/issue_comments_558587.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nThere are also failing doctests in `sage/algebras/quantum_groups/quantum_group_gap.py`, like this:\n\n```\nsage -t --warn-long 37.8 --random-seed=5244030565037623767917974460011040182 src/sage/algebras/quantum_groups/quantum_group_gap.py\n**********************************************************************\nFile \"src/sage/algebras/quantum_groups/quantum_group_gap.py\", line 1812, in sage.algebras.quantum_groups.quantum_group_gap.TensorProductOfHighestWeightModules.__init__\nFailed example:\n    TestSuite(T).run()  # optional - gap_packages\nExpected nothing\nGot:\n    doctest:warning\n      File \"/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/src/bin/sage-runtests\", line 154, in <module>\n        err = DC.run()\n... \n    DeprecationWarning: implementations of Modules().TensorProducts() now must define the method tensor_factors\n```",
    "created_at": "2022-10-17T21:19:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558587",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">Comment 29</div>

There are also failing doctests in `sage/algebras/quantum_groups/quantum_group_gap.py`, like this:

```
sage -t --warn-long 37.8 --random-seed=5244030565037623767917974460011040182 src/sage/algebras/quantum_groups/quantum_group_gap.py
**********************************************************************
File "src/sage/algebras/quantum_groups/quantum_group_gap.py", line 1812, in sage.algebras.quantum_groups.quantum_group_gap.TensorProductOfHighestWeightModules.__init__
Failed example:
    TestSuite(T).run()  # optional - gap_packages
Expected nothing
Got:
    doctest:warning
      File "/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/src/bin/sage-runtests", line 154, in <module>
        err = DC.run()
... 
    DeprecationWarning: implementations of Modules().TensorProducts() now must define the method tensor_factors
```



---

archive/issue_comments_558588.json:
```json
{
    "body": "Changed author from **Antonio Rojas, ...** to **Antonio Rojas, Dima Pasechnik**",
    "created_at": "2022-10-17T21:22:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558588",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Antonio Rojas, ...** to **Antonio Rojas, Dima Pasechnik**



---

archive/issue_comments_558589.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nPerhaps Travis can fix these missing methods `tensor_factors`  in `sage/algebras/quantum_groups/quantum_group_gap.py`, so that there won't be a need to patch these doctests.",
    "created_at": "2022-10-17T21:22:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558589",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">Comment 30</div>

Perhaps Travis can fix these missing methods `tensor_factors`  in `sage/algebras/quantum_groups/quantum_group_gap.py`, so that there won't be a need to patch these doctests.



---

archive/issue_comments_558590.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nsee #34635",
    "created_at": "2022-10-17T21:23:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558590",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">Comment 31</div>

see #34635



---

archive/issue_comments_558591.json:
```json
{
    "body": "Work Issues: **simplify spkg-install to use GAP make install to $prefix**",
    "created_at": "2022-10-19T14:41:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558591",
    "user": "https://github.com/dimpase"
}
```

Work Issues: **simplify spkg-install to use GAP make install to $prefix**



---

archive/issue_comments_558592.json:
```json
{
    "body": "wip on simplifying spkg-install",
    "created_at": "2022-10-19T14:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558592",
    "user": "https://github.com/dimpase"
}
```

wip on simplifying spkg-install



---

archive/issue_comments_558593.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nAttachment: **[s.patch.gz](https://github.com/sagemath/sage/files/ticket34391/s.patch.gz)**\n\nwith this, and https://github.com/gap-system/gap/pull/5091 it mostly works (package installation is broken though) We'll wait for 4.12.1, where also needed package upgrades are done.",
    "created_at": "2022-10-19T14:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558593",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">Comment 33</div>

Attachment: **[s.patch.gz](https://github.com/sagemath/sage/files/ticket34391/s.patch.gz)**

with this, and https://github.com/gap-system/gap/pull/5091 it mostly works (package installation is broken though) We'll wait for 4.12.1, where also needed package upgrades are done.



---

archive/issue_comments_558594.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nIn case it's useful, here are the patches I had to use for gap 4.12.0 on void linux:\n\nhttps://github.com/void-linux/void-packages/tree/ed7862591d1ff3a617b58ecbe2efdbb5343d508b/srcpkgs/gap/patches\n\nI think two of those are PR 5077 and PR 5091 already mentioned in this ticket. The third patch I needed to fix something in atlasrep package.\n\nNote also that:\na. package names have changed (at least the name of the directories changed case and removed version numbers)\nb. `sysinfo.gap` used to be installed in `/usr/share/gap` and now is installed in `/usr/lib/gap`.\n\nSagemath (9.7 and 9.8.beta2) is working fine with this, but note I only install the minimal set of packages that are standard in sage.",
    "created_at": "2022-10-19T15:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558594",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:34" align="right">Comment 34</div>

In case it's useful, here are the patches I had to use for gap 4.12.0 on void linux:

https://github.com/void-linux/void-packages/tree/ed7862591d1ff3a617b58ecbe2efdbb5343d508b/srcpkgs/gap/patches

I think two of those are PR 5077 and PR 5091 already mentioned in this ticket. The third patch I needed to fix something in atlasrep package.

Note also that:
a. package names have changed (at least the name of the directories changed case and removed version numbers)
b. `sysinfo.gap` used to be installed in `/usr/share/gap` and now is installed in `/usr/lib/gap`.

Sagemath (9.7 and 9.8.beta2) is working fine with this, but note I only install the minimal set of packages that are standard in sage.



---

archive/issue_comments_558595.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nThe atlasrep issue is https://github.com/gap-system/gap/issues/5015 and will also be fixed in GAP 4.12.1.",
    "created_at": "2022-10-19T15:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558595",
    "user": "https://github.com/collares"
}
```

<div id="comment:35" align="right">Comment 35</div>

The atlasrep issue is https://github.com/gap-system/gap/issues/5015 and will also be fixed in GAP 4.12.1.



---

archive/issue_comments_558596.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nReplying to [Gonzalo Tornar\u00eda](#comment%3A34):\n> In case it's useful, here are the patches I had to use for gap 4.12.0 on void linux:\n> \n> https://github.com/void-linux/void-packages/tree/ed7862591d1ff3a617b58ecbe2efdbb5343d508b/srcpkgs/gap/patches\n> \n> I think two of those are PR 5077 and PR 5091 already mentioned in this ticket. The third patch I needed to fix something in atlasrep package.\n> \n> Note also that:\n> a. package names have changed (at least the name of the directories changed case and removed version numbers)\n> b. `sysinfo.gap` used to be installed in `/usr/share/gap` and now is installed in `/usr/lib/gap`.\n\nFor Sage's installed GAP, this will be `$SAGE_LOCAL/lib/gap/`\n\n\n> \n> Sagemath (9.7 and 9.8.beta2) is working fine with this, but note I only install the minimal set of packages that are standard in sage.\n\nTry packages which build executables and/or GAP kernel extensions (the latter need `gac`)\nE.g. `grape` and `crypting`.",
    "created_at": "2022-10-19T16:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558596",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">Comment 36</div>

Replying to [Gonzalo Tornara](#comment%3A34):
> In case it's useful, here are the patches I had to use for gap 4.12.0 on void linux:
> 
> https://github.com/void-linux/void-packages/tree/ed7862591d1ff3a617b58ecbe2efdbb5343d508b/srcpkgs/gap/patches
> 
> I think two of those are PR 5077 and PR 5091 already mentioned in this ticket. The third patch I needed to fix something in atlasrep package.
> 
> Note also that:
> a. package names have changed (at least the name of the directories changed case and removed version numbers)
> b. `sysinfo.gap` used to be installed in `/usr/share/gap` and now is installed in `/usr/lib/gap`.

For Sage's installed GAP, this will be `$SAGE_LOCAL/lib/gap/`


> 
> Sagemath (9.7 and 9.8.beta2) is working fine with this, but note I only install the minimal set of packages that are standard in sage.

Try packages which build executables and/or GAP kernel extensions (the latter need `gac`)
E.g. `grape` and `crypting`.



---

archive/issue_comments_558597.json:
```json
{
    "body": "Changed commit from **[2e3f54b](https://github.com/sagemath/sagetrac-mirror/commit/2e3f54b25d15223fb94e2b38c46cb5e790dfff0c)** to **[d0a9b21](https://github.com/sagemath/sagetrac-mirror/commit/d0a9b213cdaa51afae123940be69fc525b1249d0)**",
    "created_at": "2022-10-21T09:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558597",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[2e3f54b](https://github.com/sagemath/sagetrac-mirror/commit/2e3f54b25d15223fb94e2b38c46cb5e790dfff0c)** to **[d0a9b21](https://github.com/sagemath/sagetrac-mirror/commit/d0a9b213cdaa51afae123940be69fc525b1249d0)**



---

archive/issue_comments_558598.json:
```json
{
    "body": "Changed branch from **[u/dimpase/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/upgrade__gap_4_12)** to **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)**",
    "created_at": "2022-10-21T09:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558598",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/dimpase/upgrade__gap_4_12](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/upgrade__gap_4_12)** to **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)**



---

archive/issue_comments_558599.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nupdate tp 4.12.1\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d503bc81ce1bea49da933bca7085b44965d0d6ff\">d503bc8</a></td><td><code>add GAP upstream PR 5077</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/894a89f4f9f2faf666fa10d6c23093947b103918\">894a89f</a></td><td><code>also, fix the package names etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0a9b213cdaa51afae123940be69fc525b1249d0\">d0a9b21</a></td><td><code>update GAP to 4.12.1</code></td></tr></table>\n",
    "created_at": "2022-10-21T09:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558599",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:37" align="right">Comment 37</div>

update tp 4.12.1

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d503bc81ce1bea49da933bca7085b44965d0d6ff">d503bc8</a></td><td><code>add GAP upstream PR 5077</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/894a89f4f9f2faf666fa10d6c23093947b103918">894a89f</a></td><td><code>also, fix the package names etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0a9b213cdaa51afae123940be69fc525b1249d0">d0a9b21</a></td><td><code>update GAP to 4.12.1</code></td></tr></table>




---

archive/issue_comments_558600.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nGAP package `liepring` now depends on a GAP package `singular`, so we should be installing it ahead of `liepring`.",
    "created_at": "2022-10-21T14:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558600",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">Comment 38</div>

GAP package `liepring` now depends on a GAP package `singular`, so we should be installing it ahead of `liepring`.



---

archive/issue_comments_558601.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02b6b4b039d86ef25ff29a599ef1a9cf26c84616\">02b6b4b</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr></table>\n",
    "created_at": "2022-10-21T14:33:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558601",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39" align="right">Comment 39</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02b6b4b039d86ef25ff29a599ef1a9cf26c84616">02b6b4b</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr></table>




---

archive/issue_comments_558602.json:
```json
{
    "body": "Changed commit from **[d0a9b21](https://github.com/sagemath/sagetrac-mirror/commit/d0a9b213cdaa51afae123940be69fc525b1249d0)** to **[02b6b4b](https://github.com/sagemath/sagetrac-mirror/commit/02b6b4b039d86ef25ff29a599ef1a9cf26c84616)**",
    "created_at": "2022-10-21T14:33:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558602",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d0a9b21](https://github.com/sagemath/sagetrac-mirror/commit/d0a9b213cdaa51afae123940be69fc525b1249d0)** to **[02b6b4b](https://github.com/sagemath/sagetrac-mirror/commit/02b6b4b039d86ef25ff29a599ef1a9cf26c84616)**



---

archive/issue_events_451575.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-10-21T14:59:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451575"
}
```



---

archive/issue_comments_558603.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nwhile more simplifications may be done on spkg-install files for `gap`, and `gap_packages`, this branch appears to work just fine.",
    "created_at": "2022-10-21T14:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558603",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">Comment 40</div>

while more simplifications may be done on spkg-install files for `gap`, and `gap_packages`, this branch appears to work just fine.



---

archive/issue_events_451576.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-10-21T17:52:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451576"
}
```



---

archive/issue_events_451577.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-10-21T17:52:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451577"
}
```



---

archive/issue_comments_558604.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\n`utils` and `autodoc` are now dependencies of `atlasrep` so they need to move from `gap_packages` to `gap`.",
    "created_at": "2022-10-21T17:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558604",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:41" align="right">Comment 41</div>

`utils` and `autodoc` are now dependencies of `atlasrep` so they need to move from `gap_packages` to `gap`.



---

archive/issue_comments_558605.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nMax Horn also pointed out that `radiroot` is now a dependency of `polenta`, one of the autoloaded packages. Also, although not strictly necessary, `atlasrep` uses `io` as the preferred method for fetching files over the network (but it will fall back to running wget if that's not available).",
    "created_at": "2022-10-21T18:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558605",
    "user": "https://github.com/collares"
}
```

<div id="comment:42" align="right">Comment 42</div>

Max Horn also pointed out that `radiroot` is now a dependency of `polenta`, one of the autoloaded packages. Also, although not strictly necessary, `atlasrep` uses `io` as the preferred method for fetching files over the network (but it will fall back to running wget if that's not available).



---

archive/issue_comments_558606.json:
```json
{
    "body": "Changed commit from **[02b6b4b](https://github.com/sagemath/sagetrac-mirror/commit/02b6b4b039d86ef25ff29a599ef1a9cf26c84616)** to **[eb8cd42](https://github.com/sagemath/sagetrac-mirror/commit/eb8cd42feb58963adba67599bf6e311e03424328)**",
    "created_at": "2022-10-23T19:03:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558606",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[02b6b4b](https://github.com/sagemath/sagetrac-mirror/commit/02b6b4b039d86ef25ff29a599ef1a9cf26c84616)** to **[eb8cd42](https://github.com/sagemath/sagetrac-mirror/commit/eb8cd42feb58963adba67599bf6e311e03424328)**



---

archive/issue_comments_558607.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84a527d823e5eea1f144f2a57fb79c15e771e03e\">84a527d</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb8cd42feb58963adba67599bf6e311e03424328\">eb8cd42</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr></table>\n",
    "created_at": "2022-10-23T19:03:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558607",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43" align="right">Comment 43</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84a527d823e5eea1f144f2a57fb79c15e771e03e">84a527d</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb8cd42feb58963adba67599bf6e311e03424328">eb8cd42</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr></table>




---

archive/issue_comments_558608.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\ndone what's requested in [comment:41](#comment%3A41) and [comment:42](#comment%3A42), please review.",
    "created_at": "2022-10-23T19:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558608",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:44" align="right">Comment 44</div>

done what's requested in [comment:41](#comment%3A41) and [comment:42](#comment%3A42), please review.



---

archive/issue_events_451578.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-10-23T19:04:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451578"
}
```



---

archive/issue_events_451579.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-10-23T19:04:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451579"
}
```



---

archive/issue_comments_558609.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReplying to [Antonio Rojas](#comment%3A13):\n> Feel free to push your changes, I can only test on x86_64 where I haven't seen any such issue so far.\n\nI think I will submit my changes in a separate ticket, since the present update seems ready and does not make things any worse on aarch64 as far as I can tell. What is the best way to submit a ticket/change which depends on an open one and touches the same lines of code? I think I will just branch off this one and mark the ticket as a dependency.\n\nEdit: Opened #34701, sorry for the noise!",
    "created_at": "2022-10-28T21:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558609",
    "user": "https://github.com/collares"
}
```

<div id="comment:45" align="right">Comment 45</div>

Replying to [Antonio Rojas](#comment%3A13):
> Feel free to push your changes, I can only test on x86_64 where I haven't seen any such issue so far.

I think I will submit my changes in a separate ticket, since the present update seems ready and does not make things any worse on aarch64 as far as I can tell. What is the best way to submit a ticket/change which depends on an open one and touches the same lines of code? I think I will just branch off this one and mark the ticket as a dependency.

Edit: Opened #34701, sorry for the noise!



---

archive/issue_comments_558610.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [Mauricio Collares](#comment%3A45):\n> What is the best way to submit a ticket/change which depends on an open one and touches the same lines of code? I think I will just branch off this one and mark the ticket as a dependency.\n\nyes, that's how this is normally done.",
    "created_at": "2022-10-28T22:25:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558610",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [Mauricio Collares](#comment%3A45):
> What is the best way to submit a ticket/change which depends on an open one and touches the same lines of code? I think I will just branch off this one and mark the ticket as a dependency.

yes, that's how this is normally done.



---

archive/issue_comments_558611.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nForwarding another suggestion from Max Horn (in https://github.com/NixOS/nixpkgs/pull/192548#discussion_r989552690): `config.h` is not meant to be installed anymore. The corresponding line in `spkg-install.in` can just be removed, I think.",
    "created_at": "2022-10-29T01:07:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558611",
    "user": "https://github.com/collares"
}
```

<div id="comment:47" align="right">Comment 47</div>

Forwarding another suggestion from Max Horn (in https://github.com/NixOS/nixpkgs/pull/192548#discussion_r989552690): `config.h` is not meant to be installed anymore. The corresponding line in `spkg-install.in` can just be removed, I think.



---

archive/issue_comments_558612.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nReplying to [Mauricio Collares](#comment%3A47):\n> Forwarding another suggestion from Max Horn (in https://github.com/NixOS/nixpkgs/pull/192548#discussion_r989552690): `config.h` is not meant to be installed anymore. The corresponding line in `spkg-install.in` can just be removed, I think.\n\nThis will solve itself once we switch to `make install`. Let's get this is as is and move that to a follow-up ticket (there are some non-trivial adjustments needed for `gap-packages`, and probably the `GAP_ROOT` variable should be rethought or removed completely)",
    "created_at": "2022-10-31T08:48:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558612",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:48" align="right">Comment 48</div>

Replying to [Mauricio Collares](#comment%3A47):
> Forwarding another suggestion from Max Horn (in https://github.com/NixOS/nixpkgs/pull/192548#discussion_r989552690): `config.h` is not meant to be installed anymore. The corresponding line in `spkg-install.in` can just be removed, I think.

This will solve itself once we switch to `make install`. Let's get this is as is and move that to a follow-up ticket (there are some non-trivial adjustments needed for `gap-packages`, and probably the `GAP_ROOT` variable should be rethought or removed completely)



---

archive/issue_comments_558613.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nIn #34711 we will switch to using GAP's `make install`. Meanwhile I'm giving this a positive review.",
    "created_at": "2022-10-31T15:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558613",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:49" align="right">Comment 49</div>

In #34711 we will switch to using GAP's `make install`. Meanwhile I'm giving this a positive review.



---

archive/issue_comments_558614.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik, Antonio Rojas, Mauricio Collares**",
    "created_at": "2022-10-31T15:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558614",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik, Antonio Rojas, Mauricio Collares**



---

archive/issue_events_451580.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-10-31T15:38:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451580"
}
```



---

archive/issue_events_451581.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-10-31T15:38:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451581"
}
```



---

archive/issue_events_451582.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-03T12:49:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451582"
}
```



---

archive/issue_events_451583.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-03T12:49:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451583"
}
```



---

archive/issue_comments_558615.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nI spoke too soon - tested with unclean SAGE_LOCAL :-(\n\nWith everything clean, while building `gap_packages`, I get\n\n```\ngcc -g -O2 -fPIC -MQ gen/src/crypting.o -MMD -MP -MF gen/src/crypting.d -g -O2 -Wno-implicit-function-declaration -Wno-implicit-function-declaration -o gen/src/crypting.o -I/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/build -I/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src -I/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap -DUSE_GASMAN=1 -c src/crypting.c\nIn file included from /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src/gap_all.h:51,\n                 from /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src/compiled.h:26,\n                 from src/crypting.c:5:\n/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src/modules.h:19:10: fatal error: version.h: No such file or directory\n   19 | #include \"version.h\"\n      |          ^~~~~~~~~~~\ncompilation terminated.\n```\nThe problem is that `version.h` gets installed into `SAGE_LOCAL/include/gap` - a location unknown to `crypting` package makefile.",
    "created_at": "2022-11-03T12:49:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558615",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:50" align="right">Comment 50</div>

I spoke too soon - tested with unclean SAGE_LOCAL :-(

With everything clean, while building `gap_packages`, I get

```
gcc -g -O2 -fPIC -MQ gen/src/crypting.o -MMD -MP -MF gen/src/crypting.d -g -O2 -Wno-implicit-function-declaration -Wno-implicit-function-declaration -o gen/src/crypting.o -I/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/build -I/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src -I/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap -DUSE_GASMAN=1 -c src/crypting.c
In file included from /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src/gap_all.h:51,
                 from /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src/compiled.h:26,
                 from src/crypting.c:5:
/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/share/gap/src/modules.h:19:10: fatal error: version.h: No such file or directory
   19 | #include "version.h"
      |          ^~~~~~~~~~~
compilation terminated.
```
The problem is that `version.h` gets installed into `SAGE_LOCAL/include/gap` - a location unknown to `crypting` package makefile.



---

archive/issue_comments_558616.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/061b6fb102d944bff6f94e2c5f37325dd78a847c\">061b6fb</a></td><td><code>Mark test as random. With gap 4.12 on x86_64 it is no longer 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5a44230494d67837d388b4aba6fd177e1ac3408\">a5a4423</a></td><td><code>Remove test that is now redundant, all seeds give the same answer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af5f91b7aa9973297ee821a03f28acda2e1ea131\">af5f91b</a></td><td><code>install gap 4.12.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46ef5f80fe9c9958005115182c1e55285ec04f1a\">46ef5f8</a></td><td><code>upgrade libsemigroup and gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d57f50284921a3640e1ee0d23ff617c6fd2ae023\">d57f502</a></td><td><code>add GAP upstream PR 5077</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34b03edf4caadd18a4bedebbd636aa84ae1b11d0\">34b03ed</a></td><td><code>also, fix the package names etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60ac4514b54cdfd4d4eb8bbe39587a8c3ca0a87a\">60ac451</a></td><td><code>update GAP to 4.12.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/412fec406eef21d610c26893ab8491f27ac78d27\">412fec4</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3ce16d5e6a92a523ba3f567835f1a76d922a699\">f3ce16d</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1e6e4316fe68e6d11bfe3565e75bd0e297642a0\">a1e6e43</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr></table>\n",
    "created_at": "2022-11-04T13:54:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558616",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51" align="right">Comment 51</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/061b6fb102d944bff6f94e2c5f37325dd78a847c">061b6fb</a></td><td><code>Mark test as random. With gap 4.12 on x86_64 it is no longer 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5a44230494d67837d388b4aba6fd177e1ac3408">a5a4423</a></td><td><code>Remove test that is now redundant, all seeds give the same answer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af5f91b7aa9973297ee821a03f28acda2e1ea131">af5f91b</a></td><td><code>install gap 4.12.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46ef5f80fe9c9958005115182c1e55285ec04f1a">46ef5f8</a></td><td><code>upgrade libsemigroup and gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d57f50284921a3640e1ee0d23ff617c6fd2ae023">d57f502</a></td><td><code>add GAP upstream PR 5077</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34b03edf4caadd18a4bedebbd636aa84ae1b11d0">34b03ed</a></td><td><code>also, fix the package names etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60ac4514b54cdfd4d4eb8bbe39587a8c3ca0a87a">60ac451</a></td><td><code>update GAP to 4.12.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/412fec406eef21d610c26893ab8491f27ac78d27">412fec4</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3ce16d5e6a92a523ba3f567835f1a76d922a699">f3ce16d</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1e6e4316fe68e6d11bfe3565e75bd0e297642a0">a1e6e43</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr></table>




---

archive/issue_comments_558617.json:
```json
{
    "body": "Changed commit from **[eb8cd42](https://github.com/sagemath/sagetrac-mirror/commit/eb8cd42feb58963adba67599bf6e311e03424328)** to **[a1e6e43](https://github.com/sagemath/sagetrac-mirror/commit/a1e6e4316fe68e6d11bfe3565e75bd0e297642a0)**",
    "created_at": "2022-11-04T13:54:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558617",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[eb8cd42](https://github.com/sagemath/sagetrac-mirror/commit/eb8cd42feb58963adba67599bf6e311e03424328)** to **[a1e6e43](https://github.com/sagemath/sagetrac-mirror/commit/a1e6e4316fe68e6d11bfe3565e75bd0e297642a0)**



---

archive/issue_comments_558618.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nrebased over latest beta, 9.8.beta3",
    "created_at": "2022-11-04T13:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558618",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">Comment 52</div>

rebased over latest beta, 9.8.beta3



---

archive/issue_comments_558619.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72d57e09637ae74e8d4bf74d82fddedd20853447\">72d57e0</a></td><td><code>don't use SAGE_LOCAL/share/gap, switch to GAP's \"make install\"</code></td></tr></table>\n",
    "created_at": "2022-11-04T14:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558619",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53" align="right">Comment 53</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72d57e09637ae74e8d4bf74d82fddedd20853447">72d57e0</a></td><td><code>don't use SAGE_LOCAL/share/gap, switch to GAP's "make install"</code></td></tr></table>




---

archive/issue_comments_558620.json:
```json
{
    "body": "Changed commit from **[a1e6e43](https://github.com/sagemath/sagetrac-mirror/commit/a1e6e4316fe68e6d11bfe3565e75bd0e297642a0)** to **[72d57e0](https://github.com/sagemath/sagetrac-mirror/commit/72d57e09637ae74e8d4bf74d82fddedd20853447)**",
    "created_at": "2022-11-04T14:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558620",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a1e6e43](https://github.com/sagemath/sagetrac-mirror/commit/a1e6e4316fe68e6d11bfe3565e75bd0e297642a0)** to **[72d57e0](https://github.com/sagemath/sagetrac-mirror/commit/72d57e09637ae74e8d4bf74d82fddedd20853447)**



---

archive/issue_comments_558621.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nthe current issue is to fix gap's `spkg-check` - currently broken due to a mess\nin some GAP's packages we install, see \nhttps://github.com/gap-packages/crypting/issues/21#issuecomment-1303503670",
    "created_at": "2022-11-04T14:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558621",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:54" align="right">Comment 54</div>

the current issue is to fix gap's `spkg-check` - currently broken due to a mess
in some GAP's packages we install, see 
https://github.com/gap-packages/crypting/issues/21#issuecomment-1303503670



---

archive/issue_events_451584.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-04T14:05:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451584"
}
```



---

archive/issue_events_451585.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-04T14:05:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451585"
}
```



---

archive/issue_comments_558622.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nlibgap doesn't find any package\n\n```\nsage: from sage.tests.gap_packages import all_installed_packages\nsage: all_installed_packages()\n()\n```",
    "created_at": "2022-11-04T18:11:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558622",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:55" align="right">Comment 55</div>

libgap doesn't find any package

```
sage: from sage.tests.gap_packages import all_installed_packages
sage: all_installed_packages()
()
```



---

archive/issue_events_451586.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-11-04T18:11:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451586"
}
```



---

archive/issue_events_451587.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-11-04T18:11:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451587"
}
```



---

archive/issue_comments_558623.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)** to **[u/arojas/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/packages/gap/4_12_1)**",
    "created_at": "2022-11-04T19:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558623",
    "user": "https://github.com/antonio-rojas"
}
```

Changed branch from **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)** to **[u/arojas/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/packages/gap/4_12_1)**



---

archive/issue_comments_558624.json:
```json
{
    "body": "Changed commit from **[72d57e0](https://github.com/sagemath/sagetrac-mirror/commit/72d57e09637ae74e8d4bf74d82fddedd20853447)** to **[16c2ccb](https://github.com/sagemath/sagetrac-mirror/commit/16c2ccb7fcbb95c1fb7f7ce0b0e4b9aec9031497)**",
    "created_at": "2022-11-04T19:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558624",
    "user": "https://github.com/antonio-rojas"
}
```

Changed commit from **[72d57e0](https://github.com/sagemath/sagetrac-mirror/commit/72d57e09637ae74e8d4bf74d82fddedd20853447)** to **[16c2ccb](https://github.com/sagemath/sagetrac-mirror/commit/16c2ccb7fcbb95c1fb7f7ce0b0e4b9aec9031497)**



---

archive/issue_comments_558625.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nIdeally libgap should know where to look for its files without needing to pass the paths with `-l`, but apparently that's not the case (it works fine in the gap command line though, `GAPInfo.RootPaths` returns both paths, `lib` and `share`).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16c2ccb7fcbb95c1fb7f7ce0b0e4b9aec9031497\">16c2ccb</a></td><td><code>Search for files in both lib/gap and share/gap</code></td></tr></table>\n",
    "created_at": "2022-11-04T19:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558625",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:57" align="right">Comment 57</div>

Ideally libgap should know where to look for its files without needing to pass the paths with `-l`, but apparently that's not the case (it works fine in the gap command line though, `GAPInfo.RootPaths` returns both paths, `lib` and `share`).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16c2ccb7fcbb95c1fb7f7ce0b0e4b9aec9031497">16c2ccb</a></td><td><code>Search for files in both lib/gap and share/gap</code></td></tr></table>




---

archive/issue_comments_558626.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nThere's still one test failure\n\n```\nsage -t --long --random-seed=259290265121646386777269003923470404522 src/sage/tests/gap_packages.py\n**********************************************************************\nFile \"src/sage/tests/gap_packages.py\", line 8, in sage.tests.gap_packages\nFailed example:\n    test_packages(pkgs, only_failures=True)    # optional - gap_packages\nException raised:\n    Traceback (most recent call last):\n      File \"/home/antonio/Software/sage/sage-gap/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/antonio/Software/sage/sage-gap/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tests.gap_packages[2]>\", line 1, in <module>\n        test_packages(pkgs, only_failures=True)    # optional - gap_packages\n      File \"/home/antonio/Software/sage/sage-gap/src/sage/tests/gap_packages.py\", line 71, in test_packages\n        output = libgap.LoadPackage(pkg)\n      File \"sage/libs/gap/element.pyx\", line 2524, in sage.libs.gap.element.GapElement_Function.__call__\n        sig_on()\n    sage.libs.gap.util.GAPError: Error, no method found! Error, no 1st choice method found for `Filename' on 2 arguments\n    The 1st argument is 'fail' which might point to an earlier problem\n    Error, was not in any namespace\n    Error, was not in any namespace\n**********************************************************************\n```\nIt happens when libgap tries to load the `packagemanager` package\n\n```\nsage: libgap.LoadPackage(\"packagemanager\")\n---------------------------------------------------------------------------\nGAPError                                  Traceback (most recent call last)\nInput In [1], in <cell line: 1>()\n----> 1 libgap.LoadPackage(\"packagemanager\")\n\nFile ~/Software/sage/sage-gap/src/sage/libs/gap/element.pyx:2524, in sage.libs.gap.element.GapElement_Function.__call__()\n   2522 try:\n   2523     sig_GAP_Enter()\n-> 2524     sig_on()\n   2525     if n == 0:\n   2526         result = CALL_0ARGS(self.value)\n\nGAPError: Error, no method found! Error, no 1st choice method found for `Filename' on 2 arguments\nThe 1st argument is 'fail' which might point to an earlier problem\nError, was not in any namespace\nError, was not in any namespace\n```\nIt (seems to) work fine the second time\n\n```\nsage: libgap.LoadPackage(\"packagemanager\")\ntrue\n```",
    "created_at": "2022-11-04T19:35:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558626",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:58" align="right">Comment 58</div>

There's still one test failure

```
sage -t --long --random-seed=259290265121646386777269003923470404522 src/sage/tests/gap_packages.py
**********************************************************************
File "src/sage/tests/gap_packages.py", line 8, in sage.tests.gap_packages
Failed example:
    test_packages(pkgs, only_failures=True)    # optional - gap_packages
Exception raised:
    Traceback (most recent call last):
      File "/home/antonio/Software/sage/sage-gap/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/antonio/Software/sage/sage-gap/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.gap_packages[2]>", line 1, in <module>
        test_packages(pkgs, only_failures=True)    # optional - gap_packages
      File "/home/antonio/Software/sage/sage-gap/src/sage/tests/gap_packages.py", line 71, in test_packages
        output = libgap.LoadPackage(pkg)
      File "sage/libs/gap/element.pyx", line 2524, in sage.libs.gap.element.GapElement_Function.__call__
        sig_on()
    sage.libs.gap.util.GAPError: Error, no method found! Error, no 1st choice method found for `Filename' on 2 arguments
    The 1st argument is 'fail' which might point to an earlier problem
    Error, was not in any namespace
    Error, was not in any namespace
**********************************************************************
```
It happens when libgap tries to load the `packagemanager` package

```
sage: libgap.LoadPackage("packagemanager")
---------------------------------------------------------------------------
GAPError                                  Traceback (most recent call last)
Input In [1], in <cell line: 1>()
----> 1 libgap.LoadPackage("packagemanager")

File ~/Software/sage/sage-gap/src/sage/libs/gap/element.pyx:2524, in sage.libs.gap.element.GapElement_Function.__call__()
   2522 try:
   2523     sig_GAP_Enter()
-> 2524     sig_on()
   2525     if n == 0:
   2526         result = CALL_0ARGS(self.value)

GAPError: Error, no method found! Error, no 1st choice method found for `Filename' on 2 arguments
The 1st argument is 'fail' which might point to an earlier problem
Error, was not in any namespace
Error, was not in any namespace
```
It (seems to) work fine the second time

```
sage: libgap.LoadPackage("packagemanager")
true
```



---

archive/issue_comments_558627.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nDo you need to look for packages in `share/gap`? There should not be any.\nThat's why I doubt your line from `\u200b16c2ccb`:\n\n```\ns = str_to_bytes(sage.env.GAP_LIB_DIR + \";\" + sage.env.GAP_SHARE_DIR, FS_ENCODING, \"surrogateescape\")\n```",
    "created_at": "2022-11-04T19:50:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558627",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:59" align="right">Comment 59</div>

Do you need to look for packages in `share/gap`? There should not be any.
That's why I doubt your line from `16c2ccb`:

```
s = str_to_bytes(sage.env.GAP_LIB_DIR + ";" + sage.env.GAP_SHARE_DIR, FS_ENCODING, "surrogateescape")
```



---

archive/issue_comments_558628.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nReplying to [Dima Pasechnik](#comment%3A59):\n> Do you need to look for packages in `share/gap`? There should not be any.\n> That's why I doubt your line from `\u200b16c2ccb`:\n\nThat is not only for packages. Without this, `libgap` can't find the `lib/init.g` file which is installed under `share/gap` and just crashes on initialization.",
    "created_at": "2022-11-04T19:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558628",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:60" align="right">Comment 60</div>

Replying to [Dima Pasechnik](#comment%3A59):
> Do you need to look for packages in `share/gap`? There should not be any.
> That's why I doubt your line from `16c2ccb`:

That is not only for packages. Without this, `libgap` can't find the `lib/init.g` file which is installed under `share/gap` and just crashes on initialization.



---

archive/issue_comments_558629.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nReplying to [Antonio Rojas](#comment%3A58):\n> It happens when libgap tries to load the `packagemanager` package\n\nLooks like `packagemanager` expects a `lib/gap/bin` dir to exist, which is not created by `make install`\n\nhttps://github.com/gap-packages/PackageManager/blob/master/gap/PackageManager.gd#L294\n\nSimply creating an empty `bin` subdir fixes the test.",
    "created_at": "2022-11-04T20:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558629",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:61" align="right">Comment 61</div>

Replying to [Antonio Rojas](#comment%3A58):
> It happens when libgap tries to load the `packagemanager` package

Looks like `packagemanager` expects a `lib/gap/bin` dir to exist, which is not created by `make install`

https://github.com/gap-packages/PackageManager/blob/master/gap/PackageManager.gd#L294

Simply creating an empty `bin` subdir fixes the test.



---

archive/issue_comments_558630.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01\">3abfbd0</a></td><td><code>Create lib/gap/bin on install</code></td></tr></table>\n",
    "created_at": "2022-11-04T20:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558630",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62" align="right">Comment 62</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01">3abfbd0</a></td><td><code>Create lib/gap/bin on install</code></td></tr></table>




---

archive/issue_comments_558631.json:
```json
{
    "body": "Changed commit from **[16c2ccb](https://github.com/sagemath/sagetrac-mirror/commit/16c2ccb7fcbb95c1fb7f7ce0b0e4b9aec9031497)** to **[3abfbd0](https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01)**",
    "created_at": "2022-11-04T20:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558631",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[16c2ccb](https://github.com/sagemath/sagetrac-mirror/commit/16c2ccb7fcbb95c1fb7f7ce0b0e4b9aec9031497)** to **[3abfbd0](https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01)**



---

archive/issue_events_451588.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-11-04T20:44:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451588"
}
```



---

archive/issue_events_451589.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2022-11-04T20:44:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451589"
}
```



---

archive/issue_comments_558632.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nReported upstream\n\nhttps://github.com/gap-packages/PackageManager/issues/105",
    "created_at": "2022-11-04T20:44:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558632",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:63" align="right">Comment 63</div>

Reported upstream

https://github.com/gap-packages/PackageManager/issues/105



---

archive/issue_comments_558633.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nSomething is fishy with PackageManager in another way, too:  https://github.com/gap-packages/PackageManager/issues/106",
    "created_at": "2022-11-04T21:05:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558633",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:64" align="right">Comment 64</div>

Something is fishy with PackageManager in another way, too:  https://github.com/gap-packages/PackageManager/issues/106



---

archive/issue_comments_558634.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nReplying to [@sagetrac-git](#comment%3A62):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01\">3abfbd0</a></td><td><code>Create lib/gap/bin on install</code></td></tr></table>\n\nbut we don't need lib/gap/bin, it's an upstream bug.",
    "created_at": "2022-11-04T21:06:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558634",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:65" align="right">Comment 65</div>

Replying to [@sagetrac-git](#comment%3A62):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01">3abfbd0</a></td><td><code>Create lib/gap/bin on install</code></td></tr></table>

but we don't need lib/gap/bin, it's an upstream bug.



---

archive/issue_comments_558635.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nReplying to [Dima Pasechnik](#comment%3A65):\n> Replying to [@sagetrac-git](#comment%3A62):\n> > Branch pushed to git repo; I updated commit sha1. New commits:\n\n> |                                                                                                                                                 |                               |\n> |-------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n> |[3abfbd0](https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01)|`Create lib/gap/bin on install`|\n> \n> but we don't need lib/gap/bin, it's an upstream bug.\n\nIt breaks a test. We either need to work around this, or we need to stop testing loading the package.",
    "created_at": "2022-11-04T21:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558635",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:66" align="right">Comment 66</div>

Replying to [Dima Pasechnik](#comment%3A65):
> Replying to [@sagetrac-git](#comment%3A62):
> > Branch pushed to git repo; I updated commit sha1. New commits:

> |                                                                                                                                                 |                               |
> |-------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
> |[3abfbd0](https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01)|`Create lib/gap/bin on install`|
> 
> but we don't need lib/gap/bin, it's an upstream bug.

It breaks a test. We either need to work around this, or we need to stop testing loading the package.



---

archive/issue_comments_558636.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nReplying to [Antonio Rojas](#comment%3A60):\n> Replying to [Dima Pasechnik](#comment%3A59):\n> > Do you need to look for packages in `share/gap`? There should not be any.\n> > That's why I doubt your line from `\u200b16c2ccb`:\n\n> \n> That is not only for packages. Without this, `libgap` can't find the `lib/init.g` file which is installed under `share/gap` and just crashes on initialization.\n\n\nI feel like it is an oversight upstream. They should move that code under lib/gap too to be consistent. It is probably just a matter of fixing the install target in the makefile.",
    "created_at": "2022-11-04T21:48:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558636",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:67" align="right">Comment 67</div>

Replying to [Antonio Rojas](#comment%3A60):
> Replying to [Dima Pasechnik](#comment%3A59):
> > Do you need to look for packages in `share/gap`? There should not be any.
> > That's why I doubt your line from `16c2ccb`:

> 
> That is not only for packages. Without this, `libgap` can't find the `lib/init.g` file which is installed under `share/gap` and just crashes on initialization.


I feel like it is an oversight upstream. They should move that code under lib/gap too to be consistent. It is probably just a matter of fixing the install target in the makefile.



---

archive/issue_comments_558637.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nReplying to [Fran\u00e7ois Bissey](#comment%3A67):\n\n> I feel like it is an oversight upstream. They should move that code under lib/gap too to be consistent. It is probably just a matter of fixing the install target in the makefile.\n\nTechnically it is the correct place. Arch-independent files belong in `share`.",
    "created_at": "2022-11-04T21:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558637",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:68" align="right">Comment 68</div>

Replying to [Franois Bissey](#comment%3A67):

> I feel like it is an oversight upstream. They should move that code under lib/gap too to be consistent. It is probably just a matter of fixing the install target in the makefile.

Technically it is the correct place. Arch-independent files belong in `share`.



---

archive/issue_comments_558638.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nReplying to [Antonio Rojas](#comment%3A68):\n> Replying to [Fran\u00e7ois Bissey](#comment%3A67):\n> \n> > I feel like it is an oversight upstream. They should move that code under lib/gap too to be consistent. It is probably just a matter of fixing the install target in the makefile.\n\n> \n> Technically it is the correct place. Arch-independent files belong in `share`.\n\nI cannot argue with that. I know I had complaint that in previous gap version, gap packages installed binaries and libraries under `share` which is not right of course. But gap packages are a mixed bag. Do we need to sort them out or to make sure only the binary bits get shipped under `lib`? It may become complicated very fast. I feel like the right decision is just to put everything under `lib`. Python does it, that's a big example to follow.",
    "created_at": "2022-11-04T22:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558638",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:69" align="right">Comment 69</div>

Replying to [Antonio Rojas](#comment%3A68):
> Replying to [Franois Bissey](#comment%3A67):
> 
> > I feel like it is an oversight upstream. They should move that code under lib/gap too to be consistent. It is probably just a matter of fixing the install target in the makefile.

> 
> Technically it is the correct place. Arch-independent files belong in `share`.

I cannot argue with that. I know I had complaint that in previous gap version, gap packages installed binaries and libraries under `share` which is not right of course. But gap packages are a mixed bag. Do we need to sort them out or to make sure only the binary bits get shipped under `lib`? It may become complicated very fast. I feel like the right decision is just to put everything under `lib`. Python does it, that's a big example to follow.



---

archive/issue_comments_558639.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nActually, the `bin/gap` script created by `make install` contains both paths\n\nhttps://github.com/gap-system/gap/blob/v4.12.1/Makefile.rules#L582\n\nMy commit is just replicating that for the `libgap` call in sage.\n\n\n> Do we need to sort them out or to make sure only the binary bits get shipped under `lib`? It may become complicated very fast. I feel like the right decision is just to put everything under `lib`. \n\nThis is something for upstream to figure out when they integrate package installation in `make install`, which I believe is planned. Until then every distro will manually install packages where they choose to, so we need to search both paths.",
    "created_at": "2022-11-04T23:25:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558639",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:70" align="right">Comment 70</div>

Actually, the `bin/gap` script created by `make install` contains both paths

https://github.com/gap-system/gap/blob/v4.12.1/Makefile.rules#L582

My commit is just replicating that for the `libgap` call in sage.


> Do we need to sort them out or to make sure only the binary bits get shipped under `lib`? It may become complicated very fast. I feel like the right decision is just to put everything under `lib`. 

This is something for upstream to figure out when they integrate package installation in `make install`, which I believe is planned. Until then every distro will manually install packages where they choose to, so we need to search both paths.



---

archive/issue_comments_558640.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">Comment 71</div>\n\nReplying to [Antonio Rojas](#comment%3A70):\n> Actually, the `bin/gap` script created by `make install` contains both paths\n> \n> https://github.com/gap-system/gap/blob/v4.12.1/Makefile.rules#L582\n> \n\nThat, I noticed when I packaged 4.12.0. I only thought of it as a backward compatible move though. It didn't quite percolate into my brain that it would be needed for the stuff that ship with gap itself.",
    "created_at": "2022-11-04T23:40:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558640",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:71" align="right">Comment 71</div>

Replying to [Antonio Rojas](#comment%3A70):
> Actually, the `bin/gap` script created by `make install` contains both paths
> 
> https://github.com/gap-system/gap/blob/v4.12.1/Makefile.rules#L582
> 

That, I noticed when I packaged 4.12.0. I only thought of it as a backward compatible move though. It didn't quite percolate into my brain that it would be needed for the stuff that ship with gap itself.



---

archive/issue_comments_558641.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nanother issue is that `make gap-clean` does not seem to work.",
    "created_at": "2022-11-05T00:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558641",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:72" align="right">Comment 72</div>

another issue is that `make gap-clean` does not seem to work.



---

archive/issue_comments_558642.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nAnd installing GAP with `SAGE_CHECK=yes` hangs for me at `gap-4.12.1/src/tst/testinstall/grp/basic.tst`",
    "created_at": "2022-11-05T00:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558642",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:73" align="right">Comment 73</div>

And installing GAP with `SAGE_CHECK=yes` hangs for me at `gap-4.12.1/src/tst/testinstall/grp/basic.tst`



---

archive/issue_comments_558643.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nDoes it hang if you disable your internet connection? `atlasgrp` fetches precomputed data from the network (using either the `io` GAP package or the `wget` binary) if available, so connection failures/slowness may cause hangs occasionally. It falls back to local computation if there's no internet access.",
    "created_at": "2022-11-05T00:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558643",
    "user": "https://github.com/collares"
}
```

<div id="comment:74" align="right">Comment 74</div>

Does it hang if you disable your internet connection? `atlasgrp` fetches precomputed data from the network (using either the `io` GAP package or the `wget` binary) if available, so connection failures/slowness may cause hangs occasionally. It falls back to local computation if there's no internet access.



---

archive/issue_comments_558644.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">Comment 75</div>\n\nReplying to [Mauricio Collares](#comment%3A74):\n> Does it hang if you disable your internet connection? `atlasgrp` fetches precomputed data from the network (using either the `io` GAP package or the `wget` binary) if available, so connection failures/slowness may cause hangs occasionally. It falls back to local computation if there's no internet access.\n\nThis might be useful: https://github.com/void-linux/void-packages/blob/master/srcpkgs/gap/patches/atlasrep-dont_use_network_by_default.patch",
    "created_at": "2022-11-05T01:33:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558644",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:75" align="right">Comment 75</div>

Replying to [Mauricio Collares](#comment%3A74):
> Does it hang if you disable your internet connection? `atlasgrp` fetches precomputed data from the network (using either the `io` GAP package or the `wget` binary) if available, so connection failures/slowness may cause hangs occasionally. It falls back to local computation if there's no internet access.

This might be useful: https://github.com/void-linux/void-packages/blob/master/srcpkgs/gap/patches/atlasrep-dont_use_network_by_default.patch



---

archive/issue_comments_558645.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nReplying to [Dima Pasechnik](#comment%3A72):\n> another issue is that `make gap-clean` does not seem to work.\n\nThe install script does not use DESTDIR staging (`sdh_make install` installs directly into the prefix)",
    "created_at": "2022-11-12T23:00:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558645",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">Comment 76</div>

Replying to [Dima Pasechnik](#comment%3A72):
> another issue is that `make gap-clean` does not seem to work.

The install script does not use DESTDIR staging (`sdh_make install` installs directly into the prefix)



---

archive/issue_comments_558646.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">Comment 77</div>\n\nReplying to [Matthias K\u00f6ppe](#comment%3A76):\n> Replying to [Dima Pasechnik](#comment%3A72):\n> > another issue is that `make gap-clean` does not seem to work.\n\n> \n> The install script does not use DESTDIR staging (`sdh_make install` installs directly into the prefix)\n\nhmm, is this a GAP bug then? Or a Sage bug?",
    "created_at": "2022-11-12T23:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558646",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:77" align="right">Comment 77</div>

Replying to [Matthias Kppe](#comment%3A76):
> Replying to [Dima Pasechnik](#comment%3A72):
> > another issue is that `make gap-clean` does not seem to work.

> 
> The install script does not use DESTDIR staging (`sdh_make install` installs directly into the prefix)

hmm, is this a GAP bug then? Or a Sage bug?



---

archive/issue_comments_558647.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">Comment 78</div>\n\nTry changing `sdh_make install` to `sdh_make_install`.",
    "created_at": "2022-11-13T02:06:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558647",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:78" align="right">Comment 78</div>

Try changing `sdh_make install` to `sdh_make_install`.



---

archive/issue_comments_558648.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+GAP 4.12.1 fixes critical bugs in 4.12.0\n+\n+[GAP 4.12.1 release page](https://www.gap-system.org/Releases/4.12.1.html)\n+\n+\n GAP 4.12.0 was released in August 2022.\n \n - [GAP 4.12.0 release announcement](https://lists.uni-kl.de/gap/arc/forum/2022-08/msg00031.html)\n``````\n",
    "created_at": "2022-11-13T11:15:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558648",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
+GAP 4.12.1 fixes critical bugs in 4.12.0
+
+[GAP 4.12.1 release page](https://www.gap-system.org/Releases/4.12.1.html)
+
+
 GAP 4.12.0 was released in August 2022.
 
 - [GAP 4.12.0 release announcement](https://lists.uni-kl.de/gap/arc/forum/2022-08/msg00031.html)
``````




---

archive/issue_comments_558649.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">Comment 80</div>\n\nReplying to [Matthias K\u00f6ppe](#comment%3A78):\n> Try changing `sdh_make install` to `sdh_make_install`.\n\nright, thanks - this worked after I removed build/pkgs/gap/spkg-prerm.in as well. I'll post a new branch.",
    "created_at": "2022-11-13T19:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558649",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:80" align="right">Comment 80</div>

Replying to [Matthias Kppe](#comment%3A78):
> Try changing `sdh_make install` to `sdh_make_install`.

right, thanks - this worked after I removed build/pkgs/gap/spkg-prerm.in as well. I'll post a new branch.



---

archive/issue_comments_558650.json:
```json
{
    "body": "Changed branch from **[u/arojas/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/packages/gap/4_12_1)** to **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)**",
    "created_at": "2022-11-13T20:02:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558650",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/arojas/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/packages/gap/4_12_1)** to **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)**



---

archive/issue_comments_558651.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">Comment 81</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df6d32e3beaf3ae0d31d10e71cbaf2465f080297\">df6d32e</a></td><td><code>ensure make gap-clean still works</code></td></tr></table>\n",
    "created_at": "2022-11-13T20:02:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558651",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:81" align="right">Comment 81</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df6d32e3beaf3ae0d31d10e71cbaf2465f080297">df6d32e</a></td><td><code>ensure make gap-clean still works</code></td></tr></table>




---

archive/issue_comments_558652.json:
```json
{
    "body": "Changed commit from **[3abfbd0](https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01)** to **[df6d32e](https://github.com/sagemath/sagetrac-mirror/commit/df6d32e3beaf3ae0d31d10e71cbaf2465f080297)**",
    "created_at": "2022-11-13T20:02:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558652",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[3abfbd0](https://github.com/sagemath/sagetrac-mirror/commit/3abfbd014f80dbda16db0f99d6c81486a1f4cf01)** to **[df6d32e](https://github.com/sagemath/sagetrac-mirror/commit/df6d32e3beaf3ae0d31d10e71cbaf2465f080297)**



---

archive/issue_comments_558653.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">Comment 82</div>\n\nWith gap_packages, cleaning is still not 100% right. Namely, *compiled* GAP packages, e.g. `cohomolo`, leave a skeleton directory after `make gap_packages-clean`. It's harmless in this particular case though.\n\nLet's leave this to another ticket.",
    "created_at": "2022-11-13T22:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558653",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:82" align="right">Comment 82</div>

With gap_packages, cleaning is still not 100% right. Namely, *compiled* GAP packages, e.g. `cohomolo`, leave a skeleton directory after `make gap_packages-clean`. It's harmless in this particular case though.

Let's leave this to another ticket.



---

archive/issue_comments_558654.json:
```json
{
    "body": "Changed commit from **[df6d32e](https://github.com/sagemath/sagetrac-mirror/commit/df6d32e3beaf3ae0d31d10e71cbaf2465f080297)** to **[97dc1ea](https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8)**",
    "created_at": "2022-11-13T23:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558654",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[df6d32e](https://github.com/sagemath/sagetrac-mirror/commit/df6d32e3beaf3ae0d31d10e71cbaf2465f080297)** to **[97dc1ea](https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8)**



---

archive/issue_comments_558655.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">Comment 83</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8\">97dc1ea</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr></table>\n",
    "created_at": "2022-11-13T23:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558655",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:83" align="right">Comment 83</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8">97dc1ea</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr></table>




---

archive/issue_comments_558656.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">Comment 84</div>\n\nNow `SAGE_CHECK= yes make gap` passes. All good, as far as I can see.\n\nAnyone wants to give this a positive review?",
    "created_at": "2022-11-13T23:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558656",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:84" align="right">Comment 84</div>

Now `SAGE_CHECK= yes make gap` passes. All good, as far as I can see.

Anyone wants to give this a positive review?



---

archive/issue_comments_558657.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">Comment 85</div>\n\nReplying to [Dima Pasechnik](#comment%3A82):\n> With gap_packages, cleaning is still not 100% right. Namely, *compiled* GAP packages, e.g. `cohomolo`, leave a skeleton directory after `make gap_packages-clean`.\n\nLikely a defect in the build system of upstream",
    "created_at": "2022-11-13T23:35:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558657",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">Comment 85</div>

Replying to [Dima Pasechnik](#comment%3A82):
> With gap_packages, cleaning is still not 100% right. Namely, *compiled* GAP packages, e.g. `cohomolo`, leave a skeleton directory after `make gap_packages-clean`.

Likely a defect in the build system of upstream



---

archive/issue_comments_558658.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">Comment 86</div>\n\nReplying to [Matthias K\u00f6ppe](#comment%3A85):\n> Replying to [Dima Pasechnik](#comment%3A82):\n> > With gap_packages, cleaning is still not 100% right. Namely, *compiled* GAP packages, e.g. `cohomolo`, leave a skeleton directory after `make gap_packages-clean`.\n\n> \n> Likely a defect in the build system of upstream\n\nI must say I've no idea what's going on there. I don't even know any more where Sage stores info on installed by `sdh_install` data.",
    "created_at": "2022-11-13T23:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558658",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:86" align="right">Comment 86</div>

Replying to [Matthias Kppe](#comment%3A85):
> Replying to [Dima Pasechnik](#comment%3A82):
> > With gap_packages, cleaning is still not 100% right. Namely, *compiled* GAP packages, e.g. `cohomolo`, leave a skeleton directory after `make gap_packages-clean`.

> 
> Likely a defect in the build system of upstream

I must say I've no idea what's going on there. I don't even know any more where Sage stores info on installed by `sdh_install` data.



---

archive/issue_comments_558659.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">Comment 87</div>\n\nThe upstream build system likely forgets to use `$(DESTDIR)` in some `mkdir` commands. We've seen this before in other packages.",
    "created_at": "2022-11-14T00:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558659",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:87" align="right">Comment 87</div>

The upstream build system likely forgets to use `$(DESTDIR)` in some `mkdir` commands. We've seen this before in other packages.



---

archive/issue_comments_558660.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">Comment 88</div>\n\nThe staging manifests are in $SAGE_LOCAL/var/lib/sage/installed/",
    "created_at": "2022-11-14T00:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558660",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:88" align="right">Comment 88</div>

The staging manifests are in $SAGE_LOCAL/var/lib/sage/installed/



---

archive/issue_comments_558661.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">Comment 89</div>\n\nReplying to [@sagetrac-git](#comment%3A83):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8\">97dc1ea</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr></table>\n\nNote that, if I'm not mistaken, `io` is needed for `atlasrep` and only to hit the network in the absence of `curl` and `wget`.\n\nAn alternative is to configure atlasrep to not hit the network by default\n(very easy: https://github.com/void-linux/void-packages/blob/master/srcpkgs/gap/patches/atlasrep-dont_use_network_by_default.patch).\n\nI'm not sure what's better for sage.",
    "created_at": "2022-11-14T00:37:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558661",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:89" align="right">Comment 89</div>

Replying to [@sagetrac-git](#comment%3A83):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8">97dc1ea</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr></table>

Note that, if I'm not mistaken, `io` is needed for `atlasrep` and only to hit the network in the absence of `curl` and `wget`.

An alternative is to configure atlasrep to not hit the network by default
(very easy: https://github.com/void-linux/void-packages/blob/master/srcpkgs/gap/patches/atlasrep-dont_use_network_by_default.patch).

I'm not sure what's better for sage.



---

archive/issue_comments_558662.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">Comment 90</div>\n\nI forgot to mention that GAP's `make check` contains one test (https://github.com/gap-system/gap/blob/v4.12.0/tst/testinstall/grpperm.tst#L67) that takes a really long time (at least ten minutes) to run if you disable usage of precomputed data. Maybe that's the hang reported above?",
    "created_at": "2022-11-14T01:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558662",
    "user": "https://github.com/collares"
}
```

<div id="comment:90" align="right">Comment 90</div>

I forgot to mention that GAP's `make check` contains one test (https://github.com/gap-system/gap/blob/v4.12.0/tst/testinstall/grpperm.tst#L67) that takes a really long time (at least ten minutes) to run if you disable usage of precomputed data. Maybe that's the hang reported above?



---

archive/issue_comments_558663.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">Comment 91</div>\n\nReplying to [Mauricio Collares](#comment%3A90):\n> I forgot to mention that GAP's `make check` contains one test (https://github.com/gap-system/gap/blob/v4.12.0/tst/testinstall/grpperm.tst#L67) that takes a really long time (at least ten minutes) to run if you disable usage of precomputed data. Maybe that's the hang reported above?\n\nThat takes less than a second for me:\n\n```\ngap> t:=time;; Length(MaximalSubgroupClassReps(SimpleGroup(\"M24\"))); time-t;\n9\n684\n```",
    "created_at": "2022-11-14T01:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558663",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:91" align="right">Comment 91</div>

Replying to [Mauricio Collares](#comment%3A90):
> I forgot to mention that GAP's `make check` contains one test (https://github.com/gap-system/gap/blob/v4.12.0/tst/testinstall/grpperm.tst#L67) that takes a really long time (at least ten minutes) to run if you disable usage of precomputed data. Maybe that's the hang reported above?

That takes less than a second for me:

```
gap> t:=time;; Length(MaximalSubgroupClassReps(SimpleGroup("M24"))); time-t;
9
684
```



---

archive/issue_comments_558664.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">Comment 92</div>\n\nReplying to [Mauricio Collares](#comment%3A90):\n> I forgot to mention that GAP's `make check` contains one test (https://github.com/gap-system/gap/blob/v4.12.0/tst/testinstall/grpperm.tst#L67) that takes a really long time (at least ten minutes) to run if you disable usage of precomputed data. Maybe that's the hang reported above?\n\nno, what I see is a total hang, nothing happens, CPUs don't do anything, etc.",
    "created_at": "2022-11-14T10:14:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558664",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:92" align="right">Comment 92</div>

Replying to [Mauricio Collares](#comment%3A90):
> I forgot to mention that GAP's `make check` contains one test (https://github.com/gap-system/gap/blob/v4.12.0/tst/testinstall/grpperm.tst#L67) that takes a really long time (at least ten minutes) to run if you disable usage of precomputed data. Maybe that's the hang reported above?

no, what I see is a total hang, nothing happens, CPUs don't do anything, etc.



---

archive/issue_comments_558665.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">Comment 93</div>\n\nReplying to [Gonzalo Tornar\u00eda](#comment%3A89):\n\n> Note that, if I'm not mistaken, `io` is needed for `atlasrep` and only to hit the network in the absence of `curl` and `wget`.\n> \n> An alternative is to configure atlasrep to not hit the network by default\n> (very easy: https://github.com/void-linux/void-packages/blob/master/srcpkgs/gap/patches/atlasrep-dont_use_network_by_default.patch).\n\nIt's not `atlastrep` here, it's other packages that use parallel computation facilities of `io` in their testsuites. Note that we're running tests on whatever is in the GAP tarball, not on the installed configuration. I think it's an upstream bug, I'll open an issue in this regard, but I think it can wait for another ticket, it's not a regression.",
    "created_at": "2022-11-14T10:43:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558665",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:93" align="right">Comment 93</div>

Replying to [Gonzalo Tornara](#comment%3A89):

> Note that, if I'm not mistaken, `io` is needed for `atlasrep` and only to hit the network in the absence of `curl` and `wget`.
> 
> An alternative is to configure atlasrep to not hit the network by default
> (very easy: https://github.com/void-linux/void-packages/blob/master/srcpkgs/gap/patches/atlasrep-dont_use_network_by_default.patch).

It's not `atlastrep` here, it's other packages that use parallel computation facilities of `io` in their testsuites. Note that we're running tests on whatever is in the GAP tarball, not on the installed configuration. I think it's an upstream bug, I'll open an issue in this regard, but I think it can wait for another ticket, it's not a regression.



---

archive/issue_comments_558666.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">Comment 94</div>\n\nping?",
    "created_at": "2022-11-21T12:26:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558666",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:94" align="right">Comment 94</div>

ping?



---

archive/issue_comments_558667.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">Comment 95</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d08847c9abd27d6a059195669bf6f1e4fd05450d\">d08847c</a></td><td><code>also, fix the package names etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4130abbd3df310b5636542017abeae653a1200f4\">4130abb</a></td><td><code>update GAP to 4.12.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c63f276f193bf7ecd4ce1fee4269ca95d6ffed0b\">c63f276</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7316eb9f58cebf64dc0117f1482fca8236a7a87c\">7316eb9</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71268c9498dd143643a7c2c9547ca25e2e78987c\">71268c9</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e055a84cb943f96d0eb88d23a48fd43ced054f1\">4e055a8</a></td><td><code>don't use SAGE_LOCAL/share/gap, switch to GAP's \"make install\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/becfa00fdefcbf46e5fe0c604aeb193398a9d39d\">becfa00</a></td><td><code>Search for files in both lib/gap and share/gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09fcb2672d20e0dcc97233d7a599da0191b0109e\">09fcb26</a></td><td><code>Create lib/gap/bin on install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93c1becb5f3eba41b0cea43912c2482389320bf9\">93c1bec</a></td><td><code>ensure make gap-clean still works</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71c9fe337455d52637e0272fccdd633d8e96fa2e\">71c9fe3</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr></table>\n",
    "created_at": "2022-11-23T18:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558667",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:95" align="right">Comment 95</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d08847c9abd27d6a059195669bf6f1e4fd05450d">d08847c</a></td><td><code>also, fix the package names etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4130abbd3df310b5636542017abeae653a1200f4">4130abb</a></td><td><code>update GAP to 4.12.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c63f276f193bf7ecd4ce1fee4269ca95d6ffed0b">c63f276</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7316eb9f58cebf64dc0117f1482fca8236a7a87c">7316eb9</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71268c9498dd143643a7c2c9547ca25e2e78987c">71268c9</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e055a84cb943f96d0eb88d23a48fd43ced054f1">4e055a8</a></td><td><code>don't use SAGE_LOCAL/share/gap, switch to GAP's "make install"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/becfa00fdefcbf46e5fe0c604aeb193398a9d39d">becfa00</a></td><td><code>Search for files in both lib/gap and share/gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09fcb2672d20e0dcc97233d7a599da0191b0109e">09fcb26</a></td><td><code>Create lib/gap/bin on install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93c1becb5f3eba41b0cea43912c2482389320bf9">93c1bec</a></td><td><code>ensure make gap-clean still works</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71c9fe337455d52637e0272fccdd633d8e96fa2e">71c9fe3</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr></table>




---

archive/issue_comments_558668.json:
```json
{
    "body": "Changed commit from **[97dc1ea](https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8)** to **[71c9fe3](https://github.com/sagemath/sagetrac-mirror/commit/71c9fe337455d52637e0272fccdd633d8e96fa2e)**",
    "created_at": "2022-11-23T18:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558668",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[97dc1ea](https://github.com/sagemath/sagetrac-mirror/commit/97dc1ea93e313c3d6c0e7bf3868dbb2143fceef8)** to **[71c9fe3](https://github.com/sagemath/sagetrac-mirror/commit/71c9fe337455d52637e0272fccdd633d8e96fa2e)**



---

archive/issue_comments_558669.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">Comment 96</div>\n\nrebased over 9.8.beta4",
    "created_at": "2022-11-23T20:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558669",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:96" align="right">Comment 96</div>

rebased over 9.8.beta4



---

archive/issue_comments_558670.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">Comment 97</div>\n\nI'm hitting a snag while testing with `gap_packages` installed on macOS 13.0.1.\n\n```\nFile \"src/sage/libs/gap/libgap.pyx\", line 11, in sage.libs.gap.libgap\nFailed example:\n    a = libgap(10)\nExpected nothing\nGot:\n    Error, LOAD_DYN: failed to load kernel module /Users/dima/software/sage/local/lib/gap\\\n    /pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, dlopen(/Users/dima/soft\\\n    ware/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, \\\n    0x0005): Symbol not found: _AssGVar\n      Referenced from: <19D7E0D8-C31C-3325-B693-D1B981EBA814> /Users/dima/software\\\n    /sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so\n      Expected in:     <BE7F0B90-13D6-39B8-AE6C-1DB05808B5AF> /Library/Frameworks/\\\n    Python.framework/Versions/3.11/Resources/Python.app/Contents/MacOS/Python\n    Error, was not in any namespace\n    Syntax warning: Unbound global variable in /Users/dima/software/sage/local/sha\\\n    re/gap/lib/init.g:740\n        ColorPrompt( UserPreference( \"UseColorPrompt\" ) );\n        ^^^^^^^^^^^\n    Error, SetGasmanMessageStatus: function is not yet defined\n    Error, Variable: 'L1_IMMUTABLE_ERROR' must have a value\n```\n\nNot sure whether this is reproducible on older macOS - everything is fine on Linux. Note that package `io` has a \"GAP kernel module\", i.e. a special dynamic library which extends GAP capabilities (not dissimilar to Python extension modules with, say, parts written in C).\n\nI can also reproduce this at the Sage prompt (after I remove pre-built GAP images):\n\n```\n$ rm -rf ~/.sage \n$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.8.beta4, Release Date: 2022-11-21               \u2502\n\u2502 Using Python 3.11.0. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: libgap(10)\nError, LOAD_DYN: failed to load kernel module /Users/dima/software/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, dlopen(/Users/dima/soft\\\nware/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, 0x0005): Symbol not found: _AssGVar\n  Referenced from: <19D7E0D8-C31C-3325-B693-D1B981EBA814> /Users/dima/software/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so\n  Expected in:     <BE7F0B90-13D6-39B8-AE6C-1DB05808B5AF> /Library/Frameworks/Python.framework/Versions/3.11/Resources/Python.app/Contents/MacOS/Python\nError, was not in any namespace\nSyntax warning: Unbound global variable in /Users/dima/software/sage/local/share/gap/lib/init.g:740\n    ColorPrompt( UserPreference( \"UseColorPrompt\" ) );\n    ^^^^^^^^^^^\nError, SetGasmanMessageStatus: function is not yet defined\nError, Variable: 'L1_IMMUTABLE_ERROR' must have a value\n10\n```",
    "created_at": "2022-11-30T18:07:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558670",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:97" align="right">Comment 97</div>

I'm hitting a snag while testing with `gap_packages` installed on macOS 13.0.1.

```
File "src/sage/libs/gap/libgap.pyx", line 11, in sage.libs.gap.libgap
Failed example:
    a = libgap(10)
Expected nothing
Got:
    Error, LOAD_DYN: failed to load kernel module /Users/dima/software/sage/local/lib/gap\
    /pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, dlopen(/Users/dima/soft\
    ware/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, \
    0x0005): Symbol not found: _AssGVar
      Referenced from: <19D7E0D8-C31C-3325-B693-D1B981EBA814> /Users/dima/software\
    /sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so
      Expected in:     <BE7F0B90-13D6-39B8-AE6C-1DB05808B5AF> /Library/Frameworks/\
    Python.framework/Versions/3.11/Resources/Python.app/Contents/MacOS/Python
    Error, was not in any namespace
    Syntax warning: Unbound global variable in /Users/dima/software/sage/local/sha\
    re/gap/lib/init.g:740
        ColorPrompt( UserPreference( "UseColorPrompt" ) );
        ^^^^^^^^^^^
    Error, SetGasmanMessageStatus: function is not yet defined
    Error, Variable: 'L1_IMMUTABLE_ERROR' must have a value
```

Not sure whether this is reproducible on older macOS - everything is fine on Linux. Note that package `io` has a "GAP kernel module", i.e. a special dynamic library which extends GAP capabilities (not dissimilar to Python extension modules with, say, parts written in C).

I can also reproduce this at the Sage prompt (after I remove pre-built GAP images):

```
$ rm -rf ~/.sage 
$ ./sage

 SageMath version 9.8.beta4, Release Date: 2022-11-21               
 Using Python 3.11.0. Type "help()" for help.                       


 Warning: this is a prerelease version, and it may be unstable.     

sage: libgap(10)
Error, LOAD_DYN: failed to load kernel module /Users/dima/software/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, dlopen(/Users/dima/soft\
ware/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so, 0x0005): Symbol not found: _AssGVar
  Referenced from: <19D7E0D8-C31C-3325-B693-D1B981EBA814> /Users/dima/software/sage/local/lib/gap/pkg/io/bin/x86_64-apple-darwin22-default64-kv8/io.so
  Expected in:     <BE7F0B90-13D6-39B8-AE6C-1DB05808B5AF> /Library/Frameworks/Python.framework/Versions/3.11/Resources/Python.app/Contents/MacOS/Python
Error, was not in any namespace
Syntax warning: Unbound global variable in /Users/dima/software/sage/local/share/gap/lib/init.g:740
    ColorPrompt( UserPreference( "UseColorPrompt" ) );
    ^^^^^^^^^^^
Error, SetGasmanMessageStatus: function is not yet defined
Error, Variable: 'L1_IMMUTABLE_ERROR' must have a value
10
```



---

archive/issue_comments_558671.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">Comment 98</div>\n\nCan you check that the `io.so` dynamic object is properly linked to libgap? With the right path.",
    "created_at": "2022-11-30T19:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558671",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:98" align="right">Comment 98</div>

Can you check that the `io.so` dynamic object is properly linked to libgap? With the right path.



---

archive/issue_comments_558672.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">Comment 99</div>\n\nReplying to [Fran\u00e7ois Bissey](#comment%3A98):\n> Can you check that the `io.so` dynamic object is properly linked to libgap? With the right path.\n\nit's not, and this is by design. it's meant to be loaded by libgap, not the other way around.\nIt's probably a race condition of some kind.",
    "created_at": "2022-11-30T20:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558672",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:99" align="right">Comment 99</div>

Replying to [Franois Bissey](#comment%3A98):
> Can you check that the `io.so` dynamic object is properly linked to libgap? With the right path.

it's not, and this is by design. it's meant to be loaded by libgap, not the other way around.
It's probably a race condition of some kind.



---

archive/issue_comments_558673.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nsee https://github.com/gap-system/gap/issues/5232 for an upstream report. Fortunately it can be reproduced within GAP's testsuite.",
    "created_at": "2022-11-30T21:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558673",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:0" align="right">Comment 0</div>

see https://github.com/gap-system/gap/issues/5232 for an upstream report. Fortunately it can be reproduced within GAP's testsuite.



---

archive/issue_comments_558674.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2022-11-30T21:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558674",
    "user": "https://github.com/dimpase"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_558675.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nDima pointed me here.\n\nI already communicated various comments to him on our (GAP's) issue tracker. But I also just had a look at the overall diff for the changes so far. Some remarks:\n\nWe have a new helper function `CALL_WITH_STREAM` which you could use to rewrite your `capture_stdout` with pure GAP. As an example, in `GAP.jl` (Julia interface to GAP), I use these two helpers; adapting that code to match `capture_stdout` is straight-forward. Note that I use `SetPrintFormattingStatus` there to avoid diffs caused by the width of the user's terminal; but if you want to 100% faithfully reproduce what GAP does, then leave that out.\n\n```\nBindGlobal( \"StringDisplayObj\",\nfunction(obj)\n  local str, out;\n  str := \"\";\n  out := OutputTextString(str, false);\n  SetPrintFormattingStatus(out, false);\n  CALL_WITH_STREAM(out, Display, [obj]);\n  CloseStream(out);\n  return str;\nend );\n\nBindGlobal( \"StringViewObj\",\nfunction(obj)\n  local str, out;\n  str := \"\";\n  out := OutputTextString(str, false);\n  SetPrintFormattingStatus(out, false);\n  CALL_WITH_STREAM(out, ViewObj, [obj]);\n  CloseStream(out);\n  return str;\nend );\n```\nThis is of course in the end equivalent to what `capture_stdout` does, but while `CALL_WITH_STREAM` is also undocumented, it'll be more stable than calling internal kernel functions like  `OpenOutputStream`. We could also eventually offer a documented, high-level version of it as `CallWithStream`; the main reason that's not yet there is that I first wanted to validate the design. If Sage also finds it useful, that would be a strong motivation to provide a fully documented `CallWithStream` in GAP 4.13. In addition or alternatively, functions like `StringViewObj` or `StringPrint` could be provided, but there it is already less clear that we can agree on a common version (see `SetPrintFormattingStatus` ...) ?\n\n\n\n- Another point: you could replace your uses of `GVarName` and `AssGVar` by `GAP_AssignGlobalVariable` (the performance overhead of re-calling `GVarName` should be miniscule; if `hold_reference` ever is called in a tight loop, that code likely has more serious problems than that...\n\n- alternatively just remove `hold_reference` (nothing uses it?)\n\n- remove `NewBag` and `CallbackForAllBags` from `gap_includes.pxd` ?\n\n- there are a lot of other things that could be replaced by \"official\" libgap API usage, e.g. `IS_INT` -> `GAP_IsInt`, `IS_INTOBJ` -> `GAP_IsSmallInt`, `SUM` -> `GAP_SUM`, `VAL_MACFLOAT` -> `GAP_ValueMacFloat`, etc. -- most of these were added specifically for use by Sage years ago but apparently are not actually used by Sage? Overall I would expect that a majority of the imports from outside `libgap-api.h` can be replaced. If someone wants to work on that and needs help to figure out what replaces what, I'll be happy to assist",
    "created_at": "2022-12-01T15:03:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558675",
    "user": "https://github.com/fingolfin"
}
```

<div id="comment:1" align="right">Comment 1</div>

Dima pointed me here.

I already communicated various comments to him on our (GAP's) issue tracker. But I also just had a look at the overall diff for the changes so far. Some remarks:

We have a new helper function `CALL_WITH_STREAM` which you could use to rewrite your `capture_stdout` with pure GAP. As an example, in `GAP.jl` (Julia interface to GAP), I use these two helpers; adapting that code to match `capture_stdout` is straight-forward. Note that I use `SetPrintFormattingStatus` there to avoid diffs caused by the width of the user's terminal; but if you want to 100% faithfully reproduce what GAP does, then leave that out.

```
BindGlobal( "StringDisplayObj",
function(obj)
  local str, out;
  str := "";
  out := OutputTextString(str, false);
  SetPrintFormattingStatus(out, false);
  CALL_WITH_STREAM(out, Display, [obj]);
  CloseStream(out);
  return str;
end );

BindGlobal( "StringViewObj",
function(obj)
  local str, out;
  str := "";
  out := OutputTextString(str, false);
  SetPrintFormattingStatus(out, false);
  CALL_WITH_STREAM(out, ViewObj, [obj]);
  CloseStream(out);
  return str;
end );
```
This is of course in the end equivalent to what `capture_stdout` does, but while `CALL_WITH_STREAM` is also undocumented, it'll be more stable than calling internal kernel functions like  `OpenOutputStream`. We could also eventually offer a documented, high-level version of it as `CallWithStream`; the main reason that's not yet there is that I first wanted to validate the design. If Sage also finds it useful, that would be a strong motivation to provide a fully documented `CallWithStream` in GAP 4.13. In addition or alternatively, functions like `StringViewObj` or `StringPrint` could be provided, but there it is already less clear that we can agree on a common version (see `SetPrintFormattingStatus` ...) ?



- Another point: you could replace your uses of `GVarName` and `AssGVar` by `GAP_AssignGlobalVariable` (the performance overhead of re-calling `GVarName` should be miniscule; if `hold_reference` ever is called in a tight loop, that code likely has more serious problems than that...

- alternatively just remove `hold_reference` (nothing uses it?)

- remove `NewBag` and `CallbackForAllBags` from `gap_includes.pxd` ?

- there are a lot of other things that could be replaced by "official" libgap API usage, e.g. `IS_INT` -> `GAP_IsInt`, `IS_INTOBJ` -> `GAP_IsSmallInt`, `SUM` -> `GAP_SUM`, `VAL_MACFLOAT` -> `GAP_ValueMacFloat`, etc. -- most of these were added specifically for use by Sage years ago but apparently are not actually used by Sage? Overall I would expect that a majority of the imports from outside `libgap-api.h` can be replaced. If someone wants to work on that and needs help to figure out what replaces what, I'll be happy to assist



---

archive/issue_comments_558676.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nI just noticed you do this, so I am guessing you will want to also use `SetPrintFormattingStatus` as mentioned above, as a better alternative to that hack\n\n```\n    argv[8] = \"-x\"    # set the \"screen\" width so that GAP is less likely to\n    argv[9] = \"4096\"  # insert newlines when printing objects\n                      # 4096 unfortunately is the hard-coded max, but should\n                      # be long enough for most cases\n\n```\n\nYou also have the following:\n\n```\n    argv[1] = \"-l\"\n    s = str_to_bytes(gap_root(), FS_ENCODING, \"surrogateescape\")\n    argv[2] = s\n\n```\n\nThis shouldn't be necessary anymore in 4.12.2 (due in ~2 weeks), thanks to https://github.com/gap-system/gap/pull/5193",
    "created_at": "2022-12-01T17:15:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558676",
    "user": "https://github.com/fingolfin"
}
```

<div id="comment:2" align="right">Comment 2</div>

I just noticed you do this, so I am guessing you will want to also use `SetPrintFormattingStatus` as mentioned above, as a better alternative to that hack

```
    argv[8] = "-x"    # set the "screen" width so that GAP is less likely to
    argv[9] = "4096"  # insert newlines when printing objects
                      # 4096 unfortunately is the hard-coded max, but should
                      # be long enough for most cases

```

You also have the following:

```
    argv[1] = "-l"
    s = str_to_bytes(gap_root(), FS_ENCODING, "surrogateescape")
    argv[2] = s

```

This shouldn't be necessary anymore in 4.12.2 (due in ~2 weeks), thanks to https://github.com/gap-system/gap/pull/5193



---

archive/issue_comments_558677.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nThis ticket is just an effort to get the ball rolling towards upgrading to GAP 4.12. Improvements to the intetface to libgap should not take place here, it's heavy enough as it is.\n\nWe are still hoping that https://pypi.org/project/gappy-system/ (also https://github.com/embray/gappy) will be a proper replacement for our libgap interface, but unfortunately gappy is  stalled, as @embray is at greener pastures nowadays.",
    "created_at": "2022-12-01T17:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558677",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">Comment 3</div>

This ticket is just an effort to get the ball rolling towards upgrading to GAP 4.12. Improvements to the intetface to libgap should not take place here, it's heavy enough as it is.

We are still hoping that https://pypi.org/project/gappy-system/ (also https://github.com/embray/gappy) will be a proper replacement for our libgap interface, but unfortunately gappy is  stalled, as @embray is at greener pastures nowadays.



---

archive/issue_comments_558678.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548\">29383be</a></td><td><code>backport GAP PR 5235</code></td></tr></table>\n",
    "created_at": "2022-12-01T17:36:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558678",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4" align="right">Comment 4</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548">29383be</a></td><td><code>backport GAP PR 5235</code></td></tr></table>




---

archive/issue_comments_558679.json:
```json
{
    "body": "Changed commit from **[71c9fe3](https://github.com/sagemath/sagetrac-mirror/commit/71c9fe337455d52637e0272fccdd633d8e96fa2e)** to **[29383be](https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548)**",
    "created_at": "2022-12-01T17:36:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558679",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[71c9fe3](https://github.com/sagemath/sagetrac-mirror/commit/71c9fe337455d52637e0272fccdd633d8e96fa2e)** to **[29383be](https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548)**



---

archive/issue_comments_558680.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">Comment 105</div>\n\nReplying to [@sagetrac-git](#comment%3A104):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548\">29383be</a></td><td><code>backport GAP PR 5235</code></td></tr></table>\n\nthis fixes the issue in [comment:100](#comment%3A100).\n\nReady for review, again.",
    "created_at": "2022-12-01T23:15:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558680",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:105" align="right">Comment 105</div>

Replying to [@sagetrac-git](#comment%3A104):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548">29383be</a></td><td><code>backport GAP PR 5235</code></td></tr></table>

this fixes the issue in [comment:100](#comment%3A100).

Ready for review, again.



---

archive/issue_comments_558681.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Completely fixed; Fix reported upstream**",
    "created_at": "2022-12-01T23:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558681",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Completely fixed; Fix reported upstream**



---

archive/issue_comments_558682.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\n> This ticket is just an effort to get the ball rolling towards upgrading to GAP 4.12. Improvements to the intetface to libgap should not take place here, it's heavy enough as it is.\n\nThat makes perfect sense. So, view this as an offer: if someone would like to tackle cleaning up some of these things, feel free to contact me for assistance.\n\n\nIn other news, as some of you are probably already aware, we just release GAP 4.12.2 which should make some of the patches here unnecessary.",
    "created_at": "2022-12-19T08:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558682",
    "user": "https://github.com/fingolfin"
}
```

<div id="comment:7" align="right">Comment 7</div>

> This ticket is just an effort to get the ball rolling towards upgrading to GAP 4.12. Improvements to the intetface to libgap should not take place here, it's heavy enough as it is.

That makes perfect sense. So, view this as an offer: if someone would like to tackle cleaning up some of these things, feel free to contact me for assistance.


In other news, as some of you are probably already aware, we just release GAP 4.12.2 which should make some of the patches here unnecessary.



---

archive/issue_comments_558683.json:
```json
{
    "body": "Changed work issues from **simplify spkg-install to use GAP make install to $prefix** to **upgrade to 4.12.2**",
    "created_at": "2022-12-19T09:20:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558683",
    "user": "https://github.com/dimpase"
}
```

Changed work issues from **simplify spkg-install to use GAP make install to $prefix** to **upgrade to 4.12.2**



---

archive/issue_comments_558684.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nYes, we'll definitely use 4.12.2",
    "created_at": "2022-12-19T09:20:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558684",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">Comment 8</div>

Yes, we'll definitely use 4.12.2



---

archive/issue_events_451590.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-12-19T09:20:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451590"
}
```



---

archive/issue_events_451591.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-12-19T09:20:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451591"
}
```



---

archive/issue_events_451592.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-07T13:26:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451592"
}
```



---

archive/issue_events_451593.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-07T13:26:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451593"
}
```



---

archive/issue_comments_558685.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cff673e17fb6b4ed510d23107616fe7e44edf4b\">4cff673</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90788f1ef38937fbb24503099b66666dedf0ac5b\">90788f1</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f026ce0c988bd4483092c841006ef13c928a0801\">f026ce0</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7fd435e6e3b18c9f3aaa16663471836c80cc6dcc\">7fd435e</a></td><td><code>don't use SAGE_LOCAL/share/gap, switch to GAP's \"make install\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2a48bd3ec50fa81c6a2afbedcbcd66c9052cfd0\">c2a48bd</a></td><td><code>Search for files in both lib/gap and share/gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/844eda69cab7c0ab7ba4926ff5c0c0f4939b513a\">844eda6</a></td><td><code>Create lib/gap/bin on install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/600cd3df88357f51973a1c8c72d3afbf900a174c\">600cd3d</a></td><td><code>ensure make gap-clean still works</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd1cc83e93165c451811838c0f2c8a7ee70f4169\">bd1cc83</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4245cf3a7beb8f5b03d452ae4ee7e57ce36744e\">d4245cf</a></td><td><code>backport GAP PR 5235</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d08af35a6037a7e2175736c0ea3ad63aa44fce17\">d08af35</a></td><td><code>update GAP to 4.12.2</code></td></tr></table>\n",
    "created_at": "2023-01-07T13:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558685",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">Comment 9</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cff673e17fb6b4ed510d23107616fe7e44edf4b">4cff673</a></td><td><code>install GAP package singular - new dependency of liepring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90788f1ef38937fbb24503099b66666dedf0ac5b">90788f1</a></td><td><code>moved install of radiroot to gap from gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f026ce0c988bd4483092c841006ef13c928a0801">f026ce0</a></td><td><code>moved install of autodoc and utils to gap from gap_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7fd435e6e3b18c9f3aaa16663471836c80cc6dcc">7fd435e</a></td><td><code>don't use SAGE_LOCAL/share/gap, switch to GAP's "make install"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2a48bd3ec50fa81c6a2afbedcbcd66c9052cfd0">c2a48bd</a></td><td><code>Search for files in both lib/gap and share/gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/844eda69cab7c0ab7ba4926ff5c0c0f4939b513a">844eda6</a></td><td><code>Create lib/gap/bin on install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/600cd3df88357f51973a1c8c72d3afbf900a174c">600cd3d</a></td><td><code>ensure make gap-clean still works</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd1cc83e93165c451811838c0f2c8a7ee70f4169">bd1cc83</a></td><td><code>with SAGE_CHECK=yes, one needs io installed to prevent hangs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4245cf3a7beb8f5b03d452ae4ee7e57ce36744e">d4245cf</a></td><td><code>backport GAP PR 5235</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d08af35a6037a7e2175736c0ea3ad63aa44fce17">d08af35</a></td><td><code>update GAP to 4.12.2</code></td></tr></table>




---

archive/issue_comments_558686.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)** to **[u/dimpase/packages/gap/4_12_2](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_2)**",
    "created_at": "2023-01-07T13:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558686",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/dimpase/packages/gap/4_12_1](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_1)** to **[u/dimpase/packages/gap/4_12_2](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gap/4_12_2)**



---

archive/issue_comments_558687.json:
```json
{
    "body": "Changed work issues from **upgrade to 4.12.2** to none",
    "created_at": "2023-01-07T13:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558687",
    "user": "https://github.com/dimpase"
}
```

Changed work issues from **upgrade to 4.12.2** to none



---

archive/issue_comments_558688.json:
```json
{
    "body": "Changed commit from **[29383be](https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548)** to **[d08af35](https://github.com/sagemath/sagetrac-mirror/commit/d08af35a6037a7e2175736c0ea3ad63aa44fce17)**",
    "created_at": "2023-01-07T13:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558688",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[29383be](https://github.com/sagemath/sagetrac-mirror/commit/29383be9dbea4e49004ed57d5f23e34155174548)** to **[d08af35](https://github.com/sagemath/sagetrac-mirror/commit/d08af35a6037a7e2175736c0ea3ad63aa44fce17)**



---

archive/issue_events_451594.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-07T14:29:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451594"
}
```



---

archive/issue_events_451595.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-07T14:29:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451595"
}
```



---

archive/issue_comments_558689.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nwe need to bump libsemigroups",
    "created_at": "2023-01-07T14:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558689",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:0" align="right">Comment 0</div>

we need to bump libsemigroups



---

archive/issue_comments_558690.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/058c1f33908afadefa79a926db41b1a0ca4a2f0d\">058c1f3</a></td><td><code>bump libsemigroups to v2.3.2</code></td></tr></table>\n",
    "created_at": "2023-01-07T15:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558690",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1" align="right">Comment 1</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/058c1f33908afadefa79a926db41b1a0ca4a2f0d">058c1f3</a></td><td><code>bump libsemigroups to v2.3.2</code></td></tr></table>




---

archive/issue_comments_558691.json:
```json
{
    "body": "Changed commit from **[d08af35](https://github.com/sagemath/sagetrac-mirror/commit/d08af35a6037a7e2175736c0ea3ad63aa44fce17)** to **[058c1f3](https://github.com/sagemath/sagetrac-mirror/commit/058c1f33908afadefa79a926db41b1a0ca4a2f0d)**",
    "created_at": "2023-01-07T15:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558691",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d08af35](https://github.com/sagemath/sagetrac-mirror/commit/d08af35a6037a7e2175736c0ea3ad63aa44fce17)** to **[058c1f3](https://github.com/sagemath/sagetrac-mirror/commit/058c1f33908afadefa79a926db41b1a0ca4a2f0d)**



---

archive/issue_events_451596.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-07T15:01:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451596"
}
```



---

archive/issue_events_451597.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-07T15:01:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34391#event-451597"
}
```



---

archive/issue_comments_558692.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nrunning GH Actions tests on \n\nhttps://github.com/sagemath/sagetrac-mirror/actions/runs/3877670681 \n\nand\n\nhttps://github.com/sagemath/sagetrac-mirror/actions/runs/3877665024",
    "created_at": "2023-01-09T21:12:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34391#issuecomment-558692",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">Comment 3</div>

running GH Actions tests on 

https://github.com/sagemath/sagetrac-mirror/actions/runs/3877670681 

and

https://github.com/sagemath/sagetrac-mirror/actions/runs/3877665024
