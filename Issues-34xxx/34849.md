# Issue 34849: More fixes to support tox 4

archive/issues_034612.json:
```json
{
    "body": "The tox.ini files in pkgs/*/ are broken with tox 4.\n\nEarly versions of tox 4.0.x have additional defects.\n\n- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n\n- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15\n\nAnd autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634\n\nHere we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n\n\nFollow up: #34840 Upgrade tox to 4.x\n\n\nCC:  @fchapoton @dimpase\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/more_fixes_to_support_tox_4\n\nStatus: needs_review\n\nDependencies: #34839\n\nCommit: 1999bd6f42480d570deb10f85d6d4219c2936af4\n\nIssue created by migration from https://trac.sagemath.org/ticket/34849\n\n",
    "created_at": "2022-12-14T19:46:23Z",
    "labels": [
        "component: scripts",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "More fixes to support tox 4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34849",
    "user": "https://github.com/mkoeppe"
}
```
The tox.ini files in pkgs/*/ are broken with tox 4.

Early versions of tox 4.0.x have additional defects.

- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13

- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15

And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634

Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.


Follow up: #34840 Upgrade tox to 4.x


CC:  @fchapoton @dimpase

Author: Matthias Koeppe

Branch: u/mkoeppe/more_fixes_to_support_tox_4

Status: needs_review

Dependencies: #34839

Commit: 1999bd6f42480d570deb10f85d6d4219c2936af4

Issue created by migration from https://trac.sagemath.org/ticket/34849





---

archive/issue_comments_522648.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n The tox.ini files in pkgs/*/ are broken with tox 4.\n \n+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv`\n+\n And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n+\n \n Dependencies: #34839\n \n```\n",
    "created_at": "2022-12-14T19:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34849#issuecomment-522648",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,9 @@
 The tox.ini files in pkgs/*/ are broken with tox 4.
 
+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv`
+
 And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
+
 
 Dependencies: #34839
 
```




---

archive/issue_comments_522649.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+The tox.ini files in pkgs/*/ are broken with tox 4.\n+\n+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n+\n+And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n \n \n Dependencies: #34839\n```\n",
    "created_at": "2022-12-18T19:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34849#issuecomment-522649",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,8 @@
+The tox.ini files in pkgs/*/ are broken with tox 4.
+
+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
+
+And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
 
 
 Dependencies: #34839
```




---

archive/issue_comments_522650.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+The tox.ini files in pkgs/*/ are broken with tox 4.\n+\n+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n+\n+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747\n+\n+And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n \n \n Dependencies: #34839\n```\n",
    "created_at": "2022-12-18T19:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34849#issuecomment-522650",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,10 @@
+The tox.ini files in pkgs/*/ are broken with tox 4.
+
+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
+
+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747
+
+And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
 
 
 Dependencies: #34839
```




---

archive/issue_comments_522651.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+The tox.ini files in pkgs/*/ are broken with tox 4.\n+\n+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n+\n+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15\n+\n+And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n \n \n Dependencies: #34839\n```\n",
    "created_at": "2022-12-20T00:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34849#issuecomment-522651",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,10 @@
+The tox.ini files in pkgs/*/ are broken with tox 4.
+
+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
+
+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15
+
+And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
 
 
 Dependencies: #34839
```




---

archive/issue_comments_522652.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-20T01:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34849#issuecomment-522652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_522653.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+The tox.ini files in pkgs/*/ are broken with tox 4.\n+\n+Early versions of tox 4.0.x have additional defects.\n+\n+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n+\n+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15\n+\n+And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634\n+\n+Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n+\n+\n+Follow up: #34840 Upgrade tox to 4.x\n \n \n Dependencies: #34839\n```\n",
    "created_at": "2022-12-20T01:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34849#issuecomment-522653",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+The tox.ini files in pkgs/*/ are broken with tox 4.
+
+Early versions of tox 4.0.x have additional defects.
+
+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
+
+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15
+
+And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634
+
+Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.
+
+
+Follow up: #34840 Upgrade tox to 4.x
 
 
 Dependencies: #34839
```




---

archive/issue_comments_522654.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-12-20T02:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34849#issuecomment-522654",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.
