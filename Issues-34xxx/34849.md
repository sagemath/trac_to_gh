# Issue 34849: More fixes to support tox 4

archive/issues_034612.json:
```json
{
    "assignees": [],
    "body": "The tox.ini files in pkgs/*/ are broken with tox 4.\n\nEarly versions of tox 4.x have additional defects.\n\n- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n\n- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15\n\n- And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634\n\n- In SAGE_ROOT/tox.ini, in tox 4 earlier than 4.2.7, numerical factors are broken because they are misinterpreted as Python versions (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); e.g., 4.0.14 is broken:\n\n  ```\n  tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*\n  docker-linuxmint-21.1-standard: skipped because could not find python interpreter with spec(s): 21.1\n    docker-linuxmint-21.1-standard: SKIP (1.98 seconds)\n  ```\n\nHere we update affected `tox.ini` files so that:\n- src/tox.ini and pkgs/*/tox.ini work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n- SAGE_ROOT/tox.ini work with tox >= 4.2.7 (autoprovisioning if necessary)\n\nFollow up: \n- #34840 Upgrade tox to 4.x\n\n\nDepends on #34839\n\nCC:  @fchapoton @dimpase\n\nBranch/Commit: **[u/mkoeppe/more_fixes_to_support_tox_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/more_fixes_to_support_tox_4) @ [`a2eb816`](https://github.com/sagemath/sagetrac-mirror/commit/a2eb816f4f265d30e5f9e8b3721ee4c703a29e9b)**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **scripts**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34849_\n\n",
    "created_at": "2022-12-14T19:46:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20scripts",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "More fixes to support tox 4",
    "type": "issue",
    "updated_at": "2023-01-14T18:40:08Z",
    "url": "https://github.com/sagemath/sage/issues/34849",
    "user": "https://github.com/mkoeppe"
}
```
The tox.ini files in pkgs/*/ are broken with tox 4.

Early versions of tox 4.x have additional defects.

- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13

- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15

- And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634

- In SAGE_ROOT/tox.ini, in tox 4 earlier than 4.2.7, numerical factors are broken because they are misinterpreted as Python versions (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); e.g., 4.0.14 is broken:

  ```
  tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*
  docker-linuxmint-21.1-standard: skipped because could not find python interpreter with spec(s): 21.1
    docker-linuxmint-21.1-standard: SKIP (1.98 seconds)
  ```

Here we update affected `tox.ini` files so that:
- src/tox.ini and pkgs/*/tox.ini work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.
- SAGE_ROOT/tox.ini work with tox >= 4.2.7 (autoprovisioning if necessary)

Follow up: 
- #34840 Upgrade tox to 4.x


Depends on #34839

CC:  @fchapoton @dimpase

Branch/Commit: **[u/mkoeppe/more_fixes_to_support_tox_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/more_fixes_to_support_tox_4) @ [`a2eb816`](https://github.com/sagemath/sagetrac-mirror/commit/a2eb816f4f265d30e5f9e8b3721ee4c703a29e9b)**

Author: **Matthias Koeppe**

Component: **scripts**

_Issue created by migration from https://trac.sagemath.org/ticket/34849_





---

archive/issue_events_470835.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-14T19:46:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470835"
}
```



---

archive/issue_events_470836.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-14T19:46:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20scripts",
    "label_color": "0000b0",
    "label_name": "c: scripts",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470836"
}
```



---

archive/issue_events_470837.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-14T19:46:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470837"
}
```



---

archive/issue_events_470838.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-14T19:46:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470838"
}
```



---

archive/issue_comments_561528.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The tox.ini files in pkgs/*/ are broken with tox 4.\n+\n+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv`\n \n And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n \n``````\n",
    "created_at": "2022-12-14T19:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561528",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The tox.ini files in pkgs/*/ are broken with tox 4.
+
+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv`
 
 And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
 
``````




---

archive/issue_comments_561529.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n The tox.ini files in pkgs/*/ are broken with tox 4.\n \n-- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv`\n+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n \n And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n \n``````\n",
    "created_at": "2022-12-18T19:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561529",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 The tox.ini files in pkgs/*/ are broken with tox 4.
 
-- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv`
+- https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
 
 And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
 
``````




---

archive/issue_comments_561530.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,7 @@\n \n - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n \n+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747\n+\n And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n \n``````\n",
    "created_at": "2022-12-18T19:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561530",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,7 @@
 
 - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
 
+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747
+
 And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
 
``````




---

archive/issue_comments_561531.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n \n-- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747\n+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15\n \n And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n \n``````\n",
    "created_at": "2022-12-20T00:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561531",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
 
-- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747
+- negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15
 
 And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
 
``````




---

archive/issue_comments_561532.json:
```json
{
    "body": "Branch: **[u/mkoeppe/more_fixes_to_support_tox_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/more_fixes_to_support_tox_4)**",
    "created_at": "2022-12-20T00:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561532",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/more_fixes_to_support_tox_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/more_fixes_to_support_tox_4)**



---

archive/issue_comments_561533.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d302a628936a965d4e5c3501b7989028274fac95\"><code>d302a62</code></a></td><td><code>tox.ini, src/tox.ini: Adjust to tox 4, autoprovision tox >= 3.18</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8703aeba13b8663e55b46494dec4fd305e65374\"><code>f8703ae</code></a></td><td><code>.github/workflows/lint.yml: Invoke tox with --</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d76204fb5801054755b2e7bc54aeb6743742ced\"><code>9d76204</code></a></td><td><code>fix some rst issues in sage_docbuild and sage_setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a27a3d089dff6f50dde00a68d896e28fed9a9c8\"><code>4a27a3d</code></a></td><td><code>Merge #34839</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95fe89ab0635531f4626a5711343fb47da280374\"><code>95fe89a</code></a></td><td><code>build/pkgs/tox/spkg-configure.m4: Check for good tox 3, tox 4 versions separately</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc7196abb897a2b3d5bb939e800131b77322dd38\"><code>cc7196a</code></a></td><td><code>src/tox.ini: More allowlist_externals for tox 4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1999bd6f42480d570deb10f85d6d4219c2936af4\"><code>1999bd6</code></a></td><td><code>src/tox.ini: Quoting fix for tox 4</code></td></tr></table>\n",
    "created_at": "2022-12-20T01:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561533",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d302a628936a965d4e5c3501b7989028274fac95"><code>d302a62</code></a></td><td><code>tox.ini, src/tox.ini: Adjust to tox 4, autoprovision tox >= 3.18</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8703aeba13b8663e55b46494dec4fd305e65374"><code>f8703ae</code></a></td><td><code>.github/workflows/lint.yml: Invoke tox with --</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d76204fb5801054755b2e7bc54aeb6743742ced"><code>9d76204</code></a></td><td><code>fix some rst issues in sage_docbuild and sage_setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a27a3d089dff6f50dde00a68d896e28fed9a9c8"><code>4a27a3d</code></a></td><td><code>Merge #34839</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95fe89ab0635531f4626a5711343fb47da280374"><code>95fe89a</code></a></td><td><code>build/pkgs/tox/spkg-configure.m4: Check for good tox 3, tox 4 versions separately</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc7196abb897a2b3d5bb939e800131b77322dd38"><code>cc7196a</code></a></td><td><code>src/tox.ini: More allowlist_externals for tox 4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1999bd6f42480d570deb10f85d6d4219c2936af4"><code>1999bd6</code></a></td><td><code>src/tox.ini: Quoting fix for tox 4</code></td></tr></table>




---

archive/issue_comments_561534.json:
```json
{
    "body": "Commit: **[`1999bd6`](https://github.com/sagemath/sagetrac-mirror/commit/1999bd6f42480d570deb10f85d6d4219c2936af4)**",
    "created_at": "2022-12-20T01:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561534",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`1999bd6`](https://github.com/sagemath/sagetrac-mirror/commit/1999bd6f42480d570deb10f85d6d4219c2936af4)**



---

archive/issue_comments_561535.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,15 @@\n The tox.ini files in pkgs/*/ are broken with tox 4.\n+\n+Early versions of tox 4.0.x have additional defects.\n \n - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n \n - negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15\n \n-And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634\n+And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634\n \n+Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n+\n+\n+Follow up: #34840 Upgrade tox to 4.x\n+\n``````\n",
    "created_at": "2022-12-20T01:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561535",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,15 @@
 The tox.ini files in pkgs/*/ are broken with tox 4.
+
+Early versions of tox 4.0.x have additional defects.
 
 - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
 
 - negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15
 
-And autoprovisioning for downgrade is not working - https://github.com/tox-dev/tox/issues/2634
+And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634
 
+Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.
+
+
+Follow up: #34840 Upgrade tox to 4.x
+
``````




---

archive/issue_comments_561536.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2022-12-20T01:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561536",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_470839.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-20T02:19:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470839"
}
```



---

archive/issue_comments_561537.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/071c113fe6f7d4405b4f470c6f3ff02eb8359e3d\"><code>071c113</code></a></td><td><code>Merge tag '9.8.beta6' into t/34849/more_fixes_to_support_tox_4</code></td></tr></table>\n",
    "created_at": "2023-01-07T08:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561537",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/071c113fe6f7d4405b4f470c6f3ff02eb8359e3d"><code>071c113</code></a></td><td><code>Merge tag '9.8.beta6' into t/34849/more_fixes_to_support_tox_4</code></td></tr></table>




---

archive/issue_comments_561538.json:
```json
{
    "body": "Changed commit from **[`1999bd6`](https://github.com/sagemath/sagetrac-mirror/commit/1999bd6f42480d570deb10f85d6d4219c2936af4)** to **[`071c113`](https://github.com/sagemath/sagetrac-mirror/commit/071c113fe6f7d4405b4f470c6f3ff02eb8359e3d)**",
    "created_at": "2023-01-07T08:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561538",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1999bd6`](https://github.com/sagemath/sagetrac-mirror/commit/1999bd6f42480d570deb10f85d6d4219c2936af4)** to **[`071c113`](https://github.com/sagemath/sagetrac-mirror/commit/071c113fe6f7d4405b4f470c6f3ff02eb8359e3d)**



---

archive/issue_comments_561539.json:
```json
{
    "body": "Changed commit from **[`071c113`](https://github.com/sagemath/sagetrac-mirror/commit/071c113fe6f7d4405b4f470c6f3ff02eb8359e3d)** to **[`6b8c666`](https://github.com/sagemath/sagetrac-mirror/commit/6b8c666119fd96115b4efafc3b23984fdacf0f6b)**",
    "created_at": "2023-01-07T08:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561539",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`071c113`](https://github.com/sagemath/sagetrac-mirror/commit/071c113fe6f7d4405b4f470c6f3ff02eb8359e3d)** to **[`6b8c666`](https://github.com/sagemath/sagetrac-mirror/commit/6b8c666119fd96115b4efafc3b23984fdacf0f6b)**



---

archive/issue_comments_561540.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70da140f5f430c1cab53a858a8b33d43d23baf1e\"><code>70da140</code></a></td><td><code>Merge branch 'u/chapoton/support_tox_4' in 9.8.b6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b8c666119fd96115b4efafc3b23984fdacf0f6b\"><code>6b8c666</code></a></td><td><code>Merge #34839</code></td></tr></table>\n",
    "created_at": "2023-01-07T08:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561540",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70da140f5f430c1cab53a858a8b33d43d23baf1e"><code>70da140</code></a></td><td><code>Merge branch 'u/chapoton/support_tox_4' in 9.8.b6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b8c666119fd96115b4efafc3b23984fdacf0f6b"><code>6b8c666</code></a></td><td><code>Merge #34839</code></td></tr></table>




---

archive/issue_comments_561541.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,5 +11,13 @@\n Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n \n \n-Follow up: #34840 Upgrade tox to 4.x\n+Follow up: \n+- Also fix numerical factors\n \n+  ```\n+  tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*\n+  docker-linuxmint-21.1-standard: skipped because could not find python interpreter with spec(s): 21.1\n+    docker-linuxmint-21.1-standard: SKIP (1.98 seconds)\n+  ```\n+- #34840 Upgrade tox to 4.x\n+\n``````\n",
    "created_at": "2023-01-13T09:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561541",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,5 +11,13 @@
 Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.
 
 
-Follow up: #34840 Upgrade tox to 4.x
+Follow up: 
+- Also fix numerical factors
 
+  ```
+  tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*
+  docker-linuxmint-21.1-standard: skipped because could not find python interpreter with spec(s): 21.1
+    docker-linuxmint-21.1-standard: SKIP (1.98 seconds)
+  ```
+- #34840 Upgrade tox to 4.x
+
``````




---

archive/issue_comments_561542.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,13 +11,15 @@\n Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n \n \n-Follow up: \n-- Also fix numerical factors\n+TODO:\n+- Set a lower version bound so that numerical factors work (4.0.14 is broken; 4.2.8 is OK)\n \n   ```\n   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*\n   docker-linuxmint-21.1-standard: skipped because could not find python interpreter with spec(s): 21.1\n     docker-linuxmint-21.1-standard: SKIP (1.98 seconds)\n   ```\n+\n+Follow up: \n - #34840 Upgrade tox to 4.x\n \n``````\n",
    "created_at": "2023-01-13T10:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561542",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,13 +11,15 @@
 Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.
 
 
-Follow up: 
-- Also fix numerical factors
+TODO:
+- Set a lower version bound so that numerical factors work (4.0.14 is broken; 4.2.8 is OK)
 
   ```
   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*
   docker-linuxmint-21.1-standard: skipped because could not find python interpreter with spec(s): 21.1
     docker-linuxmint-21.1-standard: SKIP (1.98 seconds)
   ```
+
+Follow up: 
 - #34840 Upgrade tox to 4.x
 
``````




---

archive/issue_events_470840.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-13T10:00:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470840"
}
```



---

archive/issue_events_470841.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-13T10:00:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470841"
}
```



---

archive/issue_comments_561543.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n \n \n TODO:\n-- Set a lower version bound so that numerical factors work (4.0.14 is broken; 4.2.8 is OK)\n+- Set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:\n \n   ```\n   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*\n``````\n",
    "created_at": "2023-01-13T10:03:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561543",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 
 
 TODO:
-- Set a lower version bound so that numerical factors work (4.0.14 is broken; 4.2.8 is OK)
+- Set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:
 
   ```
   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*
``````




---

archive/issue_comments_561544.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n \n \n TODO:\n-- Set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:\n+- In SAGE_ROOT/tox.ini, set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:\n \n   ```\n   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*\n``````\n",
    "created_at": "2023-01-13T10:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561544",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 
 
 TODO:
-- Set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:
+- In SAGE_ROOT/tox.ini, set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:
 
   ```
   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*
``````




---

archive/issue_comments_561545.json:
```json
{
    "body": "Changed commit from **[`6b8c666`](https://github.com/sagemath/sagetrac-mirror/commit/6b8c666119fd96115b4efafc3b23984fdacf0f6b)** to **[`a2eb816`](https://github.com/sagemath/sagetrac-mirror/commit/a2eb816f4f265d30e5f9e8b3721ee4c703a29e9b)**",
    "created_at": "2023-01-13T10:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561545",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6b8c666`](https://github.com/sagemath/sagetrac-mirror/commit/6b8c666119fd96115b4efafc3b23984fdacf0f6b)** to **[`a2eb816`](https://github.com/sagemath/sagetrac-mirror/commit/a2eb816f4f265d30e5f9e8b3721ee4c703a29e9b)**



---

archive/issue_comments_561546.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2eb816f4f265d30e5f9e8b3721ee4c703a29e9b\"><code>a2eb816</code></a></td><td><code>tox.ini: Require tox >= 4.2.7</code></td></tr></table>\n",
    "created_at": "2023-01-13T10:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561546",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2eb816f4f265d30e5f9e8b3721ee4c703a29e9b"><code>a2eb816</code></a></td><td><code>tox.ini: Require tox >= 4.2.7</code></td></tr></table>




---

archive/issue_events_470842.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-13T10:17:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470842"
}
```



---

archive/issue_events_470843.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-13T10:17:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470843"
}
```



---

archive/issue_comments_561547.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,14 @@\n The tox.ini files in pkgs/*/ are broken with tox 4.\n \n-Early versions of tox 4.0.x have additional defects.\n+Early versions of tox 4.x have additional defects.\n \n - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13\n \n - negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15\n \n-And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634\n+- And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634\n \n-Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n-\n-\n-TODO:\n-- In SAGE_ROOT/tox.ini, set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:\n+- In SAGE_ROOT/tox.ini, in tox 4 earlier than 4.2.7, numerical factors are broken because they are misinterpreted as Python versions (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); e.g., 4.0.14 is broken:\n \n   ```\n   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*\n@@ -20,6 +16,10 @@\n     docker-linuxmint-21.1-standard: SKIP (1.98 seconds)\n   ```\n \n+Here we update affected `tox.ini` files so that:\n+- src/tox.ini and pkgs/*/tox.ini work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.\n+- SAGE_ROOT/tox.ini work with tox >= 4.2.7 (autoprovisioning if necessary)\n+\n Follow up: \n - #34840 Upgrade tox to 4.x\n \n``````\n",
    "created_at": "2023-01-13T10:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561547",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,14 @@
 The tox.ini files in pkgs/*/ are broken with tox 4.
 
-Early versions of tox 4.0.x have additional defects.
+Early versions of tox 4.x have additional defects.
 
 - https://github.com/tox-dev/tox/discussions/2699#discussioncomment-4403536 - factors no longer work in `passenv` - fixed in tox 4.0.13
 
 - negated factors in `deps`, like `!pipenv-!norequirements: -rrequirements.txt` do not work - https://github.com/tox-dev/tox/issues/2747 - fixed in tox 4.0.15
 
-And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634
+- And autoprovisioning for downgrade to tox 3 is not working - https://github.com/tox-dev/tox/issues/2634
 
-Here we update affected `tox.ini` files so that they work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.
-
-
-TODO:
-- In SAGE_ROOT/tox.ini, set a lower version bound 4.2.7 so that numerical factors work (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); 4.0.14 is broken:
+- In SAGE_ROOT/tox.ini, in tox 4 earlier than 4.2.7, numerical factors are broken because they are misinterpreted as Python versions (https://tox.wiki/en/latest/changelog.html#bugfixes-4-2-7); e.g., 4.0.14 is broken:
 
   ```
   tox -e docker-linuxmint-21.1-standard                                                                                                      git:t/34903/tox_ini___gh_actions__update_linux_platforms*
@@ -20,6 +16,10 @@
     docker-linuxmint-21.1-standard: SKIP (1.98 seconds)
   ```
 
+Here we update affected `tox.ini` files so that:
+- src/tox.ini and pkgs/*/tox.ini work both with suitable versions of tox 3 and tox 4. We change the tox `spkg-configure.m4` to check for such versions.
+- SAGE_ROOT/tox.ini work with tox >= 4.2.7 (autoprovisioning if necessary)
+
 Follow up: 
 - #34840 Upgrade tox to 4.x
 
``````




---

archive/issue_comments_561548.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nwith tox 4.2.8, I get\n\n```\n$ tox -e docker-linuxmint-21.1-standard\ndocker-linuxmint-21.1-standard: commands[0]> bash -c 'build/bin/write-dockerfile.sh debian \"--has-file=spkg-configure.m4 :standard:\" yes yes \"_bootstrap      \" > /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile'\ndocker-linuxmint-21.1-standard: failed with bash is not allowed, use allowlist_externals to allow it\n  docker-linuxmint-21.1-standard: FAIL code 1 (0.44 seconds)\n  evaluation failed :( (0.75 seconds)\n```\n\n- not sure what it is.",
    "created_at": "2023-01-13T14:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561548",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

with tox 4.2.8, I get

```
$ tox -e docker-linuxmint-21.1-standard
docker-linuxmint-21.1-standard: commands[0]> bash -c 'build/bin/write-dockerfile.sh debian "--has-file=spkg-configure.m4 :standard:" yes yes "_bootstrap      " > /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile'
docker-linuxmint-21.1-standard: failed with bash is not allowed, use allowlist_externals to allow it
  docker-linuxmint-21.1-standard: FAIL code 1 (0.44 seconds)
  evaluation failed :( (0.75 seconds)
```

- not sure what it is.



---

archive/issue_comments_561549.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nand with this branch, I get\n\n```\n$ tox -e docker-linuxmint-21.1-standard\ndocker-linuxmint-21.1-standard: commands[0]> bash -c 'build/bin/write-dockerfile.sh debian \"--has-file=spkg-configure.m4 :standard:\" yes yes \"_bootstrap      \" > /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile'\ndocker-linuxmint-21.1-standard: commands[1]> bash -c 'if [ x\"\" != x ]; then mkdir -p /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/.docker && ln -sf $(realpath \"\") /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/.docker/; fi'\ndocker-linuxmint-21.1-standard: commands[2]> bash -c 'for docker_target in with-targets; do BUILD_IMAGE_STEM=sage-$(echo docker-linuxmint-21.1-standard | sed s/-incremental//); BUILD_IMAGE=$DOCKER_PUSH_REPOSITORY$BUILD_IMAGE_STEM-$docker_target; BUILD_TAG=$(git describe --dirty --always); TAG_ARGS=$(for tag in $BUILD_TAG ; do echo --tag $BUILD_IMAGE:$tag; done); DOCKER_BUILDKIT=0 docker build . -f /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile --target $docker_target $TAG_ARGS --build-arg EXTRA_CONFIGURE_ARGS=\"--enable-experimental-packages --enable-download-from-upstream-url  --with-system-python3=yes  \" --build-arg BASE_IMAGE=-amd64:latest --build-arg BOOTSTRAP=\"./bootstrap\" --build-arg TARGETS_PRE=\"$(if test -n \"$TARGETS_PRE\"; then echo $TARGETS_PRE; else echo all-sage-local; fi)\" --build-arg TARGETS=\"build\" --build-arg TARGETS_OPTIONAL=\"ptest\" ; status=$?; if [ $status != 0 ]; then BUILD_TAG=\"$BUILD_TAG-failed\"; docker commit $(docker ps -l -q) $BUILD_IMAGE:$BUILD_TAG; PUSH_TAGS=$BUILD_IMAGE:$BUILD_TAG; else PUSH_TAGS=$(echo $BUILD_IMAGE:$BUILD_TAG; for tag in ; do echo \"$BUILD_IMAGE:$tag\"; done); fi; echo $BUILD_IMAGE:$BUILD_TAG >> /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockertags; if [ x\"\" != x ]; then echo Pushing $PUSH_TAGS; for tag in $PUSH_TAGS; do docker push $tag || echo \"(ignoring errors)\"; done; fi; if [ $status != 0 ]; then exit $status; fi; done'\nSending build context to Docker daemon  749.1MB\nStep 1/45 : ARG BASE_IMAGE\nStep 2/45 : FROM ${BASE_IMAGE} as with-system-packages\ninvalid reference format\nsha256:1839a6c05ff9a58a9ffe9488ff229a64cc35fca8c23ca670792fb6b6c70baa50\ndocker-linuxmint-21.1-standard: exit 1 (38.18 seconds) /mnt/opt/Sage/sage-dev> bash -c 'for docker_target in with-targets; do BUILD_IMAGE_STEM=sage-$(echo docker-linuxmint-21.1-standard | sed s/-incremental//); BUILD_IMAGE=$DOCKER_PUSH_REPOSITORY$BUILD_IMAGE_STEM-$docker_target; BUILD_TAG=$(git describe --dirty --always); TAG_ARGS=$(for tag in $BUILD_TAG ; do echo --tag $BUILD_IMAGE:$tag; done); DOCKER_BUILDKIT=0 docker build . -f /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile --target $docker_target $TAG_ARGS --build-arg EXTRA_CONFIGURE_ARGS=\"--enable-experimental-packages --enable-download-from-upstream-url  --with-system-python3=yes  \" --build-arg BASE_IMAGE=-amd64:latest --build-arg BOOTSTRAP=\"./bootstrap\" --build-arg TARGETS_PRE=\"$(if test -n \"$TARGETS_PRE\"; then echo $TARGETS_PRE; else echo all-sage-local; fi)\" --build-arg TARGETS=\"build\" --build-arg TARGETS_OPTIONAL=\"ptest\" ; status=$?; if [ $status != 0 ]; then BUILD_TAG=\"$BUILD_TAG-failed\"; docker commit $(docker ps -l -q) $BUILD_IMAGE:$BUILD_TAG; PUSH_TAGS=$BUILD_IMAGE:$BUILD_TAG; else PUSH_TAGS=$(echo $BUILD_IMAGE:$BUILD_TAG; for tag in ; do echo \"$BUILD_IMAGE:$tag\"; done); fi; echo $BUILD_IMAGE:$BUILD_TAG >> /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockertags; if [ x\"\" != x ]; then echo Pushing $PUSH_TAGS; for tag in $PUSH_TAGS; do docker push $tag || echo \"(ignoring errors)\"; done; fi; if [ $status != 0 ]; then exit $status; fi; done' pid=4130\n  docker-linuxmint-21.1-standard: FAIL code 1 (38.78=setup[0.06]+cmd[0.53,0.00,38.18] seconds)\n  evaluation failed :( (39.09 seconds)\n```",
    "created_at": "2023-01-13T14:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561549",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

and with this branch, I get

```
$ tox -e docker-linuxmint-21.1-standard
docker-linuxmint-21.1-standard: commands[0]> bash -c 'build/bin/write-dockerfile.sh debian "--has-file=spkg-configure.m4 :standard:" yes yes "_bootstrap      " > /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile'
docker-linuxmint-21.1-standard: commands[1]> bash -c 'if [ x"" != x ]; then mkdir -p /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/.docker && ln -sf $(realpath "") /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/.docker/; fi'
docker-linuxmint-21.1-standard: commands[2]> bash -c 'for docker_target in with-targets; do BUILD_IMAGE_STEM=sage-$(echo docker-linuxmint-21.1-standard | sed s/-incremental//); BUILD_IMAGE=$DOCKER_PUSH_REPOSITORY$BUILD_IMAGE_STEM-$docker_target; BUILD_TAG=$(git describe --dirty --always); TAG_ARGS=$(for tag in $BUILD_TAG ; do echo --tag $BUILD_IMAGE:$tag; done); DOCKER_BUILDKIT=0 docker build . -f /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile --target $docker_target $TAG_ARGS --build-arg EXTRA_CONFIGURE_ARGS="--enable-experimental-packages --enable-download-from-upstream-url  --with-system-python3=yes  " --build-arg BASE_IMAGE=-amd64:latest --build-arg BOOTSTRAP="./bootstrap" --build-arg TARGETS_PRE="$(if test -n "$TARGETS_PRE"; then echo $TARGETS_PRE; else echo all-sage-local; fi)" --build-arg TARGETS="build" --build-arg TARGETS_OPTIONAL="ptest" ; status=$?; if [ $status != 0 ]; then BUILD_TAG="$BUILD_TAG-failed"; docker commit $(docker ps -l -q) $BUILD_IMAGE:$BUILD_TAG; PUSH_TAGS=$BUILD_IMAGE:$BUILD_TAG; else PUSH_TAGS=$(echo $BUILD_IMAGE:$BUILD_TAG; for tag in ; do echo "$BUILD_IMAGE:$tag"; done); fi; echo $BUILD_IMAGE:$BUILD_TAG >> /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockertags; if [ x"" != x ]; then echo Pushing $PUSH_TAGS; for tag in $PUSH_TAGS; do docker push $tag || echo "(ignoring errors)"; done; fi; if [ $status != 0 ]; then exit $status; fi; done'
Sending build context to Docker daemon  749.1MB
Step 1/45 : ARG BASE_IMAGE
Step 2/45 : FROM ${BASE_IMAGE} as with-system-packages
invalid reference format
sha256:1839a6c05ff9a58a9ffe9488ff229a64cc35fca8c23ca670792fb6b6c70baa50
docker-linuxmint-21.1-standard: exit 1 (38.18 seconds) /mnt/opt/Sage/sage-dev> bash -c 'for docker_target in with-targets; do BUILD_IMAGE_STEM=sage-$(echo docker-linuxmint-21.1-standard | sed s/-incremental//); BUILD_IMAGE=$DOCKER_PUSH_REPOSITORY$BUILD_IMAGE_STEM-$docker_target; BUILD_TAG=$(git describe --dirty --always); TAG_ARGS=$(for tag in $BUILD_TAG ; do echo --tag $BUILD_IMAGE:$tag; done); DOCKER_BUILDKIT=0 docker build . -f /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockerfile --target $docker_target $TAG_ARGS --build-arg EXTRA_CONFIGURE_ARGS="--enable-experimental-packages --enable-download-from-upstream-url  --with-system-python3=yes  " --build-arg BASE_IMAGE=-amd64:latest --build-arg BOOTSTRAP="./bootstrap" --build-arg TARGETS_PRE="$(if test -n "$TARGETS_PRE"; then echo $TARGETS_PRE; else echo all-sage-local; fi)" --build-arg TARGETS="build" --build-arg TARGETS_OPTIONAL="ptest" ; status=$?; if [ $status != 0 ]; then BUILD_TAG="$BUILD_TAG-failed"; docker commit $(docker ps -l -q) $BUILD_IMAGE:$BUILD_TAG; PUSH_TAGS=$BUILD_IMAGE:$BUILD_TAG; else PUSH_TAGS=$(echo $BUILD_IMAGE:$BUILD_TAG; for tag in ; do echo "$BUILD_IMAGE:$tag"; done); fi; echo $BUILD_IMAGE:$BUILD_TAG >> /mnt/opt/Sage/sage-dev/.tox/docker-linuxmint-21.1-standard/Dockertags; if [ x"" != x ]; then echo Pushing $PUSH_TAGS; for tag in $PUSH_TAGS; do docker push $tag || echo "(ignoring errors)"; done; fi; if [ $status != 0 ]; then exit $status; fi; done' pid=4130
  docker-linuxmint-21.1-standard: FAIL code 1 (38.78=setup[0.06]+cmd[0.53,0.00,38.18] seconds)
  evaluation failed :( (39.09 seconds)
```



---

archive/issue_events_470844.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-14T18:40:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470844"
}
```



---

archive/issue_events_470845.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-14T18:40:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470845"
}
```



---

archive/issue_events_470846.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-14T21:53:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470846"
}
```



---

archive/issue_events_470847.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-14T21:53:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470847"
}
```



---

archive/issue_comments_561550.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\noops, sorry, I just got logged out of docker, that's the reason for the error",
    "created_at": "2023-01-14T21:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561550",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

oops, sorry, I just got logged out of docker, that's the reason for the error



---

archive/issue_comments_561551.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2023-01-15T00:26:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561551",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_561552.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nseems to work",
    "created_at": "2023-01-15T00:26:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561552",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

seems to work



---

archive/issue_events_470848.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-15T00:26:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470848"
}
```



---

archive/issue_events_470849.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2023-01-15T00:26:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34849#event-470849"
}
```



---

archive/issue_comments_561553.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThanks!",
    "created_at": "2023-01-15T00:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34849",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34849#issuecomment-561553",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Thanks!
