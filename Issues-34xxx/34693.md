# Issue 34693: Further support for matplotlib 3.6

archive/issues_034456.json:
```json
{
    "assignees": [],
    "body": "#34668 was focusing on making doctests pass but did not test docbuilding.\n\nThe following plot in `src/sage/plot/plot.py`\n\n```\n    .. PLOT::\n\n        g = plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter=\"latex\")\n        sphinx_plot(g)\n```\nis causing the building of the documentation to fail horribly.\n\n```\n[plotting ]  from /home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc/en/reference/plotting/sage/plot/plot.rst:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1378, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, \"for_layout_only\": True})\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n[plotting ] During handling of the above exception, another exception occurred:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1378, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, \"for_layout_only\": True})\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py\", line 4428, in get_tightbbox\n[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1380, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **kwargs)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n[plotting ] During handling of the above exception, another exception occurred:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1378, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, \"for_layout_only\": True})\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n[plotting ] During handling of the above exception, another exception occurred:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/sphinxext/plot_directive.py\", line 515, in _run_code\n[plotting ]     exec(code, ns)\n[plotting ]   File \"<string>\", line 2, in <module>\n[plotting ]   File \"<string>\", line 37, in sphinx_plot\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/figure.py\", line 3448, in tight_layout\n[plotting ]     engine.execute(self)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/layout_engine.py\", line 180, in execute\n[plotting ]     kwargs = get_tight_layout_figure(\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py\", line 305, in get_tight_layout_figure\n[plotting ]     kwargs = _auto_adjust_subplotpars(fig, renderer,\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py\", line 82, in _auto_adjust_subplotpars\n[plotting ]     bb += [martist._get_tightbbox_for_layout_only(ax, renderer)]\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1380, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **kwargs)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py\", line 4428, in get_tightbbox\n[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1380, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **kwargs)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n```\nTests of this plot were disabled in #34668 and now we need to remove the plot. The whole example needs to be replaced by something that works.\n\nWe could not overcome the problem of symbolic values that numpy rejects, but instead made a fix to circumvent numpy and revived the doctest and the example.\n\n\n\nCC:  @tornaria\n\nBranch/Commit: **[6458968](https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Kwankyu Lee**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34693_\n\n",
    "closed_at": "2022-12-11T11:11:50Z",
    "created_at": "2022-10-24T21:58:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Further support for matplotlib 3.6",
    "type": "issue",
    "updated_at": "2022-12-11T11:11:50Z",
    "url": "https://github.com/sagemath/sage/issues/34693",
    "user": "https://github.com/kiwifb"
}
```
#34668 was focusing on making doctests pass but did not test docbuilding.

The following plot in `src/sage/plot/plot.py`

```
    .. PLOT::

        g = plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter="latex")
        sphinx_plot(g)
```
is causing the building of the documentation to fail horribly.

```
[plotting ]  from /home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc/en/reference/plotting/sage/plot/plot.rst:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1378, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, "for_layout_only": True})
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
[plotting ] During handling of the above exception, another exception occurred:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1378, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, "for_layout_only": True})
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py", line 4428, in get_tightbbox
[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1380, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **kwargs)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
[plotting ] During handling of the above exception, another exception occurred:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1378, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, "for_layout_only": True})
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
[plotting ] During handling of the above exception, another exception occurred:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/sphinxext/plot_directive.py", line 515, in _run_code
[plotting ]     exec(code, ns)
[plotting ]   File "<string>", line 2, in <module>
[plotting ]   File "<string>", line 37, in sphinx_plot
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/figure.py", line 3448, in tight_layout
[plotting ]     engine.execute(self)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/layout_engine.py", line 180, in execute
[plotting ]     kwargs = get_tight_layout_figure(
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py", line 305, in get_tight_layout_figure
[plotting ]     kwargs = _auto_adjust_subplotpars(fig, renderer,
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py", line 82, in _auto_adjust_subplotpars
[plotting ]     bb += [martist._get_tightbbox_for_layout_only(ax, renderer)]
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1380, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **kwargs)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py", line 4428, in get_tightbbox
[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1380, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **kwargs)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
```
Tests of this plot were disabled in #34668 and now we need to remove the plot. The whole example needs to be replaced by something that works.

We could not overcome the problem of symbolic values that numpy rejects, but instead made a fix to circumvent numpy and revived the doctest and the example.



CC:  @tornaria

Branch/Commit: **[6458968](https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6)**

Reviewer: **Matthias Koeppe**

Author: **Kwankyu Lee**

_Issue created by migration from https://trac.sagemath.org/ticket/34693_





---

archive/issue_events_454521.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-10-24T21:58:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454521"
}
```



---

archive/issue_events_454522.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-10-24T21:58:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454522"
}
```



---

archive/issue_events_454523.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-10-24T21:58:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454523"
}
```



---

archive/issue_events_454524.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-10-24T21:58:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454524"
}
```



---

archive/issue_comments_563094.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nCurrently making sure that this it the only change required and providing support to sage-on-gentoo users already using matplotlib 3.6.x before pushing a branch here.",
    "created_at": "2022-10-24T22:03:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563094",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'>Comment 1:</a>
Currently making sure that this it the only change required and providing support to sage-on-gentoo users already using matplotlib 3.6.x before pushing a branch here.



---

archive/issue_comments_563095.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2022-10-25T01:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563095",
    "user": "https://github.com/kiwifb"
}
```

Author: **François Bissey**



---

archive/issue_comments_563096.json:
```json
{
    "body": "Branch: **[u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)**",
    "created_at": "2022-10-25T01:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563096",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)**



---

archive/issue_comments_563097.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThe attached branch will let you build the doc with matplotlib 3.6.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568\">5501e0d</a></td><td><code>Support matplotlib 3.6</code></td></tr></table>\n",
    "created_at": "2022-10-25T01:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563097",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'>Comment 2:</a>
The attached branch will let you build the doc with matplotlib 3.6.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568">5501e0d</a></td><td><code>Support matplotlib 3.6</code></td></tr></table>




---

archive/issue_comments_563098.json:
```json
{
    "body": "Commit: **[5501e0d](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)**",
    "created_at": "2022-10-25T01:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563098",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[5501e0d](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)**



---

archive/issue_comments_563099.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNot sure how I got to attach the wrong branch. Thankfully, I noticed.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b0c147037018b77b5c8c5147e78c3c7c6388d29\">8b0c147</a></td><td><code>Merge branch 'mpl3.6_doctest' into mpl3.6_docbuilding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4645a0d0c10f9f1599aa01362593195af6d27a16\">4645a0d</a></td><td><code>Removing faulty plot</code></td></tr></table>\n",
    "created_at": "2022-10-25T01:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563099",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'>Comment 3:</a>
Not sure how I got to attach the wrong branch. Thankfully, I noticed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b0c147037018b77b5c8c5147e78c3c7c6388d29">8b0c147</a></td><td><code>Merge branch 'mpl3.6_doctest' into mpl3.6_docbuilding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4645a0d0c10f9f1599aa01362593195af6d27a16">4645a0d</a></td><td><code>Removing faulty plot</code></td></tr></table>




---

archive/issue_comments_563100.json:
```json
{
    "body": "Changed commit from **[5501e0d](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)** to **[4645a0d](https://github.com/sagemath/sagetrac-mirror/commit/4645a0d0c10f9f1599aa01362593195af6d27a16)**",
    "created_at": "2022-10-25T01:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563100",
    "user": "https://github.com/kiwifb"
}
```

Changed commit from **[5501e0d](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)** to **[4645a0d](https://github.com/sagemath/sagetrac-mirror/commit/4645a0d0c10f9f1599aa01362593195af6d27a16)**



---

archive/issue_comments_563101.json:
```json
{
    "body": "Changed branch from **[u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)** to **[u/fbissey/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL3.6_docbuilding)**",
    "created_at": "2022-10-25T01:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563101",
    "user": "https://github.com/kiwifb"
}
```

Changed branch from **[u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)** to **[u/fbissey/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL3.6_docbuilding)**



---

archive/issue_comments_563102.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nIs this ready for review?",
    "created_at": "2022-11-27T02:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563102",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'>Comment 4:</a>
Is this ready for review?



---

archive/issue_events_454525.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2022-11-27T02:45:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454525"
}
```



---

archive/issue_comments_563103.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nYes, it is ready.Our consensus at #34668 is that the point of this particular example is unclear. So, removing it does not seem to be a big deal.",
    "created_at": "2022-11-27T02:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563103",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'>Comment 5:</a>
Yes, it is ready.Our consensus at #34668 is that the point of this particular example is unclear. So, removing it does not seem to be a big deal.



---

archive/issue_comments_563104.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI'm hitting the same error (`ufunc 'isfinite' not supported`) also in some of my own plotting code.",
    "created_at": "2022-11-27T05:04:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563104",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
I'm hitting the same error (`ufunc 'isfinite' not supported`) also in some of my own plotting code.



---

archive/issue_comments_563105.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nPossibly related: #29210 scipy.optimize.newton does not accept Sage input anymore",
    "created_at": "2022-11-27T05:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563105",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
Possibly related: #29210 scipy.optimize.newton does not accept Sage input anymore



---

archive/issue_comments_563106.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nYes, I am now wondering if it is an issue that matplotlib (and scipy) may need to adapt to new stuff in numpy. But we cannot leave the plot in, since it breaks building the doc.",
    "created_at": "2022-11-27T05:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563106",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'>Comment 8:</a>
Yes, I am now wondering if it is an issue that matplotlib (and scipy) may need to adapt to new stuff in numpy. But we cannot leave the plot in, since it breaks building the doc.



---

archive/issue_comments_563107.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [Fran\u00e7ois Bissey](#comment%3A5):\n> Yes, it is ready. Our consensus at #34668 is that the point of this particular example is unclear. \n\nIt is clear. We can use symbolic values as tick marks. It is a useful feature. I may use it (though I never did :)\n\n> So, removing it does not seem to be a big deal.\n\nRemoving a feature to upgrade a package is a big deal.\n\nI investigated the real cause of the failure. Fortunately I found it. It is a kind of bug in matplotlib 3.6. I reported it to upstream:\n\nhttps://github.com/matplotlib/matplotlib/issues/24557\n\nLet's see how they react before we proceed.",
    "created_at": "2022-11-28T02:31:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563107",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [François Bissey](#comment%3A5):
> Yes, it is ready. Our consensus at #34668 is that the point of this particular example is unclear. 

It is clear. We can use symbolic values as tick marks. It is a useful feature. I may use it (though I never did :)

> So, removing it does not seem to be a big deal.

Removing a feature to upgrade a package is a big deal.

I investigated the real cause of the failure. Fortunately I found it. It is a kind of bug in matplotlib 3.6. I reported it to upstream:

https://github.com/matplotlib/matplotlib/issues/24557

Let's see how they react before we proceed.



---

archive/issue_comments_563108.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nIn the upstream discussion https://github.com/matplotlib/matplotlib/issues/24557#issuecomment-1329891836, they suggested to make our symbolic objects behave more `float`-like: \n\n> Can you add `isfinite` support to `Expression` (or a `ConstExpression` which may or may not already exist)? It seems to me that being able to ask if an expression is finite is something you should be able to ask.\n\nor numpy-array-like:\n\n> Is it possible for sagemath to provide a `.__array__ `method to convert to numpy arrays? \n\nI will investigate the former possibility. We have\n\n```python\nsage: a = sqrt(2)\nsage: a.is_infinity()\nFalse\n``` \nbut I don't know how to \"add `isfinite` support\" to satisfy numpy...",
    "created_at": "2022-11-29T01:27:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563108",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:10'>Comment 10:</a>
In the upstream discussion https://github.com/matplotlib/matplotlib/issues/24557#issuecomment-1329891836, they suggested to make our symbolic objects behave more `float`-like: 

> Can you add `isfinite` support to `Expression` (or a `ConstExpression` which may or may not already exist)? It seems to me that being able to ask if an expression is finite is something you should be able to ask.

or numpy-array-like:

> Is it possible for sagemath to provide a `.__array__ `method to convert to numpy arrays? 

I will investigate the former possibility. We have

```python
sage: a = sqrt(2)
sage: a.is_infinity()
False
``` 
but I don't know how to "add `isfinite` support" to satisfy numpy...



---

archive/issue_comments_563109.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\n\n```\nsage: np.isfinite(2)\nTrue\n```\nSo Sage integers are numbers from the perspective of numpy. How does it do it?",
    "created_at": "2022-11-29T05:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563109",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:11'>Comment 11:</a>

```
sage: np.isfinite(2)
True
```
So Sage integers are numbers from the perspective of numpy. How does it do it?



---

archive/issue_comments_563110.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBTW, \n\n```\nsage: np.can_cast(type(2), float, 'safe')\nFalse\n```\nStrange...",
    "created_at": "2022-11-29T05:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563110",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:12'>Comment 12:</a>
BTW, 

```
sage: np.can_cast(type(2), float, 'safe')
False
```
Strange...



---

archive/issue_comments_563111.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI don't know if that's the mechanism why it works, but our `Integer`s are registered with the numbers ABC - https://docs.python.org/3/library/numbers.html",
    "created_at": "2022-11-29T06:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563111",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'>Comment 13:</a>
I don't know if that's the mechanism why it works, but our `Integer`s are registered with the numbers ABC - https://docs.python.org/3/library/numbers.html



---

archive/issue_comments_563112.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [Matthias K\u00f6ppe](#comment%3A13):\n> I don't know if that's the mechanism why it works, but our `Integer`s are registered with the numbers ABC - https://docs.python.org/3/library/numbers.html\n\nI tried that, but doesn't work. Not sure I missed something...",
    "created_at": "2022-11-29T07:51:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563112",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [Matthias Köppe](#comment%3A13):
> I don't know if that's the mechanism why it works, but our `Integer`s are registered with the numbers ABC - https://docs.python.org/3/library/numbers.html

I tried that, but doesn't work. Not sure I missed something...



---

archive/issue_comments_563113.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nVoil\u00e0, I found it. It is\n\nhttps://numpy.org/doc/stable/reference/arrays.interface.html",
    "created_at": "2022-11-29T08:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563113",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:15'>Comment 15:</a>
Voilà, I found it. It is

https://numpy.org/doc/stable/reference/arrays.interface.html



---

archive/issue_comments_563114.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nand https://numpy.org/doc/stable/reference/arrays.dtypes.html\n\nThen\n\n```python\nclass Symbolic(object):\n    __array_interface__ = {'typestr': 'f'} \n    \n    def __init__(self, a, b):\n        self.num = a\n        self.den = b\n        \n    def __str__(self):\n        return '{}/{}'.format(self.num, self.den)\n        \n    def __float__(self):\n        return float(self.num / self.den)\n    \nimport matplotlib.pyplot as plt\nimport numpy as np\nimport sympy as sym\nfrom matplotlib.ticker import FixedLocator, NullLocator, FuncFormatter\n\n# make data\nx = np.linspace(0, 3, 100)\ny = 2 * x + 1\n\n# plot\nfig, ax = plt.subplots()\n\nax.plot(x, y, linewidth=2.0)\n\na = Symbolic(1,2)\n\nax.xaxis.set_major_locator(FixedLocator([a, 1, 2, 3]))\nax.xaxis.set_minor_locator(NullLocator())\nax.xaxis.set_major_formatter(FuncFormatter(lambda x, pos: str(x)))\n\nplt.show()\n```\nworks. Moreover\n\n```python\n>>> a = Symbolic(2,3)\n>>> np.isfinite(a)\nTrue\n>>> np.array(a)\narray(0.6666667, dtype=float32)\n```\nHence so we now know how to make `Expression` float-like (from the perspective of numpy).\n\nTo implement this mechanism for `Expression` may require major restructuring, since  the scope of `Expression` is much more broad beyond constant expression. As suggested in the upstream discussion, we may need `ConstantExpression` that would hold only constant values, and make that float-like or complex-like. I feel this would be a grand work out of my capacity though. Symbolic expression experts may do it. But the first question is if this work is worth to do. If so, this would need a separate ticket.",
    "created_at": "2022-11-29T19:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563114",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:16'>Comment 16:</a>
and https://numpy.org/doc/stable/reference/arrays.dtypes.html

Then

```python
class Symbolic(object):
    __array_interface__ = {'typestr': 'f'} 
    
    def __init__(self, a, b):
        self.num = a
        self.den = b
        
    def __str__(self):
        return '{}/{}'.format(self.num, self.den)
        
    def __float__(self):
        return float(self.num / self.den)
    
import matplotlib.pyplot as plt
import numpy as np
import sympy as sym
from matplotlib.ticker import FixedLocator, NullLocator, FuncFormatter

# make data
x = np.linspace(0, 3, 100)
y = 2 * x + 1

# plot
fig, ax = plt.subplots()

ax.plot(x, y, linewidth=2.0)

a = Symbolic(1,2)

ax.xaxis.set_major_locator(FixedLocator([a, 1, 2, 3]))
ax.xaxis.set_minor_locator(NullLocator())
ax.xaxis.set_major_formatter(FuncFormatter(lambda x, pos: str(x)))

plt.show()
```
works. Moreover

```python
>>> a = Symbolic(2,3)
>>> np.isfinite(a)
True
>>> np.array(a)
array(0.6666667, dtype=float32)
```
Hence so we now know how to make `Expression` float-like (from the perspective of numpy).

To implement this mechanism for `Expression` may require major restructuring, since  the scope of `Expression` is much more broad beyond constant expression. As suggested in the upstream discussion, we may need `ConstantExpression` that would hold only constant values, and make that float-like or complex-like. I feel this would be a grand work out of my capacity though. Symbolic expression experts may do it. But the first question is if this work is worth to do. If so, this would need a separate ticket.



---

archive/issue_comments_563115.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nDoes `__array_interface__` have to be a class constant, or could it be a `lazy_attribute`?",
    "created_at": "2022-11-29T19:54:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563115",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'>Comment 17:</a>
Does `__array_interface__` have to be a class constant, or could it be a `lazy_attribute`?



---

archive/issue_comments_563116.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nIt can be `lazy_attributes` or `property`.\n\nBut I realized a major problem. By the mechanism, `Symbolic` is simply converted to floats, and you see `0.5` in the plot instead of `1/2`. So this defeats the original purpose! Now it seems to me that we cannot retain the feature (supporting symbolic ticks)...",
    "created_at": "2022-11-29T20:01:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563116",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:18'>Comment 18:</a>
It can be `lazy_attributes` or `property`.

But I realized a major problem. By the mechanism, `Symbolic` is simply converted to floats, and you see `0.5` in the plot instead of `1/2`. So this defeats the original purpose! Now it seems to me that we cannot retain the feature (supporting symbolic ticks)...



---

archive/issue_comments_563117.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [Kwankyu Lee](#comment%3A18):\n> By the mechanism, `Symbolic` is simply converted to floats, and you see `0.5` in the plot instead of `1/2`. So this defeats the original purpose! Now it seems to me that we cannot retain the feature (supporting symbolic ticks)...\n\nThe rescue is to use matplotlib's `FixedFormatter` to provide strings for the tick values separately. This would amount to reimplementing sage's `tick_formatter=\"latex\"`.\n\nAnyway, implementing this together with `ConstantExpression` seems a daunting task apart from the \"worth to do\" question.\n\nI don't know how frequently the symbolic tick mark feature is used by sage users. If no one uses it :) then perhaps we may turn off this feature while we upgrade matplotlib to 3.6.",
    "created_at": "2022-11-29T21:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563117",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [Kwankyu Lee](#comment%3A18):
> By the mechanism, `Symbolic` is simply converted to floats, and you see `0.5` in the plot instead of `1/2`. So this defeats the original purpose! Now it seems to me that we cannot retain the feature (supporting symbolic ticks)...

The rescue is to use matplotlib's `FixedFormatter` to provide strings for the tick values separately. This would amount to reimplementing sage's `tick_formatter="latex"`.

Anyway, implementing this together with `ConstantExpression` seems a daunting task apart from the "worth to do" question.

I don't know how frequently the symbolic tick mark feature is used by sage users. If no one uses it :) then perhaps we may turn off this feature while we upgrade matplotlib to 3.6.



---

archive/issue_comments_563118.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nOK. So, it is currently broken and will take some time and efforts to put it right, if there is a will.\n\nIn the meantime, the branch removes just a plot showcasing the capability because it breaks building the documentation in sage-on-distros which already have matplotlib 3.6.x available.\nShould we comment the plotting code and add reference to a ticket with work in progress or just remove it until things are ready?",
    "created_at": "2022-11-29T21:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563118",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'>Comment 20:</a>
OK. So, it is currently broken and will take some time and efforts to put it right, if there is a will.

In the meantime, the branch removes just a plot showcasing the capability because it breaks building the documentation in sage-on-distros which already have matplotlib 3.6.x available.
Should we comment the plotting code and add reference to a ticket with work in progress or just remove it until things are ready?



---

archive/issue_comments_563119.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nHow about just commenting them out mentioning this ticket?\n\nBut no one uses it? I really don't know. How about posting on sage-devel to prevent some one later to complain that his/her code doesn't work anymore...",
    "created_at": "2022-11-29T22:03:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563119",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:21'>Comment 21:</a>
How about just commenting them out mentioning this ticket?

But no one uses it? I really don't know. How about posting on sage-devel to prevent some one later to complain that his/her code doesn't work anymore...



---

archive/issue_comments_563120.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI definitely use this feature (comment:6); -1 on removing the test",
    "created_at": "2022-11-29T22:06:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563120",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
I definitely use this feature (comment:6); -1 on removing the test



---

archive/issue_comments_563121.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [Matthias K\u00f6ppe](#comment%3A22):\n> I definitely use this feature (comment:6); -1 on removing the test\n\n+1. \n\nMeanwhile I learned enough matplotlib to make up a simple fix for this ticket.",
    "created_at": "2022-11-30T04:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563121",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [Matthias Köppe](#comment%3A22):
> I definitely use this feature (comment:6); -1 on removing the test

+1. 

Meanwhile I learned enough matplotlib to make up a simple fix for this ticket.



---

archive/issue_comments_563122.json:
```json
{
    "body": "Changed author from **Fran\u00e7ois Bissey** to **Kwankyu Lee**",
    "created_at": "2022-11-30T04:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563122",
    "user": "https://github.com/kwankyu"
}
```

Changed author from **François Bissey** to **Kwankyu Lee**



---

archive/issue_comments_563123.json:
```json
{
    "body": "Changed branch from **[u/fbissey/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL3.6_docbuilding)** to **[u/klee/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/MPL3.6_docbuilding)**",
    "created_at": "2022-11-30T04:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563123",
    "user": "https://github.com/kwankyu"
}
```

Changed branch from **[u/fbissey/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL3.6_docbuilding)** to **[u/klee/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/MPL3.6_docbuilding)**



---

archive/issue_comments_563124.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0a77039bb2be3eb7cd06c036aaa8085652db403\">f0a7703</a></td><td><code>Add back doctest</code></td></tr></table>\n",
    "created_at": "2022-11-30T04:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563124",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:25'>Comment 25:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0a77039bb2be3eb7cd06c036aaa8085652db403">f0a7703</a></td><td><code>Add back doctest</code></td></tr></table>




---

archive/issue_comments_563125.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -89,3 +89,7 @@\n [plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n ```\n Tests of this plot were disabled in #34668 and now we need to remove the plot. The whole example needs to be replaced by something that works.\n+\n+We could not overcome the problem of symbolic values that numpy rejects, but instead made a fix to circumvent numpy and revived the doctest and the example.\n+\n+\n``````\n",
    "created_at": "2022-11-30T04:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563125",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -89,3 +89,7 @@
 [plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
 ```
 Tests of this plot were disabled in #34668 and now we need to remove the plot. The whole example needs to be replaced by something that works.
+
+We could not overcome the problem of symbolic values that numpy rejects, but instead made a fix to circumvent numpy and revived the doctest and the example.
+
+
``````




---

archive/issue_comments_563126.json:
```json
{
    "body": "Changed commit from **[4645a0d](https://github.com/sagemath/sagetrac-mirror/commit/4645a0d0c10f9f1599aa01362593195af6d27a16)** to **[f0a7703](https://github.com/sagemath/sagetrac-mirror/commit/f0a77039bb2be3eb7cd06c036aaa8085652db403)**",
    "created_at": "2022-11-30T04:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563126",
    "user": "https://github.com/kwankyu"
}
```

Changed commit from **[4645a0d](https://github.com/sagemath/sagetrac-mirror/commit/4645a0d0c10f9f1599aa01362593195af6d27a16)** to **[f0a7703](https://github.com/sagemath/sagetrac-mirror/commit/f0a77039bb2be3eb7cd06c036aaa8085652db403)**



---

archive/issue_comments_563127.json:
```json
{
    "body": "Changed commit from **[f0a7703](https://github.com/sagemath/sagetrac-mirror/commit/f0a77039bb2be3eb7cd06c036aaa8085652db403)** to **[a8741d8](https://github.com/sagemath/sagetrac-mirror/commit/a8741d8c60dc3e173b18cc373c4c203fcc2cec4f)**",
    "created_at": "2022-11-30T12:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563127",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f0a7703](https://github.com/sagemath/sagetrac-mirror/commit/f0a77039bb2be3eb7cd06c036aaa8085652db403)** to **[a8741d8](https://github.com/sagemath/sagetrac-mirror/commit/a8741d8c60dc3e173b18cc373c4c203fcc2cec4f)**



---

archive/issue_comments_563128.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8371dd75013d5b973333b6e577e7ef17bbf042c1\">8371dd7</a></td><td><code>Missing part of the fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbfb9539ab9bbb5b2e460f4c4576835c58e84a2e\">dbfb953</a></td><td><code>Merge branch 'develop' into t/34693/MPL3.6_docbuilding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8741d8c60dc3e173b18cc373c4c203fcc2cec4f\">a8741d8</a></td><td><code>Edit the doctest</code></td></tr></table>\n",
    "created_at": "2022-11-30T12:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563128",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>Comment 26:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8371dd75013d5b973333b6e577e7ef17bbf042c1">8371dd7</a></td><td><code>Missing part of the fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbfb9539ab9bbb5b2e460f4c4576835c58e84a2e">dbfb953</a></td><td><code>Merge branch 'develop' into t/34693/MPL3.6_docbuilding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8741d8c60dc3e173b18cc373c4c203fcc2cec4f">a8741d8</a></td><td><code>Edit the doctest</code></td></tr></table>




---

archive/issue_comments_563129.json:
```json
{
    "body": "Changed commit from **[a8741d8](https://github.com/sagemath/sagetrac-mirror/commit/a8741d8c60dc3e173b18cc373c4c203fcc2cec4f)** to **[6458968](https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6)**",
    "created_at": "2022-11-30T23:26:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563129",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a8741d8](https://github.com/sagemath/sagetrac-mirror/commit/a8741d8c60dc3e173b18cc373c4c203fcc2cec4f)** to **[6458968](https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6)**



---

archive/issue_comments_563130.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6\">6458968</a></td><td><code>More edis of the doctest</code></td></tr></table>\n",
    "created_at": "2022-11-30T23:26:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563130",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>Comment 27:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6">6458968</a></td><td><code>More edis of the doctest</code></td></tr></table>




---

archive/issue_comments_563131.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2022-12-01T02:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563131",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_563132.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nI can confirm that this also fixes the issue in my plotting code. Thanks a lot for working on it!",
    "created_at": "2022-12-01T02:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563132",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'>Comment 28:</a>
I can confirm that this also fixes the issue in my plotting code. Thanks a lot for working on it!



---

archive/issue_events_454526.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-01T02:43:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454526"
}
```



---

archive/issue_events_454527.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-01T02:43:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454527"
}
```



---

archive/issue_comments_563133.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nThanks. I also checked the branch with #34796 that upgrades matplotlib to 3.6. It works well.",
    "created_at": "2022-12-01T03:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563133",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:29'>Comment 29:</a>
Thanks. I also checked the branch with #34796 that upgrades matplotlib to 3.6. It works well.



---

archive/issue_events_454528.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-12-11T11:11:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454528"
}
```



---

archive/issue_events_454529.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "949866d1e73eb73a0bc5b170160d9592e7ccba20",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-12-11T11:11:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34693#event-454529"
}
```



---

archive/issue_comments_563134.json:
```json
{
    "body": "Changed branch from **[u/klee/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/MPL3.6_docbuilding)** to **[6458968](https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6)**",
    "created_at": "2022-12-11T11:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34693#issuecomment-563134",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/klee/MPL3.6_docbuilding](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/MPL3.6_docbuilding)** to **[6458968](https://github.com/sagemath/sagetrac-mirror/commit/64589686c261d33e6b5aff2589bcae8af004bcc6)**
