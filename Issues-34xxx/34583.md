# Issue 34583: Upgrade giac to 1.9.0.29

archive/issues_034346.json:
```json
{
    "assignees": [],
    "body": "\n\n**CC:**  @collares @videlec parisse @kiwifb @fchapoton\n\n**Branch:** [u/mkoeppe/upgrade_giac_to_1_9_0_21](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_giac_to_1_9_0_21)\n\n**Commit:** [63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8](https://github.com/sagemath/sagetrac-mirror/commit/63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8)\n\nIssue created by migration from https://trac.sagemath.org/ticket/34583\n\n",
    "created_at": "2022-09-25T01:45:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade giac to 1.9.0.29",
    "type": "issue",
    "updated_at": "2022-11-29T19:38:27Z",
    "url": "https://github.com/sagemath/sage/issues/34583",
    "user": "https://github.com/mkoeppe"
}
```


**CC:**  @collares @videlec parisse @kiwifb @fchapoton

**Branch:** [u/mkoeppe/upgrade_giac_to_1_9_0_21](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_giac_to_1_9_0_21)

**Commit:** [63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8](https://github.com/sagemath/sagetrac-mirror/commit/63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8)

Issue created by migration from https://trac.sagemath.org/ticket/34583





---

archive/issue_comments_561136.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/upgrade_giac_to_1_9_0_21](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_giac_to_1_9_0_21)",
    "created_at": "2022-09-25T01:47:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561136",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/upgrade_giac_to_1_9_0_21](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_giac_to_1_9_0_21)



---

archive/issue_comments_561137.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis new version does not contain a fix for the incompatibility with pari 2.15 (#34537)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb\">c6b3c7c</a></td><td><code>build/pkgs/giac: Update to 1.9.0.21</code></td></tr></table>\n",
    "created_at": "2022-09-25T01:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561137",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
This new version does not contain a fix for the incompatibility with pari 2.15 (#34537)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb">c6b3c7c</a></td><td><code>build/pkgs/giac: Update to 1.9.0.21</code></td></tr></table>




---

archive/issue_comments_561138.json:
```json
{
    "body": "**Commit:** [c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb](https://github.com/sagemath/sagetrac-mirror/commit/c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb)",
    "created_at": "2022-09-25T01:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561138",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb](https://github.com/sagemath/sagetrac-mirror/commit/c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb)



---

archive/issue_comments_561139.json:
```json
{
    "body": "<a id='comment:3'></a>\nI am sure this is not the right place to report the bug, but for the record: PARI 2.15.0 seems to segfault when running the giac 1.9.0.21 testsuite via `make check`. This is with the ANYARG patch applied.\n\n```\n[...]\n  ***   the thread stack overflows !\n  current stack size: 1024000 (0.977 Mbytes)\n  [hint] set 'threadsizemax' to a nonzero value in your GPRC\n  *** matdet: Warning: increasing stack size to 2048000.\n  ***   at top-level: matdet([-10,-7,6,-7,1,4,-1,-2,-2,-5,1,7,-6,7,-\n  ***                 ^----------------------------------------------\n  *** matdet: the thread stack overflows !\n  current stack size: 1024000 (0.977 Mbytes)\n  [hint] set 'threadsizemax' to a nonzero value in your GPRC\nError in PARI subsystem\nSegmentation fault (core dumped)\n[...]\nFAIL chk_fhan4 (exit status: 1)\n```",
    "created_at": "2022-09-30T01:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561139",
    "user": "https://github.com/collares"
}
```

<a id='comment:3'></a>
I am sure this is not the right place to report the bug, but for the record: PARI 2.15.0 seems to segfault when running the giac 1.9.0.21 testsuite via `make check`. This is with the ANYARG patch applied.

```
[...]
  ***   the thread stack overflows !
  current stack size: 1024000 (0.977 Mbytes)
  [hint] set 'threadsizemax' to a nonzero value in your GPRC
  *** matdet: Warning: increasing stack size to 2048000.
  ***   at top-level: matdet([-10,-7,6,-7,1,4,-1,-2,-2,-5,1,7,-6,7,-
  ***                 ^----------------------------------------------
  *** matdet: the thread stack overflows !
  current stack size: 1024000 (0.977 Mbytes)
  [hint] set 'threadsizemax' to a nonzero value in your GPRC
Error in PARI subsystem
Segmentation fault (core dumped)
[...]
FAIL chk_fhan4 (exit status: 1)
```



---

archive/issue_comments_561140.json:
```json
{
    "body": "<a id='comment:5'></a>\nTo avoid the segfault I am applying the patch below.\n\n```\nFix a failing test due to thread stack overflow\n\n--- a/check/chk_fhan4\t2018-03-13 15:27:11.000000000 -0300\n+++ b/check/chk_fhan4\t2022-10-14 18:51:12.604731890 -0300\n@@ -1,4 +1,5 @@\n #! /bin/sh\n unset LANG\n+export PARI_SIZE=2048000\n ../src/icas TP04-sol.cas > TP04.tst\n diff TP04.tst TP04-sol.cas.out1\n```\n\nA better fix for upstream is probably to set `threadsizemax` to a good multiple of `parisize`.\n\nIs there a public repo of giac where to follow the code? A place to report bugs or make PR? I still have to apply a few more patches for the voidlinux pkg, it would be nice if those could be upstreamed (please ping me for more info).",
    "created_at": "2022-10-17T03:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561140",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:5'></a>
To avoid the segfault I am applying the patch below.

```
Fix a failing test due to thread stack overflow

--- a/check/chk_fhan4	2018-03-13 15:27:11.000000000 -0300
+++ b/check/chk_fhan4	2022-10-14 18:51:12.604731890 -0300
@@ -1,4 +1,5 @@
 #! /bin/sh
 unset LANG
+export PARI_SIZE=2048000
 ../src/icas TP04-sol.cas > TP04.tst
 diff TP04.tst TP04-sol.cas.out1
```

A better fix for upstream is probably to set `threadsizemax` to a good multiple of `parisize`.

Is there a public repo of giac where to follow the code? A place to report bugs or make PR? I still have to apply a few more patches for the voidlinux pkg, it would be nice if those could be upstreamed (please ping me for more info).



---

archive/issue_comments_561141.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [Gonzalo Tornar\u00eda](#comment%3A5):\n> Is there a public repo of giac where to follow the code?\n\nSee [#31563 comment:64](https://github.com/sagemath/sage/issues/31563#comment:64)",
    "created_at": "2022-10-17T03:22:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561141",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Replying to [Gonzalo Tornaría](#comment%3A5):
> Is there a public repo of giac where to follow the code?

See [#31563 comment:64](https://github.com/sagemath/sage/issues/31563#comment:64)



---

archive/issue_comments_561142.json:
```json
{
    "body": "<a id='comment:8'></a>\nShould the main configure be revised so that system `giac` that are too old are not used? On gentoo with `giac-1.7.0.13-r1` installed I have in `config.log`\n\n```\nconfigure:26431: checking for giac >= 1.5.0, <= 1.9.999\nconfigure:26551: result: /usr/bin/giac\nconfigure:26557: checking for giac/giac.h\nconfigure:26557: g++ -std=gnu++11 -c    -Dlinux   -I/usr/include conftest.cpp >&5\nconfigure:26557: $? = 0\nconfigure:26557: result: yes\n```\nand also\n\n```\nconfigure:26590: g++ -std=gnu++11 -o conftest    -Dlinux   -I/usr/include -Wl,-O1 -Wl,--as-needed conftest.cpp -lgiac  -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -larb -lflint -lmpfr -lglpk -lgmp -lm  -lntl >&5\nconfigure:26590: $? = 0\nconfigure:26610: result: -lgiac\nconfigure:26638: will use system package and not install SPKG giac\n```",
    "created_at": "2022-10-20T16:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561142",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:8'></a>
Should the main configure be revised so that system `giac` that are too old are not used? On gentoo with `giac-1.7.0.13-r1` installed I have in `config.log`

```
configure:26431: checking for giac >= 1.5.0, <= 1.9.999
configure:26551: result: /usr/bin/giac
configure:26557: checking for giac/giac.h
configure:26557: g++ -std=gnu++11 -c    -Dlinux   -I/usr/include conftest.cpp >&5
configure:26557: $? = 0
configure:26557: result: yes
```
and also

```
configure:26590: g++ -std=gnu++11 -o conftest    -Dlinux   -I/usr/include -Wl,-O1 -Wl,--as-needed conftest.cpp -lgiac  -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -larb -lflint -lmpfr -lglpk -lgmp -lm  -lntl >&5
configure:26590: $? = 0
configure:26610: result: -lgiac
configure:26638: will use system package and not install SPKG giac
```



---

archive/issue_comments_561143.json:
```json
{
    "body": "<a id='comment:9'></a>\nhow old is too old?",
    "created_at": "2022-10-20T16:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561143",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
how old is too old?



---

archive/issue_comments_561144.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [Matthias K\u00f6ppe](#comment%3A9):\n> how old is too old?\n\nNot sure. But the `1.7.0.13-r1` gives failing doctests (see https://github.com/cschwan/sage-on-gentoo/issues/721).",
    "created_at": "2022-10-20T16:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561144",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:10'></a>
Replying to [Matthias Köppe](#comment%3A9):
> how old is too old?

Not sure. But the `1.7.0.13-r1` gives failing doctests (see https://github.com/cschwan/sage-on-gentoo/issues/721).



---

archive/issue_comments_561145.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe thing is, #32354 silently raised the minimum version needed to `1.7.0-27` but did not translate it to a configure check.",
    "created_at": "2022-10-20T18:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561145",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
The thing is, #32354 silently raised the minimum version needed to `1.7.0-27` but did not translate it to a configure check.



---

archive/issue_comments_561146.json:
```json
{
    "body": "<a id='comment:12'></a>\nsee #34679 for a motivated demand from Giac's main author ; maybe this could be handled here too ?",
    "created_at": "2022-10-21T06:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561146",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
see #34679 for a motivated demand from Giac's main author ; maybe this could be handled here too ?



---

archive/issue_comments_561147.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [Fr\u00e9d\u00e9ric Chapoton](#comment%3A12):\n> see #34679 for a motivated demand from Giac's main author ; maybe this could be handled here too ?\n\nWe could depend on it. But then it is imperative to have the scope of `USE_OBJET_BIDON` fixed. At the moment we use `--disable-gui` and we know we have to use the work around. We could demand `fltk` as dependency and never have to worry about the work around. But leaving it automagical depending on the system, we cannot predict when we need to add it or not.",
    "created_at": "2022-10-21T07:03:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561147",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Replying to [Frédéric Chapoton](#comment%3A12):
> see #34679 for a motivated demand from Giac's main author ; maybe this could be handled here too ?

We could depend on it. But then it is imperative to have the scope of `USE_OBJET_BIDON` fixed. At the moment we use `--disable-gui` and we know we have to use the work around. We could demand `fltk` as dependency and never have to worry about the work around. But leaving it automagical depending on the system, we cannot predict when we need to add it or not.



---

archive/issue_comments_561148.json:
```json
{
    "body": "<a id='comment:14'></a>\nI have released 1.9.0-25 this evening, it now includes FLTK 1.3.8 and compiles it if there is no valid FLTK header available on the system.",
    "created_at": "2022-10-23T20:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561148",
    "user": "https://github.com/sagetrac-parisse"
}
```

<a id='comment:14'></a>
I have released 1.9.0-25 this evening, it now includes FLTK 1.3.8 and compiles it if there is no valid FLTK header available on the system.



---

archive/issue_comments_561149.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [Bernard Parisse](#comment%3A14):\n> I have released 1.9.0-25 this evening, it now includes FLTK 1.3.8 and compiles it if there is no valid FLTK header available on the system.\n\nSo, GUI is now mandatory? You always get FLTK one way or another?",
    "created_at": "2022-10-23T20:52:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561149",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Replying to [Bernard Parisse](#comment%3A14):
> I have released 1.9.0-25 this evening, it now includes FLTK 1.3.8 and compiles it if there is no valid FLTK header available on the system.

So, GUI is now mandatory? You always get FLTK one way or another?



---

archive/issue_comments_561150.json:
```json
{
    "body": "**Changing commit** from \"[c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb](https://github.com/sagemath/sagetrac-mirror/commit/c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb)\" to \"[12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681](https://github.com/sagemath/sagetrac-mirror/commit/12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681)\".",
    "created_at": "2022-10-23T21:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561150",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb](https://github.com/sagemath/sagetrac-mirror/commit/c6b3c7c0d5230bf79142cfa79d17ce3dcc57edbb)" to "[12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681](https://github.com/sagemath/sagetrac-mirror/commit/12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681)".



---

archive/issue_comments_561151.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/113aff8574748d6b7de6a8fbc9d1378bf680e813\">113aff8</a></td><td><code>build/pkgs/giac: Update to 1.9.0.21</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681\">12e98ec</a></td><td><code>build/pkgs/giac: Update to 1.9.0.25</code></td></tr></table>\n",
    "created_at": "2022-10-23T21:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561151",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/113aff8574748d6b7de6a8fbc9d1378bf680e813">113aff8</a></td><td><code>build/pkgs/giac: Update to 1.9.0.21</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681">12e98ec</a></td><td><code>build/pkgs/giac: Update to 1.9.0.25</code></td></tr></table>




---

archive/issue_events_306891.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-23T21:08:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "rename": {
        "from": "Upgrade giac to 1.9.0.21",
        "to": "Upgrade giac to 1.9.0.25"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34583#event-306891"
}
```



---

archive/issue_comments_561152.json:
```json
{
    "body": "<a id='comment:18'></a>\nfails to build on macOS",
    "created_at": "2022-10-23T21:08:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561152",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
fails to build on macOS



---

archive/issue_comments_561153.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [Matthias K\u00f6ppe](#comment%3A18):\n> fails to build on macOS\n\nIs it failing to build fltk by any chance?",
    "created_at": "2022-10-23T21:09:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561153",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
Replying to [Matthias Köppe](#comment%3A18):
> fails to build on macOS

Is it failing to build fltk by any chance?



---

archive/issue_comments_561154.json:
```json
{
    "body": "<a id='comment:20'></a>\nFrom `./configure --help` in 1.9.0-25\n\n```\n  --enable-gui            The disable-gui option has no more effect because\n                          FLTK 1.3.8 is now included in Giac/Xcas. If FLTK\n                          compilation fails or if your local FLTK install is\n                          incompatible, you should configure with\n                          --disable-fltk\n  --enable-fltk           enable FLTK [[default=yes]]\n```\nBut disabling `fltk` doesn't. It just skip the autodetection and automatic compiling of fltk-1.3.8 if no suitable fltk is detected. If fltk is not available or your configuration flags are not properly set for it, compilation will fail because of missing fltk stuff.",
    "created_at": "2022-10-23T21:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561154",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
From `./configure --help` in 1.9.0-25

```
  --enable-gui            The disable-gui option has no more effect because
                          FLTK 1.3.8 is now included in Giac/Xcas. If FLTK
                          compilation fails or if your local FLTK install is
                          incompatible, you should configure with
                          --disable-fltk
  --enable-fltk           enable FLTK [[default=yes]]
```
But disabling `fltk` doesn't. It just skip the autodetection and automatic compiling of fltk-1.3.8 if no suitable fltk is detected. If fltk is not available or your configuration flags are not properly set for it, compilation will fail because of missing fltk stuff.



---

archive/issue_comments_561155.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Attachment:** [giac-1.9.0.25p0.log](https://github.com/sagemath/sage/files/ticket34583/giac-1.9.0.25p0.log)\n\nIt built fltk stuff during the configure run.",
    "created_at": "2022-10-23T21:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561155",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
**Attachment:** [giac-1.9.0.25p0.log](https://github.com/sagemath/sage/files/ticket34583/giac-1.9.0.25p0.log)

It built fltk stuff during the configure run.



---

archive/issue_comments_561156.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [Matthias K\u00f6ppe](#comment%3A21):\n> It built fltk stuff during the configure run. \n\nThat's consistent with what I saw in `configure.ac`.\n\n```\nAC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS=\"$CXXFLAGS -I../fltk-1.3.8\" && LDFLAGS=\"$LDFLAGS -L../fltk-1.3.8/lib\"] ) \n```",
    "created_at": "2022-10-23T22:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561156",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
Replying to [Matthias Köppe](#comment%3A21):
> It built fltk stuff during the configure run. 

That's consistent with what I saw in `configure.ac`.

```
AC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS="$CXXFLAGS -I../fltk-1.3.8" && LDFLAGS="$LDFLAGS -L../fltk-1.3.8/lib"] ) 
```



---

archive/issue_comments_561157.json:
```json
{
    "body": "<a id='comment:23'></a>\nVery hard to figure things out with all those deprecation warnings (and I got plenty of those on linux with gcc-12 as well) but I found this bit\n\n```\nXcas1.cc:3725:29: error: unknown type name 'Fl_Widget'\n  void Menu_Insert_ItemName(Fl_Widget * w , void*) {\n```\nwhich seems to imply some flags are not properly passed/set correctly for fltk.",
    "created_at": "2022-10-23T22:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561157",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
Very hard to figure things out with all those deprecation warnings (and I got plenty of those on linux with gcc-12 as well) but I found this bit

```
Xcas1.cc:3725:29: error: unknown type name 'Fl_Widget'
  void Menu_Insert_ItemName(Fl_Widget * w , void*) {
```
which seems to imply some flags are not properly passed/set correctly for fltk.



---

archive/issue_comments_561158.json:
```json
{
    "body": "<a id='comment:24'></a>\nI don't know if that would have an impact, but you should also remove the `OBJET_BIDON` work around. It is not useful anymore and may actually interfere with fltk.",
    "created_at": "2022-10-23T22:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561158",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>
I don't know if that would have an impact, but you should also remove the `OBJET_BIDON` work around. It is not useful anymore and may actually interfere with fltk.



---

archive/issue_comments_561159.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f4c3582377827a1f718a8e377a3c4ad11dc002c\">4f4c358</a></td><td><code>re-enable giac gui (xcas using ftlk)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f9eebf2424e5d5a855894504845b40e8d61bc9e\">3f9eebf</a></td><td><code>build/pkgs/giac/patches/nofltk-check.patch: Remove</code></td></tr></table>\n",
    "created_at": "2022-10-23T22:23:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561159",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f4c3582377827a1f718a8e377a3c4ad11dc002c">4f4c358</a></td><td><code>re-enable giac gui (xcas using ftlk)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f9eebf2424e5d5a855894504845b40e8d61bc9e">3f9eebf</a></td><td><code>build/pkgs/giac/patches/nofltk-check.patch: Remove</code></td></tr></table>




---

archive/issue_comments_561160.json:
```json
{
    "body": "**Changing commit** from \"[12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681](https://github.com/sagemath/sagetrac-mirror/commit/12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681)\" to \"[3f9eebf2424e5d5a855894504845b40e8d61bc9e](https://github.com/sagemath/sagetrac-mirror/commit/3f9eebf2424e5d5a855894504845b40e8d61bc9e)\".",
    "created_at": "2022-10-23T22:23:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561160",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681](https://github.com/sagemath/sagetrac-mirror/commit/12e98ec4a7c3ee264ced1024cac3e0a9e4d4f681)" to "[3f9eebf2424e5d5a855894504845b40e8d61bc9e](https://github.com/sagemath/sagetrac-mirror/commit/3f9eebf2424e5d5a855894504845b40e8d61bc9e)".



---

archive/issue_comments_561161.json:
```json
{
    "body": "<a id='comment:26'></a>\n4f4c358 cherry-picked from #34679",
    "created_at": "2022-10-23T22:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561161",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
4f4c358 cherry-picked from #34679



---

archive/issue_comments_561162.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c63c5e563c17f4ccb79200447b31c98ee45ce91\">6c63c5e</a></td><td><code>Revert \"build/pkgs/giac/spkg-install.in: Work around xcas::localisation error\"</code></td></tr></table>\n",
    "created_at": "2022-10-23T22:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561162",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c63c5e563c17f4ccb79200447b31c98ee45ce91">6c63c5e</a></td><td><code>Revert "build/pkgs/giac/spkg-install.in: Work around xcas::localisation error"</code></td></tr></table>




---

archive/issue_comments_561163.json:
```json
{
    "body": "**Changing commit** from \"[3f9eebf2424e5d5a855894504845b40e8d61bc9e](https://github.com/sagemath/sagetrac-mirror/commit/3f9eebf2424e5d5a855894504845b40e8d61bc9e)\" to \"[6c63c5e563c17f4ccb79200447b31c98ee45ce91](https://github.com/sagemath/sagetrac-mirror/commit/6c63c5e563c17f4ccb79200447b31c98ee45ce91)\".",
    "created_at": "2022-10-23T22:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561163",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[3f9eebf2424e5d5a855894504845b40e8d61bc9e](https://github.com/sagemath/sagetrac-mirror/commit/3f9eebf2424e5d5a855894504845b40e8d61bc9e)" to "[6c63c5e563c17f4ccb79200447b31c98ee45ce91](https://github.com/sagemath/sagetrac-mirror/commit/6c63c5e563c17f4ccb79200447b31c98ee45ce91)".



---

archive/issue_comments_561164.json:
```json
{
    "body": "<a id='comment:28'></a>\nBacking out these old fixes does not seem to change anything",
    "created_at": "2022-10-23T22:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561164",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Backing out these old fixes does not seem to change anything



---

archive/issue_comments_561165.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [Matthias K\u00f6ppe](#comment%3A28):\n> Backing out these old fixes does not seem to change anything\n\nThat would have been nice if it was that simple. I'll have a go on linux with internal fltk to see what happens later this afternoon.",
    "created_at": "2022-10-24T00:00:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561165",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>
Replying to [Matthias Köppe](#comment%3A28):
> Backing out these old fixes does not seem to change anything

That would have been nice if it was that simple. I'll have a go on linux with internal fltk to see what happens later this afternoon.



---

archive/issue_comments_561166.json:
```json
{
    "body": "<a id='comment:30'></a>\nI can reproduce in linux, and I did it at `-j1` to have a nice trace\n\n```\nlibtool: compile:  g++ -std=c++14 -DHAVE_CONFIG_H -I. -I.. -DIN_GIAC -I. -I.. -I. -I.. -g -O2 -I../fltk-1.3.8 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -DTIMEOUT -MT Xcas1.lo -MD -MP -MF .deps/Xcas1.Tpo -c Xcas1.cc  -fPIC -DPIC -o .libs/Xcas1.o\n## a bunch of gcc-12 warnings about deprecation\nXcas1.cc:3725:8: error: variable or field 'Menu_Insert_ItemName' declared void\n 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {\n      |        ^~~~~~~~~~~~~~~~~~~~\nXcas1.cc:3725:29: error: 'Fl_Widget' was not declared in this scope\n 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {\n      |                             ^~~~~~~~~\nXcas1.cc:3725:41: error: 'w' was not declared in this scope\n 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {\n      |                                         ^\nXcas1.cc:3725:45: error: expected primary-expression before 'void'\n 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {\n      |                                             ^~~~\nXcas1.cc:3791:3: error: 'Fl_Menu_Item' does not name a type\n 3791 |   Fl_Menu_Item icas_xcas_menu[] = {\n      |   ^~~~~~~~~~~~\n```\nSomething is going wrong with the header inclusion.",
    "created_at": "2022-10-24T02:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561166",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
I can reproduce in linux, and I did it at `-j1` to have a nice trace

```
libtool: compile:  g++ -std=c++14 -DHAVE_CONFIG_H -I. -I.. -DIN_GIAC -I. -I.. -I. -I.. -g -O2 -I../fltk-1.3.8 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -DTIMEOUT -MT Xcas1.lo -MD -MP -MF .deps/Xcas1.Tpo -c Xcas1.cc  -fPIC -DPIC -o .libs/Xcas1.o
## a bunch of gcc-12 warnings about deprecation
Xcas1.cc:3725:8: error: variable or field 'Menu_Insert_ItemName' declared void
 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {
      |        ^~~~~~~~~~~~~~~~~~~~
Xcas1.cc:3725:29: error: 'Fl_Widget' was not declared in this scope
 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {
      |                             ^~~~~~~~~
Xcas1.cc:3725:41: error: 'w' was not declared in this scope
 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {
      |                                         ^
Xcas1.cc:3725:45: error: expected primary-expression before 'void'
 3725 |   void Menu_Insert_ItemName(Fl_Widget * w , void*) {
      |                                             ^~~~
Xcas1.cc:3791:3: error: 'Fl_Menu_Item' does not name a type
 3791 |   Fl_Menu_Item icas_xcas_menu[] = {
      |   ^~~~~~~~~~~~
```
Something is going wrong with the header inclusion.



---

archive/issue_comments_561167.json:
```json
{
    "body": "<a id='comment:31'></a>\nThis is a bit silly but easy to overlook when not paying attention. \n\n`@`parisse your trick to ship fltk internally has a serious shortcomings. From `configure.ac`\n\n```\n\tdnl force FLTK static compilation if FLTK not present\n\tAC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS=\"$CXXFLAGS -I../fltk-1.3.8\" && LDFLAGS=\"$LDFLAGS -L../fltk-1.3.8/lib\"] ) \n\tdnl X11, check for opengl, fltk\n\tAC_CHECK_LIB(X11,main)\n\tAC_CHECK_LIB(Xinerama, main)\n\tAC_CHECK_LIB(fontconfig, main)\n\tAC_CHECK_LIB(Xft, main)\n\tAC_CHECK_LIB(Xext, main)\n\tAC_CHECK_LIB(Xrender, main)\n\tAC_CHECK_LIB(fltk_gl, main)\n\tAC_CHECK_LIB(fltk, main)\n\tif test \"$HAVE_LIBFLTK\" = \"1\"; then\n\t   AC_DEFINE([HAVE_LIBFLVW],1, [Now defined if fltk is available])\n\tfi\n\tAC_CHECK_LIB(z,main)\n\tAC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))\n\tAC_CHECK_LIB(jpeg, main)\n\tAC_CHECK_LIB(fltk_images, main)\n\tFLTK_LIBS=\"$LIBS $X_LIBS\"\n\tAC_SUBST(FLTK_LIBS)\n```\nAt the end of the day I found that `config.h` was listing `HAVE_LIBFLTK` as undefined, which in turn means that inclusion of fltk headers in `Xcas1.cc`, where we see the failure is not happening because there is still a guard `ifdef HAVE_LIBFLTK` - which should go if fltk is mandatory (and it really is).\n\nBut let's figure why it happens. So, inspection of `config.log`\n\n```\nconfigure:21818: checking for main in -lfltk\nconfigure:21840: g++ -std=c++14 -o conftest -g -O2 -I../fltk-1.3.8   -L../fltk-1.3.8/lib conftest.cpp -lfltk  -lXrender -lXext -lXft -lfontconfig -lXinerama -lX11 -lGL -lcurl -lglpk -lao -ldl -lpng16 -lm -lecm -lmpfi -lmpfr -lgmp  >&5\n/usr/lib/gcc/x86_64-pc-linux-gnu/12/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lfltk\n```\nWell, `-I../fltk-1.3.8` and `-L../fltk-1.3.8/lib` will work very well once you go to the subfolder `src`, but it doesn't from the top level source directory from which `configure` is run. In effect, you probably want to replace `../fltk-1.3.8` by something that does `${srcdir}/fltk-1.3.8` which would be an absolute path that would be right in both cases.",
    "created_at": "2022-10-24T03:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561167",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>
This is a bit silly but easy to overlook when not paying attention. 

`@`parisse your trick to ship fltk internally has a serious shortcomings. From `configure.ac`

```
	dnl force FLTK static compilation if FLTK not present
	AC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS="$CXXFLAGS -I../fltk-1.3.8" && LDFLAGS="$LDFLAGS -L../fltk-1.3.8/lib"] ) 
	dnl X11, check for opengl, fltk
	AC_CHECK_LIB(X11,main)
	AC_CHECK_LIB(Xinerama, main)
	AC_CHECK_LIB(fontconfig, main)
	AC_CHECK_LIB(Xft, main)
	AC_CHECK_LIB(Xext, main)
	AC_CHECK_LIB(Xrender, main)
	AC_CHECK_LIB(fltk_gl, main)
	AC_CHECK_LIB(fltk, main)
	if test "$HAVE_LIBFLTK" = "1"; then
	   AC_DEFINE([HAVE_LIBFLVW],1, [Now defined if fltk is available])
	fi
	AC_CHECK_LIB(z,main)
	AC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))
	AC_CHECK_LIB(jpeg, main)
	AC_CHECK_LIB(fltk_images, main)
	FLTK_LIBS="$LIBS $X_LIBS"
	AC_SUBST(FLTK_LIBS)
```
At the end of the day I found that `config.h` was listing `HAVE_LIBFLTK` as undefined, which in turn means that inclusion of fltk headers in `Xcas1.cc`, where we see the failure is not happening because there is still a guard `ifdef HAVE_LIBFLTK` - which should go if fltk is mandatory (and it really is).

But let's figure why it happens. So, inspection of `config.log`

```
configure:21818: checking for main in -lfltk
configure:21840: g++ -std=c++14 -o conftest -g -O2 -I../fltk-1.3.8   -L../fltk-1.3.8/lib conftest.cpp -lfltk  -lXrender -lXext -lXft -lfontconfig -lXinerama -lX11 -lGL -lcurl -lglpk -lao -ldl -lpng16 -lm -lecm -lmpfi -lmpfr -lgmp  >&5
/usr/lib/gcc/x86_64-pc-linux-gnu/12/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lfltk
```
Well, `-I../fltk-1.3.8` and `-L../fltk-1.3.8/lib` will work very well once you go to the subfolder `src`, but it doesn't from the top level source directory from which `configure` is run. In effect, you probably want to replace `../fltk-1.3.8` by something that does `${srcdir}/fltk-1.3.8` which would be an absolute path that would be right in both cases.



---

archive/issue_comments_561168.json:
```json
{
    "body": "<a id='comment:32'></a>\nI should add one more thing. Removing the guards that prevents the inclusion of headers will enable you to compile the like of `Xcas1.cc` which are using fltk headers. But if that's the only thing you do, you will fail at linking time. `AC_CHECK_LIB(fltk, main)` failed so `-lftlk` has not been added to `LIBS` and you will get missing symbols.",
    "created_at": "2022-10-24T04:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561168",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>
I should add one more thing. Removing the guards that prevents the inclusion of headers will enable you to compile the like of `Xcas1.cc` which are using fltk headers. But if that's the only thing you do, you will fail at linking time. `AC_CHECK_LIB(fltk, main)` failed so `-lftlk` has not been added to `LIBS` and you will get missing symbols.



---

archive/issue_comments_561169.json:
```json
{
    "body": "<a id='comment:33'></a>\n1.9.0.27 out but I cannot see changes that would make a difference to vendored fltk.\n\nI may prepare something for upstream, `configure.ac` needs touching.",
    "created_at": "2022-10-24T20:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561169",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:33'></a>
1.9.0.27 out but I cannot see changes that would make a difference to vendored fltk.

I may prepare something for upstream, `configure.ac` needs touching.



---

archive/issue_comments_561170.json:
```json
{
    "body": "<a id='comment:34'></a>\nI got further with \n\n```\ndiff --git a/configure.ac b/configure.ac\nindex 1d77ab8..cd789ad 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -449,6 +449,8 @@ dnl\t\tAC_CHECK_LIB(GLU, main)\n \tAC_CHECK_LIB(Xft, main)\n \tAC_CHECK_LIB(Xext, main)\n \tAC_CHECK_LIB(Xrender, main)\n+\tsave_LDFLAGS=\"$LDFLAGS\"\n+\tLDFLAGS=\"$LDFLAGS -L./fltk-1.3.8/lib\"\n \tAC_CHECK_LIB(fltk_gl, main)\n \tAC_CHECK_LIB(fltk, main)\n \tif test \"$HAVE_LIBFLTK\" = \"1\"; then\n@@ -458,6 +460,7 @@ dnl\t\tAC_CHECK_LIB(GLU, main)\n \tAC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))\n \tAC_CHECK_LIB(jpeg, main)\n \tAC_CHECK_LIB(fltk_images, main)\n+\tLDFLAGS=\"$save_LDFLAGS\"\n \tFLTK_LIBS=\"$LIBS $X_LIBS\"\n \tAC_SUBST(FLTK_LIBS)\n   fi\n```\nbut it failed linking on my box because the libraries collected by the configure script were not complete compared to what the vendored fltk found and used on my system. The next step is either to minimise the configuration of the vendored fltk or use `fltk-config`. For info that's what my vendored fltk needs once built\n\n```\nfbissey@tarazed /home/portage/sci-mathematics/giac-1.9.0.27/work/giac-1.9.0 $ ./fltk-1.3.8/fltk-config --ldflags\n-L./fltk-1.3.8/lib -lfltk -lXrender -lXcursor -lXfixes -lXext -lXft -lfontconfig -lXinerama -lpthread -lm -lX11\n```\nThings could be really simplified if `fltk-config` is looked for and used.",
    "created_at": "2022-11-01T23:20:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561170",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
I got further with 

```
diff --git a/configure.ac b/configure.ac
index 1d77ab8..cd789ad 100644
--- a/configure.ac
+++ b/configure.ac
@@ -449,6 +449,8 @@ dnl		AC_CHECK_LIB(GLU, main)
 	AC_CHECK_LIB(Xft, main)
 	AC_CHECK_LIB(Xext, main)
 	AC_CHECK_LIB(Xrender, main)
+	save_LDFLAGS="$LDFLAGS"
+	LDFLAGS="$LDFLAGS -L./fltk-1.3.8/lib"
 	AC_CHECK_LIB(fltk_gl, main)
 	AC_CHECK_LIB(fltk, main)
 	if test "$HAVE_LIBFLTK" = "1"; then
@@ -458,6 +460,7 @@ dnl		AC_CHECK_LIB(GLU, main)
 	AC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))
 	AC_CHECK_LIB(jpeg, main)
 	AC_CHECK_LIB(fltk_images, main)
+	LDFLAGS="$save_LDFLAGS"
 	FLTK_LIBS="$LIBS $X_LIBS"
 	AC_SUBST(FLTK_LIBS)
   fi
```
but it failed linking on my box because the libraries collected by the configure script were not complete compared to what the vendored fltk found and used on my system. The next step is either to minimise the configuration of the vendored fltk or use `fltk-config`. For info that's what my vendored fltk needs once built

```
fbissey@tarazed /home/portage/sci-mathematics/giac-1.9.0.27/work/giac-1.9.0 $ ./fltk-1.3.8/fltk-config --ldflags
-L./fltk-1.3.8/lib -lfltk -lXrender -lXcursor -lXfixes -lXext -lXft -lfontconfig -lXinerama -lpthread -lm -lX11
```
Things could be really simplified if `fltk-config` is looked for and used.



---

archive/issue_comments_561171.json:
```json
{
    "body": "<a id='comment:35'></a>\nOK that got me through\n\n```\ndiff --git a/configure.ac b/configure.ac\nindex 1d77ab8..c0ab350 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -444,11 +444,15 @@ dnl\t\tAC_CHECK_LIB(GLU, main)\n \tAC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS=\"$CXXFLAGS -I../fltk-1.3.8\" && LDFLAGS=\"$LDFLAGS -L../fltk-1.3.8/lib\"] ) \n \tdnl X11, check for opengl, fltk\n \tAC_CHECK_LIB(X11,main)\n+\tAC_CHECK_LIB(Xcursor,main)\n+\tAC_CHECK_LIB(Xfixes,main)\n \tAC_CHECK_LIB(Xinerama, main)\n \tAC_CHECK_LIB(fontconfig, main)\n \tAC_CHECK_LIB(Xft, main)\n \tAC_CHECK_LIB(Xext, main)\n \tAC_CHECK_LIB(Xrender, main)\n+\tsave_LDFLAGS=\"$LDFLAGS\"\n+\tLDFLAGS=\"$LDFLAGS -L./fltk-1.3.8/lib\"\n \tAC_CHECK_LIB(fltk_gl, main)\n \tAC_CHECK_LIB(fltk, main)\n \tif test \"$HAVE_LIBFLTK\" = \"1\"; then\n@@ -458,6 +462,7 @@ dnl\t\tAC_CHECK_LIB(GLU, main)\n \tAC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))\n \tAC_CHECK_LIB(jpeg, main)\n \tAC_CHECK_LIB(fltk_images, main)\n+\tLDFLAGS=\"$save_LDFLAGS\"\n \tFLTK_LIBS=\"$LIBS $X_LIBS\"\n \tAC_SUBST(FLTK_LIBS)\n   fi\n```\nbut checking for `fltk-config`, building fltk if it is absent, and then querying it properly would tidy up the configure script in my opinion.",
    "created_at": "2022-11-01T23:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561171",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:35'></a>
OK that got me through

```
diff --git a/configure.ac b/configure.ac
index 1d77ab8..c0ab350 100644
--- a/configure.ac
+++ b/configure.ac
@@ -444,11 +444,15 @@ dnl		AC_CHECK_LIB(GLU, main)
 	AC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS="$CXXFLAGS -I../fltk-1.3.8" && LDFLAGS="$LDFLAGS -L../fltk-1.3.8/lib"] ) 
 	dnl X11, check for opengl, fltk
 	AC_CHECK_LIB(X11,main)
+	AC_CHECK_LIB(Xcursor,main)
+	AC_CHECK_LIB(Xfixes,main)
 	AC_CHECK_LIB(Xinerama, main)
 	AC_CHECK_LIB(fontconfig, main)
 	AC_CHECK_LIB(Xft, main)
 	AC_CHECK_LIB(Xext, main)
 	AC_CHECK_LIB(Xrender, main)
+	save_LDFLAGS="$LDFLAGS"
+	LDFLAGS="$LDFLAGS -L./fltk-1.3.8/lib"
 	AC_CHECK_LIB(fltk_gl, main)
 	AC_CHECK_LIB(fltk, main)
 	if test "$HAVE_LIBFLTK" = "1"; then
@@ -458,6 +462,7 @@ dnl		AC_CHECK_LIB(GLU, main)
 	AC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))
 	AC_CHECK_LIB(jpeg, main)
 	AC_CHECK_LIB(fltk_images, main)
+	LDFLAGS="$save_LDFLAGS"
 	FLTK_LIBS="$LIBS $X_LIBS"
 	AC_SUBST(FLTK_LIBS)
   fi
```
but checking for `fltk-config`, building fltk if it is absent, and then querying it properly would tidy up the configure script in my opinion.



---

archive/issue_comments_561172.json:
```json
{
    "body": "<a id='comment:36'></a>\nCan a \"headless\" version of fltk be built when no GUI libraries are available (no X11, no Wayland, ...)? If no, then this is a problem for Sage. We definitely want to be able to build it in a server environment without GUI libraries.",
    "created_at": "2022-11-01T23:37:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561172",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Can a "headless" version of fltk be built when no GUI libraries are available (no X11, no Wayland, ...)? If no, then this is a problem for Sage. We definitely want to be able to build it in a server environment without GUI libraries.



---

archive/issue_comments_561173.json:
```json
{
    "body": "<a id='comment:37'></a>\nGood question. Looking into it.",
    "created_at": "2022-11-01T23:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561173",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>
Good question. Looking into it.



---

archive/issue_comments_561174.json:
```json
{
    "body": "<a id='comment:38'></a>\nOn Linux, needs `libX11` at a minimum as far as I can tell.",
    "created_at": "2022-11-01T23:47:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561174",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'></a>
On Linux, needs `libX11` at a minimum as far as I can tell.



---

archive/issue_comments_561175.json:
```json
{
    "body": "<a id='comment:39'></a>\nGUI stuff is for xcas. libgiac itself is free from gui stuff. If we could do a lib only build and not use pexpect at all we could achieve that goal.",
    "created_at": "2022-11-02T00:07:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561175",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
GUI stuff is for xcas. libgiac itself is free from gui stuff. If we could do a lib only build and not use pexpect at all we could achieve that goal.



---

archive/issue_comments_561176.json:
```json
{
    "body": "<a id='comment:40'></a>\n1.9.0.29 is out - it doesn't fix the flaws that I pointed out in configure.ac to find a vendored fltk. But in this version `--disable-fltk` works. So, we can have a headless install without any dependencies on X11.",
    "created_at": "2022-11-07T01:04:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561176",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'></a>
1.9.0.29 is out - it doesn't fix the flaws that I pointed out in configure.ac to find a vendored fltk. But in this version `--disable-fltk` works. So, we can have a headless install without any dependencies on X11.



---

archive/issue_comments_561177.json:
```json
{
    "body": "<a id='comment:41'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/087869aec8771cf8c8ce48e1f95af3205e9c3cb1\">087869a</a></td><td><code>build/pkgs/giac: Update to 1.9.0.21</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be697cc6aaf6e9fd758d1181ef5d27e36223e12c\">be697cc</a></td><td><code>build/pkgs/giac: Update to 1.9.0.25</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4124879c232da991e93c79ccfbeca031168910c\">c412487</a></td><td><code>re-enable giac gui (xcas using ftlk)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90911b343056ca87f234b55ced5ab268ffa938b9\">90911b3</a></td><td><code>build/pkgs/giac/patches/nofltk-check.patch: Remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc8a83aa0c0c3938aa28c2ec8e23667370a4fec2\">bc8a83a</a></td><td><code>Revert \"build/pkgs/giac/spkg-install.in: Work around xcas::localisation error\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce60cba7bed0690dfbd8686ab804e8c19b8a24b9\">ce60cba</a></td><td><code>build/pkgs/giac: Update to 1.9.0.29</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8\">63cfa77</a></td><td><code>build/pkgs/giac: Use --disable-fltk, allow overriding by env var</code></td></tr></table>\n",
    "created_at": "2022-11-12T03:23:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561177",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:41'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/087869aec8771cf8c8ce48e1f95af3205e9c3cb1">087869a</a></td><td><code>build/pkgs/giac: Update to 1.9.0.21</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be697cc6aaf6e9fd758d1181ef5d27e36223e12c">be697cc</a></td><td><code>build/pkgs/giac: Update to 1.9.0.25</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4124879c232da991e93c79ccfbeca031168910c">c412487</a></td><td><code>re-enable giac gui (xcas using ftlk)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90911b343056ca87f234b55ced5ab268ffa938b9">90911b3</a></td><td><code>build/pkgs/giac/patches/nofltk-check.patch: Remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc8a83aa0c0c3938aa28c2ec8e23667370a4fec2">bc8a83a</a></td><td><code>Revert "build/pkgs/giac/spkg-install.in: Work around xcas::localisation error"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce60cba7bed0690dfbd8686ab804e8c19b8a24b9">ce60cba</a></td><td><code>build/pkgs/giac: Update to 1.9.0.29</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8">63cfa77</a></td><td><code>build/pkgs/giac: Use --disable-fltk, allow overriding by env var</code></td></tr></table>




---

archive/issue_comments_561178.json:
```json
{
    "body": "**Changing commit** from \"[6c63c5e563c17f4ccb79200447b31c98ee45ce91](https://github.com/sagemath/sagetrac-mirror/commit/6c63c5e563c17f4ccb79200447b31c98ee45ce91)\" to \"[63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8](https://github.com/sagemath/sagetrac-mirror/commit/63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8)\".",
    "created_at": "2022-11-12T03:23:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561178",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[6c63c5e563c17f4ccb79200447b31c98ee45ce91](https://github.com/sagemath/sagetrac-mirror/commit/6c63c5e563c17f4ccb79200447b31c98ee45ce91)" to "[63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8](https://github.com/sagemath/sagetrac-mirror/commit/63cfa77cacc87a1e6ea773d9b526d72af3f0d1e8)".



---

archive/issue_events_306892.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-12T03:28:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "rename": {
        "from": "Upgrade giac to 1.9.0.25",
        "to": "Upgrade giac to 1.9.0.29"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34583#event-306892"
}
```



---

archive/issue_comments_561179.json:
```json
{
    "body": "<a id='comment:43'></a>\nWhy not make the default with GUI enabled and use the environment variable for server installs?\n\nI'm making changes to configure.ac, thanks for pointing to the broken path to fltk-1.3.8 while configure runs, I'm modifying to\nAC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS=\"$CXXFLAGS -I../fltk-1.3.8 -I./fltk-1.3.8\" && LDFLAGS=\"$LDFLAGS -L../fltk-1.3.8/lib -L./fltk-1.3.8/lib\"] )",
    "created_at": "2022-11-24T09:13:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561179",
    "user": "https://github.com/sagetrac-parisse"
}
```

<a id='comment:43'></a>
Why not make the default with GUI enabled and use the environment variable for server installs?

I'm making changes to configure.ac, thanks for pointing to the broken path to fltk-1.3.8 while configure runs, I'm modifying to
AC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS="$CXXFLAGS -I../fltk-1.3.8 -I./fltk-1.3.8" && LDFLAGS="$LDFLAGS -L../fltk-1.3.8/lib -L./fltk-1.3.8/lib"] )



---

archive/issue_comments_561180.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [Bernard Parisse](#comment%3A43):\n> I'm making changes to configure.ac, thanks for pointing to the broken path to fltk-1.3.8 while configure runs, I'm modifying to\n> AC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS=\"$CXXFLAGS -I../fltk-1.3.8 -I./fltk-1.3.8\" && LDFLAGS=\"$LDFLAGS -L../fltk-1.3.8/lib -L./fltk-1.3.8/lib\"] ) \n> \n\nDo not forget the extra checks from [comment:35](#comment%3A35) for `Xcursor` and `Xfixes`. If fltk finds them at configure time they will be needed to link xcas as well. Also note that you do not need to change `CXXFLAGS` because you do no test for headers again. Only `LDFLAGS` needs adjusting.",
    "created_at": "2022-11-24T09:21:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561180",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
Replying to [Bernard Parisse](#comment%3A43):
> I'm making changes to configure.ac, thanks for pointing to the broken path to fltk-1.3.8 while configure runs, I'm modifying to
> AC_CHECK_HEADERS(FL/Fl.H,[],[tar xfj fltk-1.3.8-source.tar.bz2 ; cd fltk-1.3.8 && ./configure --disable-shared && make && cd .. && CXXFLAGS="$CXXFLAGS -I../fltk-1.3.8 -I./fltk-1.3.8" && LDFLAGS="$LDFLAGS -L../fltk-1.3.8/lib -L./fltk-1.3.8/lib"] ) 
> 

Do not forget the extra checks from [comment:35](#comment%3A35) for `Xcursor` and `Xfixes`. If fltk finds them at configure time they will be needed to link xcas as well. Also note that you do not need to change `CXXFLAGS` because you do no test for headers again. Only `LDFLAGS` needs adjusting.



---

archive/issue_comments_561181.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [Bernard Parisse](#comment%3A43):\n> Why not make the default with GUI enabled and use the environment variable for server installs?\n\nI'm not aware of a use case for the GUI within Sage; maybe you can explain what functionality it would give to Sage users?",
    "created_at": "2022-11-24T20:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561181",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Replying to [Bernard Parisse](#comment%3A43):
> Why not make the default with GUI enabled and use the environment variable for server installs?

I'm not aware of a use case for the GUI within Sage; maybe you can explain what functionality it would give to Sage users?



---

archive/issue_comments_561182.json:
```json
{
    "body": "<a id='comment:46'></a>\nIf you think of a researcher in maths, it's probably not useful, many are probably working with the commandline interface or nohup scripts in non interactive mode. A college student might find useful some GUI features of Xcas like wizards to help enter some commands, or the recently introduced tracemode for function and parametric plots, or interactive analytic geometry 2d/3d, etc.\n\nBut to be honest, that's not my main motivation. Sage has some benefits using some features of Giac. Now I would appreciate if Giac could benefit from being included inside Sage: and that means here a straightforward compilation path, this is especially important for systems where Giac/Xcas is not packaged. I would really appreciate if Sage developers could reward my involvment in math software implementation by enabling by default the full version of Giac/Xcas with GUI inside Sagemaths, instead of a stripped version without GUI.\n\nThanks!",
    "created_at": "2022-11-29T19:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34583",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34583#issuecomment-561182",
    "user": "https://github.com/sagetrac-parisse"
}
```

<a id='comment:46'></a>
If you think of a researcher in maths, it's probably not useful, many are probably working with the commandline interface or nohup scripts in non interactive mode. A college student might find useful some GUI features of Xcas like wizards to help enter some commands, or the recently introduced tracemode for function and parametric plots, or interactive analytic geometry 2d/3d, etc.

But to be honest, that's not my main motivation. Sage has some benefits using some features of Giac. Now I would appreciate if Giac could benefit from being included inside Sage: and that means here a straightforward compilation path, this is especially important for systems where Giac/Xcas is not packaged. I would really appreciate if Sage developers could reward my involvment in math software implementation by enabling by default the full version of Giac/Xcas with GUI inside Sagemaths, instead of a stripped version without GUI.

Thanks!
