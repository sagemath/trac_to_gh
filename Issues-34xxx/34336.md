# Issue 34336: base_ring is wrong for rational points in a projective space over a finite field

archive/issues_034099.json:
```json
{
    "body": "This is wrong: \n\n```\nsage: P3 = ProjectiveSpace(2, GF(3))                                                                                                                                                                                \nsage: a = P3( (0,0,1) ); a                                                                                                                                                                                          \n(0 : 0 : 1)\nsage: a.parent()                                                                                                                                                                                                    \nSet of rational points of Projective Space of dimension 2 over Finite Field of size 3\nsage: a.base_ring()                                                                                                                                                                                                 \nInteger Ring\nsage: a.parent().base_ring()                                                                                                                                                                                        \nInteger Ring\n```\nSurely in both cases the base ring should be GF(3).\n\nThis also afflicts points generated in other ways.  For example\n\n```\nsage: x,y,z = P3.gens()                                                                                                                                                                                             \nsage: C = Curve(x+y+z)                                                                                                                                                                                              \nsage: b = C.rational_points()[0]                                                                                                                                                                                    \nsage: b                                                                                                                                                                                                             \n(0 : 2 : 1)\nsage: b.parent()                                                                                                                                                                                                    \nSet of rational points of Projective Plane Curve over Finite Field of size 3 defined by x0 + x1 + x2\nsage: b.base_ring()                                                                                                                                                                                                 \nInteger Ring\n```\n\nBranch/Commit: 1626caf2b18735742316701d47018a38952f4988\n\nReviewer: Kwankyu Lee\n\nAuthor: Lorenz Panny\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34336\n\n",
    "closed_at": "2022-08-30T19:04:03Z",
    "created_at": "2022-08-10T19:13:07Z",
    "labels": [
        "component: algebraic geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "base_ring is wrong for rational points in a projective space over a finite field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34336",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```
This is wrong: 

```
sage: P3 = ProjectiveSpace(2, GF(3))                                                                                                                                                                                
sage: a = P3( (0,0,1) ); a                                                                                                                                                                                          
(0 : 0 : 1)
sage: a.parent()                                                                                                                                                                                                    
Set of rational points of Projective Space of dimension 2 over Finite Field of size 3
sage: a.base_ring()                                                                                                                                                                                                 
Integer Ring
sage: a.parent().base_ring()                                                                                                                                                                                        
Integer Ring
```
Surely in both cases the base ring should be GF(3).

This also afflicts points generated in other ways.  For example

```
sage: x,y,z = P3.gens()                                                                                                                                                                                             
sage: C = Curve(x+y+z)                                                                                                                                                                                              
sage: b = C.rational_points()[0]                                                                                                                                                                                    
sage: b                                                                                                                                                                                                             
(0 : 2 : 1)
sage: b.parent()                                                                                                                                                                                                    
Set of rational points of Projective Plane Curve over Finite Field of size 3 defined by x0 + x1 + x2
sage: b.base_ring()                                                                                                                                                                                                 
Integer Ring
```

Branch/Commit: 1626caf2b18735742316701d47018a38952f4988

Reviewer: Kwankyu Lee

Author: Lorenz Panny

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34336





---

archive/issue_comments_683246.json:
```json
{
    "body": "Changing author from \"Mark Saaltink\" to \"Lorenz Panny\"",
    "created_at": "2022-08-14T00:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683246",
    "user": "https://github.com/yyyyx4"
}
```

Changing author from "Mark Saaltink" to "Lorenz Panny"



---

archive/issue_comments_683247.json:
```json
{
    "body": "Changing commit from \"\" to \"6dc2131f96b49162974f7e9c71511d89c96de117\"",
    "created_at": "2022-08-14T00:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683247",
    "user": "https://github.com/yyyyx4"
}
```

Changing commit from "" to "6dc2131f96b49162974f7e9c71511d89c96de117"



---

archive/issue_comments_683248.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-14T00:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683248",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_683249.json:
```json
{
    "body": "<a id='comment:1'></a>\nThese fairly simple changes seem to do the trick.\n\n(I think the \"author\" field is for the author of the patch, not the bug report \u2014 someone please correct me if I'm wrong!)\n\n---\nNew commits:\n|                                                                                                                                          |                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|\n|[658c959](https://github.com/sagemath/sagetrac-mirror/commit/658c959049b3d0f2570dca579334dbe17d6e01c4)|`move .base_ring() up from SchemeMorphism_polynomial to SchemeMorphism`|\n|[6dc2131](https://github.com/sagemath/sagetrac-mirror/commit/6dc2131f96b49162974f7e9c71511d89c96de117)|`automatically determine SchemeMorphism base ring if none is given`|",
    "created_at": "2022-08-14T00:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683249",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:1'></a>
These fairly simple changes seem to do the trick.

(I think the "author" field is for the author of the patch, not the bug report â€” someone please correct me if I'm wrong!)

---
New commits:
|                                                                                                                                          |                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
|[658c959](https://github.com/sagemath/sagetrac-mirror/commit/658c959049b3d0f2570dca579334dbe17d6e01c4)|`move .base_ring() up from SchemeMorphism_polynomial to SchemeMorphism`|
|[6dc2131](https://github.com/sagemath/sagetrac-mirror/commit/6dc2131f96b49162974f7e9c71511d89c96de117)|`automatically determine SchemeMorphism base ring if none is given`|



---

archive/issue_comments_683250.json:
```json
{
    "body": "Changing branch from \"\" to \"public/34336\"",
    "created_at": "2022-08-14T00:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683250",
    "user": "https://github.com/yyyyx4"
}
```

Changing branch from "" to "public/34336"



---

archive/issue_comments_683251.json:
```json
{
    "body": "Changing commit from \"6dc2131f96b49162974f7e9c71511d89c96de117\" to \"cad694ca6f8c8433b43ceda874282b441bf9d2c4\"",
    "created_at": "2022-08-14T05:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6dc2131f96b49162974f7e9c71511d89c96de117" to "cad694ca6f8c8433b43ceda874282b441bf9d2c4"



---

archive/issue_comments_683252.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[b07543a](https://github.com/sagemath/sagetrac-mirror/commit/b07543ad50592d7fb0582a76888d9862b2ed7c66)|`Merge branch 'develop' into t/34336/public/34336`|\n|[cad694c](https://github.com/sagemath/sagetrac-mirror/commit/cad694ca6f8c8433b43ceda874282b441bf9d2c4)|`Some edits and import from sage.structure.element`|",
    "created_at": "2022-08-14T05:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[b07543a](https://github.com/sagemath/sagetrac-mirror/commit/b07543ad50592d7fb0582a76888d9862b2ed7c66)|`Merge branch 'develop' into t/34336/public/34336`|
|[cad694c](https://github.com/sagemath/sagetrac-mirror/commit/cad694ca6f8c8433b43ceda874282b441bf9d2c4)|`Some edits and import from sage.structure.element`|



---

archive/issue_comments_683253.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-In [SageMath](SageMath) 9.4:\n+This is wrong: \n \n ```\n sage: P3 = ProjectiveSpace(2, GF(3))                                                                                                                                                                                \n``````\n",
    "created_at": "2022-08-14T05:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683253",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-In [SageMath](SageMath) 9.4:
+This is wrong: 
 
 ```
 sage: P3 = ProjectiveSpace(2, GF(3))                                                                                                                                                                                
``````




---

archive/issue_comments_683254.json:
```json
{
    "body": "<a id='comment:4'></a>\nI made small edits.\n\n```diff\ndiff --git a/src/sage/schemes/generic/homset.py b/src/sage/schemes/generic/homset.py\nindex 4115f163b4..5a67c614ef 100644\n--- a/src/sage/schemes/generic/homset.py\n+++ b/src/sage/schemes/generic/homset.py\n@@ -154,7 +154,7 @@ class SchemeHomsetFactory(UniqueFactory):\n         if isinstance(Y, CommutativeRing):\n             Y = AffineScheme(Y)\n         if base is None:\n-            from sage.structure.all import coercion_model\n+            from sage.structure.element import coercion_model\n             base = coercion_model.common_parent(X.base_ring(), Y.base_ring())\n         if is_AffineScheme(base):\n             base_spec = base\n```\n\nIt is not recommended to import from `.all`, which is intended for filling the global namespace for users.\n\n```diff\ndiff --git a/src/sage/schemes/generic/morphism.py b/src/sage/schemes/generic/morphism.py\nindex b1409f05ba..4c75777c1d 100644\n--- a/src/sage/schemes/generic/morphism.py\n+++ b/src/sage/schemes/generic/morphism.py\n@@ -482,7 +482,7 @@ class SchemeMorphism(Element):\n     def base_ring(self):\n         r\"\"\"\n         Return the base ring of ``self``, that is, the ring over which\n-        the coefficients of ``self`` are given as polynomials.\n+        the defining polynomials of ``self`` are defined.\n \n         OUTPUT:\n \n```\n\nas the meaning of the original sentence is not clear.\n\nI am positive otherwise.",
    "created_at": "2022-08-14T05:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683254",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:4'></a>
I made small edits.

```diff
diff --git a/src/sage/schemes/generic/homset.py b/src/sage/schemes/generic/homset.py
index 4115f163b4..5a67c614ef 100644
--- a/src/sage/schemes/generic/homset.py
+++ b/src/sage/schemes/generic/homset.py
@@ -154,7 +154,7 @@ class SchemeHomsetFactory(UniqueFactory):
         if isinstance(Y, CommutativeRing):
             Y = AffineScheme(Y)
         if base is None:
-            from sage.structure.all import coercion_model
+            from sage.structure.element import coercion_model
             base = coercion_model.common_parent(X.base_ring(), Y.base_ring())
         if is_AffineScheme(base):
             base_spec = base
```

It is not recommended to import from `.all`, which is intended for filling the global namespace for users.

```diff
diff --git a/src/sage/schemes/generic/morphism.py b/src/sage/schemes/generic/morphism.py
index b1409f05ba..4c75777c1d 100644
--- a/src/sage/schemes/generic/morphism.py
+++ b/src/sage/schemes/generic/morphism.py
@@ -482,7 +482,7 @@ class SchemeMorphism(Element):
     def base_ring(self):
         r"""
         Return the base ring of ``self``, that is, the ring over which
-        the coefficients of ``self`` are given as polynomials.
+        the defining polynomials of ``self`` are defined.
 
         OUTPUT:
 
```

as the meaning of the original sentence is not clear.

I am positive otherwise.



---

archive/issue_comments_683255.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Kwankyu Lee\"",
    "created_at": "2022-08-14T05:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683255",
    "user": "https://github.com/kwankyu"
}
```

Changing reviewer from "" to "Kwankyu Lee"



---

archive/issue_comments_683256.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[1626caf](https://github.com/sagemath/sagetrac-mirror/commit/1626caf2b18735742316701d47018a38952f4988)|`Fix a doctest`|",
    "created_at": "2022-08-14T08:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[1626caf](https://github.com/sagemath/sagetrac-mirror/commit/1626caf2b18735742316701d47018a38952f4988)|`Fix a doctest`|



---

archive/issue_comments_683257.json:
```json
{
    "body": "Changing commit from \"cad694ca6f8c8433b43ceda874282b441bf9d2c4\" to \"1626caf2b18735742316701d47018a38952f4988\"",
    "created_at": "2022-08-14T08:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cad694ca6f8c8433b43ceda874282b441bf9d2c4" to "1626caf2b18735742316701d47018a38952f4988"



---

archive/issue_comments_683258.json:
```json
{
    "body": "<a id='comment:7'></a>\nYou can set positive review if you are okay with my edits.",
    "created_at": "2022-08-14T13:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683258",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>
You can set positive review if you are okay with my edits.



---

archive/issue_comments_683259.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-14T16:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683259",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_683260.json:
```json
{
    "body": "<a id='comment:8'></a>\nLooks good, thank you!",
    "created_at": "2022-08-14T16:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683260",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:8'></a>
Looks good, thank you!



---

archive/issue_comments_683261.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-30T19:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683261",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_683262.json:
```json
{
    "body": "Changing branch from \"public/34336\" to \"1626caf2b18735742316701d47018a38952f4988\"",
    "created_at": "2022-08-30T19:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34336#issuecomment-683262",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/34336" to "1626caf2b18735742316701d47018a38952f4988"



---

archive/issue_events_100669.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-30T19:04:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34336",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34336#event-100669"
}
```
