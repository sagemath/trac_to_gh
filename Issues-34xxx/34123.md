# Issue 34123: Fast initialization for edge connectivity

archive/issues_033886.json:
```json
{
    "body": "Keywords: GSoC2022\n\nRelated to #33839\n\nIssue created by migration from https://trac.sagemath.org/ticket/34123\n\n",
    "closed_at": "2022-10-17T22:43:40Z",
    "created_at": "2022-07-06T14:34:59Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Fast initialization for edge connectivity",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34123",
    "user": "https://github.com/enjeck"
}
```
Keywords: GSoC2022

Related to #33839

Issue created by migration from https://trac.sagemath.org/ticket/34123





---

archive/issue_comments_480598.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-07-06T15:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480598",
    "user": "https://github.com/enjeck"
}
```

New commits:



---

archive/issue_comments_480599.json:
```json
{
    "body": "Can you add more comments to better explain the steps.\n\nYou define `visited` as a list. Be aware that with lists, a test like `v in visited` requires linear time (in the size of the list). You should use a set instead as testing membership to a set requires constant time.",
    "created_at": "2022-07-08T15:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480599",
    "user": "https://github.com/dcoudert"
}
```

Can you add more comments to better explain the steps.

You define `visited` as a list. Be aware that with lists, a test like `v in visited` requires linear time (in the size of the list). You should use a set instead as testing membership to a set requires constant time.



---

archive/issue_comments_480600.json:
```json
{
    "body": "Changing keywords from \"\" to \"GSoC2022\".",
    "created_at": "2022-07-08T15:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480600",
    "user": "https://github.com/dcoudert"
}
```

Changing keywords from "" to "GSoC2022".



---

archive/issue_comments_480601.json:
```json
{
    "body": "Yeah, I can add more comments. Right, I should be using a set, totally missed that. \n\nBy the way, I had been trying to make this ticket's diffs show just my commits, excluding yours from #33839, but I haven't figured out how yet.",
    "created_at": "2022-07-08T15:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480601",
    "user": "https://github.com/enjeck"
}
```

Yeah, I can add more comments. Right, I should be using a set, totally missed that. 

By the way, I had been trying to make this ticket's diffs show just my commits, excluding yours from #33839, but I haven't figured out how yet.



---

archive/issue_comments_480602.json:
```json
{
    "body": "> By the way, I had been trying to make this ticket's diffs show just my commits, excluding yours from #33839, but I haven't figured out how yet. \n\nI don't know if it's possible to do that. At least, when #33839 will be merged, it will remain only the diff.",
    "created_at": "2022-07-08T16:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480602",
    "user": "https://github.com/dcoudert"
}
```

> By the way, I had been trying to make this ticket's diffs show just my commits, excluding yours from #33839, but I haven't figured out how yet. 

I don't know if it's possible to do that. At least, when #33839 will be merged, it will remain only the diff.



---

archive/issue_comments_480603.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-26T06:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_480604.json:
```json
{
    "body": "I'm not sure where I'm going wrong. My DFS initialization is not fast. In fact, it's slower than the implementation without it. \n\nHere are the results of some tests carried out on complete digraphs:\n\n**Without initialization**\n\n*300 vertices*\nCPU times: user 648 ms, sys: 0 ns, total: 648 ms\nWall time: 646 ms\n299\n\n*500 vertices*\nCPU times: user 3.53 s, sys: 8 ms, total: 3.54 s\nWall time: 3.54 s\n499\n\n*1000 vertices*\nCPU times: user 29.7 s, sys: 27.2 ms, total: 29.7 s\nWall time: 29.8 s\n999\n\n**Mine, with initialization**\n\n*300 vertices*\nCPU times: user 844 ms, sys: 0 ns, total: 844 ms\nWall time: 841 ms\n299\n\n*500 vertices*\nCPU times: user 3.85 s, sys: 7.46 ms, total: 3.85 s\nWall time: 3.84 s\n499\n\n*1000 vertices*\nCPU times: user 31.1 s, sys: 3.45 ms, total: 31.1 s\nWall time: 31.2 s\n999",
    "created_at": "2022-07-26T06:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480604",
    "user": "https://github.com/enjeck"
}
```

I'm not sure where I'm going wrong. My DFS initialization is not fast. In fact, it's slower than the implementation without it. 

Here are the results of some tests carried out on complete digraphs:

**Without initialization**

*300 vertices*
CPU times: user 648 ms, sys: 0 ns, total: 648 ms
Wall time: 646 ms
299

*500 vertices*
CPU times: user 3.53 s, sys: 8 ms, total: 3.54 s
Wall time: 3.54 s
499

*1000 vertices*
CPU times: user 29.7 s, sys: 27.2 ms, total: 29.7 s
Wall time: 29.8 s
999

**Mine, with initialization**

*300 vertices*
CPU times: user 844 ms, sys: 0 ns, total: 844 ms
Wall time: 841 ms
299

*500 vertices*
CPU times: user 3.85 s, sys: 7.46 ms, total: 3.85 s
Wall time: 3.84 s
499

*1000 vertices*
CPU times: user 31.1 s, sys: 3.45 ms, total: 31.1 s
Wall time: 31.2 s
999



---

archive/issue_comments_480605.json:
```json
{
    "body": "I'm obviously missing something. Not sure what :/",
    "created_at": "2022-07-26T06:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480605",
    "user": "https://github.com/enjeck"
}
```

I'm obviously missing something. Not sure what :/



---

archive/issue_comments_480606.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-26T06:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480606",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480607.json:
```json
{
    "body": "Could be because your method is recursive. Can you try a non-recursive DFS ?\n\nAlso, have you checked that your method is valid with other types of graphs ?",
    "created_at": "2022-07-26T07:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480607",
    "user": "https://github.com/dcoudert"
}
```

Could be because your method is recursive. Can you try a non-recursive DFS ?

Also, have you checked that your method is valid with other types of graphs ?



---

archive/issue_comments_480608.json:
```json
{
    "body": "> Could be because your method is recursive. Can you try a non-recursive DFS ? \n\n\nOkay. I'll try to implement an iterative version. \n\n> Also, have you checked that your method is valid with other types of graphs ? \n\n\nJust did. It works on the Peterson graph, fails on Regular graphs. I get the error message \" *ValueError: did not find the right edge*\". \n\nI'll try to fix this and do more extensive testing",
    "created_at": "2022-07-26T10:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480608",
    "user": "https://github.com/enjeck"
}
```

> Could be because your method is recursive. Can you try a non-recursive DFS ? 


Okay. I'll try to implement an iterative version. 

> Also, have you checked that your method is valid with other types of graphs ? 


Just did. It works on the Peterson graph, fails on Regular graphs. I get the error message " *ValueError: did not find the right edge*". 

I'll try to fix this and do more extensive testing



---

archive/issue_comments_480609.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-02T09:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480609",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480610.json:
```json
{
    "body": "My latest commit removed the G_minus_T function, and instead updates the current k-1 intersection inline. I expected this to speed up the code a little bit, but that doesn't happen. Instead, it's slower than before. I'm confused\n\n**Test results, which are slower than that reported earlier**:\n\n*500 vertices* CPU times: user 5.83 s, sys: 4.03 ms, total: 5.84 s Wall time: 5.84 s 499\n\n*1000 vertices* CPU times: user 53.4 s, sys: 158 ms, total: 53.5 s Wall time: 54.1 s 999",
    "created_at": "2022-08-02T09:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480610",
    "user": "https://github.com/enjeck"
}
```

My latest commit removed the G_minus_T function, and instead updates the current k-1 intersection inline. I expected this to speed up the code a little bit, but that doesn't happen. Instead, it's slower than before. I'm confused

**Test results, which are slower than that reported earlier**:

*500 vertices* CPU times: user 5.83 s, sys: 4.03 ms, total: 5.84 s Wall time: 5.84 s 499

*1000 vertices* CPU times: user 53.4 s, sys: 158 ms, total: 53.5 s Wall time: 54.1 s 999



---

archive/issue_comments_480611.json:
```json
{
    "body": "Also, I haven't yet figured out how to get the code to work on regular graphs. The \" ValueError?: did not find the right edge\" error stems from the fundamental cycle step, and is linked to the my_depths, my_parent and my_parent_edge vectors. I attempt to fix this by updating these vectors while doing the initalization DFS, *compute_dfs_tree()*. But this leads to an infinite loop in some other DFS call, *update_parents_dfs()*.",
    "created_at": "2022-08-02T09:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480611",
    "user": "https://github.com/enjeck"
}
```

Also, I haven't yet figured out how to get the code to work on regular graphs. The " ValueError?: did not find the right edge" error stems from the fundamental cycle step, and is linked to the my_depths, my_parent and my_parent_edge vectors. I attempt to fix this by updating these vectors while doing the initalization DFS, *compute_dfs_tree()*. But this leads to an infinite loop in some other DFS call, *update_parents_dfs()*.



---

archive/issue_comments_480612.json:
```json
{
    "body": "You never set any edge in `T` to `True`...",
    "created_at": "2022-08-02T09:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480612",
    "user": "https://github.com/dcoudert"
}
```

You never set any edge in `T` to `True`...



---

archive/issue_comments_480613.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-02T12:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480613",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480614.json:
```json
{
    "body": "Somehow, the code is even slower:\n\n''\n500 vertices''\nCPU times: user 7.47 s, sys: 31.5 ms, total: 7.5 s\nWall time: 7.53 s\n499\n\n*1000 vertices*\nCPU times: user 1min 8s, sys: 71.9 ms, total: 1min 8s\nWall time: 1min 10s\n999\n\nI'll get to the bottom of this!",
    "created_at": "2022-08-02T12:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480614",
    "user": "https://github.com/enjeck"
}
```

Somehow, the code is even slower:

''
500 vertices''
CPU times: user 7.47 s, sys: 31.5 ms, total: 7.5 s
Wall time: 7.53 s
499

*1000 vertices*
CPU times: user 1min 8s, sys: 71.9 ms, total: 1min 8s
Wall time: 1min 10s
999

I'll get to the bottom of this!



---

archive/issue_comments_480615.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-08T13:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480616.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-21T20:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480616",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480617.json:
```json
{
    "body": "After extensive testing, I can confirm that the code now works all graphs. Its speed matches the initial version for some graphs, and it's a bit faster for others.",
    "created_at": "2022-08-21T21:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480617",
    "user": "https://github.com/enjeck"
}
```

After extensive testing, I can confirm that the code now works all graphs. Its speed matches the initial version for some graphs, and it's a bit faster for others.



---

archive/issue_comments_480618.json:
```json
{
    "body": "The speedup is noticeable when I tested on complete digraphs:\n\n**Without initialization**\n\n*1500 vertices:*\n\nCPU times: user 1min 37s, sys: 28.2 ms, total: 1min 37s Wall time: 1min 38s 1499\n\nCPU times: user 1min 37s, sys: 33.8 ms, total: 1min 37s Wall time: 1min 37s 1499\n\n*2000 vertices:*\n\nCPU times: user 4min 13s, sys: 86.5 ms, total: 4min 13s Wall time: 4min 14s 1999\n\nCPU times: user 4min 16s, sys: 87.1 ms, total: 4min 17s Wall time: 4min 17s 1999\n\n\n**Mine, with initialization**\n\n''\n1500 vertices:''\n\nCPU times: user 1min 12s, sys: 67.5 ms, total: 1min 13s Wall time: 1min 13s 1499\n\nCPU times: user 1min 21s, sys: 104 ms, total: 1min 21s Wall time: 1min 21s 1499\n\n''2000 vertices:\n''\n\nCPU times: user 2min 48s, sys: 95.7 ms, total: 2min 48s Wall time: 2min 48s 1999\n\nCPU times: user 2min 51s, sys: 176 ms, total: 2min 51s Wall time: 2min 52s 1999",
    "created_at": "2022-08-21T21:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480618",
    "user": "https://github.com/enjeck"
}
```

The speedup is noticeable when I tested on complete digraphs:

**Without initialization**

*1500 vertices:*

CPU times: user 1min 37s, sys: 28.2 ms, total: 1min 37s Wall time: 1min 38s 1499

CPU times: user 1min 37s, sys: 33.8 ms, total: 1min 37s Wall time: 1min 37s 1499

*2000 vertices:*

CPU times: user 4min 13s, sys: 86.5 ms, total: 4min 13s Wall time: 4min 14s 1999

CPU times: user 4min 16s, sys: 87.1 ms, total: 4min 17s Wall time: 4min 17s 1999


**Mine, with initialization**

''
1500 vertices:''

CPU times: user 1min 12s, sys: 67.5 ms, total: 1min 13s Wall time: 1min 13s 1499

CPU times: user 1min 21s, sys: 104 ms, total: 1min 21s Wall time: 1min 21s 1499

''2000 vertices:
''

CPU times: user 2min 48s, sys: 95.7 ms, total: 2min 48s Wall time: 2min 48s 1999

CPU times: user 2min 51s, sys: 176 ms, total: 2min 51s Wall time: 2min 52s 1999



---

archive/issue_comments_480619.json:
```json
{
    "body": "On a random semi-complete digraph with 1000 vertices, it's over 2 times faster\n\n**\nWithout initialization**\n\nCPU times: user 23.7 s, sys: 3.93 ms, total: 23.7 s Wall time: 23.7 s 619\n\nCPU times: user 23.8 s, sys: 0 ns, total: 23.8 s Wall time: 23.9 s 615\n\nCPU times: user 24.4 s, sys: 3.98 ms, total: 24.4 s Wall time: 24.5 s 603\n\n\n**Mine, with initialization:**\n\nCPU times: user 9.99 s, sys: 0 ns, total: 9.99 s Wall time: 10 s 616\n\nCPU times: user 9.26 s, sys: 7.97 ms, total: 9.27 s Wall time: 9.32 s 595\n\nCPU times: user 9.76 s, sys: 36 ms, total: 9.8 s Wall time: 9.83 s 609",
    "created_at": "2022-08-21T21:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480619",
    "user": "https://github.com/enjeck"
}
```

On a random semi-complete digraph with 1000 vertices, it's over 2 times faster

**
Without initialization**

CPU times: user 23.7 s, sys: 3.93 ms, total: 23.7 s Wall time: 23.7 s 619

CPU times: user 23.8 s, sys: 0 ns, total: 23.8 s Wall time: 23.9 s 615

CPU times: user 24.4 s, sys: 3.98 ms, total: 24.4 s Wall time: 24.5 s 603


**Mine, with initialization:**

CPU times: user 9.99 s, sys: 0 ns, total: 9.99 s Wall time: 10 s 616

CPU times: user 9.26 s, sys: 7.97 ms, total: 9.27 s Wall time: 9.32 s 595

CPU times: user 9.76 s, sys: 36 ms, total: 9.8 s Wall time: 9.83 s 609



---

archive/issue_comments_480620.json:
```json
{
    "body": "On other digraphs like the Peterson graph and regular graphs, it's not any faster",
    "created_at": "2022-08-21T21:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480620",
    "user": "https://github.com/enjeck"
}
```

On other digraphs like the Peterson graph and regular graphs, it's not any faster



---

archive/issue_comments_480621.json:
```json
{
    "body": "I'm not seeing the 9x speedups as mentioned in the paper. I'm obviously missing something. Not sure what it is yet :/",
    "created_at": "2022-08-21T21:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480621",
    "user": "https://github.com/enjeck"
}
```

I'm not seeing the 9x speedups as mentioned in the paper. I'm obviously missing something. Not sure what it is yet :/



---

archive/issue_comments_480622.json:
```json
{
    "body": "You should do the following:\n- add an optional parameter to decide if yes/no we use the DFS method. This will ease comparison\n- make a non recursive version of the DFS. It should be faster.",
    "created_at": "2022-08-22T06:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480622",
    "user": "https://github.com/dcoudert"
}
```

You should do the following:
- add an optional parameter to decide if yes/no we use the DFS method. This will ease comparison
- make a non recursive version of the DFS. It should be faster.



---

archive/issue_events_089147.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T16:33:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34123#event-89147"
}
```



---

archive/issue_comments_480623.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-03T20:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480623",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480624.json:
```json
{
    "body": "This iterative version works on most graphs, but fails on the Rome99 graph (https://github.com/sakiskef/PackingArborescencesAlgorithms/blob/main/rome99.new.txt-EC2). I get an infinite loop, same issue I had faced weeks ago. In the cases where it works, this non-recursive code is not any faster than the recursive one, so I don't know if it's worth spending time trying to fix the bug.",
    "created_at": "2022-09-03T20:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480624",
    "user": "https://github.com/enjeck"
}
```

This iterative version works on most graphs, but fails on the Rome99 graph (https://github.com/sakiskef/PackingArborescencesAlgorithms/blob/main/rome99.new.txt-EC2). I get an infinite loop, same issue I had faced weeks ago. In the cases where it works, this non-recursive code is not any faster than the recursive one, so I don't know if it's worth spending time trying to fix the bug.



---

archive/issue_comments_480625.json:
```json
{
    "body": "I changed the non-recursive version. One of the difficulty was to ensure that an edge is selected before starting to process it's head.\n\nI also did various edits in the code (coding style) and changed a few names.\n\nI added another parameter to choose between the recursive and non-recursive versions. We will have to remove it later.\n\nIn some cases (e.g., rome), the non-recursive version is faster, but on complete graphs it is slower. I don't know why. At least it is correct and robust.\n\n---\nNew commits:",
    "created_at": "2022-09-04T11:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480625",
    "user": "https://github.com/dcoudert"
}
```

I changed the non-recursive version. One of the difficulty was to ensure that an edge is selected before starting to process it's head.

I also did various edits in the code (coding style) and changed a few names.

I added another parameter to choose between the recursive and non-recursive versions. We will have to remove it later.

In some cases (e.g., rome), the non-recursive version is faster, but on complete graphs it is slower. I don't know why. At least it is correct and robust.

---
New commits:



---

archive/issue_comments_480626.json:
```json
{
    "body": "and I changed the branch name to get something in public ;)",
    "created_at": "2022-09-04T11:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480626",
    "user": "https://github.com/dcoudert"
}
```

and I changed the branch name to get something in public ;)



---

archive/issue_comments_480627.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-04T14:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480627",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480628.json:
```json
{
    "body": "Nice. Thanks! What next for this ticket?",
    "created_at": "2022-09-04T22:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480628",
    "user": "https://github.com/enjeck"
}
```

Nice. Thanks! What next for this ticket?



---

archive/issue_comments_480629.json:
```json
{
    "body": "- Further tests. I got the same results for all combinations of parameters so far.\n- Document the input parameter `dfs` with a link to reference `[GKLP2021]_`. May be we should choose a better name for the parameter like `dfs_preprocessing` or `use_preprocessing` ?\n- Decide if we keep both the recursive and the non recursive versions or if we keep only one (and which one).",
    "created_at": "2022-09-05T15:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480629",
    "user": "https://github.com/dcoudert"
}
```

- Further tests. I got the same results for all combinations of parameters so far.
- Document the input parameter `dfs` with a link to reference `[GKLP2021]_`. May be we should choose a better name for the parameter like `dfs_preprocessing` or `use_preprocessing` ?
- Decide if we keep both the recursive and the non recursive versions or if we keep only one (and which one).



---

archive/issue_comments_480630.json:
```json
{
    "body": "> Further tests. I got the same results for all combinations of parameters so far. \n\n\nFurther tests to ensure it works? Or for the speed?\n\n> Document the input parameter dfs with a link to reference [GKLP2021]_. May be we should choose a better name for the parameter like dfs_preprocessing or use_preprocessing ? \n\n\n`dfs_preprocessing` sounds good to me.",
    "created_at": "2022-09-06T05:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480630",
    "user": "https://github.com/enjeck"
}
```

> Further tests. I got the same results for all combinations of parameters so far. 


Further tests to ensure it works? Or for the speed?

> Document the input parameter dfs with a link to reference [GKLP2021]_. May be we should choose a better name for the parameter like dfs_preprocessing or use_preprocessing ? 


`dfs_preprocessing` sounds good to me.



---

archive/issue_comments_480631.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-12T05:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480631",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480632.json:
```json
{
    "body": "Well, 2000 is too much / long for a doctest. 10 should be enough.",
    "created_at": "2022-09-12T06:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480632",
    "user": "https://github.com/dcoudert"
}
```

Well, 2000 is too much / long for a doctest. 10 should be enough.



---

archive/issue_comments_480633.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-12T06:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480634.json:
```json
{
    "body": "There is a failing doctest. Can you check what's going on ?\n\n```\nsage -t --warn-long 24.4 --random-seed=248224767818260445092579663881809139950 src/sage/graphs/edge_connectivity.pyx\n**********************************************************************\nFile \"src/sage/graphs/edge_connectivity.pyx\", line 97, in sage.graphs.edge_connectivity.GabowEdgeConnectivity\nFailed example:\n    GabowEdgeConnectivity(D).edge_connectivity()\nExpected:\n    4\nGot:\n    5\n```\n\nAlso, please add a doctest on some random graph (e.g. `RandomBarabasiAlbert(100, 2)`) and the different possible combinations of parameters.",
    "created_at": "2022-09-14T16:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480634",
    "user": "https://github.com/dcoudert"
}
```

There is a failing doctest. Can you check what's going on ?

```
sage -t --warn-long 24.4 --random-seed=248224767818260445092579663881809139950 src/sage/graphs/edge_connectivity.pyx
**********************************************************************
File "src/sage/graphs/edge_connectivity.pyx", line 97, in sage.graphs.edge_connectivity.GabowEdgeConnectivity
Failed example:
    GabowEdgeConnectivity(D).edge_connectivity()
Expected:
    4
Got:
    5
```

Also, please add a doctest on some random graph (e.g. `RandomBarabasiAlbert(100, 2)`) and the different possible combinations of parameters.



---

archive/issue_comments_480635.json:
```json
{
    "body": "The failed doctests stems from the digraph with loops: `D = digraphs.Complete(5, loops=True)`. I checked, and for both the recursive and non-recursive code, a looped complete digraph with `n` vertices yields an edge connectivity of `n` instead of `n-1`. \n\nI wonder if this problem can be easily fixed by removing or ignoring loops during processing, or if the issue goes deeper than that.",
    "created_at": "2022-09-14T19:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480635",
    "user": "https://github.com/enjeck"
}
```

The failed doctests stems from the digraph with loops: `D = digraphs.Complete(5, loops=True)`. I checked, and for both the recursive and non-recursive code, a looped complete digraph with `n` vertices yields an edge connectivity of `n` instead of `n-1`. 

I wonder if this problem can be easily fixed by removing or ignoring loops during processing, or if the issue goes deeper than that.



---

archive/issue_comments_480636.json:
```json
{
    "body": "Indeed, the easiest way should be to remove loops during the initialization of data structures. Can you check how to do that smartly ?",
    "created_at": "2022-09-15T06:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480636",
    "user": "https://github.com/dcoudert"
}
```

Indeed, the easiest way should be to remove loops during the initialization of data structures. Can you check how to do that smartly ?



---

archive/issue_comments_480637.json:
```json
{
    "body": "`@`David, I tried out the approach we discussed for removing loops, but it didn't work. I think I'm starting to figure out why\n\nRemember that I said using [.remove_loops()](https://doc.sagemath.org/html/en/reference/graphs/sage/graphs/generic_graph.html#sage.graphs.generic_graph.GenericGraph.remove_loops) worked, but was too expensive? Not quite. I noticed that it mattered where exactly I called .remove_loops(). If I called it before setting `max_ec`, then the code worked correctly. Otherwise, it failed. For a complete looped digraph, `max_ec` is 5, while `max_ec` is 2 for its unlooped counterpart. \n\nSo, it seems that the accuracy of results depends on `max_ec`. Which shouldn't be the case! I'll investigate this further.",
    "created_at": "2022-09-21T06:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480637",
    "user": "https://github.com/enjeck"
}
```

`@`David, I tried out the approach we discussed for removing loops, but it didn't work. I think I'm starting to figure out why

Remember that I said using [.remove_loops()](https://doc.sagemath.org/html/en/reference/graphs/sage/graphs/generic_graph.html#sage.graphs.generic_graph.GenericGraph.remove_loops) worked, but was too expensive? Not quite. I noticed that it mattered where exactly I called .remove_loops(). If I called it before setting `max_ec`, then the code worked correctly. Otherwise, it failed. For a complete looped digraph, `max_ec` is 5, while `max_ec` is 2 for its unlooped counterpart. 

So, it seems that the accuracy of results depends on `max_ec`. Which shouldn't be the case! I'll investigate this further.



---

archive/issue_comments_480638.json:
```json
{
    "body": "move the initialization of `max_ec` after the call `self.build_graph_data_structure()`. Instead of using `G.out_degree_iterator()` you must get degrees from the size of out-neighborhoods in `g_out`  (responsabilit\u00e9s. in `g_in`).",
    "created_at": "2022-09-21T07:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480638",
    "user": "https://github.com/dcoudert"
}
```

move the initialization of `max_ec` after the call `self.build_graph_data_structure()`. Instead of using `G.out_degree_iterator()` you must get degrees from the size of out-neighborhoods in `g_out`  (responsabilités. in `g_in`).



---

archive/issue_comments_480639.json:
```json
{
    "body": "> Instead of using G.out_degree_iterator() you must get degrees from the size of out-neighborhoods in g_out (responsabilit\u00e9s. in g_in). \n\n\nSorry, I don't understand what I'm supposed to do here. I've tried moving `max_ec`, but that on its own doesn't work",
    "created_at": "2022-09-24T18:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480639",
    "user": "https://github.com/enjeck"
}
```

> Instead of using G.out_degree_iterator() you must get degrees from the size of out-neighborhoods in g_out (responsabilités. in g_in). 


Sorry, I don't understand what I'm supposed to do here. I've tried moving `max_ec`, but that on its own doesn't work



---

archive/issue_comments_480640.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-25T06:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480640",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480641.json:
```json
{
    "body": "Check last commit and test it.",
    "created_at": "2022-09-25T06:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480641",
    "user": "https://github.com/dcoudert"
}
```

Check last commit and test it.



---

archive/issue_comments_480642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-25T16:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480642",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480643.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-28T13:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480643",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_480644.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-01T08:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480644",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480645.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-01T08:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480645",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480646.json:
```json
{
    "body": "I did some minor review edits. Do you agree with these changes ?",
    "created_at": "2022-10-01T08:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480646",
    "user": "https://github.com/dcoudert"
}
```

I did some minor review edits. Do you agree with these changes ?



---

archive/issue_comments_480647.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2022-10-01T09:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480647",
    "user": "https://github.com/enjeck"
}
```

Looks good to me!



---

archive/issue_comments_480648.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-10-01T09:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480648",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_480649.json:
```json
{
    "body": "So then.",
    "created_at": "2022-10-01T09:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480649",
    "user": "https://github.com/dcoudert"
}
```

So then.



---

archive/issue_comments_480650.json:
```json
{
    "body": "See patchbot:\n\n```\n[sagemath_doc_html-none] OSError: docstring of sage.graphs.edge_connectivity.GabowEdgeConnectivity:19: WARNING: Literal block expected; none found.\n```",
    "created_at": "2022-10-11T23:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480650",
    "user": "https://github.com/vbraun"
}
```

See patchbot:

```
[sagemath_doc_html-none] OSError: docstring of sage.graphs.edge_connectivity.GabowEdgeConnectivity:19: WARNING: Literal block expected; none found.
```



---

archive/issue_comments_480651.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-10-11T23:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480651",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_480652.json:
```json
{
    "body": "Hmm. This is weird. I've checked, and can't seem to find where the error is stemming from. I even tried looking up other tickets where this error showed up (e.g #33971#comment:21) to see how they fixed it, but that doesn't help me here :/",
    "created_at": "2022-10-12T03:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480652",
    "user": "https://github.com/enjeck"
}
```

Hmm. This is weird. I've checked, and can't seem to find where the error is stemming from. I even tried looking up other tickets where this error showed up (e.g #33971#comment:21) to see how they fixed it, but that doesn't help me here :/



---

archive/issue_comments_480653.json:
```json
{
    "body": "can you revert this change\n\n```diff\n-    EXAMPLES:\n+    EXAMPLES::\n```",
    "created_at": "2022-10-12T08:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480653",
    "user": "https://github.com/dcoudert"
}
```

can you revert this change

```diff
-    EXAMPLES:
+    EXAMPLES::
```



---

archive/issue_comments_480654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-12T18:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480655.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-10-12T18:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480655",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_480656.json:
```json
{
    "body": "This should fix the issue. Let's wait to know if the patchbot is happy or not.",
    "created_at": "2022-10-12T18:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480656",
    "user": "https://github.com/dcoudert"
}
```

This should fix the issue. Let's wait to know if the patchbot is happy or not.



---

archive/issue_comments_480657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-10-15T06:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_480658.json:
```json
{
    "body": "The docbuild issue is now fixed but the patchbot has reported an error on the doctests using `graphs.RandomBarabasiAlbert(100, 2)`. This is due to the fact that this graph is built starting from a tree, and so there is non zero probability to get a vertex of degree 1 when the graph is small. This is now fixed.",
    "created_at": "2022-10-15T06:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480658",
    "user": "https://github.com/dcoudert"
}
```

The docbuild issue is now fixed but the patchbot has reported an error on the doctests using `graphs.RandomBarabasiAlbert(100, 2)`. This is due to the fact that this graph is built starting from a tree, and so there is non zero probability to get a vertex of degree 1 when the graph is small. This is now fixed.



---

archive/issue_comments_480659.json:
```json
{
    "body": "The patchbot is now happy.",
    "created_at": "2022-10-15T15:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480659",
    "user": "https://github.com/dcoudert"
}
```

The patchbot is now happy.



---

archive/issue_comments_480660.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-10-15T15:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480660",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_089148.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-17T22:43:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34123#event-89148"
}
```



---

archive/issue_comments_480661.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-10-17T22:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34123#issuecomment-480661",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
