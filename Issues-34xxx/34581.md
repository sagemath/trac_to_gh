# Issue 34581: Implement substitution in InfinitePolynomialRing

archive/issues_034344.json:
```json
{
    "assignees": [],
    "body": "Add the ability to substitute variables in `InfinitePolynomialRing`.\n\n```\nsage: R.<z> = InfinitePolynomialRing(QQ)\nsage: f = z[1] + z[1]*z[2]*z[3]\nsage: f.subs({z[1]:z[0]})\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nInput In [3], in <cell line: 1>()\n----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})\n\nFile ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()\n    828 if str(gen) in kwds:\n    829     variables.append(kwds[str(gen)])\n--> 830 elif in_dict and gen in in_dict:\n    831     variables.append(in_dict[gen])\n    832 else:\n\nTypeError: unhashable type: 'InfinitePolynomialGen'\n```\n\nCC:  @tscrim @mwhansen @simon-king-jena\n\nKeywords: **polynomial infinite substitution subs**\n\nBranch/Commit: **[u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581) @ [`a56e345`](https://github.com/sagemath/sagetrac-mirror/commit/a56e345cd9c3203b432f2f29c743f0f4606dc088)**\n\nReviewer: **Tomer Bauer, Travis Scrimshaw**\n\nAuthor: **Trevor K. Karn**\n\nComponent: **algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34581_\n\n",
    "created_at": "2022-09-24T15:32:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/positive%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement substitution in InfinitePolynomialRing",
    "type": "issue",
    "updated_at": "2023-01-09T04:22:51Z",
    "url": "https://github.com/sagemath/sage/issues/34581",
    "user": "https://github.com/trevorkarn"
}
```
Add the ability to substitute variables in `InfinitePolynomialRing`.

```
sage: R.<z> = InfinitePolynomialRing(QQ)
sage: f = z[1] + z[1]*z[2]*z[3]
sage: f.subs({z[1]:z[0]})
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Input In [3], in <cell line: 1>()
----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})

File ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()
    828 if str(gen) in kwds:
    829     variables.append(kwds[str(gen)])
--> 830 elif in_dict and gen in in_dict:
    831     variables.append(in_dict[gen])
    832 else:

TypeError: unhashable type: 'InfinitePolynomialGen'
```

CC:  @tscrim @mwhansen @simon-king-jena

Keywords: **polynomial infinite substitution subs**

Branch/Commit: **[u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581) @ [`a56e345`](https://github.com/sagemath/sagetrac-mirror/commit/a56e345cd9c3203b432f2f29c743f0f4606dc088)**

Reviewer: **Tomer Bauer, Travis Scrimshaw**

Author: **Trevor K. Karn**

Component: **algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/34581_





---

archive/issue_events_471856.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-09-24T15:32:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471856"
}
```



---

archive/issue_events_471857.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-09-24T15:32:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471857"
}
```



---

archive/issue_events_471858.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-09-24T15:32:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471858"
}
```



---

archive/issue_events_471859.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-09-24T15:32:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471859"
}
```



---

archive/issue_comments_558685.json:
```json
{
    "body": "Branch: **[u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581)**",
    "created_at": "2022-09-24T17:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558685",
    "user": "https://github.com/trevorkarn"
}
```

Branch: **[u/tkarn/inf-poly-subs-34581](https://github.com/sagemath/sagetrac-mirror/tree/u/tkarn/inf-poly-subs-34581)**



---

archive/issue_comments_558686.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8\">2ec0f39</a></td><td><code>Add subs method</code></td></tr></table>\n",
    "created_at": "2022-09-24T17:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558686",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8">2ec0f39</a></td><td><code>Add subs method</code></td></tr></table>




---

archive/issue_comments_558687.json:
```json
{
    "body": "Commit: **[`2ec0f39`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)**",
    "created_at": "2022-09-24T17:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558687",
    "user": "https://github.com/trevorkarn"
}
```

Commit: **[`2ec0f39`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)**



---

archive/issue_events_471860.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-09-24T17:06:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471860"
}
```



---

archive/issue_events_471861.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-09-25T00:34:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471861"
}
```



---

archive/issue_events_471862.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-09-25T00:34:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471862"
}
```



---

archive/issue_comments_558688.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThere are some bad behaviors that this implements:\n\n- It forces the inputs to be in the polynomial ring. I should be able to substitute anything I want where the computation makes such, such as square matrices. This should be a simple redirection.\n- It forces the output to be in the infinite polynomial ring. Instead, the output should be the common parent of the input and the base ring.\n\nThe \"standard\" thing to do is redirect everything through `__call__` after parsing the inputs a bit, and probably should be done here too. Although I am a bit tempted to just instead do a simple redirect to `self._p.subs(*args, **kwds)`. Actually, there probably is a general problem of not expanding the input polynomial to be large enough to handle the input.\n\n```\nsage: f(x_10=f)\nKeyError\nsage: f(x_2=f)\nx_3^2*x_2*x_1^2 + x_3*x_1^2 + x_1\nsage: x[12]  # make it big enough\nx_12\nsage: f(x_10=f)\nx_3*x_2*x_1 + x_1\n```\nProbably the input parsing of `subs` and `__call__` should be refactored out into a helper method, and then both of these methods redirect to their finite polynomial counterparts.",
    "created_at": "2022-09-25T00:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558688",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

There are some bad behaviors that this implements:

- It forces the inputs to be in the polynomial ring. I should be able to substitute anything I want where the computation makes such, such as square matrices. This should be a simple redirection.
- It forces the output to be in the infinite polynomial ring. Instead, the output should be the common parent of the input and the base ring.

The "standard" thing to do is redirect everything through `__call__` after parsing the inputs a bit, and probably should be done here too. Although I am a bit tempted to just instead do a simple redirect to `self._p.subs(*args, **kwds)`. Actually, there probably is a general problem of not expanding the input polynomial to be large enough to handle the input.

```
sage: f(x_10=f)
KeyError
sage: f(x_2=f)
x_3^2*x_2*x_1^2 + x_3*x_1^2 + x_1
sage: x[12]  # make it big enough
x_12
sage: f(x_10=f)
x_3*x_2*x_1 + x_1
```
Probably the input parsing of `subs` and `__call__` should be refactored out into a helper method, and then both of these methods redirect to their finite polynomial counterparts.



---

archive/issue_comments_558689.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nbeware of #34542",
    "created_at": "2022-09-25T07:00:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558689",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

beware of #34542



---

archive/issue_comments_558690.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis might answer [this question](https://ask.sagemath.org/question/42325/polynomial-rings-with-an-arbitrary-infinite-set-of-variables/) from 4 years ago. Thanks!",
    "created_at": "2022-10-02T16:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558690",
    "user": "https://github.com/mathzeta"
}
```

<div id="comment:4" align="right">comment:4</div>

This might answer [this question](https://ask.sagemath.org/question/42325/polynomial-rings-with-an-arbitrary-infinite-set-of-variables/) from 4 years ago. Thanks!



---

archive/issue_comments_558691.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74911139ceef9b690bd0c1369acc523a5802248f\">7491113</a></td><td><code>Add subs method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162\">623021f</a></td><td><code>Punt to call and add doctests</code></td></tr></table>\n",
    "created_at": "2022-12-30T01:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558691",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74911139ceef9b690bd0c1369acc523a5802248f">7491113</a></td><td><code>Add subs method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162">623021f</a></td><td><code>Punt to call and add doctests</code></td></tr></table>




---

archive/issue_comments_558692.json:
```json
{
    "body": "Changed commit from **[`2ec0f39`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)** to **[`623021f`](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)**",
    "created_at": "2022-12-30T01:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558692",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2ec0f39`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0f39878c82bdb1802f98bff7ec0ffdd7c37a8)** to **[`623021f`](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)**



---

archive/issue_comments_558693.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIt looks like `__call__` took care of everything, so the `.subs()` method now does all of the preparsing and passes to `__call__`. I don't like the variable name `fixed`, but it is consistent with `MPolynomial_libsingular.subs()`.",
    "created_at": "2022-12-30T01:22:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558693",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:6" align="right">comment:6</div>

It looks like `__call__` took care of everything, so the `.subs()` method now does all of the preparsing and passes to `__call__`. I don't like the variable name `fixed`, but it is consistent with `MPolynomial_libsingular.subs()`.



---

archive/issue_comments_558694.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a\">0082d03</a></td><td><code>PEP8 compliance</code></td></tr></table>\n",
    "created_at": "2022-12-30T01:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558694",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a">0082d03</a></td><td><code>PEP8 compliance</code></td></tr></table>




---

archive/issue_comments_558695.json:
```json
{
    "body": "Changed commit from **[`623021f`](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)** to **[`0082d03`](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)**",
    "created_at": "2022-12-30T01:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558695",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`623021f`](https://github.com/sagemath/sagetrac-mirror/commit/623021f3c1fedd3040046b704ab9edccec3b0162)** to **[`0082d03`](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)**



---

archive/issue_events_471863.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-12-30T01:25:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471863"
}
```



---

archive/issue_events_471864.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2022-12-30T01:25:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471864"
}
```



---

archive/issue_comments_558696.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nGreen bot :)",
    "created_at": "2023-01-03T20:08:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558696",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:9" align="right">comment:9</div>

Green bot :)



---

archive/issue_events_471865.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2023-01-04T13:45:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471865"
}
```



---

archive/issue_events_471866.json:
```json
{
    "actor": "https://github.com/mathzeta",
    "created_at": "2023-01-04T13:45:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471866"
}
```



---

archive/issue_comments_558697.json:
```json
{
    "body": "Reviewer: **Tomer Bauer**",
    "created_at": "2023-01-04T13:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558697",
    "user": "https://github.com/mathzeta"
}
```

Reviewer: **Tomer Bauer**



---

archive/issue_comments_558698.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nLGTM. positive review.\n\nAlmost unrelated to this ticket, already in the `__call__` method we can substitute all variables from a \"finite\" polynomial ring:\n\n```sage\nsage: R.<x> = InfinitePolynomialRing(QQ)\nsage: S.<z, w> = QQ[]\nsage: f = x[1] + x[1]*x[2]*x[3]\nsage: f(x_1=w, x_2=z^2+1, x_3=z)\nz^3*w + z*w + w\n```\n\nBut it is a pity we do not have a canonical coercion when substituting only some of the variables:\n\n```sage\nsage: f(x_1=w)\n[...]\nTypeError: no canonical coercion from Multivariate Polynomial Ring in z, w over Rational Field to Multivariate Polynomial Ring in x_5, x_4, x_3, x_2, x_1, x_0 over Rational Field\n\nDuring handling of the above exception, another exception occurred:\n[...]\nTypeError: unsupported operand parent(s) for *: 'Multivariate Polynomial Ring in x_5, x_4, x_3, x_2, x_1, x_0 over Rational Field' and 'Multivariate Polynomial Ring in z, w over Rational Field'\n```",
    "created_at": "2023-01-04T13:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558698",
    "user": "https://github.com/mathzeta"
}
```

<div id="comment:10" align="right">comment:10</div>

LGTM. positive review.

Almost unrelated to this ticket, already in the `__call__` method we can substitute all variables from a "finite" polynomial ring:

```sage
sage: R.<x> = InfinitePolynomialRing(QQ)
sage: S.<z, w> = QQ[]
sage: f = x[1] + x[1]*x[2]*x[3]
sage: f(x_1=w, x_2=z^2+1, x_3=z)
z^3*w + z*w + w
```

But it is a pity we do not have a canonical coercion when substituting only some of the variables:

```sage
sage: f(x_1=w)
[...]
TypeError: no canonical coercion from Multivariate Polynomial Ring in z, w over Rational Field to Multivariate Polynomial Ring in x_5, x_4, x_3, x_2, x_1, x_0 over Rational Field

During handling of the above exception, another exception occurred:
[...]
TypeError: unsupported operand parent(s) for *: 'Multivariate Polynomial Ring in x_5, x_4, x_3, x_2, x_1, x_0 over Rational Field' and 'Multivariate Polynomial Ring in z, w over Rational Field'
```



---

archive/issue_comments_558699.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks! Where should the canonical coercion live? I recall seeing something that there is no coercion between polynomials from say `QQ[x]` and `QQ[y]` because it could live in any of `QQ[x,y]`, `QQ[x][y]`, `QQ[y][x]`. This seems like a similar problem to me. Should the substitution of some of the variables be in `QQ[x_0, x_1,...][w]` or `QQ[w][x_0, x_1,...]` (since I don't think `QQ[w,x_0,x_1,...]` exists in Sage yet).",
    "created_at": "2023-01-04T16:02:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558699",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks! Where should the canonical coercion live? I recall seeing something that there is no coercion between polynomials from say `QQ[x]` and `QQ[y]` because it could live in any of `QQ[x,y]`, `QQ[x][y]`, `QQ[y][x]`. This seems like a similar problem to me. Should the substitution of some of the variables be in `QQ[x_0, x_1,...][w]` or `QQ[w][x_0, x_1,...]` (since I don't think `QQ[w,x_0,x_1,...]` exists in Sage yet).



---

archive/issue_events_471867.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2023-01-05T00:47:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471867"
}
```



---

archive/issue_events_471868.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2023-01-05T00:47:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471868"
}
```



---

archive/issue_comments_558700.json:
```json
{
    "body": "Changed reviewer from **Tomer Bauer** to **Tomer Bauer, Travis Scrimshaw**",
    "created_at": "2023-01-05T00:47:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558700",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Tomer Bauer** to **Tomer Bauer, Travis Scrimshaw**



---

archive/issue_comments_558701.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSorry for not being able to review this sooner.\n\nA few things need to be addressed before a positive review from me.\n\nSome doc changes:\n\n```diff\n-        Substitute variables in an infinite polynomial.\n+        Substitute variables in ``self``.\n \n         INPUT:\n \n-        - ``fixed`` - (optional) dict with variable:value pairs\n-        - ``**kwargs`` - names parameters\n-        - ``fixed`` -- (optional) ``dict`` with ``{variable:value}`` pairs\n-        - ``**kwargs`` -- named parameters\n \n         OUTPUT:\n-            a new polynomial\n+\n+        the resulting substitution\n```\n\n```diff\n-If you want to substitute variables more generally, use the ``.subs``\n-method::\n+If you want to substitute variables, you can use the\n+standard polynomial methods, such as\n+:meth:`~sage.rings.polynomial.infinite_polynomial_element.InfinitePolynomial_sparse.subs`::\n```\n\nThis documentation is not quite correct and make this change:\n\n```diff\n-       The substitution can also handle matrices. It will\n-       return a matrix whose entries are polynomials in countably\n-       many variables::\n+       The substitution can also handle matrices::\n```\nIt is more complicated than that as it does the substitution and then does the addition by coercion. You can check things by looking at the parent of the outputs (or doing additional substitutions).\n\nThis sentence seems incomplete:\n\n```\n        Passing ``fixed={x[1]: x[0]}``. Note that the keys::\n\n            sage: f.subs({x[1]: x[0]})\n            x_3*x_2*x_0 + x_0\n```\n\nI am not sure I would want to prohibit the mixing of the two types of inputs. I would just do `kwargs.update(fixed)`, which would be in line with what (some) other implementations do:\n\n```\nsage: R.<x,y> = PolynomialRing(QQ)\nsage: x.subs({x:1})\n1\nsage: x.subs(x=5)\n5\nsage: x.subs({x:1}, x=5)\n1\n```",
    "created_at": "2023-01-05T00:47:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558701",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

Sorry for not being able to review this sooner.

A few things need to be addressed before a positive review from me.

Some doc changes:

```diff
-        Substitute variables in an infinite polynomial.
+        Substitute variables in ``self``.
 
         INPUT:
 
-        - ``fixed`` - (optional) dict with variable:value pairs
-        - ``**kwargs`` - names parameters
-        - ``fixed`` -- (optional) ``dict`` with ``{variable:value}`` pairs
-        - ``**kwargs`` -- named parameters
 
         OUTPUT:
-            a new polynomial
+
+        the resulting substitution
```

```diff
-If you want to substitute variables more generally, use the ``.subs``
-method::
+If you want to substitute variables, you can use the
+standard polynomial methods, such as
+:meth:`~sage.rings.polynomial.infinite_polynomial_element.InfinitePolynomial_sparse.subs`::
```

This documentation is not quite correct and make this change:

```diff
-       The substitution can also handle matrices. It will
-       return a matrix whose entries are polynomials in countably
-       many variables::
+       The substitution can also handle matrices::
```
It is more complicated than that as it does the substitution and then does the addition by coercion. You can check things by looking at the parent of the outputs (or doing additional substitutions).

This sentence seems incomplete:

```
        Passing ``fixed={x[1]: x[0]}``. Note that the keys::

            sage: f.subs({x[1]: x[0]})
            x_3*x_2*x_0 + x_0
```

I am not sure I would want to prohibit the mixing of the two types of inputs. I would just do `kwargs.update(fixed)`, which would be in line with what (some) other implementations do:

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: x.subs({x:1})
1
sage: x.subs(x=5)
5
sage: x.subs({x:1}, x=5)
1
```



---

archive/issue_comments_558702.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nCoercion among polynomial rings is notoriously tricky to make consistent (there are some sage-devel threads about this). For example, how do you deal with `QQ[x][y,z]` versus `QQ[x,y][z]`, or a more complicated one, the ordering of the variables matters for Gr\u00f6bner basis computations. So Sage just avoids doing it except in some trivial cases IIRC.",
    "created_at": "2023-01-05T00:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558702",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Coercion among polynomial rings is notoriously tricky to make consistent (there are some sage-devel threads about this). For example, how do you deal with `QQ[x][y,z]` versus `QQ[x,y][z]`, or a more complicated one, the ordering of the variables matters for Gr√∂bner basis computations. So Sage just avoids doing it except in some trivial cases IIRC.



---

archive/issue_comments_558703.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e8977fe18f6b38e9eb4aeca066438b8d7e0514d\">5e8977f</a></td><td><code>Add reviewer suggestions to docs and change behavior of conflicting subs</code></td></tr></table>\n",
    "created_at": "2023-01-05T18:01:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558703",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e8977fe18f6b38e9eb4aeca066438b8d7e0514d">5e8977f</a></td><td><code>Add reviewer suggestions to docs and change behavior of conflicting subs</code></td></tr></table>




---

archive/issue_comments_558704.json:
```json
{
    "body": "Changed commit from **[`0082d03`](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)** to **[`5e8977f`](https://github.com/sagemath/sagetrac-mirror/commit/5e8977fe18f6b38e9eb4aeca066438b8d7e0514d)**",
    "created_at": "2023-01-05T18:01:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558704",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0082d03`](https://github.com/sagemath/sagetrac-mirror/commit/0082d0327f68c2f0c6987d85d106b6f75a16982a)** to **[`5e8977f`](https://github.com/sagemath/sagetrac-mirror/commit/5e8977fe18f6b38e9eb4aeca066438b8d7e0514d)**



---

archive/issue_comments_558705.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks for the input!",
    "created_at": "2023-01-05T18:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558705",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks for the input!



---

archive/issue_events_471869.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2023-01-05T18:02:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471869"
}
```



---

archive/issue_events_471870.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2023-01-05T18:02:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471870"
}
```



---

archive/issue_comments_558706.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThank you. One last little thing (an idiosyncrasy most likely), I generally try to avoid referencing Python double-underscore methods. So I would change\n\n```diff\n         Passing ``fixed={x[1]: x[0]}``. Note that the keys may be given\n-        using the ``.__getitem__`` method of the infinite polynomial\n-        generator ``x_*`` or as a string::\n+        using the generators of the infinite polynomial ring\n+        or as a string::\n```\nAfter you make this change (or a similar one), you can set a positive review on my behalf if you want.",
    "created_at": "2023-01-06T23:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558706",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Thank you. One last little thing (an idiosyncrasy most likely), I generally try to avoid referencing Python double-underscore methods. So I would change

```diff
         Passing ``fixed={x[1]: x[0]}``. Note that the keys may be given
-        using the ``.__getitem__`` method of the infinite polynomial
-        generator ``x_*`` or as a string::
+        using the generators of the infinite polynomial ring
+        or as a string::
```
After you make this change (or a similar one), you can set a positive review on my behalf if you want.



---

archive/issue_comments_558707.json:
```json
{
    "body": "Changed commit from **[`5e8977f`](https://github.com/sagemath/sagetrac-mirror/commit/5e8977fe18f6b38e9eb4aeca066438b8d7e0514d)** to **[`a56e345`](https://github.com/sagemath/sagetrac-mirror/commit/a56e345cd9c3203b432f2f29c743f0f4606dc088)**",
    "created_at": "2023-01-09T04:22:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558707",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5e8977f`](https://github.com/sagemath/sagetrac-mirror/commit/5e8977fe18f6b38e9eb4aeca066438b8d7e0514d)** to **[`a56e345`](https://github.com/sagemath/sagetrac-mirror/commit/a56e345cd9c3203b432f2f29c743f0f4606dc088)**



---

archive/issue_comments_558708.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a56e345cd9c3203b432f2f29c743f0f4606dc088\">a56e345</a></td><td><code>Doc change</code></td></tr></table>\n",
    "created_at": "2023-01-09T04:22:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558708",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a56e345cd9c3203b432f2f29c743f0f4606dc088">a56e345</a></td><td><code>Doc change</code></td></tr></table>




---

archive/issue_comments_558709.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [Travis Scrimshaw](#comment:16):\n> Thank you. One last little thing (an idiosyncrasy most likely), I generally try to avoid referencing Python double-underscore methods. So I would change\n> \n> ```diff\n>          Passing ``fixed={x[1]: x[0]}``. Note that the keys may be given\n> -        using the ``.__getitem__`` method of the infinite polynomial\n> -        generator ``x_*`` or as a string::\n> +        using the generators of the infinite polynomial ring\n> +        or as a string::\n> ```\n\nThanks!\n> After you make this change (or a similar one), you can set a positive review on my behalf if you want.",
    "created_at": "2023-01-09T04:22:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34581#issuecomment-558709",
    "user": "https://github.com/trevorkarn"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [Travis Scrimshaw](#comment:16):
> Thank you. One last little thing (an idiosyncrasy most likely), I generally try to avoid referencing Python double-underscore methods. So I would change
> 
> ```diff
>          Passing ``fixed={x[1]: x[0]}``. Note that the keys may be given
> -        using the ``.__getitem__`` method of the infinite polynomial
> -        generator ``x_*`` or as a string::
> +        using the generators of the infinite polynomial ring
> +        or as a string::
> ```

Thanks!
> After you make this change (or a similar one), you can set a positive review on my behalf if you want.



---

archive/issue_events_471871.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2023-01-09T04:22:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471871"
}
```



---

archive/issue_events_471872.json:
```json
{
    "actor": "https://github.com/trevorkarn",
    "created_at": "2023-01-09T04:22:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34581",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34581#event-471872"
}
```
