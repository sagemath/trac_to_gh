# Issue 34103: Categories for Family

archive/issues_034103.json:
```json
{
    "body": "CC:  @tscrim\n\nCurrently a `LazyFamily` is automatically in `EnumeratedSets`, so at most countable.\n\nWe add keyword `category` to the constructor `Family` and all implementation classes, so that the user can choose the correct category.\n\nMoreover, we define a (non-full) subcategory of `Sets` named `Families`, which captures the additional structure (= the map from the keys onto the parent).\n\nFollow-ups / related:\n- If the `function` from indices to objects is a morphism, then the category can be taken from the codomain.\n- #18849 category of lazy family wrong if infinite combinatorial class used as index\n- #8822 Bug in Family constructor\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34340\n\n",
    "created_at": "2022-08-11T04:16:31Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Categories for Family",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34103",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tscrim

Currently a `LazyFamily` is automatically in `EnumeratedSets`, so at most countable.

We add keyword `category` to the constructor `Family` and all implementation classes, so that the user can choose the correct category.

Moreover, we define a (non-full) subcategory of `Sets` named `Families`, which captures the additional structure (= the map from the keys onto the parent).

Follow-ups / related:
- If the `function` from indices to objects is a morphism, then the category can be taken from the codomain.
- #18849 category of lazy family wrong if infinite combinatorial class used as index
- #8822 Bug in Family constructor


Issue created by migration from https://trac.sagemath.org/ticket/34340





---

archive/issue_comments_483136.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-08-14T22:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483136",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_483137.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-14T23:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483138.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T03:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T03:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483140.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T03:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483141.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T03:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483142.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-15T03:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483142",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483143.json:
```json
{
    "body": "The main part of your changes LGTM, it is good to have this extra flexibility. I just have some issues with the docstring you changed.\n\nFor the first paragraph, I am not a fan of giving implementation details to the more casual user in the docstring. If they care about such details, then they almost certainly are already looking at the code. I know it was there previously, but now it has been given more prominence. So I think the first paragraph about the function being a factory should go last (although I really would like to remove it altogether).\n\nThe second paragraph is good (I am not counting the one-line description as a paragraph).\n\nI don't really understand the third paragraph, even what you are trying to  say. My thought is that it will be far too technical and likely should be removed. Although it would be worthwhile to state that iterating through the object returns the values rather than the keys.\n\nI don't understand the second part of the fourth paragraph. I think I know what you are trying to say, but that is not anything that belongs in this documentation. It seems like a code comment for within the category. I don't think the first sentence is even necessary (this is true for nearly every object in Sage).\n\nI would change `.. NOTE::` -> `.. WARNING::`.",
    "created_at": "2022-08-15T04:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483143",
    "user": "https://github.com/tscrim"
}
```

The main part of your changes LGTM, it is good to have this extra flexibility. I just have some issues with the docstring you changed.

For the first paragraph, I am not a fan of giving implementation details to the more casual user in the docstring. If they care about such details, then they almost certainly are already looking at the code. I know it was there previously, but now it has been given more prominence. So I think the first paragraph about the function being a factory should go last (although I really would like to remove it altogether).

The second paragraph is good (I am not counting the one-line description as a paragraph).

I don't really understand the third paragraph, even what you are trying to  say. My thought is that it will be far too technical and likely should be removed. Although it would be worthwhile to state that iterating through the object returns the values rather than the keys.

I don't understand the second part of the fourth paragraph. I think I know what you are trying to say, but that is not anything that belongs in this documentation. It seems like a code comment for within the category. I don't think the first sentence is even necessary (this is true for nearly every object in Sage).

I would change `.. NOTE::` -> `.. WARNING::`.



---

archive/issue_comments_483144.json:
```json
{
    "body": "It boils down to this: When the function is not injective, there is a subtle conflict between methods such as `__len__` according to the `collections.abc` and `cardinality` from `Sets.ParentMethods`. Arguably, `__len__` should return the number of keys, whereas `cardinality` definitely must return the cardinality of the set (values)",
    "created_at": "2022-08-15T05:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483144",
    "user": "https://github.com/mkoeppe"
}
```

It boils down to this: When the function is not injective, there is a subtle conflict between methods such as `__len__` according to the `collections.abc` and `cardinality` from `Sets.ParentMethods`. Arguably, `__len__` should return the number of keys, whereas `cardinality` definitely must return the cardinality of the set (values)



---

archive/issue_comments_483145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T05:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483146.json:
```json
{
    "body": "Unfortunately I don't see how that is in the documentation (beyond the `.. WARNING::`; also ``__iter__`` -> ```__iter__``` in there). Nor does that seem to be true that is is `values()`:\n\n```\nsage: F = Family([1,1,1])\nsage: F\nFamily (1, 1, 1)\nsage: F.cardinality()\n3\n```\nThe `__len__` also redirects from `cardinality()` by default (from the category). Or perhaps that is your point, that it is different than what you would expect as a set (of values). Since this is a mapping, it is a set of pairs `(k, v)`, so the cardinality for me is consistent.",
    "created_at": "2022-08-15T05:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483146",
    "user": "https://github.com/tscrim"
}
```

Unfortunately I don't see how that is in the documentation (beyond the `.. WARNING::`; also ``__iter__`` -> ```__iter__``` in there). Nor does that seem to be true that is is `values()`:

```
sage: F = Family([1,1,1])
sage: F
Family (1, 1, 1)
sage: F.cardinality()
3
```
The `__len__` also redirects from `cardinality()` by default (from the category). Or perhaps that is your point, that it is different than what you would expect as a set (of values). Since this is a mapping, it is a set of pairs `(k, v)`, so the cardinality for me is consistent.



---

archive/issue_comments_483147.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> The `__len__` also redirects from `cardinality()` by default (from the category). Or perhaps that is your point, that it is different than what you would expect as a set (of values). Since this is a mapping, it is a set of pairs `(k, v)`, so the cardinality for me is consistent.\n\n\nBut the elements according to other methods of the `Sets` protocol are not `(k, v)`; they are `v`.",
    "created_at": "2022-08-15T05:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483147",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 tscrim]:
> The `__len__` also redirects from `cardinality()` by default (from the category). Or perhaps that is your point, that it is different than what you would expect as a set (of values). Since this is a mapping, it is a set of pairs `(k, v)`, so the cardinality for me is consistent.


But the elements according to other methods of the `Sets` protocol are not `(k, v)`; they are `v`.



---

archive/issue_comments_483148.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T05:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483148",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483149.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> Unfortunately I don't see how that is in the documentation \n\n\nYes, `__len__` is not explained there yet because it's still unclear.",
    "created_at": "2022-08-15T05:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483149",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 tscrim]:
> Unfortunately I don't see how that is in the documentation 


Yes, `__len__` is not explained there yet because it's still unclear.



---

archive/issue_comments_483150.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> Nor does that seem to be true that is is `values()`:\n> \n> ```\n> sage: F = Family([1,1,1])\n> sage: F\n> Family (1, 1, 1)\n> sage: F.cardinality()\n> 3\n> ```\n\n\nYes, that's wrong, and that's why I added the warning.",
    "created_at": "2022-08-15T05:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483150",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 tscrim]:
> Nor does that seem to be true that is is `values()`:
> 
> ```
> sage: F = Family([1,1,1])
> sage: F
> Family (1, 1, 1)
> sage: F.cardinality()
> 3
> ```


Yes, that's wrong, and that's why I added the warning.



---

archive/issue_comments_483151.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> Replying to [comment:17 tscrim]:\n> > The `__len__` also redirects from `cardinality()` by default (from the category). Or perhaps that is your point, that it is different than what you would expect as a set (of values). Since this is a mapping, it is a set of pairs `(k, v)`, so the cardinality for me is consistent.\n\n> \n> But the elements according to other methods of the `Sets` protocol are not `(k, v)`; they are `v`.\n\n\nOkay, I think I understand better what you want to say. I think you can say the same thing as\n\n```\nNote that for most set operations, this is considered as the set\nof values; for instance, containment. There are some it is considered\nas a map, such as its cardinality.\n```",
    "created_at": "2022-08-15T05:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483151",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:18 mkoeppe]:
> Replying to [comment:17 tscrim]:
> > The `__len__` also redirects from `cardinality()` by default (from the category). Or perhaps that is your point, that it is different than what you would expect as a set (of values). Since this is a mapping, it is a set of pairs `(k, v)`, so the cardinality for me is consistent.

> 
> But the elements according to other methods of the `Sets` protocol are not `(k, v)`; they are `v`.


Okay, I think I understand better what you want to say. I think you can say the same thing as

```
Note that for most set operations, this is considered as the set
of values; for instance, containment. There are some it is considered
as a map, such as its cardinality.
```



---

archive/issue_comments_483152.json:
```json
{
    "body": "Strong -1 on giving `cardinality` semantics that differs from what the category guarantees",
    "created_at": "2022-08-15T05:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483152",
    "user": "https://github.com/mkoeppe"
}
```

Strong -1 on giving `cardinality` semantics that differs from what the category guarantees



---

archive/issue_comments_483153.json:
```json
{
    "body": "Replying to [comment:21 mkoeppe]:\n> Replying to [comment:17 tscrim]:\n> > Nor does that seem to be true that is is `values()`:\n> > \n> > ```\n> > sage: F = Family([1,1,1])\n> > sage: F\n> > Family (1, 1, 1)\n> > sage: F.cardinality()\n> > 3\n> > ```\n\n> \n> Yes, that's wrong, and that's why I added the warning.\n\n\nMy point is that it is not wrong, but the implementation, mainly iteration, is just over the values. That is an implementation detail that is separate from its mathematical definition (nor do I think we should ascribe mathematical definitions to all implementations).",
    "created_at": "2022-08-15T05:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483153",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:21 mkoeppe]:
> Replying to [comment:17 tscrim]:
> > Nor does that seem to be true that is is `values()`:
> > 
> > ```
> > sage: F = Family([1,1,1])
> > sage: F
> > Family (1, 1, 1)
> > sage: F.cardinality()
> > 3
> > ```

> 
> Yes, that's wrong, and that's why I added the warning.


My point is that it is not wrong, but the implementation, mainly iteration, is just over the values. That is an implementation detail that is separate from its mathematical definition (nor do I think we should ascribe mathematical definitions to all implementations).



---

archive/issue_comments_483154.json:
```json
{
    "body": "This makes no sense. `cardinality` is mathematical cardinality. We define it for this purpose. This method is not part of Python semantics, so it does not have to be compatible with it",
    "created_at": "2022-08-15T05:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483154",
    "user": "https://github.com/mkoeppe"
}
```

This makes no sense. `cardinality` is mathematical cardinality. We define it for this purpose. This method is not part of Python semantics, so it does not have to be compatible with it



---

archive/issue_comments_483155.json:
```json
{
    "body": "Replying to [comment:23 mkoeppe]:\n> Strong -1 on giving `cardinality` semantics that differs from what the category guarantees\n\n\nBut it does not differ here. Strictly speaking, it is not a set of values, but a function. We have just chosen the iteration to be over the values as that is what is most convenient for a lot of code.",
    "created_at": "2022-08-15T05:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483155",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:23 mkoeppe]:
> Strong -1 on giving `cardinality` semantics that differs from what the category guarantees


But it does not differ here. Strictly speaking, it is not a set of values, but a function. We have just chosen the iteration to be over the values as that is what is most convenient for a lot of code.



---

archive/issue_comments_483156.json:
```json
{
    "body": "If it is a function, what are the elements?",
    "created_at": "2022-08-15T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483156",
    "user": "https://github.com/mkoeppe"
}
```

If it is a function, what are the elements?



---

archive/issue_comments_483157.json:
```json
{
    "body": "Note also that the documentation uses round brackets `()`, not squiggly `{}` for defining a family, which makes it a sequence (wrt some fixed total order on the index set).",
    "created_at": "2022-08-15T05:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483157",
    "user": "https://github.com/tscrim"
}
```

Note also that the documentation uses round brackets `()`, not squiggly `{}` for defining a family, which makes it a sequence (wrt some fixed total order on the index set).



---

archive/issue_comments_483158.json:
```json
{
    "body": "A function `f(u) = v` is a set of pairs `{(u, v)}`.",
    "created_at": "2022-08-15T05:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483158",
    "user": "https://github.com/tscrim"
}
```

A function `f(u) = v` is a set of pairs `{(u, v)}`.



---

archive/issue_comments_483159.json:
```json
{
    "body": "But `(u,v)` is not an element of the family in the sense of `__contains__` (which is a method of the `Sets().ParentMethods()` protocol): `(u,v) in f` will give `False`. `v in f` gives `True`.",
    "created_at": "2022-08-15T05:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483159",
    "user": "https://github.com/mkoeppe"
}
```

But `(u,v)` is not an element of the family in the sense of `__contains__` (which is a method of the `Sets().ParentMethods()` protocol): `(u,v) in f` will give `False`. `v in f` gives `True`.



---

archive/issue_comments_483160.json:
```json
{
    "body": "Yes, you are correct that it is breaking the usual semantics of a set with the containment. However this is extremely convenient to have and we have (many) other programming models for when we want everything to confirm. Furthermore, what would you consider a sequence to be? Is it not a set? What is its cardinality?",
    "created_at": "2022-08-15T06:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483160",
    "user": "https://github.com/tscrim"
}
```

Yes, you are correct that it is breaking the usual semantics of a set with the containment. However this is extremely convenient to have and we have (many) other programming models for when we want everything to confirm. Furthermore, what would you consider a sequence to be? Is it not a set? What is its cardinality?



---

archive/issue_comments_483161.json:
```json
{
    "body": "Replying to [comment:31 tscrim]:\n> Yes, you are correct that it is breaking the usual semantics of a set with the containment.\n\n\nNo, it just means that the interpretation that a Family \"is\" a function makes no sense.",
    "created_at": "2022-08-15T06:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483161",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:31 tscrim]:
> Yes, you are correct that it is breaking the usual semantics of a set with the containment.


No, it just means that the interpretation that a Family "is" a function makes no sense.



---

archive/issue_comments_483162.json:
```json
{
    "body": "A `Sequence` in Sage is not a Parent, so none of this reasoning applies.",
    "created_at": "2022-08-15T06:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483162",
    "user": "https://github.com/mkoeppe"
}
```

A `Sequence` in Sage is not a Parent, so none of this reasoning applies.



---

archive/issue_comments_483163.json:
```json
{
    "body": "A `Family` is a `Parent` in the `Sets()` category. It's clear that its elements are (the values). It has to satisfy this protocol and not some vague version of it.",
    "created_at": "2022-08-15T06:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483163",
    "user": "https://github.com/mkoeppe"
}
```

A `Family` is a `Parent` in the `Sets()` category. It's clear that its elements are (the values). It has to satisfy this protocol and not some vague version of it.



---

archive/issue_comments_483164.json:
```json
{
    "body": "Replying to [comment:32 mkoeppe]:\n> Replying to [comment:31 tscrim]:\n> > Yes, you are correct that it is breaking the usual semantics of a set with the containment.\n\n> \n> No, it just means that the interpretation that a Family \"is\" a function makes no sense.\n\n\nIt is for mathematical purposes. Since you are trying to make a mathematical point that the cardinality is wrong, we should apply that definition. When it comes to programming, we want an implementation that has features that make a behave like many different objects. How I understand your argument is we should always strictly apply mathematical definitions to programming constructs. What I draw from this is your argument implies we should remove certain features that are extremely useful and need to be fast as they are used in tight loops.",
    "created_at": "2022-08-15T06:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483164",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:32 mkoeppe]:
> Replying to [comment:31 tscrim]:
> > Yes, you are correct that it is breaking the usual semantics of a set with the containment.

> 
> No, it just means that the interpretation that a Family "is" a function makes no sense.


It is for mathematical purposes. Since you are trying to make a mathematical point that the cardinality is wrong, we should apply that definition. When it comes to programming, we want an implementation that has features that make a behave like many different objects. How I understand your argument is we should always strictly apply mathematical definitions to programming constructs. What I draw from this is your argument implies we should remove certain features that are extremely useful and need to be fast as they are used in tight loops.



---

archive/issue_comments_483165.json:
```json
{
    "body": "I think it's instructive to look at https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes to answer what contract `__len__`, `__iter__`, `__contains__` have to satisfy.",
    "created_at": "2022-08-15T06:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483165",
    "user": "https://github.com/mkoeppe"
}
```

I think it's instructive to look at https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes to answer what contract `__len__`, `__iter__`, `__contains__` have to satisfy.



---

archive/issue_comments_483166.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> It's clear that its elements are (the values).\n\n\nThis is not true. Otherwise we would have no need for the `keys()`. \n\n> It has to satisfy this protocol and not some vague version of it.\n\n\nWe should generally follow it, but sometimes there are very good reasons for breaking things. This is one of those times.",
    "created_at": "2022-08-15T06:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483166",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:34 mkoeppe]:
> It's clear that its elements are (the values).


This is not true. Otherwise we would have no need for the `keys()`. 

> It has to satisfy this protocol and not some vague version of it.


We should generally follow it, but sometimes there are very good reasons for breaking things. This is one of those times.



---

archive/issue_comments_483167.json:
```json
{
    "body": "Replying to [comment:35 tscrim]:\n> Replying to [comment:32 mkoeppe]:\n> > No, it just means that the interpretation that a Family \"is\" a function makes no sense.\n\n> \n> It is for mathematical purposes. Since you are trying to make a mathematical point that the cardinality is wrong, we should apply that definition.\n\n\nHere's a mathematical definition of a family that's better for us (= the programming context in which Family is used):\n\nIt \"is\" a set which \"has\" additionally a map from a (possibly ordered) set of keys onto it.",
    "created_at": "2022-08-15T06:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483167",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:35 tscrim]:
> Replying to [comment:32 mkoeppe]:
> > No, it just means that the interpretation that a Family "is" a function makes no sense.

> 
> It is for mathematical purposes. Since you are trying to make a mathematical point that the cardinality is wrong, we should apply that definition.


Here's a mathematical definition of a family that's better for us (= the programming context in which Family is used):

It "is" a set which "has" additionally a map from a (possibly ordered) set of keys onto it.



---

archive/issue_comments_483168.json:
```json
{
    "body": "Replying to [comment:33 mkoeppe]:\n> A `Sequence` in Sage is not a Parent, so none of this reasoning applies.\n\n\nI meant a mathematical sequence. What would you do if you needed it to also be a `Parent`? I suspect you would end up with the `Family` implementation.",
    "created_at": "2022-08-15T06:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483168",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:33 mkoeppe]:
> A `Sequence` in Sage is not a Parent, so none of this reasoning applies.


I meant a mathematical sequence. What would you do if you needed it to also be a `Parent`? I suspect you would end up with the `Family` implementation.



---

archive/issue_comments_483169.json:
```json
{
    "body": "Replying to [comment:37 tscrim]:\n> Replying to [comment:34 mkoeppe]:\n> > It's clear that its elements are (the values).\n\n> \n> This is not true. Otherwise we would have no need for the `keys()`. \n\n\nelements as in Element vs. Parent.\n\n(key, value) pairs are definitely not element of this parent.",
    "created_at": "2022-08-15T06:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483169",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:37 tscrim]:
> Replying to [comment:34 mkoeppe]:
> > It's clear that its elements are (the values).

> 
> This is not true. Otherwise we would have no need for the `keys()`. 


elements as in Element vs. Parent.

(key, value) pairs are definitely not element of this parent.



---

archive/issue_comments_483170.json:
```json
{
    "body": "I think every `Family` is a facade parent. So the elements don't even know about the family.",
    "created_at": "2022-08-15T06:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483170",
    "user": "https://github.com/tscrim"
}
```

I think every `Family` is a facade parent. So the elements don't even know about the family.



---

archive/issue_comments_483171.json:
```json
{
    "body": "comment:30.",
    "created_at": "2022-08-15T06:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483171",
    "user": "https://github.com/mkoeppe"
}
```

comment:30.



---

archive/issue_comments_483172.json:
```json
{
    "body": "Replying to [comment:38 mkoeppe]:\n> Replying to [comment:35 tscrim]:\n> > Replying to [comment:32 mkoeppe]:\n> > > No, it just means that the interpretation that a Family \"is\" a function makes no sense.\n\n> > \n> > It is for mathematical purposes. Since you are trying to make a mathematical point that the cardinality is wrong, we should apply that definition.\n\n> \n> Here's a mathematical definition of a family that's better for us (= the programming context in which Family is used):\n> \n> It \"is\" a set which \"has\" additionally a map from a (possibly ordered) set of keys onto it.\n\n\nOkay, I think I can get behind this as a definition. However, this makes computing the `cardinality()` potentially very expensive. I am also not sure about getting rid of the sequence/function-like aspect it had, but I currently do not have a use-case for it.\n\nI am also opposed to making everything extremely mathematically strict and rigorous. Again, there are times when it is useful to break that. I think we should instead just simply document that for most things it behaves like a function (as it is, just written `f[x]` instead of `f(x)`), but others, such as its iteration and containment, is based on the set of its values.",
    "created_at": "2022-08-15T06:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483172",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:38 mkoeppe]:
> Replying to [comment:35 tscrim]:
> > Replying to [comment:32 mkoeppe]:
> > > No, it just means that the interpretation that a Family "is" a function makes no sense.

> > 
> > It is for mathematical purposes. Since you are trying to make a mathematical point that the cardinality is wrong, we should apply that definition.

> 
> Here's a mathematical definition of a family that's better for us (= the programming context in which Family is used):
> 
> It "is" a set which "has" additionally a map from a (possibly ordered) set of keys onto it.


Okay, I think I can get behind this as a definition. However, this makes computing the `cardinality()` potentially very expensive. I am also not sure about getting rid of the sequence/function-like aspect it had, but I currently do not have a use-case for it.

I am also opposed to making everything extremely mathematically strict and rigorous. Again, there are times when it is useful to break that. I think we should instead just simply document that for most things it behaves like a function (as it is, just written `f[x]` instead of `f(x)`), but others, such as its iteration and containment, is based on the set of its values.



---

archive/issue_comments_483173.json:
```json
{
    "body": "Replying to [comment:35 tscrim]:\n> What I draw from this is your argument implies we should remove certain features that are extremely useful and need to be fast as they are used in tight loops.\n\n\nI think in most existing use cases of `Family`, the map is actually injective. \nIt would make sense to me to add to `Family` a keyword `is_injective` (default `True` =  unchecked promise that it is injective) that enables a fast straightforward mplementation.",
    "created_at": "2022-08-15T06:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483173",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:35 tscrim]:
> What I draw from this is your argument implies we should remove certain features that are extremely useful and need to be fast as they are used in tight loops.


I think in most existing use cases of `Family`, the map is actually injective. 
It would make sense to me to add to `Family` a keyword `is_injective` (default `True` =  unchecked promise that it is injective) that enables a fast straightforward mplementation.



---

archive/issue_comments_483174.json:
```json
{
    "body": "Replying to [comment:42 mkoeppe]:\n> comment:30.\n\n\ncomment:37.",
    "created_at": "2022-08-15T06:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483174",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:42 mkoeppe]:
> comment:30.


comment:37.



---

archive/issue_comments_483175.json:
```json
{
    "body": "IIRC, the only reason a `Family` is a `Parent` is because it needs to play nicely with things that expect a `Parent` as input (which includes immutability and hashability).",
    "created_at": "2022-08-15T06:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483175",
    "user": "https://github.com/tscrim"
}
```

IIRC, the only reason a `Family` is a `Parent` is because it needs to play nicely with things that expect a `Parent` as input (which includes immutability and hashability).



---

archive/issue_comments_483176.json:
```json
{
    "body": "In my use case of `Family` it's very useful that it's a `Parent` (hence this ticket)",
    "created_at": "2022-08-15T06:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483176",
    "user": "https://github.com/mkoeppe"
}
```

In my use case of `Family` it's very useful that it's a `Parent` (hence this ticket)



---

archive/issue_comments_483177.json:
```json
{
    "body": "Replying to [comment:44 mkoeppe]:\n> I think in most existing use cases of `Family`, the map is actually injective. \n> It would make sense to me to add to `Family` a keyword `is_injective` (default `True` =  unchecked promise that it is injective) that enables a fast straightforward implementation. \n\n\nIn particular, `ImageSubobject` already knows how to handle `is_injective`",
    "created_at": "2022-08-15T06:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483177",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:44 mkoeppe]:
> I think in most existing use cases of `Family`, the map is actually injective. 
> It would make sense to me to add to `Family` a keyword `is_injective` (default `True` =  unchecked promise that it is injective) that enables a fast straightforward implementation. 


In particular, `ImageSubobject` already knows how to handle `is_injective`



---

archive/issue_comments_483178.json:
```json
{
    "body": "I am still not very happy with effectively deprecating functionality that would not be replaced with something else. IMO, it is not a bug. It seems like you are essentially proposing to make `Family` be duplicate code of `ImageSubobject`. However, I see their behaviors as complementary.\n\nTo me, a `Family` is a `Parent` and hasbable version of `dict`, which is suppose to be a model of a map (to this point, in the C++ STL, it is called `map`). In a strict mathematical world, we would iterate over and check containment in `F.values()`. Yet for the cases that we use it, we typically want the values and check containment within either the keys or values (even Python's `dict` does not follow its set-theoretic containment check).\n\nHence, if we just document these behaviors clearly (and not call them wrong), it will be sufficient to deter the user who is using this to model something that they shouldn't be. We can redirect the user to other objects, such as `ImageSubobject` if they, e.g., really want the cardinality of the values.",
    "created_at": "2022-08-15T06:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483178",
    "user": "https://github.com/tscrim"
}
```

I am still not very happy with effectively deprecating functionality that would not be replaced with something else. IMO, it is not a bug. It seems like you are essentially proposing to make `Family` be duplicate code of `ImageSubobject`. However, I see their behaviors as complementary.

To me, a `Family` is a `Parent` and hasbable version of `dict`, which is suppose to be a model of a map (to this point, in the C++ STL, it is called `map`). In a strict mathematical world, we would iterate over and check containment in `F.values()`. Yet for the cases that we use it, we typically want the values and check containment within either the keys or values (even Python's `dict` does not follow its set-theoretic containment check).

Hence, if we just document these behaviors clearly (and not call them wrong), it will be sufficient to deter the user who is using this to model something that they shouldn't be. We can redirect the user to other objects, such as `ImageSubobject` if they, e.g., really want the cardinality of the values.



---

archive/issue_comments_483179.json:
```json
{
    "body": "Replying to [comment:49 tscrim]:\n> I am still not very happy with effectively deprecating functionality \n\n\nwhich one?",
    "created_at": "2022-08-15T06:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483179",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:49 tscrim]:
> I am still not very happy with effectively deprecating functionality 


which one?



---

archive/issue_comments_483180.json:
```json
{
    "body": "Replying to [comment:49 tscrim]:\n> It seems like you are essentially proposing to make `Family` be duplicate code of `ImageSubobject`.\n\n\nNot really, it has a different API (no `keys`). But it can be used for implementing `LazyFamily` to avoid code duplication.",
    "created_at": "2022-08-15T06:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483180",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:49 tscrim]:
> It seems like you are essentially proposing to make `Family` be duplicate code of `ImageSubobject`.


Not really, it has a different API (no `keys`). But it can be used for implementing `LazyFamily` to avoid code duplication.



---

archive/issue_comments_483181.json:
```json
{
    "body": "Replying to [comment:51 mkoeppe]:\n> Replying to [comment:49 tscrim]:\n> > It seems like you are essentially proposing to make `Family` be duplicate code of `ImageSubobject`.\n\n> \n> Not really, it has a different API (no `keys`). But it can be used for implementing `LazyFamily` to avoid code duplication.\n\n\nSurely you have access to the defining map and its codomain. Or are you looking for something that ducktypes with `dict`?",
    "created_at": "2022-08-15T06:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483181",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:51 mkoeppe]:
> Replying to [comment:49 tscrim]:
> > It seems like you are essentially proposing to make `Family` be duplicate code of `ImageSubobject`.

> 
> Not really, it has a different API (no `keys`). But it can be used for implementing `LazyFamily` to avoid code duplication.


Surely you have access to the defining map and its codomain. Or are you looking for something that ducktypes with `dict`?



---

archive/issue_comments_483182.json:
```json
{
    "body": "Replying to [comment:50 mkoeppe]:\n> Replying to [comment:49 tscrim]:\n> > I am still not very happy with effectively deprecating functionality \n\n> \n> which one?\n\n\nThe function/sequence like behavior with `cardinality()` and iteration. Why I see it as an effective deprecation is the `.. WARNING::` saying it could be wrong, changing the definition in comment:38, adding `is_injective` in comment:44, etc. What this amounts to is saying \"we need to change the behavior when the map is not injective.\" Paraphrasing that would be \"we will remove this functionality (because it is wrong).\"",
    "created_at": "2022-08-15T07:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483182",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:50 mkoeppe]:
> Replying to [comment:49 tscrim]:
> > I am still not very happy with effectively deprecating functionality 

> 
> which one?


The function/sequence like behavior with `cardinality()` and iteration. Why I see it as an effective deprecation is the `.. WARNING::` saying it could be wrong, changing the definition in comment:38, adding `is_injective` in comment:44, etc. What this amounts to is saying "we need to change the behavior when the map is not injective." Paraphrasing that would be "we will remove this functionality (because it is wrong)."



---

archive/issue_comments_483183.json:
```json
{
    "body": "All examples in `family.py` are injective. I'd say it's just a hidden assumption in the code, and clarifying it and handling both the injective and non-injective case correctly would be an improvement. I don't see it as deprecating anything. The interpretation of `cardinality` in the non-injective case just does not hold up.",
    "created_at": "2022-08-15T07:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483183",
    "user": "https://github.com/mkoeppe"
}
```

All examples in `family.py` are injective. I'd say it's just a hidden assumption in the code, and clarifying it and handling both the injective and non-injective case correctly would be an improvement. I don't see it as deprecating anything. The interpretation of `cardinality` in the non-injective case just does not hold up.



---

archive/issue_comments_483184.json:
```json
{
    "body": "Replying to [comment:49 tscrim]:\n> To me, a `Family` is a `Parent` and hasbable version of `dict`, which is suppose to be a model of a map (to this point, in the C++ STL, it is called `map`).\n\n\nThe comparison with C++ STL map is not very useful. Its elements are pairs. Calling `iterator` gives pairs.\n\nPython `dict` does not have this behavior. Calling `iter` iterates through its keys.\n\nAnd `Family` has neither behavior of the two. Calling `iter` iterates through values.",
    "created_at": "2022-08-15T07:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483184",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:49 tscrim]:
> To me, a `Family` is a `Parent` and hasbable version of `dict`, which is suppose to be a model of a map (to this point, in the C++ STL, it is called `map`).


The comparison with C++ STL map is not very useful. Its elements are pairs. Calling `iterator` gives pairs.

Python `dict` does not have this behavior. Calling `iter` iterates through its keys.

And `Family` has neither behavior of the two. Calling `iter` iterates through values.



---

archive/issue_comments_483185.json:
```json
{
    "body": "Replying to [comment:54 mkoeppe]:\n> All examples in `family.py` are injective. I'd say it's just a hidden assumption in the code, and clarifying it and handling both the injective and non-injective case correctly would be an improvement. I don't see it as deprecating anything. The interpretation of `cardinality` in the non-injective case just does not hold up.\n\n\nI think it is clear I disagree with this. A lack of evidence does not mean something can never happen. In the use-cases we care about, it is injective, but there is no documentation about this being a requirement. Given its role generally as a `dict` object, the `cardinality()` works where `__len__` cannot and it is consistent with that.",
    "created_at": "2022-08-15T07:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483185",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:54 mkoeppe]:
> All examples in `family.py` are injective. I'd say it's just a hidden assumption in the code, and clarifying it and handling both the injective and non-injective case correctly would be an improvement. I don't see it as deprecating anything. The interpretation of `cardinality` in the non-injective case just does not hold up.


I think it is clear I disagree with this. A lack of evidence does not mean something can never happen. In the use-cases we care about, it is injective, but there is no documentation about this being a requirement. Given its role generally as a `dict` object, the `cardinality()` works where `__len__` cannot and it is consistent with that.



---

archive/issue_comments_483186.json:
```json
{
    "body": "The comparison with `dict` is misleading. If one wanted a hashable version of `dict`, it would have been easy to just implement something compatible with `dict`. But `Family` was clearly designed for a different purpose - namely something that \"is\" a set of values, not only \"has\" a set of values.",
    "created_at": "2022-08-15T07:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483186",
    "user": "https://github.com/mkoeppe"
}
```

The comparison with `dict` is misleading. If one wanted a hashable version of `dict`, it would have been easy to just implement something compatible with `dict`. But `Family` was clearly designed for a different purpose - namely something that "is" a set of values, not only "has" a set of values.



---

archive/issue_comments_483187.json:
```json
{
    "body": "Anyway, it's late here. I'll play with the implementation in the next days and see if I can check if there's any non-injective use in the Sage library. This will give us more information.",
    "created_at": "2022-08-15T07:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483187",
    "user": "https://github.com/mkoeppe"
}
```

Anyway, it's late here. I'll play with the implementation in the next days and see if I can check if there's any non-injective use in the Sage library. This will give us more information.



---

archive/issue_comments_483188.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-08-15T07:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483188",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_483189.json:
```json
{
    "body": "IIRC, it was meant to be a hashable `dict` that also worked for infinite objects and had `Parent`-like behavior (I think for removing code duplication from inheriting stuff from categories too). It was chosen to iterate over the values rather than the keys (and check containment) because that was what was convenient for the majority of use cases.\n\nHowever, that is not the only times where it is used. A `Family` is used to handle `dict` inputs to `UniqueRepresentation` in `LieAlgebrasWithStructureCoefficients`. Now it is not being used there as a set (or even allowing it to be infinite), but just a convenient tool to handle the hashing. If you are insistent on making sure that `Family` strictly conforms with your mathematical definition of it, then you will need to change the places in Sage where it is not conforming with your definition and make sure there is a replacement for the current behavior.",
    "created_at": "2022-08-15T07:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483189",
    "user": "https://github.com/tscrim"
}
```

IIRC, it was meant to be a hashable `dict` that also worked for infinite objects and had `Parent`-like behavior (I think for removing code duplication from inheriting stuff from categories too). It was chosen to iterate over the values rather than the keys (and check containment) because that was what was convenient for the majority of use cases.

However, that is not the only times where it is used. A `Family` is used to handle `dict` inputs to `UniqueRepresentation` in `LieAlgebrasWithStructureCoefficients`. Now it is not being used there as a set (or even allowing it to be infinite), but just a convenient tool to handle the hashing. If you are insistent on making sure that `Family` strictly conforms with your mathematical definition of it, then you will need to change the places in Sage where it is not conforming with your definition and make sure there is a replacement for the current behavior.



---

archive/issue_comments_483190.json:
```json
{
    "body": "I doubt that in such use cases the method `cardinality` is used.",
    "created_at": "2022-08-15T15:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483190",
    "user": "https://github.com/mkoeppe"
}
```

I doubt that in such use cases the method `cardinality` is used.



---

archive/issue_comments_483191.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T22:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483192.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-15T23:43:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483193.json:
```json
{
    "body": "I think it can be dangerous to make such claims about code in the wild, especially something as a low-level tool like this. I am still generally opposed to considering a `Family`. Or has your argument actually become that `ImageSubset` is duplicating the functionality and intent of `Family`? API's being different is not a valid argument against this latter claim; it is just one easy to add method. I still strongly contend this is meant to be a `dict`-like structure that complements `ImageSubset`.",
    "created_at": "2022-08-15T23:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483193",
    "user": "https://github.com/tscrim"
}
```

I think it can be dangerous to make such claims about code in the wild, especially something as a low-level tool like this. I am still generally opposed to considering a `Family`. Or has your argument actually become that `ImageSubset` is duplicating the functionality and intent of `Family`? API's being different is not a valid argument against this latter claim; it is just one easy to add method. I still strongly contend this is meant to be a `dict`-like structure that complements `ImageSubset`.



---

archive/issue_comments_483194.json:
```json
{
    "body": "The crucial difference is equality.\n\nTwo `ImageSubset`s are equal if they have the same elements.\n\nTwo `Family`s are equal if they have the same keys and map (whatever that means in detail).",
    "created_at": "2022-08-15T23:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483194",
    "user": "https://github.com/mkoeppe"
}
```

The crucial difference is equality.

Two `ImageSubset`s are equal if they have the same elements.

Two `Family`s are equal if they have the same keys and map (whatever that means in detail).



---

archive/issue_comments_483195.json:
```json
{
    "body": "Which further makes my point that it is `dict`-like and not `set`-like.",
    "created_at": "2022-08-15T23:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483195",
    "user": "https://github.com/tscrim"
}
```

Which further makes my point that it is `dict`-like and not `set`-like.



---

archive/issue_comments_483196.json:
```json
{
    "body": "It is only dict-like in that it has two methods `keys` and `values`, that's all. Code that uses Family like a dict will have to use these methods. Using `cardinality` just makes no sense.",
    "created_at": "2022-08-16T00:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483196",
    "user": "https://github.com/mkoeppe"
}
```

It is only dict-like in that it has two methods `keys` and `values`, that's all. Code that uses Family like a dict will have to use these methods. Using `cardinality` just makes no sense.



---

archive/issue_comments_483197.json:
```json
{
    "body": "Some failures with the current code\n\n```\nsage -t --random-seed=251178244497158028621407850304141794068 src/sage/algebras/jordan_algebra.py  # Timed out\nsage -t --random-seed=251178244497158028621407850304141794068 src/sage/quivers/path_semigroup.py  # 1 doctest failed\nsage -t --random-seed=251178244497158028621407850304141794068 src/sage/algebras/yangian.py  # Timed out\nsage -t --random-seed=251178244497158028621407850304141794068 src/sage/algebras/lie_algebras/abelian.py  # 5 doctests failed\n```",
    "created_at": "2022-08-16T00:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483197",
    "user": "https://github.com/mkoeppe"
}
```

Some failures with the current code

```
sage -t --random-seed=251178244497158028621407850304141794068 src/sage/algebras/jordan_algebra.py  # Timed out
sage -t --random-seed=251178244497158028621407850304141794068 src/sage/quivers/path_semigroup.py  # 1 doctest failed
sage -t --random-seed=251178244497158028621407850304141794068 src/sage/algebras/yangian.py  # Timed out
sage -t --random-seed=251178244497158028621407850304141794068 src/sage/algebras/lie_algebras/abelian.py  # 5 doctests failed
```



---

archive/issue_comments_483198.json:
```json
{
    "body": "Replying to [comment:66 mkoeppe]:\n> It is only dict-like in that it has two methods `keys` and `values`, that's all. Code that uses Family like a dict will have to use these methods. Using `cardinality` just makes no sense.\n\n\nEquality is also `dict`-like (i.e., it is being treated as a map), which you just made a point about. Hence its `__len__` should follow suit, and it would be extremely strange to have `cardinality()` different from that.",
    "created_at": "2022-08-16T00:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483198",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:66 mkoeppe]:
> It is only dict-like in that it has two methods `keys` and `values`, that's all. Code that uses Family like a dict will have to use these methods. Using `cardinality` just makes no sense.


Equality is also `dict`-like (i.e., it is being treated as a map), which you just made a point about. Hence its `__len__` should follow suit, and it would be extremely strange to have `cardinality()` different from that.



---

archive/issue_comments_483199.json:
```json
{
    "body": "Replying to [comment:68 tscrim]:\n> Replying to [comment:66 mkoeppe]:\n> > It is only dict-like in that it has two methods `keys` and `values`, that's all. Code that uses Family like a dict will have to use these methods. Using `cardinality` just makes no sense.\n\n> \n> Equality is also `dict`-like (i.e., it is being treated as a map), which you just made a point about. Hence its `__len__` should follow suit\n\n\nNo, this does not follow at all.\n\nThink about it in terms of algebraic structures. For example, a group has a stricter notion of equality than the underlying set. But the notion of cardinality is set-theoretic. A group cannot just modify the concept of cardinality.",
    "created_at": "2022-08-16T00:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483199",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:68 tscrim]:
> Replying to [comment:66 mkoeppe]:
> > It is only dict-like in that it has two methods `keys` and `values`, that's all. Code that uses Family like a dict will have to use these methods. Using `cardinality` just makes no sense.

> 
> Equality is also `dict`-like (i.e., it is being treated as a map), which you just made a point about. Hence its `__len__` should follow suit


No, this does not follow at all.

Think about it in terms of algebraic structures. For example, a group has a stricter notion of equality than the underlying set. But the notion of cardinality is set-theoretic. A group cannot just modify the concept of cardinality.



---

archive/issue_comments_483200.json:
```json
{
    "body": "That's a non-sequitur. The issue is about the mathematical definition of a `Family` and the tension of that with some of the implementation details.\n\nThe design and many of the core implementation features are about emulating `dict` that is a `Parent`. We have other things, namely `ImageSubset` when we want to think of it as a set of values with a map attached. In fact, a core part of your argument is things that are in `Sets` should follow the same protocols, which include equality. Equality of sets means `X` and `Y` are each contained within each other. comment:64 rightly points out that equality of `Family` is not this, which is because it is `dict`-like, so it is treated mathematically as a set of pairs `(k, v)` defining map. I agree with you that it abuses containment and iteration for programmatic convenience. I would not be opposed to changing this behavior if it was not so fully ingrained within Sage. The documentation is very clear about it being a `dict`-like structure too as it uses sequence notation, not set notation.",
    "created_at": "2022-08-16T00:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483200",
    "user": "https://github.com/tscrim"
}
```

That's a non-sequitur. The issue is about the mathematical definition of a `Family` and the tension of that with some of the implementation details.

The design and many of the core implementation features are about emulating `dict` that is a `Parent`. We have other things, namely `ImageSubset` when we want to think of it as a set of values with a map attached. In fact, a core part of your argument is things that are in `Sets` should follow the same protocols, which include equality. Equality of sets means `X` and `Y` are each contained within each other. comment:64 rightly points out that equality of `Family` is not this, which is because it is `dict`-like, so it is treated mathematically as a set of pairs `(k, v)` defining map. I agree with you that it abuses containment and iteration for programmatic convenience. I would not be opposed to changing this behavior if it was not so fully ingrained within Sage. The documentation is very clear about it being a `dict`-like structure too as it uses sequence notation, not set notation.



---

archive/issue_comments_483201.json:
```json
{
    "body": "Replying to [comment:68 tscrim]:\n> it would be extremely strange to have `cardinality()` different from [`__len__`]\n\n\nI do agree with this part, so I retract what I said in comment:15 regarding this.\n\n`__len__` should be the same as `cardinality`.\nAnd this is compatible with `__iter__` (which must iterate over the elements of the set - no duplicates!)",
    "created_at": "2022-08-16T00:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483201",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:68 tscrim]:
> it would be extremely strange to have `cardinality()` different from [`__len__`]


I do agree with this part, so I retract what I said in comment:15 regarding this.

`__len__` should be the same as `cardinality`.
And this is compatible with `__iter__` (which must iterate over the elements of the set - no duplicates!)



---

archive/issue_comments_483202.json:
```json
{
    "body": "Replying to [comment:70 tscrim]:\n> In fact, a core part of your argument is things that are in `Sets` should follow the same protocols, which include equality. Equality of sets means `X` and `Y` are each contained within each other.\n\n\nYes, this is exactly what being in the category guarantees.\n\n> comment:64 rightly points out that equality of `Family` is not this, which is because it is `dict`-like, so it is treated mathematically as a set of pairs `(k, v)` defining map. \n\n\nNo, the interpretation that it \"is\" a set of pairs (= the pairs the elements) does not hold up. I've explained it before in comment:55.\n\nWhat are elements? They are what `__iter__` produces, and they are the idempotents under `_element_constructor_`. \n\nThese are clearly the values, not key-value pairs.",
    "created_at": "2022-08-16T00:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483202",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:70 tscrim]:
> In fact, a core part of your argument is things that are in `Sets` should follow the same protocols, which include equality. Equality of sets means `X` and `Y` are each contained within each other.


Yes, this is exactly what being in the category guarantees.

> comment:64 rightly points out that equality of `Family` is not this, which is because it is `dict`-like, so it is treated mathematically as a set of pairs `(k, v)` defining map. 


No, the interpretation that it "is" a set of pairs (= the pairs the elements) does not hold up. I've explained it before in comment:55.

What are elements? They are what `__iter__` produces, and they are the idempotents under `_element_constructor_`. 

These are clearly the values, not key-value pairs.



---

archive/issue_comments_483203.json:
```json
{
    "body": "So, as I continue to use the definition of Family from comment:38, \nthe map onto ``self`` is the additional structure of a Family, just like the group law is the additional structure of a Group.",
    "created_at": "2022-08-16T00:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483203",
    "user": "https://github.com/mkoeppe"
}
```

So, as I continue to use the definition of Family from comment:38, 
the map onto ``self`` is the additional structure of a Family, just like the group law is the additional structure of a Group.



---

archive/issue_comments_483204.json:
```json
{
    "body": "The additional structure changes what is equal, but it cannot change cardinality.",
    "created_at": "2022-08-16T00:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483204",
    "user": "https://github.com/mkoeppe"
}
```

The additional structure changes what is equal, but it cannot change cardinality.



---

archive/issue_comments_483205.json:
```json
{
    "body": "This sounds like it would introduce a major inconsistency: Two things are equal (by taking the set-of-values) with different cardinalities! If we are not going to replace it by `ImageSubset`, then we are going to have to live with some inconsistency. It is a much smaller one to simply state that iteration and containment is done on its values.\n\nAdditionally, `Family` doesn't have an `_element_constructor_`, nor does it support the `__call__` syntax (it raises a `NotImplementedError`). It uses `F[x]` instead of `F(x)` to be used as a `dict` replacement.",
    "created_at": "2022-08-16T01:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483205",
    "user": "https://github.com/tscrim"
}
```

This sounds like it would introduce a major inconsistency: Two things are equal (by taking the set-of-values) with different cardinalities! If we are not going to replace it by `ImageSubset`, then we are going to have to live with some inconsistency. It is a much smaller one to simply state that iteration and containment is done on its values.

Additionally, `Family` doesn't have an `_element_constructor_`, nor does it support the `__call__` syntax (it raises a `NotImplementedError`). It uses `F[x]` instead of `F(x)` to be used as a `dict` replacement.



---

archive/issue_comments_483206.json:
```json
{
    "body": "Furthermore, because it is a fa\u00e7ade parent, it doesn't technically have elements either.",
    "created_at": "2022-08-16T01:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483206",
    "user": "https://github.com/tscrim"
}
```

Furthermore, because it is a façade parent, it doesn't technically have elements either.



---

archive/issue_comments_483207.json:
```json
{
    "body": "Replying to [comment:75 tscrim]:\n> This sounds like it would introduce a major inconsistency: Two things are equal (by taking the set-of-values) with different cardinalities!\n\n\nNo, why would you think so?",
    "created_at": "2022-08-16T01:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483207",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:75 tscrim]:
> This sounds like it would introduce a major inconsistency: Two things are equal (by taking the set-of-values) with different cardinalities!


No, why would you think so?



---

archive/issue_comments_483208.json:
```json
{
    "body": "Replying to [comment:75 tscrim]:\n> Additionally, `Family` doesn't have an `_element_constructor_`\n\n\n`LazyFamily` now does.",
    "created_at": "2022-08-16T01:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483208",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:75 tscrim]:
> Additionally, `Family` doesn't have an `_element_constructor_`


`LazyFamily` now does.



---

archive/issue_comments_483209.json:
```json
{
    "body": "Replying to [comment:77 mkoeppe]:\n> Replying to [comment:75 tscrim]:\n> > This sounds like it would introduce a major inconsistency: Two things are equal (by taking the set-of-values) with different cardinalities!\n\n> \n> No, why would you think so?\n\n\nI misread what you said, sorry about that.\n\nActually, since you are changing the category (to `SetsWithMaps`), we do not have to have the cardinality agree with `Sets`. This is not the same relation as for, e.g., `Groups` to `Sets`. It is not intrinsic to the set.",
    "created_at": "2022-08-16T01:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483209",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:77 mkoeppe]:
> Replying to [comment:75 tscrim]:
> > This sounds like it would introduce a major inconsistency: Two things are equal (by taking the set-of-values) with different cardinalities!

> 
> No, why would you think so?


I misread what you said, sorry about that.

Actually, since you are changing the category (to `SetsWithMaps`), we do not have to have the cardinality agree with `Sets`. This is not the same relation as for, e.g., `Groups` to `Sets`. It is not intrinsic to the set.



---

archive/issue_comments_483210.json:
```json
{
    "body": "Replying to [comment:78 mkoeppe]:\n> Replying to [comment:75 tscrim]:\n> > Additionally, `Family` doesn't have an `_element_constructor_`\n\n> \n> `LazyFamily` now does.\n\n\nI don't think it is valid to use something you implemented as justification for what you think it should do.",
    "created_at": "2022-08-16T01:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483210",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:78 mkoeppe]:
> Replying to [comment:75 tscrim]:
> > Additionally, `Family` doesn't have an `_element_constructor_`

> 
> `LazyFamily` now does.


I don't think it is valid to use something you implemented as justification for what you think it should do.



---

archive/issue_comments_483211.json:
```json
{
    "body": "Replying to [comment:72 mkoeppe]:\n> What are elements? They are what `__iter__` produces\n\n\nHow about this one?",
    "created_at": "2022-08-16T01:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483211",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:72 mkoeppe]:
> What are elements? They are what `__iter__` produces


How about this one?



---

archive/issue_comments_483212.json:
```json
{
    "body": "Replying to [comment:81 mkoeppe]:\n> Replying to [comment:72 mkoeppe]:\n> > What are elements? They are what `__iter__` produces\n\n> \n> How about this one?\n\n\nAs I have repeatedly said, it is an abuse that we should document, but we have it because it is so convenient for the uses of this class.",
    "created_at": "2022-08-16T01:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483212",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:81 mkoeppe]:
> Replying to [comment:72 mkoeppe]:
> > What are elements? They are what `__iter__` produces

> 
> How about this one?


As I have repeatedly said, it is an abuse that we should document, but we have it because it is so convenient for the uses of this class.



---

archive/issue_comments_483213.json:
```json
{
    "body": "Sorry, Travis, your theory that key-value pairs are somehow the elements is completely unsubstantiated. There is no place in the code where key-value pairs even appear. Dicts at least have an `__items__` method, but a `Family` does not.",
    "created_at": "2022-08-16T01:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483213",
    "user": "https://github.com/mkoeppe"
}
```

Sorry, Travis, your theory that key-value pairs are somehow the elements is completely unsubstantiated. There is no place in the code where key-value pairs even appear. Dicts at least have an `__items__` method, but a `Family` does not.



---

archive/issue_comments_483214.json:
```json
{
    "body": "Replying to [comment:79 tscrim]:\n> Actually, since you are changing the category (to `SetsWithMaps`) [...]\n\n\nYou may want to develop this line of reasoning a bit further if you want to use it.",
    "created_at": "2022-08-16T01:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483214",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:79 tscrim]:
> Actually, since you are changing the category (to `SetsWithMaps`) [...]


You may want to develop this line of reasoning a bit further if you want to use it.



---

archive/issue_comments_483215.json:
```json
{
    "body": "Replying to [comment:83 mkoeppe]:\n> Sorry, Travis, your theory that key-value pairs are somehow the elements is completely unsubstantiated. There is no place in the code where key-value pairs even appear. Dicts at least have an `__items__` method, but a `Family` does not.\n\n\nYou mean in spite of all of the classes' documentation, the `cardinality()`, the equality, the `__getitem__()`, and the `keys()`? One implementation even stores a `dict`; the `TrivialFamily` does not because it is wasteful.\n\nIIRC, not having an `items()` comes from the fact this was implemented in Python2, when `items()` had to result in a list and there was not a reasonable way to make sense of this when the family was infinite. Now that we are allowed to return iterators for it, we can add this.\n\nHonestly, I don't think this was ever meant to be treated so precisely as an object in `Sets`. What I do not support is removing functionality and increasing code duplication (without a good reason; the reasoning you have given does not meet that standard to me).",
    "created_at": "2022-08-16T01:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483215",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:83 mkoeppe]:
> Sorry, Travis, your theory that key-value pairs are somehow the elements is completely unsubstantiated. There is no place in the code where key-value pairs even appear. Dicts at least have an `__items__` method, but a `Family` does not.


You mean in spite of all of the classes' documentation, the `cardinality()`, the equality, the `__getitem__()`, and the `keys()`? One implementation even stores a `dict`; the `TrivialFamily` does not because it is wasteful.

IIRC, not having an `items()` comes from the fact this was implemented in Python2, when `items()` had to result in a list and there was not a reasonable way to make sense of this when the family was infinite. Now that we are allowed to return iterators for it, we can add this.

Honestly, I don't think this was ever meant to be treated so precisely as an object in `Sets`. What I do not support is removing functionality and increasing code duplication (without a good reason; the reasoning you have given does not meet that standard to me).



---

archive/issue_comments_483216.json:
```json
{
    "body": "Replying to [comment:84 mkoeppe]:\n> Replying to [comment:79 tscrim]:\n> > Actually, since you are changing the category (to `SetsWithMaps`) [...]\n\n> \n> You may want to develop this line of reasoning a bit further if you want to use it. \n\n\nWhat do you mean by \"use it\" here? As justification for this argument (which I would then read your statement as very passive-aggressive)? Or do you mean to implement a new object that would be a replacement for the functionality of `Family` that you are trying to remove?",
    "created_at": "2022-08-16T01:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483216",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:84 mkoeppe]:
> Replying to [comment:79 tscrim]:
> > Actually, since you are changing the category (to `SetsWithMaps`) [...]

> 
> You may want to develop this line of reasoning a bit further if you want to use it. 


What do you mean by "use it" here? As justification for this argument (which I would then read your statement as very passive-aggressive)? Or do you mean to implement a new object that would be a replacement for the functionality of `Family` that you are trying to remove?



---

archive/issue_comments_483217.json:
```json
{
    "body": "Replying to [comment:85 tscrim]:\n> Replying to [comment:83 mkoeppe]:\n> > Sorry, Travis, your theory that key-value pairs are somehow the elements is completely unsubstantiated. There is no place in the code where key-value pairs even appear. Dicts at least have an `__items__` method, but a `Family` does not.\n\n> \n> You mean in spite of all of the classes' documentation, the `cardinality()`, the equality, the `__getitem__()`, and the `keys()`? One implementation even stores a `dict`\n\n\nYes, there are no key-value pairs anywhere in this code.",
    "created_at": "2022-08-16T01:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483217",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:85 tscrim]:
> Replying to [comment:83 mkoeppe]:
> > Sorry, Travis, your theory that key-value pairs are somehow the elements is completely unsubstantiated. There is no place in the code where key-value pairs even appear. Dicts at least have an `__items__` method, but a `Family` does not.

> 
> You mean in spite of all of the classes' documentation, the `cardinality()`, the equality, the `__getitem__()`, and the `keys()`? One implementation even stores a `dict`


Yes, there are no key-value pairs anywhere in this code.



---

archive/issue_comments_483218.json:
```json
{
    "body": "And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.",
    "created_at": "2022-08-16T01:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483218",
    "user": "https://github.com/mkoeppe"
}
```

And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.



---

archive/issue_comments_483219.json:
```json
{
    "body": "Replying to [comment:88 mkoeppe]:\n> And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.\n\n\nSo this doesn't count:\n\n```\n[(k, F[k]) for k in F.keys()]\n```\nwhich is just a slight modification of\n\n```\n[(k, d[k]) for k in d]\n```\nfor a `dict` `d`?\n\nA `dict` only has one thing that returns the pairs, which is `items()`. The key-value pairs are also implicit in the equality comparison; more explicitly when it not a lazy family (comparing the `_enumeration` or `_dictionary`).",
    "created_at": "2022-08-16T01:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483219",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:88 mkoeppe]:
> And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.


So this doesn't count:

```
[(k, F[k]) for k in F.keys()]
```
which is just a slight modification of

```
[(k, d[k]) for k in d]
```
for a `dict` `d`?

A `dict` only has one thing that returns the pairs, which is `items()`. The key-value pairs are also implicit in the equality comparison; more explicitly when it not a lazy family (comparing the `_enumeration` or `_dictionary`).



---

archive/issue_comments_483220.json:
```json
{
    "body": "Replying to [comment:89 tscrim]:\n> Replying to [comment:88 mkoeppe]:\n> > And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.\n\n> \n> So this doesn't count:\n> \n> ```\n> [(k, F[k]) for k in F.keys()]\n> ```\n\n\nIt's iterating over the keys. What's your point?",
    "created_at": "2022-08-16T01:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483220",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:89 tscrim]:
> Replying to [comment:88 mkoeppe]:
> > And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.

> 
> So this doesn't count:
> 
> ```
> [(k, F[k]) for k in F.keys()]
> ```


It's iterating over the keys. What's your point?



---

archive/issue_comments_483221.json:
```json
{
    "body": "Even with this ticket, a `Family` will continue to have `keys` and `__getitem__` methods in case this was unclear.",
    "created_at": "2022-08-16T01:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483221",
    "user": "https://github.com/mkoeppe"
}
```

Even with this ticket, a `Family` will continue to have `keys` and `__getitem__` methods in case this was unclear.



---

archive/issue_comments_483222.json:
```json
{
    "body": "Replying to [comment:90 mkoeppe]:\n> Replying to [comment:89 tscrim]:\n> > Replying to [comment:88 mkoeppe]:\n> > > And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.\n\n> > \n> > So this doesn't count:\n> > \n> > ```\n> > [(k, F[k]) for k in F.keys()]\n> > ```\n\n> \n> It's iterating over the keys. What's your point?\n\n\nIt has a very similar API to `dict` with an easy way to produce key-value pairs. With Python3, this is less useful for `dict` (as it doesn't create a new list of values but simply iterates over them), but `Family` was not written in that era.",
    "created_at": "2022-08-16T01:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483222",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:90 mkoeppe]:
> Replying to [comment:89 tscrim]:
> > Replying to [comment:88 mkoeppe]:
> > > And, more importantly, nothing in the API uses key-value pairs, and hence no code that uses a `Family` can refer to key-values.

> > 
> > So this doesn't count:
> > 
> > ```
> > [(k, F[k]) for k in F.keys()]
> > ```

> 
> It's iterating over the keys. What's your point?


It has a very similar API to `dict` with an easy way to produce key-value pairs. With Python3, this is less useful for `dict` (as it doesn't create a new list of values but simply iterates over them), but `Family` was not written in that era.



---

archive/issue_comments_483223.json:
```json
{
    "body": "Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, \"is an abuse that we should document, but we have it because it is so convenient for the uses of this class?\"",
    "created_at": "2022-08-16T02:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483223",
    "user": "https://github.com/mkoeppe"
}
```

Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, "is an abuse that we should document, but we have it because it is so convenient for the uses of this class?"



---

archive/issue_comments_483224.json:
```json
{
    "body": "Replying to [comment:91 mkoeppe]:\n> Even with this ticket, a `Family` will continue to have `keys` and `__getitem__` methods in case this was unclear.\n\n\nThat's not the issue. You are at least strongly suggesting to change the behavior of `cardinality()` because it doesn't match the description you using as an object in `Sets`. So functionally it becomes no different than `ImageSubset` with an extra check on the defining map. Thus we should replace `Family` with `ImageSubset` (as a fa\u00e7ade parent) and equality checks with checking the map (which contains both the keys and the values). This not only is more complicated to use (and potentially slower), it also does not have the ability to define an infinite sequence indexed by some enumerated set.",
    "created_at": "2022-08-16T02:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483224",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:91 mkoeppe]:
> Even with this ticket, a `Family` will continue to have `keys` and `__getitem__` methods in case this was unclear.


That's not the issue. You are at least strongly suggesting to change the behavior of `cardinality()` because it doesn't match the description you using as an object in `Sets`. So functionally it becomes no different than `ImageSubset` with an extra check on the defining map. Thus we should replace `Family` with `ImageSubset` (as a façade parent) and equality checks with checking the map (which contains both the keys and the values). This not only is more complicated to use (and potentially slower), it also does not have the ability to define an infinite sequence indexed by some enumerated set.



---

archive/issue_comments_483225.json:
```json
{
    "body": "Replying to [comment:93 mkoeppe]:\n> Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, \"is an abuse that we should document, but we have it because it is so convenient for the uses of this class?\"\n\n\nIf it was an object in `Sets`, yes I would.",
    "created_at": "2022-08-16T02:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483225",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:93 mkoeppe]:
> Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, "is an abuse that we should document, but we have it because it is so convenient for the uses of this class?"


If it was an object in `Sets`, yes I would.



---

archive/issue_comments_483226.json:
```json
{
    "body": "But as a subclass of `collections.abc.Collection`, do you see an abuse?",
    "created_at": "2022-08-16T02:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483226",
    "user": "https://github.com/mkoeppe"
}
```

But as a subclass of `collections.abc.Collection`, do you see an abuse?



---

archive/issue_comments_483227.json:
```json
{
    "body": "That doesn't have anywhere near such precise definitions. All that is required is those methods are implemented. I don't think there is any consistency requirements. There are natural ones we impose, such as the length of the result of `__iter__` is the same as `__len__`, but note that both have to be implemented by the programmer.",
    "created_at": "2022-08-16T02:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483227",
    "user": "https://github.com/tscrim"
}
```

That doesn't have anywhere near such precise definitions. All that is required is those methods are implemented. I don't think there is any consistency requirements. There are natural ones we impose, such as the length of the result of `__iter__` is the same as `__len__`, but note that both have to be implemented by the programmer.



---

archive/issue_comments_483228.json:
```json
{
    "body": "Replying to [comment:94 tscrim]:\n> it also does not have the ability to define an infinite sequence indexed by some enumerated set.\n\n\nOh I see. You are concerned that you will not be able to iterate over `values()` any more and see duplicate elements that may be appearing in this use case?",
    "created_at": "2022-08-16T02:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483228",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:94 tscrim]:
> it also does not have the ability to define an infinite sequence indexed by some enumerated set.


Oh I see. You are concerned that you will not be able to iterate over `values()` any more and see duplicate elements that may be appearing in this use case?



---

archive/issue_comments_483229.json:
```json
{
    "body": "Replying to [comment:95 tscrim]:\n> Replying to [comment:93 mkoeppe]:\n> > Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, \"is an abuse that we should document, but we have it because it is so convenient for the uses of this class?\"\n\n> \n> If it was an object in `Sets`, yes I would.\n\n\nWhy precisely does it matter to you whether this question is asked about a parent in `Sets`?",
    "created_at": "2022-08-16T02:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483229",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:95 tscrim]:
> Replying to [comment:93 mkoeppe]:
> > Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, "is an abuse that we should document, but we have it because it is so convenient for the uses of this class?"

> 
> If it was an object in `Sets`, yes I would.


Why precisely does it matter to you whether this question is asked about a parent in `Sets`?



---

archive/issue_comments_483230.json:
```json
{
    "body": "Replying to [comment:98 mkoeppe]:\n> Replying to [comment:94 tscrim]:\n> > it also does not have the ability to define an infinite sequence indexed by some enumerated set.\n\n> \n> Oh I see. You are concerned that you will not be able to iterate over `values()` any more and see duplicate elements that may be appearing in this use case?\n\n\nYes, that would be the functionality that would be lost if we ended up replacing `Family` by `ImageSubset`.",
    "created_at": "2022-08-16T02:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483230",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:98 mkoeppe]:
> Replying to [comment:94 tscrim]:
> > it also does not have the ability to define an infinite sequence indexed by some enumerated set.

> 
> Oh I see. You are concerned that you will not be able to iterate over `values()` any more and see duplicate elements that may be appearing in this use case?


Yes, that would be the functionality that would be lost if we ended up replacing `Family` by `ImageSubset`.



---

archive/issue_comments_483231.json:
```json
{
    "body": "Replying to [comment:99 mkoeppe]:\n> Replying to [comment:95 tscrim]:\n> > Replying to [comment:93 mkoeppe]:\n> > > Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, \"is an abuse that we should document, but we have it because it is so convenient for the uses of this class?\"\n\n> > \n> > If it was an object in `Sets`, yes I would.\n\n> \n> Why precisely does it matter to you whether this question is asked about a parent in `Sets`?\n\n\nMy understand is this was the starting point for your argument for saying things are wrong: `Family` is in `Sets` but (its values are) not respecting the mathematical description.",
    "created_at": "2022-08-16T02:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483231",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:99 mkoeppe]:
> Replying to [comment:95 tscrim]:
> > Replying to [comment:93 mkoeppe]:
> > > Would you say that the behavior of `dict.__iter__` to iterate over keys, not key-value pairs, "is an abuse that we should document, but we have it because it is so convenient for the uses of this class?"

> > 
> > If it was an object in `Sets`, yes I would.

> 
> Why precisely does it matter to you whether this question is asked about a parent in `Sets`?


My understand is this was the starting point for your argument for saying things are wrong: `Family` is in `Sets` but (its values are) not respecting the mathematical description.



---

archive/issue_comments_483232.json:
```json
{
    "body": "Replying to [comment:100 tscrim]:\n> if we ended up replacing `Family` by `ImageSubset`.\n\n\nMy branch does not do this, why do you speculate about it?",
    "created_at": "2022-08-16T02:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483232",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:100 tscrim]:
> if we ended up replacing `Family` by `ImageSubset`.


My branch does not do this, why do you speculate about it?



---

archive/issue_comments_483233.json:
```json
{
    "body": "Replying to [comment:100 tscrim]:\n> Replying to [comment:98 mkoeppe]:\n> > Replying to [comment:94 tscrim]:\n> > > it also does not have the ability to define an infinite sequence indexed by some enumerated set.\n\n> > \n> > Oh I see. You are concerned that you will not be able to iterate over `values()` any more and see duplicate elements that may be appearing in this use case?\n\n> \n> Yes, that would be the functionality that would be lost\n\n\nOK then, I propose the following. I revert the changes to the `values()` method so that it is not an `ImageSubobject` as proposed but gives an iterable that runs parallel to `keys`. (I can also throw in an `items()` method.)\n\nThen there could be a separate method `as_set` that would return the `ImageSubobject`.",
    "created_at": "2022-08-16T02:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483233",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:100 tscrim]:
> Replying to [comment:98 mkoeppe]:
> > Replying to [comment:94 tscrim]:
> > > it also does not have the ability to define an infinite sequence indexed by some enumerated set.

> > 
> > Oh I see. You are concerned that you will not be able to iterate over `values()` any more and see duplicate elements that may be appearing in this use case?

> 
> Yes, that would be the functionality that would be lost


OK then, I propose the following. I revert the changes to the `values()` method so that it is not an `ImageSubobject` as proposed but gives an iterable that runs parallel to `keys`. (I can also throw in an `items()` method.)

Then there could be a separate method `as_set` that would return the `ImageSubobject`.



---

archive/issue_comments_483234.json:
```json
{
    "body": "But I would still do the change to `cardinality`. It is dictated by `__iter__` and `cardinality` as part of the `EnumeratedSets()` category. \n\n`cardinality` is clearly not needed for the use case of modeling infinite sequences or really anything that needs the key-value association.",
    "created_at": "2022-08-16T02:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483234",
    "user": "https://github.com/mkoeppe"
}
```

But I would still do the change to `cardinality`. It is dictated by `__iter__` and `cardinality` as part of the `EnumeratedSets()` category. 

`cardinality` is clearly not needed for the use case of modeling infinite sequences or really anything that needs the key-value association.



---

archive/issue_comments_483235.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T02:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483236.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T02:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483236",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483237.json:
```json
{
    "body": "Replying to [comment:102 mkoeppe]:\n> Replying to [comment:100 tscrim]:\n> > if we ended up replacing `Family` by `ImageSubset`.\n\n> \n> My branch does not do this, why do you speculate about it?\n\n\ncomment:94. As long as you say the `cardinality()` may be wrong or talk about the function being injective, this holds.",
    "created_at": "2022-08-16T03:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483237",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:102 mkoeppe]:
> Replying to [comment:100 tscrim]:
> > if we ended up replacing `Family` by `ImageSubset`.

> 
> My branch does not do this, why do you speculate about it?


comment:94. As long as you say the `cardinality()` may be wrong or talk about the function being injective, this holds.



---

archive/issue_comments_483238.json:
```json
{
    "body": "I think we are at least getting closer to a solution we are both content with. Thank you for discussing this with me.\n\nI am not sure I agree with keeping a reference to the result of `as_set`, much less have it be created on initialization of the `LazyFamily`. Why can't this construction just be done in `as_set()` (and make that an ``@`cached_method`)?\n\nI don't think the `_element_constructor_` will work. You also forgot to change the `values()` code from `items()`.\n\nI am not sure how I feel about the redirect with `__iter__`. I will need to profile this as I think we should make sure this is as fast as possible.",
    "created_at": "2022-08-16T03:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483238",
    "user": "https://github.com/tscrim"
}
```

I think we are at least getting closer to a solution we are both content with. Thank you for discussing this with me.

I am not sure I agree with keeping a reference to the result of `as_set`, much less have it be created on initialization of the `LazyFamily`. Why can't this construction just be done in `as_set()` (and make that an ``@`cached_method`)?

I don't think the `_element_constructor_` will work. You also forgot to change the `values()` code from `items()`.

I am not sure how I feel about the redirect with `__iter__`. I will need to profile this as I think we should make sure this is as fast as possible.



---

archive/issue_comments_483239.json:
```json
{
    "body": "Replying to [comment:108 tscrim]:\n> I am not sure I agree with keeping a reference to the result of `as_set`, much less have it be created on initialization of the `LazyFamily`. Why can't this construction just be done in `as_set()` (and make that an ``@`cached_method`)?\n\n\nIt allows me to delegate to the `ImageSubobject` methods.\nBut sure, the same thing could be done with cached_method.",
    "created_at": "2022-08-16T03:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483239",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:108 tscrim]:
> I am not sure I agree with keeping a reference to the result of `as_set`, much less have it be created on initialization of the `LazyFamily`. Why can't this construction just be done in `as_set()` (and make that an ``@`cached_method`)?


It allows me to delegate to the `ImageSubobject` methods.
But sure, the same thing could be done with cached_method.



---

archive/issue_comments_483240.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T03:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T03:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T03:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483243.json:
```json
{
    "body": "Replying to [comment:108 tscrim]:\n> I don't think the `_element_constructor_` will work.\n\n\nYes, this needs a bit more work in `ImageSubobject` so that the relevant case is handled",
    "created_at": "2022-08-16T03:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483243",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:108 tscrim]:
> I don't think the `_element_constructor_` will work.


Yes, this needs a bit more work in `ImageSubobject` so that the relevant case is handled



---

archive/issue_comments_483244.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T03:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483244",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483245.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T05:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483245",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483246.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T05:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483247.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T22:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483248.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-16T23:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-17T22:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483250.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2022-08-18T16:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483250",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_483251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T18:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T18:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T19:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483254.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T19:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483255.json:
```json
{
    "body": "Replying to [comment:108 tscrim]:\n> I think we are at least getting closer to a solution we are both content with. Thank you for discussing this with me.\n\n\nLikewise thanks for the discussion. It has helped clarify that the semantics needs to be documented not just by text but by defining an appropriate category. \n\nHere's an attempt for this, just two singleton categories `Families` and `EnumeratedFamilies`, though I have the feeling there should be a functorial construction",
    "created_at": "2022-08-18T20:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483255",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:108 tscrim]:
> I think we are at least getting closer to a solution we are both content with. Thank you for discussing this with me.


Likewise thanks for the discussion. It has helped clarify that the semantics needs to be documented not just by text but by defining an appropriate category. 

Here's an attempt for this, just two singleton categories `Families` and `EnumeratedFamilies`, though I have the feeling there should be a functorial construction



---

archive/issue_comments_483256.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T23:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483257.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-18T23:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_483258.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-18T23:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483258",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483259.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-19T00:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483259",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-19T00:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483260",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-19T05:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483261",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_089394.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34103#event-89394"
}
```



---

archive/issue_comments_483262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-09-17T16:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_483263.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-17T16:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483263",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483264.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-17T16:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483265.json:
```json
{
    "body": "```\nsage -t --random-seed=143738364655453723155583373959896127051 src/sage/combinat/root_system/type_G.py  # 1 doctest failed\nsage -t --random-seed=143738364655453723155583373959896127051 src/sage/sets/family.py  # 6 doctests failed\n```",
    "created_at": "2022-09-18T05:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34103#issuecomment-483265",
    "user": "https://github.com/mkoeppe"
}
```

```
sage -t --random-seed=143738364655453723155583373959896127051 src/sage/combinat/root_system/type_G.py  # 1 doctest failed
sage -t --random-seed=143738364655453723155583373959896127051 src/sage/sets/family.py  # 6 doctests failed
```
