# Issue 34809: Vizing edge coloring optimization

archive/issues_034572.json:
```json
{
    "assignees": [],
    "body": "This is an optimization of the existing edge_coloring algorithm for graphs, the implementation was discussed at https://groups.google.com/g/sage-devel/c/AzD3codkw2I\n\nKeywords: **graph coloring**\n\nBranch/Commit: **[public/graphs/34809_vizing](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/34809_vizing) @ [8f61d88](https://github.com/sagemath/sagetrac-mirror/commit/8f61d888a9d47807307d85fd45bf053bae32c002)**\n\nReviewer: **David Coudert**\n\nAuthor: **Matheus Maldonado**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34809_\n\n",
    "created_at": "2022-11-29T23:25:33Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Vizing edge coloring optimization",
    "type": "issue",
    "updated_at": "2023-01-08T08:42:14Z",
    "url": "https://github.com/sagemath/sage/issues/34809",
    "user": "https://github.com/mam15"
}
```
This is an optimization of the existing edge_coloring algorithm for graphs, the implementation was discussed at https://groups.google.com/g/sage-devel/c/AzD3codkw2I

Keywords: **graph coloring**

Branch/Commit: **[public/graphs/34809_vizing](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/34809_vizing) @ [8f61d88](https://github.com/sagemath/sagetrac-mirror/commit/8f61d888a9d47807307d85fd45bf053bae32c002)**

Reviewer: **David Coudert**

Author: **Matheus Maldonado**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/34809_





---

archive/issue_events_473963.json:
```json
{
    "actor": "https://github.com/mam15",
    "created_at": "2022-11-29T23:25:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34809#event-473963"
}
```



---

archive/issue_events_473964.json:
```json
{
    "actor": "https://github.com/mam15",
    "created_at": "2022-11-29T23:25:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34809#event-473964"
}
```



---

archive/issue_events_473965.json:
```json
{
    "actor": "https://github.com/mam15",
    "created_at": "2022-11-29T23:25:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34809#event-473965"
}
```



---

archive/issue_events_473966.json:
```json
{
    "actor": "https://github.com/mam15",
    "created_at": "2022-11-29T23:25:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34809#event-473966"
}
```



---

archive/issue_comments_561364.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIt is not a good idea to change the label of edges inside the method. This main erase other data. Consider using an external dictionary.",
    "created_at": "2022-11-30T09:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561364",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:1" align="right">comment:1</div>

It is not a good idea to change the label of edges inside the method. This main erase other data. Consider using an external dictionary.



---

archive/issue_comments_561365.json:
```json
{
    "body": "Changed commit from **[2ba8294](https://github.com/sagemath/sagetrac-mirror/commit/2ba8294ef10bf6e75aed219e5902c7436dfe62ec)** to **[2435f49](https://github.com/sagemath/sagetrac-mirror/commit/2435f49cd8ebd0f7b1df13775a25baddac1bdfcc)**",
    "created_at": "2022-11-30T19:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561365",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2ba8294](https://github.com/sagemath/sagetrac-mirror/commit/2ba8294ef10bf6e75aed219e5902c7436dfe62ec)** to **[2435f49](https://github.com/sagemath/sagetrac-mirror/commit/2435f49cd8ebd0f7b1df13775a25baddac1bdfcc)**



---

archive/issue_comments_561366.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2435f49cd8ebd0f7b1df13775a25baddac1bdfcc\">2435f49</a></td><td><code>Using external dict instead of graph labels</code></td></tr></table>\n",
    "created_at": "2022-11-30T19:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561366",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2435f49cd8ebd0f7b1df13775a25baddac1bdfcc">2435f49</a></td><td><code>Using external dict instead of graph labels</code></td></tr></table>




---

archive/issue_comments_561367.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nShould be good now. I thought g = copy(g) would be enough but using another dict is much cleaner.",
    "created_at": "2022-11-30T21:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561367",
    "user": "https://github.com/mam15"
}
```

<div id="comment:3" align="right">comment:3</div>

Should be good now. I thought g = copy(g) would be enough but using another dict is much cleaner.



---

archive/issue_comments_561368.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nYou should use `frozenset(e)` instead of `tuple(sorted(e))`. \n\nAlso, can you push the branch in something like `public/graphs/34809_vizing` to allow me to push review commits. It shall ease the reviewing process.",
    "created_at": "2022-12-01T07:32:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561368",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:4" align="right">comment:4</div>

You should use `frozenset(e)` instead of `tuple(sorted(e))`. 

Also, can you push the branch in something like `public/graphs/34809_vizing` to allow me to push review commits. It shall ease the reviewing process.



---

archive/issue_comments_561369.json:
```json
{
    "body": "Changed branch from **[u/gh-mam15/vizing_edge_coloring](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mam15/vizing_edge_coloring)** to **[public/graphs/34809_vizing](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/34809_vizing)**",
    "created_at": "2022-12-01T15:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561369",
    "user": "https://github.com/mam15"
}
```

Changed branch from **[u/gh-mam15/vizing_edge_coloring](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mam15/vizing_edge_coloring)** to **[public/graphs/34809_vizing](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/34809_vizing)**



---

archive/issue_comments_561370.json:
```json
{
    "body": "Changed commit from **[2435f49](https://github.com/sagemath/sagetrac-mirror/commit/2435f49cd8ebd0f7b1df13775a25baddac1bdfcc)** to **[ef6b784](https://github.com/sagemath/sagetrac-mirror/commit/ef6b784f72255be2c1279210040661ac8e22836e)**",
    "created_at": "2022-12-02T15:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561370",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2435f49](https://github.com/sagemath/sagetrac-mirror/commit/2435f49cd8ebd0f7b1df13775a25baddac1bdfcc)** to **[ef6b784](https://github.com/sagemath/sagetrac-mirror/commit/ef6b784f72255be2c1279210040661ac8e22836e)**



---

archive/issue_comments_561371.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef6b784f72255be2c1279210040661ac8e22836e\">ef6b784</a></td><td><code>trac 34809: serious review commit</code></td></tr></table>\n",
    "created_at": "2022-12-02T15:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561371",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef6b784f72255be2c1279210040661ac8e22836e">ef6b784</a></td><td><code>trac 34809: serious review commit</code></td></tr></table>




---

archive/issue_comments_561372.json:
```json
{
    "body": "Changed commit from **[ef6b784](https://github.com/sagemath/sagetrac-mirror/commit/ef6b784f72255be2c1279210040661ac8e22836e)** to **[d9a1684](https://github.com/sagemath/sagetrac-mirror/commit/d9a16849b63ea4e2782bb8ce7c396d97548bb28f)**",
    "created_at": "2022-12-02T15:42:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561372",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ef6b784](https://github.com/sagemath/sagetrac-mirror/commit/ef6b784f72255be2c1279210040661ac8e22836e)** to **[d9a1684](https://github.com/sagemath/sagetrac-mirror/commit/d9a16849b63ea4e2782bb8ce7c396d97548bb28f)**



---

archive/issue_comments_561373.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9a16849b63ea4e2782bb8ce7c396d97548bb28f\">d9a1684</a></td><td><code>trac 34809: style</code></td></tr></table>\n",
    "created_at": "2022-12-02T15:42:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561373",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9a16849b63ea4e2782bb8ce7c396d97548bb28f">d9a1684</a></td><td><code>trac 34809: style</code></td></tr></table>




---

archive/issue_comments_561374.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI did multiple corrections and small improvements(avoid recursive calls, avoid searching in lists, etc.). I have also strengthen the doctests to avoid issues due too small changes. Please do many tests to check if its correct.",
    "created_at": "2022-12-02T15:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561374",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:8" align="right">comment:8</div>

I did multiple corrections and small improvements(avoid recursive calls, avoid searching in lists, etc.). I have also strengthen the doctests to avoid issues due too small changes. Please do many tests to check if its correct.



---

archive/issue_comments_561375.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c07e48e2ddf8eeb341f35e4af050d8c57c0fc38f\">c07e48e</a></td><td><code>Test case for random graphs</code></td></tr></table>\n",
    "created_at": "2022-12-03T06:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561375",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c07e48e2ddf8eeb341f35e4af050d8c57c0fc38f">c07e48e</a></td><td><code>Test case for random graphs</code></td></tr></table>




---

archive/issue_comments_561376.json:
```json
{
    "body": "Changed commit from **[d9a1684](https://github.com/sagemath/sagetrac-mirror/commit/d9a16849b63ea4e2782bb8ce7c396d97548bb28f)** to **[c07e48e](https://github.com/sagemath/sagetrac-mirror/commit/c07e48e2ddf8eeb341f35e4af050d8c57c0fc38f)**",
    "created_at": "2022-12-03T06:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561376",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d9a1684](https://github.com/sagemath/sagetrac-mirror/commit/d9a16849b63ea4e2782bb8ce7c396d97548bb28f)** to **[c07e48e](https://github.com/sagemath/sagetrac-mirror/commit/c07e48e2ddf8eeb341f35e4af050d8c57c0fc38f)**



---

archive/issue_comments_561377.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI couldn't really think of anything the example you created didn't cover, so I ended up testing that example on random graphs, the only difference is I test for len(colors) == Delta or Delta+1.",
    "created_at": "2022-12-03T06:04:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561377",
    "user": "https://github.com/mam15"
}
```

<div id="comment:10" align="right">comment:10</div>

I couldn't really think of anything the example you created didn't cover, so I ended up testing that example on random graphs, the only difference is I test for len(colors) == Delta or Delta+1.



---

archive/issue_comments_561378.json:
```json
{
    "body": "Changed commit from **[c07e48e](https://github.com/sagemath/sagetrac-mirror/commit/c07e48e2ddf8eeb341f35e4af050d8c57c0fc38f)** to **[e1382c7](https://github.com/sagemath/sagetrac-mirror/commit/e1382c7bbe782f9753bdcc726e720e95393d9725)**",
    "created_at": "2022-12-03T10:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561378",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c07e48e](https://github.com/sagemath/sagetrac-mirror/commit/c07e48e2ddf8eeb341f35e4af050d8c57c0fc38f)** to **[e1382c7](https://github.com/sagemath/sagetrac-mirror/commit/e1382c7bbe782f9753bdcc726e720e95393d9725)**



---

archive/issue_comments_561379.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1382c7bbe782f9753bdcc726e720e95393d9725\">e1382c7</a></td><td><code>trac #34809: smaller doctest on random graphs</code></td></tr></table>\n",
    "created_at": "2022-12-03T10:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561379",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1382c7bbe782f9753bdcc726e720e95393d9725">e1382c7</a></td><td><code>trac #34809: smaller doctest on random graphs</code></td></tr></table>




---

archive/issue_events_473967.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-12-03T10:11:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34809#event-473967"
}
```



---

archive/issue_comments_561380.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2022-12-03T10:11:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561380",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_561381.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI changed the doctest to something smaller / faster.\n\nDo you have other improvements for this method ?",
    "created_at": "2022-12-03T10:11:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561381",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:12" align="right">comment:12</div>

I changed the doctest to something smaller / faster.

Do you have other improvements for this method ?



---

archive/issue_comments_561382.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNot really for the time being, my focus was the ```O(|E||V|)``` algorithm",
    "created_at": "2022-12-03T18:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561382",
    "user": "https://github.com/mam15"
}
```

<div id="comment:13" align="right">comment:13</div>

Not really for the time being, my focus was the ```O(|E||V|)``` algorithm



---

archive/issue_comments_561383.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThere is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.\n\n```\nsage: from sage.graphs.graph_coloring import edge_coloring\nsage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)\nsage: edge_coloring(G, value_only=True, vizing=False)\n4\nsage: len(edge_coloring(G, value_only=False, vizing=False))\n5\n```\n\nAlso, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).",
    "created_at": "2022-12-04T09:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561383",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:14" align="right">comment:14</div>

There is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.

```
sage: from sage.graphs.graph_coloring import edge_coloring
sage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)
sage: edge_coloring(G, value_only=True, vizing=False)
4
sage: len(edge_coloring(G, value_only=False, vizing=False))
5
```

Also, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).



---

archive/issue_comments_561384.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI have a few minor comments/suggestions.\n\n1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?\n\nActually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.\n\n2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.\n\nI can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.\n\n3) The docstring's phrase \"This may result in either a `\\Delta`-edge-coloring or a `Delta + 1`-edge-coloring\" is very unclear.  I think the usual definition of \"k-coloring\" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term \"`\\Delta`-edge-coloring\", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.\n\n(Also, I think parentheses are necessary around \"`Delta + 1`\", and I think there is a typo: \"\\Delta\" is missing its backslash in \"`Delta + 1`-edge-coloring\".)\n\n4) Please add a reference to this trac ticket in a docstring or comment.",
    "created_at": "2022-12-04T18:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561384",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:15" align="right">comment:15</div>

I have a few minor comments/suggestions.

1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?

Actually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.

2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.

I can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.

3) The docstring's phrase "This may result in either a `\Delta`-edge-coloring or a `Delta + 1`-edge-coloring" is very unclear.  I think the usual definition of "k-coloring" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term "`\Delta`-edge-coloring", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.

(Also, I think parentheses are necessary around "`Delta + 1`", and I think there is a typo: "\Delta" is missing its backslash in "`Delta + 1`-edge-coloring".)

4) Please add a reference to this trac ticket in a docstring or comment.



---

archive/issue_comments_561385.json:
```json
{
    "body": "Changed commit from **[e1382c7](https://github.com/sagemath/sagetrac-mirror/commit/e1382c7bbe782f9753bdcc726e720e95393d9725)** to **[bb35295](https://github.com/sagemath/sagetrac-mirror/commit/bb35295eb69eb0cb621af65da7e73752df32611a)**",
    "created_at": "2022-12-04T23:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561385",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e1382c7](https://github.com/sagemath/sagetrac-mirror/commit/e1382c7bbe782f9753bdcc726e720e95393d9725)** to **[bb35295](https://github.com/sagemath/sagetrac-mirror/commit/bb35295eb69eb0cb621af65da7e73752df32611a)**



---

archive/issue_comments_561386.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb35295eb69eb0cb621af65da7e73752df32611a\">bb35295</a></td><td><code>Docstring typos and clarity + algorith fixes</code></td></tr></table>\n",
    "created_at": "2022-12-04T23:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561386",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb35295eb69eb0cb621af65da7e73752df32611a">bb35295</a></td><td><code>Docstring typos and clarity + algorith fixes</code></td></tr></table>




---

archive/issue_comments_561387.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [David Coudert](#comment:14):\n> There is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.\n> \n> ```\n> sage: from sage.graphs.graph_coloring import edge_coloring\n> sage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)\n> sage: edge_coloring(G, value_only=True, vizing=False)\n> 4\n> sage: len(edge_coloring(G, value_only=False, vizing=False))\n> 5\n> ```\n> \n> Also, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).\n\nShould be fixed now\n\nReplying to [Dave Morris](#comment:15):\n> I have a few minor comments/suggestions.\n> \n> 1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?\n> \n> Actually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.\n> \n> 2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.\n> \n> I can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.\n> \n\nThis can be fixed by adding a new color class with a random edge if a coloring with Delta colors is found, not sure if it's the best solution though. Please let me know if you have any other idea or if we should just start a discussion on sage-devel about the deprecation of this function.\n\n> 3) The docstring's phrase \"This may result in either a `\\Delta`-edge-coloring or a `Delta + 1`-edge-coloring\" is very unclear.  I think the usual definition of \"k-coloring\" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term \"`\\Delta`-edge-coloring\", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.\n> \n> (Also, I think parentheses are necessary around \"`Delta + 1`\", and I think there is a typo: \"\\Delta\" is missing its backslash in \"`Delta + 1`-edge-coloring\".)\n> \n> 4) Please add a reference to this trac ticket in a docstring or comment.\n\nAdded all your suggestions.",
    "created_at": "2022-12-04T23:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561387",
    "user": "https://github.com/mam15"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [David Coudert](#comment:14):
> There is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.
> 
> ```
> sage: from sage.graphs.graph_coloring import edge_coloring
> sage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)
> sage: edge_coloring(G, value_only=True, vizing=False)
> 4
> sage: len(edge_coloring(G, value_only=False, vizing=False))
> 5
> ```
> 
> Also, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).

Should be fixed now

Replying to [Dave Morris](#comment:15):
> I have a few minor comments/suggestions.
> 
> 1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?
> 
> Actually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.
> 
> 2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.
> 
> I can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.
> 

This can be fixed by adding a new color class with a random edge if a coloring with Delta colors is found, not sure if it's the best solution though. Please let me know if you have any other idea or if we should just start a discussion on sage-devel about the deprecation of this function.

> 3) The docstring's phrase "This may result in either a `\Delta`-edge-coloring or a `Delta + 1`-edge-coloring" is very unclear.  I think the usual definition of "k-coloring" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term "`\Delta`-edge-coloring", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.
> 
> (Also, I think parentheses are necessary around "`Delta + 1`", and I think there is a typo: "\Delta" is missing its backslash in "`Delta + 1`-edge-coloring".)
> 
> 4) Please add a reference to this trac ticket in a docstring or comment.

Added all your suggestions.



---

archive/issue_comments_561388.json:
```json
{
    "body": "Changed commit from **[bb35295](https://github.com/sagemath/sagetrac-mirror/commit/bb35295eb69eb0cb621af65da7e73752df32611a)** to **[e662f1c](https://github.com/sagemath/sagetrac-mirror/commit/e662f1c82af5c6437671628d2a1c9f2b55be40be)**",
    "created_at": "2022-12-05T10:56:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561388",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bb35295](https://github.com/sagemath/sagetrac-mirror/commit/bb35295eb69eb0cb621af65da7e73752df32611a)** to **[e662f1c](https://github.com/sagemath/sagetrac-mirror/commit/e662f1c82af5c6437671628d2a1c9f2b55be40be)**



---

archive/issue_comments_561389.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e662f1c82af5c6437671628d2a1c9f2b55be40be\">e662f1c</a></td><td><code>trac #34809: avoid some code duplication</code></td></tr></table>\n",
    "created_at": "2022-12-05T10:56:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561389",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e662f1c82af5c6437671628d2a1c9f2b55be40be">e662f1c</a></td><td><code>trac #34809: avoid some code duplication</code></td></tr></table>




---

archive/issue_comments_561390.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI added an internal function to avoir some code duplication. I also make sure that chi is updated.\n\nSeveral points raised by Dave must be addressed. I agree that Vizing should return a `Delta + 1` coloring, even if the last color is an empty set (e.g., for the star graph which requires only `Delta` colors).",
    "created_at": "2022-12-05T10:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561390",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:19" align="right">comment:19</div>

I added an internal function to avoir some code duplication. I also make sure that chi is updated.

Several points raised by Dave must be addressed. I agree that Vizing should return a `Delta + 1` coloring, even if the last color is an empty set (e.g., for the star graph which requires only `Delta` colors).



---

archive/issue_comments_561391.json:
```json
{
    "body": "Changed commit from **[e662f1c](https://github.com/sagemath/sagetrac-mirror/commit/e662f1c82af5c6437671628d2a1c9f2b55be40be)** to **[5a11c8b](https://github.com/sagemath/sagetrac-mirror/commit/5a11c8b7896db5c246971d59818d1d001705cab2)**",
    "created_at": "2022-12-06T23:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561391",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e662f1c](https://github.com/sagemath/sagetrac-mirror/commit/e662f1c82af5c6437671628d2a1c9f2b55be40be)** to **[5a11c8b](https://github.com/sagemath/sagetrac-mirror/commit/5a11c8b7896db5c246971d59818d1d001705cab2)**



---

archive/issue_comments_561392.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a11c8b7896db5c246971d59818d1d001705cab2\">5a11c8b</a></td><td><code>trac #34809: backward compat for vizing=True</code></td></tr></table>\n",
    "created_at": "2022-12-06T23:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561392",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a11c8b7896db5c246971d59818d1d001705cab2">5a11c8b</a></td><td><code>trac #34809: backward compat for vizing=True</code></td></tr></table>




---

archive/issue_comments_561393.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think everything should be up to standard now, please let me know if I missed anything",
    "created_at": "2022-12-06T23:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561393",
    "user": "https://github.com/mam15"
}
```

<div id="comment:21" align="right">comment:21</div>

I think everything should be up to standard now, please let me know if I missed anything



---

archive/issue_comments_561394.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe is still some ambiguity in the description of the case `vizing == True`. The method should return a coloring using `Delta+ 1` colors, even if some colors are empty.",
    "created_at": "2022-12-10T13:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561394",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:22" align="right">comment:22</div>

The is still some ambiguity in the description of the case `vizing == True`. The method should return a coloring using `Delta+ 1` colors, even if some colors are empty.



---

archive/issue_comments_561395.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a68435adb51e7a7fee427ff943e0fa4121d88104\">a68435a</a></td><td><code>trac #34809: fixing vizing=True in docs</code></td></tr></table>\n",
    "created_at": "2022-12-12T00:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561395",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a68435adb51e7a7fee427ff943e0fa4121d88104">a68435a</a></td><td><code>trac #34809: fixing vizing=True in docs</code></td></tr></table>




---

archive/issue_comments_561396.json:
```json
{
    "body": "Changed commit from **[5a11c8b](https://github.com/sagemath/sagetrac-mirror/commit/5a11c8b7896db5c246971d59818d1d001705cab2)** to **[a68435a](https://github.com/sagemath/sagetrac-mirror/commit/a68435adb51e7a7fee427ff943e0fa4121d88104)**",
    "created_at": "2022-12-12T00:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561396",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5a11c8b](https://github.com/sagemath/sagetrac-mirror/commit/5a11c8b7896db5c246971d59818d1d001705cab2)** to **[a68435a](https://github.com/sagemath/sagetrac-mirror/commit/a68435adb51e7a7fee427ff943e0fa4121d88104)**



---

archive/issue_comments_561397.json:
```json
{
    "body": "Changed commit from **[a68435a](https://github.com/sagemath/sagetrac-mirror/commit/a68435adb51e7a7fee427ff943e0fa4121d88104)** to **[8f61d88](https://github.com/sagemath/sagetrac-mirror/commit/8f61d888a9d47807307d85fd45bf053bae32c002)**",
    "created_at": "2022-12-12T00:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561397",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a68435a](https://github.com/sagemath/sagetrac-mirror/commit/a68435adb51e7a7fee427ff943e0fa4121d88104)** to **[8f61d88](https://github.com/sagemath/sagetrac-mirror/commit/8f61d888a9d47807307d85fd45bf053bae32c002)**



---

archive/issue_comments_561398.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f61d888a9d47807307d85fd45bf053bae32c002\">8f61d88</a></td><td><code>trac #34809: rewriting vizing=True for clarity</code></td></tr></table>\n",
    "created_at": "2022-12-12T00:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561398",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f61d888a9d47807307d85fd45bf053bae32c002">8f61d88</a></td><td><code>trac #34809: rewriting vizing=True for clarity</code></td></tr></table>




---

archive/issue_comments_561399.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n`@`Dave, do you agree with the proposed changes ? If so we can conclude the review of this ticket.",
    "created_at": "2023-01-08T08:42:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34809#issuecomment-561399",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:25" align="right">comment:25</div>

`@`Dave, do you agree with the proposed changes ? If so we can conclude the review of this ticket.
