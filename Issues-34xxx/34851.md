# Issue 34851: Upgrade singular to 4.3.1p3

archive/issues_034614.json:
```json
{
    "body": "https://groups.google.com/g/sage-devel/c/0EkgkDgMnYE/m/LFW_ZM-LAAAJ\n\n\n\nCC:  @antonio-rojas @videlec @behackl @kiwifb\n\nBranch: u/arojas/upgrade_singular_to_4_3_1p3\n\nStatus: new\n\nCommit: 267177af61d742d1571c28c49b9660720173cba7\n\nIssue created by migration from https://trac.sagemath.org/ticket/34851\n\n",
    "created_at": "2022-12-14T20:28:09Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Upgrade singular to 4.3.1p3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34851",
    "user": "https://github.com/mkoeppe"
}
```
https://groups.google.com/g/sage-devel/c/0EkgkDgMnYE/m/LFW_ZM-LAAAJ



CC:  @antonio-rojas @videlec @behackl @kiwifb

Branch: u/arojas/upgrade_singular_to_4_3_1p3

Status: new

Commit: 267177af61d742d1571c28c49b9660720173cba7

Issue created by migration from https://trac.sagemath.org/ticket/34851





---

archive/issue_comments_683598.json:
```json
{
    "body": "<a id='comment:1'></a>\nAPI change in Singular https://github.com/Singular/Singular/commit/5cc997784cbce4c118fa8bc8c2a902459d4068d4\n\nThe patch in https://github.com/archlinux/svntogit-community/blob/packages/sagemath/trunk/sagemath-singular-4.3.1.p3.patch changes use of `pTakeOutComp1` to `pTakeOutComp`. \nBut the 2-argument call of `pTakeOutComp` is marked as \n\"This is something weird -- Don't use it, unless you know what you are doing\" https://github.com/Singular/Singular/commit/5cc997784cbce4c118fa8bc8c2a902459d4068d4#diff-a690828b6277677d330d60ef57a926af0e7df24683f0ad94da92c9f0a7819ab0R344",
    "created_at": "2022-12-15T02:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683598",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
API change in Singular https://github.com/Singular/Singular/commit/5cc997784cbce4c118fa8bc8c2a902459d4068d4

The patch in https://github.com/archlinux/svntogit-community/blob/packages/sagemath/trunk/sagemath-singular-4.3.1.p3.patch changes use of `pTakeOutComp1` to `pTakeOutComp`. 
But the 2-argument call of `pTakeOutComp` is marked as 
"This is something weird -- Don't use it, unless you know what you are doing" https://github.com/Singular/Singular/commit/5cc997784cbce4c118fa8bc8c2a902459d4068d4#diff-a690828b6277677d330d60ef57a926af0e7df24683f0ad94da92c9f0a7819ab0R344



---

archive/issue_comments_683599.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/upgrade_singular_to_4_3_1p3\"",
    "created_at": "2022-12-15T02:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683599",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/upgrade_singular_to_4_3_1p3"



---

archive/issue_comments_683600.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                                                                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|\n|[42342b9](https://github.com/sagemath/sagetrac-mirror/commit/42342b90043cd7cd493f294e99e98e892850f883)|`Apply https://github.com/archlinux/svntogit-community/blob/packages/sagemath/trunk/sagemath-singular-4.3.1.p3.patch`|",
    "created_at": "2022-12-15T08:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683600",
    "user": "https://github.com/behackl"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|
|[42342b9](https://github.com/sagemath/sagetrac-mirror/commit/42342b90043cd7cd493f294e99e98e892850f883)|`Apply https://github.com/archlinux/svntogit-community/blob/packages/sagemath/trunk/sagemath-singular-4.3.1.p3.patch`|



---

archive/issue_comments_683601.json:
```json
{
    "body": "Changing commit from \"\" to \"42342b90043cd7cd493f294e99e98e892850f883\"",
    "created_at": "2022-12-15T08:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683601",
    "user": "https://github.com/behackl"
}
```

Changing commit from "" to "42342b90043cd7cd493f294e99e98e892850f883"



---

archive/issue_comments_683602.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/upgrade_singular_to_4_3_1p3\" to \"u/arojas/upgrade_singular_to_4_3_1p3\"",
    "created_at": "2022-12-20T17:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683602",
    "user": "https://github.com/antonio-rojas"
}
```

Changing branch from "u/mkoeppe/upgrade_singular_to_4_3_1p3" to "u/arojas/upgrade_singular_to_4_3_1p3"



---

archive/issue_comments_683603.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------|\n|[267177a](https://github.com/sagemath/sagetrac-mirror/commit/267177af61d742d1571c28c49b9660720173cba7)|`Fix one more test`|",
    "created_at": "2022-12-20T17:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------|
|[267177a](https://github.com/sagemath/sagetrac-mirror/commit/267177af61d742d1571c28c49b9660720173cba7)|`Fix one more test`|



---

archive/issue_comments_683604.json:
```json
{
    "body": "Changing commit from \"42342b90043cd7cd493f294e99e98e892850f883\" to \"267177af61d742d1571c28c49b9660720173cba7\"",
    "created_at": "2022-12-20T17:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683604",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "42342b90043cd7cd493f294e99e98e892850f883" to "267177af61d742d1571c28c49b9660720173cba7"



---

archive/issue_comments_683605.json:
```json
{
    "body": "<a id='comment:6'></a>\n`lift` seems to be broken\n\n```\nsage -t --long --random-seed=299698150490166540162136571885065553921 src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 4490, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift\nFailed example:\n    M\nExpected:\n    [y^7, x^7*y^2 + x^8 + x^5*y^3 + x^6*y + x^3*y^4 + x^4*y^2 + x*y^5 + x^2*y^3 + y^4]\nGot:\n    [y^7, 0]\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 4492, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift\nFailed example:\n    sum( map( mul , zip( M, I.gens() ) ) ) == f\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 4500, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift\nFailed example:\n    f.lift(I)\nExpected:\n    [1, x2]\nGot:\n    [1, 0]\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 4506, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift\nFailed example:\n    f.lift(I)\nExpected:\n    [1, x2]\nGot:\n    [1, 0]\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 4637, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.reduce\nFailed example:\n    f.reduce([2*x,y])\nExpected:\n    3*x\nGot:\n    x\n**********************************************************************\n2 items had failures:\n   4 of  18 in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift\n   1 of  22 in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.reduce\n    [1197 tests, 5 failures, 1.11 s]\n```\nand there are also many failures in `asymptotics`\n\n```\nsage -t --long --random-seed=241071912408585997575727450771429802043 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 123, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions\nFailed example:\n    decomp =  F.asymptotic_decomposition(alpha); decomp\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[48]>\", line 1, in <module>\n        decomp =  F.asymptotic_decomposition(alpha); decomp\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1502, in asymptotic_decomposition\n        decomp2.extend(ff.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1422, in cohomology_decomposition\n        decomp.extend(r.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1422, in cohomology_decomposition\n        decomp.extend(r.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1425, in cohomology_decomposition\n        return decomp._combine_like_terms_().whole_and_parts()\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 3495, in whole_and_parts\n        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here\n    UnboundLocalError: local variable 'r' referenced before assignment\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 130, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions\nFailed example:\n    F1.asymptotics(p, alpha, 2)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[50]>\", line 1, in <module>\n        F1.asymptotics(p, alpha, Integer(2))\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1636, in asymptotics\n        p = coerce_point(R, p)\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4238, in coerce_point\n        return {x: p[SR(x)] for x in R.gens()}\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4238, in <dictcomp>\n        return {x: p[SR(x)] for x in R.gens()}\n    KeyError: x\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 134, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions\nFailed example:\n    decomp =  F.asymptotic_decomposition(alpha)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[52]>\", line 1, in <module>\n        decomp =  F.asymptotic_decomposition(alpha)\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1502, in asymptotic_decomposition\n        decomp2.extend(ff.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1422, in cohomology_decomposition\n        decomp.extend(r.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1422, in cohomology_decomposition\n        decomp.extend(r.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1425, in cohomology_decomposition\n        return decomp._combine_like_terms_().whole_and_parts()\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 3495, in whole_and_parts\n        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here\n    UnboundLocalError: local variable 'r' referenced before assignment\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 136, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions\nFailed example:\n    asy = F1.asymptotics(p, alpha, 2)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[54]>\", line 1, in <module>\n        asy = F1.asymptotics(p, alpha, Integer(2))\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1636, in asymptotics\n        p = coerce_point(R, p)\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4238, in coerce_point\n        return {x: p[SR(x)] for x in R.gens()}\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4238, in <dictcomp>\n        return {x: p[SR(x)] for x in R.gens()}\n    KeyError: x\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 137, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions\nFailed example:\n    asy\nExpected:\n    (3*(10*r^2 - 7*r - 3)*2187^r, 2187, 30*r^2 - 21*r - 9)\nGot:\n    (1/24*2^(2/3)*(sqrt(3) + 4/(sqrt(3) + I) + I)*gamma(1/3)/(pi*r^(1/3)),\n     1,\n     1/24*2^(2/3)*(sqrt(3) + 4/(sqrt(3) + I) + I)*gamma(1/3)/(pi*r^(1/3)))\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 139, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions\nFailed example:\n    F.relative_error(asy[0], alpha, [1, 2, 4, 8], asy[1])\nExpected:\n    [((4, 3), 30.72702332, [0.0000000000], [1.000000000]),\n     ((8, 6), 111.9315678, [69.00000000], [0.3835519207]),\n     ((16, 12), 442.7813138, [387.0000000], [0.1259793763]),\n     ((32, 24), 1799.879232, [1743.000000], [0.03160169385])]\nGot:\n    [((4, 3),\n      67200.00000,\n      [0.1953794675 - 8.207453952e-13*I],\n      [0.9999970926 + 1.221347314e-17*I]),\n     ((8, 6),\n      5.353652190e8,\n      [0.1550727862 - 6.514260518e-13*I],\n      [0.9999999997 + 1.216788145e-21*I]),\n     ((16, 12),\n      1.012941622e16,\n      [0.1230813519 - 5.170372000e-13*I],\n      [1.000000000 + 5.104313900e-29*I]),\n     ((32, 24),\n      9.419625360e29,\n      [0.09768973377 - 4.103726976e-13*I],\n      [1.000000000 + 4.356571327e-43*I])]\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 860, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_certificate\nFailed example:\n    L\nExpected:\n    [y^2, -x*y + 1]\nGot:\n    [y^2, 0]\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 863, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_certificate\nFailed example:\n    sum(L[i]*df[i][0]**df[i][1] for i in range(len(df))) == 1\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 921, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition\nFailed example:\n    decomp\nExpected:\n    (0, []) + (1, [(x, 1)]) + (-y, [(x*y + 1, 1)])\nGot:\n    (0, []) + (-y, [(x*y + 1, 1)])\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 923, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition\nFailed example:\n    decomp.sum().quotient() == f\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 925, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition\nFailed example:\n    [r.nullstellensatz_certificate() is None for r in decomp]\nExpected:\n    [True, True, True]\nGot:\n    [True, True]\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 936, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition\nFailed example:\n    decomp\nExpected:\n    (0, []) + (sin(y), [(x, 1)]) + (-y*sin(y), [(x*y + 1, 1)])\nGot:\n    (0, []) + (-y*sin(y), [(x*y + 1, 1)])\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 938, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition\nFailed example:\n    bool(decomp.sum().quotient() == G/H)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 940, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition\nFailed example:\n    [r.nullstellensatz_certificate() is None for r in decomp]\nExpected:\n    [True, True, True]\nGot:\n    [True, True]\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1234, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition\nFailed example:\n    decomp\nExpected:\n    (0, []) + (1, [(x*y + 1, 1)]) + (x + y, [(y, 1), (x, 1)])\nGot:\n    (-x^2 - x*y - x, []) + (x, [(x*y + 1, 1)])\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1236, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition\nFailed example:\n    decomp.sum().quotient() == f\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1254, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition\nFailed example:\n    decomp\nExpected:\n    (0, []) +\n    (-(x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x)*y, [(y, 1)]) +\n    ((x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x)*x*y, [(x*y + 1, 1)]) +\n    (x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x, [(y, 1), (x, 1)])\nGot:\n    (0, []) + (-(x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x)*x, [(x*y + 1, 1)])\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1259, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition\nFailed example:\n    bool(decomp.sum().quotient() == f)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1335, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition\nFailed example:\n    FFPD(1, [(x, 1), (y, 2)]).cohomology_decomposition()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition[8]>\", line 1, in <module>\n        FFPD(Integer(1), [(x, Integer(1)), (y, Integer(2))]).cohomology_decomposition()\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1422, in cohomology_decomposition\n        decomp.extend(r.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1425, in cohomology_decomposition\n        return decomp._combine_like_terms_().whole_and_parts()\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 3495, in whole_and_parts\n        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here\n    UnboundLocalError: local variable 'r' referenced before assignment\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1343, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition\nFailed example:\n    f.cohomology_decomposition()\nExpected:\n    (0, []) + (-4/3*x*y, [(x^2 + y^2 - 1, 1)]) +\n    (1/3, [(x*y - 1, 1), (x^2 + y^2 - 1, 1)])\nGot:\n    (0, []) + (-2/3*x^2 + 4/3*x*y + 4/3, [(x^2 + y^2 - 1, 1)]) + (-1/3*x^2 + 1/6, [(x*y - 1, 1), (x^2 + y^2 - 1, 1)])\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1474, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.asymptotic_decomposition\nFailed example:\n    F.asymptotic_decomposition(alpha)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.asymptotic_decomposition[14]>\", line 1, in <module>\n        F.asymptotic_decomposition(alpha)\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1502, in asymptotic_decomposition\n        decomp2.extend(ff.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1422, in cohomology_decomposition\n        decomp.extend(r.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1425, in cohomology_decomposition\n        return decomp._combine_like_terms_().whole_and_parts()\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 3495, in whole_and_parts\n        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here\n    UnboundLocalError: local variable 'r' referenced before assignment\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1580, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\nFailed example:\n    decomp = F.asymptotic_decomposition(alpha); decomp\nExpected:\n    (0, []) + (... - 1/2, [(x*y + x + y - 1, 1)])\nGot:\n    (0, []) + (-1/2, [(x*y + x + y - 1, 1)])\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1589, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\nFailed example:\n    asy\nExpected:\n    (1/6000*(3600*sqrt(5)*sqrt(3)*sqrt(2)*sqrt(r)/sqrt(pi)\n      + 463*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)))*432^r,\n     432,\n     3/5*sqrt(5)*sqrt(3)*sqrt(2)*sqrt(r)/sqrt(pi)\n      + 463/6000*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)))\nGot:\n    (1/2880*432^r*(144*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 5*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2))),\n     432,\n     1/20*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 1/576*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2)))\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1595, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\nFailed example:\n    F.relative_error(asy[0], alpha, [1, 2, 4, 8, 16], asy[1])  # abs tol 1e-10\nExpected:\n    [((4, 3), 2.083333333, [2.092576110], [-0.004436533009]),\n     ((8, 6), 2.787374614, [2.790732875], [-0.001204811281]),\n     ((16, 12), 3.826259447, [3.827462310], [-0.0003143703383]),\n     ((32, 24), 5.328112821, [5.328540787], [-0.00008032230388]),\n     ((64, 48), 7.475927885, [7.476079664], [-0.00002030232879])]\nGot:\n    [((4, 3), 2.083333333, [0.1491447613], [0.9284105146]),\n     ((8, 6), 2.787374614, [0.1073580576], [0.9614841661]),\n     ((16, 12), 3.826259447, [0.07658422547], [0.9799845707]),\n     ((32, 24), 5.328112821, [0.05439032335], [0.9897918221]),\n     ((64, 48), 7.475927885, [0.03854359334], [0.9948443064])]\nTolerance exceeded in 10 of 25:\n    2.092576110 vs 0.1491447613, tolerance 2e0 > 1e-10\n    -0.004436533009 vs 0.9284105146, tolerance 1e0 > 1e-10\n    2.790732875 vs 0.1073580576, tolerance 3e0 > 1e-10\n    -0.001204811281 vs 0.9614841661, tolerance 1e0 > 1e-10\n    3.827462310 vs 0.07658422547, tolerance 4e0 > 1e-10\n    -0.0003143703383 vs 0.9799845707, tolerance 1e0 > 1e-10\n    5.328540787 vs 0.05439032335, tolerance 6e0 > 1e-10\n    -0.00008032230388 vs 0.9897918221, tolerance 1e0 > 1e-10\n    7.476079664 vs 0.03854359334, tolerance 8e0 > 1e-10\n    -0.00002030232879 vs 0.9948443064, tolerance 1e0 > 1e-10\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1613, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\nFailed example:\n    decomp = F.asymptotic_decomposition(alpha); decomp\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?[22]>\", line 1, in <module>\n        decomp = F.asymptotic_decomposition(alpha); decomp\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1502, in asymptotic_decomposition\n        decomp2.extend(ff.cohomology_decomposition())\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1425, in cohomology_decomposition\n        return decomp._combine_like_terms_().whole_and_parts()\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 3495, in whole_and_parts\n        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here\n    UnboundLocalError: local variable 'r' referenced before assignment\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1619, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\nFailed example:\n    asy = F1.asymptotics(p, alpha, 2, verbose=True) # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?[25]>\", line 1, in <module>\n        asy = F1.asymptotics(p, alpha, Integer(2), verbose=True) # long time\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1636, in asymptotics\n        p = coerce_point(R, p)\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4238, in coerce_point\n        return {x: p[SR(x)] for x in R.gens()}\n      File \"/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4238, in <dictcomp>\n        return {x: p[SR(x)] for x in R.gens()}\n    KeyError: x\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1624, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\nFailed example:\n    asy # long time\nExpected:\n    (4/3*sqrt(3)*sqrt(r)/sqrt(pi) + 47/216*sqrt(3)/(sqrt(pi)*sqrt(r)),\n     1, 4/3*sqrt(3)*sqrt(r)/sqrt(pi) + 47/216*sqrt(3)/(sqrt(pi)*sqrt(r)))\nGot:\n    (1/2880*432^r*(144*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 5*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2))),\n     432,\n     1/20*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 1/576*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2)))\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 1627, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\nFailed example:\n    F.relative_error(asy[0], alpha, [1, 2, 4, 8], asy[1]) # long time\nExpected:\n    [((3, 3, 2), 0.9812164307, [1.515572606], [-0.54458543...]),\n     ((6, 6, 4), 1.576181132, [1.992989399], [-0.26444185...]),\n     ((12, 12, 8), 2.485286378, [2.712196351], [-0.091301338...]),\n     ((24, 24, 16), 3.700576827, [3.760447895], [-0.016178847...])]\nGot:\n    [((3, 3, 2), 0.002271334330, [0.1491447613], [-64.66394007]),\n     ((6, 6, 4), 8.445757952e-6, [0.1073580576], [-12710.47696]),\n     ((12, 12, 8), 7.135780002e-11, [0.07658422547], [-1.073242524e9]),\n     ((24, 24, 16), 3.050699638e-21, [0.05439032335], [-1.782880316e19])]\n**********************************************************************\n7 items had failures:\n   6 of  77 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions\n   7 of 104 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?\n   1 of  16 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.asymptotic_decomposition\n   2 of  14 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition\n   4 of  32 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition\n   2 of  14 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_certificate\n   6 of  18 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition\n    [805 tests, 28 failures, 56.34 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=241071912408585997575727450771429802043 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py  # 28 doctests failed\n```",
    "created_at": "2022-12-20T17:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34851#issuecomment-683605",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:6'></a>
`lift` seems to be broken

```
sage -t --long --random-seed=299698150490166540162136571885065553921 src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 4490, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift
Failed example:
    M
Expected:
    [y^7, x^7*y^2 + x^8 + x^5*y^3 + x^6*y + x^3*y^4 + x^4*y^2 + x*y^5 + x^2*y^3 + y^4]
Got:
    [y^7, 0]
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 4492, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift
Failed example:
    sum( map( mul , zip( M, I.gens() ) ) ) == f
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 4500, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift
Failed example:
    f.lift(I)
Expected:
    [1, x2]
Got:
    [1, 0]
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 4506, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift
Failed example:
    f.lift(I)
Expected:
    [1, x2]
Got:
    [1, 0]
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 4637, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.reduce
Failed example:
    f.reduce([2*x,y])
Expected:
    3*x
Got:
    x
**********************************************************************
2 items had failures:
   4 of  18 in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.lift
   1 of  22 in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.reduce
    [1197 tests, 5 failures, 1.11 s]
```
and there are also many failures in `asymptotics`

```
sage -t --long --random-seed=241071912408585997575727450771429802043 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 123, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
Failed example:
    decomp =  F.asymptotic_decomposition(alpha); decomp
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[48]>", line 1, in <module>
        decomp =  F.asymptotic_decomposition(alpha); decomp
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1502, in asymptotic_decomposition
        decomp2.extend(ff.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1422, in cohomology_decomposition
        decomp.extend(r.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1422, in cohomology_decomposition
        decomp.extend(r.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1425, in cohomology_decomposition
        return decomp._combine_like_terms_().whole_and_parts()
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 3495, in whole_and_parts
        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here
    UnboundLocalError: local variable 'r' referenced before assignment
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 130, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
Failed example:
    F1.asymptotics(p, alpha, 2)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[50]>", line 1, in <module>
        F1.asymptotics(p, alpha, Integer(2))
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1636, in asymptotics
        p = coerce_point(R, p)
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4238, in coerce_point
        return {x: p[SR(x)] for x in R.gens()}
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4238, in <dictcomp>
        return {x: p[SR(x)] for x in R.gens()}
    KeyError: x
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 134, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
Failed example:
    decomp =  F.asymptotic_decomposition(alpha)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[52]>", line 1, in <module>
        decomp =  F.asymptotic_decomposition(alpha)
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1502, in asymptotic_decomposition
        decomp2.extend(ff.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1422, in cohomology_decomposition
        decomp.extend(r.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1422, in cohomology_decomposition
        decomp.extend(r.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1425, in cohomology_decomposition
        return decomp._combine_like_terms_().whole_and_parts()
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 3495, in whole_and_parts
        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here
    UnboundLocalError: local variable 'r' referenced before assignment
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 136, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
Failed example:
    asy = F1.asymptotics(p, alpha, 2)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions[54]>", line 1, in <module>
        asy = F1.asymptotics(p, alpha, Integer(2))
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1636, in asymptotics
        p = coerce_point(R, p)
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4238, in coerce_point
        return {x: p[SR(x)] for x in R.gens()}
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4238, in <dictcomp>
        return {x: p[SR(x)] for x in R.gens()}
    KeyError: x
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 137, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
Failed example:
    asy
Expected:
    (3*(10*r^2 - 7*r - 3)*2187^r, 2187, 30*r^2 - 21*r - 9)
Got:
    (1/24*2^(2/3)*(sqrt(3) + 4/(sqrt(3) + I) + I)*gamma(1/3)/(pi*r^(1/3)),
     1,
     1/24*2^(2/3)*(sqrt(3) + 4/(sqrt(3) + I) + I)*gamma(1/3)/(pi*r^(1/3)))
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 139, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
Failed example:
    F.relative_error(asy[0], alpha, [1, 2, 4, 8], asy[1])
Expected:
    [((4, 3), 30.72702332, [0.0000000000], [1.000000000]),
     ((8, 6), 111.9315678, [69.00000000], [0.3835519207]),
     ((16, 12), 442.7813138, [387.0000000], [0.1259793763]),
     ((32, 24), 1799.879232, [1743.000000], [0.03160169385])]
Got:
    [((4, 3),
      67200.00000,
      [0.1953794675 - 8.207453952e-13*I],
      [0.9999970926 + 1.221347314e-17*I]),
     ((8, 6),
      5.353652190e8,
      [0.1550727862 - 6.514260518e-13*I],
      [0.9999999997 + 1.216788145e-21*I]),
     ((16, 12),
      1.012941622e16,
      [0.1230813519 - 5.170372000e-13*I],
      [1.000000000 + 5.104313900e-29*I]),
     ((32, 24),
      9.419625360e29,
      [0.09768973377 - 4.103726976e-13*I],
      [1.000000000 + 4.356571327e-43*I])]
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 860, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_certificate
Failed example:
    L
Expected:
    [y^2, -x*y + 1]
Got:
    [y^2, 0]
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 863, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_certificate
Failed example:
    sum(L[i]*df[i][0]**df[i][1] for i in range(len(df))) == 1
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 921, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition
Failed example:
    decomp
Expected:
    (0, []) + (1, [(x, 1)]) + (-y, [(x*y + 1, 1)])
Got:
    (0, []) + (-y, [(x*y + 1, 1)])
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 923, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition
Failed example:
    decomp.sum().quotient() == f
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 925, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition
Failed example:
    [r.nullstellensatz_certificate() is None for r in decomp]
Expected:
    [True, True, True]
Got:
    [True, True]
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 936, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition
Failed example:
    decomp
Expected:
    (0, []) + (sin(y), [(x, 1)]) + (-y*sin(y), [(x*y + 1, 1)])
Got:
    (0, []) + (-y*sin(y), [(x*y + 1, 1)])
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 938, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition
Failed example:
    bool(decomp.sum().quotient() == G/H)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 940, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition
Failed example:
    [r.nullstellensatz_certificate() is None for r in decomp]
Expected:
    [True, True, True]
Got:
    [True, True]
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1234, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition
Failed example:
    decomp
Expected:
    (0, []) + (1, [(x*y + 1, 1)]) + (x + y, [(y, 1), (x, 1)])
Got:
    (-x^2 - x*y - x, []) + (x, [(x*y + 1, 1)])
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1236, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition
Failed example:
    decomp.sum().quotient() == f
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1254, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition
Failed example:
    decomp
Expected:
    (0, []) +
    (-(x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x)*y, [(y, 1)]) +
    ((x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x)*x*y, [(x*y + 1, 1)]) +
    (x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x, [(y, 1), (x, 1)])
Got:
    (0, []) + (-(x*y^2*sin(x) + x^2*y + x*y + y*sin(x) + x)*x, [(x*y + 1, 1)])
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1259, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition
Failed example:
    bool(decomp.sum().quotient() == f)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1335, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition
Failed example:
    FFPD(1, [(x, 1), (y, 2)]).cohomology_decomposition()
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition[8]>", line 1, in <module>
        FFPD(Integer(1), [(x, Integer(1)), (y, Integer(2))]).cohomology_decomposition()
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1422, in cohomology_decomposition
        decomp.extend(r.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1425, in cohomology_decomposition
        return decomp._combine_like_terms_().whole_and_parts()
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 3495, in whole_and_parts
        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here
    UnboundLocalError: local variable 'r' referenced before assignment
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1343, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition
Failed example:
    f.cohomology_decomposition()
Expected:
    (0, []) + (-4/3*x*y, [(x^2 + y^2 - 1, 1)]) +
    (1/3, [(x*y - 1, 1), (x^2 + y^2 - 1, 1)])
Got:
    (0, []) + (-2/3*x^2 + 4/3*x*y + 4/3, [(x^2 + y^2 - 1, 1)]) + (-1/3*x^2 + 1/6, [(x*y - 1, 1), (x^2 + y^2 - 1, 1)])
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1474, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.asymptotic_decomposition
Failed example:
    F.asymptotic_decomposition(alpha)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.asymptotic_decomposition[14]>", line 1, in <module>
        F.asymptotic_decomposition(alpha)
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1502, in asymptotic_decomposition
        decomp2.extend(ff.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1422, in cohomology_decomposition
        decomp.extend(r.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1425, in cohomology_decomposition
        return decomp._combine_like_terms_().whole_and_parts()
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 3495, in whole_and_parts
        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here
    UnboundLocalError: local variable 'r' referenced before assignment
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1580, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
Failed example:
    decomp = F.asymptotic_decomposition(alpha); decomp
Expected:
    (0, []) + (... - 1/2, [(x*y + x + y - 1, 1)])
Got:
    (0, []) + (-1/2, [(x*y + x + y - 1, 1)])
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1589, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
Failed example:
    asy
Expected:
    (1/6000*(3600*sqrt(5)*sqrt(3)*sqrt(2)*sqrt(r)/sqrt(pi)
      + 463*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)))*432^r,
     432,
     3/5*sqrt(5)*sqrt(3)*sqrt(2)*sqrt(r)/sqrt(pi)
      + 463/6000*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)))
Got:
    (1/2880*432^r*(144*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 5*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2))),
     432,
     1/20*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 1/576*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2)))
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1595, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
Failed example:
    F.relative_error(asy[0], alpha, [1, 2, 4, 8, 16], asy[1])  # abs tol 1e-10
Expected:
    [((4, 3), 2.083333333, [2.092576110], [-0.004436533009]),
     ((8, 6), 2.787374614, [2.790732875], [-0.001204811281]),
     ((16, 12), 3.826259447, [3.827462310], [-0.0003143703383]),
     ((32, 24), 5.328112821, [5.328540787], [-0.00008032230388]),
     ((64, 48), 7.475927885, [7.476079664], [-0.00002030232879])]
Got:
    [((4, 3), 2.083333333, [0.1491447613], [0.9284105146]),
     ((8, 6), 2.787374614, [0.1073580576], [0.9614841661]),
     ((16, 12), 3.826259447, [0.07658422547], [0.9799845707]),
     ((32, 24), 5.328112821, [0.05439032335], [0.9897918221]),
     ((64, 48), 7.475927885, [0.03854359334], [0.9948443064])]
Tolerance exceeded in 10 of 25:
    2.092576110 vs 0.1491447613, tolerance 2e0 > 1e-10
    -0.004436533009 vs 0.9284105146, tolerance 1e0 > 1e-10
    2.790732875 vs 0.1073580576, tolerance 3e0 > 1e-10
    -0.001204811281 vs 0.9614841661, tolerance 1e0 > 1e-10
    3.827462310 vs 0.07658422547, tolerance 4e0 > 1e-10
    -0.0003143703383 vs 0.9799845707, tolerance 1e0 > 1e-10
    5.328540787 vs 0.05439032335, tolerance 6e0 > 1e-10
    -0.00008032230388 vs 0.9897918221, tolerance 1e0 > 1e-10
    7.476079664 vs 0.03854359334, tolerance 8e0 > 1e-10
    -0.00002030232879 vs 0.9948443064, tolerance 1e0 > 1e-10
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1613, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
Failed example:
    decomp = F.asymptotic_decomposition(alpha); decomp
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?[22]>", line 1, in <module>
        decomp = F.asymptotic_decomposition(alpha); decomp
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1502, in asymptotic_decomposition
        decomp2.extend(ff.cohomology_decomposition())
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1425, in cohomology_decomposition
        return decomp._combine_like_terms_().whole_and_parts()
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 3495, in whole_and_parts
        [r.parent()(whole, ())] + parts)  # r.parent() is not the nicest here
    UnboundLocalError: local variable 'r' referenced before assignment
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1619, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
Failed example:
    asy = F1.asymptotics(p, alpha, 2, verbose=True) # long time
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?[25]>", line 1, in <module>
        asy = F1.asymptotics(p, alpha, Integer(2), verbose=True) # long time
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1636, in asymptotics
        p = coerce_point(R, p)
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4238, in coerce_point
        return {x: p[SR(x)] for x in R.gens()}
      File "/usr/lib/python3.10/site-packages/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4238, in <dictcomp>
        return {x: p[SR(x)] for x in R.gens()}
    KeyError: x
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1624, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
Failed example:
    asy # long time
Expected:
    (4/3*sqrt(3)*sqrt(r)/sqrt(pi) + 47/216*sqrt(3)/(sqrt(pi)*sqrt(r)),
     1, 4/3*sqrt(3)*sqrt(r)/sqrt(pi) + 47/216*sqrt(3)/(sqrt(pi)*sqrt(r)))
Got:
    (1/2880*432^r*(144*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 5*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2))),
     432,
     1/20*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*sqrt(r)) - 1/576*sqrt(5)*sqrt(3)*sqrt(2)/(sqrt(pi)*r^(3/2)))
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 1627, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
Failed example:
    F.relative_error(asy[0], alpha, [1, 2, 4, 8], asy[1]) # long time
Expected:
    [((3, 3, 2), 0.9812164307, [1.515572606], [-0.54458543...]),
     ((6, 6, 4), 1.576181132, [1.992989399], [-0.26444185...]),
     ((12, 12, 8), 2.485286378, [2.712196351], [-0.091301338...]),
     ((24, 24, 16), 3.700576827, [3.760447895], [-0.016178847...])]
Got:
    [((3, 3, 2), 0.002271334330, [0.1491447613], [-64.66394007]),
     ((6, 6, 4), 8.445757952e-6, [0.1073580576], [-12710.47696]),
     ((12, 12, 8), 7.135780002e-11, [0.07658422547], [-1.073242524e9]),
     ((24, 24, 16), 3.050699638e-21, [0.05439032335], [-1.782880316e19])]
**********************************************************************
7 items had failures:
   6 of  77 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
   7 of 104 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.?
   1 of  16 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.asymptotic_decomposition
   2 of  14 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.cohomology_decomposition
   4 of  32 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.leinartas_decomposition
   2 of  14 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_certificate
   6 of  18 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.nullstellensatz_decomposition
    [805 tests, 28 failures, 56.34 s]
----------------------------------------------------------------------
sage -t --long --random-seed=241071912408585997575727450771429802043 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py  # 28 doctests failed
```
