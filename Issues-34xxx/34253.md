# Issue 34253: Add discrete logarithm for anomalous elliptic curves

archive/issues_034016.json:
```json
{
    "body": "A fast method to solve the discrete logarithm in anomalous elliptic curves uses the p-adic logarithm as described in: https://link.springer.com/article/10.1007/s001459900052. I implemented the algorithm based on https://crypto.stackexchange.com/questions/70454/why-smarts-attack-doesnt-work-on-this-ecdlp/70508#70508 for `EllipticCurvePoint_finite_field`\n\nKeywords: p-adic discrete logarithm\n\nBranch/Commit: 86ad46522b11a2e1e8633d681e3cb77ea5801859\n\nReviewer: Lorenz Panny\n\nAuthor: Sylvain Pelissier\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34253\n\n",
    "closed_at": "2022-08-07T22:55:24Z",
    "created_at": "2022-07-31T13:59:31Z",
    "labels": [
        "component: number theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Add discrete logarithm for anomalous elliptic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34253",
    "user": "https://github.com/sylvainpelissier"
}
```
A fast method to solve the discrete logarithm in anomalous elliptic curves uses the p-adic logarithm as described in: https://link.springer.com/article/10.1007/s001459900052. I implemented the algorithm based on https://crypto.stackexchange.com/questions/70454/why-smarts-attack-doesnt-work-on-this-ecdlp/70508#70508 for `EllipticCurvePoint_finite_field`

Keywords: p-adic discrete logarithm

Branch/Commit: 86ad46522b11a2e1e8633d681e3cb77ea5801859

Reviewer: Lorenz Panny

Author: Sylvain Pelissier

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34253





---

archive/issue_comments_673728.json:
```json
{
    "body": "Changing commit from \"\" to \"f33b2509216f7a0ef5db31de700f032d0d38b490\"",
    "created_at": "2022-07-31T15:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673728",
    "user": "https://github.com/sylvainpelissier"
}
```

Changing commit from "" to "f33b2509216f7a0ef5db31de700f032d0d38b490"



---

archive/issue_comments_673729.json:
```json
{
    "body": "Changing branch from \"u/sylvainpelissier/padic_elliptic_logarithm\" to \"u/gh-sylvainpelissier/padic_elliptic_logarithm\"",
    "created_at": "2022-07-31T15:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673729",
    "user": "https://github.com/sylvainpelissier"
}
```

Changing branch from "u/sylvainpelissier/padic_elliptic_logarithm" to "u/gh-sylvainpelissier/padic_elliptic_logarithm"



---

archive/issue_comments_673730.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Lorenz Panny\"",
    "created_at": "2022-08-02T03:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673730",
    "user": "https://github.com/yyyyx4"
}
```

Changing reviewer from "" to "Lorenz Panny"



---

archive/issue_comments_673731.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks for writing this code, it looks very nice! A few comments:\n\n- The test\n\n```diff\n+        if E.order() == E.base().order():\n```\n  can be very expensive if the order of the curve hasn't been computed yet. (Not a very common scenario, but possible by using `.set_order()` on points.)\n  Suggestion: Replace by\n\n```python\nn == E.base_field().cardinality()\n```\n  or something like that.\n\n- If I remember correctly, `E.formal_group().log()` is another way to construct the power series underlying this mapping. Perhaps we should add `SEEALSO` cross-references, and/or reuse that method (assuming it doesn't make things slower or otherwise worse)?\n\n- Here\n\n```diff\n+        For anomalous curves with `#E = p`, the `padic_elliptic_logarithm`\n```\n  you can use the syntax\n\n```\n:meth:`padic_elliptic_logarithm`\n```\n   to turn the `padic_elliptic_logarithm` reference into a link in the HTML documentation.\n\n- This change\n\n```diff\n-        EXAMPLES::\n+        EXAMPLES:\n\n             sage: F = GF((3,6),'a')\n```\n  is incorrect; the documentation format requires a double colon before an indented block.",
    "created_at": "2022-08-02T03:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673731",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:2'></a>
Thanks for writing this code, it looks very nice! A few comments:

- The test

```diff
+        if E.order() == E.base().order():
```
  can be very expensive if the order of the curve hasn't been computed yet. (Not a very common scenario, but possible by using `.set_order()` on points.)
  Suggestion: Replace by

```python
n == E.base_field().cardinality()
```
  or something like that.

- If I remember correctly, `E.formal_group().log()` is another way to construct the power series underlying this mapping. Perhaps we should add `SEEALSO` cross-references, and/or reuse that method (assuming it doesn't make things slower or otherwise worse)?

- Here

```diff
+        For anomalous curves with `#E = p`, the `padic_elliptic_logarithm`
```
  you can use the syntax

```
:meth:`padic_elliptic_logarithm`
```
   to turn the `padic_elliptic_logarithm` reference into a link in the HTML documentation.

- This change

```diff
-        EXAMPLES::
+        EXAMPLES:

             sage: F = GF((3,6),'a')
```
  is incorrect; the documentation format requires a double colon before an indented block.



---

archive/issue_comments_673732.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[726112a](https://github.com/sagemath/sagetrac-mirror/commit/726112a3208b3ea503dac68b32cb477cfb71e131)|`Corrections on padic_elliptic_logarithm based on remarks`|",
    "created_at": "2022-08-02T07:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673732",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[726112a](https://github.com/sagemath/sagetrac-mirror/commit/726112a3208b3ea503dac68b32cb477cfb71e131)|`Corrections on padic_elliptic_logarithm based on remarks`|



---

archive/issue_comments_673733.json:
```json
{
    "body": "Changing commit from \"f33b2509216f7a0ef5db31de700f032d0d38b490\" to \"726112a3208b3ea503dac68b32cb477cfb71e131\"",
    "created_at": "2022-08-02T07:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673733",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f33b2509216f7a0ef5db31de700f032d0d38b490" to "726112a3208b3ea503dac68b32cb477cfb71e131"



---

archive/issue_comments_673734.json:
```json
{
    "body": "<a id='comment:4'></a>\nThank you for your remarks they are helpful. I corrected everything expect the one related to `E.formal_group().log()`. I would need more time to test and understand if it works the same way or bring improvements.",
    "created_at": "2022-08-02T08:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673734",
    "user": "https://github.com/sylvainpelissier"
}
```

<a id='comment:4'></a>
Thank you for your remarks they are helpful. I corrected everything expect the one related to `E.formal_group().log()`. I would need more time to test and understand if it works the same way or bring improvements.



---

archive/issue_comments_673735.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks good.\n\nOne last thing: Much of the new code is a slightly modified version of [https://crypto.stackexchange.com/a/70508](https://crypto.stackexchange.com/a/70508), so we must give proper attribution in the docstring (e.g., in the `AUTHORS` or the `ALGORITHM` part).",
    "created_at": "2022-08-03T02:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673735",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:5'></a>
Looks good.

One last thing: Much of the new code is a slightly modified version of [https://crypto.stackexchange.com/a/70508](https://crypto.stackexchange.com/a/70508), so we must give proper attribution in the docstring (e.g., in the `AUTHORS` or the `ALGORITHM` part).



---

archive/issue_comments_673736.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[5069aac](https://github.com/sagemath/sagetrac-mirror/commit/5069aacec3b0cb5523141554468b343cf58bad83)|`Add proper attribution`|",
    "created_at": "2022-08-03T05:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673736",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[5069aac](https://github.com/sagemath/sagetrac-mirror/commit/5069aacec3b0cb5523141554468b343cf58bad83)|`Add proper attribution`|



---

archive/issue_comments_673737.json:
```json
{
    "body": "Changing commit from \"726112a3208b3ea503dac68b32cb477cfb71e131\" to \"5069aacec3b0cb5523141554468b343cf58bad83\"",
    "created_at": "2022-08-03T05:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673737",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "726112a3208b3ea503dac68b32cb477cfb71e131" to "5069aacec3b0cb5523141554468b343cf58bad83"



---

archive/issue_comments_673738.json:
```json
{
    "body": "<a id='comment:7'></a>\nYes you are right. This should be fine now.",
    "created_at": "2022-08-03T05:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673738",
    "user": "https://github.com/sylvainpelissier"
}
```

<a id='comment:7'></a>
Yes you are right. This should be fine now.



---

archive/issue_comments_673739.json:
```json
{
    "body": "<a id='comment:8'></a>\nHere's an example for which this branch fails to compute `.discrete_log()`:\n\n```sage\nsage: R.<x> = ZZ[]\nsage: F.<i> = GF(787^2, modulus=x^2+1)\nsage: E = EllipticCurve([268*i + 507, 42*i + 772])\n```\n\nYou could either add an `.is_prime_field()` check, or (better) generalize the code to non-prime finite fields.\n\n(By the way, you should set the ticket to \"needs review\" once it's ready from your perspective. I looked at this anyway because I didn't notice it was still \"new\", but in general you will only attract reviewers by setting the correct status.)",
    "created_at": "2022-08-04T07:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673739",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:8'></a>
Here's an example for which this branch fails to compute `.discrete_log()`:

```sage
sage: R.<x> = ZZ[]
sage: F.<i> = GF(787^2, modulus=x^2+1)
sage: E = EllipticCurve([268*i + 507, 42*i + 772])
```

You could either add an `.is_prime_field()` check, or (better) generalize the code to non-prime finite fields.

(By the way, you should set the ticket to "needs review" once it's ready from your perspective. I looked at this anyway because I didn't notice it was still "new", but in general you will only attract reviewers by setting the correct status.)



---

archive/issue_comments_673740.json:
```json
{
    "body": "Changing commit from \"5069aacec3b0cb5523141554468b343cf58bad83\" to \"3c0c8a7a1efe6d170889da9b4e73541ebc4c5cf2\"",
    "created_at": "2022-08-04T17:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673740",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5069aacec3b0cb5523141554468b343cf58bad83" to "3c0c8a7a1efe6d170889da9b4e73541ebc4c5cf2"



---

archive/issue_comments_673741.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[3c0c8a7](https://github.com/sagemath/sagetrac-mirror/commit/3c0c8a7a1efe6d170889da9b4e73541ebc4c5cf2)|`Add primiality test`|",
    "created_at": "2022-08-04T17:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673741",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[3c0c8a7](https://github.com/sagemath/sagetrac-mirror/commit/3c0c8a7a1efe6d170889da9b4e73541ebc4c5cf2)|`Add primiality test`|



---

archive/issue_comments_673742.json:
```json
{
    "body": "<a id='comment:10'></a>\nI've added the primality test. I have to figure out how to handle the non prime field case. Do you want me to open another ticket for that ?",
    "created_at": "2022-08-04T17:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673742",
    "user": "https://github.com/sylvainpelissier"
}
```

<a id='comment:10'></a>
I've added the primality test. I have to figure out how to handle the non prime field case. Do you want me to open another ticket for that ?



---

archive/issue_comments_673743.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-04T17:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673743",
    "user": "https://github.com/sylvainpelissier"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_673744.json:
```json
{
    "body": "Changing commit from \"3c0c8a7a1efe6d170889da9b4e73541ebc4c5cf2\" to \"538f50e39114e338094a1740c41b61b522a6c2f5\"",
    "created_at": "2022-08-04T17:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673744",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3c0c8a7a1efe6d170889da9b4e73541ebc4c5cf2" to "538f50e39114e338094a1740c41b61b522a6c2f5"



---

archive/issue_comments_673745.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[538f50e](https://github.com/sagemath/sagetrac-mirror/commit/538f50e39114e338094a1740c41b61b522a6c2f5)|`Rearrange checks`|",
    "created_at": "2022-08-04T17:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[538f50e](https://github.com/sagemath/sagetrac-mirror/commit/538f50e39114e338094a1740c41b61b522a6c2f5)|`Rearrange checks`|



---

archive/issue_comments_673746.json:
```json
{
    "body": "<a id='comment:13'></a>\nI think this is incorrect for non-anomalous curves over prime fields: In that case, the first `if` holds (so the `elif` branches are skipped), but for a non-cyclic group we do still have to run the pairing check to ensure there's a solution.\n\nGiven that the prime case is already working and useful on its own, I think the non-prime case should go into a new ticket.",
    "created_at": "2022-08-05T07:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673746",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:13'></a>
I think this is incorrect for non-anomalous curves over prime fields: In that case, the first `if` holds (so the `elif` branches are skipped), but for a non-cyclic group we do still have to run the pairing check to ensure there's a solution.

Given that the prime case is already working and useful on its own, I think the non-prime case should go into a new ticket.



---

archive/issue_comments_673747.json:
```json
{
    "body": "Changing commit from \"538f50e39114e338094a1740c41b61b522a6c2f5\" to \"86ad46522b11a2e1e8633d681e3cb77ea5801859\"",
    "created_at": "2022-08-05T15:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "538f50e39114e338094a1740c41b61b522a6c2f5" to "86ad46522b11a2e1e8633d681e3cb77ea5801859"



---

archive/issue_comments_673748.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[86ad465](https://github.com/sagemath/sagetrac-mirror/commit/86ad46522b11a2e1e8633d681e3cb77ea5801859)|`Correct check for anomalous curves`|",
    "created_at": "2022-08-05T15:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[86ad465](https://github.com/sagemath/sagetrac-mirror/commit/86ad46522b11a2e1e8633d681e3cb77ea5801859)|`Correct check for anomalous curves`|



---

archive/issue_comments_673749.json:
```json
{
    "body": "<a id='comment:15'></a>\nGood catch thank you. It is corrected.",
    "created_at": "2022-08-05T15:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673749",
    "user": "https://github.com/sylvainpelissier"
}
```

<a id='comment:15'></a>
Good catch thank you. It is corrected.



---

archive/issue_comments_673750.json:
```json
{
    "body": "<a id='comment:16'></a>\nThanks!",
    "created_at": "2022-08-06T01:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673750",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:16'></a>
Thanks!



---

archive/issue_comments_673751.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-06T01:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673751",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_673752.json:
```json
{
    "body": "Changing branch from \"u/gh-sylvainpelissier/padic_elliptic_logarithm\" to \"86ad46522b11a2e1e8633d681e3cb77ea5801859\"",
    "created_at": "2022-08-07T22:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673752",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-sylvainpelissier/padic_elliptic_logarithm" to "86ad46522b11a2e1e8633d681e3cb77ea5801859"



---

archive/issue_comments_673753.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-07T22:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34253#issuecomment-673753",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_108455.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-07T22:55:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34253",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34253#event-108455"
}
```
