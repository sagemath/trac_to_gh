# Issue 34668: Support matplotlib 3.6

archive/issues_034431.json:
```json
{
    "body": "Currently there are a number of doctest failures when running sage with matplotlib 3.6, mostly deprecation warnings.\n\nThe current ticket is small and simple, it will make all tests pass with matplotlib 3.6, and it is backwards compatible.\n\n**Branch:** [5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)\n\n**Reviewer:** Matthias Koeppe\n\n**Author:** Gonzalo Tornar\u00eda\n\nIssue created by migration from https://trac.sagemath.org/ticket/34668\n\n",
    "closed_at": "2022-10-23T20:49:40Z",
    "created_at": "2022-10-17T03:17:37Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Support matplotlib 3.6",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34668",
    "user": "https://github.com/tornaria"
}
```
Currently there are a number of doctest failures when running sage with matplotlib 3.6, mostly deprecation warnings.

The current ticket is small and simple, it will make all tests pass with matplotlib 3.6, and it is backwards compatible.

**Branch:** [5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)

**Reviewer:** Matthias Koeppe

**Author:** Gonzalo Tornaría

Issue created by migration from https://trac.sagemath.org/ticket/34668





---

archive/issue_comments_563750.json:
```json
{
    "body": "**Commit:** [5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)",
    "created_at": "2022-10-17T03:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563750",
    "user": "https://github.com/tornaria"
}
```

**Commit:** [5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)



---

archive/issue_comments_563751.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568\">5501e0d</a></td><td><code>Support matplotlib 3.6</code></td></tr></table>\n",
    "created_at": "2022-10-17T03:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563751",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568">5501e0d</a></td><td><code>Support matplotlib 3.6</code></td></tr></table>




---

archive/issue_events_312241.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2022-10-17T03:18:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34668#event-312241"
}
```



---

archive/issue_comments_563752.json:
```json
{
    "body": "**Branch:** [u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)",
    "created_at": "2022-10-17T03:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563752",
    "user": "https://github.com/tornaria"
}
```

**Branch:** [u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)



---

archive/issue_events_312242.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-18T04:23:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34668#event-312242"
}
```



---

archive/issue_events_312243.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-18T04:23:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34668#event-312243"
}
```



---

archive/issue_comments_563753.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2022-10-18T04:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563753",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_events_312244.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-23T20:49:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34668#event-312244"
}
```



---

archive/issue_events_312245.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-23T20:49:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34668#event-312245"
}
```



---

archive/issue_comments_563754.json:
```json
{
    "body": "**Changing branch** from \"[u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)\" to \"[5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)\".",
    "created_at": "2022-10-23T20:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563754",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tornaria/matplotlib-3.6](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/matplotlib-3.6)" to "[5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)".



---

archive/issue_comments_563755.json:
```json
{
    "body": "**Changing commit** from \"[5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)\" to \"\".",
    "created_at": "2022-10-24T20:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563755",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[5501e0de0dca1cff0355326dd42bd8c7e5749568](https://github.com/sagemath/sagetrac-mirror/commit/5501e0de0dca1cff0355326dd42bd8c7e5749568)" to "".



---

archive/issue_comments_563756.json:
```json
{
    "body": "<a id='comment:4'></a>\nThose changes are not enough to build the documentation with matplotlib 3.6.1, unless I miss another needed element\n\n```\n[plotting ]  from /home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc/en/reference/plotting/sage/plot/plot.rst:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1378, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, \"for_layout_only\": True})\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n[plotting ] During handling of the above exception, another exception occurred:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1378, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, \"for_layout_only\": True})\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py\", line 4428, in get_tightbbox\n[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1380, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **kwargs)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n[plotting ] During handling of the above exception, another exception occurred:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1378, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, \"for_layout_only\": True})\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n[plotting ] During handling of the above exception, another exception occurred:\n[plotting ] Traceback (most recent call last):\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/sphinxext/plot_directive.py\", line 515, in _run_code\n[plotting ]     exec(code, ns)\n[plotting ]   File \"<string>\", line 2, in <module>\n[plotting ]   File \"<string>\", line 37, in sphinx_plot\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/figure.py\", line 3448, in tight_layout\n[plotting ]     engine.execute(self)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/layout_engine.py\", line 180, in execute\n[plotting ]     kwargs = get_tight_layout_figure(\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py\", line 305, in get_tight_layout_figure\n[plotting ]     kwargs = _auto_adjust_subplotpars(fig, renderer,\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py\", line 82, in _auto_adjust_subplotpars\n[plotting ]     bb += [martist._get_tightbbox_for_layout_only(ax, renderer)]\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1380, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **kwargs)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py\", line 4428, in get_tightbbox\n[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/artist.py\", line 1380, in _get_tightbbox_for_layout_only\n[plotting ]     return obj.get_tightbbox(*args, **kwargs)\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1251, in get_tightbbox\n[plotting ]     ticks_to_draw = self._update_ticks()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1198, in _update_ticks\n[plotting ]     minor_locs = self.get_minorticklocs()\n[plotting ]   File \"/usr/lib/python3.10/site-packages/matplotlib/axis.py\", line 1431, in get_minorticklocs\n[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],\n[plotting ]   File \"<__array_function__ internals>\", line 180, in isclose\n[plotting ]   File \"/usr/lib/python3.10/site-packages/numpy/core/numeric.py\", line 2373, in isclose\n[plotting ]     yfin = isfinite(y)\n[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n```",
    "created_at": "2022-10-24T20:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563756",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Those changes are not enough to build the documentation with matplotlib 3.6.1, unless I miss another needed element

```
[plotting ]  from /home/portage/sci-mathematics/sage-doc-9999/work/sage-doc-9999/src/doc/en/reference/plotting/sage/plot/plot.rst:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1378, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, "for_layout_only": True})
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
[plotting ] During handling of the above exception, another exception occurred:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1378, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, "for_layout_only": True})
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py", line 4428, in get_tightbbox
[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1380, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **kwargs)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
[plotting ] During handling of the above exception, another exception occurred:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1378, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **{**kwargs, "for_layout_only": True})
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
[plotting ] During handling of the above exception, another exception occurred:
[plotting ] Traceback (most recent call last):
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/sphinxext/plot_directive.py", line 515, in _run_code
[plotting ]     exec(code, ns)
[plotting ]   File "<string>", line 2, in <module>
[plotting ]   File "<string>", line 37, in sphinx_plot
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/figure.py", line 3448, in tight_layout
[plotting ]     engine.execute(self)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/layout_engine.py", line 180, in execute
[plotting ]     kwargs = get_tight_layout_figure(
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py", line 305, in get_tight_layout_figure
[plotting ]     kwargs = _auto_adjust_subplotpars(fig, renderer,
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/_tight_layout.py", line 82, in _auto_adjust_subplotpars
[plotting ]     bb += [martist._get_tightbbox_for_layout_only(ax, renderer)]
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1380, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **kwargs)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axes/_base.py", line 4428, in get_tightbbox
[plotting ]     ba = martist._get_tightbbox_for_layout_only(axis, renderer)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/artist.py", line 1380, in _get_tightbbox_for_layout_only
[plotting ]     return obj.get_tightbbox(*args, **kwargs)
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1251, in get_tightbbox
[plotting ]     ticks_to_draw = self._update_ticks()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1198, in _update_ticks
[plotting ]     minor_locs = self.get_minorticklocs()
[plotting ]   File "/usr/lib/python3.10/site-packages/matplotlib/axis.py", line 1431, in get_minorticklocs
[plotting ]     mask = np.isclose(tr_minor_locs[:, None], tr_major_locs[None, :],
[plotting ]   File "<__array_function__ internals>", line 180, in isclose
[plotting ]   File "/usr/lib/python3.10/site-packages/numpy/core/numeric.py", line 2373, in isclose
[plotting ]     yfin = isfinite(y)
[plotting ] TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
```



---

archive/issue_comments_563757.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt looks like \n\n```\nplot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter=\"latex\")\n```\nin both `src/sage/plot/graphics.py` and `src/sage/plot/plot.py` may be the root cause of the problem\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.8.beta2, Release Date: 2022-10-16               \u2502\n\u2502 Using Python 3.10.8. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter=\"latex\")\n/usr/lib/python3.10/site-packages/sage/repl/rich_output/display_manager.py:610: RichReprWarning: Exception in _rich_repr_ while displaying object: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''\n  warnings.warn(\nGraphics object consisting of 1 graphics primitive\n```\nNot testing them is not enough for doc building.",
    "created_at": "2022-10-24T21:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563757",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
It looks like 

```
plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter="latex")
```
in both `src/sage/plot/graphics.py` and `src/sage/plot/plot.py` may be the root cause of the problem

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.8.beta2, Release Date: 2022-10-16               │
│ Using Python 3.10.8. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter="latex")
/usr/lib/python3.10/site-packages/sage/repl/rich_output/display_manager.py:610: RichReprWarning: Exception in _rich_repr_ while displaying object: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''
  warnings.warn(
Graphics object consisting of 1 graphics primitive
```
Not testing them is not enough for doc building.



---

archive/issue_comments_563758.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [Fran\u00e7ois Bissey](#comment%3A4):\n> Those changes are not enough to build the documentation with matplotlib 3.6.1, unless I miss another needed element\n\n\nI didn't try to build documentation. The error looks like an error I \"fixed\" with this\n\n```diff\ndiff --git a/src/sage/plot/plot.py b/src/sage/plot/plot.py\nindex b36ee57..5301a05 100644\n--- a/src/sage/plot/plot.py\n+++ b/src/sage/plot/plot.py\n@@ -1741,7 +1741,7 @@ def plot(funcs, *args, **kwds):\n \n     ::\n \n-        sage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter=\"latex\")\n+        sage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter=\"latex\") # not tested (broken with matplotlib 3.6)\n         Graphics object consisting of 1 graphics primitive\n \n     .. PLOT::\n```\n\nThere is a `.. PLOT::` section after, and since I don't know how that works I didn't touch it, but I think the same code might be repeated.\n\nThe point is, the following code is broken, possibly forever:\n\n```sage\nsage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter=\"latex\")\n```\nI looked at it a little bit and my conclusion is that there is *nothing* in sage to make it work. It just did by accident; a happy hack. In fact, matplotlib is expecting numpy objects in there, and SR expressions are not. Unless I'm missing something, making this work would require a new feature.",
    "created_at": "2022-10-24T21:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563758",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:6'></a>
Replying to [François Bissey](#comment%3A4):
> Those changes are not enough to build the documentation with matplotlib 3.6.1, unless I miss another needed element


I didn't try to build documentation. The error looks like an error I "fixed" with this

```diff
diff --git a/src/sage/plot/plot.py b/src/sage/plot/plot.py
index b36ee57..5301a05 100644
--- a/src/sage/plot/plot.py
+++ b/src/sage/plot/plot.py
@@ -1741,7 +1741,7 @@ def plot(funcs, *args, **kwds):
 
     ::
 
-        sage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter="latex")
+        sage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter="latex") # not tested (broken with matplotlib 3.6)
         Graphics object consisting of 1 graphics primitive
 
     .. PLOT::
```

There is a `.. PLOT::` section after, and since I don't know how that works I didn't touch it, but I think the same code might be repeated.

The point is, the following code is broken, possibly forever:

```sage
sage: plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter="latex")
```
I looked at it a little bit and my conclusion is that there is *nothing* in sage to make it work. It just did by accident; a happy hack. In fact, matplotlib is expecting numpy objects in there, and SR expressions are not. Unless I'm missing something, making this work would require a new feature.



---

archive/issue_comments_563759.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think the section in `plot.py` should be removed, I am trying it right now. I think that will be enough for the doc. But you are right that stuff should be replaced. I am not quite sure of the intent of that plot was in the first place.",
    "created_at": "2022-10-24T21:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563759",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I think the section in `plot.py` should be removed, I am trying it right now. I think that will be enough for the doc. But you are right that stuff should be replaced. I am not quite sure of the intent of that plot was in the first place.



---

archive/issue_comments_563760.json:
```json
{
    "body": "<a id='comment:8'></a>\nIn the end, it looks like they both need to go :(",
    "created_at": "2022-10-24T21:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563760",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
In the end, it looks like they both need to go :(



---

archive/issue_comments_563761.json:
```json
{
    "body": "<a id='comment:9'></a>\nI had not noticed \n\n```\n    .. PLOT::\n\n        g = plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter=\"latex\")\n        sphinx_plot(g)\n\n```\nin `plot.py`, this is likely my only culprit.",
    "created_at": "2022-10-24T21:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563761",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I had not noticed 

```
    .. PLOT::

        g = plot(2*x+1,(x,0,5),ticks=[[0,1,e,pi,sqrt(20)],2],tick_formatter="latex")
        sphinx_plot(g)

```
in `plot.py`, this is likely my only culprit.



---

archive/issue_comments_563762.json:
```json
{
    "body": "<a id='comment:10'></a>\nMoved to a follow up ticket, #34693. We have some way forward.",
    "created_at": "2022-10-24T21:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34668#issuecomment-563762",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Moved to a follow up ticket, #34693. We have some way forward.
