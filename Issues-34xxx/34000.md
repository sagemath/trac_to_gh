# Issue 34000: cleaning and enhancement to PolyDict

archive/issues_033763.json:
```json
{
    "assignees": [],
    "body": "We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.\n\nWe also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).\n\nAlong the way, we fix\n\n```\nsage: R = ZZ['x']['y,z']\nsage: y, z = R.gens()\nsage: y.integral(y)\n1/2*y^2\nsage: parent(y.integral(y))\nMultivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring\n```\nand\n\n```\nsage: from sage.rings.polynomial.polydict import ETuple\nsage: e = ETuple([0, 1, 0])\nsage: e.eadd_p(0, 0).nonzero_positions()\n[0, 1]\n```\n\nCC:  @xcaruso @mezzarobba @saraedum\n\nComponent: **algebra**\n\nAuthor: **Vincent Delecroix**\n\nBranch/Commit: **[u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000) @ [`52c5a25`](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34000_\n\n",
    "created_at": "2022-06-16T09:04:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "cleaning and enhancement to PolyDict",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/34000",
    "user": "https://github.com/videlec"
}
```
We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.

We also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).

Along the way, we fix

```
sage: R = ZZ['x']['y,z']
sage: y, z = R.gens()
sage: y.integral(y)
1/2*y^2
sage: parent(y.integral(y))
Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring
```
and

```
sage: from sage.rings.polynomial.polydict import ETuple
sage: e = ETuple([0, 1, 0])
sage: e.eadd_p(0, 0).nonzero_positions()
[0, 1]
```

CC:  @xcaruso @mezzarobba @saraedum

Component: **algebra**

Author: **Vincent Delecroix**

Branch/Commit: **[u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000) @ [`52c5a25`](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)**

_Issue created by migration from https://trac.sagemath.org/ticket/34000_





---

archive/issue_events_462426.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T09:04:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462426"
}
```



---

archive/issue_events_462427.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T09:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462427"
}
```



---

archive/issue_events_462428.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T09:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462428"
}
```



---

archive/issue_events_462429.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T09:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462429"
}
```



---

archive/issue_comments_549415.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,14 @@\n+We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.\n \n+We also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).\n+\n+Along the way, we fix\n+\n+```\n+sage: R = ZZ['x']['y,z']\n+sage: y, z = R.gens()\n+sage: y.integral(y)\n+1/2*y^2\n+sage: parent(y.integral(y))\n+Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring\n+```\n``````\n",
    "created_at": "2022-06-16T09:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549415",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,14 @@
+We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.
 
+We also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).
+
+Along the way, we fix
+
+```
+sage: R = ZZ['x']['y,z']
+sage: y, z = R.gens()
+sage: y.integral(y)
+1/2*y^2
+sage: parent(y.integral(y))
+Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring
+```
``````




---

archive/issue_comments_549416.json:
```json
{
    "body": "Commit: **[`e48d741`](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)**",
    "created_at": "2022-06-16T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549416",
    "user": "https://github.com/videlec"
}
```

Commit: **[`e48d741`](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)**



---

archive/issue_comments_549417.json:
```json
{
    "body": "Branch: **[u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000)**",
    "created_at": "2022-06-16T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549417",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000)**



---

archive/issue_comments_549418.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7deaa248c1782ebad19bb6723e0f8a4f6d4ddb10\"><code>7deaa24</code></a></td><td><code>34000: cleaning and enhancement to polydict</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af\"><code>e48d741</code></a></td><td><code>34000: remove PolyDict.__pow__</code></td></tr></table>\n",
    "created_at": "2022-06-16T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549418",
    "user": "https://github.com/videlec"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7deaa248c1782ebad19bb6723e0f8a4f6d4ddb10"><code>7deaa24</code></a></td><td><code>34000: cleaning and enhancement to polydict</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af"><code>e48d741</code></a></td><td><code>34000: remove PolyDict.__pow__</code></td></tr></table>




---

archive/issue_events_462430.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T16:28:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462430"
}
```



---

archive/issue_comments_549419.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nTwo things that I did not understand while skimming through the code:\n* in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?\n* what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?",
    "created_at": "2022-06-18T07:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549419",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:3" align="right">comment:3</div>

Two things that I did not understand while skimming through the code:
* in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?
* what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?



---

archive/issue_comments_549420.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@mezzarobba](#comment%3A3):\n> Two things that I did not understand while skimming through the code:\n\nThanks for having a look.\n\n> * in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?\n\nI shamefully copied the code from univariate polynomials, see [polynomial_element.pyx#L3980-L3985](https://github.com/sagemath/sage/blob/develop/src/sage/rings/polynomial/polynomial_element.pyx#L3980-L3985)\n\n> * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?\n\nOne of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.",
    "created_at": "2022-06-18T12:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549420",
    "user": "https://github.com/videlec"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@mezzarobba](#comment%3A3):
> Two things that I did not understand while skimming through the code:

Thanks for having a look.

> * in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?

I shamefully copied the code from univariate polynomials, see [polynomial_element.pyx#L3980-L3985](https://github.com/sagemath/sage/blob/develop/src/sage/rings/polynomial/polynomial_element.pyx#L3980-L3985)

> * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?

One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.



---

archive/issue_comments_549421.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@videlec](#comment%3A4):\n> > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?\n\n> \n> One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.\n\nSorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).",
    "created_at": "2022-06-18T18:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549421",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@videlec](#comment%3A4):
> > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?

> 
> One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.

Sorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).



---

archive/issue_comments_549422.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6eac6b0e29605fae248f280de33563afce301347\"><code>6eac6b0</code></a></td><td><code>34000: cleaner optimization in derivative/integral</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/065d42eac965a8b276044d2487eb82a979efca4a\"><code>065d42e</code></a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53\"><code>48413be</code></a></td><td><code>34000: two little optimizations</code></td></tr></table>\n",
    "created_at": "2022-06-18T19:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549422",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6eac6b0e29605fae248f280de33563afce301347"><code>6eac6b0</code></a></td><td><code>34000: cleaner optimization in derivative/integral</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/065d42eac965a8b276044d2487eb82a979efca4a"><code>065d42e</code></a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53"><code>48413be</code></a></td><td><code>34000: two little optimizations</code></td></tr></table>




---

archive/issue_comments_549423.json:
```json
{
    "body": "Changed commit from **[`e48d741`](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)** to **[`48413be`](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)**",
    "created_at": "2022-06-18T19:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549423",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e48d741`](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)** to **[`48413be`](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)**



---

archive/issue_comments_549424.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@mezzarobba](#comment%3A5):\n> Replying to [@videlec](#comment%3A4):\n> > > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?\n\n> > \n> > One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.\n\n> \n> Sorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).\n\nIt is really a `RuntimeError` : it is assumed that keys are `ETuple` and coefficients are nonzero.",
    "created_at": "2022-06-18T19:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549424",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@mezzarobba](#comment%3A5):
> Replying to [@videlec](#comment%3A4):
> > > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?

> > 
> > One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.

> 
> Sorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).

It is really a `RuntimeError` : it is assumed that keys are `ETuple` and coefficients are nonzero.



---

archive/issue_comments_549425.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI hope I clarified the code related to your comments in \u200b6eac6b0 and 065d42e.",
    "created_at": "2022-06-18T19:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549425",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

I hope I clarified the code related to your comments in ​6eac6b0 and 065d42e.



---

archive/issue_comments_549426.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nLet me change `RuntimeError` for assertions.",
    "created_at": "2022-06-18T19:39:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549426",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

Let me change `RuntimeError` for assertions.



---

archive/issue_comments_549427.json:
```json
{
    "body": "Changed commit from **[`48413be`](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)** to **[`f6c6893`](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)**",
    "created_at": "2022-06-18T19:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549427",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`48413be`](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)** to **[`f6c6893`](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)**



---

archive/issue_comments_549428.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb\"><code>f6c6893</code></a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr></table>\n",
    "created_at": "2022-06-18T19:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549428",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb"><code>f6c6893</code></a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr></table>




---

archive/issue_comments_549429.json:
```json
{
    "body": "Changed commit from **[`f6c6893`](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)** to **[`3341a98`](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)**",
    "created_at": "2022-06-19T08:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549429",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f6c6893`](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)** to **[`3341a98`](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)**



---

archive/issue_comments_549430.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d\"><code>3341a98</code></a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>\n",
    "created_at": "2022-06-19T08:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549430",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d"><code>3341a98</code></a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>




---

archive/issue_comments_549431.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIn the last commit I fixed a bug in `eadd_p` and optimized `homogenize` in order to fix a bug that show up in doctests from `sage.schemes.elliptic_curve.constructor`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d\"><code>3341a98</code></a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>\n",
    "created_at": "2022-06-19T08:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549431",
    "user": "https://github.com/videlec"
}
```

<div id="comment:12" align="right">comment:12</div>

In the last commit I fixed a bug in `eadd_p` and optimized `homogenize` in order to fix a bug that show up in doctests from `sage.schemes.elliptic_curve.constructor`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d"><code>3341a98</code></a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>




---

archive/issue_comments_549432.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,3 +12,11 @@\n sage: parent(y.integral(y))\n Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring\n ```\n+and\n+\n+```\n+sage: from sage.rings.polynomial.polydict import ETuple\n+sage: e = ETuple([0, 1, 0])\n+sage: e.eadd_p(0, 0).nonzero_positions()\n+[0, 1]\n+```\n``````\n",
    "created_at": "2022-06-19T08:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549432",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,3 +12,11 @@
 sage: parent(y.integral(y))
 Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring
 ```
+and
+
+```
+sage: from sage.rings.polynomial.polydict import ETuple
+sage: e = ETuple([0, 1, 0])
+sage: e.eadd_p(0, 0).nonzero_positions()
+[0, 1]
+```
``````




---

archive/issue_comments_549433.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3\"><code>0b0e48c</code></a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr></table>\n",
    "created_at": "2022-06-19T09:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549433",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3"><code>0b0e48c</code></a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr></table>




---

archive/issue_comments_549434.json:
```json
{
    "body": "Changed commit from **[`3341a98`](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)** to **[`0b0e48c`](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)**",
    "created_at": "2022-06-19T09:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549434",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3341a98`](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)** to **[`0b0e48c`](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)**



---

archive/issue_events_462431.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-19T12:32:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462431"
}
```



---

archive/issue_events_462432.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-19T12:32:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462432"
}
```



---

archive/issue_comments_549435.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n\n```\nsage -t --long src/sage/rings/tate_algebra_element.pyx  # 5 doctests failed\nsage -t --long src/sage/rings/tate_algebra_ideal.pyx  # 3 doctests failed\nsage -t --long src/sage/rings/polynomial/multi_polynomial.pyx  # 1 doctest failed\n```",
    "created_at": "2022-06-19T12:32:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549435",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>


```
sage -t --long src/sage/rings/tate_algebra_element.pyx  # 5 doctests failed
sage -t --long src/sage/rings/tate_algebra_ideal.pyx  # 3 doctests failed
sage -t --long src/sage/rings/polynomial/multi_polynomial.pyx  # 1 doctest failed
```



---

archive/issue_comments_549436.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63\"><code>fae4a25</code></a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr></table>\n",
    "created_at": "2022-06-19T13:31:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549436",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63"><code>fae4a25</code></a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr></table>




---

archive/issue_comments_549437.json:
```json
{
    "body": "Changed commit from **[`0b0e48c`](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)** to **[`fae4a25`](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)**",
    "created_at": "2022-06-19T13:31:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549437",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b0e48c`](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)** to **[`fae4a25`](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)**



---

archive/issue_comments_549438.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n`@`Xavier Caruso: now that I made systematic zero coefficient removal in `polydict.pyx` I have trouble with Tate algebras. Namely, it seems that you always want to keep zeros there even though there is no natural way we can make difference between exact and inexact zero in the base ring\n\n```\nsage: R = Zp(2, print_mode='digits', prec=10)\nsage: R(0, 5).is_zero()\nTrue\nsage: R(0, 5) == R(0)\nTrue\nsage: not (R(0, 5) != R(0))\nTrue\n```\nThis affects code such as\n\n```\nsage: R = Zp(2, print_mode='digits', prec=10)\nsage: A.<x,y> = TateAlgebra(R)\nsage: f = 1 + 64*x\nsage: f -= R(1, 5)\nsage: f\n...00000 + ...0000000001000000*x\n```\nwhich now returns `...0000000001000000*x`.\n\nOn the other hand, I believe that the code in Tate algebra is buggy for the following reason. The conversion `R -> A` does not commute with binary operations\n\n```\nsage: R = Zp(2, print_mode='digits', prec=10)\nsage: A.<x,y> = TateAlgebra(R)\nsage: A(R(1)) - A(R(1,5))\n...00000\nsage: A(R(1) - R(1,5))\n0\n```\nThe following is also broken\n\n```\nsage: A({(1,1): R(0,5)})\n0\n```\n(it should have been `R(0,5)*x*y` which prints as `...00000*x*y`)\n\nThe main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.",
    "created_at": "2022-06-19T13:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549438",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

`@`Xavier Caruso: now that I made systematic zero coefficient removal in `polydict.pyx` I have trouble with Tate algebras. Namely, it seems that you always want to keep zeros there even though there is no natural way we can make difference between exact and inexact zero in the base ring

```
sage: R = Zp(2, print_mode='digits', prec=10)
sage: R(0, 5).is_zero()
True
sage: R(0, 5) == R(0)
True
sage: not (R(0, 5) != R(0))
True
```
This affects code such as

```
sage: R = Zp(2, print_mode='digits', prec=10)
sage: A.<x,y> = TateAlgebra(R)
sage: f = 1 + 64*x
sage: f -= R(1, 5)
sage: f
...00000 + ...0000000001000000*x
```
which now returns `...0000000001000000*x`.

On the other hand, I believe that the code in Tate algebra is buggy for the following reason. The conversion `R -> A` does not commute with binary operations

```
sage: R = Zp(2, print_mode='digits', prec=10)
sage: A.<x,y> = TateAlgebra(R)
sage: A(R(1)) - A(R(1,5))
...00000
sage: A(R(1) - R(1,5))
0
```
The following is also broken

```
sage: A({(1,1): R(0,5)})
0
```
(it should have been `R(0,5)*x*y` which prints as `...00000*x*y`)

The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.



---

archive/issue_comments_549439.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFor the same reason as in [comment:16](#comment%3A16) multivariate polynomials over p-adics are similarly broken in the current sage\n\n```\nsage: R = Zp(2)\nsage: Rxy.<x,y> = R[]\nsage: Rxy(R(0,5))\n0\nsage: x - x\n0\n```",
    "created_at": "2022-06-19T18:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549439",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">comment:17</div>

For the same reason as in [comment:16](#comment%3A16) multivariate polynomials over p-adics are similarly broken in the current sage

```
sage: R = Zp(2)
sage: Rxy.<x,y> = R[]
sage: Rxy(R(0,5))
0
sage: x - x
0
```



---

archive/issue_comments_549440.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@videlec](#comment%3A17):\n> For the same reason as in [comment:16](#comment%3A16) multivariate polynomials over p-adics are similarly broken in the current sage\n> \n> ```\n> sage: R = Zp(2)\n> sage: Rxy.<x,y> = R[]\n> sage: Rxy(R(0,5))\n> 0\n> sage: x - x\n> 0\n> ```\n\nhmm as well as multivariate polynomial rings over power series\n\n```\nsage: R.<x> = PowerSeriesRing(QQ)\nsage: A.<y,z> = R[]\nsage: O(x^3) * y\n0\n```",
    "created_at": "2022-06-19T18:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549440",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@videlec](#comment%3A17):
> For the same reason as in [comment:16](#comment%3A16) multivariate polynomials over p-adics are similarly broken in the current sage
> 
> ```
> sage: R = Zp(2)
> sage: Rxy.<x,y> = R[]
> sage: Rxy(R(0,5))
> 0
> sage: x - x
> 0
> ```

hmm as well as multivariate polynomial rings over power series

```
sage: R.<x> = PowerSeriesRing(QQ)
sage: A.<y,z> = R[]
sage: O(x^3) * y
0
```



---

archive/issue_comments_549441.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@videlec](#comment%3A16):\n> The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.\n\nI think you can use the method `_is_exact_zero` for padics.\n\nI'll have a look at the bug in coercion from base ring to Tate algebra you noticed.",
    "created_at": "2022-06-19T18:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549441",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@videlec](#comment%3A16):
> The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.

I think you can use the method `_is_exact_zero` for padics.

I'll have a look at the bug in coercion from base ring to Tate algebra you noticed.



---

archive/issue_comments_549442.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@xcaruso](#comment%3A19):\n> Replying to [@videlec](#comment%3A16):\n> > The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.\n\n> \n> I think you can use the method `_is_exact_zero` for padics.\n\nThanks. Though very specific to p-adics. And it does not exist for power series.\n\n> I'll have a look at the bug in coercion from base ring to Tate algebra you noticed.\n\nIt is not a bug in the coercion system. It is the way elements of the Tate algebra are constructed. The `PolyDict` class does a cleaning of zero coefficients in its input.",
    "created_at": "2022-06-19T18:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549442",
    "user": "https://github.com/videlec"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@xcaruso](#comment%3A19):
> Replying to [@videlec](#comment%3A16):
> > The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.

> 
> I think you can use the method `_is_exact_zero` for padics.

Thanks. Though very specific to p-adics. And it does not exist for power series.

> I'll have a look at the bug in coercion from base ring to Tate algebra you noticed.

It is not a bug in the coercion system. It is the way elements of the Tate algebra are constructed. The `PolyDict` class does a cleaning of zero coefficients in its input.



---

archive/issue_comments_549443.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAs far as this ticket is concerned there is an easy way out : leave simplification of zero coefficients in `PolyDict` to the user (via the `PolyDict.remove_zeros` method). This will solve the construction issues with Tate algebra.\n\nI opened ticket #34024 to fix polynomials.",
    "created_at": "2022-06-19T18:44:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549443",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

As far as this ticket is concerned there is an easy way out : leave simplification of zero coefficients in `PolyDict` to the user (via the `PolyDict.remove_zeros` method). This will solve the construction issues with Tate algebra.

I opened ticket #34024 to fix polynomials.



---

archive/issue_comments_549444.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c\"><code>680f8e0</code></a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr></table>\n",
    "created_at": "2022-06-19T19:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549444",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c"><code>680f8e0</code></a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr></table>




---

archive/issue_comments_549445.json:
```json
{
    "body": "Changed commit from **[`fae4a25`](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)** to **[`680f8e0`](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)**",
    "created_at": "2022-06-19T19:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549445",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fae4a25`](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)** to **[`680f8e0`](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)**



---

archive/issue_comments_549446.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n`@`Xavier Caruso Even with [comment:21](#comment%3A21) implemented I got the following failure\n\n```\nsage -t --random-seed=31078045756822634162710736872151007113 tate_algebra_ideal.pyx\n**********************************************************************\nFile \"tate_algebra_ideal.pyx\", line 857, in sage.rings.tate_algebra_ideal.groebner_basis_pote\nFailed example:\n    I.groebner_basis(algorithm=\"PoTe\", prec=100)  # indirect doctest\nExpected:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]\nGot:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]\n**********************************************************************\nFile \"tate_algebra_ideal.pyx\", line 1104, in sage.rings.tate_algebra_ideal.groebner_basis_vapote\nFailed example:\n    I.groebner_basis(algorithm=\"VaPoTe\", prec=100)  # indirect doctest\nExpected:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]\nGot:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]\n**********************************************************************\n2 items had failures:\n   1 of   9 in sage.rings.tate_algebra_ideal.groebner_basis_pote\n   1 of  10 in sage.rings.tate_algebra_ideal.groebner_basis_vapote\n    [126 tests, 2 failures, 3.46 s]\n```\n\nAlso, it did not magically fix [comment:16](#comment%3A16) since Tate algebras use multivariate polynomials over p-adic rings...",
    "created_at": "2022-06-19T19:34:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549446",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

`@`Xavier Caruso Even with [comment:21](#comment%3A21) implemented I got the following failure

```
sage -t --random-seed=31078045756822634162710736872151007113 tate_algebra_ideal.pyx
**********************************************************************
File "tate_algebra_ideal.pyx", line 857, in sage.rings.tate_algebra_ideal.groebner_basis_pote
Failed example:
    I.groebner_basis(algorithm="PoTe", prec=100)  # indirect doctest
Expected:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]
Got:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]
**********************************************************************
File "tate_algebra_ideal.pyx", line 1104, in sage.rings.tate_algebra_ideal.groebner_basis_vapote
Failed example:
    I.groebner_basis(algorithm="VaPoTe", prec=100)  # indirect doctest
Expected:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]
Got:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]
**********************************************************************
2 items had failures:
   1 of   9 in sage.rings.tate_algebra_ideal.groebner_basis_pote
   1 of  10 in sage.rings.tate_algebra_ideal.groebner_basis_vapote
    [126 tests, 2 failures, 3.46 s]
```

Also, it did not magically fix [comment:16](#comment%3A16) since Tate algebras use multivariate polynomials over p-adic rings...



---

archive/issue_comments_549447.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@videlec](#comment%3A23):\n> `@`Xavier Caruso Even with [comment:21](#comment%3A21) implemented I got the following failure\n\nHmm. Difficult to say what is the correct answer.\nI'll try to investigate this more but maybe, the easiest fix is to change the doctest.",
    "created_at": "2022-06-20T08:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549447",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@videlec](#comment%3A23):
> `@`Xavier Caruso Even with [comment:21](#comment%3A21) implemented I got the following failure

Hmm. Difficult to say what is the correct answer.
I'll try to investigate this more but maybe, the easiest fix is to change the doctest.



---

archive/issue_comments_549448.json:
```json
{
    "body": "Changed commit from **[`680f8e0`](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)** to **[`52c5a25`](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)**",
    "created_at": "2022-08-12T16:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549448",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`680f8e0`](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)** to **[`52c5a25`](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)**



---

archive/issue_comments_549449.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54bacfb67874aa9264e3e8e7ee4abbd768daad49\"><code>54bacfb</code></a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f08c970f15f52507b755ee3a1183f99d2c4fec5\"><code>1f08c97</code></a></td><td><code>34000: two little optimizations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e597bd7a9e322a50cf3f663b2463bd659159e981\"><code>e597bd7</code></a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6eb9e54a4863a5b6c0194abc2d9abe590666967\"><code>b6eb9e5</code></a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5966dc3250211b5ff627e14142890176819cf99a\"><code>5966dc3</code></a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c026ec8f4016a7eb9a360acae398abd380059ad\"><code>0c026ec</code></a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e0aa5c39517624d2707f4e13369b164283b56b3\"><code>5e0aa5c</code></a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49e78f99405bea5fc75237f36749ee1024f4e0dc\"><code>49e78f9</code></a></td><td><code>34000: fix doctest in multi_polynomial.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a19ca7cf2e9db5fae7aa3c85de5f5de003f65200\"><code>a19ca7c</code></a></td><td><code>34000: change tate algebras doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924\"><code>52c5a25</code></a></td><td><code>34000: doc details</code></td></tr></table>\n",
    "created_at": "2022-08-12T16:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549449",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54bacfb67874aa9264e3e8e7ee4abbd768daad49"><code>54bacfb</code></a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f08c970f15f52507b755ee3a1183f99d2c4fec5"><code>1f08c97</code></a></td><td><code>34000: two little optimizations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e597bd7a9e322a50cf3f663b2463bd659159e981"><code>e597bd7</code></a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6eb9e54a4863a5b6c0194abc2d9abe590666967"><code>b6eb9e5</code></a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5966dc3250211b5ff627e14142890176819cf99a"><code>5966dc3</code></a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c026ec8f4016a7eb9a360acae398abd380059ad"><code>0c026ec</code></a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e0aa5c39517624d2707f4e13369b164283b56b3"><code>5e0aa5c</code></a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49e78f99405bea5fc75237f36749ee1024f4e0dc"><code>49e78f9</code></a></td><td><code>34000: fix doctest in multi_polynomial.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a19ca7cf2e9db5fae7aa3c85de5f5de003f65200"><code>a19ca7c</code></a></td><td><code>34000: change tate algebras doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924"><code>52c5a25</code></a></td><td><code>34000: doc details</code></td></tr></table>




---

archive/issue_events_462433.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-08-12T16:02:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462433"
}
```



---

archive/issue_events_462434.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-08-12T16:02:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462434"
}
```



---

archive/issue_comments_549450.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nrebased on 9.7.beta8 and failing doctests modified",
    "created_at": "2022-08-12T16:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549450",
    "user": "https://github.com/videlec"
}
```

<div id="comment:26" align="right">comment:26</div>

rebased on 9.7.beta8 and failing doctests modified



---

archive/issue_comments_549451.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\ngreen bot",
    "created_at": "2022-08-13T06:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549451",
    "user": "https://github.com/videlec"
}
```

<div id="comment:27" align="right">comment:27</div>

green bot



---

archive/issue_comments_549452.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI think some timings are needed here before a positive review to see what sort of speed regressions we incur because we no longer have the option to turn off certain features and checks.\n\nWhy is addition the only operation that gets a special in-place operation? I think it would be good to make this universal.\n\nIt is generally not a good ideal to check `if type(e) is not ETuple:`. I understand this is faster than `isinstance(e, ETuple)`, but it is less future-proof if someone subclasses `ETuple`.\n\nNaively coverage seems to have decreased; e.g., `__len__` no longer has documentation. It is a bit of a misdirect that the coverage has increased as it is just total percentage.",
    "created_at": "2022-08-16T06:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-549452",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

I think some timings are needed here before a positive review to see what sort of speed regressions we incur because we no longer have the option to turn off certain features and checks.

Why is addition the only operation that gets a special in-place operation? I think it would be good to make this universal.

It is generally not a good ideal to check `if type(e) is not ETuple:`. I understand this is faster than `isinstance(e, ETuple)`, but it is less future-proof if someone subclasses `ETuple`.

Naively coverage seems to have decreased; e.g., `__len__` no longer has documentation. It is a bit of a misdirect that the coverage has increased as it is just total percentage.



---

archive/issue_events_462435.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462435"
}
```



---

archive/issue_events_462436.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-462436"
}
```
