# Issue 34000: cleaning and enhancement to PolyDict

archive/issues_033763.json:
```json
{
    "assignees": [],
    "body": "We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.\n\nWe also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).\n\nAlong the way, we fix\n\n```\nsage: R = ZZ['x']['y,z']\nsage: y, z = R.gens()\nsage: y.integral(y)\n1/2*y^2\nsage: parent(y.integral(y))\nMultivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring\n```\nand\n\n```\nsage: from sage.rings.polynomial.polydict import ETuple\nsage: e = ETuple([0, 1, 0])\nsage: e.eadd_p(0, 0).nonzero_positions()\n[0, 1]\n```\n\n**CC:**  @xcaruso @mezzarobba @saraedum\n\n**Branch:** [u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000)\n\n**Commit:** [52c5a25197b4de018007c15bfa8fac51686c9924](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)\n\n**Author:** Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/34000\n\n",
    "created_at": "2022-06-16T09:04:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "cleaning and enhancement to PolyDict",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/34000",
    "user": "https://github.com/videlec"
}
```
We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.

We also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).

Along the way, we fix

```
sage: R = ZZ['x']['y,z']
sage: y, z = R.gens()
sage: y.integral(y)
1/2*y^2
sage: parent(y.integral(y))
Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring
```
and

```
sage: from sage.rings.polynomial.polydict import ETuple
sage: e = ETuple([0, 1, 0])
sage: e.eadd_p(0, 0).nonzero_positions()
[0, 1]
```

**CC:**  @xcaruso @mezzarobba @saraedum

**Branch:** [u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000)

**Commit:** [52c5a25197b4de018007c15bfa8fac51686c9924](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)

**Author:** Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/34000





---

archive/issue_events_410547.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T09:04:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410547"
}
```



---

archive/issue_events_410548.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T09:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "08517b",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410548"
}
```



---

archive/issue_events_410549.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T09:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410549"
}
```



---

archive/issue_comments_552065.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,14 @@\n+We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.\n \n+We also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).\n+\n+Along the way, we fix\n+\n+```\n+sage: R = ZZ['x']['y,z']\n+sage: y, z = R.gens()\n+sage: y.integral(y)\n+1/2*y^2\n+sage: parent(y.integral(y))\n+Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring\n+```\n``````\n",
    "created_at": "2022-06-16T09:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552065",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,14 @@
+We provide some cleaning and speed up to the `PolyDict` class by always enforcing keys to be `ETuple` (some parts of the code did assume that was the case). As a consequence we deprecate the usage of the constructor arguments `force_int_exponents` and `force_etuples`.
 
+We also simplify the design by getting rid of `PolyDict.__zero` (and hence deprecating the argument `zero` of the `PolyDict` constructor).
+
+Along the way, we fix
+
+```
+sage: R = ZZ['x']['y,z']
+sage: y, z = R.gens()
+sage: y.integral(y)
+1/2*y^2
+sage: parent(y.integral(y))
+Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring
+```
``````




---

archive/issue_comments_552066.json:
```json
{
    "body": "**Commit:** [e48d7414f7946de6f0d8ff9485326db2413645af](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)",
    "created_at": "2022-06-16T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552066",
    "user": "https://github.com/videlec"
}
```

**Commit:** [e48d7414f7946de6f0d8ff9485326db2413645af](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)



---

archive/issue_comments_552067.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000)",
    "created_at": "2022-06-16T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552067",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/34000](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/34000)



---

archive/issue_comments_552068.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7deaa248c1782ebad19bb6723e0f8a4f6d4ddb10\">7deaa24</a></td><td><code>34000: cleaning and enhancement to polydict</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af\">e48d741</a></td><td><code>34000: remove PolyDict.__pow__</code></td></tr></table>\n",
    "created_at": "2022-06-16T16:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552068",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'>**Comment 2:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7deaa248c1782ebad19bb6723e0f8a4f6d4ddb10">7deaa24</a></td><td><code>34000: cleaning and enhancement to polydict</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af">e48d741</a></td><td><code>34000: remove PolyDict.__pow__</code></td></tr></table>




---

archive/issue_events_410550.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-16T16:28:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410550"
}
```



---

archive/issue_comments_552069.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nTwo things that I did not understand while skimming through the code:\n* in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?\n* what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?",
    "created_at": "2022-06-18T07:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552069",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:3'>**Comment 3:**</a>
Two things that I did not understand while skimming through the code:
* in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?
* what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?



---

archive/issue_comments_552070.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nReplying to [@mezzarobba](#comment%3A3):\n> Two things that I did not understand while skimming through the code:\n\nThanks for having a look.\n\n> * in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?\n\nI shamefully copied the code from univariate polynomials, see [polynomial_element.pyx#L3980-L3985](https://github.com/sagemath/sage/blob/develop/src/sage/rings/polynomial/polynomial_element.pyx#L3980-L3985)\n\n> * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?\n\nOne of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.",
    "created_at": "2022-06-18T12:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552070",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'>**Comment 4:**</a>
Replying to [@mezzarobba](#comment%3A3):
> Two things that I did not understand while skimming through the code:

Thanks for having a look.

> * in `MPolynomial_polydict.integral()`, why do you have two different code paths for determining the result's parent?

I shamefully copied the code from univariate polynomials, see [polynomial_element.pyx#L3980-L3985](https://github.com/sagemath/sage/blob/develop/src/sage/rings/polynomial/polynomial_element.pyx#L3980-L3985)

> * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?

One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.



---

archive/issue_comments_552071.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nReplying to [@videlec](#comment%3A4):\n> > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?\n\n> \n> One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.\n\nSorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).",
    "created_at": "2022-06-18T18:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552071",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:5'>**Comment 5:**</a>
Replying to [@videlec](#comment%3A4):
> > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?

> 
> One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.

Sorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).



---

archive/issue_comments_552072.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6eac6b0e29605fae248f280de33563afce301347\">6eac6b0</a></td><td><code>34000: cleaner optimization in derivative/integral</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/065d42eac965a8b276044d2487eb82a979efca4a\">065d42e</a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53\">48413be</a></td><td><code>34000: two little optimizations</code></td></tr></table>\n",
    "created_at": "2022-06-18T19:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552072",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6eac6b0e29605fae248f280de33563afce301347">6eac6b0</a></td><td><code>34000: cleaner optimization in derivative/integral</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/065d42eac965a8b276044d2487eb82a979efca4a">065d42e</a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53">48413be</a></td><td><code>34000: two little optimizations</code></td></tr></table>




---

archive/issue_comments_552073.json:
```json
{
    "body": "**Changing commit** from \"[e48d7414f7946de6f0d8ff9485326db2413645af](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)\" to \"[48413bebee6c57b9adb9fe3cabda82bc28ee3d53](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)\".",
    "created_at": "2022-06-18T19:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552073",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e48d7414f7946de6f0d8ff9485326db2413645af](https://github.com/sagemath/sagetrac-mirror/commit/e48d7414f7946de6f0d8ff9485326db2413645af)" to "[48413bebee6c57b9adb9fe3cabda82bc28ee3d53](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)".



---

archive/issue_comments_552074.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nReplying to [@mezzarobba](#comment%3A5):\n> Replying to [@videlec](#comment%3A4):\n> > > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?\n\n> > \n> > One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.\n\n> \n> Sorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).\n\nIt is really a `RuntimeError` : it is assumed that keys are `ETuple` and coefficients are nonzero.",
    "created_at": "2022-06-18T19:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552074",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'>**Comment 7:**</a>
Replying to [@mezzarobba](#comment%3A5):
> Replying to [@videlec](#comment%3A4):
> > > * what do the `RuntimeError`s now raised by `PolyDict` on various occasions correspond to?

> > 
> > One of them is ensuring that keys are `ETuple`. All others are here because I also made uniform that no coefficient is zero. At least, it did not break any test.

> 
> Sorry, my question was not clear. I was mostly wondering why you were raising `RuntimeError`s rather than `ValueError`s/`TypeError`s/... (if the purpose was argument checking) or using assertions (if you wanted to guard against things that should never happen).

It is really a `RuntimeError` : it is assumed that keys are `ETuple` and coefficients are nonzero.



---

archive/issue_comments_552075.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nI hope I clarified the code related to your comments in \u200b6eac6b0 and 065d42e.",
    "created_at": "2022-06-18T19:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552075",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'>**Comment 8:**</a>
I hope I clarified the code related to your comments in â€‹6eac6b0 and 065d42e.



---

archive/issue_comments_552076.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nLet me change `RuntimeError` for assertions.",
    "created_at": "2022-06-18T19:39:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552076",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'>**Comment 9:**</a>
Let me change `RuntimeError` for assertions.



---

archive/issue_comments_552077.json:
```json
{
    "body": "**Changing commit** from \"[48413bebee6c57b9adb9fe3cabda82bc28ee3d53](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)\" to \"[f6c689385b372a7dfb59c806808eb51033f22ddb](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)\".",
    "created_at": "2022-06-18T19:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552077",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[48413bebee6c57b9adb9fe3cabda82bc28ee3d53](https://github.com/sagemath/sagetrac-mirror/commit/48413bebee6c57b9adb9fe3cabda82bc28ee3d53)" to "[f6c689385b372a7dfb59c806808eb51033f22ddb](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)".



---

archive/issue_comments_552078.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb\">f6c6893</a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr></table>\n",
    "created_at": "2022-06-18T19:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552078",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>**Comment 10:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb">f6c6893</a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr></table>




---

archive/issue_comments_552079.json:
```json
{
    "body": "**Changing commit** from \"[f6c689385b372a7dfb59c806808eb51033f22ddb](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)\" to \"[3341a9866747e6f06445cc893f6946577427364d](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)\".",
    "created_at": "2022-06-19T08:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552079",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f6c689385b372a7dfb59c806808eb51033f22ddb](https://github.com/sagemath/sagetrac-mirror/commit/f6c689385b372a7dfb59c806808eb51033f22ddb)" to "[3341a9866747e6f06445cc893f6946577427364d](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)".



---

archive/issue_comments_552080.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d\">3341a98</a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>\n",
    "created_at": "2022-06-19T08:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552080",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>**Comment 11:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d">3341a98</a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>




---

archive/issue_comments_552081.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nIn the last commit I fixed a bug in `eadd_p` and optimized `homogenize` in order to fix a bug that show up in doctests from `sage.schemes.elliptic_curve.constructor`.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d\">3341a98</a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>\n",
    "created_at": "2022-06-19T08:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552081",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'>**Comment 12:**</a>
In the last commit I fixed a bug in `eadd_p` and optimized `homogenize` in order to fix a bug that show up in doctests from `sage.schemes.elliptic_curve.constructor`.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d">3341a98</a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr></table>




---

archive/issue_comments_552082.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,3 +12,11 @@\n sage: parent(y.integral(y))\n Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring\n ```\n+and\n+\n+```\n+sage: from sage.rings.polynomial.polydict import ETuple\n+sage: e = ETuple([0, 1, 0])\n+sage: e.eadd_p(0, 0).nonzero_positions()\n+[0, 1]\n+```\n``````\n",
    "created_at": "2022-06-19T08:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552082",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,3 +12,11 @@
 sage: parent(y.integral(y))
 Multivariate Polynomial Ring in y, z over Univariate Polynomial Ring in x over Integer Ring
 ```
+and
+
+```
+sage: from sage.rings.polynomial.polydict import ETuple
+sage: e = ETuple([0, 1, 0])
+sage: e.eadd_p(0, 0).nonzero_positions()
+[0, 1]
+```
``````




---

archive/issue_comments_552083.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3\">0b0e48c</a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr></table>\n",
    "created_at": "2022-06-19T09:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552083",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>**Comment 13:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3">0b0e48c</a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr></table>




---

archive/issue_comments_552084.json:
```json
{
    "body": "**Changing commit** from \"[3341a9866747e6f06445cc893f6946577427364d](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)\" to \"[0b0e48c6f62098d21aeb9b899f942062623dbec3](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)\".",
    "created_at": "2022-06-19T09:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552084",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[3341a9866747e6f06445cc893f6946577427364d](https://github.com/sagemath/sagetrac-mirror/commit/3341a9866747e6f06445cc893f6946577427364d)" to "[0b0e48c6f62098d21aeb9b899f942062623dbec3](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)".



---

archive/issue_events_410551.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-19T12:32:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410551"
}
```



---

archive/issue_events_410552.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-06-19T12:32:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410552"
}
```



---

archive/issue_comments_552085.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\n\n```\nsage -t --long src/sage/rings/tate_algebra_element.pyx  # 5 doctests failed\nsage -t --long src/sage/rings/tate_algebra_ideal.pyx  # 3 doctests failed\nsage -t --long src/sage/rings/polynomial/multi_polynomial.pyx  # 1 doctest failed\n```",
    "created_at": "2022-06-19T12:32:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552085",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'>**Comment 14:**</a>

```
sage -t --long src/sage/rings/tate_algebra_element.pyx  # 5 doctests failed
sage -t --long src/sage/rings/tate_algebra_ideal.pyx  # 3 doctests failed
sage -t --long src/sage/rings/polynomial/multi_polynomial.pyx  # 1 doctest failed
```



---

archive/issue_comments_552086.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63\">fae4a25</a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr></table>\n",
    "created_at": "2022-06-19T13:31:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552086",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>**Comment 15:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63">fae4a25</a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr></table>




---

archive/issue_comments_552087.json:
```json
{
    "body": "**Changing commit** from \"[0b0e48c6f62098d21aeb9b899f942062623dbec3](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)\" to \"[fae4a257a688f9bbc731bf361e84c6f990a50c63](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)\".",
    "created_at": "2022-06-19T13:31:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552087",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0b0e48c6f62098d21aeb9b899f942062623dbec3](https://github.com/sagemath/sagetrac-mirror/commit/0b0e48c6f62098d21aeb9b899f942062623dbec3)" to "[fae4a257a688f9bbc731bf361e84c6f990a50c63](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)".



---

archive/issue_comments_552088.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\n`@`Xavier Caruso: now that I made systematic zero coefficient removal in `polydict.pyx` I have trouble with Tate algebras. Namely, it seems that you always want to keep zeros there even though there is no natural way we can make difference between exact and inexact zero in the base ring\n\n```\nsage: R = Zp(2, print_mode='digits', prec=10)\nsage: R(0, 5).is_zero()\nTrue\nsage: R(0, 5) == R(0)\nTrue\nsage: not (R(0, 5) != R(0))\nTrue\n```\nThis affects code such as\n\n```\nsage: R = Zp(2, print_mode='digits', prec=10)\nsage: A.<x,y> = TateAlgebra(R)\nsage: f = 1 + 64*x\nsage: f -= R(1, 5)\nsage: f\n...00000 + ...0000000001000000*x\n```\nwhich now returns `...0000000001000000*x`.\n\nOn the other hand, I believe that the code in Tate algebra is buggy for the following reason. The conversion `R -> A` does not commute with binary operations\n\n```\nsage: R = Zp(2, print_mode='digits', prec=10)\nsage: A.<x,y> = TateAlgebra(R)\nsage: A(R(1)) - A(R(1,5))\n...00000\nsage: A(R(1) - R(1,5))\n0\n```\nThe following is also broken\n\n```\nsage: A({(1,1): R(0,5)})\n0\n```\n(it should have been `R(0,5)*x*y` which prints as `...00000*x*y`)\n\nThe main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.",
    "created_at": "2022-06-19T13:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552088",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'>**Comment 16:**</a>
`@`Xavier Caruso: now that I made systematic zero coefficient removal in `polydict.pyx` I have trouble with Tate algebras. Namely, it seems that you always want to keep zeros there even though there is no natural way we can make difference between exact and inexact zero in the base ring

```
sage: R = Zp(2, print_mode='digits', prec=10)
sage: R(0, 5).is_zero()
True
sage: R(0, 5) == R(0)
True
sage: not (R(0, 5) != R(0))
True
```
This affects code such as

```
sage: R = Zp(2, print_mode='digits', prec=10)
sage: A.<x,y> = TateAlgebra(R)
sage: f = 1 + 64*x
sage: f -= R(1, 5)
sage: f
...00000 + ...0000000001000000*x
```
which now returns `...0000000001000000*x`.

On the other hand, I believe that the code in Tate algebra is buggy for the following reason. The conversion `R -> A` does not commute with binary operations

```
sage: R = Zp(2, print_mode='digits', prec=10)
sage: A.<x,y> = TateAlgebra(R)
sage: A(R(1)) - A(R(1,5))
...00000
sage: A(R(1) - R(1,5))
0
```
The following is also broken

```
sage: A({(1,1): R(0,5)})
0
```
(it should have been `R(0,5)*x*y` which prints as `...00000*x*y`)

The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.



---

archive/issue_comments_552089.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nFor the same reason as in [This is the Trac macro *comment:16* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:16-macro) multivariate polynomials over p-adics are similarly broken in the current sage\n\n```\nsage: R = Zp(2)\nsage: Rxy.<x,y> = R[]\nsage: Rxy(R(0,5))\n0\nsage: x - x\n0\n```",
    "created_at": "2022-06-19T18:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552089",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'>**Comment 17:**</a>
For the same reason as in [This is the Trac macro *comment:16* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:16-macro) multivariate polynomials over p-adics are similarly broken in the current sage

```
sage: R = Zp(2)
sage: Rxy.<x,y> = R[]
sage: Rxy(R(0,5))
0
sage: x - x
0
```



---

archive/issue_comments_552090.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nReplying to [@videlec](#comment%3A17):\n> For the same reason as in [This is the Trac macro *comment:16* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:16-macro) multivariate polynomials over p-adics are similarly broken in the current sage\n> \n> ```\n> sage: R = Zp(2)\n> sage: Rxy.<x,y> = R[]\n> sage: Rxy(R(0,5))\n> 0\n> sage: x - x\n> 0\n> ```\n\nhmm as well as multivariate polynomial rings over power series\n\n```\nsage: R.<x> = PowerSeriesRing(QQ)\nsage: A.<y,z> = R[]\nsage: O(x^3) * y\n0\n```",
    "created_at": "2022-06-19T18:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552090",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'>**Comment 18:**</a>
Replying to [@videlec](#comment%3A17):
> For the same reason as in [This is the Trac macro *comment:16* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:16-macro) multivariate polynomials over p-adics are similarly broken in the current sage
> 
> ```
> sage: R = Zp(2)
> sage: Rxy.<x,y> = R[]
> sage: Rxy(R(0,5))
> 0
> sage: x - x
> 0
> ```

hmm as well as multivariate polynomial rings over power series

```
sage: R.<x> = PowerSeriesRing(QQ)
sage: A.<y,z> = R[]
sage: O(x^3) * y
0
```



---

archive/issue_comments_552091.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nReplying to [@videlec](#comment%3A16):\n> The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.\n\nI think you can use the method `_is_exact_zero` for padics.\n\nI'll have a look at the bug in coercion from base ring to Tate algebra you noticed.",
    "created_at": "2022-06-19T18:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552091",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:19'>**Comment 19:**</a>
Replying to [@videlec](#comment%3A16):
> The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.

I think you can use the method `_is_exact_zero` for padics.

I'll have a look at the bug in coercion from base ring to Tate algebra you noticed.



---

archive/issue_comments_552092.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nReplying to [@xcaruso](#comment%3A19):\n> Replying to [@videlec](#comment%3A16):\n> > The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.\n\n> \n> I think you can use the method `_is_exact_zero` for padics.\n\nThanks. Though very specific to p-adics. And it does not exist for power series.\n\n> I'll have a look at the bug in coercion from base ring to Tate algebra you noticed.\n\nIt is not a bug in the coercion system. It is the way elements of the Tate algebra are constructed. The `PolyDict` class does a cleaning of zero coefficients in its input.",
    "created_at": "2022-06-19T18:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552092",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'>**Comment 20:**</a>
Replying to [@xcaruso](#comment%3A19):
> Replying to [@videlec](#comment%3A16):
> > The main question is : how do we test whether an element is exactly zero in `R` ? `r.precision_absolute() == infinity and r.is_zero()`? I could introduce an attribute `zero_test` in `PolyDict` to make this check consistently.

> 
> I think you can use the method `_is_exact_zero` for padics.

Thanks. Though very specific to p-adics. And it does not exist for power series.

> I'll have a look at the bug in coercion from base ring to Tate algebra you noticed.

It is not a bug in the coercion system. It is the way elements of the Tate algebra are constructed. The `PolyDict` class does a cleaning of zero coefficients in its input.



---

archive/issue_comments_552093.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nAs far as this ticket is concerned there is an easy way out : leave simplification of zero coefficients in `PolyDict` to the user (via the `PolyDict.remove_zeros` method). This will solve the construction issues with Tate algebra.\n\nI opened ticket #34024 to fix polynomials.",
    "created_at": "2022-06-19T18:44:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552093",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'>**Comment 21:**</a>
As far as this ticket is concerned there is an easy way out : leave simplification of zero coefficients in `PolyDict` to the user (via the `PolyDict.remove_zeros` method). This will solve the construction issues with Tate algebra.

I opened ticket #34024 to fix polynomials.



---

archive/issue_comments_552094.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c\">680f8e0</a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr></table>\n",
    "created_at": "2022-06-19T19:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552094",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>**Comment 22:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c">680f8e0</a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr></table>




---

archive/issue_comments_552095.json:
```json
{
    "body": "**Changing commit** from \"[fae4a257a688f9bbc731bf361e84c6f990a50c63](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)\" to \"[680f8e0b4671b0a877e818bcd5590da29473319c](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)\".",
    "created_at": "2022-06-19T19:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552095",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[fae4a257a688f9bbc731bf361e84c6f990a50c63](https://github.com/sagemath/sagetrac-mirror/commit/fae4a257a688f9bbc731bf361e84c6f990a50c63)" to "[680f8e0b4671b0a877e818bcd5590da29473319c](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)".



---

archive/issue_comments_552096.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\n`@`Xavier Caruso Even with [This is the Trac macro *comment:21* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:21-macro) implemented I got the following failure\n\n```\nsage -t --random-seed=31078045756822634162710736872151007113 tate_algebra_ideal.pyx\n**********************************************************************\nFile \"tate_algebra_ideal.pyx\", line 857, in sage.rings.tate_algebra_ideal.groebner_basis_pote\nFailed example:\n    I.groebner_basis(algorithm=\"PoTe\", prec=100)  # indirect doctest\nExpected:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]\nGot:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]\n**********************************************************************\nFile \"tate_algebra_ideal.pyx\", line 1104, in sage.rings.tate_algebra_ideal.groebner_basis_vapote\nFailed example:\n    I.groebner_basis(algorithm=\"VaPoTe\", prec=100)  # indirect doctest\nExpected:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]\nGot:\n    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),\n     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),\n     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]\n**********************************************************************\n2 items had failures:\n   1 of   9 in sage.rings.tate_algebra_ideal.groebner_basis_pote\n   1 of  10 in sage.rings.tate_algebra_ideal.groebner_basis_vapote\n    [126 tests, 2 failures, 3.46 s]\n```\n\nAlso, it did not magically fix [This is the Trac macro *comment:16* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:16-macro) since Tate algebras use multivariate polynomials over p-adic rings...",
    "created_at": "2022-06-19T19:34:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552096",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'>**Comment 23:**</a>
`@`Xavier Caruso Even with [This is the Trac macro *comment:21* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:21-macro) implemented I got the following failure

```
sage -t --random-seed=31078045756822634162710736872151007113 tate_algebra_ideal.pyx
**********************************************************************
File "tate_algebra_ideal.pyx", line 857, in sage.rings.tate_algebra_ideal.groebner_basis_pote
Failed example:
    I.groebner_basis(algorithm="PoTe", prec=100)  # indirect doctest
Expected:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]
Got:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]
**********************************************************************
File "tate_algebra_ideal.pyx", line 1104, in sage.rings.tate_algebra_ideal.groebner_basis_vapote
Failed example:
    I.groebner_basis(algorithm="VaPoTe", prec=100)  # indirect doctest
Expected:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...000000000*x^2*y^3 + ...0000000000*x^3*y + O(3^99 * <x, y>)]
Got:
    [...0000000001*x^3 + ...2222222222*y + ...000000000*x^2*y^2 + O(3^99 * <x, y>),
     ...0000000001*x^2*y + ...01210121020 + O(3^100 * <x, y>),
     ...0000000001*y^2 + ...01210121020*x + ...0000000000*x^3*y + O(3^99 * <x, y>)]
**********************************************************************
2 items had failures:
   1 of   9 in sage.rings.tate_algebra_ideal.groebner_basis_pote
   1 of  10 in sage.rings.tate_algebra_ideal.groebner_basis_vapote
    [126 tests, 2 failures, 3.46 s]
```

Also, it did not magically fix [This is the Trac macro *comment:16* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:16-macro) since Tate algebras use multivariate polynomials over p-adic rings...



---

archive/issue_comments_552097.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nReplying to [@videlec](#comment%3A23):\n> `@`Xavier Caruso Even with [This is the Trac macro *comment:21* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:21-macro) implemented I got the following failure\n\nHmm. Difficult to say what is the correct answer.\nI'll try to investigate this more but maybe, the easiest fix is to change the doctest.",
    "created_at": "2022-06-20T08:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552097",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:24'>**Comment 24:**</a>
Replying to [@videlec](#comment%3A23):
> `@`Xavier Caruso Even with [This is the Trac macro *comment:21* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:21-macro) implemented I got the following failure

Hmm. Difficult to say what is the correct answer.
I'll try to investigate this more but maybe, the easiest fix is to change the doctest.



---

archive/issue_comments_552098.json:
```json
{
    "body": "**Changing commit** from \"[680f8e0b4671b0a877e818bcd5590da29473319c](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)\" to \"[52c5a25197b4de018007c15bfa8fac51686c9924](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)\".",
    "created_at": "2022-08-12T16:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552098",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[680f8e0b4671b0a877e818bcd5590da29473319c](https://github.com/sagemath/sagetrac-mirror/commit/680f8e0b4671b0a877e818bcd5590da29473319c)" to "[52c5a25197b4de018007c15bfa8fac51686c9924](https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924)".



---

archive/issue_comments_552099.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54bacfb67874aa9264e3e8e7ee4abbd768daad49\">54bacfb</a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f08c970f15f52507b755ee3a1183f99d2c4fec5\">1f08c97</a></td><td><code>34000: two little optimizations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e597bd7a9e322a50cf3f663b2463bd659159e981\">e597bd7</a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6eb9e54a4863a5b6c0194abc2d9abe590666967\">b6eb9e5</a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5966dc3250211b5ff627e14142890176819cf99a\">5966dc3</a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c026ec8f4016a7eb9a360acae398abd380059ad\">0c026ec</a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e0aa5c39517624d2707f4e13369b164283b56b3\">5e0aa5c</a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49e78f99405bea5fc75237f36749ee1024f4e0dc\">49e78f9</a></td><td><code>34000: fix doctest in multi_polynomial.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a19ca7cf2e9db5fae7aa3c85de5f5de003f65200\">a19ca7c</a></td><td><code>34000: change tate algebras doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924\">52c5a25</a></td><td><code>34000: doc details</code></td></tr></table>\n",
    "created_at": "2022-08-12T16:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552099",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'>**Comment 25:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54bacfb67874aa9264e3e8e7ee4abbd768daad49">54bacfb</a></td><td><code>34000: clarify RuntimeError</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f08c970f15f52507b755ee3a1183f99d2c4fec5">1f08c97</a></td><td><code>34000: two little optimizations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e597bd7a9e322a50cf3f663b2463bd659159e981">e597bd7</a></td><td><code>34000: replace RuntimeError with assertion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6eb9e54a4863a5b6c0194abc2d9abe590666967">b6eb9e5</a></td><td><code>34000: fix Polydict.homogenize and ETuple.eadd_p</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5966dc3250211b5ff627e14142890176819cf99a">5966dc3</a></td><td><code>34000: fix zero coefficient in PolyDict.homogenize</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c026ec8f4016a7eb9a360acae398abd380059ad">0c026ec</a></td><td><code>34000: make a copy of input in PolyDict.__init__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e0aa5c39517624d2707f4e13369b164283b56b3">5e0aa5c</a></td><td><code>34000: do not simplify zero coefficients in PolyDict</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49e78f99405bea5fc75237f36749ee1024f4e0dc">49e78f9</a></td><td><code>34000: fix doctest in multi_polynomial.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a19ca7cf2e9db5fae7aa3c85de5f5de003f65200">a19ca7c</a></td><td><code>34000: change tate algebras doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52c5a25197b4de018007c15bfa8fac51686c9924">52c5a25</a></td><td><code>34000: doc details</code></td></tr></table>




---

archive/issue_events_410553.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-08-12T16:02:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410553"
}
```



---

archive/issue_events_410554.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-08-12T16:02:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410554"
}
```



---

archive/issue_comments_552100.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nrebased on 9.7.beta8 and failing doctests modified",
    "created_at": "2022-08-12T16:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552100",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'>**Comment 26:**</a>
rebased on 9.7.beta8 and failing doctests modified



---

archive/issue_comments_552101.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\ngreen bot",
    "created_at": "2022-08-13T06:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552101",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'>**Comment 27:**</a>
green bot



---

archive/issue_comments_552102.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nI think some timings are needed here before a positive review to see what sort of speed regressions we incur because we no longer have the option to turn off certain features and checks.\n\nWhy is addition the only operation that gets a special in-place operation? I think it would be good to make this universal.\n\nIt is generally not a good ideal to check `if type(e) is not ETuple:`. I understand this is faster than `isinstance(e, ETuple)`, but it is less future-proof if someone subclasses `ETuple`.\n\nNaively coverage seems to have decreased; e.g., `__len__` no longer has documentation. It is a bit of a misdirect that the coverage has increased as it is just total percentage.",
    "created_at": "2022-08-16T06:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34000#issuecomment-552102",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'>**Comment 28:**</a>
I think some timings are needed here before a positive review to see what sort of speed regressions we incur because we no longer have the option to turn off certain features and checks.

Why is addition the only operation that gets a special in-place operation? I think it would be good to make this universal.

It is generally not a good ideal to check `if type(e) is not ETuple:`. I understand this is faster than `isinstance(e, ETuple)`, but it is less future-proof if someone subclasses `ETuple`.

Naively coverage seems to have decreased; e.g., `__len__` no longer has documentation. It is a bit of a misdirect that the coverage has increased as it is just total percentage.



---

archive/issue_events_410555.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410555"
}
```



---

archive/issue_events_410556.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34000",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34000#event-410556"
}
```
