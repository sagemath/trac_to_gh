# Issue 34506: Override the arbitrary limit on number of digits printed (Python 3.10.7)

archive/issues_034269.json:
```json
{
    "body": "Python 3.10.7 brings a breaking change that retroactively affects all Sage versions that accept system Python 3.10.x: \n\nhttps://docs.python.org/3.10/whatsnew/changelog.html#security\n\nSee also #34271\n\n\nCC:  @antonio-rojas @williamstein @yyyyx4\n\nBranch/Commit: 20f06e6eb4bdd093fe952911bb568f7ebf9141f1\n\nReviewer: Matthias Koeppe\n\nAuthor: David Roe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/34506\n\n",
    "closed_at": "2022-09-14T22:35:57Z",
    "created_at": "2022-09-08T16:06:01Z",
    "labels": [
        "component: basic arithmetic",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Override the arbitrary limit on number of digits printed (Python 3.10.7)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34506",
    "user": "https://github.com/mkoeppe"
}
```
Python 3.10.7 brings a breaking change that retroactively affects all Sage versions that accept system Python 3.10.x: 

https://docs.python.org/3.10/whatsnew/changelog.html#security

See also #34271


CC:  @antonio-rojas @williamstein @yyyyx4

Branch/Commit: 20f06e6eb4bdd093fe952911bb568f7ebf9141f1

Reviewer: Matthias Koeppe

Author: David Roe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/34506





---

archive/issue_comments_687097.json:
```json
{
    "body": "<a id='comment:1'></a>I am guessing that this could be a problem for pexpect interfaces, like the one for fricas.  We are going to hit the limit with `factorial(1558)`.",
    "created_at": "2022-09-08T16:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687097",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:1'></a>I am guessing that this could be a problem for pexpect interfaces, like the one for fricas.  We are going to hit the limit with `factorial(1558)`.



---

archive/issue_comments_687098.json:
```json
{
    "body": "<a id='comment:2'></a>Well, Python is clearly using a quadratic time algorithm for this while GMP is using a subquadratic algorithm.  I wish that Python had at least improved their algorithm when they hit this bug, rather than just setting a limit like this.\n\n```\nsage: s = '1'*1000000\nsage: %time x = int(s)\nCPU times: user 4.65 s, sys: 0 ns, total: 4.65 s\nWall time: 4.64 s\nsage: %time x = Integer(s)\nCPU times: user 32.1 ms, sys: 8.25 ms, total: 40.3 ms\nWall time: 40.3 ms\n```\n\nMy vote would be to [set](https://docs.python.org/3.10/library/stdtypes.html#int-max-str-digits) the limit to either 0 (unlimited) or 1000000 at Sage startup.  Of course, Sage Integers will be unaffected.",
    "created_at": "2022-09-08T16:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687098",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>Well, Python is clearly using a quadratic time algorithm for this while GMP is using a subquadratic algorithm.  I wish that Python had at least improved their algorithm when they hit this bug, rather than just setting a limit like this.

```
sage: s = '1'*1000000
sage: %time x = int(s)
CPU times: user 4.65 s, sys: 0 ns, total: 4.65 s
Wall time: 4.64 s
sage: %time x = Integer(s)
CPU times: user 32.1 ms, sys: 8.25 ms, total: 40.3 ms
Wall time: 40.3 ms
```

My vote would be to [set](https://docs.python.org/3.10/library/stdtypes.html#int-max-str-digits) the limit to either 0 (unlimited) or 1000000 at Sage startup.  Of course, Sage Integers will be unaffected.



---

archive/issue_comments_687099.json:
```json
{
    "body": "<a id='comment:3'></a>Similar pet peeve -- Python's arbitrary precision integer arithmetic is overall still asymptotically slow, whereas Chrome's V8 has huge integer arithmetic that is asymptotically \"competitive\" with GMP (using BigInt).  Python should too.\n\nThis is in my dev console in Chrome:\n\n```\n> n = BigInt('1'.repeat(1000000))\n11111111111111111111111111111111111111111111111111\u2026111111111111111111111111111111111111111111111111n\n> t=new Date(); s=n.toString(); new Date() - t\n207\n```\n\nBoth Safari and Firefox refuse to make large integers and complain \"Out of memory\".  So +1 to V8 here.  The code isn't too complicated either.  \n\nhttps://twitter.com/wstein389/status/1453624662819180547",
    "created_at": "2022-09-08T17:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687099",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>Similar pet peeve -- Python's arbitrary precision integer arithmetic is overall still asymptotically slow, whereas Chrome's V8 has huge integer arithmetic that is asymptotically "competitive" with GMP (using BigInt).  Python should too.

This is in my dev console in Chrome:

```
> n = BigInt('1'.repeat(1000000))
11111111111111111111111111111111111111111111111111â€¦111111111111111111111111111111111111111111111111n
> t=new Date(); s=n.toString(); new Date() - t
207
```

Both Safari and Firefox refuse to make large integers and complain "Out of memory".  So +1 to V8 here.  The code isn't too complicated either.  

https://twitter.com/wstein389/status/1453624662819180547



---

archive/issue_comments_687100.json:
```json
{
    "body": "<a id='comment:4'></a>What a pyti: I thought, if python is so slow for this, then it might even make sense to set the limit to 1 (i.e., only allow single digit strings), in order to catch all occurrences of such conversions, and then use sage integers throughout.  Unfortunately, this is not possible.  640 is the lower limit.  I wonder whether this is a Bill Gates reference.",
    "created_at": "2022-09-08T18:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687100",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:4'></a>What a pyti: I thought, if python is so slow for this, then it might even make sense to set the limit to 1 (i.e., only allow single digit strings), in order to catch all occurrences of such conversions, and then use sage integers throughout.  Unfortunately, this is not possible.  640 is the lower limit.  I wonder whether this is a Bill Gates reference.



---

archive/issue_comments_687101.json:
```json
{
    "body": "<a id='comment:5'></a>I want to try and push back on this so I opened a discussion in core Python:\nhttps://discuss.python.org/t/int-str-conversions-broken-in-latest-python-bugfix-releases/18889",
    "created_at": "2022-09-08T22:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687101",
    "user": "https://github.com/oscarbenjamin"
}
```

<a id='comment:5'></a>I want to try and push back on this so I opened a discussion in core Python:
https://discuss.python.org/t/int-str-conversions-broken-in-latest-python-bugfix-releases/18889



---

archive/issue_comments_687102.json:
```json
{
    "body": "<a id='comment:6'></a>**Thanks Oscar!!**  That ticket https://github.com/python/cpython/issues/95778 is really disturbing.",
    "created_at": "2022-09-08T23:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687102",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>**Thanks Oscar!!**  That ticket https://github.com/python/cpython/issues/95778 is really disturbing.



---

archive/issue_comments_687103.json:
```json
{
    "body": "<a id='comment:7'></a>https://news.ycombinator.com/item?id=32753235#32768343",
    "created_at": "2022-09-09T00:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687103",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:7'></a>https://news.ycombinator.com/item?id=32753235#32768343



---

archive/issue_comments_687104.json:
```json
{
    "body": "<a id='comment:9'></a>Sage lets me have `fibonacci(20578)` but pure python stops on `fibonacci(20577)`",
    "created_at": "2022-09-09T10:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687104",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:9'></a>Sage lets me have `fibonacci(20578)` but pure python stops on `fibonacci(20577)`



---

archive/issue_comments_687105.json:
```json
{
    "body": "Changing branch from \"\" to \"u/roed/bigint\"",
    "created_at": "2022-09-09T16:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687105",
    "user": "https://github.com/roed314"
}
```

Changing branch from "" to "u/roed/bigint"



---

archive/issue_comments_687106.json:
```json
{
    "body": "Changing commit from \"\" to \"7fc5a445834cfc67fa84185fc87338dbbdd8f73c\"",
    "created_at": "2022-09-09T16:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687106",
    "user": "https://github.com/roed314"
}
```

Changing commit from "" to "7fc5a445834cfc67fa84185fc87338dbbdd8f73c"



---

archive/issue_comments_687107.json:
```json
{
    "body": "<a id='comment:11'></a>Well, here's a proposal for a \"fix.\"  This doesn't solve all the problems, but I think it's an improvement from Sage's perspective.\n\n---\nNew commits:",
    "created_at": "2022-09-09T16:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687107",
    "user": "https://github.com/roed314"
}
```

<a id='comment:11'></a>Well, here's a proposal for a "fix."  This doesn't solve all the problems, but I think it's an improvement from Sage's perspective.

---
New commits:



---

archive/issue_comments_687108.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-09T16:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687108",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_687109.json:
```json
{
    "body": "Changing author from \"\" to \"David Roe\"",
    "created_at": "2022-09-09T16:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687109",
    "user": "https://github.com/roed314"
}
```

Changing author from "" to "David Roe"



---

archive/issue_comments_687110.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-09T16:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_687111.json:
```json
{
    "body": "Changing commit from \"7fc5a445834cfc67fa84185fc87338dbbdd8f73c\" to \"20f06e6eb4bdd093fe952911bb568f7ebf9141f1\"",
    "created_at": "2022-09-09T16:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7fc5a445834cfc67fa84185fc87338dbbdd8f73c" to "20f06e6eb4bdd093fe952911bb568f7ebf9141f1"



---

archive/issue_comments_687112.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-09-09T17:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687112",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_687113.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-09T17:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687113",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_687114.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2022-09-09T17:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687114",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_687115.json:
```json
{
    "body": "<a id='comment:14'></a>LGTM. We should probably get this into 9.7, so I'm setting it to \"blocker\".",
    "created_at": "2022-09-09T17:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687115",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>LGTM. We should probably get this into 9.7, so I'm setting it to "blocker".



---

archive/issue_comments_687116.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-14T22:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687116",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_089609.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-14T22:35:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34506#event-89609"
}
```



---

archive/issue_comments_687117.json:
```json
{
    "body": "Changing branch from \"u/roed/bigint\" to \"20f06e6eb4bdd093fe952911bb568f7ebf9141f1\"",
    "created_at": "2022-09-14T22:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34506#issuecomment-687117",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/roed/bigint" to "20f06e6eb4bdd093fe952911bb568f7ebf9141f1"
