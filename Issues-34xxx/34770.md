# Issue 34770: fix coercion from libgap's finite fields, use libgap in sage/rings/finite_rings

archive/issues_034533.json:
```json
{
    "assignees": [],
    "body": "implement coercion from libgap's finite fields, to fix e.g.\n\n```\nsage: F=GF(25)\nsage: F(libgap.Z(25)^3)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unable to coerce <class 'sage.libs.gap.element.GapElement_FiniteField'>\n```\n\nWith the ticket branch, this works:\n\n```\nsage: F=GF(25)\nsage: F(libgap.Z(25)^3)\n4*z2 + 3\n```\n\n---\n\nAs well, we switch to use libgap instead of pexpect GAP - internally\nin the affected files. This is a part of #26902\n\nCC:  @nbruin @mkoeppe @kwankyu\n\nBranch/Commit: **[6e5ea79](https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **number theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/34770_\n\n",
    "closed_at": "2022-12-14T22:12:21Z",
    "created_at": "2022-11-21T23:46:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fix coercion from libgap's finite fields, use libgap in sage/rings/finite_rings",
    "type": "issue",
    "updated_at": "2022-12-14T22:12:21Z",
    "url": "https://github.com/sagemath/sage/issues/34770",
    "user": "https://github.com/dimpase"
}
```
implement coercion from libgap's finite fields, to fix e.g.

```
sage: F=GF(25)
sage: F(libgap.Z(25)^3)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unable to coerce <class 'sage.libs.gap.element.GapElement_FiniteField'>
```

With the ticket branch, this works:

```
sage: F=GF(25)
sage: F(libgap.Z(25)^3)
4*z2 + 3
```

---

As well, we switch to use libgap instead of pexpect GAP - internally
in the affected files. This is a part of #26902

CC:  @nbruin @mkoeppe @kwankyu

Branch/Commit: **[6e5ea79](https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b)**

Reviewer: **Matthias Koeppe**

Author: **Dima Pasechnik**

Component: **number theory**

_Issue created by migration from https://trac.sagemath.org/ticket/34770_





---

archive/issue_events_473637.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-21T23:46:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473637"
}
```



---

archive/issue_events_473638.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-21T23:46:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473638"
}
```



---

archive/issue_events_473639.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-21T23:46:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473639"
}
```



---

archive/issue_events_473640.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-21T23:46:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473640"
}
```



---

archive/issue_comments_560945.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,8 +12,8 @@\n With the ticket branch, this works:\n \n ```\n-sage: sage: F=GF(25)\n-sage: sage: F(libgap.Z(25)^3)\n+sage: F=GF(25)\n+sage: F(libgap.Z(25)^3)\n 4*z2 + 3\n ```\n \n``````\n",
    "created_at": "2022-11-21T23:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560945",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,8 +12,8 @@
 With the ticket branch, this works:
 
 ```
-sage: sage: F=GF(25)
-sage: sage: F(libgap.Z(25)^3)
+sage: F=GF(25)
+sage: F(libgap.Z(25)^3)
 4*z2 + 3
 ```
 
``````




---

archive/issue_comments_560946.json:
```json
{
    "body": "Commit: **[02bd544](https://github.com/sagemath/sagetrac-mirror/commit/02bd544c5a0a348b2a448a9eb9f1cc7f7ae3fda0)**",
    "created_at": "2022-11-21T23:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560946",
    "user": "https://github.com/dimpase"
}
```

Commit: **[02bd544](https://github.com/sagemath/sagetrac-mirror/commit/02bd544c5a0a348b2a448a9eb9f1cc7f7ae3fda0)**



---

archive/issue_comments_560947.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02bd544c5a0a348b2a448a9eb9f1cc7f7ae3fda0\">02bd544</a></td><td><code>fix coersion of libgap FFelements; switch to libgap</code></td></tr></table>\n",
    "created_at": "2022-11-21T23:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560947",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02bd544c5a0a348b2a448a9eb9f1cc7f7ae3fda0">02bd544</a></td><td><code>fix coersion of libgap FFelements; switch to libgap</code></td></tr></table>




---

archive/issue_comments_560948.json:
```json
{
    "body": "Branch: **[u/dimpase/rings/FFEs_to_accept_libgap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rings/FFEs_to_accept_libgap)**",
    "created_at": "2022-11-21T23:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560948",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/rings/FFEs_to_accept_libgap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rings/FFEs_to_accept_libgap)**



---

archive/issue_events_473641.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-21T23:58:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473641"
}
```



---

archive/issue_comments_560949.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI've left intact the ability to accept pexpect GAP data to be converted in Sage finite field elements - this means I need a test for this type.\nI'm using an import statement \n\n```\nfrom sage.interfaces.gap import is_GapElement\n```\nand a call to `is_GapElement()`.\nIs there a way to avoid this call? I can also put the import into the `try` block and\nset `is_GapElement()` to always return `False` in case of import exception.",
    "created_at": "2022-11-22T09:56:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560949",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

I've left intact the ability to accept pexpect GAP data to be converted in Sage finite field elements - this means I need a test for this type.
I'm using an import statement 

```
from sage.interfaces.gap import is_GapElement
```
and a call to `is_GapElement()`.
Is there a way to avoid this call? I can also put the import into the `try` block and
set `is_GapElement()` to always return `False` in case of import exception.



---

archive/issue_comments_560950.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21e38a73fa41698d02ec4c00597e35b5dbd0eda6\">21e38a7</a></td><td><code>fix coersion of libgap FFelements; switch to libgap</code></td></tr></table>\n",
    "created_at": "2022-11-22T09:58:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560950",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21e38a73fa41698d02ec4c00597e35b5dbd0eda6">21e38a7</a></td><td><code>fix coersion of libgap FFelements; switch to libgap</code></td></tr></table>




---

archive/issue_comments_560951.json:
```json
{
    "body": "Changed commit from **[02bd544](https://github.com/sagemath/sagetrac-mirror/commit/02bd544c5a0a348b2a448a9eb9f1cc7f7ae3fda0)** to **[21e38a7](https://github.com/sagemath/sagetrac-mirror/commit/21e38a73fa41698d02ec4c00597e35b5dbd0eda6)**",
    "created_at": "2022-11-22T09:58:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560951",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[02bd544](https://github.com/sagemath/sagetrac-mirror/commit/02bd544c5a0a348b2a448a9eb9f1cc7f7ae3fda0)** to **[21e38a7](https://github.com/sagemath/sagetrac-mirror/commit/21e38a73fa41698d02ec4c00597e35b5dbd0eda6)**



---

archive/issue_comments_560952.json:
```json
{
    "body": "Changed commit from **[21e38a7](https://github.com/sagemath/sagetrac-mirror/commit/21e38a73fa41698d02ec4c00597e35b5dbd0eda6)** to **[d4bde80](https://github.com/sagemath/sagetrac-mirror/commit/d4bde80f350975b30e5795aa5ffc7333f5c80911)**",
    "created_at": "2022-11-22T10:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560952",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[21e38a7](https://github.com/sagemath/sagetrac-mirror/commit/21e38a73fa41698d02ec4c00597e35b5dbd0eda6)** to **[d4bde80](https://github.com/sagemath/sagetrac-mirror/commit/d4bde80f350975b30e5795aa5ffc7333f5c80911)**



---

archive/issue_comments_560953.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4bde80f350975b30e5795aa5ffc7333f5c80911\">d4bde80</a></td><td><code>make imports of is_GapEelment uniform across files</code></td></tr></table>\n",
    "created_at": "2022-11-22T10:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560953",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4bde80f350975b30e5795aa5ffc7333f5c80911">d4bde80</a></td><td><code>make imports of is_GapEelment uniform across files</code></td></tr></table>




---

archive/issue_comments_560954.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI can also resort to not calling `is_GapElement()`, and rely on exceptions - this would need a bit more rearranging of if/else. \n\nHowever, there are still explicit tests like `sage: S(gap('Z(25)^3'))`, and there is a discrepancy between `libgap` and (pexpect) `gap` in the way they treat such inputs:\n\n```\nsage: gap('Z(25)^3')\nZ(5^2)^3\nsage: gap.eval('Z(25)^3')\n'Z(5^2)^3'\nsage: libgap.eval('Z(25)^3')\nZ(5^2)^3\nsage: libgap('Z(25)^3')\n\"Z(25)^3\"\n```\n\nSo these tests will have to go as soon as `gap` is set to `libgap`.",
    "created_at": "2022-11-22T10:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560954",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

I can also resort to not calling `is_GapElement()`, and rely on exceptions - this would need a bit more rearranging of if/else. 

However, there are still explicit tests like `sage: S(gap('Z(25)^3'))`, and there is a discrepancy between `libgap` and (pexpect) `gap` in the way they treat such inputs:

```
sage: gap('Z(25)^3')
Z(5^2)^3
sage: gap.eval('Z(25)^3')
'Z(5^2)^3'
sage: libgap.eval('Z(25)^3')
Z(5^2)^3
sage: libgap('Z(25)^3')
"Z(25)^3"
```

So these tests will have to go as soon as `gap` is set to `libgap`.



---

archive/issue_comments_560955.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI am not familiar with libgap and less with GAP...\n\nThis `gfq_gap_to_sage(e, self.parent)` runs faster than `libgap(e).sage(ring=self.parent)` with me. Then why do you replace the former with the latter? Removing pexpect gap is the primary objective?",
    "created_at": "2022-11-24T03:58:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560955",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:9" align="right">comment:9</div>

I am not familiar with libgap and less with GAP...

This `gfq_gap_to_sage(e, self.parent)` runs faster than `libgap(e).sage(ring=self.parent)` with me. Then why do you replace the former with the latter? Removing pexpect gap is the primary objective?



---

archive/issue_comments_560956.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [Kwankyu Lee](#comment:9):\n \n> This `gfq_gap_to_sage(e, self.parent)` runs faster than `libgap(e).sage(ring=self.parent)` with me. \n\nLoading `libgap` takes time. After it's loaded, it should actually be faster to use\nit.\n\nIn this particular case, you only need `libgap(e)` on `e` coming from pexpect `gap`.\nSo there is an extra conversion involved, and we are getting rid of  pexpect `gap`\nanyway, so after this is done these conversions (to Sage types) will be much faster\n(they are just `e.sage(ring=self.parent)`)\n\nOne should not use pexpect `gap`, it should be deprecated. Do you want this to happen on this ticket?",
    "created_at": "2022-11-24T11:16:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560956",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [Kwankyu Lee](#comment:9):
 
> This `gfq_gap_to_sage(e, self.parent)` runs faster than `libgap(e).sage(ring=self.parent)` with me. 

Loading `libgap` takes time. After it's loaded, it should actually be faster to use
it.

In this particular case, you only need `libgap(e)` on `e` coming from pexpect `gap`.
So there is an extra conversion involved, and we are getting rid of  pexpect `gap`
anyway, so after this is done these conversions (to Sage types) will be much faster
(they are just `e.sage(ring=self.parent)`)

One should not use pexpect `gap`, it should be deprecated. Do you want this to happen on this ticket?



---

archive/issue_comments_560957.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nthe only \"real\" use of `gfq_gap_to_sage` is in sage/coding - and this is eliminated in #34771, along with the use of pexpect GAP.\n\nThus the only possible speed regression can appear in user code, while using pexpect GAP.",
    "created_at": "2022-11-24T17:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560957",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

the only "real" use of `gfq_gap_to_sage` is in sage/coding - and this is eliminated in #34771, along with the use of pexpect GAP.

Thus the only possible speed regression can appear in user code, while using pexpect GAP.



---

archive/issue_comments_560958.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-implement coersion from libgap's finite fields, to fix e.g.\n+implement coercion from libgap's finite fields, to fix e.g.\n \n ```\n sage: F=GF(25)\n``````\n",
    "created_at": "2022-11-25T00:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560958",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-implement coersion from libgap's finite fields, to fix e.g.
+implement coercion from libgap's finite fields, to fix e.g.
 
 ```
 sage: F=GF(25)
``````




---

archive/issue_events_473642.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-11-25T00:37:07Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "title_is": "fix coercion from libgap's finite fields, use libgap in sage/rings/finite_rings",
    "title_was": "fix coersion from libgap's finite fields, use libgap in sage/rings/finite_rings",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473642"
}
```



---

archive/issue_comments_560959.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [Dima Pasechnik](#comment:4):\n> I'm using an import statement \n> \n> ```\n> from sage.interfaces.gap import is_GapElement\n> ```\n> and a call to `is_GapElement()`.\n> Is there a way to avoid this call? I can also put the import into the `try` block and\n> set `is_GapElement()` to always return `False` in case of import exception.\n\nWhy is there a possibility of import exception?\n\nThe definition of `is_GapElement()` is `isinstance(x, GapElement)`. This lets you avoid the call. But perhaps I simply don't understand your intention or context...",
    "created_at": "2022-11-25T00:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560959",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [Dima Pasechnik](#comment:4):
> I'm using an import statement 
> 
> ```
> from sage.interfaces.gap import is_GapElement
> ```
> and a call to `is_GapElement()`.
> Is there a way to avoid this call? I can also put the import into the `try` block and
> set `is_GapElement()` to always return `False` in case of import exception.

Why is there a possibility of import exception?

The definition of `is_GapElement()` is `isinstance(x, GapElement)`. This lets you avoid the call. But perhaps I simply don't understand your intention or context...



---

archive/issue_comments_560960.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [Kwankyu Lee](#comment:12):\n\n> The definition of `is_GapElement()` is `isinstance(x, GapElement)`. This lets you avoid the call.\n\nGreat, this will simplify things a bit. It didn't cross my mind that `is_GapElement()`\nis that simple.",
    "created_at": "2022-11-25T00:42:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560960",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [Kwankyu Lee](#comment:12):

> The definition of `is_GapElement()` is `isinstance(x, GapElement)`. This lets you avoid the call.

Great, this will simplify things a bit. It didn't cross my mind that `is_GapElement()`
is that simple.



---

archive/issue_comments_560961.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [Dima Pasechnik](#comment:13):\n> Replying to [Kwankyu Lee](#comment:12):\n> \n> > The definition of `is_GapElement()` is `isinstance(x, GapElement)`. This lets you avoid the call.\n\n> \n> Great, this will simplify things a bit. It didn't cross my mind that `is_GapElement()`\n> is that simple.\n> \n\nwell, not really, as one still need to import `GapElement` (Cython won't even compile without it)",
    "created_at": "2022-11-25T16:12:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560961",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [Dima Pasechnik](#comment:13):
> Replying to [Kwankyu Lee](#comment:12):
> 
> > The definition of `is_GapElement()` is `isinstance(x, GapElement)`. This lets you avoid the call.

> 
> Great, this will simplify things a bit. It didn't cross my mind that `is_GapElement()`
> is that simple.
> 

well, not really, as one still need to import `GapElement` (Cython won't even compile without it)



---

archive/issue_comments_560962.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nDo you want to avoid importing from `sage.interfaces.gap`? Why?",
    "created_at": "2022-11-28T03:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560962",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:15" align="right">comment:15</div>

Do you want to avoid importing from `sage.interfaces.gap`? Why?



---

archive/issue_comments_560963.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIf this is for modularization purposes in which an import may fail: I am using this idiom for such isinstance tests:\n\n```\ntry:\n    from sage.interfaces.gap import GapElement\nexcept ImportError:\n    GapElement = ()\n\n... isinstance(x, GapElement)\n```",
    "created_at": "2022-11-28T04:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560963",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

If this is for modularization purposes in which an import may fail: I am using this idiom for such isinstance tests:

```
try:
    from sage.interfaces.gap import GapElement
except ImportError:
    GapElement = ()

... isinstance(x, GapElement)
```



---

archive/issue_comments_560964.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [Kwankyu Lee](#comment:15):\n> Do you want to avoid importing from `sage.interfaces.gap`? Why? \n\nas a preparation for deprecation and removal. We really don't need\na pexpect interface to GAP.",
    "created_at": "2022-11-28T13:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560964",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [Kwankyu Lee](#comment:15):
> Do you want to avoid importing from `sage.interfaces.gap`? Why? 

as a preparation for deprecation and removal. We really don't need
a pexpect interface to GAP.



---

archive/issue_comments_560965.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:16):\n> If this is for modularization purposes in which an import may fail: I am using this idiom for such isinstance tests:\n\nIt's for coming deprecation and removal, seems to do the job here, too.",
    "created_at": "2022-11-28T14:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560965",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [Matthias Köppe](#comment:16):
> If this is for modularization purposes in which an import may fail: I am using this idiom for such isinstance tests:

It's for coming deprecation and removal, seems to do the job here, too.



---

archive/issue_comments_560966.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAnother approach: #34804 Deprecate `sage.interfaces` `is_...Element` functions",
    "created_at": "2022-11-28T18:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560966",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Another approach: #34804 Deprecate `sage.interfaces` `is_...Element` functions



---

archive/issue_comments_560967.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [Dima Pasechnik](#comment:18):\n> Replying to [Matthias K\u00f6ppe](#comment:16):\n> > If this is for modularization purposes in which an import may fail: I am using this idiom for such isinstance tests:\n\n> \n> It's for coming deprecation and removal, seems to do the job here, too.\n\nFor deprecation it will not work so well because modules such as `sage.interfaces.gap` create an instance of the interface class at load time, which would trigger the deprecation warning already.",
    "created_at": "2022-11-28T19:16:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560967",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [Dima Pasechnik](#comment:18):
> Replying to [Matthias Köppe](#comment:16):
> > If this is for modularization purposes in which an import may fail: I am using this idiom for such isinstance tests:

> 
> It's for coming deprecation and removal, seems to do the job here, too.

For deprecation it will not work so well because modules such as `sage.interfaces.gap` create an instance of the interface class at load time, which would trigger the deprecation warning already.



---

archive/issue_comments_560968.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [Dima Pasechnik](#comment:17):\n> Replying to [Kwankyu Lee](#comment:15):\n> > Do you want to avoid importing from `sage.interfaces.gap`? Why? \n\n> \n> as a preparation for deprecation and removal. We really don't need\n> a pexpect interface to GAP.\n\nOkay. So this ticket is not removing pexpect GAP, but just drying it out(not sure if this phrase conveys the meaning). This seems to force you to write clumsy code. \n\nHow about adding only deprecation warnings without touching actual pexpect GAP code in this ticket, and then remove all of it in another ticket after deprecation period?",
    "created_at": "2022-11-29T01:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560968",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [Dima Pasechnik](#comment:17):
> Replying to [Kwankyu Lee](#comment:15):
> > Do you want to avoid importing from `sage.interfaces.gap`? Why? 

> 
> as a preparation for deprecation and removal. We really don't need
> a pexpect interface to GAP.

Okay. So this ticket is not removing pexpect GAP, but just drying it out(not sure if this phrase conveys the meaning). This seems to force you to write clumsy code. 

How about adding only deprecation warnings without touching actual pexpect GAP code in this ticket, and then remove all of it in another ticket after deprecation period?



---

archive/issue_comments_560969.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nBy the way, there is also an interesting import hell issue I encountered here: \nI'm changing here 4 files\n\n```\nsrc/sage/rings/finite_rings/element_givaro.pyx\nsrc/sage/rings/finite_rings/element_ntl_gf2e.pyx\nsrc/sage/rings/finite_rings/element_pari_ffelt.pyx\nsrc/sage/rings/finite_rings/integer_mod_ring.py\n```\nOf them, the first 3 are very similar. However, I cannot do top-level\n`from sage.libs.gap.element import GapElement_FiniteField` in each of them, only in  `element_ntl_gf2e.pyx` it does not\nlead to an obscure runtime error (`Cannot import RDF`) from libgap.",
    "created_at": "2022-11-29T09:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560969",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

By the way, there is also an interesting import hell issue I encountered here: 
I'm changing here 4 files

```
src/sage/rings/finite_rings/element_givaro.pyx
src/sage/rings/finite_rings/element_ntl_gf2e.pyx
src/sage/rings/finite_rings/element_pari_ffelt.pyx
src/sage/rings/finite_rings/integer_mod_ring.py
```
Of them, the first 3 are very similar. However, I cannot do top-level
`from sage.libs.gap.element import GapElement_FiniteField` in each of them, only in  `element_ntl_gf2e.pyx` it does not
lead to an obscure runtime error (`Cannot import RDF`) from libgap.



---

archive/issue_comments_560970.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:19):\n> Another approach: #34804 Deprecate `sage.interfaces` `is_...Element` functions\n\nOK, this is interesting. So this would mean unconditionally importing `GapElement` from \n`sage.interfaces.abs`, right? I'm only not completely sure I understand what should be in the latter, as examples such as in `src/sage/rings/abc.pyx` look like dark magic to me.",
    "created_at": "2022-11-29T15:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560970",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [Matthias Köppe](#comment:19):
> Another approach: #34804 Deprecate `sage.interfaces` `is_...Element` functions

OK, this is interesting. So this would mean unconditionally importing `GapElement` from 
`sage.interfaces.abs`, right? I'm only not completely sure I understand what should be in the latter, as examples such as in `src/sage/rings/abc.pyx` look like dark magic to me.



---

archive/issue_comments_560971.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [Dima Pasechnik](#comment:23):\n> Replying to [Matthias K\u00f6ppe](#comment:19):\n> > Another approach: #34804 Deprecate `sage.interfaces` `is_...Element` functions\n\n> \n> OK, this is interesting. So this would mean unconditionally importing `GapElement` from \n> `sage.interfaces.abs`, right? \n\nYes.\n\n> I'm only not completely sure I understand what should be in the latter, as examples such as in `src/sage/rings/abc.pyx` look like dark magic to me.\n\nI've pushed a barebones version to #34804. `src/sage/rings/abc.pyx` is longer, but it's just decoration",
    "created_at": "2022-11-29T18:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560971",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [Dima Pasechnik](#comment:23):
> Replying to [Matthias Köppe](#comment:19):
> > Another approach: #34804 Deprecate `sage.interfaces` `is_...Element` functions

> 
> OK, this is interesting. So this would mean unconditionally importing `GapElement` from 
> `sage.interfaces.abs`, right? 

Yes.

> I'm only not completely sure I understand what should be in the latter, as examples such as in `src/sage/rings/abc.pyx` look like dark magic to me.

I've pushed a barebones version to #34804. `src/sage/rings/abc.pyx` is longer, but it's just decoration



---

archive/issue_comments_560972.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb72ef050d94dd32cbb1499243af5de4e9eec22c\">eb72ef0</a></td><td><code>avoid is_GapElement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c4a69fdfee7ccf9aebb40bbc29b4453852cacb1\">1c4a69f</a></td><td><code>use GapElement from an abstract superclass</code></td></tr></table>\n",
    "created_at": "2022-11-29T21:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560972",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb72ef050d94dd32cbb1499243af5de4e9eec22c">eb72ef0</a></td><td><code>avoid is_GapElement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c4a69fdfee7ccf9aebb40bbc29b4453852cacb1">1c4a69f</a></td><td><code>use GapElement from an abstract superclass</code></td></tr></table>




---

archive/issue_comments_560973.json:
```json
{
    "body": "Changed commit from **[d4bde80](https://github.com/sagemath/sagetrac-mirror/commit/d4bde80f350975b30e5795aa5ffc7333f5c80911)** to **[1c4a69f](https://github.com/sagemath/sagetrac-mirror/commit/1c4a69fdfee7ccf9aebb40bbc29b4453852cacb1)**",
    "created_at": "2022-11-29T21:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560973",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d4bde80](https://github.com/sagemath/sagetrac-mirror/commit/d4bde80f350975b30e5795aa5ffc7333f5c80911)** to **[1c4a69f](https://github.com/sagemath/sagetrac-mirror/commit/1c4a69fdfee7ccf9aebb40bbc29b4453852cacb1)**



---

archive/issue_comments_560974.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOK, how about this? The branch of #34804 should be based on this one.",
    "created_at": "2022-11-29T21:22:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560974",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

OK, how about this? The branch of #34804 should be based on this one.



---

archive/issue_comments_560975.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nYes, looking good.",
    "created_at": "2022-11-29T21:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560975",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Yes, looking good.



---

archive/issue_comments_560976.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nreview?",
    "created_at": "2022-11-30T07:54:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560976",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

review?



---

archive/issue_comments_560977.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nIn this change:\n\n```\n--- a/src/sage/rings/finite_rings/element_ntl_gf2e.pyx\n+++ b/src/sage/rings/finite_rings/element_ntl_gf2e.pyx\n@@ -56,6 +54,11 @@ from .finite_field_ntl_gf2e import FiniteField_ntl_gf2e\n \n from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing\n \n+from sage.libs.gap.element import GapElement_FiniteField\n+\n```\nit would be good to use the `try except ... ()` so that there is no hard load-time dependency on libgap.",
    "created_at": "2022-11-30T17:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560977",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

In this change:

```
--- a/src/sage/rings/finite_rings/element_ntl_gf2e.pyx
+++ b/src/sage/rings/finite_rings/element_ntl_gf2e.pyx
@@ -56,6 +54,11 @@ from .finite_field_ntl_gf2e import FiniteField_ntl_gf2e
 
 from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing
 
+from sage.libs.gap.element import GapElement_FiniteField
+
```
it would be good to use the `try except ... ()` so that there is no hard load-time dependency on libgap.



---

archive/issue_comments_560978.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:29):\n> In this change:\n> \n> ```\n> --- a/src/sage/rings/finite_rings/element_ntl_gf2e.pyx\n> +++ b/src/sage/rings/finite_rings/element_ntl_gf2e.pyx\n> @@ -56,6 +54,11 @@ from .finite_field_ntl_gf2e import FiniteField_ntl_gf2e\n>  \n>  from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing\n>  \n> +from sage.libs.gap.element import GapElement_FiniteField\n> +\n> ```\n> it would be good to use the `try except ... ()` so that there is no hard load-time dependency on libgap.\n\nthere are more importings of `GapElement_FiniteField` in this patch, i suppose you'd like to deal with them all.\n\nWhy don't we instead go the way we went with `GapElement` here, by adding `sage.libs.abc`, etc?",
    "created_at": "2022-12-01T23:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560978",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [Matthias Köppe](#comment:29):
> In this change:
> 
> ```
> --- a/src/sage/rings/finite_rings/element_ntl_gf2e.pyx
> +++ b/src/sage/rings/finite_rings/element_ntl_gf2e.pyx
> @@ -56,6 +54,11 @@ from .finite_field_ntl_gf2e import FiniteField_ntl_gf2e
>  
>  from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing
>  
> +from sage.libs.gap.element import GapElement_FiniteField
> +
> ```
> it would be good to use the `try except ... ()` so that there is no hard load-time dependency on libgap.

there are more importings of `GapElement_FiniteField` in this patch, i suppose you'd like to deal with them all.

Why don't we instead go the way we went with `GapElement` here, by adding `sage.libs.abc`, etc?



---

archive/issue_comments_560979.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [Dima Pasechnik](#comment:30):\n> Why don't we instead go the way we went with `GapElement` here, by adding `sage.libs.abc`, etc?\n\nThat's also fine",
    "created_at": "2022-12-01T23:34:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560979",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [Dima Pasechnik](#comment:30):
> Why don't we instead go the way we went with `GapElement` here, by adding `sage.libs.abc`, etc?

That's also fine



---

archive/issue_comments_560980.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:31):\n> Replying to [Dima Pasechnik](#comment:30):\n> > Why don't we instead go the way we went with `GapElement` here, by adding `sage.libs.abc`, etc?\n\n> \n> That's also fine\n\nCan we do `sage.libs.abc` as a part of #32414, on a separate ticket?\nAfter all, the current ticket is a part of #26902, which is not modularisation.",
    "created_at": "2022-12-02T09:50:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560980",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [Matthias Köppe](#comment:31):
> Replying to [Dima Pasechnik](#comment:30):
> > Why don't we instead go the way we went with `GapElement` here, by adding `sage.libs.abc`, etc?

> 
> That's also fine

Can we do `sage.libs.abc` as a part of #32414, on a separate ticket?
After all, the current ticket is a part of #26902, which is not modularisation.



---

archive/issue_comments_560981.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nIt's kind of why I suggested to use `try except ... ()` in [comment:30](#comment:30).",
    "created_at": "2022-12-02T17:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560981",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

It's kind of why I suggested to use `try except ... ()` in [comment:30](#comment:30).



---

archive/issue_comments_560982.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:33):\n> It's kind of why I suggested to use `try except ... ()` in [comment:30](#comment:30).\n\nbut we are not doing modularisation of libgap module here. that's why I don't want to `try:` here.",
    "created_at": "2022-12-02T18:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560982",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [Matthias Köppe](#comment:33):
> It's kind of why I suggested to use `try except ... ()` in [comment:30](#comment:30).

but we are not doing modularisation of libgap module here. that's why I don't want to `try:` here.



---

archive/issue_comments_560983.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThe ticket is introducing a modularization regression by inserting this new module-level import.",
    "created_at": "2022-12-02T18:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560983",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

The ticket is introducing a modularization regression by inserting this new module-level import.



---

archive/issue_comments_560984.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:35):\n> The ticket is introducing a modularization regression by inserting this new module-level import.\n\nit replaces one modularization regression with another.\n\nThere are about 180 `from sage.libs.gap...` in Sage, I suppose none of them in `try... except block`. It's begging for a separate ticket, which is best attended to once we've replaced all pexpect GAP with libgap.",
    "created_at": "2022-12-02T19:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560984",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [Matthias Köppe](#comment:35):
> The ticket is introducing a modularization regression by inserting this new module-level import.

it replaces one modularization regression with another.

There are about 180 `from sage.libs.gap...` in Sage, I suppose none of them in `try... except block`. It's begging for a separate ticket, which is best attended to once we've replaced all pexpect GAP with libgap.



---

archive/issue_comments_560985.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThere are no unprotected module-level imports from `sage.libs.gap` in sage.rings. Please don't introduce one, that's all I'm asking.",
    "created_at": "2022-12-02T20:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560985",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

There are no unprotected module-level imports from `sage.libs.gap` in sage.rings. Please don't introduce one, that's all I'm asking.



---

archive/issue_comments_560986.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [Matthias K\u00f6ppe](#comment:37):\n> There are no unprotected module-level imports from `sage.libs.gap` in sage.rings. Please don't introduce one, that's all I'm asking.\n\nDo you mean it's OK for you to have imports in functions, say?\nE.g. in `src/sage/rings/number_field/number_field.py` there is\n`def _libgap_(self)` where `libgap` is unconditionally imported.",
    "created_at": "2022-12-02T23:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560986",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [Matthias Köppe](#comment:37):
> There are no unprotected module-level imports from `sage.libs.gap` in sage.rings. Please don't introduce one, that's all I'm asking.

Do you mean it's OK for you to have imports in functions, say?
E.g. in `src/sage/rings/number_field/number_field.py` there is
`def _libgap_(self)` where `libgap` is unconditionally imported.



---

archive/issue_comments_560987.json:
```json
{
    "body": "Changed commit from **[1c4a69f](https://github.com/sagemath/sagetrac-mirror/commit/1c4a69fdfee7ccf9aebb40bbc29b4453852cacb1)** to **[6e5ea79](https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b)**",
    "created_at": "2022-12-03T00:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560987",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1c4a69f](https://github.com/sagemath/sagetrac-mirror/commit/1c4a69fdfee7ccf9aebb40bbc29b4453852cacb1)** to **[6e5ea79](https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b)**



---

archive/issue_comments_560988.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b\">6e5ea79</a></td><td><code>move import of libgap into a function</code></td></tr></table>\n",
    "created_at": "2022-12-03T00:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560988",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b">6e5ea79</a></td><td><code>move import of libgap into a function</code></td></tr></table>




---

archive/issue_comments_560989.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nYes, that's https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies bullet point 2 \"Replace module-level imports by method-level imports.\"",
    "created_at": "2022-12-03T00:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560989",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Yes, that's https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies bullet point 2 "Replace module-level imports by method-level imports."



---

archive/issue_comments_560990.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2022-12-03T04:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560990",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_473643.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-03T04:25:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473643"
}
```



---

archive/issue_events_473644.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-03T04:25:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473644"
}
```



---

archive/issue_comments_560991.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nLGTM, thanks.",
    "created_at": "2022-12-03T04:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560991",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

LGTM, thanks.



---

archive/issue_comments_560992.json:
```json
{
    "body": "Changed branch from **[u/dimpase/rings/FFEs_to_accept_libgap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rings/FFEs_to_accept_libgap)** to **[6e5ea79](https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b)**",
    "created_at": "2022-12-14T22:12:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/34770#issuecomment-560992",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/rings/FFEs_to_accept_libgap](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rings/FFEs_to_accept_libgap)** to **[6e5ea79](https://github.com/sagemath/sagetrac-mirror/commit/6e5ea791a3d846cfd70d9b361f168f6c2fa66a2b)**



---

archive/issue_events_473645.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-12-14T22:12:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473645"
}
```



---

archive/issue_events_473646.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c90d203d7d9bc25af9cc7a4037f68713d6d05dac",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-12-14T22:12:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/34770",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/34770#event-473646"
}
```
