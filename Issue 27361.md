# Issue 27361: Unicode problem with SageTeX

Issue created by migration from https://trac.sagemath.org/ticket/27598

Original creator: jhpalmieri

Original creation time: 2019-04-02 20:15:30

Running SageTeX with Python 2 on this file fails:

```
\documentclass{article}
\usepackage{sagetex}
\begin{document}

\begin{sageblock}
  s = "hello á goodbye"
\end{sageblock}

\end{document}
```

(With Python 3, I think it works.) The error occurs when running Sage:

```
$ sage junk.sagetex.sage
Processing Sage code for junk.tex...
Code block (line 5) begin...end
Traceback (most recent call last):
  File "junk.sagetex.sage.py", line 16, in <module>
    _st_.endofdoc()
  File "/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python2.7/site-packages/sagetex.py", line 276, in endofdoc
    m.update(bytearray(line,'utf8'))
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 14: ordinal not in range(128)
```




---

Comment by jhpalmieri created at 2019-04-02 20:32:26

The problem is with the use of the `bytearray` function. With Python 2:

```
>>> bytearray('á')
bytearray(b'\xc3\xa1')
>>> bytearray('á', 'utf8')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: ordinal not in range(128)
```

With Python 3:

```
>>> bytearray('á')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: string argument without an encoding
>>> bytearray('á', 'utf8')
bytearray(b'\xc3\xa1')
```



---

Comment by dimpase created at 2019-06-11 11:11:41

this is hopefully fixed in #27968, which includes the recently merged PR that deals with this issue.


---

Comment by dimpase created at 2019-06-11 11:12:42

Changing status from new to needs_review.


---

Comment by dimpase created at 2019-06-11 11:12:42

please confirm that #27968 provides the fix, then this can be closed.


---

Comment by jhpalmieri created at 2019-06-12 01:14:40

Confirmed. Marked as duplicate.


---

Comment by jhpalmieri created at 2019-06-12 01:14:40

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-06-30 12:35:25

Resolution: duplicate
