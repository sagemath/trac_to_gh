# Issue 11036: Remove numpy warnings in slope field

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2011-04-17 00:22:26

Assignee: jason, was

CC:  jason novoselt

Having no arrows in an arrow plot (i.e., vector field that is a slope field) now causes warnings from matplotlib.

```
y = var('y') 
g = 1 
P=plot_slope_field(g,(x,3,4),(y,-1,1)) 
P 
<two sets of warnings> 
```

DSM has a diagnosis at [this sage-support thread](http://groups.google.com/group/sage-support/browse_thread/thread/49471ab062fcb8e9)

```
P=plot_slope_field(g,(x,3,4),(y,-1,1),headlength=1e-8) 
works for me.  FYI, it's the following few lines in Quiver._h_arrows at fault: 
        minsh = self.minshaft * self.headlength 
        [....] 
        shrink = length/minsh 
        X0 = shrink * X0[np.newaxis,:] 
        Y0 = shrink * Y0[np.newaxis,:] 
Probably we should change the defaults and/or (if it's not done 
already) ask our matplotlib friends to special-case 0 for no 
arrowheads.
```

So maybe this should be reported upstream?  See also #2922, which is also about the mpl quivers.


---

Comment by jason created at 2011-04-17 00:43:28

This should be reported upstream, right?


---

Comment by kcrisman created at 2011-04-17 00:51:22

Probably, and I say so on sage-support, but I don't know how to make this pure matplotlib, and maybe they would say it's user error?  But you are almost certainly right.


---

Comment by kcrisman created at 2011-05-24 02:57:47

I don't think this was ever reported upstream.  And now it's going to cause a problem for our PREP calculus tutorial... grumble, grumble.


---

Comment by mhampton created at 2011-09-08 18:22:05

For the moment it seems OK to use Doug McNeil's hack of setting: headlength=1e-8
Its better than leaving this problem around any longer in my opinion.


---

Comment by dsm created at 2012-02-27 22:05:15

Changing status from new to needs_review.


---

Comment by dsm created at 2012-02-27 22:05:15

Patch attached.  Wasn't sure of the idiom for doctesting the warnings; went with what I would have done in a non-Sage project.


---

Comment by dsm created at 2012-02-27 22:16:33

headlength = epsilon hack


---

Comment by davidloeffler created at 2012-03-11 15:45:21

Changing status from needs_review to needs_work.


---

Attachment

This doesn't apply to the current Sage dev version -- it seems to conflict with #10489. Can you rebase it?


---

Comment by kcrisman created at 2012-03-12 01:57:40

On the plus side, it works!  DSM, just be sure to _not_ replace the previous patch so that we can compare the two, but the rebase should be nearly trivial (I almost did it just now, but decided you were probably in the midst).  The only thing I could possibly say is that I would put the "(trac #11208)::" on the next line, but it's not really that important.

So positive review, modulo rebase.


---

Comment by dsm created at 2012-03-12 02:15:50

headlength = epsilon hack, rebased to 5.0.beta7


---

Comment by dsm created at 2012-03-12 02:21:05

Changing status from needs_work to needs_review.


---

Attachment

Dropped a message on matplotlib-devel; at least one dev thought special-casing zero was a good idea, so I'll work up a matplotlib patch if I get some time.  Not much pressure to do it on our end now, though.  [PS `@`kcrisman -- not only was I in the midst, I was typing things like 'hg export tip' as you were writing that..]


---

Comment by kcrisman created at 2012-03-12 02:30:48

Changing priority from minor to major.


---

Comment by kcrisman created at 2012-03-12 02:30:48

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2012-03-12 02:30:48

Great, make sure to post a link to the discussion on matplotlib-devel.  This applies to beta7 and fixes something we REALLY should have fixed a long time ago.

By the way, it turns out we now have this nice `:trac:` thing for documentation... not needed here, but just fyi for next time, I just found out about five minutes ago.


---

Comment by davidloeffler created at 2012-03-12 07:48:54

Apply trac_11208_avoid_headless_quiver_warning_v2.patch

(for patchbot)


---

Comment by jdemeyer created at 2012-03-21 22:04:19

Resolution: fixed


---

Comment by kcrisman created at 2012-03-22 02:07:00

Upstream report is [here](http://sourceforge.net/mailarchive/forum.php?thread_name=4F5D4707.3010209%40hawaii.edu&forum_name=matplotlib-devel).
