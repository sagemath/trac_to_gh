# Issue 14202: Update prereq for Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/14406

Original creator: jdemeyer

Original creation time: 2013-04-03 13:03:52

Assignee: tbd

CC:  jdemeyer leif jpflori

Allow Sage to build on Cygwin without setting `SAGE_PORT`.


---

Comment by jdemeyer created at 2013-04-03 13:30:28

Changing assignee from tbd to drkirkby.


---

Comment by jdemeyer created at 2013-04-03 13:30:28

Changing component from porting: Cygwin to porting.


---

Attachment


---

Comment by jdemeyer created at 2013-04-03 13:58:47

Changing status from new to needs_review.


---

Comment by jpflori created at 2013-04-03 14:02:37

In the prereq install script, the Solaris part could be a little bit polished.
The first sentence includes a disturbing also:

```
You MUST also use the GNU version of tar...
```

whereas nothing precedes it.

I don't really like the fact that both tar and make are tested together in the constructions

```
if [ -f "/usr/sfw/bin/gtar" ]  && [ -f "/usr/sfw/bin/gmake" ] ; then
```

The only advantage of doing this is to easily suggest to do 

```
   echo "$ mkdir \$HOME/bins-for-sage" 
   echo "$ cp /usr/sfw/bin/gmake \$HOME/bins-for-sage/make" 
   echo "$ cp /usr/sfw/bin/gtar \$HOME/bins-for-sage/tar" 
   echo "$ export PATH=\$HOME/bins-for-sage:\$PATH" 
```

I think we'd better split the two tests, i.e. only check for tar in the tar part and for make in the make part.
At worst, a naive user will have to run make twice before it passes the prereq checks and will have twice $HAME\bins-for-sage in its PATH.

There are also ugly double spaces before "&&" on the (new) lines 132 and 165 :)


---

Comment by jpflori created at 2013-04-03 14:07:30

We could also include the Solaris parts together with the HP-UX and other strange Unix oses as elif clauses a little down below.

That may look nicer and prevent running "tar --version" twice.

If so, the commented out comments will need just a little rewriting and relocation.


---

Comment by jdemeyer created at 2013-04-03 14:33:03

OK, making changes...


---

Comment by leif created at 2013-04-03 14:35:10

Didn't we want to replace the check for `sqrtl()` by a check for `?gammal()`?  (OTOH I don't recall why exactly... ;-) )

Actually, we need both `sqrtl()` and `[lt]gammal()` unless we build Cephes, i.e., unless we're on Cygwin(?) or on FreeBSD, or skip the test because `SAGE_PORT` is set.


---

Comment by kcrisman created at 2013-04-03 14:38:26

Also recall we still don't have `logl` (#14078) and so things are still weird, though we worked around it there.  But I don't have a problem with the Cygwin stuff here; Sage builds as is on Cygwin.  I think David originally added that check just to make sure one didn't need stuff like Cephes, but apparently we don't actually _use_ `sqrtl()` and friends.


---

Comment by jpflori created at 2013-04-03 14:44:40

Replying to [comment:9 leif]:
> Didn't we want to replace the check for `sqrtl()` by a check for `?gammal()`?  (OTOH I don't recall why exactly... ;-) )
> 
> Actually, we need both `sqrtl()` and `[lt]gammal()` unless we build Cephes, i.e., unless we're on Cygwin(?) or on FreeBSD, or skip the test because `SAGE_PORT` is set.
We don't build Cephes on Cygwin.
On Cygwin, the only *l functions actually needed anywhere in Sage and which caused troubles (and that Cygwin libm does not provide, not sure what it actually provides, but I seem to remember it provides no "long double" functions at all) was "logl" because of R, but we patched R so that its not needed anymore, and the next R upstream version provides a configure option to disable the use of "long double" functions anyway.


---

Comment by jpflori created at 2013-04-03 14:48:45

Here is what was recently included in Cygwin:

```
Support for the C99 complex functions, except for the "long double" implementations. New APIs: cacos, cacosf, cacosh, cacoshf, carg, cargf, casin, casinf, casinh, casinhf, catan, catanf, catanh, catanhf, ccos, ccosf, ccosh, ccoshf, cexp, cexpf, cimag, cimagf, clog, clogf, conj, conjf, cpow, cpowf, cproj, cprojf, creal, crealf, csin, csinf, csinh, csinhf, csqrt, csqrtf, ctan, ctanf, ctanh, ctanhf. 
```

See http://cygwin.com/cygwin-ug-net/ov-new1.7.html.


---

Comment by jpflori created at 2013-04-03 14:50:02

And I don't know what the FreeBSD libm lacks that make Sage's compilation fail (except for the logl function for R of course).


---

Comment by jpflori created at 2013-04-03 14:52:16

And of course we could revert the patch for R from #14078 and let Cephes install again on Cygwin.
It is just that at the time we were working on #14078, patching R, which is about to get the "without long double" support in a future release seemed easier.
I cannot not promise that installing Cephes and then trying to install R without the patch will just work out of the box.


---

Attachment

Replying to [comment:9 leif]:
> Actually, we need both `sqrtl()` and `[lt]gammal()` unless we build Cephes
It seems not, Cygwin doesn't have `sqrtl()`, nor does it build Cephes. Despite this, Sage builds.


---

Comment by jdemeyer created at 2013-04-03 15:00:41

OK, simplified the `tar`/`make` checks.


---

Comment by jpflori created at 2013-04-03 15:22:33

Ok, I've slightly recomplexified it :)


---

Comment by jpflori created at 2013-04-03 15:23:10

Oops, something is wrong, coming back with a proper patch.


---

Comment by leif created at 2013-04-03 15:24:41

Replying to [comment:15 jdemeyer]:
> Replying to [comment:9 leif]:
> > Actually, we need both `sqrtl()` and `[lt]gammal()` unless we build Cephes
> It seems not, Cygwin doesn't have `sqrtl()`, nor does it build Cephes. Despite this, Sage builds.

IIRC, because we (still) have some special-casing on Cygwin w.r.t. at least (just?) the (`long double`) gamma functions.




To repeat Karl-Dieter's question:  What is Cephes then needed for at all [on e.g. FreeBSD]?

I.e., we should probably check for those functions Cephes provides (and Sage needs) [unless we're on FreeBSD where Cephes gets built anyway, or `SAGE_PORT` is set].


---

Comment by jpflori created at 2013-04-03 15:30:18

Replying to [comment:19 leif]:
> Replying to [comment:15 jdemeyer]:
> > Replying to [comment:9 leif]:
> > > Actually, we need both `sqrtl()` and `[lt]gammal()` unless we build Cephes
> > It seems not, Cygwin doesn't have `sqrtl()`, nor does it build Cephes. Despite this, Sage builds.
> 
> IIRC, because we (still) have some special-casing on Cygwin w.r.t. at least (just?) the (`long double`) gamma functions.
I'll have a look.
> 
> 

> 
> To repeat Karl-Dieter's question:  What is Cephes then needed for at all [on e.g. FreeBSD]?
>
Maybe for complex functions "c*" (which are now in Cygwin libm but used not to be)? 
> I.e., we should probably check for those functions Cephes provides (and Sage needs) [unless we're on FreeBSD where Cephes gets built anyway, or `SAGE_PORT` is set].


---

Comment by jpflori created at 2013-04-03 15:32:13

Replying to [comment:20 jpflori]:
> Replying to [comment:19 leif]:
> > Replying to [comment:15 jdemeyer]:
> > > Replying to [comment:9 leif]:
> > > > Actually, we need both `sqrtl()` and `[lt]gammal()` unless we build Cephes
> > > It seems not, Cygwin doesn't have `sqrtl()`, nor does it build Cephes. Despite this, Sage builds.
> > 
> > IIRC, because we (still) have some special-casing on Cygwin w.r.t. at least (just?) the (`long double`) gamma functions.
> I'll have a look.
Indeed, we cheat for logl/sqrtl/tgammal/lgammal in sage/symbolic/pynac_cc.h just as we do with the R patch for logl.
> > 
> > 

> > 
> > To repeat Karl-Dieter's question:  What is Cephes then needed for at all [on e.g. FreeBSD]?
> >
> Maybe for complex functions "c*" (which are now in Cygwin libm but used not to be)? 
> > I.e., we should probably check for those functions Cephes provides (and Sage needs) [unless we're on FreeBSD where Cephes gets built anyway, or `SAGE_PORT` is set].


---

Comment by jpflori created at 2013-04-03 15:33:00

Replying to [comment:21 jpflori]:
> Replying to [comment:20 jpflori]:
> > Replying to [comment:19 leif]:
> > > Replying to [comment:15 jdemeyer]:
> > > > Replying to [comment:9 leif]:
> > > > > Actually, we need both `sqrtl()` and `[lt]gammal()` unless we build Cephes
> > > > It seems not, Cygwin doesn't have `sqrtl()`, nor does it build Cephes. Despite this, Sage builds.
> > > 
> > > IIRC, because we (still) have some special-casing on Cygwin w.r.t. at least (just?) the (`long double`) gamma functions.
> > I'll have a look.
> Indeed, we cheat for logl/sqrtl/tgammal/lgammal in sage/symbolic/pynac_cc.h just as we do with the R patch for logl.
And as we only cheat on Cygwin, this implies Cephes is definitively needed on FreeBSD for this file already.
> > > 
> > > 

> > > 
> > > To repeat Karl-Dieter's question:  What is Cephes then needed for at all [on e.g. FreeBSD]?
> > >
> > Maybe for complex functions "c*" (which are now in Cygwin libm but used not to be)? 
> > > I.e., we should probably check for those functions Cephes provides (and Sage needs) [unless we're on FreeBSD where Cephes gets built anyway, or `SAGE_PORT` is set].


---

Comment by leif created at 2013-04-03 15:43:03

Replying to [comment:22 jpflori]:
> Replying to [comment:21 jpflori]:
> > Replying to [comment:20 jpflori]:
> > > Replying to [comment:19 leif]:
> > > > IIRC, because we (still) have some special-casing on Cygwin w.r.t. at least (just?) the (`long double`) gamma functions.
> > Indeed, we cheat for logl/sqrtl/tgammal/lgammal in sage/symbolic/pynac_cc.h just as we do with the R patch for logl.
> And as we only cheat on Cygwin, this implies Cephes is definitively needed on FreeBSD for this file already.

So what's your conclusion?  (Regardless of perhaps cheating on FreeBSD as well.)




> > > > I.e., we should probably check for those functions Cephes provides (and Sage needs) [unless we're on FreeBSD where Cephes gets built anyway, or `SAGE_PORT` is set].


---

Comment by jpflori created at 2013-04-03 15:45:17

In fact I slightly prefer the way things get printed with the second version of the reviewer patch.
It's slightly easier to understand if both tar and make are missing.
Feel free to change it back if you want.


---

Comment by leif created at 2013-04-03 15:50:07

P.S.:  I don't have a strong opinion on the libm tests; building Sage requires a C99 environment (compiler + library) anyway.  We may add a comment on this to the _Sage Porting Guide<sup>TM</sup>_.


---

Comment by jpflori created at 2013-04-03 15:53:54

Replying to [comment:23 leif]:
> So what's your conclusion?  (Regardless of perhaps cheating on FreeBSD as well.)
Don't really know.
Check for sqrtl, logl, tgammal and lgammal everywhere except where:
* we cheat, which is currently Cygwin,
* we install Cephes, which is currently FreeBSD.
And if that fails, rant that supported platform should provide "long double" functions (except for the the two categories filtered out above) and suggest:
* setting SAGE_PORT to something non-empty,
* and:
 * either try installing the Cephes spkg,
 * or cheating as on Cygwin.
Both of these will be non-trivial anyway.
>


---

Comment by leif created at 2013-04-03 16:01:47

Replying to [comment:26 jpflori]:
> Replying to [comment:23 leif]:
> > So what's your conclusion?  (Regardless of perhaps cheating on FreeBSD as well.)
> Don't really know.
> Check for sqrtl, logl, tgammal and lgammal everywhere except where:
> * we cheat, which is currently Cygwin,
> * we install Cephes, which is currently FreeBSD.
> And if that fails, rant that supported platform should provide "long double" functions (except for the the two categories filtered out above) and suggest:
> * setting SAGE_PORT to something non-empty,
> * and:
>  * either try installing the Cephes spkg,
>  * or cheating as on Cygwin.

+ * switch to another OS

+ Provide a link to the C99 standard.




> Both of these will be non-trivial anyway.

Really?


---

Comment by jpflori created at 2013-04-03 16:08:04

Replying to [comment:27 leif]:
> Replying to [comment:26 jpflori]:
> > Replying to [comment:23 leif]:
> > > So what's your conclusion?  (Regardless of perhaps cheating on FreeBSD as well.)
> > Don't really know.
> > Check for sqrtl, logl, tgammal and lgammal everywhere except where:
> > * we cheat, which is currently Cygwin,
> > * we install Cephes, which is currently FreeBSD.
> > And if that fails, rant that supported platform should provide "long double" functions (except for the the two categories filtered out above) and suggest:
> > * setting SAGE_PORT to something non-empty,
> > * and:
> >  * either try installing the Cephes spkg,
> >  * or cheating as on Cygwin.
> 
> + * switch to another OS
> 
> + Provide a link to the C99 standard.
> 
> 

> 
> > Both of these will be non-trivial anyway.
> 
> Really?
Depends on who tries it...
* Cheating as on Cygwin is easy if you know where to look, although you should know a little bit of Sage to modify the R spkg, but I somehow agree it is not a long term solution, we don't want to patch every part of Sage which at some point will use "long double" functions... but then we can hope that Cygwin also include these functions in their libm, as they did for the "complex" functions, if every piece of software in the world need them.
* Don't really know if installing Cephes just works out of the box, i.e. "oh I have a non-C99 compliant libm, let's just install cephes and every piece of Sage looking for C99 libm functions will find them now", that's surely the case but I've never tried.


---

Comment by jpflori created at 2013-04-03 16:08:42

For Jeroen:

I guess we should check that the lapack (in fact its dependency liblapack0) and liblapack-devel packages are installed on Cygwin.
In fact it should be enough to check the existence of the import libraries for libblas (and liblapack once we get #10508 in) as I do in the spkg-install file of ATLAS from #10508:

```
    libraries = ['/usr/lib/libblas.dll.a', '/usr/lib/liblapack.dll.a']
    for lib in libraries:
        if not os.path.exists(lib):
            print '*'*75
            print 'Could not locate required file: "' + lib + '".'
            print 'On Cygwin you must install the following standard LAPACK Cygwin packages'
            print 'via the Cygwin setup.exe program in the "Math" category:'
            print '* lapack,'
            print '* liblapack-devel.'
            print 'Alternatively you can try building your own ATLAS by setting'
            print 'SAGE_ATLAS_ARCH to something sensible although that is not'
            print 'officially supported.'
            print '*'*75
            sys.exit(1)
```

Modifying the spkg from #10508 so that it correctly builds will be slighlty non-trivial, or rather the way we include that in Volker's autotools stuff needs some thoughts.


---

Comment by jpflori created at 2013-04-03 16:21:25

Replying to [comment:28 jpflori]:
> Replying to [comment:27 leif]:
> > Replying to [comment:26 jpflori]:
> > > Replying to [comment:23 leif]:
> > > > So what's your conclusion?  (Regardless of perhaps cheating on FreeBSD as well.)
> > > Don't really know.
> > > Check for sqrtl, logl, tgammal and lgammal everywhere except where:
> > > * we cheat, which is currently Cygwin,
> > > * we install Cephes, which is currently FreeBSD.
> > > And if that fails, rant that supported platform should provide "long double" functions (except for the the two categories filtered out above) and suggest:
> > > * setting SAGE_PORT to something non-empty,
> > > * and:
> > >  * either try installing the Cephes spkg,
> > >  * or cheating as on Cygwin.
> > 
> > + * switch to another OS
> > 
> > + Provide a link to the C99 standard.
> > 
> > 

> > 
> > > Both of these will be non-trivial anyway.
> > 
> > Really?
> Depends on who tries it...
> * Cheating as on Cygwin is easy if you know where to look, although you should know a little bit of Sage to modify the R spkg, but I somehow agree it is not a long term solution, we don't want to patch every part of Sage which at some point will use "long double" functions... but then we can hope that Cygwin also include these functions in their libm, as they did for the "complex" functions, if every piece of software in the world need them.
> * Don't really know if installing Cephes just works out of the box, i.e. "oh I have a non-C99 compliant libm, let's just install cephes and every piece of Sage looking for C99 libm functions will find them now", that's surely the case but I've never tried.
I think that for the long term, especially if a lot of standard stuff we need use "long double" functions by default and provide no way of easily disabling their use (as R will do), the best solution would be to:
* check for sqrtl (or any random "long double" function);
* if that's not available, then set some SAGE_INSTALL_CEPHES variable which triggers the installation of Sage;
* remove all the Cygwin "long double" hacks.

But please, let's do that later...
For the moment, just:
* check for sqrtl except on FreeBSD and Cygwin,
* rant if not available, provide links to C99 standard, suggest the user to use a mainstream OS, invite him to have coffee or whatever (and maybe mention the fact that if he dares to set SAGE_PORT, then he could also try to manually install the cephes spkg when something fails because of the lack of "long double" functions).


---

Comment by kcrisman created at 2013-04-03 16:53:30

> To repeat Karl-Dieter's question: What is Cephes then needed for at all [on e.g. FreeBSD]?
I don't recall asking about FreeBSD, simply stating that we do need it there.  You can ask Stephen M-S about that on one of those ticket.
> Indeed, we cheat for logl/sqrtl/tgammal/lgammal in sage/symbolic/pynac_cc.h just as we do with the R patch for logl.
However, I do invite someone to open a ticket to re-enable Cephes on Cygwin so that we can drop that entire file!  If that is indeed the "right" solution.
----

> But please, let's do that later...
Yes, please.
> I guess we should check that the lapack (in fact its dependency liblapack0) and liblapack-devel packages are installed on Cygwin.
Oh, right.  Good point, since #10508 is not yet in.  But I was discouraged earlier from adding this to prereq, that's why I figured #10508 was better.  I would definitely be in support of this being done on this ticket, and I've put something about that at #6743.
> For the moment, just:
> * check for sqrtl except on FreeBSD and Cygwin,
> * rant if not available, provide links to C99 standard, suggest the user to use a mainstream OS, invite him to have coffee or whatever (and maybe mention the fact that if he dares to set SAGE_PORT, then he could also try to manually install the cephes spkg when something fails because of the lack of "long double" functions).
I think that some variation on this is very reasonable.


---

Comment by jdemeyer created at 2013-04-03 17:50:40

Replying to [comment:29 jpflori]:
> we should check that the lapack [...] packages are installed on Cygwin
Why is it needed? I really don't like adding an extra check without understanding (and documenting) why.


---

Comment by kcrisman created at 2013-04-03 17:55:26

> > we should check that the lapack [...] packages are installed on Cygwin
> Why is it needed? I really don't like adding an extra check without understanding why.
Absolutely needed, because Sage ordinarily could build ATLAS/lapack spkgs on other systems but on Cygwin we (currently) need to have lapack already to get atlas to build things like R and Scipy, and it's not officially a prerequisite for Sage in general.

Unless I'm misunderstanding something about your question?


---

Comment by jdemeyer created at 2013-04-03 17:57:58

I disagree with

```
if [ "$UNAME" = "SunOS" ]
```



---

Comment by jdemeyer created at 2013-04-03 17:59:32

Replying to [comment:33 kcrisman]:
> Unless I'm misunderstanding something about your question?
You didn't really answer my question, you _confirmed_ that it is needed without mentioning _why_ it is needed. Perhaps a more explicit question is: *what goes wrong if you don't have lapack?*


---

Comment by jdemeyer created at 2013-04-03 18:05:28

Replying to [comment:21 jpflori]:
> Indeed, we cheat for logl/sqrtl/tgammal/lgammal in sage/symbolic/pynac_cc.h just as we do with the R patch for logl.

I wouldn't mind always "cheating", i.e. not supporting `logl()` at all and drop all the Cygwin/FreeBSD hassle. Especially because long doubles don't have a portable meaning (they have a different precision on different systems).


---

Comment by jdemeyer created at 2013-04-03 18:09:43

I would be against more system-specific checks in `prereq`, I would like to move to a real `./configure` before we do that. Because otherwise, it will lead to inconsistent checks (inconsistency between prereq and cephes's `spkg-install` like we're seeing now).


---

Comment by jpflori created at 2013-04-03 18:20:46

Replying to [comment:34 jdemeyer]:
> I disagree with
> {{{
> if [ "$UNAME" = "SunOS" ]
> }}}
I guess you been we should only 

```
[ -f /usr/sfw/bin/* ]
```

?
But will there really be anything else than SunOS where /usr/sfw/bin exists?


---

Comment by jpflori created at 2013-04-03 18:22:27

Replying to [comment:35 jdemeyer]:
> Replying to [comment:33 kcrisman]:
> > Unless I'm misunderstanding something about your question?
> You didn't really answer my question, you _confirmed_ that it is needed without mentioning _why_ it is needed. Perhaps a more explicit question is: *what goes wrong if you don't have lapack?*
On Cygwin the lapack packages provide both BLAS and LAPACK.
And the current Sage's ATLAS spkg, or the one from #10508, does not build ATLAS on Cygwin.
It will not be really hard, but requires some more thoughts and work.


---

Comment by jdemeyer created at 2013-04-03 18:33:09

Replying to [comment:38 jpflori]:
> But will there really be anything else than SunOS where /usr/sfw/bin exists?
Assuming not, the check for SunOS is redundant anyway.

It all goes back to the philosophy of not checking the system, but checking features.


---

Comment by jdemeyer created at 2013-04-03 18:34:38

Replying to [comment:39 jpflori]:
> And the current Sage's ATLAS spkg, or the one from #10508, does not build ATLAS on Cygwin.
> It will not be really hard, but requires some more thoughts and work.
OK, so it's a problem with the ATLAS spkg. In that case, would it not make more sense to add the check to the ATLAS spkg instead of `prereq`?


---

Attachment

Replying to [comment:41 jdemeyer]:
> Replying to [comment:39 jpflori]:
> > And the current Sage's ATLAS spkg, or the one from #10508, does not build ATLAS on Cygwin.
> > It will not be really hard, but requires some more thoughts and work.
> OK, so it's a problem with the ATLAS spkg. In that case, would it not make more sense to add the check to the ATLAS spkg instead of `prereq`?
Its already there and provides info.
I'm ok to not check anything in prereq and let the ATLAS spkg do the job (although the user might say "hey it passed prereq and now its asking for something more to be installed so much later!!!").

(And I just uploaded a new patch without redundant SunOS check.)


---

Comment by jpflori created at 2013-04-03 18:52:29

Replying to [comment:36 jdemeyer]:
> Replying to [comment:21 jpflori]:
> > Indeed, we cheat for logl/sqrtl/tgammal/lgammal in sage/symbolic/pynac_cc.h just as we do with the R patch for logl.
> 
> I wouldn't mind always "cheating", i.e. not supporting `logl()` at all and drop all the Cygwin/FreeBSD hassle. Especially because long doubles don't have a portable meaning (they have a different precision on different systems).
Ive got a slight preference for the SAGE_INST_CEPHES solution, espoecially it "could" be easier to maintain, but for the moment I could go with not even testing sqrtl anywhere assuming that its in the libm of supported platforms or were dealing with Cygwin or FreeBSD.


---

Comment by jdemeyer created at 2013-04-03 21:06:54

Reviewer patch is okay for me.


---

Comment by jdemeyer created at 2013-04-03 21:09:55

Replying to [comment:43 jpflori]:
> Ive got a slight preference for the SAGE_INST_CEPHES solution
I don't really know what that "solution" would be.

The main thing I don't want is to spread the same checks in different places. For example, the lapack check should be either in prereq, either in ATLAS, not in both. Since it currently cannot be done only in prereq, it must be done in ATLAS.


---

Comment by jpflori created at 2013-04-03 21:13:55

Replying to [comment:45 jdemeyer]:
> Replying to [comment:43 jpflori]:
> > Ive got a slight preference for the SAGE_INST_CEPHES solution
> I don't really know what that "solution" would be.
That would be:
* check for sqrtl.
* if not available trigger installation of the cephes spkg.
> 
> The main thing I don't want is to spread the same checks in different places. For example, the lapack check should be either in prereq, either in ATLAS, not in both. Since it currently cannot be done only in prereq, it must be done in ATLAS.


---

Comment by kcrisman created at 2013-04-04 00:11:33

> > > Unless I'm misunderstanding something about your question? 
> > You didn't really answer my question, you confirmed that it is needed without mentioning why it is needed. Perhaps a more explicit question is: what goes wrong if you don't have lapack? 
> On Cygwin the lapack packages provide both BLAS and LAPACK. And the current Sage's ATLAS spkg, or the one from #10508, does not build ATLAS on Cygwin. It will not be really hard, but requires some more thoughts and work. 
I thought that was basically what I was saying... not sure what happened here.

Anyway, as to the check, the reason to have it early is that atlas might build quite late in a process, and then someone says "Oh, Mxyzptlk, why did I waste all that time building Sage and I didn't have the right prereqs?"  Which I guess JP just said too.


---

Comment by jdemeyer created at 2013-04-04 06:25:20

Replying to [comment:46 jpflori]:
> That would be:
> * check for sqrtl.
> * if not available trigger installation of the cephes spkg.
And how would a prereq check "trigger" the installation of the cephes spkg? I don't think that can currently be done.


---

Comment by jdemeyer created at 2013-04-04 06:28:21

Replying to [comment:47 kcrisman]:
> Anyway, as to the check, the reason to have it early is that atlas might build quite late in a process, and then someone says "Oh, Mxyzptlk, why did I waste all that time building Sage and I didn't have the right prereqs?"  Which I guess JP just said too.
I certainly don't disagree with this, but for this to work (and also jpflori's idea of "triggering"), we need to change the prereq mechanism which is a lot less trivial than this ticket.


---

Comment by jpflori created at 2013-04-04 06:45:26

Replying to [comment:48 jdemeyer]:
> Replying to [comment:46 jpflori]:
> > That would be:
> > * check for sqrtl.
> > * if not available trigger installation of the cephes spkg.
> And how would a prereq check "trigger" the installation of the cephes spkg? I don't think that can currently be done.
I thought we could do that just like you do for GCC.
But that might be impossible, i did not check.


---

Comment by jpflori created at 2013-04-04 06:48:21

Replying to [comment:50 jpflori]:
> Replying to [comment:48 jdemeyer]:
> > Replying to [comment:46 jpflori]:
> > > That would be:
> > > * check for sqrtl.
> > > * if not available trigger installation of the cephes spkg.
> > And how would a prereq check "trigger" the installation of the cephes spkg? I don't think that can currently be done.
> I thought we could do that just like you do for GCC.
> But that might be impossible, i did not check.
Just a little more details of the way I see this, but that may be wrong:
* at prereq time (or whenever the gcc version checks are done), set an env variable if the test fails (or the user can override it if he wants),
* then either our spkg system is smart enough to build the cephes spkg iff this variable is set, or the spkg-install script from cephes spkg checks its value by itself and decide whether it should build or not (just like it now checks it is running on FreeBSD).


---

Comment by jpflori created at 2013-04-04 06:50:21

And I'm in for the idea of "let's postpone this complicated stuff" (for the ATLAS and Cephes stuff).

If nobody rants too loud, I'll put this ticket to positive review so that we have official "experimental" for Cygwin in 5.9 or 5.10.


---

Comment by jdemeyer created at 2013-04-04 06:52:23

Replying to [comment:50 jpflori]:
> I thought we could do that just like you do for GCC.
Not really, the check for GCC is done in `spkg/install`, not prereq.

I agree that all these checks should eventually move to a new file `$SAGE_ROOT/configure`, but that would require some refactoring of the build system. Since the Sage+GIT people are also refactoring the build system, it might make sense to wait for sage-6.1 to do this.


---

Comment by jpflori created at 2013-04-04 07:44:27

Agreed, let's move on and merge this considering:
* sqrtl is not really a prereq as it should be on all supported platform or provided either by cheating or by building cephes (and note FreeBSD is even not officialy supported). Later we can give it a similar treatment as GCC. We can wait for 6.1 to do this.
* the ATLAS thing is currently only somehow boring on Cygwin, but the ATLAS spkg takes care of this (although later than the prereq one) and that is planned to change. For the moment what will happen is that ATLAS build will fail and tell the user to install the needed packages, he will do that and then the build process will go on. I guess someone actually trying to compile a huge thing as Sage can live with that. We should already wait for #10508 to be merged before doing that.


---

Comment by jpflori created at 2013-04-04 07:44:27

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2013-04-04 07:52:36

I've opened #14410 for the ATLAS on Cygwin stuff.


---

Comment by kcrisman created at 2013-04-04 13:17:37

Okay, this is better than the alternatives.


---

Comment by jdemeyer created at 2013-04-04 17:41:11

Resolution: fixed


---

Comment by jpflori created at 2013-04-11 22:20:16

Groumpf, I just realized that the last elif clause filtering OS names should include Cygwin (and beware that uname does not just return CYGWIN but CYGWIN... where ... gives additional precision which we don't really care about at the moment).
Should we fix that on another ticket?


---

Comment by jdemeyer created at 2013-04-12 06:09:47

Replying to [comment:58 jpflori]:
> Should we fix that on another ticket?
Yes, I made #14447 but I'll let you write the patch.

As for the Cygwin version thing: I propose

```
if uname | grep CYGWIN >/dev/null; then
    ...
fi
```

