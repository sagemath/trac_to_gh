# Issue 24322: py3: better backwards-compatibility for Python longs

archive/issues_024322.json:
```json
{
    "body": "This does three little things to better support `long`-related functionality, especially in the doctests.  This allows a lot of tests to pass on Python 3 that wouldn't otherwise, or would need to be skipped and/or have Python 3 specific copies:\n\n* The Sage preparser supports Python 2 style long literals, like `42L`.  These are just treated as normal ints on Python 3 (we could also consider adding a deprecation warning for this usage).  I actually wish Python itself had done this (just as they restored backwards-compat for `u''` literals--that they didn't I think is just that explicit `long`s is relatively uncommon.\n\n* The *doctest* parser has a fixup for recognizing long literals in the expected output of a test, and treating them as normal ints on Python 3.  This is probably the weakest part of the patch in terms of implementation--it's very na\u00efve and I can imagine the possibility of false positives, though it is still pretty unlikely.  Open to better ideas on this.\n\n* In `sage.all` I added, on Python 3 only, a new global called `long` which is just a function that wraps `int()` and (except in the tests, for now) raises a `DeprecationWarning` for using `long()`.  This still allows a lot of tests to work.  I deliberately made it a simple function, and not a class, as the latter would tempt too many errors with code like `isinstance(x, long)`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24559\n\n",
    "created_at": "2018-01-18T10:19:45Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "py3: better backwards-compatibility for Python longs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24322",
    "user": "https://github.com/embray"
}
```
This does three little things to better support `long`-related functionality, especially in the doctests.  This allows a lot of tests to pass on Python 3 that wouldn't otherwise, or would need to be skipped and/or have Python 3 specific copies:

* The Sage preparser supports Python 2 style long literals, like `42L`.  These are just treated as normal ints on Python 3 (we could also consider adding a deprecation warning for this usage).  I actually wish Python itself had done this (just as they restored backwards-compat for `u''` literals--that they didn't I think is just that explicit `long`s is relatively uncommon.

* The *doctest* parser has a fixup for recognizing long literals in the expected output of a test, and treating them as normal ints on Python 3.  This is probably the weakest part of the patch in terms of implementation--it's very naÃ¯ve and I can imagine the possibility of false positives, though it is still pretty unlikely.  Open to better ideas on this.

* In `sage.all` I added, on Python 3 only, a new global called `long` which is just a function that wraps `int()` and (except in the tests, for now) raises a `DeprecationWarning` for using `long()`.  This still allows a lot of tests to work.  I deliberately made it a simple function, and not a class, as the latter would tempt too many errors with code like `isinstance(x, long)`.

Issue created by migration from https://trac.sagemath.org/ticket/24559





---

archive/issue_comments_340115.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-18T10:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340115",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_340116.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-19T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340116",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340117.json:
```json
{
    "body": "I don't really with the condition deprecation depending on `DOCTEST_MODE`. Doctests should be as close as possible to a normal interactive session. I'm fine with the `long = int` alias, but then I would remove the deprecation.",
    "created_at": "2018-01-23T09:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340117",
    "user": "https://github.com/jdemeyer"
}
```

I don't really with the condition deprecation depending on `DOCTEST_MODE`. Doctests should be as close as possible to a normal interactive session. I'm fine with the `long = int` alias, but then I would remove the deprecation.



---

archive/issue_comments_340118.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> I don't really with the condition deprecation depending on `DOCTEST_MODE`. Doctests should be as close as possible to a normal interactive session. I'm fine with the `long = int` alias, but then I would remove the deprecation.\n\nThis was added very deliberately in part to help with porting the doctests, so as to allow the great many doctests that use `long()` to continue working for now without interruption (while at the same time giving a useful warning for user code).\n\nMy intention, though not explicitly stated, was to later (once we want to switch Sage to Python 3) remove the condition so that it's easy to find and fix/remove such tests later.",
    "created_at": "2018-01-23T11:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340118",
    "user": "https://github.com/embray"
}
```

Replying to [comment:3 jdemeyer]:
> I don't really with the condition deprecation depending on `DOCTEST_MODE`. Doctests should be as close as possible to a normal interactive session. I'm fine with the `long = int` alias, but then I would remove the deprecation.

This was added very deliberately in part to help with porting the doctests, so as to allow the great many doctests that use `long()` to continue working for now without interruption (while at the same time giving a useful warning for user code).

My intention, though not explicitly stated, was to later (once we want to switch Sage to Python 3) remove the condition so that it's easy to find and fix/remove such tests later.



---

archive/issue_comments_340119.json:
```json
{
    "body": "Replying to [comment:4 embray]:\n> My intention, though not explicitly stated, was to later (once we want to switch Sage to Python 3) remove the condition so that it's easy to find and fix/remove such tests later.\n\nI think it's better to just enable the alias now without any deprecation and then later add an unconditional deprecation. Since Sage doesn't really support Python 3 for the moment, the deprecation won't have much effect anyway.",
    "created_at": "2018-01-24T16:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340119",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 embray]:
> My intention, though not explicitly stated, was to later (once we want to switch Sage to Python 3) remove the condition so that it's easy to find and fix/remove such tests later.

I think it's better to just enable the alias now without any deprecation and then later add an unconditional deprecation. Since Sage doesn't really support Python 3 for the moment, the deprecation won't have much effect anyway.



---

archive/issue_comments_340120.json:
```json
{
    "body": "Why do you think that's better? Why is this wrong?",
    "created_at": "2018-01-30T17:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340120",
    "user": "https://github.com/embray"
}
```

Why do you think that's better? Why is this wrong?



---

archive/issue_comments_340121.json:
```json
{
    "body": "There's a difference between \"supporting Python 3\" and \"having Python 3 as the default Sage\".  I think in some version--hopefully before long (I'm running pretty low on obvious errors to fix, and most of the problems I'm seeing are minor issues in doctests) there will be a Sage that supports Python 3.\n\nFor backwards compatibility we'll want to keep Python 2 as the default for some time, but I would definitely encourage users to move to Python 3 sooner rather than later.  To that end, I envision that soon Sage will have Python 2 and Python 3 binary releases, with some emphasis on getting people to use the latter.  To that end it will be good to help as much as possible with transitioning.\n\nThat said, there's also a question of when to switch the default in the docs over.  If the docs are Python 3 then I think there should be no `long()` without a deprecation warning.\n\nIn other words, I'd be willing to change it, but it depends a lot on bigger plans regarding how Sage will transition to Python 3 that aren't particularly settled. But I feel right now that this currently with an eye toward being as helpful as possible for transitioning.",
    "created_at": "2018-01-30T17:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340121",
    "user": "https://github.com/embray"
}
```

There's a difference between "supporting Python 3" and "having Python 3 as the default Sage".  I think in some version--hopefully before long (I'm running pretty low on obvious errors to fix, and most of the problems I'm seeing are minor issues in doctests) there will be a Sage that supports Python 3.

For backwards compatibility we'll want to keep Python 2 as the default for some time, but I would definitely encourage users to move to Python 3 sooner rather than later.  To that end, I envision that soon Sage will have Python 2 and Python 3 binary releases, with some emphasis on getting people to use the latter.  To that end it will be good to help as much as possible with transitioning.

That said, there's also a question of when to switch the default in the docs over.  If the docs are Python 3 then I think there should be no `long()` without a deprecation warning.

In other words, I'd be willing to change it, but it depends a lot on bigger plans regarding how Sage will transition to Python 3 that aren't particularly settled. But I feel right now that this currently with an eye toward being as helpful as possible for transitioning.



---

archive/issue_comments_340122.json:
```json
{
    "body": "Replying to [comment:7 embray]:\n> If the docs are Python 3 then I think there should be no `long()` without a deprecation warning.\n\nThen it should be the same in doctests too. I'm fine with a deprecation or no deprecation either way, but I am protesting the condition on `DOCTEST_MODE`.",
    "created_at": "2018-01-31T10:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340122",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 embray]:
> If the docs are Python 3 then I think there should be no `long()` without a deprecation warning.

Then it should be the same in doctests too. I'm fine with a deprecation or no deprecation either way, but I am protesting the condition on `DOCTEST_MODE`.



---

archive/issue_comments_340123.json:
```json
{
    "body": "I don't know *why*. It seems to me the whole point of having `DOCTEST_MODE` flag is to control behavior in the context of doctests.  Obviously this should be used sparingly, but one can always find special cases.\n\nThat said, I took a step back from this and rethought it a bit.  I thought of adding a `long()` in `sage.all` as sort of a helper for transition to Python 3.  That said, the lack of `long()` in Python 3 is *hardly* the biggest difference, and users aren't often in the habit of using the `long` built-in very much anyways (especially not in Sage where it's almost entirely unnecessary).\n\nSo maybe adding this helper isn't that useful anyways.\n\nSo what if we only injected it into the globals when running the doctests, just temporarily, no deprecation warning or anything.  Later, when we want to start moving the tests to be more Python 3-compatible, we just remove it and get NameErrors everywhere the tests try to use it.",
    "created_at": "2018-01-31T14:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340123",
    "user": "https://github.com/embray"
}
```

I don't know *why*. It seems to me the whole point of having `DOCTEST_MODE` flag is to control behavior in the context of doctests.  Obviously this should be used sparingly, but one can always find special cases.

That said, I took a step back from this and rethought it a bit.  I thought of adding a `long()` in `sage.all` as sort of a helper for transition to Python 3.  That said, the lack of `long()` in Python 3 is *hardly* the biggest difference, and users aren't often in the habit of using the `long` built-in very much anyways (especially not in Sage where it's almost entirely unnecessary).

So maybe adding this helper isn't that useful anyways.

So what if we only injected it into the globals when running the doctests, just temporarily, no deprecation warning or anything.  Later, when we want to start moving the tests to be more Python 3-compatible, we just remove it and get NameErrors everywhere the tests try to use it.



---

archive/issue_comments_340124.json:
```json
{
    "body": "OK, I'll stop fighting here. I don't really agree, but if you want to add `long` on Python 3 if `DOCTEST_MODE` without deprecation, please go ahead.",
    "created_at": "2018-02-01T19:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340124",
    "user": "https://github.com/jdemeyer"
}
```

OK, I'll stop fighting here. I don't really agree, but if you want to add `long` on Python 3 if `DOCTEST_MODE` without deprecation, please go ahead.



---

archive/issue_comments_340125.json:
```json
{
    "body": "Thanks--though what do you think about my other proposal of just injecting `long` for the purpose of the doctests *only*?  I'm personally leaning toward it as a preference.\n\nI understand your feeling that the doctests should reflect what a real user sees.  The problem with Sage is that the only tests (with a few exceptions) are the doctests. And for the purposes of porting to Python 3 I don't think that philosophy really applies.  It's more important just that the tests are passing so that we can narrow down on real bugs (until we make Python 3 the default, in which case yes we don't want to special case anything in the doctests if possible).",
    "created_at": "2018-02-02T12:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340125",
    "user": "https://github.com/embray"
}
```

Thanks--though what do you think about my other proposal of just injecting `long` for the purpose of the doctests *only*?  I'm personally leaning toward it as a preference.

I understand your feeling that the doctests should reflect what a real user sees.  The problem with Sage is that the only tests (with a few exceptions) are the doctests. And for the purposes of porting to Python 3 I don't think that philosophy really applies.  It's more important just that the tests are passing so that we can narrow down on real bugs (until we make Python 3 the default, in which case yes we don't want to special case anything in the doctests if possible).



---

archive/issue_comments_340126.json:
```json
{
    "body": "Replying to [comment:11 embray]:\n> Thanks--though what do you think about my other proposal of just injecting `long` for the purpose of the doctests *only*?  I'm personally leaning toward it as a preference.\n\nGo for it.",
    "created_at": "2018-02-03T19:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340126",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 embray]:
> Thanks--though what do you think about my other proposal of just injecting `long` for the purpose of the doctests *only*?  I'm personally leaning toward it as a preference.

Go for it.



---

archive/issue_comments_340127.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-12T16:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340127",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_340128.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-23T14:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340128",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_340129.json:
```json
{
    "body": "Why needs work?\n\nTh recent patchbot failures on this ticket are all a joke--they're broken patchbots.  This one passed with the current branch on this ticket, and isn't a broken patchbot: https://patchbot.sagemath.org/log/24559/Ubuntu/16.04/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2018-02-04%2014:11:23",
    "created_at": "2018-02-23T14:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340129",
    "user": "https://github.com/embray"
}
```

Why needs work?

Th recent patchbot failures on this ticket are all a joke--they're broken patchbots.  This one passed with the current branch on this ticket, and isn't a broken patchbot: https://patchbot.sagemath.org/log/24559/Ubuntu/16.04/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2018-02-04%2014:11:23



---

archive/issue_comments_340130.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-23T14:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340130",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_340131.json:
```json
{
    "body": "Ignore me--I *did* do the proposed work, but it seems I haven't pushed it to the upstream branch yet...",
    "created_at": "2018-02-23T14:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340131",
    "user": "https://github.com/embray"
}
```

Ignore me--I *did* do the proposed work, but it seems I haven't pushed it to the upstream branch yet...



---

archive/issue_comments_340132.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-02-23T15:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340132",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_340133.json:
```json
{
    "body": "This depends on #24343, but the new approach to handling `long(...)` can be see in the latest commit.\n\nNow, instead of providing a user-visible replacement for `long` (which as I've already remarked is probably not that useful anyways, or at least a slippery-slope to providing other replacements for old Python 2 builtins), it just injects it into the globals for doctests.  This should be seen purely as a transitional measure.\n----",
    "created_at": "2018-02-23T15:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340133",
    "user": "https://github.com/embray"
}
```

This depends on #24343, but the new approach to handling `long(...)` can be see in the latest commit.

Now, instead of providing a user-visible replacement for `long` (which as I've already remarked is probably not that useful anyways, or at least a slippery-slope to providing other replacements for old Python 2 builtins), it just injects it into the globals for doctests.  This should be seen purely as a transitional measure.
----



---

archive/issue_comments_340134.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-23T15:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340134",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_340135.json:
```json
{
    "body": "Rebased\n----\nNew commits:",
    "created_at": "2018-03-13T16:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340135",
    "user": "https://github.com/jdemeyer"
}
```

Rebased
----
New commits:



---

archive/issue_comments_340136.json:
```json
{
    "body": "Jeroen, I see you rebased this, but does that constitute a \"review\"?\n\nIIRC, the only open question on this ticket had to do with my plan for aliasing `long` in Python 3.  Originally I was adding an alias in the global namespace for all users (that would raise a deprecation warning).  But now I've gone back on that, and am only injecting `long` as an alias for `int` into the globals for doctests.\n\nMy experience with testing this, so far, has been that it allows a lot of tests to pass on Python 3 that wouldn't otherwise, with few exceptions, and that it's a decent transitional approach.\n\nThe `extra_globals` dict I added could prove useful for a few other things too.",
    "created_at": "2018-03-27T08:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340136",
    "user": "https://github.com/embray"
}
```

Jeroen, I see you rebased this, but does that constitute a "review"?

IIRC, the only open question on this ticket had to do with my plan for aliasing `long` in Python 3.  Originally I was adding an alias in the global namespace for all users (that would raise a deprecation warning).  But now I've gone back on that, and am only injecting `long` as an alias for `int` into the globals for doctests.

My experience with testing this, so far, has been that it allows a lot of tests to pass on Python 3 that wouldn't otherwise, with few exceptions, and that it's a decent transitional approach.

The `extra_globals` dict I added could prove useful for a few other things too.



---

archive/issue_comments_340137.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-29T08:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_340138.json:
```json
{
    "body": "I don't like this syntax:\n\n```\n    \"\"\"\n    Extra objects to place in the global namespace in which tests are run.\n    Normally this should be empty but there are special cases where it may\n    be useful.\n\n    In particular, on Python 3 add ``long`` as an alias for ``int`` so that\n    tests that use the ``long`` built-in (of which there are many) still pass.\n    We do this so that the test suite can run on Python 3 while Python 2 is\n    still the default.\n    \"\"\"\n```\n\nIt looks too much like a docstring but it isn't. Use a `# comment` instead.",
    "created_at": "2018-03-29T08:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340138",
    "user": "https://github.com/jdemeyer"
}
```

I don't like this syntax:

```
    """
    Extra objects to place in the global namespace in which tests are run.
    Normally this should be empty but there are special cases where it may
    be useful.

    In particular, on Python 3 add ``long`` as an alias for ``int`` so that
    tests that use the ``long`` built-in (of which there are many) still pass.
    We do this so that the test suite can run on Python 3 while Python 2 is
    still the default.
    """
```

It looks too much like a docstring but it isn't. Use a `# comment` instead.



---

archive/issue_comments_340139.json:
```json
{
    "body": "That's standard syntax in Sphinx for documenting class attributes.",
    "created_at": "2018-03-29T08:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340139",
    "user": "https://github.com/embray"
}
```

That's standard syntax in Sphinx for documenting class attributes.



---

archive/issue_comments_340140.json:
```json
{
    "body": "Replying to [comment:25 embray]:\n> That's standard syntax in Sphinx for documenting class attributes.\n\nAccording to the [Sphinx documentation](http://www.sphinx-doc.org/en/stable/ext/autodoc.html#directive-autoattribute), Sphinx autodoc also supports the special comment syntax `#:` for this. And in fact, Sphinx itself uses that syntax.\n\nYou may think that there is no harm in using strings-which-are-not-docstrings like that, but the problem is that it teaches a bad habit. In particular the following does **not** contain a doctest despite looking like it does:\n\n```\nclass X(object):\n    attr = \"something\"\n    \"\"\"\n    EXAMPLES::\n        \n        sage: 1 + 1\n        3\n    \"\"\"\n```\n",
    "created_at": "2018-03-29T09:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340140",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 embray]:
> That's standard syntax in Sphinx for documenting class attributes.

According to the [Sphinx documentation](http://www.sphinx-doc.org/en/stable/ext/autodoc.html#directive-autoattribute), Sphinx autodoc also supports the special comment syntax `#:` for this. And in fact, Sphinx itself uses that syntax.

You may think that there is no harm in using strings-which-are-not-docstrings like that, but the problem is that it teaches a bad habit. In particular the following does **not** contain a doctest despite looking like it does:

```
class X(object):
    attr = "something"
    """
    EXAMPLES::
        
        sage: 1 + 1
        3
    """
```




---

archive/issue_comments_340141.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-29T09:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340141",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_340142.json:
```json
{
    "body": "I don't think it's a bad habit.  It's perfectly acceptable syntax and I think preferable from the Sphinx perspective over the special comment syntax.  If there *were* a notion in the Python language of attaching a docstring to a particular class attribute that's probably how I'd write it (unfortunately the concept doesn't quite fit in with how the language works, though personally I can think of ways Python might use it).\n\nI think your concern is more a peculiarity of Sage, which overemphasizes doctests in the first place (or, perhaps if this really a problem, the doctest parser should be modified to look in triple-quoted strings anywhere in a class or module body--I think that might make sense anyways).",
    "created_at": "2018-03-30T13:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340142",
    "user": "https://github.com/embray"
}
```

I don't think it's a bad habit.  It's perfectly acceptable syntax and I think preferable from the Sphinx perspective over the special comment syntax.  If there *were* a notion in the Python language of attaching a docstring to a particular class attribute that's probably how I'd write it (unfortunately the concept doesn't quite fit in with how the language works, though personally I can think of ways Python might use it).

I think your concern is more a peculiarity of Sage, which overemphasizes doctests in the first place (or, perhaps if this really a problem, the doctest parser should be modified to look in triple-quoted strings anywhere in a class or module body--I think that might make sense anyways).



---

archive/issue_events_022711.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:26:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24322#event-22711"
}
```



---

archive/issue_comments_340143.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24322#issuecomment-340143",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
