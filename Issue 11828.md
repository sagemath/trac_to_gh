# Issue 11828: block_matrix over cyclotomics fails

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2011-11-07 18:29:35

Assignee: jason, was

CC:  rbeezer

Block matrix with blocks of size >40 fails because the cyclotomic matrix constructor does not check for `entries=None`:

```
sage: F = CyclotomicField(5)
sage: block_matrix([This is the Trac macro *identity_matrix* that was inherited from the migration called with arguments (F,41), identity_matrix)](https://trac.sagemath.org/wiki/WikiMacros#identity_matrix-macro))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/vbraun/opt/sage-4.7.2.rc0/devel/sage-main/<ipython console> in <module>()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/matrix/constructor.pyc in block_matrix(*args, **kwds)
   2600                 row = M
   2601             else:
-> 2602                 row = row.augment(M)
   2603 
   2604         # append row to final matrix

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/matrix/matrix1.so in sage.matrix.matrix1.Matrix.augment (sage/matrix/matrix1.c:8300)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/matrix/matrix1.so in sage.matrix.matrix1.Matrix.new_matrix (sage/matrix/matrix1.c:10920)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/matrix/matrix_space.pyc in __call__(self, entries, coerce, copy, rows)
    481                 return self.zero_matrix().__copy__()
    482             else:
--> 483                 return self.__matrix_class(self, None, coerce=coerce, copy=copy)
    484 
    485         if isinstance(entries, (list, tuple)) and len(entries) > 0 and \

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/matrix/matrix_cyclo_dense.so in sage.matrix.matrix_cyclo_dense.Matrix_cyclo_dense.__init__ (sage/matrix/matrix_cyclo_dense.cpp:5688)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7504)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3300)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3203)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/rings/number_field/number_field.pyc in _element_constructor_(self, x)
   7035             return self._coerce_from_str(x)
   7036         else:
-> 7037             return self._coerce_non_number_field_element_in(x)
   7038 
   7039     # TODO:

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/rings/number_field/number_field.pyc in _coerce_non_number_field_element_in(self, x)
   5162         except (TypeError, AttributeError), msg:
   5163             pass
-> 5164         raise TypeError, type(x)
   5165 
   5166     def _coerce_from_str(self, x):

TypeError: <type 'NoneType'>
```



---

Attachment

Initial patch


---

Comment by vbraun created at 2011-11-07 18:35:17

Changing status from new to needs_review.


---

Comment by vbraun created at 2011-11-07 18:35:17

Patch fixes the issue for me.


---

Comment by johanbosman created at 2011-11-14 17:07:33

For me as well. ;).


---

Comment by johanbosman created at 2011-11-14 17:07:33

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-11-15 09:07:28

Resolution: duplicate
