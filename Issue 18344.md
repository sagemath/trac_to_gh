# Issue 18344: standard_packages()... should output installed and available versions

archive/issues_018344.json:
```json
{
    "body": "CC:  ncohen\n\nCurrently, the function `standard_packages()` only gives the latest available version of a package, not the version which is installed. I propose to actually return a list of triples\n\n```\n(package_name, installed_version, latest_version)\n```\n\nwhere `installed_version` is `None` if the package is not installed and `latest_version` is the newest available version.\n\nIf, for example, arb-2.5.0 is installed but arb-2.6.0 is availble, then one such triple would be\n\n```\n('arb', '2.5.0', '2.6.0')\n```\n\n\nIf arb is not installed, this would be:\n\n```\n('arb', None, '2.6.0')\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18581\n\n",
    "created_at": "2015-06-02T09:34:47Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "standard_packages()... should output installed and available versions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18344",
    "user": "jdemeyer"
}
```
CC:  ncohen

Currently, the function `standard_packages()` only gives the latest available version of a package, not the version which is installed. I propose to actually return a list of triples

```
(package_name, installed_version, latest_version)
```

where `installed_version` is `None` if the package is not installed and `latest_version` is the newest available version.

If, for example, arb-2.5.0 is installed but arb-2.6.0 is availble, then one such triple would be

```
('arb', '2.5.0', '2.6.0')
```


If arb is not installed, this would be:

```
('arb', None, '2.6.0')
```


Issue created by migration from https://trac.sagemath.org/ticket/18581





---

archive/issue_comments_248909.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-03T20:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248909",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_248910.json:
```json
{
    "body": "The actual change is\n\n```diff\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex 91ab594..6a9f33d 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -216,9 +216,13 @@ def _package_lists_from_sage_output(package_type,version=False,local=False):\n     When ``version=False``, the function returns a pair of list\n     ``(installed,not_installed)`` with the corresponding packages' name.\n \n-    When ``version=True``, the elements of each list are not package names but\n-    pairs ``(package_name,package_version)`` where ``version`` is a string\n-    representing the version of each package that is installed.\n+    When ``version=True``, the elements of each list are not package\n+    names but either pairs ``(package_name, installed_version)`` or\n+    triples ``(package_name, latest_version, installed_version)``,\n+    depending on whether ``local`` is ``True`` or ``False``. Here,\n+    ``latest_version`` is a string representing the version of the\n+    package available on the Sage package server, while\n+    ``installed_version`` is the version that is actually installed.\n \n     EXAMPLE::\n \n@@ -257,11 +261,10 @@ def _package_lists_from_sage_output(package_type,version=False,local=False):\n     if version:\n         for line in X:\n             line = line.split(' ')\n-            name,version = line[0],line[1]\n-            if is_package_installed(name):\n-                installed.append((name,version))\n+            if is_package_installed(line[0]):\n+                installed.append(tuple(line))\n             else:\n-                not_installed.append((name,version))\n+                not_installed.append(tuple(line))\n     else:\n         for name in X:\n             if is_package_installed(name):\n```\n\nalthough the branch includes all of the changes from #18456.",
    "created_at": "2015-06-03T20:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248910",
    "user": "jhpalmieri"
}
```

The actual change is

```diff
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index 91ab594..6a9f33d 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -216,9 +216,13 @@ def _package_lists_from_sage_output(package_type,version=False,local=False):
     When ``version=False``, the function returns a pair of list
     ``(installed,not_installed)`` with the corresponding packages' name.
 
-    When ``version=True``, the elements of each list are not package names but
-    pairs ``(package_name,package_version)`` where ``version`` is a string
-    representing the version of each package that is installed.
+    When ``version=True``, the elements of each list are not package
+    names but either pairs ``(package_name, installed_version)`` or
+    triples ``(package_name, latest_version, installed_version)``,
+    depending on whether ``local`` is ``True`` or ``False``. Here,
+    ``latest_version`` is a string representing the version of the
+    package available on the Sage package server, while
+    ``installed_version`` is the version that is actually installed.
 
     EXAMPLE::
 
@@ -257,11 +261,10 @@ def _package_lists_from_sage_output(package_type,version=False,local=False):
     if version:
         for line in X:
             line = line.split(' ')
-            name,version = line[0],line[1]
-            if is_package_installed(name):
-                installed.append((name,version))
+            if is_package_installed(line[0]):
+                installed.append(tuple(line))
             else:
-                not_installed.append((name,version))
+                not_installed.append(tuple(line))
     else:
         for name in X:
             if is_package_installed(name):
```

although the branch includes all of the changes from #18456.



---

archive/issue_comments_248911.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-04T06:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248911",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248912.json:
```json
{
    "body": "I don't want a **tuple** of lists of tuples, that's just too complicated. I meant just one list of tuples.\n\nActually thinking a bit more about this, a dictionary makes more sense: the keys are the package names and the values are tuples `(installed_version, latest_version)`.\n\nAnd I certainly want the output format to be the same for `local=True` and `local=False`.\n\nI also propose to make this a separate function `package_versions()` to avoid the many `if version` branches you will need. And then implement the old `_package_lists_from_sage_output()` as a very short function using this new `package_versions()` function.",
    "created_at": "2015-06-04T06:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248912",
    "user": "jdemeyer"
}
```

I don't want a **tuple** of lists of tuples, that's just too complicated. I meant just one list of tuples.

Actually thinking a bit more about this, a dictionary makes more sense: the keys are the package names and the values are tuples `(installed_version, latest_version)`.

And I certainly want the output format to be the same for `local=True` and `local=False`.

I also propose to make this a separate function `package_versions()` to avoid the many `if version` branches you will need. And then implement the old `_package_lists_from_sage_output()` as a very short function using this new `package_versions()` function.



---

archive/issue_comments_248913.json:
```json
{
    "body": "Note: everything I said in the last comment should be treated as a suggestion, not a demand.\n\nExcept for the fact that the output for `local=True` should also include the latest available version, that's really important for #18558.",
    "created_at": "2015-06-04T06:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248913",
    "user": "jdemeyer"
}
```

Note: everything I said in the last comment should be treated as a suggestion, not a demand.

Except for the fact that the output for `local=True` should also include the latest available version, that's really important for #18558.



---

archive/issue_comments_248914.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Note: everything I said in the last comment should be treated as a suggestion, not a demand.\n> \n> Except for the fact that the output for `local=True` should also include the latest available version, that's really important for #18558.\n\nThen I don't understand what you want. With `local=True`, you don't use the internet, but to find the latest available version, you need the internet. So I'm puzzled.\n\nRegarding your previous comment, if we implement `package_versions()`, then do you care much what sort of output `_package_lists_from_sage_output` produces? Should I just revert it back to the output it had in #18456?",
    "created_at": "2015-06-04T15:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248914",
    "user": "jhpalmieri"
}
```

Replying to [comment:6 jdemeyer]:
> Note: everything I said in the last comment should be treated as a suggestion, not a demand.
> 
> Except for the fact that the output for `local=True` should also include the latest available version, that's really important for #18558.

Then I don't understand what you want. With `local=True`, you don't use the internet, but to find the latest available version, you need the internet. So I'm puzzled.

Regarding your previous comment, if we implement `package_versions()`, then do you care much what sort of output `_package_lists_from_sage_output` produces? Should I just revert it back to the output it had in #18456?



---

archive/issue_comments_248915.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> Then I don't understand what you want. With `local=True`, you don't use the internet, but to find the latest available version, you need the internet. So I'm puzzled.\n\nOr at least, that's how \"latest available version\" is defined in the earlier versions. Do you just want to read the data from `build/pkgs/benzene/package_version.txt`, etc.? What do you do with old style packages?",
    "created_at": "2015-06-04T15:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248915",
    "user": "jhpalmieri"
}
```

Replying to [comment:7 jhpalmieri]:
> Then I don't understand what you want. With `local=True`, you don't use the internet, but to find the latest available version, you need the internet. So I'm puzzled.

Or at least, that's how "latest available version" is defined in the earlier versions. Do you just want to read the data from `build/pkgs/benzene/package_version.txt`, etc.? What do you do with old style packages?



---

archive/issue_comments_248916.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> Then I don't understand what you want. With `local=True`, you don't use the internet, but to find the latest available version, you need the internet. So I'm puzzled.\nYou're right, I was only thinking about new-style packages. I propose the following:\n- for new-style packages, read the latest available version from `buikd/pkgs/foo/package_version.txt`\n- for old-style packages with `local=True`, use `None` as latest available version.",
    "created_at": "2015-06-04T16:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248916",
    "user": "jdemeyer"
}
```

Replying to [comment:7 jhpalmieri]:
> Then I don't understand what you want. With `local=True`, you don't use the internet, but to find the latest available version, you need the internet. So I'm puzzled.
You're right, I was only thinking about new-style packages. I propose the following:
- for new-style packages, read the latest available version from `buikd/pkgs/foo/package_version.txt`
- for old-style packages with `local=True`, use `None` as latest available version.



---

archive/issue_comments_248917.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> Regarding your previous comment, if we implement `package_versions()`, then do you care much what sort of output `_package_lists_from_sage_output` produces?\nIf we do implement `package_versions()`, then `_package_lists_from_sage_output` shouldn't have a `version` argument.",
    "created_at": "2015-06-04T16:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248917",
    "user": "jdemeyer"
}
```

Replying to [comment:7 jhpalmieri]:
> Regarding your previous comment, if we implement `package_versions()`, then do you care much what sort of output `_package_lists_from_sage_output` produces?
If we do implement `package_versions()`, then `_package_lists_from_sage_output` shouldn't have a `version` argument.



---

archive/issue_comments_248918.json:
```json
{
    "body": "Okay, then should we rewrite `sage --standard` (etc.) to just read data from `build/pkgs/.../package_version.txt`? I think you're saying this:\n\n- if `local` is True, just read `package_version.txt` information. For old-style packages, we don't even know about them in that case.\n- if `local` is False, still use `package_version.txt` for new-style packages. For old-style packages, check the servers.\n\nThat sounds okay to me.",
    "created_at": "2015-06-04T16:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248918",
    "user": "jhpalmieri"
}
```

Okay, then should we rewrite `sage --standard` (etc.) to just read data from `build/pkgs/.../package_version.txt`? I think you're saying this:

- if `local` is True, just read `package_version.txt` information. For old-style packages, we don't even know about them in that case.
- if `local` is False, still use `package_version.txt` for new-style packages. For old-style packages, check the servers.

That sounds okay to me.



---

archive/issue_comments_248919.json:
```json
{
    "body": "I suppose to make this work well, when a package is installed, we should record its type in its record in `local/var/lib/sage/installed`. I'm not sure I want to bother with that. As it is, if someone installs an old-style package, we don't know what type it is without checking the servers (and the servers are not 100% accurate: e.g., `zeromq` is listed as both standard and optional on the servers).\n\nCurrently, `sage --optional` (etc.) ignores the files in `var/lib/sage/installed` when compiling a list of packages to print: it only checks `build/pkgs` and the servers. (It does check those files to see what version of a package was installed.) I'm not sure of a better way to proceed, especially if `local` is True.",
    "created_at": "2015-06-04T17:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248919",
    "user": "jhpalmieri"
}
```

I suppose to make this work well, when a package is installed, we should record its type in its record in `local/var/lib/sage/installed`. I'm not sure I want to bother with that. As it is, if someone installs an old-style package, we don't know what type it is without checking the servers (and the servers are not 100% accurate: e.g., `zeromq` is listed as both standard and optional on the servers).

Currently, `sage --optional` (etc.) ignores the files in `var/lib/sage/installed` when compiling a list of packages to print: it only checks `build/pkgs` and the servers. (It does check those files to see what version of a package was installed.) I'm not sure of a better way to proceed, especially if `local` is True.



---

archive/issue_comments_248920.json:
```json
{
    "body": "Replying to [comment:11 jhpalmieri]:\n> Okay, then should we rewrite `sage --standard` (etc.) to just read data from `build/pkgs/.../package_version.txt`?\nI don't know, really. What would you find easier, changing `sage --standard` or changing the Sage library code? Nathann, do you have an opinion on this?\n\n> I think you're saying this:\n> \n> - if `local` is True, just read `package_version.txt` information. For old-style packages, we don't even know about them in that case.\n> - if `local` is False, still use `package_version.txt` for new-style packages. For old-style packages, check the servers.\nYes, indeed.",
    "created_at": "2015-06-04T17:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248920",
    "user": "jdemeyer"
}
```

Replying to [comment:11 jhpalmieri]:
> Okay, then should we rewrite `sage --standard` (etc.) to just read data from `build/pkgs/.../package_version.txt`?
I don't know, really. What would you find easier, changing `sage --standard` or changing the Sage library code? Nathann, do you have an opinion on this?

> I think you're saying this:
> 
> - if `local` is True, just read `package_version.txt` information. For old-style packages, we don't even know about them in that case.
> - if `local` is False, still use `package_version.txt` for new-style packages. For old-style packages, check the servers.
Yes, indeed.



---

archive/issue_comments_248921.json:
```json
{
    "body": "Replying to [comment:12 jhpalmieri]:\n> I suppose to make this work well, when a package is installed, we should record its type in its record in `local/var/lib/sage/installed`.\nI don't see why we need to change that. I think the current way of determining packages is good enough, especially since we're having fewer and fewer old-style packages. So, I would focus on getting new-style package right.",
    "created_at": "2015-06-04T18:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248921",
    "user": "jdemeyer"
}
```

Replying to [comment:12 jhpalmieri]:
> I suppose to make this work well, when a package is installed, we should record its type in its record in `local/var/lib/sage/installed`.
I don't see why we need to change that. I think the current way of determining packages is good enough, especially since we're having fewer and fewer old-style packages. So, I would focus on getting new-style package right.



---

archive/issue_comments_248922.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-04T19:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248922",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248923.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-04T19:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248923",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248924.json:
```json
{
    "body": "It's pretty easy to change `sage --standard`: all of the information is there, it's just a matter of how things are printed out. I might even consider the old way a bug. Here's a new version.",
    "created_at": "2015-06-04T19:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248924",
    "user": "jhpalmieri"
}
```

It's pretty easy to change `sage --standard`: all of the information is there, it's just a matter of how things are printed out. I might even consider the old way a bug. Here's a new version.



---

archive/issue_comments_248925.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-04T22:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248925",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248926.json:
```json
{
    "body": "Can you replace the string `\"not_installed\"` in `package_versions()` by `None`? It's just because checking `x == \"not_installed\"` is a lot stranger and harder to remember than checking `x is None`.",
    "created_at": "2015-06-04T22:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248926",
    "user": "jdemeyer"
}
```

Can you replace the string `"not_installed"` in `package_versions()` by `None`? It's just because checking `x == "not_installed"` is a lot stranger and harder to remember than checking `x is None`.



---

archive/issue_comments_248927.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-04T22:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248927",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248928.json:
```json
{
    "body": "Okay.",
    "created_at": "2015-06-04T22:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248928",
    "user": "jhpalmieri"
}
```

Okay.



---

archive/issue_comments_248929.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-04T22:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248929",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248930.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-05T14:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248930",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248931.json:
```json
{
    "body": "Doesn't this need to be changed also?\n\n```\nif versions[p][0] != 'not_installed'\n```\n",
    "created_at": "2015-06-05T14:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248931",
    "user": "jdemeyer"
}
```

Doesn't this need to be changed also?

```
if versions[p][0] != 'not_installed'
```




---

archive/issue_comments_248932.json:
```json
{
    "body": "For `is_package_installed()`, can you add as doctest\n\n```\nsage: is_package_installed('pari')\nTrue\n```\n\njust because `sage` is special (it doesn't have a version number)",
    "created_at": "2015-06-05T14:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248932",
    "user": "jdemeyer"
}
```

For `is_package_installed()`, can you add as doctest

```
sage: is_package_installed('pari')
True
```

just because `sage` is special (it doesn't have a version number)



---

archive/issue_comments_248933.json:
```json
{
    "body": "Instead of running `sage --{} --dump` (with `{} == \"standard\"` for example), why don't you directly run\n\n```\nsage-list-packages {} --dump\n```\n\n(this is significantly faster since it avoids all the shell script overhead like `sage-env`)",
    "created_at": "2015-06-05T14:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248933",
    "user": "jdemeyer"
}
```

Instead of running `sage --{} --dump` (with `{} == "standard"` for example), why don't you directly run

```
sage-list-packages {} --dump
```

(this is significantly faster since it avoids all the shell script overhead like `sage-env`)



---

archive/issue_comments_248934.json:
```json
{
    "body": "Instead of this strange test\n\n```\nstd['glpk'][0] >= '4.55'\n```\n\ncouldn't you just show the actual result of something like\n\n```\nstd['zn_poly']\n```\n\n(a package which hasn't been updated in a long time in Sage and whose upstream is dead, so changes in the version number are unlikely)",
    "created_at": "2015-06-05T14:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248934",
    "user": "jdemeyer"
}
```

Instead of this strange test

```
std['glpk'][0] >= '4.55'
```

couldn't you just show the actual result of something like

```
std['zn_poly']
```

(a package which hasn't been updated in a long time in Sage and whose upstream is dead, so changes in the version number are unlikely)



---

archive/issue_comments_248935.json:
```json
{
    "body": "I would also like to see `package_versions()` added to `sage.misc.all`",
    "created_at": "2015-06-05T14:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248935",
    "user": "jdemeyer"
}
```

I would also like to see `package_versions()` added to `sage.misc.all`



---

archive/issue_comments_248936.json:
```json
{
    "body": "This sentence is missing a final period: `If ``local`` is False, then Sage's servers are queried for package information`",
    "created_at": "2015-06-05T14:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248936",
    "user": "jdemeyer"
}
```

This sentence is missing a final period: `If ``local`` is False, then Sage's servers are queried for package information`



---

archive/issue_comments_248937.json:
```json
{
    "body": "Is there a reason why\n\n```\n./sage --optional --local\n```\n\ndoes *not* contain the lastest available version? (with `--dump`, it does)",
    "created_at": "2015-06-05T15:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248937",
    "user": "jdemeyer"
}
```

Is there a reason why

```
./sage --optional --local
```

does *not* contain the lastest available version? (with `--dump`, it does)



---

archive/issue_comments_248938.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-05T15:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248938",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-05T15:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248940.json:
```json
{
    "body": "The `zn_poly` doctest makes me a little nervous, in case the version does change, but I added a note to SPKG.txt about it, just in case.\n\nReplying to [comment:26 jdemeyer]:\n> Is there a reason why\n> {{{\n> ./sage --optional --local\n> }}}\n> does *not* contain the lastest available version? (with `--dump`, it does)\n\nSorry, I missed that case in my changes to `sage-list-packages`.",
    "created_at": "2015-06-05T15:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248940",
    "user": "jhpalmieri"
}
```

The `zn_poly` doctest makes me a little nervous, in case the version does change, but I added a note to SPKG.txt about it, just in case.

Replying to [comment:26 jdemeyer]:
> Is there a reason why
> {{{
> ./sage --optional --local
> }}}
> does *not* contain the lastest available version? (with `--dump`, it does)

Sorry, I missed that case in my changes to `sage-list-packages`.



---

archive/issue_comments_248941.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-05T15:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248941",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248942.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-06T08:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248942",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248943.json:
```json
{
    "body": "Replying to [comment:28 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[caa8301](http://git.sagemath.org/sage.git/commit/?id=caa8301969391828718510a45eab8eface47a717)||`trac 18581: fix for 'sage --optional --local'`||\n\nYou also need to fix the header:\n\n```\njdemeyer@tamiyo:/usr/local/src/sage-git$ ./sage --optional --local\n[package] .............................. [installed version]\n4ti2.................................... 1.6.5 (1.6.5)\narb..................................... 2.5.0 (2.6.0)\nautotools............................... 20141105 (not_installed)\nbenzene................................. 20130630 (not_installed)\nbliss................................... 0.72.p1 (not_installed)\n[...]\n```\n",
    "created_at": "2015-06-06T08:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248943",
    "user": "jdemeyer"
}
```

Replying to [comment:28 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[caa8301](http://git.sagemath.org/sage.git/commit/?id=caa8301969391828718510a45eab8eface47a717)||`trac 18581: fix for 'sage --optional --local'`||

You also need to fix the header:

```
jdemeyer@tamiyo:/usr/local/src/sage-git$ ./sage --optional --local
[package] .............................. [installed version]
4ti2.................................... 1.6.5 (1.6.5)
arb..................................... 2.5.0 (2.6.0)
autotools............................... 20141105 (not_installed)
benzene................................. 20130630 (not_installed)
bliss................................... 0.72.p1 (not_installed)
[...]
```




---

archive/issue_comments_248944.json:
```json
{
    "body": "Nathann, do you have any comments about this ticket?",
    "created_at": "2015-06-06T08:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248944",
    "user": "jdemeyer"
}
```

Nathann, do you have any comments about this ticket?



---

archive/issue_comments_248945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-06T15:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248945",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-06T16:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248947.json:
```json
{
    "body": "I fixed the header. I also made some stylistic changes, for example replacing \"foo,bar\" with \"foo, bar\" in various places, and cutting most of the lines to fewer than 80 characters.",
    "created_at": "2015-06-06T16:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248947",
    "user": "jhpalmieri"
}
```

I fixed the header. I also made some stylistic changes, for example replacing "foo,bar" with "foo, bar" in various places, and cutting most of the lines to fewer than 80 characters.



---

archive/issue_comments_248948.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-06T16:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248948",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248949.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-07T08:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248949",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248950.json:
```json
{
    "body": "Your last changes made me notice this:\n\n```\npname = re.sub(\"(\\.|-)p[0-9]+$\", \"\", pname) # strip .p0\npname = re.sub(\"(\\.|-)[0-9].*\", \"\", pname) # strip version number\n```\n\n\nThat's actually too complicated and also wrong. As far as I know, all other places in Sage handling packages just split on the first `-` and that should be done here also.",
    "created_at": "2015-06-07T08:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248950",
    "user": "jdemeyer"
}
```

Your last changes made me notice this:

```
pname = re.sub("(\.|-)p[0-9]+$", "", pname) # strip .p0
pname = re.sub("(\.|-)[0-9].*", "", pname) # strip version number
```


That's actually too complicated and also wrong. As far as I know, all other places in Sage handling packages just split on the first `-` and that should be done here also.



---

archive/issue_comments_248951.json:
```json
{
    "body": "What's the point of this complication?\n\n```\nurlexec=os.path.join(os.path.dirname(sys.argv[0]), \"sage-download-file\")\nMIRROR_URL = os.popen(urlexec+\" --print-fastest-mirror\").read().strip()\n```\n\n\nWhy not simply\n\n```\nMIRROR_URL = os.popen(\"sage-download-file --print-fastest-mirror\").read().strip()\n```\n",
    "created_at": "2015-06-07T08:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248951",
    "user": "jdemeyer"
}
```

What's the point of this complication?

```
urlexec=os.path.join(os.path.dirname(sys.argv[0]), "sage-download-file")
MIRROR_URL = os.popen(urlexec+" --print-fastest-mirror").read().strip()
```


Why not simply

```
MIRROR_URL = os.popen("sage-download-file --print-fastest-mirror").read().strip()
```




---

archive/issue_comments_248952.json:
```json
{
    "body": "> Your last changes made me notice this:\n> {{{\n> pname = re.sub(\"(\\.|-)p[0-9]+$\", \"\", pname) # strip .p0\n> pname = re.sub(\"(\\.|-)[0-9].*\", \"\", pname) # strip version number\n> }}}\n> \n> That's actually too complicated and also wrong. As far as I know, all other places in Sage handling packages just split on the first `-` and that should be done here also.\n\nYou already claimed that on another ticket, and were answered with counter-examples: http://trac.sagemath.org/ticket/18408#comment:20\n\nNathann",
    "created_at": "2015-06-07T08:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248952",
    "user": "ncohen"
}
```

> Your last changes made me notice this:
> {{{
> pname = re.sub("(\.|-)p[0-9]+$", "", pname) # strip .p0
> pname = re.sub("(\.|-)[0-9].*", "", pname) # strip version number
> }}}
> 
> That's actually too complicated and also wrong. As far as I know, all other places in Sage handling packages just split on the first `-` and that should be done here also.

You already claimed that on another ticket, and were answered with counter-examples: http://trac.sagemath.org/ticket/18408#comment:20

Nathann



---

archive/issue_comments_248953.json:
```json
{
    "body": "Instead of\n\n```\nlocal_non_filtered = os.listdir(SAGE_PKGS)\nlocal = {}\nfor p in local_non_filtered:\n```\n\nthe following is easier to understand:\n\n```\nlocal = {}\nfor p in os.listdir(SAGE_PKGS):\n```\n",
    "created_at": "2015-06-07T08:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248953",
    "user": "jdemeyer"
}
```

Instead of

```
local_non_filtered = os.listdir(SAGE_PKGS)
local = {}
for p in local_non_filtered:
```

the following is easier to understand:

```
local = {}
for p in os.listdir(SAGE_PKGS):
```




---

archive/issue_comments_248954.json:
```json
{
    "body": "Replying to [comment:38 ncohen]:\n> You already claimed that on another ticket, and were answered with counter-examples: http://trac.sagemath.org/ticket/18408#comment:20\n\n1. I believe those counter-examples are gone now (but correct me if I'm wrong)\n2. Splitting package names from versions should be done consistently, it's not that every script can independently decide how to do that. In particular, I find it an obvious requirement that the package name reported by `./sage --optional` should be accepted by `./sage -i`.",
    "created_at": "2015-06-07T09:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248954",
    "user": "jdemeyer"
}
```

Replying to [comment:38 ncohen]:
> You already claimed that on another ticket, and were answered with counter-examples: http://trac.sagemath.org/ticket/18408#comment:20

1. I believe those counter-examples are gone now (but correct me if I'm wrong)
2. Splitting package names from versions should be done consistently, it's not that every script can independently decide how to do that. In particular, I find it an obvious requirement that the package name reported by `./sage --optional` should be accepted by `./sage -i`.



---

archive/issue_comments_248955.json:
```json
{
    "body": "> 1. I believe those counter-examples are gone now (but correct me if I'm wrong)\n\nhttp://mirror.switch.ch/mirror/sagemath//spkg/optional/list\n\nLook for 'stein'\n\n> 2. Splitting package names from versions should be done consistently, it's not that every script can independently decide how to do that. In particular, I find it an obvious requirement that the package name reported by `./sage --optional` should be accepted by `./sage -i`.\n\nI agree, but that's not my point. My point is that you try to enforce a standard which is not respected by Sage. If you wish for all packages to be easily split into [name,version] by splitting the first '-' (which also means no '-' should appear in their name), I totally agree with you. But it should be done this way:\n1) Fix the names\n2) Add a consistency check somewhere to make sure it does not break in the future\n3) Change the regexp\n\nNathann",
    "created_at": "2015-06-07T09:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248955",
    "user": "ncohen"
}
```

> 1. I believe those counter-examples are gone now (but correct me if I'm wrong)

http://mirror.switch.ch/mirror/sagemath//spkg/optional/list

Look for 'stein'

> 2. Splitting package names from versions should be done consistently, it's not that every script can independently decide how to do that. In particular, I find it an obvious requirement that the package name reported by `./sage --optional` should be accepted by `./sage -i`.

I agree, but that's not my point. My point is that you try to enforce a standard which is not respected by Sage. If you wish for all packages to be easily split into [name,version] by splitting the first '-' (which also means no '-' should appear in their name), I totally agree with you. But it should be done this way:
1) Fix the names
2) Add a consistency check somewhere to make sure it does not break in the future
3) Change the regexp

Nathann



---

archive/issue_comments_248956.json:
```json
{
    "body": "Replying to [comment:41 ncohen]:\n> If you wish for all packages to be easily split into [name,version] by splitting the first '-'\nThat's not my wish, that how `sage-fix-pkg-checksums` and `./sage -i` already handle packages.\n\nNote that\n\n```\n./sage -i database_jones_numfield\n```\n\ndoes try to install the package `database_jones_numfield-v4`, so you cannot claim that the name of the package is \"`database_jones_numfield-v4`\" without a version number.\n\nConversely,\n\n```\n./sage -i database_stein_watkins_mini\n```\n\ncannot install the old-style package \"`database_stein_watkins_mini.p0`\" (even if you remove `build/pkgs/database_stein_watkins_mini`) because the `.p0` is not seen as a version number (and I don't think it should!)",
    "created_at": "2015-06-07T09:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248956",
    "user": "jdemeyer"
}
```

Replying to [comment:41 ncohen]:
> If you wish for all packages to be easily split into [name,version] by splitting the first '-'
That's not my wish, that how `sage-fix-pkg-checksums` and `./sage -i` already handle packages.

Note that

```
./sage -i database_jones_numfield
```

does try to install the package `database_jones_numfield-v4`, so you cannot claim that the name of the package is "`database_jones_numfield-v4`" without a version number.

Conversely,

```
./sage -i database_stein_watkins_mini
```

cannot install the old-style package "`database_stein_watkins_mini.p0`" (even if you remove `build/pkgs/database_stein_watkins_mini`) because the `.p0` is not seen as a version number (and I don't think it should!)



---

archive/issue_comments_248957.json:
```json
{
    "body": "> cannot install the old-style package \"`database_stein_watkins_mini.p0`\" (even if you remove `build/pkgs/database_stein_watkins_mini`) because the `.p0` is not seen as a version number (and I don't think it should!)\n\nOkay, so you are just telling me that \"only what follows a '-' character is a version number\" precisely because that's what the script handle (which is a bug). And to prove it, you explain to me that \"p0\" is clearly not a version number.\n\nCan we talk about the list of packages online? You set my patch to 'needs_work' because 'extcode' is not a standard package according to you. But of course, the official list of Sage's package had to be what is listed on the mirrors, don't you think? So how can you claim that 'extcode' is not a standard package when the opposite is stated on our website?\n\nDo you see what's happening here? Double standards. You don't want to fix this problem because you are lazy, yet you expect me to magically 'update the online list of packages' despite knowing that I have absolutely no way to make that happen.\n\nNathann",
    "created_at": "2015-06-07T09:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248957",
    "user": "ncohen"
}
```

> cannot install the old-style package "`database_stein_watkins_mini.p0`" (even if you remove `build/pkgs/database_stein_watkins_mini`) because the `.p0` is not seen as a version number (and I don't think it should!)

Okay, so you are just telling me that "only what follows a '-' character is a version number" precisely because that's what the script handle (which is a bug). And to prove it, you explain to me that "p0" is clearly not a version number.

Can we talk about the list of packages online? You set my patch to 'needs_work' because 'extcode' is not a standard package according to you. But of course, the official list of Sage's package had to be what is listed on the mirrors, don't you think? So how can you claim that 'extcode' is not a standard package when the opposite is stated on our website?

Do you see what's happening here? Double standards. You don't want to fix this problem because you are lazy, yet you expect me to magically 'update the online list of packages' despite knowing that I have absolutely no way to make that happen.

Nathann



---

archive/issue_comments_248958.json:
```json
{
    "body": "Nathann, in #18456 you decided to change\n\n```\ndef split_pkgname(name):\n    try:\n        basename, version = name.split('-', 1)\n    except ValueError:\n        # Some packages such as currently \"csage\" aren't versioned, or\n        # have non-standard versioning, e.g. \"database_stein_watkins_mini.p0\".\n        basename = name\n        version = \"\"\n    return basename, version\n```\n\nto\n\n```\ndef pkgname_split(name):\n    pname = name.split(' ')[0]\n    pname = re.sub(\"(\\.|-)p[0-9]+$\",\"\",pname) # strip .p0\n    pname = re.sub(\"(\\.|-)[0-9].*\",\"\",pname) # strip version number\n    return (pname,name[len(pname)+1:])\n```\n\nwithout justification or giving a reason why the latter is correct (where did those regexes come from?)\n\nUnless you can give me a good reason why you changed that, I'm proposing to undo that change.",
    "created_at": "2015-06-07T12:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248958",
    "user": "jdemeyer"
}
```

Nathann, in #18456 you decided to change

```
def split_pkgname(name):
    try:
        basename, version = name.split('-', 1)
    except ValueError:
        # Some packages such as currently "csage" aren't versioned, or
        # have non-standard versioning, e.g. "database_stein_watkins_mini.p0".
        basename = name
        version = ""
    return basename, version
```

to

```
def pkgname_split(name):
    pname = name.split(' ')[0]
    pname = re.sub("(\.|-)p[0-9]+$","",pname) # strip .p0
    pname = re.sub("(\.|-)[0-9].*","",pname) # strip version number
    return (pname,name[len(pname)+1:])
```

without justification or giving a reason why the latter is correct (where did those regexes come from?)

Unless you can give me a good reason why you changed that, I'm proposing to undo that change.



---

archive/issue_comments_248959.json:
```json
{
    "body": "> Unless you can give me a good reason why you changed that, I'm proposing to undo that change.\n\nCase-by-case analysis of all packages. It works, for all pacakges that we have. In a name that ends by .p0, there is no denying that .p0 is not part of the package's name but indicates a version. Do you think that it will lead you anywhere to deny something like that?\n\nNathann",
    "created_at": "2015-06-07T12:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248959",
    "user": "ncohen"
}
```

> Unless you can give me a good reason why you changed that, I'm proposing to undo that change.

Case-by-case analysis of all packages. It works, for all pacakges that we have. In a name that ends by .p0, there is no denying that .p0 is not part of the package's name but indicates a version. Do you think that it will lead you anywhere to deny something like that?

Nathann



---

archive/issue_comments_248960.json:
```json
{
    "body": "http://mirror.switch.ch/mirror/sagemath/spkg/experimental/\n\nExample: `mayavi_2.2.1.spkg` with your parsing, the package's name is 'mayavi_2.2.1' and there is no version number.\n\nNathann",
    "created_at": "2015-06-07T12:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248960",
    "user": "ncohen"
}
```

http://mirror.switch.ch/mirror/sagemath/spkg/experimental/

Example: `mayavi_2.2.1.spkg` with your parsing, the package's name is 'mayavi_2.2.1' and there is no version number.

Nathann



---

archive/issue_comments_248961.json:
```json
{
    "body": "Replying to [comment:45 ncohen]:\n> > Unless you can give me a good reason why you changed that, I'm proposing to undo that change.\n> \n> Case-by-case analysis of all packages. It works, for all packages that we have. In a name that ends by .p0, there is no denying that .p0 is not part of the package's name but indicates a version. Do you think that it will lead you anywhere to deny something like that?\nIt's not a matter of denial, it's more a matter of consistency. What's the point of listing a package `FOO` in the output of `./sage --optional` if `./sage -i FOO` cannot install that package?\n\nInstead of making up contrived regular expressions to deal with wrong package names, let's just fix the packages instead. The package `database_stein_watkins_mini.p0` is already fixed by a new-style package and we should just remove the wrongly-named package.",
    "created_at": "2015-06-07T13:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248961",
    "user": "jdemeyer"
}
```

Replying to [comment:45 ncohen]:
> > Unless you can give me a good reason why you changed that, I'm proposing to undo that change.
> 
> Case-by-case analysis of all packages. It works, for all packages that we have. In a name that ends by .p0, there is no denying that .p0 is not part of the package's name but indicates a version. Do you think that it will lead you anywhere to deny something like that?
It's not a matter of denial, it's more a matter of consistency. What's the point of listing a package `FOO` in the output of `./sage --optional` if `./sage -i FOO` cannot install that package?

Instead of making up contrived regular expressions to deal with wrong package names, let's just fix the packages instead. The package `database_stein_watkins_mini.p0` is already fixed by a new-style package and we should just remove the wrongly-named package.



---

archive/issue_comments_248962.json:
```json
{
    "body": "Some data: if I just split on the first hyphen, I think the only packages where the versions come out differently are\n\n```\ndatabase_jones_numfield-v4   is 'v4' the version number?\ndatabase_stein_watkins_mini  already fixed\nmayavi_2.2.1                 is it mayavi, v 2.2.1, or mayavi_2.2.1, no version?\nreallib3-linux-20060728      is 'linux' part of the version number?\n```\n\nThe Jones database hasn't been updated since 2007, MayaVi2 hasn't been updated since 2008, and reallib3-linux-20060728 since 2006. Based on this, I find Jeroen's argument more convincing. (I mean, I find the argument for consistency in version-checking convincing to start with, and the fact that there are only a few old exceptions makes Nathann's counterargument less persuasive.)\n\nThere is a separate issue that the servers seem to be a mess. Moving packages from old-style to new-style will help make that less of a problem.",
    "created_at": "2015-06-07T16:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248962",
    "user": "jhpalmieri"
}
```

Some data: if I just split on the first hyphen, I think the only packages where the versions come out differently are

```
database_jones_numfield-v4   is 'v4' the version number?
database_stein_watkins_mini  already fixed
mayavi_2.2.1                 is it mayavi, v 2.2.1, or mayavi_2.2.1, no version?
reallib3-linux-20060728      is 'linux' part of the version number?
```

The Jones database hasn't been updated since 2007, MayaVi2 hasn't been updated since 2008, and reallib3-linux-20060728 since 2006. Based on this, I find Jeroen's argument more convincing. (I mean, I find the argument for consistency in version-checking convincing to start with, and the fact that there are only a few old exceptions makes Nathann's counterargument less persuasive.)

There is a separate issue that the servers seem to be a mess. Moving packages from old-style to new-style will help make that less of a problem.



---

archive/issue_comments_248963.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-07T16:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248963",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248964.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-07T16:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248964",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248965.json:
```json
{
    "body": "This is good for me, but I would like to give Nathann a chance to give his opinion.",
    "created_at": "2015-06-07T17:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248965",
    "user": "jdemeyer"
}
```

This is good for me, but I would like to give Nathann a chance to give his opinion.



---

archive/issue_comments_248966.json:
```json
{
    "body": "> This is good for me, but I would like to give Nathann a chance to give his opinion.\n\nI believe that you are breaking something that works. If you want to set a new standard (it is not currently enforced), fix the package's name first and then write some code to enforce the standard.\n\nNathann",
    "created_at": "2015-06-07T17:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248966",
    "user": "ncohen"
}
```

> This is good for me, but I would like to give Nathann a chance to give his opinion.

I believe that you are breaking something that works. If you want to set a new standard (it is not currently enforced), fix the package's name first and then write some code to enforce the standard.

Nathann



---

archive/issue_comments_248967.json:
```json
{
    "body": "Replying to [comment:52 ncohen]:\n> > This is good for me, but I would like to give Nathann a chance to give his opinion.\n> \n> I believe that you are breaking something that works.\nWhat worked before that I am breaking?\n\n> If you want to set a new standard (it is not currently enforced), fix the package's name first and then write some code to enforce the standard.\nThe current standard is that the full package name is split into a package-version pair by the first hyphen. This is probably not documented anywhere, but that's the current practice. This is the standard followed by `./sage -i` (*), by `sage-fix-pkg-checksums` and by `sage-list-packages` (until recently when you changed it).\n\nI am pretty sure that no script ever considered `mayavi_2.2.1` as the package `mayavi_2` with version `2.1`, so I'm wondering why you made it that way in #18456.\n\n(*) To be more precise, `./sage -i` splits by any hyphen, not just the first hyphen.",
    "created_at": "2015-06-07T18:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248967",
    "user": "jdemeyer"
}
```

Replying to [comment:52 ncohen]:
> > This is good for me, but I would like to give Nathann a chance to give his opinion.
> 
> I believe that you are breaking something that works.
What worked before that I am breaking?

> If you want to set a new standard (it is not currently enforced), fix the package's name first and then write some code to enforce the standard.
The current standard is that the full package name is split into a package-version pair by the first hyphen. This is probably not documented anywhere, but that's the current practice. This is the standard followed by `./sage -i` (*), by `sage-fix-pkg-checksums` and by `sage-list-packages` (until recently when you changed it).

I am pretty sure that no script ever considered `mayavi_2.2.1` as the package `mayavi_2` with version `2.1`, so I'm wondering why you made it that way in #18456.

(*) To be more precise, `./sage -i` splits by any hyphen, not just the first hyphen.



---

archive/issue_comments_248968.json:
```json
{
    "body": "I am spending a nice evening with a nice girl, and I don't want to have this conversation again. Have fun, Nathann",
    "created_at": "2015-06-07T18:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248968",
    "user": "ncohen"
}
```

I am spending a nice evening with a nice girl, and I don't want to have this conversation again. Have fun, Nathann



---

archive/issue_comments_248969.json:
```json
{
    "body": "The naming conventions for old-style spkgs are described [here](http://doc.sagemath.org/html/en/developer/packaging_old_spkgs.html#naming-your-spkg), and they insist that there is a hyphen separating the package name from the version.",
    "created_at": "2015-06-07T19:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248969",
    "user": "jhpalmieri"
}
```

The naming conventions for old-style spkgs are described [here](http://doc.sagemath.org/html/en/developer/packaging_old_spkgs.html#naming-your-spkg), and they insist that there is a hyphen separating the package name from the version.



---

archive/issue_comments_248970.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-07T20:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248970",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_248971.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-08T20:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18344#issuecomment-248971",
    "user": "vbraun"
}
```

Resolution: fixed
