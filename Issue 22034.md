# Issue 22034: py3 prepare some cases of zip behaviour

Issue created by migration from https://trac.sagemath.org/ticket/22271

Original creator: chapoton

Original creation time: 2017-01-29 10:38:18

as another step to py3

* take care of a reversed(zip()) in crystals
* make sure that factorizations can handle iterators


---

Comment by chapoton created at 2017-01-29 10:39:23

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-01-29 10:39:23

New commits:


---

Comment by jdemeyer created at 2017-01-29 16:44:07

As a general principle, I don't like code of the form

```
try:
    do_something()
except E:
    raise E("msg")
```

Especially if `msg` is meaningless or plain wrong. Just replace it by

```
do_something()
```

(I am talking about the `raise TypeError("x must be a list")` and also `raise TypeError("exponents of factors must be integers")`)


---

Comment by jdemeyer created at 2017-01-29 16:46:04

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-01-29 16:46:04

In this case, you probably don't need the conversion to `list` at all, since `enumerate()` can handle iterables. This works without conversion to list:

```
sage: list(enumerate(xrange(5)))
[(0, 0), (1, 1), (2, 2), (3, 3), (4, 4)]
```



---

Comment by jdemeyer created at 2017-01-29 17:11:38

Thinking even more about it, why not replace this whole block

```
        if not isinstance(x, (list, tuple)):
            try:
                x = list(x)
            except TypeError:
                raise TypeError("x must be a list")
        for i, t in enumerate(x):
            if not (isinstance(t, tuple) and len(t) == 2):
                raise TypeError("x must be a list of pairs (p, e) with e an integer")
            try:
                x[i] = (t[0], Integer(t[1]))
            except TypeError:
                raise TypeError("exponents of factors must be integers")
```

by the one-liner

```
x = [(p, Integer(e)) for (p,e) in x]
```



---

Comment by git created at 2017-01-29 17:27:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-29 17:29:29

good idea, done.


---

Comment by chapoton created at 2017-01-29 17:29:29

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-01-29 17:45:13

Let's wait for the patchbot.


---

Comment by chapoton created at 2017-01-29 21:08:24

bot seems to be green


---

Comment by jdemeyer created at 2017-01-30 08:36:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-02 22:09:10

Resolution: fixed
