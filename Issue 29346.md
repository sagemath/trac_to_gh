# Issue 29346: Obtain product with both Vrep and Hrep (if backend supports it)

Issue created by migration from https://trac.sagemath.org/ticket/29583

Original creator: @kliem

Original creation time: 2020-04-25 21:42:02

CC:  jipilab @laisrast

Keywords: polytopes. product

We set up the product of two polyhedra with both Vrepresentation and Hrepresentation. This a great improvement, if the backend supports precomputed data (currently `field`). Otherwise, it can be an improvement, if the Hrepresentation is much shorter than the Vrepresentation.

Before this ticket:


```
sage: Cb = polytopes.hypercube(7, backend='ppl')
sage: Cr = polytopes.cross_polytope(7, backend='ppl')
sage: %time _ = Cb*Cb
CPU times: user 2.58 s, sys: 16 ms, total: 2.6 s
Wall time: 2.59 s
sage: %time _ = Cr*Cr
CPU times: user 99.9 ms, sys: 0 ns, total: 99.9 ms
Wall time: 99.6 ms

sage: Cr_field = polytopes.cross_polytope(4, backend='field')
sage: Cb_field = polytopes.hypercube(4, backend='field')
sage: %time _ = Cb_field*Cr_field
CPU times: user 4.83 s, sys: 11 µs, total: 4.83 s
Wall time: 4.83 s

```


With this ticket:


```
sage: Cb = polytopes.hypercube(7, backend='ppl')
sage: Cr = polytopes.cross_polytope(7, backend='ppl')
sage: %time _ = Cb*Cb
CPU times: user 393 ms, sys: 20 ms, total: 413 ms
Wall time: 412 ms
sage: %time _ = Cr*Cr
CPU times: user 42.3 ms, sys: 62 µs, total: 42.3 ms
Wall time: 42 ms
sage: %time _ = Cr*Cr
CPU times: user 42.2 ms, sys: 87 µs, total: 42.3 ms
Wall time: 42 ms

sage: Cr_field = polytopes.cross_polytope(8, backend='field')
sage: Cb_field = polytopes.hypercube(8, backend='field')
sage: %time _ = Cb_field*Cr_field
CPU times: user 67.2 ms, sys: 0 ns, total: 67.2 ms
Wall time: 66.9 ms
sage: %time _ = Cr_field*Cr_field
CPU times: user 51 ms, sys: 132 µs, total: 51.1 ms
Wall time: 50.2 ms
sage: %time _ = Cb_field*Cb_field
CPU times: user 986 ms, sys: 15.7 ms, total: 1 s
Wall time: 1 s
```



---

Comment by @kliem created at 2020-04-25 21:42:43

Changing status from new to needs_review.


---

Comment by @kliem created at 2020-04-25 21:42:43

New commits:


---

Comment by jipilab created at 2020-05-11 14:21:05

Some timings in the description are repeated, probably you forgot "Cr*Cb" in the status quo and didn't show it in the new times...

If you can fix this quickly, that'd be helpful!

Spaces between binary operation:


```diff
-           sage: P*P1 == Q*Q1
+           sage: P * P1 == Q * Q1
+           True
-           sage: P.polar(in_affine_span=True)*P1 == Q.polar(in_affine_span=True)*Q1
+           sage: P.polar(in_affine_span=True) * P1 == Q.polar(in_affine_span=True) * Q1
+           True
```


and


```diff
-        new_vertices = (tuple(x)+tuple(y)
+        new_vertices = (tuple(x) + tuple(y)
+                        for x in self.vertex_generator() for y in other.vertex_generator())
```


Might be nice to correct the coding styles with the multiple statements on one line with the `:` ?


---

Comment by jipilab created at 2020-05-11 14:21:12

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2020-05-11 15:23:08

New commits:


---

Comment by @kliem created at 2020-05-11 15:23:08

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-05-12 10:33:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-05-12 10:35:05

It looks good to me. I added some more pep8 cleaning. 

If the bot is happy and you agree with my changes, I would say it can be put on positive review. Hopefully, the changes won't cause too many conflicts.


---

Comment by @kliem created at 2020-05-12 10:37:56

LGTM. Thank you.


---

Comment by @kliem created at 2020-05-12 18:14:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-05-20 22:52:44

Merge conflict


---

Comment by vbraun created at 2020-05-20 22:52:44

Changing status from positive_review to needs_work.


---

Comment by @kliem created at 2020-05-25 06:38:33

Replying to [comment:10 vbraun]:
> Merge conflict

`@`vbraun: I believe this is no longer an issue.

The merge conflict appears to be with #28982, which was just rejected because it needs to be rebased (due to failing doctests). IMO we should just rebase #28982 and leave this ticket as it is.


---

Comment by @kliem created at 2020-05-25 06:38:42

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2020-05-28 09:24:00

This looks reasonable to me.

`@`Volker: Let us know if there are still further problems with merging this ticket based as it is. It seems to work for us.


---

Comment by jipilab created at 2020-05-28 09:24:00

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-05-28 18:14:21

Changing keywords from "polytopes. product" to "polytopes. product, sd109".


---

Comment by @kliem created at 2020-05-29 06:08:51

I just pulled this in to 9.2.beta0 and it appears to work fine.


---

Comment by vbraun created at 2020-05-29 21:16:35

Resolution: fixed
