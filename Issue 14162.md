# Issue 14162: Zero does not belong to zero ideal of a number field

archive/issues_014162.json:
```json
{
    "body": "Assignee: @loefflerd\n\nThe following is mathematically wrong:\n\n\n```\nsage: 0 in CyclotomicField(3).ideal(0)\nFalse\n```\n\n\nIt comes from the function _contains_(self, x) in the class NumberFieldIdeal (file sage/rings/number_field/number_field_ideal.py), which tries to compute the coordinates of the element in a basis (over ZZ) of the ideal. The function coordinates(self, x) fails for the zero ideal, raising a TypeError (in fact when _contains_ is called directly, a TypeError is raised).\nA workaround is to replace\n\n\n```\ndef _contains_(self, x):\n    return self.coordinates(self.number_field()(x)).denominator() == 1\n```\n\n\nwith\n\n\n\n```\ndef _contains_(self, x):\n    return x==0 or self.coordinates(self.number_field()(x)).denominator() == 1\n```\n\n\nbut I am not sure if it is the \"right\" way to do it.\nIs it desirable to have the _contains_ function in sage/rings/ideal.py catch the TypeError (silently)?\n\nIssue created by migration from https://trac.sagemath.org/ticket/14366\n\n",
    "created_at": "2013-03-27T10:18:40Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Zero does not belong to zero ideal of a number field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14162",
    "user": "https://trac.sagemath.org/admin/accounts/users/olitb"
}
```
Assignee: @loefflerd

The following is mathematically wrong:


```
sage: 0 in CyclotomicField(3).ideal(0)
False
```


It comes from the function _contains_(self, x) in the class NumberFieldIdeal (file sage/rings/number_field/number_field_ideal.py), which tries to compute the coordinates of the element in a basis (over ZZ) of the ideal. The function coordinates(self, x) fails for the zero ideal, raising a TypeError (in fact when _contains_ is called directly, a TypeError is raised).
A workaround is to replace


```
def _contains_(self, x):
    return self.coordinates(self.number_field()(x)).denominator() == 1
```


with



```
def _contains_(self, x):
    return x==0 or self.coordinates(self.number_field()(x)).denominator() == 1
```


but I am not sure if it is the "right" way to do it.
Is it desirable to have the _contains_ function in sage/rings/ideal.py catch the TypeError (silently)?

Issue created by migration from https://trac.sagemath.org/ticket/14366





---

archive/issue_comments_177586.json:
```json
{
    "body": "It seems to me that there is generic code in sage/rings/ideal.py for `__contains__` and this code shouldn't be touched. Basically, what it does is punts to the specific case's implementation of `_contains_`. I think the bug you point out means that for number field ideals, `_contains_` is buggy. So, the type of fix you suggest I think makes sense. Though, rather than `x == 0`, it should probably be `x == self.number_field().zero()`, otherwise anything that is 0 will evaluate as True.\n\n(I do wonder why the code for `__contains__` in sage/rings/ideal.py doesn't just return True for the zero element).",
    "created_at": "2013-04-08T04:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177586",
    "user": "https://github.com/rharron"
}
```

It seems to me that there is generic code in sage/rings/ideal.py for `__contains__` and this code shouldn't be touched. Basically, what it does is punts to the specific case's implementation of `_contains_`. I think the bug you point out means that for number field ideals, `_contains_` is buggy. So, the type of fix you suggest I think makes sense. Though, rather than `x == 0`, it should probably be `x == self.number_field().zero()`, otherwise anything that is 0 will evaluate as True.

(I do wonder why the code for `__contains__` in sage/rings/ideal.py doesn't just return True for the zero element).



---

archive/issue_comments_177587.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-23T16:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177587",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_177588.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-07-24T08:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177588",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_177589.json:
```json
{
    "body": "Attachment [trac_14366.patch](tarball://root/attachments/some-uuid/ticket14366/trac_14366.patch) by mkosters created at 2013-07-24 08:11:19",
    "created_at": "2013-07-24T08:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177589",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Attachment [trac_14366.patch](tarball://root/attachments/some-uuid/ticket14366/trac_14366.patch) by mkosters created at 2013-07-24 08:11:19



---

archive/issue_comments_177590.json:
```json
{
    "body": "Now with a commit message.",
    "created_at": "2013-07-24T08:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177590",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Now with a commit message.



---

archive/issue_comments_177591.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-24T08:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177591",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_177592.json:
```json
{
    "body": "I just bumped into this bug myself. Wouldn't it make more sense to make coordinates() return an empty tuple instead? I believe this makes sense since 0 is in the zero-dimensional vector space.",
    "created_at": "2013-07-24T20:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177592",
    "user": "https://github.com/saraedum"
}
```

I just bumped into this bug myself. Wouldn't it make more sense to make coordinates() return an empty tuple instead? I believe this makes sense since 0 is in the zero-dimensional vector space.



---

archive/issue_comments_177593.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd51\".",
    "created_at": "2013-07-24T20:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177593",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "sd51".



---

archive/issue_comments_177594.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-07-24T20:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177594",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_177595.json:
```json
{
    "body": "`@`saraedum, what should the output of K.ideal(0).coordinates(1) be where K is a number field? What kind of error should it produce?",
    "created_at": "2013-07-24T21:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177595",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

`@`saraedum, what should the output of K.ideal(0).coordinates(1) be where K is a number field? What kind of error should it produce?



---

archive/issue_comments_177596.json:
```json
{
    "body": "Replying to [comment:8 mkosters]:\n> `@`saraedum, what should the output of K.ideal(0).coordinates(1) be where K is a number field? What kind of error should it produce?\n\nThis should raise a ValueError, I believe.",
    "created_at": "2013-07-24T22:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177596",
    "user": "https://github.com/saraedum"
}
```

Replying to [comment:8 mkosters]:
> `@`saraedum, what should the output of K.ideal(0).coordinates(1) be where K is a number field? What kind of error should it produce?

This should raise a ValueError, I believe.



---

archive/issue_comments_177597.json:
```json
{
    "body": "Replying to [comment:6 saraedum]:\n> I just bumped into this bug myself. Wouldn't it make more sense to make coordinates() return an empty tuple instead? I believe this makes sense since 0 is in the zero-dimensional vector space.\n\nYep, in vector spaces:\n\n\n```\nsage: V = QQ^1\nsage: W = V.subspace([0])\nsage: W.coordinates(0)\n[]\nsage: W.coordinates(1)\nTypeError\n```\n",
    "created_at": "2013-07-25T11:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177597",
    "user": "https://github.com/aghitza"
}
```

Replying to [comment:6 saraedum]:
> I just bumped into this bug myself. Wouldn't it make more sense to make coordinates() return an empty tuple instead? I believe this makes sense since 0 is in the zero-dimensional vector space.

Yep, in vector spaces:


```
sage: V = QQ^1
sage: W = V.subspace([0])
sage: W.coordinates(0)
[]
sage: W.coordinates(1)
TypeError
```




---

archive/issue_comments_177598.json:
```json
{
    "body": "The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?",
    "created_at": "2013-07-25T13:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177598",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?



---

archive/issue_comments_177599.json:
```json
{
    "body": "Replying to [comment:11 mkosters]:\n> The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?\n\nI agree. If you want to you could put this into a new ticket.",
    "created_at": "2013-07-25T13:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177599",
    "user": "https://github.com/saraedum"
}
```

Replying to [comment:11 mkosters]:
> The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?

I agree. If you want to you could put this into a new ticket.



---

archive/issue_comments_177600.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-07-25T13:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177600",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_177601.json:
```json
{
    "body": "Attachment [14366_method2.patch](tarball://root/attachments/some-uuid/ticket14366/14366_method2.patch) by mkosters created at 2013-07-25 13:52:12\n\n14366_method2.patch\u200b changes the coordinate function for the 0 ideal (but does not do relative coordinates), and fixes the containment bug.",
    "created_at": "2013-07-25T13:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177601",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Attachment [14366_method2.patch](tarball://root/attachments/some-uuid/ticket14366/14366_method2.patch) by mkosters created at 2013-07-25 13:52:12

14366_method2.patch​ changes the coordinate function for the 0 ideal (but does not do relative coordinates), and fixes the containment bug.



---

archive/issue_comments_177602.json:
```json
{
    "body": "Replying to [comment:12 saraedum]:\n> Replying to [comment:11 mkosters]:\n> > The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?\n> \n> I agree. If you want to you could put this into a new ticket.\n\nActually, I think it is not a good idea to do. Basically, modules (and ideals, integral closures) are not free any more (because the class number is not 1 in general), so a basis might not exist.",
    "created_at": "2013-07-25T14:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177602",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Replying to [comment:12 saraedum]:
> Replying to [comment:11 mkosters]:
> > The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?
> 
> I agree. If you want to you could put this into a new ticket.

Actually, I think it is not a good idea to do. Basically, modules (and ideals, integral closures) are not free any more (because the class number is not 1 in general), so a basis might not exist.



---

archive/issue_comments_177603.json:
```json
{
    "body": "I can't help thinking that an easier solution would be to use the ` _contains_()` method of the ideal's underlying Z-module (`self.free_module()`).\n\nWe could just reimplement ` coordinates(self, x)` as \n\n```python\ndef coordinates(self, x):\n     K = self.number_field()\n     V, from_V, to_V = K.absolute_vector_space()\n     return self.free_module().coordinates(to_V(K(x)))\n```\n \nand then there is no longer any need to worry about the special case of the zero ideal, it will be dealt with automatically.",
    "created_at": "2013-07-25T15:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177603",
    "user": "https://github.com/loefflerd"
}
```

I can't help thinking that an easier solution would be to use the ` _contains_()` method of the ideal's underlying Z-module (`self.free_module()`).

We could just reimplement ` coordinates(self, x)` as 

```python
def coordinates(self, x):
     K = self.number_field()
     V, from_V, to_V = K.absolute_vector_space()
     return self.free_module().coordinates(to_V(K(x)))
```
 
and then there is no longer any need to worry about the special case of the zero ideal, it will be dealt with automatically.



---

archive/issue_comments_177604.json:
```json
{
    "body": "Replace previous patches.",
    "created_at": "2013-07-25T15:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177604",
    "user": "https://trac.sagemath.org/admin/accounts/users/mkosters"
}
```

Replace previous patches.



---

archive/issue_comments_177605.json:
```json
{
    "body": "Attachment [14366_metrod3.patch](tarball://root/attachments/some-uuid/ticket14366/14366_metrod3.patch) by @loefflerd created at 2013-07-25 16:30:45\n\nLooks fine to me.",
    "created_at": "2013-07-25T16:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177605",
    "user": "https://github.com/loefflerd"
}
```

Attachment [14366_metrod3.patch](tarball://root/attachments/some-uuid/ticket14366/14366_metrod3.patch) by @loefflerd created at 2013-07-25 16:30:45

Looks fine to me.



---

archive/issue_comments_177606.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-25T16:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177606",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_040757.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-25T17:30:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14162#event-40757"
}
```



---

archive/issue_comments_177607.json:
```json
{
    "body": "Apply 14366_metrod3.patch\u200b\n\n(for patchbot)",
    "created_at": "2013-07-26T09:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177607",
    "user": "https://github.com/loefflerd"
}
```

Apply 14366_metrod3.patch​

(for patchbot)



---

archive/issue_comments_177608.json:
```json
{
    "body": "Apply 14366_metrod3.patch",
    "created_at": "2013-07-26T18:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177608",
    "user": "https://github.com/robertwb"
}
```

Apply 14366_metrod3.patch



---

archive/issue_comments_177609.json:
```json
{
    "body": "Apply 14366_metrod3.patch\n\n(for patchbot)",
    "created_at": "2013-07-26T18:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177609",
    "user": "https://github.com/robertwb"
}
```

Apply 14366_metrod3.patch

(for patchbot)



---

archive/issue_comments_177610.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T12:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14162#issuecomment-177610",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_040758.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:55:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14162",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14162#event-40758"
}
```
