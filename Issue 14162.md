# Issue 14162: Zero does not belong to zero ideal of a number field

Issue created by migration from https://trac.sagemath.org/ticket/14366

Original creator: olitb

Original creation time: 2013-03-27 10:18:40

Assignee: davidloeffler

The following is mathematically wrong:


```
sage: 0 in CyclotomicField(3).ideal(0)
False
```


It comes from the function _contains_(self, x) in the class NumberFieldIdeal (file sage/rings/number_field/number_field_ideal.py), which tries to compute the coordinates of the element in a basis (over ZZ) of the ideal. The function coordinates(self, x) fails for the zero ideal, raising a TypeError (in fact when _contains_ is called directly, a TypeError is raised).
A workaround is to replace


```
def _contains_(self, x):
    return self.coordinates(self.number_field()(x)).denominator() == 1
```


with



```
def _contains_(self, x):
    return x==0 or self.coordinates(self.number_field()(x)).denominator() == 1
```


but I am not sure if it is the "right" way to do it.
Is it desirable to have the _contains_ function in sage/rings/ideal.py catch the TypeError (silently)?


---

Comment by robharron created at 2013-04-08 04:19:20

It seems to me that there is generic code in sage/rings/ideal.py for `__contains__` and this code shouldn't be touched. Basically, what it does is punts to the specific case's implementation of `_contains_`. I think the bug you point out means that for number field ideals, `_contains_` is buggy. So, the type of fix you suggest I think makes sense. Though, rather than `x == 0`, it should probably be `x == self.number_field().zero()`, otherwise anything that is 0 will evaluate as True.

(I do wonder why the code for `__contains__` in sage/rings/ideal.py doesn't just return True for the zero element).


---

Comment by mkosters created at 2013-07-23 16:00:45

Changing status from new to needs_review.


---

Comment by mkosters created at 2013-07-24 08:01:22

Changing status from needs_review to needs_work.


---

Attachment


---

Comment by mkosters created at 2013-07-24 08:11:51

Now with a commit message.


---

Comment by mkosters created at 2013-07-24 08:12:01

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2013-07-24 20:51:06

I just bumped into this bug myself. Wouldn't it make more sense to make coordinates() return an empty tuple instead? I believe this makes sense since 0 is in the zero-dimensional vector space.


---

Comment by saraedum created at 2013-07-24 20:51:23

Changing keywords from "" to "sd51".


---

Comment by saraedum created at 2013-07-24 20:51:23

Changing status from needs_review to needs_info.


---

Comment by mkosters created at 2013-07-24 21:08:39

`@`saraedum, what should the output of K.ideal(0).coordinates(1) be where K is a number field? What kind of error should it produce?


---

Comment by saraedum created at 2013-07-24 22:26:28

Replying to [comment:8 mkosters]:
> `@`saraedum, what should the output of K.ideal(0).coordinates(1) be where K is a number field? What kind of error should it produce?

This should raise a ValueError, I believe.


---

Comment by AlexGhitza created at 2013-07-25 11:32:26

Replying to [comment:6 saraedum]:
> I just bumped into this bug myself. Wouldn't it make more sense to make coordinates() return an empty tuple instead? I believe this makes sense since 0 is in the zero-dimensional vector space.

Yep, in vector spaces:


```
sage: V = QQ^1
sage: W = V.subspace([0])
sage: W.coordinates(0)
[]
sage: W.coordinates(1)
TypeError
```



---

Comment by mkosters created at 2013-07-25 13:10:42

The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?


---

Comment by saraedum created at 2013-07-25 13:35:21

Replying to [comment:11 mkosters]:
> The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?

I agree. If you want to you could put this into a new ticket.


---

Comment by mkosters created at 2013-07-25 13:52:12

Changing status from needs_info to needs_review.


---

Attachment

14366_method2.patch​ changes the coordinate function for the 0 ideal (but does not do relative coordinates), and fixes the containment bug.


---

Comment by mkosters created at 2013-07-25 14:11:01

Replying to [comment:12 saraedum]:
> Replying to [comment:11 mkosters]:
> > The coordinate function of a relative number field returns 'absolute' coordinates to QQ. Shouldn't this actually also be in terms of the relative field (same for I.basis() where I is an ideal)?
> 
> I agree. If you want to you could put this into a new ticket.

Actually, I think it is not a good idea to do. Basically, modules (and ideals, integral closures) are not free any more (because the class number is not 1 in general), so a basis might not exist.


---

Comment by davidloeffler created at 2013-07-25 15:32:22

I can't help thinking that an easier solution would be to use the ` _contains_()` method of the ideal's underlying Z-module (`self.free_module()`).

We could just reimplement ` coordinates(self, x)` as 

```python
def coordinates(self, x):
     K = self.number_field()
     V, from_V, to_V = K.absolute_vector_space()
     return self.free_module().coordinates(to_V(K(x)))
}}} 
and then there is no longer any need to worry about the special case of the zero ideal, it will be dealt with automatically.


---

Comment by mkosters created at 2013-07-25 15:59:38

Replace previous patches.


---

Attachment

Looks fine to me.


---

Comment by davidloeffler created at 2013-07-25 16:30:45

Changing status from needs_review to positive_review.


---

Comment by davidloeffler created at 2013-07-26 09:55:29

Apply 14366_metrod3.patch​

(for patchbot)


---

Comment by robertwb created at 2013-07-26 18:48:28

Apply 14366_metrod3.patch


---

Comment by robertwb created at 2013-07-26 18:49:03

Apply 14366_metrod3.patch

(for patchbot)


---

Comment by jdemeyer created at 2013-08-20 12:55:52

Resolution: fixed
