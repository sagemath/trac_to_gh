# Issue 29698: implicitly fuzz RNG-dependent doctests

archive/issues_029698.json:
```json
{
    "body": "CC:  @kliem mjo @davewittemorris slelievre mantepse\n\ncurrently doctests are run completely deterministically, as they always start from the same random seed.\n\nWe propose to start from a \"random\" random seed, this would make\nthese tests more robust.\n\nSee  this thread: https://groups.google.com/d/msg/sage-devel/c4UbKSdt3Aw/UQAo1iYoAAAJ\nfor more details.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29935\n\n",
    "created_at": "2020-06-22T13:02:46Z",
    "labels": [
        "doctest framework",
        "major",
        "enhancement"
    ],
    "title": "implicitly fuzz RNG-dependent doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29698",
    "user": "dimpase"
}
```
CC:  @kliem mjo @davewittemorris slelievre mantepse

currently doctests are run completely deterministically, as they always start from the same random seed.

We propose to start from a "random" random seed, this would make
these tests more robust.

See  this thread: https://groups.google.com/d/msg/sage-devel/c4UbKSdt3Aw/UQAo1iYoAAAJ
for more details.

Issue created by migration from https://trac.sagemath.org/ticket/29935





---

archive/issue_comments_421642.json:
```json
{
    "body": "Just so that we don't forget that we will have to update\n\nhttps://doc.sagemath.org/html/en/developer/coding_basics.html",
    "created_at": "2020-06-22T13:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421642",
    "user": "@kliem"
}
```

Just so that we don't forget that we will have to update

https://doc.sagemath.org/html/en/developer/coding_basics.html



---

archive/issue_comments_421643.json:
```json
{
    "body": "`geometry/hyperbolic_space/hyperbolic_geodesic.py` makes some claims on how good approximations work, which doesn't seem to work. I had this thing run 7 times now and not one time did all tests pass. E.g. there is one test that gives me absolute errors of `0.7` when running this in the shell, but the test claims it is below `10**-9`.\n\nThere is also #29904. Other than that the `geometry` module appears to ready.\n\nEdit: And there is some place where you need to add `set_random_seed(0)` now or similar.",
    "created_at": "2020-06-22T13:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421643",
    "user": "@kliem"
}
```

`geometry/hyperbolic_space/hyperbolic_geodesic.py` makes some claims on how good approximations work, which doesn't seem to work. I had this thing run 7 times now and not one time did all tests pass. E.g. there is one test that gives me absolute errors of `0.7` when running this in the shell, but the test claims it is below `10**-9`.

There is also #29904. Other than that the `geometry` module appears to ready.

Edit: And there is some place where you need to add `set_random_seed(0)` now or similar.



---

archive/issue_comments_421644.json:
```json
{
    "body": "Replying to [comment:5 gh-kliem]:\n> `geometry/hyperbolic_space/hyperbolic_geodesic.py` makes some claims on how good approximations work, which doesn't seem to work. I had this thing run 7 times now and not one time did all tests pass. E.g. there is one test that gives me absolute errors of `0.7` when running this in the shell, but the test claims it is below `10**-9`.\n\nthis is a great example of fuzzing catching an apparent error, it seems.\n\n> \n> There is also #29904. Other than that the `geometry` module appears to ready.\n> \n> Edit: And there is some place where you need to add `set_random_seed(0)` now or similar.",
    "created_at": "2020-06-22T14:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421644",
    "user": "dimpase"
}
```

Replying to [comment:5 gh-kliem]:
> `geometry/hyperbolic_space/hyperbolic_geodesic.py` makes some claims on how good approximations work, which doesn't seem to work. I had this thing run 7 times now and not one time did all tests pass. E.g. there is one test that gives me absolute errors of `0.7` when running this in the shell, but the test claims it is below `10**-9`.

this is a great example of fuzzing catching an apparent error, it seems.

> 
> There is also #29904. Other than that the `geometry` module appears to ready.
> 
> Edit: And there is some place where you need to add `set_random_seed(0)` now or similar.



---

archive/issue_comments_421645.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-22T14:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421645",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_421646.json:
```json
{
    "body": "Even in the developer guide there is an example, where it is confusing:\n\n\n```\nsage: M = matrix.identity(3) + random_matrix(RR,3,3)/10^3\nsage: M^2 # abs tol 1e-2\n[1 0 0]\n[0 1 0]\n[0 0 1]\n```\n\n\nThere is no mentioning there that only one particular matrix is tested.",
    "created_at": "2020-06-22T14:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421646",
    "user": "@kliem"
}
```

Even in the developer guide there is an example, where it is confusing:


```
sage: M = matrix.identity(3) + random_matrix(RR,3,3)/10^3
sage: M^2 # abs tol 1e-2
[1 0 0]
[0 1 0]
[0 0 1]
```


There is no mentioning there that only one particular matrix is tested.



---

archive/issue_comments_421647.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T14:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421647",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421648.json:
```json
{
    "body": "Replying to [comment:8 gh-kliem]:\n> Even in the developer guide there is an example, where it is confusing:\n> \n> {{{\n> sage: M = matrix.identity(3) + random_matrix(RR,3,3)/10^3\n> sage: M^2 # abs tol 1e-2\n> [1 0 0]\n> [0 1 0]\n> [0 0 1]\n> }}}\n> \n> There is no mentioning there that only one particular matrix is tested.\n\nindeed it assumes (?) that the entries of the random matrix are small in abs value",
    "created_at": "2020-06-22T15:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421648",
    "user": "dimpase"
}
```

Replying to [comment:8 gh-kliem]:
> Even in the developer guide there is an example, where it is confusing:
> 
> {{{
> sage: M = matrix.identity(3) + random_matrix(RR,3,3)/10^3
> sage: M^2 # abs tol 1e-2
> [1 0 0]
> [0 1 0]
> [0 0 1]
> }}}
> 
> There is no mentioning there that only one particular matrix is tested.

indeed it assumes (?) that the entries of the random matrix are small in abs value



---

archive/issue_comments_421649.json:
```json
{
    "body": "Nothing to assume there. `random_matrix(RR,3,3)` has entries between `-1` and `1`. After dividing we are good.",
    "created_at": "2020-06-22T15:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421649",
    "user": "@kliem"
}
```

Nothing to assume there. `random_matrix(RR,3,3)` has entries between `-1` and `1`. After dividing we are good.



---

archive/issue_comments_421650.json:
```json
{
    "body": "How about making the random seed an option to `sage-runtests`. Then people can fuzz the doctests if they want.",
    "created_at": "2020-06-22T16:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421650",
    "user": "mkoeppe"
}
```

How about making the random seed an option to `sage-runtests`. Then people can fuzz the doctests if they want.



---

archive/issue_comments_421651.json:
```json
{
    "body": "Will people do that? Especially enough to find incorrect claims. If you look into #29936 we have been claiming a preciseness that is far from true. Even if you consider the relative error instead of the absolute error. fuzzed doctests would have easily detected that. Even worse. Maybe the situation was better at some point and we never caught on about the regression.",
    "created_at": "2020-06-22T16:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421651",
    "user": "@kliem"
}
```

Will people do that? Especially enough to find incorrect claims. If you look into #29936 we have been claiming a preciseness that is far from true. Even if you consider the relative error instead of the absolute error. fuzzed doctests would have easily detected that. Even worse. Maybe the situation was better at some point and we never caught on about the regression.



---

archive/issue_comments_421652.json:
```json
{
    "body": "it is not a \"real\" (time-consuming) fuzzing, it is making the main random seed nondeterministic in tests. making it optional is akin to making tests optional.\n\nwe already found a couple of examples which show usefulness of this change in detecting bugs in Sage.",
    "created_at": "2020-06-22T16:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421652",
    "user": "dimpase"
}
```

it is not a "real" (time-consuming) fuzzing, it is making the main random seed nondeterministic in tests. making it optional is akin to making tests optional.

we already found a couple of examples which show usefulness of this change in detecting bugs in Sage.



---

archive/issue_comments_421653.json:
```json
{
    "body": "The option that I propose to add needs to be added in any case, so that when a failure is revealed by a random random seeds, we can reproduce the failure with that seed.",
    "created_at": "2020-06-22T16:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421653",
    "user": "mkoeppe"
}
```

The option that I propose to add needs to be added in any case, so that when a failure is revealed by a random random seeds, we can reproduce the failure with that seed.



---

archive/issue_comments_421654.json:
```json
{
    "body": "it is a good point - and the non-det. seed needs to  be logged - if this is not yet in the branch it should get there.",
    "created_at": "2020-06-22T16:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421654",
    "user": "dimpase"
}
```

it is a good point - and the non-det. seed needs to  be logged - if this is not yet in the branch it should get there.



---

archive/issue_comments_421655.json:
```json
{
    "body": "So I would suggest to use this ticket to introduce the option, not change the default.",
    "created_at": "2020-06-22T16:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421655",
    "user": "mkoeppe"
}
```

So I would suggest to use this ticket to introduce the option, not change the default.



---

archive/issue_comments_421656.json:
```json
{
    "body": "no, I don't agree, it makes no sense to test less if one can test more, and also not having it default would not force people to make their tests robust.",
    "created_at": "2020-06-22T16:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421656",
    "user": "dimpase"
}
```

no, I don't agree, it makes no sense to test less if one can test more, and also not having it default would not force people to make their tests robust.



---

archive/issue_comments_421657.json:
```json
{
    "body": "By the way I don't think most doctests have the ambition to demonstrate correctness of mathematical claims. In my opinion, if a doctest intends to do that, it should run an explicit loop of several tests. Still deterministically.",
    "created_at": "2020-06-22T16:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421657",
    "user": "mkoeppe"
}
```

By the way I don't think most doctests have the ambition to demonstrate correctness of mathematical claims. In my opinion, if a doctest intends to do that, it should run an explicit loop of several tests. Still deterministically.



---

archive/issue_comments_421658.json:
```json
{
    "body": "Why would creating the option and changing the default have to be done on the same ticket? I think it's best practices to separate the two steps on two tickets.",
    "created_at": "2020-06-22T16:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421658",
    "user": "mkoeppe"
}
```

Why would creating the option and changing the default have to be done on the same ticket? I think it's best practices to separate the two steps on two tickets.



---

archive/issue_comments_421659.json:
```json
{
    "body": "Feel free to do with the branch whatever you think is reasonable.",
    "created_at": "2020-06-22T16:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421659",
    "user": "@kliem"
}
```

Feel free to do with the branch whatever you think is reasonable.



---

archive/issue_comments_421660.json:
```json
{
    "body": "What I think would be great if running we could run each file at some \"random\" seed, e.g.\n\n\n```\nsage -t src/sage/all.py \nRunning doctests with ID 2020-06-22-18-56-54-668a26f3.\nGit branch: public/29935\nUsing --optional=4ti2,bliss,build,dochtml,e_antic,flask,flask_autoindex,flask_babel,flask_oldsessions,flask_openid,flask_silk,latte_int,lidia,lrslib,memlimit,normaliz,pynormaliz,python_openid,sage,speaklater,twisted\nDoctesting 1 file.\nsage -t --warn-long 91.5 --seed 123456 src/sage/all.py\n    [16 tests, 0.76 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.8 seconds\n    cpu time: 0.8 seconds\n    cumulative wall time: 0.8 seconds\n```\n\n\nYou can reproduce this test with\n\n```\nsage -t --warn-long 91.5 --seed 123456 src/sage/all.py\n```\n\n\nIs a bit annoying, as seeds can be long though. Then whenever a bot or someone discovers a failure, you can reproduce it. At least if it really was caused by the random seed.",
    "created_at": "2020-06-22T17:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421660",
    "user": "@kliem"
}
```

What I think would be great if running we could run each file at some "random" seed, e.g.


```
sage -t src/sage/all.py 
Running doctests with ID 2020-06-22-18-56-54-668a26f3.
Git branch: public/29935
Using --optional=4ti2,bliss,build,dochtml,e_antic,flask,flask_autoindex,flask_babel,flask_oldsessions,flask_openid,flask_silk,latte_int,lidia,lrslib,memlimit,normaliz,pynormaliz,python_openid,sage,speaklater,twisted
Doctesting 1 file.
sage -t --warn-long 91.5 --seed 123456 src/sage/all.py
    [16 tests, 0.76 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 0.8 seconds
    cumulative wall time: 0.8 seconds
```


You can reproduce this test with

```
sage -t --warn-long 91.5 --seed 123456 src/sage/all.py
```


Is a bit annoying, as seeds can be long though. Then whenever a bot or someone discovers a failure, you can reproduce it. At least if it really was caused by the random seed.



---

archive/issue_comments_421661.json:
```json
{
    "body": "Just to weigh in:\n\n1. The default should be to use a randomly-chosen seed.\n2. Failures should be reproducible:\n   a. It should be possible to pass a seed to the test runner with e.g. `--seed`.\n   b. Any test failures should log/echo the current seed so that the failing test can be reproduced easily using the option in (2.a.).\n\nThe sooner we can push this through the better. Tests that don't work due to bugs can even be deleted and replaced with trac tickets saying \"this never worked\" IMO.",
    "created_at": "2020-06-22T17:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421661",
    "user": "mjo"
}
```

Just to weigh in:

1. The default should be to use a randomly-chosen seed.
2. Failures should be reproducible:
   a. It should be possible to pass a seed to the test runner with e.g. `--seed`.
   b. Any test failures should log/echo the current seed so that the failing test can be reproduced easily using the option in (2.a.).

The sooner we can push this through the better. Tests that don't work due to bugs can even be deleted and replaced with trac tickets saying "this never worked" IMO.



---

archive/issue_comments_421662.json:
```json
{
    "body": "With #29904 (already pulled into this branch), #29936 (not yet pulled) and \t`b2954ceea638b4510e99d90cea3f99fa9a49338` (commit from above) geometry should be ready for this.\n\nEdit: The updated branch of #29904 (not yet pulled) doesn't have `set_random_seed` anymore. But there is plenty of `set_random_seed` for cones doctests? Should I remove those as well or do we do this somewhere else?",
    "created_at": "2020-06-22T18:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421662",
    "user": "@kliem"
}
```

With #29904 (already pulled into this branch), #29936 (not yet pulled) and 	`b2954ceea638b4510e99d90cea3f99fa9a49338` (commit from above) geometry should be ready for this.

Edit: The updated branch of #29904 (not yet pulled) doesn't have `set_random_seed` anymore. But there is plenty of `set_random_seed` for cones doctests? Should I remove those as well or do we do this somewhere else?



---

archive/issue_comments_421663.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T19:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421663",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421664.json:
```json
{
    "body": "Replying to [comment:26 gh-kliem]:\n> there is plenty of `set_random_seed` for cones doctests? Should I remove those as well or do we do this somewhere else?\n\nNot on the same ticket.",
    "created_at": "2020-06-22T19:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421664",
    "user": "mkoeppe"
}
```

Replying to [comment:26 gh-kliem]:
> there is plenty of `set_random_seed` for cones doctests? Should I remove those as well or do we do this somewhere else?

Not on the same ticket.



---

archive/issue_comments_421665.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T19:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421665",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T19:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421666",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421667.json:
```json
{
    "body": "Please tell me, if I should open seperate tickets for those or something else. I just felt like starting with those. I'm done for today.",
    "created_at": "2020-06-22T19:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421667",
    "user": "@kliem"
}
```

Please tell me, if I should open seperate tickets for those or something else. I just felt like starting with those. I'm done for today.



---

archive/issue_comments_421668.json:
```json
{
    "body": "Replying to [comment:25 mjo]:\n> 1. The default should be to use a randomly-chosen seed.\n> 2. Failures should be reproducible:\n>  a. It should be possible to pass a seed to the test runner with e.g. `--seed`.\n>  b. Any test failures should log/echo the current seed so that the failing test can be reproduced easily using the option in (2.a.).\n\n+1.\n\nAlso note that Sage still uses a verbatim copy of the Python-2 version of the `Random` module during doctesting, which was necessary in order to obtain consistent results between Python 2 and 3. This is why the bug in #29550 went unnoticed, for example. Now that support for Python 2 has been removed, we should switch to the Python 3 version of `Random`. This will require updating lots of doctests, but I assume this ticket here will simplify this if it makes doctests less dependent on the seed/RNG.",
    "created_at": "2020-06-23T19:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421668",
    "user": "@mwageringel"
}
```

Replying to [comment:25 mjo]:
> 1. The default should be to use a randomly-chosen seed.
> 2. Failures should be reproducible:
>  a. It should be possible to pass a seed to the test runner with e.g. `--seed`.
>  b. Any test failures should log/echo the current seed so that the failing test can be reproduced easily using the option in (2.a.).

+1.

Also note that Sage still uses a verbatim copy of the Python-2 version of the `Random` module during doctesting, which was necessary in order to obtain consistent results between Python 2 and 3. This is why the bug in #29550 went unnoticed, for example. Now that support for Python 2 has been removed, we should switch to the Python 3 version of `Random`. This will require updating lots of doctests, but I assume this ticket here will simplify this if it makes doctests less dependent on the seed/RNG.



---

archive/issue_comments_421669.json:
```json
{
    "body": "Apparently `LinearCodeSyndromeDecoder.decode_to_code` is broken.\n\nSee #29945.",
    "created_at": "2020-06-23T19:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421669",
    "user": "@kliem"
}
```

Apparently `LinearCodeSyndromeDecoder.decode_to_code` is broken.

See #29945.



---

archive/issue_comments_421670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-23T19:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421670",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-23T21:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421671",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421672.json:
```json
{
    "body": "I specified `random_seed` to distinguish from `--randorder=SEED`. If after `--randorder=SEED` the next option is `--seed=SEED` that sounds a bit weird to me. Although `random_seed` is not much better.",
    "created_at": "2020-06-23T21:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421672",
    "user": "@kliem"
}
```

I specified `random_seed` to distinguish from `--randorder=SEED`. If after `--randorder=SEED` the next option is `--seed=SEED` that sounds a bit weird to me. Although `random_seed` is not much better.



---

archive/issue_comments_421673.json:
```json
{
    "body": "Standard  bracked lyndon words are set up incorrectly. I don't know if that should be consider a bug:\n\n\n```\nsage: SBLW33 = StandardBracketedLyndonWords(3,3)\nsage: TestSuite(SBLW33).run()\nFailure in _test_an_element:\nTraceback (most recent call last):\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/misc/sage_unittest.py\", line 296, in run\n    test_method(tester=tester)\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/categories/sets_cat.py\", line 1093, in _test_an_element\n    tester.assertTrue(an_element in self, \"self.an_element() is not in self\")\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py\", line 692, in assertTrue\n    raise self.failureException(msg)\nAssertionError: self.an_element() is not in self\n------------------------------------------------------------\nFailure in _test_enumerated_set_contains:\nTraceback (most recent call last):\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/misc/sage_unittest.py\", line 296, in run\n    test_method(tester=tester)\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/categories/enumerated_sets.py\", line 945, in _test_enumerated_set_contains\n    tester.assertIn(w, self)\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py\", line 1106, in assertIn\n    self.fail(self._formatMessage(msg, standardMsg))\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py\", line 680, in fail\n    raise self.failureException(msg)\nAssertionError: [1, [1, 2]] not found in Standard bracketed Lyndon words from an alphabet of size 3 of length 3\n------------------------------------------------------------\nFailure in _test_some_elements:\nTraceback (most recent call last):\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/misc/sage_unittest.py\", line 296, in run\n    test_method(tester=tester)\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/categories/sets_cat.py\", line 1385, in _test_some_elements\n    \"the object %s in self.some_elements() is not in self\")%(x,))\n  File \"/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py\", line 692, in assertTrue\n    raise self.failureException(msg)\nAssertionError: the object [1, [1, 2]] in self.some_elements() is not in self\n------------------------------------------------------------\nThe following tests failed: _test_an_element, _test_enumerated_set_contains, _test_some_elements\n```\n",
    "created_at": "2020-06-24T08:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421673",
    "user": "@kliem"
}
```

Standard  bracked lyndon words are set up incorrectly. I don't know if that should be consider a bug:


```
sage: SBLW33 = StandardBracketedLyndonWords(3,3)
sage: TestSuite(SBLW33).run()
Failure in _test_an_element:
Traceback (most recent call last):
  File "/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/misc/sage_unittest.py", line 296, in run
    test_method(tester=tester)
  File "/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/categories/sets_cat.py", line 1093, in _test_an_element
    tester.assertTrue(an_element in self, "self.an_element() is not in self")
  File "/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py", line 692, in assertTrue
    raise self.failureException(msg)
AssertionError: self.an_element() is not in self
------------------------------------------------------------
Failure in _test_enumerated_set_contains:
Traceback (most recent call last):
  File "/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/misc/sage_unittest.py", line 296, in run
    test_method(tester=tester)
  File "/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/categories/enumerated_sets.py", line 945, in _test_enumerated_set_contains
    tester.assertIn(w, self)
  File "/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py", line 1106, in assertIn
    self.fail(self._formatMessage(msg, standardMsg))
  File "/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py", line 680, in fail
    raise self.failureException(msg)
AssertionError: [1, [1, 2]] not found in Standard bracketed Lyndon words from an alphabet of size 3 of length 3
------------------------------------------------------------
Failure in _test_some_elements:
Traceback (most recent call last):
  File "/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/misc/sage_unittest.py", line 296, in run
    test_method(tester=tester)
  File "/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/categories/sets_cat.py", line 1385, in _test_some_elements
    "the object %s in self.some_elements() is not in self")%(x,))
  File "/home/jonathan/Applications/sage/local/lib/python3.7/unittest/case.py", line 692, in assertTrue
    raise self.failureException(msg)
AssertionError: the object [1, [1, 2]] in self.some_elements() is not in self
------------------------------------------------------------
The following tests failed: _test_an_element, _test_enumerated_set_contains, _test_some_elements
```




---

archive/issue_comments_421674.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T09:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421674",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T09:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421675",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T12:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421676",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421677.json:
```json
{
    "body": "In `src/sage/plot/multigraphics.py` is a doctest that fails with the precicion:\n\n\n```\n1294             sage: g1 = plot(sin(x), (x, -pi, pi))\n1295             sage: g2 = circle((0,1), 1.)\n1296             sage: G = graphics_array([g1, g2])\n1297             sage: G.position(0)  # tol 1.0e-13\n1298             (0.023437500000000003,\n1299              0.03415488992713045,\n1300              0.4627803348994754,\n1301              0.9345951100728696)\n1302             sage: G.position(1)  # tol 1.0e-13\n1303             (0.5136230468749999,\n1304              0.19293222169724827,\n1305              0.46278033489947534,\n1306              0.617040446532634)\n```\n\nwhen running on `set_random_seed(151058820726654196682836430928254760259)`. The precision is somewhere around `1e-3` then. Is this a bug?",
    "created_at": "2020-06-24T13:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421677",
    "user": "@kliem"
}
```

In `src/sage/plot/multigraphics.py` is a doctest that fails with the precicion:


```
1294             sage: g1 = plot(sin(x), (x, -pi, pi))
1295             sage: g2 = circle((0,1), 1.)
1296             sage: G = graphics_array([g1, g2])
1297             sage: G.position(0)  # tol 1.0e-13
1298             (0.023437500000000003,
1299              0.03415488992713045,
1300              0.4627803348994754,
1301              0.9345951100728696)
1302             sage: G.position(1)  # tol 1.0e-13
1303             (0.5136230468749999,
1304              0.19293222169724827,
1305              0.46278033489947534,
1306              0.617040446532634)
```

when running on `set_random_seed(151058820726654196682836430928254760259)`. The precision is somewhere around `1e-3` then. Is this a bug?



---

archive/issue_comments_421678.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T15:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421678",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421679.json:
```json
{
    "body": "It may be too late for this, but I would suggest a staged approach:\n\n- ticket 1: implement optional random seed but don't make it the default\n- tickets 2-n: fix doctests when using random seeds in various parts of the Sage library\n- ticket n+1: make random seed standard, if that is what people think should be done\n\nDoing everything all at once is likely to lead to a patch bomb, which will lead to merge conflicts and in general be hard to deal with.",
    "created_at": "2020-06-24T16:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421679",
    "user": "jhpalmieri"
}
```

It may be too late for this, but I would suggest a staged approach:

- ticket 1: implement optional random seed but don't make it the default
- tickets 2-n: fix doctests when using random seeds in various parts of the Sage library
- ticket n+1: make random seed standard, if that is what people think should be done

Doing everything all at once is likely to lead to a patch bomb, which will lead to merge conflicts and in general be hard to deal with.



---

archive/issue_comments_421680.json:
```json
{
    "body": "There is a reason that I have the fixes grouped by parts of sage. So that isn't spoiled yet.\n\nThat completely makes sense. We still need the last ticket to have the bots test everything.",
    "created_at": "2020-06-24T18:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421680",
    "user": "@kliem"
}
```

There is a reason that I have the fixes grouped by parts of sage. So that isn't spoiled yet.

That completely makes sense. We still need the last ticket to have the bots test everything.



---

archive/issue_comments_421681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T19:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421681",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421682.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T19:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421682",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421683.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T19:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421683",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421684.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-24T20:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421684",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_421685.json:
```json
{
    "body": "We had a little discussion on #29971, how we treat doctests as\n\n```\nsage: C = FiniteEnumeratedSets().example()\nsage: C.random_element()\n1\n```\n\n\nIf we tag this as `# random` and maybe test instead containment in `C`, the doctest we will essentially remove the doctest and add another. Is this what we want?\n\nMatthias Koeppe suggested inventing a new tag maybe `# random-seed=0`. If we implicitly fuzz all doctests this would only be tested if we run the test block twice?!\n\nI think we should agree on a something here. Depending on the agreement it needs to be taken care of with #29962 already.\n\nIMO tests as `C.random_element()` should run at least once with fuzzing (with checking that the object is consistent). We can run it twice to obtain our old test, but I would appreciate some help with that.",
    "created_at": "2020-06-29T08:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421685",
    "user": "@kliem"
}
```

We had a little discussion on #29971, how we treat doctests as

```
sage: C = FiniteEnumeratedSets().example()
sage: C.random_element()
1
```


If we tag this as `# random` and maybe test instead containment in `C`, the doctest we will essentially remove the doctest and add another. Is this what we want?

Matthias Koeppe suggested inventing a new tag maybe `# random-seed=0`. If we implicitly fuzz all doctests this would only be tested if we run the test block twice?!

I think we should agree on a something here. Depending on the agreement it needs to be taken care of with #29962 already.

IMO tests as `C.random_element()` should run at least once with fuzzing (with checking that the object is consistent). We can run it twice to obtain our old test, but I would appreciate some help with that.



---

archive/issue_comments_421686.json:
```json
{
    "body": "This will do the job, and doesn't depend on the literal output of the random function:\n\n\n```\nsage: C = FiniteEnumeratedSets().example()\nsage: C.random_element() in C\nTrue\n```\n",
    "created_at": "2020-06-29T11:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421686",
    "user": "mjo"
}
```

This will do the job, and doesn't depend on the literal output of the random function:


```
sage: C = FiniteEnumeratedSets().example()
sage: C.random_element() in C
True
```




---

archive/issue_comments_421687.json:
```json
{
    "body": "In principal I agree.\n\nI prefer\n\n```\nsage: C = FiniteEnumeratedSets().example()\nsage: n = C.random_element(); n  # random\n1\nsage: n in C\nTrue\n```\n\nas this makes it a bit easier for the user to see, what will/might happen. But that is only minor.\n\nHowever, I just noticed, that there are problems with that approach. The representation of those random things will never be checked. In principal (almost) all random events should be reproducible with some random seed (doesn't work for e.g. hashing). By tagging something as `# random`, we might document nonsense or outdated information and no one will catch on.\n\nE.g. in #29981 I fixed a documentation mistake along the way: Solve a linear equation system with `A\\v` with `A` a random matrix. `A` should be non-singular of course, which was never thought of because the doctest is only tested for one matrix, which happens to be non-singular. In #29981, `A` is defined as `A = random_matrix(QQ, 3, algorithm='unimodular')`. However, I forgot to update the representation of `A` to some unimodular matrix and the doctests never caught on.\n\nNow if you tag something as `# random-seed=0` and we find some way to test this (both seed 0 and different), it would mean that the printed representations stay up to date and consistent and it is also tested, if those thing work for \"random\" input.\n\nI found many examples where functions where tested assuming random seed 0. One could make use of the double testing framework:\n\n```\ndef foo(y):\n   r\"\"\"\n   EXAMPLES::\n\n      sage: M = random(); M  # random-seed=0\n      <some random input>\n      sage: N = foo(M); N  # random-seed=0\n      <some random output>\n      sage: check_for_consistency(M, N)\n   \"\"\"\n   return _foo(y)\n```\n\nIt is still checked, that `foo` works exactly for some example that hopefully was verified by someone. But it is also checked, that the method in principal works on \"random\" input and that the output appears to be correct.",
    "created_at": "2020-06-29T12:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421687",
    "user": "@kliem"
}
```

In principal I agree.

I prefer

```
sage: C = FiniteEnumeratedSets().example()
sage: n = C.random_element(); n  # random
1
sage: n in C
True
```

as this makes it a bit easier for the user to see, what will/might happen. But that is only minor.

However, I just noticed, that there are problems with that approach. The representation of those random things will never be checked. In principal (almost) all random events should be reproducible with some random seed (doesn't work for e.g. hashing). By tagging something as `# random`, we might document nonsense or outdated information and no one will catch on.

E.g. in #29981 I fixed a documentation mistake along the way: Solve a linear equation system with `A\v` with `A` a random matrix. `A` should be non-singular of course, which was never thought of because the doctest is only tested for one matrix, which happens to be non-singular. In #29981, `A` is defined as `A = random_matrix(QQ, 3, algorithm='unimodular')`. However, I forgot to update the representation of `A` to some unimodular matrix and the doctests never caught on.

Now if you tag something as `# random-seed=0` and we find some way to test this (both seed 0 and different), it would mean that the printed representations stay up to date and consistent and it is also tested, if those thing work for "random" input.

I found many examples where functions where tested assuming random seed 0. One could make use of the double testing framework:

```
def foo(y):
   r"""
   EXAMPLES::

      sage: M = random(); M  # random-seed=0
      <some random input>
      sage: N = foo(M); N  # random-seed=0
      <some random output>
      sage: check_for_consistency(M, N)
   """
   return _foo(y)
```

It is still checked, that `foo` works exactly for some example that hopefully was verified by someone. But it is also checked, that the method in principal works on "random" input and that the output appears to be correct.



---

archive/issue_comments_421688.json:
```json
{
    "body": "If we want to check the printed/string representation of something, can't we just... check it? In other words, instead of\n\n\n```\nsage: C = FiniteEnumeratedSets().example()\nsage: C.random_element()\n1\n```\n\n\nwe could do\n\n\n```\nsage: C = FiniteEnumeratedSets().example()\nsage: C.random_element() in C\nTrue\nsage: C[0]\n1\n```\n\n\nThis has the (big, in my opinion) added benefit of actually being a runnable example. If a user runs\n\n\n```\nsage: C = FiniteEnumeratedSets().example()\nsage: n = C.random_element(); n  # random\n```\n\n\nthen he's not going to see what the documentation says he should see, because `# random` does nothing on the command-line.",
    "created_at": "2020-06-29T17:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421688",
    "user": "mjo"
}
```

If we want to check the printed/string representation of something, can't we just... check it? In other words, instead of


```
sage: C = FiniteEnumeratedSets().example()
sage: C.random_element()
1
```


we could do


```
sage: C = FiniteEnumeratedSets().example()
sage: C.random_element() in C
True
sage: C[0]
1
```


This has the (big, in my opinion) added benefit of actually being a runnable example. If a user runs


```
sage: C = FiniteEnumeratedSets().example()
sage: n = C.random_element(); n  # random
```


then he's not going to see what the documentation says he should see, because `# random` does nothing on the command-line.



---

archive/issue_comments_421689.json:
```json
{
    "body": "IMO, it is not necessary to test the printing of random elements, as the repr of those elements is already tested elsewhere. We do not make any promises about the precise elements that are returned with a seed of 0, so we should not bake that into the doctests. As we cannot test the randomness, we can only test that `random_element` returns an element of the parent. The following check could be used for that:\n\n```\nsage: C.random_element().parent() is C\n```\n\nUnlike `__contains__`, this does not implicitly coerce the element into `C`.",
    "created_at": "2020-06-29T17:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421689",
    "user": "@mwageringel"
}
```

IMO, it is not necessary to test the printing of random elements, as the repr of those elements is already tested elsewhere. We do not make any promises about the precise elements that are returned with a seed of 0, so we should not bake that into the doctests. As we cannot test the randomness, we can only test that `random_element` returns an element of the parent. The following check could be used for that:

```
sage: C.random_element().parent() is C
```

Unlike `__contains__`, this does not implicitly coerce the element into `C`.



---

archive/issue_comments_421690.json:
```json
{
    "body": "Replying to [comment:62 gh-mwageringel]:\n> IMO, it is not necessary to test the printing of random elements, as the repr of those elements is already tested elsewhere. We do not make any promises about the precise elements that are returned with a seed of 0, so we should not bake that into the doctests. As we cannot test the randomness, we can only test that `random_element` returns an element of the parent. The following check could be used for that:\n> {{{\n> sage: C.random_element().parent() is C\n> }}}\n> Unlike `__contains__`, this does not implicitly coerce the element into `C`.\n\nSounds good to me.",
    "created_at": "2020-06-29T18:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421690",
    "user": "mjo"
}
```

Replying to [comment:62 gh-mwageringel]:
> IMO, it is not necessary to test the printing of random elements, as the repr of those elements is already tested elsewhere. We do not make any promises about the precise elements that are returned with a seed of 0, so we should not bake that into the doctests. As we cannot test the randomness, we can only test that `random_element` returns an element of the parent. The following check could be used for that:
> {{{
> sage: C.random_element().parent() is C
> }}}
> Unlike `__contains__`, this does not implicitly coerce the element into `C`.

Sounds good to me.



---

archive/issue_comments_421691.json:
```json
{
    "body": "Replying to [comment:60 gh-kliem]:\n> {{{\nSounds good to me. As for the documentation of `random_element`, I don't think a user cares about the precise value of `set_random_seed(0); C.random_element()`.\n\nTwo more cases that I would like to discuss.\n\n- Basically from comment:60. How do we deal with something like this:\n\n```\ndef foo(y):\n   r\"\"\"\n   EXAMPLES::\n\n      sage: M = random(); M\n      <some random input>\n      sage: foo(M)\n      <some random output>\n   \"\"\"\n```\n\n  It appears to me that there are many examples, where someone did not write down a concrete element to doctest. I would propose having two doctests, if possible:\n- Explicitly obtain the old test.\n- Have a \"random\" test with a consistency check. (Even without a consistency check, it's probably worth checking that the function terminates without an error usually.)\n- The other one is a concrete example from #29981 (linear algrebra tutorial). The original test is\n\n```\n    sage: A=random_matrix(QQ,3)\n    sage: v=vector([2,3,1])\n    sage: A,v\n    (\n    [ 0 -1  1]\n    [-1 -1 -1]\n    [ 0  2  2], (2, 3, 1)\n    )\n    sage: x=A\\v; x\n    (-7/2, -3/4, 5/4)\n    sage: A*x\n    (2, 3, 1)\n```\n\n  As mentioned already, this does not work. I see basically two ways of fixing this. One is to explicitly write down `A`. The other one is similar to what I did. Use a correct random approach (e.g. random unimodular) and check that indeed `A*x == v`. Optionally one can print `x` and `A` and tag this as random. To be honest, I don't see how a user would profit from the printing. What a 3 by 3 matrix looks like should be clear by then.",
    "created_at": "2020-06-29T19:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421691",
    "user": "@kliem"
}
```

Replying to [comment:60 gh-kliem]:
> {{{
Sounds good to me. As for the documentation of `random_element`, I don't think a user cares about the precise value of `set_random_seed(0); C.random_element()`.

Two more cases that I would like to discuss.

- Basically from comment:60. How do we deal with something like this:

```
def foo(y):
   r"""
   EXAMPLES::

      sage: M = random(); M
      <some random input>
      sage: foo(M)
      <some random output>
   """
```

  It appears to me that there are many examples, where someone did not write down a concrete element to doctest. I would propose having two doctests, if possible:
- Explicitly obtain the old test.
- Have a "random" test with a consistency check. (Even without a consistency check, it's probably worth checking that the function terminates without an error usually.)
- The other one is a concrete example from #29981 (linear algrebra tutorial). The original test is

```
    sage: A=random_matrix(QQ,3)
    sage: v=vector([2,3,1])
    sage: A,v
    (
    [ 0 -1  1]
    [-1 -1 -1]
    [ 0  2  2], (2, 3, 1)
    )
    sage: x=A\v; x
    (-7/2, -3/4, 5/4)
    sage: A*x
    (2, 3, 1)
```

  As mentioned already, this does not work. I see basically two ways of fixing this. One is to explicitly write down `A`. The other one is similar to what I did. Use a correct random approach (e.g. random unimodular) and check that indeed `A*x == v`. Optionally one can print `x` and `A` and tag this as random. To be honest, I don't see how a user would profit from the printing. What a 3 by 3 matrix looks like should be clear by then.



---

archive/issue_comments_421692.json:
```json
{
    "body": "Replying to [comment:64 gh-kliem]:\n> \n> - Basically from comment:60. How do we deal with something like this:\n> {{{\n> def foo(y):\n>    r\"\"\"\n>    EXAMPLES::\n> \n>       sage: M = random(); M\n>       <some random input>\n>       sage: foo(M)\n>       <some random output>\n>    \"\"\"\n> }}}\n\nIf the point isn't to demonstrate the `random()` function, then the \"random\" element can just be replaced with whatever it winds up with now (i.e. the fixed element you get with a seed of zero).\nThe `TESTS` block can contain some truly random test of a property that the output from `foo()` should satisfy, like\n\n\n```\nsage: foo(random()) in RR\nTrue\n```\n\n\n\n> - The other one is a concrete example from #29981 (linear algrebra tutorial). The original test is\n> {{{\n>     sage: A=random_matrix(QQ,3)\n>     sage: v=vector([2,3,1])\n>     sage: A,v\n>     (\n>     [ 0 -1  1]\n>     [-1 -1 -1]\n>     [ 0  2  2], (2, 3, 1)\n>     )\n>     sage: x=A\\v; x\n>     (-7/2, -3/4, 5/4)\n>     sage: A*x\n>     (2, 3, 1)\n> }}}\n\nHow about...\n\n\n```\nsage: A = random_matrix(QQ,3)\nsage: while not A.is_invertible():\n....:     A = random_matrix(QQ,3)\n....:     \nsage: v=vector([2,3,1])\nsage: x=A\\v\nsage: A*x - v == 0\nTrue\n```\n",
    "created_at": "2020-06-29T19:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421692",
    "user": "mjo"
}
```

Replying to [comment:64 gh-kliem]:
> 
> - Basically from comment:60. How do we deal with something like this:
> {{{
> def foo(y):
>    r"""
>    EXAMPLES::
> 
>       sage: M = random(); M
>       <some random input>
>       sage: foo(M)
>       <some random output>
>    """
> }}}

If the point isn't to demonstrate the `random()` function, then the "random" element can just be replaced with whatever it winds up with now (i.e. the fixed element you get with a seed of zero).
The `TESTS` block can contain some truly random test of a property that the output from `foo()` should satisfy, like


```
sage: foo(random()) in RR
True
```



> - The other one is a concrete example from #29981 (linear algrebra tutorial). The original test is
> {{{
>     sage: A=random_matrix(QQ,3)
>     sage: v=vector([2,3,1])
>     sage: A,v
>     (
>     [ 0 -1  1]
>     [-1 -1 -1]
>     [ 0  2  2], (2, 3, 1)
>     )
>     sage: x=A\v; x
>     (-7/2, -3/4, 5/4)
>     sage: A*x
>     (2, 3, 1)
> }}}

How about...


```
sage: A = random_matrix(QQ,3)
sage: while not A.is_invertible():
....:     A = random_matrix(QQ,3)
....:     
sage: v=vector([2,3,1])
sage: x=A\v
sage: A*x - v == 0
True
```




---

archive/issue_comments_421693.json:
```json
{
    "body": "Replying to [comment:65 mjo]:\n> Replying to [comment:64 gh-kliem]:\n> > \n> > - Basically from comment:60. How do we deal with something like this:\n> > {{{\n> > def foo(y):\n> >    r\"\"\"\n> >    EXAMPLES::\n> > \n> >       sage: M = random(); M\n> >       <some random input>\n> >       sage: foo(M)\n> >       <some random output>\n> >    \"\"\"\n> > }}}\n> \n> If the point isn't to demonstrate the `random()` function, then the \"random\" element can just be replaced with whatever it winds up with now (i.e. the fixed element you get with a seed of zero).\n> The `TESTS` block can contain some truly random test of a property that the output from `foo()` should satisfy, like\n> \n> {{{\n> sage: foo(random()) in RR\n> True\n> }}}\n> \n> \n> > - The other one is a concrete example from #29981 (linear algrebra tutorial). The original test is\n> > {{{\n> >     sage: A=random_matrix(QQ,3)\n> >     sage: v=vector([2,3,1])\n> >     sage: A,v\n> >     (\n> >     [ 0 -1  1]\n> >     [-1 -1 -1]\n> >     [ 0  2  2], (2, 3, 1)\n> >     )\n> >     sage: x=A\\v; x\n> >     (-7/2, -3/4, 5/4)\n> >     sage: A*x\n> >     (2, 3, 1)\n> > }}}\n> \n> How about...\n> \n> {{{\n> sage: A = random_matrix(QQ,3)\n> sage: while not A.is_invertible():\n> ....:     A = random_matrix(QQ,3)\n> ....:     \n> sage: v=vector([2,3,1])\n> sage: x=A\\v\n> sage: A*x - v == 0\n> True\n> }}}\n\nSounds reasonable to me. I will adhere to those suggestions.",
    "created_at": "2020-07-02T11:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421693",
    "user": "@kliem"
}
```

Replying to [comment:65 mjo]:
> Replying to [comment:64 gh-kliem]:
> > 
> > - Basically from comment:60. How do we deal with something like this:
> > {{{
> > def foo(y):
> >    r"""
> >    EXAMPLES::
> > 
> >       sage: M = random(); M
> >       <some random input>
> >       sage: foo(M)
> >       <some random output>
> >    """
> > }}}
> 
> If the point isn't to demonstrate the `random()` function, then the "random" element can just be replaced with whatever it winds up with now (i.e. the fixed element you get with a seed of zero).
> The `TESTS` block can contain some truly random test of a property that the output from `foo()` should satisfy, like
> 
> {{{
> sage: foo(random()) in RR
> True
> }}}
> 
> 
> > - The other one is a concrete example from #29981 (linear algrebra tutorial). The original test is
> > {{{
> >     sage: A=random_matrix(QQ,3)
> >     sage: v=vector([2,3,1])
> >     sage: A,v
> >     (
> >     [ 0 -1  1]
> >     [-1 -1 -1]
> >     [ 0  2  2], (2, 3, 1)
> >     )
> >     sage: x=A\v; x
> >     (-7/2, -3/4, 5/4)
> >     sage: A*x
> >     (2, 3, 1)
> > }}}
> 
> How about...
> 
> {{{
> sage: A = random_matrix(QQ,3)
> sage: while not A.is_invertible():
> ....:     A = random_matrix(QQ,3)
> ....:     
> sage: v=vector([2,3,1])
> sage: x=A\v
> sage: A*x - v == 0
> True
> }}}

Sounds reasonable to me. I will adhere to those suggestions.



---

archive/issue_comments_421694.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-07-11T07:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421694",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_421695.json:
```json
{
    "body": "Maybe it makes sense to restrict the size of the random seed, so that one can still read the output of doctesting.",
    "created_at": "2020-07-11T07:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421695",
    "user": "@kliem"
}
```

Maybe it makes sense to restrict the size of the random seed, so that one can still read the output of doctesting.



---

archive/issue_comments_421696.json:
```json
{
    "body": "Replying to [comment:69 gh-kliem]:\n> Maybe it makes sense to restrict the size of the random seed, so that one can still read the output of doctesting.\n\nit's not clear to me what you mean here.",
    "created_at": "2020-07-11T07:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421696",
    "user": "dimpase"
}
```

Replying to [comment:69 gh-kliem]:
> Maybe it makes sense to restrict the size of the random seed, so that one can still read the output of doctesting.

it's not clear to me what you mean here.



---

archive/issue_comments_421697.json:
```json
{
    "body": "\n```\nsage -t src/sage/all.py \nRunning doctests with ID 2020-06-23-23-19-03-8003eea5.\n...\nsage -t --warn-long 89.5 --random-seed=273987373473433732996760115183658447263 src/sage/all.py\n    [16 tests, 0.73 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.8 seconds\n    cpu time: 0.7 seconds\n    cumulative wall time: 0.7 seconds\n```\n\n\nCurrently this output is the plan. This might be very annoying for patchbots and so on. If we instead restrict to fewer digits, we will still test a reasonable amount of different inputs and you can still read this line (even if working on a non-huge screen).",
    "created_at": "2020-07-11T07:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421697",
    "user": "@kliem"
}
```


```
sage -t src/sage/all.py 
Running doctests with ID 2020-06-23-23-19-03-8003eea5.
...
sage -t --warn-long 89.5 --random-seed=273987373473433732996760115183658447263 src/sage/all.py
    [16 tests, 0.73 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 0.7 seconds
    cumulative wall time: 0.7 seconds
```


Currently this output is the plan. This might be very annoying for patchbots and so on. If we instead restrict to fewer digits, we will still test a reasonable amount of different inputs and you can still read this line (even if working on a non-huge screen).



---

archive/issue_comments_421698.json:
```json
{
    "body": "I think it is ok - compare this with very long lists of optional packages which are there sometimes.",
    "created_at": "2020-07-11T07:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421698",
    "user": "dimpase"
}
```

I think it is ok - compare this with very long lists of optional packages which are there sometimes.



---

archive/issue_comments_421699.json:
```json
{
    "body": "See #29962#comment:19",
    "created_at": "2020-08-24T06:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421699",
    "user": "@kliem"
}
```

See #29962#comment:19



---

archive/issue_comments_421700.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-27T02:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421700",
    "user": "mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_421701.json:
```json
{
    "body": "Marking this as a meta-ticket.",
    "created_at": "2021-04-29T22:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421701",
    "user": "slelievre"
}
```

Marking this as a meta-ticket.



---

archive/issue_comments_421702.json:
```json
{
    "body": "Changing keywords from \"\" to \"fuzz, random, seed\".",
    "created_at": "2021-04-29T22:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421702",
    "user": "slelievre"
}
```

Changing keywords from "" to "fuzz, random, seed".



---

archive/issue_comments_421703.json:
```json
{
    "body": "Expanding the ticket description, adding a code snippet giving\na way to set a random randomness seed, which I find useful\nfor working on the (few remaining) dependencies of this ticket.",
    "created_at": "2021-06-08T10:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421703",
    "user": "slelievre"
}
```

Expanding the ticket description, adding a code snippet giving
a way to set a random randomness seed, which I find useful
for working on the (few remaining) dependencies of this ticket.



---

archive/issue_comments_421704.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-01T12:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421704",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_421705.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-01T16:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421705",
    "user": "@kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_421706.json:
```json
{
    "body": "A couple of new tests fail yet.",
    "created_at": "2021-07-01T16:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421706",
    "user": "@kliem"
}
```

A couple of new tests fail yet.



---

archive/issue_comments_421707.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2021-07-03T09:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421707",
    "user": "@kliem"
}
```

Last 10 new commits:



---

archive/issue_comments_421708.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-03T09:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421708",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421709.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-03T21:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421709",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-05T08:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421710",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-05T08:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421711",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_421712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-05T08:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421712",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_421713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-05T09:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421713",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421714.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-05T09:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421714",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-05T17:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421715",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T07:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421716",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421717.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T15:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421717",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421718.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-06T16:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421718",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_421719.json:
```json
{
    "body": "This is getting more and more stable.\n\nI can now run it on 8 random seeds without failure (or without failure that doesn't appear on random seed 0). There are probably still failing examples, but its getting to a point, where it won't prevent patchbots from working and it's not too much of a burden to report failures because of this.",
    "created_at": "2021-07-06T16:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421719",
    "user": "@kliem"
}
```

This is getting more and more stable.

I can now run it on 8 random seeds without failure (or without failure that doesn't appear on random seed 0). There are probably still failing examples, but its getting to a point, where it won't prevent patchbots from working and it's not too much of a burden to report failures because of this.



---

archive/issue_comments_421720.json:
```json
{
    "body": "We should also remember to try the optional tests at some point, but I assume the majority of them does not use randomness.",
    "created_at": "2021-07-06T19:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421720",
    "user": "@mwageringel"
}
```

We should also remember to try the optional tests at some point, but I assume the majority of them does not use randomness.



---

archive/issue_comments_421721.json:
```json
{
    "body": "Right, I forgot about the optional packages.\n\nI hope this helps a bit:\n\nhttps://github.com/kliem/sage/pull/48/checks",
    "created_at": "2021-07-06T19:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421721",
    "user": "@kliem"
}
```

Right, I forgot about the optional packages.

I hope this helps a bit:

https://github.com/kliem/sage/pull/48/checks



---

archive/issue_comments_421722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-09T19:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421722",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421723.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-12T06:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421723",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421724.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-12T15:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421724",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421725.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-12T15:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421725",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421726.json:
```json
{
    "body": "I outsourced many of the small fixes to #32188, to make review here easier.",
    "created_at": "2021-07-12T15:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421726",
    "user": "@kliem"
}
```

I outsourced many of the small fixes to #32188, to make review here easier.



---

archive/issue_comments_421727.json:
```json
{
    "body": "Note that doctesting with a fixed seed is publicly documented behaviour in sage. Quoting from [Developer guide](https://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests):\n\n    ''However, most functions generating pseudorandom output do not need this tag since the doctesting framework guarantees the state of the pseudorandom number generators (PRNGs) used in Sage for a given doctest.\n''\n\nI would think that tests explicitly relying on this behaviour are rather weak and I wouldn't mind changing this \"policy\", but we shouldn't forget to update the developer guide as well.",
    "created_at": "2021-07-16T16:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421727",
    "user": "nbruin"
}
```

Note that doctesting with a fixed seed is publicly documented behaviour in sage. Quoting from [Developer guide](https://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests):

    ''However, most functions generating pseudorandom output do not need this tag since the doctesting framework guarantees the state of the pseudorandom number generators (PRNGs) used in Sage for a given doctest.
''

I would think that tests explicitly relying on this behaviour are rather weak and I wouldn't mind changing this "policy", but we shouldn't forget to update the developer guide as well.



---

archive/issue_comments_421728.json:
```json
{
    "body": "Replying to [comment:139 nbruin]:\n> Note that doctesting with a fixed seed is publicly documented behaviour in sage. Quoting from [Developer guide](https://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests):\n> \n>     ''However, most functions generating pseudorandom output do not need this tag since the doctesting framework guarantees the state of the pseudorandom number generators (PRNGs) used in Sage for a given doctest.\n> ''\n> \n> I would think that tests explicitly relying on this behaviour are rather weak and I wouldn't mind changing this \"policy\", but we shouldn't forget to update the developer guide as well.\n\nThanks for the pointer. This is now #32216.",
    "created_at": "2021-07-16T20:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421728",
    "user": "@kliem"
}
```

Replying to [comment:139 nbruin]:
> Note that doctesting with a fixed seed is publicly documented behaviour in sage. Quoting from [Developer guide](https://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests):
> 
>     ''However, most functions generating pseudorandom output do not need this tag since the doctesting framework guarantees the state of the pseudorandom number generators (PRNGs) used in Sage for a given doctest.
> ''
> 
> I would think that tests explicitly relying on this behaviour are rather weak and I wouldn't mind changing this "policy", but we shouldn't forget to update the developer guide as well.

Thanks for the pointer. This is now #32216.



---

archive/issue_comments_421729.json:
```json
{
    "body": "I'll leave #32169 for later and would just like to get this in.\n----\nNew commits:",
    "created_at": "2021-09-16T08:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421729",
    "user": "@kliem"
}
```

I'll leave #32169 for later and would just like to get this in.
----
New commits:



---

archive/issue_comments_421730.json:
```json
{
    "body": "I think this,\n\n\n```patch\n         ....:     n = ZZ.random_element().abs() + 5\n+        ....:     if n > 5000:  # avoid timeouts\n+        ....:         continue\n```\n\n\ncan be simplified by passing `(5,5001)` as the bound to `ZZ.random_element()`, without abs.\n\nAnd the fix for this has already been merged:\n\n\n```patch\n+        sage: test_symbolic_expression_order(10000)  # long time,  # not tested, known bug (see :trac:`32185`)\n```\n",
    "created_at": "2021-09-16T13:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421730",
    "user": "mjo"
}
```

I think this,


```patch
         ....:     n = ZZ.random_element().abs() + 5
+        ....:     if n > 5000:  # avoid timeouts
+        ....:         continue
```


can be simplified by passing `(5,5001)` as the bound to `ZZ.random_element()`, without abs.

And the fix for this has already been merged:


```patch
+        sage: test_symbolic_expression_order(10000)  # long time,  # not tested, known bug (see :trac:`32185`)
```




---

archive/issue_comments_421731.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-16T14:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421731",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421732.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-16T15:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421732",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421733.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-17T09:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421733",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421734.json:
```json
{
    "body": "Looks OK now, but there's really no way to be 100% certain. We will probably discover a few instances where e.g. a ptestlong happens to generate four relatively hard problems at once, leading to intermittent timeouts. But regardless, I think the sooner we can get this in, the better. I started some GH actions for added test cycles.",
    "created_at": "2021-09-19T10:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421734",
    "user": "mjo"
}
```

Looks OK now, but there's really no way to be 100% certain. We will probably discover a few instances where e.g. a ptestlong happens to generate four relatively hard problems at once, leading to intermittent timeouts. But regardless, I think the sooner we can get this in, the better. I started some GH actions for added test cycles.



---

archive/issue_comments_421735.json:
```json
{
    "body": "Replying to [comment:148 mjo]:\n> ... I think the sooner we can get this in, the better. ...\n\n+1",
    "created_at": "2021-09-20T01:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421735",
    "user": "@DaveWitteMorris"
}
```

Replying to [comment:148 mjo]:
> ... I think the sooner we can get this in, the better. ...

+1



---

archive/issue_comments_421736.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-20T07:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421736",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421737.json:
```json
{
    "body": "I also think this is ready. It is rather stable now.\n\nWe should open a new (meta?) ticket, to collect all those failures, I think.",
    "created_at": "2021-09-20T07:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421737",
    "user": "@kliem"
}
```

I also think this is ready. It is rather stable now.

We should open a new (meta?) ticket, to collect all those failures, I think.



---

archive/issue_comments_421738.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-21T00:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421738",
    "user": "mjo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_421739.json:
```json
{
    "body": "Let's just do it before beta2 happens.\n\nThanks for all your work on this, I never had the courage to try it myself.",
    "created_at": "2021-09-21T00:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421739",
    "user": "mjo"
}
```

Let's just do it before beta2 happens.

Thanks for all your work on this, I never had the courage to try it myself.



---

archive/issue_comments_421740.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-09-21T04:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421740",
    "user": "@kliem"
}
```

Thank you.



---

archive/issue_comments_421741.json:
```json
{
    "body": "I created #32544 for the errors appearing now that this is positively reviewed.\nThere already is a ticket on it (#32543).",
    "created_at": "2021-09-21T06:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421741",
    "user": "@kliem"
}
```

I created #32544 for the errors appearing now that this is positively reviewed.
There already is a ticket on it (#32543).



---

archive/issue_comments_421742.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 45.3 --random-seed=58740356065403116296055203326248101103 src/sage/graphs/generic_graph.py\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 23499, in sage.graphs.generic_graph.GenericGraph.edge_polytope\nFailed example:\n    P.is_combinatorially_isomorphic(product(components))\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of  24 in sage.graphs.generic_graph.GenericGraph.edge_polytope\n    [3598 tests, 1 failure, 22.29 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 45.3 --random-seed=58740356065403116296055203326248101103 src/sage/graphs/generic_graph.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2021-10-02T14:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421742",
    "user": "vbraun"
}
```


```
sage -t --long --warn-long 45.3 --random-seed=58740356065403116296055203326248101103 src/sage/graphs/generic_graph.py
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 23499, in sage.graphs.generic_graph.GenericGraph.edge_polytope
Failed example:
    P.is_combinatorially_isomorphic(product(components))
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  24 in sage.graphs.generic_graph.GenericGraph.edge_polytope
    [3598 tests, 1 failure, 22.29 s]
----------------------------------------------------------------------
sage -t --long --warn-long 45.3 --random-seed=58740356065403116296055203326248101103 src/sage/graphs/generic_graph.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_421743.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-10-02T14:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421743",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_421744.json:
```json
{
    "body": "So this ticket got rejected because it detected my own mistake in #32498. That's fair I guess.\n\nWhat I claimed is complete nonsense, but it did work for seed 0 I guess. The (symmetric) edge polytope of a graph is of course the **join** of the (symmetric) edge polytopes of the connecting compoments.",
    "created_at": "2021-10-02T19:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421744",
    "user": "@kliem"
}
```

So this ticket got rejected because it detected my own mistake in #32498. That's fair I guess.

What I claimed is complete nonsense, but it did work for seed 0 I guess. The (symmetric) edge polytope of a graph is of course the **join** of the (symmetric) edge polytopes of the connecting compoments.



---

archive/issue_comments_421745.json:
```json
{
    "body": "No, that is not the join, it is the subdirect sum. It is really worth reading the definitions once in a while...",
    "created_at": "2021-10-02T19:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421745",
    "user": "@kliem"
}
```

No, that is not the join, it is the subdirect sum. It is really worth reading the definitions once in a while...



---

archive/issue_comments_421746.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-02T19:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421746",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421747.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-02T19:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421747",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_421748.json:
```json
{
    "body": "`@`Martin Rubey: Can you please check the fix of #32498, everything else should still be fine.",
    "created_at": "2021-10-02T19:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421748",
    "user": "@kliem"
}
```

`@`Martin Rubey: Can you please check the fix of #32498, everything else should still be fine.



---

archive/issue_comments_421749.json:
```json
{
    "body": "I'm afraid there is a `MemoryError` reported by the bot.  I'll check whether it is reproducible.",
    "created_at": "2021-10-04T08:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421749",
    "user": "mantepse"
}
```

I'm afraid there is a `MemoryError` reported by the bot.  I'll check whether it is reproducible.



---

archive/issue_comments_421750.json:
```json
{
    "body": "\n```\nsage -t --random-seed=306431873350217748498615142104107167501 src/sage/graphs/generic_graph.py\n**********************************************************************\nFile \"src/sage/graphs/generic_graph.py\", line 23601, in sage.graphs.generic_graph.GenericGraph.symmetric_edge_polytope\nFailed example:\n    P.is_combinatorially_isomorphic(P1.subdirect_sum(P2))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generic_graph.GenericGraph.symmetric_edge_polytope[20]>\", line 1, in <module>\n        P.is_combinatorially_isomorphic(P1.subdirect_sum(P2))\n      File \"/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py\", line 10715, in is_combinatorially_isomorphic\n        return G_self.is_isomorphic(G_other)\n      File \"/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py\", line 22672, in is_isomorphic\n        isom = isomorphic(GC, GC2, partition, partition2, (self._directed or self.has_loops()), 1)\n      File \"sage/groups/perm_gps/partn_ref/refinement_graphs.pyx\", line 163, in sage.groups.perm_gps.partn_ref.refinement_graphs.isomorphic (build/cythonized/sage/groups/perm_gps/partn_ref/refinement_graphs.c:6775)\n        cdef bint isomorphic = double_coset(<void *>GS1, <void *>GS2, part, ordering, n, &all_children_are_equivalent, &refine_by_degree, &compare_graphs, NULL, NULL, output)\n      File \"sage/groups/perm_gps/partn_ref/double_coset.pyx\", line 364, in sage.groups.perm_gps.partn_ref.double_coset.double_coset (build/cythonized/sage/groups/perm_gps/partn_ref/double_coset.c:5618)\n        raise MemoryError\n    MemoryError\n**********************************************************************\n1 item had failures:\n   1 of  53 in sage.graphs.generic_graph.GenericGraph.symmetric_edge_polytope\n    [3558 tests, 1 failure, 42.09 s]\n----------------------------------------------------------------------\nsage -t --random-seed=306431873350217748498615142104107167501 src/sage/graphs/generic_graph.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 43.1 seconds\n    cpu time: 40.1 seconds\n    cumulative wall time: 42.1 seconds\nPytest is not installed, skip checking tests that rely on it.\n```\n",
    "created_at": "2021-10-04T08:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421750",
    "user": "mantepse"
}
```


```
sage -t --random-seed=306431873350217748498615142104107167501 src/sage/graphs/generic_graph.py
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 23601, in sage.graphs.generic_graph.GenericGraph.symmetric_edge_polytope
Failed example:
    P.is_combinatorially_isomorphic(P1.subdirect_sum(P2))
Exception raised:
    Traceback (most recent call last):
      File "/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generic_graph.GenericGraph.symmetric_edge_polytope[20]>", line 1, in <module>
        P.is_combinatorially_isomorphic(P1.subdirect_sum(P2))
      File "/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py", line 10715, in is_combinatorially_isomorphic
        return G_self.is_isomorphic(G_other)
      File "/home/martin/sage-develop/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py", line 22672, in is_isomorphic
        isom = isomorphic(GC, GC2, partition, partition2, (self._directed or self.has_loops()), 1)
      File "sage/groups/perm_gps/partn_ref/refinement_graphs.pyx", line 163, in sage.groups.perm_gps.partn_ref.refinement_graphs.isomorphic (build/cythonized/sage/groups/perm_gps/partn_ref/refinement_graphs.c:6775)
        cdef bint isomorphic = double_coset(<void *>GS1, <void *>GS2, part, ordering, n, &all_children_are_equivalent, &refine_by_degree, &compare_graphs, NULL, NULL, output)
      File "sage/groups/perm_gps/partn_ref/double_coset.pyx", line 364, in sage.groups.perm_gps.partn_ref.double_coset.double_coset (build/cythonized/sage/groups/perm_gps/partn_ref/double_coset.c:5618)
        raise MemoryError
    MemoryError
**********************************************************************
1 item had failures:
   1 of  53 in sage.graphs.generic_graph.GenericGraph.symmetric_edge_polytope
    [3558 tests, 1 failure, 42.09 s]
----------------------------------------------------------------------
sage -t --random-seed=306431873350217748498615142104107167501 src/sage/graphs/generic_graph.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 43.1 seconds
    cpu time: 40.1 seconds
    cumulative wall time: 42.1 seconds
Pytest is not installed, skip checking tests that rely on it.
```




---

archive/issue_comments_421751.json:
```json
{
    "body": "Looks like I need to reduce the number of vertices.",
    "created_at": "2021-10-04T08:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421751",
    "user": "@kliem"
}
```

Looks like I need to reduce the number of vertices.



---

archive/issue_comments_421752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-04T08:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421752",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421753.json:
```json
{
    "body": "Previously I decomposed random graphs of up to 12 vertices. Now I take the disjoint union of random graphs and need to go down with the number of vertices.",
    "created_at": "2021-10-04T08:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421753",
    "user": "@kliem"
}
```

Previously I decomposed random graphs of up to 12 vertices. Now I take the disjoint union of random graphs and need to go down with the number of vertices.



---

archive/issue_comments_421754.json:
```json
{
    "body": "timeout",
    "created_at": "2021-10-04T09:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421754",
    "user": "mantepse"
}
```

timeout



---

archive/issue_comments_421755.json:
```json
{
    "body": "Attachment [timeout.txt](tarball://root/attachments/some-uuid/ticket29935/timeout.txt) by mantepse created at 2021-10-04 09:48:53\n\nIt seems that there is still a problem.  With some seeds, testing `generic_graph.py` takes about 16 seconds on my computer.  However,\n\n```\nsage -t --random-seed=236024484355828254371843550334759500607 src/sage/graphs/generic_graph.py\n```\n\ntimes out.  I attached the log.  The last line executed is\n\n```\nsage: trees = g.edge_disjoint_spanning_trees(k) ## line 6282 ##\n```\n\n\nOf course, this should not have anything to do with the SEP.",
    "created_at": "2021-10-04T09:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421755",
    "user": "mantepse"
}
```

Attachment [timeout.txt](tarball://root/attachments/some-uuid/ticket29935/timeout.txt) by mantepse created at 2021-10-04 09:48:53

It seems that there is still a problem.  With some seeds, testing `generic_graph.py` takes about 16 seconds on my computer.  However,

```
sage -t --random-seed=236024484355828254371843550334759500607 src/sage/graphs/generic_graph.py
```

times out.  I attached the log.  The last line executed is

```
sage: trees = g.edge_disjoint_spanning_trees(k) ## line 6282 ##
```


Of course, this should not have anything to do with the SEP.



---

archive/issue_comments_421756.json:
```json
{
    "body": "Yes, that is #32169. I was wondering why it did not happen in this case.",
    "created_at": "2021-10-04T09:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421756",
    "user": "@kliem"
}
```

Yes, that is #32169. I was wondering why it did not happen in this case.



---

archive/issue_comments_421757.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-04T09:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421757",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-08T07:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421758",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421759.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-08T14:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421759",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421760.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-10-08T14:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421760",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_421761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-10-11T05:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421761",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_421762.json:
```json
{
    "body": "Rebased on #32498, which fixes the error with (symmetric) edge polytopes.",
    "created_at": "2021-10-11T05:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421762",
    "user": "@kliem"
}
```

Rebased on #32498, which fixes the error with (symmetric) edge polytopes.



---

archive/issue_comments_421763.json:
```json
{
    "body": "Correct ticket.",
    "created_at": "2021-10-11T07:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421763",
    "user": "@kliem"
}
```

Correct ticket.



---

archive/issue_comments_421764.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-13T12:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421764",
    "user": "mjo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_421765.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-10-13T12:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421765",
    "user": "@kliem"
}
```

Thank you.



---

archive/issue_comments_421766.json:
```json
{
    "body": "No problem, you'll have to rebase this onto the typo-fix too I think.",
    "created_at": "2021-10-13T12:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421766",
    "user": "mjo"
}
```

No problem, you'll have to rebase this onto the typo-fix too I think.



---

archive/issue_comments_421767.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-10-13T12:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421767",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_421768.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:",
    "created_at": "2021-10-13T12:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421768",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:



---

archive/issue_comments_421769.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-13T12:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421769",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_421770.json:
```json
{
    "body": "Replying to [comment:176 mjo]:\n> No problem, you'll have to rebase this onto the typo-fix too I think.\n\nI don't know, if this is necessary, but it sure doesn't hurt.",
    "created_at": "2021-10-13T12:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421770",
    "user": "@kliem"
}
```

Replying to [comment:176 mjo]:
> No problem, you'll have to rebase this onto the typo-fix too I think.

I don't know, if this is necessary, but it sure doesn't hurt.



---

archive/issue_comments_421771.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-10-13T19:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421771",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_421772.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-10-13T19:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421772",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_421773.json:
```json
{
    "body": "This is the merge conflict, which permits a trivial solution (at least trivial for a human being):\n\n\n```diff\ndiff --cc src/bin/sage-runtests\nindex d1fe6567e7,4fc2062b15..0000000000\n--- a/src/bin/sage-runtests\n+++ b/src/bin/sage-runtests\n@@@ -64,59 -55,60 +55,97 @@@ if __name__ == \"__main__\"\n               'if \"external\" is listed, will also run tests for available external software; '\n               'if \"build\" is listed, will also run tests specific to Sage\\'s build/packaging system; '\n               'if set to \"all\", then all tests will be run')\n++<<<<<<< HEAD\n +    parser.add_option(\"--randorder\", type=int, metavar=\"SEED\", help=\"randomize order of tests\")\n +    parser.add_option(\"--random-seed\", dest=\"random_seed\", type=int, metavar=\"SEED\", help=\"random seed (integer) for fuzzing doctests\")\n +    parser.add_option(\"--global-iterations\", \"--global_iterations\", type=int, default=0, help=\"repeat the whole testing process this many times\")\n +    parser.add_option(\"--file-iterations\", \"--file_iterations\", type=int, default=0, help=\"repeat each file this many times, stopping on the first failure\")\n +    parser.add_option(\"--environment\", type=str, default=\"sage.repl.ipython_kernel.all_jupyter\", help=\"name of a module that provides the global environment for tests\")\n +\n +    parser.add_option(\"-i\", \"--initial\", action=\"store_true\", default=False, help=\"only show the first failure in each file\")\n +    parser.add_option(\"--exitfirst\", action=\"store_true\", default=False, help=\"end the test run immediately after the first failure or unexpected exception\")\n +    parser.add_option(\"--force_lib\", \"--force-lib\", action=\"store_true\", default=False, help=\"do not import anything from the tested file(s)\")\n +    parser.add_option(\"--abspath\", action=\"store_true\", default=False, help=\"print absolute paths rather than relative paths\")\n +    parser.add_option(\"--verbose\", action=\"store_true\", default=False, help=\"print debugging output during the test\")\n +    parser.add_option(\"-d\", \"--debug\", action=\"store_true\", default=False, help=\"drop into a python debugger when an unexpected error is raised\")\n +    parser.add_option(\"--only-errors\", action=\"store_true\", default=False, help=\"only output failures, not test successes\")\n +\n +    parser.add_option(\"--gdb\", action=\"store_true\", default=False, help=\"run doctests under the control of gdb\")\n +    parser.add_option(\"--valgrind\", \"--memcheck\", action=\"store_true\", default=False,\n +                      help=\"run doctests using Valgrind's memcheck tool.  The log \"\n +                         \"files are named sage-memcheck.PID and can be found in \" +\n +                         os.path.join(DOT_SAGE, \"valgrind\"))\n +    parser.add_option(\"--massif\", action=\"store_true\", default=False,\n +                      help=\"run doctests using Valgrind's massif tool.  The log \"\n +                         \"files are named sage-massif.PID and can be found in \" +\n +                         os.path.join(DOT_SAGE, \"valgrind\"))\n +    parser.add_option(\"--cachegrind\", action=\"store_true\", default=False,\n +                      help=\"run doctests using Valgrind's cachegrind tool.  The log \"\n +                         \"files are named sage-cachegrind.PID and can be found in \" +\n +                         os.path.join(DOT_SAGE, \"valgrind\"))\n +    parser.add_option(\"--omega\", action=\"store_true\", default=False,\n +                      help=\"run doctests using Valgrind's omega tool.  The log \"\n +                         \"files are named sage-omega.PID and can be found in \" +\n +                         os.path.join(DOT_SAGE, \"valgrind\"))\n +\n +    parser.add_option(\"-f\", \"--failed\", action=\"store_true\", default=False,\n++=======\n+     parser.add_argument(\"--randorder\", type=int, metavar=\"SEED\", help=\"randomize order of tests\")\n+     parser.add_argument(\"--random-seed\", dest=\"random_seed\", type=int, metavar=\"SEED\", help=\"random seed for fuzzing doctests\")\n+     parser.add_argument(\"--global-iterations\", \"--global_iterations\", type=int, default=0, help=\"repeat the whole testing process this many times\")\n+     parser.add_argument(\"--file-iterations\", \"--file_iterations\", type=int, default=0, help=\"repeat each file this many times, stopping on the first failure\")\n+     parser.add_argument(\"--environment\", type=str, default=\"sage.repl.ipython_kernel.all_jupyter\", help=\"name of a module that provides the global environment for tests\")\n+ \n+     parser.add_argument(\"-i\", \"--initial\", action=\"store_true\", default=False, help=\"only show the first failure in each file\")\n+     parser.add_argument(\"--exitfirst\", action=\"store_true\", default=False, help=\"end the test run immediately after the first failure or unexpected exception\")\n+     parser.add_argument(\"--force_lib\", \"--force-lib\", action=\"store_true\", default=False, help=\"do not import anything from the test\n...\n```\n",
    "created_at": "2021-10-13T19:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421773",
    "user": "@kliem"
}
```

This is the merge conflict, which permits a trivial solution (at least trivial for a human being):


```diff
diff --cc src/bin/sage-runtests
index d1fe6567e7,4fc2062b15..0000000000
--- a/src/bin/sage-runtests
+++ b/src/bin/sage-runtests
@@@ -64,59 -55,60 +55,97 @@@ if __name__ == "__main__"
               'if "external" is listed, will also run tests for available external software; '
               'if "build" is listed, will also run tests specific to Sage\'s build/packaging system; '
               'if set to "all", then all tests will be run')
++<<<<<<< HEAD
 +    parser.add_option("--randorder", type=int, metavar="SEED", help="randomize order of tests")
 +    parser.add_option("--random-seed", dest="random_seed", type=int, metavar="SEED", help="random seed (integer) for fuzzing doctests")
 +    parser.add_option("--global-iterations", "--global_iterations", type=int, default=0, help="repeat the whole testing process this many times")
 +    parser.add_option("--file-iterations", "--file_iterations", type=int, default=0, help="repeat each file this many times, stopping on the first failure")
 +    parser.add_option("--environment", type=str, default="sage.repl.ipython_kernel.all_jupyter", help="name of a module that provides the global environment for tests")
 +
 +    parser.add_option("-i", "--initial", action="store_true", default=False, help="only show the first failure in each file")
 +    parser.add_option("--exitfirst", action="store_true", default=False, help="end the test run immediately after the first failure or unexpected exception")
 +    parser.add_option("--force_lib", "--force-lib", action="store_true", default=False, help="do not import anything from the tested file(s)")
 +    parser.add_option("--abspath", action="store_true", default=False, help="print absolute paths rather than relative paths")
 +    parser.add_option("--verbose", action="store_true", default=False, help="print debugging output during the test")
 +    parser.add_option("-d", "--debug", action="store_true", default=False, help="drop into a python debugger when an unexpected error is raised")
 +    parser.add_option("--only-errors", action="store_true", default=False, help="only output failures, not test successes")
 +
 +    parser.add_option("--gdb", action="store_true", default=False, help="run doctests under the control of gdb")
 +    parser.add_option("--valgrind", "--memcheck", action="store_true", default=False,
 +                      help="run doctests using Valgrind's memcheck tool.  The log "
 +                         "files are named sage-memcheck.PID and can be found in " +
 +                         os.path.join(DOT_SAGE, "valgrind"))
 +    parser.add_option("--massif", action="store_true", default=False,
 +                      help="run doctests using Valgrind's massif tool.  The log "
 +                         "files are named sage-massif.PID and can be found in " +
 +                         os.path.join(DOT_SAGE, "valgrind"))
 +    parser.add_option("--cachegrind", action="store_true", default=False,
 +                      help="run doctests using Valgrind's cachegrind tool.  The log "
 +                         "files are named sage-cachegrind.PID and can be found in " +
 +                         os.path.join(DOT_SAGE, "valgrind"))
 +    parser.add_option("--omega", action="store_true", default=False,
 +                      help="run doctests using Valgrind's omega tool.  The log "
 +                         "files are named sage-omega.PID and can be found in " +
 +                         os.path.join(DOT_SAGE, "valgrind"))
 +
 +    parser.add_option("-f", "--failed", action="store_true", default=False,
++=======
+     parser.add_argument("--randorder", type=int, metavar="SEED", help="randomize order of tests")
+     parser.add_argument("--random-seed", dest="random_seed", type=int, metavar="SEED", help="random seed for fuzzing doctests")
+     parser.add_argument("--global-iterations", "--global_iterations", type=int, default=0, help="repeat the whole testing process this many times")
+     parser.add_argument("--file-iterations", "--file_iterations", type=int, default=0, help="repeat each file this many times, stopping on the first failure")
+     parser.add_argument("--environment", type=str, default="sage.repl.ipython_kernel.all_jupyter", help="name of a module that provides the global environment for tests")
+ 
+     parser.add_argument("-i", "--initial", action="store_true", default=False, help="only show the first failure in each file")
+     parser.add_argument("--exitfirst", action="store_true", default=False, help="end the test run immediately after the first failure or unexpected exception")
+     parser.add_argument("--force_lib", "--force-lib", action="store_true", default=False, help="do not import anything from the test
...
```




---

archive/issue_comments_421774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-13T19:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421774",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421775.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-10-13T19:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421775",
    "user": "@kliem"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_421776.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29698#issuecomment-421776",
    "user": "vbraun"
}
```

Resolution: fixed
