# Issue 24536: Delayed/Conditional Substitution

Issue created by migration from Trac.

Original creator: cheuberg

Original creation time: 2018-02-19 12:47:09

CC:  dkrenn behackl rws

Mathematica (see http://reference.wolfram.com/language/ref/RuleDelayed.html) has a very useful feature called delayed rule. Instead of a static rule, a function is invoked which decides looking at the argument how the actual substitution should be carried out. This is a useful feature when simplifying some symbolic expressions.

This ticket shall implement such a delayed substitution in [SageMath](SageMath).


---

Comment by cheuberg created at 2018-02-19 13:07:40

Changing status from new to needs_review.


---

Comment by cheuberg created at 2018-02-19 13:07:40

New commits:


---

Comment by dkrenn created at 2018-02-19 13:22:59

LGTM, but I want to raise the following to be discussed: the name `delayed_substitution` of the method. The other substitute-methods are called `substitute*`, so maybe an `substitute_delayed` would fit more into this scheme. However, I do not have a strong opinion on this topic.

The first basic Mathematica example is

```
{x, x, x} /. x :> RandomReal[]
```

so maybe adding this example as well could be a benefit.


---

Comment by dkrenn created at 2018-02-19 13:22:59

Changing status from needs_review to needs_info.


---

Comment by rws created at 2018-02-19 13:52:30

Replying to [comment:3 dkrenn]:
> LGTM, but I want to raise the following to be discussed: the name `delayed_substitution` of the method. The other substitute-methods are called `substitute*`, so maybe an `substitute_delayed` would fit more into this scheme. 

Agree, mostly because it makes it easier to be found by TAB completion.


---

Comment by git created at 2018-02-19 15:51:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2018-02-19 16:03:54

I renamed the method as suggested.

Concerning the Mathematica example: I have two problems with that example. The first being that a list is not a symbolic expression. So we would need something like

```
sage: var('a b c')
sage: e1 = a*x + b*x + c*x
```

But then, it does not work as expected:

```
sage: e1.substitution_delayed(x, lambda d: random())
0.7859203112304044*a + 0.7859203112304044*b + 0.7859203112304044*c
```


The reason is that the code proposed here tries to do the job with as little effort as possible. This means that first, I look for all matches of the pattern:

```
sage: e1.find(x)
[x]
```

And then, I simply replace all occurrences.

One possibility would be:

```
sage: var('a b c x y z')
sage: w = SR.wild(0)
sage: e2 = a*sin(x) + b*sin(y) + c*sin(z)
sage: e2.substitution_delayed(sin(w), lambda d: random())
0.9299473549632423*a + 0.1776245598330548*b + 0.5870609216512541*c
```



---

Comment by cheuberg created at 2018-02-19 17:25:16

Changing status from needs_info to needs_review.


---

Comment by dkrenn created at 2018-02-20 13:55:33

Replying to [comment:6 cheuberg]:
> Concerning the Mathematica example: I have two problems with that example. The first being that a list is not a symbolic expression. So we would need something like
> {{{
> sage: var('a b c')
> sage: e1 = a*x + b*x + c*x
> }}}
> But then, [...]

Ok, I understand. Then I suggest to skip this example completely to not get confused.


---

Comment by dkrenn created at 2018-02-20 13:55:54

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2018-02-20 14:15:28

I think this is badly missing documentation. I just read the docstring and have absolutely no clue what this is about.

What does the "delayed" in the name refer to? How does this differ from `subs` or `subs_expr`? Can you add an example which is actually meant to explain what this method does?


---

Comment by jdemeyer created at 2018-02-20 14:15:28

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-02-20 17:18:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2018-02-20 17:22:10

I have added an example and some more explanation.


---

Comment by cheuberg created at 2018-02-20 17:22:10

Changing status from needs_work to needs_review.


---

Comment by rws created at 2018-02-24 07:02:53

Changing status from needs_review to positive_review.


---

Comment by rws created at 2018-02-24 07:02:53

I think it's worth to have. LGTM too.


---

Comment by vbraun created at 2018-02-25 20:00:28

Resolution: fixed
