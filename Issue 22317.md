# Issue 22317: Use create_extension() from Cython

archive/issues_022317.json:
```json
{
    "body": "Implement a custom `create_extension()` function for Cython.\n\nThis requires an upstream patch https://github.com/cython/cython/pull/466\n\nIssue created by migration from https://trac.sagemath.org/ticket/22554\n\n",
    "created_at": "2017-03-09T10:39:04Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Use create_extension() from Cython",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22317",
    "user": "jdemeyer"
}
```
Implement a custom `create_extension()` function for Cython.

This requires an upstream patch https://github.com/cython/cython/pull/466

Issue created by migration from https://trac.sagemath.org/ticket/22554





---

archive/issue_comments_310150.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-09T11:26:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310150",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_310151.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-09T11:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310151",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_310152.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-09T13:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310152",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_310153.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-09T14:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310153",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_310154.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-09T14:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310154",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_310155.json:
```json
{
    "body": "I can't really comment on this patch, but I've successfully built sage with it on my Mac with homebrew (which provides gfortran, so the Sage gcc is not installed), using Apple's \"gcc\" (clang)",
    "created_at": "2017-03-19T05:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310155",
    "user": "mkoeppe"
}
```

I can't really comment on this patch, but I've successfully built sage with it on my Mac with homebrew (which provides gfortran, so the Sage gcc is not installed), using Apple's "gcc" (clang)



---

archive/issue_comments_310156.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> I can't really comment on this patch, but I've successfully built sage with it on my Mac with homebrew (which provides gfortran, so the Sage gcc is not installed), using Apple's \"gcc\" (clang)\n\nJust to be clear: I assume you mean with `SAGE_INSTALL_GCC=no`, otherwise Sage will build and use GCC anyway.",
    "created_at": "2017-03-19T15:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310156",
    "user": "jdemeyer"
}
```

Replying to [comment:11 mkoeppe]:
> I can't really comment on this patch, but I've successfully built sage with it on my Mac with homebrew (which provides gfortran, so the Sage gcc is not installed), using Apple's "gcc" (clang)

Just to be clear: I assume you mean with `SAGE_INSTALL_GCC=no`, otherwise Sage will build and use GCC anyway.



---

archive/issue_comments_310157.json:
```json
{
    "body": "Turns out I used a different \"feature\" of the build system. I had configured using `./configure CC=gcc-6 CXX=g++-6` (they are from homebrew) and then configure was happy; but then the build just used /usr/bin/gcc anyway. (This bug is #22646.)",
    "created_at": "2017-03-19T15:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310157",
    "user": "mkoeppe"
}
```

Turns out I used a different "feature" of the build system. I had configured using `./configure CC=gcc-6 CXX=g++-6` (they are from homebrew) and then configure was happy; but then the build just used /usr/bin/gcc anyway. (This bug is #22646.)



---

archive/issue_comments_310158.json:
```json
{
    "body": "What does \"This requires an upstream patch\" mean? That it should be applied to the upstream tarball?\n\n(in fact one does not seem to need it to be applied to Sage, so this probably needs to be clarified in the ticket description)",
    "created_at": "2017-03-27T13:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310158",
    "user": "dimpase"
}
```

What does "This requires an upstream patch" mean? That it should be applied to the upstream tarball?

(in fact one does not seem to need it to be applied to Sage, so this probably needs to be clarified in the ticket description)



---

archive/issue_comments_310159.json:
```json
{
    "body": "Replying to [comment:15 dimpase]:\n> What does \"This requires an upstream patch\" mean?\n\nThat the patch from the linked github pull request should be applied to the Cython sources. In this case, the patch is added as `build/pkgs/cython/patches/create_extension.patch` and the Cython version number is bumped to force rebuilding Cython with that patch.",
    "created_at": "2017-03-27T14:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310159",
    "user": "jdemeyer"
}
```

Replying to [comment:15 dimpase]:
> What does "This requires an upstream patch" mean?

That the patch from the linked github pull request should be applied to the Cython sources. In this case, the patch is added as `build/pkgs/cython/patches/create_extension.patch` and the Cython version number is bumped to force rebuilding Cython with that patch.



---

archive/issue_comments_310160.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-27T21:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310160",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_310161.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-29T16:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22317#issuecomment-310161",
    "user": "vbraun"
}
```

Resolution: fixed
