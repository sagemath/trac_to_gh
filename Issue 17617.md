# Issue 17617: Metaticket: remove c_lib

Issue created by migration from https://trac.sagemath.org/ticket/17854

Original creator: jdemeyer

Original creation time: 2015-02-25 16:15:30

CC:  fbissey

Move `c_lib` code to Cython modules, or refactor code to no longer use `c_lib`:

* #17789: Remove c_lib/src/ZZ_pylong.cpp
* #17853: Implement mpz_pylong in Cython
* #17788: PARI: store GEN as mpz/mpq
* #17784: Modernize NTL error handler
* #17819: Use uintmax_t for Integer.divisors


---

Comment by fbissey created at 2015-02-25 20:53:18

That's ambitious and will remove one barrier to having simultaneous python2.7 and python3.x installs at the same time (the others being polybori and pynac).


---

Comment by fbissey created at 2015-03-02 21:45:57

Hum... That will get rid of the last doctest that give a different result with gmp than with mpir.


---

Comment by jdemeyer created at 2015-03-02 22:28:12

Replying to [comment:8 fbissey]:
> Hum... That will get rid of the last doctest that give a different result with gmp than with mpir.

Which doctest?


---

Comment by fbissey created at 2015-03-02 22:33:10

I should have commented in #17881, commenting here was a mistake. I am talking about the doctest you removed so far in `sage/rings/integer.pyx` it gives a sligthly different answer for gmp than mpir. This is something we have identified a while ago with Jean-Pierre Flori.

For info this is what it gives for gmp:

```
**********************************************************************
File "/usr/share/sage/src/sage/rings/integer.pyx", line 1938, in sage.rings.integer.Integer.__pow__
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes  
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 850, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer.__pow__[27]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "sage/rings/integer.pyx", line 1977, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:12942)
        sig_on()
      File "sage/ext/c_lib.pyx", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1035)
        raise RuntimeError(msg)
    RuntimeError: Aborted
```



---

Comment by jdemeyer created at 2015-03-02 22:39:21

Yes, GMP has some extra error checking that MPIR doesn't have.

Anyway, this doctest will not be removed, just _moved_ to a different file in #17881.


---

Comment by fbissey created at 2015-03-02 22:57:21

Indeed it escaped my attention. So it will just move a bit. No biggy in any case.


---

Comment by jdemeyer created at 2015-05-27 12:35:40

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-05-27 12:35:40

Last 10 new commits:


---

Comment by git created at 2015-05-27 14:05:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-06-03 09:41:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-06-03 09:42:18

Merged latest versions of dependencies, now that they have positive_review.


---

Comment by fbissey created at 2015-06-03 09:58:42

OK I was a tiny bit too late with my comment in #18367. Anyway, it is now definitely all good to go. I want to see that stuff in 6.8.beta3, it is ready for the bots.


---

Comment by fbissey created at 2015-06-03 09:58:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-06-04 22:46:33

Resolution: fixed
